{"mappings":"C,A,W,S,E,C,C,C,C,C,C,C,E,O,c,C,E,E,C,I,E,I,E,W,C,E,a,C,C,E,C,S,E,C,E,O,G,E,U,C,E,O,C,C,C,I,E,A,C,A,a,O,W,W,A,a,O,K,K,A,a,O,O,O,A,a,O,O,O,C,C,E,iB,C,E,Q,C,Q,S,C,C,C,E,E,E,O,C,Q,W,O,C,G,I,E,E,S,E,E,S,E,E,S,E,E,S,E,S,I,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,SC8Ba,EAAN,W,aAAM,SAAA,EAyDY,CAzDZ,E,I,E,I,CAAA,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,IAAA,CAAA,GAyDY,IAAA,CAAA,CAAA,CAAA,EAvDb,IAAA,CAAA,aAAA,CAAyB,CAAA,EAEhB,IAAA,CAAA,QAAA,CAAuB,EAAE,CAqE1C,IAAA,CAAA,WAAA,CAAuC,SAAC,CAAxC,EACI,EAAK,cAAA,CAAe,EACxB,EAhBI,IAAI,CAAC,eAAA,CAAkB,SAAS,cAAA,CAAe,kBAC/C,IAAI,CAAC,mBAAA,CAAsB,SAAS,cAAA,CAAe,uBAC/C,IAAI,CAAC,mBAAA,EACL,CAAA,IAAI,CAAC,mBAAA,CAAoB,WAAA,CAAc,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,qBADhD,EAII,EAAE,cAAA,EACF,CAAA,AAAA,EAAA,QAAO,CAAE,cAAA,CAAiB,CAAA,CAD9B,EAGI,EAAE,OAAA,EACF,IAAI,CAAC,cAAA,CAAe,EAAE,OAD1B,C,CApEK,MAAA,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,EAAA,C,CAUT,IAAA,iBAAA,MAAA,SAAgB,CAAmB,E,I,E,I,CAC/B,GAAI,CACA,GAAI,IAAI,CAAC,aAAA,CACL,MAAM,AAAI,MAAM,6BAEpB,CAAA,IAAI,CAAC,aAAA,CAAgB,CAAA,EAErB,IAAM,EAAe,IAAI,EAAA,YAAW,CAChC,EAAA,SAAQ,CACR,CAAA,EACA,CAAA,EACA,WAAO,EACP,WAAM,MAAA,EAAA,EAAK,KAAA,EAAQ,EAAK,KAAA,CAAM,SAAA,EAC9B,EAAA,KACA,KAEJ,CAAA,IAAI,CAAC,KAAA,CAAQ,IAAI,EAAA,KAAI,CACjB,EACA,CACI,aAAA,EACA,UAAW,IAAI,CAAC,CAAA,CAAE,SAAlB,CACA,QAAS,IAAI,CAAC,CAAA,CAAE,OAAhB,CACA,MAAO,CACH,IAAK,IAAI,CAAC,CAAA,CAAE,QAAZ,CACA,SAAU,IAAI,CAAC,CAAA,CAAE,QAAjB,AACJ,CACJ,GAEJ,EAAa,IAAb,GAEA,IAAI,CAAC,eAAA,EAAmB,IAAI,CAAC,eAAA,CAAgB,MAA7C,GACA,IAAI,CAAC,eAAA,CAAkB,KACvB,IAAI,CAAC,mBAAA,CAAsB,KAE3B,SAAS,IAAA,CAAK,MAAA,CAAO,IAAI,CAAC,KAAA,CAAM,KAAhC,GACJ,CAAE,MAAO,EAAG,CACJ,IAAI,CAAC,mBAAA,EACL,CAAA,IAAI,CAAC,mBAAA,CAAoB,WAAA,CAAc,KAAO,CAAA,EAE9C,IAAI,CAAC,eAAA,EACL,CAAA,IAAI,CAAC,eAAA,CAAgB,SAAA,EAAa,sBADtC,EAGA,QAAQ,KAAA,CAAM,EAClB,CACJ,C,E,CAuBA,IAAA,YAAA,MAAA,SAAW,CAAa,EAChB,IAAI,CAAC,mBAAA,EACL,CAAA,IAAI,CAAC,mBAAA,CAAoB,WAAA,CAAc,KAAO,CADlD,EAGI,IAAI,CAAC,eAAA,EACL,CAAA,IAAI,CAAC,eAAA,CAAgB,SAAA,EAAa,sBADtC,CAGJ,C,E,CAEA,IAAA,SAAA,MAAA,WACI,GAAI,CAAC,IAAI,CAAC,KAAA,CACN,MAAM,AAAI,MAAM,uBAEpB,OAAO,IAAI,CAAC,KAAA,CAAM,MAAlB,EACJ,C,E,CAEM,IAAA,SAAN,MAAA,W,I,E,I,CAAA,MAAA,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,W,M,A,C,E,E,W,A,E,I,C,S,C,E,O,E,K,E,K,EACI,GAAI,CAAC,EAAK,KAAA,CACN,MAAM,AAAI,MAAM,uBAEb,MAAA,C,EAAM,EAAK,KAAA,CAAM,MAAX,G,A,M,EAAb,MAAA,C,EAAO,EAAA,IAAA,G,A,C,EACX,I,C,E,CAEA,IAAA,WAAA,MAAA,SAAU,CAAgB,E,I,E,I,CACtB,GAAI,AAAgB,IAAhB,EAAK,MAAA,EAIT,IAAM,EAAW,SAAC,CAAlB,EACI,GAAI,CACA,IAAM,EAAM,EAAM,KAAA,CAAc,OAAA,CAAQ,EAAK,IAA7C,EACM,EAAU,AAAA,CAAA,EAAA,EAAA,gBAAe,AAAf,EAAiB,AAAA,CAAA,EAAA,EAAA,OAAM,AAAN,EAAQ,IACzC,EAAK,QAAA,CAAS,EAClB,CAAE,MAAO,EAAG,CACR,QAAQ,KAAA,CAAM,qBAAsB,GACpC,EAAK,QAAA,CAAS,KAClB,CACJ,EAGA,GAAK,IAAI,CAAC,KAAA,CAkBN,EAAK,OAAA,CAAQ,OAlBA,C,I,E,I,AACgB,CAAA,IAAzB,IAAI,CAAC,QAAA,CAAS,MAAA,EAEb,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,W,M,A,C,E,E,W,A,E,I,C,S,C,E,O,E,K,E,K,EAEoB,O,E,I,C,I,C,C,E,G,E,EAAA,C,EAAM,AAAA,CAAA,EAAA,EAAA,SAAQ,AAAR,I,A,M,E,OAAnB,EAAK,KAAA,CAAQ,EAAb,IAAA,G,C,E,E,A,M,E,OACK,EAAA,IAAA,GACL,EAAK,KAAA,CAAQ,Q,C,E,E,A,M,EAEjB,KAAO,EAAK,QAAA,CAAS,MAAA,EACjB,EAAS,EAAK,QAAA,CAAS,KAD3B,I,M,C,E,A,C,EAGJ,KAEJ,EAAK,OAAA,CAAQ,SAAA,CAAb,EACI,EAAK,QAAA,CAAS,IAAA,CAAK,EACvB,EACJ,EAGJ,C,E,EAzIS,C,G,G,E,Q,C,Q,S,C,C,C,E,I,E,E,SE2Eb,G,E,SA5FM,aAAc,QAAQ,SAAQ,EAChC,OAAO,cAAA,CAAe,QAAQ,SAAA,CAAW,WAAY,CACjD,MAAO,SAAU,CAAS,CAAE,CAAS,EACjC,IAAI,CAAC,UAAA,CAAa,EAClB,IAAI,CAAC,SAAA,CAAY,CACrB,CACJ,GAIE,aAAc,QAAQ,SAAQ,EAChC,OAAO,cAAA,CAAe,QAAQ,SAAA,CAAW,WAAY,CACjD,MAAO,SAAU,CAAS,CAAE,CAAS,EACjC,IAAI,CAAC,UAAA,EAAc,EACnB,IAAI,CAAC,SAAA,EAAa,CACtB,CACJ,GAIC,MAAM,SAAA,CAAU,IAAA,EACjB,OAAO,cAAA,CAAe,MAAM,SAAA,CAAW,OAAQ,CAC3C,aAAc,CAAA,EACd,MAAO,SAAS,IAAM,IAAA,IAAA,EAAA,UAAA,MAAA,CAAA,EAAA,AAAA,MAAA,GAAA,EAAA,EAAA,EAAA,EAAA,IAAG,CAAA,CAAH,EAAA,CAAA,SAAA,CAAA,EAAc,CAChC,IAAM,EAAQ,MAAM,CAAI,CAAC,EAAE,EAAI,EAAI,OAAO,CAAI,CAAC,EAAE,EAEjD,OAAO,EAAQ,MAAM,SAAA,CAAU,MAAA,CAAO,IAAA,CAAK,IAAI,CAAE,SAAU,CAAQ,CAAE,CAAG,EAQpE,OAPI,MAAM,OAAA,CAAQ,GAEd,EAAI,IAAA,CAAK,KAAA,CAAM,EAAK,EAAK,IAAA,CAAK,EAAK,EAAQ,IAE3C,EAAI,IAAA,CAAK,GAGN,CACX,EAAG,EAAE,EAAI,MAAM,SAAA,CAAU,KAAA,CAAM,IAAA,CAAK,IAAI,CAC5C,EACA,SAAU,CAAA,CACd,GAKC,OAAO,SAAA,CAAU,UAAA,EAClB,OAAO,cAAA,CAAe,OAAO,SAAA,CAAW,aAAc,CAClD,MAAO,SAAU,CAA4B,CAAE,CAAoB,EAC/D,GAAI,AAAwB,YAAxB,OAAO,EACP,MAAM,AAAI,MAAM,+DAEpB,OAAO,IAAI,CAAC,OAAA,CAAQ,AAAI,OAAO,EAAa,KAAM,EACtD,CACJ,GAwBC,OAAO,WAAA,EACR,OAAO,cAAA,CAAe,OAAQ,cAAe,CACzC,MAAA,SAAO,CAAY,EACf,GAAI,CAAC,GAAW,CAAC,CAAO,CAAC,OAAO,QAAA,CAAS,CACrC,MAAM,AAAI,MAAM,4DAEpB,IAAM,EAAS,CAAC,EAKhB,OAJA,OAAO,IAAA,CAAK,GAAS,OAAA,CAAQ,SAAC,CAA9B,EACI,IAAe,EAAA,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,CAAO,CAAC,EAAI,CAAA,GAApB,EAAQ,CAAA,CAAA,EAAA,CAAL,EAAK,CAAf,CAAA,EAAA,AACA,CAAA,CAAC,CAAC,EAAE,CAAG,CACX,GACO,CACX,CACJ,GAIA,CAAE,CAAA,iBAAkB,MAAA,EACpB,GAAI,CACC,OAAe,YAAA,CAAe,CAC3B,QAAS,WAAM,OAAA,I,EACf,QAAS,WAAO,EAChB,WAAY,WAAO,CACvB,CACJ,CAAE,MAAO,EAAG,CAEZ,C,G,E,Q,C,Q,S,C,C,C,EC3GH,EAAA,S,E,S,E,S,E,Q,G,E,Q,C,Q,S,C,C,C,ECPoB,IAAA,EAAA,EAAT,WAAa,IAAI,EAAE,MAAM,SAAA,CAAU,KAAA,CAAM,IAAA,CAAK,WAAW,EAAE,SAAS,sBAAvD,EAAgF,CAAA,EAAE,OAAA,CAAQ,SAAS,CAAC,EAAE,IAAI,EAAE,aAAa,KAAK,EAAE,WAAA,CAAY,EAAE,EAAE,SAAS,cAAA,CAAe,OAAO,IAAI,GAAG,IAAI,CAAC,WAAA,CAAY,EAAE,EAAC,CAAC,QAAQ,SAAR,CAAkB,SAAS,SAAT,CAAmB,iBAAiB,SAAjB,CAA2B,CAAC,OAAA,CAAQ,SAAS,CAAC,EAAE,EAAE,cAAA,CAAe,WAAW,OAAO,cAAA,CAAe,EAAE,SAAS,CAAC,aAAa,CAAC,EAAE,WAAW,CAAC,EAAE,SAAS,CAAC,EAAE,MAAM,CAAC,EAAE,E,G,E,Q,C,Q,S,C,C,C,ECArZ,IAAA,EAAA,EAAT,WAAa,IAAI,EAAE,MAAM,SAAA,CAAU,KAAA,CAAM,IAAA,CAAK,WAAW,EAAE,SAAS,sBAAvD,EAAgF,CAAA,EAAE,OAAA,CAAQ,SAAS,CAAC,EAAE,IAAI,EAAE,aAAa,KAAK,EAAE,WAAA,CAAY,EAAE,EAAE,SAAS,cAAA,CAAe,OAAO,IAAI,GAAG,IAAI,CAAC,YAAA,CAAa,EAAE,IAAI,CAAC,UAA5B,CAAuC,EAAC,CAAC,QAAQ,SAAR,CAAkB,SAAS,SAAT,CAAmB,iBAAiB,SAAjB,CAA2B,CAAC,OAAA,CAAQ,SAAS,CAAC,EAAE,EAAE,cAAA,CAAe,YAAY,OAAO,cAAA,CAAe,EAAE,UAAU,CAAC,aAAa,CAAC,EAAE,WAAW,CAAC,EAAE,SAAS,CAAC,EAAE,MAAM,CAAC,EAAE,E,G,E,Q,C,Q,S,C,C,C,ECA7b,OAAO,SAAA,CAAU,QAAA,EAAW,CAAA,OAAO,SAAA,CAAU,QAAA,CAAS,SAAS,CAAC,CAAC,CAAC,EAAE,OAAO,IAAI,EAAE,EAAE,OAAO,GAAG,KAAK,IAAI,CAAC,MAAA,CAAO,EAAE,OAAO,IAAI,EAAG,CAAA,AAAC,CAAA,GAAG,IAAI,CAAC,MAAK,AAAL,EAAQ,EAAE,MAAA,EAAS,CAAA,GAAG,EAAE,MAAA,CAAO,EAAE,EAAE,MAAA,CAAA,EAAS,EAAE,KAAA,CAAM,EAAE,GAAG,OAAO,IAAI,CAAA,CAAE,CAAA,C,G,E,Q,C,Q,S,C,C,C,ECA7M,MAAM,SAAA,CAAU,SAAA,EAAW,OAAO,cAAA,CAAe,MAAM,SAAA,CAAU,YAAY,CAAC,MAAM,SAAS,CAAC,EAAE,GAAG,MAAM,IAAI,CAAC,MAAM,AAAI,UAAU,iCAAiC,IAAI,EAAE,OAAO,IAAI,EAAE,EAAE,EAAE,MAAA,GAAS,EAAE,GAAG,YAAY,OAAO,EAAE,MAAM,AAAI,UAAU,gCAAgC,IAAI,IAAI,EAAE,SAAS,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC,EAAE,CAAC,GAAG,EAAE,IAAA,CAAK,EAAE,EAAE,EAAE,GAAG,OAAO,CAAE,CAAA,GAAG,CAAC,OAAM,EAAE,CAAC,E,G,E,Q,C,Q,S,C,C,C,E,E,E,O,C,Q,W,O,C,G,I,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,SCqEtW,AAAA,CAAA,EAAA,EAAA,aAAY,AAAZ,IAEO,IAAM,EAAN,W,aAAM,SAAA,EAoIL,CAA2B,CAC3B,CAAuB,E,IA6BnB,EAwCA,EACA,EACA,EAseA,EAoBA,E,E,I,CAtsBC,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,IAAA,CAAA,GAeQ,IAAA,CAAA,iBAAA,CAA4B,IAI5B,IAAA,CAAA,SAAA,CAAoB,I,I,E,I,AAgjDrC,CAAA,IAAA,CAAA,MAAA,CAAS,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,W,M,A,C,E,E,W,A,E,I,C,S,C,E,O,E,K,E,K,EACE,MAAA,C,EAAM,AAAA,CAAA,EAAA,EAAA,iBAAgB,AAAhB,EAAkB,EAAK,QAAvB,E,A,M,EAAb,MAAA,C,EAAO,EAAA,IAAA,G,A,C,EACX,GA97CI,IAAI,CAAC,KAAA,CAAQ,EAAS,KAAtB,CAGA,IAAM,EAAkB,KAAK,GAAA,CAAI,KAAM,KAAK,GAAA,CAAI,KAAM,KAAK,GAAA,CAAI,OAAO,MAAA,CAAO,KAAA,CAAO,OAAO,MAAA,CAAO,MAAlG,GACA,CAAA,IAAI,CAAC,OAAA,CAAW,IAAI,CAAC,KAAA,CAAQ,OAAU,AAAA,CAAA,EAAA,EAAA,YAAW,AAAX,EAAa,OAAA,CAAQ,WAAa,AAAA,CAAA,EAAA,EAAA,YAAW,AAAX,EAAa,OAAA,CAAQ,WAAa,QAC3G,IAAM,EAAe,EAAS,YAA9B,AACA,CAAA,IAAI,CAAC,QAAA,CAAW,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,EAAA,CAAG,CAClB,UAAW,SACX,IAAK,CACD,SAAU,WACV,KAAM,IACN,IAAK,IACL,MAAO,IACP,OAAQ,GACZ,CACJ,GACA,IAAI,CAAC,OAAA,CAAU,KAAK,GAAA,CAAI,EAAG,OAAO,UAAlC,EACA,IAAI,CAAC,QAAA,CAAW,KAAK,GAAA,CAAI,EAAG,OAAO,WAAnC,EACA,IAAI,EAA0B,KAC9B,CAAA,IAAI,CAAC,QAAA,CAAW,IAAI,AAAA,EAAA,EAAC,CAAE,QAAA,CACnB,EAAW,CACP,WAAY,CAChB,EAAI,CACA,MAAO,KAAK,GAAA,CAAI,GAAI,KAAK,GAAA,CAAI,EAAiB,OAAO,UAAA,CAAa,IAAI,CAAC,iBAAA,CAAoB,IAAI,CAAC,OAAA,CAAU,IAAI,CAAC,OAAA,CAAU,IAAI,CAAC,SAA9H,GACA,OAAQ,KAAK,GAAA,CAAI,GAAI,KAAK,GAAA,CAAI,EAAiB,IAAI,CAAC,QAApD,EACJ,EAAG,IAAI,CAAC,KAAA,CAAQ,GAAK,GACzB,IAAI,CAAC,QAAA,CAAS,UAAA,CAAW,EAAA,SAAQ,EAEjC,IAAI,EAAiC,KAAA,CAEhC,CAAA,EAAS,YAAA,EACV,CAAA,EAAS,YAAA,CAAe,CAAC,KAAM,WAAO,EAAG,MAAO,WAAO,CAAC,CAAA,EAGxD,GAEA,EAAS,MAAA,CAAO,OAAA,CAAQ,SAAA,CAAxB,EACI,EAAM,KAAA,CAAQ,IAClB,GACA,EAAW,OAEX,AAAA,CAAA,EAAA,EAAA,SAAQ,AAAR,EAAU,KAAA,CAAM,CAAA,GAChB,IAAI,CAAC,QAAA,CAAS,QAAd,GACA,IAAI,CAAC,QAAA,CAAS,SAAA,CAAU,EAAG,CAAC,EAAG,EAAA,WAAU,CAAG,EAAG,EAAA,WAAU,CAAG,EAAG,EAAA,WAAU,AAAC,GAC1E,AAAA,CAAA,EAAA,EAAA,SAAQ,AAAR,EAAU,KAAA,CAAM,CAAA,IAEpB,GAAI,CACA,EAAY,CACR,OAAQ,IAAI,AAAA,EAAA,EAAC,CAAE,QAAA,CAAS,CAAC,KAAM,IAAI,CAAC,QAAX,AAAmB,EAAG,IAAI,CAAC,KAAA,CAAQ,GAAK,GACjE,MAAO,IAAI,CAAC,QAAA,CAAS,aAAA,GAAkB,EACvC,QAAS,CAAC,CACd,CACJ,CAAE,MAAO,EAAG,CAIR,KAH6B,2BAAxB,EAAY,OAAA,EACb,IAAI,CAAC,QAAA,CAAS,OADlB,GAGM,CACV,CACA,OAAO,OAAA,CAAQ,AAAA,EAAA,EAAC,CAAE,OAAA,EAAS,OAAA,CAAQ,SAAnC,CAAA,EAAqC,IAAA,EAAA,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,EAAA,GAAA,EAAA,CAAA,CAAA,EAAA,CAAG,EAAH,CAAA,CAAA,EAAA,AACjC,CAAA,EAAU,OAAO,CAAC,EAAE,CAAG,IAAI,EACvB,EAAU,MAAA,EACV,EAAU,OAAO,CAAC,EAAE,CAAC,UAAA,CAAW,EAAU,MAAA,CAAO,eAAA,CAAgB,EAAU,KAD/E,EAGJ,GAGA,IAAI,EAAe,IAAI,AAAA,EAAA,EAAC,CAAE,GAAA,CAAI,EAAG,EAAG,GAIhC,EAAkB,AAAA,CAAA,EAAA,EAAA,WAAU,AAAV,EAAY,IAAI,CAAC,QAAA,CAAS,eAAA,CAAgB,IAAI,CAAC,QAAA,CAAS,aAAA,GAAkB,IAG1F,EAAiB,WACnB,GAAI,AAAmB,gBAAnB,EACA,OAAO,EAEX,IAAM,EAAS,OAAO,IAAA,CAAK,IAAY,MAAA,CAAO,SAAA,CAA9C,EAAsD,MAAA,AAAS,gBAAT,C,GAChD,EAAI,EAAO,SAAA,CAAU,SAAA,CAA3B,EAAmC,OAAA,IAAS,C,GAC5C,OAAO,CAAM,CAAE,AAAA,CAAA,EAAI,CAAA,EAAK,EAAO,MAAA,CAAO,AAC1C,EAEM,EAAc,SAAC,CAArB,EACI,EAAoB,QAAA,CAAS,GACzB,EAAK,iBAAA,EACL,EAAK,iBAAA,CAAkB,aAAA,CAAc,AAAM,EAAN,EAE7C,EAEM,EAAsB,IAAI,AAAA,EAAA,EAAC,CAAE,mBAAA,CAC/B,SAAC,CADL,EAEQ,EAAK,aAAA,CAAc,QAAA,CAAS,GAC5B,EAAe,QAAA,CAAS,GACxB,EAAe,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,OAAA,CAAQ,EAC9B,EACA,SAAC,CADD,EAEI,EAAe,OAAA,CAAQ,GACvB,EAAK,iBAAA,CAAkB,aAAA,CAAc,AAAO,EAAP,EACzC,EACA,SAAC,CADD,EAEI,EAAe,UAAA,CAAW,EAC9B,EACA,WAAM,OAAA,EAAK,aAAA,CAAc,QAAnB,EACN,EAAA,WAAM,OAAA,EAAU,CAAC,EAAe,CAAC,OAA3B,EACN,EAAA,WAAM,OAAA,EAAU,CAAC,EAAe,CAAC,UAA3B,EACN,EAAA,WACI,MAAO,CACH,WAAY,AAAA,EAAA,EAAC,CAAE,SAAS,CAAC,EAAe,CAAC,UAAzC,CACA,cAAe,AAAA,EAAA,EAAC,CAAE,SAAS,CAAC,EAAe,CAAC,aAA5C,AACJ,CACJ,GAGE,EAAgB,IAAI,EAAA,aAAY,CAAE,CACpC,UAAW,AAAA,CAAA,EAAA,EAAA,kBAAiB,AAAjB,EAAmB,EAClC,EACA,CAAA,IAAI,CAAC,aAAA,CAAgB,IAAI,EAAA,aAAY,CAErC,IAAM,EAAiB,IAAI,AAAA,EAAA,EAAC,CAAE,UAAA,CAAW,CACrC,SAAU,CACN,IAAI,CAAC,aAAL,CACA,EACH,AACL,GAEA,EAAe,WAAA,CAAa,SAAC,CAA7B,EACuB,SAAf,EAAM,IAAA,GACN,EAAK,SAAA,CAAU,KAAA,CAAM,aAAA,CAAgB,OACrC,EAAe,SAAA,CAAU,EAAM,CAAA,CAAG,EAAM,CAAA,CAAG,EAAM,QAAjD,EACA,EAAK,iBAAA,CAAkB,YAAvB,IAEe,SAAf,EAAM,IAAA,GACN,EAAe,MAAA,CAAO,EAAM,CAAA,CAAG,EAAM,CAAA,CAAG,EAAM,QAAA,CAAU,CAAA,EAAO,EAAM,WAArE,EACA,EAAK,iBAAA,CAAkB,gBAAA,CAAiB,EAAM,CAAA,CAAG,EAAM,CAAA,CAAG,EAAM,QAAhE,EACA,EAAK,iBAAA,CAAkB,YAAvB,IAEe,OAAf,EAAM,IAAA,GACN,EAAK,SAAA,CAAU,KAAA,CAAM,aAAA,CAAgB,GACrC,EAAe,OAAf,GACA,EAAK,iBAAA,CAAkB,YAAvB,IAEe,SAAf,EAAM,IAAA,GACN,EAAe,QAAA,GAAW,eAAA,CAAgB,EAAM,EAAA,CAAI,EAAM,EAAA,CAAI,EAAM,EAAA,CAAI,EAAM,EAA9E,EACA,EAAK,iBAAA,CAAkB,YAAvB,GAER,GAEA,IAAI,GAAmB,CACnB,KAAM,GACN,MAAO,OACP,OAAQ,CAAA,EACR,SAAU,CAAA,EACV,KAAM,aACN,cAAe,EACf,WAAY,EACZ,KAAM,CACF,MAAO,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,CAClC,CACJ,CAEA,CAAA,IAAI,CAAC,iBAAA,CAAoB,IAAI,AAAA,EAAA,EAAC,CAAE,iBAAA,CAAkB,CAC9C,SAAU,IAAI,CAAC,QAAf,CACA,MAAO,KAAK,GAAA,CAAI,EAAG,IAAI,CAAC,OAAA,CAAU,IAAI,CAAC,SAAvC,EACA,OAAQ,IAAI,CAAC,QAAb,CACA,OAAQ,SAAC,CAAT,EAAe,OAAA,EAAe,OAAA,CAAQ,E,EACtC,OAAQ,SAAC,CAAA,CAAQ,CAAjB,EACI,EAAoB,QAAA,CAAS,GACzB,IACA,EAAK,aAAA,CAAc,WAAnB,GACA,EAAK,iBAAA,CAAkB,OAAA,CAAQ,EAAK,gBAAA,CAAiB,SAArD,IAER,EACA,OAAQ,SAAC,CAAA,CAAS,CAAlB,EACI,IAAM,EAAa,AAAA,CAAA,EAAA,EAAA,WAAU,AAAV,EAAY,EAAK,QAAA,CAAS,aAAA,CAAc,EAAgB,MAA3E,GACA,EAAK,QAAA,CAAS,SAAA,CACV,EACA,EACA,EACA,GAAO,WAAA,GAAgB,KAAO,EAAK,aAAA,CAAc,QAAA,GACjD,GAAO,UAAA,GACP,GAAO,YAAA,GACP,GAAO,SAAA,GACP,GAAO,OAAA,GACP,GAAO,aATX,IAWA,EAAK,iBAAA,CAAkB,YAAvB,EACJ,EACA,WAAY,SAAC,CAAA,CAAS,CAAA,CAAS,CAAA,CAAS,CAAxC,EACoB,SAAZ,GACA,GAAa,MAAA,CAAO,EAAS,EAAS,GAE1B,SAAZ,GACA,GAAa,MAAA,CAAO,EAAS,GAEjB,OAAZ,GACA,GAAa,IAAA,CAAK,EAAS,EAEnC,EACA,OAAQ,SAAC,CAAA,CAAS,CAAA,CAAS,CAA3B,EACQ,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,aAAA,CAAc,GAAA,GAAQ,GAI7B,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,cAAA,CAAe,CACd,SAAU,EAAK,QAAf,CACA,WAAY,AAAA,CAAA,EAAA,EAAA,WAAU,AAAV,EAAY,EAAK,QAAA,CAAS,aAAA,CAAc,EAAgB,MAApE,GACA,aAAc,EAAK,aAAA,CAAc,QAAjC,GACA,eAAgB,EAAK,aAAA,CAAc,eAAnC,GAEA,KAAM,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,CAAA,EACC,IADP,CAEI,KAAM,GACN,EAAG,EACH,EAAG,EACH,SAAU,EACV,KAAO,GAAiB,IAAA,CAAO,CAC3B,MAAO,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,CAAA,EACA,EAAK,aAAA,CAAc,QAD1B,IAAA,CAEI,EAAG,GAAiB,IAAA,CAAK,KAAA,CAAM,CAA/B,A,EAER,EAAI,KAAA,EACJ,OAAS,GAAiB,MAAA,CAAS,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,CAAA,EAC5B,GAAiB,MADxB,EAAA,CAEI,MAAO,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,CAAA,EACA,EAAK,aAAA,CAAc,eAD1B,IAAA,CAEI,EAAG,GAAiB,MAAA,CAAO,KAAA,CAAM,CAAjC,A,EAEJ,GAAA,KAAA,C,GAGR,UAAW,SAAC,CAAZ,EACI,GAAmB,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,CAAA,EACZ,GADP,CAEI,KAAM,E,GAEV,IAAM,EAAa,AAAA,CAAA,EAAA,EAAA,WAAU,AAAV,EAAY,EAAK,QAAA,CAAS,aAAA,CAAc,EAAgB,MAA3E,GACA,EAAK,QAAA,CAAS,IAAA,CAAK,EAAY,GAC/B,EAAK,iBAAA,CAAkB,YAAvB,EACJ,CACJ,EAEJ,EACA,QAAS,SAAC,CAAA,CAAS,CAAA,CAAS,CAAA,CAAS,CAArC,EACoB,SAAZ,GACA,GAAU,MAAA,CAAO,EAAS,EAAS,GAEvB,SAAZ,GACA,GAAU,MAAA,CAAO,EAAS,GAEd,OAAZ,GACA,GAAU,IAAA,CAAK,EAAS,EAEhC,EAEA,aAAc,SAAC,CAAf,EAEQ,EAAc,OAAA,CAAQ,QAAA,CAAS,UAC/B,EAAK,aAAA,CAAc,GAAA,CAAI,CACnB,KAAM,YACN,MAAO,EAAc,KAArB,CACA,SAAU,AAAsB,IAAtB,EAAc,KAAA,CAAc,KAAK,EAA3C,AACJ,GAGJ,EAAK,gBAAA,CAAiB,eAAA,CAAgB,EAAc,KAAA,GAAU,EAAK,iBAAA,CAAkB,WAArF,IACA,EAAK,gBAAA,CAAiB,gBAAA,CAAiB,EAAc,KAAA,GAAU,EAAK,iBAAA,CAAkB,WAAtF,IAEA,GAAO,MAAA,CAAO,EAAc,KAAA,CAAO,AAAsB,IAAtB,EAAc,KAAA,CAAc,KAAK,EAApE,CACJ,EACA,OAAQ,WACA,AAAA,CAAA,EAAA,EAAA,SAAQ,AAAR,EAAU,OAAA,IACN,GAAgB,IAAA,IAChB,EAAK,aAAA,CAAc,GAAA,CAAI,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,QAAS,CAAA,EAGjD,EACA,OAAQ,WACA,AAAA,CAAA,EAAA,EAAA,SAAQ,AAAR,EAAU,OAAA,IACN,GAAgB,IAAA,IAChB,EAAK,aAAA,CAAc,GAAA,CAAI,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,QAAS,CAAA,EAGjD,CACJ,GAEA,IAAM,GAA0B,WAC5B,GAAK,EAiBL,IAAK,IAJC,EAAY,EAAK,gBAAA,CAAiB,SAAxC,GACM,EAAW,EAAW,cAA5B,GAEM,EAAU,CAXZ,OACA,OACA,OACA,WACA,OACA,QAMJ,CACS,EAAI,EAAG,EAAI,EAAQ,MAAA,CAAQ,IAC5B,IAAc,CAAO,CAAC,EAAE,CACxB,EAAW,YAAA,CAAa,CAAO,CAAC,EAAE,CAAE,CAAA,IAEpC,EAAW,YAAA,CAAa,CAAO,CAAC,EAAE,CAAE,CAAA,GAChC,IAAa,CAAO,CAAC,EAAE,EACvB,EAAW,IAAA,CAAK,GAKhC,EAEM,GAAc,IAAI,AAAA,EAAA,EAAC,CAAE,WAAA,CAAY,CACnC,OAAQ,SAAC,CAAA,CAAQ,CAAA,CAAO,CAAxB,EACI,IAAI,CAAA,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,aAAA,CAAc,GAAA,GAAQ,GAAK,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,cAAA,CAAe,CAAA,EAAA,IAIlC,CAAA,EAAK,aAAA,CAAc,YAAA,IAAkB,EAAK,iBAAA,CAAkB,YAA9E,EAAA,GAiHA,GA5GiB,SAAb,GACA,EAAK,iBAAA,CAAkB,UAAA,CAAW,GAAY,SAAA,CAAU,SAAW,EAAE,EAAI,IAE5D,UAAb,GACA,EAAK,iBAAA,CAAkB,UAAA,CAAW,GAAY,SAAA,CAAU,SAAW,GAAG,EAAI,KAE7D,SAAb,GACA,EAAK,iBAAA,CAAkB,OAAA,CAAQ,CAAA,GAElB,QAAb,GACA,EAAK,iBAAA,CAAkB,SAAA,CAAU,CAAA,GAEjC,CAAC,SAAU,QAAQ,CAAC,QAAA,CAAS,KAC7B,EAAM,cAAN,GACA,GAAgB,IAAhB,IAGA,CAAA,CAAC,SAAU,QAAQ,CAAC,QAAA,CAAS,IAGrB,AAAA,CAAA,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,QAAA,CAAS,eAAgB,IAC5B,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,QAAA,CAAS,cAAe,EAAA,GAC1B,AAAW,MAAX,CAAW,IAGpB,EAAM,cAAN,GACA,GAAgB,IAAhB,IAEA,CAAC,EAAK,KAAA,GACF,CAAC,SAAU,QAAQ,CAAC,QAAA,CAAS,KAC7B,EAAM,cAAN,GACA,EAAK,cAAA,CAAe,IAApB,IAEA,CAAC,eAAgB,cAAc,CAAC,QAAA,CAAS,KACzC,EAAM,cAAN,GAEC,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,WACO,IAAA,EAGK,E,M,A,C,E,E,W,A,E,I,C,S,C,E,O,E,K,E,K,EAHL,EAAU,CAAA,E,E,K,C,C,M,EAEV,O,E,I,C,I,C,C,E,G,E,EAAA,C,EAAM,EAAc,KAAA,CAAM,A,EAAK,QAAA,CAAS,UAAlC,I,A,M,E,OAAN,EAAA,IAAA,G,C,E,E,A,M,E,OACK,EAAA,EAAA,IAAA,GACL,EAAU,CAAA,EACV,WAAW,WACP,MAAM,AAAI,MAAM,uDAAyD,EAC7E,EAAG,GACH,A,EAAK,aAAA,CAAc,GAAA,CAAI,KAAO,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,uBAAwB,CAAA,G,C,E,E,A,M,E,OAE3D,IACA,EAAS,YAAA,CAAc,KAAvB,GACA,A,EAAK,aAAA,CAAc,GAAA,CAAI,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,uBAAwB,CAAA,I,C,E,A,C,EAE5D,MAEA,CAAC,SAAU,QAAQ,CAAC,QAAA,CAAS,KAC7B,EAAM,cAAN,GACA,GAAgB,CAAA,KAGpB,CAAC,SAAU,QAAQ,CAAC,QAAA,CAAS,IAC7B,EAAM,cADa,GAKnB,GAAY,iBAAA,CAAkB,CAAC,OAAQ,QAAS,KAAM,OAAO,IAC9C,SAAX,GACA,EAAK,iBAAA,CAAkB,aAAA,CAAc,EAAG,GAE7B,UAAX,GACA,EAAK,iBAAA,CAAkB,aAAA,CAAc,GAAI,GAE9B,OAAX,GACA,EAAK,iBAAA,CAAkB,aAAA,CAAc,EAAG,GAE7B,SAAX,GACA,EAAK,iBAAA,CAAkB,aAAA,CAAc,EAAG,KAK5C,CAAC,SAAS,UAAU,CAAC,QAAA,CAAS,KACf,SAAX,IACA,EAAK,iBAAA,CAAkB,QAAA,CAAS,IAAK,CAAA,GACrC,GAAO,MAAA,CAAO,EAAK,iBAAA,CAAkB,QAAA,GAAY,EAAK,iBAAA,CAAkB,WAAxE,KAEW,UAAX,IACA,EAAK,iBAAA,CAAkB,QAAA,CAAS,GAAI,CAAA,GACpC,GAAO,MAAA,CAAO,EAAK,iBAAA,CAAkB,QAAA,GAAY,EAAK,iBAAA,CAAkB,WAAxE,MAGJ,CAAC,OAAO,CAAC,QAAA,CAAS,KAClB,EAAK,iBAAA,CAAkB,QAAA,CAAS,GAChC,GAAO,MAAA,CAAO,EAAK,iBAAA,CAAkB,QAAA,GAAY,EAAK,iBAAA,CAAkB,WAAxE,KAIa,cAAb,GACA,EAAe,YAAA,CAAa,IAAO,EAAK,iBAAA,CAAkB,QAD9D,IAGiB,eAAb,GACA,EAAe,YAAA,CAAa,IAAO,EAAK,iBAAA,CAAkB,QAD9D,IAGiB,UAAb,IACA,EAAK,QAAA,CAAS,SAAA,CACV,AAAA,CAAA,EAAA,EAAA,WAAU,AAAV,EAAY,EAAK,QAAA,CAAS,aAAA,CAAc,EAAgB,MAAA,GACxD,EAAK,aAAA,CAAc,QAFvB,IAIA,EAAK,aAAA,CAAc,GAAA,CAAI,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,UAAW,CAAA,IAEvC,CAAC,SAAU,YAAY,CAAC,QAAA,CAAS,GAAW,CAC5C,IAAM,EAAa,AAAA,CAAA,EAAA,EAAA,WAAU,AAAV,EAAY,EAAK,QAAA,CAAS,aAAA,CAAc,EAAgB,MAA3E,EACI,AAAe,CAAA,IAAf,GAAqB,GAAW,WAAA,CAAY,kBAAA,GAG5C,EAAK,QAAA,CAAS,UAAA,CAAW,GAFzB,EAAK,QAAA,CAAS,SAAA,CAAU,EAAY,CAAC,EAAG,IAAK,EAAG,IAAK,EAAG,GAAG,EAAG,aAIlE,EAAK,aAAA,CAAc,GAAA,CAAI,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,iBAAkB,CAAA,EAClD,CAaA,GAZI,AAAa,YAAb,GACA,EAAM,cAAN,GACA,EAAe,YAAA,EAAgB,EAAe,YAA9C,IAEoB,MAAb,IACP,EAAM,cAAN,GACA,EAAK,iBAAA,CAAkB,OAAA,CAAQ,QAC/B,EAAK,gBAAA,CAAiB,SAAA,CAAU,QAChC,GAAc,EAAW,IAAA,CAAK,QAC9B,KACA,GAAY,IAAA,CAAK,gBAEjB,AAAa,MAAb,EAAkB,CAClB,EAAM,cAAN,GACA,IAAM,EAAW,EAAK,iBAAA,CAAkB,OAAxC,GACA,EAAK,iBAAA,CAAkB,OAAA,CAAQ,QAC/B,EAAK,gBAAA,CAAiB,SAAA,CAAU,QAChC,GAAc,EAAW,IAAA,CAAK,QAC9B,KACA,GAAY,IAAA,CAAK,AAAa,SAAb,EAAsB,IAAmB,EAC9D,CACA,GAAI,AAAa,MAAb,EAAkB,CAClB,EAAM,cAAN,GACA,IAAM,EAAU,AAAqC,SAArC,EAAK,iBAAA,CAAkB,OAAA,GAAuB,WAAa,OAC3E,EAAK,iBAAA,CAAkB,OAAA,CAAQ,GAC/B,EAAK,gBAAA,CAAiB,SAAA,CAAU,GAChC,GAAc,EAAW,IAAA,CAAK,GAC9B,IACJ,CACiB,MAAb,IACA,EAAM,cAAN,GACA,EAAK,iBAAA,CAAkB,OAAA,CAAQ,QAC/B,EAAK,gBAAA,CAAiB,SAAA,CAAU,QAChC,GAAc,EAAW,IAAA,CAAK,QAC9B,MAEa,MAAb,IACA,EAAM,cAAN,GACA,EAAK,iBAAA,CAAkB,OAAA,CAAQ,SAC/B,EAAK,gBAAA,CAAiB,SAAA,CAAU,SAChC,GAAc,EAAW,IAAA,CAAK,SAC9B,MAEa,MAAb,IACA,EAAM,cAAN,GACA,EAAK,aAAA,CAAc,UAAnB,IAIR,EACA,KAAM,SAAC,CAAA,CAAQ,CAAA,EACf,CACJ,GAEM,GAEF,CAAC,EAEL,OAAO,OAAA,CAAQ,AAAA,EAAA,EAAC,CAAE,SAAA,EAAW,OAAA,CAAQ,SAArC,CAAA,EAAuC,IAAA,EAAA,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,EAAA,GAAA,EAAA,CAAA,CAAA,EAAA,CAC7B,EAAK,IAAK,AADmB,CAAA,CAAA,EAAA,CACX,EAAA,CAAW,CAC/B,aAAc,EACd,gBAAiB,SAAC,CAAlB,EACI,EAAoB,WAAA,CAAY,EACpC,EACA,eAAgB,WACZ,EAAoB,gBAAA,CAAiB,CACjC,WAAY,AAAA,EAAA,EAAC,CAAE,SAAS,CAAC,EAAe,CAAC,UAAzC,CACA,cAAe,AAAA,EAAA,EAAC,CAAE,SAAS,CAAC,EAAe,CAAC,aAA5C,AACJ,EACJ,CACJ,EACA,CAAA,EAAU,CAAC,EAAE,CAAG,EAChB,EAAG,UAAA,GAAa,KAAA,CAAM,OAAA,CAAU,MACpC,GAEA,IAAI,CAAC,aAAA,CAAgB,IAAI,AAAA,EAAA,EAAC,CAAE,aAA5B,CAEA,IAAI,CAAC,SAAA,CAAY,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,EAAA,CAAG,CACnB,UAAW,eACX,IAAK,CACD,SAAU,WACV,MAAO,IACP,IAAK,IACL,OAAQ,IACR,MAAO,IAAK,CAAC,SAAA,CAAa,KAC1B,SAAU,SACV,WAAY,OACZ,YAAa,MACjB,CACJ,GACA,IAAI,CAAC,cAAA,CAAiB,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,EAAA,CAAG,CACxB,OAAQ,IAAI,CAAC,SAAb,AACJ,GACA,IAAI,CAAC,SAAA,CAAU,aAAA,CAAgB,WAC3B,MAAO,CAAA,CACX,EACA,IAAI,CAAC,SAAA,CAAU,OAAA,CAAU,AAAA,EAAA,EAAC,CAAE,WAA5B,CAGA,IAAI,CAAC,kBAAA,CAAqB,IAAI,AAAA,EAAA,EAAC,CAAE,kBAAA,CAAmB,CAChD,SAAU,WACN,EAAK,cAAL,EACJ,CACJ,GAEA,IAAI,CAAC,cAAL,GAOA,WAAW,WACP,EAAmB,IAAI,AAAA,EAAA,EAAC,CAAE,gBAAA,CAAiB,CACvC,YAAa,WACT,OAAO,AAA2B,IAA3B,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,aAAA,CAAc,GAAA,IAAe,CAAC,EAAK,aAAA,CAAc,YAA3D,EACJ,EACA,oBAAA,CACJ,GACA,EAAK,QAAA,CAAS,MAAA,CAAO,EAAiB,UAAtC,GACJ,EAAG,GAEH,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,MAAA,CACC,IAAI,CAAC,QAAA,CACL,CACI,IAAI,CAAC,iBAAA,CAAkB,UAAvB,GACA,IAAI,CAAC,SAAL,CACA,IAAI,CAAC,kBAAA,CAAmB,UAAxB,GACH,EAmGL,CA9FI,EADA,IAAI,CAAC,KAAA,CACa,IAAI,EAAA,oBAAmB,CAAE,CACvC,OAAQ,WACJ,AAAA,CAAA,EAAA,EAAA,eAAc,AAAd,EAAgB,EAAK,KAAA,CAAO,GAAA,CAAM,aAAc,CAAC,CAAC,EAAK,KAAvD,CACJ,EACA,SAAU,WACN,IAsCc,EAtCR,EAAY,WAEd,IADI,EACE,EAAU,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,EAAA,CAAG,CAClB,QAAS,SACT,YAAa,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,0BAClB,IAAK,CACD,QAAS,OACb,CACJ,EACA,CAAA,EAAQ,OAAA,CAAU,WACd,EAAK,SAAL,GACA,GACJ,EACA,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,KAAA,CAAM,CACL,OAAQ,EAAK,QAAb,CACA,QAAS,MAAQ,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,iBAAmB,OACzC,IAAK,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,EAAA,CAAG,CACH,QAAS,CACL,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,EAAA,CAAG,CACF,QAAS,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,kBACd,IAAK,CACD,aAAc,MAClB,CACJ,GACA,EACH,AACL,GACJ,iBAAkB,CAAA,EAClB,UAAW,SAAC,CAAZ,EACI,EAAY,CAChB,CACJ,EACJ,EAEA,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,KAAA,CAAM,CACL,OAAQ,EAAK,QAAb,CACA,QAAS,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,iBACd,QAAS,CAAC,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,UAAW,SAAS,CACnC,QAAQ,EAAE,EAAA,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,SAAO,CAAP,EAKA,IAAA,E,M,A,C,E,E,W,A,E,I,C,S,C,SAJF,IAAW,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,YAId,EAAU,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,EAAA,CAAG,CAClB,OAAQ,A,EAAK,QAAb,CACA,UAAW,iBACX,QAAS,+BAAiC,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,oBACnD,GAEA,A,EAAK,KAAA,CAAO,QAAA,CACR,WACI,EAAS,YAAA,CAAc,KAAvB,GACA,EAAQ,MAAR,EACJ,EACA,WACI,EAAQ,MAAR,GACA,GACJ,IAlBJ,C,E,A,EAmBJ,GApBiB,SAAA,CAAA,E,O,E,K,C,I,C,U,EAqBrB,EACJ,EACA,YAAa,WACT,EAAK,OAAA,CAAU,AAAiB,SAAjB,EAAK,OAAA,CAAqB,QAAU,OACnD,EAAK,QAAL,EACJ,CACJ,GAEkB,IAAI,AAAA,EAAA,EAAC,CAAE,eAAA,CAAgB,CACrC,QAAS,EAAS,OAAlB,CACA,OAAQ,WACJ,AAAA,CAAA,EAAA,EAAA,eAAc,AAAd,EAAgB,UAAW,CAAC,CAAC,EAAK,KAAlC,CACJ,EACA,MAAO,WACH,IACJ,EACA,SAAU,WACN,GAAS,aAAT,EACJ,EACA,OAAQ,WACJ,EAAK,cAAA,CAAe,IAApB,EACJ,EACA,QAAS,WACL,IACJ,EACA,OAAQ,WACJ,AAAA,CAAA,EAAA,EAAA,eAAc,AAAd,EAAgB,UAAW,CAAC,CAAC,EAAK,KAAlC,CACJ,CACJ,IAEY,UAAA,GAAa,KAAA,CAAM,YAAA,CAAe,OAClD,IAAI,CAAC,cAAA,CAAe,MAAA,CAAO,EAAgB,UAA3C,IAEA,IAAI,CAAC,gBAAA,CAAmB,IAAI,AAAA,EAAA,EAAC,CAAE,gBAAA,CAAiB,CAC5C,WAAY,SAAC,CAAb,EACI,GAAI,AAAc,SAAd,EACA,EAAK,iBAAA,CAAkB,OAAA,CAAQ,aAC5B,GAAI,AAAc,SAAd,EACP,EAAK,iBAAA,CAAkB,OAAA,CAAQ,aAC5B,GAAI,AAAc,SAAd,EACP,EAAK,iBAAA,CAAkB,OAAA,CAAQ,aAC5B,GAAI,AAAc,aAAd,EACP,EAAK,iBAAA,CAAkB,OAAA,CAAQ,iBAC5B,GAAI,AAAc,SAAd,EACP,EAAK,iBAAA,CAAkB,OAAA,CAAQ,aAC5B,GAAI,AAAc,UAAd,EACP,EAAK,iBAAA,CAAkB,OAAA,CAAQ,cAE/B,MAAM,AAAI,MAAM,oBAEpB,CAAA,GAAc,EAAW,IAAA,CAAK,GAC9B,KACA,EAAK,aAAA,CAAc,WAAnB,EACJ,EACA,SAAU,WACN,EAAK,iBAAA,CAAkB,UAAA,CAAW,GAAY,SAAA,CAAU,SAAW,EAAE,EAAI,GAC7E,EACA,UAAW,WACP,EAAK,iBAAA,CAAkB,UAAA,CAAW,GAAY,SAAA,CAAU,SAAW,GAAG,EAAI,IAC9E,EACA,OAAQ,WACJ,GAAgB,IAAhB,EACJ,EACA,OAAQ,WACJ,GAAgB,IAAhB,EACJ,CACJ,GACA,IAAI,CAAC,gBAAA,CAAiB,UAAA,CAAW,IAAI,CAAC,QAAA,CAAW,KACjD,AAAA,CAAA,EAAA,EAAA,SAAQ,AAAR,EAAU,WAAA,CAAY,WAClB,EAAK,gBAAA,CAAiB,aAAA,CAAc,AAAA,CAAA,EAAA,EAAA,SAAQ,AAAR,EAAU,OAA9C,IACA,EAAK,gBAAA,CAAiB,aAAA,CAAc,AAAA,CAAA,EAAA,EAAA,SAAQ,AAAR,EAAU,OAA9C,GACJ,GACA,IAAI,CAAC,cAAA,CAAe,MAAA,CAAO,IAAI,CAAC,gBAAA,CAAiB,UAAjD,IASA,IAAI,CAAC,aAAA,CAAgB,IAAI,AAAA,EAAA,EAAC,CAAE,aAAA,CAAc,CACtC,MAAO,IACP,OAAQ,GACR,SAAU,IACV,WAAY,IAAI,AAAA,EAAA,EAAC,CAAE,GAAA,CAAI,EAAG,EAAG,GAC7B,OAZkB,SAAC,CAAvB,EACI,EAAe,EACf,EAAe,QAAA,CAAS,GACxB,EAAoB,SAAA,CAAU,GAC9B,EAAK,aAAA,CAAc,WAAnB,EACJ,CAQA,GACA,IAAI,CAAC,aAAA,CAAc,SAAA,CAAU,KAAK,GAAA,CAAI,IAAK,KAAK,GAAA,CAAI,IAAK,IAAI,CAAC,QAAA,CAAW,OACzE,IAAI,CAAC,aAAA,CAAc,eAAA,CAAgB,SAAC,CAApC,EAEQ,EACA,EAAK,iBAAA,CAAkB,OAAA,CAAQ,SAE/B,EAAK,iBAAA,CAAkB,OAAA,CAAQ,EAAK,gBAAA,CAAiB,SAArD,IACA,KAGR,GAEA,IAAM,GAAkB,SAAC,CAAzB,EACoB,gBAAZ,GACA,CAAA,EAAuB,CAD3B,EAII,EAAK,aAAT,GACQ,AAAY,gBAAZ,EACA,EAAK,aAAA,CAAc,MAAA,CAAO,CAAA,GAE1B,EAAK,aAAA,CAAc,MAAA,CAAO,CAAA,IAIlC,EAAiB,EAEjB,AADA,CAAA,EAAiB,EAAU,CAAC,EAAQ,AAAR,EACb,QAAA,CAAS,GACxB,EAAe,UAAA,CAAW,GAC1B,EAAK,iBAAA,CAAkB,OAAA,CAAQ,QAC/B,EAAK,gBAAA,CAAiB,SAAA,CAAU,QAChC,IACJ,EAEM,GAAkB,SAAC,CAAzB,EACI,EAAkB,EAAM,OAAxB,CACA,EAAe,UAAA,CAAW,EAAM,OAAhC,EACA,EAAK,YAAA,CAAa,QAAA,CAAS,EAC/B,EAEM,GAAW,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,EAApB,GACM,GAAW,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,EAAA,CAAG,CACnB,IAAK,CACD,OAAQ,OACR,QAAS,OACT,SAAU,OACV,eAAgB,gBAChB,WAAY,UAChB,CACJ,GACM,GAAyB,IAAI,AAAA,EAAA,EAAC,CAAE,sBAAA,CAAuB,CACzD,UAAW,EACX,SAAU,SAAC,CAAX,EACI,EAAc,YAAA,CAAa,AAAA,CAAA,EAAA,EAAA,kBAAiB,AAAjB,EAAmB,GAClD,CACJ,GAGA,GAAS,MAAA,CAAO,IAChB,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,MAAA,CACC,GACA,CAAC,IAAI,CAAC,aAAA,CAAc,UAAnB,GAAiC,IAAI,CAAC,aAAA,CAAc,gBAAnB,GAAuC,GAAuB,UAAvB,GAAoC,EAGjH,IAAM,GAAc,IAAI,AAAA,EAAA,EAAC,CAAE,MAAA,CAAO,CAC9B,UAAW,WACX,UAAW,CAAA,EACX,OAAQ,WA0BJ,IAAK,IAzBC,EAAS,EAAE,CAEX,EAAY,SAAC,CAAnB,EACI,MAAO,CACH,GAAI,EACJ,MAAO,AAAA,EAAA,EAAC,CAAE,SAAS,CAAC,EAAO,CAAC,KAA5B,CACA,MAAO,AAAA,EAAA,EAAC,CAAE,SAAS,CAAC,EAAO,CAAC,OAA5B,CACA,OAAQ,WACJ,EAAU,CAAC,EAAO,CAAC,UAAA,GAAa,KAAA,CAAM,OAAA,CAAU,QAChD,GAAgB,GAChB,EAAK,aAAA,CAAc,WAAnB,GACA,EAAoB,gBAAA,CAAiB,CACjC,WAAY,AAAA,EAAA,EAAC,CAAE,SAAS,CAAC,EAAO,CAAC,UAAjC,CACA,cAAe,AAAA,EAAA,EAAC,CAAE,SAAS,CAAC,EAAO,CAAC,aAApC,AACJ,GACA,EAAY,EAAU,CAAC,EAAO,CAAC,OAA/B,IACA,EAAoB,WAAA,CAAY,EAAU,CAAC,EAAO,CAAC,UAAnD,GACJ,EACA,QAAS,WACL,EAAU,CAAC,EAAO,CAAC,UAAA,GAAa,KAAA,CAAM,OAAA,CAAU,MACpD,CACJ,CACJ,EAEM,EAAS,OAAO,IAAA,CAAK,IAClB,EAAI,EAAG,EAAI,EAAO,MAAA,CAAQ,IAC/B,EAAO,IAAA,CAAK,EAAU,CAAM,CAAC,EAAE,GAEnC,OAAO,CACX,GACJ,GACA,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,MAAA,CAAO,GAAU,CAChB,GAAY,UAAZ,GAEH,CAHmB,MAAA,CAEhB,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAG,OAAO,OAAA,CAAQ,AAAA,EAAA,EAAC,CAAE,SAAA,EAAW,GAAA,CAAI,SACvC,CAAA,EADgD,OAAA,EAAU,CAAjB,AAAA,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,EAAA,EAAA,CAAA,EAAA,CAAoB,CAAC,UAAd,E,MAGjD,IAAM,GAAS,IAAI,AAAA,EAAA,EAAC,CAAE,MAAA,CAAO,CACzB,MAAO,IAAI,CAAC,iBAAA,CAAkB,QAA9B,GACA,SAAU,EACV,QAAS,WACL,EAAK,iBAAA,CAAkB,SAAA,CAAU,CAAA,GACjC,GAAO,MAAA,CAAO,EAAK,iBAAA,CAAkB,QAAA,GAAY,EAAK,iBAAA,CAAkB,WAAxE,GACJ,EACA,MAAO,WACH,EAAK,iBAAA,CAAkB,OAAA,CAAQ,CAAA,GAC/B,GAAO,MAAA,CAAO,EAAK,iBAAA,CAAkB,QAAA,GAAY,EAAK,iBAAA,CAAkB,WAAxE,GACJ,EACA,cAAe,SAAC,CAAA,CAAU,CAA1B,EACI,EAAK,iBAAA,CAAkB,QAAA,CAAS,EAAU,GAC1C,GAAO,MAAA,CAAO,EAAK,iBAAA,CAAkB,QAAA,GAAY,EAAK,iBAAA,CAAkB,WAAxE,GACJ,CACJ,GAEM,GAAS,IAAI,AAAA,EAAA,EAAC,CAAE,MAAA,CAAO,CACzB,YAAa,IAAI,CAAC,aAAlB,AACJ,GAEM,GAAa,IAAI,AAAA,EAAA,EAAC,CAAE,UAAA,CAAW,CACjC,YAAa,IAAI,CAAC,aAAlB,AACJ,GAEM,GAAS,IAAI,AAAA,EAAA,EAAC,CAAE,MAAA,CAAO,CACzB,YAAa,IAAI,CAAC,aAAlB,AACJ,GAEM,GAAU,IAAI,AAAA,EAAA,EAAC,CAAE,OAAA,CAAQ,CAC3B,YAAa,IAAI,CAAC,aAAlB,AACJ,GAEM,GAAe,IAAI,AAAA,EAAA,EAAC,CAAE,YAAA,CAAa,CACrC,WAAY,SAAC,CAAA,CAAQ,CAAA,CAAI,CAAA,CAAI,CAAA,CAAI,CAAA,CAAI,CAArC,EACI,IAAM,EAAa,AAAA,CAAA,EAAA,EAAA,WAAU,AAAV,EAAY,EAAK,QAAA,CAAS,aAAA,CAAc,EAAgB,MAA3E,GACM,EAAW,GAAW,WAA5B,GACM,EAAyB,CAC3B,KAAM,EAAS,IAAf,CACA,OAAQ,EAAK,aAAA,CAAc,QAA3B,GACA,WAAY,EAAS,UAArB,CACA,QAAS,EAAS,OAAlB,CACA,YAAa,EAAS,WAAtB,CACA,SAAU,EAAS,QAAnB,CACA,OAAQ,GAAY,SAAA,CAAU,UAAY,EAAS,MAAnD,CACA,GAAA,EACA,GAAA,EACA,GAAA,EACA,GAAA,EACA,SAAA,CACJ,EAEI,GACA,EAAK,QAAA,CAAS,YAAA,CAAa,EAAY,MACvC,EAAK,QAAA,CAAS,YAAA,CAAa,EAAY,IAEvC,EAAK,QAAA,CAAS,YAAA,CAAa,EAAY,CACnC,KAAM,SAAC,CAAP,EACI,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,YAAA,CAAa,EAAK,EACzB,CACJ,GAEJ,EAAK,iBAAA,CAAkB,YAAvB,EACJ,CACJ,GAEM,GAAY,IAAI,AAAA,EAAA,EAAC,CAAE,SAAA,CAAU,CAC/B,QAAS,SAAC,CAAA,CAAQ,CAAA,CAAI,CAAA,CAAI,CAAA,CAAI,CAAA,CAAI,CAAlC,EAEI,IAAM,EAAa,AAAA,CAAA,EAAA,EAAA,WAAU,AAAV,EAAY,EAAK,QAAA,CAAS,aAAA,CAAc,EAAgB,MAA3E,GAEM,EAAgB,CAClB,KAAM,GAAQ,QAAd,GACA,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,GAAI,EACJ,SAAU,EACV,WAAY,GAAQ,aAApB,GACA,QAAS,GAAQ,UAAjB,GACA,SAAU,GAAQ,WAAlB,GACA,YAAa,GAAQ,cAArB,EACJ,CACI,AAAuB,CAAA,SAAvB,GAAQ,QAAA,IACR,EAAS,SAAA,CAAY,EAAK,aAAA,CAAc,QAAxC,GACA,EAAS,SAAA,CAAY,GAAQ,YAA7B,GACA,EAAS,WAAA,CAAc,GAAQ,SAAA,IAAe,GAAY,SAAA,CAAU,WAEpE,EAAS,YAAA,CAAe,GAAQ,UAAA,IAAgB,GAAY,SAAA,CAAU,SAClE,AAAsB,WAAtB,GAAQ,OAAA,IACR,EAAS,SAAA,CAAY,EAAK,aAAA,CAAc,QAAxC,GACA,EAAS,SAAA,CAAY,GAAQ,YAA7B,IAEA,EAAS,OAAA,CAAU,EAAK,aAAA,CAAc,QAD1C,IAKA,GACA,EAAK,QAAA,CAAS,YAAA,CAAa,EAAY,MACvC,EAAK,QAAA,CAAS,SAAA,CAAU,EAAY,IAEpC,EAAK,QAAA,CAAS,YAAA,CAAa,EAAY,CACnC,KAAM,SAAC,CAAP,EACI,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,SAAA,CAAU,EAAK,EACtB,CACJ,GAEJ,EAAK,iBAAA,CAAkB,YAAvB,EAEJ,CACJ,EAEA,CAAA,IAAI,CAAC,YAAA,CAAe,IAAI,AAAA,EAAA,EAAC,CAAE,YAAA,CACvB,IAAI,CAAC,QAAA,CACL,SAAC,CAFL,EAGQ,GAAgB,AAAA,CAAA,EAAA,EAAA,WAAU,AAAV,EAAY,EAAK,QAAA,CAAS,QAAA,CAAS,KACnD,AAAA,CAAA,EAAA,EAAA,SAAQ,AAAR,EAAU,IAAA,CAAK,CACX,KAAM,CAAC,OAAO,CACd,OAAQ,aACR,OAAQ,CAAC,EAAI,AACjB,EACJ,EACA,IAAI,CAAC,QAAA,CACL,IAAI,CAAC,OAFL,EAIJ,IAAI,CAAC,YAAA,CAAe,IAAI,AAAA,EAAA,EAAC,CAAE,YAAA,CAAa,CACpC,SAAU,IAAI,CAAC,QAAf,CACA,QAAS,WACL,GAAc,EAAW,IAAA,CAAK,SAClC,EACA,QAAS,IAAI,CAAC,OAAd,AACJ,GACA,IAAI,CAAC,YAAA,CAAa,YAAA,CAAa,IAAI,CAAC,QAAA,EAAY,KAChD,IAAI,CAAC,YAAA,CAAa,QAAA,CAAS,IAAI,CAAC,QAAA,CAAS,QAAA,CAAS,IAAI,CAAC,QAAA,CAAS,aAAA,CAAc,EAAgB,MAA9F,IAEA,IAAM,GAAY,IAAI,AAAA,EAAA,EAAC,CAAE,SAAA,CACrB,IAAI,CAAC,QAAA,CACL,IAAI,CAAC,aAAA,CACL,IAAI,CAAC,YAAA,CACL,IAAI,CAAC,iBAAA,CACL,GACA,WAAM,OAAA,CACN,EAAA,WAAM,OAAA,CACN,EAAA,WAAM,OAAA,EAAK,QAAL,AACN,EAAA,WAAM,OAAA,CACN,EAAA,CAAC,CAAC,IAAI,CAAC,KAAA,CACP,IAAI,CAAC,aADL,EAIE,GAAkB,IAAI,AAAA,EAAA,EAAC,CAAE,eAAA,CAC3B,GACA,IAAI,CAAC,YAAA,CACL,IAAI,CAAC,YAAA,CACL,GACA,IAAI,CAAC,iBAAA,CACL,WACI,GAAI,CAAC,EACD,MAAM,AAAI,MAAM,6BAEpB,OAAO,CACX,EACA,WAAM,OAAA,EAAK,QAAL,AACN,EAAA,WAAM,OAAA,CACN,EAAA,SAAC,CAAD,EACI,EAAkB,CACtB,EACA,WAAM,OAAA,C,GAEV,AAAA,CAAA,EAAA,EAAA,SAAQ,AAAR,EAAU,WAAA,CAAY,SAAC,CAAvB,EACI,GAAgB,OAAA,CAAQ,EAC5B,GAEA,IAAM,GAAqB,WACvB,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,cAAA,CAAe,CACd,aAAc,EACd,eAAgB,EAAK,aAAA,CAAc,eAAnC,GACA,cAAe,EACf,YAAa,EAAK,QAAA,CAAS,QAA3B,GACA,aAAc,EAAK,QAAA,CAAS,SAA5B,GACA,eAAgB,OAAO,UAAA,CAAa,EAAK,iBAAA,CAAoB,EAAK,OAAA,CAAU,EAAK,OAAA,CAAU,EAAK,SAAhG,CACA,gBAAiB,EAAK,QAAtB,CACA,UAAW,SAAC,CAAA,CAAO,CAAA,CAAQ,CAA3B,EACI,EAAK,QAAA,CAAS,KAAA,CAAM,CAChB,MAAO,EACP,OAAQ,EACR,MAAO,AAAY,IAAZ,EAAM,CAAA,CAAU,EAAQ,KAAA,CACnC,GAEA,EAAK,YAAA,CAAa,MAAA,CAAO,GACzB,GAAgB,AAAA,CAAA,EAAA,EAAA,WAAU,AAAV,EAAY,EAAK,QAAA,CAAS,QAAA,CAAS,KACnD,EAAK,iBAAA,CAAkB,cAAvB,GACA,GAAO,MAAA,CAAO,EAAK,iBAAA,CAAkB,QAAA,GAAY,EAAK,iBAAA,CAAkB,WAAxE,GACJ,EACA,SAAU,WAAO,CACrB,EACJ,EAEM,GAAa,SAAC,CAApB,EACI,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,WAAA,CAAY,CACX,OAAQ,EAAK,QAAA,CAAS,iBAAA,CAAkB,GACxC,SAAU,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,OAAA,GAAY,AAAA,EAAA,QAAO,CAAE,YAAA,CAAe,OACjD,MAAO,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,OAAA,GAAY,AAAA,EAAA,QAAO,CAAE,YAAA,CAAe,OAC9C,SAAU,GAAsB,WAAO,CAC3C,EACJ,CAEA,CAAA,IAAI,CAAC,cAAA,CAAiB,IAAI,AAAA,EAAA,EAAC,CAAE,cAAA,CACzB,EAAS,YAAA,CACT,WAAM,OAAA,CACN,EAAA,WAAM,OAAA,EAAK,QAAL,A,GAGV,IAAM,GAAkB,SAAC,CAAzB,EACI,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,eAAA,CACC,EAAK,QAAA,CACL,EAAK,QAAA,CAAS,iBAAA,CAAkB,GAChC,SAAC,CAHL,EAIY,CAAA,AAAkB,IAAlB,EAAS,IAAA,EAAc,AAAmB,IAAnB,EAAS,KAAA,EAAe,AAAiB,IAAjB,EAAS,GAAA,EAAa,AAAoB,IAApB,EAAS,MAAA,AAAW,IAI7F,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,SAAA,CAAU,UAAA,CAAW,KAAA,CAAO,CAC3B,QAAS,EACT,SAAU,EAAK,QAAf,CACA,MAAO,EACP,QAAS,EAAA,SAAQ,AACrB,GACA,EAAK,YAAA,CAAa,MAAlB,GACA,EAAK,iBAAA,CAAkB,cAAvB,GACA,GAAO,MAAA,CAAO,EAAK,iBAAA,CAAkB,QAAA,GAAY,EAAK,iBAAA,CAAkB,WAAxE,IACJ,EACA,EAAK,aAAA,CACL,GAAY,CAAA,EAEpB,EAEM,GAAU,IAAI,CAAC,KAAA,CAAQ,KAAO,IAAI,AAAA,EAAA,EAAC,CAAE,OAAA,CACvC,IAAI,CAAC,QAAA,CACL,EACA,WAAM,OAAA,EAAK,QAAA,CAAS,UAAd,EACN,EAAA,EACA,SAAC,CADD,EAEI,EAAa,CACjB,EACA,SAAC,CAAA,CAAO,CADR,EACuB,OAAA,GAAc,gBAAA,CAAiB,EAAO,EAC7D,EAAA,WAAM,OAAA,EAAK,cAAA,CAAe,IAApB,EACN,EAAA,GACA,GACA,WACI,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,WAAA,CACC,EAAK,QAAA,CACL,EAAK,QAAA,CACL,EAAS,YAAA,CACT,EAAS,GAAA,EAAO,EAAS,GAAA,CAAI,QAAA,CAAW,EAAS,GAAA,CAAI,QAAA,CAAW,GAExE,EACA,GACA,EAAS,YAFT,EAKE,GAAc,IAAI,AAAA,EAAA,EAAC,CAAE,WAAA,CACvB,WACI,EAAK,OAAA,CAAU,AAAiB,SAAjB,EAAK,OAAA,CAAqB,QAAU,OACnD,EAAK,QAAL,GACK,EAAK,KAAA,EACN,AAAA,CAAA,EAAA,EAAA,YAAW,AAAX,EAAa,OAAA,CAAQ,UAAW,EAAK,OADzC,CAGJ,EACA,EAAS,OADT,EAIJ,EAAa,IAAI,AAAA,EAAA,EAAC,CAAE,MAAA,CAAO,CACvB,UAAW,OACX,OAAQ,CACJ,CACI,GAAI,OACJ,MAAO,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,cACZ,MAAO,EAAA,GACP,OAAQ,WACmB,gBAAnB,GACA,EAAK,aAAA,CAAc,MAAA,CAAO,CAAA,GAE9B,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,MAAA,CACC,GACA,CAAC,EAAK,aAAA,CAAc,UAAnB,GAAiC,EAAK,aAAA,CAAc,gBAAnB,GAAuC,GAAuB,UAAvB,GAAoC,EAEjH,GAAS,KAAA,CAAM,OAAA,CAAU,OAC7B,EACA,QAAS,WACL,GAAS,KAAA,CAAM,OAAA,CAAU,MAC7B,EACA,IAAK,CACD,SAAU,MACd,CACJ,EACA,CACI,GAAI,OACJ,MAAO,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,aACZ,MAAO,EAAA,GACP,UAAW,CAAA,EACX,OAAQ,WACJ,GAAO,YAAA,CAAa,CAAA,EACxB,EACA,QAAS,WACL,GAAO,YAAA,CAAa,CAAA,EACxB,EACA,IAAK,CACD,SAAU,MACd,CACJ,EACA,CACI,GAAI,OACJ,MAAO,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,qBACZ,MAAO,EAAA,GACP,UAAW,CAAA,EACX,OAAQ,WACJ,EAAK,aAAA,CAAc,MAAA,CAAO,CAAA,GAC1B,GAAO,YAAA,CAAa,CAAA,EACxB,EACA,QAAS,WACL,GAAO,YAAA,CAAa,CAAA,EACxB,EACA,IAAK,CACD,SAAU,MACd,CACJ,EACA,CACI,GAAI,WACJ,MAAO,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,iBACZ,MAAO,EAAA,GACP,UAAW,CAAA,EACX,OAAQ,WACJ,EAAK,aAAA,CAAc,MAAA,CAAO,CAAA,GAC1B,GAAW,YAAA,CAAa,CAAA,EAC5B,EACA,QAAS,WACL,GAAW,YAAA,CAAa,CAAA,EAC5B,EACA,IAAK,CACD,SAAU,MACd,CACJ,EACA,CACI,GAAI,OACJ,MAAO,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,aACZ,MAAO,EAAA,GACP,UAAW,CAAA,EACX,OAAQ,WACJ,EAAK,aAAA,CAAc,MAAA,CAAO,CAAA,GAC1B,GAAO,YAAA,CAAa,CAAA,EACxB,EACA,QAAS,WACL,GAAO,YAAA,CAAa,CAAA,EACxB,EACA,IAAK,CACD,SAAU,MACd,CACJ,EACA,CACI,GAAI,QACJ,MAAO,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,cACZ,MAAO,EAAA,GACP,UAAW,CAAA,EACX,OAAQ,WACJ,EAAK,aAAA,CAAc,MAAA,CAAO,CAAA,GAC1B,GAAQ,YAAA,CAAa,CAAA,EACzB,EACA,QAAS,WACL,GAAQ,YAAA,CAAa,CAAA,EACzB,EACA,IAAK,CACD,SAAU,MACd,CACJ,EACA,CACI,GAAI,SACJ,MAAO,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,UACZ,MAAO,EAAA,GACP,OAAQ,WACJ,EAAK,YAAA,CAAa,MAAlB,GACA,EAAK,YAAA,CAAa,UAAA,GAAa,KAAA,CAAM,OAAA,CAAU,OACnD,EACA,QAAS,WACL,EAAK,YAAA,CAAa,UAAA,GAAa,KAAA,CAAM,OAAA,CAAU,MACnD,EACA,IAAK,CACD,SAAU,MACd,CACJ,EACA,CACI,GAAI,OACJ,MAAO,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,YACZ,OAAQ,WACJ,GAAU,IAAV,EACJ,EACA,QAAS,WACL,GAAU,IAAV,EACJ,EACA,IAAK,CACD,QAAS,OACb,CACJ,EACA,CACI,GAAI,OACJ,MAAO,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,YACZ,UAAW,CAAC,CAAC,GACb,OAAQ,WACC,KAGL,GAAQ,UAAA,GAAa,KAAA,CAAM,OAAA,CAAU,QACrC,GAAQ,YAAA,CAAa,CAAA,GACzB,EACA,QAAS,WACA,KAGL,GAAQ,UAAA,GAAa,KAAA,CAAM,OAAA,CAAU,OACrC,GAAQ,YAAA,CAAa,CAAA,GACzB,EACA,IAAK,CACD,QAAS,OACb,CACJ,EACA,CACI,GAAI,WACJ,MAAO,AAAA,CAAA,EAAA,EAAA,IAAG,AAAH,EAAK,gBACZ,MAAO,EAAA,GACP,OAAQ,WACJ,GAAY,UAAA,GAAa,KAAA,CAAM,OAAA,CAAU,OAE7C,EACA,QAAS,WACL,GAAY,UAAA,GAAa,KAAA,CAAM,OAAA,CAAU,MAE7C,EACA,IAAK,CACD,SAAU,MACd,CACJ,EACH,AACL,GAEA,IAAI,CAAC,gBAAA,CAAmB,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,EAAA,CAAG,CAC1B,IAAK,CACD,MAAO,QACP,SAAU,WACV,OAAQ,IACR,KAAM,GACV,CACJ,GACI,EAAS,SAAA,GACT,IAAI,CAAC,SAAA,CAAY,EAAS,SAA1B,CACA,IAAI,CAAC,gBAAA,CAAiB,MAAA,CAAO,IAAI,CAAC,SAAlC,EAEA,AADiB,IAAI,iBAAiB,WAAM,OAAA,EAAK,eAAL,E,GACnC,OAAA,CACL,IAAI,CAAC,cAAA,CACL,CACI,WAAY,CAAA,EACZ,UAAW,CAAA,EACX,QAAS,CAAA,CACb,IAOR,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,MAAA,CAAO,IAAI,CAAC,cAAA,CAAgB,CAC3B,IAAI,CAAC,YAAA,CAAa,UAAlB,GACA,EAAW,UAAX,GACA,GACA,GAAO,UAAP,GACA,GAAO,UAAP,GACA,GAAW,UAAX,GACA,GAAO,UAAP,GACA,GAAQ,UAAR,GACA,IAAI,CAAC,YAAA,CAAa,UAAlB,GACA,GAAU,UAAV,GACA,GAAU,GAAQ,UAAA,GAAe,KAAA,EACjC,GAAY,UAAZ,GACA,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,EAAA,CAAG,CACF,IAAK,CACD,OAAQ,MACZ,CACJ,GACA,IAAI,CAAC,gBAAA,CAAmB,IAAI,CAAC,gBAAA,CAAmB,KAAA,EACnD,EAED,IAAI,CAAC,iBAAA,CAAoB,IAAI,AAAA,EAAA,EAAC,CAAE,iBAAA,CAAkB,CAC9C,UAAW,IAAI,CAAC,SAAhB,CACA,QAAS,IAAI,CAAC,OAAd,AACJ,GAEK,IAAI,CAAC,KAAA,EACN,OAAO,cAAA,CAAe,OAAQ,KAAM,CAChC,MAAO,AAAA,CAAA,EAAA,EAAA,gBAAe,AAAf,EAAiB,CACpB,OAAQ,SAAC,CAAT,EACS,GAAQ,AAAgB,IAAhB,EAAK,MAAA,GAGlB,EAAK,OAAA,CAAQ,SAAC,CAAA,CAAG,CAAjB,EACQ,AAAU,IAAV,EACA,EAAe,SAAA,CAAU,EAAE,CAAA,CAAG,EAAE,CAAA,CAAG,GAEnC,EAAe,MAAA,CAAO,EAAE,CAAA,CAAG,EAAE,CAAA,CAAG,EAExC,GACA,EAAe,OAAf,GACA,EAAK,iBAAA,CAAkB,YAAvB,GACJ,CACJ,GACA,SAAU,CAAA,CACd,GAGJ,IAAI,CAAC,MAAA,CAAO,IAAI,CAAC,OAAA,CAAS,IAAI,CAAC,QAA/B,EACA,IAAI,CAAC,QAAL,GAEA,IAAM,GAAgB,IAAI,EAAA,aAAY,CAAE,CACpC,SAAU,IAAI,CAAC,QAAf,CACA,gBAAA,EACA,aAAc,IAAI,CAAC,YAAnB,CACA,gBAAA,GACA,SAAU,IAAI,CAAC,QAAf,CACA,kBAAmB,IAAI,CAAC,iBAAxB,CACA,OAAA,EACJ,EAAG,CACC,QAAS,SAAC,CAAV,EAAkB,OAAA,EAAoB,QAAA,CAAS,E,CACnD,EAEK,CAAA,IAAI,CAAC,KAAA,GACN,IAAI,AAAA,EAAA,EAAC,CAAE,cAAA,CAAe,CAClB,OAAQ,SAAS,IAAjB,CACA,OAAQ,SAAC,CAAA,CAAO,CAAhB,EACQ,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,aAAA,CAAc,GAAA,GAAQ,GAG7B,GAAc,gBAAA,CAAiB,EAAO,EAC1C,EACA,YAAa,WACT,OAAO,AAA2B,IAA3B,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,aAAA,CAAc,GAAA,EAC5B,CACJ,GAEA,OAAO,QAAA,CAAS,gBAAA,CACZ,QACA,SAAC,CAFL,EAE2B,OAAA,GAAc,OAAA,CAAQ,EAC7C,EAAA,CAAA,IAKJ,OAAO,gBAAA,CAAiB,SAAU,WAC9B,EAAK,MAAA,CAAO,OAAO,UAAA,CAAY,OAAO,WAAtC,CACJ,GACA,OAAO,gBAAA,CAAiB,oBAAqB,WACzC,EAAK,MAAA,CAAO,OAAO,UAAA,CAAY,OAAO,WAAtC,CACJ,GAIA,IAAM,GAAsB,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,EAAA,CAAG,CAC9B,OAAQ,SAAS,IAAjB,CACA,IAAK,CACD,SAAU,QACV,KAAM,IACN,IAAK,IACL,MAAO,IACP,OAAQ,IACR,cAAe,OACf,OAAQ,KACR,WAAY,MAChB,CACJ,GACA,GAAI,CAGA,AADiB,IAAI,eAAe,WAAM,OAAA,EAAK,MAAA,CAAO,OAAO,UAAA,CAAY,OAAO,WAAtC,C,GACjC,OAAA,CAAQ,GACrB,CAAE,MAAO,EAAG,CACR,GAAoB,MAApB,EACJ,CAGA,IAAI,CAAC,QAAA,CAAS,gBAAA,CAAiB,QAAS,SAAC,CAAzC,EACQ,GAAY,SAAA,CAAU,SACtB,EAAM,cADV,EAGJ,GAEA,IAAM,GAAU,SAAC,CAAjB,EACI,EAAE,cAAF,EACJ,EACA,OAAO,gBAAA,CAAiB,eAAgB,IACxC,OAAO,gBAAA,CAAiB,gBAAiB,IACzC,OAAO,gBAAA,CAAiB,aAAc,G,CA3hDrC,MAAA,AAAA,CAAA,EAAA,EAAA,CAAA,AAAA,EAAA,EAAA,C,CAyBD,IAAA,iBAAR,MAAA,WAGQ,IAAI,CAAC,OAAA,CAAU,IAAI,CAAC,iBAAA,EACpB,IAAI,CAAC,kBAAA,CAAmB,UAAA,GAAa,KAAA,CAAM,OAAA,CAAU,QAErD,IAAI,CAAC,kBAAA,CAAmB,YAAA,CAAa,IAAI,CAAC,OAA1C,EACI,IAAI,CAAC,kBAAA,CAAmB,MAAA,IACpB,AAAiB,SAAjB,IAAI,CAAC,OAAA,EACL,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,GAAA,CAAI,IAAI,CAAC,kBAAA,CAAmB,UAAA,GAAc,CACzC,KAAM,QACN,MAAO,EACX,GACA,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,GAAA,CAAI,IAAI,CAAC,iBAAA,CAAkB,UAAA,GAAc,CACxC,KAAM,OACV,KAEA,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,GAAA,CAAI,IAAI,CAAC,kBAAA,CAAmB,UAAA,GAAc,CACzC,KAAM,GACN,MAAO,OACX,GACA,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,GAAA,CAAI,IAAI,CAAC,iBAAA,CAAkB,UAAA,GAAc,CACxC,KAAM,GACV,IAEJ,IAAI,CAAC,SAAA,CAAU,KAAA,CAAM,OAAA,CAAU,QAC/B,IAAI,CAAC,iBAAA,CAAkB,OAAA,CAAQ,KAAK,GAAA,CAAI,EAAG,IAAI,CAAC,OAAA,CAAU,IAAI,CAAC,SAAA,EAAY,IAAI,CAAC,QAAhF,EACA,IAAI,CAAC,aAAA,CAAc,OAAA,CAAQ,CAAA,KAGvB,AAAiB,SAAjB,IAAI,CAAC,OAAA,CACL,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,GAAA,CAAI,IAAI,CAAC,kBAAA,CAAmB,UAAA,GAAc,CACzC,KAAM,IACN,MAAO,EACX,GAKA,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,GAAA,CAAI,IAAI,CAAC,kBAAA,CAAmB,UAAA,GAAc,CACzC,KAAM,GACN,MAAO,GACX,GACA,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,GAAA,CAAI,IAAI,CAAC,iBAAA,CAAkB,UAAA,GAAc,CACxC,KAAM,GACV,GAEJ,IAAI,CAAC,SAAA,CAAU,KAAA,CAAM,OAAA,CAAU,OAC/B,IAAI,CAAC,iBAAA,CAAkB,OAAA,CAAQ,KAAK,GAAA,CAAI,EAAG,IAAI,CAAC,OAAA,EAAU,IAAI,CAAC,QAA/D,EACA,IAAI,CAAC,aAAA,CAAc,OAAA,CAAQ,CAAA,MAK/B,IAAI,CAAC,kBAAA,CAAmB,UAAA,GAAa,KAAA,CAAM,OAAA,CAAU,OACjD,AAAiB,SAAjB,IAAI,CAAC,OAAA,CACL,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,GAAA,CAAI,IAAI,CAAC,iBAAA,CAAkB,UAAA,GAAc,CACxC,KAAM,OACV,GAEA,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,GAAA,CAAI,IAAI,CAAC,iBAAA,CAAkB,UAAA,GAAc,CACxC,KAAM,GACV,GAEJ,IAAI,CAAC,SAAA,CAAU,KAAA,CAAM,OAAA,CAAU,QAC/B,IAAI,CAAC,iBAAA,CAAkB,OAAA,CAAQ,KAAK,GAAA,CAAI,EAAG,IAAI,CAAC,OAAA,CAAU,IAAI,CAAC,SAAA,EAAY,IAAI,CAAC,QAAhF,EACA,IAAI,CAAC,aAAA,CAAc,OAAA,CAAQ,CAAA,GAEnC,C,E,CAEQ,IAAA,kBAAR,MAAA,WACI,GAAK,IAAI,CAAC,SAAA,EAGV,IAAM,EAAa,IAAI,CAAC,cAAA,CAAe,YAAA,CAAe,GAAK,OAAO,WAAlE,AACA,CAAA,IAAI,CAAC,gBAAA,CAAiB,KAAA,CAAM,OAAA,CAAU,EAAY,GAAK,OAC3D,C,E,CAEQ,IAAA,WAAR,MAAA,WACI,IAAI,CAAC,SAAA,CAAU,SAAA,CAAU,MAAA,CAAO,qBAAsB,AAAiB,SAAjB,IAAI,CAAC,OAAA,EAC3D,IAAI,CAAC,SAAA,CAAU,SAAA,CAAU,MAAA,CAAO,sBAAuB,AAAiB,UAAjB,IAAI,CAAC,OAAA,EACxD,AAAiB,SAAjB,IAAI,CAAC,OAAA,EACL,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,GAAA,CAAI,IAAI,CAAC,SAAA,CAAW,CACnB,KAAM,IACN,MAAO,EACX,GACA,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,GAAA,CAAI,IAAI,CAAC,iBAAA,CAAkB,UAAA,GAAc,CACxC,KAAM,OACV,KAEA,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,GAAA,CAAI,IAAI,CAAC,SAAA,CAAW,CACnB,KAAM,GACN,MAAO,GACX,GACA,AAAA,CAAA,EAAA,EAAA,EAAC,AAAD,EAAG,GAAA,CAAI,IAAI,CAAC,iBAAA,CAAkB,UAAA,GAAc,CACxC,KAAM,GACV,IAEJ,IAAI,CAAC,aAAA,CAAc,UAAA,CAAW,IAAI,CAAC,OAAnC,EACA,IAAI,CAAC,YAAA,CAAa,UAAA,CAAW,IAAI,CAAC,OAAlC,EACA,IAAI,CAAC,YAAA,CAAa,UAAA,CAAW,IAAI,CAAC,OAAlC,EACA,IAAI,CAAC,cAAL,GACA,IAAI,CAAC,iBAAA,CAAkB,aAAA,CAAc,IAAI,CAAC,OAA1C,CACJ,C,E,CAi6CA,IAAA,QAAA,MAAA,WACI,OAAO,IAAI,CAAC,QAAZ,AACJ,C,E,CAEA,IAAA,SAAA,MAAA,SAAQ,CAAS,CAAE,CAAS,EAGpB,OAAO,OAAA,CAAU,GACjB,OAAO,QAAA,CAAS,EAAG,GAGnB,CAAA,IAAI,CAAC,OAAA,GAAY,KAAK,GAAA,CAAI,EAAG,IAAM,IAAI,CAAC,QAAA,GAAa,KAAK,GAAA,CAAI,EAAG,EAAA,IAIrE,IAAI,CAAC,OAAA,CAAU,KAAK,GAAA,CAAI,EAAG,GAC3B,IAAI,CAAC,QAAA,CAAW,KAAK,GAAA,CAAI,EAAG,GAE5B,IAAI,CAAC,cAAL,GACA,IAAI,CAAC,eAAL,GAEA,IAAI,CAAC,YAAA,CAAa,YAAA,CAAa,IAAI,CAAC,QAAA,EAAY,KAChD,IAAI,CAAC,aAAA,CAAc,SAAA,CAAU,KAAK,GAAA,CAAI,IAAK,KAAK,GAAA,CAAI,IAAK,IAAI,CAAC,QAAA,CAAW,OACzE,IAAI,CAAC,gBAAA,CAAiB,UAAA,CAAW,IAAI,CAAC,QAAA,CAAW,KACrD,C,E,CAEA,IAAA,MAAA,MAAA,SAAK,CAAW,EACZ,IAAI,CAAC,aAAA,CAAc,GAAA,CAAI,EAC3B,C,E,CAEA,IAAA,SAAA,MAAA,WACI,MAAO,AAAA,CAAA,EAAA,EAAA,YAAW,AAAX,EAAa,IAAI,CAAC,QAAA,CAAS,iBAAA,CAAkB,GAAG,SAAA,CAAU,aACrE,C,E,CAMA,IAAA,aAAA,MAAA,WACI,OAAO,IAAI,CAAC,QAAA,CAAS,UAArB,EACJ,C,E,CAEA,IAAA,kBAAA,MAAA,WACI,IAAI,CAAC,OAAA,CAAU,AAAiB,SAAjB,IAAI,CAAC,OAAA,CAAqB,QAAU,OAC9C,IAAI,CAAC,KAAA,EACN,AAAA,CAAA,EAAA,EAAA,YAAW,AAAX,EAAa,OAAA,CAAQ,UAAW,IAAI,CAAC,OADzC,EAGA,IAAI,CAAC,QAAL,EACJ,C,E,CAEA,IAAA,YAAA,MAAA,WACI,IAAI,CAAC,cAAA,CAAe,IAAA,CAAK,MAC7B,C,E,CAEA,IAAA,YAAA,MAAA,WACI,OAAO,IAAI,CAAC,aAAA,CAAc,YAAA,IAAkB,IAAI,CAAC,iBAAA,CAAkB,YAAnE,EACJ,C,E,EAzlDS,C,G,G,E,Q,C,Q,S,C,C,C,E,E,E,O,C,I,W,O,C,G,I,E,E,S,E,E,S,E,E,S,E,E,SClEN,SAAS,EAAqB,CAAG,EACpC,MAAO,AAAA,CAAA,EAAA,EAAA,oBAAmB,AAAnB,EAAqB,IAAQ,AAAA,CAAA,EAAA,EAAA,kBAAiB,AAAjB,EAAmB,IAAQ,AAAA,CAAA,EAAA,EAAA,8BAA6B,AAA7B,EAA+B,IAAQ,AAAA,CAAA,EAAA,EAAA,oBAAmB,AAAnB,GAC1G,C,G,E,Q,C,Q,S,C,C,C,E,E,E,O,C,uB,W,O,C,G,I,E,E,SCLO,SAAS,EAAqB,CAAG,EACpC,GAAI,MAAM,OAAA,CAAQ,GAAM,MAAO,AAAA,CAAA,EAAA,EAAA,oBAAmB,AAAnB,EAAqB,EACxD,C,G,E,Q,C,Q,S,C,C,C,E,E,E,O,C,qB,W,O,C,GCJO,SAAS,EAAmB,CAAI,EACnC,GAAI,AAAkB,aAAlB,OAAO,QAA0B,AAAyB,MAAzB,CAAI,CAAC,OAAO,QAAA,CAAS,EAAY,AAAsB,MAAtB,CAAI,CAAC,aAAa,CACpF,OAAO,MAAM,IAAA,CAAK,EAE1B,C,G,E,Q,C,Q,S,C,C,C,E,E,E,O,C,uB,W,O,C,GCJO,SAAS,IACZ,MAAM,AAAI,UAAU,uIACxB,C,G,E,Q,C,Q,S,C,C,C,E,E,E,O,C,K,W,O,E,G,I,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,E,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,S,G,E,SC2Ea,GAAK,CAGd,QAAA,GAAA,OAAM,CACN,UAAA,GAAA,SAAQ,CACR,oBAAA,GAAA,mBAAkB,CAGlB,SAAA,EAAA,QAAO,CACP,YAAA,GAAA,WAAU,CAGV,oBAAA,EAAA,mBAAkB,CAClB,kBAAA,EAAA,iBAAgB,CAChB,gBAAA,EAAA,eAAc,CAGd,gBAAA,GAAA,eAAc,CACd,UAAA,GAAA,SAAQ,CAGR,gBAAA,GAAA,eAAc,CAGd,WAAA,EAAA,UAAS,CACT,cAAA,EAAA,aAAY,CACZ,UAAA,EAAA,SAAQ,CACR,UAAA,EAAA,SAAQ,CACR,aAAA,GAAA,YAAW,CACX,aAAA,GAAA,YAAW,CAGX,IAAA,EACA,UAAA,GAAA,SAAQ,CACR,UAAA,GACA,aAAA,GAAA,YAAW,CACX,UAAA,GAAA,SAAQ,CACR,eAAA,GAAA,cAAa,CAGb,wBAAA,EAAA,uBAAsB,CACtB,SAAA,EAAA,QAAO,CACP,MAAA,EAAA,KAAI,CACJ,OAAA,EAAA,MAAK,CACL,YAAA,EAAA,WAAU,CACV,eAAA,EAAA,cAAa,CACb,UAAA,GAAA,SAAQ,CACR,wBAAA,EAAA,uBAAsB,CACtB,SAAA,EAAA,QAAO,CACP,eAAA,EAAA,cAAa,CACb,cAAA,EAAA,aAAY,CACZ,mBAAA,EAAA,kBAAiB,CACjB,YAAA,EAAA,WAAU,CACV,aAAA,EAAA,YAAW,CACX,QAA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CM,EAAK,KAAK,GAAA,CAAI,EAAQ,EAAG,EAAO,EAAtC,EACM,EAAK,KAAK,GAAA,CAAI,EAAS,EAAG,EAAO,EAAvC,EACA,GAAI,CAAA,CAAA,EAAK,CAAA,IAAM,CAAA,EAAK,CAAA,EAGpB,MAAO,CAAE,GAAA,EAAI,GAAA,EAAI,GAAA,EAAI,GAAA,CAAG,EAC5B,C,E,E,O,C,M,W,O,C,G,E,E,O,C,O,W,O,C,G,E,E,O,C,c,W,O,C,G,E,E,O,C,a,W,O,C,G,E,E,O,C,mB,W,O,C,G,E,E,O,C,mB,W,O,C,G,E,E,O,C,e,W,O,C,G,E,E,O,C,Q,W,O,C,G,E,E,O,C,S,W,O,C,G,E,E,O,C,e,W,O,C,G,E,E,O,C,S,W,O,C,G,E,E,O,C,Y,W,O,C,G,E,E,O,C,c,W,O,C,G,E,E,O,C,Q,W,O,C,G,E,E,O,C,e,W,O,C,G,E,E,O,C,e,W,O,C,E,G,E,Q,C,Q,S,C,C,C,E,E,E,O,C,a,W,O,C,G,E,E,O,C,M,W,O,C,G,E,E,O,C,qB,W,O,C,G,E,E,O,C,iC,W,O,C,G,E,E,O,C,+B,W,O,C,G,E,E,O,C,sB,W,O,C,G,E,E,O,C,uB,W,O,C,G,E,E,O,C,e,W,OCkEO,SAAS,EACZ,CAAyB,CACzB,CAAS,CACT,CAAS,CACT,CAAwB,CACxB,CAAwB,EAgBxB,GAAI,AAAC,GAAM,GAAM,CAAA,IAAM,EAAO,KAAA,EAAS,IAAM,EAAO,MAAA,AAAA,GAKpD,GAFA,EAAI,KAAK,GAAA,CAAI,EAAG,GAChB,EAAI,KAAK,GAAA,CAAI,EAAG,GACZ,GAAK,EAAO,KAAA,EAAS,GAAK,EAAO,MAAA,CAAQ,CAEzC,EAAO,AAAC,GAAO,AAAA,CAAA,EAAA,EAAA,YAAW,AAAX,IACf,EAAO,AAAC,GAAO,AAAA,CAAA,EAAA,EAAA,YAAW,AAAX,IAEf,IArBM,EA6BF,EAAI,EARF,GAfN,CANM,EAAS,CACX,WAAY,KAAK,KAAA,CAAM,KAAK,IAAA,CAoBN,EAAO,KAAA,GAnB7B,YAAa,KAAK,KAAA,CAAM,KAAK,IAAA,CAmBO,EAAO,MAAA,GAlB3C,WAAY,KAAK,IAAA,CAAK,KAAK,IAAA,CAkBwB,IA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O,C,G,E,E,O,C,U,W,O,C,G,E,E,O,C,U,W,O,C,G,E,E,O,C,S,W,O,C,G,E,E,O,C,U,W,O,C,G,E,E,O,C,W,W,O,C,G,E,E,O,C,O,W,O,C,G,E,E,O,C,O,W,O,C,G,E,E,O,C,O,W,O,C,G,E,E,O,C,Q,W,O,C,G,E,E,O,C,Q,W,O,C,G,E,E,O,C,Q,W,O,C,G,E,E,O,C,U,W,O,C,G,E,E,O,C,U,W,O,C,G,E,E,O,C,U,W,O,C,G,E,E,O,C,Y,W,O,C,G,E,E,O,C,Y,W,O,C,G,E,E,O,C,a,W,O,C,G,E,E,O,C,Y,W,O,C,GEtJC,IAAC+uF,EAAK,OACLD,EAAM,QACND,EAAS,WAET8+C,EAAU,OACVt+C,EAAU,OACVX,EAAc,OAUdS,EAAY,aCZZlqD,EAAM54B,KAAK44B,GAAZ,CAMChb,EAAOviB,OAAOosF,YAAf,CAMCE,EAAS3zF,OAAO2zF,MAAjB,CAOH,SAASpF,EAAMtrF,CAAAA,CAAO6B,CAAAA,EAC5B,OAAO8pF,AAAmB,GAAnBA,EAAO3rF,EAAO,GAAK,AAAA,CAAA,AAAY6B,CAAAA,AAAAA,CAAAA,GAAU,EAAK8pF,EAAO3rF,EAAO,EAAA,GAAO,EAAK2rF,EAAO3rF,EAAO,EAAA,GAAO,EAAK2rF,EAAO3rF,EAAO,EAAA,GAAO,EAAK2rF,EAAO3rF,EAAO,GAAK,CAAA,CAgBhJ,SAASisF,EAAOjsF,CAAAA,CAAOw/F,CAAAA,EAC7B,MAAA,AAAQx/F,CAAAA,EAAQw/F,EAAQ3vD,IAAAA,CAAK7vC,EAAAA,EAAUA,CAAAA,CAAM,EAAA,CAAKA,CAAAA,CASnD,SAAgBwE,EAASxE,CAAAA,CAAOw/F,CAAAA,CAASyrC,CAAAA,EACxC,OAAOjrI,EAAMwE,OAAAA,CAAQg7F,EAASyrC,EAAAA,CAQxB,SAASr/C,EAAS5rF,CAAAA,CAAOkrI,CAAAA,EAC/B,OAAOlrI,EAAM03B,OAAAA,CAAQwzG,EAAAA,CAQf,SAASv/C,EAAQ3rF,CAAAA,CAAO8jB,CAAAA,EAC9B,OAAO9jB,AAA0B,EAA1BA,EAAM4qF,UAAAA,CAAW9mE,EAAS,CASlC,SAAgBqnH,EAAQnrI,CAAAA,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","sources":["<anon>","src/app/script/main-embed.ts","<<jsx-config-pragma.js>>","src/app/script/polyfills/polyfills.ts","src/app/script/polyfills/polyfills-nomodule.ts","node_modules/mdn-polyfills/Node.prototype.append.js","node_modules/mdn-polyfills/Node.prototype.prepend.js","node_modules/mdn-polyfills/String.prototype.padStart.js","node_modules/mdn-polyfills/Array.prototype.findIndex.js","src/app/script/app/kl-app.ts","node_modules/@swc/helpers/esm/_to_consumable_array.js","node_modules/@swc/helpers/esm/_array_without_holes.js","node_modules/@swc/helpers/esm/_iterable_to_array.js","node_modules/@swc/helpers/esm/_non_iterable_spread.js","src/app/script/klecks/kl.ts","src/app/script/klecks/history/kl-history.ts","src/app/script/klecks/ui/modals/base/showModal.ts","src/app/script/klecks/ui/modals/modal-count.ts","src/app/script/bb/bb.ts","src/app/script/bb/base/browser.ts","src/app/script/bb/input/key-listener.ts","src/app/script/bb/input/pointer-listener.ts","src/app/script/bb/input/wheel-cleaner.ts","src/app/script/bb/input/pressure-normalizer.ts","src/app/script/bb/math/math.ts","src/app/script/bb/base/canvas.ts","src/app/script/bb/base/create-canvas.ts","src/app/script/bb/math/matrix.ts","src/app/script/bb/math/vec2.ts","src/app/script/bb/math/line.ts","src/app/script/bb/color/color.ts","src/app/script/bb/base/ui.ts","src/app/script/bb/base/bb-log.ts","src/app/script/bb/base/local-storage.ts","src/app/script/bb/input/event-chain/coalesced-exploder.ts","src/app/script/bb/input/event-chain/n-finger-tapper.ts","src/app/script/bb/input/event-chain/pinch-zoomer.ts","src/app/script/bb/input/event-chain/double-tapper.ts","src/app/script/bb/input/event-chain/one-pointer-limiter.ts","src/app/script/bb/input/event-chain/event-chain.ts","src/app/script/klecks/ui/modals/base/scroll-fix.ts","node_modules/@parcel/runtime-js/lib/runtime-ac5a13e6ed7d1c32.js","node_modules/@parcel/runtime-js/lib/runtime-287f00094a316f99.js","src/app/script/klecks/ui/modals/base/dynamic-modal.ts","src/app/script/klecks/ui/components/checkbox.ts","src/app/script/klecks/ui/components/input.ts","src/app/script/klecks/ui/components/select.ts","src/app/script/klecks/ui/components/image-toggle.ts","src/app/script/klecks/ui/components/image-radio-list.ts","src/app/script/klecks/ui/components/create-pen-pressure-toggle.ts","node_modules/@parcel/runtime-js/lib/runtime-5d5af97961b0b866.js","src/app/script/klecks/ui/components/box-toggle.ts","src/app/script/klecks/ui/components/kl-slider.ts","src/app/script/klecks/ui/components/slider-falloff.ts","src/app/script/klecks/ui/components/kl-slider-manual-input.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-343023b05f023704.js","src/app/script/klecks/ui/components/kl-color-slider.ts","node_modules/@parcel/runtime-js/lib/runtime-e949988766af13d3.js","src/app/script/klecks/brushes/erase-color.ts","src/app/script/klecks/ui/components/kl-color-slider-small.ts","src/app/script/klecks/ui/components/point-slider.ts","src/app/script/klecks/ui/components/color-options.ts","src/app/script/bb/base/c.ts","src/app/script/klecks/ui/components/options.ts","src/app/script/klecks/ui/components/status-overlay.ts","node_modules/@parcel/runtime-js/lib/runtime-e99dce5763a53828.js","src/app/script/klecks/ui/components/crop-copy.ts","src/app/script/klecks/ui/modals/clipboard-dialog.ts","src/app/script/klecks/ui/tool-tabs/layer-manager/layer-manager.ts","src/app/script/klecks/canvas/kl-canvas.ts","src/app/script/klecks/image-operations/flood-fill.ts","src/app/script/klecks/image-operations/shape-tool.ts","src/app/script/klecks/image-operations/render-text.ts","src/app/script/klecks/canvas/draw-project.ts","src/app/script/klecks/image-operations/gradient-tool.ts","src/app/script/klecks/canvas/translate-blending.ts","src/app/script/klecks/ui/tool-tabs/layer-manager/rename-layer-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-b31ab580fe87ed91.js","src/app/script/klecks/ui/tool-tabs/layer-manager/merge-layer-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-9d4db9a16894fc5d.js","node_modules/@parcel/runtime-js/lib/runtime-8689d3bdc90716d5.js","node_modules/@parcel/runtime-js/lib/runtime-67c3e5d0b4ea898f.js","node_modules/@parcel/runtime-js/lib/runtime-6f5bf53dff43e557.js","src/app/script/klecks/canvas-ui/workspace-svg-overlay.ts","src/app/script/klecks/canvas-ui/kl-canvas-workspace.ts","node_modules/@parcel/runtime-js/lib/runtime-d3176d0a84b6cab2.js","node_modules/@parcel/runtime-js/lib/runtime-fae9a2679085aa34.js","node_modules/@parcel/runtime-js/lib/runtime-313dd5ffb9b9f520.js","node_modules/@parcel/runtime-js/lib/runtime-2a18e2880edd0998.js","src/app/script/klecks/events/linetool-processor.ts","src/app/script/klecks/kl-config.ts","src/app/script/klecks/canvas-ui/canvas-preview.ts","src/app/script/klecks/ui/components/free-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-719757e47171233d.js","src/app/script/klecks/ui/components/free-transform-utils.ts","src/app/script/klecks/ui/components/free-transform-canvas.ts","src/app/script/klecks/ui/components/cropper.ts","src/app/script/klecks/ui/components/layer-preview.ts","src/app/script/klecks/ui/modals/show-import-as-layer-dialog.ts","src/app/script/klecks/ui/components/kl-image-dropper.ts","src/app/script/klecks/ui/components/overlay-toolspace.ts","src/app/script/klecks/ui/components/toolspace-top-row.ts","node_modules/@parcel/runtime-js/lib/runtime-7df504581c8b86ae.js","node_modules/@parcel/runtime-js/lib/runtime-051039d7aa46660a.js","node_modules/@parcel/runtime-js/lib/runtime-c3ac4661b4a56a9b.js","node_modules/@parcel/runtime-js/lib/runtime-b17cc4a4601be3c4.js","node_modules/@parcel/runtime-js/lib/runtime-ba29718ea135d20f.js","node_modules/@parcel/runtime-js/lib/runtime-4ecaac3815a70635.js","src/app/script/klecks/ui/components/tool-dropdown.ts","node_modules/@parcel/runtime-js/lib/runtime-8bdb8bdd8828f06e.js","node_modules/@parcel/runtime-js/lib/runtime-0b39f3111ea9252b.js","node_modules/@parcel/runtime-js/lib/runtime-48932223f89234d1.js","node_modules/@parcel/runtime-js/lib/runtime-7d10910deba19d0d.js","node_modules/@parcel/runtime-js/lib/runtime-88790bdf968aa944.js","node_modules/@parcel/runtime-js/lib/runtime-19a2d39e17cbc785.js","src/app/script/klecks/ui/components/toolspace-tool-row.ts","node_modules/@parcel/runtime-js/lib/runtime-41c7a6bdeb9cc3fc.js","node_modules/@parcel/runtime-js/lib/runtime-c4a854cd9c2e49c9.js","node_modules/@parcel/runtime-js/lib/runtime-71bc2704037e4034.js","node_modules/@parcel/runtime-js/lib/runtime-1efd7f94627b6b51.js","src/app/script/klecks/ui/components/toolspace-stabilizer-row.ts","src/app/script/klecks/ui/components/tab-row.ts","node_modules/@parcel/runtime-js/lib/runtime-16dea92aa233c3d8.js","src/app/script/klecks/ui/tool-tabs/hand-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-144f3179c6c3fe3c.js","src/app/script/klecks/ui/tool-tabs/fill-ui.ts","src/app/script/klecks/ui/tool-tabs/text-ui.ts","src/app/script/klecks/ui/tool-tabs/shape-ui.ts","src/app/script/klecks/ui/modals/new-image-dialog.ts","src/app/script/klecks/ui/components/table.ts","src/app/script/klecks/ui/components/toolspace-collapser.ts","node_modules/@parcel/runtime-js/lib/runtime-61134bbd82dc83a9.js","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-dialog.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-fill-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-font-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-4b94518680a7ea9a.js","node_modules/@parcel/runtime-js/lib/runtime-27c12d26a5335a1c.js","node_modules/@parcel/runtime-js/lib/runtime-a2156221f02ea6ff.js","node_modules/@parcel/runtime-js/lib/runtime-095fd25bc9573bb4.js","node_modules/@parcel/runtime-js/lib/runtime-91916a44e9213781.js","src/app/fonts/fonts.ts","node_modules/@parcel/runtime-js/lib/runtime-416468c8ae4fd4e3.js","node_modules/@parcel/runtime-js/lib/runtime-e44dcf04ed9c9f55.js","node_modules/@parcel/runtime-js/lib/runtime-ac555ca2118d1c7b.js","node_modules/@parcel/runtime-js/lib/runtime-a51a6f4c8f5a68b6.js","node_modules/@parcel/runtime-js/lib/runtime-d6e1064a92ba2ec0.js","node_modules/@parcel/runtime-js/lib/runtime-e07889c2deb4201e.js","node_modules/@parcel/runtime-js/lib/runtime-64942f4184da01d8.js","node_modules/@parcel/runtime-js/lib/runtime-2fc4fc5b967eabe1.js","node_modules/@parcel/runtime-js/lib/runtime-1b1397ee894257ac.js","node_modules/@parcel/runtime-js/lib/runtime-2bb767bac2a4fc61.js","node_modules/@parcel/runtime-js/lib/runtime-36e9cc16255d419c.js","node_modules/@parcel/runtime-js/lib/runtime-60a432e29517223e.js","node_modules/@parcel/runtime-js/lib/runtime-62d4ec40bbbe08d9.js","node_modules/@parcel/runtime-js/lib/runtime-2c495e63deaf7209.js","node_modules/@parcel/runtime-js/lib/runtime-973d2c294bb61bea.js","node_modules/@parcel/runtime-js/lib/runtime-4897f7a785ce37ce.js","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-stroke-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-text-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-viewport-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-dialog.module.scss","node_modules/@emotion/css/dist/emotion-css.esm.js","node_modules/@emotion/css/create-instance/dist/emotion-css-create-instance.esm.js","node_modules/@emotion/cache/dist/emotion-cache.browser.esm.js","node_modules/@emotion/sheet/dist/emotion-sheet.browser.esm.js","node_modules/stylis/dist/stylis.mjs","node_modules/stylis/src/Enum.js","node_modules/stylis/src/Utility.js","node_modules/stylis/src/Tokenizer.js","node_modules/stylis/src/Parser.js","node_modules/stylis/src/Prefixer.js","node_modules/stylis/src/Serializer.js","node_modules/stylis/src/Middleware.js","node_modules/@emotion/weak-memoize/dist/emotion-weak-memoize.esm.js","node_modules/@emotion/memoize/dist/emotion-memoize.esm.js","node_modules/@emotion/serialize/dist/emotion-serialize.browser.esm.js","node_modules/@emotion/hash/dist/emotion-hash.esm.js","node_modules/@emotion/unitless/dist/emotion-unitless.esm.js","node_modules/@emotion/utils/dist/emotion-utils.browser.esm.js","src/app/script/klecks/ui/modals/show-import-image-dialog.ts","src/app/script/klecks/storage/psd.ts","src/app/script/klecks/storage/indexed-db.ts","src/app/script/klecks/filters/filters.ts","node_modules/@parcel/runtime-js/lib/runtime-acf4a19a71cb937a.js","node_modules/@parcel/runtime-js/lib/runtime-d67887a6c0fb147f.js","node_modules/@parcel/runtime-js/lib/runtime-1951d0f45b837ff9.js","node_modules/@parcel/runtime-js/lib/runtime-bb176b3b6425aaaa.js","node_modules/@parcel/runtime-js/lib/runtime-dbc18e2745ca65c5.js","node_modules/@parcel/runtime-js/lib/runtime-80911ed486f33545.js","node_modules/@parcel/runtime-js/lib/runtime-eead2608d2fa5bd2.js","node_modules/@parcel/runtime-js/lib/runtime-9a1e033a88e16096.js","node_modules/@parcel/runtime-js/lib/runtime-c9bd458795fed0ba.js","node_modules/@parcel/runtime-js/lib/runtime-5626aa10019711dd.js","node_modules/@parcel/runtime-js/lib/runtime-2044b7aa526106e6.js","node_modules/@parcel/runtime-js/lib/runtime-21795bc53efbcb17.js","node_modules/@parcel/runtime-js/lib/runtime-d5912d6d1ba72424.js","node_modules/@parcel/runtime-js/lib/runtime-d72562b990dee7d8.js","node_modules/@parcel/runtime-js/lib/runtime-0b2b4c30952b5c7d.js","node_modules/@parcel/runtime-js/lib/runtime-64c83be280987e8f.js","node_modules/@parcel/runtime-js/lib/runtime-ca97bf89fb66f180.js","node_modules/@parcel/runtime-js/lib/runtime-9fe1796050e673a2.js","src/app/script/klecks/brushes/brushes.ts","src/app/script/klecks/brushes/pen-brush.ts","src/app/script/klecks/brushes/brushes-common.ts","src/app/script/klecks/brushes/alphas/brush-alphas.ts","src/app/script/bb/math/perlin.ts","src/app/script/klecks/brushes/blend-brush.ts","src/app/script/klecks/brushes/sketchy-brush.ts","src/app/script/klecks/brushes/pixel-brush.ts","src/app/script/klecks/brushes/eraser-brush.ts","src/app/script/klecks/brushes/smudge-brush.ts","src/app/script/klecks/brushes/chemy-brush.ts","src/app/script/klecks/brushes-ui/brushes-ui.ts","src/app/script/klecks/brushes-ui/pen-brush-ui.ts","src/app/script/klecks/brushes-ui/brushes-consts.ts","node_modules/@parcel/runtime-js/lib/runtime-317d41dd30e22153.js","src/app/script/klecks/brushes-ui/blend-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-fb4dfe91dd51f3ab.js","src/app/script/klecks/brushes-ui/sketchy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-9c55c239f6725590.js","src/app/script/klecks/brushes-ui/pixel-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-7deb3a76132d4783.js","src/app/script/klecks/brushes-ui/eraser-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-64ee3a6e15622cad.js","src/app/script/klecks/brushes-ui/smudge-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-69a46bfcd4b52be6.js","src/app/script/klecks/brushes-ui/chemy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-67968a5afa6a1356.js","src/app/script/klecks/ui/modals/show-iframe-modal.ts","src/app/script/klecks/ui/components/radio-list.ts","src/app/script/klecks/ui/components/browser-storage-ui.ts","src/app/script/klecks/storage/project-store.ts","src/app/script/klecks/storage/project-converter.ts","src/app/script/klecks/storage/base-64-to-blob.ts","src/app/script/klecks/ui/tool-tabs/file-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-237dc2978439233a.js","src/app/script/klecks/ui/tool-tabs/filter-tab.ts","src/app/script/fx-canvas/shared-fx.ts","src/app/script/fx-canvas/fx-canvas.ts","src/app/script/fx-canvas/filters/brightness-contrast.ts","src/app/script/fx-canvas/core/simple-shader.ts","src/app/script/fx-canvas/core/fx-shader.ts","src/app/script/fx-canvas/core/gl.ts","src/app/script/fx-canvas/core/fx-texture.ts","src/app/script/fx-canvas/filters/curves.ts","src/app/script/fx-canvas/math/spline-interpolate.ts","src/app/script/fx-canvas/filters/hue-saturation.ts","src/app/script/fx-canvas/filters/noise.ts","src/app/script/fx-canvas/shaders/shader-noise.glsl","src/app/script/fx-canvas/filters/triangle-blur.ts","src/app/script/fx-canvas/shaders/random-shader-func.ts","src/app/script/fx-canvas/filters/tilt-shift.ts","src/app/script/fx-canvas/filters/matrix-warp.ts","src/app/script/fx-canvas/shaders/warp-shader.ts","src/app/script/fx-canvas/math/matrix.ts","src/app/script/fx-canvas/filters/unsharp-mask.ts","src/app/script/fx-canvas/filters/to-alpha.ts","src/app/script/fx-canvas/filters/invert.ts","src/app/script/fx-canvas/filters/perspective.ts","src/app/script/fx-canvas/filters/unmultiply-alpha.ts","src/app/script/fx-canvas/filters/distort.ts","src/app/script/fx-canvas/filters/multiply-alpha.ts","src/app/script/klecks/ui/modals/imgur-upload.ts","node_modules/@parcel/runtime-js/lib/runtime-5b3a6227e48c006a.js","src/app/script/klecks/ui/components/save-reminder.ts","src/app/script/klecks/storage/save-to-computer.ts","src/app/script/bb/base/save-as.ts","src/app/script/klecks/history/undo-redo-catchup.ts","src/app/script/klecks/brushes-ui/brush-setting-service.ts","src/app/script/klecks/ui/tool-tabs/settings-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-476b50212be070a0.js","node_modules/@parcel/runtime-js/lib/runtime-f5c56ad551a77e9a.js","src/app/script/klecks/ui/modals/licenses-dialog/show-licenses-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-00f23eb2994daefa.js","node_modules/@parcel/runtime-js/lib/runtime-7ee836d9303d04b8.js","src/app/script/klecks/ui/components/toolspace-scroller.ts","src/app/script/klecks/ui/tool-tabs/gradient-ui.ts","src/app/script/embed/embed-toolspace-top-row.ts","src/app/script/klecks/filters/filters-lazy.ts","src/app/script/klecks/filters/filter-brightness-contrast.ts","src/app/script/klecks/filters/filters-consts.ts","src/app/script/klecks/filters/filter-crop-extend.ts","src/app/script/klecks/filters/filter-curves.ts","src/app/script/klecks/filters/filter-curves/curves-input.ts","src/app/script/klecks/filters/filter-flip.ts","src/app/script/klecks/filters/filter-hue-saturation.ts","src/app/script/klecks/filters/filter-invert.ts","src/app/script/klecks/filters/filter-perspective.ts","src/app/script/klecks/ui/components/two-tabs.ts","src/app/script/klecks/filters/filter-resize.ts","node_modules/@parcel/runtime-js/lib/runtime-cd2cbb52134a8268.js","src/app/script/klecks/filters/filter-rotate.ts","src/app/script/klecks/filters/filter-tilt-shift.ts","src/app/script/klecks/filters/filter-transform.ts","src/app/script/klecks/filters/filter-blur.ts","src/app/script/klecks/filters/filter-unsharp-mask.ts","src/app/script/klecks/filters/filter-to-alpha.ts","src/app/script/klecks/filters/filter-grid.ts","src/app/script/klecks/image-operations/draw-grid.ts","src/app/script/klecks/filters/filter-noise.ts","src/app/script/klecks/filters/filter-pattern.ts","src/app/script/klecks/filters/filter-distort.ts","src/app/script/klecks/filters/filter-vanish-point.ts","src/app/script/klecks/image-operations/draw-vanish-point.ts","src/app/script/klecks/storage/kl-canvas-to-psd-blob.ts","src/app/script/klecks/events/line-smoothing.ts","src/app/script/klecks/events/line-sanitizer.ts","src/app/script/klecks/utils/translate-smoothing.ts","src/app/script/app/import-handler.ts","node_modules/@parcel/runtime-js/lib/runtime-6ea03b887069337c.js","node_modules/@parcel/runtime-js/lib/runtime-a1a8750389ec178d.js","src/app/script/app/console-api.ts"],"sourcesContent":["(function () {\nfunction $parcel$export(e, n, v, s) {\n  Object.defineProperty(e, n, {get: v, set: s, enumerable: true, configurable: true});\n}\nfunction $parcel$interopDefault(a) {\n  return a && a.__esModule ? a.default : a;\n}\nvar $parcel$global =\ntypeof globalThis !== 'undefined'\n  ? globalThis\n  : typeof self !== 'undefined'\n  ? self\n  : typeof window !== 'undefined'\n  ? window\n  : typeof global !== 'undefined'\n  ? global\n  : {};\nvar parcelRequire = $parcel$global[\"parcelRequire94c2\"];\nparcelRequire.register(\"6NgYC\", function(module, exports) {\n\n$parcel$export(module.exports, \"Embed\", function () { return $d2fa9a947070c225$export$a84540bc8b694b2d; });\n\nvar $1LaJZ = parcelRequire(\"1LaJZ\");\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $2gUX3 = parcelRequire(\"2gUX3\");\nparcelRequire(\"15wZT\");\n\nvar $3C7jC = parcelRequire(\"3C7jC\");\n\nvar $5ngYX = parcelRequire(\"5ngYX\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $941rU = parcelRequire(\"941rU\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $iVf04 = parcelRequire(\"iVf04\");\n\nvar $hAS38 = parcelRequire(\"hAS38\");\nvar $d2fa9a947070c225$export$a84540bc8b694b2d = /*#__PURE__*/ function() {\n    \"use strict\";\n    function Embed(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, Embed);\n        this.p = p;\n        this.isInitialized = false;\n        this.psdQueue = [];\n        this.openProject = function(project) {\n            _this.onProjectReady(project);\n        };\n        this.loadingScreenEl = document.getElementById(\"loading-screen\");\n        this.loadingScreenTextEl = document.getElementById(\"loading-screen-text\");\n        if (this.loadingScreenTextEl) this.loadingScreenTextEl.textContent = (0, $1mH1z.LANG)(\"embed-init-waiting\");\n        if (p.disableAutoFit) (0, $hAS38.klConfig).disableAutoFit = true;\n        if (p.project) this.onProjectReady(p.project);\n    }\n    (0, $7h4XF._)(Embed, [\n        {\n            key: \"onProjectReady\",\n            value: function onProjectReady(project) {\n                var _this = this;\n                try {\n                    if (this.isInitialized) throw new Error(\"Already called openProject\");\n                    this.isInitialized = true;\n                    var saveReminder = new (0, $5ngYX.SaveReminder)((0, $gWfkn.klHistory), false, false, function() {}, function() {\n                        return _this.klApp ? _this.klApp.isDrawing() : false;\n                    }, null, null);\n                    this.klApp = new (0, $3C7jC.KlApp)(project, {\n                        saveReminder: saveReminder,\n                        bottomBar: this.p.bottomBar,\n                        aboutEl: this.p.aboutEl,\n                        embed: {\n                            url: this.p.embedUrl,\n                            onSubmit: this.p.onSubmit\n                        }\n                    });\n                    saveReminder.init();\n                    this.loadingScreenEl && this.loadingScreenEl.remove();\n                    this.loadingScreenEl = null;\n                    this.loadingScreenTextEl = null;\n                    document.body.append(this.klApp.getEl());\n                } catch (e) {\n                    if (this.loadingScreenTextEl) this.loadingScreenTextEl.textContent = \" \" + e;\n                    if (this.loadingScreenEl) this.loadingScreenEl.className += \"loading-screen-error\";\n                    console.error(e);\n                }\n            }\n        },\n        {\n            key: \"initError\",\n            value: function initError(error) {\n                if (this.loadingScreenTextEl) this.loadingScreenTextEl.textContent = \" \" + error;\n                if (this.loadingScreenEl) this.loadingScreenEl.className += \"loading-screen-error\";\n            }\n        },\n        {\n            key: \"getPNG\",\n            value: function getPNG() {\n                if (!this.klApp) throw new Error(\"App not initialized\");\n                return this.klApp.getPNG();\n            }\n        },\n        {\n            key: \"getPSD\",\n            value: function getPSD() {\n                var _this = this;\n                return (0, $1LaJZ._)(function() {\n                    return (0, $2gUX3.__generator)(this, function(_state) {\n                        switch(_state.label){\n                            case 0:\n                                if (!_this.klApp) throw new Error(\"App not initialized\");\n                                return [\n                                    4,\n                                    _this.klApp.getPSD()\n                                ];\n                            case 1:\n                                return [\n                                    2,\n                                    _state.sent()\n                                ];\n                        }\n                    });\n                })();\n            }\n        },\n        {\n            key: \"readPSDs\",\n            value: function readPSDs(psds) {\n                var _this = this;\n                if (psds.length === 0) return;\n                var readItem = function(item) {\n                    try {\n                        var psd = _this.agPsd.readPsd(item.blob);\n                        var project = (0, $941rU.klPsdToKlProject)((0, $941rU.readPsd)(psd));\n                        item.callback(project);\n                    } catch (e) {\n                        console.error(\"failed to read psd\", e);\n                        item.callback(null);\n                    }\n                };\n                // library not loaded yet\n                if (!this.agPsd) {\n                    var _this1 = this;\n                    if (this.psdQueue.length === 0) // load ag-psd\n                    (0, $1LaJZ._)(function() {\n                        var e;\n                        return (0, $2gUX3.__generator)(this, function(_state) {\n                            switch(_state.label){\n                                case 0:\n                                    _state.trys.push([\n                                        0,\n                                        2,\n                                        ,\n                                        3\n                                    ]);\n                                    return [\n                                        4,\n                                        (0, $iVf04.loadAgPsd)()\n                                    ];\n                                case 1:\n                                    _this1.agPsd = _state.sent();\n                                    return [\n                                        3,\n                                        3\n                                    ];\n                                case 2:\n                                    e = _state.sent();\n                                    _this1.agPsd = \"error\";\n                                    return [\n                                        3,\n                                        3\n                                    ];\n                                case 3:\n                                    while(_this1.psdQueue.length)readItem(_this1.psdQueue.shift());\n                                    return [\n                                        2\n                                    ];\n                            }\n                        });\n                    })();\n                    psds.forEach(function(item) {\n                        _this.psdQueue.push(item);\n                    });\n                } else psds.forEach(readItem);\n            }\n        }\n    ]);\n    return Embed;\n}();\n\n});\nparcelRequire.register(\"15wZT\", function(module, exports) {\n\nvar $8N5YG = parcelRequire(\"8N5YG\");\nparcelRequire(\"k3KW8\");\n/*\r\n * ---- Below ----------------------\r\n * features that didn't have support until *after* browsers supported the modules script tag:\r\n * Chrome 61\r\n * Edge 16\r\n * Safari 11\r\n * Firefox 60\r\n * https://caniuse.com/es6-module\r\n */ // chrome 61, edge 79, safari 16, firefox 107\nif (!(\"scrollTo\" in Element.prototype)) Object.defineProperty(Element.prototype, \"scrollTo\", {\n    value: function value(x, y) {\n        this.scrollLeft = x;\n        this.scrollTop = y;\n    }\n});\n// chrome 61, edge 79, safari 16, firefox 107\nif (!(\"scrollBy\" in Element.prototype)) Object.defineProperty(Element.prototype, \"scrollBy\", {\n    value: function value(x, y) {\n        this.scrollLeft += x;\n        this.scrollTop += y;\n    }\n});\n// chrome 69, edge 79, safari 12, firefox 62\nif (!Array.prototype.flat) Object.defineProperty(Array.prototype, \"flat\", {\n    configurable: true,\n    value: function flat() {\n        for(var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++){\n            args[_key] = arguments[_key];\n        }\n        var depth = isNaN(args[0]) ? 1 : Number(args[0]);\n        return depth ? Array.prototype.reduce.call(this, function(acc, cur) {\n            if (Array.isArray(cur)) // eslint-disable-next-line prefer-spread\n            acc.push.apply(acc, flat.call(cur, depth - 1));\n            else acc.push(cur);\n            return acc;\n        }, []) : Array.prototype.slice.call(this);\n    },\n    writable: true\n});\n// Chrome 85, Firefox 77, Safari 13.1\n// if there are problems, maybe use core-js\nif (!String.prototype.replaceAll) Object.defineProperty(String.prototype, \"replaceAll\", {\n    value: function value(searchValue, replaceValue) {\n        if (typeof replaceValue === \"function\") throw new Error(\"replaceAll polyfill does not support replaceValue: function\");\n        return this.replace(new RegExp(searchValue, \"g\"), replaceValue);\n    }\n});\n/*\r\n    Copyright 2018  Alfredo Mungo <alfredo.mungo@protonmail.ch>\r\n\r\n    Permission is hereby granted, free of charge, to any person obtaining a copy\r\n    of this software and associated documentation files (the \"Software\"), to\r\n    deal in the Software without restriction, including without limitation the\r\n    rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n    sell copies of the Software, and to permit persons to whom the Software is\r\n    furnished to do so, subject to the following conditions:\r\n\r\n    The above copyright notice and this permission notice shall be included in\r\n    all copies or substantial portions of the Software.\r\n\r\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\r\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n    IN THE SOFTWARE.\r\n*/ if (!Object.fromEntries) Object.defineProperty(Object, \"fromEntries\", {\n    value: function(entries) {\n        if (!entries || !entries[Symbol.iterator]) throw new Error(\"Object.fromEntries() requires a single iterable argument\");\n        var o = {};\n        Object.keys(entries).forEach(function(key) {\n            var _entries_key = (0, $8N5YG._)(entries[key], 2), k = _entries_key[0], v = _entries_key[1];\n            o[k] = v;\n        });\n        return o;\n    }\n});\n// sometimes Android WebView has no localStorage\nif (!(\"localStorage\" in window)) try {\n    window.localStorage = {\n        getItem: function() {\n            return null;\n        },\n        setItem: function() {},\n        removeItem: function() {}\n    };\n} catch (e) {\n// maybe it fails?\n}\n\n});\nparcelRequire.register(\"k3KW8\", function(module, exports) {\n/**\r\n * features that were available before module script tags:\r\n * chrome 61\r\n * edge 16\r\n * safari 11\r\n * firefox 60\r\n * https://caniuse.com/es6-module\r\n */ parcelRequire(\"5dg4B\");\nparcelRequire(\"izcMZ\");\nparcelRequire(\"iD0Yt\");\nparcelRequire(\"fIU0v\");\n\n});\nparcelRequire.register(\"5dg4B\", function(module, exports) {\n!function() {\n    var t = function t() {\n        var e = Array.prototype.slice.call(arguments), n = document.createDocumentFragment();\n        e.forEach(function(e) {\n            var t = e instanceof Node;\n            n.appendChild(t ? e : document.createTextNode(String(e)));\n        }), this.appendChild(n);\n    };\n    [\n        Element.prototype,\n        Document.prototype,\n        DocumentFragment.prototype\n    ].forEach(function(e) {\n        e.hasOwnProperty(\"append\") || Object.defineProperty(e, \"append\", {\n            configurable: !0,\n            enumerable: !0,\n            writable: !0,\n            value: t\n        });\n    });\n}();\n\n});\n\nparcelRequire.register(\"izcMZ\", function(module, exports) {\n!function() {\n    var t = function t() {\n        var e = Array.prototype.slice.call(arguments), n = document.createDocumentFragment();\n        e.forEach(function(e) {\n            var t = e instanceof Node;\n            n.appendChild(t ? e : document.createTextNode(String(e)));\n        }), this.insertBefore(n, this.firstChild);\n    };\n    [\n        Element.prototype,\n        Document.prototype,\n        DocumentFragment.prototype\n    ].forEach(function(e) {\n        e.hasOwnProperty(\"prepend\") || Object.defineProperty(e, \"prepend\", {\n            configurable: !0,\n            enumerable: !0,\n            writable: !0,\n            value: t\n        });\n    });\n}();\n\n});\n\nparcelRequire.register(\"iD0Yt\", function(module, exports) {\nString.prototype.padStart || (String.prototype.padStart = function(t, n) {\n    return t >>= 0, n = String(n || \" \"), this.length > t ? String(this) : ((t -= this.length) > n.length && (n += n.repeat(t / n.length)), n.slice(0, t) + String(this));\n});\n\n});\n\nparcelRequire.register(\"fIU0v\", function(module, exports) {\nArray.prototype.findIndex || Object.defineProperty(Array.prototype, \"findIndex\", {\n    value: function value(r) {\n        if (null == this) throw new TypeError('\"this\" is null or not defined');\n        var e = Object(this), t = e.length >>> 0;\n        if (\"function\" != typeof r) throw new TypeError(\"predicate must be a function\");\n        for(var n = arguments[1], o = 0; o < t;){\n            var i = e[o];\n            if (r.call(n, i, o, e)) return o;\n            o++;\n        }\n        return -1;\n    }\n});\n\n});\n\n\n\nparcelRequire.register(\"3C7jC\", function(module, exports) {\n\n$parcel$export(module.exports, \"KlApp\", function () { return $cf5d938ee512ebca$export$96f6458b62e4c2c; });\n\nvar $1LaJZ = parcelRequire(\"1LaJZ\");\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $cL71g = parcelRequire(\"cL71g\");\n\nvar $4EWN2 = parcelRequire(\"4EWN2\");\n\nvar $8N5YG = parcelRequire(\"8N5YG\");\n\nvar $bX4ja = parcelRequire(\"bX4ja\");\n\nvar $2gUX3 = parcelRequire(\"2gUX3\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $h62LS = parcelRequire(\"h62LS\");\n\nvar $jmL5A = parcelRequire(\"jmL5A\");\n\nvar $iUR3L = parcelRequire(\"iUR3L\");\n\nvar $2wCWz = parcelRequire(\"2wCWz\");\n\nvar $3WOmu = parcelRequire(\"3WOmu\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $6l0gQ = parcelRequire(\"6l0gQ\");\n\nvar $iuTWx = parcelRequire(\"iuTWx\");\n\nvar $57YJz = parcelRequire(\"57YJz\");\n\nvar $aId1u = parcelRequire(\"aId1u\");\n\nvar $iG6pP = parcelRequire(\"iG6pP\");\n\nvar $8dsYZ = parcelRequire(\"8dsYZ\");\n\nvar $4sBxW = parcelRequire(\"4sBxW\");\n\nvar $6iPxE = parcelRequire(\"6iPxE\");\n\nvar $fZtJh = parcelRequire(\"fZtJh\");\n\nvar $eOZOu = parcelRequire(\"eOZOu\");\n\nvar $haxur = parcelRequire(\"haxur\");\n\nvar $fX22P = parcelRequire(\"fX22P\");\n\nvar $i7SrA = parcelRequire(\"i7SrA\");\n\nvar $qur3y = parcelRequire(\"qur3y\");\n\nvar $fohxs = parcelRequire(\"fohxs\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\n\nvar $hAS38 = parcelRequire(\"hAS38\");\n(0, $iUR3L.importFilters)();\nvar $cf5d938ee512ebca$export$96f6458b62e4c2c = /*#__PURE__*/ function() {\n    \"use strict\";\n    function KlApp(pProject, pOptions) {\n        var _this = this;\n        (0, $cx0mh._)(this, KlApp);\n        this.collapseThreshold = 820;\n        this.toolWidth = 271;\n        var _this1 = this;\n        this.getPSD = /*#__PURE__*/ (0, $1LaJZ._)(function() {\n            return (0, $2gUX3.__generator)(this, function(_state) {\n                switch(_state.label){\n                    case 0:\n                        return [\n                            4,\n                            (0, $3WOmu.klCanvasToPsdBlob)(_this1.klCanvas)\n                        ];\n                    case 1:\n                        return [\n                            2,\n                            _state.sent()\n                        ];\n                }\n            });\n        });\n        this.embed = pOptions.embed;\n        // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\n        // but not larger than 4096 - a fairly arbitrary decision\n        var klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\n        this.uiState = this.embed ? \"left\" : (0, $6l0gQ.LocalStorage).getItem(\"uiState\") ? (0, $6l0gQ.LocalStorage).getItem(\"uiState\") : \"right\";\n        var projectStore = pOptions.projectStore;\n        this.klRootEl = (0, $eWjiX.BB).el({\n            className: \"g-root\",\n            css: {\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\",\n                right: \"0\",\n                bottom: \"0\"\n            }\n        });\n        this.uiWidth = Math.max(0, window.innerWidth);\n        this.uiHeight = Math.max(0, window.innerHeight);\n        var exportType = \"png\";\n        this.klCanvas = new (0, $hrnUX.KL).KlCanvas(pProject ? {\n            projectObj: pProject\n        } : {\n            width: Math.max(10, Math.min(klMaxCanvasSize, window.innerWidth < this.collapseThreshold ? this.uiWidth : this.uiWidth - this.toolWidth)),\n            height: Math.max(10, Math.min(klMaxCanvasSize, this.uiHeight))\n        }, this.embed ? -1 : 0);\n        this.klCanvas.setHistory((0, $gWfkn.klHistory));\n        var initState;\n        var mainTabRow = undefined;\n        if (!pOptions.saveReminder) pOptions.saveReminder = {\n            init: function() {},\n            reset: function() {}\n        };\n        if (pProject) {\n            // attempt at freeing memory\n            pProject.layers.forEach(function(layer) {\n                layer.image = null;\n            });\n            pProject = null;\n        } else {\n            (0, $gWfkn.klHistory).pause(true);\n            this.klCanvas.addLayer();\n            this.klCanvas.layerFill(0, {\n                r: (0, $fohxs.ERASE_COLOR),\n                g: (0, $fohxs.ERASE_COLOR),\n                b: (0, $fohxs.ERASE_COLOR)\n            });\n            (0, $gWfkn.klHistory).pause(false);\n        }\n        try {\n            initState = {\n                canvas: new (0, $hrnUX.KL).KlCanvas({\n                    copy: this.klCanvas\n                }, this.embed ? -1 : 0),\n                focus: this.klCanvas.getLayerCount() - 1,\n                brushes: {}\n            };\n        } catch (e) {\n            if (e.message === \"kl-create-canvas-error\") this.klCanvas.destroy();\n            throw e;\n        }\n        Object.entries((0, $hrnUX.KL).brushes).forEach(function(param) {\n            var _param = (0, $8N5YG._)(param, 2), b = _param[0], Brush = _param[1];\n            initState.brushes[b] = new Brush();\n            if (initState.canvas) initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\n        });\n        var currentColor = new (0, $eWjiX.BB).RGB(0, 0, 0);\n        var currentBrushUi; // todo\n        var currentBrushId;\n        var lastNonEraserBrushId;\n        var currentLayerCtx = (0, $7jh4K.throwIfNull)(this.klCanvas.getLayerContext(this.klCanvas.getLayerCount() - 1));\n        // when cycling through brushes you need to know the next non-eraser brush\n        var getNextBrushId = function() {\n            if (currentBrushId === \"eraserBrush\") return lastNonEraserBrushId;\n            var keyArr = Object.keys(brushUiMap).filter(function(item) {\n                return item !== \"eraserBrush\";\n            });\n            var i = keyArr.findIndex(function(item) {\n                return item === currentBrushId;\n            });\n            return keyArr[(i + 1) % keyArr.length];\n        };\n        var sizeWatcher = function(val) {\n            brushSettingService.emitSize(val);\n            if (_this.klCanvasWorkspace) _this.klCanvasWorkspace.setCursorSize(val * 2);\n        };\n        var brushSettingService = new (0, $hrnUX.KL).BrushSettingService(function(color) {\n            _this.klColorSlider.setColor(color);\n            currentBrushUi.setColor(color);\n            currentColor = (0, $eWjiX.BB).copyObj(color);\n        }, function(size) {\n            currentBrushUi.setSize(size);\n            _this.klCanvasWorkspace.setCursorSize(size * 2);\n        }, function(opacity) {\n            currentBrushUi.setOpacity(opacity);\n        }, function() {\n            return _this.klColorSlider.getColor();\n        }, function() {\n            return brushUiMap[currentBrushId].getSize();\n        }, function() {\n            return brushUiMap[currentBrushId].getOpacity();\n        }, function() {\n            return {\n                sizeSlider: (0, $hrnUX.KL).brushesUI[currentBrushId].sizeSlider,\n                opacitySlider: (0, $hrnUX.KL).brushesUI[currentBrushId].opacitySlider\n            };\n        });\n        var lineSmoothing = new (0, $iuTWx.LineSmoothing)({\n            smoothing: (0, $aId1u.translateSmoothing)(1)\n        });\n        this.lineSanitizer = new (0, $57YJz.LineSanitizer)();\n        var drawEventChain = new (0, $eWjiX.BB).EventChain({\n            chainArr: [\n                this.lineSanitizer,\n                lineSmoothing\n            ]\n        });\n        drawEventChain.setChainOut(function(event) {\n            if (event.type === \"down\") {\n                _this.toolspace.style.pointerEvents = \"none\";\n                currentBrushUi.startLine(event.x, event.y, event.pressure);\n                _this.klCanvasWorkspace.requestFrame();\n            }\n            if (event.type === \"move\") {\n                currentBrushUi.goLine(event.x, event.y, event.pressure, false, event.isCoalesced);\n                _this.klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\n                _this.klCanvasWorkspace.requestFrame();\n            }\n            if (event.type === \"up\") {\n                _this.toolspace.style.pointerEvents = \"\";\n                currentBrushUi.endLine();\n                _this.klCanvasWorkspace.requestFrame();\n            }\n            if (event.type === \"line\") {\n                currentBrushUi.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\n                _this.klCanvasWorkspace.requestFrame();\n            }\n        });\n        var textToolSettings = {\n            size: 20,\n            align: \"left\",\n            isBold: false,\n            isItalic: false,\n            font: \"sans-serif\",\n            letterSpacing: 0,\n            lineHeight: 1,\n            fill: {\n                color: {\n                    r: 0,\n                    g: 0,\n                    b: 0,\n                    a: 1\n                }\n            }\n        };\n        this.klCanvasWorkspace = new (0, $hrnUX.KL).KlCanvasWorkspace({\n            klCanvas: this.klCanvas,\n            width: Math.max(0, this.uiWidth - this.toolWidth),\n            height: this.uiHeight,\n            onDraw: function(e) {\n                return drawEventChain.chainIn(e);\n            },\n            onPick: function(rgbObj, isDragDone) {\n                brushSettingService.setColor(rgbObj);\n                if (isDragDone) {\n                    _this.klColorSlider.pickingDone();\n                    _this.klCanvasWorkspace.setMode(_this.toolspaceToolRow.getActive());\n                }\n            },\n            onFill: function(canvasX, canvasY) {\n                var layerIndex = (0, $7jh4K.throwIfNull)(_this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                _this.klCanvas.floodFill(layerIndex, canvasX, canvasY, fillUi.getIsEraser() ? null : _this.klColorSlider.getColor(), fillUi.getOpacity(), fillUi.getTolerance(), fillUi.getSample(), fillUi.getGrow(), fillUi.getContiguous());\n                _this.klCanvasWorkspace.requestFrame();\n            },\n            onGradient: function(typeStr, canvasX, canvasY, angleRad) {\n                if (typeStr === \"down\") gradientTool.onDown(canvasX, canvasY, angleRad);\n                if (typeStr === \"move\") gradientTool.onMove(canvasX, canvasY);\n                if (typeStr === \"up\") gradientTool.onUp(canvasX, canvasY);\n            },\n            onText: function(canvasX, canvasY, angleRad) {\n                if ((0, $hrnUX.KL).dialogCounter.get() > 0) return;\n                (0, $hrnUX.KL).textToolDialog({\n                    klCanvas: _this.klCanvas,\n                    layerIndex: (0, $7jh4K.throwIfNull)(_this.klCanvas.getLayerIndex(currentLayerCtx.canvas)),\n                    primaryColor: _this.klColorSlider.getColor(),\n                    secondaryColor: _this.klColorSlider.getSecondaryRGB(),\n                    text: (0, $4EWN2._)((0, $cL71g._)({}, textToolSettings), {\n                        text: \"\",\n                        x: canvasX,\n                        y: canvasY,\n                        angleRad: angleRad,\n                        fill: textToolSettings.fill ? {\n                            color: (0, $4EWN2._)((0, $cL71g._)({}, _this.klColorSlider.getColor()), {\n                                a: textToolSettings.fill.color.a\n                            })\n                        } : undefined,\n                        stroke: textToolSettings.stroke ? (0, $4EWN2._)((0, $cL71g._)({}, textToolSettings.stroke), {\n                            color: (0, $4EWN2._)((0, $cL71g._)({}, _this.klColorSlider.getSecondaryRGB()), {\n                                a: textToolSettings.stroke.color.a\n                            })\n                        }) : undefined\n                    }),\n                    onConfirm: function(val) {\n                        textToolSettings = (0, $4EWN2._)((0, $cL71g._)({}, val), {\n                            text: \"\"\n                        });\n                        var layerIndex = (0, $7jh4K.throwIfNull)(_this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                        _this.klCanvas.text(layerIndex, val);\n                        _this.klCanvasWorkspace.requestFrame();\n                    }\n                });\n            },\n            onShape: function(typeStr, canvasX, canvasY, angleRad) {\n                if (typeStr === \"down\") shapeTool.onDown(canvasX, canvasY, angleRad);\n                if (typeStr === \"move\") shapeTool.onMove(canvasX, canvasY);\n                if (typeStr === \"up\") shapeTool.onUp(canvasX, canvasY);\n            },\n            onViewChange: function(viewChangeObj) {\n                if (viewChangeObj.changed.includes(\"scale\")) _this.statusOverlay.out({\n                    type: \"transform\",\n                    scale: viewChangeObj.scale,\n                    angleDeg: viewChangeObj.angle * 180 / Math.PI\n                });\n                _this.toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== _this.klCanvasWorkspace.getMaxScale());\n                _this.toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== _this.klCanvasWorkspace.getMinScale());\n                handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\n            },\n            onUndo: function() {\n                if ((0, $gWfkn.klHistory).canUndo()) {\n                    if (undoRedoCatchup.undo()) _this.statusOverlay.out((0, $1mH1z.LANG)(\"undo\"), true);\n                }\n            },\n            onRedo: function() {\n                if ((0, $gWfkn.klHistory).canRedo()) {\n                    if (undoRedoCatchup.redo()) _this.statusOverlay.out((0, $1mH1z.LANG)(\"redo\"), true);\n                }\n            }\n        });\n        var updateMainTabVisibility = function() {\n            if (!mainTabRow) return;\n            var toolObj = {\n                \"draw\": {},\n                \"hand\": {},\n                \"fill\": {},\n                \"gradient\": {},\n                \"text\": {},\n                \"shape\": {}\n            };\n            var activeStr = _this.toolspaceToolRow.getActive();\n            var oldTabId = mainTabRow.getOpenedTabId();\n            var keysArr = Object.keys(toolObj);\n            for(var i = 0; i < keysArr.length; i++)if (activeStr === keysArr[i]) mainTabRow.setIsVisible(keysArr[i], true);\n            else {\n                mainTabRow.setIsVisible(keysArr[i], false);\n                if (oldTabId === keysArr[i]) mainTabRow.open(activeStr);\n            }\n        };\n        var keyListener = new (0, $eWjiX.BB).KeyListener({\n            onDown: function(keyStr, event, comboStr) {\n                if ((0, $hrnUX.KL).dialogCounter.get() > 0 || (0, $eWjiX.BB).isInputFocused(true)) return;\n                var isDrawing = _this.lineSanitizer.getIsDrawing() || _this.klCanvasWorkspace.getIsDrawing();\n                if (isDrawing) return;\n                if (comboStr === \"plus\") _this.klCanvasWorkspace.zoomByStep(keyListener.isPressed(\"shift\") ? 1 / 8 : 0.5);\n                if (comboStr === \"minus\") _this.klCanvasWorkspace.zoomByStep(keyListener.isPressed(\"shift\") ? -1 / 8 : -0.5);\n                if (comboStr === \"home\") _this.klCanvasWorkspace.fitView(true);\n                if (comboStr === \"end\") _this.klCanvasWorkspace.resetView(true);\n                if ([\n                    \"ctrl+z\",\n                    \"cmd+z\"\n                ].includes(comboStr)) {\n                    event.preventDefault();\n                    undoRedoCatchup.undo();\n                }\n                if ([\n                    \"ctrl+y\",\n                    \"cmd+y\"\n                ].includes(comboStr) || ((0, $eWjiX.BB).sameKeys(\"ctrl+shift+z\", comboStr) || (0, $eWjiX.BB).sameKeys(\"cmd+shift+z\", comboStr)) && keyStr === \"z\") {\n                    event.preventDefault();\n                    undoRedoCatchup.redo();\n                }\n                if (!_this.embed) {\n                    if ([\n                        \"ctrl+s\",\n                        \"cmd+s\"\n                    ].includes(comboStr)) {\n                        event.preventDefault();\n                        _this.saveToComputer.save();\n                    }\n                    if ([\n                        \"ctrl+shift+s\",\n                        \"cmd+shift+s\"\n                    ].includes(comboStr)) {\n                        event.preventDefault();\n                        var _this1 = _this;\n                        (0, $1LaJZ._)(function() {\n                            var success, e;\n                            return (0, $2gUX3.__generator)(this, function(_state) {\n                                switch(_state.label){\n                                    case 0:\n                                        success = true;\n                                        _state.label = 1;\n                                    case 1:\n                                        _state.trys.push([\n                                            1,\n                                            3,\n                                            ,\n                                            4\n                                        ]);\n                                        return [\n                                            4,\n                                            projectStore.store(_this1.klCanvas.getProject())\n                                        ];\n                                    case 2:\n                                        _state.sent();\n                                        return [\n                                            3,\n                                            4\n                                        ];\n                                    case 3:\n                                        e = _state.sent();\n                                        success = false;\n                                        setTimeout(function() {\n                                            throw new Error(\"keyboard-shortcut: failed to store browser storage, \" + e);\n                                        }, 0);\n                                        _this1.statusOverlay.out(\" \" + (0, $1mH1z.LANG)(\"file-storage-failed\"), true);\n                                        return [\n                                            3,\n                                            4\n                                        ];\n                                    case 4:\n                                        if (success) {\n                                            pOptions.saveReminder.reset();\n                                            _this1.statusOverlay.out((0, $1mH1z.LANG)(\"file-storage-stored\"), true);\n                                        }\n                                        return [\n                                            2\n                                        ];\n                                }\n                            });\n                        })();\n                    }\n                    if ([\n                        \"ctrl+c\",\n                        \"cmd+c\"\n                    ].includes(comboStr)) {\n                        event.preventDefault();\n                        copyToClipboard(true);\n                    }\n                }\n                if ([\n                    \"ctrl+a\",\n                    \"cmd+a\"\n                ].includes(comboStr)) event.preventDefault();\n                if (keyListener.comboOnlyContains([\n                    \"left\",\n                    \"right\",\n                    \"up\",\n                    \"down\"\n                ])) {\n                    if (keyStr === \"left\") _this.klCanvasWorkspace.translateView(1, 0);\n                    if (keyStr === \"right\") _this.klCanvasWorkspace.translateView(-1, 0);\n                    if (keyStr === \"up\") _this.klCanvasWorkspace.translateView(0, 1);\n                    if (keyStr === \"down\") _this.klCanvasWorkspace.translateView(0, -1);\n                }\n                if ([\n                    \"r+left\",\n                    \"r+right\"\n                ].includes(comboStr)) {\n                    if (keyStr === \"left\") {\n                        _this.klCanvasWorkspace.setAngle(-15, true);\n                        handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\n                    }\n                    if (keyStr === \"right\") {\n                        _this.klCanvasWorkspace.setAngle(15, true);\n                        handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\n                    }\n                }\n                if ([\n                    \"r+up\"\n                ].includes(comboStr)) {\n                    _this.klCanvasWorkspace.setAngle(0);\n                    handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\n                }\n                if (comboStr === \"sqbr_open\") currentBrushUi.decreaseSize(0.03 / _this.klCanvasWorkspace.getScale());\n                if (comboStr === \"sqbr_close\") currentBrushUi.increaseSize(0.03 / _this.klCanvasWorkspace.getScale());\n                if (comboStr === \"enter\") {\n                    _this.klCanvas.layerFill((0, $7jh4K.throwIfNull)(_this.klCanvas.getLayerIndex(currentLayerCtx.canvas)), _this.klColorSlider.getColor());\n                    _this.statusOverlay.out((0, $1mH1z.LANG)(\"filled\"), true);\n                }\n                if ([\n                    \"delete\",\n                    \"backspace\"\n                ].includes(comboStr)) {\n                    var layerIndex = (0, $7jh4K.throwIfNull)(_this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                    if (layerIndex === 0 && !brushUiMap.eraserBrush.getIsTransparentBg()) _this.klCanvas.layerFill(layerIndex, {\n                        r: 255,\n                        g: 255,\n                        b: 255\n                    }, \"source-in\");\n                    else _this.klCanvas.clearLayer(layerIndex);\n                    _this.statusOverlay.out((0, $1mH1z.LANG)(\"cleared-layer\"), true);\n                }\n                if (comboStr === \"shift+e\") {\n                    event.preventDefault();\n                    currentBrushUi.toggleEraser && currentBrushUi.toggleEraser();\n                } else if (comboStr === \"e\") {\n                    event.preventDefault();\n                    _this.klCanvasWorkspace.setMode(\"draw\");\n                    _this.toolspaceToolRow.setActive(\"draw\");\n                    mainTabRow && mainTabRow.open(\"draw\");\n                    updateMainTabVisibility();\n                    brushTabRow.open(\"eraserBrush\");\n                }\n                if (comboStr === \"b\") {\n                    event.preventDefault();\n                    var prevMode = _this.klCanvasWorkspace.getMode();\n                    _this.klCanvasWorkspace.setMode(\"draw\");\n                    _this.toolspaceToolRow.setActive(\"draw\");\n                    mainTabRow && mainTabRow.open(\"draw\");\n                    updateMainTabVisibility();\n                    brushTabRow.open(prevMode === \"draw\" ? getNextBrushId() : currentBrushId);\n                }\n                if (comboStr === \"g\") {\n                    event.preventDefault();\n                    var newMode = _this.klCanvasWorkspace.getMode() === \"fill\" ? \"gradient\" : \"fill\";\n                    _this.klCanvasWorkspace.setMode(newMode);\n                    _this.toolspaceToolRow.setActive(newMode);\n                    mainTabRow && mainTabRow.open(newMode);\n                    updateMainTabVisibility();\n                }\n                if (comboStr === \"t\") {\n                    event.preventDefault();\n                    _this.klCanvasWorkspace.setMode(\"text\");\n                    _this.toolspaceToolRow.setActive(\"text\");\n                    mainTabRow && mainTabRow.open(\"text\");\n                    updateMainTabVisibility();\n                }\n                if (comboStr === \"u\") {\n                    event.preventDefault();\n                    _this.klCanvasWorkspace.setMode(\"shape\");\n                    _this.toolspaceToolRow.setActive(\"shape\");\n                    mainTabRow && mainTabRow.open(\"shape\");\n                    updateMainTabVisibility();\n                }\n                if (comboStr === \"x\") {\n                    event.preventDefault();\n                    _this.klColorSlider.swapColors();\n                }\n            },\n            onUp: function(keyStr, event) {}\n        });\n        var brushUiMap = {};\n        // create brush UIs\n        Object.entries((0, $hrnUX.KL).brushesUI).forEach(function(param) {\n            var _param = (0, $8N5YG._)(param, 2), b = _param[0], brushUi = _param[1];\n            var ui = new brushUi.Ui({\n                onSizeChange: sizeWatcher,\n                onOpacityChange: function(opacity) {\n                    brushSettingService.emitOpacity(opacity);\n                },\n                onConfigChange: function() {\n                    brushSettingService.emitSliderConfig({\n                        sizeSlider: (0, $hrnUX.KL).brushesUI[currentBrushId].sizeSlider,\n                        opacitySlider: (0, $hrnUX.KL).brushesUI[currentBrushId].opacitySlider\n                    });\n                }\n            });\n            brushUiMap[b] = ui;\n            ui.getElement().style.padding = \"10px\";\n        });\n        this.statusOverlay = new (0, $hrnUX.KL).StatusOverlay();\n        this.toolspace = (0, $eWjiX.BB).el({\n            className: \"kl-toolspace\",\n            css: {\n                position: \"absolute\",\n                right: \"0\",\n                top: \"0\",\n                bottom: \"0\",\n                width: this.toolWidth + \"px\",\n                overflow: \"hidden\",\n                userSelect: \"none\",\n                touchAction: \"none\"\n            }\n        });\n        this.toolspaceInner = (0, $eWjiX.BB).el({\n            parent: this.toolspace\n        });\n        this.toolspace.oncontextmenu = function() {\n            return false;\n        };\n        this.toolspace.onclick = (0, $eWjiX.BB).handleClick;\n        this.toolspaceCollapser = new (0, $hrnUX.KL).ToolspaceCollapser({\n            onChange: function() {\n                _this.updateCollapse();\n            }\n        });\n        this.updateCollapse();\n        var overlayToolspace;\n        setTimeout(function() {\n            overlayToolspace = new (0, $hrnUX.KL).OverlayToolspace({\n                enabledTest: function() {\n                    return (0, $hrnUX.KL).dialogCounter.get() === 0 && !_this.lineSanitizer.getIsDrawing();\n                },\n                brushSettingService: brushSettingService\n            });\n            _this.klRootEl.append(overlayToolspace.getElement());\n        }, 0);\n        (0, $eWjiX.BB).append(this.klRootEl, [\n            this.klCanvasWorkspace.getElement(),\n            this.toolspace,\n            this.toolspaceCollapser.getElement()\n        ]);\n        var toolspaceTopRow;\n        if (this.embed) toolspaceTopRow = new (0, $jmL5A.EmbedToolspaceTopRow)({\n            onHelp: function() {\n                (0, $h62LS.showIframeModal)(_this.embed.url + \"/help.html\", !!_this.embed);\n            },\n            onSubmit: function() {\n                var onFailure = function() {\n                    var closeFunc;\n                    var saveBtn = (0, $eWjiX.BB).el({\n                        tagName: \"button\",\n                        textContent: (0, $1mH1z.LANG)(\"save-reminder-save-psd\"),\n                        css: {\n                            display: \"block\"\n                        }\n                    });\n                    saveBtn.onclick = function() {\n                        _this.saveAsPsd();\n                        closeFunc();\n                    };\n                    (0, $hrnUX.KL).popup({\n                        target: _this.klRootEl,\n                        message: \"<b>\" + (0, $1mH1z.LANG)(\"upload-failed\") + \"</b>\",\n                        div: (0, $eWjiX.BB).el({\n                            content: [\n                                (0, $eWjiX.BB).el({\n                                    content: (0, $1mH1z.LANG)(\"backup-drawing\"),\n                                    css: {\n                                        marginBottom: \"10px\"\n                                    }\n                                }),\n                                saveBtn\n                            ]\n                        }),\n                        ignoreBackground: true,\n                        closeFunc: function(f) {\n                            closeFunc = f;\n                        }\n                    });\n                };\n                var _this1 = _this;\n                (0, $hrnUX.KL).popup({\n                    target: _this.klRootEl,\n                    message: (0, $1mH1z.LANG)(\"submit-prompt\"),\n                    buttons: [\n                        (0, $1mH1z.LANG)(\"submit\"),\n                        \"Cancel\"\n                    ],\n                    callback: function() {\n                        var _ref = (0, $1LaJZ._)(function(result) {\n                            var overlay;\n                            return (0, $2gUX3.__generator)(this, function(_state) {\n                                if (result !== (0, $1mH1z.LANG)(\"submit\")) return [\n                                    2\n                                ];\n                                overlay = (0, $eWjiX.BB).el({\n                                    parent: _this1.klRootEl,\n                                    className: \"upload-overlay\",\n                                    content: '<div class=\"spinner\"></div> ' + (0, $1mH1z.LANG)(\"submit-submitting\")\n                                });\n                                _this1.embed.onSubmit(function() {\n                                    pOptions.saveReminder.reset();\n                                    overlay.remove();\n                                }, function() {\n                                    overlay.remove();\n                                    onFailure();\n                                });\n                                return [\n                                    2\n                                ];\n                            });\n                        });\n                        return function(result) {\n                            return _ref.apply(this, arguments);\n                        };\n                    }()\n                });\n            },\n            onLeftRight: function() {\n                _this.uiState = _this.uiState === \"left\" ? \"right\" : \"left\";\n                _this.updateUi();\n            }\n        });\n        else toolspaceTopRow = new (0, $hrnUX.KL).ToolspaceTopRow({\n            logoImg: pOptions.logoImg,\n            onLogo: function() {\n                (0, $h62LS.showIframeModal)(\"./home/\", !!_this.embed);\n            },\n            onNew: function() {\n                showNewImageDialog();\n            },\n            onImport: function() {\n                fileTab.triggerImport();\n            },\n            onSave: function() {\n                _this.saveToComputer.save();\n            },\n            onShare: function() {\n                shareImage();\n            },\n            onHelp: function() {\n                (0, $h62LS.showIframeModal)(\"./help/\", !!_this.embed);\n            }\n        });\n        toolspaceTopRow.getElement().style.marginBottom = \"10px\";\n        this.toolspaceInner.append(toolspaceTopRow.getElement());\n        this.toolspaceToolRow = new (0, $hrnUX.KL).ToolspaceToolRow({\n            onActivate: function(activeStr) {\n                if (activeStr === \"draw\") _this.klCanvasWorkspace.setMode(\"draw\");\n                else if (activeStr === \"hand\") _this.klCanvasWorkspace.setMode(\"hand\");\n                else if (activeStr === \"fill\") _this.klCanvasWorkspace.setMode(\"fill\");\n                else if (activeStr === \"gradient\") _this.klCanvasWorkspace.setMode(\"gradient\");\n                else if (activeStr === \"text\") _this.klCanvasWorkspace.setMode(\"text\");\n                else if (activeStr === \"shape\") _this.klCanvasWorkspace.setMode(\"shape\");\n                else throw new Error(\"unknown activeStr\");\n                mainTabRow && mainTabRow.open(activeStr);\n                updateMainTabVisibility();\n                _this.klColorSlider.pickingDone();\n            },\n            onZoomIn: function() {\n                _this.klCanvasWorkspace.zoomByStep(keyListener.isPressed(\"shift\") ? 1 / 8 : 0.5);\n            },\n            onZoomOut: function() {\n                _this.klCanvasWorkspace.zoomByStep(keyListener.isPressed(\"shift\") ? -1 / 8 : -0.5);\n            },\n            onUndo: function() {\n                undoRedoCatchup.undo();\n            },\n            onRedo: function() {\n                undoRedoCatchup.redo();\n            }\n        });\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\n        (0, $gWfkn.klHistory).addListener(function() {\n            _this.toolspaceToolRow.setEnableUndo((0, $gWfkn.klHistory).canUndo());\n            _this.toolspaceToolRow.setEnableRedo((0, $gWfkn.klHistory).canRedo());\n        });\n        this.toolspaceInner.append(this.toolspaceToolRow.getElement());\n        var setBrushColor = function(p_color) {\n            currentColor = p_color;\n            currentBrushUi.setColor(p_color);\n            brushSettingService.emitColor(p_color);\n            _this.klColorSlider.pickingDone();\n        };\n        this.klColorSlider = new (0, $hrnUX.KL).KlColorSlider({\n            width: 250,\n            height: 30,\n            svHeight: 100,\n            startValue: new (0, $eWjiX.BB).RGB(0, 0, 0),\n            onPick: setBrushColor\n        });\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\n        this.klColorSlider.setPickCallback(function(doPick) {\n            if (doPick) _this.klCanvasWorkspace.setMode(\"pick\");\n            else {\n                _this.klCanvasWorkspace.setMode(_this.toolspaceToolRow.getActive());\n                updateMainTabVisibility();\n            }\n        });\n        var setCurrentBrush = function(brushId) {\n            if (brushId !== \"eraserBrush\") lastNonEraserBrushId = brushId;\n            if (_this.klColorSlider) {\n                if (brushId === \"eraserBrush\") _this.klColorSlider.enable(false);\n                else _this.klColorSlider.enable(true);\n            }\n            currentBrushId = brushId;\n            currentBrushUi = brushUiMap[brushId];\n            currentBrushUi.setColor(currentColor);\n            currentBrushUi.setContext(currentLayerCtx);\n            _this.klCanvasWorkspace.setMode(\"draw\");\n            _this.toolspaceToolRow.setActive(\"draw\");\n            updateMainTabVisibility();\n        };\n        var setCurrentLayer = function(layer) {\n            currentLayerCtx = layer.context;\n            currentBrushUi.setContext(layer.context);\n            _this.layerPreview.setLayer(layer);\n        };\n        var brushDiv = (0, $eWjiX.BB).el();\n        var colorDiv = (0, $eWjiX.BB).el({\n            css: {\n                margin: \"10px\",\n                display: \"flex\",\n                flexWrap: \"wrap\",\n                justifyContent: \"space-between\",\n                alignItems: \"flex-end\"\n            }\n        });\n        var toolspaceStabilizerRow = new (0, $hrnUX.KL).ToolspaceStabilizerRow({\n            smoothing: 1,\n            onSelect: function(v) {\n                lineSmoothing.setSmoothing((0, $aId1u.translateSmoothing)(v));\n            }\n        });\n        brushDiv.append(colorDiv);\n        (0, $eWjiX.BB).append(colorDiv, [\n            this.klColorSlider.getElement(),\n            this.klColorSlider.getOutputElement(),\n            toolspaceStabilizerRow.getElement()\n        ]);\n        var brushTabRow = new (0, $hrnUX.KL).TabRow({\n            initialId: \"penBrush\",\n            useAccent: true,\n            tabArr: function() {\n                var result = [];\n                var createTab = function(keyStr) {\n                    return {\n                        id: keyStr,\n                        image: (0, $hrnUX.KL).brushesUI[keyStr].image,\n                        title: (0, $hrnUX.KL).brushesUI[keyStr].tooltip,\n                        onOpen: function() {\n                            brushUiMap[keyStr].getElement().style.display = \"block\";\n                            setCurrentBrush(keyStr);\n                            _this.klColorSlider.pickingDone();\n                            brushSettingService.emitSliderConfig({\n                                sizeSlider: (0, $hrnUX.KL).brushesUI[keyStr].sizeSlider,\n                                opacitySlider: (0, $hrnUX.KL).brushesUI[keyStr].opacitySlider\n                            });\n                            sizeWatcher(brushUiMap[keyStr].getSize());\n                            brushSettingService.emitOpacity(brushUiMap[keyStr].getOpacity());\n                        },\n                        onClose: function() {\n                            brushUiMap[keyStr].getElement().style.display = \"none\";\n                        }\n                    };\n                };\n                var keyArr = Object.keys(brushUiMap);\n                for(var i = 0; i < keyArr.length; i++)result.push(createTab(keyArr[i]));\n                return result;\n            }()\n        });\n        (0, $eWjiX.BB).append(brushDiv, [\n            brushTabRow.getElement()\n        ].concat((0, $bX4ja._)(Object.entries((0, $hrnUX.KL).brushesUI).map(function(param) {\n            var _param = (0, $8N5YG._)(param, 1), b = _param[0];\n            return brushUiMap[b].getElement();\n        }))));\n        var handUi = new (0, $hrnUX.KL).HandUi({\n            scale: this.klCanvasWorkspace.getScale(),\n            angleDeg: 0,\n            onReset: function() {\n                _this.klCanvasWorkspace.resetView(true);\n                handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\n            },\n            onFit: function() {\n                _this.klCanvasWorkspace.fitView(true);\n                handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\n            },\n            onAngleChange: function(angleDeg, isRelative) {\n                _this.klCanvasWorkspace.setAngle(angleDeg, isRelative);\n                handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\n            }\n        });\n        var fillUi = new (0, $hrnUX.KL).FillUi({\n            colorSlider: this.klColorSlider\n        });\n        var gradientUi = new (0, $hrnUX.KL).GradientUi({\n            colorSlider: this.klColorSlider\n        });\n        var textUi = new (0, $hrnUX.KL).TextUi({\n            colorSlider: this.klColorSlider\n        });\n        var shapeUi = new (0, $hrnUX.KL).ShapeUi({\n            colorSlider: this.klColorSlider\n        });\n        var gradientTool = new (0, $hrnUX.KL).GradientTool({\n            onGradient: function(isDone, x1, y1, x2, y2, angleRad) {\n                var layerIndex = (0, $7jh4K.throwIfNull)(_this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                var settings = gradientUi.getSettings();\n                var gradientObj = {\n                    type: settings.type,\n                    color1: _this.klColorSlider.getColor(),\n                    isReversed: settings.isReversed,\n                    opacity: settings.opacity,\n                    doLockAlpha: settings.doLockAlpha,\n                    isEraser: settings.isEraser,\n                    doSnap: keyListener.isPressed(\"shift\") || settings.doSnap,\n                    x1: x1,\n                    y1: y1,\n                    x2: x2,\n                    y2: y2,\n                    angleRad: angleRad\n                };\n                if (isDone) {\n                    _this.klCanvas.setComposite(layerIndex, null);\n                    _this.klCanvas.drawGradient(layerIndex, gradientObj);\n                } else _this.klCanvas.setComposite(layerIndex, {\n                    draw: function(ctx) {\n                        (0, $hrnUX.KL).drawGradient(ctx, gradientObj);\n                    }\n                });\n                _this.klCanvasWorkspace.requestFrame();\n            }\n        });\n        var shapeTool = new (0, $hrnUX.KL).ShapeTool({\n            onShape: function(isDone, x1, y1, x2, y2, angleRad) {\n                var layerIndex = (0, $7jh4K.throwIfNull)(_this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                var shapeObj = {\n                    type: shapeUi.getShape(),\n                    x1: x1,\n                    y1: y1,\n                    x2: x2,\n                    y2: y2,\n                    angleRad: angleRad,\n                    isOutwards: shapeUi.getIsOutwards(),\n                    opacity: shapeUi.getOpacity(),\n                    isEraser: shapeUi.getIsEraser(),\n                    doLockAlpha: shapeUi.getDoLockAlpha()\n                };\n                if (shapeUi.getShape() === \"line\") {\n                    shapeObj.strokeRgb = _this.klColorSlider.getColor();\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\n                    shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed(\"shift\");\n                } else {\n                    shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed(\"shift\");\n                    if (shapeUi.getMode() === \"stroke\") {\n                        shapeObj.strokeRgb = _this.klColorSlider.getColor();\n                        shapeObj.lineWidth = shapeUi.getLineWidth();\n                    } else shapeObj.fillRgb = _this.klColorSlider.getColor();\n                }\n                if (isDone) {\n                    _this.klCanvas.setComposite(layerIndex, null);\n                    _this.klCanvas.drawShape(layerIndex, shapeObj);\n                } else _this.klCanvas.setComposite(layerIndex, {\n                    draw: function(ctx) {\n                        (0, $hrnUX.KL).drawShape(ctx, shapeObj);\n                    }\n                });\n                _this.klCanvasWorkspace.requestFrame();\n            }\n        });\n        this.layerManager = new (0, $hrnUX.KL).LayerManager(this.klCanvas, function(val) {\n            setCurrentLayer((0, $7jh4K.throwIfNull)(_this.klCanvas.getLayer(val)));\n            (0, $gWfkn.klHistory).push({\n                tool: [\n                    \"misc\"\n                ],\n                action: \"focusLayer\",\n                params: [\n                    val\n                ]\n            });\n        }, this.klRootEl, this.uiState);\n        this.layerPreview = new (0, $hrnUX.KL).LayerPreview({\n            klRootEl: this.klRootEl,\n            onClick: function() {\n                mainTabRow && mainTabRow.open(\"layers\");\n            },\n            uiState: this.uiState\n        });\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\n        this.layerPreview.setLayer(this.klCanvas.getLayer(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)));\n        var filterTab = new (0, $hrnUX.KL).FilterTab(this.klRootEl, this.klColorSlider, this.layerManager, this.klCanvasWorkspace, handUi, function() {\n            return currentColor;\n        }, function() {\n            return klMaxCanvasSize;\n        }, function() {\n            return _this.klCanvas;\n        }, function() {\n            return currentLayerCtx;\n        }, !!this.embed, this.statusOverlay);\n        var undoRedoCatchup = new (0, $hrnUX.KL).UndoRedoCatchup(brushUiMap, this.layerPreview, this.layerManager, handUi, this.klCanvasWorkspace, function() {\n            if (!initState) throw new Error(\"initState not initialized\");\n            return initState;\n        }, function() {\n            return _this.klCanvas;\n        }, function() {\n            return currentLayerCtx;\n        }, function(ctx) {\n            currentLayerCtx = ctx;\n        }, function() {\n            return currentBrushUi;\n        });\n        (0, $gWfkn.klHistory).addListener(function(p) {\n            undoRedoCatchup.catchup(p);\n        });\n        var showNewImageDialog = function() {\n            (0, $hrnUX.KL).newImageDialog({\n                currentColor: currentColor,\n                secondaryColor: _this.klColorSlider.getSecondaryRGB(),\n                maxCanvasSize: klMaxCanvasSize,\n                canvasWidth: _this.klCanvas.getWidth(),\n                canvasHeight: _this.klCanvas.getHeight(),\n                workspaceWidth: window.innerWidth < _this.collapseThreshold ? _this.uiWidth : _this.uiWidth - _this.toolWidth,\n                workspaceHeight: _this.uiHeight,\n                onConfirm: function(width, height, color) {\n                    _this.klCanvas.reset({\n                        width: width,\n                        height: height,\n                        color: color.a === 1 ? color : undefined\n                    });\n                    _this.layerManager.update(0);\n                    setCurrentLayer((0, $7jh4K.throwIfNull)(_this.klCanvas.getLayer(0)));\n                    _this.klCanvasWorkspace.resetOrFitView();\n                    handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\n                },\n                onCancel: function() {}\n            });\n        };\n        var shareImage = function(callback) {\n            (0, $eWjiX.BB).shareCanvas({\n                canvas: _this.klCanvas.getCompleteCanvas(1),\n                fileName: (0, $eWjiX.BB).getDate() + (0, $hAS38.klConfig).filenameBase + \".png\",\n                title: (0, $eWjiX.BB).getDate() + (0, $hAS38.klConfig).filenameBase + \".png\",\n                callback: callback ? callback : function() {}\n            });\n        };\n        this.saveToComputer = new (0, $hrnUX.KL).SaveToComputer(pOptions.saveReminder, function() {\n            return exportType;\n        }, function() {\n            return _this.klCanvas;\n        });\n        var copyToClipboard = function(showCrop) {\n            (0, $hrnUX.KL).clipboardDialog(_this.klRootEl, _this.klCanvas.getCompleteCanvas(1), function(inputObj) {\n                if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) return;\n                //do a crop\n                (0, $hrnUX.KL).filterLib.cropExtend.apply({\n                    context: currentLayerCtx,\n                    klCanvas: _this.klCanvas,\n                    input: inputObj,\n                    history: (0, $gWfkn.klHistory)\n                });\n                _this.layerManager.update();\n                _this.klCanvasWorkspace.resetOrFitView();\n                handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\n            }, _this.statusOverlay, showCrop || false);\n        };\n        var fileTab = this.embed ? null : new (0, $hrnUX.KL).FileTab(this.klRootEl, projectStore, function() {\n            return _this.klCanvas.getProject();\n        }, exportType, function(type) {\n            exportType = type;\n        }, function(files, optionsStr) {\n            return importHandler.handleFileSelect(files, optionsStr);\n        }, function() {\n            return _this.saveToComputer.save();\n        }, showNewImageDialog, shareImage, function() {\n            (0, $hrnUX.KL).imgurUpload(_this.klCanvas, _this.klRootEl, pOptions.saveReminder, pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : \"\");\n        }, copyToClipboard, pOptions.saveReminder);\n        var settingsTab = new (0, $hrnUX.KL).SettingsTab(function() {\n            _this.uiState = _this.uiState === \"left\" ? \"right\" : \"left\";\n            _this.updateUi();\n            if (!_this.embed) (0, $6l0gQ.LocalStorage).setItem(\"uiState\", _this.uiState);\n        }, pOptions.aboutEl);\n        mainTabRow = new (0, $hrnUX.KL).TabRow({\n            initialId: \"draw\",\n            tabArr: [\n                {\n                    id: \"draw\",\n                    title: (0, $1mH1z.LANG)(\"tool-brush\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($8dsYZ))),\n                    onOpen: function() {\n                        if (currentBrushId === \"eraserBrush\") _this.klColorSlider.enable(false);\n                        (0, $eWjiX.BB).append(colorDiv, [\n                            _this.klColorSlider.getElement(),\n                            _this.klColorSlider.getOutputElement(),\n                            toolspaceStabilizerRow.getElement()\n                        ]);\n                        brushDiv.style.display = \"block\";\n                    },\n                    onClose: function() {\n                        brushDiv.style.display = \"none\";\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                },\n                {\n                    id: \"hand\",\n                    title: (0, $1mH1z.LANG)(\"tool-hand\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($4sBxW))),\n                    isVisible: false,\n                    onOpen: function() {\n                        handUi.setIsVisible(true);\n                    },\n                    onClose: function() {\n                        handUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                },\n                {\n                    id: \"fill\",\n                    title: (0, $1mH1z.LANG)(\"tool-paint-bucket\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($6iPxE))),\n                    isVisible: false,\n                    onOpen: function() {\n                        _this.klColorSlider.enable(true);\n                        fillUi.setIsVisible(true);\n                    },\n                    onClose: function() {\n                        fillUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                },\n                {\n                    id: \"gradient\",\n                    title: (0, $1mH1z.LANG)(\"tool-gradient\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($fZtJh))),\n                    isVisible: false,\n                    onOpen: function() {\n                        _this.klColorSlider.enable(true);\n                        gradientUi.setIsVisible(true);\n                    },\n                    onClose: function() {\n                        gradientUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                },\n                {\n                    id: \"text\",\n                    title: (0, $1mH1z.LANG)(\"tool-text\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($eOZOu))),\n                    isVisible: false,\n                    onOpen: function() {\n                        _this.klColorSlider.enable(true);\n                        textUi.setIsVisible(true);\n                    },\n                    onClose: function() {\n                        textUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                },\n                {\n                    id: \"shape\",\n                    title: (0, $1mH1z.LANG)(\"tool-shape\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($haxur))),\n                    isVisible: false,\n                    onOpen: function() {\n                        _this.klColorSlider.enable(true);\n                        shapeUi.setIsVisible(true);\n                    },\n                    onClose: function() {\n                        shapeUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                },\n                {\n                    id: \"layers\",\n                    title: (0, $1mH1z.LANG)(\"layers\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($i7SrA))),\n                    onOpen: function() {\n                        _this.layerManager.update();\n                        _this.layerManager.getElement().style.display = \"block\";\n                    },\n                    onClose: function() {\n                        _this.layerManager.getElement().style.display = \"none\";\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                },\n                {\n                    id: \"edit\",\n                    label: (0, $1mH1z.LANG)(\"tab-edit\"),\n                    onOpen: function() {\n                        filterTab.show();\n                    },\n                    onClose: function() {\n                        filterTab.hide();\n                    },\n                    css: {\n                        padding: \"0 7px\"\n                    }\n                },\n                {\n                    id: \"file\",\n                    label: (0, $1mH1z.LANG)(\"tab-file\"),\n                    isVisible: !!fileTab,\n                    onOpen: function() {\n                        if (!fileTab) return;\n                        fileTab.getElement().style.display = \"block\";\n                        fileTab.setIsVisible(true);\n                    },\n                    onClose: function() {\n                        if (!fileTab) return;\n                        fileTab.getElement().style.display = \"none\";\n                        fileTab.setIsVisible(false);\n                    },\n                    css: {\n                        padding: \"0 7px\"\n                    }\n                },\n                {\n                    id: \"settings\",\n                    title: (0, $1mH1z.LANG)(\"tab-settings\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($fX22P))),\n                    onOpen: function() {\n                        settingsTab.getElement().style.display = \"block\";\n                    // settingsTab.setIsVisible(true);\n                    },\n                    onClose: function() {\n                        settingsTab.getElement().style.display = \"none\";\n                    // settingsTab.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                }\n            ]\n        });\n        this.bottomBarWrapper = (0, $eWjiX.BB).el({\n            css: {\n                width: \"270px\",\n                position: \"absolute\",\n                bottom: \"0\",\n                left: \"0\"\n            }\n        });\n        if (pOptions.bottomBar) {\n            this.bottomBar = pOptions.bottomBar;\n            this.bottomBarWrapper.append(this.bottomBar);\n            var observer = new MutationObserver(function() {\n                return _this.updateBottomBar();\n            });\n            observer.observe(this.toolspaceInner, {\n                attributes: true,\n                childList: true,\n                subtree: true\n            });\n        }\n        (0, $eWjiX.BB).append(this.toolspaceInner, [\n            this.layerPreview.getElement(),\n            mainTabRow.getElement(),\n            brushDiv,\n            handUi.getElement(),\n            fillUi.getElement(),\n            gradientUi.getElement(),\n            textUi.getElement(),\n            shapeUi.getElement(),\n            this.layerManager.getElement(),\n            filterTab.getElement(),\n            fileTab ? fileTab.getElement() : undefined,\n            settingsTab.getElement(),\n            (0, $eWjiX.BB).el({\n                css: {\n                    height: \"10px\"\n                }\n            }),\n            this.bottomBarWrapper ? this.bottomBarWrapper : undefined\n        ]);\n        this.toolspaceScroller = new (0, $hrnUX.KL).ToolspaceScroller({\n            toolspace: this.toolspace,\n            uiState: this.uiState\n        });\n        if (!this.embed) Object.defineProperty(window, \"KL\", {\n            value: (0, $qur3y.createConsoleApi)({\n                onDraw: function(path) {\n                    if (!path || path.length === 0) return;\n                    path.forEach(function(p, index) {\n                        if (index === 0) currentBrushUi.startLine(p.x, p.y, 1);\n                        else currentBrushUi.goLine(p.x, p.y, 1);\n                    });\n                    currentBrushUi.endLine();\n                    _this.klCanvasWorkspace.requestFrame();\n                }\n            }),\n            writable: false\n        });\n        this.resize(this.uiWidth, this.uiHeight);\n        this.updateUi();\n        var importHandler = new (0, $iG6pP.ImportHandler)({\n            klRootEl: this.klRootEl,\n            klMaxCanvasSize: klMaxCanvasSize,\n            layerManager: this.layerManager,\n            setCurrentLayer: setCurrentLayer,\n            klCanvas: this.klCanvas,\n            klCanvasWorkspace: this.klCanvasWorkspace,\n            handUi: handUi\n        }, {\n            onColor: function(rgb) {\n                return brushSettingService.setColor(rgb);\n            }\n        });\n        if (!this.embed) {\n            new (0, $hrnUX.KL).KlImageDropper({\n                target: document.body,\n                onDrop: function(files, optionStr) {\n                    if ((0, $hrnUX.KL).dialogCounter.get() > 0) return;\n                    importHandler.handleFileSelect(files, optionStr);\n                },\n                enabledTest: function() {\n                    return (0, $hrnUX.KL).dialogCounter.get() === 0;\n                }\n            });\n            window.document.addEventListener(\"paste\", function(e) {\n                return importHandler.onPaste(e);\n            }, false);\n        }\n        {\n            window.addEventListener(\"resize\", function() {\n                _this.resize(window.innerWidth, window.innerHeight);\n            });\n            window.addEventListener(\"orientationchange\", function() {\n                _this.resize(window.innerWidth, window.innerHeight);\n            });\n            // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\n            // Workaround: place a div in the body that fills the window, and use a ResizeObserver\n            var windowResizeWatcher = (0, $eWjiX.BB).el({\n                parent: document.body,\n                css: {\n                    position: \"fixed\",\n                    left: \"0\",\n                    top: \"0\",\n                    right: \"0\",\n                    bottom: \"0\",\n                    pointerEvents: \"none\",\n                    zIndex: \"-1\",\n                    userSelect: \"none\"\n                }\n            });\n            try {\n                // Not all browsers support ResizeObserver. Not critical though.\n                var observer1 = new ResizeObserver(function() {\n                    return _this.resize(window.innerWidth, window.innerHeight);\n                });\n                observer1.observe(windowResizeWatcher);\n            } catch (e) {\n                windowResizeWatcher.remove();\n            }\n            // prevent ctrl scroll -> zooming page\n            this.klRootEl.addEventListener(\"wheel\", function(event) {\n                if (keyListener.isPressed(\"ctrl\")) event.preventDefault();\n            });\n            //maybe prevent zooming on safari mac os - todo still needed?\n            var prevent = function(e) {\n                e.preventDefault();\n            };\n            window.addEventListener(\"gesturestart\", prevent);\n            window.addEventListener(\"gesturechange\", prevent);\n            window.addEventListener(\"gestureend\", prevent);\n        }\n    }\n    (0, $7h4XF._)(KlApp, [\n        {\n            key: \"updateCollapse\",\n            value: function updateCollapse() {\n                //collapser\n                if (this.uiWidth < this.collapseThreshold) {\n                    this.toolspaceCollapser.getElement().style.display = \"block\";\n                    this.toolspaceCollapser.setDirection(this.uiState);\n                    if (this.toolspaceCollapser.isOpen()) {\n                        if (this.uiState === \"left\") {\n                            (0, $eWjiX.BB).css(this.toolspaceCollapser.getElement(), {\n                                left: \"271px\",\n                                right: \"\"\n                            });\n                            (0, $eWjiX.BB).css(this.klCanvasWorkspace.getElement(), {\n                                left: \"271px\"\n                            });\n                        } else {\n                            (0, $eWjiX.BB).css(this.toolspaceCollapser.getElement(), {\n                                left: \"\",\n                                right: \"271px\"\n                            });\n                            (0, $eWjiX.BB).css(this.klCanvasWorkspace.getElement(), {\n                                left: \"0\"\n                            });\n                        }\n                        this.toolspace.style.display = \"block\";\n                        this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\n                        this.statusOverlay.setWide(false);\n                    } else {\n                        if (this.uiState === \"left\") {\n                            (0, $eWjiX.BB).css(this.toolspaceCollapser.getElement(), {\n                                left: \"0\",\n                                right: \"\"\n                            });\n                            (0, $eWjiX.BB).css(this.klCanvasWorkspace.getElement(), {\n                                left: \"0\"\n                            });\n                        } else {\n                            (0, $eWjiX.BB).css(this.toolspaceCollapser.getElement(), {\n                                left: \"\",\n                                right: \"0\"\n                            });\n                            (0, $eWjiX.BB).css(this.klCanvasWorkspace.getElement(), {\n                                left: \"0\"\n                            });\n                        }\n                        this.toolspace.style.display = \"none\";\n                        this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth), this.uiHeight);\n                        this.statusOverlay.setWide(true);\n                    }\n                } else {\n                    this.toolspaceCollapser.getElement().style.display = \"none\";\n                    if (this.uiState === \"left\") (0, $eWjiX.BB).css(this.klCanvasWorkspace.getElement(), {\n                        left: \"271px\"\n                    });\n                    else (0, $eWjiX.BB).css(this.klCanvasWorkspace.getElement(), {\n                        left: \"0\"\n                    });\n                    this.toolspace.style.display = \"block\";\n                    this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\n                    this.statusOverlay.setWide(false);\n                }\n            }\n        },\n        {\n            key: \"updateBottomBar\",\n            value: function updateBottomBar() {\n                if (!this.bottomBar) return;\n                var isVisible = this.toolspaceInner.scrollHeight + 40 < window.innerHeight;\n                this.bottomBarWrapper.style.display = isVisible ? \"\" : \"none\";\n            }\n        },\n        {\n            key: \"updateUi\",\n            value: function updateUi() {\n                this.toolspace.classList.toggle(\"kl-toolspace--left\", this.uiState === \"left\");\n                this.toolspace.classList.toggle(\"kl-toolspace--right\", this.uiState === \"right\");\n                if (this.uiState === \"left\") {\n                    (0, $eWjiX.BB).css(this.toolspace, {\n                        left: \"0\",\n                        right: \"\"\n                    });\n                    (0, $eWjiX.BB).css(this.klCanvasWorkspace.getElement(), {\n                        left: \"271px\"\n                    });\n                } else {\n                    (0, $eWjiX.BB).css(this.toolspace, {\n                        left: \"\",\n                        right: \"0\"\n                    });\n                    (0, $eWjiX.BB).css(this.klCanvasWorkspace.getElement(), {\n                        left: \"0\"\n                    });\n                }\n                this.statusOverlay.setUiState(this.uiState);\n                this.layerPreview.setUiState(this.uiState);\n                this.layerManager.setUiState(this.uiState);\n                this.updateCollapse();\n                this.toolspaceScroller.updateUiState(this.uiState);\n            }\n        },\n        {\n            // -------- interface --------\n            key: \"getEl\",\n            value: function getEl() {\n                return this.klRootEl;\n            }\n        },\n        {\n            key: \"resize\",\n            value: function resize(w, h) {\n                // iPad scrolls down when increasing text zoom\n                if (window.scrollY > 0) window.scrollTo(0, 0);\n                if (this.uiWidth === Math.max(0, w) && this.uiHeight === Math.max(0, h)) return;\n                this.uiWidth = Math.max(0, w);\n                this.uiHeight = Math.max(0, h);\n                this.updateCollapse();\n                this.updateBottomBar();\n                this.layerPreview.setIsVisible(this.uiHeight >= 579);\n                this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\n                this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\n            }\n        },\n        {\n            key: \"out\",\n            value: function out(msg) {\n                this.statusOverlay.out(msg);\n            }\n        },\n        {\n            key: \"getPNG\",\n            value: function getPNG() {\n                return (0, $2wCWz.base64ToBlob)(this.klCanvas.getCompleteCanvas(1).toDataURL(\"image/png\"));\n            }\n        },\n        {\n            key: \"getProject\",\n            value: function getProject() {\n                return this.klCanvas.getProject();\n            }\n        },\n        {\n            key: \"swapUiLeftRight\",\n            value: function swapUiLeftRight() {\n                this.uiState = this.uiState === \"left\" ? \"right\" : \"left\";\n                if (!this.embed) (0, $6l0gQ.LocalStorage).setItem(\"uiState\", this.uiState);\n                this.updateUi();\n            }\n        },\n        {\n            key: \"saveAsPsd\",\n            value: function saveAsPsd() {\n                this.saveToComputer.save(\"psd\");\n            }\n        },\n        {\n            key: \"isDrawing\",\n            value: function isDrawing() {\n                return this.lineSanitizer.getIsDrawing() || this.klCanvasWorkspace.getIsDrawing();\n            }\n        }\n    ]);\n    return KlApp;\n}();\n\n});\nparcelRequire.register(\"bX4ja\", function(module, exports) {\n\n$parcel$export(module.exports, \"_\", function () { return $8b388beb029932dc$export$1b5e630bc3aea29f; });\n\nvar $6KGpL = parcelRequire(\"6KGpL\");\n\nvar $5mm0I = parcelRequire(\"5mm0I\");\n\nvar $kD20o = parcelRequire(\"kD20o\");\n\nvar $kWe4k = parcelRequire(\"kWe4k\");\nfunction $8b388beb029932dc$export$1b5e630bc3aea29f(arr) {\n    return (0, $6KGpL._array_without_holes)(arr) || (0, $5mm0I._iterable_to_array)(arr) || (0, $kWe4k._unsupported_iterable_to_array)(arr) || (0, $kD20o._non_iterable_spread)();\n}\n\n});\nparcelRequire.register(\"6KGpL\", function(module, exports) {\n\n$parcel$export(module.exports, \"_array_without_holes\", function () { return $4ea7f09e3565689e$export$7e0947b5ad3404e2; });\n\nvar $gszWS = parcelRequire(\"gszWS\");\nfunction $4ea7f09e3565689e$export$7e0947b5ad3404e2(arr) {\n    if (Array.isArray(arr)) return (0, $gszWS._array_like_to_array)(arr);\n}\n\n});\n\nparcelRequire.register(\"5mm0I\", function(module, exports) {\n\n$parcel$export(module.exports, \"_iterable_to_array\", function () { return $3e7014a700b6235f$export$1eb58a6e75231000; });\nfunction $3e7014a700b6235f$export$1eb58a6e75231000(iter) {\n    if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\n});\n\nparcelRequire.register(\"kD20o\", function(module, exports) {\n\n$parcel$export(module.exports, \"_non_iterable_spread\", function () { return $f049015e10c27370$export$e6f3c4780d19eb2b; });\nfunction $f049015e10c27370$export$e6f3c4780d19eb2b() {\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\n});\n\n\nparcelRequire.register(\"hrnUX\", function(module, exports) {\n\n$parcel$export(module.exports, \"KL\", function () { return $9cbe98d1fb398012$export$6e4a713ddcda1e5e; });\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $2MaaK = parcelRequire(\"2MaaK\");\n\nvar $dLlkc = parcelRequire(\"dLlkc\");\n\nvar $i8UFO = parcelRequire(\"i8UFO\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $dJPtW = parcelRequire(\"dJPtW\");\n\nvar $eEL9N = parcelRequire(\"eEL9N\");\n\nvar $1kyaA = parcelRequire(\"1kyaA\");\n\nvar $4nUqS = parcelRequire(\"4nUqS\");\n\nvar $lCF5N = parcelRequire(\"lCF5N\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $11glk = parcelRequire(\"11glk\");\n\nvar $lfHl9 = parcelRequire(\"lfHl9\");\n\nvar $fg9Sv = parcelRequire(\"fg9Sv\");\n\nvar $gmji4 = parcelRequire(\"gmji4\");\n\nvar $j5jvd = parcelRequire(\"j5jvd\");\n\nvar $43qNf = parcelRequire(\"43qNf\");\n\nvar $iFIyy = parcelRequire(\"iFIyy\");\n\nvar $bmB93 = parcelRequire(\"bmB93\");\n\nvar $hRdOL = parcelRequire(\"hRdOL\");\n\nvar $isYih = parcelRequire(\"isYih\");\n\nvar $jMW1P = parcelRequire(\"jMW1P\");\n\nvar $7bo3M = parcelRequire(\"7bo3M\");\n\nvar $lV6Vy = parcelRequire(\"lV6Vy\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $cNhNm = parcelRequire(\"cNhNm\");\n\nvar $kEeSq = parcelRequire(\"kEeSq\");\n\nvar $32CBv = parcelRequire(\"32CBv\");\n\nvar $kqmpc = parcelRequire(\"kqmpc\");\n\nvar $8ebuX = parcelRequire(\"8ebuX\");\n\nvar $13r5y = parcelRequire(\"13r5y\");\n\nvar $9p4Zp = parcelRequire(\"9p4Zp\");\n\nvar $8jqzp = parcelRequire(\"8jqzp\");\n\nvar $84zxV = parcelRequire(\"84zxV\");\n\nvar $9Kxky = parcelRequire(\"9Kxky\");\n\nvar $1Ax5m = parcelRequire(\"1Ax5m\");\n\nvar $e4sAN = parcelRequire(\"e4sAN\");\n\nvar $khi8I = parcelRequire(\"khi8I\");\n\nvar $dJXmR = parcelRequire(\"dJXmR\");\n\nvar $iS9xS = parcelRequire(\"iS9xS\");\n\nvar $9J17G = parcelRequire(\"9J17G\");\n\nvar $76Qvv = parcelRequire(\"76Qvv\");\n\nvar $1uc3b = parcelRequire(\"1uc3b\");\n\nvar $h20yl = parcelRequire(\"h20yl\");\n\nvar $dHnZA = parcelRequire(\"dHnZA\");\n\nvar $kDGzx = parcelRequire(\"kDGzx\");\n\nvar $30Cml = parcelRequire(\"30Cml\");\n\nvar $941rU = parcelRequire(\"941rU\");\n\nvar $3ujzu = parcelRequire(\"3ujzu\");\n\nvar $705qg = parcelRequire(\"705qg\");\n\nvar $9BlwZ = parcelRequire(\"9BlwZ\");\n\nvar $kyVjY = parcelRequire(\"kyVjY\");\n\nvar $dAXbp = parcelRequire(\"dAXbp\");\n\nvar $3P46L = parcelRequire(\"3P46L\");\n\nvar $h62LS = parcelRequire(\"h62LS\");\n\nvar $fRGIf = parcelRequire(\"fRGIf\");\n\nvar $9pcu9 = parcelRequire(\"9pcu9\");\n\nvar $aSJRf = parcelRequire(\"aSJRf\");\n\nvar $6mTnI = parcelRequire(\"6mTnI\");\n\nvar $eK8ID = parcelRequire(\"eK8ID\");\n\nvar $2umOB = parcelRequire(\"2umOB\");\n\nvar $5ENro = parcelRequire(\"5ENro\");\n\nvar $iVf04 = parcelRequire(\"iVf04\");\n\nvar $5ngYX = parcelRequire(\"5ngYX\");\n\nvar $eyygR = parcelRequire(\"eyygR\");\n\nvar $6rdi0 = parcelRequire(\"6rdi0\");\n\nvar $7pyBK = parcelRequire(\"7pyBK\");\n\nvar $cmnov = parcelRequire(\"cmnov\");\n\nvar $bIgqE = parcelRequire(\"bIgqE\");\n\nvar $iVHpg = parcelRequire(\"iVHpg\");\n\nvar $5Gc7M = parcelRequire(\"5Gc7M\");\n\nvar $7EG77 = parcelRequire(\"7EG77\");\nvar $9cbe98d1fb398012$export$6e4a713ddcda1e5e = {\n    // --- brushes ---\n    brushes: (0, $dAXbp.brushes),\n    brushesUI: (0, $3P46L.brushesUI),\n    BrushSettingService: (0, $7pyBK.BrushSettingService),\n    // --- canvas ---\n    KlCanvas: (0, $705qg.KlCanvas),\n    drawProject: (0, $aSJRf.drawProject),\n    // --- canvas ui ---\n    WorkspaceSvgOverlay: (0, $7bo3M.WorkspaceSvgOverlay),\n    KlCanvasWorkspace: (0, $lV6Vy.KlCanvasWorkspace),\n    KlCanvasPreview: (0, $i5nyl.KlCanvasPreview),\n    // --- filters ---\n    filterLibStatus: (0, $kyVjY.filterLibStatus),\n    filterLib: (0, $kyVjY.filterLib),\n    // --- history ---\n    UndoRedoCatchup: (0, $6rdi0.UndoRedoCatchup),\n    // --- image operations ---\n    renderText: (0, $h20yl.renderText),\n    floodFillBits: (0, $30Cml.floodFillBits),\n    ShapeTool: (0, $3ujzu.ShapeTool),\n    drawShape: (0, $3ujzu.drawShape),\n    GradientTool: (0, $7EG77.GradientTool),\n    drawGradient: (0, $7EG77.drawGradient),\n    // --- storage ---\n    PSD: $941rU,\n    setDbName: (0, $9BlwZ.setDbName),\n    indexedDb: $9BlwZ,\n    ProjectStore: (0, $6mTnI.ProjectStore),\n    loadAgPsd: (0, $iVf04.loadAgPsd),\n    SaveToComputer: (0, $eyygR.SaveToComputer),\n    // --- ui - components ---\n    calcSliderFalloffFactor: (0, $11glk.calcSliderFalloffFactor),\n    Checkbox: (0, $7bWhB.Checkbox),\n    input: (0, $dJPtW.input),\n    Select: (0, $eEL9N.Select),\n    ImageToggle: (0, $1kyaA.ImageToggle),\n    ImageRadioList: (0, $4nUqS.ImageRadioList),\n    RadioList: (0, $fRGIf.RadioList),\n    createPenPressureToggle: (0, $lCF5N.createPenPressureToggle),\n    KlSlider: (0, $aP0jf.KlSlider),\n    HexColorDialog: (0, $lfHl9.HexColorDialog),\n    KlColorSlider: (0, $fg9Sv.KlColorSlider),\n    KlColorSliderSmall: (0, $gmji4.KlColorSliderSmall),\n    PointSlider: (0, $j5jvd.PointSlider),\n    ColorOptions: (0, $43qNf.ColorOptions),\n    Options: (0, $iFIyy.Options),\n    BoxToggle: (0, $cmnov.BoxToggle),\n    StatusOverlay: (0, $bmB93.StatusOverlay),\n    CropCopy: (0, $hRdOL.CropCopy),\n    FreeTransform: (0, $cNhNm.FreeTransform),\n    FreeTransformCanvas: (0, $kEeSq.FreeTransformCanvas),\n    Cropper: (0, $32CBv.Cropper),\n    LayerPreview: (0, $kqmpc.LayerPreview),\n    KlImageDropper: (0, $13r5y.KlImageDropper),\n    OverlayToolspace: (0, $9p4Zp.OverlayToolspace),\n    ToolspaceTopRow: (0, $8jqzp.ToolspaceTopRow),\n    ToolDropdown: (0, $84zxV.ToolDropdown),\n    ToolspaceToolRow: (0, $9Kxky.ToolspaceToolRow),\n    ToolspaceStabilizerRow: (0, $1Ax5m.ToolspaceStabilizerRow),\n    TabRow: (0, $e4sAN.TabRow),\n    ToolspaceCollapser: (0, $1uc3b.ToolspaceCollapser),\n    BrowserStorageUi: (0, $9pcu9.BrowserStorageUi),\n    SaveReminder: (0, $5ngYX.SaveReminder),\n    ToolspaceScroller: (0, $iVHpg.ToolspaceScroller),\n    // --- ui - modals ---\n    dialogCounter: (0, $i8UFO.dialogCounter),\n    popup: (0, $2MaaK.showModal),\n    Popup: (0, $dLlkc.DynamicModal),\n    clipboardDialog: (0, $isYih.clipboardDialog),\n    showImportAsLayerDialog: (0, $8ebuX.showImportAsLayerDialog),\n    newImageDialog: (0, $76Qvv.newImageDialog),\n    textToolDialog: (0, $dHnZA.textToolDialog),\n    showImportImageDialog: (0, $kDGzx.showImportImageDialog),\n    showIframePopup: (0, $h62LS.showIframeModal),\n    imgurUpload: (0, $5ENro.imgurUpload),\n    // --- ui - tool tabs ---\n    HandUi: (0, $khi8I.HandUi),\n    FillUi: (0, $dJXmR.FillUi),\n    GradientUi: (0, $5Gc7M.GradientUi),\n    TextUi: (0, $iS9xS.TextUi),\n    ShapeUi: (0, $9J17G.ShapeUi),\n    FileTab: (0, $eK8ID.FileTab),\n    FilterTab: (0, $2umOB.FilterTab),\n    SettingsTab: (0, $bIgqE.SettingsTab),\n    LayerManager: (0, $jMW1P.LayerManager),\n    klHistory: (0, $gWfkn.klHistory),\n    DecoyKlHistory: (0, $gWfkn.DecoyKlHistory)\n};\nObject.keys($9cbe98d1fb398012$export$6e4a713ddcda1e5e); // without this, parcel build may break this object\n\n});\nparcelRequire.register(\"gWfkn\", function(module, exports) {\n\n$parcel$export(module.exports, \"DecoyKlHistory\", function () { return $b60fce38973759d6$export$2a772a91f059c0f9; });\n$parcel$export(module.exports, \"klHistory\", function () { return $b60fce38973759d6$export$28b6f4d98dde9845; });\n// --------- history entry types ------------------------------\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $bX4ja = parcelRequire(\"bX4ja\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $b60fce38973759d6$var$historyInstance = false;\nvar $b60fce38973759d6$export$2a772a91f059c0f9 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function DecoyKlHistory() {\n        (0, $cx0mh._)(this, DecoyKlHistory);\n    }\n    (0, $7h4XF._)(DecoyKlHistory, [\n        {\n            key: \"pause\",\n            value: function pause() {}\n        },\n        {\n            key: \"addListener\",\n            value: function addListener() {}\n        },\n        {\n            key: \"push\",\n            value: function push() {}\n        },\n        {\n            key: \"undo\",\n            value: function undo() {\n                return [];\n            }\n        },\n        {\n            key: \"redo\",\n            value: function redo() {\n                return undefined;\n            }\n        },\n        {\n            key: \"getAll\",\n            value: function getAll() {\n                return [];\n            }\n        },\n        {\n            key: \"canRedo\",\n            value: function canRedo() {\n                return false;\n            }\n        },\n        {\n            key: \"canUndo\",\n            value: function canUndo() {\n                return false;\n            }\n        },\n        {\n            key: \"getState\",\n            value: function getState() {\n                return 0;\n            }\n        },\n        {\n            key: \"getActionNumber\",\n            value: function getActionNumber() {\n                return 0;\n            }\n        }\n    ]);\n    return DecoyKlHistory;\n}();\nvar $b60fce38973759d6$var$DO_DELETE_OLD = true;\nvar $b60fce38973759d6$export$1a1044741a812c67 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function KlHistory() {\n        (0, $cx0mh._)(this, KlHistory);\n        this.max = 20 // max number undo steps\n        ;\n        if ($b60fce38973759d6$var$historyInstance) throw new Error(\"klHistory already instantiated\");\n        $b60fce38973759d6$var$historyInstance = true;\n        this.state = 0;\n        this.entries = [];\n        this.listeners = [];\n        this.pauseStack = 0;\n        this.maxState = -1;\n        this.actionNumber = -1;\n    }\n    (0, $7h4XF._)(KlHistory, [\n        {\n            key: \"broadcast\",\n            value: function broadcast(p) {\n                var _this = this;\n                setTimeout(function() {\n                    for(var i = 0; i < _this.listeners.length; i++)_this.listeners[i](p);\n                    _this.state++;\n                }, 1);\n            }\n        },\n        {\n            /**\r\n     * Needed, because sometimes there are actions that would cause other undo steps.\r\n     * For example a filter that does something with two layers and then merges them.\r\n     * That should be a single undo step, and prevent merging from creating its own undo step.\r\n     * Pause prevents creation of unintended undo steps.\r\n     */ key: \"pause\",\n            value: function pause(b) {\n                if (b) this.pauseStack++;\n                else this.pauseStack = Math.max(0, this.pauseStack - 1);\n            }\n        },\n        {\n            key: \"addListener\",\n            value: function addListener(l) {\n                this.listeners.push(l);\n            }\n        },\n        {\n            key: \"push\",\n            value: function push(newEntry) {\n                if (this.pauseStack > 0) return;\n                while(this.actionNumber < this.entries.length - 1)this.entries.pop();\n                //taking care of actions that shouldn't cause a new undo step\n                var lastEntry = this.entries[this.entries.length - 1];\n                // opacity\n                if (lastEntry && newEntry.tool[0] === \"canvas\" && lastEntry.tool[0] === \"canvas\" && newEntry.action === \"layerOpacity\" && lastEntry.action === \"layerOpacity\" && lastEntry.params[0] === newEntry.params[0]) {\n                    this.entries[this.entries.length - 1] = newEntry;\n                    this.state++; //still needs to increment because something changed\n                    return;\n                }\n                // layer visibility\n                if (lastEntry && newEntry.tool[0] === \"canvas\" && lastEntry.tool[0] === \"canvas\" && newEntry.action === \"setLayerIsVisible\" && lastEntry.action === \"setLayerIsVisible\" && lastEntry.params[0] === newEntry.params[0] && lastEntry.params[1] != newEntry.params[1]) {\n                    // if last and current step toggle visibility -> that means it's the way it was before\n                    this.entries.pop();\n                    this.actionNumber--;\n                    this.state++; //still needs to increment because something changed\n                    this.broadcast(null);\n                    return;\n                }\n                // select layer\n                if (newEntry.action === \"focusLayer\" && lastEntry && lastEntry.action === \"focusLayer\") {\n                    this.entries[this.entries.length - 1] = newEntry;\n                    this.state++;\n                    return;\n                }\n                this.entries[this.entries.length] = newEntry;\n                this.actionNumber = this.entries.length - 1;\n                var maxBefore = this.maxState;\n                this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\n                if (maxBefore < this.maxState) {\n                    var item = this.entries[this.maxState];\n                    if (!item) throw new Error(\"this.dataArr[this.maxState] null\");\n                    this.broadcast({\n                        bufferUpdate: item\n                    });\n                } else this.broadcast(null);\n                if ($b60fce38973759d6$var$DO_DELETE_OLD && this.maxState >= 0) this.entries[this.maxState] = null; //to free some memory...imported images take a lot of space\n            }\n        },\n        {\n            /**\r\n     * lowers action number, returns all entries that need to be executed\r\n     * on trailing snapshot to represent the canvas one undo step back.\r\n     * Empty array if it can't undo\r\n     */ key: \"undo\",\n            value: function undo() {\n                var result = [];\n                if (!this.canUndo()) return result;\n                for(var i = this.maxState + 1; i < this.actionNumber; i++)result.push((0, $7jh4K.throwIfNull)(this.entries[i]));\n                this.actionNumber--;\n                this.broadcast(null);\n                return result;\n            }\n        },\n        {\n            /**\r\n     * raises action number, returns the action to be redone\r\n     */ key: \"redo\",\n            value: function redo() {\n                if (!this.canRedo()) return undefined;\n                this.actionNumber++;\n                this.broadcast(null);\n                return (0, $7jh4K.throwIfNull)(this.entries[this.actionNumber]);\n            }\n        },\n        {\n            key: \"getAll\",\n            value: function getAll() {\n                return (0, $bX4ja._)(this.entries);\n            }\n        },\n        {\n            key: \"canRedo\",\n            value: function canRedo() {\n                return this.actionNumber < this.entries.length - 1;\n            }\n        },\n        {\n            key: \"canUndo\",\n            value: function canUndo() {\n                return this.actionNumber > this.maxState;\n            }\n        },\n        {\n            key: \"getState\",\n            value: function getState() {\n                return this.state;\n            }\n        },\n        {\n            /**\r\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\r\n     */ key: \"getActionNumber\",\n            value: function getActionNumber() {\n                return this.actionNumber + 1;\n            }\n        }\n    ]);\n    return KlHistory;\n}();\nvar $b60fce38973759d6$export$28b6f4d98dde9845 = new $b60fce38973759d6$export$1a1044741a812c67();\n\n});\n\nparcelRequire.register(\"2MaaK\", function(module, exports) {\n\n$parcel$export(module.exports, \"showModal\", function () { return $c902829f68f42bce$export$d7e8d4d4450c819c; });\n\nvar $i8UFO = parcelRequire(\"i8UFO\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nparcelRequire(\"8zjca\");\n\nvar $6ToP3 = parcelRequire(\"6ToP3\");\n\nvar $d2FVM = parcelRequire(\"d2FVM\");\nfunction $c902829f68f42bce$export$d7e8d4d4450c819c(p) {\n    var close = function close(value) {\n        if (isClosed) return;\n        isClosed = true;\n        (0, $eWjiX.BB).clearSelection();\n        (0, $eWjiX.BB).unfocusAnyInput();\n        rootRootEl.remove();\n        (0, $i8UFO.dialogCounter).decrease();\n        (0, $eWjiX.BB).destroyEl(xButton);\n        (0, $eWjiX.BB).destroyEl(bgEl);\n        keyListener.destroy();\n        rootEl.removeEventListener(\"wheel\", wheelPrevent);\n        // (disabled) eslint-disable-next-line no-null/no-null\n        rootEl.onclick = null;\n        btnElArr.forEach(function(item) {\n            return (0, $eWjiX.BB).destroyEl(item);\n        });\n        btnElArr.splice(0, btnElArr.length);\n        if (p.callback) p.callback(value);\n    };\n    (0, $i8UFO.dialogCounter).increase();\n    var isClosed = false;\n    var ignoreBackground = !!p.ignoreBackground;\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\n    var rootRootEl = (0, $eWjiX.BB).el({\n        parent: document.body,\n        css: {\n            position: \"absolute\",\n            left: \"0\",\n            top: \"0\",\n            right: \"0\",\n            bottom: \"0\",\n            overflow: \"hidden\"\n        }\n    });\n    var rootEl = (0, $eWjiX.BB).el({\n        parent: rootRootEl,\n        className: \"kl-popup\"\n    });\n    var scrollContent = (0, $eWjiX.BB).el({\n        parent: rootEl,\n        css: {\n            width: \"100%\",\n            minHeight: \"100%\",\n            // padding: '10px 0',\n            position: \"relative\",\n            display: \"flex\",\n            flexDirection: \"column\",\n            justifyContent: \"center\",\n            alignItems: \"center\"\n        }\n    });\n    var bgEl = (0, $eWjiX.BB).el({\n        parent: scrollContent,\n        onClick: function() {\n            if (ignoreBackground) return;\n            close(\"Cancel\");\n        },\n        css: {\n            position: \"absolute\",\n            left: \"0\",\n            top: \"0\",\n            zIndex: \"0\",\n            width: \"100%\",\n            height: \"100%\"\n        }\n    });\n    var titleHeight = 40;\n    var xButton = (0, $eWjiX.BB).el({\n        tagName: \"button\",\n        className: \"popup-x\",\n        content: '<img alt=\"'.concat((0, $1mH1z.LANG)(\"modal-close\"), '\" height=\"20\" src=\"').concat((0, (/*@__PURE__*/$parcel$interopDefault($6ToP3))), '\">'),\n        title: (0, $1mH1z.LANG)(\"modal-close\"),\n        onClick: function() {\n            close(\"Cancel\");\n        },\n        css: {\n            width: titleHeight + \"px\",\n            height: titleHeight + \"px\",\n            lineHeight: titleHeight + \"px\",\n            position: \"absolute\",\n            right: \"0\",\n            top: \"0\",\n            background: \"none\",\n            boxShadow: \"none\"\n        }\n    });\n    var icon = undefined;\n    if (p.type) icon = (0, $eWjiX.BB).el({\n        className: {\n            error: \"kl-popup__icon-error\",\n            ok: \"kl-popup__icon-ok\",\n            warning: \"kl-popup__icon-warning\",\n            upload: \"kl-popup__icon-upload\"\n        }[p.type]\n    });\n    var boxClasses = [\n        \"kl-popup-box\"\n    ];\n    boxClasses.push(\"kl-popup-box--sm\");\n    var boxEl = (0, $eWjiX.BB).el({\n        content: [\n            xButton,\n            icon,\n            (0, $eWjiX.BB).el({\n                content: p.message,\n                css: {\n                    marginRight: \"15px\",\n                    marginBottom: p.div ? \"10px\" : undefined\n                }\n            }),\n            p.div\n        ],\n        className: boxClasses.join(\" \"),\n        css: p.style ? p.style : undefined\n    });\n    scrollContent.append((0, $eWjiX.BB).el({\n        css: {\n            flex: \"0.5\"\n        }\n    }), boxEl, (0, $eWjiX.BB).el({\n        css: {\n            flex: \"1\"\n        }\n    }));\n    var keyListener = new (0, $eWjiX.BB).KeyListener({\n        onDown: function onDown(keyStr, e, comboStr) {\n            if (isClosed) return;\n            if (clickOnEnterBtn && comboStr === \"enter\" && !(0, $eWjiX.BB).isInputFocused()) {\n                e.stopPropagation();\n                setTimeout(function() {\n                    clickOnEnterBtn && clickOnEnterBtn.click();\n                }, 10);\n            }\n            if (comboStr === \"esc\") {\n                e.stopPropagation();\n                close(\"Cancel\");\n            }\n        }\n    });\n    // prevent ctrl scroll -> zooming page\n    var wheelPrevent = function(event) {\n        if (keyListener.isPressed(\"ctrl\")) event.preventDefault();\n    };\n    rootEl.addEventListener(\"wheel\", wheelPrevent);\n    rootEl.onclick = (0, $eWjiX.BB).handleClick;\n    var autoFocus;\n    if (p.autoFocus) autoFocus = p.autoFocus;\n    else if (p.autoFocus === false) autoFocus = undefined;\n    else autoFocus = \"Ok\";\n    var buttonRowEl = p.buttons && p.buttons.length > 0 ? (0, $eWjiX.BB).el({\n        parent: boxEl,\n        css: {\n            display: \"flex\",\n            flexWrap: \"wrap\",\n            justifyContent: \"flex-end\",\n            marginTop: \"12px\",\n            marginLeft: \"-8px\"\n        }\n    }) : undefined;\n    var clickOnEnterBtn;\n    var btnElArr = [];\n    if (p.buttons) p.buttons.forEach(function(buttonName) {\n        var btnClasses = [\n            \"kl-popup__btn\"\n        ];\n        if (buttonName === \"Ok\" || p.primaries && p.primaries.includes(buttonName)) btnClasses.push(\"kl-button-primary\");\n        var iconUrl;\n        var label = buttonName;\n        if (buttonName === \"Ok\") {\n            label = (0, $1mH1z.LANG)(\"modal-ok\");\n            iconUrl = (0, (/*@__PURE__*/$parcel$interopDefault($d2FVM)));\n        }\n        if (buttonName === \"Cancel\") {\n            label = (0, $1mH1z.LANG)(\"modal-cancel\");\n            iconUrl = (0, (/*@__PURE__*/$parcel$interopDefault($6ToP3)));\n            btnClasses.push(\"kl-button-cancel\");\n        }\n        var iconImg = undefined;\n        if (iconUrl) iconImg = (0, $eWjiX.BB).el({\n            tagName: \"img\",\n            custom: {\n                src: iconUrl,\n                height: \"17\"\n            }\n        });\n        var btn = (0, $eWjiX.BB).el({\n            parent: buttonRowEl,\n            tagName: \"button\",\n            className: btnClasses.join(\" \"),\n            content: [\n                iconImg,\n                (0, $eWjiX.BB).el({\n                    className: \"kl-popup__btn__text\",\n                    content: label\n                })\n            ],\n            onClick: function() {\n                close(buttonName);\n            }\n        });\n        btnElArr.push(btn);\n        if (autoFocus === buttonName) {\n            setTimeout(function() {\n                btn.focus();\n                rootEl.scrollTo(0, 0);\n            }, 10);\n            setTimeout(function() {\n                // safari needs a separate timeout\n                rootEl.scrollTo(0, 0);\n            }, 20);\n        }\n        if (buttonName === p.clickOnEnter) clickOnEnterBtn = btn;\n    });\n    if (p.closeFunc) p.closeFunc(function() {\n        close(\"Cancel\");\n    });\n    return {\n        setIgnoreBackground: function(b) {\n            ignoreBackground = b;\n        }\n    };\n}\n\n});\nparcelRequire.register(\"i8UFO\", function(module, exports) {\n\n$parcel$export(module.exports, \"dialogCounter\", function () { return $dd0d395ff14a3e11$export$17eb8275e0c4cab8; });\n// not the best\n/**\r\n * how many modals are open\r\n */ \nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\nvar $dd0d395ff14a3e11$export$f5386afdb763a67e = /*#__PURE__*/ function() {\n    \"use strict\";\n    function DialogCounter() {\n        (0, $cx0mh._)(this, DialogCounter);\n        this.listeners = [];\n        this.count = 0;\n    }\n    (0, $7h4XF._)(DialogCounter, [\n        {\n            key: \"emit\",\n            value: function emit() {\n                var _this = this;\n                this.listeners.forEach(function(item) {\n                    item(_this.count);\n                });\n            }\n        },\n        {\n            key: \"increase\",\n            value: function increase(v) {\n                if (v !== undefined) this.count += v;\n                else this.count++;\n                this.emit();\n            }\n        },\n        {\n            key: \"decrease\",\n            value: function decrease(v) {\n                if (v !== undefined) this.count -= v;\n                else this.count--;\n                this.emit();\n            }\n        },\n        {\n            key: \"get\",\n            value: function get() {\n                return this.count;\n            }\n        },\n        {\n            key: \"subscribe\",\n            value: function subscribe(listener) {\n                this.listeners.push(listener);\n            }\n        }\n    ]);\n    return DialogCounter;\n}();\nvar $dd0d395ff14a3e11$export$17eb8275e0c4cab8 = new $dd0d395ff14a3e11$export$f5386afdb763a67e();\n\n});\n\nparcelRequire.register(\"eWjiX\", function(module, exports) {\n\n$parcel$export(module.exports, \"BB\", function () { return $05ec456c8871d48f$export$921068d8846a1559; });\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\n\nvar $6J2My = parcelRequire(\"6J2My\");\n\nvar $idV3L = parcelRequire(\"idV3L\");\n\nvar $04lDo = parcelRequire(\"04lDo\");\n\nvar $eIcQa = parcelRequire(\"eIcQa\");\n\nvar $kVHNC = parcelRequire(\"kVHNC\");\n\nvar $4toIY = parcelRequire(\"4toIY\");\n\nvar $af1iA = parcelRequire(\"af1iA\");\n\nvar $dJ1E2 = parcelRequire(\"dJ1E2\");\n\nvar $72Jv0 = parcelRequire(\"72Jv0\");\n\nvar $eg83P = parcelRequire(\"eg83P\");\n\nvar $eelgW = parcelRequire(\"eelgW\");\n\nvar $i0uIf = parcelRequire(\"i0uIf\");\n\nvar $6l0gQ = parcelRequire(\"6l0gQ\");\n\nvar $jjWRi = parcelRequire(\"jjWRi\");\n\nvar $2pgVs = parcelRequire(\"2pgVs\");\n\nvar $joplQ = parcelRequire(\"joplQ\");\n\nvar $c1lmK = parcelRequire(\"c1lmK\");\n\nvar $635F6 = parcelRequire(\"635F6\");\n\nvar $gCzYB = parcelRequire(\"gCzYB\");\nvar $05ec456c8871d48f$export$921068d8846a1559 = {\n    // ---- browser ----\n    eventUsesHighResTimeStamp: (0, $6J2My.eventUsesHighResTimeStamp),\n    hasPointerEvents: (0, $6J2My.hasPointerEvents),\n    isCssMinMaxSupported: (0, $6J2My.isCssMinMaxSupported),\n    canShareFiles: (0, $6J2My.canShareFiles),\n    unsetEventHandler: (0, $6J2My.unsetEventHandler),\n    // ---- base ----\n    insertAfter: (0, $7jh4K.insertAfter),\n    loadImage: (0, $7jh4K.loadImage),\n    css: (0, $7jh4K.css),\n    setAttributes: (0, $7jh4K.setAttributes),\n    append: (0, $7jh4K.append),\n    fitInto: (0, $7jh4K.fitInto),\n    centerWithin: (0, $7jh4K.centerWithin),\n    getDate: (0, $7jh4K.getDate),\n    gcd: (0, $7jh4K.gcd),\n    reduce: (0, $7jh4K.reduce),\n    decToFraction: (0, $7jh4K.decToFraction),\n    imageBlobToUrl: (0, $7jh4K.imageBlobToUrl),\n    dateDayDifference: (0, $7jh4K.dateDayDifference),\n    copyObj: (0, $7jh4K.copyObj),\n    shareCanvas: (0, $7jh4K.shareCanvas),\n    handleClick: (0, $7jh4K.handleClick),\n    createSvg: (0, $7jh4K.createSvg),\n    BbLog: (0, $i0uIf.BbLog),\n    LocalStorage: (0, $6l0gQ.LocalStorage),\n    throwIfNull: (0, $7jh4K.throwIfNull),\n    nullToUndefined: (0, $7jh4K.nullToUndefined),\n    isDark: (0, $7jh4K.isDark),\n    // ---- math ----\n    mix: (0, $eg83P.mix),\n    dist: (0, $eg83P.dist),\n    distSquared: (0, $eg83P.distSquared),\n    lenSquared: (0, $eg83P.lenSquared),\n    pointsToAngleRad: (0, $eg83P.pointsToAngleRad),\n    pointsToAngleDeg: (0, $eg83P.pointsToAngleDeg),\n    isInsideRect: (0, $eg83P.isInsideRect),\n    clamp: (0, $eg83P.clamp),\n    rotate: (0, $eg83P.rotate),\n    rotateAround: (0, $eg83P.rotateAround),\n    Matrix: (0, $kVHNC.Matrix),\n    Vec2: (0, $4toIY.Vec2),\n    intDxy: (0, $eg83P.intDxy),\n    roundEven: (0, $eg83P.roundEven),\n    roundUneven: (0, $eg83P.roundUneven),\n    round: (0, $eg83P.round),\n    updateBounds: (0, $eg83P.updateBounds),\n    boundsInArea: (0, $eg83P.boundsInArea),\n    // ---- line ----\n    projectPointOnLine: (0, $af1iA.projectPointOnLine),\n    PointLine: (0, $af1iA.PointLine),\n    BezierLine: (0, $af1iA.BezierLine),\n    SplineInterpolator: (0, $af1iA.SplineInterpolator),\n    quadraticSplineInput: (0, $af1iA.quadraticSplineInput),\n    // ---- canvas ----\n    canvas: (0, $eelgW.createCanvas),\n    ctx: (0, $eIcQa.ctx),\n    copyCanvas: (0, $eIcQa.copyCanvas),\n    testShouldPixelate: (0, $eIcQa.testShouldPixelate),\n    drawTransformedImageWithBounds: (0, $eIcQa.drawTransformedImageWithBounds),\n    drawTransformedImageOnCanvas: (0, $eIcQa.drawTransformedImageOnCanvas),\n    createCheckerCanvas: (0, $eIcQa.createCheckerCanvas),\n    createCheckerDataUrl: (0, $eIcQa.createCheckerDataUrl),\n    resizeCanvas: (0, $eIcQa.resizeCanvas),\n    convertToAlphaChannelCanvas: (0, $eIcQa.convertToAlphaChannelCanvas),\n    freeCanvas: (0, $eIcQa.freeCanvas),\n    canvasBounds: (0, $eIcQa.canvasBounds),\n    // ---- color ----\n    HSV: (0, $dJ1E2.HSV),\n    RGB: (0, $dJ1E2.RGB),\n    CMYK: (0, $dJ1E2.CMYK),\n    ColorConverter: (0, $dJ1E2.ColorConverter),\n    testIsWhiteBestContrast: (0, $dJ1E2.testIsWhiteBestContrast),\n    // ---- UI ----\n    appendTextDiv: (0, $72Jv0.appendTextDiv),\n    clearSelection: (0, $72Jv0.clearSelection),\n    makeUnfocusable: (0, $72Jv0.makeUnfocusable),\n    el: (0, $72Jv0.el),\n    destroyEl: (0, $72Jv0.destroyEl),\n    isInputFocused: (0, $72Jv0.isInputFocused),\n    unfocusAnyInput: (0, $72Jv0.unfocusAnyInput),\n    // ---- events / input ----\n    KeyListener: (0, $idV3L.KeyListener),\n    PointerListener: (0, $04lDo.PointerListener),\n    sameKeys: (0, $idV3L.sameKeys),\n    EventChain: (0, $gCzYB.EventChain),\n    DoubleTapper: (0, $c1lmK.DoubleTapper),\n    NFingerTapper: (0, $2pgVs.NFingerTapper),\n    PinchZoomer: (0, $joplQ.PinchZoomer),\n    CoalescedExploder: (0, $jjWRi.CoalescedExploder),\n    OnePointerLimiter: (0, $635F6.OnePointerLimiter)\n};\nObject.keys($05ec456c8871d48f$export$921068d8846a1559); // without this, parcel build may break this object\n\n});\nparcelRequire.register(\"6J2My\", function(module, exports) {\n\n$parcel$export(module.exports, \"isFirefox\", function () { return $878b1f179a521546$export$b7d78993b74f766d; });\n$parcel$export(module.exports, \"eventUsesHighResTimeStamp\", function () { return $878b1f179a521546$export$4ec3bfbae69fbb50; });\n$parcel$export(module.exports, \"hasPointerEvents\", function () { return $878b1f179a521546$export$b7b64c480b083ae0; });\n$parcel$export(module.exports, \"isCssMinMaxSupported\", function () { return $878b1f179a521546$export$fe0a7220ab4eecad; });\n$parcel$export(module.exports, \"canShareFiles\", function () { return $878b1f179a521546$export$558f5e20caee48c2; });\n$parcel$export(module.exports, \"unsetEventHandler\", function () { return $878b1f179a521546$export$4fb2cccfca937a8c; });\nvar $878b1f179a521546$export$b7d78993b74f766d = navigator.userAgent.toLowerCase().indexOf(\"firefox\") > -1;\nvar $878b1f179a521546$export$4ec3bfbae69fbb50 = function() {\n    var eventUsesHighResTimeStamp = new Event(\"\").timeStamp < 3600000;\n    return function() {\n        return eventUsesHighResTimeStamp;\n    };\n}();\nvar $878b1f179a521546$export$b7b64c480b083ae0 = !!window.PointerEvent;\nvar $878b1f179a521546$export$fe0a7220ab4eecad = function() {\n    var test = function test() {\n        var div = document.createElement(\"div\");\n        div.style.position = \"absolute\";\n        div.style.top = \"0\";\n        div.style.left = \"max(0px, 25px)\";\n        document.body.append(div);\n        setTimeout(function() {\n            result = div.offsetLeft === 25;\n            div.remove();\n        }, 25);\n    };\n    var result;\n    if (document.body) test();\n    else window.addEventListener(\"DOMContentLoaded\", function() {\n        test();\n    });\n    return function() {\n        if (result === undefined) throw new Error(\"isCssMinMaxSupported not initialized\");\n        return result;\n    };\n}();\nvar $878b1f179a521546$export$558f5e20caee48c2 = function canShareFiles() {\n    return \"share\" in navigator && \"canShare\" in navigator;\n};\nfunction $878b1f179a521546$export$4fb2cccfca937a8c(obj) {\n    for(var _len = arguments.length, handlers = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++){\n        handlers[_key - 1] = arguments[_key];\n    }\n    handlers.forEach(function(handler) {\n        // (disabled) eslint-disable-next-line no-null/no-null\n        obj[handler] = null;\n    });\n}\n\n});\n\nparcelRequire.register(\"idV3L\", function(module, exports) {\n\n$parcel$export(module.exports, \"KeyListener\", function () { return $74d1f29ad2137b2c$export$f17908c5de22d32e; });\n$parcel$export(module.exports, \"sameKeys\", function () { return $74d1f29ad2137b2c$export$e9f65b0175de4c03; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $8N5YG = parcelRequire(\"8N5YG\");\nvar $74d1f29ad2137b2c$var$globalKey = function() {\n    var keyDown = function keyDown(e) {\n        var key = e.key;\n        var code = e.code;\n        if (key in keyToKeyStrObj) {\n            var keyStr = keyToKeyStrObj[key];\n            if (isDownObj[keyStr]) {\n                emitDown(keyStr, e, comboArr.join(\"+\"), true);\n                return;\n            }\n            isDownObj[keyStr] = true;\n            codeIsDownObj[code] = keyStr;\n            //add to combo\n            comboArr.push(keyStr);\n            emitDown(keyStr, e, comboArr.join(\"+\"));\n        }\n    };\n    var keyUp = function keyUp(e) {\n        var code = e.code;\n        var oldComboStr = comboArr.join(\"+\");\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\n        if ([\n            \"Meta\",\n            \"MetaLeft\",\n            \"MetaRight\",\n            \"OSLeft\",\n            \"OSRight\"\n        ].includes(code)) {\n            blur();\n            return;\n        }\n        var keyStr = codeIsDownObj[code];\n        if (keyStr !== undefined) {\n            isDownObj[keyStr] = false;\n            codeIsDownObj[code] = undefined;\n            // remove from combo\n            for(var i = 0; i < comboArr.length; i++)if (comboArr[i] == keyStr) {\n                comboArr.splice(i, 1);\n                i--;\n            }\n            emitUp(keyStr, e, oldComboStr);\n        }\n    };\n    var blur = function blur() {\n        var oldComboStr = comboArr.join(\"+\");\n        comboArr = [];\n        codeIsDownObj = {};\n        var eventArr = [];\n        keyStrArr.forEach(function(keyStr) {\n            if (isDownObj[keyStr]) {\n                isDownObj[keyStr] = false;\n                eventArr.push(keyStr);\n            }\n        });\n        for(var i = 0; i < eventArr.length; i++)emitUp(eventArr[i], {\n            preventDefault: function preventDefault() {},\n            stopPropagation: function stopPropagation() {}\n        }, oldComboStr);\n        emitBlur();\n    };\n    // keyStr - our key naming system\n    // key - KeyboardEvent.key\n    // code - KeyboardEvent.code\n    var keyStrToKeyObj = {\n        \"space\": [\n            \" \",\n            \"Spacebar\"\n        ],\n        \"alt\": [\n            \"Alt\",\n            \"AltGraph\"\n        ],\n        \"shift\": \"Shift\",\n        \"ctrl\": \"Control\",\n        \"cmd\": [\n            \"Meta\",\n            \"MetaLeft\",\n            \"MetaRight\"\n        ],\n        \"enter\": \"Enter\",\n        \"esc\": \"Escape\",\n        \"backspace\": \"Backspace\",\n        \"delete\": \"Delete\",\n        \"sqbr_open\": \"[\",\n        \"sqbr_close\": \"]\",\n        \"a\": [\n            \"a\",\n            \"A\"\n        ],\n        \"b\": [\n            \"b\",\n            \"B\"\n        ],\n        \"c\": [\n            \"c\",\n            \"C\"\n        ],\n        \"e\": [\n            \"e\",\n            \"E\"\n        ],\n        \"f\": [\n            \"f\",\n            \"F\"\n        ],\n        \"g\": [\n            \"g\",\n            \"G\"\n        ],\n        \"r\": [\n            \"r\",\n            \"R\"\n        ],\n        \"s\": [\n            \"s\",\n            \"S\"\n        ],\n        \"t\": [\n            \"t\",\n            \"T\"\n        ],\n        \"u\": [\n            \"u\",\n            \"U\"\n        ],\n        \"x\": [\n            \"x\",\n            \"X\"\n        ],\n        \"y\": [\n            \"y\",\n            \"Y\"\n        ],\n        \"z\": [\n            \"z\",\n            \"Z\"\n        ],\n        \"plus\": \"+\",\n        \"minus\": \"-\",\n        \"left\": \"ArrowLeft\",\n        \"right\": \"ArrowRight\",\n        \"up\": \"ArrowUp\",\n        \"down\": \"ArrowDown\",\n        \"home\": \"Home\",\n        \"end\": \"End\"\n    };\n    // ['space', 'alt', ... ]\n    var keyStrArr = Object.keys(keyStrToKeyObj);\n    // { space: false, ... }\n    var isDownObj = Object.entries(keyStrToKeyObj).reduce(function(acc, param) {\n        var _param = (0, $8N5YG._)(param, 1), key = _param[0];\n        acc[key] = false;\n        return acc;\n    }, {});\n    // event.key to keyStr\n    // { ArrowLeft: 'left', ... }\n    var keyToKeyStrObj = Object.entries(keyStrToKeyObj).reduce(function(acc, param) {\n        var _param = (0, $8N5YG._)(param, 2), key = _param[0], code = _param[1];\n        if (typeof code === \"string\") acc[code] = key;\n        else code.forEach(function(item) {\n            acc[item] = key;\n        });\n        return acc;\n    }, {});\n    var comboArr = [];\n    // a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\n    // { KeyE: 'e', KeyF: undefined } - undefined - not down, string - the associated keyStr\n    var codeIsDownObj = {};\n    var listenerArr = [];\n    var emitDown = function emitDown(a, b, c, d) {\n        listenerArr.forEach(function(item) {\n            if (!item[0]) return;\n            item[0](a, b, c, d);\n        });\n    };\n    var emitUp = function emitUp(a, b, c) {\n        listenerArr.forEach(function(item) {\n            if (!item[1]) return;\n            item[1](a, b, c);\n        });\n    };\n    var emitBlur = function emitBlur() {\n        listenerArr.forEach(function(item) {\n            if (!item[2]) return;\n            item[2]();\n        });\n    };\n    return {\n        add: function(keyListenerRef) {\n            if (listenerArr.includes(keyListenerRef)) return;\n            var first = listenerArr.length === 0;\n            listenerArr.push(keyListenerRef);\n            if (first) {\n                document.addEventListener(\"keydown\", keyDown);\n                document.addEventListener(\"keyup\", keyUp);\n                window.addEventListener(\"blur\", blur);\n            }\n        },\n        remove: function(keyListenerRef) {\n            if (!listenerArr.includes(keyListenerRef)) return;\n            var last = listenerArr.length === 1;\n            for(var i = 0; i < listenerArr.length; i++)if (listenerArr[i] === keyListenerRef) {\n                listenerArr.splice(i, 1);\n                break;\n            }\n            if (last) {\n                document.removeEventListener(\"keydown\", keyDown);\n                document.removeEventListener(\"keyup\", keyUp);\n                window.removeEventListener(\"blur\", blur);\n            }\n        },\n        getIsDown: function() {\n            return isDownObj;\n        },\n        getCombo: function() {\n            return comboArr;\n        }\n    };\n}();\nvar $74d1f29ad2137b2c$export$f17908c5de22d32e = /*#__PURE__*/ function() {\n    \"use strict\";\n    function KeyListener(p) {\n        (0, $cx0mh._)(this, KeyListener);\n        this.onDown = p.onDown;\n        this.onUp = p.onUp;\n        this.onBlur = p.onBlur;\n        this.ref = [\n            this.onDown,\n            this.onUp,\n            this.onBlur\n        ];\n        $74d1f29ad2137b2c$var$globalKey.add(this.ref);\n    }\n    (0, $7h4XF._)(KeyListener, [\n        {\n            key: \"isPressed\",\n            value: function isPressed(keyStr) {\n                if (!(keyStr in $74d1f29ad2137b2c$var$globalKey.getIsDown())) throw 'key \"' + keyStr + '\" not found';\n                return $74d1f29ad2137b2c$var$globalKey.getIsDown()[keyStr];\n            }\n        },\n        {\n            key: \"getComboStr\",\n            value: function getComboStr() {\n                return $74d1f29ad2137b2c$var$globalKey.getCombo().join(\"+\");\n            }\n        },\n        {\n            key: \"comboOnlyContains\",\n            value: function comboOnlyContains(keyStrArr) {\n                for(var i = 0; i < $74d1f29ad2137b2c$var$globalKey.getCombo().length; i++){\n                    if (!keyStrArr.includes($74d1f29ad2137b2c$var$globalKey.getCombo()[i])) return false;\n                }\n                return true;\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                $74d1f29ad2137b2c$var$globalKey.remove(this.ref);\n            }\n        }\n    ]);\n    return KeyListener;\n}();\nfunction $74d1f29ad2137b2c$export$e9f65b0175de4c03(comboAStr, comboBStr) {\n    return comboAStr.split(\"+\").sort().join(\"+\") === comboBStr.split(\"+\").sort().join(\"+\");\n}\n\n});\n\nparcelRequire.register(\"04lDo\", function(module, exports) {\n\n$parcel$export(module.exports, \"PointerListener\", function () { return $893e90c2dcf687ac$export$9371bd96776f4e82; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $cL71g = parcelRequire(\"cL71g\");\n\nvar $4EWN2 = parcelRequire(\"4EWN2\");\n\nvar $6J2My = parcelRequire(\"6J2My\");\n\nvar $93oLo = parcelRequire(\"93oLo\");\n\nvar $eIAon = parcelRequire(\"eIAon\");\n// keeping track of pointers for movement fallback\nvar $893e90c2dcf687ac$var$pointerArr = [];\nfunction $893e90c2dcf687ac$var$addPointer(event) {\n    var pointerObj = {\n        pointerId: event.pointerId,\n        lastPageX: null,\n        lastPageY: null\n    };\n    $893e90c2dcf687ac$var$pointerArr.push(pointerObj);\n    if ($893e90c2dcf687ac$var$pointerArr.length > 15) $893e90c2dcf687ac$var$pointerArr.shift();\n    return pointerObj;\n}\nfunction $893e90c2dcf687ac$var$getPointer(event) {\n    for(var i = $893e90c2dcf687ac$var$pointerArr.length - 1; i >= 0; i--){\n        if (event.pointerId === $893e90c2dcf687ac$var$pointerArr[i].pointerId) return $893e90c2dcf687ac$var$pointerArr[i];\n    }\n    return null;\n}\nfunction $893e90c2dcf687ac$var$getButtonStr(buttons) {\n    switch(buttons){\n        case 1:\n            return \"left\";\n        case 2:\n            return \"right\";\n        case 4:\n            return \"middle\";\n        default:\n            return undefined;\n    }\n}\nvar $893e90c2dcf687ac$var$pressureNormalizer = new (0, $eIAon.PressureNormalizer)();\nvar $893e90c2dcf687ac$var$timeStampOffset = (0, $6J2My.eventUsesHighResTimeStamp)() ? 0 : -performance.timing.navigationStart;\nvar $893e90c2dcf687ac$var$pointerDownEvt = (0, $6J2My.hasPointerEvents) ? \"pointerdown\" : \"mousedown\";\nvar $893e90c2dcf687ac$var$pointerMoveEvt = (0, $6J2My.hasPointerEvents) ? \"pointermove\" : \"mousemove\";\nvar $893e90c2dcf687ac$var$pointerUpEvt = (0, $6J2My.hasPointerEvents) ? \"pointerup\" : \"mouseup\";\nvar $893e90c2dcf687ac$var$pointerCancelEvt = (0, $6J2My.hasPointerEvents) ? \"pointercancel\" : \"mousecancel\";\nvar $893e90c2dcf687ac$var$pointerLeaveEvt = (0, $6J2My.hasPointerEvents) ? \"pointerleave\" : \"mouseleave\";\nvar $893e90c2dcf687ac$var$pointerEnterEvt = (0, $6J2My.hasPointerEvents) ? \"pointerenter\" : \"mouseenter\";\n/**\r\n * More trustworthy pointer attributes. that behave the same across browsers.\r\n * returns a new object. Also attaches itself to the orig event. -> event.corrected\r\n */ function $893e90c2dcf687ac$var$correctPointerEvent(event) {\n    var determineButtons = function determineButtons() {\n        if (event.buttons !== undefined) return event.buttons;\n        /*\r\n                button -> buttons\r\n        none:\tundefined -> 0\r\n        left:\t0 -> 1\r\n        middle:\t1 -> 4\r\n        right:\t2 -> 2\r\n        fourth:\t3 -> 8\r\n        fifth:\t4 -> 16\r\n         */ if (event.button !== undefined) return [\n            1,\n            4,\n            2,\n            8,\n            16\n        ][event.button];\n        return 0;\n    };\n    if (\"corrected\" in event) return event.corrected;\n    var correctedObj = {\n        pointerId: event.pointerId,\n        pointerType: event.pointerType,\n        pageX: event.pageX,\n        pageY: event.pageY,\n        clientX: event.clientX,\n        clientY: event.clientY,\n        movementX: event.movementX,\n        movementY: event.movementY,\n        timeStamp: event.timeStamp + $893e90c2dcf687ac$var$timeStampOffset,\n        pressure: $893e90c2dcf687ac$var$pressureNormalizer.normalize(event.pressure),\n        buttons: determineButtons(),\n        button: event.button,\n        coalescedArr: [],\n        eventPreventDefault: function() {\n            return event.preventDefault();\n        },\n        eventStopPropagation: function() {\n            return event.stopPropagation();\n        }\n    };\n    event.corrected = correctedObj;\n    var customPressure = null;\n    if (\"pointerId\" in event) {\n        if (\"pressure\" in event && event.buttons !== 0 && ([\n            \"mouse\"\n        ].includes(event.pointerType) || event.pointerType === \"touch\" && event.pressure === 0)) {\n            correctedObj.pressure = 1;\n            customPressure = 1;\n        }\n    } else {\n        correctedObj.pointerId = 0;\n        correctedObj.pointerType = \"mouse\";\n        correctedObj.pressure = event.buttons !== 0 ? 1 : 0;\n        customPressure = correctedObj.pressure;\n    }\n    if ((0, $6J2My.isFirefox) && event.pointerType != \"mouse\" && event.type === \"pointermove\" && event.buttons === 0) correctedObj.buttons = 1; // todo wrong if no buttons actually pressed\n    var coalescedEventArr = [];\n    if (\"getCoalescedEvents\" in event) coalescedEventArr = event.getCoalescedEvents();\n    // chrome somehow movementX not same scale as pageX. todo: only chrome?\n    // so make my own\n    var pointerObj = $893e90c2dcf687ac$var$getPointer(correctedObj) || $893e90c2dcf687ac$var$addPointer(correctedObj);\n    var totalLastX = pointerObj.lastPageX;\n    var totalLastY = pointerObj.lastPageY;\n    for(var i = 0; i < coalescedEventArr.length; i++){\n        var eventItem = coalescedEventArr[i];\n        correctedObj.coalescedArr.push({\n            pageX: eventItem.pageX,\n            pageY: eventItem.pageY,\n            clientX: eventItem.clientX,\n            clientY: eventItem.clientY,\n            movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\n            movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\n            timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : eventItem.timeStamp + $893e90c2dcf687ac$var$timeStampOffset,\n            pressure: customPressure === null ? $893e90c2dcf687ac$var$pressureNormalizer.normalize(eventItem.pressure) : customPressure\n        });\n        pointerObj.lastPageX = eventItem.pageX;\n        pointerObj.lastPageY = eventItem.pageY;\n    }\n    pointerObj.lastPageX = correctedObj.pageX;\n    pointerObj.lastPageY = correctedObj.pageY;\n    correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\n    correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\n    return correctedObj;\n}\nvar $893e90c2dcf687ac$export$9371bd96776f4e82 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function PointerListener(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, PointerListener);\n        this.isDestroyed = false;\n        this.isOverCounter = 0;\n        // pointers that are pressing a button\n        this.dragObjArr = [];\n        this.dragPointerIdArr = [];\n        // chrome input glitch workaround\n        this.lastPointerType = null;\n        this.didSkip = false;\n        this.targetElement = p.target;\n        this.onPointerCallback = p.onPointer;\n        this.onWheelCallback = p.onWheel;\n        this.onEnterLeaveCallback = p.onEnterLeave;\n        this.maxPointers = Math.max(1, p.maxPointers || 1);\n        this.wheelCleaner = new (0, $93oLo.WheelCleaner)(function(cleanerEvent) {\n            if (_this.isDestroyed || !_this.onWheelCallback) return;\n            var bounds = _this.targetElement.getBoundingClientRect();\n            var whlEvent = (0, $4EWN2._)((0, $cL71g._)({}, cleanerEvent), {\n                relX: cleanerEvent.clientX - bounds.left + _this.targetElement.scrollLeft,\n                relY: cleanerEvent.clientY - bounds.top + _this.targetElement.scrollTop\n            });\n            _this.onWheelCallback(whlEvent);\n        });\n        if (this.onPointerCallback) {\n            this.onPointerMove = function(event) {\n                var correctedEvent = $893e90c2dcf687ac$var$correctPointerEvent(event);\n                var tempLastPointerType = _this.lastPointerType;\n                _this.lastPointerType = correctedEvent.pointerType;\n                if (_this.dragPointerIdArr.includes(correctedEvent.pointerId) || _this.dragPointerIdArr.length === _this.maxPointers || correctedEvent.pointerType === \"touch\") {\n                    _this.didSkip = false;\n                    return;\n                }\n                // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\n                if (!_this.didSkip && correctedEvent.pointerType === \"mouse\" && tempLastPointerType === \"pen\") {\n                    _this.didSkip = true;\n                    return;\n                }\n                _this.didSkip = false;\n                var outEvent = _this.createPointerOutEvent(\"pointermove\", correctedEvent);\n                _this.onPointerCallback && _this.onPointerCallback(outEvent);\n            };\n            this.onPointerDown = function(event, onSkipGlobal) {\n                //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\n                var correctedEvent = $893e90c2dcf687ac$var$correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' pointerdown');\n                if (_this.dragPointerIdArr.includes(correctedEvent.pointerId) || _this.dragPointerIdArr.length === _this.maxPointers || ![\n                    1,\n                    2,\n                    4\n                ].includes(correctedEvent.buttons)) //BB.throwOut('pointerdown ignored');\n                return;\n                //set up global listeners\n                if (_this.dragObjArr.length === 0 && !onSkipGlobal) _this.setupDocumentListeners();\n                var dragObj = {\n                    pointerId: correctedEvent.pointerId,\n                    pointerType: correctedEvent.pointerType,\n                    downPageX: correctedEvent.pageX,\n                    downPageY: correctedEvent.pageY,\n                    buttons: correctedEvent.buttons,\n                    lastPageX: correctedEvent.pageX,\n                    lastPageY: correctedEvent.pageY,\n                    lastTimeStamp: correctedEvent.timeStamp\n                };\n                _this.dragObjArr.push(dragObj);\n                _this.dragPointerIdArr.push(correctedEvent.pointerId);\n                var outEvent = _this.createPointerOutEvent(\"pointerdown\", correctedEvent, {\n                    downPageX: correctedEvent.pageX,\n                    downPageY: correctedEvent.pageY,\n                    button: $893e90c2dcf687ac$var$getButtonStr(correctedEvent.buttons),\n                    pressure: correctedEvent.pressure\n                });\n                _this.onPointerCallback && _this.onPointerCallback(outEvent);\n            };\n            this.windowOnPointerMove = function(event) {\n                //BB.throwOut('pointermove ' + event.pointerId);\n                var correctedEvent = $893e90c2dcf687ac$var$correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\n                if (!_this.dragPointerIdArr.includes(correctedEvent.pointerId)) return;\n                var dragObj = _this.getDragObj(correctedEvent.pointerId);\n                if (!dragObj) // todo need to handle this!\n                return;\n                //if pointer changes button its pressing -> turn into pointerup\n                if (correctedEvent.buttons !== dragObj.buttons) {\n                    //pointer up\n                    //remove listener\n                    if (_this.dragObjArr.length === 1) _this.destroyDocumentListeners();\n                    _this.removeDragObj(correctedEvent.pointerId);\n                    var outEvent = _this.createPointerOutEvent(\"pointerup\", correctedEvent, {\n                        downPageX: dragObj.downPageX,\n                        downPageY: dragObj.downPageY\n                    });\n                    _this.onPointerCallback && _this.onPointerCallback(outEvent);\n                    return;\n                }\n                // ipad likes to do this\n                if (correctedEvent.pointerType === \"pen\" && correctedEvent.pageX === dragObj.lastPageX && correctedEvent.pageY === dragObj.lastPageY && correctedEvent.timeStamp === dragObj.lastTimeStamp) //ignore\n                return;\n                var outEvent1 = _this.createPointerOutEvent(\"pointermove\", correctedEvent, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY,\n                    button: $893e90c2dcf687ac$var$getButtonStr(correctedEvent.buttons),\n                    pressure: correctedEvent.pressure\n                });\n                dragObj.lastPageX = correctedEvent.pageX;\n                dragObj.lastPageY = correctedEvent.pageY;\n                dragObj.lastTimeStamp = correctedEvent.timeStamp;\n                _this.onPointerCallback && _this.onPointerCallback(outEvent1);\n            };\n            this.windowOnPointerUp = function(event) {\n                //BB.throwOut('pointerup ' + event.pointerId);\n                var correctedEvent = $893e90c2dcf687ac$var$correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\n                if (!_this.dragPointerIdArr.includes(correctedEvent.pointerId)) return;\n                //remove listener\n                if (_this.dragObjArr.length === 1) _this.destroyDocumentListeners();\n                var dragObj = _this.removeDragObj(correctedEvent.pointerId);\n                if (!dragObj) // todo need to handle this!\n                return;\n                var outEvent = _this.createPointerOutEvent(\"pointerup\", correctedEvent, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY\n                });\n                _this.onPointerCallback && _this.onPointerCallback(outEvent);\n            };\n            this.windowOnPointerLeave = function(event) {\n                //BB.throwOut('pointerleave ' + event.pointerId);\n                var correctedEvent = $893e90c2dcf687ac$var$correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\n                if (!_this.dragPointerIdArr.includes(correctedEvent.pointerId)) return;\n                //remove listener\n                if (_this.dragObjArr.length === 1) _this.destroyDocumentListeners();\n                var dragObj = _this.removeDragObj(correctedEvent.pointerId);\n                if (!dragObj) // todo need to handle this!\n                return;\n                var outEvent = _this.createPointerOutEvent(\"pointerup\", correctedEvent, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY\n                });\n                _this.onPointerCallback && _this.onPointerCallback(outEvent);\n            };\n            this.targetElement.addEventListener($893e90c2dcf687ac$var$pointerMoveEvt, this.onPointerMove);\n            this.targetElement.addEventListener($893e90c2dcf687ac$var$pointerDownEvt, this.onPointerDown);\n            if (!(0, $6J2My.hasPointerEvents)) {\n                var touchToFakePointer = function(touch, touchEvent, isDown) {\n                    return {\n                        pointerId: touch.identifier,\n                        pointerType: \"touch\",\n                        pageX: touch.pageX,\n                        pageY: touch.pageY,\n                        clientX: touch.clientX,\n                        clientY: touch.clientY,\n                        button: isDown ? 0 : undefined,\n                        buttons: isDown ? 1 : 0,\n                        timeStamp: touchEvent.timeStamp,\n                        target: touchEvent.target,\n                        pressure: isDown ? 1 : 0,\n                        preventDefault: function() {\n                            return touchEvent.preventDefault();\n                        },\n                        stopPropagation: function() {\n                            return touchEvent.stopPropagation();\n                        }\n                    };\n                };\n                var handleTouch = function(e, type) {\n                    for(var i = 0; i < e.changedTouches.length; i++){\n                        var touch = e.changedTouches[i];\n                        var fakePointer = touchToFakePointer(touch, e, [\n                            \"start\",\n                            \"move\"\n                        ].includes(type));\n                        if (type === \"start\") _this.onPointerDown(fakePointer, false);\n                        else if (type === \"move\") _this.windowOnPointerMove(fakePointer);\n                        else if (type === \"end\") _this.windowOnPointerUp(fakePointer);\n                        else _this.windowOnPointerLeave(fakePointer);\n                    }\n                };\n                this.onTouchStart = function(e) {\n                    e.preventDefault();\n                    handleTouch(e, \"start\");\n                };\n                this.onTouchMove = function(e) {\n                    handleTouch(e, \"move\");\n                };\n                this.onTouchEnd = function(e) {\n                    handleTouch(e, \"end\");\n                };\n                this.onTouchCancel = function(e) {\n                    handleTouch(e, \"cancel\");\n                };\n                this.targetElement.addEventListener(\"touchstart\", this.onTouchStart);\n                this.targetElement.addEventListener(\"touchmove\", this.onTouchMove);\n                this.targetElement.addEventListener(\"touchend\", this.onTouchEnd);\n                this.targetElement.addEventListener(\"touchcancel\", this.onTouchCancel);\n            }\n        }\n        if (this.onWheelCallback) {\n            this.onWheel = function(e) {\n                _this.wheelCleaner.process(e);\n            };\n            this.targetElement.addEventListener(\"wheel\", this.onWheel);\n        }\n        if (this.onEnterLeaveCallback) {\n            this.onPointerEnter = function() {\n                _this.isOverCounter++;\n                _this.onEnterLeaveCallback && _this.onEnterLeaveCallback(true);\n            };\n            this.onPointerLeave = function() {\n                _this.isOverCounter--;\n                _this.onEnterLeaveCallback && _this.onEnterLeaveCallback(false);\n            };\n            this.targetElement.addEventListener($893e90c2dcf687ac$var$pointerEnterEvt, this.onPointerEnter);\n            this.targetElement.addEventListener($893e90c2dcf687ac$var$pointerLeaveEvt, this.onPointerLeave);\n        }\n        if (p.fixScribble) {\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\n            this.onTouchMoveScribbleFix = function(e) {\n                return e.preventDefault();\n            };\n            this.targetElement.addEventListener(\"touchmove\", this.onTouchMoveScribbleFix);\n        }\n    }\n    (0, $7h4XF._)(PointerListener, [\n        {\n            key: \"getDragObj\",\n            value: function getDragObj(pointerId) {\n                for(var i = 0; i < this.dragObjArr.length; i++){\n                    if (pointerId === this.dragObjArr[i].pointerId) return this.dragObjArr[i];\n                }\n                return null;\n            }\n        },\n        {\n            key: \"removeDragObj\",\n            value: function removeDragObj(pointerId) {\n                var removedDragObj = null;\n                for(var i = 0; i < this.dragPointerIdArr.length; i++)if (this.dragPointerIdArr[i] === pointerId) {\n                    removedDragObj = this.dragObjArr[i];\n                    this.dragObjArr.splice(i, 1);\n                    this.dragPointerIdArr.splice(i, 1);\n                    i--;\n                }\n                return removedDragObj;\n            }\n        },\n        {\n            key: \"createPointerOutEvent\",\n            value: /**\r\n     * Creates a value for onPointer, from a pointer event handler.\r\n     */ function createPointerOutEvent(typeStr, correctedEvent, custom) {\n                var bounds = this.targetElement.getBoundingClientRect();\n                var result = (0, $cL71g._)({\n                    type: typeStr,\n                    pointerId: correctedEvent.pointerId,\n                    pointerType: correctedEvent.pointerType,\n                    pageX: correctedEvent.pageX,\n                    pageY: correctedEvent.pageY,\n                    clientX: correctedEvent.clientX,\n                    clientY: correctedEvent.clientY,\n                    relX: correctedEvent.clientX - bounds.left + this.targetElement.scrollLeft,\n                    relY: correctedEvent.clientY - bounds.top + this.targetElement.scrollTop,\n                    dX: correctedEvent.movementX,\n                    dY: correctedEvent.movementY,\n                    time: correctedEvent.timeStamp,\n                    eventPreventDefault: correctedEvent.eventPreventDefault,\n                    eventStopPropagation: correctedEvent.eventStopPropagation\n                }, custom);\n                if (typeStr === \"pointermove\") {\n                    result.coalescedArr = [];\n                    if (correctedEvent.coalescedArr.length > 1) {\n                        var coalescedItem;\n                        for(var i = 0; i < correctedEvent.coalescedArr.length; i++){\n                            coalescedItem = correctedEvent.coalescedArr[i];\n                            result.coalescedArr.push({\n                                pageX: coalescedItem.pageX,\n                                pageY: coalescedItem.pageY,\n                                clientX: coalescedItem.clientX,\n                                clientY: coalescedItem.clientY,\n                                relX: coalescedItem.clientX - bounds.left + this.targetElement.scrollLeft,\n                                relY: coalescedItem.clientY - bounds.top + this.targetElement.scrollTop,\n                                dX: coalescedItem.movementX,\n                                dY: coalescedItem.movementY,\n                                time: coalescedItem.timeStamp\n                            });\n                        }\n                    }\n                }\n                return result;\n            }\n        },\n        {\n            key: \"setupDocumentListeners\",\n            value: function setupDocumentListeners() {\n                this.windowOnPointerMove && document.addEventListener($893e90c2dcf687ac$var$pointerMoveEvt, this.windowOnPointerMove);\n                this.windowOnPointerUp && document.addEventListener($893e90c2dcf687ac$var$pointerUpEvt, this.windowOnPointerUp);\n                this.windowOnPointerLeave && document.addEventListener($893e90c2dcf687ac$var$pointerCancelEvt, this.windowOnPointerLeave);\n                this.windowOnPointerLeave && document.addEventListener($893e90c2dcf687ac$var$pointerLeaveEvt, this.windowOnPointerLeave);\n            }\n        },\n        {\n            key: \"destroyDocumentListeners\",\n            value: function destroyDocumentListeners() {\n                this.windowOnPointerMove && document.removeEventListener($893e90c2dcf687ac$var$pointerMoveEvt, this.windowOnPointerMove);\n                this.windowOnPointerUp && document.removeEventListener($893e90c2dcf687ac$var$pointerUpEvt, this.windowOnPointerUp);\n                this.windowOnPointerLeave && document.removeEventListener($893e90c2dcf687ac$var$pointerCancelEvt, this.windowOnPointerLeave);\n                this.windowOnPointerLeave && document.removeEventListener($893e90c2dcf687ac$var$pointerLeaveEvt, this.windowOnPointerLeave);\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                if (this.isDestroyed) return;\n                this.isDestroyed = true;\n                this.onPointerEnter && this.targetElement.removeEventListener($893e90c2dcf687ac$var$pointerEnterEvt, this.onPointerEnter);\n                this.onPointerLeave && this.targetElement.removeEventListener($893e90c2dcf687ac$var$pointerLeaveEvt, this.onPointerLeave);\n                this.onPointerMove && this.targetElement.removeEventListener($893e90c2dcf687ac$var$pointerMoveEvt, this.onPointerMove);\n                this.onPointerDown && this.targetElement.removeEventListener($893e90c2dcf687ac$var$pointerDownEvt, this.onPointerDown);\n                this.onWheel && this.targetElement.removeEventListener(\"wheel\", this.onWheel);\n                this.destroyDocumentListeners();\n                this.onTouchMoveScribbleFix && document.removeEventListener(\"touchmove\", this.onTouchMoveScribbleFix);\n                this.onTouchStart && this.targetElement.removeEventListener(\"touchstart\", this.onTouchStart);\n                this.onTouchMove && this.targetElement.removeEventListener(\"touchmove\", this.onTouchMove);\n                this.onTouchEnd && this.targetElement.removeEventListener(\"touchend\", this.onTouchEnd);\n                this.onTouchCancel && this.targetElement.removeEventListener(\"touchcancel\", this.onTouchCancel);\n            }\n        }\n    ]);\n    return PointerListener;\n}();\n\n});\nparcelRequire.register(\"93oLo\", function(module, exports) {\n\n$parcel$export(module.exports, \"WheelCleaner\", function () { return $42238a223231ec71$export$c734b8535f2f8e38; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\nvar $42238a223231ec71$var$SEQUENCE_TIMEOUT_MS = 200;\nvar $42238a223231ec71$export$c734b8535f2f8e38 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function WheelCleaner(callback) {\n        (0, $cx0mh._)(this, WheelCleaner);\n        this.callback = callback;\n        this.knownUnitArr = [\n            100\n        ];\n        this.sequenceLength = 0;\n        this.sequenceUnit = null;\n        this.toEmitDelta = null;\n        this.position = null;\n    }\n    (0, $7h4XF._)(WheelCleaner, [\n        {\n            key: \"emit\",\n            value: function emit(delta) {\n                if (this.position === null || this.sequenceUnit === null) return;\n                this.callback({\n                    deltaY: Math.round(delta / this.sequenceUnit),\n                    pageX: this.position.pageX,\n                    pageY: this.position.pageY,\n                    clientX: this.position.clientX,\n                    clientY: this.position.clientY\n                });\n            }\n        },\n        {\n            key: \"endSequence\",\n            value: function endSequence() {\n                if (this.toEmitDelta !== null) {\n                    this.emit(this.toEmitDelta);\n                    this.toEmitDelta = null;\n                }\n                if (this.sequenceUnit !== null && !this.knownUnitArr.includes(this.sequenceUnit)) this.knownUnitArr.push(this.sequenceUnit);\n                this.sequenceLength = 0;\n                this.sequenceUnit = null;\n            }\n        },\n        {\n            key: \"process\",\n            value: function process(event) {\n                var _this = this;\n                this.position = {\n                    pageX: event.pageX,\n                    pageY: event.pageY,\n                    clientX: event.clientX,\n                    clientY: event.clientY\n                };\n                if (this.endSequenceTimeout) clearTimeout(this.endSequenceTimeout);\n                this.endSequenceTimeout = setTimeout(function() {\n                    return _this.endSequence();\n                }, $42238a223231ec71$var$SEQUENCE_TIMEOUT_MS);\n                //prep delta\n                var delta = event.deltaY;\n                if (\"deltaMode\" in event && event.deltaMode === 1) delta *= 100 / 3;\n                var absDelta = Math.abs(delta);\n                //sequence begins\n                if (this.sequenceLength === 0) {\n                    this.sequenceLength++;\n                    if (absDelta < 50) //dirty - probably a swipe scroll or pinch scroll on trackpad\n                    return;\n                    this.sequenceUnit = absDelta;\n                    if (this.knownUnitArr.includes(this.sequenceUnit)) //we know this unit - emit right away\n                    this.emit(delta);\n                    else //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\n                    this.toEmitDelta = delta;\n                    return;\n                }\n                if (this.sequenceUnit === null) {\n                    //previously determined dirty sequence\n                    this.toEmitDelta = null;\n                    return;\n                }\n                //sequence continues\n                if (absDelta === 0) //ignore zero scroll\n                return;\n                if (absDelta === this.sequenceUnit || absDelta / this.sequenceUnit % 1 < 0.0001 // a multiple\n                ) ;\n                else if (this.sequenceUnit / absDelta % 1 < 0.0001) //unit was actually a multiple - update it\n                this.sequenceUnit = absDelta;\n                else if (absDelta !== this.sequenceUnit) {\n                    //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\n                    this.sequenceUnit = null;\n                    this.toEmitDelta = null;\n                    return;\n                }\n                if (this.toEmitDelta !== null) {\n                    this.emit(this.toEmitDelta);\n                    this.toEmitDelta = null;\n                }\n                this.emit(delta);\n            }\n        }\n    ]);\n    return WheelCleaner;\n}();\n\n});\n\nparcelRequire.register(\"eIAon\", function(module, exports) {\n\n$parcel$export(module.exports, \"PressureNormalizer\", function () { return $e14d50e39929aa54$export$61f95f4b79132931; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eg83P = parcelRequire(\"eg83P\");\nvar $e14d50e39929aa54$export$61f95f4b79132931 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function PressureNormalizer() {\n        (0, $cx0mh._)(this, PressureNormalizer);\n        this.count = 0;\n        this.avgPressure = 0 // float [0, 1]\n        ;\n        this.normalizeIsComplete = false;\n        this.normalizeFactor = 1;\n    }\n    (0, $7h4XF._)(PressureNormalizer, [\n        {\n            // ---- public ----\n            key: \"normalize\",\n            value: function normalize(pressure) {\n                if (pressure === 0 || pressure === 1) return pressure;\n                if (this.count < 60) {\n                    if (this.count === 0 || this.count === null) this.avgPressure = pressure;\n                    else this.avgPressure = (0, $eg83P.mix)(pressure, this.avgPressure, 0.95);\n                    this.count++;\n                } else if (!this.normalizeIsComplete) {\n                    this.normalizeIsComplete = true;\n                    //BB.throwOut('avg pressure decision!' + this.avgPressure);\n                    if (this.avgPressure < 0.13) this.normalizeFactor = 2.3;\n                }\n                return Math.pow(pressure, 1 / this.normalizeFactor);\n            }\n        }\n    ]);\n    return PressureNormalizer;\n}();\n\n});\nparcelRequire.register(\"eg83P\", function(module, exports) {\n\n$parcel$export(module.exports, \"mix\", function () { return $9a5bdb07e7a7c42f$export$2c9e8a9632a706b2; });\n$parcel$export(module.exports, \"dist\", function () { return $9a5bdb07e7a7c42f$export$6c4a311cc157c764; });\n$parcel$export(module.exports, \"distSquared\", function () { return $9a5bdb07e7a7c42f$export$499eb56409f6cbc2; });\n$parcel$export(module.exports, \"lenSquared\", function () { return $9a5bdb07e7a7c42f$export$a4f99f99d3e99cfa; });\n$parcel$export(module.exports, \"pointsToAngleRad\", function () { return $9a5bdb07e7a7c42f$export$627023b405ba5028; });\n$parcel$export(module.exports, \"pointsToAngleDeg\", function () { return $9a5bdb07e7a7c42f$export$c03a8450eabc2532; });\n$parcel$export(module.exports, \"isInsideRect\", function () { return $9a5bdb07e7a7c42f$export$151bd845d70e2099; });\n$parcel$export(module.exports, \"clamp\", function () { return $9a5bdb07e7a7c42f$export$7d15b64cf5a3a4c4; });\n$parcel$export(module.exports, \"rotate\", function () { return $9a5bdb07e7a7c42f$export$bb628a54ab399bc9; });\n$parcel$export(module.exports, \"rotateAround\", function () { return $9a5bdb07e7a7c42f$export$95ec0760d3d00713; });\n$parcel$export(module.exports, \"intDxy\", function () { return $9a5bdb07e7a7c42f$export$bbf9af158036c5e9; });\n$parcel$export(module.exports, \"roundEven\", function () { return $9a5bdb07e7a7c42f$export$94cce7adf2ec2d08; });\n$parcel$export(module.exports, \"roundUneven\", function () { return $9a5bdb07e7a7c42f$export$f373b6a7b0c159a; });\n$parcel$export(module.exports, \"round\", function () { return $9a5bdb07e7a7c42f$export$2077e0241d6afd3c; });\n$parcel$export(module.exports, \"updateBounds\", function () { return $9a5bdb07e7a7c42f$export$f4467a4f41373bc7; });\n$parcel$export(module.exports, \"boundsInArea\", function () { return $9a5bdb07e7a7c42f$export$bbb91bbc54e7d9ac; });\nfunction $9a5bdb07e7a7c42f$export$2c9e8a9632a706b2(a, b, f) {\n    return a * (1 - f) + b * f;\n}\nfunction $9a5bdb07e7a7c42f$export$6c4a311cc157c764(ax, ay, bx, by) {\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\n}\nfunction $9a5bdb07e7a7c42f$export$499eb56409f6cbc2(ax, ay, bx, by) {\n    // faster because no square-root\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\n}\nfunction $9a5bdb07e7a7c42f$export$a4f99f99d3e99cfa(x, y) {\n    // faster because no square-root\n    return x * x + y * y;\n}\nfunction $9a5bdb07e7a7c42f$export$627023b405ba5028(p1, p2) {\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n}\nfunction $9a5bdb07e7a7c42f$export$c03a8450eabc2532(p1, p2) {\n    return $9a5bdb07e7a7c42f$export$627023b405ba5028(p1, p2) * 180 / Math.PI;\n}\nfunction $9a5bdb07e7a7c42f$export$151bd845d70e2099(p, rect) {\n    return rect.x <= p.x && p.x <= rect.x + rect.width && rect.y <= p.y && p.y <= rect.y + rect.height;\n}\nfunction $9a5bdb07e7a7c42f$export$7d15b64cf5a3a4c4(num, min, max) {\n    return num < min ? min : num > max ? max : num;\n}\nfunction $9a5bdb07e7a7c42f$export$bb628a54ab399bc9(x, y, deg) {\n    var theta = deg * (Math.PI / 180);\n    var cs = Math.cos(theta);\n    var sn = Math.sin(theta);\n    return {\n        x: x * cs - y * sn,\n        y: x * sn + y * cs\n    };\n}\nfunction $9a5bdb07e7a7c42f$export$95ec0760d3d00713(center, point, deg) {\n    var rot = $9a5bdb07e7a7c42f$export$bb628a54ab399bc9(point.x - center.x, point.y - center.y, deg);\n    rot.x += center.x;\n    rot.y += center.y;\n    return rot;\n}\nfunction $9a5bdb07e7a7c42f$export$bbf9af158036c5e9(remainder, fDx, fDy) {\n    remainder.x += fDx;\n    remainder.y += fDy;\n    var dX = Math.round(remainder.x);\n    var dY = Math.round(remainder.y);\n    remainder.x -= dX;\n    remainder.y -= dY;\n    return {\n        dX: dX,\n        dY: dY\n    };\n}\nfunction $9a5bdb07e7a7c42f$export$94cce7adf2ec2d08(f) {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) return f;\n        return f + 1;\n    }\n    var above = Math.ceil(f);\n    var below = Math.floor(f);\n    if (above % 2 === 0) return above;\n    else return below;\n}\nfunction $9a5bdb07e7a7c42f$export$f373b6a7b0c159a(f) {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) return f + 1;\n        return f;\n    }\n    var above = Math.ceil(f);\n    var below = Math.floor(f);\n    if (above % 2 === 1) return above;\n    else return below;\n}\nfunction $9a5bdb07e7a7c42f$export$2077e0241d6afd3c(f, digits) {\n    var digitMult = Math.pow(10, digits);\n    return Math.round(f /* + Number.EPSILON*/  * digitMult) / digitMult;\n}\nfunction $9a5bdb07e7a7c42f$export$f4467a4f41373bc7(target, bounds) {\n    if (!bounds && !target) throw new Error(\"at least one param needs to be defined\");\n    if (!bounds) return target;\n    if (!target) target = {\n        x1: bounds.x1,\n        y1: bounds.y1,\n        x2: bounds.x2,\n        y2: bounds.y2\n    };\n    else {\n        target.x1 = Math.min(target.x1, bounds.x1);\n        target.y1 = Math.min(target.y1, bounds.y1);\n        target.x2 = Math.max(target.x2, bounds.x2);\n        target.y2 = Math.max(target.y2, bounds.y2);\n    }\n    return target;\n}\nfunction $9a5bdb07e7a7c42f$export$bbb91bbc54e7d9ac(bounds, width, height) {\n    if (!bounds) return undefined;\n    var x1 = Math.max(0, bounds.x1);\n    var y1 = Math.max(0, bounds.y1);\n    var x2 = Math.min(width - 1, bounds.x2);\n    var y2 = Math.min(height - 1, bounds.y2);\n    if (x1 > x2 || y1 > y2) return undefined;\n    return {\n        x1: x1,\n        y1: y1,\n        x2: x2,\n        y2: y2\n    };\n}\n\n});\n\n\n\nparcelRequire.register(\"eIcQa\", function(module, exports) {\n\n$parcel$export(module.exports, \"copyCanvas\", function () { return $3f0e2f35371c9852$export$dd0873c0fb3ccff6; });\n$parcel$export(module.exports, \"ctx\", function () { return $3f0e2f35371c9852$export$39f92e86d1722f3a; });\n$parcel$export(module.exports, \"testShouldPixelate\", function () { return $3f0e2f35371c9852$export$1555f643cc9a976; });\n$parcel$export(module.exports, \"drawTransformedImageWithBounds\", function () { return $3f0e2f35371c9852$export$ded2b43392504635; });\n$parcel$export(module.exports, \"drawTransformedImageOnCanvas\", function () { return $3f0e2f35371c9852$export$425a419ef9fc761f; });\n$parcel$export(module.exports, \"createCheckerCanvas\", function () { return $3f0e2f35371c9852$export$754559b36e94ea2f; });\n$parcel$export(module.exports, \"createCheckerDataUrl\", function () { return $3f0e2f35371c9852$export$42af33c76b681867; });\n$parcel$export(module.exports, \"resizeCanvas\", function () { return $3f0e2f35371c9852$export$59b33278b5b2fc8a; });\n$parcel$export(module.exports, \"convertToAlphaChannelCanvas\", function () { return $3f0e2f35371c9852$export$5a7576952c826b4f; });\n$parcel$export(module.exports, \"freeCanvas\", function () { return $3f0e2f35371c9852$export$2384aff49c9b73c2; });\n$parcel$export(module.exports, \"canvasBounds\", function () { return $3f0e2f35371c9852$export$3db033c6ee0b8700; });\n\nvar $eelgW = parcelRequire(\"eelgW\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nfunction $3f0e2f35371c9852$export$dd0873c0fb3ccff6(canvas) {\n    var resultCanvas = (0, $eelgW.createCanvas)(canvas.width, canvas.height);\n    var ctx = resultCanvas.getContext(\"2d\");\n    if (!ctx) throw new Error(\"2d context not supported or canvas already initialized\");\n    ctx.drawImage(canvas, 0, 0);\n    return resultCanvas;\n}\nfunction $3f0e2f35371c9852$export$39f92e86d1722f3a(canvas) {\n    var ctx = canvas.getContext(\"2d\");\n    if (!ctx) throw new Error(\"couldn't get 2d context\");\n    return ctx;\n}\nfunction $3f0e2f35371c9852$export$1555f643cc9a976(transform, scaleX, scaleY) {\n    if (![\n        1,\n        -1\n    ].includes(scaleX) || ![\n        1,\n        -1\n    ].includes(scaleY) || transform.width % 1 !== 0 || transform.height % 1 !== 0 || Math.abs(transform.angleDeg) % 90 !== 0) return false;\n    var whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    var width = whSwapped ? transform.height : transform.width;\n    var height = whSwapped ? transform.width : transform.height;\n    return (Math.abs(width) % 2 === 0 && transform.x % 1 === 0 || Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5) && (Math.abs(height) % 2 === 0 && transform.y % 1 === 0 || Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5);\n}\nfunction $3f0e2f35371c9852$export$ded2b43392504635(destCtx, transformImage, transform, bounds, pixelated) {\n    if (!bounds) bounds = {\n        x: 0,\n        y: 0,\n        width: transformImage.width,\n        height: transformImage.height\n    };\n    destCtx.save();\n    if (pixelated) destCtx.imageSmoothingEnabled = false;\n    else {\n        destCtx.imageSmoothingEnabled = true;\n        destCtx.imageSmoothingQuality = \"high\";\n    }\n    destCtx.translate(transform.x, transform.y);\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\n    destCtx.drawImage(transformImage, bounds.x, bounds.y, bounds.width, bounds.height, -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\n    destCtx.restore();\n}\nfunction $3f0e2f35371c9852$export$425a419ef9fc761f(baseCanvas, transformImage, transformObj) {\n    transformObj = (0, $7jh4K.copyObj)(transformObj);\n    if (!transformObj.center) transformObj.center = {\n        x: transformImage.width / 2,\n        y: transformImage.height / 2\n    };\n    if (!transformObj.scale) transformObj.scale = {\n        x: 1,\n        y: 1\n    };\n    if (!transformObj.angleDegree) transformObj.angleDegree = 0;\n    if (!transformObj.translate) transformObj.translate = {\n        x: 0,\n        y: 0\n    };\n    var ctx = baseCanvas.getContext(\"2d\");\n    if (!ctx) throw new Error(\"2d context not supported or canvas already initialized\");\n    ctx.save();\n    if (Math.abs(transformObj.scale.x - 1) > 0.000001 || Math.abs(transformObj.scale.y - 1) > 0.000001 || Math.abs(transformObj.angleDegree % 90) > 0.000001) {\n        ctx.imageSmoothingEnabled = true;\n        ctx.imageSmoothingQuality = \"high\";\n    } else ctx.imageSmoothingEnabled = false;\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\n    ctx.translate(transformObj.center.x, transformObj.center.y);\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\n    ctx.restore();\n}\nvar $3f0e2f35371c9852$export$754559b36e94ea2f = function createCheckerCanvas(size, isDark) {\n    var canvas = (0, $eelgW.createCanvas)();\n    var ctx;\n    if (size < 1) {\n        canvas.width = 1;\n        canvas.height = 1;\n        ctx = canvas.getContext(\"2d\");\n        if (!ctx) throw new Error(\"2d context not supported or canvas already initialized\");\n        ctx.fillStyle = \"rgb(128, 128, 128)\";\n        ctx.fillRect(0, 0, 1, 1);\n    } else if (size > 200) {\n        canvas.width = 401;\n        canvas.height = 401;\n    } else {\n        canvas.width = size * 2;\n        canvas.height = size * 2;\n        ctx = canvas.getContext(\"2d\");\n        if (!ctx) throw new Error(\"2d context not supported or canvas already initialized\");\n        ctx.fillStyle = isDark ? \"rgb(90, 90, 90)\" : \"rgb(255, 255, 255)\";\n        ctx.fillRect(0, 0, size * 2, size * 2);\n        ctx.fillStyle = isDark ? \"rgb(63, 63, 63)\" : \"rgb(200, 200, 200)\";\n        ctx.fillRect(0, 0, size, size);\n        ctx.fillRect(size, size, size * 2, size * 2);\n    }\n    return canvas;\n};\nvar $3f0e2f35371c9852$export$42af33c76b681867 = function() {\n    var cache = {\n        \"8l\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC\",\n        \"4l\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC\"\n    };\n    return function(size, callback, isDark) {\n        var create = function create(size) {\n            size = parseInt(\"\" + size);\n            if (cache[\"\" + size + modeStr]) return cache[\"\" + size + modeStr];\n            var canvas = $3f0e2f35371c9852$export$754559b36e94ea2f(size, isDark);\n            var result = canvas.toDataURL(\"image/png\");\n            cache[\"\" + size + modeStr] = result;\n            return result;\n        };\n        var modeStr = isDark ? \"d\" : \"l\";\n        if (callback) setTimeout(function() {\n            callback(create(size));\n        }, 1);\n        else return create(size);\n    };\n}();\nfunction $3f0e2f35371c9852$export$59b33278b5b2fc8a(canvas, w, h, tmp1, tmp2) {\n    var getBase2Obj = //determine base 2 exponents of old and new size\n    function getBase2Obj(oldW, oldH, newW, newH) {\n        var result = {\n            oldWidthEx: Math.round(Math.log2(oldW)),\n            oldHeightEx: Math.round(Math.log2(oldH)),\n            newWidthEx: Math.ceil(Math.log2(newW)),\n            newHeightEx: Math.ceil(Math.log2(newH))\n        };\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\n        return result;\n    };\n    if (!w || !h || w === canvas.width && h === canvas.height) return;\n    w = Math.max(w, 1);\n    h = Math.max(h, 1);\n    if (w <= canvas.width && h <= canvas.height) {\n        tmp1 = !tmp1 ? (0, $eelgW.createCanvas)() : tmp1;\n        tmp2 = !tmp2 ? (0, $eelgW.createCanvas)() : tmp2;\n        var base2 = getBase2Obj(canvas.width, canvas.height, w, h);\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\n        tmp1.getContext(\"2d\").save();\n        tmp2.getContext(\"2d\").save();\n        var ew, eh;\n        var buffer1 = tmp1, buffer2 = tmp2;\n        ew = base2.oldWidthEx;\n        eh = base2.oldHeightEx;\n        var bufferCtx = buffer2.getContext(\"2d\");\n        bufferCtx.imageSmoothingEnabled = true;\n        bufferCtx.imageSmoothingQuality = \"high\";\n        bufferCtx.globalCompositeOperation = \"copy\";\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\n        var currentWidth = buffer2.width;\n        var currentHeight = buffer2.height;\n        //stepwise half the size\n        for(; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--){\n            bufferCtx = buffer1.getContext(\"2d\");\n            bufferCtx.imageSmoothingEnabled = true;\n            bufferCtx.imageSmoothingQuality = \"high\";\n            bufferCtx.globalCompositeOperation = \"copy\";\n            var newWidth = ew > base2.newWidthEx ? currentWidth / 2 : currentWidth;\n            var newHeight = eh > base2.newHeightEx ? currentHeight / 2 : currentHeight;\n            //buffer also needs to be properly sized, unfortunately\n            buffer1.width = newWidth;\n            buffer1.height = newHeight;\n            bufferCtx.drawImage(buffer2, 0, 0, currentWidth, currentHeight, 0, 0, newWidth, newHeight);\n            currentWidth = newWidth;\n            currentHeight = newHeight;\n            //swap\n            var tmp = buffer1;\n            buffer1 = buffer2;\n            buffer2 = tmp;\n        }\n        //when no longer can be halved, bring to target size\n        canvas.width = w;\n        canvas.height = h;\n        var canvasCtx = canvas.getContext(\"2d\");\n        canvasCtx.save();\n        canvasCtx.imageSmoothingEnabled = true;\n        canvasCtx.imageSmoothingQuality = \"high\";\n        canvasCtx.drawImage(buffer2, 0, 0, currentWidth, currentHeight, 0, 0, w, h);\n        canvasCtx.restore();\n        tmp1.getContext(\"2d\").restore();\n        tmp2.getContext(\"2d\").restore();\n    } else if (w >= canvas.width && h >= canvas.height) {\n        tmp1 = !tmp1 ? (0, $eelgW.createCanvas)() : tmp1;\n        tmp1.width = w;\n        tmp1.height = h;\n        var tmp1Ctx = tmp1.getContext(\"2d\");\n        tmp1Ctx.save();\n        tmp1Ctx.imageSmoothingEnabled = true;\n        tmp1Ctx.imageSmoothingQuality = \"high\";\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\n        tmp1Ctx.restore();\n        canvas.width = w;\n        canvas.height = h;\n        canvas.getContext(\"2d\").drawImage(tmp1, 0, 0);\n    } else {\n        $3f0e2f35371c9852$export$59b33278b5b2fc8a(canvas, w, canvas.height, tmp1, tmp2);\n        $3f0e2f35371c9852$export$59b33278b5b2fc8a(canvas, w, h, tmp1, tmp2);\n    }\n}\nfunction $3f0e2f35371c9852$export$5a7576952c826b4f(canvas) {\n    var imdat = canvas.getContext(\"2d\").getImageData(0, 0, canvas.width, canvas.height);\n    for(var i = 0; i < imdat.data.length; i += 4){\n        if (imdat.data[i + 3] === 0) continue;\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\n    }\n    canvas.getContext(\"2d\").putImageData(imdat, 0, 0);\n}\nfunction $3f0e2f35371c9852$export$2384aff49c9b73c2(canvas) {\n    canvas.width = 1;\n    canvas.height = 1;\n    var ctx = canvas.getContext(\"2d\");\n    ctx && ctx.clearRect(0, 0, 1, 1);\n}\nfunction $3f0e2f35371c9852$export$3db033c6ee0b8700(context) {\n    var boundsObj = {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0\n    };\n    {\n        var tempBounds = {\n            x1: undefined,\n            y1: undefined,\n            x2: undefined,\n            y2: undefined\n        };\n        var imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\n        if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\n            tempBounds.x1 = 0;\n            tempBounds.y1 = 0;\n            tempBounds.x2 = context.canvas.width - 1;\n            tempBounds.y2 = context.canvas.height - 1;\n        } else {\n            for(var i = 3; i < imdat.data.length; i += 4)if (imdat.data[i] > 0) {\n                var x = (i - 3) / 4 % context.canvas.width;\n                var y = Math.floor((i - 3) / 4 / context.canvas.width);\n                if (tempBounds.x1 === undefined || tempBounds.x1 > x) tempBounds.x1 = x;\n                if (tempBounds.y1 === undefined) tempBounds.y1 = y;\n                if (tempBounds.x2 === undefined || tempBounds.x2 < x) tempBounds.x2 = x;\n                if (tempBounds.y2 === undefined || tempBounds.y2 < y) tempBounds.y2 = y;\n            }\n        }\n        if (tempBounds.x1 === undefined || tempBounds.y1 === undefined || tempBounds.x2 === undefined || tempBounds.y2 === undefined) return undefined;\n        boundsObj.x = tempBounds.x1;\n        boundsObj.y = tempBounds.y1;\n        boundsObj.width = tempBounds.x2 - tempBounds.x1 + 1;\n        boundsObj.height = tempBounds.y2 - tempBounds.y1 + 1;\n    }\n    return boundsObj;\n}\n\n});\nparcelRequire.register(\"eelgW\", function(module, exports) {\n\n$parcel$export(module.exports, \"createCanvas\", function () { return $44dda2e48e48a872$export$cd3d1f114b139967; });\n/*window['canvases'] = [];\r\n\r\nwindow['printCanvases'] = () => {\r\n    let total = 0;\r\n\r\n    console.log(window['canvases'].map(item => {\r\n        total += item.width * item.height;\r\n        return {w: item.width, h: item.height};\r\n    }));\r\n\r\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\r\n};*/ function $44dda2e48e48a872$export$cd3d1f114b139967(w, h) {\n    var result = document.createElement(\"canvas\");\n    if (w && h) {\n        result.width = w;\n        result.height = h;\n    }\n    // window['canvases'].push(result);\n    return result;\n}\n\n});\n\n\nparcelRequire.register(\"kVHNC\", function(module, exports) {\n\n$parcel$export(module.exports, \"Matrix\", function () { return $e4df33b4b16105d5$export$5b12bf1653c0dd85; });\n// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\n// not optimized\nfunction $e4df33b4b16105d5$var$getIdentity() {\n    return [\n        1,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1\n    ];\n}\n// point  matrix\nfunction $e4df33b4b16105d5$var$multiplyMatrixAndPoint(matrix, point) {\n    return [\n        point[0] * matrix[0] + point[1] * matrix[4] + point[2] * matrix[8] + point[3] * matrix[12],\n        point[0] * matrix[1] + point[1] * matrix[5] + point[2] * matrix[9] + point[3] * matrix[13],\n        point[0] * matrix[2] + point[1] * matrix[6] + point[2] * matrix[10] + point[3] * matrix[14],\n        point[0] * matrix[3] + point[1] * matrix[7] + point[2] * matrix[11] + point[3] * matrix[15]\n    ];\n}\n//matrixB  matrixA\nfunction $e4df33b4b16105d5$var$multiplyMatrices(matrixA, matrixB) {\n    // Slice the second matrix up into rows\n    var row0 = [\n        matrixB[0],\n        matrixB[1],\n        matrixB[2],\n        matrixB[3]\n    ];\n    var row1 = [\n        matrixB[4],\n        matrixB[5],\n        matrixB[6],\n        matrixB[7]\n    ];\n    var row2 = [\n        matrixB[8],\n        matrixB[9],\n        matrixB[10],\n        matrixB[11]\n    ];\n    var row3 = [\n        matrixB[12],\n        matrixB[13],\n        matrixB[14],\n        matrixB[15]\n    ];\n    // Multiply each row by matrixA\n    var result0 = $e4df33b4b16105d5$var$multiplyMatrixAndPoint(matrixA, row0);\n    var result1 = $e4df33b4b16105d5$var$multiplyMatrixAndPoint(matrixA, row1);\n    var result2 = $e4df33b4b16105d5$var$multiplyMatrixAndPoint(matrixA, row2);\n    var result3 = $e4df33b4b16105d5$var$multiplyMatrixAndPoint(matrixA, row3);\n    // Turn the result rows back into a single matrix\n    return [\n        result0[0],\n        result0[1],\n        result0[2],\n        result0[3],\n        result1[0],\n        result1[1],\n        result1[2],\n        result1[3],\n        result2[0],\n        result2[1],\n        result2[2],\n        result2[3],\n        result3[0],\n        result3[1],\n        result3[2],\n        result3[3]\n    ];\n}\nfunction $e4df33b4b16105d5$var$createTranslationMatrix(x, y) {\n    return [\n        1,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        x,\n        y,\n        0,\n        1\n    ];\n}\nfunction $e4df33b4b16105d5$var$createRotationMatrix(angleRad) {\n    //let angleRad = angleDeg / 360 * 2 * Math.PI;\n    return [\n        Math.cos(-angleRad),\n        -Math.sin(-angleRad),\n        0,\n        0,\n        Math.sin(-angleRad),\n        Math.cos(-angleRad),\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1\n    ];\n}\nfunction $e4df33b4b16105d5$var$createScaleMatrix(f) {\n    return [\n        f,\n        0,\n        0,\n        0,\n        0,\n        f,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1\n    ];\n}\nvar $e4df33b4b16105d5$export$5b12bf1653c0dd85 = Object.freeze({\n    getIdentity: $e4df33b4b16105d5$var$getIdentity,\n    multiplyMatrixAndPoint: $e4df33b4b16105d5$var$multiplyMatrixAndPoint,\n    multiplyMatrices: $e4df33b4b16105d5$var$multiplyMatrices,\n    createTranslationMatrix: $e4df33b4b16105d5$var$createTranslationMatrix,\n    createRotationMatrix: $e4df33b4b16105d5$var$createRotationMatrix,\n    createScaleMatrix: $e4df33b4b16105d5$var$createScaleMatrix\n});\n\n});\n\nparcelRequire.register(\"4toIY\", function(module, exports) {\n\n$parcel$export(module.exports, \"Vec2\", function () { return $531c9f41f98b7ec0$export$ac4bca90992eed1; });\nvar $531c9f41f98b7ec0$export$ac4bca90992eed1 = {\n    add: function add(p1, p2) {\n        return {\n            x: p1.x + p2.x,\n            y: p1.y + p2.y\n        };\n    },\n    sub: function sub(p1, p2) {\n        return {\n            x: p1.x - p2.x,\n            y: p1.y - p2.y\n        };\n    },\n    nor: function nor(p) {\n        var len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n        return {\n            x: p.x / len,\n            y: p.y / len\n        };\n    },\n    len: function len(p) {\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n    },\n    dist: function dist(p1, p2) {\n        return $531c9f41f98b7ec0$export$ac4bca90992eed1.len($531c9f41f98b7ec0$export$ac4bca90992eed1.sub(p1, p2));\n    },\n    mul: function mul(p, s) {\n        return {\n            x: p.x * s,\n            y: p.y * s\n        };\n    },\n    angle: function angle(p1, p2) {\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n    },\n    dot: function dot(a, b) {\n        var aArr = [\n            a.x,\n            a.y\n        ];\n        var bArr = [\n            b.x,\n            b.y\n        ];\n        return aArr.map(function(x, i) {\n            return aArr[i] * bArr[i];\n        }).reduce(function(m, n) {\n            return m + n;\n        });\n    }\n};\n\n});\n\nparcelRequire.register(\"af1iA\", function(module, exports) {\n\n$parcel$export(module.exports, \"projectPointOnLine\", function () { return $77ae015f37ebe4f1$export$b4c5b177db876445; });\n$parcel$export(module.exports, \"PointLine\", function () { return $77ae015f37ebe4f1$export$8b36a4a83269a640; });\n$parcel$export(module.exports, \"BezierLine\", function () { return $77ae015f37ebe4f1$export$5379d955c16d4d43; });\n$parcel$export(module.exports, \"SplineInterpolator\", function () { return $77ae015f37ebe4f1$export$80967b1eb9fd6eb4; });\n$parcel$export(module.exports, \"quadraticSplineInput\", function () { return $77ae015f37ebe4f1$export$4551d4af86c1eb08; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $4toIY = parcelRequire(\"4toIY\");\n\nvar $eg83P = parcelRequire(\"eg83P\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $77ae015f37ebe4f1$export$b4c5b177db876445 = function projectPointOnLine(lineStart, lineEnd, p) {\n    var x, y;\n    if (lineStart.x === lineEnd.x) {\n        x = lineStart.x;\n        y = p.y;\n        return {\n            x: x,\n            y: y\n        };\n    }\n    var m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\n    var b = lineStart.y - m * lineStart.x;\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\n    return {\n        x: x,\n        y: y\n    };\n};\nvar $77ae015f37ebe4f1$export$8b36a4a83269a640 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function PointLine(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, PointLine);\n        this.segmentArr = [];\n        for(var i = 0; i < p.points.length; i++)(function(i) {\n            var length = 0;\n            if (i < p.points.length - 1) length = (0, $eg83P.dist)(p.points[i].x, p.points[i].y, p.points[i + 1].x, p.points[i + 1].y);\n            _this.segmentArr[i] = {\n                x: p.points[i].x,\n                y: p.points[i].y,\n                length: length\n            };\n        })(i);\n    }\n    (0, $7h4XF._)(PointLine, [\n        {\n            // ---- interface ----\n            /**\r\n     * returns point when traveling *dist* along the line, > 0\r\n     * @param dist\r\n     */ key: \"getAtDist\",\n            value: function getAtDist(dist) {\n                var remainder = Math.min(this.getLength(), dist);\n                var i = 0;\n                for(; remainder > this.segmentArr[i].length && i < this.segmentArr.length - 2; i++)remainder -= this.segmentArr[i].length;\n                var fac = Math.min(1, Math.max(0, remainder / this.segmentArr[i].length));\n                return {\n                    x: this.segmentArr[i].x * (1 - fac) + this.segmentArr[i + 1].x * fac,\n                    y: this.segmentArr[i].y * (1 - fac) + this.segmentArr[i + 1].y * fac\n                };\n            }\n        },\n        {\n            /**\r\n     * total length of line\r\n     */ key: \"getLength\",\n            value: function getLength() {\n                var result = 0;\n                for(var i = 0; i < this.segmentArr.length - 1; i++)result += this.segmentArr[i].length;\n                return result;\n            }\n        }\n    ]);\n    return PointLine;\n}();\nvar $77ae015f37ebe4f1$export$5379d955c16d4d43 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function BezierLine() {\n        (0, $cx0mh._)(this, BezierLine);\n        this.lastDot = 0;\n        this.pointArr = [];\n    }\n    (0, $7h4XF._)(BezierLine, [\n        {\n            key: \"getBezierPoints\",\n            value: /**\r\n     * creates bezier curve from control points\r\n     * @param p1 - control point 1 {x: float, y: float}\r\n     * @param p2 - control point 2 {x: float, y: float}\r\n     * @param p3 - control point 3 {x: float, y: float}\r\n     * @param p4 - control point 4 {x: float, y: float}\r\n     * @param resolution - int\r\n     * @returns bezier curve made up of points {x: float, y: float}\r\n     */ function getBezierPoints(p1, p2, p3, p4, resolution) {\n                var curvePoints = [];\n                var t;\n                for(var i = 0; i <= resolution; i++){\n                    t = i / resolution;\n                    curvePoints[curvePoints.length] = {\n                        x: Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x,\n                        y: Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y\n                    };\n                }\n                return curvePoints;\n            }\n        },\n        {\n            // ---- interface ----\n            /**\r\n     * Add new point to line. \"Drawn\" line will go until the previous point.\r\n     *\r\n     * @param x - coord of new point\r\n     * @param y\r\n     * @param spacing - space between each step\r\n     * @param callback - calls for each step\r\n     * @param controlsCallback - calls that callback with the bezier control points\r\n     */ key: \"add\",\n            value: function add(x, y, spacing, callback, controlsCallback) {\n                if (this.lastPoint && x === this.lastPoint.x && y === this.lastPoint.y) return;\n                this.lastPoint = {\n                    x: x,\n                    y: y\n                };\n                this.pointArr[this.pointArr.length] = {\n                    x: x,\n                    y: y,\n                    spacing: spacing\n                };\n                //calculate directions\n                if (this.pointArr.length === 1) {\n                    this.lastSpacing = spacing;\n                    return;\n                } else if (this.pointArr.length === 2) {\n                    this.pointArr[0].dir = (0, $4toIY.Vec2).nor((0, $4toIY.Vec2).sub(this.pointArr[1], this.pointArr[0]));\n                    this.lastDot = spacing;\n                    this.lastSpacing = spacing;\n                    return;\n                } else {\n                    var pointM1 = this.pointArr[this.pointArr.length - 1];\n                    var pointM2 = this.pointArr[this.pointArr.length - 2];\n                    var pointM3 = this.pointArr[this.pointArr.length - 3];\n                    pointM2.dir = (0, $4toIY.Vec2).nor((0, $4toIY.Vec2).sub(pointM1, pointM3));\n                    if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) //when xy -3 == -1\n                    pointM2.dir = (0, $7jh4K.copyObj)(pointM3.dir);\n                }\n                //get bezier curve\n                var a = this.pointArr[this.pointArr.length - 3];\n                var b = this.pointArr[this.pointArr.length - 2];\n                var p1 = a;\n                var p2 = (0, $4toIY.Vec2).add(a, (0, $4toIY.Vec2).mul(a.dir, (0, $4toIY.Vec2).dist(a, b) / 4));\n                var p3 = (0, $4toIY.Vec2).sub(b, (0, $4toIY.Vec2).mul(b.dir, (0, $4toIY.Vec2).dist(a, b) / 4));\n                var p4 = b;\n                var pointLine;\n                if (callback) {\n                    var curvePoints = this.getBezierPoints(p1, p2, p3, p4, 20);\n                    pointLine = new $77ae015f37ebe4f1$export$8b36a4a83269a640({\n                        points: curvePoints\n                    });\n                } else pointLine = new $77ae015f37ebe4f1$export$8b36a4a83269a640({\n                    points: [\n                        p1,\n                        p4\n                    ]\n                });\n                //iterate over curve with spacing and callback\n                var len = pointLine.getLength();\n                var tempSpacing = (0, $eg83P.mix)(this.lastSpacing, spacing, (0, $eg83P.clamp)(this.lastDot / len, 0, 1));\n                var d = this.lastDot;\n                for(; d <= len; d += tempSpacing){\n                    tempSpacing = (0, $eg83P.mix)(this.lastSpacing, spacing, (0, $eg83P.clamp)(d / len, 0, 1));\n                    var point = pointLine.getAtDist(d);\n                    var angle = this.lastCallbackPoint ? (0, $eg83P.pointsToAngleDeg)(this.lastCallbackPoint, point) : undefined;\n                    if (callback) callback({\n                        x: point.x,\n                        y: point.y,\n                        t: d / len,\n                        angle: angle,\n                        dAngle: this.lastCallbackPoint ? angle - this.lastAngle : 0\n                    });\n                    this.lastCallbackPoint = point;\n                    this.lastAngle = angle;\n                }\n                if (callback) this.lastDot = d - len;\n                else {\n                    this.lastDot = 0;\n                    controlsCallback && controlsCallback({\n                        p1: p1,\n                        p2: p2,\n                        p3: p3,\n                        p4: p4\n                    });\n                }\n                this.lastSpacing = spacing;\n            }\n        },\n        {\n            key: \"addFinal\",\n            value: function addFinal(spacing, callback, controlsCallback) {\n                if (this.pointArr.length < 2) return;\n                var p1 = this.pointArr[this.pointArr.length - 2];\n                var p2 = this.pointArr[this.pointArr.length - 1];\n                var newP = (0, $4toIY.Vec2).add(p2, (0, $4toIY.Vec2).sub(p2, p1));\n                this.add(newP.x, newP.y, spacing, callback, controlsCallback);\n            }\n        }\n    ]);\n    return BezierLine;\n}();\nvar $77ae015f37ebe4f1$export$80967b1eb9fd6eb4 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function SplineInterpolator(points) {\n        (0, $cx0mh._)(this, SplineInterpolator);\n        var n = points.length;\n        this.xa = [];\n        this.ya = [];\n        this.u = [];\n        this.y2 = [];\n        var i;\n        this.first = points[0][0];\n        this.last = points[points.length - 1][0];\n        points.sort(function(a, b) {\n            return a[0] - b[0];\n        });\n        for(i = 0; i < n; i++){\n            this.xa.push(points[i][0]);\n            this.ya.push(points[i][1]);\n        }\n        this.u[0] = 0;\n        this.y2[0] = 0;\n        for(i = 1; i < n - 1; ++i){\n            // This is the decomposition loop of the tridiagonal algorithm.\n            // y2 and u are used for temporary storage of the decomposed factors.\n            var wx = this.xa[i + 1] - this.xa[i - 1];\n            var sig = (this.xa[i] - this.xa[i - 1]) / wx;\n            var p = sig * this.y2[i - 1] + 2.0;\n            this.y2[i] = (sig - 1.0) / p;\n            var ddydx = (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) - (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\n            this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\n        }\n        this.y2[n - 1] = 0;\n        // This is the backsubstitution loop of the tridiagonal algorithm\n        for(i = n - 2; i >= 0; --i)this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\n    }\n    (0, $7h4XF._)(SplineInterpolator, [\n        {\n            // ---- interface ----\n            key: \"getFirstX\",\n            value: function getFirstX() {\n                return this.first;\n            }\n        },\n        {\n            key: \"getLastX\",\n            value: function getLastX() {\n                return this.last;\n            }\n        },\n        {\n            key: \"interpolate\",\n            value: function interpolate(x) {\n                var n = this.ya.length;\n                var klo = 0;\n                var khi = n - 1;\n                // We will find the right place in the table by means of\n                // bisection. This is optimal if sequential calls to this\n                // routine are at random values of x. If sequential calls\n                // are in order, and closely spaced, one would do better\n                // to store previous values of klo and khi.\n                while(khi - klo > 1){\n                    var k = khi + klo >> 1;\n                    if (this.xa[k] > x) khi = k;\n                    else klo = k;\n                }\n                var h = this.xa[khi] - this.xa[klo];\n                var a = (this.xa[khi] - x) / h;\n                var b = (x - this.xa[klo]) / h;\n                // Cubic spline polynomial is now evaluated.\n                return a * this.ya[klo] + b * this.ya[khi] + ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\n            }\n        },\n        {\n            /**\r\n     * find x to y. simply by stepping through. suboptimal, so don't call often.\r\n     * searches in x 0-1 range\r\n     */ key: \"findX\",\n            value: function findX(y, resolution) {\n                var x;\n                var dist;\n                for(var i = 0; i <= resolution; i++){\n                    var tempX = i / resolution;\n                    var tempY = this.interpolate(tempX);\n                    if (x === undefined) {\n                        x = tempX;\n                        dist = Math.abs(tempY - y);\n                        continue;\n                    }\n                    var tempDist = Math.abs(tempY - y);\n                    if (tempDist < dist) {\n                        x = tempX;\n                        dist = tempDist;\n                    } else break;\n                }\n                return x;\n            }\n        }\n    ]);\n    return SplineInterpolator;\n}();\nfunction $77ae015f37ebe4f1$export$4551d4af86c1eb08(startVal, endVal, stepSize) {\n    var round = function round(v, dec) {\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\n    };\n    var resultArr = [];\n    for(var i = 0; i <= 1; i += stepSize)resultArr.push([\n        round(i, 4),\n        round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)\n    ]);\n    return resultArr;\n}\n\n});\n\nparcelRequire.register(\"dJ1E2\", function(module, exports) {\n\n$parcel$export(module.exports, \"HSV\", function () { return $5e7aac2fa49b6b1f$export$d2edaecd208aed43; });\n$parcel$export(module.exports, \"RGB\", function () { return $5e7aac2fa49b6b1f$export$8f9ece5a47764b93; });\n$parcel$export(module.exports, \"CMYK\", function () { return $5e7aac2fa49b6b1f$export$89d3f85304bf0767; });\n$parcel$export(module.exports, \"ColorConverter\", function () { return $5e7aac2fa49b6b1f$export$fb7efcd2e153af6e; });\n$parcel$export(module.exports, \"testIsWhiteBestContrast\", function () { return $5e7aac2fa49b6b1f$export$5cf396345d1238ae; });\n// based on js color conversion http://www.webtoolkit.info/\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\nvar $5e7aac2fa49b6b1f$export$d2edaecd208aed43 = function HSV(h, s, v) {\n    \"use strict\";\n    (0, $cx0mh._)(this, HSV);\n    this.h = Math.max(0, Math.min(360, h));\n    this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\n    this.v = Math.max(0, Math.min(100, v));\n};\nvar $5e7aac2fa49b6b1f$export$8f9ece5a47764b93 = function RGB(r, g, b) {\n    \"use strict\";\n    (0, $cx0mh._)(this, RGB);\n    this.r = Math.max(0, Math.min(255, r));\n    this.g = Math.max(0, Math.min(255, g));\n    this.b = Math.max(0, Math.min(255, b));\n};\nvar $5e7aac2fa49b6b1f$export$89d3f85304bf0767 = function CMYK(c, m, y, k) {\n    \"use strict\";\n    (0, $cx0mh._)(this, CMYK);\n    this.c = Math.max(0, Math.min(100, c));\n    this.m = Math.max(0, Math.min(100, m));\n    this.y = Math.max(0, Math.min(100, y));\n    this.k = Math.max(0, Math.min(100, k));\n};\nvar $5e7aac2fa49b6b1f$export$fb7efcd2e153af6e = {\n    _RGBtoHSV: function _RGBtoHSV(RGB) {\n        var result = new $5e7aac2fa49b6b1f$export$d2edaecd208aed43(0, 0, 0);\n        var r = RGB.r / 255;\n        var g = RGB.g / 255;\n        var b = RGB.b / 255;\n        var minVal = Math.min(r, g, b);\n        var maxVal = Math.max(r, g, b);\n        var delta = maxVal - minVal;\n        result.v = maxVal;\n        if (delta == 0) {\n            result.h = 0;\n            result.s = 0;\n        } else {\n            result.s = delta / maxVal;\n            var del_R = ((maxVal - r) / 6 + delta / 2) / delta;\n            var del_G = ((maxVal - g) / 6 + delta / 2) / delta;\n            var del_B = ((maxVal - b) / 6 + delta / 2) / delta;\n            if (r == maxVal) result.h = del_B - del_G;\n            else if (g == maxVal) result.h = 1 / 3 + del_R - del_B;\n            else if (b == maxVal) result.h = 2 / 3 + del_G - del_R;\n            if (result.h < 0) result.h += 1;\n            if (result.h > 1) result.h -= 1;\n        }\n        result.h = Math.round(result.h * 360);\n        result.s = Math.round(result.s * 100);\n        result.v = Math.round(result.v * 100);\n        return result;\n    },\n    _HSVtoRGB: function _HSVtoRGB(HSV) {\n        var result = new $5e7aac2fa49b6b1f$export$8f9ece5a47764b93(0, 0, 0);\n        var var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\n        var h = HSV.h / 360 % 1;\n        var s = HSV.s / 100;\n        var v = HSV.v / 100;\n        if (s == 0) {\n            result.r = v * 255;\n            result.g = v * 255;\n            result.b = v * 255;\n        } else {\n            var_h = h * 6;\n            var_i = Math.floor(var_h);\n            var_1 = v * (1 - s);\n            var_2 = v * (1 - s * (var_h - var_i));\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\n            if (var_i == 0) {\n                var_r = v;\n                var_g = var_3;\n                var_b = var_1;\n            } else if (var_i == 1) {\n                var_r = var_2;\n                var_g = v;\n                var_b = var_1;\n            } else if (var_i == 2) {\n                var_r = var_1;\n                var_g = v;\n                var_b = var_3;\n            } else if (var_i == 3) {\n                var_r = var_1;\n                var_g = var_2;\n                var_b = v;\n            } else if (var_i == 4) {\n                var_r = var_3;\n                var_g = var_1;\n                var_b = v;\n            } else {\n                var_r = v;\n                var_g = var_1;\n                var_b = var_2;\n            }\n            result.r = var_r * 255;\n            result.g = var_g * 255;\n            result.b = var_b * 255;\n            result.r = Math.round(result.r);\n            result.g = Math.round(result.g);\n            result.b = Math.round(result.b);\n        }\n        return result;\n    },\n    _CMYKtoRGB: function _CMYKtoRGB(CMYK) {\n        var result = new $5e7aac2fa49b6b1f$export$8f9ece5a47764b93(0, 0, 0);\n        var c = CMYK.c / 100;\n        var m = CMYK.m / 100;\n        var y = CMYK.y / 100;\n        var k = CMYK.k / 100;\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\n        result.r = Math.round(result.r * 255);\n        result.g = Math.round(result.g * 255);\n        result.b = Math.round(result.b * 255);\n        return result;\n    },\n    _RGBtoCMYK: function _RGBtoCMYK(RGB) {\n        var result = new $5e7aac2fa49b6b1f$export$89d3f85304bf0767(0, 0, 0, 0);\n        var r = RGB.r / 255;\n        var g = RGB.g / 255;\n        var b = RGB.b / 255;\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\n        result.c = (1 - r - result.k) / (1 - result.k);\n        result.m = (1 - g - result.k) / (1 - result.k);\n        result.y = (1 - b - result.k) / (1 - result.k);\n        result.c = Math.round(result.c * 100);\n        result.m = Math.round(result.m * 100);\n        result.y = Math.round(result.y * 100);\n        result.k = Math.round(result.k * 100);\n        return result;\n    },\n    toRGB: function toRGB(o) {\n        if (o instanceof $5e7aac2fa49b6b1f$export$8f9ece5a47764b93) return o;\n        if (o instanceof $5e7aac2fa49b6b1f$export$d2edaecd208aed43) return this._HSVtoRGB(o);\n        if (o instanceof $5e7aac2fa49b6b1f$export$89d3f85304bf0767) return this._CMYKtoRGB(o);\n        throw new Error(\"unknown type\");\n    },\n    toHSV: function toHSV(o) {\n        if (o instanceof $5e7aac2fa49b6b1f$export$d2edaecd208aed43) return o;\n        if (o instanceof $5e7aac2fa49b6b1f$export$8f9ece5a47764b93) return this._RGBtoHSV(o);\n        if (o instanceof $5e7aac2fa49b6b1f$export$89d3f85304bf0767) return this._RGBtoHSV(this._CMYKtoRGB(o));\n        throw new Error(\"unknown type\");\n    },\n    toCMYK: function toCMYK(o) {\n        if (o instanceof $5e7aac2fa49b6b1f$export$89d3f85304bf0767) return o;\n        if (o instanceof $5e7aac2fa49b6b1f$export$8f9ece5a47764b93) return this._RGBtoCMYK(o);\n        if (o instanceof $5e7aac2fa49b6b1f$export$d2edaecd208aed43) return this._RGBtoCMYK(this._HSVtoRGB(o));\n        throw new Error(\"unknown type\");\n    },\n    toHexString: function toHexString(o) {\n        if (o instanceof $5e7aac2fa49b6b1f$export$8f9ece5a47764b93 || \"r\" in o && \"g\" in o && \"b\" in o) {\n            var ha = parseInt(\"\" + o.r).toString(16);\n            var hb = parseInt(\"\" + o.g).toString(16);\n            var hc = parseInt(\"\" + o.b).toString(16);\n            if (ha.length == 1) ha = \"0\" + ha;\n            if (hb.length == 1) hb = \"0\" + hb;\n            if (hc.length == 1) hc = \"0\" + hc;\n            return ha + hb + hc;\n        }\n        return \"#000\";\n    },\n    toRgbStr: function toRgbStr(rgbObj) {\n        return \"rgb(\" + Math.round(rgbObj.r) + \", \" + Math.round(rgbObj.g) + \", \" + Math.round(rgbObj.b) + \")\";\n    },\n    toRgbaStr: function toRgbaStr(rgbaObj) {\n        return \"rgba(\" + Math.round(rgbaObj.r) + \", \" + Math.round(rgbaObj.g) + \", \" + Math.round(rgbaObj.b) + \", \" + rgbaObj.a + \")\";\n    },\n    hexToRGB: function hexToRGB(hexStr) {\n        hexStr = hexStr.trim();\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n        var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        hexStr = hexStr.replace(shorthandRegex, function(m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n        var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\n        return result ? new $5e7aac2fa49b6b1f$export$8f9ece5a47764b93(parseInt(result[1], 16), parseInt(result[2], 16), parseInt(result[3], 16)) : undefined;\n    }\n};\nfunction $5e7aac2fa49b6b1f$export$5cf396345d1238ae(rgbObj) {\n    return rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114 < 125;\n}\n\n});\n\nparcelRequire.register(\"72Jv0\", function(module, exports) {\n\n$parcel$export(module.exports, \"appendTextDiv\", function () { return $cfe3aa45a75894cc$export$7868464f598ba79d; });\n$parcel$export(module.exports, \"isInputFocused\", function () { return $cfe3aa45a75894cc$export$906dfdb7df31ccfc; });\n$parcel$export(module.exports, \"unfocusAnyInput\", function () { return $cfe3aa45a75894cc$export$e05240ca9e0b8bd9; });\n$parcel$export(module.exports, \"clearSelection\", function () { return $cfe3aa45a75894cc$export$a3d02541b0ebf605; });\n$parcel$export(module.exports, \"makeUnfocusable\", function () { return $cfe3aa45a75894cc$export$6bd63bfceaafae0c; });\n$parcel$export(module.exports, \"el\", function () { return $cfe3aa45a75894cc$export$c3da0dad1b44eea9; });\n$parcel$export(module.exports, \"destroyEl\", function () { return $cfe3aa45a75894cc$export$b1da1db524e22115; });\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nfunction $cfe3aa45a75894cc$export$7868464f598ba79d(target, text) {\n    var div = document.createElement(\"div\");\n    div.innerHTML = text;\n    target.append(div);\n    return div;\n}\nfunction $cfe3aa45a75894cc$export$906dfdb7df31ccfc() {\n    var getAll = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : false;\n    var _document_activeElement;\n    var result = !!document.activeElement && [\n        \"INPUT\",\n        \"TEXTAREA\",\n        \"SELECT\"\n    ].includes(document.activeElement.tagName);\n    if (getAll) return result;\n    else return result && !((_document_activeElement = document.activeElement) === null || _document_activeElement === void 0 ? void 0 : _document_activeElement.getAttribute(\"data-ignore-focus\"));\n}\nfunction $cfe3aa45a75894cc$export$e05240ca9e0b8bd9() {\n    if ($cfe3aa45a75894cc$export$906dfdb7df31ccfc(true)) {\n        /*\r\n            Unfocus anything that is focused.\r\n\r\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\r\n            that isn't its direct parent, then Firefox will keep anything attached to this\r\n            Input in memory. It will not be garbage collected until a new Input is focused.\r\n\r\n            Workaround: Temporarily create an input, focus it, detach it.\r\n             */ var focusEl = (0, $eWjiX.BB).el({\n            parent: document.body,\n            tagName: \"input\",\n            css: {\n                opacity: \"0\",\n                width: \"0\",\n                height: \"0\"\n            }\n        });\n        setTimeout(function() {\n            focusEl.select();\n            focusEl.focus();\n            focusEl.remove();\n        }, 10);\n    }\n}\nfunction $cfe3aa45a75894cc$export$a3d02541b0ebf605() {\n    if (window.getSelection) {\n        var sel = window.getSelection();\n        if (sel) {\n            if (sel.empty) sel.empty();\n            else if (sel.removeAllRanges) sel.removeAllRanges();\n        }\n    }\n}\nvar $cfe3aa45a75894cc$export$6bd63bfceaafae0c = function() {\n    var preventFocus = function preventFocus(event) {\n        event.preventDefault();\n        var didFocusRelated = false;\n        if (event.relatedTarget) try {\n            event.relatedTarget.focus();\n            didFocusRelated = true;\n        } catch (e) {\n            console.error(\"failed to focus\");\n        }\n        if (!didFocusRelated) event.currentTarget.blur();\n    };\n    return function(el) {\n        el.setAttribute(\"tabindex\", \"-1\");\n        el.addEventListener(\"focus\", preventFocus);\n    };\n}();\nvar $cfe3aa45a75894cc$var$els = [];\nfunction $cfe3aa45a75894cc$export$c3da0dad1b44eea9(params) {\n    if (!params) return document.createElement(\"div\");\n    var result = document.createElement(params.tagName ? params.tagName : \"div\");\n    params.css && (0, $7jh4K.css)(result, params.css);\n    if (params.content) {\n        if (typeof params.content === \"string\") result.innerHTML = params.content;\n        else if (Array.isArray(params.content)) (0, $eWjiX.BB).append(result, params.content);\n        else result.append(params.content);\n    }\n    if (params.textContent) result.textContent = params.textContent;\n    if (params.className) result.className = params.className;\n    if (params.id) result.id = params.id;\n    if (params.parent) params.parent.append(result);\n    if (\"title\" in params && params.title !== undefined) result.title = params.title;\n    var listeners = [];\n    if (params.onClick !== undefined) {\n        result.addEventListener(\"click\", params.onClick);\n        listeners.push([\n            \"click\",\n            params.onClick\n        ]);\n    }\n    if (params.onChange !== undefined) {\n        result.addEventListener(\"change\", params.onChange);\n        listeners.push([\n            \"change\",\n            params.onChange\n        ]);\n    }\n    if (listeners.length > 0) $cfe3aa45a75894cc$var$els.push({\n        el: result,\n        listeners: listeners\n    });\n    if (\"custom\" in params && params.custom) {\n        var customKeyArr = Object.keys(params.custom);\n        for(var i = 0; i < customKeyArr.length; i++)result.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\n    }\n    return result;\n}\nfunction $cfe3aa45a75894cc$export$b1da1db524e22115(el) {\n    if (!el) return;\n    for(var i = 0; i < $cfe3aa45a75894cc$var$els.length; i++){\n        var item = $cfe3aa45a75894cc$var$els[i];\n        if (item.el === el) {\n            item.listeners.forEach(function(item) {\n                el.removeEventListener(item[0], item[1]);\n            });\n            $cfe3aa45a75894cc$var$els.splice(i, 1);\n            return;\n        }\n    }\n    // not found\n    return;\n}\n\n});\n\nparcelRequire.register(\"i0uIf\", function(module, exports) {\n\n$parcel$export(module.exports, \"BbLog\", function () { return $0d0e99c175410ac4$export$9860cd9e09e6f8ba; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\nvar $0d0e99c175410ac4$export$9860cd9e09e6f8ba = /*#__PURE__*/ function() {\n    \"use strict\";\n    function BbLog() {\n        (0, $cx0mh._)(this, BbLog);\n    }\n    (0, $7h4XF._)(BbLog, null, [\n        {\n            key: \"subscribe\",\n            value: function subscribe(listener) {\n                if (BbLog.listeners.includes(listener)) return;\n                BbLog.listeners.push(listener);\n            }\n        },\n        {\n            key: \"unsubscribe\",\n            value: function unsubscribe(listener) {\n                for(var i = 0; i < BbLog.listeners.length; i++)if (listener === BbLog.listeners[i]) {\n                    BbLog.listeners.splice(i, 1);\n                    return;\n                }\n            }\n        },\n        {\n            key: \"emit\",\n            value: function emit(msg) {\n                BbLog.listeners.forEach(function(item) {\n                    item(msg);\n                });\n            }\n        }\n    ]);\n    return BbLog;\n}();\n(function() {\n    $0d0e99c175410ac4$export$9860cd9e09e6f8ba.listeners = [];\n})();\n\n});\n\nparcelRequire.register(\"6l0gQ\", function(module, exports) {\n\n$parcel$export(module.exports, \"LocalStorage\", function () { return $9e5fd8359d8b22f2$export$19fffca37ef3e106; });\n/**\r\n * LocalStorage wrapper that does not throw exceptions.\r\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\r\n */ \nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\nvar $9e5fd8359d8b22f2$export$19fffca37ef3e106 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function LocalStorage() {\n        (0, $cx0mh._)(this, LocalStorage);\n    }\n    (0, $7h4XF._)(LocalStorage, null, [\n        {\n            key: \"getItem\",\n            value: function getItem(key) {\n                // (disabled) eslint-disable-next-line no-null/no-null\n                var result = null;\n                try {\n                    result = localStorage.getItem(key);\n                } catch (e) {\n                    this.error = e;\n                }\n                return result;\n            }\n        },\n        {\n            key: \"setItem\",\n            value: function setItem(key, value) {\n                try {\n                    localStorage.setItem(key, value);\n                } catch (e) {\n                    this.error = e;\n                }\n            }\n        },\n        {\n            key: \"removeItem\",\n            value: function removeItem(key) {\n                try {\n                    localStorage.removeItem(key);\n                } catch (e) {\n                    this.error = e;\n                }\n            }\n        },\n        {\n            key: \"getError\",\n            value: function getError() {\n                return this.error;\n            }\n        }\n    ]);\n    return LocalStorage;\n}();\n\n});\n\nparcelRequire.register(\"jjWRi\", function(module, exports) {\n\n$parcel$export(module.exports, \"CoalescedExploder\", function () { return $d2c9f6aa6c7498f1$export$fe11e0afe623a677; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $d2c9f6aa6c7498f1$export$fe11e0afe623a677 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function CoalescedExploder() {\n        (0, $cx0mh._)(this, CoalescedExploder);\n    }\n    (0, $7h4XF._)(CoalescedExploder, [\n        {\n            // ---- public ----\n            key: \"setChainOut\",\n            value: function setChainOut(func) {\n                this.chainOut = func;\n            }\n        },\n        {\n            key: \"chainIn\",\n            value: function chainIn(event) {\n                if (event.type === \"pointermove\") {\n                    if (event.coalescedArr && event.coalescedArr.length > 0) for(var i = 0; i < event.coalescedArr.length; i++){\n                        var eventCopy = (0, $7jh4K.copyObj)(event);\n                        if (i === 0) eventCopy.coalescedArr = [];\n                        var coalescedItem = event.coalescedArr[i];\n                        eventCopy.pageX = coalescedItem.pageX;\n                        eventCopy.pageY = coalescedItem.pageY;\n                        eventCopy.relX = coalescedItem.relX;\n                        eventCopy.relY = coalescedItem.relY;\n                        eventCopy.dX = coalescedItem.dX;\n                        eventCopy.dY = coalescedItem.dY;\n                        eventCopy.time = coalescedItem.time;\n                        if (i < event.coalescedArr.length - 1) eventCopy.isCoalesced = true;\n                        this.chainOut && this.chainOut(eventCopy);\n                    }\n                    else return event;\n                } else return event;\n                return null;\n            }\n        }\n    ]);\n    return CoalescedExploder;\n}();\n\n});\n\nparcelRequire.register(\"2pgVs\", function(module, exports) {\n\n$parcel$export(module.exports, \"NFingerTapper\", function () { return $cc27951506e6ad28$export$510622b8aed00381; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eg83P = parcelRequire(\"eg83P\");\nvar $cc27951506e6ad28$export$510622b8aed00381 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function NFingerTapper(p) {\n        (0, $cx0mh._)(this, NFingerTapper);\n        this.minSilenceBeforeDurationMs = 50;\n        this.maxTapMs = 500;\n        this.maxFirstLastFingerDownMs = 250;\n        this.maxPressedDistancePx = 12 //5 + fingers * 5;\n        ;\n        this.fingerArr = [];\n        this.eventQueueArr = [];\n        this.firstDownTime = 0;\n        this.lastEventTime = 0;\n        this.nowTime = performance.now();\n        this.pointersDownIdArr = [];\n        this.timeoutObj = {\n            firstLastDownTimeout: null,\n            tapTimeout: null\n        };\n        this.fingers = p.fingers;\n        this.onTap = p.onTap;\n    }\n    (0, $7h4XF._)(NFingerTapper, [\n        {\n            key: \"failGesture\",\n            value: function failGesture() {\n                if (this.eventQueueArr.length === 0) return;\n                this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\n                this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\n                for(var i = 0; i < this.eventQueueArr.length; i++)this.chainOut && this.chainOut(this.eventQueueArr[i]);\n                this.eventQueueArr = [];\n                this.fingerArr = [];\n            }\n        },\n        {\n            key: \"success\",\n            value: function success() {\n                this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\n                this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\n                this.eventQueueArr = []; // events get swallowed\n                this.fingerArr = [];\n                this.onTap();\n            }\n        },\n        {\n            key: \"setupTimeout\",\n            value: function setupTimeout(timeoutStr, timeMS) {\n                var _this = this;\n                var diff = timeMS - this.nowTime;\n                //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n                if (diff <= 0) return false;\n                this.timeoutObj[timeoutStr] = setTimeout(function() {\n                    return _this.failGesture();\n                }, diff);\n                return true;\n            }\n        },\n        {\n            key: \"processEvent\",\n            value: function processEvent(event) {\n                var tempLastEventTime = this.lastEventTime;\n                this.lastEventTime = event.time;\n                if (event.type === \"pointerdown\") this.pointersDownIdArr.push(event.pointerId);\n                else if (event.type === \"pointerup\") {\n                    for(var i = 0; i < this.pointersDownIdArr.length; i++)if (this.pointersDownIdArr[i] === event.pointerId) {\n                        this.pointersDownIdArr.splice(i, 1);\n                        break;\n                    }\n                }\n                if (event.pointerType !== \"touch\") {\n                    if (this.fingerArr.length > 0) this.failGesture();\n                    return;\n                }\n                this.nowTime = performance.now();\n                if (event.type === \"pointerdown\") {\n                    //console.log('down');\n                    if (this.fingerArr.length + 1 !== this.pointersDownIdArr.length) {\n                        this.failGesture();\n                        return;\n                    }\n                    if (this.fingerArr.length === this.fingers) {\n                        //console.log(fingers + ': too many fingers down -> fail');\n                        this.failGesture();\n                        return;\n                    }\n                    if (this.fingerArr.length > 0 && event.time - this.maxFirstLastFingerDownMs > this.fingerArr[0].downTimeMs) {\n                        //console.log(fingers + ': took too long to touch with all fingers -> fail');\n                        this.failGesture();\n                        return;\n                    }\n                    if (this.fingerArr.length === 0 && event.time - this.minSilenceBeforeDurationMs < tempLastEventTime) {\n                        //console.log(fingers + ': not enough silence before -> fail');\n                        this.failGesture();\n                        return;\n                    }\n                    if (this.fingerArr.length === 0) {\n                        this.firstDownTime = event.time;\n                        if (!this.setupTimeout(\"firstLastDownTimeout\", event.time + this.maxFirstLastFingerDownMs) || !this.setupTimeout(\"tapTimeout\", event.time + this.maxTapMs)) {\n                            this.failGesture();\n                            return;\n                        }\n                    }\n                    this.fingerArr.push({\n                        pointerId: event.pointerId,\n                        downTimeMs: event.time,\n                        downPageX: event.pageX,\n                        downPageY: event.pageY\n                    });\n                    return;\n                }\n                if (event.type === \"pointermove\") {\n                    if (this.fingerArr.length === 0) //not in a gesture -> ignore\n                    return;\n                    var fingerObj = null;\n                    for(var i1 = 0; i1 < this.fingerArr.length; i1++)if (this.fingerArr[i1].pointerId === event.pointerId) {\n                        fingerObj = this.fingerArr[i1];\n                        break;\n                    }\n                    if (fingerObj === null) {\n                        this.failGesture();\n                        return;\n                    }\n                    if (event.time - this.maxTapMs > this.firstDownTime) {\n                        //console.log(fingers + ': tap took too long -> fail');\n                        this.failGesture();\n                        return;\n                    }\n                    var distance = (0, $eg83P.dist)(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\n                    if (distance > this.maxPressedDistancePx) {\n                        //console.log(fingers + ': a finger moved too much -> fail', distance);\n                        this.failGesture();\n                        return;\n                    }\n                }\n                if (event.type === \"pointerup\") {\n                    if (this.fingerArr.length === 0) //not in a gesture -> ignore\n                    return;\n                    //console.log('up', event.pageX, event.pageY);\n                    if (this.fingerArr.length !== this.fingers) {\n                        //console.log(fingers + ': not enough fingers -> fail');\n                        this.failGesture();\n                        return;\n                    }\n                    var fingerObj1 = null;\n                    var i2 = 0;\n                    for(; i2 < this.fingerArr.length; i2++)if (this.fingerArr[i2].pointerId === event.pointerId) {\n                        fingerObj1 = this.fingerArr[i2];\n                        break;\n                    }\n                    if (fingerObj1 === null) //do nothing\n                    return;\n                    if (event.time - this.maxTapMs > this.firstDownTime) {\n                        //console.log(fingers + ': tap took too long -> fail');\n                        this.failGesture();\n                        return;\n                    }\n                    var distance1 = (0, $eg83P.dist)(event.pageX, event.pageY, fingerObj1.downPageX, fingerObj1.downPageY);\n                    if (distance1 > this.maxPressedDistancePx) {\n                        //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\n                        //console.log(fingerArr);\n                        this.failGesture();\n                        return;\n                    }\n                    fingerObj1.isUp = true;\n                    var allAreUp = true;\n                    for(var i3 = 0; i3 < this.fingerArr.length; i3++)if (!this.fingerArr[i3].isUp) {\n                        allAreUp = false;\n                        break;\n                    }\n                    //console.log('fingerArr', fingerArr);\n                    if (allAreUp) {\n                        this.success();\n                        return true;\n                    }\n                }\n            }\n        },\n        {\n            key: \"chainIn\",\n            value: function chainIn(event) {\n                var result = this.processEvent(event);\n                //console.log(fingerArr.length);\n                if (result === true) //tap success -> event gets swallowed\n                return null;\n                if (this.fingerArr.length === 0) return event;\n                else this.eventQueueArr.push(event);\n                return null;\n            }\n        },\n        {\n            key: \"setChainOut\",\n            value: function setChainOut(func) {\n                this.chainOut = func;\n            }\n        }\n    ]);\n    return NFingerTapper;\n}();\n\n});\n\nparcelRequire.register(\"joplQ\", function(module, exports) {\n\n$parcel$export(module.exports, \"PinchZoomer\", function () { return $670d2777518c365a$export$d62358ac2d82abb3; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eg83P = parcelRequire(\"eg83P\");\nvar $670d2777518c365a$export$d62358ac2d82abb3 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function PinchZoomer(p) {\n        (0, $cx0mh._)(this, PinchZoomer);\n        this.firstFingerMaxDistancePx = 10;\n        this.untilSecondFingerDurationMs = 250;\n        this.pointersDownIdArr = [];\n        this.gestureObj = null;\n        this.eventQueueArr = [];\n        this.nowTime = performance.now();\n        this.timeoutObj = {\n            secondFingerTimeout: null\n        };\n        this.pincherArr = [];\n        this.onPinch = p.onPinch;\n    }\n    (0, $7h4XF._)(PinchZoomer, [\n        {\n            key: \"end\",\n            value: function end() {\n                this.gestureObj = null;\n                this.eventQueueArr = [];\n            }\n        },\n        {\n            key: \"fail\",\n            value: function fail(doSwallow) {\n                if (!this.gestureObj) return;\n                this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\n                if (!doSwallow) for(var i = 0; i < this.eventQueueArr.length; i++)this.chainOut && this.chainOut(this.eventQueueArr[i]);\n                this.end();\n            }\n        },\n        {\n            key: \"setupFailTimeout\",\n            value: function setupFailTimeout(timeMS) {\n                var _this = this;\n                var diff = timeMS - this.nowTime;\n                if (diff <= 0) return false;\n                this.timeoutObj.secondFingerTimeout = setTimeout(function() {\n                    return _this.fail();\n                }, diff);\n                return true;\n            }\n        },\n        {\n            key: \"processEvent\",\n            value: function processEvent(event) {\n                if (event.type === \"pointerdown\") this.pointersDownIdArr.push(event.pointerId);\n                else if (event.type === \"pointerup\") {\n                    for(var i = 0; i < this.pointersDownIdArr.length; i++)if (this.pointersDownIdArr[i] === event.pointerId) {\n                        this.pointersDownIdArr.splice(i, 1);\n                        break;\n                    }\n                }\n                //pass through scenarios\n                if (!this.gestureObj && (event.pointerType !== \"touch\" || // wrong pointer type\n                event.type === \"pointermove\" && this.pointersDownIdArr.length > 0 || // failed before\n                this.pointersDownIdArr.length > 1 || // failed before\n                event.type === \"pointerup\" // failed before\n                )) return;\n                this.nowTime = performance.now();\n                //pointer down\n                if (event.type === \"pointerdown\") {\n                    if (this.gestureObj) {\n                        if (event.pointerType === \"touch\") {\n                            this.gestureObj.touchPointerArr.push({\n                                pointerId: event.pointerId,\n                                relX: event.relX,\n                                relY: event.relY\n                            });\n                            if (this.gestureObj.isInProgress) this.continuePinch(this.gestureObj, {\n                                type: \"down\",\n                                index: this.gestureObj.touchPointerArr.length - 1\n                            });\n                            else {\n                                this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\n                                this.gestureObj.isInProgress = true;\n                                this.beginPinch(this.gestureObj);\n                            }\n                            return;\n                        } else {\n                            if (this.gestureObj.isInProgress) this.gestureObj.otherPointerIdArr.push(event.pointerId);\n                            else this.fail();\n                            return;\n                        }\n                    } else {\n                        // first finger down - can only be touch if no gestureObj\n                        this.gestureObj = {\n                            touchPointerArr: [\n                                {\n                                    pointerId: event.pointerId,\n                                    relX: event.relX,\n                                    relY: event.relY,\n                                    downRelX: event.relX,\n                                    downRelY: event.relY\n                                }\n                            ],\n                            otherPointerIdArr: [],\n                            isInProgress: false\n                        };\n                        if (!this.setupFailTimeout(event.time + this.untilSecondFingerDurationMs)) {\n                            this.fail();\n                            return;\n                        }\n                        return;\n                    }\n                }\n                // should not happen. something went wrong\n                if (!this.gestureObj) {\n                    // throw? would make it less robust\n                    this.fail();\n                    return;\n                }\n                //pointer move\n                if (event.type === \"pointermove\" && event.pointerType === \"touch\") {\n                    //gesture object should always exist here\n                    var touchPointerObj = null;\n                    var i1 = 0;\n                    for(; i1 < this.gestureObj.touchPointerArr.length; i1++)if (event.pointerId === this.gestureObj.touchPointerArr[i1].pointerId) {\n                        touchPointerObj = this.gestureObj.touchPointerArr[i1];\n                        break;\n                    }\n                    //null should not be possible. something went wrong\n                    if (!touchPointerObj) {\n                        // throw? would make it less robust\n                        this.fail();\n                        return;\n                    }\n                    touchPointerObj.relX = event.relX;\n                    touchPointerObj.relY = event.relY;\n                    if (!this.gestureObj.isInProgress) {\n                        // should not happen. something went wrong\n                        if (!(\"downRelX\" in touchPointerObj && touchPointerObj.downRelX !== undefined) || !(\"downRelY\" in touchPointerObj && touchPointerObj.downRelY !== undefined)) {\n                            this.fail();\n                            return;\n                        }\n                        var distance = (0, $eg83P.dist)(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\n                        if (distance > this.firstFingerMaxDistancePx) {\n                            this.fail();\n                            return;\n                        }\n                    } else if (i1 < 2) this.continuePinch(this.gestureObj, {\n                        type: \"move\",\n                        index: i1\n                    });\n                    return;\n                }\n                //pointer up\n                if (event.type === \"pointerup\") {\n                    //gesture object should always exist here\n                    if (event.pointerType === \"touch\") {\n                        var i2 = 0;\n                        for(; i2 < this.gestureObj.touchPointerArr.length; i2++)if (this.gestureObj.touchPointerArr[i2].pointerId === event.pointerId) {\n                            this.gestureObj.touchPointerArr.splice(i2, 1);\n                            break;\n                        }\n                        if (this.gestureObj.touchPointerArr.length > 0) this.continuePinch(this.gestureObj, {\n                            type: \"up\",\n                            index: i2\n                        });\n                    } else {\n                        for(var i3 = 0; i3 < this.gestureObj.otherPointerIdArr.length; i3++)if (this.gestureObj.otherPointerIdArr[i3] === event.pointerId) {\n                            this.gestureObj.otherPointerIdArr.splice(i3, 1);\n                            break;\n                        }\n                    }\n                    //all fingers lifted?\n                    if (this.gestureObj.touchPointerArr.length === 0 && this.gestureObj.otherPointerIdArr.length === 0) {\n                        if (this.gestureObj.isInProgress) {\n                            this.end();\n                            this.endPinch();\n                        } else this.fail();\n                        return;\n                    }\n                }\n            }\n        },\n        {\n            key: \"beginPinch\",\n            value: function beginPinch(gestureObj) {\n                for(var i = 0; i < gestureObj.touchPointerArr.length; i++){\n                    var pointerObj = gestureObj.touchPointerArr[i];\n                    this.pincherArr.push({\n                        pointerId: pointerObj.pointerId,\n                        relX: pointerObj.relX,\n                        relY: pointerObj.relY,\n                        downRelX: pointerObj.relX,\n                        downRelY: pointerObj.relY\n                    });\n                }\n                var event = {\n                    type: \"move\",\n                    // temp\n                    downRelX: 0,\n                    downRelY: 0,\n                    relX: 0,\n                    relY: 0,\n                    angleRad: 0,\n                    scale: 1\n                };\n                if (this.pincherArr.length === 1) {\n                    event.relX = this.pincherArr[0].downRelX;\n                    event.relY = this.pincherArr[0].downRelY;\n                } else {\n                    event.relX = 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX);\n                    event.relY = 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY);\n                }\n                event.downRelX = event.relX;\n                event.downRelY = event.relY;\n                this.onPinch(event);\n            }\n        },\n        {\n            key: \"continuePinch\",\n            value: //actionObj = {type: 'down'|'move'|'up', index: number}\n            function continuePinch(gestureObj, actionObj) {\n                if (actionObj.index > 1) return;\n                if (actionObj.type === \"move\") {\n                    var event;\n                    this.pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\n                    this.pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\n                    if (this.pincherArr.length === 1) event = {\n                        type: \"move\",\n                        downRelX: this.pincherArr[0].downRelX,\n                        downRelY: this.pincherArr[0].downRelY,\n                        relX: this.pincherArr[0].relX,\n                        relY: this.pincherArr[0].relY,\n                        angleRad: 0,\n                        scale: 1\n                    };\n                    else {\n                        var startDist = (0, $eg83P.dist)(this.pincherArr[0].downRelX, this.pincherArr[0].downRelY, this.pincherArr[1].downRelX, this.pincherArr[1].downRelY);\n                        var distance = (0, $eg83P.dist)(this.pincherArr[0].relX, this.pincherArr[0].relY, this.pincherArr[1].relX, this.pincherArr[1].relY);\n                        var startAngle = (0, $eg83P.pointsToAngleRad)({\n                            x: this.pincherArr[0].downRelX,\n                            y: this.pincherArr[0].downRelY\n                        }, {\n                            x: this.pincherArr[1].downRelX,\n                            y: this.pincherArr[1].downRelY\n                        });\n                        var angle = (0, $eg83P.pointsToAngleRad)({\n                            x: this.pincherArr[0].relX,\n                            y: this.pincherArr[0].relY\n                        }, {\n                            x: this.pincherArr[1].relX,\n                            y: this.pincherArr[1].relY\n                        });\n                        event = {\n                            type: \"move\",\n                            downRelX: 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX),\n                            downRelY: 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY),\n                            relX: 0.5 * (this.pincherArr[0].relX + this.pincherArr[1].relX),\n                            relY: 0.5 * (this.pincherArr[0].relY + this.pincherArr[1].relY),\n                            angleRad: angle - startAngle,\n                            scale: distance / startDist\n                        };\n                    }\n                    this.onPinch(event);\n                } else if (actionObj.type === \"down\" || actionObj.type === \"up\") {\n                    this.endPinch();\n                    this.beginPinch(gestureObj);\n                }\n            }\n        },\n        {\n            key: \"endPinch\",\n            value: function endPinch() {\n                this.pincherArr = [];\n                this.onPinch({\n                    type: \"end\"\n                });\n            }\n        },\n        {\n            key: \"chainIn\",\n            value: function chainIn(event) {\n                this.processEvent(event);\n                if (this.gestureObj) {\n                    if (!this.gestureObj.isInProgress) this.eventQueueArr.push(event);\n                } else return event;\n                return null;\n            }\n        },\n        {\n            key: \"setChainOut\",\n            value: function setChainOut(func) {\n                this.chainOut = func;\n            }\n        }\n    ]);\n    return PinchZoomer;\n}();\n\n});\n\nparcelRequire.register(\"c1lmK\", function(module, exports) {\n\n$parcel$export(module.exports, \"DoubleTapper\", function () { return $f607ef98ce9eccdc$export$db3963a21c01d803; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $bX4ja = parcelRequire(\"bX4ja\");\n\nvar $eg83P = parcelRequire(\"eg83P\");\nvar $f607ef98ce9eccdc$export$db3963a21c01d803 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function DoubleTapper(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, DoubleTapper);\n        this.allowedPointerTypeArr = [\n            \"touch\",\n            \"mouse\",\n            \"pen\"\n        ];\n        this.allowedButtonArr = [\n            \"left\"\n        ];\n        this.minSilenceBeforeDurationMs = 400;\n        this.maxPressedDurationMs = 300;\n        this.maxPressedDistancePx = 10;\n        this.maxInbetweenDistancePx = 19;\n        this.maxUpToUpDurationMs = 500;\n        this.maxUntilSecondDownDurationMs = 300;\n        this.minSilenceAfterMs = 250;\n        this.sequenceArr = [];\n        this.pointersDownIdArr = [];\n        this.lastUpTime = 0;\n        this.nowTime = 0;\n        this.eventQueueArr = [];\n        this.timeoutObj = {\n            fail: null,\n            maxUntilSecondDown: null,\n            success: null\n        };\n        this.onDoubleTap = p.onDoubleTap;\n        this.gestureFailed = function() {\n            if (_this.sequenceArr.length === 0) return;\n            _this.timeoutObj.fail && clearTimeout(_this.timeoutObj.fail);\n            _this.timeoutObj.maxUntilSecondDown && clearTimeout(_this.timeoutObj.maxUntilSecondDown);\n            _this.timeoutObj.success && clearTimeout(_this.timeoutObj.success);\n            _this.timeoutObj.fail = null;\n            _this.timeoutObj.maxUntilSecondDown = null;\n            _this.timeoutObj.success = null;\n            if (_this.chainOut) for(var i = 0; i < _this.eventQueueArr.length; i++)_this.chainOut(_this.eventQueueArr[i]);\n            _this.eventQueueArr = [];\n            _this.sequenceArr = [];\n        };\n    }\n    (0, $7h4XF._)(DoubleTapper, [\n        {\n            key: \"success\",\n            value: // double tap achieved\n            function success() {\n                this.timeoutObj.fail = null;\n                this.timeoutObj.success = null;\n                this.eventQueueArr = []; // events get swallowed\n                var lastSequenceItem = this.sequenceArr[this.sequenceArr.length - 1];\n                this.sequenceArr = [];\n                if (\"pageX\" in lastSequenceItem) this.onDoubleTap({\n                    pageX: lastSequenceItem.pageX,\n                    pageY: lastSequenceItem.pageY,\n                    relX: lastSequenceItem.relX,\n                    relY: lastSequenceItem.relY\n                });\n            }\n        },\n        {\n            key: \"setupTimeout\",\n            value: // returns false if time already up. otherwise sets up timeout\n            function setupTimeout(timeoutStr, targetFunc, timeMS) {\n                var diff = timeMS - this.nowTime;\n                // console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n                if (diff <= 0) return false;\n                this.timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\n                return true;\n            }\n        },\n        {\n            key: \"processEvent\",\n            value: /**\r\n     * @param event object - a pointer event from BB.PointerListener\r\n     */ function processEvent(event) {\n                var _this = this;\n                if (event.type === \"pointerdown\") this.pointersDownIdArr.push(event.pointerId);\n                else if (event.type === \"pointerup\") {\n                    for(var i = 0; i < this.pointersDownIdArr.length; i++)if (this.pointersDownIdArr[i] === event.pointerId) {\n                        this.pointersDownIdArr.splice(i, 1);\n                        break;\n                    }\n                }\n                if (!this.allowedPointerTypeArr.includes(event.pointerType)) {\n                    //console.log('wrong input type -> fail');\n                    this.gestureFailed();\n                    return;\n                }\n                this.nowTime = performance.now();\n                var lastSequenceItem = this.sequenceArr.length > 0 ? this.sequenceArr[this.sequenceArr.length - 1] : null;\n                if (event.type === \"pointerup\") this.lastUpTime = event.time;\n                if (event.type === \"pointerdown\") {\n                    if (this.pointersDownIdArr.length > 1) {\n                        //console.log('more than one pointer down -> fail');\n                        this.gestureFailed();\n                        return;\n                    }\n                    if (this.timeoutObj.success !== null) {\n                        //console.log('silence-after not achieved -> fail');\n                        this.gestureFailed();\n                        return;\n                    }\n                    if (this.sequenceArr.length === 0 && this.nowTime - this.lastUpTime < this.minSilenceBeforeDurationMs) {\n                        //console.log('silence before not achieved -> fail');\n                        this.gestureFailed();\n                        return;\n                    }\n                    if (event.button && !this.allowedButtonArr.includes(event.button)) {\n                        //console.log('wrong button -> fail', event.button, allowedButtonArr);\n                        this.gestureFailed();\n                        return;\n                    }\n                    if (lastSequenceItem && \"isDown\" in lastSequenceItem && lastSequenceItem.isDown || this.sequenceArr.length > 2) {\n                        //console.log('jumbled -> fail');\n                        this.gestureFailed();\n                        return;\n                    }\n                    if (lastSequenceItem && \"position\" in lastSequenceItem) {\n                        var distance = (0, $eg83P.dist)(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\n                        if (distance > this.maxInbetweenDistancePx) {\n                            //console.log('maxInbetweenDistancePx -> reset');\n                            this.gestureFailed();\n                            if (\"time\" in lastSequenceItem && this.nowTime - lastSequenceItem.time < this.minSilenceBeforeDurationMs) return;\n                        }\n                    }\n                    this.sequenceArr.push({\n                        isDown: true,\n                        time: this.nowTime,\n                        position: [\n                            event.pageX,\n                            event.pageY\n                        ],\n                        pointerId: event.pointerId\n                    });\n                    //maxUntilSecondDown\n                    if (this.sequenceArr.length > 1) this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\n                    else if (!this.setupTimeout(\"maxUntilSecondDown\", function() {\n                        return _this.gestureFailed();\n                    }, event.time + this.maxUntilSecondDownDurationMs)) {\n                        //console.log('event.time + maxPressedDurationMs -> fail');\n                        this.gestureFailed();\n                        return;\n                    }\n                    this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\n                    if (!this.setupTimeout(\"fail\", function() {\n                        return _this.gestureFailed();\n                    }, event.time + this.maxPressedDurationMs)) {\n                        //console.log('event.time + maxPressedDurationMs -> fail');\n                        this.gestureFailed();\n                        return;\n                    }\n                }\n                if (lastSequenceItem && event.type === \"pointermove\" && \"pointerId\" in lastSequenceItem && lastSequenceItem.pointerId === event.pointerId) {\n                    /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                console.log('another pointer mixing in -> fail');\r\n                this.fail();\r\n                return;\r\n            }*/ var distance1 = (0, $eg83P.dist)(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\n                    if (distance1 > this.maxPressedDistancePx) {\n                        //console.log('maxPressedDistancePx -> fail');\n                        this.gestureFailed();\n                        return;\n                    }\n                }\n                if (lastSequenceItem && event.type === \"pointerup\") {\n                    if (\"pointerId\" in lastSequenceItem && lastSequenceItem.pointerId !== event.pointerId) {\n                        this.gestureFailed();\n                        return;\n                    }\n                    if (\"time\" in lastSequenceItem && this.nowTime >= lastSequenceItem.time + this.maxPressedDurationMs) {\n                        this.gestureFailed();\n                        return;\n                    }\n                    this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\n                    if (this.sequenceArr.length < 3) {\n                        if (!this.setupTimeout(\"fail\", function() {\n                            return _this.gestureFailed();\n                        }, event.time + this.maxUpToUpDurationMs)) {\n                            this.gestureFailed();\n                            return;\n                        }\n                        this.sequenceArr = [\n                            lastSequenceItem,\n                            {\n                                isUp: true,\n                                time: this.nowTime,\n                                position: [\n                                    event.pageX,\n                                    event.pageY\n                                ]\n                            }\n                        ];\n                        return;\n                    }\n                    if (\"time\" in this.sequenceArr[1] && this.nowTime < this.sequenceArr[1].time + this.maxUpToUpDurationMs) {\n                        // double tap almost success\n                        // only needs silence\n                        this.sequenceArr.push({\n                            pageX: event.pageX,\n                            pageY: event.pageY,\n                            relX: event.relX,\n                            relY: event.relY\n                        });\n                        if (!this.setupTimeout(\"success\", function() {\n                            return _this.success();\n                        }, event.time + this.minSilenceAfterMs)) this.gestureFailed();\n                    } else this.gestureFailed();\n                }\n            }\n        },\n        {\n            key: \"chainIn\",\n            value: function chainIn(event) {\n                this.processEvent(event);\n                if (this.sequenceArr.length === 0) {\n                    this.gestureFailed();\n                    return event;\n                }\n                // events might become a double tap -> queue\n                this.eventQueueArr.push(event);\n                return null;\n            }\n        },\n        {\n            key: \"setChainOut\",\n            value: function setChainOut(func) {\n                this.chainOut = func;\n            }\n        },\n        {\n            key: \"setAllowedPointerTypeArr\",\n            value: function setAllowedPointerTypeArr(arr) {\n                this.allowedPointerTypeArr = (0, $bX4ja._)(arr);\n            }\n        },\n        {\n            key: \"setAllowedButtonArr\",\n            value: function setAllowedButtonArr(arr) {\n                this.allowedButtonArr = (0, $bX4ja._)(arr);\n            }\n        }\n    ]);\n    return DoubleTapper;\n}();\n\n});\n\nparcelRequire.register(\"635F6\", function(module, exports) {\n\n$parcel$export(module.exports, \"OnePointerLimiter\", function () { return $956c5ff01a38849f$export$71ff2f51bf1f4062; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\nvar $956c5ff01a38849f$export$71ff2f51bf1f4062 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function OnePointerLimiter() {\n        (0, $cx0mh._)(this, OnePointerLimiter);\n        this.downPointerId = null;\n        this.ignorePointerIdArr = [];\n    }\n    (0, $7h4XF._)(OnePointerLimiter, [\n        {\n            // ---- public ----\n            key: \"chainIn\",\n            value: function chainIn(event) {\n                if (this.ignorePointerIdArr.includes(event.pointerId)) {\n                    if (event.type === \"pointerup\") {\n                        for(var i = 0; i < this.ignorePointerIdArr.length; i++)if (this.ignorePointerIdArr[i] === event.pointerId) {\n                            this.ignorePointerIdArr.splice(i, 1);\n                            break;\n                        }\n                    }\n                    return null;\n                }\n                if (this.downPointerId === null) {\n                    if (event.type === \"pointerdown\") this.downPointerId = event.pointerId;\n                    return event;\n                } else {\n                    if (event.pointerId !== this.downPointerId) {\n                        if (event.type === \"pointerdown\") this.ignorePointerIdArr.push(event.pointerId);\n                        return null;\n                    }\n                    if (event.type === \"pointerup\") this.downPointerId = null;\n                    return event;\n                }\n            }\n        },\n        {\n            key: \"setChainOut\",\n            value: function setChainOut(func) {\n                this.chainOut = func;\n            }\n        }\n    ]);\n    return OnePointerLimiter;\n}();\n\n});\n\nparcelRequire.register(\"gCzYB\", function(module, exports) {\n\n$parcel$export(module.exports, \"EventChain\", function () { return $4fb7927cde0b2f75$export$649a211db9812745; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\nvar $4fb7927cde0b2f75$export$649a211db9812745 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function EventChain(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, EventChain);\n        this.chainArr = p.chainArr;\n        for(var i = 0; i < this.chainArr.length; i++)(function(i) {\n            _this.chainArr[i].setChainOut(function(event) {\n                _this.continueChain(i + 1, event);\n            });\n        })(i);\n    }\n    (0, $7h4XF._)(EventChain, [\n        {\n            key: \"continueChain\",\n            value: function continueChain(i, event) {\n                for(; i < this.chainArr.length; i++){\n                    event = this.chainArr[i].chainIn(event);\n                    if (event === null) return null;\n                }\n                this.chainOut && this.chainOut(event);\n                return null;\n            }\n        },\n        {\n            /**\r\n     * feed an event into the chain\r\n     */ key: \"chainIn\",\n            value: function chainIn(event) {\n                return this.continueChain(0, event);\n            }\n        },\n        {\n            /**\r\n     * func will be called when event has passed through the chain\r\n     */ key: \"setChainOut\",\n            value: function setChainOut(func) {\n                this.chainOut = func;\n            }\n        }\n    ]);\n    return EventChain;\n}();\n\n});\n\n\nparcelRequire.register(\"8zjca\", function(module, exports) {\nwindow.onscroll = function(e) {\n    e.preventDefault();\n};\n\n});\n\nparcelRequire.register(\"6ToP3\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"hWwEP\");\n\n});\n\nparcelRequire.register(\"d2FVM\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"83Fnk\");\n\n});\n\n\nparcelRequire.register(\"dLlkc\", function(module, exports) {\n\n$parcel$export(module.exports, \"DynamicModal\", function () { return $e59fbd08bcc1a36b$export$185108a9b725b68; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $i8UFO = parcelRequire(\"i8UFO\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nparcelRequire(\"8zjca\");\n\nvar $6ToP3 = parcelRequire(\"6ToP3\");\nvar $e59fbd08bcc1a36b$export$185108a9b725b68 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function DynamicModal(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, DynamicModal);\n        (0, $i8UFO.dialogCounter).increase();\n        this.onClose = p.onClose;\n        this.parent = document.body;\n        this.rootEl = (0, $eWjiX.BB).el({\n            parent: this.parent,\n            className: \"g-root kl-d-modal-root\",\n            css: {\n                position: \"fixed\",\n                left: \"0\",\n                top: \"0\",\n                bottom: \"0\",\n                right: \"0\",\n                overflow: \"auto\",\n                animationName: \"consoleIn\",\n                animationDuration: \"0.3s\",\n                animationTimingFunction: \"ease-out\"\n            },\n            onClick: (0, $eWjiX.BB).handleClick\n        });\n        //background element registering clicks\n        this.bgEl = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\",\n                bottom: \"0\",\n                right: \"0\"\n            },\n            onClick: function() {\n                return _this.close();\n            }\n        });\n        //the actual popup box\n        var popupEl = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            className: \"kl-d-modal\",\n            css: {\n                position: \"absolute\",\n                width: (0, $eWjiX.BB).isCssMinMaxSupported() ? \"min(calc(100% - 40px), \" + (p.width ? p.width : 400) + \"px)\" : (p.width ? p.width : 400) + \"px\",\n                height: \"calc(100% - 40px)\",\n                borderRadius: \"10px\",\n                overflow: \"hidden\"\n            }\n        });\n        //x and y position via script. flex not powerful enough imo\n        this.updatePos = function() {\n            var elW = popupEl.offsetWidth;\n            var elH = popupEl.offsetHeight;\n            (0, $eWjiX.BB).css(popupEl, {\n                left: Math.max(0, (window.innerWidth - elW) / 2) + \"px\",\n                top: Math.max(20, (window.innerHeight - elH) / 2 - elH * 0.20) + \"px\"\n            });\n        };\n        this.updatePos();\n        window.addEventListener(\"resize\", this.updatePos);\n        //title row in popup\n        var titleHeight = 40;\n        var titleEl = (0, $eWjiX.BB).el({\n            parent: popupEl,\n            css: {\n                height: titleHeight + \"px\",\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                alignItems: \"center\",\n                paddingLeft: titleHeight / 2 + \"px\"\n            }\n        });\n        if (p.title) titleEl.append(p.title);\n        this.xButton = (0, $eWjiX.BB).el({\n            parent: titleEl,\n            tagName: \"button\",\n            className: \"popup-x\",\n            content: '<img alt=\"'.concat((0, $1mH1z.LANG)(\"modal-close\"), '\" height=\"20\" src=\"').concat((0, (/*@__PURE__*/$parcel$interopDefault($6ToP3))), '\">'),\n            title: (0, $1mH1z.LANG)(\"modal-close\"),\n            onClick: function() {\n                return _this.close();\n            },\n            css: {\n                width: titleHeight + \"px\",\n                height: titleHeight + \"px\",\n                lineHeight: titleHeight + \"px\",\n                background: \"none\",\n                boxShadow: \"none\"\n            },\n            custom: {\n                tabindex: \"0\"\n            }\n        });\n        var contentEl = (0, $eWjiX.BB).el({\n            parent: popupEl,\n            css: {\n                height: \"calc(100% - \" + titleHeight + \"px)\"\n            }\n        });\n        if (p.content) contentEl.append(p.content);\n        this.keyListener = new (0, $eWjiX.BB).KeyListener({\n            onDown: function(keyStr, e) {\n                if (keyStr === \"esc\") {\n                    e.stopPropagation();\n                    _this.close();\n                }\n            }\n        });\n    }\n    (0, $7h4XF._)(DynamicModal, [\n        {\n            // ---- interface ----\n            key: \"close\",\n            value: function close() {\n                (0, $i8UFO.dialogCounter).decrease();\n                (0, $eWjiX.BB).destroyEl(this.rootEl);\n                this.rootEl.remove();\n                window.removeEventListener(\"resize\", this.updatePos);\n                this.keyListener.destroy();\n                (0, $eWjiX.BB).destroyEl(this.xButton);\n                (0, $eWjiX.BB).destroyEl(this.bgEl);\n                this.onClose && this.onClose();\n            }\n        }\n    ]);\n    return DynamicModal;\n}();\n\n});\n\nparcelRequire.register(\"7bWhB\", function(module, exports) {\n\n$parcel$export(module.exports, \"Checkbox\", function () { return $365a915dfb503274$export$48513f6b9f8ce62d; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $365a915dfb503274$export$48513f6b9f8ce62d = /*#__PURE__*/ function() {\n    \"use strict\";\n    function Checkbox(params) {\n        var _this = this;\n        (0, $cx0mh._)(this, Checkbox);\n        this.doHighlight = !!params.doHighlight;\n        this.element = (0, $eWjiX.BB).el({\n            className: \"kl-checkbox\"\n        });\n        var innerEl = (0, $eWjiX.BB).el({\n            parent: this.element,\n            tagName: \"label\",\n            className: \"kl-checkbox__inner\",\n            css: {\n                display: \"flex\"\n            }\n        });\n        this.check = (0, $eWjiX.BB).el({\n            parent: innerEl,\n            tagName: \"input\",\n            css: {\n                margin: \"0 5px 0 0\"\n            },\n            custom: {\n                type: \"checkbox\"\n            }\n        });\n        this.check.checked = !!params.init;\n        if (this.doHighlight && this.check.checked) this.element.classList.add(\"kl-checkbox--highlight\");\n        if (!params.allowTab) this.check.tabIndex = -1;\n        if (params.title) innerEl.title = params.title;\n        var label = (0, $eWjiX.BB).el({\n            parent: innerEl,\n            content: params.label,\n            css: {}\n        });\n        label.allowClick = true;\n        this.check.onchange = function() {\n            if (_this.doHighlight) _this.element.classList.toggle(\"kl-checkbox--highlight\", _this.check.checked);\n            params.callback && params.callback(_this.check.checked);\n            setTimeout(function() {\n                _this.check.blur();\n            }, 0);\n        };\n        if (params.css) (0, $eWjiX.BB).css(this.element, params.css);\n    }\n    (0, $7h4XF._)(Checkbox, [\n        {\n            key: \"getValue\",\n            value: function getValue() {\n                return this.check.checked;\n            }\n        },\n        {\n            key: \"setValue\",\n            value: function setValue(b) {\n                this.check.checked = !!b;\n                if (this.doHighlight) this.element.classList.toggle(\"kl-checkbox--highlight\", this.check.checked);\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.element;\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.check.onchange = null;\n            }\n        }\n    ]);\n    return Checkbox;\n}();\n\n});\n\nparcelRequire.register(\"dJPtW\", function(module, exports) {\n\n$parcel$export(module.exports, \"Input\", function () { return $f18fe37a308c53fd$export$f5b8910cec6cf069; });\n$parcel$export(module.exports, \"input\", function () { return $f18fe37a308c53fd$export$b7e3ae3d7c15e42e; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $f18fe37a308c53fd$export$f5b8910cec6cf069 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function Input(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, Input);\n        this.keyListener = {\n            destroy: function() {}\n        };\n        this.rootEl = (0, $eWjiX.BB).el({\n            tagName: \"label\",\n            content: p.label,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                gap: \"5px\"\n            }\n        });\n        this.input = (0, $eWjiX.BB).el({\n            tagName: \"input\",\n            parent: this.rootEl,\n            title: p.title\n        });\n        this.input.type;\n        var _p_type;\n        this.type = (_p_type = p.type) !== null && _p_type !== void 0 ? _p_type : \"text\";\n        try {\n            this.input.type = this.type;\n        } catch (e) {\n        // ie can't deal with number\n        }\n        var _p_step;\n        var stepSize = (_p_step = p.step) !== null && _p_step !== void 0 ? _p_step : 1;\n        if (this.type === \"number\") {\n            if (p.min !== undefined) this.input.min = \"\" + p.min;\n            if (p.max !== undefined) this.input.max = \"\" + p.max;\n            if (p.step !== undefined) this.input.step = \"\" + stepSize;\n        }\n        this.input.value = \"\" + p.init;\n        var lastValidValue = this.input.value;\n        /**\r\n         * return true if not changed\r\n         */ var handleChange = function() {\n            var oldVal = lastValidValue;\n            var newValue = _this.input.value;\n            if (p.doResetIfInvalid) {\n                var didChange = false;\n                if (newValue === \"\") {\n                    newValue = lastValidValue;\n                    didChange = true;\n                }\n                if (p.min !== undefined && parseFloat(newValue) < p.min) {\n                    newValue = \"\" + p.min;\n                    didChange = true;\n                }\n                if (p.max !== undefined && parseFloat(newValue) > p.max) {\n                    newValue = \"\" + p.max;\n                    didChange = true;\n                }\n                if (didChange) _this.input.value = \"\" + newValue;\n            }\n            lastValidValue = newValue;\n            return oldVal !== newValue;\n        };\n        if (p.onChange) {\n            var onChange = p.onChange;\n            this.input.onchange = function() {\n                handleChange() && onChange(_this.input.value);\n            };\n        }\n        if (p.css) (0, $eWjiX.BB).css(this.input, p.css);\n        if (p.doScrollWithoutFocus && p.type === \"number\" && p.onChange) {\n            var onChange1 = p.onChange;\n            this.keyListener = new (0, $eWjiX.BB).KeyListener({});\n            this.pointerListener = new (0, $eWjiX.BB).PointerListener({\n                target: this.input,\n                onWheel: function(e) {\n                    /*if (document.hasFocus()) { // what was the point of this?\r\n                        return;\r\n                    }*/ var fac = _this.keyListener.isPressed(\"shift\") ? 4 : 1;\n                    _this.input.value = \"\" + (parseFloat(_this.input.value) - e.deltaY * stepSize * fac);\n                    handleChange() && onChange1(_this.input.value);\n                }\n            });\n        }\n    }\n    (0, $7h4XF._)(Input, [\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"getValue\",\n            value: function getValue() {\n                return this.input.value;\n            }\n        },\n        {\n            key: \"setValue\",\n            value: function setValue(v) {\n                this.input.value = \"\" + v;\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.pointerListener && this.pointerListener.destroy();\n                this.keyListener.destroy();\n            }\n        }\n    ]);\n    return Input;\n}();\nvar $f18fe37a308c53fd$export$b7e3ae3d7c15e42e = function input(params) {\n    var result = document.createElement(\"input\");\n    if (params.type) try {\n        result.type = params.type;\n    } catch (e) {\n    /* empty */ // ie can't deal with number\n    }\n    else result.type = \"text\";\n    if (params.min !== undefined) result.min = \"\" + params.min;\n    if (params.max !== undefined) result.max = \"\" + params.max;\n    result.value = \"\" + params.init;\n    if (params.callback) result.onchange = function() {\n        params.callback(result.value);\n    };\n    if (params.css) (0, $eWjiX.BB).css(result, params.css);\n    return result;\n};\n\n});\n\nparcelRequire.register(\"eEL9N\", function(module, exports) {\n\n$parcel$export(module.exports, \"Select\", function () { return $7a3263857aacf58f$export$ef9b1a59e592288f; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $7a3263857aacf58f$export$ef9b1a59e592288f = /*#__PURE__*/ function() {\n    \"use strict\";\n    function Select(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, Select);\n        this.optionArr = [];\n        this.selectEl = (0, $eWjiX.BB).el({\n            tagName: \"select\",\n            title: p.title,\n            className: \"kl-select\",\n            css: {\n                cursor: \"pointer\",\n                fontSize: \"15px\",\n                padding: \"3px\"\n            }\n        });\n        if (p.css) (0, $eWjiX.BB).css(this.selectEl, p.css);\n        var isFocusable = p.isFocusable;\n        if (!isFocusable) this.selectEl.tabIndex = -1;\n        this.setOptionArr(p.optionArr);\n        if (p.onChange) this.onChange = p.onChange;\n        this.changeListener = function() {\n            if (!isFocusable) _this.selectEl.blur();\n            _this.onChange && _this.onChange(_this.getValue());\n        };\n        this.selectEl.addEventListener(\"change\", this.changeListener);\n        this.selectEl.value = p.initValue !== undefined ? p.initValue : \"\";\n    }\n    (0, $7h4XF._)(Select, [\n        {\n            key: \"setValue\",\n            value: function setValue(val) {\n                this.selectEl.value = val === undefined ? \"\" : val;\n            }\n        },\n        {\n            key: \"getValue\",\n            value: function getValue() {\n                return this.selectEl.value;\n            }\n        },\n        {\n            key: \"setDeltaValue\",\n            value: function setDeltaValue(delta) {\n                var index = 0;\n                for(var i = 0; i < this.optionArr.length; i++){\n                    var option = this.optionArr[i];\n                    if (option.item && \"\" + option.item[0] === this.selectEl.value) {\n                        index = i;\n                        break;\n                    }\n                }\n                index = Math.max(0, Math.min(this.optionArr.length - 1, index + delta));\n                var option1 = this.optionArr[index];\n                this.selectEl.value = option1.item ? option1.item[0] : \"\";\n                this.onChange && this.onChange(this.getValue());\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.selectEl;\n            }\n        },\n        {\n            key: \"updateLabel\",\n            value: function updateLabel(id, label) {\n                this.optionArr.forEach(function(option) {\n                    if (option.item && option.item[0] === id && option.el) {\n                        option.item[1] = label;\n                        option.el.textContent = option.item[1];\n                    }\n                });\n            }\n        },\n        {\n            key: \"setOptionArr\",\n            value: function setOptionArr(optionArr) {\n                this.optionArr = [];\n                this.selectEl.innerHTML = \"\";\n                for(var i = 0; i < optionArr.length; i++){\n                    var item = optionArr[i];\n                    if (!item) {\n                        this.optionArr.push({\n                            item: item\n                        });\n                        continue;\n                    }\n                    var el = document.createElement(\"option\");\n                    el.value = item[0];\n                    el.textContent = item[1];\n                    if (item[2]) (0, $eWjiX.BB).css(el, item[2].css);\n                    this.optionArr.push({\n                        item: item,\n                        el: el\n                    });\n                    this.selectEl.append(el);\n                }\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.selectEl.removeEventListener(\"change\", this.changeListener);\n            }\n        }\n    ]);\n    return Select;\n}();\n\n});\n\nparcelRequire.register(\"1kyaA\", function(module, exports) {\n\n$parcel$export(module.exports, \"ImageToggle\", function () { return $8fa94d142febb502$export$b6d053cded550773; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $8fa94d142febb502$export$b6d053cded550773 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function ImageToggle(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, ImageToggle);\n        this.isActive = !!p.initValue;\n        this.rootEl = (0, $eWjiX.BB).el({\n            className: \"image-toggle\",\n            title: p.title,\n            content: (0, $eWjiX.BB).el({\n                className: \"image-toggle__im\" + (p.darkInvert ? \" dark-invert\" : \"\"),\n                css: {\n                    backgroundImage: \"url('\" + p.image + \"')\"\n                }\n            }),\n            onClick: function(e) {\n                e.preventDefault();\n                if (p.isRadio && _this.isActive) return;\n                _this.isActive = !_this.isActive;\n                _this.update();\n                p.onChange(_this.isActive);\n            }\n        });\n        this.update();\n    }\n    (0, $7h4XF._)(ImageToggle, [\n        {\n            key: \"update\",\n            value: function update() {\n                this.rootEl.classList.toggle(\"image-toggle-active\", this.isActive);\n            }\n        },\n        {\n            // --- interface ---\n            key: \"setValue\",\n            value: function setValue(b) {\n                this.isActive = !!b;\n                this.update();\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"getValue\",\n            value: function getValue() {\n                return this.isActive;\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                (0, $eWjiX.BB).destroyEl(this.rootEl);\n            }\n        }\n    ]);\n    return ImageToggle;\n}();\n\n});\n\nparcelRequire.register(\"4nUqS\", function(module, exports) {\n\n$parcel$export(module.exports, \"ImageRadioList\", function () { return $8cb981a3c9e5b15b$export$7cc1012a658e6ad8; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1kyaA = parcelRequire(\"1kyaA\");\nvar $8cb981a3c9e5b15b$export$7cc1012a658e6ad8 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function ImageRadioList(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, ImageRadioList);\n        this.rootEl = (0, $eWjiX.BB).el({\n            className: \"image-radio-wrapper\",\n            css: {\n                display: \"flex\"\n            }\n        });\n        this.optionArr = [];\n        var select = function(index, id) {\n            _this.activeIndex = index;\n            for(var i = 0; i < _this.optionArr.length; i++)_this.optionArr[i].radioEl.setValue(i === _this.activeIndex);\n            p.onChange(id);\n        };\n        var initialIndex;\n        var createOption = function(index, o) {\n            if (o.id === p.initId) initialIndex = index;\n            var radioEl = new (0, $1kyaA.ImageToggle)({\n                image: o.image,\n                title: o.title,\n                initValue: o.id === p.initId,\n                isRadio: true,\n                onChange: function() {\n                    select(index, o.id);\n                },\n                darkInvert: o.darkInvert\n            });\n            _this.rootEl.append(radioEl.getElement());\n            return {\n                id: o.id,\n                radioEl: radioEl\n            };\n        };\n        for(var i = 0; i < p.optionArr.length; i++)this.optionArr.push(createOption(i, p.optionArr[i]));\n        if (initialIndex === undefined) throw new Error(\"initId not in optionArr\");\n        this.activeIndex = initialIndex;\n    }\n    (0, $7h4XF._)(ImageRadioList, [\n        {\n            // --- interface ---\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"getValue\",\n            value: function getValue() {\n                return this.optionArr[this.activeIndex].id;\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.optionArr.forEach(function(item) {\n                    item.radioEl.destroy();\n                });\n            }\n        }\n    ]);\n    return ImageRadioList;\n}();\n\n});\n\nparcelRequire.register(\"lCF5N\", function(module, exports) {\n\n$parcel$export(module.exports, \"createPenPressureToggle\", function () { return $a49c90053f8766a2$export$9da2e8821e6cbb57; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $8IsQq = parcelRequire(\"8IsQq\");\n\nvar $cmnov = parcelRequire(\"cmnov\");\nvar $a49c90053f8766a2$export$9da2e8821e6cbb57 = function createPenPressureToggle(isChecked, changeCallback) {\n    var toggleEl = new (0, $cmnov.BoxToggle)({\n        label: (0, $eWjiX.BB).el({\n            className: \"dark-invert\",\n            css: {\n                width: \"17px\",\n                height: \"17px\",\n                backgroundImage: 'url(\"' + (0, (/*@__PURE__*/$parcel$interopDefault($8IsQq))) + '\")',\n                backgroundSize: \"contain\",\n                backgroundRepeat: \"no-repeat\",\n                margin: \"1px\",\n                borderRadius: \"3px\"\n            }\n        }),\n        title: (0, $1mH1z.LANG)(\"brush-toggle-pressure\"),\n        init: isChecked,\n        onChange: function(b) {\n            changeCallback(b);\n        }\n    });\n    return toggleEl.getElement();\n};\n\n});\nparcelRequire.register(\"8IsQq\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"h8ubb\");\n\n});\n\nparcelRequire.register(\"cmnov\", function(module, exports) {\n\n$parcel$export(module.exports, \"BoxToggle\", function () { return $afe02cc26c765c2c$export$2358c75ad3c15b2d; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $afe02cc26c765c2c$export$2358c75ad3c15b2d = /*#__PURE__*/ function() {\n    \"use strict\";\n    function BoxToggle(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, BoxToggle);\n        this.value = !!p.init;\n        this.el = (0, $eWjiX.BB).el({\n            content: p.label,\n            title: p.title,\n            className: typeof p.label === \"string\" ? \"kl-box-toggle\" : \"kl-box-toggle kl-box-toggle--custom-el\",\n            onClick: function() {\n                _this.value = !_this.value;\n                _this.update();\n                p.onChange(_this.value);\n            },\n            css: {\n                cursor: \"pointer\"\n            }\n        });\n        if (typeof p.label !== \"string\") (0, $eWjiX.BB).css(p.label, {\n            display: \"block\",\n            pointerEvents: \"none\"\n        });\n        this.update();\n    }\n    (0, $7h4XF._)(BoxToggle, [\n        {\n            key: \"update\",\n            value: function update() {\n                this.el.classList.toggle(\"kl-box-toggle--active\", this.value);\n            }\n        },\n        {\n            key: \"getValue\",\n            value: function getValue() {\n                return this.value;\n            }\n        },\n        {\n            key: \"setValue\",\n            value: function setValue(b) {\n                this.value = !!b;\n                this.update();\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.el;\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                (0, $eWjiX.BB).destroyEl(this.el);\n            }\n        }\n    ]);\n    return BoxToggle;\n}();\n\n});\n\n\nparcelRequire.register(\"aP0jf\", function(module, exports) {\n\n$parcel$export(module.exports, \"KlSlider\", function () { return $5c0625e6104e2c75$export$a1855b925e534de7; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $11glk = parcelRequire(\"11glk\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $869o9 = parcelRequire(\"869o9\");\nvar $5c0625e6104e2c75$export$a1855b925e534de7 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function KlSlider(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, KlSlider);\n        this.isEnabled = p.isEnabled !== false;\n        this.manualInputRoundDigits = p.manualInputRoundDigits;\n        this.useSpline = !!p.curve;\n        if (!p.label) throw new Error(\"KlSlider missing params\");\n        if (p.min != 0 && p.max != 0 && p.value != 0) {\n            if (!p.min || !p.max || !p.value) throw new Error(\"KlSlider broken params\");\n        }\n        if (p.min >= p.max) throw new Error(\"KlSlider broken params\");\n        this.min = p.min;\n        this.max = p.max;\n        this.value = (0, $eWjiX.BB).clamp(p.value, this.min, this.max);\n        this.elementWidth = p.width;\n        this.elementHeight = p.height;\n        this.resolution = p.resolution ? p.resolution : this.elementWidth * 2;\n        this.onChange = p.onChange ? p.onChange : function() {};\n        if (!p.toValue !== !p.toDisplayValue) throw new Error(\"both or neither have to be set, toValue and toDisplayValue\");\n        this.displayValueToValue = p.toValue ? p.toValue : function(displayValue) {\n            return displayValue;\n        };\n        this.valueToDisplayValue = p.toDisplayValue ? p.toDisplayValue : function(value) {\n            return value;\n        };\n        this.isChangeOnFinal = !!p.isChangeOnFinal;\n        this.formatFunc = p.formatFunc;\n        this.eventResMs = p.eventResMs;\n        this.unit = p.unit;\n        if (this.useSpline) {\n            if (!p.curve) throw new Error(\"curve needs to be set if useSpline true\");\n            var curveArr = p.curve === \"quadratic\" ? (0, $eWjiX.BB).quadraticSplineInput(this.min, this.max, 0.1) : p.curve;\n            this.splineInterpolator = new (0, $eWjiX.BB).SplineInterpolator(curveArr);\n        }\n        this.rootEl = (0, $eWjiX.BB).el({\n            css: {\n                display: \"flex\"\n            }\n        });\n        this.sliderWrapperEl = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            className: \"slider-wrapper\",\n            css: {\n                overflow: \"hidden\",\n                position: \"relative\",\n                width: this.elementWidth + \"px\",\n                height: this.elementHeight + \"px\",\n                userSelect: \"none\"\n            }\n        });\n        this.rootEl.oncontextmenu = function() {\n            return false;\n        };\n        this.label = p.label;\n        var labelFontSize = this.elementHeight - 14;\n        this.textEl = (0, $eWjiX.BB).el({\n            content: this.label,\n            css: {\n                position: \"absolute\",\n                display: \"flex\",\n                alignItems: \"center\",\n                marginLeft: \"7px\",\n                height: \"100%\",\n                fontSize: labelFontSize + \"px\",\n                pointerEvents: \"none\"\n            }\n        });\n        this.control = (0, $eWjiX.BB).el({\n            className: \"slider-inner\",\n            css: {\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\",\n                width: this.valueToSliderValue(this.value) * this.elementWidth + \"px\",\n                height: this.elementHeight + \"px\"\n            }\n        });\n        var controlInner = document.createElement(\"div\");\n        this.sliderWrapperEl.append(this.control, this.textEl);\n        this.control.append(controlInner);\n        this.updateEnable();\n        var doubleTapper = new (0, $eWjiX.BB).DoubleTapper({\n            onDoubleTap: function() {\n                _this.showManualInput();\n            }\n        });\n        doubleTapper.setAllowedButtonArr([\n            \"left\",\n            \"right\"\n        ]);\n        var eventChain = new (0, $eWjiX.BB).EventChain({\n            chainArr: [\n                doubleTapper\n            ]\n        });\n        var virtualVal;\n        var onPointer = function(event) {\n            event.eventPreventDefault();\n            if (!_this.isEnabled) return;\n            if (event.type === \"pointerdown\") {\n                // unfocus manual slider input\n                (0, $eWjiX.BB).unfocusAnyInput();\n                _this.sliderWrapperEl.className = \"slider-wrapper slider-wrapper--active\";\n                if (event.button === \"left\") {\n                    var sliderValue = event.relX / _this.elementWidth;\n                    sliderValue = Math.max(0, Math.min(1, sliderValue));\n                    _this.value = _this.sliderValueToValue(sliderValue);\n                    _this.updateLabel();\n                    _this.emit(false);\n                }\n                virtualVal = _this.valueToSliderValue(_this.value);\n            }\n            if (event.type === \"pointermove\" && [\n                \"left\",\n                \"right\"\n            ].includes(event.button || \"\")) {\n                var deltaX = event.dX;\n                var deltaY = Math.abs(event.pageY - (event.downPageY || 0));\n                var factor = (0, $11glk.calcSliderFalloffFactor)(deltaY, event.button === \"right\");\n                deltaX *= factor;\n                deltaX /= _this.elementWidth;\n                virtualVal += deltaX;\n                var sliderValue1 = Math.max(0, Math.min(1, virtualVal));\n                _this.value = _this.sliderValueToValue(sliderValue1);\n                _this.updateLabel();\n                _this.emit(false);\n            }\n            if (event.type === \"pointerup\") {\n                _this.sliderWrapperEl.className = \"slider-wrapper\";\n                _this.emit(true);\n            }\n        };\n        this.pointerListenerTimeout = setTimeout(function() {\n            _this.pointerListener = new (0, $eWjiX.BB).PointerListener({\n                target: _this.sliderWrapperEl,\n                fixScribble: true,\n                onPointer: function(e) {\n                    onPointer(e);\n                    eventChain.chainIn(e);\n                },\n                onWheel: function(event) {\n                    var sliderValue = _this.valueToSliderValue(_this.value);\n                    sliderValue = (0, $eWjiX.BB).clamp(sliderValue - event.deltaY / 40, 0, 1);\n                    _this.value = _this.sliderValueToValue(sliderValue);\n                    _this.updateLabel();\n                    _this.onChange(_this.value);\n                }\n            });\n            _this.updateLabel();\n        }, 1);\n    }\n    (0, $7h4XF._)(KlSlider, [\n        {\n            key: \"valueToSliderValue\",\n            value: function valueToSliderValue(value) {\n                if (this.useSpline && this.splineInterpolator) return this.splineInterpolator.findX(value, Math.floor(this.resolution)) || 0;\n                return (value - this.min) / (this.max - this.min);\n            }\n        },\n        {\n            key: \"sliderValueToValue\",\n            value: function sliderValueToValue(sliderValue) {\n                var result = this.min + sliderValue * (this.max - this.min);\n                if (this.useSpline && this.splineInterpolator) result = this.splineInterpolator.interpolate(sliderValue) || 0;\n                return result;\n            }\n        },\n        {\n            key: \"updateLabel\",\n            value: function updateLabel() {\n                var displayValue = this.valueToDisplayValue(this.value);\n                displayValue = this.formatFunc ? this.formatFunc(displayValue) : Math.round(displayValue);\n                displayValue = displayValue.toLocaleString((0, $1mH1z.languageStrings).getCode());\n                var unit = this.unit !== undefined ? this.unit : \"\";\n                this.textEl.innerHTML = this.label + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + displayValue + unit + \"</span>\";\n                var sliderValue = this.valueToSliderValue(this.value);\n                this.control.style.width = sliderValue * this.elementWidth + \"px\";\n            }\n        },\n        {\n            key: \"emit\",\n            value: function emit(isFinal) {\n                var _this = this;\n                if (!isFinal && this.isChangeOnFinal) return;\n                if (isFinal || !this.eventResMs) {\n                    this.onChange(this.value);\n                    if (this.emitInterval) {\n                        clearInterval(this.emitInterval);\n                        this.emitInterval = undefined;\n                    }\n                    return;\n                }\n                if (this.emitInterval) this.emitValue = this.value;\n                else {\n                    this.onChange(this.value);\n                    this.emitInterval = setInterval(function() {\n                        if (_this.emitValue === undefined) {\n                            clearInterval(_this.emitInterval);\n                            _this.emitInterval = undefined;\n                        } else {\n                            _this.onChange(_this.emitValue);\n                            _this.emitValue = undefined;\n                        }\n                    }, this.eventResMs);\n                }\n            }\n        },\n        {\n            key: \"updateEnable\",\n            value: function updateEnable() {\n                this.sliderWrapperEl.classList.toggle(\"slider-wrapper--disabled\", !this.isEnabled);\n                (0, $eWjiX.BB).css(this.sliderWrapperEl, {\n                    opacity: this.isEnabled ? \"\" : \"0.5\",\n                    pointerEvents: this.isEnabled ? \"\" : \"none\"\n                });\n                if (this.manualInput) this.manualInput.setIsEnabled(this.isEnabled);\n            }\n        },\n        {\n            key: \"showManualInput\",\n            value: function showManualInput() {\n                var _this = this;\n                this.manualInput = new (0, $869o9.KlSliderManualInput)(this.valueToDisplayValue(this.value), this.valueToDisplayValue(this.min), this.valueToDisplayValue(this.max), this.sliderWrapperEl.getBoundingClientRect(), function(val) {\n                    val = _this.displayValueToValue(val);\n                    _this.setValue((0, $eWjiX.BB).clamp(val, _this.min, _this.max));\n                    _this.onChange(_this.value);\n                }, function() {\n                    (0, $eWjiX.BB).css(_this.sliderWrapperEl, {\n                        display: \"\"\n                    });\n                    if (_this.manualInput) {\n                        _this.manualInput.getElement().remove();\n                        _this.manualInput.destroy();\n                    }\n                    _this.manualInput = undefined;\n                }, this.manualInputRoundDigits && this.manualInputRoundDigits > 0 ? this.manualInputRoundDigits : 0);\n                this.manualInput.setIsEnabled(this.isEnabled);\n                this.rootEl.append(this.manualInput.getElement());\n                setTimeout(function() {\n                    _this.manualInput && _this.manualInput.focus();\n                });\n                (0, $eWjiX.BB).css(this.sliderWrapperEl, {\n                    display: \"none\"\n                });\n            }\n        },\n        {\n            key: \"changeSliderValue\",\n            value: function changeSliderValue(f) {\n                if (!this.isEnabled) return;\n                var sliderValue = this.valueToSliderValue(this.value);\n                sliderValue = (0, $eWjiX.BB).clamp(sliderValue + f, 0, 1);\n                this.value = this.sliderValueToValue(sliderValue);\n                this.updateLabel();\n                this.onChange(this.value);\n            }\n        },\n        {\n            key: \"setValue\",\n            value: function setValue(v) {\n                this.value = (0, $eWjiX.BB).clamp(v, this.min, this.max);\n                this.updateLabel();\n            }\n        },\n        {\n            key: \"getValue\",\n            value: function getValue() {\n                return this.value;\n            }\n        },\n        {\n            key: \"update\",\n            value: function update(config) {\n                this.min = config.min;\n                this.max = config.max;\n                this.useSpline = !!config.curve;\n                if (this.useSpline) {\n                    if (!config.curve) throw new Error(\"curve needs to be set if useSpline true\");\n                    var curveArr = config.curve === \"quadratic\" ? (0, $eWjiX.BB).quadraticSplineInput(this.min, this.max, 0.1) : config.curve;\n                    this.splineInterpolator = new (0, $eWjiX.BB).SplineInterpolator(curveArr);\n                } else this.splineInterpolator = undefined;\n                this.setIsEnabled(!config.isDisabled);\n            }\n        },\n        {\n            key: \"setIsEnabled\",\n            value: function setIsEnabled(e) {\n                this.isEnabled = !!e;\n                this.updateEnable();\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                clearTimeout(this.pointerListenerTimeout);\n                this.pointerListener && this.pointerListener.destroy();\n                if (this.manualInput) this.manualInput.destroy();\n                if (this.emitInterval) clearInterval(this.emitInterval);\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        }\n    ]);\n    return KlSlider;\n}();\n\n});\nparcelRequire.register(\"11glk\", function(module, exports) {\n\n$parcel$export(module.exports, \"calcSliderFalloffFactor\", function () { return $16ee6d1163eaf409$export$f8e41e222e32615d; });\n/**\r\n * To make sliders more fine-grained. The falloff when moving cursor away from cursor.\r\n * Returns the factor [0,1]\r\n *  0 -> infinite movement required for change of 1\r\n *  1 -> 1px movement for change of 1\r\n *\r\n * @param deltaY vertical distance from pointerdown\r\n * @param isRightButton\r\n */ function $16ee6d1163eaf409$export$f8e41e222e32615d(deltaY, isRightButton) {\n    var result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\n    if (isRightButton) result *= 2;\n    return 1 / result;\n}\n\n});\n\nparcelRequire.register(\"869o9\", function(module, exports) {\n\n$parcel$export(module.exports, \"KlSliderManualInput\", function () { return $068903cd1342554f$export$db3d4fde05db9a5e; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $dJPtW = parcelRequire(\"dJPtW\");\nvar $068903cd1342554f$export$db3d4fde05db9a5e = /*#__PURE__*/ function() {\n    \"use strict\";\n    function KlSliderManualInput(value, min, max, rect, onChange, onClose, roundDigits) {\n        var _this = this;\n        (0, $cx0mh._)(this, KlSliderManualInput);\n        this.onChange = onChange;\n        this.onClose = onClose;\n        this.isEnabled = true;\n        this.isClosed = false;\n        this.input = (0, $dJPtW.input)({\n            type: \"number\",\n            init: value,\n            min: min,\n            max: max,\n            callback: function(val) {\n                _this.emit();\n            }\n        });\n        if (roundDigits !== 0) this.input.setAttribute(\"step\", \"any\");\n        this.input.onblur = function() {\n            _this.privateOnClose();\n        };\n        this.input.addEventListener(\"keyup\", function(e) {\n            if ([\n                \"Enter\",\n                \"Escape\"\n            ].includes(e.key)) _this.privateOnClose();\n            else _this.emit();\n        });\n        this.input.addEventListener(\"wheel\", function() {\n            return _this.emit();\n        });\n        this.scrollBefore = {\n            x: window.scrollX,\n            y: window.scrollY\n        };\n        var currentValue;\n        if (roundDigits || roundDigits === 0) currentValue = (0, $eWjiX.BB).round(value, roundDigits);\n        else currentValue = value;\n        this.lastValue = currentValue;\n        this.input.value = \"\" + currentValue;\n        (0, $eWjiX.BB).css(this.input, {\n            width: rect.width + \"px\",\n            height: rect.height + \"px\"\n        });\n    }\n    (0, $7h4XF._)(KlSliderManualInput, [\n        {\n            key: \"emit\",\n            value: function emit() {\n                if (this.lastValue !== Number(this.input.value)) {\n                    this.onChange(Number(this.input.value));\n                    this.lastValue = Number(this.input.value);\n                }\n            }\n        },\n        {\n            key: \"privateOnClose\",\n            value: function privateOnClose() {\n                var _this = this;\n                if (this.isClosed) return;\n                this.isClosed = true;\n                this.emit();\n                this.onClose();\n                setTimeout(function() {\n                    // because iPad keyboard changes the scroll position\n                    _this.scrollBefore && window.scrollTo(_this.scrollBefore.x, _this.scrollBefore.y);\n                    _this.scrollBefore = undefined;\n                });\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.input;\n            }\n        },\n        {\n            key: \"setIsEnabled\",\n            value: function setIsEnabled(b) {\n                this.isEnabled = !!b;\n            }\n        },\n        {\n            key: \"focus\",\n            value: function focus() {\n                this.input.focus();\n                this.input.select();\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                (0, $eWjiX.BB).destroyEl(this.input);\n            }\n        }\n    ]);\n    return KlSliderManualInput;\n}();\n\n});\n\n\nparcelRequire.register(\"lfHl9\", function(module, exports) {\n\n$parcel$export(module.exports, \"HexColorDialog\", function () { return $dada52d673c8c4ac$export$cc42e119007cb939; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $dJPtW = parcelRequire(\"dJPtW\");\n\nvar $2MaaK = parcelRequire(\"2MaaK\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $bJupx = parcelRequire(\"bJupx\");\nvar $dada52d673c8c4ac$export$cc42e119007cb939 = function HexColorDialog(p) {\n    \"use strict\";\n    (0, $cx0mh._)(this, HexColorDialog);\n    var createRgbInputRow = // --- R G B ---\n    function createRgbInputRow(labelStr, attributeStr) {\n        var rowEl = (0, $eWjiX.BB).el({\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                marginTop: \"5px\"\n            }\n        });\n        var labelEl = (0, $eWjiX.BB).el({\n            content: labelStr,\n            css: {\n                width: \"60px\"\n            }\n        });\n        var inputEl = (0, $dJPtW.input)({\n            init: lastValidRgb[attributeStr],\n            min: 0,\n            max: 255,\n            type: \"number\",\n            css: {\n                width: \"80px\"\n            },\n            callback: function callback() {\n                if (inputEl.value === \"\" || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\n                    result.update();\n                    return;\n                }\n                inputEl.value = \"\" + Math.round(parseFloat(inputEl.value));\n                lastValidRgb[attributeStr] = Number(inputEl.value);\n                previewEl.style.background = \"#\" + (0, $eWjiX.BB).ColorConverter.toHexString(lastValidRgb);\n                hexInput.value = \"#\" + (0, $eWjiX.BB).ColorConverter.toHexString(lastValidRgb);\n            }\n        });\n        rowEl.append(labelEl, inputEl);\n        div.append(rowEl);\n        var result = {\n            update: function() {\n                inputEl.value = \"\" + lastValidRgb[attributeStr];\n            },\n            destroy: function() {\n                (0, $eWjiX.BB).unsetEventHandler(inputEl, \"onchange\");\n            }\n        };\n        return result;\n    };\n    var lastValidRgb = new (0, $eWjiX.BB).RGB(p.color.r, p.color.g, p.color.b);\n    var div = (0, $eWjiX.BB).el();\n    var previewEl = (0, $eWjiX.BB).el({\n        css: {\n            width: \"20px\",\n            height: \"20px\",\n            marginBottom: \"10px\",\n            boxShadow: \"inset 0 0 0 1px #fff, 0 0 0 1px #000\",\n            background: \"#\" + (0, $eWjiX.BB).ColorConverter.toHexString(lastValidRgb)\n        }\n    });\n    div.append(previewEl);\n    // --- Hex ---\n    var hexRowEl = (0, $eWjiX.BB).el({\n        css: {\n            display: \"flex\",\n            alignItems: \"center\",\n            marginBottom: \"15px\"\n        }\n    });\n    var hexLabel = (0, $eWjiX.BB).el({\n        content: (0, $1mH1z.LANG)(\"mci-hex\"),\n        css: {\n            width: \"60px\"\n        }\n    });\n    var hexInput = (0, $dJPtW.input)({\n        init: \"#\" + (0, $eWjiX.BB).ColorConverter.toHexString(lastValidRgb),\n        css: {\n            width: \"80px\"\n        },\n        callback: function callback() {\n            var rgbObj = (0, $eWjiX.BB).ColorConverter.hexToRGB(hexInput.value);\n            if (!rgbObj) {\n                rgbObj = lastValidRgb;\n                hexInput.value = \"#\" + (0, $eWjiX.BB).ColorConverter.toHexString(lastValidRgb);\n            } else lastValidRgb = rgbObj;\n            previewEl.style.background = \"#\" + (0, $eWjiX.BB).ColorConverter.toHexString(rgbObj);\n            for(var i = 0; i < rgbArr.length; i++)rgbArr[i].update();\n        }\n    });\n    var copyButton = (0, $eWjiX.BB).el({\n        tagName: \"button\",\n        content: '<img src=\"' + (0, (/*@__PURE__*/$parcel$interopDefault($bJupx))) + '\" height=\"20\" alt=\"\"/>',\n        title: (0, $1mH1z.LANG)(\"mci-copy\"),\n        css: {\n            marginLeft: \"10px\"\n        },\n        onClick: function onClick() {\n            hexInput.select();\n            document.execCommand(\"copy\");\n        }\n    });\n    hexRowEl.append(hexLabel, hexInput, copyButton);\n    div.append(hexRowEl);\n    setTimeout(function() {\n        hexInput.focus();\n        hexInput.select();\n    }, 0);\n    var rgbArr = [];\n    rgbArr.push(createRgbInputRow((0, $1mH1z.LANG)(\"red\"), \"r\"));\n    rgbArr.push(createRgbInputRow((0, $1mH1z.LANG)(\"green\"), \"g\"));\n    rgbArr.push(createRgbInputRow((0, $1mH1z.LANG)(\"blue\"), \"b\"));\n    (0, $2MaaK.showModal)({\n        target: document.body,\n        message: \"<b>\".concat((0, $1mH1z.LANG)(\"manual-color-input\"), \"</b>\"),\n        div: div,\n        autoFocus: false,\n        clickOnEnter: \"Ok\",\n        buttons: [\n            \"Ok\",\n            \"Cancel\"\n        ],\n        callback: function callback(resultStr) {\n            (0, $eWjiX.BB).destroyEl(copyButton);\n            rgbArr.forEach(function(item) {\n                return item.destroy();\n            });\n            rgbArr.splice(0, rgbArr.length);\n            p.onClose(resultStr === \"Ok\" ? (0, $eWjiX.BB).ColorConverter.hexToRGB(hexInput.value) : undefined);\n        }\n    });\n};\n\n});\nparcelRequire.register(\"bJupx\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"htADd\");\n\n});\n\n\nparcelRequire.register(\"fg9Sv\", function(module, exports) {\n\n$parcel$export(module.exports, \"KlColorSlider\", function () { return $0ebf4eb3a9343b24$export$4e5102252876c5d7; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $lfHl9 = parcelRequire(\"lfHl9\");\n\nvar $11glk = parcelRequire(\"11glk\");\n\nvar $6fV2b = parcelRequire(\"6fV2b\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $fohxs = parcelRequire(\"fohxs\");\nvar $0ebf4eb3a9343b24$export$4e5102252876c5d7 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function KlColorSlider(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, KlColorSlider);\n        this.rootEl = (0, $eWjiX.BB).el({\n            className: \"kl-color-picker\",\n            css: {\n                position: \"relative\"\n            }\n        });\n        this.outputDiv = (0, $eWjiX.BB).el({\n            css: {\n                display: \"flex\",\n                alignItems: \"center\"\n            }\n        });\n        this.width = p.width;\n        this.svHeight = p.svHeight;\n        this.height = p.height;\n        this.emitColor = p.onPick;\n        this.primaryColorRGB = {\n            r: parseInt(\"\" + p.startValue.r),\n            g: parseInt(\"\" + p.startValue.g),\n            b: parseInt(\"\" + p.startValue.b)\n        };\n        this.primaryColorHSV = (0, $eWjiX.BB).ColorConverter.toHSV(p.startValue); // BB.HSV\n        this.secondaryColorRGB = {\n            r: (0, $fohxs.ERASE_COLOR),\n            g: (0, $fohxs.ERASE_COLOR),\n            b: (0, $fohxs.ERASE_COLOR)\n        };\n        this.secondaryColorHSV = (0, $eWjiX.BB).ColorConverter._RGBtoHSV(this.secondaryColorRGB); // BB.HSV\n        var svWrapper = (0, $eWjiX.BB).el();\n        this.svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"><defs><linearGradient id=\"value\" gradientTransform=\"rotate(90)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop offset=\"100%\" stop-color=\"#000\"/></linearGradient><linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/></linearGradient></defs><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\" style=\"mix-blend-mode: multiply\"/></svg>', \"image/svg+xml\").documentElement;\n        {\n            var hueStop = this.svSvg.querySelector(\"#hue-stop\");\n            if (!hueStop) throw Error(\"#hue-stop not found in svSvg\");\n            this.hueStop = hueStop;\n        }\n        (0, $eWjiX.BB).setAttributes(this.hueStop, {\n            \"stop-color\": \"#f0f\"\n        });\n        (0, $eWjiX.BB).css(this.svSvg, {\n            width: this.width + \"px\",\n            height: this.svHeight + \"px\"\n        });\n        svWrapper.append(this.svSvg);\n        var divH = (0, $eWjiX.BB).el({\n            className: \"kl-color-picker__h\",\n            css: {\n                overflow: \"hidden\",\n                position: \"relative\",\n                width: this.width + \"px\",\n                height: this.height + \"px\",\n                cursor: \"ew-resize\",\n                marginTop: \"1px\",\n                marginBottom: \"1px\"\n            }\n        });\n        this.divPreview = (0, $eWjiX.BB).el({\n            className: \"kl-color-picker__preview\",\n            css: {\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                width: this.height * 2.5 + \"px\",\n                height: this.height + \"px\"\n            }\n        });\n        this.controlH = (0, $eWjiX.BB).el();\n        var createHueBg = function(targetEl) {\n            var im = new Image();\n            (0, $eWjiX.BB).css(im, {\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\",\n                display: \"none\",\n                pointerEvents: \"none\"\n            });\n            var cv = (0, $eWjiX.BB).canvas(_this.width, _this.height);\n            var ctx = (0, $eWjiX.BB).ctx(cv);\n            var gradH = ctx.createLinearGradient(0, 0, _this.width, 0);\n            for(var i = 0; i < 1; i += 0.01){\n                var col = (0, $eWjiX.BB).ColorConverter.toRGB(new (0, $eWjiX.BB).HSV(i * 360, 100, 100));\n                var ha = parseInt(\"\" + col.r).toString(16);\n                var hb = parseInt(\"\" + col.g).toString(16);\n                var hc = parseInt(\"\" + col.b).toString(16);\n                if (ha.length === 1) ha = \"0\" + ha;\n                if (hb.length === 1) hb = \"0\" + hb;\n                if (hc.length === 1) hc = \"0\" + hc;\n                gradH.addColorStop(i, \"#\" + ha + hb + hc);\n            }\n            ctx.fillStyle = gradH;\n            ctx.fillRect(0, 0, _this.width, _this.height);\n            targetEl.append(im);\n            im.alt = \"hue\";\n            im.src = cv.toDataURL(\"image/png\");\n            im.style.display = \"block\";\n        };\n        this.updateSVCanvas();\n        this.rootEl.style.width = this.width + \"px\";\n        this.rootEl.oncontextmenu = function() {\n            return false;\n        };\n        this.SVContainer = (0, $eWjiX.BB).el({\n            className: \"kl-color-picker__sv\",\n            css: {\n                width: this.width + \"px\",\n                height: this.svHeight + \"px\",\n                overflow: \"hidden\",\n                display: \"block\",\n                position: \"relative\",\n                cursor: \"crosshair\"\n            }\n        });\n        this.pointerSV = (0, $eWjiX.BB).el({\n            css: {\n                width: \"12px\",\n                height: \"12px\",\n                borderRadius: \"6px\",\n                position: \"absolute\",\n                pointerEvents: \"none\",\n                boxShadow: \"0px 0px 0 1px #000, inset 0px 0px 0 1px #fff\"\n            }\n        });\n        this.SVContainer.append(svWrapper, this.pointerSV);\n        this.updateSVPointer();\n        this.rootEl.append(this.SVContainer, divH);\n        this.outputDiv.append(this.divPreview);\n        //divH.className = \"svSlider\";\n        (0, $eWjiX.BB).css(this.controlH, {\n            width: \"1px\",\n            height: this.height + \"px\",\n            background: \"#000\",\n            borderLeft: \"1px solid #fff\",\n            position: \"absolute\",\n            top: \"0\",\n            left: parseInt(\"\" + (this.primaryColorHSV.h / 360 * this.width - 1)) + \"px\"\n        });\n        var virtualHSV = {\n            h: 0,\n            s: 0,\n            v: 0\n        };\n        this.pickerButton = (0, $eWjiX.BB).el({\n            title: (0, $1mH1z.LANG)(\"eyedropper\") + \" [Alt]\",\n            className: \"color-picker-preview-button\",\n            css: {\n                width: \"30px\",\n                height: \"30px\",\n                backgroundImage: \"url(\" + (0, (/*@__PURE__*/$parcel$interopDefault($6fV2b))) + \")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundSize: \"70%\",\n                backgroundPosition: \"center\"\n            },\n            onClick: function() {\n                if (_this.isPicking) {\n                    _this.pickCallback && _this.pickCallback(false);\n                    _this.pickingDone();\n                } else {\n                    _this.pickerButton.classList.remove(\"color-picker-preview-button-hover\");\n                    _this.pickerButton.classList.add(\"color-picker-preview-button-active\");\n                    _this.isPicking = true;\n                    _this.pickCallback && _this.pickCallback(true);\n                }\n            }\n        });\n        this.isPicking = false;\n        var pickerButtonPointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.pickerButton,\n            onEnterLeave: function(isOver) {\n                if (_this.isPicking) return;\n                _this.pickerButton.classList.toggle(\"color-picker-preview-button-hover\", isOver);\n            }\n        });\n        this.divPreview.append(this.pickerButton);\n        this.hexButton = (0, $eWjiX.BB).el({\n            content: \"#\",\n            className: \"color-picker-preview-button\",\n            title: (0, $1mH1z.LANG)(\"manual-color-input\"),\n            css: {\n                height: \"100%\",\n                width: this.height + \"px\",\n                lineHeight: this.height + \"px\",\n                fontSize: this.height * 0.65 + \"px\"\n            },\n            onClick: function() {\n                new (0, $lfHl9.HexColorDialog)({\n                    color: new (0, $eWjiX.BB).RGB(_this.primaryColorRGB.r, _this.primaryColorRGB.g, _this.primaryColorRGB.b),\n                    onClose: function(rgbObj) {\n                        if (!rgbObj) return;\n                        _this.setColor(rgbObj);\n                        _this.emitColor(new (0, $eWjiX.BB).RGB(_this.primaryColorRGB.r, _this.primaryColorRGB.g, _this.primaryColorRGB.b));\n                    }\n                });\n            }\n        });\n        var hexButtonPointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.hexButton,\n            onEnterLeave: function(isOver) {\n                _this.hexButton.classList.toggle(\"color-picker-preview-button-hover\", isOver);\n            }\n        });\n        this.divPreview.append(this.hexButton);\n        this.setColPreview();\n        setTimeout(function() {\n            createHueBg(divH);\n            divH.append(_this.controlH);\n            var svPointerListener = new (0, $eWjiX.BB).PointerListener({\n                target: svWrapper,\n                fixScribble: true,\n                onPointer: function(event) {\n                    if (event.type === \"pointerdown\") {\n                        // prevent manual slider input keeping focus on iPad\n                        (0, $eWjiX.BB).unfocusAnyInput();\n                        _this.SVContainer.classList.toggle(\"kl-color-picker--active\", true);\n                        if (event.button === \"left\") {\n                            virtualHSV.s = event.relX / _this.width * 100;\n                            virtualHSV.v = 100 - event.relY / _this.svHeight * 100;\n                            _this.primaryColorHSV = new (0, $eWjiX.BB).HSV(_this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\n                            _this.primaryColorRGB = (0, $eWjiX.BB).ColorConverter.toRGB(_this.primaryColorHSV);\n                            _this.updateSVPointer();\n                            _this.setColPreview();\n                            _this.emitColor((0, $eWjiX.BB).ColorConverter.toRGB(_this.primaryColorHSV));\n                        } else {\n                            virtualHSV.s = _this.primaryColorHSV.s;\n                            virtualHSV.v = _this.primaryColorHSV.v;\n                        }\n                    }\n                    if (event.type === \"pointermove\" && [\n                        \"left\",\n                        \"right\"\n                    ].includes(event.button || \"\")) {\n                        var factor = 1;\n                        if (event.button === \"right\") factor = 0.5;\n                        virtualHSV.s += event.dX / _this.width * 100 * factor;\n                        virtualHSV.v -= event.dY / _this.svHeight * 100 * factor;\n                        _this.primaryColorHSV = new (0, $eWjiX.BB).HSV(_this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\n                        _this.primaryColorRGB = (0, $eWjiX.BB).ColorConverter.toRGB(_this.primaryColorHSV);\n                        _this.updateSVPointer();\n                        _this.setColPreview();\n                        _this.emitColor((0, $eWjiX.BB).ColorConverter.toRGB(_this.primaryColorHSV));\n                    }\n                    if (event.type === \"pointerup\") _this.SVContainer.classList.toggle(\"kl-color-picker--active\", false);\n                }\n            });\n            var hPointerListener = new (0, $eWjiX.BB).PointerListener({\n                target: divH,\n                fixScribble: true,\n                onPointer: function(event) {\n                    if (event.type === \"pointerdown\") {\n                        // prevent manual slider input keeping focus on iPad\n                        (0, $eWjiX.BB).unfocusAnyInput();\n                        divH.classList.toggle(\"kl-color-picker--active\", true);\n                        if (event.button === \"left\") {\n                            virtualHSV.h = event.relX / _this.width * 359.99;\n                            _this.primaryColorHSV = new (0, $eWjiX.BB).HSV(virtualHSV.h, _this.primaryColorHSV.s, _this.primaryColorHSV.v);\n                            _this.primaryColorRGB = (0, $eWjiX.BB).ColorConverter.toRGB(_this.primaryColorHSV);\n                            _this.controlH.style.left = Math.round(_this.primaryColorHSV.h / 359.99 * _this.width) - 1 + \"px\";\n                            _this.updateSVCanvas();\n                            _this.setColPreview();\n                            _this.emitColor((0, $eWjiX.BB).ColorConverter.toRGB(_this.primaryColorHSV));\n                        } else virtualHSV.h = _this.primaryColorHSV.h;\n                    }\n                    if (event.type === \"pointermove\" && [\n                        \"left\",\n                        \"right\"\n                    ].includes(event.button || \"\")) {\n                        var deltaY = Math.abs(event.pageY - event.downPageY);\n                        var factor = (0, $11glk.calcSliderFalloffFactor)(deltaY, event.button === \"right\");\n                        virtualHSV.h += event.dX / _this.width * 359.99 * factor;\n                        if (event.button === \"right\") {\n                            virtualHSV.h = virtualHSV.h % 359.99;\n                            if (virtualHSV.h < 0) virtualHSV.h += 359.99;\n                        }\n                        virtualHSV.h = Math.min(359.99, virtualHSV.h);\n                        _this.primaryColorHSV = new (0, $eWjiX.BB).HSV(virtualHSV.h, _this.primaryColorHSV.s, _this.primaryColorHSV.v);\n                        _this.primaryColorRGB = (0, $eWjiX.BB).ColorConverter.toRGB(_this.primaryColorHSV);\n                        _this.controlH.style.left = Math.round(_this.primaryColorHSV.h / 359.99 * _this.width) - 1 + \"px\";\n                        _this.updateSVCanvas();\n                        _this.setColPreview();\n                        _this.emitColor((0, $eWjiX.BB).ColorConverter.toRGB(_this.primaryColorHSV));\n                    }\n                    if (event.type === \"pointerup\") divH.classList.toggle(\"kl-color-picker--active\", false);\n                }\n            });\n        }, 1);\n        // --- secondary color ---\n        this.secondaryColorBtn = (0, $eWjiX.BB).el({\n            parent: this.outputDiv,\n            title: (0, $1mH1z.LANG)(\"secondary-color\") + \" [X]\",\n            className: \"kl-color-picker__secondary\",\n            css: {\n                cursor: \"pointer\",\n                marginLeft: \"5px\",\n                width: \"22px\",\n                height: \"22px\"\n            },\n            onClick: function(e) {\n                e.preventDefault();\n                _this.swapColors();\n            }\n        });\n        this.updateSecondaryColor();\n    }\n    (0, $7h4XF._)(KlColorSlider, [\n        {\n            key: \"updatePrimaryHSV\",\n            value: function updatePrimaryHSV(hsv) {\n                if (hsv.s === 0) this.primaryColorHSV = new (0, $eWjiX.BB).HSV(this.primaryColorHSV.h, hsv.s, hsv.v);\n                else this.primaryColorHSV = new (0, $eWjiX.BB).HSV(hsv.h, hsv.s, hsv.v);\n            }\n        },\n        {\n            key: \"updateSVCanvas\",\n            value: function updateSVCanvas() {\n                var rgb = (0, $eWjiX.BB).ColorConverter.toRGB(new (0, $eWjiX.BB).HSV(this.primaryColorHSV.h, 100, 100));\n                (0, $eWjiX.BB).setAttributes(this.hueStop, {\n                    \"stop-color\": \"#\" + (0, $eWjiX.BB).ColorConverter.toHexString(rgb)\n                });\n            }\n        },\n        {\n            key: \"updateSVPointer\",\n            value: function updateSVPointer() {\n                var left = this.primaryColorHSV.s / 100 * this.width - 7;\n                var top = (1 - this.primaryColorHSV.v / 100) * this.svHeight - 6;\n                (0, $eWjiX.BB).css(this.pointerSV, {\n                    left: left + \"px\",\n                    top: top + \"px\"\n                });\n            }\n        },\n        {\n            key: \"setColPreview\",\n            value: function setColPreview() {\n                this.divPreview.style.backgroundColor = \"rgb(\" + this.primaryColorRGB.r + \",\" + this.primaryColorRGB.g + \",\" + this.primaryColorRGB.b + \")\";\n                if ((0, $eWjiX.BB).testIsWhiteBestContrast(this.primaryColorRGB)) {\n                    (0, $eWjiX.BB).css(this.pickerButton, {\n                        filter: \"invert(1)\"\n                    });\n                    (0, $eWjiX.BB).css(this.hexButton, {\n                        filter: \"invert(1)\"\n                    });\n                } else {\n                    (0, $eWjiX.BB).css(this.pickerButton, {\n                        filter: \"\"\n                    });\n                    (0, $eWjiX.BB).css(this.hexButton, {\n                        filter: \"\"\n                    });\n                }\n            }\n        },\n        {\n            key: \"updateSecondaryColor\",\n            value: function updateSecondaryColor() {\n                this.secondaryColorBtn.style.backgroundColor = (0, $eWjiX.BB).ColorConverter.toRgbStr(this.secondaryColorRGB);\n            }\n        },\n        {\n            key: \"setColor\",\n            value: function setColor(c) {\n                this.primaryColorRGB = {\n                    r: parseInt(\"\" + c.r),\n                    g: parseInt(\"\" + c.g),\n                    b: parseInt(\"\" + c.b)\n                };\n                this.updatePrimaryHSV((0, $eWjiX.BB).ColorConverter.toHSV(c));\n                this.controlH.style.left = parseInt(\"\" + (this.primaryColorHSV.h / 359 * this.width - 1)) + \"px\";\n                this.updateSVCanvas();\n                this.updateSVPointer();\n                this.setColPreview();\n            }\n        },\n        {\n            key: \"getColor\",\n            value: function getColor() {\n                return new (0, $eWjiX.BB).RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b);\n            }\n        },\n        {\n            key: \"getSecondaryRGB\",\n            value: function getSecondaryRGB() {\n                return new (0, $eWjiX.BB).RGB(this.secondaryColorRGB.r, this.secondaryColorRGB.g, this.secondaryColorRGB.b);\n            }\n        },\n        {\n            key: \"setPickCallback\",\n            value: function setPickCallback(func) {\n                this.pickCallback = func;\n            }\n        },\n        {\n            key: \"pickingDone\",\n            value: function pickingDone() {\n                if (!this.isPicking) return;\n                this.isPicking = false;\n                this.pickerButton.classList.remove(\"color-picker-preview-button-active\");\n            }\n        },\n        {\n            key: \"enable\",\n            value: function enable(e) {\n                if (e) {\n                    this.rootEl.style.pointerEvents = \"\";\n                    this.rootEl.style.opacity = \"1\";\n                    this.outputDiv.style.pointerEvents = \"\";\n                    this.outputDiv.style.opacity = \"1\";\n                } else {\n                    this.rootEl.style.pointerEvents = \"none\";\n                    this.rootEl.style.opacity = \"0.5\";\n                    this.outputDiv.style.pointerEvents = \"none\";\n                    this.outputDiv.style.opacity = \"0.5\";\n                }\n            }\n        },\n        {\n            key: \"setHeight\",\n            value: function setHeight(h) {\n                h = parseInt(\"\" + (h - this.height * 2 - 3), 10);\n                if (h === this.svHeight) return;\n                this.svHeight = h;\n                (0, $eWjiX.BB).css(this.svSvg, {\n                    width: this.width + \"px\",\n                    height: this.svHeight + \"px\"\n                });\n                this.SVContainer.style.height = this.svHeight + \"px\";\n                this.updateSVPointer();\n            }\n        },\n        {\n            key: \"swapColors\",\n            value: function swapColors() {\n                // swap hsv\n                var tmp = this.secondaryColorHSV;\n                this.secondaryColorHSV = this.primaryColorHSV;\n                this.updatePrimaryHSV(tmp);\n                // swap rgb\n                tmp = this.secondaryColorRGB;\n                this.secondaryColorRGB = this.primaryColorRGB;\n                this.primaryColorRGB = tmp;\n                this.controlH.style.left = parseInt(\"\" + (this.primaryColorHSV.h / 359 * this.width - 1)) + \"px\";\n                this.updateSVCanvas();\n                this.updateSVPointer();\n                this.setColPreview();\n                this.updateSecondaryColor();\n                this.emitColor(new (0, $eWjiX.BB).RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b));\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"getOutputElement\",\n            value: function getOutputElement() {\n                return this.outputDiv;\n            }\n        }\n    ]);\n    return KlColorSlider;\n}();\n\n});\nparcelRequire.register(\"6fV2b\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"ffKNP\");\n\n});\n\nparcelRequire.register(\"fohxs\", function(module, exports) {\n\n$parcel$export(module.exports, \"ERASE_COLOR\", function () { return $00f785a5ea9e210d$export$e4203cb02d5e5b28; });\n\nvar $1C8RU = parcelRequire(\"1C8RU\");\nvar $00f785a5ea9e210d$export$e4203cb02d5e5b28 = (0, $1C8RU.theme).isDark() ? 255 : 255;\n\n});\n\n\nparcelRequire.register(\"gmji4\", function(module, exports) {\n\n$parcel$export(module.exports, \"KlColorSliderSmall\", function () { return $3ce0af1e789f1ab4$export$66306bf21a9ff39e; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $11glk = parcelRequire(\"11glk\");\nvar $3ce0af1e789f1ab4$export$66306bf21a9ff39e = /*#__PURE__*/ function() {\n    \"use strict\";\n    function KlColorSliderSmall(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, KlColorSliderSmall);\n        this.rootEl = (0, $eWjiX.BB).el({\n            css: {\n                width: p.width + \"px\",\n                position: \"relative\",\n                overflow: \"hidden\",\n                userSelect: \"none\"\n            }\n        });\n        this.rootEl.oncontextmenu = function(e) {\n            e.preventDefault();\n        };\n        this.color = (0, $eWjiX.BB).ColorConverter.toHSV(new (0, $eWjiX.BB).RGB(p.color.r, p.color.g, p.color.b));\n        this.width = p.width;\n        this.heightSV = p.heightSV;\n        this.canvasSV = (0, $eWjiX.BB).canvas(10, 10);\n        (0, $eWjiX.BB).css(this.canvasSV, {\n            width: this.width + \"px\",\n            height: this.heightSV + \"px\",\n            cursor: \"crosshair\"\n        });\n        this.updateSV();\n        var canvasH = (0, $eWjiX.BB).canvas(p.width, p.heightH);\n        canvasH.style.cursor = \"ew-resize\";\n        (function() {\n            var ctx = (0, $eWjiX.BB).ctx(canvasH);\n            var gradH = ctx.createLinearGradient(0, 0, p.width, 0);\n            for(var i = 0; i < 1; i += 0.01){\n                var col = (0, $eWjiX.BB).ColorConverter.toRGB(new (0, $eWjiX.BB).HSV(i * 360, 100, 100));\n                gradH.addColorStop(i, \"rgba(\" + parseInt(\"\" + col.r) + \", \" + parseInt(\"\" + col.g) + \", \" + parseInt(\"\" + col.b) + \", 1)\");\n            }\n            ctx.fillStyle = gradH;\n            ctx.fillRect(0, 0, p.width, p.heightH);\n        })();\n        (0, $eWjiX.BB).css(this.canvasSV, {\n            width: p.width + \"px\",\n            height: p.heightSV + \"px\",\n            overflow: \"hidden\",\n            position: \"relative\"\n        });\n        this.canvasSV.style.cssFloat = \"left\";\n        canvasH.style.cssFloat = \"left\";\n        this.rootEl.append(this.canvasSV, canvasH);\n        this.pointerSV = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                width: \"8px\",\n                height: \"8px\",\n                borderRadius: \"8px\",\n                position: \"absolute\",\n                pointerEvents: \"none\",\n                boxShadow: \"0 0 0 1px #000, inset 0 0 0 1px #fff\"\n            }\n        });\n        this.pointerH = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                width: \"0\",\n                height: p.heightH + \"px\",\n                borderLeft: \"1px solid #fff\",\n                borderRight: \"1px solid #000\",\n                position: \"absolute\",\n                top: p.heightSV + \"px\",\n                pointerEvents: \"none\"\n            }\n        });\n        this.updateSVPointer();\n        this.updateHPointer();\n        var virtualHSV = {\n            h: 0,\n            s: 0,\n            v: 0\n        };\n        this.svPointerId = null;\n        this.svPointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.canvasSV,\n            fixScribble: true,\n            onPointer: function(event) {\n                if (event.type === \"pointerdown\") {\n                    // prevent manual slider input keeping focus on iPad\n                    (0, $eWjiX.BB).unfocusAnyInput();\n                    _this.svPointerId = event.pointerId;\n                    if (event.button === \"left\") {\n                        virtualHSV.s = event.relX / p.width * 100;\n                        virtualHSV.v = 100 - event.relY / p.heightSV * 100;\n                        _this.color = new (0, $eWjiX.BB).HSV(_this.color.h, virtualHSV.s, virtualHSV.v);\n                        _this.updateSVPointer();\n                        p.callback((0, $eWjiX.BB).ColorConverter.toRGB(_this.color));\n                    } else {\n                        virtualHSV.s = _this.color.s;\n                        virtualHSV.v = _this.color.v;\n                    }\n                }\n                if (event.type === \"pointermove\" && [\n                    \"left\",\n                    \"right\"\n                ].includes(\"\" + event.button) && _this.svPointerId === event.pointerId) {\n                    var factor = 1;\n                    if (event.button === \"right\") factor = 0.5;\n                    virtualHSV.s += event.dX / p.width * 100 * factor;\n                    virtualHSV.v -= event.dY / p.heightSV * 100 * factor;\n                    _this.color = new (0, $eWjiX.BB).HSV(_this.color.h, virtualHSV.s, virtualHSV.v);\n                    _this.updateSVPointer();\n                    p.callback((0, $eWjiX.BB).ColorConverter.toRGB(_this.color));\n                }\n                if (event.type === \"pointerup\") _this.svPointerId = null;\n            }\n        });\n        this.hPointerId = null;\n        this.hPointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: canvasH,\n            fixScribble: true,\n            onPointer: function(event) {\n                if (event.type === \"pointerdown\") {\n                    _this.hPointerId = event.pointerId;\n                    if (event.button === \"left\") {\n                        virtualHSV.h = event.relX / p.width * 359.99;\n                        _this.color = new (0, $eWjiX.BB).HSV(virtualHSV.h, _this.color.s, _this.color.v);\n                        _this.updateSV();\n                        _this.updateHPointer();\n                        p.callback((0, $eWjiX.BB).ColorConverter.toRGB(_this.color));\n                    } else virtualHSV.h = _this.color.h;\n                }\n                if (event.type === \"pointermove\" && [\n                    \"left\",\n                    \"right\"\n                ].includes(\"\" + event.button) && _this.hPointerId === event.pointerId) {\n                    var deltaY = Math.abs(event.pageY - event.downPageY);\n                    var factor = (0, $11glk.calcSliderFalloffFactor)(deltaY, event.button === \"right\");\n                    virtualHSV.h += event.dX / p.width * 359.99 * factor;\n                    if (event.button === \"right\") {\n                        virtualHSV.h = virtualHSV.h % 359.99;\n                        if (virtualHSV.h < 0) virtualHSV.h += 359.99;\n                    }\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\n                    _this.color = new (0, $eWjiX.BB).HSV(virtualHSV.h, _this.color.s, _this.color.v);\n                    _this.updateSV();\n                    _this.updateHPointer();\n                    p.callback((0, $eWjiX.BB).ColorConverter.toRGB(_this.color));\n                }\n                if (event.type === \"pointerup\") _this.hPointerId = null;\n            }\n        });\n        var cleardiv = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                clear: \"both\"\n            }\n        });\n    }\n    (0, $7h4XF._)(KlColorSliderSmall, [\n        {\n            key: \"updateSV\",\n            value: function updateSV() {\n                var ctx = (0, $eWjiX.BB).ctx(this.canvasSV);\n                if (!ctx) throw new Error(\"couldnt create canvas\");\n                for(var i = 0; i < this.canvasSV.height; i += 1){\n                    var gradient1 = ctx.createLinearGradient(0, 0, this.canvasSV.width, 0);\n                    var colleft = (0, $eWjiX.BB).ColorConverter.toRGB(new (0, $eWjiX.BB).HSV(this.color.h, 1, 100 - i / this.canvasSV.height * 100.0));\n                    var colright = (0, $eWjiX.BB).ColorConverter.toRGB(new (0, $eWjiX.BB).HSV(this.color.h, 100, 100 - i / this.canvasSV.height * 100.0));\n                    gradient1.addColorStop(0, \"#\" + (0, $eWjiX.BB).ColorConverter.toHexString(colleft));\n                    gradient1.addColorStop(1, \"#\" + (0, $eWjiX.BB).ColorConverter.toHexString(colright));\n                    ctx.fillStyle = \"#ff0000\"; //needed for chrome...otherwise alpha problem\n                    ctx.fillStyle = gradient1;\n                    ctx.fillRect(0, i, this.canvasSV.width, 1);\n                }\n            }\n        },\n        {\n            key: \"updateSVPointer\",\n            value: function updateSVPointer() {\n                var left = this.color.s / 100 * this.width - 4;\n                var top = (1 - this.color.v / 100) * this.heightSV - 4;\n                (0, $eWjiX.BB).css(this.pointerSV, {\n                    left: left + \"px\",\n                    top: top + \"px\"\n                });\n            }\n        },\n        {\n            key: \"updateHPointer\",\n            value: function updateHPointer() {\n                this.pointerH.style.left = this.color.h / 359.999 * this.width - 1 + \"px\";\n            }\n        },\n        {\n            // ---- interface ----\n            key: \"setColor\",\n            value: function setColor(c) {\n                this.color = (0, $eWjiX.BB).ColorConverter.toHSV(new (0, $eWjiX.BB).RGB(c.r, c.g, c.b));\n                this.updateSV();\n                this.updateSVPointer();\n                this.updateHPointer();\n            }\n        },\n        {\n            key: \"getColor\",\n            value: function getColor() {\n                return (0, $eWjiX.BB).ColorConverter.toRGB(this.color);\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.svPointerListener.destroy();\n                this.hPointerListener.destroy();\n            }\n        },\n        {\n            key: \"end\",\n            value: function end() {\n                this.svPointerId = null;\n                this.hPointerId = null;\n            }\n        }\n    ]);\n    return KlColorSliderSmall;\n}();\n\n});\n\nparcelRequire.register(\"j5jvd\", function(module, exports) {\n\n$parcel$export(module.exports, \"PointSlider\", function () { return $5e81242a941997c7$export$ac00cea56cec3037; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $5e81242a941997c7$export$ac00cea56cec3037 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function PointSlider(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, PointSlider);\n        this.rootEl = (0, $eWjiX.BB).el({\n            css: {\n                position: \"relative\"\n            }\n        });\n        var sliderLine = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            className: \"kl-point-slider__line\",\n            css: {\n                marginTop: parseInt(\"\" + (p.pointSize / 2 - 1)) + \"px\",\n                width: p.width + \"px\"\n            }\n        });\n        this.sliderPoint = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            className: \"kl-point-slider__point\"\n        });\n        var sliderPos;\n        var isDragging = false;\n        //sliderPoint\n        var touchAreaEl = (0, $eWjiX.BB).el({\n            parent: this.sliderPoint,\n            css: {\n                // background: 'rgba(255,0,0,0.4)',\n                margin: \"-7px 0 0 -7px\",\n                width: \"calc(100% + 14px)\",\n                height: \"calc(100% + 7px)\"\n            }\n        });\n        var redrawPoint = function() {\n            (0, $eWjiX.BB).css(_this.sliderPoint, {\n                left: sliderPos + \"px\"\n            });\n        };\n        var getValue = function() {\n            return sliderPos / (p.width - p.pointSize);\n        };\n        {\n            var isFirst;\n            sliderPos = (0, $eWjiX.BB).clamp(p.init * (p.width - p.pointSize), 0, p.width - p.pointSize);\n            (0, $eWjiX.BB).css(this.sliderPoint, {\n                width: p.pointSize + \"px\",\n                height: p.pointSize + \"px\",\n                borderRadius: p.pointSize + \"px\"\n            });\n            redrawPoint();\n            var imaginaryPos;\n            this.pointerListener = new (0, $eWjiX.BB).PointerListener({\n                target: this.sliderPoint,\n                fixScribble: true,\n                onPointer: function(event) {\n                    if (event.type === \"pointerdown\" && event.button === \"left\") {\n                        isFirst = true;\n                        isDragging = true;\n                        imaginaryPos = sliderPos;\n                        redrawPoint();\n                        event.eventStopPropagation();\n                    } else if (event.type === \"pointermove\" && event.button === \"left\") {\n                        event.eventStopPropagation();\n                        imaginaryPos = imaginaryPos + event.dX;\n                        sliderPos = parseInt(\"\" + (0, $eWjiX.BB).clamp(imaginaryPos, 0, p.width - p.pointSize));\n                        redrawPoint();\n                        p.callback(getValue(), isFirst, false);\n                        isFirst = false;\n                    }\n                    if (event.type === \"pointerup\") {\n                        event.eventStopPropagation();\n                        isDragging = false;\n                        redrawPoint();\n                        p.callback(getValue(), false, true);\n                    }\n                }\n            });\n        }\n    }\n    (0, $7h4XF._)(PointSlider, [\n        {\n            // ---- interface ----\n            key: \"getEl\",\n            value: function getEl() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"setActive\",\n            value: function setActive(isActive) {\n                this.sliderPoint.style.backgroundColor = isActive ? \"#fff\" : \"#eaeaea\";\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.pointerListener.destroy();\n            }\n        }\n    ]);\n    return PointSlider;\n}();\n\n});\n\nparcelRequire.register(\"43qNf\", function(module, exports) {\n\n$parcel$export(module.exports, \"ColorOptions\", function () { return $4db8cbbb01889095$export$24ba9b81662d4366; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $cL71g = parcelRequire(\"cL71g\");\n\nvar $4EWN2 = parcelRequire(\"4EWN2\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1C8RU = parcelRequire(\"1C8RU\");\n\nvar $dJ1E2 = parcelRequire(\"dJ1E2\");\n\nvar $amum4 = parcelRequire(\"amum4\");\nvar $4db8cbbb01889095$export$24ba9b81662d4366 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function ColorOptions(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, ColorOptions);\n        this.colorArr = [];\n        this.selectedIndex = 0;\n        var _p_title;\n        this.rootEl = (0, $eWjiX.BB).el({\n            content: p.label ? p.label : \"\",\n            title: (_p_title = p.title) !== null && _p_title !== void 0 ? _p_title : undefined,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                gap: \"7px\"\n            }\n        });\n        this.buttonArr = [];\n        var buttonSize = 22;\n        var checkerUrl = (0, $eWjiX.BB).createCheckerDataUrl(5, undefined, (0, $1C8RU.theme).isDark());\n        this.onColorInputChange = function() {\n            var i = _this.selectedIndex;\n            var color = _this.colorArr[i];\n            if (!color || color.a < 1) // ignore\n            return;\n            var newRawColor = _this.colorInput.value;\n            _this.buttonArr[_this.selectedIndex].el.style.backgroundColor = newRawColor;\n            _this.colorArr[i] = (0, $4EWN2._)((0, $cL71g._)({}, (0, $dJ1E2.ColorConverter).hexToRGB(newRawColor)), {\n                a: 1\n            });\n            p.onChange(_this.colorArr[i]);\n        };\n        this.colorInput = (0, $eWjiX.BB).el({\n            tagName: \"input\",\n            custom: {\n                type: \"color\",\n                tabIndex: \"-1\"\n            }\n        });\n        this.colorInput.onchange = this.onColorInputChange;\n        this.colorInput.oninput = this.onColorInputChange;\n        // build colorArr while removing duplicates\n        for(var i = 0; i < p.colorArr.length; i++){\n            var item = p.colorArr[i];\n            var found = false;\n            for(var e = 0; e < this.colorArr.length; e++){\n                var sItem = this.colorArr[e];\n                if (sItem === item) {\n                    found = true;\n                    break;\n                }\n                if (sItem === null || item === null) continue;\n                if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\n                    found = true;\n                    break;\n                }\n            }\n            if (found) continue;\n            this.colorArr.push(item);\n            if (\"initialIndex\" in p && p.initialIndex === i) this.selectedIndex = this.colorArr.length - 1;\n        }\n        for(var i1 = 0; i1 < this.colorArr.length; i1++)(function(i) {\n            var color = _this.colorArr[i];\n            var colorButton = (0, $eWjiX.BB).el({\n                parent: _this.rootEl,\n                content: color ? \"\" : \"X\",\n                className: \"kl-color-option\",\n                css: {\n                    width: buttonSize + \"px\",\n                    height: buttonSize + \"px\",\n                    backgroundColor: color ? (0, $eWjiX.BB).ColorConverter.toRgbaStr(color) : \"transparent\",\n                    lineHeight: buttonSize + 1 + \"px\"\n                },\n                onClick: function(e) {\n                    if (_this.selectedIndex === i) {\n                        if (color && color.a === 1) _this.colorInput.showPicker ? _this.colorInput.showPicker() : _this.colorInput.click();\n                        return;\n                    }\n                    e.preventDefault();\n                    _this.selectedIndex = i;\n                    update();\n                    p.onChange(_this.colorArr[i]); // color may change\n                }\n            });\n            if (color && color.a === 0) colorButton.style.backgroundImage = \"url(\" + checkerUrl + \")\";\n            var setIsSelected = function(b) {\n                colorButton.classList.toggle(\"kl-color-option--active\", b);\n            };\n            _this.buttonArr.push({\n                el: colorButton,\n                setIsSelected: setIsSelected\n            });\n        })(i1);\n        this.rootEl.append((0, $amum4.c)(\",w-0,h-0,overflow-hidden\", [\n            this.colorInput\n        ]));\n        var update = function() {\n            for(var i = 0; i < _this.buttonArr.length; i++)_this.buttonArr[i].setIsSelected(i === _this.selectedIndex);\n        };\n        update();\n        this.updateCheckerboard = function() {\n            var checkerUrl = (0, $eWjiX.BB).createCheckerDataUrl(5, undefined, (0, $1C8RU.theme).isDark());\n            _this.buttonArr.forEach(function(button, i) {\n                var color = _this.colorArr[i];\n                if (color && color.a === 0) button.el.style.backgroundImage = \"url(\" + checkerUrl + \")\";\n            });\n        };\n        (0, $1C8RU.theme).addIsDarkListener(this.updateCheckerboard);\n    }\n    (0, $7h4XF._)(ColorOptions, [\n        {\n            // ---- interface ----\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"getValue\",\n            value: function getValue() {\n                return this.colorArr[this.selectedIndex];\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.buttonArr.forEach(function(item) {\n                    (0, $eWjiX.BB).destroyEl(item.el);\n                });\n                this.buttonArr.splice(0, this.buttonArr.length);\n                (0, $1C8RU.theme).removeIsDarkListener(this.updateCheckerboard);\n                this.colorInput.onchange = null;\n                this.colorInput.oninput = null;\n            }\n        }\n    ]);\n    return ColorOptions;\n}();\n\n});\nparcelRequire.register(\"amum4\", function(module, exports) {\n\n$parcel$export(module.exports, \"c\", function () { return $075b9fd415bad4ff$export$db3b6bfb95261072; });\n\nvar $bX4ja = parcelRequire(\"bX4ja\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nfunction $075b9fd415bad4ff$var$decomposeElString(el) {\n    if (el === \"\") return {};\n    var split;\n    var tagName;\n    var classes = [];\n    split = el.split(\".\");\n    if (split.length === 1) {\n        split = split[0].split(\",\");\n        tagName = split.shift();\n    } else {\n        tagName = split.shift();\n        split.forEach(function(item, index) {\n            var isLast = index === split.length - 1;\n            if (isLast) {\n                split = item.split(\",\");\n                var last = split.shift();\n                if (last !== undefined) classes.push(last);\n            } else classes.push(item);\n        });\n    }\n    var result = {};\n    if (tagName !== \"\") result.tagName = tagName;\n    if (classes.length > 0) result.classes = classes;\n    if (split.length > 0) result.styles = split;\n    return result;\n}\nfunction $075b9fd415bad4ff$var$applyStyleNames(el, styleNames) {\n    var style = {};\n    var operations = {\n        c: function(params) {\n            style.color = params[0];\n        },\n        bg: function(params) {\n            style.background = params[0];\n        },\n        p: function(params) {\n            style.padding = params[0] + \"px\";\n        },\n        py: function(params) {\n            style.paddingTop = params[0] + \"px\";\n            style.paddingBottom = params[0] + \"px\";\n        },\n        // flex\n        flex: function() {\n            style.display = \"flex\";\n        },\n        \"flexCol\": function() {\n            style.flexDirection = \"column\";\n        },\n        \"flexWrap\": function() {\n            style.flexWrap = \"wrap\";\n        },\n        gap: function(params) {\n            style.gap = params.map(function(item) {\n                return item + \"px\";\n            }).join(\" \");\n        },\n        grow: function() {\n            style.flexGrow = \"1\";\n        },\n        justify: function(params) {\n            style.justifyContent = params[0];\n        },\n        items: function(params) {\n            style.alignItems = params[0];\n        },\n        hidden: function() {\n            style.display = \"none\";\n        },\n        abs: function(params) {\n            style.position = \"absolute\";\n            style.left = params[0] + \"px\";\n            style.top = params[1] + \"px\";\n        },\n        w: function(params) {\n            style.width = params[0] + \"px\";\n        },\n        h: function(params) {\n            style.height = params[0] + \"px\";\n        },\n        minh: function(params) {\n            style.minHeight = params[0] + \"px\";\n        },\n        z: function(params) {\n            style.zIndex = params[0];\n        },\n        overflow: function(params) {\n            style.overflow = params[0];\n        }\n    };\n    styleNames.forEach(function(item) {\n        var params = item.split(\"-\");\n        var operation = params.shift();\n        operations[operation](params);\n    });\n    (0, $eWjiX.BB).css(el, style);\n}\nfunction $075b9fd415bad4ff$export$db3b6bfb95261072(el, inner) {\n    var _result_classList;\n    if (el === undefined) return document.createElement(\"div\");\n    if (typeof el !== \"string\") {\n        if (inner) {\n            var _el;\n            if (typeof inner === \"string\") el.innerHTML = inner;\n            else (_el = el).append.apply(_el, (0, $bX4ja._)(inner));\n        }\n        return el;\n    }\n    var decomp = $075b9fd415bad4ff$var$decomposeElString(el);\n    var _decomp_tagName;\n    var result = document.createElement((_decomp_tagName = decomp.tagName) !== null && _decomp_tagName !== void 0 ? _decomp_tagName : \"div\");\n    decomp.classes && (_result_classList = result.classList).add.apply(_result_classList, (0, $bX4ja._)(decomp.classes));\n    decomp.styles && $075b9fd415bad4ff$var$applyStyleNames(result, decomp.styles);\n    if (inner) {\n        var _result;\n        if (typeof inner === \"string\") result.innerHTML = inner;\n        else (_result = result).append.apply(_result, (0, $bX4ja._)(inner));\n    }\n    return result;\n}\n\n});\n\n\nparcelRequire.register(\"iFIyy\", function(module, exports) {\n\n$parcel$export(module.exports, \"Options\", function () { return $7960d0c50ff12b0d$export$c019608e5b5bb4cb; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $7960d0c50ff12b0d$export$c019608e5b5bb4cb = /*#__PURE__*/ function() {\n    \"use strict\";\n    function Options(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, Options);\n        this.rootEl = (0, $eWjiX.BB).el();\n        var wrapperEl = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            className: \"kl-option-wrapper\",\n            css: {\n                display: \"flex\"\n            }\n        });\n        if (p.onChange) this.onChange = p.onChange;\n        this.optionArr = [];\n        this.selectedId = \"initialId\" in p && p.initId !== undefined ? p.initId : p.optionArr[0].id;\n        var createOption = function(o) {\n            var classArr = [\n                \"kl-option\"\n            ];\n            if (p.isSmall) classArr.push(\"kl-option--small\");\n            if (typeof o.label !== \"string\") {\n                classArr.push(\"kl-option--custom-el\");\n                (0, $eWjiX.BB).css(o.label, {\n                    display: \"block\",\n                    pointerEvents: \"none\"\n                });\n            }\n            var optionObj = {\n                id: o.id,\n                el: (0, $eWjiX.BB).el({\n                    parent: wrapperEl,\n                    content: o.label,\n                    className: classArr.join(\" \"),\n                    onClick: function() {\n                        if (_this.selectedId !== optionObj.id) {\n                            _this.selectedId = optionObj.id;\n                            _this.update();\n                            _this.onChange && _this.onChange(_this.selectedId);\n                        }\n                    }\n                })\n            };\n            if (o.title) optionObj.el.title = o.title;\n            _this.optionArr.push(optionObj);\n        };\n        for(var i = 0; i < p.optionArr.length; i++)createOption(p.optionArr[i]);\n        this.update();\n        if (p.changeOnInit) setTimeout(function() {\n            _this.onChange && _this.onChange(_this.selectedId);\n        }, 0);\n    }\n    (0, $7h4XF._)(Options, [\n        {\n            key: \"getIndex\",\n            value: function getIndex() {\n                for(var i = 0; i < this.optionArr.length; i++){\n                    if (this.optionArr[i].id === this.selectedId) return i;\n                }\n                return -1;\n            }\n        },\n        {\n            key: \"update\",\n            value: function update() {\n                for(var i = 0; i < this.optionArr.length; i++)this.optionArr[i].el.classList.toggle(\"kl-option-selected\", this.optionArr[i].id === this.selectedId);\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"getValue\",\n            value: function getValue() {\n                return this.selectedId;\n            }\n        },\n        {\n            key: \"next\",\n            value: function next() {\n                this.selectedId = this.optionArr[(this.getIndex() + 1) % this.optionArr.length].id;\n                this.update();\n                this.onChange && this.onChange(this.selectedId);\n            }\n        },\n        {\n            key: \"previous\",\n            value: function previous() {\n                this.selectedId = this.optionArr[(this.optionArr.length + this.getIndex() - 1) % this.optionArr.length].id;\n                this.update();\n                this.onChange && this.onChange(this.selectedId);\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.optionArr.forEach(function(item) {\n                    (0, $eWjiX.BB).destroyEl(item.el);\n                });\n                this.optionArr.splice(0, this.optionArr.length);\n            }\n        }\n    ]);\n    return Options;\n}();\n\n});\n\nparcelRequire.register(\"bmB93\", function(module, exports) {\n\n$parcel$export(module.exports, \"StatusOverlay\", function () { return $c1a93a3cd82636c9$export$5ee0af1d5c87e856; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $gGQwz = parcelRequire(\"gGQwz\");\nvar $c1a93a3cd82636c9$export$5ee0af1d5c87e856 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function StatusOverlay() {\n        (0, $cx0mh._)(this, StatusOverlay);\n        this.isWide = false // tool space hidden\n        ;\n        this.uiState = \"right\";\n        this.el = (0, $eWjiX.BB).el({\n            className: \"top-overlay g-root\",\n            onClick: (0, $eWjiX.BB).handleClick\n        });\n        this.updateUiState();\n        this.innerEl = (0, $eWjiX.BB).el({\n            className: \"top-overlay--inner\"\n        });\n        this.angleIm = new Image();\n        this.angleIm.src = (0, (/*@__PURE__*/$parcel$interopDefault($gGQwz)));\n        (0, $eWjiX.BB).css(this.angleIm, {\n            verticalAlign: \"bottom\",\n            width: \"20px\",\n            height: \"20px\",\n            marginLeft: \"5px\",\n            borderRadius: \"10px\"\n        });\n        this.innerInnerEl = document.createElement(\"div\");\n        this.innerInnerEl.style.display = \"inline-block\";\n        this.innerEl.append(this.innerInnerEl, this.angleIm);\n        this.el.append(this.innerEl);\n        document.body.append(this.el);\n        this.el.style.display = \"none\";\n    }\n    (0, $7h4XF._)(StatusOverlay, [\n        {\n            key: \"updateUiState\",\n            value: function updateUiState() {\n                if (this.uiState === \"left\") this.el.style.left = \"271px\";\n                else this.el.style.removeProperty(\"left\");\n            }\n        },\n        {\n            key: \"setWide\",\n            value: function setWide(b) {\n                this.isWide = b;\n                if (!this.el) return;\n                if (this.isWide) {\n                    this.el.style.width = \"100%\";\n                    this.el.style.left = \"\";\n                } else {\n                    this.el.style.removeProperty(\"width\");\n                    this.el.style.left = this.uiState === \"left\" ? \"271px\" : \"\";\n                }\n            }\n        },\n        {\n            key: \"setUiState\",\n            value: function setUiState(state) {\n                this.uiState = state;\n                this.updateUiState();\n            }\n        },\n        {\n            key: \"out\",\n            value: function out(msg, doPulse) {\n                var _this = this;\n                if (typeof msg === \"string\") {\n                    this.angleIm.style.display = \"none\";\n                    this.innerInnerEl.innerHTML = msg;\n                } else if (msg.type === \"transform\") {\n                    this.angleIm.style.display = \"inline-block\";\n                    this.angleIm.style.transform = \"rotate(\" + msg.angleDeg + \"deg)\";\n                    if (msg.angleDeg % 90 === 0) this.angleIm.style.boxShadow = \"inset 0 0 0 1px rgba(255, 255, 255, 0.7)\";\n                    else this.angleIm.style.boxShadow = \"\";\n                    this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + \"%\";\n                } else this.angleIm.style.display = \"none\";\n                if (doPulse) {\n                    this.innerEl.style.animation = \"\";\n                    setTimeout(function() {\n                        return _this.innerEl.style.animation = \"topOverlayPulse 0.5s ease-out\";\n                    }, 20);\n                    clearTimeout(this.timeout3);\n                    this.timeout3 = setTimeout(function() {\n                        return _this.innerEl.style.animation = \"\";\n                    }, 520);\n                }\n                clearTimeout(this.timeout);\n                clearTimeout(this.timeout2);\n                this.el.style.animationName = doPulse ? \"consoleInFast\" : \"consoleIn\";\n                this.el.style.opacity = \"1\";\n                this.timeout = setTimeout(function() {\n                    _this.el.style.opacity = \"0\";\n                    _this.el.style.animationName = \"consoleOut\";\n                    _this.timeout2 = setTimeout(function() {\n                        _this.el.style.display = \"none\";\n                    }, 450);\n                }, 1200);\n                this.el.style.display = \"flex\";\n            }\n        }\n    ]);\n    return StatusOverlay;\n}();\n\n});\nparcelRequire.register(\"gGQwz\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"iqIgb\");\n\n});\n\n\nparcelRequire.register(\"hRdOL\", function(module, exports) {\n\n$parcel$export(module.exports, \"CropCopy\", function () { return $01fcd0ed15aa4018$export$40175a5948a88a57; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1C8RU = parcelRequire(\"1C8RU\");\nvar $01fcd0ed15aa4018$export$40175a5948a88a57 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function CropCopy(param) {\n        var _this = this;\n        (0, $cx0mh._)(this, CropCopy);\n        this.crop = {\n            x: 0,\n            y: 0,\n            width: 0,\n            height: 0\n        };\n        this.rootEl = (0, $eWjiX.BB).el({\n            className: \"kl-edit-crop-preview\",\n            css: {\n                position: \"relative\",\n                height: param.height + \"px\",\n                width: param.width + \"px\",\n                overflow: \"hidden\"\n            }\n        });\n        if (param.onChange) this.onChange = param.onChange;\n        this.canvas = param.canvas;\n        this.resetCrop();\n        var isInsideSelectionRect = function(p) {\n            var rect = {\n                x: Math.round(_this.thumbX + _this.crop.x * _this.scaleW),\n                y: Math.round(_this.thumbY + _this.crop.y * _this.scaleH),\n                width: Math.round(_this.crop.width * _this.scaleW),\n                height: Math.round(_this.crop.height * _this.scaleH)\n            };\n            return (0, $eWjiX.BB).isInsideRect(p, rect);\n        };\n        this.croppedCanvas = (0, $eWjiX.BB).canvas();\n        this.eventTarget = this.croppedCanvas;\n        if (!param.isNotCopy) {\n            this.croppedImage = new Image();\n            this.eventTarget = this.croppedImage;\n        }\n        (0, $eWjiX.BB).css(this.eventTarget, {\n            height: param.height + \"px\",\n            width: param.width + \"px\"\n        });\n        this.rootEl.append(this.eventTarget);\n        this.updateCroppedCanvas();\n        var padding = 20;\n        var previewWrapper = (0, $eWjiX.BB).el({\n            css: {\n                width: param.width + \"px\",\n                height: param.height + \"px\",\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\",\n                pointerEvents: \"none\"\n            }\n        });\n        this.rootEl.append(previewWrapper);\n        (0, $eWjiX.BB).createCheckerDataUrl(4, function(v) {\n            previewWrapper.style.backgroundImage = \"url(\" + v + \")\";\n        }, (0, $1C8RU.theme).isDark());\n        var thumbSize = (0, $eWjiX.BB).fitInto(this.canvas.width, this.canvas.height, param.width - padding * 2, param.height - padding * 2, 1);\n        var thumbCanvas = (0, $eWjiX.BB).canvas(Math.round(thumbSize.width), Math.round(thumbSize.height));\n        thumbCanvas.style.imageRendering = \"pixelated\";\n        this.scaleW = thumbCanvas.width / this.canvas.width;\n        this.scaleH = thumbCanvas.height / this.canvas.height;\n        var thumbCtx = (0, $eWjiX.BB).ctx(thumbCanvas);\n        thumbCtx.imageSmoothingEnabled = false;\n        thumbCtx.drawImage(this.canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);\n        previewWrapper.append(thumbCanvas);\n        this.thumbX = parseInt(\"\" + (param.width - thumbCanvas.width) / 2);\n        this.thumbY = parseInt(\"\" + (param.height - thumbCanvas.height) / 2);\n        (0, $eWjiX.BB).css(thumbCanvas, {\n            position: \"absolute\",\n            left: this.thumbX + \"px\",\n            top: this.thumbY + \"px\"\n        });\n        this.selectionRect = (0, $eWjiX.BB).el({\n            parent: previewWrapper,\n            className: \"kl-edit-crop-preview__sel\"\n        });\n        this.updateSelectionRect();\n        var toOriginalSpace = function(p) {\n            return {\n                x: (0, $eWjiX.BB).clamp((p.x - _this.thumbX) / _this.scaleW, 0, _this.canvas.width),\n                y: (0, $eWjiX.BB).clamp((p.y - _this.thumbY) / _this.scaleH, 0, _this.canvas.height)\n            };\n        };\n        //gen crop from thumb-space points\n        var genCrop = function(p1, p2) {\n            var topLeftP = {\n                x: Math.min(p1.x, p2.x),\n                y: Math.min(p1.y, p2.y)\n            };\n            var bottomRightP = {\n                x: Math.max(p1.x, p2.x),\n                y: Math.max(p1.y, p2.y)\n            };\n            var origTopLeftP = toOriginalSpace(topLeftP);\n            var origBottomRightP = toOriginalSpace(bottomRightP);\n            origTopLeftP.x = Math.floor(origTopLeftP.x);\n            origTopLeftP.y = Math.floor(origTopLeftP.y);\n            origBottomRightP.x = Math.ceil(origBottomRightP.x);\n            origBottomRightP.y = Math.ceil(origBottomRightP.y);\n            return {\n                x: origTopLeftP.x,\n                y: origTopLeftP.y,\n                width: origBottomRightP.x - origTopLeftP.x,\n                height: origBottomRightP.y - origTopLeftP.y\n            };\n        };\n        var startP;\n        var startCrop = null;\n        var isDragging = false;\n        var didMove = false;\n        var updateCropTimeout;\n        this.pointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.eventTarget,\n            fixScribble: true,\n            onPointer: function(event) {\n                if (event.type === \"pointerdown\" && event.button === \"left\") {\n                    event.eventPreventDefault();\n                    isDragging = true;\n                    startP = {\n                        x: event.relX,\n                        y: event.relY\n                    };\n                    if (!_this.isReset() && isInsideSelectionRect(startP)) startCrop = {\n                        x: _this.crop.x,\n                        y: _this.crop.y,\n                        width: _this.crop.width,\n                        height: _this.crop.height\n                    };\n                    else _this.crop = genCrop(startP, startP);\n                } else if (event.type === \"pointermove\" && event.button === \"left\") {\n                    event.eventPreventDefault();\n                    didMove = true;\n                    if (startCrop) {\n                        _this.crop.x = startCrop.x + Math.round((event.relX - startP.x) / _this.scaleW);\n                        _this.crop.y = startCrop.y + Math.round((event.relY - startP.y) / _this.scaleH);\n                        _this.crop.x = (0, $eWjiX.BB).clamp(_this.crop.x, 0, _this.canvas.width - _this.crop.width);\n                        _this.crop.y = (0, $eWjiX.BB).clamp(_this.crop.y, 0, _this.canvas.height - _this.crop.height);\n                    } else _this.crop = genCrop(startP, {\n                        x: event.relX,\n                        y: event.relY\n                    });\n                    _this.updateSelectionRect();\n                } else if (event.type === \"pointerup\" && startP) {\n                    event.eventPreventDefault();\n                    isDragging = false;\n                    startCrop = null;\n                    startP = null;\n                    if (_this.crop.width === 0 || _this.crop.height === 0 || !didMove) {\n                        _this.resetCrop();\n                        _this.updateSelectionRect();\n                    }\n                    didMove = false;\n                    updateCropTimeout = setTimeout(function() {\n                        return _this.updateCroppedCanvas();\n                    }, 1);\n                }\n            }\n        });\n        this.keyListener = new (0, $eWjiX.BB).KeyListener({\n            onDown: function(keyStr, e, comboStr) {\n                if (isDragging) return;\n                var doUpdate = false;\n                var stepSize = Math.max(1, 1 / _this.scaleW);\n                var shiftIsPressed = _this.keyListener.isPressed(\"shift\");\n                if (keyStr === \"left\") {\n                    if (shiftIsPressed) _this.crop.width = (0, $eWjiX.BB).clamp(_this.crop.width - stepSize, 1, _this.canvas.width - _this.crop.x);\n                    else _this.crop.x = (0, $eWjiX.BB).clamp(_this.crop.x - stepSize, 0, _this.canvas.width - _this.crop.width);\n                    doUpdate = true;\n                }\n                if (keyStr === \"right\") {\n                    if (shiftIsPressed) _this.crop.width = (0, $eWjiX.BB).clamp(_this.crop.width + stepSize, 1, _this.canvas.width - _this.crop.x);\n                    else _this.crop.x = (0, $eWjiX.BB).clamp(_this.crop.x + stepSize, 0, _this.canvas.width - _this.crop.width);\n                    doUpdate = true;\n                }\n                if (keyStr === \"up\") {\n                    if (shiftIsPressed) _this.crop.height = (0, $eWjiX.BB).clamp(_this.crop.height - stepSize, 1, _this.canvas.height - _this.crop.y);\n                    else _this.crop.y = (0, $eWjiX.BB).clamp(_this.crop.y - stepSize, 0, _this.canvas.height - _this.crop.height);\n                    doUpdate = true;\n                }\n                if (keyStr === \"down\") {\n                    if (shiftIsPressed) _this.crop.height = (0, $eWjiX.BB).clamp(_this.crop.height + stepSize, 1, _this.canvas.height - _this.crop.y);\n                    else _this.crop.y = (0, $eWjiX.BB).clamp(_this.crop.y + stepSize, 0, _this.canvas.height - _this.crop.height);\n                    doUpdate = true;\n                }\n                if (doUpdate) {\n                    e.preventDefault();\n                    _this.updateSelectionRect();\n                    clearTimeout(updateCropTimeout);\n                    updateCropTimeout = setTimeout(function() {\n                        return _this.updateCroppedCanvas();\n                    }, 100);\n                }\n            }\n        });\n    }\n    (0, $7h4XF._)(CropCopy, [\n        {\n            key: \"resetCrop\",\n            value: function resetCrop() {\n                this.crop = {\n                    x: 0,\n                    y: 0,\n                    width: this.canvas.width,\n                    height: this.canvas.height\n                };\n            }\n        },\n        {\n            key: \"updateCroppedCanvas\",\n            value: function updateCroppedCanvas() {\n                this.croppedCanvas.width = Math.round(this.crop.width);\n                this.croppedCanvas.height = Math.round(this.crop.height);\n                var ctx = (0, $eWjiX.BB).ctx(this.croppedCanvas);\n                ctx.drawImage(this.canvas, Math.round(-this.crop.x), Math.round(-this.crop.y));\n                if (this.croppedImage) this.croppedImage.src = this.croppedCanvas.toDataURL(\"image/png\");\n                this.onChange && this.onChange(this.croppedCanvas.width, this.croppedCanvas.height);\n            }\n        },\n        {\n            key: \"updateSelectionRect\",\n            value: function updateSelectionRect() {\n                (0, $eWjiX.BB).css(this.selectionRect, {\n                    left: this.thumbX + this.crop.x * this.scaleW + \"px\",\n                    top: this.thumbY + this.crop.y * this.scaleH + \"px\",\n                    width: this.crop.width * this.scaleW + \"px\",\n                    height: this.crop.height * this.scaleH + \"px\"\n                });\n                this.onChange && this.onChange(Math.round(this.crop.width), Math.round(this.crop.height));\n            }\n        },\n        {\n            // ---- interface ----\n            key: \"getEl\",\n            value: function getEl() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"reset\",\n            value: function reset() {\n                this.resetCrop();\n                this.updateCroppedCanvas();\n                this.updateSelectionRect();\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.eventTarget.style.removeProperty(\"width\");\n                this.eventTarget.style.removeProperty(\"height\");\n                this.keyListener.destroy();\n                this.pointerListener.destroy();\n            }\n        },\n        {\n            key: \"isReset\",\n            value: function isReset() {\n                return this.crop.x === 0 && this.crop.y === 0 && this.crop.width === this.canvas.width && this.crop.height === this.canvas.height;\n            }\n        },\n        {\n            key: \"getRect\",\n            value: function getRect() {\n                return (0, $eWjiX.BB).copyObj(this.crop);\n            }\n        },\n        {\n            key: \"getCroppedImage\",\n            value: function getCroppedImage() {\n                return this.croppedCanvas;\n            }\n        }\n    ]);\n    return CropCopy;\n}();\n\n});\n\nparcelRequire.register(\"isYih\", function(module, exports) {\n\n$parcel$export(module.exports, \"clipboardDialog\", function () { return $ffd40240385bb9f9$export$32b89bc9bb92706a; });\n\nvar $1LaJZ = parcelRequire(\"1LaJZ\");\n\nvar $exh8t = parcelRequire(\"exh8t\");\n\nvar $2gUX3 = parcelRequire(\"2gUX3\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $2MaaK = parcelRequire(\"2MaaK\");\n\nvar $hRdOL = parcelRequire(\"hRdOL\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nfunction $ffd40240385bb9f9$export$32b89bc9bb92706a(parent, fullCanvas, cropCallback, output, showCrop) {\n    var toClipboard = function toClipboard() {\n        var imgURL = cropCopy.getCroppedImage().toDataURL(\"image/png\");\n        setTimeout(/*#__PURE__*/ (0, $1LaJZ._)(function() {\n            var data, blob, err;\n            return (0, $2gUX3.__generator)(this, function(_state) {\n                switch(_state.label){\n                    case 0:\n                        _state.trys.push([\n                            0,\n                            4,\n                            ,\n                            5\n                        ]);\n                        return [\n                            4,\n                            fetch(imgURL)\n                        ];\n                    case 1:\n                        data = _state.sent();\n                        return [\n                            4,\n                            data.blob()\n                        ];\n                    case 2:\n                        blob = _state.sent();\n                        return [\n                            4,\n                            navigator.clipboard.write([\n                                new ClipboardItem((0, $exh8t._)({}, blob.type, blob))\n                            ])\n                        ];\n                    case 3:\n                        _state.sent();\n                        setTimeout(function() {\n                            output.out((0, $1mH1z.LANG)(\"cropcopy-copied\"), true);\n                        }, 200);\n                        return [\n                            3,\n                            5\n                        ];\n                    case 4:\n                        err = _state.sent();\n                        console.error(err.name, err.message);\n                        return [\n                            3,\n                            5\n                        ];\n                    case 5:\n                        return [\n                            2\n                        ];\n                }\n            });\n        }), 0);\n    };\n    var blur = function blur() {\n        closeFunc && closeFunc();\n    };\n    var clipboardItemIsSupported = false;\n    try {\n        clipboardItemIsSupported = !!ClipboardItem;\n    } catch (e) {}\n    var div = document.createElement(\"div\");\n    var isSmall = window.innerWidth < 550 || window.innerHeight < 550;\n    var topWrapper = (0, $eWjiX.BB).el({\n        content: (0, $1mH1z.LANG)(\"crop-drag-to-crop\") + (clipboardItemIsSupported ? \"\" : \"<br>\" + (0, $1mH1z.LANG)(\"cropcopy-click-hold\")),\n        css: {\n            textAlign: \"center\"\n        }\n    });\n    div.append(topWrapper);\n    var cropCopy = new (0, $hRdOL.CropCopy)({\n        width: isSmall ? 340 : 540,\n        height: isSmall ? 300 : 350,\n        canvas: fullCanvas,\n        isNotCopy: false\n    });\n    (0, $eWjiX.BB).css(cropCopy.getEl(), {\n        marginTop: \"10px\",\n        marginLeft: \"-20px\"\n    });\n    div.append(cropCopy.getEl());\n    var keyListener = new (0, $eWjiX.BB).KeyListener({\n        onDown: function onDown(keyStr, KeyEvent, comboStr) {\n            if (comboStr === \"ctrl+c\") {\n                toClipboard();\n                closeFunc && closeFunc();\n            }\n        }\n    });\n    var closeFunc;\n    window.addEventListener(\"blur\", blur);\n    var buttonArr = [];\n    if (clipboardItemIsSupported) buttonArr.push((0, $1mH1z.LANG)(\"cropcopy-btn-copy\"));\n    if (showCrop) buttonArr.push((0, $1mH1z.LANG)(\"cropcopy-btn-crop\"));\n    buttonArr.push(\"Cancel\");\n    (0, $2MaaK.showModal)({\n        target: parent,\n        message: \"<b>\" + (showCrop ? \"\".concat((0, $1mH1z.LANG)(\"cropcopy-title-copy\"), \" / \").concat((0, $1mH1z.LANG)(\"cropcopy-title-crop\")) : \"\".concat((0, $1mH1z.LANG)(\"cropcopy-title-copy\"))) + \"</b>\",\n        div: div,\n        style: isSmall ? {} : {\n            width: \"540px\"\n        },\n        buttons: buttonArr,\n        primaries: [\n            (0, $1mH1z.LANG)(\"cropcopy-btn-copy\")\n        ],\n        callback: function callback(result) {\n            if (result === (0, $1mH1z.LANG)(\"cropcopy-btn-copy\")) toClipboard();\n            else if (result === (0, $1mH1z.LANG)(\"cropcopy-btn-crop\")) {\n                var rectObj = cropCopy.getRect();\n                cropCallback({\n                    left: Math.round(-rectObj.x),\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\n                    top: Math.round(-rectObj.y),\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height)\n                });\n            }\n            window.removeEventListener(\"blur\", blur);\n            cropCopy.destroy();\n            keyListener.destroy();\n        },\n        clickOnEnter: (0, $1mH1z.LANG)(\"cropcopy-btn-copy\"),\n        closeFunc: function closeFunc1(func) {\n            closeFunc = func;\n        }\n    });\n}\n\n});\n\nparcelRequire.register(\"jMW1P\", function(module, exports) {\n\n$parcel$export(module.exports, \"LayerManager\", function () { return $82406ffdc1235dbb$export$eff87c52915dd7fe; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $eEL9N = parcelRequire(\"eEL9N\");\n\nvar $j5jvd = parcelRequire(\"j5jvd\");\n\nvar $705qg = parcelRequire(\"705qg\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $bBcC4 = parcelRequire(\"bBcC4\");\n\nvar $jneUH = parcelRequire(\"jneUH\");\n\nvar $6NMo1 = parcelRequire(\"6NMo1\");\n\nvar $hWVsV = parcelRequire(\"hWVsV\");\n\nvar $5Ycub = parcelRequire(\"5Ycub\");\n\nvar $jKBKm = parcelRequire(\"jKBKm\");\n\nvar $auzYC = parcelRequire(\"auzYC\");\n\nvar $1Qqvs = parcelRequire(\"1Qqvs\");\n\nvar $1C8RU = parcelRequire(\"1C8RU\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\n\nvar $6J2My = parcelRequire(\"6J2My\");\nvar $82406ffdc1235dbb$var$paddingLeft = 25;\nvar $82406ffdc1235dbb$export$eff87c52915dd7fe = /*#__PURE__*/ function() {\n    \"use strict\";\n    function LayerManager(klCanvas, onSelect, parentEl, uiState) {\n        var _this = this;\n        (0, $cx0mh._)(this, LayerManager);\n        this.lastpos = 0;\n        this.layerHeight = 35;\n        this.layerSpacing = 0;\n        this.parentEl = parentEl;\n        this.klCanvas = klCanvas;\n        this.layerElArr = [];\n        this.layerHeight = 35;\n        this.layerSpacing = 0;\n        var width = 270;\n        this.onSelect = onSelect;\n        this.uiState = uiState;\n        this.largeThumbDiv = (0, $eWjiX.BB).el({\n            onClick: (0, $eWjiX.BB).handleClick,\n            css: {\n                position: \"absolute\",\n                top: \"500px\",\n                background: \"#aaa\",\n                boxShadow: \"1px 1px 3px rgba(0,0,0,0.3)\",\n                pointerEvents: \"none\",\n                padding: \"0\",\n                border: \"1px solid #aaa\",\n                transition: \"opacity 0.3s ease-out\",\n                userSelect: \"none\"\n            }\n        });\n        this.setUiState(uiState);\n        (0, $eWjiX.BB).createCheckerDataUrl(4, function(url) {\n            _this.largeThumbDiv.style.backgroundImage = \"url(\" + url + \")\";\n        }, (0, $1C8RU.theme).isDark());\n        this.largeThumbCanvas = (0, $eWjiX.BB).canvas(200, 200);\n        this.largeThumbCanvas.style.display = \"block\";\n        this.largeThumbDiv.append(this.largeThumbCanvas);\n        this.largeThumbInDocument = false;\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        this.selectedSpotIndex = this.klCanvasLayerArr.length - 1;\n        this.rootEl = (0, $eWjiX.BB).el({\n            css: {\n                marginRight: \"10px\",\n                marginBottom: \"10px\",\n                marginLeft: \"10px\",\n                marginTop: \"10px\",\n                cursor: \"default\"\n            }\n        });\n        var listDiv = (0, $eWjiX.BB).el({\n            css: {\n                width: width + \"px\",\n                position: \"relative\",\n                margin: \"0 -10px\",\n                zIndex: \"0\"\n            }\n        });\n        this.layerListEl = (0, $eWjiX.BB).el({\n            parent: listDiv\n        });\n        this.addBtn = (0, $eWjiX.BB).el({\n            tagName: \"button\"\n        });\n        this.duplicateBtn = (0, $eWjiX.BB).el({\n            tagName: \"button\"\n        });\n        this.mergeBtn = (0, $eWjiX.BB).el({\n            tagName: \"button\"\n        });\n        this.removeBtn = (0, $eWjiX.BB).el({\n            tagName: \"button\"\n        });\n        var renameBtn = (0, $eWjiX.BB).el({\n            tagName: \"button\"\n        });\n        var createButtons = function() {\n            var div = (0, $eWjiX.BB).el();\n            var async = function() {\n                (0, $eWjiX.BB).makeUnfocusable(_this.addBtn);\n                (0, $eWjiX.BB).makeUnfocusable(_this.duplicateBtn);\n                (0, $eWjiX.BB).makeUnfocusable(_this.mergeBtn);\n                (0, $eWjiX.BB).makeUnfocusable(_this.removeBtn);\n                (0, $eWjiX.BB).makeUnfocusable(renameBtn);\n                _this.addBtn.style.cssFloat = \"left\";\n                _this.duplicateBtn.style.cssFloat = \"left\";\n                _this.mergeBtn.style.cssFloat = \"left\";\n                _this.removeBtn.style.cssFloat = \"left\";\n                renameBtn.style.cssFloat = \"left\";\n                _this.addBtn.title = (0, $1mH1z.LANG)(\"layers-new\");\n                _this.duplicateBtn.title = (0, $1mH1z.LANG)(\"layers-duplicate\");\n                _this.removeBtn.title = (0, $1mH1z.LANG)(\"layers-remove\");\n                _this.mergeBtn.title = (0, $1mH1z.LANG)(\"layers-merge\");\n                renameBtn.title = (0, $1mH1z.LANG)(\"layers-rename-title\");\n                _this.addBtn.style.paddingLeft = \"5px\";\n                _this.addBtn.style.paddingRight = \"3px\";\n                _this.removeBtn.style.paddingLeft = \"5px\";\n                _this.removeBtn.style.paddingRight = \"3px\";\n                _this.duplicateBtn.style.paddingLeft = \"5px\";\n                _this.duplicateBtn.style.paddingRight = \"3px\";\n                _this.mergeBtn.style.paddingLeft = \"5px\";\n                _this.mergeBtn.style.paddingRight = \"3px\";\n                renameBtn.style.height = \"30px\";\n                renameBtn.style.lineHeight = \"20px\";\n                _this.addBtn.innerHTML = \"<img src='\" + (0, (/*@__PURE__*/$parcel$interopDefault($hWVsV))) + \"' height='20'/>\";\n                _this.duplicateBtn.innerHTML = \"<img src='\" + (0, (/*@__PURE__*/$parcel$interopDefault($5Ycub))) + \"' height='20'/>\";\n                _this.mergeBtn.innerHTML = \"<img src='\" + (0, (/*@__PURE__*/$parcel$interopDefault($jKBKm))) + \"' height='20'/>\";\n                _this.removeBtn.innerHTML = \"<img src='\" + (0, (/*@__PURE__*/$parcel$interopDefault($auzYC))) + \"' height='20'/>\";\n                renameBtn.innerHTML = \"<img src='\" + (0, (/*@__PURE__*/$parcel$interopDefault($1Qqvs))) + \"' height='20'/>\";\n                _this.addBtn.style.marginRight = \"5px\";\n                _this.removeBtn.style.marginRight = \"5px\";\n                _this.duplicateBtn.style.marginRight = \"5px\";\n                _this.mergeBtn.style.marginRight = \"5px\";\n                div.append(_this.addBtn, _this.removeBtn, _this.duplicateBtn, _this.mergeBtn, renameBtn, (0, $eWjiX.BB).el({\n                    css: {\n                        clear: \"both\",\n                        height: \"10px\"\n                    }\n                }));\n                _this.addBtn.onclick = function() {\n                    if (_this.klCanvas.addLayer(_this.selectedSpotIndex) === false) return;\n                    _this.klCanvasLayerArr = _this.klCanvas.getLayers();\n                    if (_this.klCanvasLayerArr.length === (0, $705qg.MAX_LAYERS)) {\n                        _this.addBtn.disabled = true;\n                        _this.duplicateBtn.disabled = true;\n                    }\n                    _this.removeBtn.disabled = false;\n                    _this.selectedSpotIndex = _this.selectedSpotIndex + 1;\n                    _this.createLayerList();\n                    (0, $gWfkn.klHistory).pause(true);\n                    _this.onSelect(_this.selectedSpotIndex);\n                    (0, $gWfkn.klHistory).pause(false);\n                };\n                _this.duplicateBtn.onclick = function() {\n                    if (_this.klCanvas.duplicateLayer(_this.selectedSpotIndex) === false) return;\n                    _this.klCanvasLayerArr = _this.klCanvas.getLayers();\n                    if (_this.klCanvasLayerArr.length === (0, $705qg.MAX_LAYERS)) {\n                        _this.addBtn.disabled = true;\n                        _this.duplicateBtn.disabled = true;\n                    }\n                    _this.removeBtn.disabled = false;\n                    _this.selectedSpotIndex++;\n                    _this.createLayerList();\n                    (0, $gWfkn.klHistory).pause(true);\n                    _this.onSelect(_this.selectedSpotIndex);\n                    (0, $gWfkn.klHistory).pause(false);\n                };\n                _this.removeBtn.onclick = function() {\n                    if (_this.layerElArr.length <= 1) return;\n                    _this.klCanvas.removeLayer(_this.selectedSpotIndex);\n                    if (_this.selectedSpotIndex > 0) _this.selectedSpotIndex--;\n                    _this.klCanvasLayerArr = _this.klCanvas.getLayers();\n                    _this.createLayerList();\n                    (0, $gWfkn.klHistory).pause(true);\n                    _this.onSelect(_this.selectedSpotIndex);\n                    (0, $gWfkn.klHistory).pause(false);\n                    if (_this.klCanvasLayerArr.length === 1) _this.removeBtn.disabled = true;\n                    if (_this.klCanvasLayerArr.length < (0, $705qg.MAX_LAYERS)) {\n                        _this.addBtn.disabled = false;\n                        _this.duplicateBtn.disabled = false;\n                    }\n                };\n                _this.mergeBtn.onclick = function() {\n                    if (_this.selectedSpotIndex <= 0) return;\n                    (0, $6NMo1.mergeLayerDialog)(_this.parentEl, {\n                        topCanvas: _this.klCanvasLayerArr[_this.selectedSpotIndex].context.canvas,\n                        bottomCanvas: _this.klCanvasLayerArr[_this.selectedSpotIndex - 1].context.canvas,\n                        topOpacity: _this.klCanvas.getLayer(_this.selectedSpotIndex).opacity,\n                        mixModeStr: _this.klCanvasLayerArr[_this.selectedSpotIndex].mixModeStr,\n                        callback: function(mode) {\n                            _this.klCanvas.mergeLayers(_this.selectedSpotIndex, _this.selectedSpotIndex - 1, mode);\n                            _this.klCanvasLayerArr = _this.klCanvas.getLayers();\n                            _this.selectedSpotIndex--;\n                            if (_this.klCanvasLayerArr.length === 1) _this.removeBtn.disabled = true;\n                            if (_this.klCanvasLayerArr.length < (0, $705qg.MAX_LAYERS)) {\n                                _this.addBtn.disabled = false;\n                                _this.duplicateBtn.disabled = false;\n                            }\n                            _this.createLayerList();\n                            (0, $gWfkn.klHistory).pause(true);\n                            _this.onSelect(_this.selectedSpotIndex);\n                            (0, $gWfkn.klHistory).pause(false);\n                        }\n                    });\n                };\n                renameBtn.onclick = function() {\n                    _this.renameLayer(_this.selectedSpotIndex);\n                };\n            };\n            setTimeout(async, 1);\n            return div;\n        };\n        this.rootEl.append(createButtons());\n        var modeWrapper;\n        modeWrapper = (0, $eWjiX.BB).el({\n            content: (0, $1mH1z.LANG)(\"layers-blending\") + \"&nbsp;\",\n            css: {\n                fontSize: \"15px\"\n            }\n        });\n        this.modeSelect = new (0, $eEL9N.Select)({\n            optionArr: [\n                \"source-over\",\n                undefined,\n                \"darken\",\n                \"multiply\",\n                \"color-burn\",\n                undefined,\n                \"lighten\",\n                \"screen\",\n                \"color-dodge\",\n                undefined,\n                \"overlay\",\n                \"soft-light\",\n                \"hard-light\",\n                undefined,\n                \"difference\",\n                \"exclusion\",\n                undefined,\n                \"hue\",\n                \"saturation\",\n                \"color\",\n                \"luminosity\"\n            ].map(function(item) {\n                return item ? [\n                    item,\n                    (0, $bBcC4.translateBlending)(item)\n                ] : undefined;\n            }),\n            onChange: function(val) {\n                _this.klCanvas.setMixMode(_this.selectedSpotIndex, val);\n                _this.update(_this.selectedSpotIndex);\n            },\n            css: {\n                marginBottom: \"10px\"\n            }\n        });\n        modeWrapper.append(this.modeSelect.getElement());\n        this.rootEl.append(modeWrapper);\n        this.rootEl.append(listDiv);\n        //updating the thumbs in interval\n        //don't update when: manager not visible || layer didn't change || is drawing\n        setInterval(function() {\n            if (_this.rootEl.style.display !== \"block\") return;\n            var historyState = (0, $gWfkn.klHistory).getState();\n            if (historyState === _this.oldHistoryState) return;\n            _this.oldHistoryState = historyState;\n            for(var i = 0; i < _this.layerElArr.length; i++)if (_this.selectedSpotIndex === _this.layerElArr[i].spot && _this.klCanvasLayerArr[_this.layerElArr[i].spot]) {\n                var ctx = (0, $eWjiX.BB).ctx(_this.layerElArr[i].thumb);\n                ctx.save();\n                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n                if (_this.klCanvasLayerArr[_this.layerElArr[i].spot].context.canvas.width < _this.layerElArr[i].thumb.width) ctx.imageSmoothingEnabled = false;\n                ctx.drawImage(_this.klCanvasLayerArr[_this.layerElArr[i].spot].context.canvas, 0, 0, _this.layerElArr[i].thumb.width, _this.layerElArr[i].thumb.height);\n                ctx.restore();\n            }\n        }, 1);\n        (0, $1C8RU.theme).addIsDarkListener(function() {\n            _this.createLayerList();\n        });\n        this.createLayerList();\n    }\n    (0, $7h4XF._)(LayerManager, [\n        {\n            key: \"move\",\n            value: function move(oldSpotIndex, newSpotIndex) {\n                var _this = this;\n                if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) throw \"layermanager - invalid move\";\n                for(var i = 0; i < this.klCanvasLayerArr.length; i++)(function(i) {\n                    var posy = _this.layerElArr[i].spot; // <- here\n                    if (_this.layerElArr[i].spot === oldSpotIndex) posy = newSpotIndex;\n                    else {\n                        if (_this.layerElArr[i].spot > oldSpotIndex) posy--;\n                        if (posy >= newSpotIndex) posy++;\n                    }\n                    _this.layerElArr[i].spot = posy;\n                    _this.layerElArr[i].posY = (_this.layerHeight + _this.layerSpacing) * (_this.klCanvasLayerArr.length - posy - 1);\n                    _this.layerElArr[i].style.top = _this.layerElArr[i].posY + \"px\";\n                })(i);\n                if (oldSpotIndex === newSpotIndex) return;\n                this.klCanvas.moveLayer(this.selectedSpotIndex, newSpotIndex - oldSpotIndex);\n                this.klCanvasLayerArr = this.klCanvas.getLayers();\n                this.selectedSpotIndex = newSpotIndex;\n                this.mergeBtn.disabled = this.selectedSpotIndex === 0;\n            }\n        },\n        {\n            key: \"posToSpot\",\n            value: function posToSpot(p) {\n                var result = parseInt(\"\" + (p / (this.layerHeight + this.layerSpacing) + 0.5));\n                result = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, result));\n                result = this.klCanvasLayerArr.length - result - 1;\n                return result;\n            }\n        },\n        {\n            key: \"updateLayersVerticalPosition\",\n            value: /**\r\n     * update css position of all layers that are not being dragged, while dragging\r\n     */ function updateLayersVerticalPosition(id, newspot) {\n                newspot = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, newspot));\n                if (newspot === this.lastpos) return;\n                for(var i = 0; i < this.klCanvasLayerArr.length; i++){\n                    if (this.layerElArr[i].spot === id) continue;\n                    var posy = this.layerElArr[i].spot;\n                    if (this.layerElArr[i].spot > id) posy--;\n                    if (posy >= newspot) posy++;\n                    this.layerElArr[i].posY = (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\n                    this.layerElArr[i].style.top = this.layerElArr[i].posY + \"px\";\n                }\n                this.lastpos = newspot;\n            }\n        },\n        {\n            key: \"renameLayer\",\n            value: function renameLayer(layerSpot) {\n                var _this = this;\n                (0, $jneUH.renameLayerDialog)(this.parentEl, this.klCanvas.getLayer(layerSpot).name, function(newName) {\n                    if (newName === undefined || newName === _this.klCanvas.getLayer(layerSpot).name) return;\n                    _this.klCanvas.renameLayer(layerSpot, newName);\n                    _this.createLayerList();\n                    (0, $gWfkn.klHistory).pause(true);\n                    _this.onSelect(layerSpot);\n                    (0, $gWfkn.klHistory).pause(false);\n                });\n            }\n        },\n        {\n            key: \"updateHeight\",\n            value: function updateHeight() {\n                this.layerListEl.style.height = this.layerElArr.length * 35 + \"px\";\n            }\n        },\n        {\n            key: \"createLayerList\",\n            value: function createLayerList() {\n                var _this = this;\n                this.oldHistoryState = (0, $gWfkn.klHistory).getState();\n                this.klCanvasLayerArr = this.klCanvas.getLayers();\n                var checkerImUrl = (0, $eWjiX.BB).createCheckerDataUrl(4, undefined, (0, $1C8RU.theme).isDark());\n                var createLayerEntry = function(index) {\n                    var klLayer = (0, $7jh4K.throwIfNull)(_this.klCanvas.getLayer(index));\n                    var layerName = klLayer.name;\n                    var opacity = _this.klCanvasLayerArr[index].opacity;\n                    var isVisible = klLayer.isVisible;\n                    var layercanvas = _this.klCanvasLayerArr[index].context.canvas;\n                    var layer = (0, $eWjiX.BB).el({\n                        className: \"kl-layer\"\n                    });\n                    _this.layerElArr[index] = layer;\n                    layer.posY = (_this.klCanvasLayerArr.length - 1) * 35 - index * 35;\n                    (0, $eWjiX.BB).css(layer, {\n                        top: layer.posY + \"px\"\n                    });\n                    var innerLayer = (0, $eWjiX.BB).el();\n                    (0, $eWjiX.BB).css(innerLayer, {\n                        position: \"relative\"\n                    });\n                    var container1 = (0, $eWjiX.BB).el();\n                    (0, $eWjiX.BB).css(container1, {\n                        width: \"270px\",\n                        height: \"34px\"\n                    });\n                    var container2 = (0, $eWjiX.BB).el();\n                    layer.append(innerLayer);\n                    innerLayer.append(container1, container2);\n                    layer.spot = index;\n                    //checkbox - visibility\n                    {\n                        var checkWrapper = (0, $eWjiX.BB).el({\n                            tagName: \"label\",\n                            parent: container1,\n                            title: (0, $1mH1z.LANG)(\"layers-visibility-toggle\"),\n                            css: {\n                                display: \"flex\",\n                                width: \"25px\",\n                                height: \"100%\",\n                                justifyContent: \"right\",\n                                alignItems: \"center\",\n                                cursor: \"pointer\"\n                            }\n                        });\n                        var check = (0, $eWjiX.BB).el({\n                            tagName: \"input\",\n                            parent: checkWrapper,\n                            custom: {\n                                type: \"checkbox\",\n                                tabindex: \"-1\"\n                            },\n                            css: {\n                                display: \"block\",\n                                cursor: \"pointer\",\n                                margin: \"0\",\n                                marginRight: \"5px\"\n                            }\n                        });\n                        check.checked = isVisible;\n                        check.onchange = function() {\n                            _this.klCanvas.setLayerIsVisible(layer.spot, check.checked);\n                            _this.createLayerList();\n                            if (layer.spot === _this.selectedSpotIndex) {\n                                (0, $gWfkn.klHistory).pause(true);\n                                _this.onSelect(_this.selectedSpotIndex);\n                                (0, $gWfkn.klHistory).pause(false);\n                            }\n                        };\n                        // prevent layer getting dragged\n                        var preventFunc = function(e) {\n                            e.preventDefault();\n                            e.stopPropagation();\n                        };\n                        if (0, $6J2My.hasPointerEvents) checkWrapper.onpointerdown = preventFunc;\n                        else checkWrapper.onmousedown = preventFunc;\n                    }\n                    //thumb\n                    {\n                        var thumbDimensions = (0, $eWjiX.BB).fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\n                        layer.thumb = (0, $eWjiX.BB).canvas(thumbDimensions.width, thumbDimensions.height);\n                        var thc = (0, $eWjiX.BB).ctx(layer.thumb);\n                        thc.save();\n                        if (layer.thumb.width > layercanvas.width) thc.imageSmoothingEnabled = false;\n                        thc.drawImage(layercanvas, 0, 0, layer.thumb.width, layer.thumb.height);\n                        thc.restore();\n                        (0, $eWjiX.BB).css(layer.thumb, {\n                            position: \"absolute\",\n                            left: (32 - layer.thumb.width) / 2 + $82406ffdc1235dbb$var$paddingLeft + \"px\",\n                            top: (32 - layer.thumb.height) / 2 + 1 + \"px\"\n                        });\n                        layer.thumb.style.backgroundImage = \"url(\" + checkerImUrl + \")\";\n                    }\n                    layer.label = (0, $eWjiX.BB).el({\n                        className: \"kl-layer__label\"\n                    });\n                    layer.layerName = layerName;\n                    layer.label.append(layer.layerName);\n                    (0, $eWjiX.BB).css(layer.label, {\n                        position: \"absolute\",\n                        left: 38 + $82406ffdc1235dbb$var$paddingLeft + \"px\",\n                        top: \"1px\",\n                        fontSize: \"13px\",\n                        width: \"170px\",\n                        height: \"20px\",\n                        overflow: \"hidden\",\n                        whiteSpace: \"nowrap\"\n                    });\n                    layer.label.ondblclick = function() {\n                        _this.renameLayer(layer.spot);\n                    };\n                    layer.opacityLabel = (0, $eWjiX.BB).el({\n                        className: \"kl-layer__opacity-label\"\n                    });\n                    layer.opacity = opacity;\n                    layer.opacityLabel.append(parseInt(\"\" + layer.opacity * 100) + \"%\");\n                    (0, $eWjiX.BB).css(layer.opacityLabel, {\n                        position: \"absolute\",\n                        left: 189 + $82406ffdc1235dbb$var$paddingLeft + \"px\",\n                        top: \"1px\",\n                        fontSize: \"13px\",\n                        textAlign: \"right\",\n                        width: \"50px\",\n                        transition: \"color 0.2s ease-in-out\",\n                        textDecoration: isVisible ? undefined : \"line-through\"\n                    });\n                    var oldOpacity;\n                    var opacitySlider = new (0, $j5jvd.PointSlider)({\n                        init: layer.opacity,\n                        width: 200,\n                        pointSize: 14,\n                        callback: function(sliderValue, isFirst, isLast) {\n                            if (isFirst) {\n                                oldOpacity = _this.klCanvas.getLayer(layer.spot).opacity;\n                                (0, $gWfkn.klHistory).pause(true);\n                                return;\n                            }\n                            if (isLast) {\n                                (0, $gWfkn.klHistory).pause(false);\n                                if (oldOpacity !== sliderValue) _this.klCanvas.layerOpacity(layer.spot, sliderValue);\n                                return;\n                            }\n                            layer.opacityLabel.innerHTML = Math.round(sliderValue * 100) + \"%\";\n                            _this.klCanvas.layerOpacity(layer.spot, sliderValue);\n                        }\n                    });\n                    (0, $eWjiX.BB).css(opacitySlider.getEl(), {\n                        position: \"absolute\",\n                        left: 39 + $82406ffdc1235dbb$var$paddingLeft + \"px\",\n                        top: \"17px\"\n                    });\n                    layer.opacitySlider = opacitySlider;\n                    //larger layer preview - hover\n                    layer.thumb.onpointerover = function(e) {\n                        if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== \"touch\")) return;\n                        var thumbDimensions = (0, $eWjiX.BB).fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\n                        if (_this.largeThumbCanvas.width !== thumbDimensions.width || _this.largeThumbCanvas.height !== thumbDimensions.height) {\n                            _this.largeThumbCanvas.width = thumbDimensions.width;\n                            _this.largeThumbCanvas.height = thumbDimensions.height;\n                        }\n                        var ctx = (0, $eWjiX.BB).ctx(_this.largeThumbCanvas);\n                        ctx.save();\n                        if (_this.largeThumbCanvas.width > layercanvas.width) ctx.imageSmoothingEnabled = false;\n                        ctx.imageSmoothingQuality = \"high\";\n                        ctx.clearRect(0, 0, _this.largeThumbCanvas.width, _this.largeThumbCanvas.height);\n                        ctx.drawImage(layercanvas, 0, 0, _this.largeThumbCanvas.width, _this.largeThumbCanvas.height);\n                        ctx.restore();\n                        (0, $eWjiX.BB).css(_this.largeThumbDiv, {\n                            top: e.clientY - _this.largeThumbCanvas.height / 2 + \"px\",\n                            opacity: \"0\"\n                        });\n                        if (!_this.largeThumbInDocument) {\n                            document.body.append(_this.largeThumbDiv);\n                            _this.largeThumbInDocument = true;\n                        }\n                        clearTimeout(_this.largeThumbInTimeout);\n                        _this.largeThumbInTimeout = setTimeout(function() {\n                            (0, $eWjiX.BB).css(_this.largeThumbDiv, {\n                                opacity: \"1\"\n                            });\n                        }, 20);\n                        clearTimeout(_this.largeThumbTimeout);\n                    };\n                    layer.thumb.onpointerout = function() {\n                        clearTimeout(_this.largeThumbInTimeout);\n                        (0, $eWjiX.BB).css(_this.largeThumbDiv, {\n                            opacity: \"0\"\n                        });\n                        clearTimeout(_this.largeThumbTimeout);\n                        _this.largeThumbTimeout = setTimeout(function() {\n                            if (!_this.largeThumbInDocument) return;\n                            _this.largeThumbDiv.remove();\n                            _this.largeThumbInDocument = false;\n                        }, 300);\n                    };\n                    container1.append(layer.thumb, layer.label, layer.opacityLabel, opacitySlider.getEl());\n                    var dragstart = false;\n                    var freshSelection = false;\n                    //events for moving layers up and down\n                    var dragEventHandler = function(event) {\n                        if (event.type === \"pointerdown\" && event.button === \"left\") {\n                            (0, $eWjiX.BB).css(layer, {\n                                transition: \"box-shadow 0.3s ease-in-out\"\n                            });\n                            layer.style.zIndex = \"1\";\n                            _this.lastpos = layer.spot;\n                            freshSelection = false;\n                            if (!layer.isSelected) {\n                                freshSelection = true;\n                                _this.activateLayer(layer.spot);\n                            }\n                            dragstart = true;\n                        } else if (event.type === \"pointermove\" && event.button === \"left\") {\n                            if (dragstart) {\n                                dragstart = false;\n                                (0, $eWjiX.BB).css(layer, {\n                                    boxShadow: \"1px 3px 5px rgba(0,0,0,0.4)\"\n                                });\n                            }\n                            layer.posY += event.dY;\n                            var corrected = Math.max(0, Math.min((_this.klCanvasLayerArr.length - 1) * 35, layer.posY));\n                            layer.style.top = corrected + \"px\";\n                            _this.updateLayersVerticalPosition(layer.spot, _this.posToSpot(layer.posY));\n                        }\n                        if (event.type === \"pointerup\") {\n                            (0, $eWjiX.BB).css(layer, {\n                                transition: \"all 0.1s linear\"\n                            });\n                            setTimeout(function() {\n                                (0, $eWjiX.BB).css(layer, {\n                                    boxShadow: \"\"\n                                });\n                            }, 20);\n                            layer.posY = Math.max(0, Math.min((_this.klCanvasLayerArr.length - 1) * 35, layer.posY));\n                            layer.style.zIndex = \"\";\n                            var newSpot = _this.posToSpot(layer.posY);\n                            var oldSpot = layer.spot;\n                            _this.move(layer.spot, newSpot);\n                            if (oldSpot != newSpot) {\n                                (0, $gWfkn.klHistory).pause(true);\n                                _this.onSelect(_this.selectedSpotIndex);\n                                (0, $gWfkn.klHistory).pause(false);\n                            }\n                            if (oldSpot === newSpot && freshSelection) _this.onSelect(_this.selectedSpotIndex);\n                            freshSelection = false;\n                        }\n                    };\n                    layer.pointerListener = new (0, $eWjiX.BB).PointerListener({\n                        target: container1,\n                        onPointer: dragEventHandler\n                    });\n                    _this.layerListEl.append(layer);\n                };\n                this.layerElArr = [];\n                while(this.layerListEl.firstChild){\n                    var child = this.layerListEl.firstChild;\n                    child.pointerListener.destroy();\n                    child.opacitySlider.destroy();\n                    child.remove();\n                }\n                for(var i = 0; i < this.klCanvasLayerArr.length; i++)createLayerEntry(i);\n                this.activateLayer(this.selectedSpotIndex);\n                this.updateHeight();\n            }\n        },\n        {\n            // ---- interface ----\n            key: \"update\",\n            value: function update(activeLayerSpotIndex) {\n                var _this = this;\n                this.klCanvasLayerArr = this.klCanvas.getLayers();\n                if (activeLayerSpotIndex || activeLayerSpotIndex === 0) this.selectedSpotIndex = activeLayerSpotIndex;\n                this.removeBtn.disabled = this.klCanvasLayerArr.length === 1;\n                if (this.klCanvasLayerArr.length === (0, $705qg.MAX_LAYERS)) {\n                    this.addBtn.disabled = true;\n                    this.duplicateBtn.disabled = true;\n                } else {\n                    this.addBtn.disabled = false;\n                    this.duplicateBtn.disabled = false;\n                }\n                setTimeout(function() {\n                    return _this.createLayerList();\n                }, 1);\n            }\n        },\n        {\n            key: \"getSelected\",\n            value: function getSelected() {\n                return this.selectedSpotIndex;\n            }\n        },\n        {\n            key: \"activateLayer\",\n            value: function activateLayer(spotIndex) {\n                if (spotIndex < 0 || spotIndex > this.layerElArr.length - 1) throw \"invalid spotIndex \" + spotIndex + \", layerElArr.length \" + this.layerElArr.length;\n                this.selectedSpotIndex = spotIndex;\n                this.modeSelect.setValue(this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr);\n                for(var i = 0; i < this.layerElArr.length; i++){\n                    var layer = this.layerElArr[i];\n                    var isSelected = this.selectedSpotIndex === layer.spot;\n                    (0, $eWjiX.BB).css(layer, {\n                        boxShadow: \"\"\n                    });\n                    layer.classList.toggle(\"kl-layer--selected\", isSelected);\n                    layer.opacitySlider.setActive(isSelected);\n                    layer.isSelected = isSelected;\n                }\n                this.mergeBtn.disabled = this.selectedSpotIndex === 0;\n            }\n        },\n        {\n            key: \"setUiState\",\n            value: function setUiState(stateStr) {\n                this.uiState = stateStr;\n                if (this.uiState === \"left\") (0, $eWjiX.BB).css(this.largeThumbDiv, {\n                    left: \"280px\",\n                    right: \"\"\n                });\n                else (0, $eWjiX.BB).css(this.largeThumbDiv, {\n                    left: \"\",\n                    right: \"280px\"\n                });\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        }\n    ]);\n    return LayerManager;\n}();\n\n});\nparcelRequire.register(\"705qg\", function(module, exports) {\n\n$parcel$export(module.exports, \"MAX_LAYERS\", function () { return $0621fc8724f6bfac$export$9f4f73b1bd7c2f26; });\n$parcel$export(module.exports, \"KlCanvas\", function () { return $0621fc8724f6bfac$export$4a819bde91671014; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $bX4ja = parcelRequire(\"bX4ja\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $30Cml = parcelRequire(\"30Cml\");\n\nvar $3ujzu = parcelRequire(\"3ujzu\");\n\nvar $h20yl = parcelRequire(\"h20yl\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $aSJRf = parcelRequire(\"aSJRf\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $7EG77 = parcelRequire(\"7EG77\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $0621fc8724f6bfac$var$allowedMixModes = [\n    \"source-over\",\n    \"darken\",\n    \"multiply\",\n    \"color-burn\",\n    \"lighten\",\n    \"screen\",\n    \"color-dodge\",\n    \"overlay\",\n    \"soft-light\",\n    \"hard-light\",\n    \"difference\",\n    \"exclusion\",\n    \"hue\",\n    \"saturation\",\n    \"color\",\n    \"luminosity\"\n];\nvar $0621fc8724f6bfac$export$9f4f73b1bd7c2f26 = 16;\nvar $0621fc8724f6bfac$export$4a819bde91671014 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function KlCanvas(params) {\n        var layerNrOffset = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : 0;\n        (0, $cx0mh._)(this, KlCanvas);\n        this.layerNrOffset = layerNrOffset;\n        this.isDestroyed = false;\n        this.layerCanvasArr = [];\n        this.pickCanvas = (0, $eWjiX.BB).canvas(1, 1);\n        this.history = new (0, $gWfkn.DecoyKlHistory)();\n        if (\"copy\" in params) {\n            this.width = 1;\n            this.height = 1;\n        } else if (\"width\" in params && \"height\" in params) {\n            this.width = params.width;\n            this.height = params.height;\n        } else {\n            this.width = 1;\n            this.height = 1;\n        }\n        this.init(this.width, this.height);\n        this.changeListenerArr = [];\n        if (\"copy\" in params) try {\n            this.copy(params.copy);\n        } catch (e) {\n            this.destroy();\n            throw e;\n        }\n        else if (\"projectObj\" in params) {\n            var inLayers = (0, $bX4ja._)(params.projectObj.layers);\n            this.init(params.projectObj.width, params.projectObj.height);\n            if (!inLayers.length) throw new Error(\"project.layers needs at least 1 layer\");\n            for(var i = 0; i < inLayers.length; i++){\n                var mixModeStr = inLayers[i].mixModeStr;\n                if (mixModeStr && !$0621fc8724f6bfac$var$allowedMixModes.includes(mixModeStr)) throw new Error(\"unknown mixModeStr \" + inLayers[i].mixModeStr);\n                this.addLayer();\n                this.layerOpacity(i, inLayers[i].opacity);\n                this.layerCanvasArr[i].name = inLayers[i].name;\n                this.layerCanvasArr[i].isVisible = inLayers[i].isVisible;\n                this.layerCanvasArr[i].mixModeStr = mixModeStr || \"source-over\";\n                (0, $eWjiX.BB).ctx(this.layerCanvasArr[i]).drawImage(inLayers[i].image, 0, 0);\n            }\n        }\n        this.updateIndices();\n    }\n    (0, $7h4XF._)(KlCanvas, [\n        {\n            key: \"init\",\n            value: function init(w, h) {\n                if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) throw new Error(\"init - invalid canvas size: \" + w + \", \" + h);\n                this.width = w;\n                this.height = h;\n            }\n        },\n        {\n            key: \"emitChange\",\n            value: function emitChange() {\n                // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\n                this.changeListenerArr.forEach(function(item) {\n                    return item();\n                });\n            }\n        },\n        {\n            key: \"updateIndices\",\n            value: function updateIndices() {\n                this.layerCanvasArr.forEach(function(item, index) {\n                    item.index = index;\n                });\n            }\n        },\n        {\n            key: \"setHistory\",\n            value: function setHistory(h) {\n                this.history = h;\n            }\n        },\n        {\n            /**\r\n     * Resets canvas -> 1 layer, 100% opacity,\r\n     * unless layers provided.\r\n     * @param p\r\n     */ key: \"reset\",\n            value: function reset(p) {\n                if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height)) throw new Error(\"invalid canvas size\");\n                this.history.pause(true);\n                this.width = p.width;\n                this.height = p.height;\n                this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\n                if (p.layers) for(var i = 0; i < p.layers.length; i++){\n                    var item = p.layers[i];\n                    if (!this.layerCanvasArr[i]) this.addLayer();\n                    this.layerCanvasArr[i].name = item.name;\n                    this.layerCanvasArr[i].isVisible = item.isVisible;\n                    this.layerCanvasArr[i].width = this.width;\n                    this.layerCanvasArr[i].height = this.height;\n                    this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : \"source-over\";\n                    (0, $eWjiX.BB).ctx(this.layerCanvasArr[i]).drawImage(item.image, 0, 0);\n                    this.layerOpacity(i, item.opacity);\n                }\n                else {\n                    this.layerCanvasArr[0].name = p.layerName ? p.layerName : (0, $1mH1z.LANG)(\"layers-layer\") + \" 1\";\n                    this.layerCanvasArr[0].isVisible = true;\n                    this.layerCanvasArr[0].width = this.width;\n                    this.layerCanvasArr[0].height = this.height;\n                    this.layerCanvasArr[0].mixModeStr = \"source-over\";\n                    this.layerOpacity(0, 1);\n                    if (p.color) this.layerFill(0, p.color);\n                    else if (p.image) (0, $eWjiX.BB).ctx(this.layerCanvasArr[0]).drawImage(p.image, 0, 0);\n                }\n                this.updateIndices();\n                this.history.pause(false);\n                this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"reset\",\n                    params: [\n                        p\n                    ]\n                });\n                return this.layerCanvasArr.length - 1;\n            }\n        },\n        {\n            key: \"isLayerLimitReached\",\n            value: function isLayerLimitReached() {\n                return this.layerCanvasArr.length >= $0621fc8724f6bfac$export$9f4f73b1bd7c2f26;\n            }\n        },\n        {\n            key: \"getWidth\",\n            value: function getWidth() {\n                return this.width;\n            }\n        },\n        {\n            key: \"getHeight\",\n            value: function getHeight() {\n                return this.height;\n            }\n        },\n        {\n            key: \"copy\",\n            value: function copy(toCopyCanvas) {\n                if (toCopyCanvas.getWidth() < 1 || toCopyCanvas.getHeight() < 1 || isNaN(toCopyCanvas.getWidth()) || isNaN(toCopyCanvas.getHeight())) throw new Error(\"invalid canvas size\");\n                // keep existing canvases\n                var origLayers = toCopyCanvas.getLayers();\n                while(this.layerCanvasArr.length > origLayers.length)this.removeLayer(this.layerCanvasArr.length - 1);\n                if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\n                for(var i = 0; i < origLayers.length; i++){\n                    if (i >= this.layerCanvasArr.length) this.addLayer();\n                    else {\n                        this.layerCanvasArr[i].width = this.width;\n                        this.layerCanvasArr[i].height = this.height;\n                    }\n                    this.layerOpacity(i, origLayers[i].opacity);\n                    this.layerCanvasArr[i].name = origLayers[i].name;\n                    this.layerCanvasArr[i].isVisible = origLayers[i].isVisible;\n                    this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\n                    (0, $eWjiX.BB).ctx(this.layerCanvasArr[i]).drawImage(origLayers[i].context.canvas, 0, 0);\n                }\n                this.updateIndices();\n            }\n        },\n        {\n            key: \"getLayerCount\",\n            value: function getLayerCount() {\n                return this.layerCanvasArr.length;\n            }\n        },\n        {\n            key: \"resize\",\n            value: function resize(w, h) {\n                var algorithm = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : \"smooth\";\n                if (!w || !h || w === this.width && h === this.height || isNaN(w) || isNaN(h) || w < 1 || h < 1) return false;\n                w = Math.max(w, 1);\n                h = Math.max(h, 1);\n                var tmp1, tmp2;\n                if (algorithm === \"pixelated\") {\n                    tmp1 = (0, $eWjiX.BB).canvas(w, h);\n                    var tmp1Ctx = (0, $eWjiX.BB).ctx(tmp1);\n                    tmp1Ctx.imageSmoothingEnabled = false;\n                    for(var i = 0; i < this.layerCanvasArr.length; i++){\n                        if (i > 0) tmp1Ctx.clearRect(0, 0, w, h);\n                        var layerCanvas = this.layerCanvasArr[i];\n                        tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\n                        layerCanvas.width = w;\n                        layerCanvas.height = h;\n                        var layerContext = (0, $eWjiX.BB).ctx(layerCanvas);\n                        layerContext.drawImage(tmp1, 0, 0);\n                    }\n                } else if (algorithm === \"smooth\") {\n                    tmp1 = (0, $eWjiX.BB).canvas();\n                    tmp2 = (0, $eWjiX.BB).canvas();\n                    for(var i1 = 0; i1 < this.layerCanvasArr.length; i1++)(0, $eWjiX.BB).resizeCanvas(this.layerCanvasArr[i1], w, h, tmp1, tmp2);\n                } else throw new Error(\"unknown resize algorithm\");\n                this.width = w;\n                this.height = h;\n                return true;\n            }\n        },\n        {\n            /**\r\n     * crop / extend\r\n     * @param p\r\n     */ key: \"resizeCanvas\",\n            value: function resizeCanvas(p) {\n                var newW = Math.round(p.left) + this.width + Math.round(p.right);\n                var newH = Math.round(p.top) + this.height + Math.round(p.bottom);\n                var offX = Math.round(p.left);\n                var offY = Math.round(p.top);\n                if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) throw new Error(\"KlCanvas.resizeCanvas - invalid canvas size\");\n                for(var i = 0; i < this.layerCanvasArr.length; i++){\n                    var ctemp = (0, $eWjiX.BB).canvas(this.width, this.height);\n                    var layerCanvas = this.layerCanvasArr[i];\n                    var layerCtx = (0, $eWjiX.BB).ctx(this.layerCanvasArr[i]);\n                    (0, $eWjiX.BB).ctx(ctemp).drawImage(layerCanvas, 0, 0);\n                    this.layerCanvasArr[i].width = newW;\n                    this.layerCanvasArr[i].height = newH;\n                    layerCtx.save();\n                    if (i === 0 && p.fillColor) {\n                        layerCtx.fillStyle = (0, $eWjiX.BB).ColorConverter.toRgbStr(p.fillColor);\n                        layerCtx.fillRect(0, 0, newW, newH);\n                        layerCtx.clearRect(offX, offY, this.width, this.height);\n                    }\n                    layerCtx.drawImage(ctemp, offX, offY);\n                    layerCtx.restore();\n                }\n                this.width = newW;\n                this.height = newH;\n            }\n        },\n        {\n            /**\r\n     * will be inserted on top of selected\r\n     * @param selected\r\n     */ key: \"addLayer\",\n            value: function addLayer(selected) {\n                if (this.isLayerLimitReached()) return false;\n                var canvas = (0, $eWjiX.BB).canvas(this.width, this.height);\n                if (!canvas.getContext(\"2d\")) throw new Error(\"kl-create-canvas-error\");\n                canvas.isVisible = true;\n                canvas.mixModeStr = \"source-over\";\n                if (selected === undefined) {\n                    this.layerCanvasArr[this.layerCanvasArr.length] = canvas;\n                    selected = Math.max(0, this.layerCanvasArr.length - 1);\n                } else {\n                    this.layerCanvasArr.splice(selected + 1, 0, canvas);\n                    selected++;\n                }\n                canvas.name = (0, $1mH1z.LANG)(\"layers-layer\") + \" \" + (this.layerCanvasArr.length + this.layerNrOffset);\n                this.history.pause(true);\n                this.layerOpacity(selected, 1);\n                this.history.pause(false);\n                this.updateIndices();\n                this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"addLayer\",\n                    params: [\n                        selected - 1\n                    ]\n                });\n                return selected;\n            }\n        },\n        {\n            key: \"duplicateLayer\",\n            value: function duplicateLayer(i) {\n                if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) return false;\n                var canvas = (0, $eWjiX.BB).canvas(this.width, this.height);\n                this.layerCanvasArr.splice(i + 1, 0, canvas);\n                canvas.name = this.layerCanvasArr[i].name + \" \" + (0, $1mH1z.LANG)(\"layers-copy\");\n                canvas.isVisible = this.layerCanvasArr[i].isVisible;\n                canvas.mixModeStr = this.layerCanvasArr[i].mixModeStr;\n                // 2023-04-30 workaround for https://bugs.webkit.org/show_bug.cgi?id=256151\n                // todo replace with simple drawImage eventually when fixed\n                (0, $eWjiX.BB).ctx(canvas).putImageData((0, $eWjiX.BB).ctx(this.layerCanvasArr[i]).getImageData(0, 0, this.width, this.height), 0, 0);\n                this.history.pause(true);\n                this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\n                this.history.pause(false);\n                this.updateIndices();\n                this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"duplicateLayer\",\n                    params: [\n                        i\n                    ]\n                });\n                return i + 1;\n            }\n        },\n        {\n            key: \"getLayerContext\",\n            value: function getLayerContext(i, doReturnNull) {\n                if (this.layerCanvasArr[i]) return (0, $eWjiX.BB).ctx(this.layerCanvasArr[i]);\n                if (doReturnNull) return null;\n                throw new Error(\"layer of index \" + i + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\n            }\n        },\n        {\n            key: \"removeLayer\",\n            value: function removeLayer(i) {\n                if (this.layerCanvasArr[i]) {\n                    this.layerCanvasArr.splice(i, 1);\n                    this.updateIndices();\n                } else return false;\n                this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"removeLayer\",\n                    params: [\n                        i\n                    ]\n                });\n                return Math.max(0, i - 1);\n            }\n        },\n        {\n            key: \"renameLayer\",\n            value: function renameLayer(i, name) {\n                if (this.layerCanvasArr[i]) this.layerCanvasArr[i].name = name;\n                else return false;\n                this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"renameLayer\",\n                    params: [\n                        i,\n                        name\n                    ]\n                });\n                return true;\n            }\n        },\n        {\n            key: \"layerOpacity\",\n            value: function layerOpacity(layerIndex, opacity) {\n                if (!this.layerCanvasArr[layerIndex]) return;\n                opacity = Math.max(0, Math.min(1, opacity));\n                this.layerCanvasArr[layerIndex].opacity = opacity;\n                this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"layerOpacity\",\n                    params: [\n                        layerIndex,\n                        opacity\n                    ]\n                });\n                this.emitChange();\n            }\n        },\n        {\n            key: \"setLayerIsVisible\",\n            value: function setLayerIsVisible(layerIndex, isVisible) {\n                if (this.layerCanvasArr[layerIndex]) this.layerCanvasArr[layerIndex].isVisible = isVisible;\n                else throw new Error(\"layer \".concat(layerIndex, \" undefined\"));\n                this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"setLayerIsVisible\",\n                    params: [\n                        layerIndex,\n                        isVisible\n                    ]\n                });\n            }\n        },\n        {\n            key: \"moveLayer\",\n            value: function moveLayer(i, d) {\n                if (d === 0) return;\n                if (this.layerCanvasArr[i]) {\n                    var temp = this.layerCanvasArr[i];\n                    this.layerCanvasArr.splice(i, 1);\n                    var targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\n                    this.layerCanvasArr.splice(targetIndex, 0, temp);\n                    this.updateIndices();\n                    this.history.push({\n                        tool: [\n                            \"canvas\"\n                        ],\n                        action: \"moveLayer\",\n                        params: [\n                            i,\n                            d\n                        ]\n                    });\n                    return targetIndex;\n                }\n            }\n        },\n        {\n            key: \"mergeLayers\",\n            value: function mergeLayers(layerBottomIndex, layerTopIndex, mixModeStr) {\n                if (!this.layerCanvasArr[layerBottomIndex] || !this.layerCanvasArr[layerTopIndex] || layerBottomIndex === layerTopIndex) return;\n                //order messed up\n                if (layerBottomIndex > layerTopIndex) {\n                    var temp = layerBottomIndex;\n                    layerBottomIndex = layerTopIndex;\n                    layerTopIndex = temp;\n                }\n                var topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\n                if (topOpacity !== 0 && topOpacity) {\n                    var ctx = (0, $eWjiX.BB).ctx(this.layerCanvasArr[layerBottomIndex]);\n                    ctx.save();\n                    if (mixModeStr === \"as-alpha\") {\n                        (0, $eWjiX.BB).convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\n                        ctx.globalCompositeOperation = \"destination-in\";\n                        ctx.globalAlpha = topOpacity;\n                        (0, $eWjiX.BB).ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\n                    } else {\n                        if (mixModeStr) ctx.globalCompositeOperation = mixModeStr;\n                        ctx.globalAlpha = topOpacity;\n                        (0, $eWjiX.BB).ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\n                    }\n                    ctx.restore();\n                    // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\n                    // TODO remove if chrome updated\n                    if (mixModeStr) {\n                        ctx.save();\n                        ctx.fillStyle = \"rgba(0,0,0,0.01)\";\n                        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\n                        ctx.restore();\n                    }\n                }\n                this.updateIndices();\n                this.history.pause(true);\n                this.removeLayer(layerTopIndex);\n                this.history.pause(false);\n                this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"mergeLayers\",\n                    params: [\n                        layerBottomIndex,\n                        layerTopIndex,\n                        mixModeStr\n                    ]\n                });\n                return layerBottomIndex;\n            }\n        },\n        {\n            key: \"rotate\",\n            value: function rotate(deg) {\n                while(deg < 0)deg += 360;\n                deg %= 360;\n                if (deg % 90 != 0 || deg === 0) return;\n                var temp = (0, $eWjiX.BB).canvas();\n                if (deg === 0 || deg === 180) {\n                    temp.width = this.width;\n                    temp.height = this.height;\n                } else if (deg === 90 || deg === 270) {\n                    temp.width = this.height;\n                    temp.height = this.width;\n                }\n                var ctx = (0, $eWjiX.BB).ctx(temp);\n                for(var i = 0; i < this.layerCanvasArr.length; i++){\n                    ctx.clearRect(0, 0, temp.width, temp.height);\n                    ctx.save();\n                    ctx.translate(temp.width / 2, temp.height / 2);\n                    ctx.rotate(deg * Math.PI / 180);\n                    if (deg === 180) ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\n                    else if (deg === 90 || deg === 270) ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\n                    this.layerCanvasArr[i].width = temp.width;\n                    this.layerCanvasArr[i].height = temp.height;\n                    (0, $eWjiX.BB).ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\n                    (0, $eWjiX.BB).ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\n                    ctx.restore();\n                }\n                this.width = temp.width;\n                this.height = temp.height;\n            }\n        },\n        {\n            key: \"flip\",\n            value: function flip(isHorizontal, isVertical, layerIndex) {\n                if (!isHorizontal && !isVertical) return;\n                var temp = (0, $eWjiX.BB).canvas(this.width, this.height);\n                temp.width = this.width;\n                temp.height = this.height;\n                var tempCtx = (0, $eWjiX.BB).ctx(temp);\n                for(var i = 0; i < this.layerCanvasArr.length; i++){\n                    if ((layerIndex || layerIndex === 0) && i !== layerIndex) continue;\n                    tempCtx.save();\n                    tempCtx.clearRect(0, 0, temp.width, temp.height);\n                    tempCtx.translate(temp.width / 2, temp.height / 2);\n                    tempCtx.scale(isHorizontal ? -1 : 1, isVertical ? -1 : 1);\n                    tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\n                    tempCtx.restore();\n                    (0, $eWjiX.BB).ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\n                    (0, $eWjiX.BB).ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\n                }\n            }\n        },\n        {\n            key: \"layerFill\",\n            value: function layerFill(layerIndex, colorObj, compositeOperation) {\n                var ctx = (0, $eWjiX.BB).ctx(this.layerCanvasArr[layerIndex]);\n                ctx.save();\n                if (compositeOperation) ctx.globalCompositeOperation = compositeOperation;\n                ctx.fillStyle = \"rgba(\" + colorObj.r + \",\" + colorObj.g + \",\" + colorObj.b + \",1)\";\n                ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\n                ctx.restore();\n                // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\n                // TODO remove if chrome updated\n                ctx.save();\n                ctx.fillStyle = \"rgba(0,0,0,0.01)\";\n                ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\n                ctx.restore();\n                /*if (!document.getElementById('testocanvas')) {\r\n            layerCanvasArr[layerIndex].id = 'testocanvas';\r\n            document.body.append(layerCanvasArr[layerIndex]);\r\n            BB.css(layerCanvasArr[layerIndex], {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }\r\n        if (!document.getElementById('testocanvas')) {\r\n            let c = document.createElement('canvas');\r\n            c.width = 1000;\r\n            c.height = 1000;\r\n            let ctx2 = c.getContext('2d');\r\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\r\n            c.id = 'testocanvas';\r\n            document.body.append(c);\r\n            BB.css(c, {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }*/ this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"layerFill\",\n                    params: [\n                        layerIndex,\n                        colorObj,\n                        compositeOperation\n                    ]\n                });\n            }\n        },\n        {\n            key: \"floodFill\",\n            value: function floodFill(layerIndex, x, y, rgb, opacity, tolerance, sampleStr, grow, isContiguous) {\n                if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) return;\n                tolerance = Math.round(tolerance);\n                if (![\n                    \"above\",\n                    \"current\",\n                    \"all\"\n                ].includes(sampleStr)) throw new Error(\"invalid sampleStr\");\n                var result;\n                var targetCtx;\n                var targetImageData;\n                if (sampleStr === \"all\") {\n                    var srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\n                    var srcCtx = (0, $eWjiX.BB).ctx(srcCanvas);\n                    var srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\n                    var srcData = srcImageData.data;\n                    result = (0, $30Cml.floodFillBits)(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\n                    targetCtx = (0, $eWjiX.BB).ctx(this.layerCanvasArr[layerIndex]);\n                    targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\n                } else {\n                    var srcIndex = sampleStr === \"above\" ? layerIndex + 1 : layerIndex;\n                    if (srcIndex >= this.layerCanvasArr.length) return;\n                    var srcCtx1 = (0, $eWjiX.BB).ctx(this.layerCanvasArr[srcIndex]);\n                    var srcImageData1 = srcCtx1.getImageData(0, 0, this.width, this.height);\n                    var srcData1 = srcImageData1.data;\n                    result = (0, $30Cml.floodFillBits)(srcData1, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\n                    targetCtx = layerIndex === srcIndex ? srcCtx1 : (0, $eWjiX.BB).ctx(this.layerCanvasArr[layerIndex]);\n                    targetImageData = layerIndex === srcIndex ? srcImageData1 : targetCtx.getImageData(0, 0, this.width, this.height);\n                }\n                var targetData = targetImageData.data;\n                if (rgb) {\n                    if (opacity === 1) {\n                        for(var i = 0; i < this.width * this.height; i++)if (result.data[i] === 255) {\n                            targetData[i * 4] = rgb.r;\n                            targetData[i * 4 + 1] = rgb.g;\n                            targetData[i * 4 + 2] = rgb.b;\n                            targetData[i * 4 + 3] = 255;\n                        }\n                    } else {\n                        for(var i1 = 0; i1 < this.width * this.height; i1++)if (result.data[i1] === 255) {\n                            targetData[i1 * 4] = (0, $eWjiX.BB).mix(targetData[i1 * 4], rgb.r, opacity);\n                            targetData[i1 * 4 + 1] = (0, $eWjiX.BB).mix(targetData[i1 * 4 + 1], rgb.g, opacity);\n                            targetData[i1 * 4 + 2] = (0, $eWjiX.BB).mix(targetData[i1 * 4 + 2], rgb.b, opacity);\n                            targetData[i1 * 4 + 3] = (0, $eWjiX.BB).mix(targetData[i1 * 4 + 3], 255, opacity);\n                        }\n                    }\n                } else if (opacity === 1) {\n                    for(var i2 = 0; i2 < this.width * this.height; i2++)if (result.data[i2] === 255) targetData[i2 * 4 + 3] = 0;\n                } else {\n                    for(var i3 = 0; i3 < this.width * this.height; i3++)if (result.data[i3] === 255) targetData[i3 * 4 + 3] = (0, $eWjiX.BB).mix(targetData[i3 * 4 + 3], 0, opacity);\n                }\n                targetCtx.putImageData(targetImageData, 0, 0);\n                this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"replaceLayer\",\n                    params: [\n                        layerIndex,\n                        targetImageData\n                    ]\n                });\n            }\n        },\n        {\n            /**\r\n     * draw shape via BB.drawShape\r\n     * @param layerIndex\r\n     * @param shapeObj\r\n     */ key: \"drawShape\",\n            value: function drawShape1(layerIndex, shapeObj) {\n                if (shapeObj.x1 === shapeObj.x2 && shapeObj.y1 === shapeObj.y2) return;\n                (0, $3ujzu.drawShape)((0, $eWjiX.BB).ctx(this.layerCanvasArr[layerIndex]), shapeObj);\n                this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"drawShape\",\n                    params: [\n                        layerIndex,\n                        (0, $eWjiX.BB).copyObj(shapeObj)\n                    ]\n                });\n            }\n        },\n        {\n            key: \"drawGradient\",\n            value: function drawGradient1(layerIndex, gradientObj) {\n                (0, $7EG77.drawGradient)((0, $eWjiX.BB).ctx(this.layerCanvasArr[layerIndex]), gradientObj);\n                this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"drawGradient\",\n                    params: [\n                        layerIndex,\n                        (0, $eWjiX.BB).copyObj(gradientObj)\n                    ]\n                });\n            }\n        },\n        {\n            key: \"text\",\n            value: function text(layerIndex, p) {\n                (0, $h20yl.renderText)(this.layerCanvasArr[layerIndex], (0, $eWjiX.BB).copyObj(p));\n                this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"text\",\n                    params: [\n                        layerIndex,\n                        (0, $eWjiX.BB).copyObj(p)\n                    ]\n                });\n            }\n        },\n        {\n            key: \"replaceLayer\",\n            value: function replaceLayer(layerIndex, imageData) {\n                var ctx = (0, $eWjiX.BB).ctx(this.layerCanvasArr[layerIndex]);\n                ctx.putImageData(imageData, 0, 0);\n                this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"replaceLayer\",\n                    params: [\n                        layerIndex,\n                        imageData\n                    ]\n                });\n            }\n        },\n        {\n            key: \"clearLayer\",\n            value: function clearLayer(layerIndex) {\n                var ctx = (0, $eWjiX.BB).ctx(this.layerCanvasArr[layerIndex]);\n                ctx.save();\n                ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\n                ctx.restore();\n                this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"clearLayer\",\n                    params: [\n                        layerIndex\n                    ]\n                });\n            }\n        },\n        {\n            key: \"getLayers\",\n            value: function getLayers() {\n                return this.layerCanvasArr.map(function(item) {\n                    return {\n                        context: (0, $eWjiX.BB).ctx(item),\n                        isVisible: item.isVisible,\n                        opacity: item.opacity,\n                        name: item.name,\n                        mixModeStr: item.mixModeStr\n                    };\n                });\n            }\n        },\n        {\n            key: \"getLayersFast\",\n            value: function getLayersFast() {\n                return this.layerCanvasArr.map(function(item) {\n                    return {\n                        canvas: item,\n                        isVisible: item.isVisible,\n                        opacity: item.opacity,\n                        name: item.name,\n                        mixModeStr: item.mixModeStr\n                    };\n                });\n            }\n        },\n        {\n            key: \"getLayerIndex\",\n            value: function getLayerIndex(canvasObj, doReturnNull) {\n                for(var i = 0; i < this.layerCanvasArr.length; i++){\n                    if (this.layerCanvasArr[i] === canvasObj) return i;\n                }\n                if (!doReturnNull) throw new Error(\"layer not found (in \" + this.layerCanvasArr.length + \" layers)\");\n                return null;\n            }\n        },\n        {\n            key: \"getLayer\",\n            value: function getLayer(index, doReturnNull) {\n                if (this.layerCanvasArr[index]) return {\n                    context: (0, $eWjiX.BB).ctx(this.layerCanvasArr[index]),\n                    isVisible: this.layerCanvasArr[index].isVisible,\n                    opacity: this.layerCanvasArr[index].opacity,\n                    name: this.layerCanvasArr[index].name,\n                    id: index\n                };\n                if (!doReturnNull) throw new Error(\"layer of index \" + index + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\n                return null;\n            }\n        },\n        {\n            key: \"getColorAt\",\n            value: function getColorAt(x, y) {\n                x = Math.floor(x);\n                y = Math.floor(y);\n                var ctx = (0, $eWjiX.BB).ctx(this.pickCanvas);\n                ctx.save();\n                ctx.imageSmoothingEnabled = false;\n                ctx.clearRect(0, 0, 1, 1);\n                for(var i = 0; i < this.layerCanvasArr.length; i++){\n                    var layer = this.layerCanvasArr[i];\n                    if (!layer.isVisible || layer.opacity === 0) continue;\n                    ctx.globalAlpha = layer.opacity;\n                    ctx.globalCompositeOperation = layer.mixModeStr;\n                    ctx.drawImage(layer, -x, -y);\n                }\n                ctx.restore();\n                var imData = ctx.getImageData(0, 0, 1, 1);\n                return new (0, $eWjiX.BB).RGB(imData.data[0], imData.data[1], imData.data[2]);\n            }\n        },\n        {\n            key: \"getCompleteCanvas\",\n            value: function getCompleteCanvas(factor) {\n                return (0, $aSJRf.drawProject)(this.getProject(), factor);\n            }\n        },\n        {\n            key: \"getProject\",\n            value: function getProject() {\n                return {\n                    width: this.width,\n                    height: this.height,\n                    layers: this.layerCanvasArr.map(function(layer) {\n                        return {\n                            name: layer.name,\n                            isVisible: layer.isVisible,\n                            opacity: layer.opacity,\n                            mixModeStr: layer.mixModeStr,\n                            image: layer\n                        };\n                    })\n                };\n            }\n        },\n        {\n            key: \"addChangeListener\",\n            value: function addChangeListener(func) {\n                if (this.changeListenerArr.includes(func)) return;\n                this.changeListenerArr.push(func);\n            }\n        },\n        {\n            key: \"removeChangeListener\",\n            value: function removeChangeListener(func) {\n                for(var i = 0; i < this.changeListenerArr.length; i++)if (this.changeListenerArr[i] === func) {\n                    this.changeListenerArr.splice(i, 1);\n                    return;\n                }\n            }\n        },\n        {\n            key: \"setMixMode\",\n            value: function setMixMode(layerIndex, mixModeStr) {\n                if (!this.layerCanvasArr[layerIndex]) throw new Error(\"invalid layer\");\n                this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\n                this.history.push({\n                    tool: [\n                        \"canvas\"\n                    ],\n                    action: \"setMixMode\",\n                    params: [\n                        layerIndex,\n                        \"\" + mixModeStr\n                    ]\n                });\n            }\n        },\n        {\n            /**\r\n     * Set composite drawing step for KlCanvasWorkspace.\r\n     * To apply temporary manipulations to a layer.\r\n     *\r\n     * @param layerIndex\r\n     * @param compositeObj\r\n     */ key: \"setComposite\",\n            value: function setComposite(layerIndex, compositeObj) {\n                if (!this.layerCanvasArr[layerIndex]) throw new Error(\"invalid layer\");\n                this.layerCanvasArr[layerIndex].compositeObj = (0, $7jh4K.nullToUndefined)(compositeObj);\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                if (this.isDestroyed) return;\n                this.layerCanvasArr.forEach(function(canvas) {\n                    (0, $eWjiX.BB).freeCanvas(canvas);\n                });\n                this.layerCanvasArr = [];\n                this.isDestroyed = true;\n            }\n        }\n    ]);\n    return KlCanvas;\n}();\n\n});\nparcelRequire.register(\"30Cml\", function(module, exports) {\n\n$parcel$export(module.exports, \"floodFillBits\", function () { return $7069db2f5e23d00f$export$13d50f258a8034f; });\n/**\r\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/, but it implemented tolerance wrong, and had bugs.\r\n * So, my own implementation. can handle tolerance, grow, opacity.\r\n * Needs to be optimized.\r\n */ /**\r\n * Set values in data within rect to 254, unless they're 255\r\n *\r\n * @param data Uint8Array\r\n * @param width int\r\n * @param x0 int\r\n * @param y0 int\r\n * @param x1 int >x0\r\n * @param y1 int >y0\r\n */ function $7069db2f5e23d00f$var$fillRect(data, width, x0, y0, x1, y1) {\n    for(var x = x0; x <= x1; x++)for(var y = y0; y <= y1; y++){\n        if (data[y * width + x] === 255) continue;\n        data[y * width + x] = 254;\n    }\n}\nvar $7069db2f5e23d00f$var$mx, $7069db2f5e23d00f$var$my;\n/**\r\n * Get index i moved by dX, dY. in array with dimensions width height.\r\n * Returns null if outside bounds.\r\n *\r\n * @param width int\r\n * @param height int\r\n * @param i int\r\n * @param dX int\r\n * @param dY int\r\n */ function $7069db2f5e23d00f$var$moveIndex(width, height, i, dX, dY) {\n    $7069db2f5e23d00f$var$mx = i % width + dX;\n    $7069db2f5e23d00f$var$my = Math.floor(i / width) + dY;\n    if ($7069db2f5e23d00f$var$mx < 0 || $7069db2f5e23d00f$var$my < 0 || $7069db2f5e23d00f$var$mx >= width || $7069db2f5e23d00f$var$my >= height) return undefined;\n    return $7069db2f5e23d00f$var$my * width + $7069db2f5e23d00f$var$mx;\n}\n/**\r\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\r\n * returns false if already filled, or i is null\r\n *\r\n * @param srcArr Uint8ClampedArray rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param initRgba rgba\r\n * @param tolerance int 0 - 255\r\n * @param i int - srcArr index\r\n * @returns {boolean}\r\n */ function $7069db2f5e23d00f$var$testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i) {\n    if (i === undefined || targetArr[i] === 255) return false;\n    if (srcArr[i * 4] === initRgba[0] && srcArr[i * 4 + 1] === initRgba[1] && srcArr[i * 4 + 2] === initRgba[2] && srcArr[i * 4 + 3] === initRgba[3]) {\n        targetArr[i] = 255;\n        return true;\n    }\n    if (tolerance > 0 && Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance && Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance && Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance && Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance) {\n        targetArr[i] = 255;\n        return true;\n    }\n    return false;\n}\n/**\r\n *\r\n * @param srcArr Uint8ClampedArray rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param px int\r\n * @param py int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n */ function $7069db2f5e23d00f$var$floodFill(srcArr, targetArr, width, height, px, py, tolerance, grow, isContiguous) {\n    var initRgba = [\n        srcArr[(py * width + px) * 4],\n        srcArr[(py * width + px) * 4 + 1],\n        srcArr[(py * width + px) * 4 + 2],\n        srcArr[(py * width + px) * 4 + 3]\n    ];\n    if (isContiguous) {\n        var q = [];\n        q.push(py * width + px);\n        targetArr[py * width + px] = 255;\n        var i, e;\n        while(q.length){\n            i = q.pop(); // a test would slow down the code\n            // queue up unfilled neighbors\n            e = $7069db2f5e23d00f$var$moveIndex(width, height, i, -1, 0); // left\n            // test will return false if e is undefined -> only numbers will be pushed to q\n            $7069db2f5e23d00f$var$testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n            e = $7069db2f5e23d00f$var$moveIndex(width, height, i, 1, 0); // right\n            $7069db2f5e23d00f$var$testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n            e = $7069db2f5e23d00f$var$moveIndex(width, height, i, 0, -1); // up\n            $7069db2f5e23d00f$var$testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n            e = $7069db2f5e23d00f$var$moveIndex(width, height, i, 0, 1); // bottom\n            $7069db2f5e23d00f$var$testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n        }\n    } else for(var i1 = 0; i1 < width * height; i1++)$7069db2f5e23d00f$var$testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i1);\n    // grow\n    if (grow === 0) return;\n    // how does it grow? it finds all pixel at the edge.\n    // then depending on what kind of edge it is, it draws a rectangle into target\n    // the rectangle has the value 254, or else it will mess it all up.\n    // after it's all done, replaces it with 255\n    var x0, x1, y0, y1;\n    var l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\n    for(var x = 0; x < width; x++)for(var y = 0; y < height; y++){\n        if (targetArr[y * width + x] !== 255) continue;\n        // bounds of rectangle\n        x0 = x;\n        x1 = x;\n        y0 = y;\n        y1 = y;\n        l = targetArr[y * width + x - 1] !== 255;\n        tl = targetArr[(y - 1) * width + x - 1] !== 255;\n        t = targetArr[(y - 1) * width + x] !== 255;\n        tr = targetArr[(y - 1) * width + x + 1] !== 255;\n        r = targetArr[y * width + x + 1] !== 255;\n        br = targetArr[(y + 1) * width + x + 1] !== 255;\n        b = targetArr[(y + 1) * width + x] !== 255;\n        bl = targetArr[(y + 1) * width + x - 1] !== 255;\n        if (l) x0 = x - grow;\n        if (l && tl && t) {\n            x0 = x - grow;\n            y0 = y - grow;\n        }\n        if (t) y0 = Math.min(y0, y - grow);\n        if (t && tr && r) {\n            y0 = Math.min(y0, y - grow);\n            x1 = x + grow;\n        }\n        if (r) x1 = Math.max(x1, x + grow);\n        if (r && br && b) {\n            x1 = Math.max(x1, x + grow);\n            y1 = Math.max(y1, y + grow);\n        }\n        if (b) y1 = Math.max(y1, y + grow);\n        if (b && bl && l) {\n            x0 = Math.min(x0, x - grow);\n            y1 = Math.max(y1, y + grow);\n        }\n        if (!l && !tl && !t && !tr && !r && !br && !b && !bl) continue;\n        $7069db2f5e23d00f$var$fillRect(targetArr, width, Math.max(0, x0), Math.max(0, y0), Math.min(width - 1, x1), Math.min(height - 1, y1));\n    }\n    for(var i2 = 0; i2 < width * height; i2++)if (targetArr[i2] === 254) targetArr[i2] = 255;\n}\nfunction $7069db2f5e23d00f$export$13d50f258a8034f(rgbaArr, width, height, x, y, tolerance, grow, isContiguous) {\n    x = Math.round(x);\n    y = Math.round(y);\n    var resultArr = new Uint8Array(new ArrayBuffer(width * height));\n    $7069db2f5e23d00f$var$floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\n    return {\n        data: resultArr\n    };\n}\n\n});\n\nparcelRequire.register(\"3ujzu\", function(module, exports) {\n\n$parcel$export(module.exports, \"ShapeTool\", function () { return $01d7180c5d1d0fdf$export$27550cc14d7ae85a; });\n$parcel$export(module.exports, \"drawShape\", function () { return $01d7180c5d1d0fdf$export$71b514a25c47df50; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $cL71g = parcelRequire(\"cL71g\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $01d7180c5d1d0fdf$export$27550cc14d7ae85a = /*#__PURE__*/ function() {\n    \"use strict\";\n    function ShapeTool(p) {\n        (0, $cx0mh._)(this, ShapeTool);\n        this.downX = 0;\n        this.downY = 0;\n        this.downAngleRad = 0;\n        this.onShape = p.onShape;\n    }\n    (0, $7h4XF._)(ShapeTool, [\n        {\n            key: \"onDown\",\n            value: function onDown(x, y, angleRad) {\n                this.downX = x;\n                this.downY = y;\n                this.downAngleRad = angleRad;\n            }\n        },\n        {\n            key: \"onMove\",\n            value: function onMove(x, y) {\n                this.onShape(false, this.downX, this.downY, x, y, this.downAngleRad);\n            }\n        },\n        {\n            key: \"onUp\",\n            value: function onUp(x, y) {\n                this.onShape(true, this.downX, this.downY, x, y, this.downAngleRad);\n            }\n        }\n    ]);\n    return ShapeTool;\n}();\nfunction $01d7180c5d1d0fdf$export$71b514a25c47df50(ctx, shapeObj) {\n    shapeObj = (0, $cL71g._)({\n        // defaults\n        angleRad: 0,\n        isOutwards: false,\n        opacity: 1,\n        isEraser: false,\n        doLockAlpha: false\n    }, (0, $eWjiX.BB).copyObj(shapeObj));\n    if ([\n        \"rect\",\n        \"ellipse\",\n        \"line\"\n    ].includes(shapeObj.type)) {\n        if (shapeObj.angleRad === undefined) throw new Error(\"angleRad undefined\");\n        var lineWidth = shapeObj.lineWidth === undefined ? -1 : Math.round(shapeObj.lineWidth);\n        var angleDeg = shapeObj.angleRad * 180 / Math.PI;\n        // --- prep color ---\n        if (!shapeObj.isEraser && shapeObj.fillRgb === undefined && shapeObj.strokeRgb === undefined) throw new Error(\"fillRgb and strokeRgb undefined\");\n        var colorRGB = shapeObj.isEraser ? {\n            r: 255,\n            g: 255,\n            b: 255\n        } : shapeObj.fillRgb ? shapeObj.fillRgb : shapeObj.strokeRgb;\n        // --- prep canvas ---\n        ctx.save();\n        if (shapeObj.opacity) ctx.globalAlpha = shapeObj.opacity;\n        if (shapeObj.isEraser) ctx.globalCompositeOperation = \"destination-out\";\n        if (shapeObj.doLockAlpha) ctx.globalCompositeOperation = \"source-atop\";\n        ctx.rotate(-shapeObj.angleRad);\n        if (shapeObj.fillRgb) ctx.fillStyle = (0, $eWjiX.BB).ColorConverter.toRgbStr(colorRGB);\n        else if (shapeObj.strokeRgb) {\n            ctx.strokeStyle = (0, $eWjiX.BB).ColorConverter.toRgbStr(colorRGB);\n            ctx.lineWidth = lineWidth;\n        }\n        var x1 = shapeObj.x1;\n        var y1 = shapeObj.y1;\n        var x2 = shapeObj.x2;\n        var y2 = shapeObj.y2;\n        // --- angle snapping ---\n        if (shapeObj.isAngleSnap) {\n            var r1 = (0, $eWjiX.BB).rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\n            var r2 = (0, $eWjiX.BB).rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\n            var pAngleDeg = (0, $eWjiX.BB).pointsToAngleDeg(r1, r2) + 90;\n            var pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\n            var rotated = (0, $eWjiX.BB).rotateAround({\n                x: x1,\n                y: y1\n            }, {\n                x: x2,\n                y: y2\n            }, pAngleDegSnapped - pAngleDeg);\n            x2 = rotated.x;\n            y2 = rotated.y;\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) x2 = x1;\n                else y2 = y1;\n            }\n        }\n        var x = x1;\n        var y = y1;\n        var dX = x2 - x1;\n        var dY = y2 - y1;\n        // --- 1:1 ratio ---\n        if (shapeObj.type !== \"line\" && shapeObj.isFixedRatio) {\n            var r11 = (0, $eWjiX.BB).rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\n            var r21 = (0, $eWjiX.BB).rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\n            var rx = r11.x;\n            var ry = r11.y;\n            var rdX = r21.x - r11.x;\n            var rdY = r21.y - r11.y;\n            if (Math.abs(rdX) < Math.abs(rdY)) rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\n            else rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\n            r21.x = rx + rdX;\n            r21.y = ry + rdY;\n            r11 = (0, $eWjiX.BB).rotate(r11.x, r11.y, -shapeObj.angleRad / Math.PI * 180);\n            r21 = (0, $eWjiX.BB).rotate(r21.x, r21.y, -shapeObj.angleRad / Math.PI * 180);\n            x1 = r11.x;\n            y1 = r11.y;\n            x2 = r21.x;\n            y2 = r21.y;\n            x = x1;\n            y = y1;\n            dX = x2 - x1;\n            dY = y2 - y1;\n        }\n        // outwards modifier\n        if (shapeObj.isOutwards) {\n            x -= dX;\n            y -= dY;\n            dX *= 2;\n            dY *= 2;\n            x1 = x;\n            y1 = y;\n            x2 = x + dX;\n            y2 = y + dY;\n        }\n        var p1;\n        var p2;\n        if (shapeObj.type === \"line\") {\n            // rounded\n            var x1r = Math.round(x1);\n            var y1r = Math.round(y1);\n            var x2r = Math.round(x2);\n            var y2r = Math.round(y2);\n            // floored\n            var x1f = Math.floor(x1);\n            var y1f = Math.floor(y1);\n            var x2f = Math.floor(x2);\n            var y2f = Math.floor(y2);\n            if (lineWidth % 2 === 0) {\n                if (y1r === y2r) {\n                    p1 = {\n                        x: x1f,\n                        y: y1r\n                    };\n                    p2 = {\n                        x: x2f,\n                        y: y2r\n                    };\n                    if (x1f < x2f) p2.x += 1;\n                    else p1.x += 1;\n                } else if (x1r === x2r) {\n                    p1 = {\n                        x: x1r,\n                        y: y1f\n                    };\n                    p2 = {\n                        x: x2r,\n                        y: y2f\n                    };\n                    if (y1f < y2f) p2.y += 1;\n                    else p1.y += 1;\n                } else {\n                    p1 = {\n                        x: x1,\n                        y: y1\n                    };\n                    p2 = {\n                        x: x2,\n                        y: y2\n                    };\n                }\n            } else {\n                p1 = {\n                    x: x1f,\n                    y: y1f\n                };\n                p2 = {\n                    x: x2f,\n                    y: y2f\n                };\n                if (y1f === y2f) {\n                    if (x1f < x2f) p2.x += 1;\n                    else p1.x += 1;\n                    p1.y += 0.5;\n                    p2.y += 0.5;\n                } else if (x1f === x2f) {\n                    if (y1f < y2f) p2.y += 1;\n                    else p1.y += 1;\n                    p1.x += 0.5;\n                    p2.x += 0.5;\n                } else {\n                    p1.x = x1;\n                    p1.y = y1;\n                    p2.x = x2;\n                    p2.y = y2;\n                }\n            }\n            p1 = (0, $eWjiX.BB).rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\n            p2 = (0, $eWjiX.BB).rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\n            ctx.beginPath();\n            ctx.moveTo(p1.x, p1.y);\n            ctx.lineTo(p2.x, p2.y);\n            ctx.stroke();\n        } else if (shapeObj.type === \"rect\") {\n            // floored\n            var x1f1 = Math.floor(x1);\n            var y1f1 = Math.floor(y1);\n            var x2f1 = Math.floor(x2);\n            var y2f1 = Math.floor(y2);\n            if (angleDeg % 90 === 0) {\n                if (shapeObj.fillRgb) {\n                    if (x1 % 1 === 0) x1 += 1;\n                    if (y1 % 1 === 0) y1 += 1;\n                    if (x2 % 1 === 0) x2 += 1;\n                    if (y2 % 1 === 0) y2 += 1;\n                    p1 = {\n                        x: x1 < x2 ? x1f1 : x2f1,\n                        y: y1 < y2 ? y1f1 : y2f1\n                    };\n                    p2 = {\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y)\n                    };\n                    p2.x = p1.x + p2.x;\n                    p2.y = p1.y + p2.y;\n                } else if (lineWidth % 2 === 0) {\n                    p1 = {\n                        x: x1f1,\n                        y: y1f1\n                    };\n                    p2 = {\n                        x: x2f1,\n                        y: y2f1\n                    };\n                } else {\n                    p1 = {\n                        x: x1f1 + 0.5,\n                        y: y1f1 + 0.5\n                    };\n                    p2 = {\n                        x: x2f1 + 0.5,\n                        y: y2f1 + 0.5\n                    };\n                }\n            } else {\n                p1 = {\n                    x: x1,\n                    y: y1\n                };\n                p2 = {\n                    x: x2,\n                    y: y2\n                };\n            }\n            p1 = (0, $eWjiX.BB).rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\n            p2 = (0, $eWjiX.BB).rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\n            p2.x = p2.x - p1.x;\n            p2.y = p2.y - p1.y;\n            if (shapeObj.fillRgb) ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\n            else ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\n        } else {\n            p1 = (0, $eWjiX.BB).rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\n            p2 = (0, $eWjiX.BB).rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\n            x = p1.x;\n            y = p1.y;\n            dX = p2.x - p1.x;\n            dY = p2.y - p1.y;\n            ctx.beginPath();\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\n            if (shapeObj.fillRgb) ctx.fill();\n            else ctx.stroke();\n        }\n        ctx.restore();\n    } else throw new Error(\"unknown shape\");\n}\n\n});\n\nparcelRequire.register(\"h20yl\", function(module, exports) {\n\n$parcel$export(module.exports, \"renderText\", function () { return $fdc12d72a3df9be9$export$482c90f94eb9717c; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nfunction $fdc12d72a3df9be9$var$textMetricToRect(metrics, align) {\n    var _metrics_fontBoundingBoxAscent;\n    // fallback for older browsers\n    var ascent = (_metrics_fontBoundingBoxAscent = metrics.fontBoundingBoxAscent) !== null && _metrics_fontBoundingBoxAscent !== void 0 ? _metrics_fontBoundingBoxAscent : metrics.actualBoundingBoxAscent;\n    var _metrics_fontBoundingBoxDescent;\n    var descent = (_metrics_fontBoundingBoxDescent = metrics.fontBoundingBoxDescent) !== null && _metrics_fontBoundingBoxDescent !== void 0 ? _metrics_fontBoundingBoxDescent : metrics.actualBoundingBoxDescent;\n    if (align === \"left\") return {\n        x: 0,\n        y: -ascent,\n        width: metrics.width,\n        height: ascent + descent\n    };\n    if (align === \"right\") return {\n        x: -metrics.width,\n        y: -ascent,\n        width: metrics.width,\n        height: ascent + descent\n    };\n    // center\n    return {\n        x: -metrics.width / 2,\n        y: -ascent,\n        width: metrics.width,\n        height: ascent + descent\n    };\n}\nfunction $fdc12d72a3df9be9$export$482c90f94eb9717c(canvas, p) {\n    p = (0, $eWjiX.BB).copyObj(p);\n    // setup context\n    var ctx = (0, $eWjiX.BB).ctx(canvas);\n    ctx.save();\n    ctx.textAlign = p.align;\n    ctx.letterSpacing = p.letterSpacing ? p.letterSpacing + \"px\" : \"0\";\n    // font\n    var fontArr = [\n        p.size + \"px \" + (p.font ? p.font : \"sans-serif\")\n    ];\n    if (p.isBold) fontArr.unshift(\"bold\");\n    if (p.isItalic) fontArr.unshift(\"italic\");\n    ctx.font = fontArr.join(\" \");\n    // fill\n    ctx.fillStyle = p.fill ? (0, $eWjiX.BB).ColorConverter.toRgbaStr(p.fill.color) : \"transparent\";\n    // stroke\n    ctx.strokeStyle = p.stroke ? (0, $eWjiX.BB).ColorConverter.toRgbaStr(p.stroke.color) : \"transparent\";\n    if (p.stroke) {\n        ctx.lineWidth = p.stroke.lineWidth;\n        ctx.lineJoin = \"round\";\n    }\n    ctx.translate(p.x, p.y);\n    ctx.rotate(-p.angleRad);\n    var lines = p.text.split(\"\\n\").map(function(line) {\n        return line.replaceAll(\"\t\", \"    \");\n    });\n    // bounds\n    var bounds = {\n        x1: 0,\n        y1: 0,\n        x2: 0,\n        y2: 0\n    };\n    {\n        var isFirst = true;\n        lines.forEach(function(line, lineIndex) {\n            var metrics = ctx.measureText(line);\n            var x = 0;\n            var _p_lineHeight;\n            var y = p.size * ((_p_lineHeight = p.lineHeight) !== null && _p_lineHeight !== void 0 ? _p_lineHeight : 1) * lineIndex;\n            var mRect = $fdc12d72a3df9be9$var$textMetricToRect(metrics, p.align);\n            if (isFirst) {\n                isFirst = false;\n                bounds.x1 = x + mRect.x;\n                bounds.y1 = y + mRect.y;\n                bounds.x2 = x + mRect.x + mRect.width;\n                bounds.y2 = y + mRect.y + mRect.height;\n            } else {\n                bounds.x1 = Math.min(bounds.x1, x + mRect.x);\n                bounds.y1 = Math.min(bounds.y1, y + mRect.y);\n                bounds.x2 = Math.max(bounds.x2, x + mRect.x + mRect.width);\n                bounds.y2 = Math.max(bounds.y2, y + mRect.y + mRect.height);\n            }\n        });\n    }\n    // draw stroke\n    lines.forEach(function(line, lineIndex) {\n        var x = 0;\n        var _p_lineHeight;\n        var y = p.size * ((_p_lineHeight = p.lineHeight) !== null && _p_lineHeight !== void 0 ? _p_lineHeight : 1) * lineIndex;\n        ctx.strokeText(line, x, y);\n    });\n    // draw fill\n    lines.forEach(function(line, lineIndex) {\n        var x = 0;\n        var _p_lineHeight;\n        var y = p.size * ((_p_lineHeight = p.lineHeight) !== null && _p_lineHeight !== void 0 ? _p_lineHeight : 1) * lineIndex;\n        ctx.fillText(line, x, y);\n    });\n    ctx.restore();\n    return {\n        x: bounds.x1,\n        y: bounds.y1,\n        width: bounds.x2 - bounds.x1,\n        height: bounds.y2 - bounds.y1\n    };\n}\n\n});\n\nparcelRequire.register(\"aSJRf\", function(module, exports) {\n\n$parcel$export(module.exports, \"drawProject\", function () { return $089586a542a12f27$export$5f63a7b18dc4503a; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nfunction $089586a542a12f27$export$5f63a7b18dc4503a(project, factor) {\n    var resultCanvas = (0, $eWjiX.BB).canvas(Math.max(1, Math.round(project.width * factor)), Math.max(1, Math.round(project.height * factor)));\n    var ctx = (0, $eWjiX.BB).ctx(resultCanvas);\n    ctx.save();\n    if (factor > 1) ctx.imageSmoothingEnabled = false;\n    for(var i = 0; i < project.layers.length; i++){\n        var layer = project.layers[i];\n        if (!layer.isVisible || layer.opacity === 0) continue;\n        ctx.globalAlpha = layer.opacity;\n        var mixModeStr = layer.mixModeStr;\n        ctx.globalCompositeOperation = mixModeStr !== undefined ? mixModeStr : \"source-over\";\n        ctx.drawImage(layer.image, 0, 0, resultCanvas.width, resultCanvas.height);\n    }\n    ctx.restore();\n    return resultCanvas;\n}\n\n});\n\nparcelRequire.register(\"7EG77\", function(module, exports) {\n\n$parcel$export(module.exports, \"GradientTool\", function () { return $5e45fa121ba5050f$export$74d12f09ff9f1956; });\n$parcel$export(module.exports, \"drawGradient\", function () { return $5e45fa121ba5050f$export$b1f70a113e3b5c1b; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $cL71g = parcelRequire(\"cL71g\");\n\nvar $4EWN2 = parcelRequire(\"4EWN2\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $5e45fa121ba5050f$export$74d12f09ff9f1956 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function GradientTool(p) {\n        (0, $cx0mh._)(this, GradientTool);\n        this.downX = 0;\n        this.downY = 0;\n        this.downAngleRad = 0;\n        this.onGradient = p.onGradient;\n    }\n    (0, $7h4XF._)(GradientTool, [\n        {\n            key: \"onDown\",\n            value: function onDown(x, y, angleRad) {\n                this.downX = x;\n                this.downY = y;\n                this.downAngleRad = angleRad;\n            }\n        },\n        {\n            key: \"onMove\",\n            value: function onMove(x, y) {\n                this.onGradient(false, this.downX, this.downY, x, y, this.downAngleRad);\n            }\n        },\n        {\n            key: \"onUp\",\n            value: function onUp(x, y) {\n                this.onGradient(true, this.downX, this.downY, x, y, this.downAngleRad);\n            }\n        }\n    ]);\n    return GradientTool;\n}();\nfunction $5e45fa121ba5050f$export$b1f70a113e3b5c1b(ctx, gradientObj) {\n    ctx.save();\n    var x1 = gradientObj.x1;\n    var y1 = gradientObj.y1;\n    var x2 = gradientObj.x2;\n    var y2 = gradientObj.y2;\n    if (gradientObj.doSnap) {\n        var angleDeg = gradientObj.angleRad * 180 / Math.PI;\n        var r1 = (0, $eWjiX.BB).rotate(x1, y1, gradientObj.angleRad / Math.PI * 180);\n        var r2 = (0, $eWjiX.BB).rotate(x2, y2, gradientObj.angleRad / Math.PI * 180);\n        var pAngleDeg = (0, $eWjiX.BB).pointsToAngleDeg(r1, r2) + 90;\n        var pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\n        var rotated = (0, $eWjiX.BB).rotateAround({\n            x: x1,\n            y: y1\n        }, {\n            x: x2,\n            y: y2\n        }, pAngleDegSnapped - pAngleDeg);\n        x2 = rotated.x;\n        y2 = rotated.y;\n        // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\n        if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\n            if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) x2 = x1;\n            else y2 = y1;\n        }\n    }\n    var baseColor = gradientObj.color1;\n    if (gradientObj.isEraser && gradientObj.doLockAlpha) baseColor = {\n        r: 255,\n        g: 255,\n        b: 255\n    };\n    var color1 = (0, $4EWN2._)((0, $cL71g._)({}, baseColor), {\n        a: gradientObj.opacity\n    });\n    var color2 = (0, $4EWN2._)((0, $cL71g._)({}, baseColor), {\n        a: 0\n    });\n    if (gradientObj.isReversed) {\n        var temp = color1;\n        color1 = color2;\n        color2 = temp;\n    }\n    var gradient;\n    if (gradientObj.type === \"linear\") {\n        gradient = ctx.createLinearGradient(x1, y1, x2, y2);\n        gradient.addColorStop(0, (0, $eWjiX.BB).ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, (0, $eWjiX.BB).ColorConverter.toRgbaStr(color2));\n    } else if (gradientObj.type === \"linear-mirror\") {\n        var d = {\n            x: x2 - x1,\n            y: y2 - y1\n        };\n        gradient = ctx.createLinearGradient(x1 - d.x, y1 - d.y, x2, y2);\n        gradient.addColorStop(0, (0, $eWjiX.BB).ColorConverter.toRgbaStr(color2));\n        gradient.addColorStop(0.5, (0, $eWjiX.BB).ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, (0, $eWjiX.BB).ColorConverter.toRgbaStr(color2));\n    } else if (gradientObj.type === \"radial\") {\n        var r = (0, $eWjiX.BB).Vec2.dist({\n            x: x1,\n            y: y1\n        }, {\n            x: x2,\n            y: y2\n        });\n        gradient = ctx.createRadialGradient(x1, y1, 0, x1, y1, r);\n        gradient.addColorStop(0, (0, $eWjiX.BB).ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, (0, $eWjiX.BB).ColorConverter.toRgbaStr(color2));\n    }\n    ctx.fillStyle = gradient;\n    if (gradientObj.isEraser) ctx.globalCompositeOperation = \"destination-out\";\n    if (gradientObj.doLockAlpha) ctx.globalCompositeOperation = \"source-atop\";\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    ctx.restore();\n}\n\n});\n\n\nparcelRequire.register(\"bBcC4\", function(module, exports) {\n\n$parcel$export(module.exports, \"translateBlending\", function () { return $2f1281ced73ab1dc$export$6e1bedb2a6cdff30; });\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nfunction $2f1281ced73ab1dc$export$6e1bedb2a6cdff30(blendMode) {\n    if (!blendMode) return (0, $1mH1z.LANG)(\"layers-blend-normal\");\n    var codes = {\n        \"source-over\": \"layers-blend-normal\",\n        \"darken\": \"layers-blend-darken\",\n        \"multiply\": \"layers-blend-multiply\",\n        \"color-burn\": \"layers-blend-color-burn\",\n        \"lighten\": \"layers-blend-lighten\",\n        \"screen\": \"layers-blend-screen\",\n        \"color-dodge\": \"layers-blend-color-dodge\",\n        \"overlay\": \"layers-blend-overlay\",\n        \"soft-light\": \"layers-blend-soft-light\",\n        \"hard-light\": \"layers-blend-hard-light\",\n        \"difference\": \"layers-blend-difference\",\n        \"exclusion\": \"layers-blend-exclusion\",\n        \"hue\": \"layers-blend-hue\",\n        \"saturation\": \"layers-blend-saturation\",\n        \"color\": \"layers-blend-color\",\n        \"luminosity\": \"layers-blend-luminosity\"\n    };\n    if (!(blendMode in codes)) throw new Error(\"unknown blend mode\");\n    return (0, $1mH1z.LANG)(codes[blendMode]);\n}\n\n});\n\nparcelRequire.register(\"jneUH\", function(module, exports) {\n\n$parcel$export(module.exports, \"renameLayerDialog\", function () { return $f3c4df6b644f6a61$export$28debfc111084e87; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $2MaaK = parcelRequire(\"2MaaK\");\n\nvar $auzYC = parcelRequire(\"auzYC\");\nfunction $f3c4df6b644f6a61$export$28debfc111084e87(parentEl, currentName, callback) {\n    var div = (0, $eWjiX.BB).el();\n    var label = (0, $eWjiX.BB).el({\n        content: (0, $1mH1z.LANG)(\"layers-rename-name\") + \":\",\n        css: {\n            marginRight: \"5px\"\n        }\n    });\n    var row = (0, $eWjiX.BB).el({\n        css: {\n            display: \"flex\"\n        }\n    });\n    var input = (0, $eWjiX.BB).el({\n        tagName: \"input\"\n    });\n    input.value = currentName;\n    input.setAttribute(\"data-ignore-focus\", \"true\");\n    var clearBtn = (0, $eWjiX.BB).el({\n        tagName: \"button\",\n        content: '<img src=\"' + (0, (/*@__PURE__*/$parcel$interopDefault($auzYC))) + '\" height=\"20\"/>',\n        title: (0, $1mH1z.LANG)(\"layers-rename-clear\"),\n        css: {\n            marginLeft: \"10px\"\n        },\n        onClick: function() {\n            input.value = \"\";\n            input.focus();\n        }\n    });\n    var suggestions = [\n        (0, $1mH1z.LANG)(\"layers-rename-sketch\"),\n        (0, $1mH1z.LANG)(\"layers-rename-colors\"),\n        (0, $1mH1z.LANG)(\"layers-rename-shading\"),\n        (0, $1mH1z.LANG)(\"layers-rename-lines\"),\n        (0, $1mH1z.LANG)(\"layers-rename-effects\"),\n        (0, $1mH1z.LANG)(\"background\"),\n        (0, $1mH1z.LANG)(\"layers-rename-foreground\")\n    ];\n    var suggestionBtns = [];\n    var row2 = (0, $eWjiX.BB).el({\n        css: {\n            display: \"flex\",\n            flexWrap: \"wrap\",\n            marginTop: \"5px\",\n            marginLeft: \"-5px\"\n        }\n    });\n    suggestions.forEach(function(item) {\n        var btn = (0, $eWjiX.BB).el({\n            parent: row2,\n            tagName: \"button\",\n            content: item,\n            onClick: function() {\n                input.value = \"\" + btn.textContent;\n            },\n            css: {\n                margin: \"5px 0 0 5px\"\n            }\n        });\n        suggestionBtns.push(btn);\n    });\n    div.append(label);\n    label.append(row, row2);\n    row.append(input, clearBtn);\n    setTimeout(function() {\n        input.focus();\n        input.select();\n    }, 10);\n    (0, $2MaaK.showModal)({\n        target: parentEl,\n        message: \"<b>\".concat((0, $1mH1z.LANG)(\"layers-rename-title\"), \"</b>\"),\n        div: div,\n        buttons: [\n            (0, $1mH1z.LANG)(\"layers-rename\"),\n            \"Cancel\"\n        ],\n        primaries: [\n            (0, $1mH1z.LANG)(\"layers-rename\")\n        ],\n        callback: function(val) {\n            (0, $eWjiX.BB).destroyEl(clearBtn);\n            suggestionBtns.forEach(function(item) {\n                (0, $eWjiX.BB).destroyEl(item);\n            });\n            suggestionBtns.splice(0, suggestionBtns.length);\n            if (val === (0, $1mH1z.LANG)(\"layers-rename\")) callback(input.value);\n            else callback(undefined);\n        },\n        clickOnEnter: (0, $1mH1z.LANG)(\"layers-rename\")\n    });\n}\n\n});\nparcelRequire.register(\"auzYC\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"1twgF\");\n\n});\n\n\nparcelRequire.register(\"6NMo1\", function(module, exports) {\n\n$parcel$export(module.exports, \"mergeLayerDialog\", function () { return $c8f65770493ffd93$export$ee79aceabae6bb8a; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $iFIyy = parcelRequire(\"iFIyy\");\n\nvar $bBcC4 = parcelRequire(\"bBcC4\");\n\nvar $2MaaK = parcelRequire(\"2MaaK\");\n\nvar $1C8RU = parcelRequire(\"1C8RU\");\nfunction $c8f65770493ffd93$export$ee79aceabae6bb8a(parentEl, p) {\n    var updateCheckerboard = function updateCheckerboard() {\n        (0, $eWjiX.BB).createCheckerDataUrl(4, function(url) {\n            preview.style.backgroundImage = \"url(\" + url + \")\";\n        }, (0, $1C8RU.theme).isDark());\n    };\n    var div = (0, $eWjiX.BB).el();\n    div.innerHTML = (0, $1mH1z.LANG)(\"layers-merge-description\");\n    var options = new (0, $iFIyy.Options)({\n        optionArr: [\n            {\n                id: p.mixModeStr,\n                label: (0, $bBcC4.translateBlending)(p.mixModeStr)\n            },\n            {\n                id: \"source-in\",\n                label: \"source-in\"\n            },\n            {\n                id: \"source-out\",\n                label: \"source-out\"\n            },\n            {\n                id: \"source-atop\",\n                label: \"source-atop\"\n            },\n            {\n                id: \"destination-in\",\n                label: \"destination-in\"\n            },\n            {\n                id: \"destination-out\",\n                label: \"destination-out\"\n            },\n            {\n                id: \"destination-atop\",\n                label: \"destination-atop\"\n            },\n            {\n                id: \"xor\",\n                label: \"xor\"\n            }\n        ],\n        initId: p.mixModeStr,\n        onChange: function() {\n            update();\n        },\n        isSmall: true\n    });\n    options.getElement().style.marginTop = \"5px\";\n    div.append(options.getElement());\n    var thumbDimensions = (0, $eWjiX.BB).fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\n    var preview = (0, $eWjiX.BB).canvas(thumbDimensions.width, thumbDimensions.height);\n    preview.title = (0, $1mH1z.LANG)(\"preview\");\n    preview.className = \"kl-merge-preview\";\n    var spacer = (0, $eWjiX.BB).el({\n        content: \"<br/>\",\n        css: {\n            clear: \"both\"\n        }\n    });\n    div.append(spacer, preview);\n    updateCheckerboard();\n    (0, $1C8RU.theme).addIsDarkListener(updateCheckerboard);\n    var alphaCanvas = (0, $eWjiX.BB).copyCanvas(preview);\n    (0, $eWjiX.BB).ctx(alphaCanvas).drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\n    (0, $eWjiX.BB).convertToAlphaChannelCanvas(alphaCanvas);\n    var update = function() {\n        var ctx = (0, $eWjiX.BB).ctx(preview);\n        ctx.save();\n        ctx.clearRect(0, 0, preview.width, preview.height);\n        if (preview.width > p.topCanvas.width) ctx.imageSmoothingEnabled = false;\n        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\n        if (options.getValue() === \"as-alpha\") {\n            ctx.globalCompositeOperation = \"destination-in\";\n            ctx.globalAlpha = p.topOpacity;\n            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\n        } else {\n            ctx.globalCompositeOperation = options.getValue();\n            ctx.globalAlpha = p.topOpacity;\n            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\n        }\n        ctx.restore();\n    };\n    update();\n    var keyListener = new (0, $eWjiX.BB).KeyListener({\n        onDown: function(keyStr) {\n            if (keyStr === \"right\") options.next();\n            if (keyStr === \"left\") options.previous();\n        }\n    });\n    (0, $2MaaK.showModal)({\n        target: parentEl,\n        message: \"<b>\".concat((0, $1mH1z.LANG)(\"layers-merge-modal-title\"), \"</b>\"),\n        div: div,\n        buttons: [\n            \"Ok\",\n            \"Cancel\"\n        ],\n        clickOnEnter: \"Ok\",\n        callback: function(val) {\n            keyListener.destroy();\n            options.destroy();\n            (0, $1C8RU.theme).removeIsDarkListener(updateCheckerboard);\n            if (val === \"Ok\") p.callback(options.getValue());\n        }\n    });\n}\n\n});\n\nparcelRequire.register(\"hWVsV\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"70WHw\");\n\n});\n\nparcelRequire.register(\"5Ycub\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"3huo1\");\n\n});\n\nparcelRequire.register(\"jKBKm\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"1AvFX\");\n\n});\n\nparcelRequire.register(\"1Qqvs\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"ftA1L\");\n\n});\n\n\nparcelRequire.register(\"7bo3M\", function(module, exports) {\n\n$parcel$export(module.exports, \"WorkspaceSvgOverlay\", function () { return $d256278b259ca979$export$6b9252711ea5997f; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $d256278b259ca979$export$6b9252711ea5997f = /*#__PURE__*/ function() {\n    \"use strict\";\n    function WorkspaceSvgOverlay(p) {\n        (0, $cx0mh._)(this, WorkspaceSvgOverlay);\n        this.rootElement = (0, $eWjiX.BB).createSvg({\n            elementType: \"svg\",\n            width: \"\" + p.width,\n            height: \"\" + p.height\n        });\n        (0, $eWjiX.BB).css(this.rootElement, {\n            position: \"absolute\",\n            left: \"0\",\n            top: \"0\",\n            pointerEvents: \"none\",\n            userSelect: \"none\"\n        });\n        //brush circles\n        this.brushCircleOuter = (0, $eWjiX.BB).createSvg({\n            elementType: \"circle\",\n            r: \"10\",\n            stroke: \"rgba(0,0,0,0.7)\",\n            \"stroke-width\": \"1\",\n            fill: \"none\"\n        });\n        this.brushCircleInner = (0, $eWjiX.BB).createSvg({\n            elementType: \"circle\",\n            r: \"9\",\n            stroke: \"rgba(255,255,255,0.7)\",\n            \"stroke-width\": \"1\",\n            fill: \"none\"\n        });\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\n        //color picker preview circle\n        this.pickerPreviewBorder = (0, $eWjiX.BB).createSvg({\n            elementType: \"circle\",\n            r: \"47\",\n            stroke: \"black\",\n            \"stroke-width\": \"22\",\n            fill: \"none\"\n        });\n        this.pickerPreviewBorder.style.opacity = \"0\";\n        this.pickerPreviewCol = (0, $eWjiX.BB).createSvg({\n            elementType: \"circle\",\n            r: \"47\",\n            stroke: \"black\",\n            \"stroke-width\": \"20\",\n            fill: \"none\"\n        });\n        this.pickerPreviewCol.style.opacity = \"0\";\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\n        //rotation compass\n        this.compassSize = 30;\n        this.compass = (0, $eWjiX.BB).createSvg({\n            elementType: \"g\",\n            transform: \"translate(\" + p.width / 2 + \", \" + p.height / 2 + \")\"\n        });\n        (0, $eWjiX.BB).css(this.compass, {\n            transition: \"opacity 0.25s ease-in-out\",\n            opacity: \"0\"\n        });\n        this.compassInner = (0, $eWjiX.BB).createSvg({\n            elementType: \"g\",\n            transform: \"rotate(45)\"\n        });\n        this.compassBaseCircle = (0, $eWjiX.BB).createSvg({\n            elementType: \"circle\",\n            fill: \"rgba(0,0,0,0.9)\",\n            stroke: \"none\",\n            cx: \"0\",\n            cy: \"0\",\n            r: \"\" + this.compassSize\n        });\n        this.compassLineCircle = (0, $eWjiX.BB).createSvg({\n            elementType: \"circle\",\n            fill: \"none\",\n            stroke: \"rgba(255,255,255,0.75)\",\n            \"stroke-width\": \"1\",\n            cx: \"0\",\n            cy: \"0\",\n            r: \"\" + this.compassSize * 0.9\n        });\n        this.compassUpperTriangle = (0, $eWjiX.BB).createSvg({\n            elementType: \"path\",\n            fill: \"#f00\",\n            stroke: \"none\",\n            d: \"M -\" + this.compassSize * 0.25 + \",0 \" + this.compassSize * 0.25 + \",0 0,-\" + this.compassSize * 0.9 + \" z\"\n        });\n        this.compassLowerTriangle = (0, $eWjiX.BB).createSvg({\n            elementType: \"path\",\n            fill: \"#fff\",\n            stroke: \"none\",\n            d: \"M -\" + this.compassSize * 0.25 + \",0 \" + this.compassSize * 0.25 + \",0 0,\" + this.compassSize * 0.9 + \" z\"\n        });\n        this.compassInner.append(this.compassBaseCircle, this.compassLineCircle, this.compassUpperTriangle, this.compassLowerTriangle);\n        this.compass.append(this.compassInner);\n        this.rootElement.append(this.compass);\n    }\n    (0, $7h4XF._)(WorkspaceSvgOverlay, [\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootElement;\n            }\n        },\n        {\n            key: \"setSize\",\n            value: function setSize(width, height) {\n                this.rootElement.setAttribute(\"width\", \"\" + width);\n                this.rootElement.setAttribute(\"height\", \"\" + height);\n                this.compass.setAttribute(\"transform\", \"translate(\" + width / 2 + \", \" + height / 2 + \")\");\n            }\n        },\n        {\n            key: \"updateCursor\",\n            value: function updateCursor(p) {\n                if (p.x !== undefined) {\n                    this.brushCircleOuter.setAttribute(\"cx\", \"\" + p.x);\n                    this.brushCircleInner.setAttribute(\"cx\", \"\" + p.x);\n                }\n                if (p.y !== undefined) {\n                    this.brushCircleOuter.setAttribute(\"cy\", \"\" + p.y);\n                    this.brushCircleInner.setAttribute(\"cy\", \"\" + p.y);\n                }\n                if (p.radius !== undefined) {\n                    this.brushCircleOuter.setAttribute(\"r\", \"\" + Math.max(0, p.radius));\n                    this.brushCircleInner.setAttribute(\"r\", \"\" + Math.max(0, p.radius - 1));\n                }\n                if (p.isVisible !== undefined) {\n                    this.brushCircleOuter.style.opacity = p.isVisible ? \"1\" : \"0\";\n                    this.brushCircleInner.style.opacity = p.isVisible ? \"1\" : \"0\";\n                }\n            }\n        },\n        {\n            key: \"updateColorPreview\",\n            value: function updateColorPreview(p) {\n                if (p.x !== undefined) {\n                    this.pickerPreviewCol.setAttribute(\"cx\", \"\" + p.x);\n                    this.pickerPreviewBorder.setAttribute(\"cx\", \"\" + p.x);\n                }\n                if (p.y !== undefined) {\n                    this.pickerPreviewCol.setAttribute(\"cy\", \"\" + p.y);\n                    this.pickerPreviewBorder.setAttribute(\"cy\", \"\" + p.y);\n                }\n                if (p.color) {\n                    this.pickerPreviewCol.setAttribute(\"stroke\", (0, $eWjiX.BB).ColorConverter.toRgbStr(p.color));\n                    var borderColor = (0, $eWjiX.BB).testIsWhiteBestContrast(p.color) ? \"rgba(255,255,255,0.5)\" : \"rgba(0,0,0,0.5)\";\n                    this.pickerPreviewBorder.setAttribute(\"stroke\", borderColor);\n                }\n                if (p.isVisible !== undefined) {\n                    this.pickerPreviewCol.style.opacity = p.isVisible ? \"1\" : \"0\";\n                    this.pickerPreviewBorder.style.opacity = p.isVisible ? \"1\" : \"0\";\n                }\n            }\n        },\n        {\n            key: \"updateCompass\",\n            value: function updateCompass(p) {\n                if (p.angleDeg !== undefined) {\n                    this.compassInner.setAttribute(\"transform\", \"rotate(\" + p.angleDeg + \")\");\n                    this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? \"1\" : \"0\";\n                }\n                if (p.isVisible !== undefined) this.compass.style.opacity = p.isVisible ? \"1\" : \"0\";\n            }\n        }\n    ]);\n    return WorkspaceSvgOverlay;\n}();\n\n});\n\nparcelRequire.register(\"lV6Vy\", function(module, exports) {\n\n$parcel$export(module.exports, \"KlCanvasWorkspace\", function () { return $d492af58f4721011$export$6eaf6f7c0cc177fc; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $7bo3M = parcelRequire(\"7bo3M\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $eZ2aJ = parcelRequire(\"eZ2aJ\");\n\nvar $7QZIi = parcelRequire(\"7QZIi\");\n\nvar $bz6iQ = parcelRequire(\"bz6iQ\");\n\nvar $kE5UF = parcelRequire(\"kE5UF\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $dpBaO = parcelRequire(\"dpBaO\");\n\nvar $1C8RU = parcelRequire(\"1C8RU\");\n\nvar $hAS38 = parcelRequire(\"hAS38\");\nvar $d492af58f4721011$var$MIN_SCALE = 1 / 16;\nvar $d492af58f4721011$var$MAX_SCALE = Math.pow(2, 7);\nvar $d492af58f4721011$var$TMode;\n(function(TMode) {\n    TMode[TMode[\"Draw\"] = 0] = \"Draw\";\n    TMode[TMode[\"Hand\"] = 1] = \"Hand\";\n    TMode[TMode[\"HandGrabbing\"] = 2] = \"HandGrabbing\";\n    TMode[TMode[\"Pick\"] = 3] = \"Pick\";\n    TMode[TMode[\"Zoom\"] = 4] = \"Zoom\";\n    TMode[TMode[\"Rotate\"] = 5] = \"Rotate\";\n    TMode[TMode[\"Rotating\"] = 6] = \"Rotating\";\n    TMode[TMode[\"Fill\"] = 7] = \"Fill\";\n    TMode[TMode[\"Gradient\"] = 8] = \"Gradient\";\n    TMode[TMode[\"Text\"] = 9] = \"Text\";\n    TMode[TMode[\"Shape\"] = 10] = \"Shape\";\n})($d492af58f4721011$var$TMode || ($d492af58f4721011$var$TMode = {}));\nvar $d492af58f4721011$var$ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\nvar $d492af58f4721011$export$6eaf6f7c0cc177fc = /*#__PURE__*/ function() {\n    \"use strict\";\n    function KlCanvasWorkspace(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, KlCanvasWorkspace);\n        this.rootEl = (0, $eWjiX.BB).el({\n            css: {\n                position: \"absolute\",\n                left: \"0\",\n                right: \"0\",\n                top: \"0\",\n                bottom: \"0\",\n                cursor: \"crosshair\",\n                userSelect: \"none\"\n            }\n        });\n        this.klCanvas = p.klCanvas;\n        this.onViewChange = p.onViewChange;\n        this.renderTargetCanvas = (0, $eWjiX.BB).canvas(p.width, p.height);\n        this.renderTargetCtx = (0, $eWjiX.BB).ctx(this.renderTargetCanvas);\n        this.renderWidth = p.width;\n        this.renderHeight = p.height;\n        this.compositeCanvas = (0, $eWjiX.BB).canvas(1, 1); // for drawing klcanvas layer composite\n        this.compositeCtx = (0, $eWjiX.BB).ctx(this.compositeCanvas);\n        this.doResizeCanvas = false;\n        this.oldTransformObj = null;\n        this.targetTransformObj = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angle: 0\n        };\n        this.highResTransformObj = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angle: 0\n        };\n        this.renderedTransformObj = {};\n        this.cursorPos = {\n            x: 0,\n            y: 0\n        };\n        this.usesCssCursor = false;\n        this.bgVisible = true;\n        this.transformIsDirty = true;\n        this.doAnimateTranslate = true;\n        this.svgOverlay = new (0, $7bo3M.WorkspaceSvgOverlay)({\n            width: p.width,\n            height: p.height\n        });\n        (0, $eWjiX.BB).css(this.renderTargetCanvas, {\n            userSelect: \"none\",\n            pointerEvents: \"none\"\n        });\n        (0, $eWjiX.BB).createCheckerDataUrl(8, function(url) {\n            _this.renderTargetCanvas.style.background = \"url(\" + url + \")\";\n        }, (0, $1C8RU.theme).isDark());\n        (0, $1C8RU.theme).addIsDarkListener(function() {\n            _this.renderTargetCanvas.style.background = \"url(\" + (0, $eWjiX.BB).createCheckerDataUrl(8, undefined, (0, $1C8RU.theme).isDark()) + \")\";\n            _this.lastRenderedState = -1;\n            _this.reqFrame();\n        });\n        this.rootEl.append(this.renderTargetCanvas, this.svgOverlay.getElement());\n        this.rootEl.addEventListener(\"touchend\", function(e) {\n            e.preventDefault();\n            return false;\n        });\n        this.rootEl.addEventListener(\"contextmenu\", function(e) {\n            e.preventDefault();\n            return false;\n        });\n        this.rootEl.addEventListener(\"dragstart\", function(e) {\n            e.preventDefault();\n            return false;\n        });\n        this.emptyCanvas = (0, $eWjiX.BB).canvas(1, 1);\n        this.emptyLightCanvas = (0, $eWjiX.BB).canvas(1, 1);\n        {\n            var ctx = (0, $eWjiX.BB).ctx(this.emptyCanvas);\n            ctx.fillRect(0, 0, 1, 1);\n            ctx = (0, $eWjiX.BB).ctx(this.emptyLightCanvas);\n            ctx.fillStyle = \"#fff\";\n            ctx.fillRect(0, 0, 1, 1);\n        }\n        this.keyListener = new (0, $eWjiX.BB).KeyListener({\n            onDown: function(keyStr, event, comboStr, isRepeat) {\n                if ((0, $hrnUX.KL).dialogCounter.get() > 0 || (0, $eWjiX.BB).isInputFocused(true)) return;\n                if (keyStr === \"alt\") event.preventDefault();\n                if (isRepeat) return;\n                if (_this.currentInputProcessor) _this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                else {\n                    if ([\n                        $d492af58f4721011$var$TMode.Draw,\n                        $d492af58f4721011$var$TMode.Pick,\n                        $d492af58f4721011$var$TMode.Fill,\n                        $d492af58f4721011$var$TMode.Gradient,\n                        $d492af58f4721011$var$TMode.Text,\n                        $d492af58f4721011$var$TMode.Shape\n                    ].includes(_this.globalMode) && comboStr === \"space\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.spaceHand;\n                        _this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n                    if ([\n                        $d492af58f4721011$var$TMode.Draw,\n                        $d492af58f4721011$var$TMode.Hand,\n                        $d492af58f4721011$var$TMode.Fill,\n                        $d492af58f4721011$var$TMode.Gradient,\n                        $d492af58f4721011$var$TMode.Text,\n                        $d492af58f4721011$var$TMode.Shape\n                    ].includes(_this.globalMode) && comboStr === \"alt\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.altPicker;\n                        _this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n                    if ([\n                        \"r\",\n                        \"shift+r\"\n                    ].includes(comboStr)) {\n                        _this.currentInputProcessor = _this.inputProcessorObj.rotate;\n                        _this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n                    if (\"z\" === comboStr) {\n                        _this.currentInputProcessor = _this.inputProcessorObj.zoom;\n                        _this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n                }\n            },\n            onUp: function(keyStr, event, oldComboStr) {\n                // prevent menu bar in Firefox\n                if (keyStr === \"alt\") event.preventDefault();\n                if (_this.currentInputProcessor) _this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\n            }\n        });\n        this.updateChangeListener();\n        this.currentMode = $d492af58f4721011$var$TMode.Draw;\n        this.globalMode = $d492af58f4721011$var$TMode.Draw;\n        this.renderTime = 0;\n        this.lastDrawEvent = null;\n        this.linetoolProcessor = new (0, $dpBaO.LinetoolProcessor)({\n            onDraw: function(event) {\n                var getMatrix = function() {\n                    var art = _this.getRenderedTransform();\n                    var matrix = (0, $eWjiX.BB).Matrix.getIdentity();\n                    matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createScaleMatrix(1 / art.scale));\n                    matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createRotationMatrix(-art.angle));\n                    matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createTranslationMatrix(-art.x, -art.y));\n                    return matrix;\n                };\n                if (event.type === \"line\" && !_this.lastDrawEvent) {\n                    var matrix = getMatrix();\n                    var coords = [\n                        event.x1,\n                        event.y1,\n                        0,\n                        1\n                    ];\n                    coords = (0, $eWjiX.BB).Matrix.multiplyMatrixAndPoint(matrix, coords);\n                    _this.lastDrawEvent = {\n                        x: coords[0],\n                        y: coords[1],\n                        pressure: event.pressure1\n                    };\n                    return;\n                }\n                if (\"x\" in event || \"x0\" in event) {\n                    var matrix1 = getMatrix();\n                    if (\"x\" in event) {\n                        var coords1 = [\n                            event.x,\n                            event.y,\n                            0,\n                            1\n                        ];\n                        coords1 = (0, $eWjiX.BB).Matrix.multiplyMatrixAndPoint(matrix1, coords1);\n                        event.x = coords1[0];\n                        event.y = coords1[1];\n                    }\n                    if (\"x0\" in event) {\n                        event.x0 = _this.lastDrawEvent.x;\n                        event.y0 = _this.lastDrawEvent.y;\n                        event.pressure0 = _this.lastDrawEvent.pressure;\n                        var coords2 = [\n                            event.x1,\n                            event.y1,\n                            0,\n                            1\n                        ];\n                        coords2 = (0, $eWjiX.BB).Matrix.multiplyMatrixAndPoint(matrix1, coords2);\n                        event.x1 = coords2[0];\n                        event.y1 = coords2[1];\n                        _this.lastDrawEvent = {\n                            x: event.x1,\n                            y: event.y1,\n                            pressure: event.pressure1\n                        };\n                    }\n                }\n                if (event.type === \"down\" || event.type === \"move\") _this.lastDrawEvent = {\n                    x: event.x,\n                    y: event.y,\n                    pressure: event.pressure\n                };\n                p.onDraw(event);\n            }\n        });\n        this.pointer = null;\n        this.isDrawing = false;\n        this.inputProcessorObj = {\n            draw: {\n                onPointer: function(val) {\n                    _this.reqFrame();\n                    _this.updateCursor($d492af58f4721011$var$TMode.Draw);\n                    var comboStr = _this.keyListener.getComboStr();\n                    var event = {\n                        scale: _this.highResTransformObj.scale\n                    };\n                    event.shiftIsPressed = comboStr === \"shift\";\n                    event.pressure = val.pressure;\n                    event.isCoalesced = !!val.isCoalesced;\n                    if (val.type === \"pointerdown\") {\n                        _this.isDrawing = true;\n                        event.type = \"down\";\n                    } else if (val.button) event.type = \"move\";\n                    else if (val.type === \"pointerup\") {\n                        _this.isDrawing = false;\n                        event.type = \"up\";\n                        _this.linetoolProcessor.process(event);\n                        _this.resetInputProcessor();\n                        return;\n                    } else return;\n                    event.x = val.relX;\n                    event.y = val.relY;\n                    _this.linetoolProcessor.process(event);\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: function(keyStr, event, comboStr, isRepeat) {},\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: function(keyStr, event, oldComboStr) {}\n            },\n            fill: {\n                onPointer: function(event) {\n                    _this.reqFrame();\n                    _this.updateCursor($d492af58f4721011$var$TMode.Fill);\n                    if (event.type === \"pointerdown\") {\n                        var coord = _this.workspaceToCanvasCoord({\n                            x: event.relX,\n                            y: event.relY\n                        });\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\n                    } else if (event.type === \"pointerup\") {\n                        _this.resetInputProcessor();\n                        return;\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: function(keyStr, event, comboStr, isRepeat) {},\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: function(keyStr, event, oldComboStr) {}\n            },\n            gradient: {\n                onPointer: function(event) {\n                    _this.reqFrame();\n                    _this.updateCursor($d492af58f4721011$var$TMode.Gradient);\n                    var coord = _this.workspaceToCanvasCoord({\n                        x: event.relX,\n                        y: event.relY\n                    });\n                    if (event.type === \"pointerdown\") {\n                        _this.isDrawing = true;\n                        p.onGradient(\"down\", coord.x, coord.y, _this.renderedTransformObj.angle);\n                    } else if (event.type === \"pointermove\") p.onGradient(\"move\", coord.x, coord.y, _this.renderedTransformObj.angle);\n                    else if (event.type === \"pointerup\") {\n                        _this.isDrawing = false;\n                        p.onGradient(\"up\", coord.x, coord.y, _this.renderedTransformObj.angle);\n                        _this.resetInputProcessor();\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: function(keyStr, event, comboStr, isRepeat) {},\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: function(keyStr, event, oldComboStr) {}\n            },\n            text: {\n                onPointer: function(event) {\n                    _this.reqFrame();\n                    _this.updateCursor($d492af58f4721011$var$TMode.Text);\n                    if (event.type === \"pointerdown\") {\n                        var coord = _this.workspaceToCanvasCoord({\n                            x: event.relX,\n                            y: event.relY\n                        });\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), _this.renderedTransformObj.angle);\n                    } else if (event.type === \"pointerup\") {\n                        _this.resetInputProcessor();\n                        return;\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: function(keyStr, event, comboStr, isRepeat) {},\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: function(keyStr, event, oldComboStr) {}\n            },\n            shape: {\n                onPointer: function(event) {\n                    _this.reqFrame();\n                    _this.updateCursor($d492af58f4721011$var$TMode.Shape);\n                    var coord = _this.workspaceToCanvasCoord({\n                        x: event.relX,\n                        y: event.relY\n                    });\n                    if (event.type === \"pointerdown\") {\n                        _this.isDrawing = true;\n                        p.onShape(\"down\", coord.x, coord.y, _this.renderedTransformObj.angle);\n                    } else if (event.type === \"pointermove\") p.onShape(\"move\", coord.x, coord.y, _this.renderedTransformObj.angle);\n                    else if (event.type === \"pointerup\") {\n                        _this.isDrawing = false;\n                        p.onShape(\"up\", coord.x, coord.y, _this.renderedTransformObj.angle);\n                        _this.resetInputProcessor();\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: function(keyStr, event, comboStr, isRepeat) {},\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: function(keyStr, event, oldComboStr) {}\n            },\n            hand: {\n                onPointer: function(event) {\n                    _this.updateCursor($d492af58f4721011$var$TMode.Hand);\n                    if ([\n                        \"left\",\n                        \"middle\"\n                    ].includes(event.button || \"\")) {\n                        _this.updateCursor($d492af58f4721011$var$TMode.HandGrabbing);\n                        _this.targetTransformObj.x += event.dX;\n                        _this.targetTransformObj.y += event.dY;\n                        _this.highResTransformObj = (0, $eWjiX.BB).copyObj(_this.targetTransformObj);\n                        _this.doAnimateTranslate = false;\n                        _this.transformIsDirty = true;\n                        _this.reqFrame(true);\n                    } else if (event.type === \"pointerup\") _this.resetInputProcessor();\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: function(keyStr, event, comboStr, isRepeat) {},\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: function(keyStr, event, oldComboStr) {}\n            },\n            spaceHand: {\n                onPointer: function(event) {\n                    _this.updateCursor($d492af58f4721011$var$TMode.Hand);\n                    if ([\n                        \"left\",\n                        \"middle\"\n                    ].includes(event.button || \"\")) {\n                        _this.updateCursor($d492af58f4721011$var$TMode.HandGrabbing);\n                        _this.targetTransformObj.x += event.dX;\n                        _this.targetTransformObj.y += event.dY;\n                        _this.highResTransformObj = (0, $eWjiX.BB).copyObj(_this.targetTransformObj);\n                        _this.doAnimateTranslate = false;\n                        _this.transformIsDirty = true;\n                        _this.reqFrame(true);\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: function(keyStr, event, comboStr, isRepeat) {\n                    if (comboStr !== \"space\") _this.resetInputProcessor();\n                    else _this.updateCursor($d492af58f4721011$var$TMode.Hand);\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: function(keyStr, event, oldComboStr) {\n                    _this.resetInputProcessor();\n                }\n            },\n            zoom: {\n                onPointer: function(event) {\n                    _this.updateCursor($d492af58f4721011$var$TMode.Zoom);\n                    if (event.button === \"left\" && !event.isCoalesced && event.dX != 0) {\n                        var offsetX = event.pageX - event.relX;\n                        var offsetY = event.pageY - event.relY;\n                        _this.internalZoomByStep(event.dX / 175, event.downPageX - offsetX, event.downPageY - offsetY);\n                        _this.highResTransformObj = (0, $eWjiX.BB).copyObj(_this.targetTransformObj);\n                        _this.lastRenderedState = -1;\n                        _this.reqFrame();\n                        _this.onViewChange({\n                            changed: [\n                                \"scale\"\n                            ],\n                            angle: _this.targetTransformObj.angle,\n                            scale: _this.targetTransformObj.scale\n                        });\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: function(keyStr, event, comboStr, isRepeat) {\n                    if (comboStr !== \"z\") _this.resetInputProcessor();\n                    else _this.updateCursor($d492af58f4721011$var$TMode.Zoom);\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: function(keyStr, event, oldComboStr) {\n                    _this.resetInputProcessor();\n                }\n            },\n            picker: {\n                onPointer: function(event) {\n                    _this.updateCursor($d492af58f4721011$var$TMode.Pick);\n                    if ([\n                        \"left\",\n                        \"right\"\n                    ].includes(event.button || \"\") && !event.isCoalesced || event.type === \"pointerup\") {\n                        var coord = _this.workspaceToCanvasCoord({\n                            x: event.relX,\n                            y: event.relY\n                        });\n                        var pickedColor = _this.klCanvas.getColorAt(coord.x, coord.y);\n                        p.onPick(pickedColor, event.type === \"pointerup\");\n                        _this.svgOverlay.updateColorPreview({\n                            x: event.relX,\n                            y: event.relY,\n                            color: pickedColor,\n                            isVisible: event.type !== \"pointerup\"\n                        });\n                        if (event.type === \"pointerup\") _this.resetInputProcessor();\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: function(keyStr, event, comboStr, isRepeat) {},\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: function(keyStr, event, oldComboStr) {}\n            },\n            altPicker: {\n                onPointer: function(event) {\n                    _this.updateCursor($d492af58f4721011$var$TMode.Pick);\n                    if ([\n                        \"left\",\n                        \"right\"\n                    ].includes(event.button || \"\") && !event.isCoalesced || event.type === \"pointerup\") {\n                        var coord = _this.workspaceToCanvasCoord({\n                            x: event.relX,\n                            y: event.relY\n                        });\n                        var pickedColor = _this.klCanvas.getColorAt(coord.x, coord.y);\n                        p.onPick(pickedColor, event.type === \"pointerup\");\n                        _this.svgOverlay.updateColorPreview({\n                            x: event.relX,\n                            y: event.relY,\n                            color: pickedColor,\n                            isVisible: event.type !== \"pointerup\"\n                        });\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: function(keyStr, event, comboStr, isRepeat) {\n                    if (comboStr !== \"alt\") _this.resetInputProcessor();\n                    else _this.updateCursor($d492af58f4721011$var$TMode.Pick);\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: function(keyStr, event, oldComboStr) {\n                    _this.resetInputProcessor();\n                }\n            },\n            rotate: {\n                onPointer: function(event) {\n                    _this.updateCursor(event.button === \"left\" ? $d492af58f4721011$var$TMode.Rotating : $d492af58f4721011$var$TMode.Rotate);\n                    if (event.type === \"pointerdown\" && event.button === \"left\") _this.oldTransformObj = (0, $eWjiX.BB).copyObj(_this.targetTransformObj);\n                    else if (event.button === \"left\" && !event.isCoalesced && _this.oldTransformObj) {\n                        var offsetX = event.pageX - event.relX;\n                        var offsetY = event.pageY - event.relY;\n                        //rotation done around center\n                        var centerObj = {\n                            x: _this.renderWidth / 2,\n                            y: _this.renderHeight / 2\n                        };\n                        var startAngleRad = (0, $eWjiX.BB).Vec2.angle(centerObj, {\n                            x: event.downPageX - offsetX,\n                            y: event.downPageY - offsetY\n                        });\n                        var angleRad = (0, $eWjiX.BB).Vec2.angle(centerObj, {\n                            x: event.pageX - offsetX,\n                            y: event.pageY - offsetY\n                        });\n                        var dAngleRad = angleRad - startAngleRad;\n                        //apply angle\n                        _this.targetTransformObj = (0, $eWjiX.BB).copyObj(_this.oldTransformObj);\n                        _this.targetTransformObj.angle += dAngleRad;\n                        if (_this.keyListener.isPressed(\"shift\")) {\n                            _this.targetTransformObj.angle = Math.round(_this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\n                            dAngleRad = _this.targetTransformObj.angle - _this.oldTransformObj.angle;\n                        }\n                        _this.targetTransformObj.angle = _this.minimizeAngleRad(_this.targetTransformObj.angle);\n                        //rotate transform.xy\n                        var matrix = (0, $eWjiX.BB).Matrix.getIdentity();\n                        matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\n                        matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createRotationMatrix(dAngleRad));\n                        matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\n                        var origin = [\n                            _this.targetTransformObj.x,\n                            _this.targetTransformObj.y,\n                            0,\n                            1\n                        ];\n                        origin = (0, $eWjiX.BB).Matrix.multiplyMatrixAndPoint(matrix, origin);\n                        _this.targetTransformObj.x = origin[0];\n                        _this.targetTransformObj.y = origin[1];\n                        _this.highResTransformObj = (0, $eWjiX.BB).copyObj(_this.targetTransformObj);\n                        _this.transformIsDirty = true;\n                        _this.lastRenderedState = -1;\n                        _this.reqFrame();\n                        _this.onViewChange({\n                            changed: [\n                                \"angle\"\n                            ],\n                            scale: _this.targetTransformObj.scale,\n                            angle: _this.targetTransformObj.angle\n                        });\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: function(keyStr, event, comboStr, isRepeat) {\n                    if ([\n                        \"r\",\n                        \"r+shift\",\n                        \"shift+r\",\n                        \"r+left\",\n                        \"r+right\",\n                        \"r+left+right\",\n                        \"r+right+left\",\n                        \"r+up\"\n                    ].includes(comboStr)) _this.updateCursor($d492af58f4721011$var$TMode.Rotate);\n                    else _this.resetInputProcessor();\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: function(keyStr, event, oldComboStr) {\n                    var comboStr = _this.keyListener.getComboStr();\n                    if ([\n                        \"r\",\n                        \"r+shift\",\n                        \"shift+r\",\n                        \"r+left\",\n                        \"r+right\",\n                        \"r+left+right\",\n                        \"r+right+left\",\n                        \"r+up\"\n                    ].includes(comboStr)) _this.updateCursor($d492af58f4721011$var$TMode.Rotate);\n                    else _this.resetInputProcessor();\n                }\n            }\n        };\n        this.currentInputProcessor = null;\n        this.angleIsExtraSticky = false;\n        this.pinchZoomer = new (0, $eWjiX.BB).PinchZoomer({\n            onPinch: function(event) {\n                if (event.type === \"move\") {\n                    if (!_this.oldTransformObj) {\n                        _this.oldTransformObj = (0, $eWjiX.BB).copyObj(_this.targetTransformObj);\n                        _this.angleIsExtraSticky = _this.targetTransformObj.angle % (Math.PI / 2) === 0;\n                    }\n                    _this.targetTransformObj = (0, $eWjiX.BB).copyObj(_this.oldTransformObj);\n                    event.scale = Math.max($d492af58f4721011$var$MIN_SCALE, Math.min($d492af58f4721011$var$MAX_SCALE, _this.targetTransformObj.scale * event.scale)) / _this.targetTransformObj.scale;\n                    _this.targetTransformObj.scale *= event.scale;\n                    _this.targetTransformObj.angle += event.angleRad;\n                    _this.targetTransformObj.angle = _this.minimizeAngleRad(_this.snapAngleRad(_this.targetTransformObj.angle, 90, _this.angleIsExtraSticky ? 12 : 4));\n                    if (_this.targetTransformObj.angle % (Math.PI / 2) !== 0) _this.angleIsExtraSticky = false;\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\n                    event.angleRad = _this.targetTransformObj.angle - _this.oldTransformObj.angle;\n                    //calc translation\n                    {\n                        var matrix = (0, $eWjiX.BB).Matrix.getIdentity();\n                        matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createTranslationMatrix(event.relX, event.relY));\n                        matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createScaleMatrix(event.scale));\n                        matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createRotationMatrix(event.angleRad));\n                        matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createTranslationMatrix(-event.relX, -event.relY));\n                        matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\n                        var origin = [\n                            _this.targetTransformObj.x,\n                            _this.targetTransformObj.y,\n                            0,\n                            1\n                        ];\n                        origin = (0, $eWjiX.BB).Matrix.multiplyMatrixAndPoint(matrix, origin);\n                        _this.targetTransformObj.x = origin[0];\n                        _this.targetTransformObj.y = origin[1];\n                    }\n                    _this.highResTransformObj = (0, $eWjiX.BB).copyObj(_this.targetTransformObj);\n                    //if (event.scale !== 1) {\n                    _this.onViewChange({\n                        changed: [\n                            \"scale\",\n                            \"angle\"\n                        ],\n                        scale: _this.targetTransformObj.scale,\n                        angle: _this.targetTransformObj.angle\n                    });\n                    //}\n                    _this.reqFrame();\n                    _this.transformIsDirty = true;\n                    _this.lastRenderedState = -1;\n                } else if (event.type === \"end\") _this.oldTransformObj = null;\n            }\n        });\n        var onDoubleTap = function(event) {\n            if (_this.fitView(true)) {\n                _this.lastRenderedState = -1;\n                _this.reqFrame();\n            } else {\n                // zoom 2 steps further\n                var didZoom = _this.internalZoomByStep(2, event.relX, event.relY);\n                if (didZoom) _this.onViewChange({\n                    changed: [\n                        \"scale\"\n                    ],\n                    angle: _this.targetTransformObj.angle,\n                    scale: _this.targetTransformObj.scale\n                });\n                //updateCursor(TMode.Draw, true);\n                _this.lastRenderedState = -1;\n            }\n        };\n        this.mainDoubleTapper = new (0, $eWjiX.BB).DoubleTapper({\n            onDoubleTap: onDoubleTap\n        });\n        this.middleDoubleTapper = new (0, $eWjiX.BB).DoubleTapper({\n            onDoubleTap: onDoubleTap\n        });\n        this.middleDoubleTapper.setAllowedButtonArr([\n            \"middle\"\n        ]);\n        this.twoFingerTap = new (0, $eWjiX.BB).NFingerTapper({\n            fingers: 2,\n            onTap: function() {\n                p.onUndo();\n            }\n        });\n        this.threeFingerTap = new (0, $eWjiX.BB).NFingerTapper({\n            fingers: 3,\n            onTap: function() {\n                p.onRedo();\n            }\n        });\n        this.pointerEventChain = new (0, $eWjiX.BB).EventChain({\n            chainArr: [\n                this.twoFingerTap,\n                this.threeFingerTap,\n                this.mainDoubleTapper,\n                this.middleDoubleTapper,\n                this.pinchZoomer,\n                new (0, $eWjiX.BB).OnePointerLimiter(),\n                new (0, $eWjiX.BB).CoalescedExploder()\n            ]\n        });\n        this.pointerEventChain.setChainOut(function(event) {\n            _this.cursorPos.x = event.relX;\n            _this.cursorPos.y = event.relY;\n            if (event.type === \"pointerup\" && event.pointerType === \"touch\") {\n                _this.pointer = null;\n                _this.lastRenderedState = -1;\n                _this.reqFrame();\n            } else {\n                if (!_this.pointer) _this.pointer = {\n                    x: 0,\n                    y: 0\n                };\n                _this.pointer.x = event.relX;\n                _this.pointer.y = event.relY;\n            }\n            if (_this.currentInputProcessor) _this.currentInputProcessor.onPointer(event);\n            else {\n                var comboStr = _this.keyListener.getComboStr();\n                if (_this.globalMode === $d492af58f4721011$var$TMode.Draw) {\n                    if ([\n                        \"\",\n                        \"shift\",\n                        \"ctrl\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"left\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.draw;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"right\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.picker;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"middle\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.hand;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else {\n                        _this.updateCursor($d492af58f4721011$var$TMode.Draw);\n                        _this.reqFrame();\n                    }\n                } else if (_this.globalMode === $d492af58f4721011$var$TMode.Hand) {\n                    if (event.type === \"pointerdown\" && [\n                        \"left\",\n                        \"middle\"\n                    ].includes(event.button || \"\")) {\n                        _this.currentInputProcessor = _this.inputProcessorObj.hand;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"right\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.picker;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else _this.updateCursor($d492af58f4721011$var$TMode.Hand);\n                } else if (_this.globalMode === $d492af58f4721011$var$TMode.Pick) {\n                    if (event.type === \"pointerdown\" && [\n                        \"left\",\n                        \"right\"\n                    ].includes(event.button || \"\")) {\n                        _this.currentInputProcessor = _this.inputProcessorObj.picker;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"middle\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.hand;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else _this.updateCursor($d492af58f4721011$var$TMode.Pick);\n                } else if (_this.globalMode === $d492af58f4721011$var$TMode.Fill) {\n                    if (event.type === \"pointerdown\" && event.button === \"left\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.fill;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"right\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.picker;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"middle\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.hand;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else {\n                        _this.updateCursor($d492af58f4721011$var$TMode.Fill);\n                        _this.reqFrame();\n                    }\n                } else if (_this.globalMode === $d492af58f4721011$var$TMode.Gradient) {\n                    if ([\n                        \"\",\n                        \"shift\",\n                        \"ctrl\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"left\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.gradient;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"right\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.picker;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"middle\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.hand;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else {\n                        _this.updateCursor($d492af58f4721011$var$TMode.Gradient);\n                        _this.reqFrame();\n                    }\n                } else if (_this.globalMode === $d492af58f4721011$var$TMode.Text) {\n                    if (event.type === \"pointerdown\" && event.button === \"left\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.text;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"right\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.picker;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"middle\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.hand;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else {\n                        _this.updateCursor($d492af58f4721011$var$TMode.Text);\n                        _this.reqFrame();\n                    }\n                } else if (_this.globalMode === $d492af58f4721011$var$TMode.Shape) {\n                    if ([\n                        \"\",\n                        \"shift\",\n                        \"ctrl\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"left\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.shape;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"right\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.picker;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"middle\") {\n                        _this.currentInputProcessor = _this.inputProcessorObj.hand;\n                        _this.currentInputProcessor.onPointer(event);\n                    } else {\n                        _this.updateCursor($d492af58f4721011$var$TMode.Shape);\n                        _this.reqFrame();\n                    }\n                }\n            }\n        });\n        //prevent ctrl scroll -> zooming page\n        this.rootEl.addEventListener(\"wheel\", function(event) {\n            event.preventDefault();\n        });\n        setTimeout(function() {\n            _this.pointerListener = new (0, $eWjiX.BB).PointerListener({\n                target: _this.rootEl,\n                fixScribble: true,\n                onPointer: function(e) {\n                    if (e.type === \"pointerdown\" && e.button === \"middle\") try {\n                        e.eventPreventDefault();\n                    } catch (e) {\n                    /* empty */ }\n                    // prevent manual slider input keeping focus on iPad\n                    if (e.type === \"pointerdown\") (0, $eWjiX.BB).unfocusAnyInput();\n                    /*if (e.type === 'pointermove') {\r\n                        BB.throwOut(JSON.stringify(e));\r\n                    }*/ _this.pointerEventChain.chainIn(e);\n                },\n                onWheel: function(wheelEvent) {\n                    if (_this.isDrawing) return;\n                    _this.reqFrame();\n                    var didZoom = _this.internalZoomByStep(-wheelEvent.deltaY / (_this.keyListener.isPressed(\"shift\") ? 8 : 2), wheelEvent.relX, wheelEvent.relY);\n                    if (didZoom) _this.onViewChange({\n                        changed: [\n                            \"scale\"\n                        ],\n                        angle: _this.targetTransformObj.angle,\n                        scale: _this.targetTransformObj.scale\n                    });\n                    //updateCursor(TMode.Draw, true);\n                    _this.lastRenderedState = -1;\n                },\n                onEnterLeave: function(isOver) {\n                    if (!isOver) {\n                        if (!_this.isDrawing) {\n                            _this.pointer = null;\n                            _this.lastRenderedState = -1;\n                        }\n                    }\n                },\n                maxPointers: 4\n            });\n        }, 1);\n        this.brushRadius = 1;\n        this.animationFrameRequested = false;\n        //setup rendering\n        this.lastRenderedState = -2;\n        this.lastRenderTime = performance.now();\n        window.requestAnimationFrame(function() {\n            return _this.updateLoop();\n        });\n        this.resetOrFitView();\n    }\n    (0, $7h4XF._)(KlCanvasWorkspace, [\n        {\n            key: \"getRenderedTransform\",\n            value: function getRenderedTransform() {\n                // rounded x & y so canvas is less blurry.\n                var result = this.renderedTransformObj;\n                result.x = this.highResTransformObj.x;\n                result.y = this.highResTransformObj.y;\n                result.scale = this.highResTransformObj.scale;\n                result.angle = this.highResTransformObj.angle;\n                if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\n                    result.x = Math.round(result.x);\n                    result.y = Math.round(result.y);\n                }\n                return result;\n            }\n        },\n        {\n            key: \"updateChangeListener\",\n            value: function updateChangeListener() {\n                var _this = this;\n                this.klCanvas.addChangeListener(function() {\n                    _this.lastRenderedState = -1;\n                    _this.reqFrame();\n                });\n            }\n        },\n        {\n            key: \"updateCursor\",\n            value: function updateCursor(modeInt, doForce) {\n                if (modeInt === this.currentMode && !doForce) return;\n                var oldMode = this.currentMode;\n                this.currentMode = modeInt;\n                this.lastRenderedState = -1;\n                if (this.currentMode === $d492af58f4721011$var$TMode.Draw) this.rootEl.style.cursor = \"crosshair\";\n                else if (this.currentMode === $d492af58f4721011$var$TMode.Hand) this.rootEl.style.cursor = \"grab\";\n                else if (this.currentMode === $d492af58f4721011$var$TMode.HandGrabbing) this.rootEl.style.cursor = \"grabbing\";\n                else if (this.currentMode === $d492af58f4721011$var$TMode.Pick) this.rootEl.style.cursor = \"url('\" + (0, (/*@__PURE__*/$parcel$interopDefault($eZ2aJ))) + \"') 0 15, crosshair\";\n                else if (this.currentMode === $d492af58f4721011$var$TMode.Zoom) this.rootEl.style.cursor = \"url('\" + (0, (/*@__PURE__*/$parcel$interopDefault($7QZIi))) + \"') 7 7, zoom-in\";\n                else if (this.currentMode === $d492af58f4721011$var$TMode.Rotate) this.rootEl.style.cursor = \"grab\";\n                else if (this.currentMode === $d492af58f4721011$var$TMode.Rotating) this.rootEl.style.cursor = \"grabbing\";\n                else if (this.currentMode === $d492af58f4721011$var$TMode.Fill) this.rootEl.style.cursor = \"url('\" + (0, (/*@__PURE__*/$parcel$interopDefault($bz6iQ))) + \"') 1 12, crosshair\";\n                else if (this.currentMode === $d492af58f4721011$var$TMode.Gradient) this.rootEl.style.cursor = \"crosshair\";\n                else if (this.currentMode === $d492af58f4721011$var$TMode.Text) this.rootEl.style.cursor = \"url('\" + (0, (/*@__PURE__*/$parcel$interopDefault($kE5UF))) + \"') 1 12, crosshair\";\n                else if (this.currentMode === $d492af58f4721011$var$TMode.Shape) this.rootEl.style.cursor = \"crosshair\";\n                if ([\n                    $d492af58f4721011$var$TMode.Draw,\n                    $d492af58f4721011$var$TMode.Pick,\n                    $d492af58f4721011$var$TMode.Fill,\n                    $d492af58f4721011$var$TMode.Text,\n                    $d492af58f4721011$var$TMode.Shape\n                ].includes(this.globalMode)) {\n                    var oldIsHand = [\n                        $d492af58f4721011$var$TMode.Hand,\n                        $d492af58f4721011$var$TMode.HandGrabbing\n                    ].includes(oldMode);\n                    var currentIsHand = [\n                        $d492af58f4721011$var$TMode.Hand,\n                        $d492af58f4721011$var$TMode.HandGrabbing\n                    ].includes(this.currentMode);\n                    if (!oldIsHand && currentIsHand) this.mainDoubleTapper.setAllowedPointerTypeArr([\n                        \"mouse\",\n                        \"pen\",\n                        \"touch\"\n                    ]);\n                    if (oldIsHand && !currentIsHand) this.mainDoubleTapper.setAllowedPointerTypeArr([\n                        \"touch\"\n                    ]);\n                }\n                if (this.currentMode !== $d492af58f4721011$var$TMode.Pick) this.svgOverlay.updateColorPreview({\n                    isVisible: false\n                });\n            }\n        },\n        {\n            key: \"internalZoomByStep\",\n            value: /**\r\n     * returns false if no change of zoom\r\n     * @param stepNum\r\n     * @param centerX\r\n     * @param centerY\r\n     * @private\r\n     */ function internalZoomByStep(stepNum, centerX, centerY) {\n                var step = Math.log2(this.targetTransformObj.scale);\n                var newStep = step / Math.abs(stepNum);\n                newStep += stepNum > 0 ? 1 : -1;\n                newStep = Math.round(newStep);\n                newStep *= Math.abs(stepNum);\n                var newScale = Math.max($d492af58f4721011$var$MIN_SCALE, Math.min($d492af58f4721011$var$MAX_SCALE, Math.pow(2, newStep)));\n                //has zoomed?\n                if (newScale === this.targetTransformObj.scale) return false;\n                var effectiveFactor = newScale / this.targetTransformObj.scale;\n                this.targetTransformObj.scale = newScale;\n                var matrix = (0, $eWjiX.BB).Matrix.getIdentity();\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createTranslationMatrix(centerX, centerY));\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createScaleMatrix(effectiveFactor));\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createTranslationMatrix(-centerX, -centerY));\n                var origin = [\n                    this.targetTransformObj.x,\n                    this.targetTransformObj.y,\n                    0,\n                    1\n                ];\n                origin = (0, $eWjiX.BB).Matrix.multiplyMatrixAndPoint(matrix, origin);\n                this.targetTransformObj.x = origin[0];\n                this.targetTransformObj.y = origin[1];\n                this.transformIsDirty = true;\n                return true;\n            }\n        },\n        {\n            key: \"mixTransformObj\",\n            value: /**\r\n     * mixes two transform objects. modifies A\r\n     * @param transformA\r\n     * @param transformB\r\n     * @param blendFactor 0 -> A, 1 -> B\r\n     * @private\r\n     */ function mixTransformObj(transformA, transformB, blendFactor) {\n                if (transformA.angle === transformB.angle) {\n                    transformA.scale = (0, $eWjiX.BB).mix(transformA.scale, transformB.scale, blendFactor);\n                    transformA.x = (0, $eWjiX.BB).mix(transformA.x, transformB.x, blendFactor);\n                    transformA.y = (0, $eWjiX.BB).mix(transformA.y, transformB.y, blendFactor);\n                    transformA.angle = (0, $eWjiX.BB).mix(transformA.angle, transformB.angle, blendFactor);\n                    return;\n                }\n                var w = this.klCanvas.getWidth();\n                var h = this.klCanvas.getHeight();\n                // --- determine centerPosA, centerPosB ---\n                var centerPosA = this.canvasToWorkspaceCoord({\n                    x: w / 2,\n                    y: h / 2\n                }, transformA);\n                var centerPosB = this.canvasToWorkspaceCoord({\n                    x: w / 2,\n                    y: h / 2\n                }, transformB);\n                // --- centerPosMixed ---\n                transformA.x = (0, $eWjiX.BB).mix(centerPosA.x, centerPosB.x, blendFactor);\n                transformA.y = (0, $eWjiX.BB).mix(centerPosA.y, centerPosB.y, blendFactor);\n                // --- scale and angle ---\n                transformA.scale = (0, $eWjiX.BB).mix(transformA.scale, transformB.scale, blendFactor);\n                transformA.angle = (0, $eWjiX.BB).mix(transformA.angle, transformB.angle, blendFactor);\n                // --- x and y ---\n                var mixedPos = this.canvasToWorkspaceCoord({\n                    x: -w / 2,\n                    y: -h / 2\n                }, transformA);\n                transformA.x = mixedPos.x;\n                transformA.y = mixedPos.y;\n            }\n        },\n        {\n            key: \"render\",\n            value: function render() {\n                if (this.doResizeCanvas) {\n                    this.doResizeCanvas = false;\n                    this.renderTargetCanvas.width = this.renderWidth;\n                    this.renderTargetCanvas.height = this.renderHeight;\n                }\n                this.renderContext(this.renderTargetCtx);\n            }\n        },\n        {\n            key: \"testBgVisible\",\n            value: /**\r\n     * is the gray background that surrounds canvas visible?\r\n     * @private\r\n     */ function testBgVisible() {\n                //bring workspace points (corners of workspace) into canvas coordinate system\n                //then check if any corner point is outside of the canvas -> that means the bg is visible\n                var workspacePointArr = [\n                    [\n                        0,\n                        0\n                    ],\n                    [\n                        this.renderWidth,\n                        0\n                    ],\n                    [\n                        this.renderWidth,\n                        this.renderHeight\n                    ],\n                    [\n                        0,\n                        this.renderHeight\n                    ]\n                ];\n                var art = this.getRenderedTransform();\n                //setup transformation matrix\n                var matrix = (0, $eWjiX.BB).Matrix.getIdentity();\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createScaleMatrix(1 / art.scale));\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createRotationMatrix(-art.angle));\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createTranslationMatrix(-art.x, -art.y));\n                //transform points, then test if outside of canvas\n                for(var i = 0; i < workspacePointArr.length; i++){\n                    var coords = [\n                        workspacePointArr[i][0],\n                        workspacePointArr[i][1],\n                        0,\n                        1\n                    ];\n                    coords = (0, $eWjiX.BB).Matrix.multiplyMatrixAndPoint(matrix, coords);\n                    if (!(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() && 0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())) //if not inside -> bg visible\n                    return true;\n                }\n                return false;\n            }\n        },\n        {\n            key: \"renderContext\",\n            value: function renderContext(ctx) {\n                var w = this.klCanvas.getWidth();\n                var h = this.klCanvas.getHeight();\n                var art = this.getRenderedTransform();\n                var isDark = (0, $1C8RU.theme).isDark();\n                if (art.scale >= 4 || art.scale === 1 && art.angle === 0) ctx.imageSmoothingEnabled = false;\n                else {\n                    ctx.imageSmoothingEnabled = true;\n                    ctx.imageSmoothingQuality = \"low\"; // art.scale >= 1 ? 'low' : 'medium';\n                }\n                //ctx.imageSmoothingEnabled = false;\n                //renderTargetCtx.globalCompositeOperation  = 'multiply';\n                ctx.save();\n                {\n                    if (this.bgVisible) {\n                        ctx.fillStyle = isDark ? \"rgb(33, 33, 33)\" : \"rgb(158,158,158)\"; // 'rgb(185,185,185)';\n                        ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\n                    } else ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\n                    if (this.bgVisible) {\n                        ctx.save();\n                        ctx.translate(art.x, art.y);\n                        ctx.scale(art.scale, art.scale);\n                        ctx.rotate(art.angle);\n                        ctx.imageSmoothingEnabled = false;\n                        //outline\n                        var borderSize = 1;\n                        ctx.globalAlpha = isDark ? 0.25 : 0.2;\n                        ctx.drawImage(isDark ? this.emptyLightCanvas : this.emptyCanvas, -borderSize / art.scale, -borderSize / art.scale, w + borderSize * 2 / art.scale, h + borderSize * 2 / art.scale);\n                        ctx.globalAlpha = 1;\n                        //erase\n                        ctx.globalCompositeOperation = \"destination-out\";\n                        ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\n                        ctx.restore();\n                    }\n                    /*const region = new Path2D();\r\n            region.rect(80, 10, 20, 130);\r\n            ctx.clip(region);*/ ctx.translate(art.x, art.y);\n                    ctx.scale(art.scale, art.scale);\n                    ctx.rotate(art.angle);\n                    var layerArr = this.klCanvas.getLayersFast();\n                    for(var i = 0; i < layerArr.length; i++){\n                        if (!layerArr[i].isVisible || layerArr[i].opacity === 0) continue;\n                        ctx.globalAlpha = layerArr[i].opacity;\n                        ctx.globalCompositeOperation = layerArr[i].mixModeStr;\n                        var compositeObj = layerArr[i].canvas.compositeObj;\n                        if (compositeObj) {\n                            if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\n                                this.compositeCanvas.width = layerArr[i].canvas.width;\n                                this.compositeCanvas.height = layerArr[i].canvas.height;\n                            } else this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\n                            this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\n                            compositeObj.draw(this.compositeCtx);\n                            ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\n                        } else ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\n                    }\n                    ctx.globalAlpha = 1;\n                }\n                ctx.restore();\n                // rotation hud\n                if ($d492af58f4721011$var$TMode.Rotate === this.currentMode || $d492af58f4721011$var$TMode.Rotating === this.currentMode) this.svgOverlay.updateCompass({\n                    isVisible: true,\n                    angleDeg: art.angle / Math.PI * 180\n                });\n                else this.svgOverlay.updateCompass({\n                    isVisible: false\n                });\n            }\n        },\n        {\n            key: \"workspaceToCanvasCoord\",\n            value: function workspaceToCanvasCoord(p) {\n                var art = this.getRenderedTransform();\n                var matrix = (0, $eWjiX.BB).Matrix.getIdentity();\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createScaleMatrix(1 / art.scale));\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createRotationMatrix(-art.angle));\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createTranslationMatrix(-art.x, -art.y));\n                var coords = [\n                    p.x,\n                    p.y,\n                    0,\n                    1\n                ];\n                coords = (0, $eWjiX.BB).Matrix.multiplyMatrixAndPoint(matrix, coords);\n                return {\n                    x: coords[0],\n                    y: coords[1]\n                };\n            }\n        },\n        {\n            key: \"canvasToWorkspaceCoord\",\n            value: function canvasToWorkspaceCoord(p, transformObj) {\n                var matrix = (0, $eWjiX.BB).Matrix.getIdentity();\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createRotationMatrix(transformObj.angle));\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createScaleMatrix(transformObj.scale));\n                var coords = [\n                    p.x,\n                    p.y,\n                    0,\n                    1\n                ];\n                coords = (0, $eWjiX.BB).Matrix.multiplyMatrixAndPoint(matrix, coords);\n                return {\n                    x: coords[0],\n                    y: coords[1]\n                };\n            }\n        },\n        {\n            key: \"snapAngleRad\",\n            value: function snapAngleRad(angleRad, snapDegIncrement, maxDistDeg) {\n                var angleDeg = angleRad * 180 / Math.PI;\n                var modDeg = Math.abs(angleDeg % snapDegIncrement);\n                var dist = Math.min(modDeg, snapDegIncrement - modDeg);\n                if (dist <= maxDistDeg) angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\n                return angleDeg / 180 * Math.PI;\n            }\n        },\n        {\n            key: \"minimizeAngleRad\",\n            value: /**\r\n     * angle always in range [-PI, PI]\r\n     * @param angleRad\r\n     * @private\r\n     */ function minimizeAngleRad(angleRad) {\n                angleRad = angleRad % (2 * Math.PI);\n                if (angleRad > Math.PI) angleRad -= 2 * Math.PI;\n                else if (angleRad < -Math.PI) angleRad += 2 * Math.PI;\n                return angleRad;\n            }\n        },\n        {\n            key: \"resetInputProcessor\",\n            value: function resetInputProcessor() {\n                this.currentInputProcessor = null;\n                this.updateCursor(this.globalMode);\n                this.reqFrame(true);\n            }\n        },\n        {\n            key: \"reqFrame\",\n            value: function reqFrame(doRedrawCanvas) {\n                this.animationFrameRequested = true;\n                if (doRedrawCanvas) this.lastRenderedState = -1;\n            }\n        },\n        {\n            key: \"updateLoop\",\n            value: function updateLoop() {\n                var _this = this;\n                window.requestAnimationFrame(function() {\n                    return _this.updateLoop();\n                });\n                var newState = (0, $gWfkn.klHistory).getState();\n                var doRender = this.lastRenderedState < newState;\n                //handle variable framerate\n                var nowTime = performance.now();\n                var elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\n                this.lastRenderTime = nowTime;\n                if (this.animationFrameRequested || doRender) {\n                    this.animationFrameRequested = false;\n                    this.checkChange(elapsedFrames);\n                }\n            }\n        },\n        {\n            key: \"checkChange\",\n            value: function checkChange(elapsedFrames) {\n                var newState = (0, $gWfkn.klHistory).getState();\n                var doRender = this.lastRenderedState < newState || this.highResTransformObj.scale !== this.targetTransformObj.scale || this.highResTransformObj.x !== this.targetTransformObj.x || this.highResTransformObj.y !== this.targetTransformObj.y;\n                //update transform\n                if (!this.doAnimateTranslate && (this.highResTransformObj.scale === this.targetTransformObj.scale || Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale)) {\n                    this.highResTransformObj.scale = this.targetTransformObj.scale;\n                    this.highResTransformObj.x = this.targetTransformObj.x;\n                    this.highResTransformObj.y = this.targetTransformObj.y;\n                    this.highResTransformObj.angle = this.targetTransformObj.angle;\n                    if (this.transformIsDirty) {\n                        this.transformIsDirty = false;\n                        this.bgVisible = this.testBgVisible();\n                    }\n                    this.svgOverlay.updateCursor({\n                        radius: this.brushRadius * this.highResTransformObj.scale\n                    });\n                } else if ((this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) && (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) && (this.highResTransformObj.scale === this.targetTransformObj.scale || Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale)) {\n                    this.highResTransformObj.scale = this.targetTransformObj.scale;\n                    this.highResTransformObj.x = this.targetTransformObj.x;\n                    this.highResTransformObj.y = this.targetTransformObj.y;\n                    this.highResTransformObj.angle = this.targetTransformObj.angle;\n                    this.doAnimateTranslate = false;\n                    if (this.transformIsDirty) {\n                        this.transformIsDirty = false;\n                        this.bgVisible = this.testBgVisible();\n                    }\n                    this.svgOverlay.updateCursor({\n                        radius: this.brushRadius * this.highResTransformObj.scale\n                    });\n                } else {\n                    this.reqFrame(); //probably needs another frame\n                    var blendFactor = Math.min(1, $d492af58f4721011$var$ANIMATION_SPEED * elapsedFrames);\n                    this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\n                    this.bgVisible = true; // spare yourself the calculation\n                    this.svgOverlay.updateCursor({\n                        radius: this.brushRadius * this.highResTransformObj.scale\n                    });\n                }\n                if (this.pointer && this.currentMode == $d492af58f4721011$var$TMode.Draw && !this.usesCssCursor) this.svgOverlay.updateCursor({\n                    x: this.pointer.x,\n                    y: this.pointer.y,\n                    isVisible: true\n                });\n                else this.svgOverlay.updateCursor({\n                    isVisible: false\n                });\n                if (doRender) {\n                    //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\n                    this.lastRenderedState = newState;\n                    var start = performance.now();\n                    this.render();\n                    this.renderTime = (0, $eWjiX.BB).mix(this.renderTime, performance.now() - start, 0.05);\n                }\n                doRender;\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"setCanvas\",\n            value: function setCanvas(klC) {\n                this.klCanvas = klC;\n                this.lastDrawEvent = null;\n                this.resetView();\n                this.updateChangeListener();\n                this.lastRenderedState = -1;\n                this.reqFrame();\n            }\n        },\n        {\n            /**\r\n     * set size of workspace area in pixels\r\n     * @param width\r\n     * @param height\r\n     */ key: \"setSize\",\n            value: function setSize(width, height) {\n                var oldWidth = this.renderWidth;\n                var oldHeight = this.renderHeight;\n                if (width === oldWidth && height === oldHeight) return;\n                this.doResizeCanvas = true;\n                this.renderWidth = width;\n                this.renderHeight = height;\n                this.svgOverlay.setSize(width, height);\n                this.targetTransformObj.x += (width - oldWidth) / 2;\n                this.targetTransformObj.y += (height - oldHeight) / 2;\n                this.highResTransformObj.x = this.targetTransformObj.x;\n                this.highResTransformObj.y = this.targetTransformObj.y;\n                this.bgVisible = this.testBgVisible();\n                this.lastRenderedState = -1;\n                this.reqFrame();\n            }\n        },\n        {\n            key: \"setMode\",\n            value: function setMode(modeStr) {\n                //only sets the base mode\n                if (modeStr === \"draw\") {\n                    this.globalMode = $d492af58f4721011$var$TMode.Draw;\n                    this.mainDoubleTapper.setAllowedPointerTypeArr([\n                        \"touch\"\n                    ]);\n                }\n                if (modeStr === \"fill\") {\n                    this.globalMode = $d492af58f4721011$var$TMode.Fill;\n                    this.mainDoubleTapper.setAllowedPointerTypeArr([\n                        \"touch\"\n                    ]);\n                }\n                if (modeStr === \"gradient\") {\n                    this.globalMode = $d492af58f4721011$var$TMode.Gradient;\n                    this.mainDoubleTapper.setAllowedPointerTypeArr([\n                        \"touch\"\n                    ]);\n                }\n                if (modeStr === \"text\") {\n                    this.globalMode = $d492af58f4721011$var$TMode.Text;\n                    this.mainDoubleTapper.setAllowedPointerTypeArr([\n                        \"touch\"\n                    ]);\n                }\n                if (modeStr === \"shape\") {\n                    this.globalMode = $d492af58f4721011$var$TMode.Shape;\n                    this.mainDoubleTapper.setAllowedPointerTypeArr([\n                        \"touch\"\n                    ]);\n                }\n                if (modeStr === \"hand\") {\n                    this.globalMode = $d492af58f4721011$var$TMode.Hand;\n                    this.mainDoubleTapper.setAllowedPointerTypeArr([\n                        \"mouse\",\n                        \"pen\",\n                        \"touch\"\n                    ]);\n                }\n                if (modeStr === \"pick\") {\n                    this.globalMode = $d492af58f4721011$var$TMode.Pick;\n                    this.mainDoubleTapper.setAllowedPointerTypeArr([\n                        \"touch\"\n                    ]);\n                }\n            }\n        },\n        {\n            key: \"getMode\",\n            value: function getMode() {\n                if (this.globalMode === $d492af58f4721011$var$TMode.Draw) return \"draw\";\n                if (this.globalMode === $d492af58f4721011$var$TMode.Fill) return \"fill\";\n                if (this.globalMode === $d492af58f4721011$var$TMode.Gradient) return \"gradient\";\n                if (this.globalMode === $d492af58f4721011$var$TMode.Text) return \"text\";\n                if (this.globalMode === $d492af58f4721011$var$TMode.Shape) return \"shape\";\n                if (this.globalMode === $d492af58f4721011$var$TMode.Hand) return \"hand\";\n                if (this.globalMode === $d492af58f4721011$var$TMode.Pick) return \"pick\";\n                throw new Error(\"unknown globalMode\");\n            }\n        },\n        {\n            key: \"setCursorSize\",\n            value: function setCursorSize(diameter) {\n                var _this = this;\n                this.brushRadius = diameter / 2;\n                this.svgOverlay.updateCursor({\n                    radius: this.brushRadius * this.highResTransformObj.scale\n                });\n                if (this.pointer === null) {\n                    this.hideBrushCursorTimeout && clearTimeout(this.hideBrushCursorTimeout);\n                    this.svgOverlay.updateCursor({\n                        x: this.renderWidth / 2,\n                        y: this.renderHeight / 2,\n                        isVisible: true\n                    });\n                    this.hideBrushCursorTimeout = setTimeout(function() {\n                        if (_this.pointer !== null) return;\n                        _this.svgOverlay.updateCursor({\n                            isVisible: false\n                        });\n                    }, 500);\n                }\n            }\n        },\n        {\n            key: \"zoomByStep\",\n            value: function zoomByStep(stepNum) {\n                if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) return;\n                this.lastRenderedState = -1;\n                this.reqFrame();\n                this.onViewChange({\n                    changed: [\n                        \"scale\"\n                    ],\n                    angle: this.targetTransformObj.angle,\n                    scale: this.targetTransformObj.scale\n                });\n            }\n        },\n        {\n            key: \"resetView\",\n            value: function resetView(doAnimate) {\n                this.targetTransformObj.scale = 1;\n                this.targetTransformObj.angle = 0;\n                this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\n                this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\n                if (doAnimate) {\n                    this.doAnimateTranslate = true;\n                    this.transformIsDirty = true;\n                } else this.highResTransformObj = (0, $eWjiX.BB).copyObj(this.targetTransformObj);\n                this.bgVisible = this.testBgVisible();\n                this.reqFrame();\n                if (doAnimate) this.onViewChange({\n                    changed: [\n                        \"scale\",\n                        \"angle\"\n                    ],\n                    scale: this.targetTransformObj.scale,\n                    angle: this.targetTransformObj.angle\n                });\n            }\n        },\n        {\n            /**\r\n     * fit into view. center. snap angle. padding\r\n     * returns true if transform changes\r\n     */ key: \"fitView\",\n            value: function fitView(doAnimate) {\n                // determine new transform\n                var newAngle = this.snapAngleRad(this.targetTransformObj.angle, 90, 90);\n                //calc width and height of bounds\n                var canvasPointsArr = [\n                    [\n                        0,\n                        0\n                    ],\n                    [\n                        this.klCanvas.getWidth(),\n                        0\n                    ],\n                    [\n                        this.klCanvas.getWidth(),\n                        this.klCanvas.getHeight()\n                    ],\n                    [\n                        0,\n                        this.klCanvas.getHeight()\n                    ],\n                    [\n                        this.klCanvas.getWidth() / 2,\n                        this.klCanvas.getHeight() / 2\n                    ]\n                ];\n                //setup transformation matrix\n                var matrix = (0, $eWjiX.BB).Matrix.getIdentity();\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createRotationMatrix(newAngle));\n                //rotate points\n                for(var i = 0; i < canvasPointsArr.length; i++){\n                    var coords = [\n                        canvasPointsArr[i][0],\n                        canvasPointsArr[i][1],\n                        0,\n                        1\n                    ];\n                    coords = (0, $eWjiX.BB).Matrix.multiplyMatrixAndPoint(matrix, coords);\n                    canvasPointsArr[i][0] = coords[0];\n                    canvasPointsArr[i][1] = coords[1];\n                }\n                var boundsObj = {};\n                for(var i1 = 0; i1 < canvasPointsArr.length; i1++){\n                    if (boundsObj.x1 === undefined || canvasPointsArr[i1][0] < boundsObj.x1) boundsObj.x1 = canvasPointsArr[i1][0];\n                    if (boundsObj.y1 === undefined || canvasPointsArr[i1][1] < boundsObj.y1) boundsObj.y1 = canvasPointsArr[i1][1];\n                    if (boundsObj.x2 === undefined || canvasPointsArr[i1][0] > boundsObj.x2) boundsObj.x2 = canvasPointsArr[i1][0];\n                    if (boundsObj.y2 === undefined || canvasPointsArr[i1][1] > boundsObj.y2) boundsObj.y2 = canvasPointsArr[i1][1];\n                }\n                var boundsWidth = boundsObj.x2 - boundsObj.x1;\n                var boundsHeight = boundsObj.y2 - boundsObj.y1;\n                //fit bounds\n                var padding = 0;\n                var _BB_fitInto = (0, $eWjiX.BB).fitInto(boundsWidth, boundsHeight, this.renderWidth - padding, this.renderHeight - padding, 1), fitWidth = _BB_fitInto.width;\n                //determine scale\n                var factor = Math.min($d492af58f4721011$var$MAX_SCALE, fitWidth / boundsWidth);\n                var newTargetTransformObj = {\n                    angle: newAngle,\n                    x: this.renderWidth / 2 - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor,\n                    y: this.renderHeight / 2 - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor,\n                    scale: factor\n                };\n                if (newTargetTransformObj.angle === this.targetTransformObj.angle && Math.abs(newTargetTransformObj.x - this.targetTransformObj.x) < 0.0000000001 && Math.abs(newTargetTransformObj.y - this.targetTransformObj.y) < 0.0000000001 && newTargetTransformObj.scale === this.targetTransformObj.scale) return false;\n                this.targetTransformObj = newTargetTransformObj;\n                if (doAnimate) this.doAnimateTranslate = true;\n                else this.highResTransformObj = (0, $eWjiX.BB).copyObj(this.targetTransformObj);\n                this.transformIsDirty = true;\n                this.reqFrame();\n                if (doAnimate) this.onViewChange({\n                    changed: [\n                        \"scale\",\n                        \"angle\"\n                    ],\n                    scale: this.targetTransformObj.scale,\n                    angle: this.targetTransformObj.angle\n                });\n                return true;\n            }\n        },\n        {\n            /**\r\n     * let the workspace decide what is best. E.g. if it's pixel art, Fit might be better.\r\n     */ key: \"resetOrFitView\",\n            value: function resetOrFitView() {\n                var threshold = 4; // >= 400% zoom. pixelated, not blurry\n                if (!(0, $hAS38.klConfig).disableAutoFit && this.klCanvas.getWidth() <= this.renderWidth / threshold && this.klCanvas.getHeight() <= this.renderHeight / threshold) this.fitView();\n                else this.resetView();\n            }\n        },\n        {\n            key: \"setAngle\",\n            value: function setAngle(angleDeg, isRelative) {\n                //rotation done around center\n                var centerObj = {\n                    x: this.renderWidth / 2,\n                    y: this.renderHeight / 2\n                };\n                var oldAngleRad = this.targetTransformObj.angle;\n                var angleRad = angleDeg / 180 * Math.PI;\n                if (isRelative) this.targetTransformObj.angle += angleRad;\n                else this.targetTransformObj.angle = angleRad;\n                this.targetTransformObj.angle = this.minimizeAngleRad(this.snapAngleRad(this.targetTransformObj.angle, 90, 4));\n                //rotate transform.xy\n                var matrix = (0, $eWjiX.BB).Matrix.getIdentity();\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\n                matrix = (0, $eWjiX.BB).Matrix.multiplyMatrices(matrix, (0, $eWjiX.BB).Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\n                var origin = [\n                    this.targetTransformObj.x,\n                    this.targetTransformObj.y,\n                    0,\n                    1\n                ];\n                origin = (0, $eWjiX.BB).Matrix.multiplyMatrixAndPoint(matrix, origin);\n                this.targetTransformObj.x = origin[0];\n                this.targetTransformObj.y = origin[1];\n                this.highResTransformObj = (0, $eWjiX.BB).copyObj(this.targetTransformObj);\n                this.transformIsDirty = true;\n                this.reqFrame(true);\n            }\n        },\n        {\n            /**\r\n     * translate canvas by viewport pixels\r\n     * @param tx\r\n     * @param ty\r\n     */ key: \"translateView\",\n            value: function translateView(tx, ty) {\n                var scale = 40;\n                this.targetTransformObj.x += tx * scale;\n                this.targetTransformObj.y += ty * scale;\n                this.transformIsDirty = true;\n                this.doAnimateTranslate = true;\n                this.reqFrame(true);\n            }\n        },\n        {\n            key: \"getIsDrawing\",\n            value: function getIsDrawing() {\n                return this.isDrawing;\n            }\n        },\n        {\n            key: \"getScale\",\n            value: function getScale() {\n                return this.targetTransformObj.scale;\n            }\n        },\n        {\n            key: \"getAngleDeg\",\n            value: function getAngleDeg() {\n                return this.targetTransformObj.angle * 180 / Math.PI;\n            }\n        },\n        {\n            key: \"getMaxScale\",\n            value: function getMaxScale() {\n                return $d492af58f4721011$var$MAX_SCALE;\n            }\n        },\n        {\n            key: \"getMinScale\",\n            value: function getMinScale() {\n                return $d492af58f4721011$var$MIN_SCALE;\n            }\n        },\n        {\n            key: \"requestFrame\",\n            value: function requestFrame() {\n                this.lastRenderedState = -1;\n                this.reqFrame();\n            }\n        },\n        {\n            key: \"setLastDrawEvent\",\n            value: function setLastDrawEvent(x, y, pressure) {\n                if (x === undefined) {\n                    this.lastDrawEvent = null;\n                    return;\n                }\n                if (!this.lastDrawEvent) this.lastDrawEvent = {\n                    x: 0,\n                    y: 0,\n                    pressure: 0\n                };\n                this.lastDrawEvent.x = x;\n                this.lastDrawEvent.y = y;\n                this.lastDrawEvent.pressure = pressure;\n            }\n        }\n    ]);\n    return KlCanvasWorkspace;\n}();\n\n});\nparcelRequire.register(\"eZ2aJ\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"ayl5b\");\n\n});\n\nparcelRequire.register(\"7QZIi\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"8Sx0P\");\n\n});\n\nparcelRequire.register(\"bz6iQ\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"ixtEz\");\n\n});\n\nparcelRequire.register(\"kE5UF\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"3iHbP\");\n\n});\n\nparcelRequire.register(\"dpBaO\", function(module, exports) {\n\n$parcel$export(module.exports, \"LinetoolProcessor\", function () { return $7752bf3fb7f240e9$export$d429e21f52463d17; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $7752bf3fb7f240e9$var$DIR_X = 0;\nvar $7752bf3fb7f240e9$var$DIR_Y = 1;\nvar $7752bf3fb7f240e9$export$d429e21f52463d17 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function LinetoolProcessor(p) {\n        (0, $cx0mh._)(this, LinetoolProcessor);\n        this.downEvent = null;\n        this.eventQueue = [];\n        this.direction = null;\n        this.onDraw = p.onDraw;\n    }\n    (0, $7h4XF._)(LinetoolProcessor, [\n        {\n            key: \"process\",\n            value: function process(event) {\n                if (event.type === \"down\") {\n                    this.downEvent = event;\n                    this.direction = null;\n                    if (event.shiftIsPressed) {\n                        this.onDraw({\n                            type: \"line\",\n                            x0: null,\n                            y0: null,\n                            pressure0: null,\n                            x1: event.x,\n                            y1: event.y,\n                            pressure1: event.pressure\n                        });\n                        this.eventQueue.push(event);\n                        return;\n                    }\n                }\n                if (event.type === \"move\" && this.downEvent) {\n                    if (event.shiftIsPressed) {\n                        if (this.direction === null) {\n                            var dX = Math.abs(event.x - this.downEvent.x);\n                            var dY = Math.abs(event.y - this.downEvent.y);\n                            if (dX > 5 || dY > 5) {\n                                this.direction = dX > dY ? $7752bf3fb7f240e9$var$DIR_X : $7752bf3fb7f240e9$var$DIR_Y;\n                                for(var i = 0; i < this.eventQueue.length; i++){\n                                    var e = this.eventQueue[i];\n                                    if (e.type !== \"up\") {\n                                        if (this.direction === $7752bf3fb7f240e9$var$DIR_X) e.y = this.downEvent.y;\n                                        else e.x = this.downEvent.x;\n                                    }\n                                    this.onDraw((0, $eWjiX.BB).copyObj(e));\n                                }\n                                this.eventQueue = [];\n                            }\n                        }\n                        if (this.direction === null) {\n                            this.eventQueue.push(event);\n                            return;\n                        }\n                        if (this.direction === $7752bf3fb7f240e9$var$DIR_X) event.y = this.downEvent.y;\n                        else event.x = this.downEvent.x;\n                    } else if (this.eventQueue.length > 0) {\n                        for(var i1 = 0; i1 < this.eventQueue.length; i1++)this.onDraw((0, $eWjiX.BB).copyObj(this.eventQueue[i1]));\n                        this.eventQueue = [];\n                    }\n                }\n                if (event.type === \"up\") {\n                    this.eventQueue = [];\n                    this.downEvent = null;\n                }\n                this.onDraw((0, $eWjiX.BB).copyObj(event));\n            }\n        }\n    ]);\n    return LinetoolProcessor;\n}();\n\n});\n\nparcelRequire.register(\"hAS38\", function(module, exports) {\n\n$parcel$export(module.exports, \"klConfig\", function () { return $da1a7600c10c1784$export$4d6077ff8d823dfb; });\nvar $da1a7600c10c1784$export$4d6077ff8d823dfb = {\n    filenameBase: \"Klecks\"\n};\n\n});\n\n\nparcelRequire.register(\"i5nyl\", function(module, exports) {\n\n$parcel$export(module.exports, \"KlCanvasPreview\", function () { return $6faa9d948ec87f40$export$e258ade1648009b7; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1C8RU = parcelRequire(\"1C8RU\");\nvar $6faa9d948ec87f40$export$e258ade1648009b7 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function KlCanvasPreview(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, KlCanvasPreview);\n        this.layers = p.layers;\n        var scale = p.width / p.layers[0].image.width;\n        var width = scale > 1 ? p.layers[0].image.width : p.width;\n        var height = scale > 1 ? p.layers[0].image.height : p.height;\n        this.canvas = (0, $eWjiX.BB).canvas(width, height);\n        this.updateCheckerboard = function() {\n            _this.canvas.style.backgroundImage = \"url(\" + (0, $eWjiX.BB).createCheckerDataUrl(8, undefined, (0, $1C8RU.theme).isDark()) + \")\";\n        };\n        this.updateCheckerboard();\n        this.ctx = (0, $eWjiX.BB).ctx(this.canvas);\n        (0, $eWjiX.BB).css(this.canvas, {\n            width: \"100%\",\n            height: \"100%\",\n            imageRendering: scale > 1 ? \"pixelated\" : undefined\n        });\n        setTimeout(function() {\n            return _this.render();\n        }, 0);\n        (0, $1C8RU.theme).addIsDarkListener(this.updateCheckerboard);\n    }\n    (0, $7h4XF._)(KlCanvasPreview, [\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.canvas;\n            }\n        },\n        {\n            key: \"render\",\n            value: function render() {\n                if (!this.ctx) return;\n                this.ctx.save();\n                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n                for(var i = 0; i < this.layers.length; i++){\n                    var layer = this.layers[i];\n                    if (!layer.isVisible || layer.opacity === 0) continue;\n                    this.ctx.globalAlpha = this.layers[i].opacity;\n                    this.ctx.globalCompositeOperation = this.layers[i].mixModeStr;\n                    if (this.canvas.width > this.layers[i].image.width) this.ctx.imageSmoothingEnabled = false;\n                    this.ctx.drawImage(this.layers[i].image, 0, 0, this.canvas.width, this.canvas.height);\n                }\n                this.ctx.restore();\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                (0, $1C8RU.theme).removeIsDarkListener(this.updateCheckerboard);\n            }\n        }\n    ]);\n    return KlCanvasPreview;\n}();\n\n});\n\nparcelRequire.register(\"cNhNm\", function(module, exports) {\n\n$parcel$export(module.exports, \"FreeTransform\", function () { return $0370167ee97a20d9$export$79a74567acf241b0; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $5cYet = parcelRequire(\"5cYet\");\n\nvar $lt7cS = parcelRequire(\"lt7cS\");\nvar $0370167ee97a20d9$export$79a74567acf241b0 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function FreeTransform(params) {\n        var _this = this;\n        (0, $cx0mh._)(this, FreeTransform);\n        var resetRemainder = function resetRemainder() {\n            pointerRemainder.x = 0;\n            pointerRemainder.y = 0;\n        };\n        this.scaled = {\n            x: 0,\n            y: 0,\n            width: 0,\n            height: 0,\n            corners: [\n                {\n                    x: 0,\n                    y: 0\n                }\n            ]\n        };\n        this.minSnapDist = 7 // minimal snapping distance in px screen space\n        ;\n        this.cornerCursors = [\n            \"nw\",\n            \"n\",\n            \"ne\",\n            \"e\",\n            \"se\",\n            \"s\",\n            \"sw\",\n            \"w\"\n        ];\n        this.gripSize = 14;\n        this.edgeSize = 10;\n        this.corners = [];\n        this.edges = [];\n        this.transform = {\n            x: params.x,\n            y: params.y,\n            width: params.width,\n            height: params.height,\n            angleDeg: params.angleDeg\n        };\n        this.isConstrained = params.isConstrained;\n        this.snapX = params.snapX;\n        this.snapY = params.snapY;\n        this.callback = params.callback;\n        this.scale = params.scale;\n        this.snappingEnabled = true;\n        this.ratio = this.transform.width / this.transform.height;\n        this.rootEl = (0, $eWjiX.BB).el({\n            className: \"kl-free-transform\",\n            css: {\n                userSelect: \"none\"\n            }\n        });\n        this.transEl = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                position: \"absolute\"\n            }\n        });\n        this.boundsEl = (0, $eWjiX.BB).el({\n            css: {\n                position: \"absolute\",\n                cursor: \"move\",\n                boxShadow: \"rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px\"\n            }\n        });\n        var pointerRemainder = {\n            x: 0,\n            y: 0\n        };\n        this.keyListener = new (0, $eWjiX.BB).KeyListener({});\n        var boundsStartP = {\n            x: 0,\n            y: 0\n        };\n        this.boundsPointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.boundsEl,\n            fixScribble: true,\n            onPointer: function(event) {\n                event.eventPreventDefault();\n                if (event.type === \"pointerdown\") boundsStartP = {\n                    x: _this.transform.x,\n                    y: _this.transform.y\n                };\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    _this.transform.x = boundsStartP.x + (event.pageX - event.downPageX) / _this.scale;\n                    _this.transform.y = boundsStartP.y + (event.pageY - event.downPageY) / _this.scale;\n                    var dist;\n                    var snap = {\n                        distX: -1,\n                        distY: -1\n                    };\n                    if (_this.snappingEnabled) {\n                        var i;\n                        for(i = 0; i < _this.snapX.length; i++){\n                            dist = Math.abs(_this.transform.x - _this.snapX[i]);\n                            if (dist < _this.minSnapDist / _this.scale) {\n                                if (snap.x === undefined || dist < snap.distX) {\n                                    snap.x = _this.snapX[i];\n                                    snap.distX = dist;\n                                }\n                            }\n                        }\n                        for(i = 0; i < _this.snapY.length; i++){\n                            dist = Math.abs(_this.transform.y - _this.snapY[i]);\n                            if (dist < _this.minSnapDist / _this.scale) {\n                                if (snap.y === undefined || dist < snap.distY) {\n                                    snap.y = _this.snapY[i];\n                                    snap.distY = dist;\n                                }\n                            }\n                        }\n                        var iP;\n                        for(i = 0; i < 4; i++){\n                            iP = (0, $lt7cS.toImageSpace)(_this.corners[i].x, _this.corners[i].y, _this.transform);\n                            var j = void 0;\n                            for(j = 0; j < _this.snapX.length; j++){\n                                dist = Math.abs(iP.x - _this.snapX[j]);\n                                if (dist < _this.minSnapDist / _this.scale) {\n                                    if (snap.x === undefined || dist < snap.distX) {\n                                        snap.x = _this.snapX[j] - (iP.x - _this.transform.x);\n                                        snap.distX = dist;\n                                    }\n                                }\n                            }\n                            for(j = 0; j < _this.snapY.length; j++){\n                                dist = Math.abs(iP.y - _this.snapY[j]);\n                                if (dist < _this.minSnapDist / _this.scale) {\n                                    if (snap.y === undefined || dist < snap.distY) {\n                                        snap.y = _this.snapY[j] - (iP.y - _this.transform.y);\n                                        snap.distY = dist;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    if (_this.keyListener.getComboStr() === \"shift\") {\n                        var projected = (0, $eWjiX.BB).projectPointOnLine({\n                            x: 0,\n                            y: boundsStartP.y\n                        }, {\n                            x: 10,\n                            y: boundsStartP.y\n                        }, {\n                            x: _this.transform.x,\n                            y: _this.transform.y\n                        });\n                        var dist1 = (0, $eWjiX.BB).dist(projected.x, projected.y, _this.transform.x, _this.transform.y);\n                        snap = {\n                            x: projected.x,\n                            y: projected.y,\n                            distX: dist1,\n                            distY: dist1\n                        };\n                        projected = (0, $eWjiX.BB).projectPointOnLine({\n                            x: boundsStartP.x,\n                            y: 0\n                        }, {\n                            x: boundsStartP.x,\n                            y: 10\n                        }, {\n                            x: _this.transform.x,\n                            y: _this.transform.y\n                        });\n                        dist1 = (0, $eWjiX.BB).dist(projected.x, projected.y, _this.transform.x, _this.transform.y);\n                        if (dist1 < snap.distX) snap = {\n                            x: projected.x,\n                            y: projected.y,\n                            distX: dist1,\n                            distY: dist1\n                        };\n                        projected = (0, $eWjiX.BB).projectPointOnLine({\n                            x: boundsStartP.x,\n                            y: boundsStartP.y\n                        }, {\n                            x: boundsStartP.x + 1,\n                            y: boundsStartP.y + 1\n                        }, {\n                            x: _this.transform.x,\n                            y: _this.transform.y\n                        });\n                        dist1 = (0, $eWjiX.BB).dist(projected.x, projected.y, _this.transform.x, _this.transform.y);\n                        if (dist1 < snap.distX) snap = {\n                            x: projected.x,\n                            y: projected.y,\n                            distX: dist1,\n                            distY: dist1\n                        };\n                        projected = (0, $eWjiX.BB).projectPointOnLine({\n                            x: boundsStartP.x,\n                            y: boundsStartP.y\n                        }, {\n                            x: boundsStartP.x + 1,\n                            y: boundsStartP.y - 1\n                        }, {\n                            x: _this.transform.x,\n                            y: _this.transform.y\n                        });\n                        dist1 = (0, $eWjiX.BB).dist(projected.x, projected.y, _this.transform.x, _this.transform.y);\n                        if (dist1 < snap.distX) snap = {\n                            x: projected.x,\n                            y: projected.y,\n                            distX: dist1,\n                            distY: dist1\n                        };\n                    }\n                    if (snap.x != undefined) _this.transform.x = snap.x;\n                    if (snap.y != undefined) _this.transform.y = snap.y;\n                    // snap to pixels\n                    if (Math.abs(_this.transform.angleDeg) % 90 === 0) {\n                        (0, $lt7cS.snapToPixel)(_this.transform);\n                        _this.updateCornerPositions();\n                    }\n                    _this.updateDOM();\n                }\n            }\n        });\n        for(var i = 0; i < 4; i++)(function(i) {\n            var g = _this.corners[i] = {\n                i: i,\n                el: (0, $eWjiX.BB).el({\n                    css: {\n                        width: _this.gripSize + \"px\",\n                        height: _this.gripSize + \"px\",\n                        background: \"#fff\",\n                        /*background: [\r\n                                '#ff0000',\r\n                                '#00ff00',\r\n                                '#0000ff',\r\n                                '#ff00ff',\r\n                            ][i],*/ borderRadius: _this.gripSize + \"px\",\n                        position: \"absolute\",\n                        boxShadow: \"inset 0 0 0 2px #000\"\n                    }\n                }),\n                x: 0,\n                y: 0,\n                virtualPos: {\n                    x: 0,\n                    y: 0\n                }\n            };\n            g.updateDOM = function() {\n                // grip position\n                // if it gets small: slightly offset grips, so easier to handle\n                var offsetArr = [\n                    [\n                        -1,\n                        -1\n                    ],\n                    [\n                        1,\n                        -1\n                    ],\n                    [\n                        1,\n                        1\n                    ],\n                    [\n                        -1,\n                        1\n                    ]\n                ].map(function(item) {\n                    item[0] *= _this.transform.width > 0 ? 1 : -1;\n                    item[1] *= _this.transform.height > 0 ? 1 : -1;\n                    return item;\n                });\n                var tinyOffset = Math.abs(_this.scaled.width) < 20 || Math.abs(_this.scaled.height) < 20 ? 10 : 0;\n                (0, $eWjiX.BB).css(g.el, {\n                    left: _this.scaled.corners[g.i].x - _this.gripSize / 2 + offsetArr[i][0] * tinyOffset + \"px\",\n                    top: _this.scaled.corners[g.i].y - _this.gripSize / 2 + offsetArr[i][1] * tinyOffset + \"px\"\n                });\n                // cursor\n                var angle = (0, $eWjiX.BB).pointsToAngleDeg({\n                    x: _this.transform.x,\n                    y: _this.transform.y\n                }, (0, $lt7cS.toImageSpace)(g.x, g.y, _this.transform)) + 135; // offset so nw is 0\n                while(angle < 0)angle += 360;\n                var index = Math.round(angle / 45) % _this.cornerCursors.length;\n                (0, $eWjiX.BB).css(g.el, {\n                    cursor: _this.cornerCursors[index] + \"-resize\"\n                });\n            };\n            g.pointerListener = new (0, $eWjiX.BB).PointerListener({\n                target: _this.corners[i].el,\n                fixScribble: true,\n                onPointer: function(event) {\n                    event.eventPreventDefault();\n                    if (event.type === \"pointerdown\" && event.button === \"left\") _this.corners[i].virtualPos = (0, $lt7cS.toImageSpace)(_this.corners[i].x, _this.corners[i].y, _this.transform);\n                    else if (event.type === \"pointermove\" && event.button === \"left\") {\n                        _this.corners[i].virtualPos.x += event.dX / _this.scale;\n                        _this.corners[i].virtualPos.y += event.dY / _this.scale;\n                        var iP = {\n                            x: _this.corners[i].virtualPos.x,\n                            y: _this.corners[i].virtualPos.y\n                        };\n                        iP = _this.constrainCorner(i, iP.x, iP.y);\n                        if (!_this.isConstrained) iP = _this.snapCorner(iP.x, iP.y);\n                        if (Math.abs(_this.transform.angleDeg) % 90 === 0) {\n                            iP.x = Math.round(iP.x);\n                            iP.y = Math.round(iP.y);\n                        }\n                        var tP = (0, $lt7cS.toTransformSpace)(iP.x, iP.y, _this.transform);\n                        var dX = tP.x - _this.corners[i].x;\n                        var dY = tP.y - _this.corners[i].y;\n                        _this.corners[i].x = tP.x;\n                        _this.corners[i].y = tP.y;\n                        var indexes = [];\n                        if (i === 0) indexes = [\n                            3,\n                            1,\n                            2\n                        ];\n                        else if (i === 1) indexes = [\n                            2,\n                            0,\n                            3\n                        ];\n                        else if (i === 2) indexes = [\n                            1,\n                            3,\n                            0\n                        ];\n                        else if (i === 3) indexes = [\n                            0,\n                            2,\n                            1\n                        ];\n                        _this.corners[indexes[0]].x = _this.corners[i].x;\n                        _this.corners[indexes[1]].y = _this.corners[i].y;\n                        if (_this.keyListener.isPressed(\"shift\")) {\n                            _this.corners[indexes[2]].x -= dX;\n                            _this.corners[indexes[2]].y -= dY;\n                            _this.corners[indexes[1]].x = _this.corners[indexes[2]].x;\n                            _this.corners[indexes[0]].y = _this.corners[indexes[2]].y;\n                        }\n                        _this.updateTransformViaCorners();\n                    }\n                }\n            });\n        })(i);\n        this.updateCornerPositions();\n        this.updateScaled();\n        var isInverted;\n        for(var i1 = 0; i1 < 4; i1++)(function(i) {\n            _this.edges[i] = {\n                el: (0, $eWjiX.BB).el({\n                    css: {\n                        width: _this.edgeSize + \"px\",\n                        height: _this.edgeSize + \"px\",\n                        /*background: [\r\n                                '#ff000044',\r\n                                '#00ff0044',\r\n                                '#0000ff44',\r\n                                '#ff00ff44',\r\n                            ][i],*/ position: \"absolute\"\n                    }\n                })\n            };\n            var g = _this.edges[i];\n            g.updateDOM = function() {\n                if (i === 0) (0, $eWjiX.BB).css(g.el, {\n                    left: Math.min(_this.scaled.corners[0].x, _this.scaled.corners[1].x) + \"px\",\n                    top: Math.min(_this.scaled.corners[0].y, _this.scaled.corners[3].y) - _this.edgeSize + \"px\",\n                    width: Math.abs(_this.scaled.width) + \"px\",\n                    height: _this.edgeSize + \"px\"\n                });\n                else if (i === 1) (0, $eWjiX.BB).css(g.el, {\n                    left: Math.max(_this.scaled.corners[0].x, _this.scaled.corners[1].x) + \"px\",\n                    top: Math.min(_this.scaled.corners[1].y, _this.scaled.corners[2].y) + \"px\",\n                    width: _this.edgeSize + \"px\",\n                    height: Math.abs(_this.scaled.height) + \"px\"\n                });\n                else if (i === 2) (0, $eWjiX.BB).css(g.el, {\n                    left: Math.min(_this.scaled.corners[3].x, _this.scaled.corners[2].x) + \"px\",\n                    top: Math.max(_this.scaled.corners[0].y, _this.scaled.corners[3].y) + \"px\",\n                    width: Math.abs(_this.scaled.width) + \"px\",\n                    height: _this.edgeSize + \"px\"\n                });\n                else if (i === 3) (0, $eWjiX.BB).css(g.el, {\n                    left: Math.min(_this.scaled.corners[0].x, _this.scaled.corners[1].x) - _this.edgeSize + \"px\",\n                    top: Math.min(_this.scaled.corners[0].y, _this.scaled.corners[3].y) + \"px\",\n                    width: _this.edgeSize + \"px\",\n                    height: Math.abs(_this.scaled.height) + \"px\"\n                });\n                var angleOffset = Math.round(_this.transform.angleDeg / 45);\n                while(angleOffset < 0)angleOffset += 8;\n                angleOffset = (i * 2 + 1 + angleOffset) % _this.cornerCursors.length;\n                g.el.style.cursor = _this.cornerCursors[angleOffset] + \"-resize\";\n            };\n            var isVertical = [\n                0,\n                2\n            ].includes(i);\n            g.pointerListener = new (0, $eWjiX.BB).PointerListener({\n                target: _this.edges[i].el,\n                fixScribble: true,\n                onPointer: function(event) {\n                    event.eventPreventDefault();\n                    if (event.type === \"pointerdown\" && event.button === \"left\") {\n                        if (isVertical) isInverted = _this.corners[0].y >= _this.corners[3].y;\n                        else isInverted = _this.corners[0].x >= _this.corners[1].x;\n                        resetRemainder();\n                    }\n                    if (event.type === \"pointermove\" && event.button === \"left\") {\n                        var tfD = (0, $eWjiX.BB).rotateAround({\n                            x: 0,\n                            y: 0\n                        }, {\n                            x: event.dX / _this.scale,\n                            y: event.dY / _this.scale\n                        }, -_this.transform.angleDeg);\n                        var ti = {\n                            dX: tfD.x,\n                            dY: tfD.y\n                        };\n                        if (Math.abs(_this.transform.angleDeg) % 90 === 0) ti = (0, $eWjiX.BB).intDxy(pointerRemainder, tfD.x, tfD.y);\n                        var indexes = [];\n                        if (i === 0) indexes = [\n                            2,\n                            3,\n                            0,\n                            1\n                        ];\n                        else if (i === 1) indexes = [\n                            0,\n                            3,\n                            1,\n                            2\n                        ];\n                        else if (i === 2) indexes = [\n                            0,\n                            1,\n                            2,\n                            3\n                        ];\n                        else if (i === 3) indexes = [\n                            1,\n                            2,\n                            0,\n                            3\n                        ];\n                        var dimension = isVertical ? \"y\" : \"x\";\n                        var d = isVertical ? ti.dY : ti.dX;\n                        if (isInverted) {\n                            _this.corners[indexes[0]][dimension] += d;\n                            _this.corners[indexes[1]][dimension] += d;\n                        } else {\n                            _this.corners[indexes[2]][dimension] += d;\n                            _this.corners[indexes[3]][dimension] += d;\n                        }\n                        if (_this.keyListener.isPressed(\"shift\")) {\n                            if (isInverted) {\n                                _this.corners[indexes[2]][dimension] -= d;\n                                _this.corners[indexes[3]][dimension] -= d;\n                            } else {\n                                _this.corners[indexes[0]][dimension] -= d;\n                                _this.corners[indexes[1]][dimension] -= d;\n                            }\n                        }\n                        if (isVertical) _this.restoreRatio(false, true);\n                        else _this.restoreRatio(true, false);\n                        _this.updateTransformViaCorners();\n                    }\n                }\n            });\n        })(i1);\n        this.angleGrip = {\n            el: (0, $eWjiX.BB).el({\n                css: {\n                    cursor: \"url(\" + (0, (/*@__PURE__*/$parcel$interopDefault($5cYet))) + \") 10 10, move\",\n                    width: this.gripSize + \"px\",\n                    height: this.gripSize + \"px\",\n                    background: \"#0ff\",\n                    borderRadius: this.gripSize + \"px\",\n                    position: \"absolute\",\n                    boxShadow: \"inset 0 0 0 2px #000\"\n                }\n            }),\n            x: 0,\n            y: 0,\n            snap: false,\n            updateDOM: function() {\n                (0, $eWjiX.BB).css(_this.angleGrip.el, {\n                    left: _this.angleGrip.x - _this.gripSize / 2 + \"px\",\n                    top: _this.angleGrip.y - _this.gripSize / 2 + \"px\"\n                });\n            }\n        };\n        (0, $eWjiX.BB).el({\n            parent: this.angleGrip.el,\n            css: {\n                width: \"2px\",\n                height: \"13px\",\n                left: this.gripSize / 2 - 1 + \"px\",\n                top: this.gripSize + \"px\",\n                background: \"#0ff\",\n                position: \"absolute\"\n            }\n        });\n        this.anglePointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.angleGrip.el,\n            fixScribble: true,\n            onPointer: function(event) {\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    var bounds = _this.rootEl.getBoundingClientRect();\n                    var offset = {\n                        x: bounds.left - _this.rootEl.scrollLeft,\n                        y: bounds.top - _this.rootEl.scrollTop\n                    };\n                    var iP = {\n                        x: (event.clientX - offset.x) / _this.scale,\n                        y: (event.clientY - offset.y) / _this.scale\n                    };\n                    var a = (0, $eWjiX.BB).pointsToAngleDeg({\n                        x: _this.transform.x,\n                        y: _this.transform.y\n                    }, iP) + 90;\n                    _this.transform.angleDeg = a;\n                    var snapDeg = Math.round(a / 360 * 8) * 45;\n                    if (_this.keyListener.getComboStr() === \"shift\") _this.transform.angleDeg = snapDeg;\n                    else if (_this.snappingEnabled && Math.abs(snapDeg - a) < 8) _this.transform.angleDeg = snapDeg;\n                    _this.updateDOM();\n                }\n                if (event.type === \"pointerup\") {\n                    if (Math.abs(_this.transform.angleDeg) % 90 === 0) {\n                        (0, $lt7cS.snapToPixel)(_this.transform);\n                        _this.updateCornerPositions();\n                        _this.updateDOM();\n                    }\n                }\n            }\n        });\n        (0, $lt7cS.snapToPixel)(this.transform);\n        this.updateDOM(true);\n        (0, $eWjiX.BB).append(this.transEl, [\n            this.boundsEl,\n            this.edges[0].el,\n            this.edges[1].el,\n            this.edges[2].el,\n            this.edges[3].el,\n            this.corners[0].el,\n            this.corners[1].el,\n            this.corners[2].el,\n            this.corners[3].el,\n            this.angleGrip.el\n        ]);\n    }\n    (0, $7h4XF._)(FreeTransform, [\n        {\n            key: \"updateScaled\",\n            value: function updateScaled() {\n                var _this = this;\n                this.scaled.x = this.transform.x * this.scale;\n                this.scaled.y = this.transform.y * this.scale;\n                this.scaled.width = this.transform.width * this.scale;\n                this.scaled.height = this.transform.height * this.scale;\n                this.scaled.corners = this.corners.map(function(item) {\n                    return {\n                        x: item.x * _this.scale,\n                        y: item.y * _this.scale\n                    };\n                });\n            }\n        },\n        {\n            key: \"snapCorner\",\n            value: /**\r\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\r\n     * both in image space\r\n     *\r\n     * @param iX - image space\r\n     * @param iY - image space\r\n     * @private\r\n     */ function snapCorner(iX, iY) {\n                if (!this.snappingEnabled) return {\n                    x: iX,\n                    y: iY\n                };\n                var dist;\n                var snap = {\n                    x: undefined,\n                    y: undefined,\n                    dist: {\n                        x: undefined,\n                        y: undefined\n                    }\n                };\n                for(var e = 0; e < this.snapX.length; e++){\n                    dist = Math.abs(iX - this.snapX[e]);\n                    if (dist < this.minSnapDist / this.scale) {\n                        if (snap.x === undefined || dist < snap.dist.x) {\n                            snap.x = this.snapX[e];\n                            snap.dist.x = dist;\n                        }\n                    }\n                }\n                for(var e1 = 0; e1 < this.snapY.length; e1++){\n                    dist = Math.abs(iY - this.snapY[e1]);\n                    if (dist < this.minSnapDist / this.scale) {\n                        if (snap.y === undefined || dist < snap.dist.y) {\n                            snap.y = this.snapY[e1];\n                            snap.dist.y = dist;\n                        }\n                    }\n                }\n                if (snap.x === undefined && snap.y === undefined) return {\n                    x: iX,\n                    y: iY\n                };\n                var _snap_x, _snap_y;\n                return {\n                    x: (_snap_x = snap.x) !== null && _snap_x !== void 0 ? _snap_x : iX,\n                    y: (_snap_y = snap.y) !== null && _snap_y !== void 0 ? _snap_y : iY\n                };\n            }\n        },\n        {\n            key: \"constrainCorner\",\n            value: /**\r\n     * If constrained return nearest corner pos that fits aspect ratio\r\n     *\r\n     * @param cornerIndex\r\n     * @param iX\r\n     * @param iY\r\n     * @private\r\n     */ function constrainCorner(cornerIndex, iX, iY) {\n                if (!this.isConstrained) return {\n                    x: iX,\n                    y: iY\n                };\n                var flip = this.transform.width * this.transform.height < 0 ? -1 : 1;\n                return (0, $eWjiX.BB).projectPointOnLine({\n                    x: this.transform.x,\n                    y: this.transform.y\n                }, (0, $lt7cS.toImageSpace)(this.ratio, flip * ([\n                    0,\n                    2\n                ].includes(cornerIndex) ? 1 : -1), this.transform), {\n                    x: iX,\n                    y: iY\n                });\n            }\n        },\n        {\n            key: \"updateCornerPositions\",\n            value: /**\r\n     * Update corners according to width height.\r\n     * Not their DOM.\r\n     */ function updateCornerPositions() {\n                this.corners[0].x = -this.transform.width / 2; // top left\n                this.corners[0].y = -this.transform.height / 2;\n                this.corners[1].x = this.transform.width / 2; // top right\n                this.corners[1].y = -this.transform.height / 2;\n                this.corners[2].x = this.transform.width / 2; // bottom right\n                this.corners[2].y = this.transform.height / 2;\n                this.corners[3].x = -this.transform.width / 2; // bottom left\n                this.corners[3].y = this.transform.height / 2;\n            }\n        },\n        {\n            key: \"restoreRatio\",\n            value: /**\r\n     * If constrained and dragging an edge, restore aspect ratio\r\n     * Updates corner positions.\r\n     *\r\n     * @param widthChanged\r\n     * @param heightChanged\r\n     * @private\r\n     */ function restoreRatio(widthChanged, heightChanged) {\n                if (!this.isConstrained) return;\n                var angle90 = Math.abs(this.transform.angleDeg) % 90 === 0;\n                var whSwapped = Math.abs(this.transform.angleDeg - 90) % 180 === 0;\n                if (heightChanged && !widthChanged) {\n                    var newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\n                    var newWidth = this.ratio * newHeight;\n                    if (angle90) newWidth = (whSwapped ? this.transform.y % 1 : this.transform.x % 1) === 0 ? (0, $eWjiX.BB).roundEven(newWidth) : (0, $eWjiX.BB).roundUneven(newWidth);\n                    if (this.corners[1].x - this.corners[0].x < 0) newWidth *= -1;\n                    this.corners[0].x = -newWidth / 2;\n                    this.corners[3].x = -newWidth / 2;\n                    this.corners[1].x = newWidth / 2;\n                    this.corners[2].x = newWidth / 2;\n                }\n                if (!heightChanged && widthChanged) {\n                    var newWidth1 = Math.abs(this.corners[0].x - this.corners[1].x);\n                    var newHeight1 = newWidth1 / this.ratio;\n                    if (angle90) newHeight1 = (whSwapped ? this.transform.x % 1 : this.transform.y % 1) === 0 ? (0, $eWjiX.BB).roundEven(newHeight1) : (0, $eWjiX.BB).roundUneven(newHeight1);\n                    if (this.corners[3].y - this.corners[0].y < 0) newHeight1 *= -1;\n                    this.corners[0].y = -newHeight1 / 2;\n                    this.corners[1].y = -newHeight1 / 2;\n                    this.corners[2].y = newHeight1 / 2;\n                    this.corners[3].y = newHeight1 / 2;\n                }\n            }\n        },\n        {\n            key: \"updateTransformViaCorners\",\n            value: /**\r\n     * update transform based on corners\r\n     * @private\r\n     */ function updateTransformViaCorners() {\n                // calc transform center in image space\n                var rot = (0, $eWjiX.BB).rotateAround({\n                    x: 0,\n                    y: 0\n                }, {\n                    x: (this.corners[0].x + this.corners[1].x) / 2,\n                    y: (this.corners[0].y + this.corners[3].y) / 2\n                }, this.transform.angleDeg);\n                this.transform.x = rot.x + this.transform.x;\n                this.transform.y = rot.y + this.transform.y;\n                // update size\n                this.transform.width = this.corners[1].x - this.corners[0].x;\n                this.transform.height = this.corners[3].y - this.corners[0].y;\n                // new center means corners changed their position\n                this.updateCornerPositions();\n                this.updateDOM();\n            }\n        },\n        {\n            key: \"updateDOM\",\n            value: /**\r\n     * updates DOM according to transform\r\n     * @param skipCallback\r\n     */ function updateDOM(skipCallback) {\n                this.updateScaled();\n                (0, $eWjiX.BB).css(this.transEl, {\n                    left: this.scaled.x + \"px\",\n                    top: this.scaled.y + \"px\",\n                    transformOrigin: \"0 0\",\n                    transform: \"rotate(\" + this.transform.angleDeg + \"deg)\"\n                });\n                (0, $eWjiX.BB).css(this.boundsEl, {\n                    width: Math.abs(this.scaled.width) + \"px\",\n                    height: Math.abs(this.scaled.height) + \"px\",\n                    left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + \"px\",\n                    top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + \"px\"\n                });\n                this.corners[0].updateDOM();\n                this.corners[1].updateDOM();\n                this.corners[2].updateDOM();\n                this.corners[3].updateDOM();\n                this.edges[0].updateDOM();\n                this.edges[1].updateDOM();\n                this.edges[2].updateDOM();\n                this.edges[3].updateDOM();\n                this.angleGrip.x = 0;\n                this.angleGrip.y = -Math.abs(this.transform.height * this.scale) / 2 - 20;\n                this.angleGrip.updateDOM();\n                if (!skipCallback) {\n                    if (this.callback) this.callback((0, $lt7cS.copyTransform)(this.transform));\n                }\n            }\n        },\n        {\n            key: \"getTransform\",\n            value: function getTransform() {\n                return (0, $lt7cS.copyTransform)(this.transform);\n            }\n        },\n        {\n            key: \"setConstrained\",\n            value: function setConstrained(b) {\n                this.isConstrained = b;\n                if (b && this.transform.width !== 0 && this.transform.height !== 0) this.ratio = Math.abs(this.transform.width / this.transform.height);\n            }\n        },\n        {\n            key: \"setSnapping\",\n            value: function setSnapping(s) {\n                this.snappingEnabled = s;\n            }\n        },\n        {\n            key: \"setPos\",\n            value: function setPos(p) {\n                this.transform.x = p.x;\n                this.transform.y = p.y;\n                this.updateDOM(true);\n            }\n        },\n        {\n            key: \"move\",\n            value: function move(dX, dY) {\n                this.transform.x += dX;\n                this.transform.y += dY;\n                this.updateDOM(false);\n            }\n        },\n        {\n            key: \"setSize\",\n            value: function setSize(w, h) {\n                this.transform.width = w;\n                this.transform.height = h;\n                if (Math.abs(this.transform.angleDeg) % 90 === 0) (0, $lt7cS.snapToPixel)(this.transform);\n                this.updateCornerPositions();\n                this.updateDOM(false);\n            }\n        },\n        {\n            key: \"setAngleDeg\",\n            value: function setAngleDeg(a) {\n                this.transform.angleDeg = a;\n                if (Math.abs(this.transform.angleDeg) % 90 === 0) {\n                    (0, $lt7cS.snapToPixel)(this.transform);\n                    this.updateCornerPositions();\n                }\n                this.updateDOM(true);\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"getRatio\",\n            value: function getRatio() {\n                return this.ratio;\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.keyListener.destroy();\n                this.boundsPointerListener.destroy();\n                this.corners[0].pointerListener.destroy();\n                this.corners[1].pointerListener.destroy();\n                this.corners[2].pointerListener.destroy();\n                this.corners[3].pointerListener.destroy();\n                this.edges[0].pointerListener.destroy();\n                this.edges[1].pointerListener.destroy();\n                this.edges[2].pointerListener.destroy();\n                this.edges[3].pointerListener.destroy();\n                this.anglePointerListener.destroy();\n            }\n        }\n    ]);\n    return FreeTransform;\n}();\n\n});\nparcelRequire.register(\"5cYet\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"fcdZI\");\n\n});\n\nparcelRequire.register(\"lt7cS\", function(module, exports) {\n\n$parcel$export(module.exports, \"snapToPixel\", function () { return $6c5cb3001c773523$export$958c2bfe8d7142a9; });\n$parcel$export(module.exports, \"copyTransform\", function () { return $6c5cb3001c773523$export$234b1c16dfa57d6a; });\n$parcel$export(module.exports, \"toTransformSpace\", function () { return $6c5cb3001c773523$export$6a4549ec4168874a; });\n$parcel$export(module.exports, \"toImageSpace\", function () { return $6c5cb3001c773523$export$3fba3b383c654cc6; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nfunction $6c5cb3001c773523$export$958c2bfe8d7142a9(transform) {\n    if (Math.abs(transform.angleDeg) % 90 !== 0) return;\n    transform.width = Math.round(transform.width);\n    transform.height = Math.round(transform.height);\n    // 0 is original orientation.\n    // At 90 and 270 width and height become swapped due to different orientation.\n    var whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    transform.x = (whSwapped ? transform.height : transform.width) % 2 === 0 ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\n    transform.y = (whSwapped ? transform.width : transform.height) % 2 === 0 ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\n}\nfunction $6c5cb3001c773523$export$234b1c16dfa57d6a(transform) {\n    return {\n        x: transform.x,\n        y: transform.y,\n        width: transform.width,\n        height: transform.height,\n        angleDeg: transform.angleDeg\n    };\n}\nfunction $6c5cb3001c773523$export$6a4549ec4168874a(x, y, transform) {\n    var px, py;\n    px = x - transform.x;\n    py = y - transform.y;\n    var rot = (0, $eWjiX.BB).rotateAround({\n        x: 0,\n        y: 0\n    }, {\n        x: px,\n        y: py\n    }, -transform.angleDeg);\n    px = rot.x;\n    py = rot.y;\n    return {\n        x: px,\n        y: py\n    };\n}\nfunction $6c5cb3001c773523$export$3fba3b383c654cc6(x, y, transform) {\n    var rot = (0, $eWjiX.BB).rotateAround({\n        x: 0,\n        y: 0\n    }, {\n        x: x,\n        y: y\n    }, transform.angleDeg);\n    return {\n        x: rot.x + transform.x,\n        y: rot.y + transform.y\n    };\n}\n\n});\n\n\nparcelRequire.register(\"kEeSq\", function(module, exports) {\n\n$parcel$export(module.exports, \"FreeTransformCanvas\", function () { return $48f5d87739d28bf9$export$205c2dd29f8a66b5; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $cNhNm = parcelRequire(\"cNhNm\");\nvar $48f5d87739d28bf9$export$205c2dd29f8a66b5 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function FreeTransformCanvas(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, FreeTransformCanvas);\n        this.imageWidth = p.imageWidth;\n        this.imageHeight = p.imageHeight;\n        var previewFit = (0, $eWjiX.BB).fitInto(p.imageWidth, this.imageHeight, p.elementWidth - 20, p.elementHeight - 60, 1);\n        this.scale = previewFit.width / p.imageWidth;\n        this.rootEl = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper\",\n            css: {\n                width: p.elementWidth + \"px\",\n                height: p.elementHeight + \"px\"\n            }\n        });\n        this.rootEl.oncontextmenu = function() {\n            return false;\n        };\n        this.layers = p.layers;\n        this.transformIndex = p.transformIndex;\n        var innerWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper__canvas\",\n            css: {\n                width: previewFit.width + \"px\",\n                height: previewFit.height + \"px\"\n            }\n        });\n        this.rootEl.append(innerWrapper);\n        this.previewLayerArr = this.layers.map(function(item) {\n            return {\n                image: item.image,\n                isVisible: item.isVisible,\n                mixModeStr: item.mixModeStr,\n                opacity: item.opacity\n            };\n        });\n        this.previewLayerArr[this.previewLayerArr.length - 1].image = (0, $eWjiX.BB).canvas(this.scale > 1 ? this.imageWidth : previewFit.width, this.scale > 1 ? this.imageHeight : previewFit.height);\n        this.klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n            width: previewFit.width,\n            height: previewFit.height,\n            layers: this.previewLayerArr\n        });\n        innerWrapper.append(this.klCanvasPreview.getElement());\n        {\n            var transformSize = {\n                width: this.layers[this.transformIndex].image.width * this.scale,\n                height: this.layers[this.transformIndex].image.height * this.scale\n            };\n            if (transformSize.width > previewFit.width || transformSize.height > previewFit.height) transformSize = (0, $eWjiX.BB).fitInto(this.layers[this.transformIndex].image.width, this.layers[this.transformIndex].image.height, previewFit.width, previewFit.height, 1);\n            this.initTransform = {\n                x: this.imageWidth / 2,\n                y: this.imageHeight / 2,\n                width: this.layers[this.transformIndex].image.width,\n                height: this.layers[this.transformIndex].image.height\n            };\n            this.freeTransform = new (0, $cNhNm.FreeTransform)({\n                x: this.initTransform.x,\n                y: this.initTransform.y,\n                width: this.initTransform.width,\n                height: this.initTransform.height,\n                angleDeg: 0,\n                isConstrained: true,\n                snapX: [\n                    0,\n                    this.imageWidth\n                ],\n                snapY: [\n                    0,\n                    this.imageHeight\n                ],\n                scale: this.scale,\n                callback: function() {\n                    _this.updatePreview();\n                }\n            });\n        }\n        (0, $eWjiX.BB).css(this.freeTransform.getElement(), {\n            position: \"absolute\",\n            left: \"0\",\n            top: \"0\"\n        });\n        innerWrapper.append(this.freeTransform.getElement());\n        setTimeout(function() {\n            return _this.updatePreview();\n        }, 0);\n    }\n    (0, $7h4XF._)(FreeTransformCanvas, [\n        {\n            key: \"updatePreview\",\n            value: function updatePreview() {\n                if (!this.freeTransform) return;\n                var transform = this.freeTransform.getTransform();\n                if (this.scale < 1) {\n                    transform.x *= this.scale;\n                    transform.y *= this.scale;\n                    transform.width *= this.scale;\n                    transform.height *= this.scale;\n                }\n                var destCanvas = this.previewLayerArr[this.transformIndex].image;\n                var ctx = (0, $eWjiX.BB).ctx(destCanvas);\n                ctx.save();\n                ctx.clearRect(0, 0, destCanvas.width, destCanvas.height);\n                (0, $eWjiX.BB).drawTransformedImageWithBounds(ctx, this.layers[this.transformIndex].image, transform, undefined, (0, $eWjiX.BB).testShouldPixelate(transform, transform.width / this.initTransform.width, transform.height / this.initTransform.height));\n                ctx.restore();\n                this.klCanvasPreview.render();\n            }\n        },\n        {\n            // ---- interface ----\n            key: \"move\",\n            value: function move(dX, dY) {\n                this.freeTransform.move(dX, dY);\n            }\n        },\n        {\n            key: \"reset\",\n            value: function reset() {\n                var w = this.layers[this.transformIndex].image.width;\n                var h = this.layers[this.transformIndex].image.height;\n                this.freeTransform.setSize(w, h);\n                this.freeTransform.setPos({\n                    x: w / 2,\n                    y: h / 2\n                });\n                this.freeTransform.setAngleDeg(0);\n                this.updatePreview();\n            }\n        },\n        {\n            key: \"setTransformFit\",\n            value: function setTransformFit() {\n                var fit = (0, $eWjiX.BB).fitInto(this.layers[this.transformIndex].image.width, this.layers[this.transformIndex].image.height, this.imageWidth, this.imageHeight, 1);\n                this.freeTransform.setSize(fit.width, fit.height);\n                this.freeTransform.setPos({\n                    x: fit.width / 2,\n                    y: fit.height / 2\n                });\n                this.freeTransform.setAngleDeg(0);\n                this.updatePreview();\n            }\n        },\n        {\n            key: \"setTransformCenter\",\n            value: function setTransformCenter() {\n                this.freeTransform.setPos({\n                    x: this.imageWidth / 2,\n                    y: this.imageHeight / 2\n                });\n                this.freeTransform.setAngleDeg(0);\n                this.updatePreview();\n            }\n        },\n        {\n            /**\r\n     * gives you the transformation in the original scale\r\n     */ key: \"getTransformation\",\n            value: function getTransformation() {\n                if (!this.freeTransform) return false;\n                return this.freeTransform.getTransform();\n            }\n        },\n        {\n            key: \"getIsPixelated\",\n            value: function getIsPixelated() {\n                var transform = this.freeTransform.getTransform();\n                return (0, $eWjiX.BB).testShouldPixelate(transform, transform.width / this.initTransform.width, transform.height / this.initTransform.height);\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.freeTransform.destroy();\n                this.klCanvasPreview.destroy();\n            }\n        }\n    ]);\n    return FreeTransformCanvas;\n}();\n\n});\n\nparcelRequire.register(\"32CBv\", function(module, exports) {\n\n$parcel$export(module.exports, \"Cropper\", function () { return $de496a1759b04ed9$export$71ed2b85d4ca43d3; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $de496a1759b04ed9$export$71ed2b85d4ca43d3 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function Cropper(params) {\n        var _this = this;\n        (0, $cx0mh._)(this, Cropper);\n        this.x = params.x;\n        this.y = params.y;\n        this.width = params.width;\n        this.height = params.height;\n        this.scale = params.scale;\n        this.callback = params.callback;\n        var maxW = params.maxW;\n        var maxH = params.maxW;\n        this.rootEl = (0, $eWjiX.BB).el();\n        var gripCursors = [\n            \"nw\",\n            \"n\",\n            \"ne\",\n            \"e\",\n            \"se\",\n            \"s\",\n            \"sw\",\n            \"w\"\n        ];\n        this.keyListener = new (0, $eWjiX.BB).KeyListener({});\n        (0, $eWjiX.BB).css(this.rootEl, {\n            position: \"absolute\",\n            left: this.x * this.scale + \"px\",\n            top: this.y * this.scale + \"px\"\n        });\n        this.outline = {\n            el: (0, $eWjiX.BB).el({\n                css: {\n                    position: \"absolute\",\n                    border: \"1px dashed #fff\",\n                    cursor: \"move\"\n                }\n            }),\n            update: function() {\n                (0, $eWjiX.BB).css(_this.outline.el, {\n                    left: _this.grips[0].x * _this.scale - 1 + \"px\",\n                    top: _this.grips[0].y * _this.scale - 1 + \"px\",\n                    width: (_this.grips[2].x - _this.grips[0].x) * _this.scale + \"px\",\n                    height: (_this.grips[2].y - _this.grips[0].y) * _this.scale + \"px\"\n                });\n            }\n        };\n        this.pointerRemainder = {\n            x: 0,\n            y: 0\n        };\n        this.outlinePointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.outline.el,\n            onPointer: function(event) {\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    var _BB_intDxy = (0, $eWjiX.BB).intDxy(_this.pointerRemainder, event.dX / _this.scale, event.dY / _this.scale), dX = _BB_intDxy.dX, dY = _BB_intDxy.dY;\n                    _this.grips[0].x += dX;\n                    _this.grips[0].y += dY;\n                    _this.grips[1].x += dX;\n                    _this.grips[1].y += dY;\n                    _this.grips[2].x += dX;\n                    _this.grips[2].y += dY;\n                    _this.grips[3].x += dX;\n                    _this.grips[3].y += dY;\n                    _this.update();\n                }\n                if (event.type === \"pointerup\") _this.commit();\n            }\n        });\n        this.thirdsHorizontal = {\n            el: (0, $eWjiX.BB).el({\n                css: {\n                    position: \"absolute\",\n                    borderTop: \"1px solid #0ff\",\n                    borderBottom: \"1px solid #0ff\"\n                }\n            }),\n            update: function() {\n                (0, $eWjiX.BB).css(_this.thirdsHorizontal.el, {\n                    left: _this.grips[0].x * _this.scale + \"px\",\n                    top: (_this.grips[0].y + (_this.grips[2].y - _this.grips[0].y) / 3) * _this.scale + \"px\",\n                    width: (_this.grips[2].x - _this.grips[0].x) * _this.scale + \"px\",\n                    height: (_this.grips[2].y - _this.grips[0].y) / 3 * _this.scale + \"px\"\n                });\n            }\n        };\n        this.thirdsVertical = {\n            el: (0, $eWjiX.BB).el({\n                css: {\n                    position: \"absolute\",\n                    borderLeft: \"1px solid #0ff\",\n                    borderRight: \"1px solid #0ff\"\n                }\n            }),\n            update: function() {\n                (0, $eWjiX.BB).css(_this.thirdsVertical.el, {\n                    left: (_this.grips[0].x + (_this.grips[2].x - _this.grips[0].x) / 3) * _this.scale + \"px\",\n                    top: _this.grips[0].y * _this.scale + \"px\",\n                    width: (_this.grips[2].x - _this.grips[0].x) / 3 * _this.scale + \"px\",\n                    height: (_this.grips[2].y - _this.grips[0].y) * _this.scale + \"px\"\n                });\n            }\n        };\n        var gripSize = 40;\n        var gripOverlay = 10;\n        this.grips = [\n            {\n                x: 0,\n                y: 0\n            },\n            {\n                x: this.width,\n                y: 0\n            },\n            {\n                x: this.width,\n                y: this.height\n            },\n            {\n                x: 0,\n                y: this.height\n            }\n        ];\n        var transformTop = function(dY) {\n            _this.grips[0].y += dY;\n            _this.grips[0].y = (0, $eWjiX.BB).clamp(_this.grips[0].y, _this.grips[3].y - maxH, _this.grips[3].y - 1);\n            _this.grips[1].y = _this.grips[0].y;\n        };\n        var transformRight = function(dX) {\n            _this.grips[1].x += dX;\n            _this.grips[1].x = (0, $eWjiX.BB).clamp(_this.grips[1].x, _this.grips[0].x + 1, _this.grips[0].x + maxW);\n            _this.grips[2].x = _this.grips[1].x;\n        };\n        var transformBottom = function(dY) {\n            _this.grips[2].y += dY;\n            _this.grips[2].y = (0, $eWjiX.BB).clamp(_this.grips[2].y, _this.grips[1].y + 1, _this.grips[1].y + maxH);\n            _this.grips[3].y = _this.grips[2].y;\n        };\n        var transformLeft = function(dX) {\n            _this.grips[0].x += dX;\n            _this.grips[0].x = (0, $eWjiX.BB).clamp(_this.grips[0].x, _this.grips[1].x - maxW, _this.grips[1].x - 1);\n            _this.grips[3].x = _this.grips[0].x;\n        };\n        this.edges = [];\n        for(var i = 0; i < 4; i++)(function(i) {\n            var el = (0, $eWjiX.BB).el({\n                css: {\n                    width: gripSize + \"px\",\n                    height: gripSize + \"px\",\n                    //background: '#0f0',\n                    position: \"absolute\"\n                }\n            });\n            var update = function() {\n                if (i === 0) (0, $eWjiX.BB).css(el, {\n                    left: _this.grips[0].x * _this.scale + gripOverlay + \"px\",\n                    top: _this.grips[0].y * _this.scale - gripSize * 2 + gripOverlay + \"px\",\n                    width: (_this.grips[1].x - _this.grips[0].x) * _this.scale - gripOverlay * 2 + \"px\",\n                    height: gripSize * 2 + \"px\"\n                });\n                else if (i === 1) (0, $eWjiX.BB).css(el, {\n                    left: _this.grips[1].x * _this.scale - gripOverlay + \"px\",\n                    top: _this.grips[1].y * _this.scale + gripOverlay + \"px\",\n                    width: gripSize * 2 + \"px\",\n                    height: (_this.grips[2].y - _this.grips[1].y) * _this.scale - gripOverlay * 2 + \"px\"\n                });\n                else if (i === 2) (0, $eWjiX.BB).css(el, {\n                    left: _this.grips[3].x * _this.scale + gripOverlay + \"px\",\n                    top: _this.grips[3].y * _this.scale - gripOverlay + \"px\",\n                    width: (_this.grips[2].x - _this.grips[3].x) * _this.scale - gripOverlay * 2 + \"px\",\n                    height: gripSize * 2 + \"px\"\n                });\n                else if (i === 3) (0, $eWjiX.BB).css(el, {\n                    left: _this.grips[0].x * _this.scale - gripSize * 2 + gripOverlay + \"px\",\n                    top: _this.grips[0].y * _this.scale + gripOverlay + \"px\",\n                    width: gripSize * 2 + \"px\",\n                    height: (_this.grips[3].y - _this.grips[0].y) * _this.scale - gripOverlay * 2 + \"px\"\n                });\n                var angleOffset = i * 2 + 1;\n                el.style.cursor = gripCursors[angleOffset] + \"-resize\";\n            };\n            _this.edges[i] = {\n                el: el,\n                update: update\n            };\n        })(i);\n        this.darken = [];\n        for(var i1 = 0; i1 < 4; i1++)(function(i) {\n            var g = (0, $eWjiX.BB).el({\n                css: {\n                    position: \"absolute\",\n                    background: \"#000\",\n                    opacity: \"0.5\"\n                }\n            });\n            var update = function() {\n                if (i === 0) (0, $eWjiX.BB).css(g, {\n                    left: _this.grips[0].x * _this.scale + \"px\",\n                    top: _this.grips[0].y * _this.scale - 8000 + \"px\",\n                    width: (_this.grips[1].x - _this.grips[0].x) * _this.scale + \"px\",\n                    height: \"8000px\"\n                });\n                else if (i === 1) (0, $eWjiX.BB).css(g, {\n                    left: _this.grips[1].x * _this.scale + \"px\",\n                    top: _this.grips[1].y * _this.scale - 8000 + \"px\",\n                    width: \"8000px\",\n                    height: \"16000px\"\n                });\n                else if (i === 2) (0, $eWjiX.BB).css(g, {\n                    left: _this.grips[3].x * _this.scale + \"px\",\n                    top: _this.grips[3].y * _this.scale + \"px\",\n                    width: (_this.grips[2].x - _this.grips[3].x) * _this.scale + \"px\",\n                    height: \"8000px\"\n                });\n                else if (i === 3) (0, $eWjiX.BB).css(g, {\n                    left: _this.grips[0].x * _this.scale - 8000 + \"px\",\n                    top: _this.grips[0].y * _this.scale - 8000 + \"px\",\n                    width: \"8000px\",\n                    height: \"16000px\"\n                });\n            };\n            _this.darken[i] = {\n                el: g,\n                update: update\n            };\n        })(i1);\n        this.edge0PointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.edges[0].el,\n            fixScribble: true,\n            onPointer: function(event) {\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    var dY = (0, $eWjiX.BB).intDxy(_this.pointerRemainder, event.dX / _this.scale, event.dY / _this.scale).dY;\n                    transformTop(dY);\n                    if (_this.keyListener.isPressed(\"shift\")) transformBottom(-dY);\n                    _this.update();\n                }\n                if (event.type === \"pointerup\") _this.commit();\n            }\n        });\n        this.edge1PointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.edges[1].el,\n            fixScribble: true,\n            onPointer: function(event) {\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    var _BB_intDxy = (0, $eWjiX.BB).intDxy(_this.pointerRemainder, event.dX / _this.scale, event.dY / _this.scale), dX = _BB_intDxy.dX, dY = _BB_intDxy.dY;\n                    transformRight(dX);\n                    if (_this.keyListener.isPressed(\"shift\")) transformLeft(-dX);\n                    _this.update();\n                }\n                if (event.type === \"pointerup\") _this.commit();\n            }\n        });\n        this.edge2PointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.edges[2].el,\n            fixScribble: true,\n            onPointer: function(event) {\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    var _BB_intDxy = (0, $eWjiX.BB).intDxy(_this.pointerRemainder, event.dX / _this.scale, event.dY / _this.scale), dX = _BB_intDxy.dX, dY = _BB_intDxy.dY;\n                    transformBottom(dY);\n                    if (_this.keyListener.isPressed(\"shift\")) transformTop(-dY);\n                    _this.update();\n                }\n                if (event.type === \"pointerup\") _this.commit();\n            }\n        });\n        this.edge3PointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.edges[3].el,\n            fixScribble: true,\n            onPointer: function(event) {\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    var _BB_intDxy = (0, $eWjiX.BB).intDxy(_this.pointerRemainder, event.dX / _this.scale, event.dY / _this.scale), dX = _BB_intDxy.dX, dY = _BB_intDxy.dY;\n                    transformLeft(dX);\n                    if (_this.keyListener.isPressed(\"shift\")) transformRight(-dX);\n                    _this.update();\n                }\n                if (event.type === \"pointerup\") _this.commit();\n            }\n        });\n        this.cornerElArr = [];\n        (function() {\n            for(var i = 0; i < 4; i++)(function(i) {\n                var g = (0, $eWjiX.BB).el({\n                    css: {\n                        //background: '#f00',\n                        width: gripSize * 2 + \"px\",\n                        height: gripSize * 2 + \"px\",\n                        position: \"absolute\",\n                        cursor: [\n                            \"nwse-resize\",\n                            \"nesw-resize\"\n                        ][i % 2]\n                    }\n                });\n                var update = function() {\n                    if (i === 0) (0, $eWjiX.BB).css(g, {\n                        left: _this.grips[0].x * _this.scale - gripSize * 2 + gripOverlay + \"px\",\n                        top: _this.grips[0].y * _this.scale - gripSize * 2 + gripOverlay + \"px\"\n                    });\n                    else if (i === 1) (0, $eWjiX.BB).css(g, {\n                        left: _this.grips[1].x * _this.scale - gripOverlay + \"px\",\n                        top: _this.grips[1].y * _this.scale - gripSize * 2 + gripOverlay + \"px\"\n                    });\n                    else if (i === 2) (0, $eWjiX.BB).css(g, {\n                        left: _this.grips[1].x * _this.scale - gripOverlay + \"px\",\n                        top: _this.grips[2].y * _this.scale - gripOverlay + \"px\"\n                    });\n                    else if (i === 3) (0, $eWjiX.BB).css(g, {\n                        left: _this.grips[0].x * _this.scale - gripSize * 2 + gripOverlay + \"px\",\n                        top: _this.grips[2].y * _this.scale - gripOverlay + \"px\"\n                    });\n                };\n                _this.cornerElArr[i] = {\n                    el: g,\n                    update: update\n                };\n            })(i);\n        })();\n        //top left\n        this.corner0PointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.cornerElArr[0].el,\n            fixScribble: true,\n            onPointer: function(event) {\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    var _BB_intDxy = (0, $eWjiX.BB).intDxy(_this.pointerRemainder, event.dX / _this.scale, event.dY / _this.scale), dX = _BB_intDxy.dX, dY = _BB_intDxy.dY;\n                    transformLeft(dX);\n                    transformTop(dY);\n                    if (_this.keyListener.isPressed(\"shift\")) {\n                        transformRight(-dX);\n                        transformBottom(-dY);\n                    }\n                    _this.update();\n                }\n                if (event.type === \"pointerup\") _this.commit();\n            }\n        });\n        //top right\n        this.corner1PointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.cornerElArr[1].el,\n            fixScribble: true,\n            onPointer: function(event) {\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    var _BB_intDxy = (0, $eWjiX.BB).intDxy(_this.pointerRemainder, event.dX / _this.scale, event.dY / _this.scale), dX = _BB_intDxy.dX, dY = _BB_intDxy.dY;\n                    transformRight(dX);\n                    transformTop(dY);\n                    if (_this.keyListener.isPressed(\"shift\")) {\n                        transformLeft(-dX);\n                        transformBottom(-dY);\n                    }\n                    _this.update();\n                }\n                if (event.type === \"pointerup\") _this.commit();\n            }\n        });\n        //bottom right\n        this.corner2PointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.cornerElArr[2].el,\n            fixScribble: true,\n            onPointer: function(event) {\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    var _BB_intDxy = (0, $eWjiX.BB).intDxy(_this.pointerRemainder, event.dX / _this.scale, event.dY / _this.scale), dX = _BB_intDxy.dX, dY = _BB_intDxy.dY;\n                    transformRight(dX);\n                    transformBottom(dY);\n                    if (_this.keyListener.isPressed(\"shift\")) {\n                        transformLeft(-dX);\n                        transformTop(-dY);\n                    }\n                    _this.update();\n                }\n                if (event.type === \"pointerup\") _this.commit();\n            }\n        });\n        //bottom left\n        this.corner3PointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.cornerElArr[3].el,\n            fixScribble: true,\n            onPointer: function(event) {\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    var _BB_intDxy = (0, $eWjiX.BB).intDxy(_this.pointerRemainder, event.dX / _this.scale, event.dY / _this.scale), dX = _BB_intDxy.dX, dY = _BB_intDxy.dY;\n                    transformLeft(dX);\n                    transformBottom(dY);\n                    if (_this.keyListener.isPressed(\"shift\")) {\n                        transformRight(-dX);\n                        transformTop(-dY);\n                    }\n                    _this.update();\n                }\n                if (event.type === \"pointerup\") _this.commit();\n            }\n        });\n        this.rootEl.append(this.darken[1].el, this.darken[0].el, this.darken[2].el, this.darken[3].el, this.thirdsHorizontal.el, this.thirdsVertical.el, this.outline.el, this.edges[1].el, this.edges[0].el, this.edges[2].el, this.edges[3].el, this.cornerElArr[0].el, this.cornerElArr[1].el, this.cornerElArr[2].el, this.cornerElArr[3].el);\n        this.update();\n    }\n    (0, $7h4XF._)(Cropper, [\n        {\n            key: \"update\",\n            value: function update() {\n                this.edges[0].update();\n                this.edges[1].update();\n                this.edges[2].update();\n                this.edges[3].update();\n                this.cornerElArr[0].update();\n                this.cornerElArr[1].update();\n                this.cornerElArr[2].update();\n                this.cornerElArr[3].update();\n                this.darken[0].update();\n                this.darken[1].update();\n                this.darken[2].update();\n                this.darken[3].update();\n                this.outline.update();\n                this.thirdsHorizontal.update();\n                this.thirdsVertical.update();\n            }\n        },\n        {\n            key: \"commit\",\n            value: function commit() {\n                this.pointerRemainder.x = 0;\n                this.pointerRemainder.y = 0;\n                this.callback(this.getTransform());\n            }\n        },\n        {\n            // ---- interface ----\n            key: \"getTransform\",\n            value: function getTransform() {\n                this.grips[1].x -= this.grips[0].x;\n                this.grips[1].y -= this.grips[0].y;\n                this.grips[2].x -= this.grips[0].x;\n                this.grips[2].y -= this.grips[0].y;\n                this.grips[3].x -= this.grips[0].x;\n                this.grips[3].y -= this.grips[0].y;\n                this.x += this.grips[0].x;\n                this.y += this.grips[0].y;\n                this.grips[0].x = 0;\n                this.grips[0].y = 0;\n                return {\n                    x: this.x,\n                    y: this.y,\n                    width: this.grips[1].x,\n                    height: this.grips[2].y\n                };\n            }\n        },\n        {\n            key: \"setTransform\",\n            value: function setTransform(p) {\n                this.x = p.x;\n                this.y = p.y;\n                this.width = p.width;\n                this.height = p.height;\n                (0, $eWjiX.BB).css(this.rootEl, {\n                    left: this.x * this.scale + \"px\",\n                    top: this.y * this.scale + \"px\"\n                });\n                this.grips[0].x = 0;\n                this.grips[0].y = 0;\n                this.grips[1].x = this.width;\n                this.grips[1].y = 0;\n                this.grips[2].x = this.width;\n                this.grips[2].y = this.height;\n                this.grips[3].x = 0;\n                this.grips[3].y = this.height;\n                this.update();\n                this.commit();\n            }\n        },\n        {\n            key: \"setScale\",\n            value: function setScale(s) {\n                this.scale = s;\n                (0, $eWjiX.BB).css(this.rootEl, {\n                    left: this.x * this.scale + \"px\",\n                    top: this.y * this.scale + \"px\"\n                });\n                this.update();\n            }\n        },\n        {\n            key: \"showThirds\",\n            value: function showThirds(b) {\n                this.thirdsHorizontal.el.style.display = b ? \"block\" : \"none\";\n                this.thirdsVertical.el.style.display = b ? \"block\" : \"none\";\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.keyListener.destroy();\n                this.outlinePointerListener.destroy();\n                this.corner0PointerListener.destroy();\n                this.corner1PointerListener.destroy();\n                this.corner2PointerListener.destroy();\n                this.corner3PointerListener.destroy();\n                this.edge0PointerListener.destroy();\n                this.edge1PointerListener.destroy();\n                this.edge2PointerListener.destroy();\n                this.edge3PointerListener.destroy();\n            }\n        }\n    ]);\n    return Cropper;\n}();\n\n});\n\nparcelRequire.register(\"kqmpc\", function(module, exports) {\n\n$parcel$export(module.exports, \"LayerPreview\", function () { return $18e69c7d4cb991e8$export$d25420b53e16716f; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $1C8RU = parcelRequire(\"1C8RU\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $18e69c7d4cb991e8$export$d25420b53e16716f = /*#__PURE__*/ function() {\n    \"use strict\";\n    function LayerPreview(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, LayerPreview);\n        this.animationCanvasCheckerPattern = {};\n        this.largeCanvasCheckerPattern = {};\n        // internally redraws with in an interval. checks history is something changed\n        // this update will be animated\n        // it will not be animated if the resolution changed\n        // also redraws when you call updateLayer - not animated\n        // syncs via updateLayer, and internally updates layer opacity via a hack\n        this.rootEl = (0, $eWjiX.BB).el({\n            className: \"kl-layer-preview\"\n        });\n        this.isVisible = true;\n        this.height = 40;\n        this.canvasSize = this.height - 10;\n        this.largeCanvasSize = 300;\n        this.lastDrawnState = -2;\n        this.lastDrawnSize = {\n            width: 0,\n            height: 0\n        };\n        this.animationCanvas = (0, $eWjiX.BB).canvas(); // to help animate the transition\n        this.animationCanvasCtx = (0, $eWjiX.BB).ctx(this.animationCanvas);\n        this.animationLength = 30;\n        this.animationCount = 0;\n        this.largeCanvasIsVisible = false;\n        var largeCanvasAnimationTimeout;\n        var largeCanvasAnimationDurationMs = 300;\n        this.uiState = p.uiState;\n        // --- setup dom ---\n        this.contentWrapperEl = (0, $eWjiX.BB).el({\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                height: this.height + \"px\"\n            }\n        });\n        var checkWrapper = (0, $eWjiX.BB).el({\n            css: {\n                display: \"flex\",\n                justifyContent: \"flex-end\",\n                alignItems: \"center\",\n                width: \"23px\"\n            }\n        });\n        this.checkEl = (0, $eWjiX.BB).el({\n            parent: checkWrapper,\n            tagName: \"input\",\n            css: {\n                pointerEvents: \"none\"\n            },\n            custom: {\n                type: \"checkbox\",\n                disabled: \"true\"\n            }\n        });\n        var canvasWrapperEl = (0, $eWjiX.BB).el({\n            css: {\n                //background: '#f00',\n                minWidth: this.height + \"px\",\n                height: this.height + \"px\",\n                display: \"flex\",\n                justifyContent: \"center\",\n                alignItems: \"center\"\n            }\n        });\n        this.canvas = (0, $eWjiX.BB).canvas(this.canvasSize, this.canvasSize);\n        this.canvasCtx = (0, $eWjiX.BB).ctx(this.canvas);\n        this.canvas.title = (0, $1mH1z.LANG)(\"layers-active-layer\");\n        var nameWrapper = (0, $eWjiX.BB).el({\n            css: {\n                //background: '#ff0',\n                flexGrow: \"1\",\n                paddingLeft: \"10px\",\n                fontSize: \"13px\",\n                overflow: \"hidden\",\n                position: \"relative\"\n            }\n        });\n        this.nameLabelEl = (0, $eWjiX.BB).el({\n            content: \"\",\n            css: {\n                cssFloat: \"left\",\n                whiteSpace: \"nowrap\"\n            }\n        });\n        var clickableEl = (0, $eWjiX.BB).el({\n            css: {\n                // background: 'rgba(0,255,0,0.6)',\n                position: \"absolute\",\n                left: \"10px\",\n                top: \"0\",\n                width: \"90px\",\n                height: \"100%\"\n            }\n        });\n        if (p.onClick) {\n            clickableEl.addEventListener(\"click\", function() {\n                return p.onClick();\n            });\n            this.canvas.addEventListener(\"click\", function() {\n                return p.onClick();\n            });\n            checkWrapper.addEventListener(\"click\", function() {\n                return p.onClick();\n            });\n        }\n        this.opacityEl = (0, $eWjiX.BB).el({\n            content: (0, $1mH1z.LANG)(\"opacity\") + \"<br>100%\",\n            css: {\n                minWidth: \"60px\",\n                fontSize: \"12px\",\n                textAlign: \"center\"\n            }\n        });\n        this.largeCanvasWrapper = (0, $eWjiX.BB).el({\n            onClick: (0, $eWjiX.BB).handleClick,\n            css: {\n                pointerEvents: \"none\",\n                background: \"#fff\",\n                position: \"absolute\",\n                right: \"280px\",\n                top: \"10px\",\n                border: \"1px solid #aaa\",\n                boxShadow: \"1px 1px 3px rgba(0,0,0,0.3)\",\n                transition: \"opacity \" + largeCanvasAnimationDurationMs + \"ms ease-in-out\",\n                userSelect: \"none\",\n                display: \"block\",\n                webkitTouchCallout: \"none\"\n            }\n        });\n        this.largeCanvas = (0, $eWjiX.BB).canvas(this.largeCanvasSize, this.largeCanvasSize);\n        this.largeCanvasWrapper.append(this.largeCanvas);\n        this.largeCanvasCtx = (0, $eWjiX.BB).ctx(this.largeCanvas);\n        (0, $eWjiX.BB).css(this.largeCanvas, {\n            display: \"block\"\n        });\n        canvasWrapperEl.append(this.canvas);\n        nameWrapper.append(this.nameLabelEl, clickableEl);\n        this.contentWrapperEl.append(checkWrapper, canvasWrapperEl, nameWrapper, this.opacityEl);\n        this.rootEl.append(this.contentWrapperEl);\n        this.updateCheckerPatterns();\n        (0, $1C8RU.theme).addIsDarkListener(function() {\n            _this.updateCheckerPatterns();\n            _this.draw(true);\n        });\n        // --- update logic ---\n        // cross-fade done via 2 canvases (old and new state)\n        // both have checkerboard background drawn on them, both fully opaque\n        // -> no \"lighter\" is needed for accurate cross-fading\n        setInterval(function() {\n            if (!_this.layerObj) return;\n            var currentState = (0, $gWfkn.klHistory).getState();\n            if (currentState === _this.lastDrawnState) return;\n            //update opacity w hack\n            _this.layerObj.opacity = _this.layerObj.context.canvas.opacity;\n            _this.draw(false);\n        }, 2000);\n        var removeLargeCanvas = function() {\n            _this.largeCanvasWrapper.remove();\n        };\n        var showLargeCanvas = function(b) {\n            if (_this.largeCanvasIsVisible === b) return;\n            clearTimeout(largeCanvasAnimationTimeout);\n            _this.largeCanvasIsVisible = b;\n            if (b) largeCanvasAnimationTimeout = setTimeout(function() {\n                _this.drawLargeCanvas();\n                _this.largeCanvasWrapper.style.opacity = \"0\";\n                p.klRootEl.append(_this.largeCanvasWrapper);\n                setTimeout(function() {\n                    _this.largeCanvasWrapper.style.opacity = \"1\";\n                }, 20);\n            }, 250);\n            else {\n                _this.largeCanvasWrapper.style.opacity = \"0\";\n                largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\n            }\n        };\n        var pointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.canvas,\n            onEnterLeave: function(b) {\n                showLargeCanvas(b);\n            }\n        });\n    }\n    (0, $7h4XF._)(LayerPreview, [\n        {\n            key: \"updateCheckerPatterns\",\n            value: function updateCheckerPatterns() {\n                var checker = (0, $eWjiX.BB).createCheckerCanvas(4, (0, $1C8RU.theme).isDark());\n                this.animationCanvasCheckerPattern = (0, $7jh4K.throwIfNull)(this.animationCanvasCtx.createPattern(checker, \"repeat\"));\n                this.largeCanvasCheckerPattern = (0, $7jh4K.throwIfNull)(this.canvasCtx.createPattern(checker, \"repeat\"));\n            }\n        },\n        {\n            key: \"animate\",\n            value: function animate() {\n                var _this = this;\n                if (this.animationCount === 0) return;\n                this.animationCount--;\n                this.canvasCtx.save();\n                this.canvasCtx.globalAlpha = Math.pow((this.animationLength - this.animationCount) / this.animationLength, 2);\n                this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\n                this.canvasCtx.restore();\n                if (this.animationCount > 0) requestAnimationFrame(function() {\n                    return _this.animate();\n                });\n            }\n        },\n        {\n            key: \"drawLargeCanvas\",\n            value: /**\r\n     * is always instant\r\n     */ function drawLargeCanvas() {\n                if (!this.largeCanvasIsVisible || !this.layerObj) return;\n                var layerCanvas = this.layerObj.context.canvas;\n                var canvasDimensions = (0, $eWjiX.BB).fitInto(layerCanvas.width, layerCanvas.height, this.largeCanvasSize, this.largeCanvasSize, 1);\n                this.largeCanvas.width = Math.round(canvasDimensions.width);\n                this.largeCanvas.height = Math.round(canvasDimensions.height);\n                this.largeCanvasCtx.save();\n                if (this.largeCanvas.width > layerCanvas.width) this.largeCanvasCtx.imageSmoothingEnabled = false;\n                else {\n                    this.largeCanvasCtx.imageSmoothingEnabled = true;\n                    this.largeCanvasCtx.imageSmoothingQuality = \"high\";\n                }\n                this.largeCanvasCtx.fillStyle = this.largeCanvasCheckerPattern;\n                this.largeCanvasCtx.fillRect(0, 0, this.largeCanvas.width, this.largeCanvas.height);\n                this.largeCanvasCtx.drawImage(layerCanvas, 0, 0, this.largeCanvas.width, this.largeCanvas.height);\n                this.largeCanvasCtx.restore();\n                var bounds = this.rootEl.getBoundingClientRect();\n                (0, $eWjiX.BB).css(this.largeCanvasWrapper, {\n                    top: Math.max(10, bounds.top + this.height / 2 - this.largeCanvas.height / 2) + \"px\"\n                });\n            }\n        },\n        {\n            key: \"draw\",\n            value: function draw(isInstant) {\n                if (!this.isVisible || !this.layerObj) return;\n                var layerIsVisible = this.layerObj.isVisible;\n                this.checkEl.parentElement.title = layerIsVisible ? (0, $1mH1z.LANG)(\"layers-active-layer-visible\") : (0, $1mH1z.LANG)(\"layers-active-layer-hidden\");\n                this.checkEl.checked = layerIsVisible;\n                this.checkEl.style.boxShadow = layerIsVisible ? \"\" : \"0 0 0 1px red\";\n                this.nameLabelEl.textContent = this.layerObj.name;\n                if (this.layerObj.isVisible) this.opacityEl.innerHTML = (0, $1mH1z.LANG)(\"opacity\") + \"<br>\" + Math.round(this.layerObj.opacity * 100) + \"%\";\n                else this.opacityEl.innerHTML = (0, $1mH1z.LANG)(\"opacity\") + \"<br><s>\" + Math.round(this.layerObj.opacity * 100) + \"%</s>\";\n                var layerCanvas = this.layerObj.context.canvas;\n                if (layerCanvas.width !== this.lastDrawnSize.width || layerCanvas.height !== this.lastDrawnSize.height) {\n                    var canvasDimensions = (0, $eWjiX.BB).fitInto(layerCanvas.width, layerCanvas.height, this.canvasSize, this.canvasSize, 1);\n                    this.canvas.width = Math.round(canvasDimensions.width);\n                    this.canvas.height = Math.round(canvasDimensions.height);\n                    isInstant = true;\n                }\n                this.animationCanvas.width = this.canvas.width;\n                this.animationCanvas.height = this.canvas.height;\n                this.animationCanvasCtx.save();\n                this.animationCanvasCtx.imageSmoothingEnabled = false;\n                this.animationCanvasCtx.fillStyle = this.animationCanvasCheckerPattern;\n                this.animationCanvasCtx.fillRect(0, 0, this.animationCanvas.width, this.animationCanvas.height);\n                this.animationCanvasCtx.drawImage(layerCanvas, 0, 0, this.animationCanvas.width, this.animationCanvas.height);\n                this.animationCanvasCtx.restore();\n                if (isInstant) {\n                    this.animationCount = 0;\n                    this.canvasCtx.save();\n                    this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\n                    this.canvasCtx.restore();\n                } else {\n                    this.animationCount = this.animationLength;\n                    this.animate();\n                }\n                this.drawLargeCanvas();\n                this.lastDrawnState = (0, $gWfkn.klHistory).getState();\n                this.lastDrawnSize.width = layerCanvas.width;\n                this.lastDrawnSize.height = layerCanvas.height;\n            }\n        },\n        {\n            // ---- interface ----\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"setIsVisible\",\n            value: function setIsVisible(b) {\n                if (this.isVisible === b) return;\n                this.isVisible = b;\n                this.contentWrapperEl.style.display = this.isVisible ? \"flex\" : \"none\";\n                this.rootEl.style.marginBottom = this.isVisible ? \"\" : \"10px\";\n                var currentState = (0, $gWfkn.klHistory).getState();\n                if (b && this.lastDrawnState !== currentState) this.draw(true);\n            }\n        },\n        {\n            //when the layer might have changed\n            key: \"setLayer\",\n            value: function setLayer(klCanvasLayerObj) {\n                this.layerObj = klCanvasLayerObj;\n                this.draw(true);\n            }\n        },\n        {\n            key: \"setUiState\",\n            value: function setUiState(stateStr) {\n                this.uiState = stateStr;\n                if (this.uiState === \"left\") (0, $eWjiX.BB).css(this.largeCanvasWrapper, {\n                    left: \"280px\",\n                    right: \"\"\n                });\n                else (0, $eWjiX.BB).css(this.largeCanvasWrapper, {\n                    left: \"\",\n                    right: \"280px\"\n                });\n            }\n        }\n    ]);\n    return LayerPreview;\n}();\n\n});\n\nparcelRequire.register(\"8ebuX\", function(module, exports) {\n\n$parcel$export(module.exports, \"showImportAsLayerDialog\", function () { return $e3dfa43019bc3f08$export$962af7e240721d88; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $kEeSq = parcelRequire(\"kEeSq\");\n\nvar $2MaaK = parcelRequire(\"2MaaK\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nfunction $e3dfa43019bc3f08$export$962af7e240721d88(params) {\n    var move = function move(x, y) {\n        freeTransformCanvas.move(x, y);\n    };\n    var div = document.createElement(\"div\");\n    (0, $eWjiX.BB).appendTextDiv(div, (0, $1mH1z.LANG)(\"import-as-layer-description\"));\n    if (params.klCanvas.isLayerLimitReached()) {\n        var noteEl = (0, $eWjiX.BB).el({\n            content: (0, $1mH1z.LANG)(\"import-as-layer-limit-reached\"),\n            css: {\n                background: \"#ff0\",\n                padding: \"10px\",\n                marginTop: \"5px\",\n                marginBottom: \"5px\",\n                border: \"1px solid #e7d321\",\n                borderRadius: \"5px\"\n            }\n        });\n        div.append(noteEl);\n    }\n    var isSmall = window.innerWidth < 550;\n    var buttonRowEl = (0, $eWjiX.BB).el({\n        css: {\n            display: \"flex\"\n        }\n    });\n    var originalSizeBtn = (0, $eWjiX.BB).el({\n        tagName: \"button\",\n        content: \"1:1\",\n        css: {\n            marginRight: \"10px\"\n        },\n        onClick: function onClick() {\n            freeTransformCanvas.reset();\n        }\n    });\n    var fitSizeBtn = (0, $eWjiX.BB).el({\n        tagName: \"button\",\n        content: (0, $1mH1z.LANG)(\"import-as-layer-fit\"),\n        css: {\n            marginRight: \"10px\"\n        },\n        onClick: function onClick() {\n            freeTransformCanvas.setTransformFit();\n        }\n    });\n    var centerBtn = (0, $eWjiX.BB).el({\n        tagName: \"button\",\n        content: (0, $1mH1z.LANG)(\"center\"),\n        css: {\n            marginRight: \"10px\"\n        },\n        onClick: function onClick() {\n            freeTransformCanvas.setTransformCenter();\n        }\n    });\n    buttonRowEl.append(originalSizeBtn, fitSizeBtn, centerBtn);\n    div.append(buttonRowEl);\n    var layers = [];\n    {\n        var klCanvasLayerArr = params.klCanvas.getLayers();\n        for(var i = 0; i < klCanvasLayerArr.length; i++)layers.push({\n            image: klCanvasLayerArr[i].context.canvas,\n            isVisible: klCanvasLayerArr[i].isVisible,\n            opacity: klCanvasLayerArr[i].opacity,\n            mixModeStr: klCanvasLayerArr[i].mixModeStr\n        });\n    }\n    layers.push({\n        image: params.importImage,\n        isVisible: true,\n        opacity: 1,\n        mixModeStr: \"source-over\"\n    });\n    var freeTransformCanvas = new (0, $kEeSq.FreeTransformCanvas)({\n        elementWidth: isSmall ? 340 : 540,\n        elementHeight: isSmall ? 280 : 350,\n        imageWidth: params.klCanvas.getLayerContext(0).canvas.width,\n        imageHeight: params.klCanvas.getLayerContext(0).canvas.height,\n        layers: layers,\n        transformIndex: layers.length - 1\n    });\n    (0, $eWjiX.BB).css(freeTransformCanvas.getElement(), {\n        marginTop: \"10px\",\n        marginLeft: \"-20px\"\n    });\n    div.append(freeTransformCanvas.getElement());\n    var keyListener = new (0, $eWjiX.BB).KeyListener({\n        onDown: function onDown(keyStr) {\n            if (keyStr === \"left\") move(-1, 0);\n            if (keyStr === \"right\") move(1, 0);\n            if (keyStr === \"up\") move(0, -1);\n            if (keyStr === \"down\") move(0, 1);\n        }\n    });\n    (0, $2MaaK.showModal)({\n        target: params.target,\n        message: \"<b>\".concat((0, $1mH1z.LANG)(\"import-as-layer-title\"), \"</b>\"),\n        div: div,\n        style: isSmall ? undefined : {\n            width: \"540px\"\n        },\n        buttons: [\n            \"Ok\",\n            \"Cancel\"\n        ],\n        clickOnEnter: \"Ok\",\n        callback: function callback(buttonStr) {\n            keyListener.destroy();\n            freeTransformCanvas.destroy();\n            (0, $eWjiX.BB).destroyEl(originalSizeBtn);\n            (0, $eWjiX.BB).destroyEl(fitSizeBtn);\n            (0, $eWjiX.BB).destroyEl(centerBtn);\n            if (buttonStr === \"Ok\") params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\n            else params.callback();\n        }\n    });\n}\n\n});\n\nparcelRequire.register(\"13r5y\", function(module, exports) {\n\n$parcel$export(module.exports, \"KlImageDropper\", function () { return $01cb8095758db224$export$e789742143ba5b1; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $01cb8095758db224$export$e789742143ba5b1 = function KlImageDropper(p) {\n    \"use strict\";\n    var _this = this;\n    (0, $cx0mh._)(this, KlImageDropper);\n    //set up DOM\n    this.rootEl = (0, $eWjiX.BB).el({\n        content: \"Drop to import\",\n        css: {\n            paddingTop: \"100px\",\n            position: \"fixed\",\n            left: \"0\",\n            top: \"0\",\n            width: \"100%\",\n            height: \"100%\",\n            background: \"rgba(50, 50, 50, 0.7)\",\n            color: \"#fff\",\n            textShadow: \"2px 2px #000\",\n            textAlign: \"center\",\n            fontSize: \"25px\"\n        }\n    });\n    var wrapperEl = (0, $eWjiX.BB).el({\n        css: {\n            \"marginTop\": \"50px\",\n            \"display\": \"flex\",\n            \"justifyContent\": \"center\"\n        }\n    });\n    var optionStyle = {\n        width: \"200px\",\n        padding: \"50px\",\n        margin: \"10px\",\n        //opacity: 0.5,\n        borderRadius: \"20px\",\n        border: \"1px dashed #fff\",\n        background: \"#00aefe\",\n        fontWeight: \"bold\"\n    };\n    var optionLayerEl = (0, $eWjiX.BB).el({\n        content: \"As Layer\",\n        css: optionStyle\n    });\n    var optionImageEl = (0, $eWjiX.BB).el({\n        content: \"As New Image\",\n        css: optionStyle\n    });\n    this.rootEl.append(wrapperEl);\n    wrapperEl.append(optionLayerEl, optionImageEl);\n    var rootCounter = 0;\n    var optionLayerCounter = 0;\n    var optionImageCounter = 0;\n    var destroy = function() {\n        rootCounter = 0;\n        optionLayerCounter = 0;\n        optionImageCounter = 0;\n        _this.rootEl.remove();\n    };\n    /**\r\n         * check, can drop content be imported\r\n         */ var testAcceptType = function(event) {\n        return !!event.dataTransfer && !event.dataTransfer.types.includes(\"text/plain\");\n    };\n    var updateOptions = function() {\n        var boxShadow = \"0 0 20px 4px #fff\";\n        if (optionLayerCounter > 0) {\n            optionLayerEl.style.boxShadow = boxShadow;\n            optionImageEl.style.boxShadow = \"\";\n        } else if (optionImageCounter > 0) {\n            optionLayerEl.style.boxShadow = \"\";\n            optionImageEl.style.boxShadow = boxShadow;\n        } else {\n            optionLayerEl.style.boxShadow = \"\";\n            optionImageEl.style.boxShadow = \"\";\n        }\n    };\n    optionLayerEl.addEventListener(\"dragenter\", function() {\n        optionLayerCounter++;\n        updateOptions();\n    });\n    optionLayerEl.addEventListener(\"dragleave\", function() {\n        optionLayerCounter--;\n        updateOptions();\n    });\n    optionImageEl.addEventListener(\"dragenter\", function() {\n        optionImageCounter++;\n        updateOptions();\n    });\n    optionImageEl.addEventListener(\"dragleave\", function() {\n        optionImageCounter--;\n        updateOptions();\n    });\n    var rootDragOver = function(event) {\n        if (!testAcceptType(event)) return;\n        event.stopPropagation();\n        event.preventDefault();\n    };\n    var rootDragEnter = function(event) {\n        if (!p.enabledTest() || !testAcceptType(event)) return;\n        if (rootCounter === 0) p.target.append(_this.rootEl);\n        rootCounter++;\n    };\n    var rootDragLeave = function(event) {\n        if (!testAcceptType(event) || rootCounter === 0) return;\n        rootCounter = Math.max(0, rootCounter - 1);\n        if (rootCounter === 0) _this.rootEl.remove();\n    };\n    var rootDrop = function(event) {\n        if (!testAcceptType(event) || !event.dataTransfer || event.dataTransfer.files.length === 0) {\n            destroy();\n            return;\n        }\n        event.stopPropagation();\n        event.preventDefault();\n        var optionStr = \"default\";\n        if (optionLayerCounter > 0) optionStr = \"layer\";\n        else if (optionImageCounter > 0) optionStr = \"image\";\n        p.onDrop(event.dataTransfer.files, optionStr);\n        if (rootCounter > 0) _this.rootEl.remove();\n        rootCounter = 0;\n        optionLayerCounter = 0;\n        optionImageCounter = 0;\n        updateOptions();\n    };\n    window.addEventListener(\"dragover\", rootDragOver, false);\n    window.addEventListener(\"dragenter\", rootDragEnter, false);\n    window.addEventListener(\"dragleave\", rootDragLeave, false);\n    window.addEventListener(\"drop\", rootDrop, false);\n    // if something goes wrong and you're stuck with overlay\n    this.rootEl.addEventListener(\"pointerdown\", function() {\n        destroy();\n    });\n    var keyListener = new (0, $eWjiX.BB).KeyListener({\n        onDown: function(keyStr) {\n            if (rootCounter > 0 && keyStr === \"esc\") destroy();\n        }\n    });\n};\n\n});\n\nparcelRequire.register(\"9p4Zp\", function(module, exports) {\n\n$parcel$export(module.exports, \"OverlayToolspace\", function () { return $d6fe881e8fc421ac$export$9f0da9b942594e99; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $gmji4 = parcelRequire(\"gmji4\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $d6fe881e8fc421ac$export$9f0da9b942594e99 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function OverlayToolspace(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, OverlayToolspace);\n        var sizeObj = {\n            width: 150,\n            svHeight: 90,\n            hHeight: 20,\n            sliderHeight: 25\n        };\n        var isVisible = false;\n        this.rootEl = (0, $eWjiX.BB).el({\n            className: \"kl-overlay-toolspace\"\n        });\n        var queuedObj = {\n            color: null,\n            size: null,\n            opacity: null\n        };\n        // --- inputs ---\n        //color selection\n        var colorEl = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            className: \"kl-overlay-toolspace__color\"\n        });\n        var colorSlider = new (0, $gmji4.KlColorSliderSmall)({\n            width: sizeObj.width,\n            heightSV: sizeObj.svHeight,\n            heightH: sizeObj.hHeight,\n            color: p.brushSettingService.getColor(),\n            callback: function(rgbObj) {\n                selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\n                p.brushSettingService.setColor(rgbObj, subscriptionFunc);\n            }\n        });\n        var selectedColorEl = (0, $eWjiX.BB).el({\n            css: {\n                width: sizeObj.width + \"px\",\n                height: sizeObj.hHeight + \"px\",\n                pointerEvents: \"none\"\n            }\n        });\n        {\n            var initialColor = p.brushSettingService.getColor();\n            selectedColorEl.style.backgroundColor = \"rgb(\" + initialColor.r + \",\" + initialColor.g + \",\" + initialColor.b + \")\";\n        }\n        colorEl.append(selectedColorEl, colorSlider.getElement());\n        var updateColor = function(rgbObj) {\n            colorSlider.setColor(rgbObj);\n            selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\n        };\n        //brushsize slider\n        var sizeSlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"brush-size\"),\n            width: sizeObj.width,\n            height: sizeObj.sliderHeight,\n            min: 0,\n            max: 500,\n            value: 50,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toDisplayValue: function(val) {\n                return val * 2;\n            },\n            toValue: function(displayValue) {\n                return displayValue / 2;\n            },\n            onChange: function(v) {\n                p.brushSettingService.setSize(v);\n            },\n            formatFunc: function(displayValue) {\n                if (displayValue < 10) return (0, $eWjiX.BB).round(displayValue, 1);\n                else return Math.round(displayValue);\n            }\n        });\n        (0, $eWjiX.BB).css(sizeSlider.getElement(), {\n            marginTop: \"2px\"\n        });\n        var opacitySlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"opacity\"),\n            width: sizeObj.width,\n            height: sizeObj.sliderHeight,\n            min: 0,\n            max: 1,\n            value: 1,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toDisplayValue: function(val) {\n                return val * 100;\n            },\n            toValue: function(displayValue) {\n                return displayValue / 100;\n            },\n            onChange: function(v) {\n                p.brushSettingService.setOpacity(v);\n            }\n        });\n        (0, $eWjiX.BB).css(opacitySlider.getElement(), {\n            margin: \"2px 0\"\n        });\n        this.rootEl.append(sizeSlider.getElement(), opacitySlider.getElement());\n        // --- general setup ---\n        var subscriptionFunc = function(event) {\n            if (event.type === \"color\") {\n                if (!isVisible) queuedObj.color = event.value;\n                else updateColor(event.value);\n            }\n            if (event.type === \"size\") {\n                if (!isVisible) queuedObj.size = event.value;\n                else sizeSlider.setValue(event.value);\n            }\n            if (event.type === \"opacity\") {\n                if (!isVisible) queuedObj.opacity = event.value;\n                else opacitySlider.setValue(event.value);\n            }\n            if (event.type === \"sliderConfig\") {\n                sizeSlider.update(event.value.sizeSlider);\n                opacitySlider.update(event.value.opacitySlider);\n            }\n        };\n        p.brushSettingService.subscribe(subscriptionFunc);\n        {\n            var sliderConfig = p.brushSettingService.getSliderConfig();\n            sizeSlider.update(sliderConfig.sizeSlider);\n            opacitySlider.update(sliderConfig.opacitySlider);\n            sizeSlider.setValue(p.brushSettingService.getSize());\n            opacitySlider.setValue(p.brushSettingService.getOpacity());\n        }\n        var updateUI = function() {\n            // unfocus manual slider input\n            (0, $eWjiX.BB).unfocusAnyInput();\n            _this.rootEl.style.display = isVisible ? \"block\" : \"none\";\n            if (isVisible && mousePos) (0, $eWjiX.BB).css(_this.rootEl, {\n                left: mousePos.x - Math.round(sizeObj.width / 2) + \"px\",\n                top: mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2) + \"px\"\n            });\n        };\n        var mousePos = null;\n        document.addEventListener(\"pointermove\", function(event) {\n            mousePos = {\n                x: event.pageX,\n                y: event.pageY\n            };\n        });\n        var keyListener = new (0, $eWjiX.BB).KeyListener({\n            onDown: function(keyStr, event, comboStr, isRepeat) {\n                if (isRepeat) return;\n                if (isVisible) {\n                    isVisible = false;\n                    updateUI();\n                    return;\n                }\n                if (!p.enabledTest() || !mousePos) return;\n                if ([\n                    \"ctrl+alt\",\n                    \"cmd+alt\",\n                    \"alt+ctrl\",\n                    \"alt+cmd\"\n                ].includes(comboStr)) {\n                    event.preventDefault();\n                    isVisible = true;\n                    if (queuedObj.color !== null) {\n                        updateColor(queuedObj.color);\n                        queuedObj.color = null;\n                    }\n                    if (queuedObj.size !== null) {\n                        sizeSlider.setValue(queuedObj.size);\n                        queuedObj.size = null;\n                    }\n                    if (queuedObj.opacity !== null) {\n                        opacitySlider.setValue(queuedObj.opacity);\n                        queuedObj.opacity = null;\n                    }\n                    updateUI();\n                }\n            },\n            onUp: function(keyStr, event, oldComboStr) {\n                if ([\n                    \"ctrl+alt\",\n                    \"cmd+alt\",\n                    \"alt+ctrl\",\n                    \"alt+cmd\"\n                ].includes(oldComboStr) && isVisible) {\n                    isVisible = false;\n                    colorSlider.end();\n                    updateUI();\n                }\n            },\n            onBlur: function() {\n                if (isVisible) {\n                    isVisible = false;\n                    colorSlider.end();\n                    updateUI();\n                }\n            }\n        });\n    }\n    (0, $7h4XF._)(OverlayToolspace, [\n        {\n            // ---- interface ----\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        }\n    ]);\n    return OverlayToolspace;\n}();\n\n});\n\nparcelRequire.register(\"8jqzp\", function(module, exports) {\n\n$parcel$export(module.exports, \"ToolspaceTopRow\", function () { return $6003e73b8cbb69e2$export$665d2c76b1eb8459; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $kX3t5 = parcelRequire(\"kX3t5\");\n\nvar $frUlg = parcelRequire(\"frUlg\");\n\nvar $7qUeg = parcelRequire(\"7qUeg\");\n\nvar $g2tQ8 = parcelRequire(\"g2tQ8\");\n\nvar $cmBTx = parcelRequire(\"cmBTx\");\n\nvar $8pc1M = parcelRequire(\"8pc1M\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $6003e73b8cbb69e2$export$665d2c76b1eb8459 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function ToolspaceTopRow(p) {\n        (0, $cx0mh._)(this, ToolspaceTopRow);\n        var createButton = function createButton(p) {\n            var padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n            var el = (0, $eWjiX.BB).el({\n                className: \"toolspace-row-button nohighlight\",\n                title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.contain ? padding + \"px 0\" : \"\"\n                }\n            });\n            var im = (0, $eWjiX.BB).el({\n                className: p.darkInvert ? \"dark-invert\" : undefined,\n                css: {\n                    backgroundImage: \"url('\" + p.image + \"')\",\n                    backgroundRepeat: \"no-repeat\",\n                    backgroundPosition: \"center\",\n                    backgroundSize: p.contain ? \"contain\" : \"\",\n                    //filter: 'grayscale(1)',\n                    height: \"100%\"\n                }\n            });\n            im.style.pointerEvents = \"none\";\n            el.append(im);\n            var pointerListener = new (0, $eWjiX.BB).PointerListener({\n                target: el,\n                onEnterLeave: function onEnterLeave(isOver) {\n                    el.classList.toggle(\"toolspace-row-button-hover\", isOver);\n                }\n            });\n            return {\n                el: el,\n                pointerListener: pointerListener\n            };\n        };\n        this.rootEl = (0, $eWjiX.BB).el({\n            className: \"kl-toolspace-row\",\n            css: {\n                height: \"36px\",\n                display: \"flex\"\n            }\n        });\n        var logoButton = createButton({\n            onClick: p.onLogo,\n            title: (0, $1mH1z.LANG)(\"home\"),\n            image: p.logoImg ? p.logoImg : (0, (/*@__PURE__*/$parcel$interopDefault($kX3t5))),\n            contain: true,\n            darkInvert: true\n        });\n        logoButton.el.classList.add(\"kl-tool-row-border-right\");\n        (0, $eWjiX.BB).css(logoButton.el, {\n            width: \"46px\"\n        });\n        var newButton = createButton({\n            onClick: p.onNew,\n            title: (0, $1mH1z.LANG)(\"file-new\"),\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($frUlg))),\n            extraPadding: 1,\n            contain: true\n        });\n        var importButton = createButton({\n            onClick: p.onImport,\n            title: (0, $1mH1z.LANG)(\"file-import\"),\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($7qUeg))),\n            extraPadding: 1,\n            contain: true\n        });\n        var saveButton = createButton({\n            onClick: p.onSave,\n            title: (0, $1mH1z.LANG)(\"file-save\"),\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($g2tQ8))),\n            extraPadding: 1,\n            contain: true\n        });\n        var shareButton = null;\n        if ((0, $eWjiX.BB).canShareFiles()) shareButton = createButton({\n            onClick: p.onShare,\n            title: (0, $1mH1z.LANG)(\"file-share\"),\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($cmBTx))),\n            contain: true,\n            darkInvert: true\n        });\n        var helpButton = createButton({\n            onClick: p.onHelp,\n            title: (0, $1mH1z.LANG)(\"help\"),\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($8pc1M))),\n            contain: true,\n            darkInvert: true\n        });\n        (0, $eWjiX.BB).append(this.rootEl, [\n            logoButton.el,\n            newButton.el,\n            importButton.el,\n            saveButton.el,\n            shareButton ? shareButton.el : undefined,\n            helpButton.el\n        ]);\n    }\n    (0, $7h4XF._)(ToolspaceTopRow, [\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        }\n    ]);\n    return ToolspaceTopRow;\n}();\n\n});\nparcelRequire.register(\"kX3t5\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"6Sfz2\");\n\n});\n\nparcelRequire.register(\"frUlg\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"eaJmh\");\n\n});\n\nparcelRequire.register(\"7qUeg\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"kV8IH\");\n\n});\n\nparcelRequire.register(\"g2tQ8\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"SROeX\");\n\n});\n\nparcelRequire.register(\"cmBTx\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"lFrok\");\n\n});\n\nparcelRequire.register(\"8pc1M\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"cvYlU\");\n\n});\n\n\nparcelRequire.register(\"84zxV\", function(module, exports) {\n\n$parcel$export(module.exports, \"ToolDropdown\", function () { return $18c597dee53260ff$export$a0a40f8a0b8fee15; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $i8UFO = parcelRequire(\"i8UFO\");\n\nvar $8dsYZ = parcelRequire(\"8dsYZ\");\n\nvar $6iPxE = parcelRequire(\"6iPxE\");\n\nvar $fZtJh = parcelRequire(\"fZtJh\");\n\nvar $eOZOu = parcelRequire(\"eOZOu\");\n\nvar $haxur = parcelRequire(\"haxur\");\n\nvar $32WFC = parcelRequire(\"32WFC\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $18c597dee53260ff$export$a0a40f8a0b8fee15 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function ToolDropdown(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, ToolDropdown);\n        this.smallMargin = \"6px 0\";\n        this.optionArr = [\n            \"draw\",\n            \"fill\",\n            \"gradient\",\n            \"text\",\n            \"shape\"\n        ];\n        this.imArr = [\n            (0, (/*@__PURE__*/$parcel$interopDefault($8dsYZ))),\n            (0, (/*@__PURE__*/$parcel$interopDefault($6iPxE))),\n            (0, (/*@__PURE__*/$parcel$interopDefault($fZtJh))),\n            (0, (/*@__PURE__*/$parcel$interopDefault($eOZOu))),\n            (0, (/*@__PURE__*/$parcel$interopDefault($haxur)))\n        ];\n        this.titleArr = [\n            \"\".concat((0, $1mH1z.LANG)(\"tool-brush\"), \" [B]\"),\n            \"\".concat((0, $1mH1z.LANG)(\"tool-paint-bucket\"), \" [G]\"),\n            \"\".concat((0, $1mH1z.LANG)(\"tool-gradient\"), \" [G]\"),\n            \"\".concat((0, $1mH1z.LANG)(\"tool-text\"), \" [T]\"),\n            \"\".concat((0, $1mH1z.LANG)(\"tool-shape\"), \" [U]\")\n        ];\n        this.currentActiveIndex = 0;\n        this.isActive = true;\n        var isOpen = false;\n        //preload images\n        setTimeout(function() {\n            for(var i = 1; i < _this.imArr.length; i++){\n                var im = new Image();\n                im.src = _this.imArr[i];\n            }\n        }, 100);\n        this.rootEl = (0, $eWjiX.BB).el({\n            css: {\n                position: \"relative\",\n                flexGrow: \"1\"\n            }\n        });\n        var openTimeout;\n        var isDragging = false;\n        var startX;\n        var startY;\n        var pointerListener;\n        if ((0, $eWjiX.BB).hasPointerEvents) pointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.rootEl,\n            onPointer: function(event) {\n                if (event.type === \"pointerdown\") {\n                    if (isOpen) return;\n                    openTimeout = setTimeout(function() {\n                        showDropdown();\n                    }, 400);\n                    isDragging = true;\n                    startX = event.pageX;\n                    startY = event.pageY;\n                } else if (event.type === \"pointermove\") {\n                    if (isDragging && !isOpen && (0, $eWjiX.BB).dist(startX, startY, event.pageX, event.pageY) > 5) {\n                        clearTimeout(openTimeout);\n                        showDropdown();\n                    }\n                } else if (event.type === \"pointerup\") {\n                    clearTimeout(openTimeout);\n                    if (isOpen && isDragging) {\n                        var target = document.elementFromPoint(event.pageX, event.pageY);\n                        for(var i = 0; i < _this.dropdownBtnArr.length; i++)if (target === _this.dropdownBtnArr[i].wrapper) {\n                            closeDropdown();\n                            _this.isActive = true;\n                            _this.currentActiveIndex = i;\n                            _this.updateButton();\n                            p.onChange(_this.optionArr[_this.currentActiveIndex]);\n                            break;\n                        }\n                    }\n                    isDragging = false;\n                }\n            }\n        });\n        this.activeButton = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            className: \"toolspace-row-button nohighlight toolspace-row-button-activated\",\n            title: this.titleArr[this.currentActiveIndex],\n            onClick: function(e) {\n                if (_this.isActive && !isOpen) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    showDropdown();\n                    return;\n                }\n                _this.isActive = true;\n                p.onChange(_this.optionArr[_this.currentActiveIndex]);\n                if (isOpen) closeDropdown();\n            },\n            css: {\n                padding: \"10px 0\",\n                pointerEvents: \"auto\",\n                height: \"100%\",\n                boxSizing: \"border-box\"\n            }\n        });\n        this.activeButtonIm = (0, $eWjiX.BB).el({\n            parent: this.activeButton,\n            className: \"dark-invert\",\n            css: {\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"center\",\n                backgroundSize: \"contain\",\n                width: \"calc(100% - 7px)\",\n                height: \"100%\",\n                pointerEvents: \"none\",\n                opacity: \"0.75\"\n            }\n        });\n        this.arrowButton = (0, $eWjiX.BB).el({\n            parent: this.activeButton,\n            className: \"dark-invert\",\n            css: {\n                position: \"absolute\",\n                right: \"1px\",\n                bottom: \"1px\",\n                width: \"18px\",\n                height: \"18px\",\n                //background: '#aaa',\n                //borderRadius: '2px',\n                cursor: \"pointer\",\n                backgroundImage: \"url('\" + (0, (/*@__PURE__*/$parcel$interopDefault($32WFC))) + \"')\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"center\",\n                backgroundSize: \"60%\"\n            },\n            title: \"More Tools\",\n            onClick: function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                showDropdown();\n            }\n        });\n        var overlay = (0, $eWjiX.BB).el({\n            css: {\n                position: \"absolute\",\n                //background: 'rgba(255,0,0,0.5)',\n                left: \"0\",\n                top: \"0\",\n                right: \"0\",\n                bottom: \"0\"\n            }\n        });\n        var overlayPointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: overlay,\n            onPointer: function(e) {\n                if (e.type === \"pointerdown\") {\n                    e.eventPreventDefault();\n                    closeDropdown();\n                }\n            }\n        });\n        var dropdownWrapper = (0, $eWjiX.BB).el({\n            className: \"tool-dropdown-wrapper\",\n            css: {\n                position: \"absolute\",\n                width: \"100%\",\n                height: 100 * (this.optionArr.length - 1) + \"%\",\n                top: \"100%\",\n                left: \"0\",\n                zIndex: \"1\",\n                boxSizing: \"border-box\",\n                cursor: \"pointer\",\n                transition: \"height 0.1s ease-in-out, opacity 0.1s ease-in-out\",\n                borderBottomLeftRadius: \"5px\",\n                borderBottomRightRadius: \"5px\",\n                overflow: \"hidden\"\n            }\n        });\n        this.dropdownBtnArr = [];\n        var createDropdownButton = function(p) {\n            var wrapper = (0, $eWjiX.BB).el({\n                parent: dropdownWrapper,\n                className: \"tool-dropdown-button\",\n                title: p.title,\n                css: {\n                    padding: \"10px 0\",\n                    height: 100 / (_this.optionArr.length - 1) + \"%\",\n                    boxSizing: \"border-box\"\n                },\n                onClick: function(e) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    p.onClick(p.index);\n                }\n            });\n            (0, $eWjiX.BB).el({\n                parent: wrapper,\n                className: \"dark-invert\",\n                css: {\n                    backgroundImage: \"url('\" + p.image + \"')\",\n                    backgroundRepeat: \"no-repeat\",\n                    backgroundPosition: \"center\",\n                    backgroundSize: \"contain\",\n                    height: \"100%\",\n                    pointerEvents: \"none\",\n                    opacity: \"0.75\"\n                }\n            });\n            // --- interface ---\n            var show = function(b) {\n                wrapper.style.display = b ? \"block\" : \"none\";\n            };\n            var setIsSmall = function(b) {\n                wrapper.style.padding = b ? _this.smallMargin : \"10px 0\";\n            };\n            return {\n                wrapper: wrapper,\n                show: show,\n                setIsSmall: setIsSmall\n            };\n        };\n        var onClickDropdownBtn = function(index) {\n            closeDropdown();\n            _this.isActive = true;\n            _this.currentActiveIndex = index;\n            _this.updateButton();\n            p.onChange(_this.optionArr[_this.currentActiveIndex]);\n        };\n        for(var i = 0; i < this.optionArr.length; i++)this.dropdownBtnArr.push(createDropdownButton({\n            index: i,\n            id: this.optionArr[i],\n            image: this.imArr[i],\n            title: this.titleArr[i],\n            onClick: onClickDropdownBtn\n        }));\n        var showDropdown = function() {\n            (0, $i8UFO.dialogCounter).increase(0.5);\n            isOpen = true;\n            for(var i = 0; i < _this.optionArr.length; i++)_this.dropdownBtnArr[i].show(_this.currentActiveIndex !== i);\n            _this.arrowButton.style.display = \"none\";\n            _this.rootEl.style.zIndex = \"1\";\n            document.body.append(overlay);\n            _this.rootEl.append(dropdownWrapper);\n        };\n        var closeDropdown = function() {\n            (0, $i8UFO.dialogCounter).decrease(0.5);\n            isOpen = false;\n            _this.arrowButton.style.removeProperty(\"display\");\n            _this.rootEl.style.removeProperty(\"z-index\");\n            overlay.remove();\n            dropdownWrapper.remove();\n        };\n        this.updateButton();\n    }\n    (0, $7h4XF._)(ToolDropdown, [\n        {\n            key: \"updateButton\",\n            value: function updateButton() {\n                this.activeButton.title = this.titleArr[this.currentActiveIndex];\n                this.activeButtonIm.style.backgroundImage = \"url('\" + this.imArr[this.currentActiveIndex] + \"')\";\n            }\n        },\n        {\n            // ---- interface ----\n            key: \"setIsSmall\",\n            value: function setIsSmall(b) {\n                this.activeButton.style.padding = b ? this.smallMargin : \"10px 0\";\n                for(var i = 0; i < this.optionArr.length; i++)this.dropdownBtnArr[i].setIsSmall(b);\n                if (b) {\n                    this.arrowButton.style.width = \"14px\";\n                    this.arrowButton.style.height = \"14px\";\n                } else {\n                    this.arrowButton.style.width = \"18px\";\n                    this.arrowButton.style.height = \"18px\";\n                }\n            }\n        },\n        {\n            key: \"setActive\",\n            value: function setActive(activeStr) {\n                if (this.optionArr.includes(activeStr)) {\n                    this.isActive = true;\n                    for(var i = 0; i < this.optionArr.length; i++)if (this.optionArr[i] === activeStr) {\n                        this.currentActiveIndex = i;\n                        break;\n                    }\n                    this.activeButton.classList.add(\"toolspace-row-button-activated\");\n                    this.updateButton();\n                } else {\n                    this.isActive = false;\n                    this.activeButton.classList.remove(\"toolspace-row-button-activated\");\n                }\n            }\n        },\n        {\n            key: \"getActive\",\n            value: function getActive() {\n                return this.optionArr[this.currentActiveIndex];\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        }\n    ]);\n    return ToolDropdown;\n}();\n\n});\nparcelRequire.register(\"8dsYZ\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"dW3eU\");\n\n});\n\nparcelRequire.register(\"6iPxE\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"fnumN\");\n\n});\n\nparcelRequire.register(\"fZtJh\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"6J8A8\");\n\n});\n\nparcelRequire.register(\"eOZOu\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"da34V\");\n\n});\n\nparcelRequire.register(\"haxur\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"eStsa\");\n\n});\n\nparcelRequire.register(\"32WFC\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"eW5wL\");\n\n});\n\n\nparcelRequire.register(\"9Kxky\", function(module, exports) {\n\n$parcel$export(module.exports, \"ToolspaceToolRow\", function () { return $a372d78c806cd0cc$export$c744a22bef9e0b97; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $84zxV = parcelRequire(\"84zxV\");\n\nvar $4sBxW = parcelRequire(\"4sBxW\");\n\nvar $fORLP = parcelRequire(\"fORLP\");\n\nvar $kRxRZ = parcelRequire(\"kRxRZ\");\n\nvar $5ZTVn = parcelRequire(\"5ZTVn\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $a372d78c806cd0cc$export$c744a22bef9e0b97 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function ToolspaceToolRow(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, ToolspaceToolRow);\n        this.rootEl = (0, $eWjiX.BB).el({\n            className: \"kl-toolspace-row\",\n            css: {\n                height: \"54px\",\n                display: \"flex\"\n            }\n        });\n        this.onActivate = p.onActivate;\n        this.currentActiveStr = \"draw\"; // 'draw' | 'hand' | 'fill'\n        var createButton = function(p) {\n            var smallMargin = p.doLighten ? \"6px 0\" : \"8px 0\";\n            var el = (0, $eWjiX.BB).el({\n                className: \"toolspace-row-button nohighlight\",\n                //title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.contain ? \"10px 0\" : \"\"\n                }\n            });\n            var im = (0, $eWjiX.BB).el({\n                className: \"dark-invert\",\n                css: {\n                    backgroundImage: \"url('\" + p.image + \"')\",\n                    backgroundRepeat: \"no-repeat\",\n                    backgroundPosition: \"center\",\n                    backgroundSize: p.contain ? \"contain\" : \"\",\n                    //filter: 'grayscale(1)',\n                    height: \"100%\",\n                    transform: p.doMirror ? \"scale(-1, 1)\" : \"\",\n                    pointerEvents: \"none\",\n                    opacity: p.doLighten ? \"0.75\" : \"1\"\n                }\n            });\n            el.append(im);\n            var pointerListener = new (0, $eWjiX.BB).PointerListener({\n                target: el,\n                onEnterLeave: function(isOver) {\n                    el.classList.toggle(\"toolspace-row-button-hover\", isOver);\n                }\n            });\n            var setIsSmall = function(b) {\n                el.style.padding = p.contain ? b ? smallMargin : \"10px 0\" : \"\";\n            };\n            return {\n                el: el,\n                pointerListener: pointerListener,\n                setIsSmall: setIsSmall\n            };\n        };\n        var createTriangleButton = function(p) {\n            var result = (0, $eWjiX.BB).el({\n                css: {\n                    flexGrow: \"1\",\n                    position: \"relative\"\n                }\n            });\n            var svg = (0, $eWjiX.BB).createSvg({\n                elementType: \"svg\",\n                width: \"67px\",\n                height: \"54px\",\n                viewBox: \"0 0 100 100\",\n                preserveAspectRatio: \"none\"\n            });\n            (0, $eWjiX.BB).css(svg, {\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\"\n            });\n            var blurRadius = 10;\n            var blurOffsetX = 2;\n            var blurOffsetY = 2;\n            var defs = (0, $eWjiX.BB).createSvg({\n                elementType: \"defs\",\n                childrenArr: [\n                    {\n                        elementType: \"filter\",\n                        id: \"innershadow\",\n                        x0: \"-50%\",\n                        y0: \"-50%\",\n                        width: \"200%\",\n                        height: \"200%\",\n                        childrenArr: [\n                            {\n                                elementType: \"feGaussianBlur\",\n                                in: \"SourceAlpha\",\n                                stdDeviation: \"\" + blurRadius,\n                                result: \"blur\"\n                            },\n                            {\n                                elementType: \"feOffset\",\n                                dx: \"\" + blurOffsetX,\n                                dy: \"\" + blurOffsetY\n                            },\n                            {\n                                elementType: \"feComposite\",\n                                in2: \"SourceAlpha\",\n                                operator: \"arithmetic\",\n                                k2: \"-1\",\n                                k3: \"1\",\n                                result: \"shadowDiff\"\n                            },\n                            {\n                                elementType: \"feFlood\",\n                                \"flood-color\": \"#000\",\n                                \"flood-opacity\": \"0.2\"\n                            },\n                            {\n                                elementType: \"feComposite\",\n                                in2: \"shadowDiff\",\n                                operator: \"in\"\n                            },\n                            {\n                                elementType: \"feComposite\",\n                                in2: \"SourceGraphic\",\n                                operator: \"over\",\n                                result: \"firstfilter\"\n                            },\n                            {\n                                elementType: \"feGaussianBlur\",\n                                in: \"firstfilter\",\n                                stdDeviation: \"\" + blurRadius,\n                                result: \"blur2\"\n                            },\n                            {\n                                elementType: \"feOffset\",\n                                dx: \"\" + blurOffsetX,\n                                dy: \"\" + blurOffsetY\n                            },\n                            {\n                                elementType: \"feComposite\",\n                                in2: \"firstfilter\",\n                                operator: \"arithmetic\",\n                                k2: \"-1\",\n                                k3: \"1\",\n                                result: \"shadowDiff\"\n                            },\n                            {\n                                elementType: \"feFlood\",\n                                \"flood-color\": \"#000\",\n                                \"flood-opacity\": \"0.2\"\n                            },\n                            {\n                                elementType: \"feComposite\",\n                                in2: \"shadowDiff\",\n                                operator: \"in\"\n                            },\n                            {\n                                elementType: \"feComposite\",\n                                in2: \"firstfilter\",\n                                operator: \"over\"\n                            }\n                        ]\n                    }\n                ]\n            });\n            var svgTriangleLeft = (0, $eWjiX.BB).createSvg({\n                elementType: \"path\",\n                \"vector-effect\": \"non-scaling-stroke\",\n                d: \"M0,0 L 100,0 0,100 z\",\n                fill: \"rgba(0,0,0,0)\",\n                class: \"toolspace-svg-triangle-button\"\n            });\n            svgTriangleLeft.onclick = function() {\n                p.onLeft();\n                svgTriangleLeft.classList.remove(\"toolspace-svg-triangle-button-hover\");\n            };\n            var svgTriangleRight = (0, $eWjiX.BB).createSvg({\n                elementType: \"path\",\n                \"vector-effect\": \"non-scaling-stroke\",\n                d: \"M100,100 L 100,0 0,100 z\",\n                fill: \"rgba(0,0,0,0)\",\n                class: \"toolspace-svg-triangle-button\"\n            });\n            svgTriangleRight.onclick = function() {\n                p.onRight();\n                svgTriangleRight.classList.remove(\"toolspace-svg-triangle-button-hover\");\n            };\n            // because :hover causes problems w touch\n            var leftPointerListener = new (0, $eWjiX.BB).PointerListener({\n                target: svgTriangleLeft,\n                onEnterLeave: function(isOver) {\n                    svgTriangleLeft.classList.toggle(\"toolspace-svg-triangle-button-hover\", isOver);\n                }\n            });\n            var rightPointerListener = new (0, $eWjiX.BB).PointerListener({\n                target: svgTriangleRight,\n                onEnterLeave: function(isOver) {\n                    svgTriangleRight.classList.toggle(\"toolspace-svg-triangle-button-hover\", isOver);\n                }\n            });\n            svg.append(defs, svgTriangleLeft, svgTriangleRight);\n            result.append(svg);\n            var leftIm = (0, $eWjiX.BB).el({\n                parent: result,\n                className: \"dark-invert\",\n                css: {\n                    backgroundImage: \"url('\" + p.leftImage + \"')\",\n                    backgroundRepeat: \"no-repeat\",\n                    backgroundSize: \"contain\",\n                    width: \"20px\",\n                    height: \"20px\",\n                    position: \"absolute\",\n                    left: \"10px\",\n                    top: \"8px\",\n                    //transform: p.doMirror ? 'scale(-1, 1)' : '',\n                    pointerEvents: \"none\"\n                }\n            });\n            result.append(leftIm);\n            var rightIm = (0, $eWjiX.BB).el({\n                parent: result,\n                className: \"dark-invert\",\n                css: {\n                    backgroundImage: \"url('\" + (p.rightImage ? p.rightImage : p.leftImage) + \"')\",\n                    backgroundRepeat: \"no-repeat\",\n                    backgroundSize: \"contain\",\n                    width: \"20px\",\n                    height: \"20px\",\n                    position: \"absolute\",\n                    right: \"10px\",\n                    bottom: \"8px\",\n                    transform: p.rightImage ? \"\" : \"scale(-1, 1)\",\n                    pointerEvents: \"none\"\n                }\n            });\n            var setIsEnabledLeft = function(b) {\n                svgTriangleLeft.classList.toggle(\"toolspace-row-button-disabled\", !b);\n                leftIm.classList.toggle(\"toolspace-row-button-disabled\", !b);\n            };\n            var setIsEnabledRight = function(b) {\n                svgTriangleRight.classList.toggle(\"toolspace-row-button-disabled\", !b);\n                rightIm.classList.toggle(\"toolspace-row-button-disabled\", !b);\n            };\n            return {\n                el: result,\n                setIsEnabledLeft: setIsEnabledLeft,\n                setIsEnabledRight: setIsEnabledRight,\n                leftPointerListener: leftPointerListener,\n                rightPointerListener: rightPointerListener\n            };\n        };\n        this.toolDropdown = new (0, $84zxV.ToolDropdown)({\n            onChange: function(activeStr) {\n                _this.setActive(activeStr, true);\n            }\n        });\n        this.rootEl.append(this.toolDropdown.getElement());\n        this.handButton = createButton({\n            onClick: function() {\n                _this.setActive(\"hand\", true);\n            },\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($4sBxW))),\n            contain: true,\n            doLighten: true\n        });\n        this.handButton.el.classList.add(\"kl-tool-row-border-right\");\n        this.handButton.el.title = (0, $1mH1z.LANG)(\"tool-hand\");\n        this.rootEl.append(this.handButton.el);\n        this.zoomInNOutButton = createTriangleButton({\n            onLeft: p.onZoomIn,\n            onRight: p.onZoomOut,\n            leftImage: (0, (/*@__PURE__*/$parcel$interopDefault($fORLP))),\n            rightImage: (0, (/*@__PURE__*/$parcel$interopDefault($kRxRZ)))\n        });\n        this.zoomInNOutButton.el.title = (0, $1mH1z.LANG)(\"tool-zoom\");\n        this.rootEl.append(this.zoomInNOutButton.el);\n        this.zoomInButton = createButton({\n            onClick: p.onZoomIn,\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($fORLP))),\n            contain: true\n        });\n        this.zoomInButton.el.title = (0, $1mH1z.LANG)(\"zoom-in\");\n        this.rootEl.append(this.zoomInButton.el);\n        this.zoomOutButton = createButton({\n            onClick: p.onZoomOut,\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($kRxRZ))),\n            contain: true\n        });\n        this.zoomOutButton.el.title = (0, $1mH1z.LANG)(\"zoom-out\");\n        this.rootEl.append(this.zoomOutButton.el);\n        this.undoNRedoButton = createTriangleButton({\n            onLeft: p.onUndo,\n            onRight: p.onRedo,\n            leftImage: (0, (/*@__PURE__*/$parcel$interopDefault($5ZTVn))),\n            rightImage: null\n        });\n        this.undoNRedoButton.el.title = (0, $1mH1z.LANG)(\"undo\") + \"/\" + (0, $1mH1z.LANG)(\"redo\");\n        this.undoNRedoButton.setIsEnabledLeft(false);\n        this.undoNRedoButton.setIsEnabledRight(false);\n        this.rootEl.append(this.undoNRedoButton.el);\n        this.undoButton = createButton({\n            onClick: p.onUndo,\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($5ZTVn))),\n            contain: true\n        });\n        this.undoButton.el.title = (0, $1mH1z.LANG)(\"undo\");\n        this.undoButton.el.classList.add(\"toolspace-row-button-disabled\");\n        this.rootEl.append(this.undoButton.el);\n        this.redoButton = createButton({\n            onClick: p.onRedo,\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($5ZTVn))),\n            contain: true,\n            doMirror: true\n        });\n        this.redoButton.el.title = (0, $1mH1z.LANG)(\"redo\");\n        this.redoButton.el.classList.add(\"toolspace-row-button-disabled\");\n        this.rootEl.append(this.redoButton.el);\n        this.zoomInButton.el.style.display = \"none\";\n        this.zoomOutButton.el.style.display = \"none\";\n        this.undoButton.el.style.display = \"none\";\n        this.redoButton.el.style.display = \"none\";\n    }\n    (0, $7h4XF._)(ToolspaceToolRow, [\n        {\n            // ---- interface ----\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"setIsSmall\",\n            value: function setIsSmall(b) {\n                (0, $eWjiX.BB).css(this.rootEl, {\n                    height: b ? \"36px\" : \"54px\"\n                });\n                this.toolDropdown.setIsSmall(b);\n                this.handButton.setIsSmall(b);\n                this.zoomInButton.setIsSmall(b);\n                this.zoomOutButton.setIsSmall(b);\n                this.undoButton.setIsSmall(b);\n                this.redoButton.setIsSmall(b);\n                if (b) {\n                    this.zoomInNOutButton.el.style.display = \"none\";\n                    this.undoNRedoButton.el.style.display = \"none\";\n                    this.zoomInButton.el.style.display = \"block\";\n                    this.zoomOutButton.el.style.display = \"block\";\n                    this.undoButton.el.style.display = \"block\";\n                    this.redoButton.el.style.display = \"block\";\n                } else {\n                    this.zoomInNOutButton.el.style.display = \"block\";\n                    this.undoNRedoButton.el.style.display = \"block\";\n                    this.zoomInButton.el.style.display = \"none\";\n                    this.zoomOutButton.el.style.display = \"none\";\n                    this.undoButton.el.style.display = \"none\";\n                    this.redoButton.el.style.display = \"none\";\n                }\n            }\n        },\n        {\n            key: \"setEnableZoomIn\",\n            value: function setEnableZoomIn(b) {\n                this.zoomInButton.el.classList.toggle(\"toolspace-row-button-disabled\", !b);\n                this.zoomInNOutButton.setIsEnabledLeft(b);\n            }\n        },\n        {\n            key: \"setEnableZoomOut\",\n            value: function setEnableZoomOut(b) {\n                this.zoomOutButton.el.classList.toggle(\"toolspace-row-button-disabled\", !b);\n                this.zoomInNOutButton.setIsEnabledRight(b);\n            }\n        },\n        {\n            key: \"setEnableUndo\",\n            value: function setEnableUndo(b) {\n                this.undoButton.el.classList.toggle(\"toolspace-row-button-disabled\", !b);\n                this.undoNRedoButton.setIsEnabledLeft(b);\n            }\n        },\n        {\n            key: \"setEnableRedo\",\n            value: function setEnableRedo(b) {\n                this.redoButton.el.classList.toggle(\"toolspace-row-button-disabled\", !b);\n                this.undoNRedoButton.setIsEnabledRight(b);\n            }\n        },\n        {\n            key: \"setActive\",\n            value: function setActive(activeStr, doEmit) {\n                if (this.currentActiveStr === activeStr) return;\n                this.currentActiveStr = activeStr;\n                this.toolDropdown.setActive(this.currentActiveStr);\n                this.handButton.el.classList.toggle(\"toolspace-row-button-activated\", this.currentActiveStr === \"hand\");\n                if (doEmit) this.onActivate(this.currentActiveStr);\n            }\n        },\n        {\n            key: \"getActive\",\n            value: function getActive() {\n                return this.currentActiveStr;\n            }\n        }\n    ]);\n    return ToolspaceToolRow;\n}();\n\n});\nparcelRequire.register(\"4sBxW\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"b30IN\");\n\n});\n\nparcelRequire.register(\"fORLP\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"jYhj7\");\n\n});\n\nparcelRequire.register(\"kRxRZ\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"44EC1\");\n\n});\n\nparcelRequire.register(\"5ZTVn\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"1YnIA\");\n\n});\n\n\nparcelRequire.register(\"1Ax5m\", function(module, exports) {\n\n$parcel$export(module.exports, \"ToolspaceStabilizerRow\", function () { return $90c04b5ac185bf3d$export$8162a66cd18867a7; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $eEL9N = parcelRequire(\"eEL9N\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $90c04b5ac185bf3d$export$8162a66cd18867a7 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function ToolspaceStabilizerRow(p) {\n        (0, $cx0mh._)(this, ToolspaceStabilizerRow);\n        this.rootEl = (0, $eWjiX.BB).el({\n            tagName: \"label\",\n            className: \"kl-stabilizer\",\n            content: (0, $1mH1z.LANG)(\"stabilizer\") + \"&nbsp;\",\n            title: (0, $1mH1z.LANG)(\"stabilizer-title\")\n        });\n        var strengthSelect = new (0, $eEL9N.Select)({\n            optionArr: [\n                [\n                    \"0\",\n                    \"0\"\n                ],\n                [\n                    \"1\",\n                    \"1\"\n                ],\n                [\n                    \"2\",\n                    \"2\"\n                ],\n                [\n                    \"3\",\n                    \"3\"\n                ],\n                [\n                    \"4\",\n                    \"4\"\n                ],\n                [\n                    \"5\",\n                    \"5\"\n                ]\n            ],\n            initValue: \"\" + p.smoothing,\n            onChange: function onChange(val) {\n                p.onSelect(parseInt(val));\n            }\n        });\n        this.rootEl.append(strengthSelect.getElement());\n        this.pointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.rootEl,\n            onWheel: function onWheel(e) {\n                strengthSelect.setDeltaValue(e.deltaY);\n            }\n        });\n    }\n    (0, $7h4XF._)(ToolspaceStabilizerRow, [\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        }\n    ]);\n    return ToolspaceStabilizerRow;\n}();\n\n});\n\nparcelRequire.register(\"e4sAN\", function(module, exports) {\n\n$parcel$export(module.exports, \"TabRow\", function () { return $d04d72b97d637d65$export$3c6d17ed0106bfb9; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $fqSj0 = parcelRequire(\"fqSj0\");\nvar $d04d72b97d637d65$export$3c6d17ed0106bfb9 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function TabRow(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, TabRow);\n        var _p_height;\n        var height = (_p_height = p.height) !== null && _p_height !== void 0 ? _p_height : 35;\n        this.rootEl = (0, $eWjiX.BB).el({\n            className: \"tabrow\",\n            css: {\n                height: height + 1 + \"px\"\n            }\n        });\n        this.tabArr = []; //creates its own internal arr\n        var roundSize = 10;\n        this.roundRight = (0, $eWjiX.BB).el({\n            css: {\n                width: roundSize + \"px\",\n                height: roundSize + \"px\",\n                backgroundImage: \"url('\".concat((0, (/*@__PURE__*/$parcel$interopDefault($fqSj0))), \"')\"),\n                backgroundSize: \"cover\",\n                position: \"absolute\",\n                right: -roundSize + \"px\",\n                bottom: \"0\",\n                pointerEvents: \"none\"\n            }\n        });\n        this.roundLeft = (0, $eWjiX.BB).el({\n            css: {\n                width: roundSize + \"px\",\n                height: roundSize + \"px\",\n                backgroundImage: \"url('\".concat((0, (/*@__PURE__*/$parcel$interopDefault($fqSj0))), \"')\"),\n                backgroundSize: \"cover\",\n                position: \"absolute\",\n                left: -roundSize + \"px\",\n                bottom: \"0\",\n                transform: \"scale(-1,1)\",\n                pointerEvents: \"none\"\n            }\n        });\n        var createTab = function(pTabObj, initialId, useAccent) {\n            var isVisible = \"isVisible\" in pTabObj && pTabObj.isVisible !== undefined ? pTabObj.isVisible : true;\n            var result = {\n                id: pTabObj.id,\n                isVisible: isVisible,\n                onOpen: pTabObj.onOpen,\n                onClose: pTabObj.onClose,\n                update: function(openedTabObj) {\n                    result.el.className = openedTabObj === result ? useAccent ? \"tabrow__tab tabrow__tab--opened-accented\" : \"tabrow__tab tabrow__tab--opened\" : \"tabrow__tab\";\n                    result.el.style.display = result.isVisible ? \"block\" : \"none\";\n                },\n                el: (0, $eWjiX.BB).el({\n                    parent: _this.rootEl,\n                    content: \"label\" in pTabObj ? pTabObj.label : \"\",\n                    title: \"title\" in pTabObj ? pTabObj.title : undefined,\n                    className: initialId === pTabObj.id ? useAccent ? \"tabrow__tab tabrow__tab--opened-accented\" : \"tabrow__tab tabrow__tab--opened\" : \"tabrow__tab\",\n                    css: {\n                        lineHeight: height + \"px\",\n                        display: isVisible ? \"block\" : \"none\",\n                        zIndex: \"0\"\n                    },\n                    onClick: function() {\n                        if (_this.activeTab === result) return;\n                        _this.open(result.id);\n                    }\n                }),\n                pointerListener: {}\n            };\n            if (\"image\" in pTabObj) (0, $eWjiX.BB).el({\n                tagName: \"span\",\n                parent: result.el,\n                className: \"dark-invert\",\n                css: {\n                    backgroundImage: 'url(\"'.concat(pTabObj.image, '\")'),\n                    backgroundSize: \"contain\",\n                    backgroundPosition: \"center\",\n                    backgroundRepeat: \"no-repeat\",\n                    display: \"flex\",\n                    height: height - 7 + \"px\",\n                    justifyContent: \"center\",\n                    margin: \"4px auto\"\n                }\n            });\n            if (\"css\" in pTabObj && pTabObj.css !== undefined) (0, $eWjiX.BB).css(result.el, pTabObj.css);\n            result.pointerListener = new (0, $eWjiX.BB).PointerListener({\n                target: result.el,\n                onEnterLeave: function(isOver) {\n                    result.el.classList.toggle(\"tabrow__tab-hover\", isOver);\n                }\n            });\n            if (initialId === result.id) {\n                result.onOpen();\n                result.el.append(_this.roundRight, _this.roundLeft);\n            } else result.onClose();\n            return result;\n        };\n        var initTabObj = null;\n        for(var i = 0; i < p.tabArr.length; i++){\n            var tab = createTab(p.tabArr[i], p.initialId, p.useAccent || false);\n            if (tab.id === p.initialId) initTabObj = tab;\n            this.tabArr.push(tab);\n        }\n        if (!initTabObj) throw \"invalid initialId\";\n        this.activeTab = initTabObj;\n    }\n    (0, $7h4XF._)(TabRow, [\n        {\n            // update\n            key: \"update\",\n            value: function update() {\n                for(var i = 0; i < this.tabArr.length; i++)this.tabArr[i].update(this.activeTab);\n            }\n        },\n        {\n            // ---- interface ----\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"open\",\n            value: function open(tabId) {\n                for(var i = 0; i < this.tabArr.length; i++)if (this.tabArr[i].id === tabId) {\n                    if (this.activeTab === this.tabArr[i]) return;\n                    this.activeTab.onClose();\n                    this.activeTab = this.tabArr[i];\n                    this.activeTab.onOpen();\n                    this.activeTab.el.append(this.roundRight, this.roundLeft);\n                    this.update();\n                    return;\n                }\n                throw \"TabRow.open - invalid tabId\";\n            }\n        },\n        {\n            key: \"getOpenedTabId\",\n            value: function getOpenedTabId() {\n                return \"\" + this.activeTab.id;\n            }\n        },\n        {\n            key: \"setIsVisible\",\n            value: function setIsVisible(tabId, isVisible) {\n                for(var i = 0; i < this.tabArr.length; i++)if (this.tabArr[i].id === tabId) {\n                    this.tabArr[i].isVisible = isVisible;\n                    this.update();\n                    return;\n                }\n                throw \"TabRow.setIsVisible - invalid tabId\";\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.tabArr.forEach(function(item) {\n                    (0, $eWjiX.BB).destroyEl(item.el);\n                    item.pointerListener.destroy();\n                });\n            }\n        }\n    ]);\n    return TabRow;\n}();\n\n});\nparcelRequire.register(\"fqSj0\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"6ae9h\");\n\n});\n\n\nparcelRequire.register(\"khi8I\", function(module, exports) {\n\n$parcel$export(module.exports, \"HandUi\", function () { return $9934467c988b088a$export$cf20160367bae46c; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $gGQwz = parcelRequire(\"gGQwz\");\n\nvar $6Dvin = parcelRequire(\"6Dvin\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $9934467c988b088a$export$cf20160367bae46c = /*#__PURE__*/ function() {\n    \"use strict\";\n    function HandUi(p) {\n        (0, $cx0mh._)(this, HandUi);\n        this.isVisible = true;\n        this.rootEl = (0, $eWjiX.BB).el({\n            css: {\n                margin: \"10px\"\n            }\n        });\n        this.scale = p.scale;\n        this.angleDeg = p.angleDeg;\n        this.onAngleChange = p.onAngleChange;\n        var row1 = (0, $eWjiX.BB).el({\n            css: {\n                marginBottom: \"10px\",\n                display: \"flex\"\n            }\n        });\n        var row2 = (0, $eWjiX.BB).el({\n            css: {\n                display: \"flex\",\n                marginBottom: \"10px\"\n            }\n        });\n        var row3 = (0, $eWjiX.BB).el({\n            css: {\n                display: \"flex\"\n            }\n        });\n        this.rootEl.append(row1, row2, row3);\n        this.scaleEl = (0, $eWjiX.BB).el({\n            css: {\n                width: \"55px\",\n                userSelect: \"none\"\n            }\n        });\n        row1.append(this.scaleEl);\n        this.angleIm = new Image();\n        this.angleIm.src = (0, (/*@__PURE__*/$parcel$interopDefault($gGQwz)));\n        (0, $eWjiX.BB).css(this.angleIm, {\n            verticalAlign: \"bottom\",\n            width: \"20px\",\n            height: \"20px\",\n            marginRight: \"5px\",\n            borderRadius: \"10px\",\n            background: \"rgba(0,0,0,0.2)\",\n            userSelect: \"none\"\n        });\n        row1.append(this.angleIm);\n        this.angleEl = (0, $eWjiX.BB).el({\n            parent: row1,\n            css: {\n                userSelect: \"none\"\n            }\n        });\n        this.updateUi();\n        var resetButton = (0, $eWjiX.BB).el({\n            tagName: \"button\",\n            content: (0, $1mH1z.LANG)(\"hand-reset\"),\n            onClick: p.onReset\n        });\n        (0, $eWjiX.BB).makeUnfocusable(resetButton);\n        var fitButton = (0, $eWjiX.BB).el({\n            tagName: \"button\",\n            content: (0, $1mH1z.LANG)(\"hand-fit\"),\n            css: {\n                marginLeft: \"10px\"\n            },\n            onClick: p.onFit\n        });\n        (0, $eWjiX.BB).makeUnfocusable(fitButton);\n        row2.append(resetButton, fitButton);\n        var leftRotateButton = (0, $eWjiX.BB).el({\n            tagName: \"button\",\n            content: '<img height=\"20\" src=\"' + (0, (/*@__PURE__*/$parcel$interopDefault($6Dvin))) + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\n            onClick: function onClick() {\n                p.onAngleChange(-15, true);\n            }\n        });\n        (0, $eWjiX.BB).makeUnfocusable(leftRotateButton);\n        var resetAngleButton = (0, $eWjiX.BB).el({\n            tagName: \"button\",\n            content: \"0\\xb0\",\n            css: {\n                marginLeft: \"10px\"\n            },\n            onClick: function onClick() {\n                p.onAngleChange(0);\n            }\n        });\n        (0, $eWjiX.BB).makeUnfocusable(resetAngleButton);\n        var rightRotateButton = (0, $eWjiX.BB).el({\n            tagName: \"button\",\n            content: '<img height=\"20\" src=\"' + (0, (/*@__PURE__*/$parcel$interopDefault($6Dvin))) + '\" alt=\"Rotate\"/>',\n            css: {\n                marginLeft: \"10px\"\n            },\n            onClick: function onClick() {\n                p.onAngleChange(15, true);\n            }\n        });\n        (0, $eWjiX.BB).makeUnfocusable(rightRotateButton);\n        row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\n    }\n    (0, $7h4XF._)(HandUi, [\n        {\n            key: \"updateUi\",\n            value: function updateUi() {\n                this.scaleEl.innerHTML = Math.round(this.scale * 100) + \"%\";\n                this.angleEl.innerHTML = Math.round(this.angleDeg) + \"\\xb0\";\n                this.angleIm.style.transform = \"rotate(\" + this.angleDeg + \"deg)\";\n                if (this.angleDeg % 90 === 0) this.angleIm.style.boxShadow = \"inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)\";\n                else this.angleIm.style.boxShadow = \"\";\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"setIsVisible\",\n            value: function setIsVisible(pIsVisible) {\n                this.isVisible = !!pIsVisible;\n                this.rootEl.style.display = this.isVisible ? \"block\" : \"none\";\n                if (this.isVisible) this.updateUi();\n            }\n        },\n        {\n            key: \"update\",\n            value: function update(pScale, pAngleDeg) {\n                this.scale = pScale;\n                this.angleDeg = pAngleDeg;\n                if (this.isVisible) this.updateUi();\n            }\n        }\n    ]);\n    return HandUi;\n}();\n\n});\nparcelRequire.register(\"6Dvin\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"8l03e\");\n\n});\n\n\nparcelRequire.register(\"dJXmR\", function(module, exports) {\n\n$parcel$export(module.exports, \"FillUi\", function () { return $51d47356d698ffec$export$1e63e3b0645421a2; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $eEL9N = parcelRequire(\"eEL9N\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $51d47356d698ffec$export$1e63e3b0645421a2 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function FillUi(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, FillUi);\n        this.rootEl = (0, $eWjiX.BB).el({\n            css: {\n                margin: \"10px\"\n            }\n        });\n        this.isVisible = true;\n        this.colorDiv = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: \"10px\"\n            }\n        });\n        this.colorSlider = p.colorSlider;\n        this.opacitySlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"opacity\"),\n            width: 250,\n            height: 30,\n            min: 0.01,\n            max: 1,\n            value: 1,\n            toValue: function(displayValue) {\n                return displayValue / 100;\n            },\n            toDisplayValue: function(value) {\n                return value * 100;\n            }\n        });\n        this.rootEl.append(this.opacitySlider.getElement());\n        this.toleranceSlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"bucket-tolerance\"),\n            width: 250,\n            height: 30,\n            min: 0,\n            max: 255,\n            value: 51,\n            toValue: function(displayValue) {\n                return displayValue * 2.55;\n            },\n            toDisplayValue: function(value) {\n                return value / 2.55;\n            }\n        });\n        (0, $eWjiX.BB).css(this.toleranceSlider.getElement(), {\n            marginTop: \"10px\"\n        });\n        this.rootEl.append(this.toleranceSlider.getElement());\n        var selectRow = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                display: \"flex\",\n                marginTop: \"10px\"\n            }\n        });\n        var modeWrapper = (0, $eWjiX.BB).el({\n            content: (0, $1mH1z.LANG)(\"bucket-sample\") + \"&nbsp;\",\n            title: (0, $1mH1z.LANG)(\"bucket-sample-title\"),\n            css: {\n                fontSize: \"15px\"\n            }\n        });\n        this.modeSelect = new (0, $eEL9N.Select)({\n            optionArr: [\n                [\n                    \"all\",\n                    (0, $1mH1z.LANG)(\"bucket-sample-all\")\n                ],\n                [\n                    \"current\",\n                    (0, $1mH1z.LANG)(\"bucket-sample-active\")\n                ],\n                [\n                    \"above\",\n                    (0, $1mH1z.LANG)(\"bucket-sample-above\")\n                ]\n            ],\n            initValue: \"all\"\n        });\n        var modePointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.modeSelect.getElement(),\n            onWheel: function(e) {\n                _this.modeSelect.setDeltaValue(e.deltaY);\n            }\n        });\n        modeWrapper.append(this.modeSelect.getElement());\n        selectRow.append(modeWrapper);\n        var growWrapper = (0, $eWjiX.BB).el({\n            content: (0, $1mH1z.LANG)(\"bucket-grow\") + \"&nbsp;\",\n            title: (0, $1mH1z.LANG)(\"bucket-grow-title\"),\n            css: {\n                fontSize: \"15px\",\n                marginLeft: \"10px\"\n            }\n        });\n        this.growSelect = new (0, $eEL9N.Select)({\n            optionArr: [\n                [\n                    \"0\",\n                    \"0\"\n                ],\n                [\n                    \"1\",\n                    \"1\"\n                ],\n                [\n                    \"2\",\n                    \"2\"\n                ],\n                [\n                    \"3\",\n                    \"3\"\n                ],\n                [\n                    \"4\",\n                    \"4\"\n                ],\n                [\n                    \"5\",\n                    \"5\"\n                ],\n                [\n                    \"6\",\n                    \"6\"\n                ],\n                [\n                    \"7\",\n                    \"7\"\n                ]\n            ],\n            initValue: \"0\"\n        });\n        var growPointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.growSelect.getElement(),\n            onWheel: function(e) {\n                _this.growSelect.setDeltaValue(e.deltaY);\n            }\n        });\n        growWrapper.append(this.growSelect.getElement());\n        selectRow.append(growWrapper);\n        this.isContiguous = true;\n        var contiguousToggle = new (0, $7bWhB.Checkbox)({\n            init: true,\n            label: (0, $1mH1z.LANG)(\"bucket-contiguous\"),\n            title: (0, $1mH1z.LANG)(\"bucket-contiguous-title\"),\n            callback: function(b) {\n                _this.isContiguous = b;\n            },\n            css: {\n                paddingRight: \"5px\",\n                display: \"inline-block\",\n                width: \"50%\"\n            }\n        });\n        this.eraserToggle = new (0, $7bWhB.Checkbox)({\n            init: false,\n            label: (0, $1mH1z.LANG)(\"eraser\"),\n            css: {\n                paddingRight: \"5px\",\n                display: \"inline-block\",\n                width: \"50%\"\n            }\n        });\n        this.rootEl.append((0, $eWjiX.BB).el({\n            content: [\n                contiguousToggle.getElement(),\n                this.eraserToggle.getElement()\n            ],\n            css: {\n                display: \"flex\",\n                marginTop: \"10px\"\n            }\n        }));\n    }\n    (0, $7h4XF._)(FillUi, [\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"setIsVisible\",\n            value: function setIsVisible(pIsVisible) {\n                this.isVisible = !!pIsVisible;\n                this.rootEl.style.display = this.isVisible ? \"block\" : \"none\";\n                if (this.isVisible) this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\n            }\n        },\n        {\n            /**\r\n     * [0, 1]\r\n     */ key: \"getTolerance\",\n            value: function getTolerance() {\n                return this.toleranceSlider.getValue();\n            }\n        },\n        {\n            key: \"getOpacity\",\n            value: function getOpacity() {\n                return this.opacitySlider.getValue();\n            }\n        },\n        {\n            key: \"getSample\",\n            value: function getSample() {\n                return this.modeSelect.getValue();\n            }\n        },\n        {\n            key: \"getGrow\",\n            value: function getGrow() {\n                return parseInt(this.growSelect.getValue(), 10);\n            }\n        },\n        {\n            key: \"getContiguous\",\n            value: function getContiguous() {\n                return this.isContiguous;\n            }\n        },\n        {\n            key: \"getIsEraser\",\n            value: function getIsEraser() {\n                return this.eraserToggle.getValue();\n            }\n        }\n    ]);\n    return FillUi;\n}();\n\n});\n\nparcelRequire.register(\"iS9xS\", function(module, exports) {\n\n$parcel$export(module.exports, \"TextUi\", function () { return $d06987f550ff485e$export$32a22540e4b2f123; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $d06987f550ff485e$export$32a22540e4b2f123 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function TextUi(p) {\n        (0, $cx0mh._)(this, TextUi);\n        this.isVisible = true;\n        this.rootEl = (0, $eWjiX.BB).el({\n            css: {\n                margin: \"10px\"\n            }\n        });\n        this.colorSlider = p.colorSlider;\n        this.colorDiv = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: \"10px\"\n            }\n        });\n        var hint = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            content: (0, $1mH1z.LANG)(\"text-instruction\")\n        });\n    }\n    (0, $7h4XF._)(TextUi, [\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"setIsVisible\",\n            value: function setIsVisible(pIsVisible) {\n                this.isVisible = !!pIsVisible;\n                this.rootEl.style.display = this.isVisible ? \"block\" : \"none\";\n                if (this.isVisible) this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\n            }\n        }\n    ]);\n    return TextUi;\n}();\n\n});\n\nparcelRequire.register(\"9J17G\", function(module, exports) {\n\n$parcel$export(module.exports, \"ShapeUi\", function () { return $45c003c723de07b5$export$a9387b1d4260d39c; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $iFIyy = parcelRequire(\"iFIyy\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $45c003c723de07b5$export$a9387b1d4260d39c = /*#__PURE__*/ function() {\n    \"use strict\";\n    function ShapeUi(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, ShapeUi);\n        this.shape = \"rect\";\n        this.mode = \"stroke\";\n        this.rootEl = (0, $eWjiX.BB).el({\n            css: {\n                margin: \"10px\"\n            }\n        });\n        this.isVisible = true;\n        this.colorDiv = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: \"10px\"\n            }\n        });\n        this.colorSlider = p.colorSlider;\n        var previewSize = 35;\n        var previewPadding = 8;\n        var rectStrokeSvgRect = (0, $eWjiX.BB).createSvg({\n            elementType: \"rect\",\n            x: \"\" + previewPadding,\n            width: \"\" + (previewSize - previewPadding * 2)\n        });\n        var rectStrokeSvg = (0, $eWjiX.BB).createSvg({\n            elementType: \"svg\",\n            width: \"\" + previewSize,\n            height: \"\" + previewSize\n        });\n        rectStrokeSvg.classList.add(\"dark-invert\");\n        rectStrokeSvg.append(rectStrokeSvgRect);\n        (0, $eWjiX.BB).css(rectStrokeSvg, {\n            display: \"block\"\n        });\n        var rectFilledSvgRect = (0, $eWjiX.BB).createSvg({\n            elementType: \"rect\",\n            x: \"\" + previewPadding,\n            width: \"\" + (previewSize - previewPadding * 2)\n        });\n        var rectFilledSvg = (0, $eWjiX.BB).createSvg({\n            elementType: \"svg\",\n            width: \"\" + previewSize,\n            height: \"\" + previewSize\n        });\n        rectFilledSvg.classList.add(\"dark-invert\");\n        rectFilledSvg.append(rectFilledSvgRect);\n        (0, $eWjiX.BB).css(rectFilledSvg, {\n            display: \"block\"\n        });\n        var ellipseStrokeSvgEllipse = (0, $eWjiX.BB).createSvg({\n            elementType: \"ellipse\",\n            cx: \"\" + previewSize / 2,\n            cy: \"\" + previewSize / 2,\n            rx: \"\" + (previewSize / 2 - previewPadding)\n        });\n        var ellipseStrokeSvg = (0, $eWjiX.BB).createSvg({\n            elementType: \"svg\",\n            width: \"\" + previewSize,\n            height: \"\" + previewSize\n        });\n        ellipseStrokeSvg.classList.add(\"dark-invert\");\n        ellipseStrokeSvg.append(ellipseStrokeSvgEllipse);\n        (0, $eWjiX.BB).css(ellipseStrokeSvg, {\n            display: \"block\"\n        });\n        var ellipseFilledSvgEllipse = (0, $eWjiX.BB).createSvg({\n            elementType: \"ellipse\",\n            cx: \"\" + previewSize / 2,\n            cy: \"\" + previewSize / 2,\n            rx: \"\" + (previewSize / 2 - previewPadding)\n        });\n        var ellipseFilledSvg = (0, $eWjiX.BB).createSvg({\n            elementType: \"svg\",\n            width: \"\" + previewSize,\n            height: \"\" + previewSize\n        });\n        ellipseFilledSvg.classList.add(\"dark-invert\");\n        ellipseFilledSvg.append(ellipseFilledSvgEllipse);\n        (0, $eWjiX.BB).css(ellipseFilledSvg, {\n            display: \"block\"\n        });\n        var lineSvgLine = (0, $eWjiX.BB).createSvg({\n            elementType: \"line\",\n            x1: \"\" + previewPadding,\n            x2: \"\" + (previewSize - previewPadding)\n        });\n        var lineSvg = (0, $eWjiX.BB).createSvg({\n            elementType: \"svg\",\n            width: \"\" + previewSize,\n            height: \"\" + previewSize\n        });\n        lineSvg.classList.add(\"dark-invert\");\n        lineSvg.append(lineSvgLine);\n        (0, $eWjiX.BB).css(lineSvg, {\n            display: \"block\"\n        });\n        var updatePreviews = function() {\n            var strokeWidth = (0, $eWjiX.BB).clamp(Math.round(_this.lineWidthSlider.getValue() / 10), 1, 10) + \"px\";\n            var squish = 1.35;\n            (0, $eWjiX.BB).css(rectStrokeSvgRect, {\n                fill: \"none\",\n                stroke: \"black\",\n                strokeWidth: strokeWidth\n            });\n            (0, $eWjiX.BB).css(rectFilledSvgRect, {\n                fill: \"black\",\n                stroke: \"none\"\n            });\n            (0, $eWjiX.BB).css(ellipseStrokeSvgEllipse, {\n                fill: \"none\",\n                stroke: \"black\",\n                strokeWidth: strokeWidth\n            });\n            (0, $eWjiX.BB).css(ellipseFilledSvgEllipse, {\n                fill: \"black\",\n                stroke: \"none\"\n            });\n            (0, $eWjiX.BB).css(lineSvgLine, {\n                fill: \"none\",\n                stroke: \"black\",\n                strokeWidth: strokeWidth\n            });\n            if (_this.fixedToggle.getValue()) {\n                rectStrokeSvgRect.setAttribute(\"y\", \"\" + previewPadding);\n                rectStrokeSvgRect.setAttribute(\"height\", \"\" + (previewSize - previewPadding * 2));\n                rectFilledSvgRect.setAttribute(\"y\", \"\" + previewPadding);\n                rectFilledSvgRect.setAttribute(\"height\", \"\" + (previewSize - previewPadding * 2));\n                ellipseStrokeSvgEllipse.setAttribute(\"ry\", \"\" + (previewSize / 2 - previewPadding));\n                ellipseFilledSvgEllipse.setAttribute(\"ry\", \"\" + (previewSize / 2 - previewPadding));\n            } else {\n                rectStrokeSvgRect.setAttribute(\"y\", \"\" + previewPadding * squish);\n                rectStrokeSvgRect.setAttribute(\"height\", \"\" + (previewSize - previewPadding * squish * 2));\n                rectFilledSvgRect.setAttribute(\"y\", \"\" + previewPadding * squish);\n                rectFilledSvgRect.setAttribute(\"height\", \"\" + (previewSize - previewPadding * squish * 2));\n                ellipseStrokeSvgEllipse.setAttribute(\"ry\", \"\" + (previewSize / 2 - previewPadding * squish));\n                ellipseFilledSvgEllipse.setAttribute(\"ry\", \"\" + (previewSize / 2 - previewPadding * squish));\n            }\n            if (_this.snapToggle.getValue()) {\n                lineSvgLine.setAttribute(\"y1\", \"\" + (previewSize - previewPadding));\n                lineSvgLine.setAttribute(\"y2\", \"\" + previewPadding);\n            } else {\n                lineSvgLine.setAttribute(\"y1\", \"\" + (previewSize - previewPadding * squish));\n                lineSvgLine.setAttribute(\"y2\", \"\" + previewPadding * squish);\n            }\n        };\n        var row1 = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                alignItems: \"start\"\n            }\n        });\n        var shapeOptions = new (0, $iFIyy.Options)({\n            optionArr: [\n                {\n                    id: \"rect-stroke\",\n                    label: rectStrokeSvg,\n                    title: (0, $1mH1z.LANG)(\"shape-rect\") + \" \" + (0, $1mH1z.LANG)(\"shape-stroke\")\n                },\n                {\n                    id: \"ellipse-stroke\",\n                    label: ellipseStrokeSvg,\n                    title: (0, $1mH1z.LANG)(\"shape-ellipse\") + \" \" + (0, $1mH1z.LANG)(\"shape-stroke\")\n                },\n                {\n                    id: \"line\",\n                    label: lineSvg,\n                    title: (0, $1mH1z.LANG)(\"shape-line\")\n                },\n                {\n                    id: \"rect-fill\",\n                    label: rectFilledSvg,\n                    title: (0, $1mH1z.LANG)(\"shape-rect\") + \" \" + (0, $1mH1z.LANG)(\"shape-fill\")\n                },\n                {\n                    id: \"ellipse-fill\",\n                    label: ellipseFilledSvg,\n                    title: (0, $1mH1z.LANG)(\"shape-ellipse\") + \" \" + (0, $1mH1z.LANG)(\"shape-fill\")\n                }\n            ],\n            initId: this.shape + \" \" + this.mode,\n            onChange: function(id) {\n                var split = id.split(\"-\");\n                _this.shape = split[0];\n                _this.mode = split[1];\n                (0, $eWjiX.BB).css(_this.fixedToggle.getElement(), {\n                    display: _this.shape === \"line\" ? \"none\" : \"\"\n                });\n                (0, $eWjiX.BB).css(_this.snapToggle.getElement(), {\n                    display: _this.shape === \"line\" ? \"\" : \"none\"\n                });\n                (0, $eWjiX.BB).css(_this.lineWidthSlider.getElement(), {\n                    display: _this.shape !== \"line\" && _this.mode === \"fill\" ? \"none\" : \"\"\n                });\n            },\n            changeOnInit: true\n        });\n        shapeOptions.getElement().style.width = \"120px\";\n        row1.append(shapeOptions.getElement());\n        this.eraserToggle = new (0, $7bWhB.Checkbox)({\n            init: false,\n            label: (0, $1mH1z.LANG)(\"eraser\"),\n            callback: function() {\n                updatePreviews();\n            }\n        });\n        this.lockAlphaToggle = new (0, $7bWhB.Checkbox)({\n            init: false,\n            label: (0, $1mH1z.LANG)(\"lock-alpha\"),\n            title: (0, $1mH1z.LANG)(\"lock-alpha-title\"),\n            doHighlight: true\n        });\n        this.lockAlphaToggle.getElement().style.marginTop = \"10px\";\n        row1.append((0, $eWjiX.BB).el({\n            content: [\n                this.eraserToggle.getElement(),\n                this.lockAlphaToggle.getElement()\n            ]\n        }));\n        this.lineWidthSlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"shape-line-width\"),\n            width: 250,\n            height: 30,\n            min: 1,\n            max: 200,\n            value: 4,\n            curve: \"quadratic\",\n            onChange: function() {\n                updatePreviews();\n            }\n        });\n        (0, $eWjiX.BB).css(this.lineWidthSlider.getElement(), {\n            marginTop: \"10px\"\n        });\n        this.rootEl.append(this.lineWidthSlider.getElement());\n        this.opacitySlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"opacity\"),\n            width: 250,\n            height: 30,\n            min: 0.01,\n            max: 1,\n            value: 1,\n            toValue: function(displayValue) {\n                return displayValue / 100;\n            },\n            toDisplayValue: function(value) {\n                return value * 100;\n            }\n        });\n        (0, $eWjiX.BB).css(this.opacitySlider.getElement(), {\n            marginTop: \"10px\"\n        });\n        this.rootEl.append(this.opacitySlider.getElement());\n        var row2 = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                marginTop: \"10px\"\n            }\n        });\n        this.outwardsToggle = new (0, $7bWhB.Checkbox)({\n            init: false,\n            label: (0, $1mH1z.LANG)(\"shape-outwards\"),\n            css: {\n                width: \"50%\",\n                marginRight: \"10px\"\n            }\n        });\n        row2.append(this.outwardsToggle.getElement());\n        this.fixedToggle = new (0, $7bWhB.Checkbox)({\n            init: false,\n            label: (0, $1mH1z.LANG)(\"shape-fixed\"),\n            callback: function() {\n                updatePreviews();\n            },\n            css: {\n                flexGrow: \"1\"\n            }\n        });\n        row2.append(this.fixedToggle.getElement());\n        this.snapToggle = new (0, $7bWhB.Checkbox)({\n            init: false,\n            label: (0, $1mH1z.LANG)(\"angle-snap\"),\n            title: (0, $1mH1z.LANG)(\"angle-snap-title\"),\n            callback: function() {\n                updatePreviews();\n            },\n            css: {\n                flexGrow: \"1\"\n            }\n        });\n        row2.append(this.snapToggle.getElement());\n        updatePreviews();\n    }\n    (0, $7h4XF._)(ShapeUi, [\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"setIsVisible\",\n            value: function setIsVisible(pIsVisible) {\n                this.isVisible = !!pIsVisible;\n                this.rootEl.style.display = this.isVisible ? \"block\" : \"none\";\n                if (this.isVisible) {\n                    this.colorDiv.append(this.colorSlider.getElement());\n                    this.colorDiv.append(this.colorSlider.getOutputElement());\n                //update();\n                }\n            }\n        },\n        {\n            key: \"getShape\",\n            value: function getShape() {\n                return this.shape;\n            }\n        },\n        {\n            key: \"getMode\",\n            value: function getMode() {\n                return this.mode;\n            }\n        },\n        {\n            key: \"getIsEraser\",\n            value: function getIsEraser() {\n                return this.eraserToggle.getValue();\n            }\n        },\n        {\n            key: \"getOpacity\",\n            value: function getOpacity() {\n                return this.opacitySlider.getValue();\n            }\n        },\n        {\n            key: \"getLineWidth\",\n            value: function getLineWidth() {\n                return this.lineWidthSlider.getValue();\n            }\n        },\n        {\n            key: \"getIsOutwards\",\n            value: function getIsOutwards() {\n                return this.outwardsToggle.getValue();\n            }\n        },\n        {\n            key: \"getIsFixed\",\n            value: function getIsFixed() {\n                return this.fixedToggle.getValue();\n            }\n        },\n        {\n            key: \"getIsSnap\",\n            value: function getIsSnap() {\n                return this.snapToggle.getValue();\n            }\n        },\n        {\n            key: \"getDoLockAlpha\",\n            value: function getDoLockAlpha() {\n                return this.lockAlphaToggle.getValue();\n            }\n        }\n    ]);\n    return ShapeUi;\n}();\n\n});\n\nparcelRequire.register(\"76Qvv\", function(module, exports) {\n\n$parcel$export(module.exports, \"newImageDialog\", function () { return $4fb68589de8a8c9a$export$f77a89101d7d6586; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $eEL9N = parcelRequire(\"eEL9N\");\n\nvar $43qNf = parcelRequire(\"43qNf\");\n\nvar $2MaaK = parcelRequire(\"2MaaK\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $cNr8p = parcelRequire(\"cNr8p\");\n\nvar $fohxs = parcelRequire(\"fohxs\");\n\nvar $1C8RU = parcelRequire(\"1C8RU\");\nfunction $4fb68589de8a8c9a$export$f77a89101d7d6586(p) {\n    var createRatioSize = function createRatioSize(ratioX, ratioY, width, height, padding) {\n        return (0, $eWjiX.BB).fitInto(ratioX, ratioY, Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding), 1);\n    };\n    var updateRatio = function updateRatio() {\n        widthInput.value = \"\" + Math.min(maxCanvasSize, parseInt(widthInput.value));\n        heightInput.value = \"\" + Math.min(maxCanvasSize, parseInt(heightInput.value));\n        function hcf(u, v) {\n            var U = u, V = v;\n            // eslint-disable-next-line no-constant-condition\n            while(true){\n                if (!(U %= V)) return V;\n                if (!(V %= U)) return U;\n            }\n        }\n        var w = parseInt(widthInput.value);\n        var h = parseInt(heightInput.value);\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\n            if (w > maxCanvasSize) w = maxCanvasSize;\n            else if (h > maxCanvasSize) h = maxCanvasSize;\n            widthInput.value = \"\" + w;\n            heightInput.value = \"\" + h;\n        }\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\n        var commonRatios = [\n            [\n                1,\n                2\n            ],\n            [\n                2,\n                1\n            ],\n            [\n                2,\n                3\n            ],\n            [\n                3,\n                2\n            ],\n            [\n                3,\n                4\n            ],\n            [\n                4,\n                3\n            ],\n            [\n                4,\n                5\n            ],\n            [\n                5,\n                4\n            ],\n            [\n                16,\n                9\n            ],\n            [\n                9,\n                16\n            ],\n            [\n                3,\n                2\n            ],\n            [\n                2,\n                3\n            ],\n            [\n                5,\n                3\n            ],\n            [\n                3,\n                5\n            ],\n            [\n                2,\n                1\n            ],\n            [\n                1,\n                2\n            ],\n            [\n                1.414,\n                1\n            ],\n            [\n                1,\n                1.414\n            ]\n        ];\n        var reducedArr = (0, $eWjiX.BB).reduce(w, h);\n        var closestRatio = commonRatios[0];\n        var closestDistance = Math.abs(commonRatios[0][0] / commonRatios[0][1] - reducedArr[0] / reducedArr[1]);\n        for(var i = 0; i < commonRatios.length; i++)if (Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\n            closestRatio = commonRatios[i];\n            closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\n        }\n        //display ratio\n        if (closestDistance > 0 && closestDistance < 0.005) ratioWrapper.innerText = (0, $1mH1z.LANG)(\"new-ratio\") + \": ~\" + closestRatio[0] + \":\" + closestRatio[1];\n        else ratioWrapper.innerText = (0, $1mH1z.LANG)(\"new-ratio\") + \": \" + reducedArr[0] + \":\" + reducedArr[1];\n        var realw = w;\n        var T = hcf(w, h);\n        w /= T;\n        h /= T;\n        w *= 260;\n        h *= 260;\n        if (w > 260) {\n            h = 260 / w * h;\n            w = 260;\n        }\n        if (h > 100) {\n            w = 100 / h * w;\n            h = 100;\n        }\n        preview.style.width = w + \"px\";\n        preview.style.height = h + \"px\";\n        (0, $eWjiX.BB).createCheckerDataUrl(parseInt(\"\" + 30 * (w / realw)), function(url) {\n            previewWrapper.style.background = \"url(\" + url + \")\";\n        }, (0, $1C8RU.theme).isDark());\n    };\n    var currentColor = p.currentColor;\n    var secondaryColor = p.secondaryColor;\n    var maxCanvasSize = p.maxCanvasSize;\n    var canvasWidth = p.canvasWidth;\n    var canvasHeight = p.canvasHeight;\n    var workspaceWidth = p.workspaceWidth;\n    var workspaceHeight = p.workspaceHeight;\n    var onConfirm = p.onConfirm;\n    var onCancel = p.onCancel;\n    var newImDiv = (0, $eWjiX.BB).el();\n    var widthInput = (0, $eWjiX.BB).el({\n        tagName: \"input\"\n    });\n    var unitStyle = {\n        color: \"#888\",\n        fontSize: \"12px\",\n        marginLeft: \"5px\"\n    };\n    var widthUnit = (0, $eWjiX.BB).el({\n        textContent: (0, $1mH1z.LANG)(\"new-px\"),\n        css: unitStyle\n    });\n    var heightInput = (0, $eWjiX.BB).el({\n        tagName: \"input\"\n    });\n    var heightUnit = (0, $eWjiX.BB).el({\n        textContent: (0, $1mH1z.LANG)(\"new-px\"),\n        css: unitStyle\n    });\n    widthInput.setAttribute(\"data-ignore-focus\", \"true\");\n    heightInput.setAttribute(\"data-ignore-focus\", \"true\");\n    widthInput.type = \"number\";\n    widthInput.min = \"1\";\n    widthInput.max = \"\" + maxCanvasSize;\n    (0, $eWjiX.BB).css(widthInput, {\n        width: \"70px\"\n    });\n    heightInput.type = \"number\";\n    heightInput.min = \"1\";\n    heightInput.max = \"\" + maxCanvasSize;\n    heightInput.style.width = \"70px\";\n    widthInput.value = \"\" + canvasWidth;\n    heightInput.value = \"\" + canvasHeight;\n    widthInput.onclick = function() {\n        widthInput.focus();\n        updateRatio();\n    };\n    heightInput.onclick = function() {\n        heightInput.focus();\n        updateRatio();\n    };\n    var sizeTable = (0, $cNr8p.table)([\n        [\n            (0, $1mH1z.LANG)(\"width\") + \":&nbsp;\",\n            widthInput,\n            widthUnit\n        ],\n        [\n            (0, $eWjiX.BB).el({\n                css: {\n                    height: \"5px\"\n                }\n            }),\n            \"\",\n            \"\"\n        ],\n        [\n            (0, $1mH1z.LANG)(\"height\") + \":&nbsp;\",\n            heightInput,\n            heightUnit\n        ]\n    ]);\n    (0, $eWjiX.BB).css(sizeTable, {\n        marginBottom: \"10px\"\n    });\n    var ratioWrapper = (0, $eWjiX.BB).el({\n        css: {\n            marginTop: \"5px\",\n            color: \"#888\"\n        }\n    });\n    var templateWrapper = (0, $eWjiX.BB).el();\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\n    var presetFitBtn = (0, $eWjiX.BB).el({\n        tagName: \"button\"\n    });\n    templateWrapper.style.marginBottom = \"10px\";\n    var presetCurrentBtn = (0, $eWjiX.BB).el({\n        tagName: \"button\"\n    });\n    var presetSquareBtn = (0, $eWjiX.BB).el({\n        tagName: \"button\"\n    });\n    var presetLandscapeBtn = (0, $eWjiX.BB).el({\n        tagName: \"button\"\n    });\n    var presetPortraitBtn = (0, $eWjiX.BB).el({\n        tagName: \"button\"\n    });\n    var presetOversizeBtn = (0, $eWjiX.BB).el({\n        tagName: \"button\"\n    });\n    presetCurrentBtn.textContent = (0, $1mH1z.LANG)(\"new-current\");\n    presetFitBtn.textContent = (0, $1mH1z.LANG)(\"new-fit\");\n    presetOversizeBtn.textContent = (0, $1mH1z.LANG)(\"new-oversize\");\n    presetLandscapeBtn.textContent = (0, $1mH1z.LANG)(\"new-landscape\");\n    presetPortraitBtn.textContent = (0, $1mH1z.LANG)(\"new-portrait\");\n    presetSquareBtn.textContent = (0, $1mH1z.LANG)(\"new-square\");\n    presetCurrentBtn.style.marginRight = \"5px\";\n    presetFitBtn.style.marginRight = \"5px\";\n    presetOversizeBtn.style.marginRight = \"5px\";\n    presetLandscapeBtn.style.marginTop = \"5px\";\n    presetLandscapeBtn.style.marginRight = \"5px\";\n    presetPortraitBtn.style.marginTop = \"5px\";\n    presetPortraitBtn.style.marginRight = \"5px\";\n    templateWrapper.append(presetCurrentBtn, presetFitBtn, presetOversizeBtn, presetSquareBtn, presetLandscapeBtn, presetPortraitBtn);\n    var templatePadding = 0;\n    presetCurrentBtn.onclick = function() {\n        widthInput.value = \"\" + canvasWidth;\n        heightInput.value = \"\" + canvasHeight;\n        updateRatio();\n    };\n    presetFitBtn.onclick = function() {\n        widthInput.value = \"\" + workspaceWidth;\n        heightInput.value = \"\" + workspaceHeight;\n        updateRatio();\n    };\n    presetOversizeBtn.onclick = function() {\n        widthInput.value = \"\" + (workspaceWidth + 500);\n        heightInput.value = \"\" + (workspaceHeight + 500);\n        updateRatio();\n    };\n    presetSquareBtn.onclick = function() {\n        var sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = \"\" + Math.round(sizeObj.width);\n        heightInput.value = \"\" + Math.round(sizeObj.height);\n        updateRatio();\n    };\n    presetLandscapeBtn.onclick = function() {\n        var sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = \"\" + Math.round(sizeObj.width);\n        heightInput.value = \"\" + Math.round(sizeObj.height);\n        updateRatio();\n    };\n    presetPortraitBtn.onclick = function() {\n        var sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = \"\" + Math.round(sizeObj.width);\n        heightInput.value = \"\" + Math.round(sizeObj.height);\n        updateRatio();\n    };\n    var select = new (0, $eEL9N.Select)({\n        isFocusable: true,\n        optionArr: [\n            [\n                \"screen\",\n                (0, $1mH1z.LANG)(\"new-screen\")\n            ],\n            [\n                \"16 9\",\n                (0, $1mH1z.LANG)(\"new-video\") + \" 16:9\"\n            ],\n            [\n                \"3 2\",\n                \"3:2\"\n            ],\n            [\n                \"5 3\",\n                \"5:3\"\n            ],\n            [\n                \"2 1\",\n                \"2:1\"\n            ],\n            [\n                \"paper\",\n                (0, $1mH1z.LANG)(\"new-din-paper\") + \" 2:1\"\n            ],\n            [\n                \"9 16\",\n                \"9:16\"\n            ],\n            [\n                \"2 3\",\n                \"2:3\"\n            ],\n            [\n                \"3 5\",\n                \"3:5\"\n            ],\n            [\n                \"1 2\",\n                \"1:2\"\n            ],\n            [\n                \"1 1.4142135623730951\",\n                \"1:2\"\n            ]\n        ],\n        onChange: function onChange(val) {\n            if (val === \"screen\") {\n                widthInput.value = \"\" + window.screen.width;\n                heightInput.value = \"\" + window.screen.height;\n            } else if (val === \"paper\") {\n                var sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\n                widthInput.value = \"\" + Math.round(sizeObj.width);\n                heightInput.value = \"\" + Math.round(sizeObj.height);\n            } else {\n                var split = val.split(\" \");\n                var sizeObj1 = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\n                widthInput.value = \"\" + Math.round(sizeObj1.width);\n                heightInput.value = \"\" + Math.round(sizeObj1.height);\n            }\n            updateRatio();\n            select.setValue(undefined);\n        }\n    });\n    setTimeout(function() {\n        // safari: not empty without also setting it to null via timeout\n        select.setValue(undefined);\n    }, 0);\n    (0, $eWjiX.BB).css(select.getElement(), {\n        width: \"80px\"\n    });\n    templateWrapper.append(select.getElement());\n    var backgroundRGBA = {\n        r: 255,\n        g: 255,\n        b: 255,\n        a: 1\n    };\n    var colorOptionsArr = [\n        {\n            r: 255,\n            g: 255,\n            b: 255,\n            a: 1\n        },\n        {\n            r: 0,\n            g: 0,\n            b: 0,\n            a: 1\n        },\n        {\n            r: 0,\n            g: 0,\n            b: 0,\n            a: 0\n        },\n        {\n            r: currentColor.r,\n            g: currentColor.g,\n            b: currentColor.b,\n            a: 1\n        },\n        {\n            r: secondaryColor.r,\n            g: secondaryColor.g,\n            b: secondaryColor.b,\n            a: 1\n        }\n    ];\n    var initColorIndex = 0;\n    if ((0, $1C8RU.theme).isDark()) colorOptionsArr.forEach(function(item, index) {\n        if (item.r === (0, $fohxs.ERASE_COLOR) && item.g === (0, $fohxs.ERASE_COLOR) && item.b === (0, $fohxs.ERASE_COLOR)) {\n            initColorIndex = index;\n            backgroundRGBA = item;\n        }\n    });\n    var colorOptions = new (0, $43qNf.ColorOptions)({\n        colorArr: colorOptionsArr,\n        initialIndex: initColorIndex,\n        onChange: function onChange(rgbaObj) {\n            backgroundRGBA = rgbaObj;\n            preview.style.backgroundColor = \"rgba(\" + rgbaObj.r + \",\" + rgbaObj.g + \",\" + rgbaObj.b + \", \" + rgbaObj.a + \")\";\n        }\n    });\n    var previewWrapper = (0, $eWjiX.BB).el({\n        className: \"kl-transparent-preview\",\n        css: {\n            boxSizing: \"border-box\",\n            width: \"340px\",\n            height: \"140px\",\n            display: \"table\",\n            padding: \"10px\",\n            marginTop: \"10px\",\n            marginLeft: \"-20px\"\n        }\n    });\n    var preview = (0, $eWjiX.BB).el({\n        className: \"kl-transparent-preview__canvas\",\n        css: {\n            width: \"200px\",\n            height: \"100px\",\n            backgroundColor: \"rgba(\" + backgroundRGBA.r + \",\" + backgroundRGBA.g + \",\" + backgroundRGBA.b + \", \" + backgroundRGBA.a + \")\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            color: \"#aaa\",\n            fontSize: \"16px\",\n            fontWeight: \"bold\",\n            textAlign: \"center\",\n            verticalAlign: \"center\",\n            display: \"table\",\n            overflow: \"hidden\"\n        }\n    });\n    (0, $eWjiX.BB).el({\n        parent: previewWrapper,\n        content: preview,\n        css: {\n            display: \"table-cell\",\n            verticalAlign: \"middle\"\n        }\n    });\n    (0, $eWjiX.BB).el({\n        parent: preview,\n        css: {\n            display: \"table-cell\",\n            verticalAlign: \"middle\"\n        }\n    });\n    (0, $1C8RU.theme).addIsDarkListener(updateRatio);\n    widthInput.onchange = function() {\n        if (widthInput.value === \"\" || parseInt(widthInput.value) < 0) widthInput.value = \"1\";\n        updateRatio();\n    };\n    widthInput.onkeyup = function() {\n        updateRatio();\n    };\n    heightInput.onchange = function() {\n        if (heightInput.value === \"\" || parseFloat(heightInput.value) < 0) heightInput.value = \"1\";\n        updateRatio();\n    };\n    heightInput.onkeyup = function() {\n        updateRatio();\n    };\n    updateRatio();\n    newImDiv.append(templateWrapper);\n    var secondRow = (0, $eWjiX.BB).el({\n        parent: newImDiv,\n        css: {\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            alignItems: \"flex-end\"\n        }\n    });\n    var secondRowLeft = (0, $eWjiX.BB).el({\n        parent: secondRow\n    });\n    secondRowLeft.append(sizeTable, ratioWrapper);\n    secondRow.append(colorOptions.getElement());\n    newImDiv.append(previewWrapper);\n    (0, $2MaaK.showModal)({\n        target: document.body,\n        message: \"<b>\".concat((0, $1mH1z.LANG)(\"new-title\"), \"</b>\"),\n        div: newImDiv,\n        buttons: [\n            \"Ok\",\n            \"Cancel\"\n        ],\n        callback: function callback(result) {\n            (0, $eWjiX.BB).unsetEventHandler(widthInput, \"onclick\", \"onchange\", \"onkeyup\");\n            (0, $eWjiX.BB).unsetEventHandler(widthInput, \"onclick\", \"onchange\", \"onkeyup\");\n            (0, $eWjiX.BB).unsetEventHandler(presetCurrentBtn, \"onclick\");\n            (0, $eWjiX.BB).unsetEventHandler(presetFitBtn, \"onclick\");\n            (0, $eWjiX.BB).unsetEventHandler(presetOversizeBtn, \"onclick\");\n            (0, $eWjiX.BB).unsetEventHandler(presetSquareBtn, \"onclick\");\n            (0, $eWjiX.BB).unsetEventHandler(presetLandscapeBtn, \"onclick\");\n            (0, $eWjiX.BB).unsetEventHandler(presetPortraitBtn, \"onclick\");\n            select.destroy();\n            colorOptions.destroy();\n            (0, $1C8RU.theme).removeIsDarkListener(updateRatio);\n            if (result === \"Cancel\" || parseInt(widthInput.value) <= 0 || parseInt(heightInput.value) <= 0 || isNaN(parseInt(widthInput.value)) || isNaN(parseInt(heightInput.value))) {\n                onCancel();\n                return;\n            }\n            onConfirm(parseInt(widthInput.value), parseInt(heightInput.value), backgroundRGBA);\n        },\n        clickOnEnter: \"Ok\"\n    });\n}\n\n});\nparcelRequire.register(\"cNr8p\", function(module, exports) {\n\n$parcel$export(module.exports, \"table\", function () { return $96366ef7b36c82a7$export$9852986a3ec5f6a0; });\n\nvar $bX4ja = parcelRequire(\"bX4ja\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nfunction $96366ef7b36c82a7$export$9852986a3ec5f6a0(data, cellProps) {\n    var result = (0, $eWjiX.BB).el({\n        tagName: \"table\",\n        className: \"kl-table\"\n    });\n    data.forEach(function(row, rowIndex) {\n        var _rowEl;\n        var rowEl = (0, $eWjiX.BB).el({\n            tagName: \"tr\"\n        });\n        (_rowEl = rowEl).append.apply(_rowEl, (0, $bX4ja._)(row.map(function(el, colIndex) {\n            var cellEl = (0, $eWjiX.BB).el({\n                tagName: \"td\",\n                content: el\n            });\n            var key = rowIndex + \".\" + colIndex;\n            if (cellProps !== undefined && key in cellProps) cellEl.rowSpan = cellProps[key].rowspan;\n            return cellEl;\n        })));\n        result.append(rowEl);\n    });\n    return result;\n}\n\n});\n\n\nparcelRequire.register(\"1uc3b\", function(module, exports) {\n\n$parcel$export(module.exports, \"ToolspaceCollapser\", function () { return $3f73fb4b1b574d52$export$5b91f641162972fc; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $9ecpQ = parcelRequire(\"9ecpQ\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $3f73fb4b1b574d52$export$5b91f641162972fc = /*#__PURE__*/ function() {\n    \"use strict\";\n    function ToolspaceCollapser(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, ToolspaceCollapser);\n        this.stateIsOpen = true;\n        this.directionStr = \"right\";\n        this.rootEl = (0, $eWjiX.BB).el({\n            className: \"kl-toolspace-toggle\",\n            css: {\n                width: \"36px\",\n                height: \"36px\",\n                background: \"rgba(100, 100, 100, 0.9)\",\n                color: \"#fff\",\n                position: \"absolute\",\n                top: \"0\",\n                textAlign: \"center\",\n                lineHeight: \"36px\",\n                cursor: \"pointer\",\n                userSelect: \"none\",\n                padding: \"6px\",\n                boxSizing: \"border-box\"\n            },\n            title: (0, $1mH1z.LANG)(\"toggle-show-tools\"),\n            onClick: function(e) {\n                e.preventDefault();\n                _this.stateIsOpen = !_this.stateIsOpen;\n                _this.update();\n                p.onChange();\n            }\n        });\n        this.icon = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                backgroundImage: \"url(\".concat((0, (/*@__PURE__*/$parcel$interopDefault($9ecpQ))), \")\"),\n                width: \"100%\",\n                height: \"100%\",\n                backgroundSize: \"contain\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"center\",\n                userSelect: \"none\"\n            }\n        });\n        this.rootEl.oncontextmenu = function() {\n            return false;\n        };\n    }\n    (0, $7h4XF._)(ToolspaceCollapser, [\n        {\n            key: \"update\",\n            value: function update() {\n                if (this.directionStr === \"left\") this.icon.style.transform = this.stateIsOpen ? \"rotate(180deg)\" : \"\";\n                else this.icon.style.transform = this.stateIsOpen ? \"\" : \"rotate(180deg)\";\n            }\n        },\n        {\n            // ---- interface ----\n            key: \"isOpen\",\n            value: function isOpen() {\n                return this.stateIsOpen;\n            }\n        },\n        {\n            key: \"setDirection\",\n            value: function setDirection(dirStr) {\n                this.directionStr = dirStr;\n                this.update();\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        }\n    ]);\n    return ToolspaceCollapser;\n}();\n\n});\nparcelRequire.register(\"9ecpQ\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"8K12o\");\n\n});\n\n\nparcelRequire.register(\"dHnZA\", function(module, exports) {\n\n$parcel$export(module.exports, \"textToolDialog\", function () { return $7a7111f71abacc0a$export$e263e067d6140649; });\n\nvar $cL71g = parcelRequire(\"cL71g\");\n\nvar $4EWN2 = parcelRequire(\"4EWN2\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $2MaaK = parcelRequire(\"2MaaK\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $2NQHg = parcelRequire(\"2NQHg\");\n\nvar $4aPno = parcelRequire(\"4aPno\");\n\nvar $l2lnZ = parcelRequire(\"l2lnZ\");\n\nvar $7xBn4 = parcelRequire(\"7xBn4\");\n\nvar $MbxPB = parcelRequire(\"MbxPB\");\n\nvar $6Tfl8 = parcelRequire(\"6Tfl8\");\n\nvar $amum4 = parcelRequire(\"amum4\");\n\nvar $jXowp = parcelRequire(\"jXowp\");\n\nvar $e4sAN = parcelRequire(\"e4sAN\");\nfunction $7a7111f71abacc0a$export$e263e067d6140649(p) {\n    var onUpdate = function onUpdate(p) {\n        text = (0, $cL71g._)({}, text, p);\n        viewportUI.setText(text);\n    };\n    var onScroll = // prevent mobile keyboards scrolling page\n    function onScroll() {\n        window.scrollTo(0, 0);\n    };\n    var rootEl = (0, $eWjiX.BB).el({});\n    var text = (0, $eWjiX.BB).copyObj(p.text);\n    var viewportWrapper = (0, $eWjiX.BB).el({\n        className: $6Tfl8.viewportWrapper\n    });\n    var viewportUI = new (0, $MbxPB.TextToolViewportUI)({\n        text: text,\n        klCanvas: p.klCanvas,\n        layerIndex: p.layerIndex,\n        onDragEnd: function() {\n            return tabs.getOpenedTabId() === \"text\" ? textUI.focus() : 0;\n        }\n    });\n    viewportUI.render();\n    var fontUI = new (0, $4aPno.TextToolFontUI)((0, $4EWN2._)((0, $cL71g._)({}, text), {\n        onUpdate: function(p) {\n            onUpdate(p);\n        }\n    }));\n    var colorWrapper = (0, $eWjiX.BB).el({\n        css: {\n            display: \"flex\",\n            gap: \"10px\",\n            flexDirection: \"column\"\n        }\n    });\n    var fillUI = new (0, $2NQHg.TextToolFillUI)({\n        fill: text.fill,\n        primaryColor: p.primaryColor,\n        secondaryColor: p.secondaryColor,\n        onUpdate: function(p) {\n            onUpdate(p);\n        }\n    });\n    var strokeUI = new (0, $l2lnZ.TextToolStrokeUI)({\n        stroke: text.stroke,\n        primaryColor: p.primaryColor,\n        secondaryColor: p.secondaryColor,\n        onUpdate: function(p) {\n            onUpdate(p);\n        }\n    });\n    var textUI = new (0, $7xBn4.TextToolTextUI)({\n        text: text.text,\n        onUpdate: function(p) {\n            p.text !== undefined && modal.setIgnoreBackground(p.text.length > 0);\n            onUpdate(p);\n        }\n    });\n    var tabs = new (0, $e4sAN.TabRow)({\n        initialId: \"text\",\n        height: 40,\n        tabArr: [\n            {\n                id: \"text\",\n                label: (0, $1mH1z.LANG)(\"text-text\"),\n                onOpen: function() {\n                    textUI.getElement().style.display = \"\";\n                    textUI.focus();\n                },\n                onClose: function() {\n                    textUI.getElement().style.display = \"none\";\n                }\n            },\n            {\n                id: \"font\",\n                label: (0, $1mH1z.LANG)(\"text-font\"),\n                onOpen: function() {\n                    fontUI.getElement().style.display = \"flex\";\n                },\n                onClose: function() {\n                    fontUI.getElement().style.display = \"none\";\n                }\n            },\n            {\n                id: \"color\",\n                label: (0, $1mH1z.LANG)(\"text-color\"),\n                onOpen: function() {\n                    colorWrapper.style.display = \"flex\";\n                },\n                onClose: function() {\n                    colorWrapper.style.display = \"none\";\n                }\n            }\n        ]\n    });\n    tabs.getElement().classList.add((0, $jXowp.css)({\n        minWidth: \"200px\",\n        maxWidth: \"500px\",\n        flexGrow: \"1\",\n        borderBottom: \"none !important\"\n    }));\n    var viewportInputsCss = (0, $jXowp.css)({\n        position: \"relative\",\n        \">*\": {\n            position: \"absolute\",\n            right: 0,\n            top: 10\n        }\n    });\n    var tabWrapperCss = (0, $jXowp.css)({\n        display: \"flex\",\n        justifyContent: \"space-between\",\n        flexDirection: \"row-reverse\",\n        flexWrap: \"wrap\",\n        marginTop: \"10px\",\n        marginLeft: \"-20px\",\n        marginRight: \"-20px\",\n        padding: \"0 20px\",\n        \"@media (min-width: 700px) and (min-height: 700px)\": {\n            display: \"none !important\"\n        }\n    });\n    var inputsCss = (0, $jXowp.css)({\n        minHeight: 72,\n        marginTop: \"10px\",\n        \"@media (min-width: 700px) and (min-height: 700px)\": {\n            display: \"flex\",\n            flexDirection: \"column\",\n            gap: \"10px\",\n            \">*\": {\n                display: \"flex !important\"\n            }\n        }\n    });\n    rootEl.append((0, $amum4.c)(\"\", [\n        (0, $amum4.c)(viewportWrapper, [\n            viewportUI.getElement()\n        ]),\n        (0, $amum4.c)(\".\" + viewportInputsCss, [\n            viewportUI.getInputsElement()\n        ]),\n        (0, $amum4.c)(\".tabrow.\" + tabWrapperCss, [\n            (0, $amum4.c)(\",w-240,h-40\"),\n            tabs.getElement()\n        ]),\n        (0, $amum4.c)(\".\" + inputsCss, [\n            (0, $amum4.c)(colorWrapper, [\n                fillUI.getElement(),\n                strokeUI.getElement()\n            ]),\n            fontUI.getElement(),\n            textUI.getElement()\n        ])\n    ]));\n    var onResize = function() {\n        var b = viewportWrapper.getBoundingClientRect();\n        var w = Math.ceil(b.width);\n        var h = Math.ceil(b.height);\n        viewportUI.setSize(w, h);\n    };\n    window.addEventListener(\"resize\", onResize);\n    setTimeout(function() {\n        onResize();\n    });\n    setTimeout(function() {\n        textUI.focus();\n    }, 100);\n    window.addEventListener(\"scroll\", onScroll);\n    var onModalExit = function(val) {\n        window.removeEventListener(\"resize\", onResize);\n        window.removeEventListener(\"scroll\", onScroll);\n        viewportUI.destroy();\n        fontUI.destroy();\n        fillUI.destroy();\n        strokeUI.destroy();\n        textUI.destroy();\n        tabs.destroy();\n        if (val === \"Ok\") p.onConfirm((0, $cL71g._)({}, viewportUI.getValues(), fontUI.getValues(), fillUI.getValues(), strokeUI.getValues(), textUI.getValues()));\n    };\n    var modal = (0, $2MaaK.showModal)({\n        target: document.body,\n        message: \"<b>\".concat((0, $1mH1z.LANG)(\"text-title\"), \"</b>\"),\n        div: rootEl,\n        buttons: [\n            \"Ok\",\n            \"Cancel\"\n        ],\n        ignoreBackground: p.text.text.length > 0,\n        callback: onModalExit,\n        style: {\n            width: \"calc(100% - 50px)\",\n            maxWidth: \"1000px\",\n            minWidth: \"300px\",\n            boxSizing: \"border-box\"\n        },\n        clickOnEnter: \"Ok\"\n    });\n}\n\n});\nparcelRequire.register(\"2NQHg\", function(module, exports) {\n\n$parcel$export(module.exports, \"TextToolFillUI\", function () { return $0c994c56e6434e84$export$5cdfb22682d2a5dd; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $cL71g = parcelRequire(\"cL71g\");\n\nvar $4EWN2 = parcelRequire(\"4EWN2\");\n\nvar $43qNf = parcelRequire(\"43qNf\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $amum4 = parcelRequire(\"amum4\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $0c994c56e6434e84$export$5cdfb22682d2a5dd = /*#__PURE__*/ function() {\n    \"use strict\";\n    function TextToolFillUI(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, TextToolFillUI);\n        var emit = function() {\n            p.onUpdate(_this.getValues());\n        };\n        var colorOptionsArr = [\n            null,\n            p.fill ? (0, $4EWN2._)((0, $cL71g._)({}, p.fill.color), {\n                a: 1\n            }) : null,\n            (0, $4EWN2._)((0, $cL71g._)({}, p.primaryColor), {\n                a: 1\n            }),\n            (0, $4EWN2._)((0, $cL71g._)({}, p.secondaryColor), {\n                a: 1\n            }),\n            {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 1\n            },\n            {\n                r: 255,\n                g: 255,\n                b: 255,\n                a: 1\n            }\n        ];\n        this.colorOptions = new (0, $43qNf.ColorOptions)({\n            colorArr: colorOptionsArr,\n            initialIndex: p.fill ? 1 : 0,\n            title: (0, $1mH1z.LANG)(\"shape-fill\"),\n            onChange: function(c) {\n                _this.opacitySlider.getElement().style.display = c !== null ? \"\" : \"none\";\n                emit();\n            }\n        });\n        this.opacitySlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"opacity\"),\n            width: 150,\n            height: 30,\n            min: 0.01,\n            max: 1,\n            value: p.fill ? p.fill.color.a : 1,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toValue: function(displayValue) {\n                return displayValue / 100;\n            },\n            toDisplayValue: function(value) {\n                return value * 100;\n            },\n            onChange: function() {\n                return emit();\n            }\n        });\n        this.opacitySlider.getElement().style.display = p.fill ? \"\" : \"none\";\n        var svg = (0, $7jh4K.createSvg)({\n            elementType: \"svg\",\n            class: \"dark-invert\",\n            width: \"25px\",\n            height: \"25px\",\n            viewBox: \"0 0 30 30\",\n            childrenArr: [\n                {\n                    elementType: \"polyline\",\n                    points: \"0,0 30,0 30,8 19,8 19,30 11,30 11,8 0,8 0,0 1,0\",\n                    \"transform-origin\": \"15px 15px\",\n                    transform: \"scale(0.8)\",\n                    fill: \"#000c\"\n                }\n            ]\n        });\n        this.rootEl = (0, $amum4.c)(\",flex,gap-10,items-center,flexWrap,minh-30\", [\n            svg,\n            this.colorOptions.getElement(),\n            this.opacitySlider.getElement()\n        ]);\n    }\n    (0, $7h4XF._)(TextToolFillUI, [\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"getValues\",\n            value: function getValues() {\n                var c = this.colorOptions.getValue();\n                if (c === null || (c === null || c === void 0 ? void 0 : c.a) === 0) return {\n                    fill: undefined\n                };\n                var color = (0, $4EWN2._)((0, $cL71g._)({}, c), {\n                    a: this.opacitySlider.getValue()\n                });\n                return {\n                    fill: {\n                        color: color\n                    }\n                };\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.colorOptions.destroy();\n                this.opacitySlider.destroy();\n            }\n        }\n    ]);\n    return TextToolFillUI;\n}();\n\n});\n\nparcelRequire.register(\"4aPno\", function(module, exports) {\n\n$parcel$export(module.exports, \"TextToolFontUI\", function () { return $d84067eeb22a523d$export$2e7faedafda1fc85; });\n\nvar $1LaJZ = parcelRequire(\"1LaJZ\");\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $bX4ja = parcelRequire(\"bX4ja\");\n\nvar $2gUX3 = parcelRequire(\"2gUX3\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $dJPtW = parcelRequire(\"dJPtW\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $4nUqS = parcelRequire(\"4nUqS\");\n\nvar $itzxn = parcelRequire(\"itzxn\");\n\nvar $3RXBC = parcelRequire(\"3RXBC\");\n\nvar $dtB7M = parcelRequire(\"dtB7M\");\n\nvar $3qZsM = parcelRequire(\"3qZsM\");\n\nvar $68rzB = parcelRequire(\"68rzB\");\n\nvar $1kyaA = parcelRequire(\"1kyaA\");\n\nvar $eEL9N = parcelRequire(\"eEL9N\");\n\nvar $amum4 = parcelRequire(\"amum4\");\n\nvar $gE7dS = parcelRequire(\"gE7dS\");\nvar $d84067eeb22a523d$var$importedFonts = [\n    {\n        fontFamily: \"sans-serif\",\n        fontName: \"Sans-serif\"\n    },\n    {\n        fontFamily: \"serif\",\n        fontName: \"Serif\"\n    },\n    {\n        fontFamily: \"monospace\",\n        fontName: \"Monospace\"\n    },\n    {\n        fontFamily: \"cursive\",\n        fontName: \"Cursive\"\n    },\n    {\n        fontFamily: \"fantasy\",\n        fontName: \"Fantasy\"\n    }\n].concat((0, $bX4ja._)((0, $gE7dS.fonts).map(function(item) {\n    return {\n        fontFamily: item.name,\n        fontName: item.name\n    };\n})));\nvar $d84067eeb22a523d$var$didLoadBundledFonts = false;\nfunction $d84067eeb22a523d$var$loadBundledFonts() {\n    return $d84067eeb22a523d$var$_loadBundledFonts.apply(this, arguments);\n}\nfunction $d84067eeb22a523d$var$_loadBundledFonts() {\n    $d84067eeb22a523d$var$_loadBundledFonts = (0, $1LaJZ._)(function() {\n        var _loop, promises, i;\n        return (0, $2gUX3.__generator)(this, function(_state) {\n            switch(_state.label){\n                case 0:\n                    _loop = function(i) {\n                        promises.push((0, $1LaJZ._)(function() {\n                            var item, response, buffer, font;\n                            return (0, $2gUX3.__generator)(this, function(_state) {\n                                switch(_state.label){\n                                    case 0:\n                                        item = (0, $gE7dS.fonts)[i];\n                                        return [\n                                            4,\n                                            fetch(item.url)\n                                        ];\n                                    case 1:\n                                        response = _state.sent();\n                                        return [\n                                            4,\n                                            response.arrayBuffer()\n                                        ];\n                                    case 2:\n                                        buffer = _state.sent();\n                                        font = new FontFace(item.name, buffer);\n                                        document.fonts.add(font);\n                                        return [\n                                            2\n                                        ];\n                                }\n                            });\n                        })());\n                    };\n                    if ($d84067eeb22a523d$var$didLoadBundledFonts) return [\n                        2\n                    ];\n                    $d84067eeb22a523d$var$didLoadBundledFonts = true;\n                    promises = [];\n                    for(i = 0; i < (0, $gE7dS.fonts).length; i++)_loop(i);\n                    return [\n                        4,\n                        Promise.all(promises)\n                    ];\n                case 1:\n                    _state.sent();\n                    return [\n                        2\n                    ];\n            }\n        });\n    });\n    return $d84067eeb22a523d$var$_loadBundledFonts.apply(this, arguments);\n}\nvar $d84067eeb22a523d$export$2e7faedafda1fc85 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function TextToolFontUI(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, TextToolFontUI);\n        this.onUpdate = p.onUpdate;\n        this.fontSelect = new (0, $eEL9N.Select)({\n            initValue: p.font,\n            optionArr: $d84067eeb22a523d$var$importedFonts.map(function(i) {\n                return [\n                    i.fontFamily,\n                    i.fontName,\n                    {\n                        css: {\n                            fontFamily: i.fontFamily,\n                            fontSize: \"1.2em\"\n                        }\n                    }\n                ];\n            }),\n            isFocusable: true,\n            css: {\n                width: \"180px\"\n            },\n            onChange: function(v) {\n                _this.loadBundledFonts();\n                p.onUpdate({\n                    font: v\n                });\n            }\n        });\n        this.onFocus = function() {\n            return _this.loadBundledFonts();\n        };\n        this.fontSelect.getElement().addEventListener(\"focus\", this.onFocus);\n        this.fontPointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.fontSelect.getElement(),\n            onWheel: function(e) {\n                return _this.fontSelect.setDeltaValue(e.deltaY);\n            }\n        });\n        this.importButton = (0, $eWjiX.BB).el({\n            tagName: \"button\",\n            content: (0, $1mH1z.LANG)(\"file-import\"),\n            onClick: function() {\n                _this.importFont();\n            }\n        });\n        var sizeLabel = (0, $eWjiX.BB).el({\n            content: '<div><span style=\"font-size: 0.6em; margin-right: -1px\">A</span>A</div>',\n            css: {\n                width: \"25px\",\n                height: \"25px\",\n                display: \"flex\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n                fontSize: \"1.2em\",\n                userSelect: \"none\"\n            }\n        });\n        this.sizeInput = new (0, $dJPtW.Input)({\n            title: (0, $1mH1z.LANG)(\"text-size\"),\n            type: \"number\",\n            min: 0,\n            max: 1000,\n            init: p.size,\n            onChange: function(v) {\n                p.onUpdate({\n                    size: parseFloat(v)\n                });\n            },\n            doResetIfInvalid: true,\n            doScrollWithoutFocus: true,\n            css: {\n                width: \"70px\"\n            }\n        });\n        var _p_lineHeight;\n        this.lineHeightInput = new (0, $dJPtW.Input)({\n            label: (0, $1mH1z.LANG)(\"text-line-height\"),\n            type: \"number\",\n            min: 0,\n            max: 10,\n            step: 0.1,\n            init: (_p_lineHeight = p.lineHeight) !== null && _p_lineHeight !== void 0 ? _p_lineHeight : 1,\n            onChange: function(v) {\n                p.onUpdate({\n                    lineHeight: parseFloat(v)\n                });\n            },\n            doResetIfInvalid: true,\n            doScrollWithoutFocus: true,\n            css: {\n                width: \"60px\"\n            }\n        });\n        var _p_letterSpacing;\n        this.letterSpacingInput = new (0, $dJPtW.Input)({\n            label: (0, $1mH1z.LANG)(\"text-letter-spacing\"),\n            type: \"number\",\n            min: -100,\n            max: 100,\n            init: (_p_letterSpacing = p.letterSpacing) !== null && _p_letterSpacing !== void 0 ? _p_letterSpacing : 0,\n            onChange: function(v) {\n                p.onUpdate({\n                    letterSpacing: parseFloat(v)\n                });\n            },\n            doResetIfInvalid: true,\n            doScrollWithoutFocus: true,\n            css: {\n                width: \"60px\"\n            }\n        });\n        this.alignRadioList = new (0, $4nUqS.ImageRadioList)({\n            optionArr: [\n                {\n                    id: \"left\",\n                    title: (0, $1mH1z.LANG)(\"text-left\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($itzxn))),\n                    darkInvert: true\n                },\n                {\n                    id: \"center\",\n                    title: (0, $1mH1z.LANG)(\"text-center\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($3RXBC))),\n                    darkInvert: true\n                },\n                {\n                    id: \"right\",\n                    title: (0, $1mH1z.LANG)(\"text-right\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($dtB7M))),\n                    darkInvert: true\n                }\n            ],\n            initId: p.align,\n            onChange: function(v) {\n                return p.onUpdate({\n                    align: v\n                });\n            }\n        });\n        this.italicToggle = new (0, $1kyaA.ImageToggle)({\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($3qZsM))),\n            title: (0, $1mH1z.LANG)(\"text-italic\"),\n            initValue: p.isItalic,\n            onChange: function(v) {\n                return p.onUpdate({\n                    isItalic: v\n                });\n            },\n            darkInvert: true\n        });\n        this.boldToggle = new (0, $1kyaA.ImageToggle)({\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($68rzB))),\n            title: (0, $1mH1z.LANG)(\"text-bold\"),\n            initValue: p.isBold,\n            onChange: function(v) {\n                return p.onUpdate({\n                    isBold: v\n                });\n            },\n            darkInvert: true\n        });\n        this.rootEl = (0, $amum4.c)(\",flex,flexWrap,gap-10-15,items-center\", [\n            (0, $amum4.c)(\",flex,gap-5,items-center\", [\n                sizeLabel,\n                this.sizeInput.getElement()\n            ]),\n            (0, $amum4.c)(\",flex,gap-5\", [\n                this.fontSelect.getElement(),\n                this.importButton\n            ]),\n            (0, $amum4.c)(\",flex,gap-7\", [\n                this.alignRadioList.getElement(),\n                this.italicToggle.getElement(),\n                this.boldToggle.getElement()\n            ]),\n            this.letterSpacingInput.getElement(),\n            this.lineHeightInput.getElement()\n        ]);\n    }\n    (0, $7h4XF._)(TextToolFontUI, [\n        {\n            key: \"loadBundledFonts\",\n            value: // only load fonts when interacting with the font input\n            function loadBundledFonts1() {\n                var _this = this;\n                !$d84067eeb22a523d$var$didLoadBundledFonts && $d84067eeb22a523d$var$loadBundledFonts().then(function() {\n                    _this.onUpdate({\n                        font: _this.fontSelect.getValue()\n                    });\n                });\n            }\n        },\n        {\n            key: \"importFont\",\n            value: function importFont() {\n                var input = document.createElement(\"input\");\n                input.type = \"file\";\n                input.multiple = true;\n                input.accept = \".ttf, .otf, .woff, .woff2, .eot\";\n                input.focus();\n                input.click();\n                var _this = this;\n                input.onchange = /*#__PURE__*/ (0, $1LaJZ._)(function() {\n                    var toSelect, fontFamilies, i, file, fontName, split, font, _, _tmp;\n                    return (0, $2gUX3.__generator)(this, function(_state) {\n                        switch(_state.label){\n                            case 0:\n                                if (!input.files || input.files.length === 0) return [\n                                    2\n                                ];\n                                toSelect = undefined;\n                                fontFamilies = $d84067eeb22a523d$var$importedFonts.map(function(i) {\n                                    return i.fontFamily;\n                                });\n                                i = 0;\n                                _state.label = 1;\n                            case 1:\n                                if (!(i < input.files.length)) return [\n                                    3,\n                                    4\n                                ];\n                                file = input.files[i];\n                                fontName = \"kl-\" + $d84067eeb22a523d$var$importedFonts.length;\n                                if (fontFamilies.includes(fontName)) return [\n                                    3,\n                                    3\n                                ];\n                                if (!toSelect) {\n                                    toSelect = fontName;\n                                    _this.importButton.disabled = true;\n                                    _this.importButton.innerText = (0, $1mH1z.LANG)(\"loading\");\n                                }\n                                split = file.name.split(\".\");\n                                split.pop();\n                                $d84067eeb22a523d$var$importedFonts.push({\n                                    fontFamily: fontName,\n                                    fontName: split.join(\".\")\n                                });\n                                _ = FontFace.bind;\n                                _tmp = [\n                                    void 0,\n                                    fontName\n                                ];\n                                return [\n                                    4,\n                                    file.arrayBuffer()\n                                ];\n                            case 2:\n                                font = new (_.apply(FontFace, _tmp.concat([\n                                    _state.sent()\n                                ])));\n                                document.fonts.add(font);\n                                _state.label = 3;\n                            case 3:\n                                i++;\n                                return [\n                                    3,\n                                    1\n                                ];\n                            case 4:\n                                // update font selection\n                                setTimeout(function() {\n                                    _this.fontSelect.setOptionArr($d84067eeb22a523d$var$importedFonts.map(function(i) {\n                                        return [\n                                            i.fontFamily,\n                                            i.fontName,\n                                            {\n                                                css: {\n                                                    fontFamily: i.fontFamily,\n                                                    fontSize: \"1.2em\"\n                                                }\n                                            }\n                                        ];\n                                    }));\n                                    _this.fontSelect.setValue(toSelect);\n                                    _this.onUpdate({\n                                        font: toSelect\n                                    });\n                                    _this.importButton.disabled = false;\n                                    _this.importButton.innerText = (0, $1mH1z.LANG)(\"file-import\");\n                                });\n                                return [\n                                    2\n                                ];\n                        }\n                    });\n                });\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"getValues\",\n            value: function getValues() {\n                return {\n                    font: this.fontSelect.getValue(),\n                    size: +this.sizeInput.getValue(),\n                    letterSpacing: +this.letterSpacingInput.getValue(),\n                    lineHeight: +this.lineHeightInput.getValue(),\n                    align: this.alignRadioList.getValue(),\n                    isItalic: this.italicToggle.getValue(),\n                    isBold: this.boldToggle.getValue()\n                };\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.fontPointerListener.destroy();\n                this.fontSelect.getElement().removeEventListener(\"focus\", this.onFocus);\n                this.fontSelect.destroy();\n                (0, $eWjiX.BB).destroyEl(this.importButton);\n                this.sizeInput.destroy();\n                this.lineHeightInput.destroy();\n                this.letterSpacingInput.destroy();\n                this.alignRadioList.destroy();\n                this.italicToggle.destroy();\n                this.boldToggle.destroy();\n            }\n        }\n    ]);\n    return TextToolFontUI;\n}();\n\n});\nparcelRequire.register(\"itzxn\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"2WSh2\");\n\n});\n\nparcelRequire.register(\"3RXBC\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"lHK8L\");\n\n});\n\nparcelRequire.register(\"dtB7M\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"3kjmQ\");\n\n});\n\nparcelRequire.register(\"3qZsM\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"g8nvA\");\n\n});\n\nparcelRequire.register(\"68rzB\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"axEKL\");\n\n});\n\nparcelRequire.register(\"gE7dS\", function(module, exports) {\n\n$parcel$export(module.exports, \"fonts\", function () { return $4830416abb0c56c9$export$f45fbea8fe20ca8a; });\n\nvar $cr8hf = parcelRequire(\"cr8hf\");\n\nvar $5vm9m = parcelRequire(\"5vm9m\");\n\nvar $krgkA = parcelRequire(\"krgkA\");\n\nvar $2ak4V = parcelRequire(\"2ak4V\");\n\nvar $7xb38 = parcelRequire(\"7xb38\");\n\nvar $ldVTx = parcelRequire(\"ldVTx\");\n\nvar $6EVai = parcelRequire(\"6EVai\");\n\nvar $lRyM4 = parcelRequire(\"lRyM4\");\n\nvar $9NBnh = parcelRequire(\"9NBnh\");\n\nvar $6rOLc = parcelRequire(\"6rOLc\");\n\nvar $dk8Is = parcelRequire(\"dk8Is\");\n\nvar $edjtV = parcelRequire(\"edjtV\");\n\nvar $4do1t = parcelRequire(\"4do1t\");\n\nvar $kH2iD = parcelRequire(\"kH2iD\");\n\nvar $acHch = parcelRequire(\"acHch\");\n\nvar $ayzR9 = parcelRequire(\"ayzR9\");\nvar $4830416abb0c56c9$export$f45fbea8fe20ca8a = [\n    {\n        name: \"Caveat\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($cr8hf)))\n    },\n    {\n        name: \"ClimateCrisis\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($5vm9m)))\n    },\n    {\n        name: \"CorrectionBrush\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($krgkA)))\n    },\n    {\n        name: \"DancingScript\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($2ak4V)))\n    },\n    {\n        name: \"Diabolik\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($7xb38)))\n    },\n    {\n        name: \"FreckleFace\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($ldVTx)))\n    },\n    {\n        name: \"Gloock\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($6EVai)))\n    },\n    {\n        name: \"GochiHand\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($9NBnh)))\n    },\n    {\n        name: \"Pacha\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($lRyM4)))\n    },\n    {\n        name: \"PassionOne\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($6rOLc)))\n    },\n    {\n        name: \"PixeloidSans\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($dk8Is)))\n    },\n    {\n        name: \"PlaypenSans\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($edjtV)))\n    },\n    {\n        name: \"Quicksand\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($4do1t)))\n    },\n    {\n        name: \"Silkscreen\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($kH2iD)))\n    },\n    {\n        name: \"Tehroc\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($acHch)))\n    },\n    {\n        name: \"YUNGA\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($ayzR9)))\n    }\n];\n\n});\nparcelRequire.register(\"cr8hf\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"hapKl\");\n\n});\n\nparcelRequire.register(\"5vm9m\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"dqzux\");\n\n});\n\nparcelRequire.register(\"krgkA\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"l7VGL\");\n\n});\n\nparcelRequire.register(\"2ak4V\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"dm0T7\");\n\n});\n\nparcelRequire.register(\"7xb38\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"2U3dq\");\n\n});\n\nparcelRequire.register(\"ldVTx\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"axzlU\");\n\n});\n\nparcelRequire.register(\"6EVai\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"avgh6\");\n\n});\n\nparcelRequire.register(\"lRyM4\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"H9bSu\");\n\n});\n\nparcelRequire.register(\"9NBnh\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"emBfm\");\n\n});\n\nparcelRequire.register(\"6rOLc\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"kjRvm\");\n\n});\n\nparcelRequire.register(\"dk8Is\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"c79R0\");\n\n});\n\nparcelRequire.register(\"edjtV\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"fndWQ\");\n\n});\n\nparcelRequire.register(\"4do1t\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"iAFmc\");\n\n});\n\nparcelRequire.register(\"kH2iD\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"2Bq6W\");\n\n});\n\nparcelRequire.register(\"acHch\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"hmfbp\");\n\n});\n\nparcelRequire.register(\"ayzR9\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"iItsG\");\n\n});\n\n\n\nparcelRequire.register(\"l2lnZ\", function(module, exports) {\n\n$parcel$export(module.exports, \"TextToolStrokeUI\", function () { return $1d4a3fd6cf6c0a9d$export$42bb0e3b48d549f6; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $cL71g = parcelRequire(\"cL71g\");\n\nvar $4EWN2 = parcelRequire(\"4EWN2\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $43qNf = parcelRequire(\"43qNf\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $amum4 = parcelRequire(\"amum4\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $1d4a3fd6cf6c0a9d$export$42bb0e3b48d549f6 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function TextToolStrokeUI(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, TextToolStrokeUI);\n        this.rootEl = (0, $eWjiX.BB).el({\n            css: {\n                boxShadow: \"0 0 0 1px #aaa\"\n            }\n        });\n        var emit = function() {\n            p.onUpdate(_this.getValues());\n        };\n        var colorOptionsArr = [\n            null,\n            p.stroke ? (0, $4EWN2._)((0, $cL71g._)({}, p.stroke.color), {\n                a: 1\n            }) : null,\n            (0, $4EWN2._)((0, $cL71g._)({}, p.secondaryColor), {\n                a: 1\n            }),\n            (0, $4EWN2._)((0, $cL71g._)({}, p.primaryColor), {\n                a: 1\n            }),\n            {\n                r: 255,\n                g: 255,\n                b: 255,\n                a: 1\n            },\n            {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 1\n            }\n        ];\n        this.colorOptions = new (0, $43qNf.ColorOptions)({\n            colorArr: colorOptionsArr,\n            initialIndex: p.stroke ? 1 : 0,\n            title: (0, $1mH1z.LANG)(\"shape-stroke\"),\n            onChange: function(c) {\n                _this.opacitySlider.getElement().style.display = c !== null ? \"\" : \"none\";\n                _this.lineWidthSlider.getElement().style.display = c !== null ? \"\" : \"none\";\n                emit();\n            }\n        });\n        this.opacitySlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"opacity\"),\n            width: 150,\n            height: 30,\n            min: 0.01,\n            max: 1,\n            value: p.stroke ? p.stroke.color.a : 1,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toValue: function(displayValue) {\n                return displayValue / 100;\n            },\n            toDisplayValue: function(value) {\n                return value * 100;\n            },\n            onChange: function() {\n                return emit();\n            }\n        });\n        this.lineWidthSlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"shape-line-width\"),\n            width: 150,\n            height: 30,\n            min: 0.5,\n            max: 100,\n            value: p.stroke ? p.stroke.lineWidth : 2,\n            eventResMs: 1000 / 30,\n            curve: \"quadratic\",\n            onChange: function() {\n                return emit();\n            }\n        });\n        this.opacitySlider.getElement().style.display = p.stroke ? \"\" : \"none\";\n        this.lineWidthSlider.getElement().style.display = p.stroke ? \"\" : \"none\";\n        var svg = (0, $7jh4K.createSvg)({\n            elementType: \"svg\",\n            class: \"dark-invert\",\n            width: \"25px\",\n            height: \"25px\",\n            viewBox: \"0 0 30 30\",\n            childrenArr: [\n                {\n                    elementType: \"polyline\",\n                    points: \"0,0 30,0 30,8 19,8 19,30 11,30 11,8 0,8 0,0 1,0\",\n                    fill: \"none\",\n                    stroke: \"#000c\",\n                    \"stroke-width\": \"3\",\n                    \"transform-origin\": \"15px 15px\",\n                    transform: \"scale(0.8)\"\n                }\n            ]\n        });\n        this.rootEl = (0, $amum4.c)(\",flex,gap-10,items-center,flexWrap,minh-30\", [\n            svg,\n            this.colorOptions.getElement(),\n            this.opacitySlider.getElement(),\n            this.lineWidthSlider.getElement()\n        ]);\n    }\n    (0, $7h4XF._)(TextToolStrokeUI, [\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"getValues\",\n            value: function getValues() {\n                var c = this.colorOptions.getValue();\n                if (c === null || (c === null || c === void 0 ? void 0 : c.a) === 0) return {\n                    stroke: undefined\n                };\n                var color = (0, $4EWN2._)((0, $cL71g._)({}, c), {\n                    a: this.opacitySlider.getValue()\n                });\n                return {\n                    stroke: {\n                        color: color,\n                        lineWidth: this.lineWidthSlider.getValue()\n                    }\n                };\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.colorOptions.destroy();\n                this.opacitySlider.destroy();\n                this.lineWidthSlider.destroy();\n            }\n        }\n    ]);\n    return TextToolStrokeUI;\n}();\n\n});\n\nparcelRequire.register(\"7xBn4\", function(module, exports) {\n\n$parcel$export(module.exports, \"TextToolTextUI\", function () { return $c85fd0de8751b6a0$export$c6656360602b35c2; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $amum4 = parcelRequire(\"amum4\");\nvar $c85fd0de8751b6a0$export$c6656360602b35c2 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function TextToolTextUI(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, TextToolTextUI);\n        this.onInput = function() {\n            _this.emit();\n        };\n        this.lastEmittedText = p.text;\n        this.onUpdate = p.onUpdate;\n        this.rootEl = (0, $amum4.c)(\"\");\n        this.textInput = (0, $eWjiX.BB).el({\n            tagName: \"textarea\",\n            parent: this.rootEl,\n            content: p.text,\n            custom: {\n                placeholder: (0, $1mH1z.LANG)(\"text-placeholder\")\n            },\n            css: {\n                whiteSpace: \"pre\",\n                overflow: \"auto\",\n                width: \"100%\",\n                height: \"70px\",\n                resize: \"vertical\"\n            },\n            onChange: function() {\n                _this.emit();\n            }\n        });\n        this.textInput.addEventListener(\"input\", this.onInput);\n    }\n    (0, $7h4XF._)(TextToolTextUI, [\n        {\n            key: \"emit\",\n            value: function emit() {\n                var text = this.textInput.value;\n                if (text === this.lastEmittedText) return;\n                this.lastEmittedText = text;\n                this.onUpdate({\n                    text: text\n                });\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"getValues\",\n            value: function getValues() {\n                return {\n                    text: this.textInput.value\n                };\n            }\n        },\n        {\n            key: \"focus\",\n            value: function focus() {\n                this.textInput.focus();\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                (0, $eWjiX.BB).destroyEl(this.textInput);\n                this.textInput.removeEventListener(\"input\", this.onInput);\n            }\n        }\n    ]);\n    return TextToolTextUI;\n}();\n\n});\n\nparcelRequire.register(\"MbxPB\", function(module, exports) {\n\n$parcel$export(module.exports, \"TextToolViewportUI\", function () { return $5ffe4a6cd7b98bc8$export$1d311696e0fb2158; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $cL71g = parcelRequire(\"cL71g\");\n\nvar $4EWN2 = parcelRequire(\"4EWN2\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\n\nvar $1C8RU = parcelRequire(\"1C8RU\");\n\nvar $h20yl = parcelRequire(\"h20yl\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $fORLP = parcelRequire(\"fORLP\");\n\nvar $kRxRZ = parcelRequire(\"kRxRZ\");\n\nvar $amum4 = parcelRequire(\"amum4\");\nvar $5ffe4a6cd7b98bc8$export$1d311696e0fb2158 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function TextToolViewportUI(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, TextToolViewportUI);\n        this.offset = {\n            x: 0,\n            y: 0\n        };\n        this.zoomFac = 0;\n        this.scale = 1;\n        this.layerArr = [];\n        this.onDarkChange = function() {\n            _this.checkerPattern = (0, $7jh4K.throwIfNull)(_this.previewCtx.createPattern((0, $eWjiX.BB).createCheckerCanvas(8, (0, $1C8RU.theme).isDark()), \"repeat\"));\n            _this.render();\n        };\n        this.rootEl = (0, $amum4.c)();\n        this.text = p.text;\n        this.layerIndex = p.layerIndex;\n        var isSmallWidth = window.innerWidth < 550;\n        var isSmallHeight = window.innerHeight < 630;\n        // --- preview ---\n        // Text drawn on klCanvas-sized canvas: textCanvas\n        // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\n        //      they are transformed. canvas size of final preview\n        // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\n        // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\n        this.width = isSmallWidth ? 340 : 540;\n        this.height = isSmallWidth ? isSmallHeight ? 210 : 260 : isSmallHeight ? 230 : 350;\n        this.layerArr = p.klCanvas.getLayersFast();\n        this.textCanvas = (0, $eWjiX.BB).canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\n        this.textCtx = (0, $eWjiX.BB).ctx(this.textCanvas);\n        this.targetCanvas = (0, $eWjiX.BB).canvas(this.width, this.height);\n        this.targetCtx = (0, $eWjiX.BB).ctx(this.targetCanvas);\n        this.layersCanvas = (0, $eWjiX.BB).canvas(this.width, this.height);\n        this.layersCtx = (0, $eWjiX.BB).ctx(this.layersCanvas);\n        this.previewCanvas = (0, $eWjiX.BB).canvas(this.width, this.height); // the one that is visible\n        this.previewCtx = (0, $eWjiX.BB).ctx(this.previewCanvas);\n        (0, $eWjiX.BB).css(this.previewCanvas, {\n            display: \"block\"\n        });\n        this.previewWrapper = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                position: \"relative\",\n                width: this.width + \"px\",\n                cursor: \"move\",\n                touchAction: \"none\"\n            }\n        });\n        (0, $eWjiX.BB).el({\n            parent: this.previewWrapper,\n            className: \"kl-text-preview-wrapper\"\n        });\n        this.previewWrapper.append(this.previewCanvas);\n        this.checkerPattern = (0, $7jh4K.throwIfNull)(this.previewCtx.createPattern((0, $eWjiX.BB).createCheckerCanvas(8, (0, $1C8RU.theme).isDark()), \"repeat\"));\n        this.emptyCanvas = (0, $eWjiX.BB).canvas(1, 1);\n        this.emptyCanvasLight = (0, $eWjiX.BB).canvas(1, 1);\n        {\n            var ctx = (0, $eWjiX.BB).ctx(this.emptyCanvas);\n            ctx.fillRect(0, 0, 1, 1);\n            ctx = (0, $eWjiX.BB).ctx(this.emptyCanvasLight);\n            ctx.fillStyle = \"#fff\";\n            ctx.fillRect(0, 0, 1, 1);\n        }\n        (0, $1C8RU.theme).addIsDarkListener(this.onDarkChange);\n        this.previewCanvas.oncontextmenu = function(e) {\n            return e.preventDefault();\n        };\n        var dragged = false;\n        var isDown = false;\n        var offsetDragged = false;\n        this.previewPointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.previewCanvas,\n            onPointer: function(e) {\n                // drag detect\n                if (e.type === \"pointerdown\") {\n                    dragged = false;\n                    isDown = true;\n                }\n                if (e.type === \"pointermove\" && isDown) dragged = true;\n                if (e.type === \"pointerup\") {\n                    if (isDown && dragged && e.pointerType === \"mouse\") // With touch/pen it would be annoying to focus again,\n                    // because it probably pops out the keyboard.\n                    p.onDragEnd();\n                    dragged = false;\n                    isDown = false;\n                }\n                if (e.type === \"pointermove\" && e.button === \"left\") {\n                    e.eventPreventDefault();\n                    _this.offset = {\n                        x: 0,\n                        y: 0\n                    };\n                    _this.move(-e.dX, -e.dY);\n                }\n                if (e.type === \"pointerdown\" && e.button === \"right\") document.body.append(_this.eventCapture);\n                if (e.type === \"pointerup\") setTimeout(function() {\n                    return _this.eventCapture.remove();\n                }, 20);\n                if (e.type === \"pointermove\" && e.button === \"right\") {\n                    offsetDragged = true;\n                    e.eventPreventDefault();\n                    _this.offset.x -= e.dX;\n                    _this.offset.y -= e.dY;\n                    _this.render();\n                }\n                if (e.type === \"pointerup\" && offsetDragged) {\n                    var count = 0;\n                    _this.interval = setInterval(function() {\n                        if (count > 8) {\n                            clearInterval(_this.interval);\n                            _this.offset = {\n                                x: 0,\n                                y: 0\n                            };\n                            _this.render();\n                        }\n                        _this.offset = {\n                            x: _this.offset.x * 0.6,\n                            y: _this.offset.y * 0.6\n                        };\n                        _this.render();\n                        count++;\n                    }, 10);\n                    _this.offset = {\n                        x: _this.offset.x * 0.6,\n                        y: _this.offset.y * 0.6\n                    };\n                    _this.render();\n                }\n            },\n            onWheel: function(e) {\n                _this.changeZoomFac(-e.deltaY);\n            }\n        });\n        var wheelPrevent = function(event) {\n            return event.preventDefault();\n        };\n        this.previewCanvas.addEventListener(\"wheel\", wheelPrevent);\n        this.rotationSlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"filter-transform-rotation\"),\n            width: 150,\n            height: 30,\n            min: -Math.PI,\n            max: Math.PI,\n            value: p.text.angleRad,\n            resolution: 225,\n            // eventResMs: 1000 / 30,\n            toValue: function(deg) {\n                return deg * Math.PI / 180;\n            },\n            toDisplayValue: function(rad) {\n                return rad / Math.PI * 180;\n            },\n            onChange: function() {\n                _this.offset = {\n                    x: 0,\n                    y: 0\n                };\n                _this.render();\n            },\n            unit: \"\\xb0\"\n        });\n        this.zoomInBtn = (0, $eWjiX.BB).el({\n            tagName: \"button\",\n            content: '<img height=\"20\" src=\"'.concat((0, (/*@__PURE__*/$parcel$interopDefault($fORLP))), '\">'),\n            title: (0, $1mH1z.LANG)(\"zoom-in\"),\n            onClick: function() {\n                return _this.changeZoomFac(1);\n            },\n            css: {\n                fontWeight: \"bold\"\n            }\n        });\n        this.zoomOutBtn = (0, $eWjiX.BB).el({\n            tagName: \"button\",\n            content: '<img height=\"20\" src=\"'.concat((0, (/*@__PURE__*/$parcel$interopDefault($kRxRZ))), '\">'),\n            title: (0, $1mH1z.LANG)(\"zoom-out\"),\n            onClick: function() {\n                return _this.changeZoomFac(-1);\n            },\n            css: {\n                fontWeight: \"bold\"\n            }\n        });\n        this.eventCapture = (0, $eWjiX.BB).el({\n            css: {\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\",\n                right: \"0\",\n                bottom: \"0\",\n                zIndex: \"999\",\n                cursor: \"move\"\n            }\n        });\n        this.eventCapture.oncontextmenu = function(e) {\n            return e.preventDefault();\n        };\n        this.keyListener = new (0, $eWjiX.BB).KeyListener({\n            onDown: function(keyStr) {\n                if ((0, $eWjiX.BB).isInputFocused(true)) return;\n                var factor = _this.keyListener.isPressed(\"shift\") ? 4 : 1;\n                if (keyStr === \"left\") _this.move(-factor, 0);\n                if (keyStr === \"right\") _this.move(factor, 0);\n                if (keyStr === \"up\") _this.move(0, -factor);\n                if (keyStr === \"down\") _this.move(0, factor);\n            }\n        });\n        this.inputsRootEl = (0, $amum4.c)(\",flex,gap-5\", [\n            this.rotationSlider.getElement(),\n            (0, $amum4.c)(),\n            this.zoomInBtn,\n            this.zoomOutBtn\n        ]);\n    }\n    (0, $7h4XF._)(TextToolViewportUI, [\n        {\n            key: \"canZoom\",\n            value: function canZoom(d) {\n                return this.zoomFac !== Math.min(2, Math.max(-2, this.zoomFac + d));\n            }\n        },\n        {\n            key: \"changeZoomFac\",\n            value: function changeZoomFac(d) {\n                this.zoomFac = Math.min(2, Math.max(-2, this.zoomFac + d));\n                this.render();\n                this.zoomInBtn.disabled = !this.canZoom(1);\n                this.zoomOutBtn.disabled = !this.canZoom(-1);\n            }\n        },\n        {\n            key: \"move\",\n            value: /** Move text by x y **/ function move(x, y) {\n                var rotated = (0, $eWjiX.BB).rotate(x, y, -this.rotationSlider.getValue() / Math.PI * 180);\n                this.text.x += rotated.x / this.scale;\n                this.text.y += rotated.y / this.scale;\n                this.render();\n            }\n        },\n        {\n            key: \"render\",\n            value: function render() {\n                // try to draw very much like klCanvasWorkspace\n                var angleRad = this.rotationSlider.getValue();\n                // --- draw text ---\n                this.textCtx.clearRect(0, 0, this.textCanvas.width, this.textCanvas.height);\n                var bounds = (0, $h20yl.renderText)(this.textCanvas, (0, $4EWN2._)((0, $cL71g._)({}, this.text), {\n                    x: this.text.x,\n                    y: this.text.y,\n                    angleRad: this.rotationSlider.getValue()\n                }));\n                // transform offset\n                var transformedOffset = (0, $eWjiX.BB).Vec2.mul((0, $eWjiX.BB).rotate(this.offset.x, this.offset.y, -angleRad / Math.PI * 180), 1 / this.scale);\n                // --- determine transformation of viewport ---\n                // text should always be visible\n                bounds.width = Math.max(bounds.width, 1);\n                bounds.height = Math.max(bounds.height, 1);\n                var rotatedXY = (0, $eWjiX.BB).rotate(bounds.x, bounds.y, -angleRad / Math.PI * 180);\n                var rotatedWH = (0, $eWjiX.BB).rotate(bounds.width, bounds.height, -angleRad / Math.PI * 180);\n                var centerX = this.text.x + rotatedXY.x + rotatedWH.x / 2 + transformedOffset.x;\n                var centerY = this.text.y + rotatedXY.y + rotatedWH.y / 2 + transformedOffset.y;\n                var padding = 100;\n                var fitBounds = (0, $eWjiX.BB).fitInto(bounds.width, bounds.height, this.width - padding, this.height - padding);\n                this.scale = Math.min(1, fitBounds.width / bounds.width);\n                this.scale = Math.min(4, this.scale * Math.pow(2, this.zoomFac));\n                // --- compose text and target layer ---\n                this.targetCtx.save();\n                if (this.scale >= 4) this.targetCtx.imageSmoothingEnabled = false;\n                else {\n                    this.targetCtx.imageSmoothingEnabled = true;\n                    this.targetCtx.imageSmoothingQuality = this.scale >= 1 ? \"low\" : \"medium\";\n                }\n                this.targetCtx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n                this.targetCtx.translate(this.width / 2, this.height / 2);\n                this.targetCtx.scale(this.scale, this.scale);\n                this.targetCtx.rotate(angleRad);\n                this.targetCtx.drawImage(this.layerArr[this.layerIndex].canvas, -centerX, -centerY);\n                this.targetCtx.drawImage(this.textCanvas, -centerX, -centerY);\n                this.targetCtx.restore();\n                var isDark = (0, $1C8RU.theme).isDark();\n                // --- layers ---\n                this.layersCtx.save();\n                this.layersCtx.fillStyle = isDark ? \"rgb(33,33,33)\" : \"rgb(158,158,158)\";\n                this.layersCtx.fillRect(0, 0, this.width, this.height);\n                {\n                    this.layersCtx.save();\n                    this.layersCtx.translate(this.width / 2, this.height / 2);\n                    this.layersCtx.scale(this.scale, this.scale);\n                    this.layersCtx.rotate(angleRad);\n                    this.layersCtx.imageSmoothingEnabled = false;\n                    //outline\n                    var borderSize = 1 / this.scale;\n                    this.layersCtx.globalAlpha = isDark ? 0.25 : 0.2;\n                    this.layersCtx.drawImage(isDark ? this.emptyCanvasLight : this.emptyCanvas, -centerX - borderSize, -centerY - borderSize, this.textCanvas.width + borderSize * 2, this.textCanvas.height + borderSize * 2);\n                    this.layersCtx.globalAlpha = 1;\n                    //erase\n                    this.layersCtx.globalCompositeOperation = \"destination-out\";\n                    this.layersCtx.drawImage(this.emptyCanvas, -centerX, -centerY, this.textCanvas.width, this.textCanvas.height);\n                    this.layersCtx.restore();\n                }\n                if (this.scale >= 4) this.layersCtx.imageSmoothingEnabled = false;\n                else {\n                    this.layersCtx.imageSmoothingEnabled = true;\n                    this.layersCtx.imageSmoothingQuality = this.scale >= 1 ? \"low\" : \"medium\";\n                }\n                // layers below\n                this.layersCtx.save();\n                this.layersCtx.translate(this.width / 2, this.height / 2);\n                this.layersCtx.scale(this.scale, this.scale);\n                this.layersCtx.rotate(angleRad);\n                for(var i = 0; i < this.layerIndex; i++)if (this.layerArr[i].isVisible && this.layerArr[i].opacity > 0) {\n                    this.layersCtx.globalAlpha = this.layerArr[i].opacity;\n                    this.layersCtx.globalCompositeOperation = this.layerArr[i].mixModeStr;\n                    this.layersCtx.drawImage(this.layerArr[i].canvas, -centerX, -centerY);\n                }\n                this.layersCtx.restore();\n                // target layer\n                this.layersCtx.globalAlpha = this.layerArr[this.layerIndex].opacity * (this.layerArr[this.layerIndex].isVisible ? 1 : 0);\n                this.layersCtx.globalCompositeOperation = this.layerArr[this.layerIndex].mixModeStr;\n                this.layersCtx.drawImage(this.targetCanvas, 0, 0);\n                // layers above\n                this.layersCtx.save();\n                this.layersCtx.translate(this.width / 2, this.height / 2);\n                this.layersCtx.scale(this.scale, this.scale);\n                this.layersCtx.rotate(angleRad);\n                for(var i1 = this.layerIndex + 1; i1 < this.layerArr.length; i1++)if (this.layerArr[i1].isVisible && this.layerArr[i1].opacity > 0) {\n                    this.layersCtx.globalAlpha = this.layerArr[i1].opacity;\n                    this.layersCtx.globalCompositeOperation = this.layerArr[i1].mixModeStr;\n                    this.layersCtx.drawImage(this.layerArr[i1].canvas, -centerX, -centerY);\n                }\n                this.layersCtx.restore();\n                this.layersCtx.restore();\n                // --- final composite ---\n                this.previewCtx.save();\n                this.previewCtx.fillStyle = this.checkerPattern;\n                this.previewCtx.fillRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n                this.previewCtx.drawImage(this.layersCanvas, 0, 0);\n                this.previewCtx.restore();\n                // bounds\n                this.previewCtx.save();\n                this.previewCtx.globalCompositeOperation = \"difference\";\n                this.previewCtx.strokeStyle = \"#fff\";\n                this.previewCtx.lineWidth = 0.5;\n                this.previewCtx.translate(-this.offset.x, -this.offset.y);\n                this.previewCtx.strokeRect(Math.round(this.width / 2 - bounds.width / 2 * this.scale) + 0.5, Math.round(this.height / 2 - bounds.height / 2 * this.scale) + 0.5, Math.round(bounds.width * this.scale), Math.round(bounds.height * this.scale));\n                this.previewCtx.restore();\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"getInputsElement\",\n            value: function getInputsElement() {\n                return this.inputsRootEl;\n            }\n        },\n        {\n            key: \"getValues\",\n            value: function getValues() {\n                return {\n                    x: this.text.x,\n                    y: this.text.y,\n                    angleRad: this.rotationSlider.getValue()\n                };\n            }\n        },\n        {\n            key: \"setText\",\n            value: function setText(text) {\n                var x = this.text.x;\n                var y = this.text.y;\n                var angleRad = this.text.angleRad;\n                this.text = (0, $4EWN2._)((0, $cL71g._)({}, text), {\n                    x: x,\n                    y: y,\n                    angleRad: angleRad\n                });\n                this.render();\n            }\n        },\n        {\n            key: \"setSize\",\n            value: function setSize(width, height) {\n                if (width === this.width && height === this.height) return;\n                this.width = width;\n                this.height = height;\n                this.targetCanvas.width = this.width;\n                this.targetCanvas.height = this.height;\n                this.layersCanvas.width = this.width;\n                this.layersCanvas.height = this.height;\n                this.previewCanvas.width = this.width;\n                this.previewCanvas.height = this.height;\n                this.previewWrapper.style.width = this.width + \"px\";\n                this.render();\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                (0, $eWjiX.BB).destroyEl(this.rootEl);\n                (0, $eWjiX.BB).destroyEl(this.inputsRootEl);\n                (0, $eWjiX.BB).destroyEl(this.previewWrapper);\n                clearInterval(this.interval);\n                this.rotationSlider.destroy();\n                (0, $eWjiX.BB).destroyEl(this.zoomInBtn);\n                (0, $eWjiX.BB).destroyEl(this.zoomOutBtn);\n                this.eventCapture.remove();\n                this.previewPointerListener.destroy();\n                this.keyListener.destroy();\n                (0, $1C8RU.theme).removeIsDarkListener(this.onDarkChange);\n            }\n        }\n    ]);\n    return TextToolViewportUI;\n}();\n\n});\n\nparcelRequire.register(\"6Tfl8\", function(module, exports) {\n\n$parcel$export(module.exports, \"viewportWrapper\", function () { return $5043c756765ef749$export$e114d13b1a258938; }, function (v) { return $5043c756765ef749$export$e114d13b1a258938 = v; });\nvar $5043c756765ef749$export$e114d13b1a258938;\n$5043c756765ef749$export$e114d13b1a258938 = \"_5vlQAW_viewportWrapper\";\n\n});\n\nparcelRequire.register(\"jXowp\", function(module, exports) {\n\n$parcel$export(module.exports, \"css\", function () { return $e8768c7f5a14aa4a$export$dbf350e5966cf602; });\n\nvar $iVt4v = parcelRequire(\"iVt4v\");\nparcelRequire(\"exBzs\");\nparcelRequire(\"csvAs\");\nparcelRequire(\"5zE8f\");\nvar $e8768c7f5a14aa4a$var$_createEmotion = (0, $iVt4v.default)({\n    key: \"css\"\n}), $e8768c7f5a14aa4a$export$4909b86c8034bf73 = $e8768c7f5a14aa4a$var$_createEmotion.flush, $e8768c7f5a14aa4a$export$fa8d919ba61d84db = $e8768c7f5a14aa4a$var$_createEmotion.hydrate, $e8768c7f5a14aa4a$export$a274e22fb40f762e = $e8768c7f5a14aa4a$var$_createEmotion.cx, $e8768c7f5a14aa4a$export$4950aa0f605343fb = $e8768c7f5a14aa4a$var$_createEmotion.merge, $e8768c7f5a14aa4a$export$95d99596f328fd52 = $e8768c7f5a14aa4a$var$_createEmotion.getRegisteredStyles, $e8768c7f5a14aa4a$export$efb9f5caaa2ca0c7 = $e8768c7f5a14aa4a$var$_createEmotion.injectGlobal, $e8768c7f5a14aa4a$export$d25ddfdf17c3ad3e = $e8768c7f5a14aa4a$var$_createEmotion.keyframes, $e8768c7f5a14aa4a$export$dbf350e5966cf602 = $e8768c7f5a14aa4a$var$_createEmotion.css, $e8768c7f5a14aa4a$export$995990c5c04c46f0 = $e8768c7f5a14aa4a$var$_createEmotion.sheet, $e8768c7f5a14aa4a$export$69a3209f1a06c04d = $e8768c7f5a14aa4a$var$_createEmotion.cache;\n\n});\nparcelRequire.register(\"iVt4v\", function(module, exports) {\n\n$parcel$export(module.exports, \"default\", function () { return $dc7419e907cef710$export$2e2bcd8739ae039; });\n\nvar $8KHnw = parcelRequire(\"8KHnw\");\n\nvar $exBzs = parcelRequire(\"exBzs\");\n\nvar $csvAs = parcelRequire(\"csvAs\");\n\nvar $5zE8f = parcelRequire(\"5zE8f\");\nfunction $dc7419e907cef710$var$insertWithoutScoping(cache, serialized) {\n    if (cache.inserted[serialized.name] === undefined) return cache.insert(\"\", serialized, cache.sheet, true);\n}\nfunction $dc7419e907cef710$var$merge(registered, css, className) {\n    var registeredStyles = [];\n    var rawClassName = (0, $5zE8f.getRegisteredStyles)(registered, registeredStyles, className);\n    if (registeredStyles.length < 2) return className;\n    return rawClassName + css(registeredStyles);\n}\nvar $dc7419e907cef710$export$2e2bcd8739ae039 = function createEmotion(options) {\n    var cache = (0, $exBzs.default)(options); // $FlowFixMe\n    cache.sheet.speedy = function(value) {\n        this.isSpeedy = value;\n    };\n    cache.compat = true;\n    var css = function css() {\n        for(var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++)args[_key] = arguments[_key];\n        var serialized = (0, $csvAs.serializeStyles)(args, cache.registered, undefined);\n        (0, $5zE8f.insertStyles)(cache, serialized, false);\n        return cache.key + \"-\" + serialized.name;\n    };\n    var keyframes = function keyframes() {\n        for(var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++)args[_key2] = arguments[_key2];\n        var serialized = (0, $csvAs.serializeStyles)(args, cache.registered);\n        var animation = \"animation-\" + serialized.name;\n        $dc7419e907cef710$var$insertWithoutScoping(cache, {\n            name: serialized.name,\n            styles: \"@keyframes \" + animation + \"{\" + serialized.styles + \"}\"\n        });\n        return animation;\n    };\n    var injectGlobal = function injectGlobal() {\n        for(var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++)args[_key3] = arguments[_key3];\n        var serialized = (0, $csvAs.serializeStyles)(args, cache.registered);\n        $dc7419e907cef710$var$insertWithoutScoping(cache, serialized);\n    };\n    var cx = function cx() {\n        for(var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++)args[_key4] = arguments[_key4];\n        return $dc7419e907cef710$var$merge(cache.registered, css, $dc7419e907cef710$var$classnames(args));\n    };\n    return {\n        css: css,\n        cx: cx,\n        injectGlobal: injectGlobal,\n        keyframes: keyframes,\n        hydrate: function hydrate(ids) {\n            ids.forEach(function(key) {\n                cache.inserted[key] = true;\n            });\n        },\n        flush: function flush() {\n            cache.registered = {};\n            cache.inserted = {};\n            cache.sheet.flush();\n        },\n        // $FlowFixMe\n        sheet: cache.sheet,\n        cache: cache,\n        getRegisteredStyles: (0, $5zE8f.getRegisteredStyles).bind(null, cache.registered),\n        merge: $dc7419e907cef710$var$merge.bind(null, cache.registered, css)\n    };\n};\nvar $dc7419e907cef710$var$classnames = function classnames(args) {\n    var cls = \"\";\n    for(var i = 0; i < args.length; i++){\n        var arg = args[i];\n        if (arg == null) continue;\n        var toAdd = void 0;\n        switch(typeof arg === \"undefined\" ? \"undefined\" : (0, $8KHnw._)(arg)){\n            case \"boolean\":\n                break;\n            case \"object\":\n                if (Array.isArray(arg)) toAdd = classnames(arg);\n                else {\n                    toAdd = \"\";\n                    for(var k in arg)if (arg[k] && k) {\n                        toAdd && (toAdd += \" \");\n                        toAdd += k;\n                    }\n                }\n                break;\n            default:\n                toAdd = arg;\n        }\n        if (toAdd) {\n            cls && (cls += \" \");\n            cls += toAdd;\n        }\n    }\n    return cls;\n};\n\n});\nparcelRequire.register(\"exBzs\", function(module, exports) {\n\n$parcel$export(module.exports, \"default\", function () { return $a9614a8e19e44976$export$2e2bcd8739ae039; });\n\nvar $hkMbk = parcelRequire(\"hkMbk\");\n\nvar $ikgWV = parcelRequire(\"ikgWV\");\nparcelRequire(\"gZ0tz\");\nparcelRequire(\"8ClKM\");\nvar $a9614a8e19e44976$var$identifierWithPointTracking = function identifierWithPointTracking(begin, points, index) {\n    var previous = 0;\n    var character = 0;\n    while(true){\n        previous = character;\n        character = (0, $ikgWV.peek)(); // &\\f\n        if (previous === 38 && character === 12) points[index] = 1;\n        if ((0, $ikgWV.token)(character)) break;\n        (0, $ikgWV.next)();\n    }\n    return (0, $ikgWV.slice)(begin, (0, $ikgWV.position));\n};\nvar $a9614a8e19e44976$var$toRules = function toRules(parsed, points) {\n    // pretend we've started with a comma\n    var index = -1;\n    var character = 44;\n    do switch((0, $ikgWV.token)(character)){\n        case 0:\n            // &\\f\n            if (character === 38 && (0, $ikgWV.peek)() === 12) // this is not 100% correct, we don't account for literal sequences here - like for example quoted strings\n            // stylis inserts \\f after & to know when & where it should replace this sequence with the context selector\n            // and when it should just concatenate the outer and inner selectors\n            // it's very unlikely for this sequence to actually appear in a different context, so we just leverage this fact here\n            points[index] = 1;\n            parsed[index] += $a9614a8e19e44976$var$identifierWithPointTracking((0, $ikgWV.position) - 1, points, index);\n            break;\n        case 2:\n            parsed[index] += (0, $ikgWV.delimit)(character);\n            break;\n        case 4:\n            // comma\n            if (character === 44) {\n                // colon\n                parsed[++index] = (0, $ikgWV.peek)() === 58 ? \"&\\f\" : \"\";\n                points[index] = parsed[index].length;\n                break;\n            }\n        // fallthrough\n        default:\n            parsed[index] += (0, $ikgWV.from)(character);\n    }\n    while (character = (0, $ikgWV.next)());\n    return parsed;\n};\nvar $a9614a8e19e44976$var$getRules = function getRules(value, points) {\n    return (0, $ikgWV.dealloc)($a9614a8e19e44976$var$toRules((0, $ikgWV.alloc)(value), points));\n}; // WeakSet would be more appropriate, but only WeakMap is supported in IE11\nvar $a9614a8e19e44976$var$fixedElements = /* #__PURE__ */ new WeakMap();\nvar $a9614a8e19e44976$var$compat = function compat(element) {\n    if (element.type !== \"rule\" || !element.parent || // positive .length indicates that this rule contains pseudo\n    // negative .length indicates that this rule has been already prefixed\n    element.length < 1) return;\n    var value = element.value, parent = element.parent;\n    var isImplicitRule = element.column === parent.column && element.line === parent.line;\n    while(parent.type !== \"rule\"){\n        parent = parent.parent;\n        if (!parent) return;\n    } // short-circuit for the simplest case\n    if (element.props.length === 1 && value.charCodeAt(0) !== 58 && !$a9614a8e19e44976$var$fixedElements.get(parent)) return;\n     // if this is an implicitly inserted rule (the one eagerly inserted at the each new nested level)\n    // then the props has already been manipulated beforehand as they that array is shared between it and its \"rule parent\"\n    if (isImplicitRule) return;\n    $a9614a8e19e44976$var$fixedElements.set(element, true);\n    var points = [];\n    var rules = $a9614a8e19e44976$var$getRules(value, points);\n    var parentRules = parent.props;\n    for(var i = 0, k = 0; i < rules.length; i++)for(var j = 0; j < parentRules.length; j++, k++)element.props[k] = points[i] ? rules[i].replace(/&\\f/g, parentRules[j]) : parentRules[j] + \" \" + rules[i];\n};\nvar $a9614a8e19e44976$var$removeLabel = function removeLabel(element) {\n    if (element.type === \"decl\") {\n        var value = element.value;\n        if (value.charCodeAt(0) === 108 && // charcode for b\n        value.charCodeAt(2) === 98) {\n            // this ignores label\n            element[\"return\"] = \"\";\n            element.value = \"\";\n        }\n    }\n};\nvar $a9614a8e19e44976$var$ignoreFlag = \"emotion-disable-server-rendering-unsafe-selector-warning-please-do-not-use-this-the-warning-exists-for-a-reason\";\nvar $a9614a8e19e44976$var$isIgnoringComment = function isIgnoringComment(element) {\n    return element.type === \"comm\" && element.children.indexOf($a9614a8e19e44976$var$ignoreFlag) > -1;\n};\nvar $a9614a8e19e44976$var$createUnsafeSelectorsAlarm = function createUnsafeSelectorsAlarm(cache) {\n    return function(element, index, children) {\n        if (element.type !== \"rule\" || cache.compat) return;\n        var unsafePseudoClasses = element.value.match(/(:first|:nth|:nth-last)-child/g);\n        if (unsafePseudoClasses) {\n            var isNested = !!element.parent; // in nested rules comments become children of the \"auto-inserted\" rule and that's always the `element.parent`\n            //\n            // considering this input:\n            // .a {\n            //   .b /* comm */ {}\n            //   color: hotpink;\n            // }\n            // we get output corresponding to this:\n            // .a {\n            //   & {\n            //     /* comm */\n            //     color: hotpink;\n            //   }\n            //   .b {}\n            // }\n            var commentContainer = isNested ? element.parent.children : children;\n            for(var i = commentContainer.length - 1; i >= 0; i--){\n                var node = commentContainer[i];\n                if (node.line < element.line) break;\n                 // it is quite weird but comments are *usually* put at `column: element.column - 1`\n                // so we seek *from the end* for the node that is earlier than the rule's `element` and check that\n                // this will also match inputs like this:\n                // .a {\n                //   /* comm */\n                //   .b {}\n                // }\n                //\n                // but that is fine\n                //\n                // it would be the easiest to change the placement of the comment to be the first child of the rule:\n                // .a {\n                //   .b { /* comm */ }\n                // }\n                // with such inputs we wouldn't have to search for the comment at all\n                // TODO: consider changing this comment placement in the next major version\n                if (node.column < element.column) {\n                    if ($a9614a8e19e44976$var$isIgnoringComment(node)) return;\n                    break;\n                }\n            }\n            unsafePseudoClasses.forEach(function(unsafePseudoClass) {\n                console.error('The pseudo class \"' + unsafePseudoClass + '\" is potentially unsafe when doing server-side rendering. Try changing it to \"' + unsafePseudoClass.split(\"-child\")[0] + '-of-type\".');\n            });\n        }\n    };\n};\nvar $a9614a8e19e44976$var$isImportRule = function isImportRule(element) {\n    return element.type.charCodeAt(1) === 105 && element.type.charCodeAt(0) === 64;\n};\nvar $a9614a8e19e44976$var$isPrependedWithRegularRules = function isPrependedWithRegularRules(index, children) {\n    for(var i = index - 1; i >= 0; i--){\n        if (!$a9614a8e19e44976$var$isImportRule(children[i])) return true;\n    }\n    return false;\n}; // use this to remove incorrect elements from further processing\n// so they don't get handed to the `sheet` (or anything else)\n// as that could potentially lead to additional logs which in turn could be overhelming to the user\nvar $a9614a8e19e44976$var$nullifyElement = function nullifyElement(element) {\n    element.type = \"\";\n    element.value = \"\";\n    element[\"return\"] = \"\";\n    element.children = \"\";\n    element.props = \"\";\n};\nvar $a9614a8e19e44976$var$incorrectImportAlarm = function incorrectImportAlarm(element, index, children) {\n    if (!$a9614a8e19e44976$var$isImportRule(element)) return;\n    if (element.parent) {\n        console.error(\"`@import` rules can't be nested inside other rules. Please move it to the top level and put it before regular rules. Keep in mind that they can only be used within global styles.\");\n        $a9614a8e19e44976$var$nullifyElement(element);\n    } else if ($a9614a8e19e44976$var$isPrependedWithRegularRules(index, children)) {\n        console.error(\"`@import` rules can't be after other rules. Please put your `@import` rules before your other rules.\");\n        $a9614a8e19e44976$var$nullifyElement(element);\n    }\n};\n/* eslint-disable no-fallthrough */ function $a9614a8e19e44976$var$prefix(value, length) {\n    switch((0, $ikgWV.hash)(value, length)){\n        // color-adjust\n        case 5103:\n            return (0, $ikgWV.WEBKIT) + \"print-\" + value + value;\n        // animation, animation-(delay|direction|duration|fill-mode|iteration-count|name|play-state|timing-function)\n        case 5737:\n        case 4201:\n        case 3177:\n        case 3433:\n        case 1641:\n        case 4457:\n        case 2921:\n        case 5572:\n        case 6356:\n        case 5844:\n        case 3191:\n        case 6645:\n        case 3005:\n        case 6391:\n        case 5879:\n        case 5623:\n        case 6135:\n        case 4599:\n        case 4855:\n        case 4215:\n        case 6389:\n        case 5109:\n        case 5365:\n        case 5621:\n        case 3829:\n            return (0, $ikgWV.WEBKIT) + value + value;\n        // appearance, user-select, transform, hyphens, text-size-adjust\n        case 5349:\n        case 4246:\n        case 4810:\n        case 6968:\n        case 2756:\n            return (0, $ikgWV.WEBKIT) + value + (0, $ikgWV.MOZ) + value + (0, $ikgWV.MS) + value + value;\n        // flex, flex-direction\n        case 6828:\n        case 4268:\n            return (0, $ikgWV.WEBKIT) + value + (0, $ikgWV.MS) + value + value;\n        // order\n        case 6165:\n            return (0, $ikgWV.WEBKIT) + value + (0, $ikgWV.MS) + \"flex-\" + value + value;\n        // align-items\n        case 5187:\n            return (0, $ikgWV.WEBKIT) + value + (0, $ikgWV.replace)(value, /(\\w+).+(:[^]+)/, (0, $ikgWV.WEBKIT) + \"box-$1$2\" + (0, $ikgWV.MS) + \"flex-$1$2\") + value;\n        // align-self\n        case 5443:\n            return (0, $ikgWV.WEBKIT) + value + (0, $ikgWV.MS) + \"flex-item-\" + (0, $ikgWV.replace)(value, /flex-|-self/, \"\") + value;\n        // align-content\n        case 4675:\n            return (0, $ikgWV.WEBKIT) + value + (0, $ikgWV.MS) + \"flex-line-pack\" + (0, $ikgWV.replace)(value, /align-content|flex-|-self/, \"\") + value;\n        // flex-shrink\n        case 5548:\n            return (0, $ikgWV.WEBKIT) + value + (0, $ikgWV.MS) + (0, $ikgWV.replace)(value, \"shrink\", \"negative\") + value;\n        // flex-basis\n        case 5292:\n            return (0, $ikgWV.WEBKIT) + value + (0, $ikgWV.MS) + (0, $ikgWV.replace)(value, \"basis\", \"preferred-size\") + value;\n        // flex-grow\n        case 6060:\n            return (0, $ikgWV.WEBKIT) + \"box-\" + (0, $ikgWV.replace)(value, \"-grow\", \"\") + (0, $ikgWV.WEBKIT) + value + (0, $ikgWV.MS) + (0, $ikgWV.replace)(value, \"grow\", \"positive\") + value;\n        // transition\n        case 4554:\n            return (0, $ikgWV.WEBKIT) + (0, $ikgWV.replace)(value, /([^-])(transform)/g, \"$1\" + (0, $ikgWV.WEBKIT) + \"$2\") + value;\n        // cursor\n        case 6187:\n            return (0, $ikgWV.replace)((0, $ikgWV.replace)((0, $ikgWV.replace)(value, /(zoom-|grab)/, (0, $ikgWV.WEBKIT) + \"$1\"), /(image-set)/, (0, $ikgWV.WEBKIT) + \"$1\"), value, \"\") + value;\n        // background, background-image\n        case 5495:\n        case 3959:\n            return (0, $ikgWV.replace)(value, /(image-set\\([^]*)/, (0, $ikgWV.WEBKIT) + \"$1\" + \"$`$1\");\n        // justify-content\n        case 4968:\n            return (0, $ikgWV.replace)((0, $ikgWV.replace)(value, /(.+:)(flex-)?(.*)/, (0, $ikgWV.WEBKIT) + \"box-pack:$3\" + (0, $ikgWV.MS) + \"flex-pack:$3\"), /s.+-b[^;]+/, \"justify\") + (0, $ikgWV.WEBKIT) + value + value;\n        // (margin|padding)-inline-(start|end)\n        case 4095:\n        case 3583:\n        case 4068:\n        case 2532:\n            return (0, $ikgWV.replace)(value, /(.+)-inline(.+)/, (0, $ikgWV.WEBKIT) + \"$1$2\") + value;\n        // (min|max)?(width|height|inline-size|block-size)\n        case 8116:\n        case 7059:\n        case 5753:\n        case 5535:\n        case 5445:\n        case 5701:\n        case 4933:\n        case 4677:\n        case 5533:\n        case 5789:\n        case 5021:\n        case 4765:\n            // stretch, max-content, min-content, fill-available\n            if ((0, $ikgWV.strlen)(value) - 1 - length > 6) switch((0, $ikgWV.charat)(value, length + 1)){\n                // (m)ax-content, (m)in-content\n                case 109:\n                    // -\n                    if ((0, $ikgWV.charat)(value, length + 4) !== 45) break;\n                // (f)ill-available, (f)it-content\n                case 102:\n                    return (0, $ikgWV.replace)(value, /(.+:)(.+)-([^]+)/, \"$1\" + (0, $ikgWV.WEBKIT) + \"$2-$3\" + \"$1\" + (0, $ikgWV.MOZ) + ((0, $ikgWV.charat)(value, length + 3) == 108 ? \"$3\" : \"$2-$3\")) + value;\n                // (s)tretch\n                case 115:\n                    return ~(0, $ikgWV.indexof)(value, \"stretch\") ? $a9614a8e19e44976$var$prefix((0, $ikgWV.replace)(value, \"stretch\", \"fill-available\"), length) + value : value;\n            }\n            break;\n        // position: sticky\n        case 4949:\n            // (s)ticky?\n            if ((0, $ikgWV.charat)(value, length + 1) !== 115) break;\n        // display: (flex|inline-flex)\n        case 6444:\n            switch((0, $ikgWV.charat)(value, (0, $ikgWV.strlen)(value) - 3 - (~(0, $ikgWV.indexof)(value, \"!important\") && 10))){\n                // stic(k)y\n                case 107:\n                    return (0, $ikgWV.replace)(value, \":\", \":\" + (0, $ikgWV.WEBKIT)) + value;\n                // (inline-)?fl(e)x\n                case 101:\n                    return (0, $ikgWV.replace)(value, /(.+:)([^;!]+)(;|!.+)?/, \"$1\" + (0, $ikgWV.WEBKIT) + ((0, $ikgWV.charat)(value, 14) === 45 ? \"inline-\" : \"\") + \"box$3\" + \"$1\" + (0, $ikgWV.WEBKIT) + \"$2$3\" + \"$1\" + (0, $ikgWV.MS) + \"$2box$3\") + value;\n            }\n            break;\n        // writing-mode\n        case 5936:\n            switch((0, $ikgWV.charat)(value, length + 11)){\n                // vertical-l(r)\n                case 114:\n                    return (0, $ikgWV.WEBKIT) + value + (0, $ikgWV.MS) + (0, $ikgWV.replace)(value, /[svh]\\w+-[tblr]{2}/, \"tb\") + value;\n                // vertical-r(l)\n                case 108:\n                    return (0, $ikgWV.WEBKIT) + value + (0, $ikgWV.MS) + (0, $ikgWV.replace)(value, /[svh]\\w+-[tblr]{2}/, \"tb-rl\") + value;\n                // horizontal(-)tb\n                case 45:\n                    return (0, $ikgWV.WEBKIT) + value + (0, $ikgWV.MS) + (0, $ikgWV.replace)(value, /[svh]\\w+-[tblr]{2}/, \"lr\") + value;\n            }\n            return (0, $ikgWV.WEBKIT) + value + (0, $ikgWV.MS) + value + value;\n    }\n    return value;\n}\nvar $a9614a8e19e44976$var$prefixer = function prefixer(element, index, children, callback) {\n    if (element.length > -1) {\n        if (!element[\"return\"]) switch(element.type){\n            case 0, $ikgWV.DECLARATION:\n                element[\"return\"] = $a9614a8e19e44976$var$prefix(element.value, element.length);\n                break;\n            case 0, $ikgWV.KEYFRAMES:\n                return (0, $ikgWV.serialize)([\n                    (0, $ikgWV.copy)(element, {\n                        value: (0, $ikgWV.replace)(element.value, \"@\", \"@\" + (0, $ikgWV.WEBKIT))\n                    })\n                ], callback);\n            case 0, $ikgWV.RULESET:\n                if (element.length) return (0, $ikgWV.combine)(element.props, function(value) {\n                    switch((0, $ikgWV.match)(value, /(::plac\\w+|:read-\\w+)/)){\n                        // :read-(only|write)\n                        case \":read-only\":\n                        case \":read-write\":\n                            return (0, $ikgWV.serialize)([\n                                (0, $ikgWV.copy)(element, {\n                                    props: [\n                                        (0, $ikgWV.replace)(value, /:(read-\\w+)/, \":\" + (0, $ikgWV.MOZ) + \"$1\")\n                                    ]\n                                })\n                            ], callback);\n                        // :placeholder\n                        case \"::placeholder\":\n                            return (0, $ikgWV.serialize)([\n                                (0, $ikgWV.copy)(element, {\n                                    props: [\n                                        (0, $ikgWV.replace)(value, /:(plac\\w+)/, \":\" + (0, $ikgWV.WEBKIT) + \"input-$1\")\n                                    ]\n                                }),\n                                (0, $ikgWV.copy)(element, {\n                                    props: [\n                                        (0, $ikgWV.replace)(value, /:(plac\\w+)/, \":\" + (0, $ikgWV.MOZ) + \"$1\")\n                                    ]\n                                }),\n                                (0, $ikgWV.copy)(element, {\n                                    props: [\n                                        (0, $ikgWV.replace)(value, /:(plac\\w+)/, (0, $ikgWV.MS) + \"input-$1\")\n                                    ]\n                                })\n                            ], callback);\n                    }\n                    return \"\";\n                });\n        }\n    }\n};\nvar $a9614a8e19e44976$var$defaultStylisPlugins = [\n    $a9614a8e19e44976$var$prefixer\n];\nvar $a9614a8e19e44976$export$2e2bcd8739ae039 = function createCache(options) {\n    var key = options.key;\n    if (key === \"css\") {\n        var ssrStyles = document.querySelectorAll(\"style[data-emotion]:not([data-s])\"); // get SSRed styles out of the way of React's hydration\n        // document.head is a safe place to move them to(though note document.head is not necessarily the last place they will be)\n        // note this very very intentionally targets all style elements regardless of the key to ensure\n        // that creating a cache works inside of render of a React component\n        Array.prototype.forEach.call(ssrStyles, function(node) {\n            // we want to only move elements which have a space in the data-emotion attribute value\n            // because that indicates that it is an Emotion 11 server-side rendered style elements\n            // while we will already ignore Emotion 11 client-side inserted styles because of the :not([data-s]) part in the selector\n            // Emotion 10 client-side inserted styles did not have data-s (but importantly did not have a space in their data-emotion attributes)\n            // so checking for the space ensures that loading Emotion 11 after Emotion 10 has inserted some styles\n            // will not result in the Emotion 10 styles being destroyed\n            var dataEmotionAttribute = node.getAttribute(\"data-emotion\");\n            if (dataEmotionAttribute.indexOf(\" \") === -1) return;\n            document.head.appendChild(node);\n            node.setAttribute(\"data-s\", \"\");\n        });\n    }\n    var stylisPlugins = options.stylisPlugins || $a9614a8e19e44976$var$defaultStylisPlugins;\n    var inserted = {};\n    var container;\n    var nodesToHydrate = [];\n    container = options.container || document.head;\n    Array.prototype.forEach.call(// means that the style elements we're looking at are only Emotion 11 server-rendered style elements\n    document.querySelectorAll('style[data-emotion^=\"' + key + ' \"]'), function(node) {\n        var attrib = node.getAttribute(\"data-emotion\").split(\" \"); // $FlowFixMe\n        for(var i = 1; i < attrib.length; i++)inserted[attrib[i]] = true;\n        nodesToHydrate.push(node);\n    });\n    var _insert;\n    var omnipresentPlugins = [\n        $a9614a8e19e44976$var$compat,\n        $a9614a8e19e44976$var$removeLabel\n    ];\n    var currentSheet;\n    var finalizingPlugins = [\n        (0, $ikgWV.stringify),\n        (0, $ikgWV.rulesheet)(function(rule) {\n            currentSheet.insert(rule);\n        })\n    ];\n    var serializer = (0, $ikgWV.middleware)(omnipresentPlugins.concat(stylisPlugins, finalizingPlugins));\n    var stylis = function stylis(styles) {\n        return (0, $ikgWV.serialize)((0, $ikgWV.compile)(styles), serializer);\n    };\n    _insert = function insert(selector, serialized, sheet, shouldCache) {\n        currentSheet = sheet;\n        stylis(selector ? selector + \"{\" + serialized.styles + \"}\" : serialized.styles);\n        if (shouldCache) cache.inserted[serialized.name] = true;\n    };\n    var cache = {\n        key: key,\n        sheet: new (0, $hkMbk.StyleSheet)({\n            key: key,\n            container: container,\n            nonce: options.nonce,\n            speedy: options.speedy,\n            prepend: options.prepend,\n            insertionPoint: options.insertionPoint\n        }),\n        nonce: options.nonce,\n        inserted: inserted,\n        registered: {},\n        insert: _insert\n    };\n    cache.sheet.hydrate(nodesToHydrate);\n    return cache;\n};\n\n});\nparcelRequire.register(\"hkMbk\", function(module, exports) {\n\n$parcel$export(module.exports, \"StyleSheet\", function () { return $c9e9add3d695fc85$export$9d753cd7ae895cce; });\n/*\n\nBased off glamor's StyleSheet, thanks Sunil \n\nhigh performance StyleSheet for css-in-js systems\n\n- uses multiple style tags behind the scenes for millions of rules\n- uses `insertRule` for appending in production for *much* faster performance\n\n// usage\n\nimport { StyleSheet } from '@emotion/sheet'\n\nlet styleSheet = new StyleSheet({ key: '', container: document.head })\n\nstyleSheet.insert('#box { border: 1px solid red; }')\n- appends a css rule into the stylesheet\n\nstyleSheet.flush()\n- empties the stylesheet of all its contents\n\n*/ // $FlowFixMe\nfunction $c9e9add3d695fc85$var$sheetForTag(tag) {\n    if (tag.sheet) // $FlowFixMe\n    return tag.sheet;\n     // this weirdness brought to you by firefox\n    /* istanbul ignore next */ for(var i = 0; i < document.styleSheets.length; i++){\n        if (document.styleSheets[i].ownerNode === tag) // $FlowFixMe\n        return document.styleSheets[i];\n    }\n}\nfunction $c9e9add3d695fc85$var$createStyleElement(options) {\n    var tag = document.createElement(\"style\");\n    tag.setAttribute(\"data-emotion\", options.key);\n    if (options.nonce !== undefined) tag.setAttribute(\"nonce\", options.nonce);\n    tag.appendChild(document.createTextNode(\"\"));\n    tag.setAttribute(\"data-s\", \"\");\n    return tag;\n}\nvar $c9e9add3d695fc85$export$9d753cd7ae895cce = /*#__PURE__*/ function() {\n    var StyleSheet = // Using Node instead of HTMLElement since container may be a ShadowRoot\n    function StyleSheet(options) {\n        var _this = this;\n        this._insertTag = function(tag) {\n            var before;\n            if (_this.tags.length === 0) {\n                if (_this.insertionPoint) before = _this.insertionPoint.nextSibling;\n                else if (_this.prepend) before = _this.container.firstChild;\n                else before = _this.before;\n            } else before = _this.tags[_this.tags.length - 1].nextSibling;\n            _this.container.insertBefore(tag, before);\n            _this.tags.push(tag);\n        };\n        this.isSpeedy = options.speedy === undefined ? true : options.speedy;\n        this.tags = [];\n        this.ctr = 0;\n        this.nonce = options.nonce; // key is the value of the data-emotion attribute, it's used to identify different sheets\n        this.key = options.key;\n        this.container = options.container;\n        this.prepend = options.prepend;\n        this.insertionPoint = options.insertionPoint;\n        this.before = null;\n    };\n    var _proto = StyleSheet.prototype;\n    _proto.hydrate = function hydrate(nodes) {\n        nodes.forEach(this._insertTag);\n    };\n    _proto.insert = function insert(rule) {\n        // the max length is how many rules we have per style tag, it's 65000 in speedy mode\n        // it's 1 in dev because we insert source maps that map a single rule to a location\n        // and you can only have one source map per style tag\n        if (this.ctr % (this.isSpeedy ? 65000 : 1) === 0) this._insertTag($c9e9add3d695fc85$var$createStyleElement(this));\n        var tag = this.tags[this.tags.length - 1];\n        var isImportRule;\n        if (this.isSpeedy) {\n            var sheet = $c9e9add3d695fc85$var$sheetForTag(tag);\n            try {\n                // this is the ultrafast version, works across browsers\n                // the big drawback is that the css won't be editable in devtools\n                sheet.insertRule(rule, sheet.cssRules.length);\n            } catch (e) {}\n        } else tag.appendChild(document.createTextNode(rule));\n        this.ctr++;\n    };\n    _proto.flush = function flush() {\n        // $FlowFixMe\n        this.tags.forEach(function(tag) {\n            return tag.parentNode && tag.parentNode.removeChild(tag);\n        });\n        this.tags = [];\n        this.ctr = 0;\n    };\n    return StyleSheet;\n}();\n\n});\n\nparcelRequire.register(\"ikgWV\", function(module, exports) {\n\n$parcel$export(module.exports, \"MS\", function () { return $ad3686905e666bc0$export$71ad59f2e432cfe8; });\n$parcel$export(module.exports, \"MOZ\", function () { return $ad3686905e666bc0$export$2c0f367103c8d01c; });\n$parcel$export(module.exports, \"WEBKIT\", function () { return $ad3686905e666bc0$export$39dfd62a25e0fe93; });\n$parcel$export(module.exports, \"RULESET\", function () { return $ad3686905e666bc0$export$aa3a2e812ca8570d; });\n$parcel$export(module.exports, \"DECLARATION\", function () { return $ad3686905e666bc0$export$527d108ccf083c2b; });\n$parcel$export(module.exports, \"KEYFRAMES\", function () { return $ad3686905e666bc0$export$b44a8529a35fcb60; });\n$parcel$export(module.exports, \"from\", function () { return $ad3686905e666bc0$export$6788812c4e6611e6; });\n$parcel$export(module.exports, \"hash\", function () { return $ad3686905e666bc0$export$d6af199866bfb566; });\n$parcel$export(module.exports, \"charat\", function () { return $ad3686905e666bc0$export$a9db5e087081082d; });\n$parcel$export(module.exports, \"match\", function () { return $ad3686905e666bc0$export$4659b591c19bdf3d; });\n$parcel$export(module.exports, \"replace\", function () { return $ad3686905e666bc0$export$77ad94ebf1c2b9ed; });\n$parcel$export(module.exports, \"indexof\", function () { return $ad3686905e666bc0$export$f8e21b1e77979a08; });\n$parcel$export(module.exports, \"strlen\", function () { return $ad3686905e666bc0$export$36776f635604f274; });\n$parcel$export(module.exports, \"combine\", function () { return $ad3686905e666bc0$export$1be1fc439b849fdf; });\n$parcel$export(module.exports, \"position\", function () { return $ad3686905e666bc0$export$5880b8b5730aff45; });\n$parcel$export(module.exports, \"copy\", function () { return $ad3686905e666bc0$export$784d13d8ee351f07; });\n$parcel$export(module.exports, \"next\", function () { return $ad3686905e666bc0$export$48cfd1e771a65c4f; });\n$parcel$export(module.exports, \"peek\", function () { return $ad3686905e666bc0$export$4d3fb11e950abb9e; });\n$parcel$export(module.exports, \"slice\", function () { return $ad3686905e666bc0$export$58adb3bec8346d0f; });\n$parcel$export(module.exports, \"token\", function () { return $ad3686905e666bc0$export$9e1725a4cfeada27; });\n$parcel$export(module.exports, \"alloc\", function () { return $ad3686905e666bc0$export$2de70f21292aac9e; });\n$parcel$export(module.exports, \"dealloc\", function () { return $ad3686905e666bc0$export$45918ac1574455b1; });\n$parcel$export(module.exports, \"delimit\", function () { return $ad3686905e666bc0$export$410ac95b9ec204b8; });\n$parcel$export(module.exports, \"compile\", function () { return $ad3686905e666bc0$export$ef7acd7185315e22; });\n$parcel$export(module.exports, \"serialize\", function () { return $ad3686905e666bc0$export$dfdc1655ccc5b9cb; });\n$parcel$export(module.exports, \"stringify\", function () { return $ad3686905e666bc0$export$fac44ee5b035f737; });\n$parcel$export(module.exports, \"middleware\", function () { return $ad3686905e666bc0$export$5a7767152ae0305f; });\n$parcel$export(module.exports, \"rulesheet\", function () { return $ad3686905e666bc0$export$38bcb760f1d4871c; });\nvar $ad3686905e666bc0$export$71ad59f2e432cfe8 = \"-ms-\";\nvar $ad3686905e666bc0$export$2c0f367103c8d01c = \"-moz-\";\nvar $ad3686905e666bc0$export$39dfd62a25e0fe93 = \"-webkit-\";\nvar $ad3686905e666bc0$export$a29989082612d0d9 = \"comm\";\nvar $ad3686905e666bc0$export$aa3a2e812ca8570d = \"rule\";\nvar $ad3686905e666bc0$export$527d108ccf083c2b = \"decl\";\nvar $ad3686905e666bc0$export$d3d35020fa5b54f0 = \"@page\";\nvar $ad3686905e666bc0$export$500415a86c544f73 = \"@media\";\nvar $ad3686905e666bc0$export$a763edbf796b780a = \"@import\";\nvar $ad3686905e666bc0$export$2790aeb8b4e5c826 = \"@charset\";\nvar $ad3686905e666bc0$export$1cc683e23b84b133 = \"@viewport\";\nvar $ad3686905e666bc0$export$9447a5efea57e862 = \"@supports\";\nvar $ad3686905e666bc0$export$ef011b4e114b1fba = \"@document\";\nvar $ad3686905e666bc0$export$6aad947bda0f3f46 = \"@namespace\";\nvar $ad3686905e666bc0$export$b44a8529a35fcb60 = \"@keyframes\";\nvar $ad3686905e666bc0$export$2c16de31893252e6 = \"@font-face\";\nvar $ad3686905e666bc0$export$3d846dd52e150c6f = \"@counter-style\";\nvar $ad3686905e666bc0$export$22314bfbb57653fe = \"@font-feature-values\";\nvar $ad3686905e666bc0$export$d773506282b3cfe6 = \"@layer\";\nvar $ad3686905e666bc0$export$2335f513bbd82c6d = Math.abs;\nvar $ad3686905e666bc0$export$6788812c4e6611e6 = String.fromCharCode;\nvar $ad3686905e666bc0$export$e6e34fd1f2686227 = Object.assign;\nfunction $ad3686905e666bc0$export$d6af199866bfb566(e, r) {\n    return $ad3686905e666bc0$export$a9db5e087081082d(e, 0) ^ 45 ? (((r << 2 ^ $ad3686905e666bc0$export$a9db5e087081082d(e, 0)) << 2 ^ $ad3686905e666bc0$export$a9db5e087081082d(e, 1)) << 2 ^ $ad3686905e666bc0$export$a9db5e087081082d(e, 2)) << 2 ^ $ad3686905e666bc0$export$a9db5e087081082d(e, 3) : 0;\n}\nfunction $ad3686905e666bc0$export$87c2784dc9fc4ab(e) {\n    return e.trim();\n}\nfunction $ad3686905e666bc0$export$4659b591c19bdf3d(e, r) {\n    return (e = r.exec(e)) ? e[0] : e;\n}\nfunction $ad3686905e666bc0$export$77ad94ebf1c2b9ed(e, r, a) {\n    return e.replace(r, a);\n}\nfunction $ad3686905e666bc0$export$f8e21b1e77979a08(e, r) {\n    return e.indexOf(r);\n}\nfunction $ad3686905e666bc0$export$a9db5e087081082d(e, r) {\n    return e.charCodeAt(r) | 0;\n}\nfunction $ad3686905e666bc0$export$2f35ab04d2335697(e, r, a) {\n    return e.slice(r, a);\n}\nfunction $ad3686905e666bc0$export$36776f635604f274(e) {\n    return e.length;\n}\nfunction $ad3686905e666bc0$export$f9084667e487ed46(e) {\n    return e.length;\n}\nfunction $ad3686905e666bc0$export$10d8903dec122b9d(e, r) {\n    return r.push(e), e;\n}\nfunction $ad3686905e666bc0$export$1be1fc439b849fdf(e, r) {\n    return e.map(r).join(\"\");\n}\nvar $ad3686905e666bc0$export$53f1d5ea8de3d7c = 1;\nvar $ad3686905e666bc0$export$4e0c71f277ca26b3 = 1;\nvar $ad3686905e666bc0$export$f24224f1c91d8156 = 0;\nvar $ad3686905e666bc0$export$5880b8b5730aff45 = 0;\nvar $ad3686905e666bc0$export$c0306caf338ac095 = 0;\nvar $ad3686905e666bc0$export$30a86d91af8ff6e6 = \"\";\nfunction $ad3686905e666bc0$export$35059013cd4a06db(e, r, a, n, c, s, t) {\n    return {\n        value: e,\n        root: r,\n        parent: a,\n        type: n,\n        props: c,\n        children: s,\n        line: $ad3686905e666bc0$export$53f1d5ea8de3d7c,\n        column: $ad3686905e666bc0$export$4e0c71f277ca26b3,\n        length: t,\n        return: \"\"\n    };\n}\nfunction $ad3686905e666bc0$export$784d13d8ee351f07(e, r) {\n    return $ad3686905e666bc0$export$e6e34fd1f2686227($ad3686905e666bc0$export$35059013cd4a06db(\"\", null, null, \"\", null, null, 0), e, {\n        length: -e.length\n    }, r);\n}\nfunction $ad3686905e666bc0$export$eba6f6f03b0a92e7() {\n    return $ad3686905e666bc0$export$c0306caf338ac095;\n}\nfunction $ad3686905e666bc0$export$232faf9add678146() {\n    $ad3686905e666bc0$export$c0306caf338ac095 = $ad3686905e666bc0$export$5880b8b5730aff45 > 0 ? $ad3686905e666bc0$export$a9db5e087081082d($ad3686905e666bc0$export$30a86d91af8ff6e6, --$ad3686905e666bc0$export$5880b8b5730aff45) : 0;\n    if ($ad3686905e666bc0$export$4e0c71f277ca26b3--, $ad3686905e666bc0$export$c0306caf338ac095 === 10) $ad3686905e666bc0$export$4e0c71f277ca26b3 = 1, $ad3686905e666bc0$export$53f1d5ea8de3d7c--;\n    return $ad3686905e666bc0$export$c0306caf338ac095;\n}\nfunction $ad3686905e666bc0$export$48cfd1e771a65c4f() {\n    $ad3686905e666bc0$export$c0306caf338ac095 = $ad3686905e666bc0$export$5880b8b5730aff45 < $ad3686905e666bc0$export$f24224f1c91d8156 ? $ad3686905e666bc0$export$a9db5e087081082d($ad3686905e666bc0$export$30a86d91af8ff6e6, $ad3686905e666bc0$export$5880b8b5730aff45++) : 0;\n    if ($ad3686905e666bc0$export$4e0c71f277ca26b3++, $ad3686905e666bc0$export$c0306caf338ac095 === 10) $ad3686905e666bc0$export$4e0c71f277ca26b3 = 1, $ad3686905e666bc0$export$53f1d5ea8de3d7c++;\n    return $ad3686905e666bc0$export$c0306caf338ac095;\n}\nfunction $ad3686905e666bc0$export$4d3fb11e950abb9e() {\n    return $ad3686905e666bc0$export$a9db5e087081082d($ad3686905e666bc0$export$30a86d91af8ff6e6, $ad3686905e666bc0$export$5880b8b5730aff45);\n}\nfunction $ad3686905e666bc0$export$e88cb2efb12ae807() {\n    return $ad3686905e666bc0$export$5880b8b5730aff45;\n}\nfunction $ad3686905e666bc0$export$58adb3bec8346d0f(e, r) {\n    return $ad3686905e666bc0$export$2f35ab04d2335697($ad3686905e666bc0$export$30a86d91af8ff6e6, e, r);\n}\nfunction $ad3686905e666bc0$export$9e1725a4cfeada27(e) {\n    switch(e){\n        case 0:\n        case 9:\n        case 10:\n        case 13:\n        case 32:\n            return 5;\n        case 33:\n        case 43:\n        case 44:\n        case 47:\n        case 62:\n        case 64:\n        case 126:\n        case 59:\n        case 123:\n        case 125:\n            return 4;\n        case 58:\n            return 3;\n        case 34:\n        case 39:\n        case 40:\n        case 91:\n            return 2;\n        case 41:\n        case 93:\n            return 1;\n    }\n    return 0;\n}\nfunction $ad3686905e666bc0$export$2de70f21292aac9e(e) {\n    return $ad3686905e666bc0$export$53f1d5ea8de3d7c = $ad3686905e666bc0$export$4e0c71f277ca26b3 = 1, $ad3686905e666bc0$export$f24224f1c91d8156 = $ad3686905e666bc0$export$36776f635604f274($ad3686905e666bc0$export$30a86d91af8ff6e6 = e), $ad3686905e666bc0$export$5880b8b5730aff45 = 0, [];\n}\nfunction $ad3686905e666bc0$export$45918ac1574455b1(e) {\n    return $ad3686905e666bc0$export$30a86d91af8ff6e6 = \"\", e;\n}\nfunction $ad3686905e666bc0$export$410ac95b9ec204b8(e) {\n    return $ad3686905e666bc0$export$87c2784dc9fc4ab($ad3686905e666bc0$export$58adb3bec8346d0f($ad3686905e666bc0$export$5880b8b5730aff45 - 1, $ad3686905e666bc0$export$c889f2fcc19dbf12(e === 91 ? e + 2 : e === 40 ? e + 1 : e)));\n}\nfunction $ad3686905e666bc0$export$660b2ee2d4fb4eff(e) {\n    return $ad3686905e666bc0$export$45918ac1574455b1($ad3686905e666bc0$export$5f8c09e3ae6f64e1($ad3686905e666bc0$export$2de70f21292aac9e(e)));\n}\nfunction $ad3686905e666bc0$export$7af1228ff777d175(e) {\n    while($ad3686905e666bc0$export$c0306caf338ac095 = $ad3686905e666bc0$export$4d3fb11e950abb9e())if ($ad3686905e666bc0$export$c0306caf338ac095 < 33) $ad3686905e666bc0$export$48cfd1e771a65c4f();\n    else break;\n    return $ad3686905e666bc0$export$9e1725a4cfeada27(e) > 2 || $ad3686905e666bc0$export$9e1725a4cfeada27($ad3686905e666bc0$export$c0306caf338ac095) > 3 ? \"\" : \" \";\n}\nfunction $ad3686905e666bc0$export$5f8c09e3ae6f64e1(e) {\n    while($ad3686905e666bc0$export$48cfd1e771a65c4f())switch($ad3686905e666bc0$export$9e1725a4cfeada27($ad3686905e666bc0$export$c0306caf338ac095)){\n        case 0:\n            $ad3686905e666bc0$export$10d8903dec122b9d($ad3686905e666bc0$export$c2ab62c7bf24634($ad3686905e666bc0$export$5880b8b5730aff45 - 1), e);\n            break;\n        case 2:\n            $ad3686905e666bc0$export$10d8903dec122b9d($ad3686905e666bc0$export$410ac95b9ec204b8($ad3686905e666bc0$export$c0306caf338ac095), e);\n            break;\n        default:\n            $ad3686905e666bc0$export$10d8903dec122b9d($ad3686905e666bc0$export$6788812c4e6611e6($ad3686905e666bc0$export$c0306caf338ac095), e);\n    }\n    return e;\n}\nfunction $ad3686905e666bc0$export$955ba06d119e085e(e, r) {\n    while(--r && $ad3686905e666bc0$export$48cfd1e771a65c4f())if ($ad3686905e666bc0$export$c0306caf338ac095 < 48 || $ad3686905e666bc0$export$c0306caf338ac095 > 102 || $ad3686905e666bc0$export$c0306caf338ac095 > 57 && $ad3686905e666bc0$export$c0306caf338ac095 < 65 || $ad3686905e666bc0$export$c0306caf338ac095 > 70 && $ad3686905e666bc0$export$c0306caf338ac095 < 97) break;\n    return $ad3686905e666bc0$export$58adb3bec8346d0f(e, $ad3686905e666bc0$export$e88cb2efb12ae807() + (r < 6 && $ad3686905e666bc0$export$4d3fb11e950abb9e() == 32 && $ad3686905e666bc0$export$48cfd1e771a65c4f() == 32));\n}\nfunction $ad3686905e666bc0$export$c889f2fcc19dbf12(e) {\n    while($ad3686905e666bc0$export$48cfd1e771a65c4f())switch($ad3686905e666bc0$export$c0306caf338ac095){\n        case e:\n            return $ad3686905e666bc0$export$5880b8b5730aff45;\n        case 34:\n        case 39:\n            if (e !== 34 && e !== 39) $ad3686905e666bc0$export$c889f2fcc19dbf12($ad3686905e666bc0$export$c0306caf338ac095);\n            break;\n        case 40:\n            if (e === 41) $ad3686905e666bc0$export$c889f2fcc19dbf12(e);\n            break;\n        case 92:\n            $ad3686905e666bc0$export$48cfd1e771a65c4f();\n            break;\n    }\n    return $ad3686905e666bc0$export$5880b8b5730aff45;\n}\nfunction $ad3686905e666bc0$export$4254d4e2b3745c4c(e, r) {\n    while($ad3686905e666bc0$export$48cfd1e771a65c4f())if (e + $ad3686905e666bc0$export$c0306caf338ac095 === 57) break;\n    else if (e + $ad3686905e666bc0$export$c0306caf338ac095 === 84 && $ad3686905e666bc0$export$4d3fb11e950abb9e() === 47) break;\n    return \"/*\" + $ad3686905e666bc0$export$58adb3bec8346d0f(r, $ad3686905e666bc0$export$5880b8b5730aff45 - 1) + \"*\" + $ad3686905e666bc0$export$6788812c4e6611e6(e === 47 ? e : $ad3686905e666bc0$export$48cfd1e771a65c4f());\n}\nfunction $ad3686905e666bc0$export$c2ab62c7bf24634(e) {\n    while(!$ad3686905e666bc0$export$9e1725a4cfeada27($ad3686905e666bc0$export$4d3fb11e950abb9e()))$ad3686905e666bc0$export$48cfd1e771a65c4f();\n    return $ad3686905e666bc0$export$58adb3bec8346d0f(e, $ad3686905e666bc0$export$5880b8b5730aff45);\n}\nfunction $ad3686905e666bc0$export$ef7acd7185315e22(e) {\n    return $ad3686905e666bc0$export$45918ac1574455b1($ad3686905e666bc0$export$98e6a39c04603d36(\"\", null, null, null, [\n        \"\"\n    ], e = $ad3686905e666bc0$export$2de70f21292aac9e(e), 0, [\n        0\n    ], e));\n}\nfunction $ad3686905e666bc0$export$98e6a39c04603d36(e, r, a, n, c, s, t, u, i) {\n    var f = 0;\n    var o = 0;\n    var l = t;\n    var v = 0;\n    var p = 0;\n    var h = 0;\n    var b = 1;\n    var w = 1;\n    var d = 1;\n    var $ = 0;\n    var g = \"\";\n    var m = c;\n    var x = s;\n    var y = n;\n    var j = g;\n    while(w)switch(h = $, $ = $ad3686905e666bc0$export$48cfd1e771a65c4f()){\n        case 40:\n            if (h != 108 && $ad3686905e666bc0$export$a9db5e087081082d(j, l - 1) == 58) {\n                if ($ad3686905e666bc0$export$f8e21b1e77979a08(j += $ad3686905e666bc0$export$77ad94ebf1c2b9ed($ad3686905e666bc0$export$410ac95b9ec204b8($), \"&\", \"&\\f\"), \"&\\f\") != -1) d = -1;\n                break;\n            }\n        case 34:\n        case 39:\n        case 91:\n            j += $ad3686905e666bc0$export$410ac95b9ec204b8($);\n            break;\n        case 9:\n        case 10:\n        case 13:\n        case 32:\n            j += $ad3686905e666bc0$export$7af1228ff777d175(h);\n            break;\n        case 92:\n            j += $ad3686905e666bc0$export$955ba06d119e085e($ad3686905e666bc0$export$e88cb2efb12ae807() - 1, 7);\n            continue;\n        case 47:\n            switch($ad3686905e666bc0$export$4d3fb11e950abb9e()){\n                case 42:\n                case 47:\n                    $ad3686905e666bc0$export$10d8903dec122b9d($ad3686905e666bc0$export$4a34f930e789283c($ad3686905e666bc0$export$4254d4e2b3745c4c($ad3686905e666bc0$export$48cfd1e771a65c4f(), $ad3686905e666bc0$export$e88cb2efb12ae807()), r, a), i);\n                    break;\n                default:\n                    j += \"/\";\n            }\n            break;\n        case 123 * b:\n            u[f++] = $ad3686905e666bc0$export$36776f635604f274(j) * d;\n        case 125 * b:\n        case 59:\n        case 0:\n            switch($){\n                case 0:\n                case 125:\n                    w = 0;\n                case 59 + o:\n                    if (d == -1) j = $ad3686905e666bc0$export$77ad94ebf1c2b9ed(j, /\\f/g, \"\");\n                    if (p > 0 && $ad3686905e666bc0$export$36776f635604f274(j) - l) $ad3686905e666bc0$export$10d8903dec122b9d(p > 32 ? $ad3686905e666bc0$export$f8483753829ec8f3(j + \";\", n, a, l - 1) : $ad3686905e666bc0$export$f8483753829ec8f3($ad3686905e666bc0$export$77ad94ebf1c2b9ed(j, \" \", \"\") + \";\", n, a, l - 2), i);\n                    break;\n                case 59:\n                    j += \";\";\n                default:\n                    $ad3686905e666bc0$export$10d8903dec122b9d(y = $ad3686905e666bc0$export$3307ffa7023ede1e(j, r, a, f, o, c, u, g, m = [], x = [], l), s);\n                    if ($ === 123) {\n                        if (o === 0) $ad3686905e666bc0$export$98e6a39c04603d36(j, r, y, y, m, s, l, u, x);\n                        else switch(v === 99 && $ad3686905e666bc0$export$a9db5e087081082d(j, 3) === 110 ? 100 : v){\n                            case 100:\n                            case 108:\n                            case 109:\n                            case 115:\n                                $ad3686905e666bc0$export$98e6a39c04603d36(e, y, y, n && $ad3686905e666bc0$export$10d8903dec122b9d($ad3686905e666bc0$export$3307ffa7023ede1e(e, y, y, 0, 0, c, u, g, c, m = [], l), x), c, x, l, u, n ? m : x);\n                                break;\n                            default:\n                                $ad3686905e666bc0$export$98e6a39c04603d36(j, y, y, y, [\n                                    \"\"\n                                ], x, 0, u, x);\n                        }\n                    }\n            }\n            f = o = p = 0, b = d = 1, g = j = \"\", l = t;\n            break;\n        case 58:\n            l = 1 + $ad3686905e666bc0$export$36776f635604f274(j), p = h;\n        default:\n            if (b < 1) {\n                if ($ == 123) --b;\n                else if ($ == 125 && b++ == 0 && $ad3686905e666bc0$export$232faf9add678146() == 125) continue;\n            }\n            switch(j += $ad3686905e666bc0$export$6788812c4e6611e6($), $ * b){\n                case 38:\n                    d = o > 0 ? 1 : (j += \"\\f\", -1);\n                    break;\n                case 44:\n                    u[f++] = ($ad3686905e666bc0$export$36776f635604f274(j) - 1) * d, d = 1;\n                    break;\n                case 64:\n                    if ($ad3686905e666bc0$export$4d3fb11e950abb9e() === 45) j += $ad3686905e666bc0$export$410ac95b9ec204b8($ad3686905e666bc0$export$48cfd1e771a65c4f());\n                    v = $ad3686905e666bc0$export$4d3fb11e950abb9e(), o = l = $ad3686905e666bc0$export$36776f635604f274(g = j += $ad3686905e666bc0$export$c2ab62c7bf24634($ad3686905e666bc0$export$e88cb2efb12ae807())), $++;\n                    break;\n                case 45:\n                    if (h === 45 && $ad3686905e666bc0$export$36776f635604f274(j) == 2) b = 0;\n            }\n    }\n    return s;\n}\nfunction $ad3686905e666bc0$export$3307ffa7023ede1e(e, r, a, n, s, t, u, i, f, o, l) {\n    var v = s - 1;\n    var p = s === 0 ? t : [\n        \"\"\n    ];\n    var h = $ad3686905e666bc0$export$f9084667e487ed46(p);\n    for(var b = 0, w = 0, d = 0; b < n; ++b)for(var $ = 0, k = $ad3686905e666bc0$export$2f35ab04d2335697(e, v + 1, v = $ad3686905e666bc0$export$2335f513bbd82c6d(w = u[b])), m = e; $ < h; ++$)if (m = $ad3686905e666bc0$export$87c2784dc9fc4ab(w > 0 ? p[$] + \" \" + k : $ad3686905e666bc0$export$77ad94ebf1c2b9ed(k, /&\\f/g, p[$]))) f[d++] = m;\n    return $ad3686905e666bc0$export$35059013cd4a06db(e, r, a, s === 0 ? $ad3686905e666bc0$export$aa3a2e812ca8570d : i, f, o, l);\n}\nfunction $ad3686905e666bc0$export$4a34f930e789283c(e, r, a) {\n    return $ad3686905e666bc0$export$35059013cd4a06db(e, r, a, $ad3686905e666bc0$export$a29989082612d0d9, $ad3686905e666bc0$export$6788812c4e6611e6($ad3686905e666bc0$export$eba6f6f03b0a92e7()), $ad3686905e666bc0$export$2f35ab04d2335697(e, 2, -2), 0);\n}\nfunction $ad3686905e666bc0$export$f8483753829ec8f3(e, r, a, n) {\n    return $ad3686905e666bc0$export$35059013cd4a06db(e, r, a, $ad3686905e666bc0$export$527d108ccf083c2b, $ad3686905e666bc0$export$2f35ab04d2335697(e, 0, n), $ad3686905e666bc0$export$2f35ab04d2335697(e, n + 1, -1), n);\n}\nfunction $ad3686905e666bc0$export$82e9f45cca5ba907(n, c, s) {\n    switch($ad3686905e666bc0$export$d6af199866bfb566(n, c)){\n        case 5103:\n            return $ad3686905e666bc0$export$39dfd62a25e0fe93 + \"print-\" + n + n;\n        case 5737:\n        case 4201:\n        case 3177:\n        case 3433:\n        case 1641:\n        case 4457:\n        case 2921:\n        case 5572:\n        case 6356:\n        case 5844:\n        case 3191:\n        case 6645:\n        case 3005:\n        case 6391:\n        case 5879:\n        case 5623:\n        case 6135:\n        case 4599:\n        case 4855:\n        case 4215:\n        case 6389:\n        case 5109:\n        case 5365:\n        case 5621:\n        case 3829:\n            return $ad3686905e666bc0$export$39dfd62a25e0fe93 + n + n;\n        case 4789:\n            return $ad3686905e666bc0$export$2c0f367103c8d01c + n + n;\n        case 5349:\n        case 4246:\n        case 4810:\n        case 6968:\n        case 2756:\n            return $ad3686905e666bc0$export$39dfd62a25e0fe93 + n + $ad3686905e666bc0$export$2c0f367103c8d01c + n + $ad3686905e666bc0$export$71ad59f2e432cfe8 + n + n;\n        case 5936:\n            switch($ad3686905e666bc0$export$a9db5e087081082d(n, c + 11)){\n                case 114:\n                    return $ad3686905e666bc0$export$39dfd62a25e0fe93 + n + $ad3686905e666bc0$export$71ad59f2e432cfe8 + $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, /[svh]\\w+-[tblr]{2}/, \"tb\") + n;\n                case 108:\n                    return $ad3686905e666bc0$export$39dfd62a25e0fe93 + n + $ad3686905e666bc0$export$71ad59f2e432cfe8 + $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, /[svh]\\w+-[tblr]{2}/, \"tb-rl\") + n;\n                case 45:\n                    return $ad3686905e666bc0$export$39dfd62a25e0fe93 + n + $ad3686905e666bc0$export$71ad59f2e432cfe8 + $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, /[svh]\\w+-[tblr]{2}/, \"lr\") + n;\n            }\n        case 6828:\n        case 4268:\n        case 2903:\n            return $ad3686905e666bc0$export$39dfd62a25e0fe93 + n + $ad3686905e666bc0$export$71ad59f2e432cfe8 + n + n;\n        case 6165:\n            return $ad3686905e666bc0$export$39dfd62a25e0fe93 + n + $ad3686905e666bc0$export$71ad59f2e432cfe8 + \"flex-\" + n + n;\n        case 5187:\n            return $ad3686905e666bc0$export$39dfd62a25e0fe93 + n + $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, /(\\w+).+(:[^]+)/, $ad3686905e666bc0$export$39dfd62a25e0fe93 + \"box-$1$2\" + $ad3686905e666bc0$export$71ad59f2e432cfe8 + \"flex-$1$2\") + n;\n        case 5443:\n            return $ad3686905e666bc0$export$39dfd62a25e0fe93 + n + $ad3686905e666bc0$export$71ad59f2e432cfe8 + \"flex-item-\" + $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, /flex-|-self/g, \"\") + (!$ad3686905e666bc0$export$4659b591c19bdf3d(n, /flex-|baseline/) ? $ad3686905e666bc0$export$71ad59f2e432cfe8 + \"grid-row-\" + $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, /flex-|-self/g, \"\") : \"\") + n;\n        case 4675:\n            return $ad3686905e666bc0$export$39dfd62a25e0fe93 + n + $ad3686905e666bc0$export$71ad59f2e432cfe8 + \"flex-line-pack\" + $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, /align-content|flex-|-self/g, \"\") + n;\n        case 5548:\n            return $ad3686905e666bc0$export$39dfd62a25e0fe93 + n + $ad3686905e666bc0$export$71ad59f2e432cfe8 + $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, \"shrink\", \"negative\") + n;\n        case 5292:\n            return $ad3686905e666bc0$export$39dfd62a25e0fe93 + n + $ad3686905e666bc0$export$71ad59f2e432cfe8 + $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, \"basis\", \"preferred-size\") + n;\n        case 6060:\n            return $ad3686905e666bc0$export$39dfd62a25e0fe93 + \"box-\" + $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, \"-grow\", \"\") + $ad3686905e666bc0$export$39dfd62a25e0fe93 + n + $ad3686905e666bc0$export$71ad59f2e432cfe8 + $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, \"grow\", \"positive\") + n;\n        case 4554:\n            return $ad3686905e666bc0$export$39dfd62a25e0fe93 + $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, /([^-])(transform)/g, \"$1\" + $ad3686905e666bc0$export$39dfd62a25e0fe93 + \"$2\") + n;\n        case 6187:\n            return $ad3686905e666bc0$export$77ad94ebf1c2b9ed($ad3686905e666bc0$export$77ad94ebf1c2b9ed($ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, /(zoom-|grab)/, $ad3686905e666bc0$export$39dfd62a25e0fe93 + \"$1\"), /(image-set)/, $ad3686905e666bc0$export$39dfd62a25e0fe93 + \"$1\"), n, \"\") + n;\n        case 5495:\n        case 3959:\n            return $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, /(image-set\\([^]*)/, $ad3686905e666bc0$export$39dfd62a25e0fe93 + \"$1\" + \"$`$1\");\n        case 4968:\n            return $ad3686905e666bc0$export$77ad94ebf1c2b9ed($ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, /(.+:)(flex-)?(.*)/, $ad3686905e666bc0$export$39dfd62a25e0fe93 + \"box-pack:$3\" + $ad3686905e666bc0$export$71ad59f2e432cfe8 + \"flex-pack:$3\"), /s.+-b[^;]+/, \"justify\") + $ad3686905e666bc0$export$39dfd62a25e0fe93 + n + n;\n        case 4200:\n            if (!$ad3686905e666bc0$export$4659b591c19bdf3d(n, /flex-|baseline/)) return $ad3686905e666bc0$export$71ad59f2e432cfe8 + \"grid-column-align\" + $ad3686905e666bc0$export$2f35ab04d2335697(n, c) + n;\n            break;\n        case 2592:\n        case 3360:\n            return $ad3686905e666bc0$export$71ad59f2e432cfe8 + $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, \"template-\", \"\") + n;\n        case 4384:\n        case 3616:\n            if (s && s.some(function(e, r) {\n                return c = r, $ad3686905e666bc0$export$4659b591c19bdf3d(e.props, /grid-\\w+-end/);\n            })) return ~$ad3686905e666bc0$export$f8e21b1e77979a08(n + (s = s[c].value), \"span\") ? n : $ad3686905e666bc0$export$71ad59f2e432cfe8 + $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, \"-start\", \"\") + n + $ad3686905e666bc0$export$71ad59f2e432cfe8 + \"grid-row-span:\" + (~$ad3686905e666bc0$export$f8e21b1e77979a08(s, \"span\") ? $ad3686905e666bc0$export$4659b591c19bdf3d(s, /\\d+/) : +$ad3686905e666bc0$export$4659b591c19bdf3d(s, /\\d+/) - +$ad3686905e666bc0$export$4659b591c19bdf3d(n, /\\d+/)) + \";\";\n            return $ad3686905e666bc0$export$71ad59f2e432cfe8 + $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, \"-start\", \"\") + n;\n        case 4896:\n        case 4128:\n            return s && s.some(function(e) {\n                return $ad3686905e666bc0$export$4659b591c19bdf3d(e.props, /grid-\\w+-start/);\n            }) ? n : $ad3686905e666bc0$export$71ad59f2e432cfe8 + $ad3686905e666bc0$export$77ad94ebf1c2b9ed($ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, \"-end\", \"-span\"), \"span \", \"\") + n;\n        case 4095:\n        case 3583:\n        case 4068:\n        case 2532:\n            return $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, /(.+)-inline(.+)/, $ad3686905e666bc0$export$39dfd62a25e0fe93 + \"$1$2\") + n;\n        case 8116:\n        case 7059:\n        case 5753:\n        case 5535:\n        case 5445:\n        case 5701:\n        case 4933:\n        case 4677:\n        case 5533:\n        case 5789:\n        case 5021:\n        case 4765:\n            if ($ad3686905e666bc0$export$36776f635604f274(n) - 1 - c > 6) switch($ad3686905e666bc0$export$a9db5e087081082d(n, c + 1)){\n                case 109:\n                    if ($ad3686905e666bc0$export$a9db5e087081082d(n, c + 4) !== 45) break;\n                case 102:\n                    return $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, /(.+:)(.+)-([^]+)/, \"$1\" + $ad3686905e666bc0$export$39dfd62a25e0fe93 + \"$2-$3\" + \"$1\" + $ad3686905e666bc0$export$2c0f367103c8d01c + ($ad3686905e666bc0$export$a9db5e087081082d(n, c + 3) == 108 ? \"$3\" : \"$2-$3\")) + n;\n                case 115:\n                    return ~$ad3686905e666bc0$export$f8e21b1e77979a08(n, \"stretch\") ? $ad3686905e666bc0$export$82e9f45cca5ba907($ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, \"stretch\", \"fill-available\"), c, s) + n : n;\n            }\n            break;\n        case 5152:\n        case 5920:\n            return $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, /(.+?):(\\d+)(\\s*\\/\\s*(span)?\\s*(\\d+))?(.*)/, function(r, a, c, s, t, u, i) {\n                return $ad3686905e666bc0$export$71ad59f2e432cfe8 + a + \":\" + c + i + (s ? $ad3686905e666bc0$export$71ad59f2e432cfe8 + a + \"-span:\" + (t ? u : +u - +c) + i : \"\") + n;\n            });\n        case 4949:\n            if ($ad3686905e666bc0$export$a9db5e087081082d(n, c + 6) === 121) return $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, \":\", \":\" + $ad3686905e666bc0$export$39dfd62a25e0fe93) + n;\n            break;\n        case 6444:\n            switch($ad3686905e666bc0$export$a9db5e087081082d(n, $ad3686905e666bc0$export$a9db5e087081082d(n, 14) === 45 ? 18 : 11)){\n                case 120:\n                    return $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, /(.+:)([^;\\s!]+)(;|(\\s+)?!.+)?/, \"$1\" + $ad3686905e666bc0$export$39dfd62a25e0fe93 + ($ad3686905e666bc0$export$a9db5e087081082d(n, 14) === 45 ? \"inline-\" : \"\") + \"box$3\" + \"$1\" + $ad3686905e666bc0$export$39dfd62a25e0fe93 + \"$2$3\" + \"$1\" + $ad3686905e666bc0$export$71ad59f2e432cfe8 + \"$2box$3\") + n;\n                case 100:\n                    return $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, \":\", \":\" + $ad3686905e666bc0$export$71ad59f2e432cfe8) + n;\n            }\n            break;\n        case 5719:\n        case 2647:\n        case 2135:\n        case 3927:\n        case 2391:\n            return $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n, \"scroll-\", \"scroll-snap-\") + n;\n    }\n    return n;\n}\nfunction $ad3686905e666bc0$export$dfdc1655ccc5b9cb(e, r) {\n    var a = \"\";\n    var n = $ad3686905e666bc0$export$f9084667e487ed46(e);\n    for(var c = 0; c < n; c++)a += r(e[c], c, e, r) || \"\";\n    return a;\n}\nfunction $ad3686905e666bc0$export$fac44ee5b035f737(e, r, a, t) {\n    switch(e.type){\n        case $ad3686905e666bc0$export$d773506282b3cfe6:\n            if (e.children.length) break;\n        case $ad3686905e666bc0$export$a763edbf796b780a:\n        case $ad3686905e666bc0$export$527d108ccf083c2b:\n            return e.return = e.return || e.value;\n        case $ad3686905e666bc0$export$a29989082612d0d9:\n            return \"\";\n        case $ad3686905e666bc0$export$b44a8529a35fcb60:\n            return e.return = e.value + \"{\" + $ad3686905e666bc0$export$dfdc1655ccc5b9cb(e.children, t) + \"}\";\n        case $ad3686905e666bc0$export$aa3a2e812ca8570d:\n            e.value = e.props.join(\",\");\n    }\n    return $ad3686905e666bc0$export$36776f635604f274(a = $ad3686905e666bc0$export$dfdc1655ccc5b9cb(e.children, t)) ? e.return = e.value + \"{\" + a + \"}\" : \"\";\n}\nfunction $ad3686905e666bc0$export$5a7767152ae0305f(e) {\n    var r = $ad3686905e666bc0$export$f9084667e487ed46(e);\n    return function(a, n, c, s) {\n        var t = \"\";\n        for(var u = 0; u < r; u++)t += e[u](a, n, c, s) || \"\";\n        return t;\n    };\n}\nfunction $ad3686905e666bc0$export$38bcb760f1d4871c(e) {\n    return function(r) {\n        if (!r.root) {\n            if (r = r.return) e(r);\n        }\n    };\n}\nfunction $ad3686905e666bc0$export$e08c7d021b829b7a(n, t, u, i) {\n    if (n.length > -1) {\n        if (!n.return) switch(n.type){\n            case $ad3686905e666bc0$export$527d108ccf083c2b:\n                n.return = $ad3686905e666bc0$export$82e9f45cca5ba907(n.value, n.length, u);\n                return;\n            case $ad3686905e666bc0$export$b44a8529a35fcb60:\n                return $ad3686905e666bc0$export$dfdc1655ccc5b9cb([\n                    $ad3686905e666bc0$export$784d13d8ee351f07(n, {\n                        value: $ad3686905e666bc0$export$77ad94ebf1c2b9ed(n.value, \"@\", \"@\" + $ad3686905e666bc0$export$39dfd62a25e0fe93)\n                    })\n                ], i);\n            case $ad3686905e666bc0$export$aa3a2e812ca8570d:\n                if (n.length) return $ad3686905e666bc0$export$1be1fc439b849fdf(n.props, function(c) {\n                    switch($ad3686905e666bc0$export$4659b591c19bdf3d(c, /(::plac\\w+|:read-\\w+)/)){\n                        case \":read-only\":\n                        case \":read-write\":\n                            return $ad3686905e666bc0$export$dfdc1655ccc5b9cb([\n                                $ad3686905e666bc0$export$784d13d8ee351f07(n, {\n                                    props: [\n                                        $ad3686905e666bc0$export$77ad94ebf1c2b9ed(c, /:(read-\\w+)/, \":\" + $ad3686905e666bc0$export$2c0f367103c8d01c + \"$1\")\n                                    ]\n                                })\n                            ], i);\n                        case \"::placeholder\":\n                            return $ad3686905e666bc0$export$dfdc1655ccc5b9cb([\n                                $ad3686905e666bc0$export$784d13d8ee351f07(n, {\n                                    props: [\n                                        $ad3686905e666bc0$export$77ad94ebf1c2b9ed(c, /:(plac\\w+)/, \":\" + $ad3686905e666bc0$export$39dfd62a25e0fe93 + \"input-$1\")\n                                    ]\n                                }),\n                                $ad3686905e666bc0$export$784d13d8ee351f07(n, {\n                                    props: [\n                                        $ad3686905e666bc0$export$77ad94ebf1c2b9ed(c, /:(plac\\w+)/, \":\" + $ad3686905e666bc0$export$2c0f367103c8d01c + \"$1\")\n                                    ]\n                                }),\n                                $ad3686905e666bc0$export$784d13d8ee351f07(n, {\n                                    props: [\n                                        $ad3686905e666bc0$export$77ad94ebf1c2b9ed(c, /:(plac\\w+)/, $ad3686905e666bc0$export$71ad59f2e432cfe8 + \"input-$1\")\n                                    ]\n                                })\n                            ], i);\n                    }\n                    return \"\";\n                });\n        }\n    }\n}\nfunction $ad3686905e666bc0$export$76a88f7de6507443(e) {\n    switch(e.type){\n        case $ad3686905e666bc0$export$aa3a2e812ca8570d:\n            e.props = e.props.map(function(r) {\n                return $ad3686905e666bc0$export$1be1fc439b849fdf($ad3686905e666bc0$export$660b2ee2d4fb4eff(r), function(r, a, n) {\n                    switch($ad3686905e666bc0$export$a9db5e087081082d(r, 0)){\n                        case 12:\n                            return $ad3686905e666bc0$export$2f35ab04d2335697(r, 1, $ad3686905e666bc0$export$36776f635604f274(r));\n                        case 0:\n                        case 40:\n                        case 43:\n                        case 62:\n                        case 126:\n                            return r;\n                        case 58:\n                            if (n[++a] === \"global\") n[a] = \"\", n[++a] = \"\\f\" + $ad3686905e666bc0$export$2f35ab04d2335697(n[a], a = 1, -1);\n                        case 32:\n                            return a === 1 ? \"\" : r;\n                        default:\n                            switch(a){\n                                case 0:\n                                    e = r;\n                                    return $ad3686905e666bc0$export$f9084667e487ed46(n) > 1 ? \"\" : r;\n                                case a = $ad3686905e666bc0$export$f9084667e487ed46(n) - 1:\n                                case 2:\n                                    return a === 2 ? r + e + e : r + e;\n                                default:\n                                    return r;\n                            }\n                    }\n                });\n            });\n    }\n}\n\n});\n\nparcelRequire.register(\"gZ0tz\", function(module, exports) {\nvar $c5d2b6572f2301a4$export$2e2bcd8739ae039 = function weakMemoize(func) {\n    // $FlowFixMe flow doesn't include all non-primitive types as allowed for weakmaps\n    var cache = new WeakMap();\n    return function(arg) {\n        if (cache.has(arg)) // $FlowFixMe\n        return cache.get(arg);\n        var ret = func(arg);\n        cache.set(arg, ret);\n        return ret;\n    };\n};\n\n});\n\nparcelRequire.register(\"8ClKM\", function(module, exports) {\n\n$parcel$export(module.exports, \"default\", function () { return $6462bf2593a1e404$export$2e2bcd8739ae039; });\nfunction $6462bf2593a1e404$export$2e2bcd8739ae039(fn) {\n    var cache = Object.create(null);\n    return function(arg) {\n        if (cache[arg] === undefined) cache[arg] = fn(arg);\n        return cache[arg];\n    };\n}\n\n});\n\n\nparcelRequire.register(\"csvAs\", function(module, exports) {\n\n$parcel$export(module.exports, \"serializeStyles\", function () { return $91209a116b87ff88$export$6321afa313b251b5; });\n\nvar $8KHnw = parcelRequire(\"8KHnw\");\n\nvar $3worW = parcelRequire(\"3worW\");\n\nvar $1gYqP = parcelRequire(\"1gYqP\");\n\nvar $8ClKM = parcelRequire(\"8ClKM\");\nvar $91209a116b87ff88$var$ILLEGAL_ESCAPE_SEQUENCE_ERROR = \"You have illegal escape sequence in your template literal, most likely inside content's property value.\\nBecause you write your CSS inside a JavaScript string you actually have to do double escaping, so for example \\\"content: '\\\\00d7';\\\" should become \\\"content: '\\\\\\\\00d7';\\\".\\nYou can read more about this here:\\nhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#ES2018_revision_of_illegal_escape_sequences\";\nvar $91209a116b87ff88$var$UNDEFINED_AS_OBJECT_KEY_ERROR = \"You have passed in falsy value as style object's key (can happen when in example you pass unexported component as computed key).\";\nvar $91209a116b87ff88$var$hyphenateRegex = /[A-Z]|^ms/g;\nvar $91209a116b87ff88$var$animationRegex = /_EMO_([^_]+?)_([^]*?)_EMO_/g;\nvar $91209a116b87ff88$var$isCustomProperty = function isCustomProperty(property) {\n    return property.charCodeAt(1) === 45;\n};\nvar $91209a116b87ff88$var$isProcessableValue = function isProcessableValue(value) {\n    return value != null && typeof value !== \"boolean\";\n};\nvar $91209a116b87ff88$var$processStyleName = /* #__PURE__ */ (0, $8ClKM.default)(function(styleName) {\n    return $91209a116b87ff88$var$isCustomProperty(styleName) ? styleName : styleName.replace($91209a116b87ff88$var$hyphenateRegex, \"-$&\").toLowerCase();\n});\nvar $91209a116b87ff88$var$processStyleValue = function processStyleValue(key, value) {\n    switch(key){\n        case \"animation\":\n        case \"animationName\":\n            if (typeof value === \"string\") return value.replace($91209a116b87ff88$var$animationRegex, function(match, p1, p2) {\n                $91209a116b87ff88$var$cursor = {\n                    name: p1,\n                    styles: p2,\n                    next: $91209a116b87ff88$var$cursor\n                };\n                return p1;\n            });\n    }\n    if ((0, $1gYqP.default)[key] !== 1 && !$91209a116b87ff88$var$isCustomProperty(key) && typeof value === \"number\" && value !== 0) return value + \"px\";\n    return value;\n};\nvar $91209a116b87ff88$var$contentValuePattern, $91209a116b87ff88$var$contentValues, $91209a116b87ff88$var$oldProcessStyleValue, $91209a116b87ff88$var$msPattern, $91209a116b87ff88$var$hyphenPattern, $91209a116b87ff88$var$hyphenatedCache;\nvar $91209a116b87ff88$var$noComponentSelectorMessage = \"Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.\";\nfunction $91209a116b87ff88$var$handleInterpolation(mergedProps, registered, interpolation) {\n    if (interpolation == null) return \"\";\n    if (interpolation.__emotion_styles !== undefined) return interpolation;\n    switch(typeof interpolation === \"undefined\" ? \"undefined\" : (0, $8KHnw._)(interpolation)){\n        case \"boolean\":\n            return \"\";\n        case \"object\":\n            if (interpolation.anim === 1) {\n                $91209a116b87ff88$var$cursor = {\n                    name: interpolation.name,\n                    styles: interpolation.styles,\n                    next: $91209a116b87ff88$var$cursor\n                };\n                return interpolation.name;\n            }\n            if (interpolation.styles !== undefined) {\n                var next = interpolation.next;\n                if (next !== undefined) // not the most efficient thing ever but this is a pretty rare case\n                // and there will be very few iterations of this generally\n                while(next !== undefined){\n                    $91209a116b87ff88$var$cursor = {\n                        name: next.name,\n                        styles: next.styles,\n                        next: $91209a116b87ff88$var$cursor\n                    };\n                    next = next.next;\n                }\n                var styles = interpolation.styles + \";\";\n                return styles;\n            }\n            return $91209a116b87ff88$var$createStringFromObject(mergedProps, registered, interpolation);\n        case \"function\":\n            if (mergedProps !== undefined) {\n                var previousCursor = $91209a116b87ff88$var$cursor;\n                var result = interpolation(mergedProps);\n                $91209a116b87ff88$var$cursor = previousCursor;\n                return $91209a116b87ff88$var$handleInterpolation(mergedProps, registered, result);\n            }\n            break;\n        case \"string\":\n            var matched, replaced;\n            break;\n    } // finalize string values (regular strings and functions interpolated into css calls)\n    if (registered == null) return interpolation;\n    var cached = registered[interpolation];\n    return cached !== undefined ? cached : interpolation;\n}\nfunction $91209a116b87ff88$var$createStringFromObject(mergedProps, registered, obj) {\n    var string = \"\";\n    if (Array.isArray(obj)) for(var i = 0; i < obj.length; i++)string += $91209a116b87ff88$var$handleInterpolation(mergedProps, registered, obj[i]) + \";\";\n    else for(var _key in obj){\n        var value = obj[_key];\n        if (typeof value !== \"object\") {\n            if (registered != null && registered[value] !== undefined) string += _key + \"{\" + registered[value] + \"}\";\n            else if ($91209a116b87ff88$var$isProcessableValue(value)) string += $91209a116b87ff88$var$processStyleName(_key) + \":\" + $91209a116b87ff88$var$processStyleValue(_key, value) + \";\";\n        } else if (Array.isArray(value) && typeof value[0] === \"string\" && (registered == null || registered[value[0]] === undefined)) {\n            for(var _i = 0; _i < value.length; _i++)if ($91209a116b87ff88$var$isProcessableValue(value[_i])) string += $91209a116b87ff88$var$processStyleName(_key) + \":\" + $91209a116b87ff88$var$processStyleValue(_key, value[_i]) + \";\";\n        } else {\n            var interpolated = $91209a116b87ff88$var$handleInterpolation(mergedProps, registered, value);\n            switch(_key){\n                case \"animation\":\n                case \"animationName\":\n                    string += $91209a116b87ff88$var$processStyleName(_key) + \":\" + interpolated + \";\";\n                    break;\n                default:\n                    string += _key + \"{\" + interpolated + \"}\";\n            }\n        }\n    }\n    return string;\n}\nvar $91209a116b87ff88$var$labelPattern = /label:\\s*([^\\s;\\n{]+)\\s*(;|$)/g;\nvar $91209a116b87ff88$var$sourceMapPattern;\n// keyframes are stored on the SerializedStyles object as a linked list\nvar $91209a116b87ff88$var$cursor;\nvar $91209a116b87ff88$export$6321afa313b251b5 = function serializeStyles(args, registered, mergedProps) {\n    if (args.length === 1 && typeof args[0] === \"object\" && args[0] !== null && args[0].styles !== undefined) return args[0];\n    var stringMode = true;\n    var styles = \"\";\n    $91209a116b87ff88$var$cursor = undefined;\n    var strings = args[0];\n    if (strings == null || strings.raw === undefined) {\n        stringMode = false;\n        styles += $91209a116b87ff88$var$handleInterpolation(mergedProps, registered, strings);\n    } else styles += strings[0];\n     // we start at 1 since we've already handled the first arg\n    for(var i = 1; i < args.length; i++){\n        styles += $91209a116b87ff88$var$handleInterpolation(mergedProps, registered, args[i]);\n        if (stringMode) styles += strings[i];\n    }\n    var sourceMap;\n    $91209a116b87ff88$var$labelPattern.lastIndex = 0;\n    var identifierName = \"\";\n    var match; // https://esbench.com/bench/5b809c2cf2949800a0f61fb5\n    while((match = $91209a116b87ff88$var$labelPattern.exec(styles)) !== null)identifierName += \"-\" + // $FlowFixMe we know it's not null\n    match[1];\n    var name = (0, $3worW.default)(styles) + identifierName;\n    return {\n        name: name,\n        styles: styles,\n        next: $91209a116b87ff88$var$cursor\n    };\n};\n\n});\nparcelRequire.register(\"3worW\", function(module, exports) {\n\n$parcel$export(module.exports, \"default\", function () { return $2907536e1df79c58$export$2e2bcd8739ae039; });\n/* eslint-disable */ // Inspired by https://github.com/garycourt/murmurhash-js\n// Ported from https://github.com/aappleby/smhasher/blob/61a0530f28277f2e850bfc39600ce61d02b518de/src/MurmurHash2.cpp#L37-L86\nfunction $2907536e1df79c58$export$2e2bcd8739ae039(str) {\n    // 'm' and 'r' are mixing constants generated offline.\n    // They're not really 'magic', they just happen to work well.\n    // const m = 0x5bd1e995;\n    // const r = 24;\n    // Initialize the hash\n    var h = 0; // Mix 4 bytes at a time into the hash\n    var k, i = 0, len = str.length;\n    for(; len >= 4; ++i, len -= 4){\n        k = str.charCodeAt(i) & 0xff | (str.charCodeAt(++i) & 0xff) << 8 | (str.charCodeAt(++i) & 0xff) << 16 | (str.charCodeAt(++i) & 0xff) << 24;\n        k = /* Math.imul(k, m): */ (k & 0xffff) * 0x5bd1e995 + ((k >>> 16) * 0xe995 << 16);\n        k ^= /* k >>> r: */ k >>> 24;\n        h = /* Math.imul(k, m): */ (k & 0xffff) * 0x5bd1e995 + ((k >>> 16) * 0xe995 << 16) ^ /* Math.imul(h, m): */ (h & 0xffff) * 0x5bd1e995 + ((h >>> 16) * 0xe995 << 16);\n    } // Handle the last few bytes of the input array\n    switch(len){\n        case 3:\n            h ^= (str.charCodeAt(i + 2) & 0xff) << 16;\n        case 2:\n            h ^= (str.charCodeAt(i + 1) & 0xff) << 8;\n        case 1:\n            h ^= str.charCodeAt(i) & 0xff;\n            h = /* Math.imul(h, m): */ (h & 0xffff) * 0x5bd1e995 + ((h >>> 16) * 0xe995 << 16);\n    } // Do a few final mixes of the hash to ensure the last few\n    // bytes are well-incorporated.\n    h ^= h >>> 13;\n    h = /* Math.imul(h, m): */ (h & 0xffff) * 0x5bd1e995 + ((h >>> 16) * 0xe995 << 16);\n    return ((h ^ h >>> 15) >>> 0).toString(36);\n}\n\n});\n\nparcelRequire.register(\"1gYqP\", function(module, exports) {\n\n$parcel$export(module.exports, \"default\", function () { return $0ed62991c9c383b9$export$2e2bcd8739ae039; });\nvar $0ed62991c9c383b9$export$2e2bcd8739ae039 = {\n    animationIterationCount: 1,\n    aspectRatio: 1,\n    borderImageOutset: 1,\n    borderImageSlice: 1,\n    borderImageWidth: 1,\n    boxFlex: 1,\n    boxFlexGroup: 1,\n    boxOrdinalGroup: 1,\n    columnCount: 1,\n    columns: 1,\n    flex: 1,\n    flexGrow: 1,\n    flexPositive: 1,\n    flexShrink: 1,\n    flexNegative: 1,\n    flexOrder: 1,\n    gridRow: 1,\n    gridRowEnd: 1,\n    gridRowSpan: 1,\n    gridRowStart: 1,\n    gridColumn: 1,\n    gridColumnEnd: 1,\n    gridColumnSpan: 1,\n    gridColumnStart: 1,\n    msGridRow: 1,\n    msGridRowSpan: 1,\n    msGridColumn: 1,\n    msGridColumnSpan: 1,\n    fontWeight: 1,\n    lineHeight: 1,\n    opacity: 1,\n    order: 1,\n    orphans: 1,\n    tabSize: 1,\n    widows: 1,\n    zIndex: 1,\n    zoom: 1,\n    WebkitLineClamp: 1,\n    // SVG-related properties\n    fillOpacity: 1,\n    floodOpacity: 1,\n    stopOpacity: 1,\n    strokeDasharray: 1,\n    strokeDashoffset: 1,\n    strokeMiterlimit: 1,\n    strokeOpacity: 1,\n    strokeWidth: 1\n};\n\n});\n\n\nparcelRequire.register(\"5zE8f\", function(module, exports) {\n\n$parcel$export(module.exports, \"getRegisteredStyles\", function () { return $40ef5a08092b28a8$export$95d99596f328fd52; });\n$parcel$export(module.exports, \"insertStyles\", function () { return $40ef5a08092b28a8$export$6f077d94b33a01aa; });\nvar $40ef5a08092b28a8$var$isBrowser = true;\nfunction $40ef5a08092b28a8$export$95d99596f328fd52(registered, registeredStyles, classNames) {\n    var rawClassName = \"\";\n    classNames.split(\" \").forEach(function(className) {\n        if (registered[className] !== undefined) registeredStyles.push(registered[className] + \";\");\n        else rawClassName += className + \" \";\n    });\n    return rawClassName;\n}\nvar $40ef5a08092b28a8$export$580009a5da2a8b4b = function registerStyles(cache, serialized, isStringTag) {\n    var className = cache.key + \"-\" + serialized.name;\n    if (// class name could be used further down\n    // the tree but if it's a string tag, we know it won't\n    // so we don't have to add it to registered cache.\n    // this improves memory usage since we can avoid storing the whole style string\n    (isStringTag === false || // we need to always store it if we're in compat mode and\n    // in node since emotion-server relies on whether a style is in\n    // the registered cache to know whether a style is global or not\n    // also, note that this check will be dead code eliminated in the browser\n    $40ef5a08092b28a8$var$isBrowser === false) && cache.registered[className] === undefined) cache.registered[className] = serialized.styles;\n};\nvar $40ef5a08092b28a8$export$6f077d94b33a01aa = function insertStyles(cache, serialized, isStringTag) {\n    $40ef5a08092b28a8$export$580009a5da2a8b4b(cache, serialized, isStringTag);\n    var className = cache.key + \"-\" + serialized.name;\n    if (cache.inserted[serialized.name] === undefined) {\n        var current = serialized;\n        do {\n            cache.insert(serialized === current ? \".\" + className : \"\", current, cache.sheet, true);\n            current = current.next;\n        }while (current !== undefined);\n    }\n};\n\n});\n\n\n\n\nparcelRequire.register(\"kDGzx\", function(module, exports) {\n\n$parcel$export(module.exports, \"showImportImageDialog\", function () { return $c8d2eb7d799b314c$export$1bf16d9bd59fd8f9; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $hRdOL = parcelRequire(\"hRdOL\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $2MaaK = parcelRequire(\"2MaaK\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nfunction $c8d2eb7d799b314c$export$1bf16d9bd59fd8f9(p) {\n    var updateResolution = function updateResolution(w, h) {\n        var fit = (0, $eWjiX.BB).fitInto(w, h, p.maxSize, p.maxSize);\n        if (fit.width < w) {\n            resolutionEl.innerHTML = '<span class=\"kl-text-error\">'.concat(w, \" X \").concat(h, \"</span>  \").concat(Math.round(fit.width), \" X \").concat(Math.round(fit.height));\n            resolutionEl.title = (0, $1mH1z.LANG)(\"import-too-large\");\n        } else {\n            resolutionEl.innerHTML = \"\".concat(w, \" X \").concat(h);\n            resolutionEl.title = \"\";\n        }\n    };\n    var showWarnings = function showWarnings(psdWarningArr) {\n        var contentArr = [];\n        var warningMap = {\n            \"mask\": \"Masks not supported. Mask was applied.\",\n            \"clipping\": \"Clipping not supported. Clipping layers were merged.\",\n            \"group\": \"Groups not supported. Layers were ungrouped.\",\n            \"adjustment\": \"Adjustment layers not supported.\",\n            \"layer-effect\": \"Layer effects not supported.\",\n            \"smart-object\": \"Smart objects not supported.\",\n            \"blend-mode\": \"Unsupported layer blend mode.\",\n            \"bits-per-channel\": \"Unsupported color depth. Only 8bit per channel supported.\"\n        };\n        for(var i = 0; i < psdWarningArr.length; i++)contentArr.push(\"- \" + warningMap[psdWarningArr[i]]);\n        alert(contentArr.join(\"\\n\"));\n    };\n    var callback = function callback(result) {\n        var croppedImage = cropCopy.getCroppedImage();\n        var cropRect = cropCopy.getRect();\n        var isCropped = p.image.width !== cropRect.width && p.image.height !== cropRect.height;\n        cropCopy.destroy();\n        (0, $eWjiX.BB).destroyEl(warningsEl);\n        if (flattenCheckbox) flattenCheckbox.destroy();\n        if (result === (0, $1mH1z.LANG)(\"import-btn-as-layer\")) p.callback({\n            type: \"as-layer\",\n            image: isCropped ? croppedImage : p.image.canvas\n        });\n        else if (result === (0, $1mH1z.LANG)(\"import-btn-as-image\")) {\n            if (p.image.type === \"psd\") {\n                if (doFlatten) delete p.image.layers;\n                p.callback({\n                    type: \"as-image-psd\",\n                    image: p.image,\n                    cropObj: cropRect\n                });\n            } else if (p.image.type === \"image\") p.callback({\n                type: \"as-image\",\n                image: croppedImage\n            });\n        } else p.callback({\n            type: \"cancel\"\n        });\n    };\n    var rootEl = (0, $eWjiX.BB).el();\n    var isSmall = window.innerWidth < 550 || window.innerHeight < 550;\n    var style = isSmall ? {} : {\n        width: \"540px\"\n    };\n    var resolutionEl = (0, $eWjiX.BB).el({\n        css: {\n            marginTop: \"10px\",\n            textAlign: \"center\",\n            color: \"#888\",\n            lineHeight: \"20px\"\n        }\n    });\n    var cropCopy = new (0, $hRdOL.CropCopy)({\n        width: isSmall ? 340 : 540,\n        height: isSmall ? 300 : 400,\n        canvas: p.image.canvas,\n        isNotCopy: true,\n        onChange: function(width, height) {\n            if (!resolutionEl) return;\n            updateResolution(width, height);\n        }\n    });\n    (0, $eWjiX.BB).css(cropCopy.getEl(), {\n        marginLeft: \"-20px\"\n    });\n    cropCopy.getEl().title = (0, $1mH1z.LANG)(\"crop-drag-to-crop\");\n    rootEl.append(cropCopy.getEl(), resolutionEl);\n    updateResolution(p.image.width, p.image.height);\n    var doFlatten = false;\n    var flattenCheckbox;\n    var warningsEl;\n    if (p.image.type === \"psd\") {\n        if (p.image.layers) {\n            flattenCheckbox = new (0, $7bWhB.Checkbox)({\n                init: doFlatten,\n                label: (0, $1mH1z.LANG)(\"import-flatten\"),\n                callback: function(b) {\n                    doFlatten = b;\n                }\n            });\n            rootEl.append(flattenCheckbox.getElement());\n            if (p.image.warningArr) {\n                var noteEl = (0, $eWjiX.BB).el({\n                    className: \"kl-import-note\",\n                    content: (0, $1mH1z.LANG)(\"import-psd-limited-support\")\n                });\n                var warnings = p.image.warningArr;\n                warningsEl = (0, $eWjiX.BB).el({\n                    parent: noteEl,\n                    tagName: \"a\",\n                    content: \"Details\",\n                    css: {\n                        marginLeft: \"5px\"\n                    },\n                    onClick: function() {\n                        return showWarnings(warnings);\n                    }\n                });\n                rootEl.append(noteEl);\n            }\n        } else {\n            var noteEl1 = (0, $eWjiX.BB).el({\n                className: \"kl-import-note\",\n                content: (0, $1mH1z.LANG)(\"import-psd-unsupported\")\n            });\n            rootEl.append(noteEl1);\n        }\n    }\n    (0, $2MaaK.showModal)({\n        target: p.target,\n        message: \"<b>\".concat((0, $1mH1z.LANG)(\"import-title\"), \"</b>\"),\n        div: rootEl,\n        style: style,\n        buttons: [\n            (0, $1mH1z.LANG)(\"import-btn-as-layer\"),\n            (0, $1mH1z.LANG)(\"import-btn-as-image\"),\n            \"Cancel\"\n        ],\n        primaries: [\n            (0, $1mH1z.LANG)(\"import-btn-as-layer\"),\n            (0, $1mH1z.LANG)(\"import-btn-as-image\")\n        ],\n        callback: callback,\n        autoFocus: \"As Image\"\n    });\n}\n\n});\n\nparcelRequire.register(\"941rU\", function(module, exports) {\n\n$parcel$export(module.exports, \"blendPsdToKl\", function () { return $4c230b0de5e1a470$export$6df36f0c42d2440f; });\n$parcel$export(module.exports, \"blendKlToPsd\", function () { return $4c230b0de5e1a470$export$4e3b1f7d3ad623b4; });\n$parcel$export(module.exports, \"readPsd\", function () { return $4c230b0de5e1a470$export$3d649861c4b13fa2; });\n$parcel$export(module.exports, \"klPsdToKlProject\", function () { return $4c230b0de5e1a470$export$56493bf279c387b3; });\n\nvar $eelgW = parcelRequire(\"eelgW\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $705qg = parcelRequire(\"705qg\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $4c230b0de5e1a470$var$kl2PsdMap;\nvar $4c230b0de5e1a470$var$psd2KlMap;\nfunction $4c230b0de5e1a470$var$init() {\n    if ($4c230b0de5e1a470$var$kl2PsdMap) return;\n    $4c230b0de5e1a470$var$kl2PsdMap = {\n        \"source-over\": \"normal\",\n        \"darken\": \"darken\",\n        \"multiply\": \"multiply\",\n        \"color-burn\": \"color burn\",\n        \"lighten\": \"lighten\",\n        \"screen\": \"screen\",\n        \"color-dodge\": \"color dodge\",\n        \"overlay\": \"overlay\",\n        \"soft-light\": \"soft light\",\n        \"hard-light\": \"hard light\",\n        \"difference\": \"difference\",\n        \"exclusion\": \"exclusion\",\n        \"hue\": \"hue\",\n        \"saturation\": \"saturation\",\n        \"color\": \"color\",\n        \"luminosity\": \"luminosity\"\n    };\n    $4c230b0de5e1a470$var$psd2KlMap = Object.fromEntries(Object.entries($4c230b0de5e1a470$var$kl2PsdMap).map(function(a) {\n        return a.reverse();\n    }));\n}\nfunction $4c230b0de5e1a470$export$6df36f0c42d2440f(str) {\n    $4c230b0de5e1a470$var$init();\n    return $4c230b0de5e1a470$var$psd2KlMap[str];\n}\nfunction $4c230b0de5e1a470$export$4e3b1f7d3ad623b4(str) {\n    $4c230b0de5e1a470$var$init();\n    return $4c230b0de5e1a470$var$kl2PsdMap[str];\n}\nfunction $4c230b0de5e1a470$export$3d649861c4b13fa2(psdObj) {\n    var addWarning = function addWarning(warningStr) {\n        if (!result.warningArr) result.warningArr = [];\n        if (result.warningArr.includes(warningStr)) return;\n        result.warningArr.push(warningStr);\n    };\n    var getMixModeStr = function getMixModeStr(blendMode) {\n        var mixModeStr = $4c230b0de5e1a470$export$6df36f0c42d2440f(blendMode);\n        if (!mixModeStr) {\n            addWarning(\"blend-mode\");\n            mixModeStr = \"source-over\";\n        }\n        return mixModeStr;\n    };\n    var prepareMask = function prepareMask(maskCanvas, defaultColor) {\n        var groupMaskCtx = (0, $eWjiX.BB).ctx(maskCanvas);\n        var imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\n        if (defaultColor === 0) for(var i = 0; i < imData.data.length; i += 4)imData.data[i + 3] = imData.data[i];\n        else for(var i1 = 0; i1 < imData.data.length; i1 += 4)imData.data[i1 + 3] = 255 - imData.data[i1];\n        groupMaskCtx.putImageData(imData, 0, 0);\n    };\n    if (!psdObj.canvas) throw new Error(\"psdObj.canvas undefined\");\n    var result = {\n        type: \"psd\",\n        canvas: psdObj.canvas,\n        width: psdObj.width,\n        height: psdObj.height\n    };\n    if (psdObj.bitsPerChannel !== 8) addWarning(\"bits-per-channel\");\n    if (!psdObj.children) {\n        result.error = true;\n        return result;\n    }\n    // count resulting layers\n    var maxLayers = (0, $705qg.MAX_LAYERS);\n    var layerCount = 0;\n    function countWithinGroup(groupObj) {\n        var result = 0;\n        if (groupObj.blendMode) {\n            var mixModeStr = $4c230b0de5e1a470$export$6df36f0c42d2440f(groupObj.blendMode);\n            if (mixModeStr && mixModeStr !== \"source-over\") return 1;\n        }\n        if (groupObj.children) for(var i = 0; i < groupObj.children.length; i++){\n            var item = groupObj.children[i];\n            if (item.clipping || item.adjustment) continue;\n            if (item.children) {\n                addWarning(\"group\");\n                result += countWithinGroup(item);\n            } else result++;\n        }\n        return result;\n    }\n    layerCount += countWithinGroup(psdObj);\n    if (layerCount > maxLayers) {\n        result.error = true;\n        return result;\n    }\n    result.layers = [];\n    function convertGroup(psdGroupObj) {\n        var resultArr = [];\n        var groupIsVisible = !psdGroupObj.hidden;\n        var groupOpacity = (0, $7jh4K.throwIfUndefined)(psdGroupObj.opacity, \"groupOpacity is undefined\");\n        var groupMixModeStr = getMixModeStr(psdGroupObj.blendMode);\n        var groupCanvas;\n        var groupCtx;\n        if (groupMixModeStr !== \"source-over\") {\n            groupCanvas = (0, $eelgW.createCanvas)(result.width, result.height);\n            groupCtx = (0, $eWjiX.BB).ctx(groupCanvas);\n        }\n        // prepare group mask\n        if (psdGroupObj.mask) {\n            addWarning(\"mask\");\n            prepareMask(psdGroupObj.mask.canvas, psdGroupObj.mask.defaultColor);\n        }\n        if (psdGroupObj.children) for(var i = 0; i < psdGroupObj.children.length; i++){\n            var item = psdGroupObj.children[i];\n            if (item.clipping) continue;\n            if (item.adjustment) {\n                addWarning(\"adjustment\");\n                continue;\n            }\n            var hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\n            if (hasClipping) addWarning(\"clipping\");\n            if (item.children) {\n                var convertedChildGroupItems = convertGroup(item);\n                for(var e = 0; e < convertedChildGroupItems.length; e++){\n                    var innerItem = convertedChildGroupItems[e];\n                    var innerCtx = (0, $eWjiX.BB).ctx(innerItem.image);\n                    // clipping\n                    if (hasClipping) {\n                        var clippingCanvas = (0, $eelgW.createCanvas)(result.width, result.height);\n                        var clippingCtx = (0, $eWjiX.BB).ctx(clippingCanvas);\n                        clippingCtx.drawImage(innerItem.image, 0, 0);\n                        for(var f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++){\n                            var clippingItem = psdGroupObj.children[f];\n                            if (clippingItem.opacity === 0 || clippingItem.hidden) continue;\n                            if (clippingItem.blendMode === undefined) throw new Error(\"clippingItem.blendMode undefined\");\n                            if (clippingItem.opacity === undefined) throw new Error(\"clippingItem.opacity undefined\");\n                            if (clippingItem.canvas === undefined) throw new Error(\"clippingItem.canvas undefined\");\n                            if (clippingItem.left === undefined) throw new Error(\"clippingItem.left undefined\");\n                            if (clippingItem.top === undefined) throw new Error(\"clippingItem.top undefined\");\n                            clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\n                            clippingCtx.globalAlpha = clippingItem.opacity;\n                            clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\n                        }\n                        innerCtx.globalCompositeOperation = \"source-atop\";\n                        innerCtx.drawImage(clippingCanvas, 0, 0);\n                    }\n                    // group mask\n                    if (psdGroupObj.mask) {\n                        innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? \"destination-in\" : \"destination-out\";\n                        if (psdGroupObj.mask.canvas === undefined) throw new Error(\"psdGroupObj.mask.canvas undefined\");\n                        if (psdGroupObj.mask.left === undefined) throw new Error(\"psdGroupObj.mask.left undefined\");\n                        if (psdGroupObj.mask.top === undefined) throw new Error(\"psdGroupObj.mask.top undefined\");\n                        innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\n                    }\n                    if (groupCanvas) {\n                        if (groupCtx === undefined) throw new Error(\"groupCtx undefined\");\n                        groupCtx.globalCompositeOperation = innerItem.mixModeStr;\n                        groupCtx.globalAlpha = innerItem.opacity;\n                        groupCtx.drawImage(innerItem.image, 0, 0);\n                    } else {\n                        innerItem.opacity = innerItem.opacity * groupOpacity;\n                        resultArr.push(innerItem);\n                    }\n                }\n                continue;\n            }\n            var canvas = (0, $eelgW.createCanvas)(result.width, result.height);\n            var ctx = (0, $eWjiX.BB).ctx(canvas);\n            if (item.canvas) {\n                if (item.top === undefined) throw new Error(\"item.top undefined\");\n                if (item.left === undefined) throw new Error(\"item.left undefined\");\n                ctx.drawImage(item.canvas, item.left, item.top);\n            }\n            // effects\n            if (item.effects) addWarning(\"layer-effect\");\n            // mask\n            if (item.mask) {\n                addWarning(\"mask\");\n                if (item.mask.canvas === undefined) throw new Error(\"item.mask.canvas undefined\");\n                if (item.mask.defaultColor === undefined) throw new Error(\"item.mask.defaultColor undefined\");\n                if (item.mask.left === undefined) throw new Error(\"item.mask.left undefined\");\n                if (item.mask.top === undefined) throw new Error(\"item.mask.top undefined\");\n                prepareMask(item.mask.canvas, item.mask.defaultColor);\n                ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? \"destination-in\" : \"destination-out\";\n                ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\n            }\n            // clipping\n            if (hasClipping) {\n                if (item.right === undefined) throw new Error(\"item.right undefined\");\n                if (item.left === undefined) throw new Error(\"item.left undefined\");\n                if (item.bottom === undefined) throw new Error(\"item.bottom undefined\");\n                if (item.top === undefined) throw new Error(\"item.top undefined\");\n                if (item.canvas === undefined) throw new Error(\"item.canvas undefined\");\n                var clippingCanvas1 = (0, $eelgW.createCanvas)(item.right - item.left, item.bottom - item.top);\n                var clippingCtx1 = (0, $eWjiX.BB).ctx(clippingCanvas1);\n                clippingCtx1.drawImage(item.canvas, 0, 0);\n                for(var e1 = i + 1; e1 < psdGroupObj.children.length && psdGroupObj.children[e1].clipping; e1++){\n                    var clippingItem1 = psdGroupObj.children[e1];\n                    if (clippingItem1.opacity === 0 || clippingItem1.hidden) continue;\n                    if (clippingItem1.blendMode === undefined) throw new Error(\"clippingItem.blendMode undefined\");\n                    if (clippingItem1.opacity === undefined) throw new Error(\"clippingItem.opacity undefined\");\n                    if (clippingItem1.canvas === undefined) throw new Error(\"clippingItem.canvas undefined\");\n                    if (clippingItem1.left === undefined) throw new Error(\"clippingItem.left undefined\");\n                    if (clippingItem1.top === undefined) throw new Error(\"clippingItem.top undefined\");\n                    clippingCtx1.globalCompositeOperation = getMixModeStr(clippingItem1.blendMode);\n                    clippingCtx1.globalAlpha = clippingItem1.opacity;\n                    clippingCtx1.drawImage(clippingItem1.canvas, clippingItem1.left - item.left, clippingItem1.top - item.top);\n                }\n                ctx.globalCompositeOperation = \"source-atop\";\n                ctx.drawImage(clippingCanvas1, item.left, item.top);\n            }\n            // group mask\n            if (psdGroupObj.mask) {\n                ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? \"destination-in\" : \"destination-out\";\n                if (psdGroupObj.mask.canvas === undefined) throw new Error(\"psdGroupObj.mask.canvas undefined\");\n                if (psdGroupObj.mask.left === undefined) throw new Error(\"psdGroupObj.mask.left undefined\");\n                if (psdGroupObj.mask.top === undefined) throw new Error(\"psdGroupObj.mask.top undefined\");\n                ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\n            }\n            if (item.blendMode === undefined) throw new Error(\"item.blendMode undefined\");\n            if (item.hidden === undefined) throw new Error(\"item.hidden  undefined\");\n            if (item.opacity === undefined) throw new Error(\"item.opacity undefined\");\n            if (groupCanvas && groupCtx) {\n                if (groupOpacity > 0) {\n                    groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\n                    groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\n                    groupCtx.drawImage(canvas, 0, 0);\n                }\n            } else {\n                if (item.name === undefined) throw new Error(\"item.name undefined\");\n                resultArr.push({\n                    name: item.name,\n                    isVisible: !item.hidden && groupIsVisible,\n                    opacity: item.opacity * groupOpacity,\n                    mixModeStr: getMixModeStr(item.blendMode),\n                    image: canvas\n                });\n            }\n        }\n        if (groupCanvas) {\n            if (psdGroupObj.name === undefined) throw new Error(\"psdGroupObj.name undefined\");\n            resultArr = [\n                {\n                    name: psdGroupObj.name,\n                    isVisible: groupIsVisible,\n                    opacity: groupOpacity,\n                    mixModeStr: groupMixModeStr,\n                    image: groupCanvas\n                }\n            ];\n        }\n        return resultArr;\n    }\n    result.layers = convertGroup({\n        name: \"root\",\n        opacity: 1,\n        blendMode: \"normal\",\n        children: psdObj.children\n    });\n    return result;\n}\nfunction $4c230b0de5e1a470$export$56493bf279c387b3(klPsd) {\n    // only share references to Canvas elements\n    var result = {\n        width: klPsd.width,\n        height: klPsd.height,\n        layers: []\n    };\n    if (klPsd.layers) result.layers = klPsd.layers.map(function(item) {\n        return {\n            name: item.name,\n            isVisible: item.isVisible,\n            opacity: item.opacity,\n            mixModeStr: item.mixModeStr,\n            image: item.image\n        };\n    });\n    else // flattened\n    result.layers = [\n        {\n            name: (0, $1mH1z.LANG)(\"background\"),\n            isVisible: true,\n            opacity: 1,\n            mixModeStr: \"source-over\",\n            image: klPsd.canvas\n        }\n    ];\n    return result;\n}\n\n});\n\nparcelRequire.register(\"9BlwZ\", function(module, exports) {\n\n$parcel$export(module.exports, \"setDbName\", function () { return $41164c8aeaf53227$export$1347f8be1f25c479; });\n$parcel$export(module.exports, \"getKlProjectObj\", function () { return $41164c8aeaf53227$export$1448a0dd0d3fde8e; });\n$parcel$export(module.exports, \"storeKlProjectObj\", function () { return $41164c8aeaf53227$export$21ade4eb935254aa; });\n$parcel$export(module.exports, \"clear\", function () { return $41164c8aeaf53227$export$42ffd38884aecdac; });\nvar $41164c8aeaf53227$var$indexedDbIsSupported = !!window.indexedDB;\nvar $41164c8aeaf53227$var$dbNameStr = \"Klecks\";\nvar $41164c8aeaf53227$var$storageNameStr = \"ProjectStore\";\nfunction $41164c8aeaf53227$export$1347f8be1f25c479(name) {\n    $41164c8aeaf53227$var$dbNameStr = \"\" + name;\n}\n/**\r\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\r\n * with index 'id'\r\n *\r\n * @param actionFunction what to execute during transaction\r\n * @param successCallback on successful transaction\r\n * @param errorCallback on error\r\n */ function $41164c8aeaf53227$var$execIndexedDBTransaction(actionFunction, successCallback, errorCallback) {\n    var onSuccess = function onSuccess() {\n        if (hasFinished) return;\n        hasFinished = true;\n        successCallback();\n    };\n    var onError = function onError(errorStr) {\n        if (hasFinished) return;\n        hasFinished = true;\n        errorCallback(errorStr);\n    };\n    var hasFinished = false;\n    if (!$41164c8aeaf53227$var$indexedDbIsSupported) {\n        setTimeout(function() {\n            onError(\"no indexed db available\");\n        }, 0);\n        return;\n    }\n    var requestObj;\n    try {\n        requestObj = window.indexedDB.open($41164c8aeaf53227$var$dbNameStr, 1);\n    } catch (e) {\n        onError(e.message);\n        return;\n    }\n    requestObj.onupgradeneeded = function() {\n        try {\n            var db = requestObj.result;\n            var store = db.createObjectStore($41164c8aeaf53227$var$storageNameStr, {\n                keyPath: \"id\"\n            });\n            store.createIndex(\"id\", \"id\", {\n                unique: true\n            });\n        } catch (e) {\n            onError(e.message);\n        }\n    };\n    requestObj.onerror = function() {\n        onError(\"indexedDB.open failed, \" + requestObj.error);\n    };\n    requestObj.onsuccess = function() {\n        var databaseObj;\n        var transactionObj;\n        var storeObj;\n        try {\n            databaseObj = requestObj.result;\n            if (!databaseObj.objectStoreNames.contains($41164c8aeaf53227$var$storageNameStr)) {\n                //someone maybe messed with the db, or creation failed earlier\n                //it's broken -> destroy\n                window.indexedDB.deleteDatabase($41164c8aeaf53227$var$dbNameStr);\n                onError(\"object store \" + $41164c8aeaf53227$var$storageNameStr + \" missing. destroying db\");\n                return;\n            }\n            transactionObj = databaseObj.transaction($41164c8aeaf53227$var$storageNameStr, \"readwrite\");\n            storeObj = transactionObj.objectStore($41164c8aeaf53227$var$storageNameStr);\n            storeObj.index(\"id\");\n        } catch (e) {\n            onError(e.message);\n            return;\n        }\n        databaseObj.onerror = function() {\n            onError(\"database error, \" + databaseObj.error);\n        };\n        try {\n            actionFunction(storeObj);\n        } catch (e) {\n            onError(e.message);\n            return;\n        }\n        transactionObj.oncomplete = function() {\n            onSuccess();\n            databaseObj.close();\n        };\n        transactionObj.onerror = function() {\n            onError(\"transaction error, \" + transactionObj.error);\n        };\n    };\n}\nfunction $41164c8aeaf53227$export$1448a0dd0d3fde8e(successCallback, errorCallback) {\n    if ($41164c8aeaf53227$var$indexedDbIsSupported) {\n        var query;\n        $41164c8aeaf53227$var$execIndexedDBTransaction(function(storeObj) {\n            query = storeObj.get(1);\n        }, function() {\n            successCallback(query.result);\n        }, function(errorStr) {\n            errorCallback(\"execIndexedDBTransaction error, \" + errorStr);\n        });\n    } else successCallback(undefined);\n}\nfunction $41164c8aeaf53227$export$21ade4eb935254aa(storageProject, successCallback, errorCallback) {\n    $41164c8aeaf53227$var$execIndexedDBTransaction(function(storeObj) {\n        storeObj.put(storageProject);\n    }, function() {\n        successCallback();\n    }, function(errorStr) {\n        errorCallback(errorStr);\n    });\n}\nfunction $41164c8aeaf53227$export$42ffd38884aecdac(successCallback, errorCallback) {\n    $41164c8aeaf53227$var$execIndexedDBTransaction(function(storeObj) {\n        storeObj.delete(1);\n    }, function() {\n        successCallback();\n    }, function(error) {\n        errorCallback(error);\n    });\n}\n\n});\n\nparcelRequire.register(\"kyVjY\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterLibStatus\", function () { return $805be15a1e91c0ee$export$7a4e0b62a5d854bc; });\n$parcel$export(module.exports, \"filterLib\", function () { return $805be15a1e91c0ee$export$395d33c8e06b92c9; });\n\nvar $fsSyS = parcelRequire(\"fsSyS\");\n\nvar $bBJjx = parcelRequire(\"bBJjx\");\n\nvar $fb1QA = parcelRequire(\"fb1QA\");\n\nvar $5XYnt = parcelRequire(\"5XYnt\");\n\nvar $hK7d4 = parcelRequire(\"hK7d4\");\n\nvar $bE89l = parcelRequire(\"bE89l\");\n\nvar $anXZw = parcelRequire(\"anXZw\");\n\nvar $gDMhw = parcelRequire(\"gDMhw\");\n\nvar $6Dvin = parcelRequire(\"6Dvin\");\n\nvar $bNSoq = parcelRequire(\"bNSoq\");\n\nvar $dkVDV = parcelRequire(\"dkVDV\");\n\nvar $6aHfw = parcelRequire(\"6aHfw\");\n\nvar $kLbWO = parcelRequire(\"kLbWO\");\n\nvar $bgekB = parcelRequire(\"bgekB\");\n\nvar $537C7 = parcelRequire(\"537C7\");\n\nvar $kHVZD = parcelRequire(\"kHVZD\");\n\nvar $bphza = parcelRequire(\"bphza\");\n\nvar $tP4I2 = parcelRequire(\"tP4I2\");\n\nvar $4w6gs = parcelRequire(\"4w6gs\");\nvar $805be15a1e91c0ee$export$7a4e0b62a5d854bc = {\n    isLoaded: false\n};\nvar $805be15a1e91c0ee$export$395d33c8e06b92c9 = {\n    brightnessContrast: {\n        lang: {\n            name: \"filter-bright-contrast-title\",\n            button: \"filter-bright-contrast\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($fsSyS))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true\n    },\n    cropExtend: {\n        lang: {\n            name: \"filter-crop-title\",\n            button: \"filter-crop-extend\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($bBJjx))),\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false\n    },\n    curves: {\n        lang: {\n            name: \"filter-curves-title\",\n            button: \"filter-curves\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($fb1QA))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true\n    },\n    distort: {\n        lang: {\n            name: \"filter-distort\",\n            button: \"filter-distort\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($4w6gs))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true\n    },\n    flip: {\n        lang: {\n            name: \"filter-flip-title\",\n            button: \"filter-flip\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($5XYnt))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true\n    },\n    hueSaturation: {\n        lang: {\n            name: \"filter-hue-sat-title\",\n            button: \"filter-hue-sat\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($hK7d4))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true\n    },\n    invert: {\n        lang: {\n            name: \"filter-invert\",\n            button: \"filter-invert\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($bE89l))),\n        updatePos: false,\n        isInstant: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true\n    },\n    perspective: {\n        lang: {\n            name: \"filter-perspective-title\",\n            button: \"filter-perspective\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($anXZw))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true\n    },\n    resize: {\n        lang: {\n            name: \"filter-resize-title\",\n            button: \"filter-resize\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($gDMhw))),\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false\n    },\n    rotate: {\n        lang: {\n            name: \"filter-rotate-title\",\n            button: \"filter-rotate\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($6Dvin))),\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false\n    },\n    tiltShift: {\n        lang: {\n            name: \"filter-tilt-shift-title\",\n            button: \"filter-tilt-shift\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($bNSoq))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true\n    },\n    toAlpha: {\n        lang: {\n            name: \"filter-to-alpha-title\",\n            button: \"filter-to-alpha\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($dkVDV))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true\n    },\n    transform: {\n        lang: {\n            name: \"filter-transform-title\",\n            button: \"filter-transform\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($6aHfw))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true\n    },\n    blur: {\n        lang: {\n            name: \"filter-triangle-blur-title\",\n            button: \"filter-triangle-blur\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($kLbWO))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true\n    },\n    unsharpMask: {\n        lang: {\n            name: \"filter-unsharp-mask-title\",\n            button: \"filter-unsharp-mask\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($bgekB))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true\n    },\n    grid: {\n        lang: {\n            name: \"filter-grid\",\n            button: \"filter-grid\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($537C7))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true\n    },\n    noise: {\n        lang: {\n            name: \"filter-noise\",\n            button: \"filter-noise\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($kHVZD))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true\n    },\n    pattern: {\n        lang: {\n            name: \"filter-pattern\",\n            button: \"filter-pattern\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($bphza))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true\n    },\n    vanishPoint: {\n        lang: {\n            name: \"filter-vanish-point-title\",\n            button: \"filter-vanish-point\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($tP4I2))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true\n    }\n};\n\n});\nparcelRequire.register(\"fsSyS\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"7tOPd\");\n\n});\n\nparcelRequire.register(\"bBJjx\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"fduLu\");\n\n});\n\nparcelRequire.register(\"fb1QA\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"ijSd4\");\n\n});\n\nparcelRequire.register(\"5XYnt\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"3lCpH\");\n\n});\n\nparcelRequire.register(\"hK7d4\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"hhylW\");\n\n});\n\nparcelRequire.register(\"bE89l\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"kV0ed\");\n\n});\n\nparcelRequire.register(\"anXZw\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"dNk9L\");\n\n});\n\nparcelRequire.register(\"gDMhw\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"aj5Gc\");\n\n});\n\nparcelRequire.register(\"bNSoq\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"6D2tK\");\n\n});\n\nparcelRequire.register(\"dkVDV\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"7nesm\");\n\n});\n\nparcelRequire.register(\"6aHfw\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"leHUT\");\n\n});\n\nparcelRequire.register(\"kLbWO\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"3lP2j\");\n\n});\n\nparcelRequire.register(\"bgekB\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"7G4sY\");\n\n});\n\nparcelRequire.register(\"537C7\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"7n1Rt\");\n\n});\n\nparcelRequire.register(\"kHVZD\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"ijwf0\");\n\n});\n\nparcelRequire.register(\"bphza\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"18gIG\");\n\n});\n\nparcelRequire.register(\"tP4I2\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"786LQ\");\n\n});\n\nparcelRequire.register(\"4w6gs\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"kcnOE\");\n\n});\n\n\nparcelRequire.register(\"dAXbp\", function(module, exports) {\n\n$parcel$export(module.exports, \"brushes\", function () { return $42ac5b30ad65dabb$export$7d68cd8857639377; });\n\nvar $68QTJ = parcelRequire(\"68QTJ\");\n\nvar $5PSXS = parcelRequire(\"5PSXS\");\n\nvar $ewgr9 = parcelRequire(\"ewgr9\");\n\nvar $kic4a = parcelRequire(\"kic4a\");\n\nvar $7cUpm = parcelRequire(\"7cUpm\");\n\nvar $ltaBP = parcelRequire(\"ltaBP\");\n\nvar $6Nq1H = parcelRequire(\"6Nq1H\");\nvar $42ac5b30ad65dabb$export$7d68cd8857639377 = {\n    PenBrush: (0, $68QTJ.PenBrush),\n    BlendBrush: (0, $5PSXS.BlendBrush),\n    SketchyBrush: (0, $ewgr9.SketchyBrush),\n    PixelBrush: (0, $kic4a.PixelBrush),\n    ChemyBrush: (0, $6Nq1H.ChemyBrush),\n    SmudgeBrush: (0, $ltaBP.SmudgeBrush),\n    EraserBrush: (0, $7cUpm.EraserBrush)\n};\n\n});\nparcelRequire.register(\"68QTJ\", function(module, exports) {\n\n$parcel$export(module.exports, \"PenBrush\", function () { return $3f0923cd3c55ea92$export$6f96c8f9e6ae7341; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $5CF7D = parcelRequire(\"5CF7D\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\nvar $3f0923cd3c55ea92$var$ALPHA_CIRCLE = 0;\nvar $3f0923cd3c55ea92$var$ALPHA_CHALK = 1;\nvar $3f0923cd3c55ea92$var$ALPHA_CAL = 2; // calligraphy\nvar $3f0923cd3c55ea92$var$ALPHA_SQUARE = 3;\nvar $3f0923cd3c55ea92$var$TWO_PI = 2 * Math.PI;\nvar $3f0923cd3c55ea92$export$6f96c8f9e6ae7341 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function PenBrush() {\n        (0, $cx0mh._)(this, PenBrush);\n        this.context = {};\n        this.history = new (0, $hrnUX.KL).DecoyKlHistory();\n        this.settingHasOpacityPressure = false;\n        this.settingHasSizePressure = true;\n        this.settingSize = 2;\n        this.settingSpacing = 0.8489;\n        this.settingOpacity = 1;\n        this.settingColor = {};\n        this.settingColorStr = \"\";\n        this.settingAlphaId = $3f0923cd3c55ea92$var$ALPHA_CIRCLE;\n        this.settingLockLayerAlpha = false;\n        this.hasDrawnDot = false;\n        this.lineToolLastDot = 0;\n        this.lastInput = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.lastInput2 = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.inputArr = [];\n        this.inputIsDrawing = false;\n        this.bezierLine = null;\n        // mipmapping\n        this.alphaCanvas128 = (0, $eWjiX.BB).canvas(128, 128);\n        this.alphaCanvas64 = (0, $eWjiX.BB).canvas(64, 64);\n        this.alphaCanvas32 = (0, $eWjiX.BB).canvas(32, 32);\n        this.alphaOpacityArr = [\n            1,\n            0.9,\n            1,\n            1\n        ];\n    }\n    (0, $7h4XF._)(PenBrush, [\n        {\n            key: \"updateAlphaCanvas\",\n            value: function updateAlphaCanvas() {\n                if (this.settingAlphaId === $3f0923cd3c55ea92$var$ALPHA_CIRCLE || this.settingAlphaId === $3f0923cd3c55ea92$var$ALPHA_SQUARE) return;\n                var instructionArr = [\n                    [\n                        this.alphaCanvas128,\n                        128\n                    ],\n                    [\n                        this.alphaCanvas64,\n                        64\n                    ],\n                    [\n                        this.alphaCanvas32,\n                        32\n                    ]\n                ];\n                var ctx;\n                for(var i = 0; i < instructionArr.length; i++){\n                    ctx = (0, $eWjiX.BB).ctx(instructionArr[i][0]);\n                    ctx.save();\n                    ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n                    ctx.fillStyle = \"rgba(\" + this.settingColor.r + \", \" + this.settingColor.g + \", \" + this.settingColor.b + \", \" + this.alphaOpacityArr[this.settingAlphaId] + \")\";\n                    ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n                    ctx.globalCompositeOperation = \"destination-in\";\n                    ctx.imageSmoothingQuality = \"high\";\n                    ctx.drawImage((0, $5CF7D.alphaImArr)[this.settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\n                    ctx.restore();\n                }\n            }\n        },\n        {\n            key: \"calcOpacity\",\n            value: function calcOpacity(pressure) {\n                return this.settingOpacity * (this.settingHasOpacityPressure ? pressure * pressure : 1);\n            }\n        },\n        {\n            key: \"drawDot\",\n            value: /**\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     * @param angle\r\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\r\n     */ function drawDot(x, y, size, opacity, angle, before) {\n                if (size <= 0) return;\n                if (this.settingLockLayerAlpha) this.context.globalCompositeOperation = \"source-atop\";\n                if (!before || before[3] !== opacity) this.context.globalAlpha = opacity;\n                if (!before && (this.settingAlphaId === $3f0923cd3c55ea92$var$ALPHA_CIRCLE || this.settingAlphaId === $3f0923cd3c55ea92$var$ALPHA_SQUARE)) this.context.fillStyle = this.settingColorStr;\n                if (this.settingAlphaId === $3f0923cd3c55ea92$var$ALPHA_CIRCLE) {\n                    this.context.beginPath();\n                    this.context.arc(x, y, size, 0, $3f0923cd3c55ea92$var$TWO_PI);\n                    this.context.closePath();\n                    this.context.fill();\n                    this.hasDrawnDot = true;\n                } else if (this.settingAlphaId === $3f0923cd3c55ea92$var$ALPHA_SQUARE) {\n                    if (angle !== undefined) {\n                        this.context.save();\n                        this.context.translate(x, y);\n                        this.context.rotate(angle / 180 * Math.PI);\n                        this.context.fillRect(-size, -size, size * 2, size * 2);\n                        this.context.restore();\n                        this.hasDrawnDot = true;\n                    }\n                } else {\n                    this.context.save();\n                    this.context.translate(x, y);\n                    var targetMipmap = this.alphaCanvas128;\n                    if (size <= 32 && size > 16) targetMipmap = this.alphaCanvas64;\n                    else if (size <= 16) targetMipmap = this.alphaCanvas32;\n                    this.context.scale(size, size);\n                    if (this.settingAlphaId === $3f0923cd3c55ea92$var$ALPHA_CHALK) this.context.rotate((x + y) * 53123 % $3f0923cd3c55ea92$var$TWO_PI); // without mod it sometimes looks different\n                    this.context.drawImage(targetMipmap, -1, -1, 2, 2);\n                    this.context.restore();\n                    this.hasDrawnDot = true;\n                }\n            }\n        },\n        {\n            key: \"continueLine\",\n            value: // continueLine\n            function continueLine(x, y, size, pressure) {\n                var _this = this;\n                if (this.bezierLine === null) {\n                    this.bezierLine = new (0, $eWjiX.BB).BezierLine();\n                    this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function() {});\n                }\n                var drawArr = []; //draw instructions. will be all drawn at once\n                var dotCallback = function(val) {\n                    var localPressure = (0, $eWjiX.BB).mix(_this.lastInput2.pressure, pressure, val.t);\n                    var localOpacity = _this.calcOpacity(localPressure);\n                    var localSize = Math.max(0.1, _this.settingSize * (_this.settingHasSizePressure ? localPressure : 1));\n                    drawArr.push([\n                        val.x,\n                        val.y,\n                        localSize,\n                        localOpacity,\n                        val.angle\n                    ]);\n                };\n                var localSpacing = size * this.settingSpacing;\n                if (x === null || y === null) this.bezierLine.addFinal(localSpacing, dotCallback);\n                else this.bezierLine.add(x, y, localSpacing, dotCallback);\n                // execute draw instructions\n                this.context.save();\n                var before = undefined;\n                for(var i = 0; i < drawArr.length; i++){\n                    var item = drawArr[i];\n                    this.drawDot(item[0], item[1], item[2], item[3], item[4], before);\n                    before = item;\n                }\n                this.context.restore();\n            }\n        },\n        {\n            // ---- interface ----\n            key: \"startLine\",\n            value: function startLine(x, y, p) {\n                this.historyEntry = {\n                    tool: [\n                        \"brush\",\n                        \"PenBrush\"\n                    ],\n                    actions: [\n                        {\n                            action: \"opacityPressure\",\n                            params: [\n                                this.settingHasOpacityPressure\n                            ]\n                        },\n                        {\n                            action: \"sizePressure\",\n                            params: [\n                                this.settingHasSizePressure\n                            ]\n                        },\n                        {\n                            action: \"setSize\",\n                            params: [\n                                this.settingSize\n                            ]\n                        },\n                        {\n                            action: \"setSpacing\",\n                            params: [\n                                this.settingSpacing\n                            ]\n                        },\n                        {\n                            action: \"setOpacity\",\n                            params: [\n                                this.settingOpacity\n                            ]\n                        },\n                        {\n                            action: \"setColor\",\n                            params: [\n                                this.settingColor\n                            ]\n                        },\n                        {\n                            action: \"setAlpha\",\n                            params: [\n                                this.settingAlphaId\n                            ]\n                        },\n                        {\n                            action: \"setLockAlpha\",\n                            params: [\n                                this.settingLockLayerAlpha\n                            ]\n                        }\n                    ]\n                };\n                p = (0, $eWjiX.BB).clamp(p, 0, 1);\n                var localOpacity = this.calcOpacity(p);\n                var localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\n                this.hasDrawnDot = false;\n                this.inputIsDrawing = true;\n                this.context.save();\n                this.drawDot(x, y, localSize, localOpacity);\n                this.context.restore();\n                this.lineToolLastDot = localSize * this.settingSpacing;\n                this.lastInput.x = x;\n                this.lastInput.y = y;\n                this.lastInput.pressure = p;\n                this.lastInput2.pressure = p;\n                this.inputArr = [\n                    {\n                        x: x,\n                        y: y,\n                        pressure: p\n                    }\n                ];\n                this.historyEntry.actions.push({\n                    action: \"startLine\",\n                    params: [\n                        x,\n                        y,\n                        p\n                    ]\n                });\n            }\n        },\n        {\n            key: \"goLine\",\n            value: function goLine(x, y, p) {\n                if (!this.inputIsDrawing) return;\n                this.historyEntry.actions.push({\n                    action: \"goLine\",\n                    params: [\n                        x,\n                        y,\n                        p\n                    ]\n                });\n                var pressure = (0, $eWjiX.BB).clamp(p, 0, 1);\n                var localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n                this.context.save();\n                this.continueLine(x, y, localSize, this.lastInput.pressure);\n                /*context.fillStyle = 'red';\r\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\r\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/ this.context.restore();\n                this.lastInput.x = x;\n                this.lastInput.y = y;\n                this.lastInput2.pressure = this.lastInput.pressure;\n                this.lastInput.pressure = pressure;\n                this.inputArr.push({\n                    x: x,\n                    y: y,\n                    pressure: p\n                });\n            }\n        },\n        {\n            key: \"endLine\",\n            value: function endLine(x, y) {\n                var localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n                this.context.save();\n                this.continueLine(null, null, localSize, this.lastInput.pressure);\n                this.context.restore();\n                this.inputIsDrawing = false;\n                if (this.settingAlphaId === $3f0923cd3c55ea92$var$ALPHA_SQUARE && !this.hasDrawnDot) {\n                    // find max pressure input, use that one\n                    var maxInput = this.inputArr[0];\n                    this.inputArr.forEach(function(item) {\n                        if (item.pressure > maxInput.pressure) maxInput = item;\n                    });\n                    this.context.save();\n                    var p = (0, $eWjiX.BB).clamp(maxInput.pressure, 0, 1);\n                    var localOpacity = this.calcOpacity(p);\n                    this.drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\n                    this.context.restore();\n                }\n                this.bezierLine = null;\n                if (this.historyEntry) {\n                    this.historyEntry.actions.push({\n                        action: \"endLine\",\n                        params: [\n                            x,\n                            y\n                        ]\n                    });\n                    this.history.push(this.historyEntry);\n                    this.historyEntry = undefined;\n                }\n                this.hasDrawnDot = false;\n                this.inputArr = [];\n            }\n        },\n        {\n            key: \"drawLineSegment\",\n            value: function drawLineSegment(x1, y1, x2, y2) {\n                this.lastInput.x = x2;\n                this.lastInput.y = y2;\n                this.lastInput.pressure = 1;\n                if (this.inputIsDrawing || x1 === undefined) return;\n                var angle = (0, $eWjiX.BB).pointsToAngleDeg({\n                    x: x1,\n                    y: y1\n                }, {\n                    x: x2,\n                    y: y2\n                });\n                var mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n                var eX = (x2 - x1) / mouseDist;\n                var eY = (y2 - y1) / mouseDist;\n                var loopDist;\n                var bdist = this.settingSize * this.settingSpacing;\n                this.lineToolLastDot = this.settingSize * this.settingSpacing;\n                this.context.save();\n                for(loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist)this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity, angle);\n                this.context.restore();\n                var historyEntry = {\n                    tool: [\n                        \"brush\",\n                        \"PenBrush\"\n                    ],\n                    actions: [\n                        {\n                            action: \"opacityPressure\",\n                            params: [\n                                this.settingHasOpacityPressure\n                            ]\n                        },\n                        {\n                            action: \"sizePressure\",\n                            params: [\n                                this.settingHasSizePressure\n                            ]\n                        },\n                        {\n                            action: \"setSize\",\n                            params: [\n                                this.settingSize\n                            ]\n                        },\n                        {\n                            action: \"setSpacing\",\n                            params: [\n                                this.settingSpacing\n                            ]\n                        },\n                        {\n                            action: \"setOpacity\",\n                            params: [\n                                this.settingOpacity\n                            ]\n                        },\n                        {\n                            action: \"setColor\",\n                            params: [\n                                this.settingColor\n                            ]\n                        },\n                        {\n                            action: \"setAlpha\",\n                            params: [\n                                this.settingAlphaId\n                            ]\n                        },\n                        {\n                            action: \"setLockAlpha\",\n                            params: [\n                                this.settingLockLayerAlpha\n                            ]\n                        },\n                        {\n                            action: \"drawLineSegment\",\n                            params: [\n                                x1,\n                                y1,\n                                x2,\n                                y2\n                            ]\n                        }\n                    ]\n                };\n                this.history.push(historyEntry);\n            }\n        },\n        {\n            //IS\n            key: \"isDrawing\",\n            value: function isDrawing() {\n                return this.inputIsDrawing;\n            }\n        },\n        {\n            //SET\n            key: \"setAlpha\",\n            value: function setAlpha(a) {\n                if (this.settingAlphaId === a) return;\n                this.settingAlphaId = a;\n                this.updateAlphaCanvas();\n            }\n        },\n        {\n            key: \"setColor\",\n            value: function setColor(c) {\n                if (this.settingColor === c) return;\n                this.settingColor = {\n                    r: c.r,\n                    g: c.g,\n                    b: c.b\n                };\n                this.settingColorStr = \"rgb(\" + this.settingColor.r + \",\" + this.settingColor.g + \",\" + this.settingColor.b + \")\";\n                this.updateAlphaCanvas();\n            }\n        },\n        {\n            key: \"setContext\",\n            value: function setContext(c) {\n                this.context = c;\n            }\n        },\n        {\n            key: \"setHistory\",\n            value: function setHistory(l) {\n                this.history = l;\n            }\n        },\n        {\n            key: \"setSize\",\n            value: function setSize(s) {\n                this.settingSize = s;\n            }\n        },\n        {\n            key: \"setOpacity\",\n            value: function setOpacity(o) {\n                this.settingOpacity = o;\n            }\n        },\n        {\n            key: \"setSpacing\",\n            value: function setSpacing(s) {\n                this.settingSpacing = s;\n            }\n        },\n        {\n            key: \"sizePressure\",\n            value: function sizePressure(b) {\n                this.settingHasSizePressure = b;\n            }\n        },\n        {\n            key: \"opacityPressure\",\n            value: function opacityPressure(b) {\n                this.settingHasOpacityPressure = b;\n            }\n        },\n        {\n            key: \"setLockAlpha\",\n            value: function setLockAlpha(b) {\n                this.settingLockLayerAlpha = b;\n            }\n        },\n        {\n            //GET\n            key: \"getSpacing\",\n            value: function getSpacing() {\n                return this.settingSpacing;\n            }\n        },\n        {\n            key: \"getSize\",\n            value: function getSize() {\n                return this.settingSize;\n            }\n        },\n        {\n            key: \"getOpacity\",\n            value: function getOpacity() {\n                return this.settingOpacity;\n            }\n        },\n        {\n            key: \"getLockAlpha\",\n            value: function getLockAlpha() {\n                return this.settingLockLayerAlpha;\n            }\n        }\n    ]);\n    return PenBrush;\n}();\n\n});\nparcelRequire.register(\"5CF7D\", function(module, exports) {\n\n$parcel$export(module.exports, \"alphaImArr\", function () { return $ff6c1f784f50f5d5$export$d116ae91f77f1f19; });\n\nvar $74D3O = parcelRequire(\"74D3O\");\nvar $ff6c1f784f50f5d5$export$d116ae91f77f1f19 = []; //used by default brush\n$ff6c1f784f50f5d5$export$d116ae91f77f1f19[1] = (0, $74D3O.genBrushAlpha01)(128);\n$ff6c1f784f50f5d5$export$d116ae91f77f1f19[2] = (0, $74D3O.genBrushAlpha02)(128);\n\n});\nparcelRequire.register(\"74D3O\", function(module, exports) {\n\n$parcel$export(module.exports, \"genBrushAlpha01\", function () { return $f875015ce1aeb4d3$export$74a44bbc21d06a28; });\n$parcel$export(module.exports, \"genBrushAlpha02\", function () { return $f875015ce1aeb4d3$export$eaa218d5d17c8f1c; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $gZSR2 = parcelRequire(\"gZSR2\");\nfunction $f875015ce1aeb4d3$export$74a44bbc21d06a28(w) {\n    var scaleFac = w / 500;\n    var h = w;\n    var canvas = (0, $eWjiX.BB).canvas(w, h);\n    var ctx = (0, $eWjiX.BB).ctx(canvas);\n    var imData = ctx.createImageData(w, h);\n    for(var x = 0; x < w; x++)for(var y = 0; y < h; y++){\n        var i = (y * w + x) * 4;\n        // base noise\n        var sFac2 = scaleFac + (0, $gZSR2.noise).simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\n        var noisePattern = 100 + ((0, $gZSR2.noise).simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\n        noisePattern -= ((0, $gZSR2.noise).simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\n        // fade out in circular shape\n        var centerDist = (0, $eWjiX.BB).dist(w / 2, h / 2, x, y);\n        var falloff = (0, $eWjiX.BB).clamp(1 - ((centerDist - w / 2.5) / (w / 14) + (0, $gZSR2.noise).simplex2(x / 22 / sFac2, y / 22 / sFac2)), 0, 1);\n        noisePattern = noisePattern * falloff;\n        // make the middle darker\n        var falloff2 = (0, $eWjiX.BB).clamp(1 - centerDist / w, 0, 1) * 2;\n        noisePattern = noisePattern * falloff2;\n        imData.data[i] = 0;\n        imData.data[i + 1] = 0;\n        imData.data[i + 2] = 0;\n        imData.data[i + 3] = (0, $eWjiX.BB).clamp(noisePattern, 0, 255);\n    }\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}\n// https://www.shadertoy.com/view/3tdSDj\nfunction $f875015ce1aeb4d3$var$udSegment(p, a, b) {\n    var ba = (0, $eWjiX.BB).Vec2.sub(b, a);\n    var pa = (0, $eWjiX.BB).Vec2.sub(p, a);\n    var h = (0, $eWjiX.BB).clamp((0, $eWjiX.BB).Vec2.dot(pa, ba) / (0, $eWjiX.BB).Vec2.dot(ba, ba), 0.0, 1.0);\n    return (0, $eWjiX.BB).Vec2.len((0, $eWjiX.BB).Vec2.sub(pa, (0, $eWjiX.BB).Vec2.mul(ba, h)));\n}\nfunction $f875015ce1aeb4d3$export$eaa218d5d17c8f1c(w) {\n    var pDist = 1 / 4;\n    var centerSize = 2 / 3;\n    var transitionSize = 1 / 3;\n    centerSize *= pDist;\n    transitionSize *= pDist;\n    var p1 = {\n        x: pDist * w,\n        y: w - w * pDist\n    };\n    var p2 = {\n        x: w - w * pDist,\n        y: pDist * w\n    };\n    var h = w;\n    var canvas = (0, $eWjiX.BB).canvas(w, h);\n    var ctx = (0, $eWjiX.BB).ctx(canvas);\n    var imData = ctx.createImageData(w, h);\n    for(var x = 0; x < w; x++)for(var y = 0; y < h; y++){\n        var i = (y * w + x) * 4;\n        var col = $f875015ce1aeb4d3$var$udSegment({\n            x: x,\n            y: y\n        }, p1, p2);\n        col = (0, $eWjiX.BB).clamp(255 - (col - w * centerSize) / (w * transitionSize) * 255, 0, 255);\n        imData.data[i] = 0;\n        imData.data[i + 1] = 0;\n        imData.data[i + 2] = 0;\n        imData.data[i + 3] = col;\n    }\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}\n\n});\nparcelRequire.register(\"gZSR2\", function(module, exports) {\n\n$parcel$export(module.exports, \"noise\", function () { return $dfc47a34ad9bc378$export$d3022aad56692482; });\n/*\r\n * A speed-improved perlin and simplex noise algorithms for 2D.\r\n *\r\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\n * Better rank ordering method by Stefan Gustavson in 2012.\r\n * Converted to Javascript by Joseph Gentle.\r\n *\r\n * Version 2012-03-09\r\n *\r\n * This code was placed in the public domain by its original author,\r\n * Stefan Gustavson. You may use it as you see fit, but\r\n * attribution is appreciated.\r\n *\r\n */ \nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\nvar $dfc47a34ad9bc378$var$myModule = {};\nvar $dfc47a34ad9bc378$var$Grad = /*#__PURE__*/ function() {\n    \"use strict\";\n    function Grad(x, y, z) {\n        (0, $cx0mh._)(this, Grad);\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n    (0, $7h4XF._)(Grad, [\n        {\n            key: \"dot2\",\n            value: function dot2(x, y) {\n                return this.x * x + this.y * y;\n            }\n        }\n    ]);\n    return Grad;\n}();\n/*\r\nGrad.prototype.dot3 = function(x, y, z) {\r\n    return this.x*x + this.y*y + this.z*z;\r\n};*/ var $dfc47a34ad9bc378$var$grad3 = [\n    new $dfc47a34ad9bc378$var$Grad(1, 1, 0),\n    new $dfc47a34ad9bc378$var$Grad(-1, 1, 0),\n    new $dfc47a34ad9bc378$var$Grad(1, -1, 0),\n    new $dfc47a34ad9bc378$var$Grad(-1, -1, 0),\n    new $dfc47a34ad9bc378$var$Grad(1, 0, 1),\n    new $dfc47a34ad9bc378$var$Grad(-1, 0, 1),\n    new $dfc47a34ad9bc378$var$Grad(1, 0, -1),\n    new $dfc47a34ad9bc378$var$Grad(-1, 0, -1),\n    new $dfc47a34ad9bc378$var$Grad(0, 1, 1),\n    new $dfc47a34ad9bc378$var$Grad(0, -1, 1),\n    new $dfc47a34ad9bc378$var$Grad(0, 1, -1),\n    new $dfc47a34ad9bc378$var$Grad(0, -1, -1)\n];\nvar $dfc47a34ad9bc378$var$p = [\n    151,\n    160,\n    137,\n    91,\n    90,\n    15,\n    131,\n    13,\n    201,\n    95,\n    96,\n    53,\n    194,\n    233,\n    7,\n    225,\n    140,\n    36,\n    103,\n    30,\n    69,\n    142,\n    8,\n    99,\n    37,\n    240,\n    21,\n    10,\n    23,\n    190,\n    6,\n    148,\n    247,\n    120,\n    234,\n    75,\n    0,\n    26,\n    197,\n    62,\n    94,\n    252,\n    219,\n    203,\n    117,\n    35,\n    11,\n    32,\n    57,\n    177,\n    33,\n    88,\n    237,\n    149,\n    56,\n    87,\n    174,\n    20,\n    125,\n    136,\n    171,\n    168,\n    68,\n    175,\n    74,\n    165,\n    71,\n    134,\n    139,\n    48,\n    27,\n    166,\n    77,\n    146,\n    158,\n    231,\n    83,\n    111,\n    229,\n    122,\n    60,\n    211,\n    133,\n    230,\n    220,\n    105,\n    92,\n    41,\n    55,\n    46,\n    245,\n    40,\n    244,\n    102,\n    143,\n    54,\n    65,\n    25,\n    63,\n    161,\n    1,\n    216,\n    80,\n    73,\n    209,\n    76,\n    132,\n    187,\n    208,\n    89,\n    18,\n    169,\n    200,\n    196,\n    135,\n    130,\n    116,\n    188,\n    159,\n    86,\n    164,\n    100,\n    109,\n    198,\n    173,\n    186,\n    3,\n    64,\n    52,\n    217,\n    226,\n    250,\n    124,\n    123,\n    5,\n    202,\n    38,\n    147,\n    118,\n    126,\n    255,\n    82,\n    85,\n    212,\n    207,\n    206,\n    59,\n    227,\n    47,\n    16,\n    58,\n    17,\n    182,\n    189,\n    28,\n    42,\n    223,\n    183,\n    170,\n    213,\n    119,\n    248,\n    152,\n    2,\n    44,\n    154,\n    163,\n    70,\n    221,\n    153,\n    101,\n    155,\n    167,\n    43,\n    172,\n    9,\n    129,\n    22,\n    39,\n    253,\n    19,\n    98,\n    108,\n    110,\n    79,\n    113,\n    224,\n    232,\n    178,\n    185,\n    112,\n    104,\n    218,\n    246,\n    97,\n    228,\n    251,\n    34,\n    242,\n    193,\n    238,\n    210,\n    144,\n    12,\n    191,\n    179,\n    162,\n    241,\n    81,\n    51,\n    145,\n    235,\n    249,\n    14,\n    239,\n    107,\n    49,\n    192,\n    214,\n    31,\n    181,\n    199,\n    106,\n    157,\n    184,\n    84,\n    204,\n    176,\n    115,\n    121,\n    50,\n    45,\n    127,\n    4,\n    150,\n    254,\n    138,\n    236,\n    205,\n    93,\n    222,\n    114,\n    67,\n    29,\n    24,\n    72,\n    243,\n    141,\n    128,\n    195,\n    78,\n    66,\n    215,\n    61,\n    156,\n    180\n];\n// To remove the need for index wrapping, double the permutation table length\nvar $dfc47a34ad9bc378$var$perm = new Array(512);\nvar $dfc47a34ad9bc378$var$gradP = new Array(512);\n// This isn't a very good seeding function, but it works ok. It supports 2^16\n// different seed values. Write something better if you need more seeds.\n$dfc47a34ad9bc378$var$myModule.seed = function(seed) {\n    if (seed > 0 && seed < 1) // Scale the seed out\n    seed *= 65536;\n    seed = Math.floor(seed);\n    if (seed < 256) seed |= seed << 8;\n    for(var i = 0; i < 256; i++){\n        var v = void 0;\n        if (i & 1) v = $dfc47a34ad9bc378$var$p[i] ^ seed & 255;\n        else v = $dfc47a34ad9bc378$var$p[i] ^ seed >> 8 & 255;\n        $dfc47a34ad9bc378$var$perm[i] = $dfc47a34ad9bc378$var$perm[i + 256] = v;\n        $dfc47a34ad9bc378$var$gradP[i] = $dfc47a34ad9bc378$var$gradP[i + 256] = $dfc47a34ad9bc378$var$grad3[v % 12];\n    }\n};\n$dfc47a34ad9bc378$var$myModule.seed(0);\n/*\r\nfor (let i=0; i<256; i++) {\r\n  perm[i] = perm[i + 256] = p[i];\r\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\r\n}*/ // Skewing and unskewing factors for 2, 3, and 4 dimensions\nvar $dfc47a34ad9bc378$var$F2 = 0.5 * (Math.sqrt(3) - 1);\nvar $dfc47a34ad9bc378$var$G2 = (3 - Math.sqrt(3)) / 6;\n/*let F3 = 1/3;\r\nlet G3 = 1/6;*/ // 2D simplex noise\n$dfc47a34ad9bc378$var$myModule.simplex2 = function(xin, yin) {\n    var n0, n1, n2; // Noise contributions from the three corners\n    // Skew the input space to determine which simplex cell we're in\n    var s = (xin + yin) * $dfc47a34ad9bc378$var$F2; // Hairy factor for 2D\n    var i = Math.floor(xin + s);\n    var j = Math.floor(yin + s);\n    var t = (i + j) * $dfc47a34ad9bc378$var$G2;\n    var x0 = xin - i + t; // The x,y distances from the cell origin, unskewed.\n    var y0 = yin - j + t;\n    // For the 2D case, the simplex shape is an equilateral triangle.\n    // Determine which simplex we are in.\n    var i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n    if (x0 > y0) {\n        i1 = 1;\n        j1 = 0;\n    } else {\n        i1 = 0;\n        j1 = 1;\n    }\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n    // c = (3-sqrt(3))/6\n    var x1 = x0 - i1 + $dfc47a34ad9bc378$var$G2; // Offsets for middle corner in (x,y) unskewed coords\n    var y1 = y0 - j1 + $dfc47a34ad9bc378$var$G2;\n    var x2 = x0 - 1 + 2 * $dfc47a34ad9bc378$var$G2; // Offsets for last corner in (x,y) unskewed coords\n    var y2 = y0 - 1 + 2 * $dfc47a34ad9bc378$var$G2;\n    // Work out the hashed gradient indices of the three simplex corners\n    i &= 255;\n    j &= 255;\n    var gi0 = $dfc47a34ad9bc378$var$gradP[i + $dfc47a34ad9bc378$var$perm[j]];\n    var gi1 = $dfc47a34ad9bc378$var$gradP[i + i1 + $dfc47a34ad9bc378$var$perm[j + j1]];\n    var gi2 = $dfc47a34ad9bc378$var$gradP[i + 1 + $dfc47a34ad9bc378$var$perm[j + 1]];\n    // Calculate the contribution from the three corners\n    var t0 = 0.5 - x0 * x0 - y0 * y0;\n    if (t0 < 0) n0 = 0;\n    else {\n        t0 *= t0;\n        n0 = t0 * t0 * gi0.dot2(x0, y0); // (x,y) of grad3 used for 2D gradient\n    }\n    var t1 = 0.5 - x1 * x1 - y1 * y1;\n    if (t1 < 0) n1 = 0;\n    else {\n        t1 *= t1;\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\n    }\n    var t2 = 0.5 - x2 * x2 - y2 * y2;\n    if (t2 < 0) n2 = 0;\n    else {\n        t2 *= t2;\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 70 * (n0 + n1 + n2);\n};\nvar $dfc47a34ad9bc378$export$d3022aad56692482 = $dfc47a34ad9bc378$var$myModule;\n\n});\n\n\n\n\nparcelRequire.register(\"5PSXS\", function(module, exports) {\n\n$parcel$export(module.exports, \"BlendBrush\", function () { return $02d77b8dd5755328$export$9659db8d01dd5313; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $eg83P = parcelRequire(\"eg83P\");\nvar $02d77b8dd5755328$var$cellSize = 256;\nvar $02d77b8dd5755328$export$9659db8d01dd5313 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function BlendBrush() {\n        (0, $cx0mh._)(this, BlendBrush);\n        this.isTesting = false // testing mode - context only gets updated when line is finished\n        ;\n        this.context = {};\n        this.color = {};\n        this.size = 29 // radius - 0.5 - 99999\n        ;\n        this.opacity = 0.6 // 0-1\n        ;\n        this.blending = 0.65 // 0-1\n        ;\n        this.settingLockLayerAlpha = false;\n        this.settingSizePressure = true;\n        this.settingOpacityPressure = false;\n        this.blendCol = {\n            r: 0,\n            g: 0,\n            b: 0,\n            a: 1\n        } // todo docs\n        ;\n        this.blendMix = 0.45 // todo docs\n        ;\n        this.mixCol = {\n            r: 0,\n            g: 0,\n            b: 0\n        } // todo docs\n        ;\n        this.localColOld = {} // todo docs\n        ;\n        this.isDrawing = false;\n        this.lastInput = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        } // todo docs\n        ;\n        this.lastInput2 = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        } // todo docs\n        ;\n        this.cells = [];\n        this.drawBuffer = [];\n    }\n    (0, $7h4XF._)(BlendBrush, [\n        {\n            key: \"updateRedrawBounds\",\n            value: function updateRedrawBounds(bounds) {\n                this.redrawBounds = (0, $eWjiX.BB).updateBounds(this.redrawBounds, bounds);\n            }\n        },\n        {\n            key: \"getCellsWidth\",\n            value: function getCellsWidth() {\n                return Math.ceil(this.context.canvas.width / $02d77b8dd5755328$var$cellSize);\n            }\n        },\n        {\n            key: \"drawChangedCells\",\n            value: /**\r\n     * draw changed cells (changed by brushstroke) onto context\r\n     * @private\r\n     */ function drawChangedCells() {\n                var _this = this;\n                if (!this.redrawBounds) return;\n                var cells = this.cells.map(function() {\n                    return undefined;\n                });\n                var touchedCells = this.getTouchedCells(this.redrawBounds);\n                touchedCells.forEach(function(isTouched, index) {\n                    if (isTouched) cells[index] = _this.cells[index];\n                });\n                this.drawCells(cells);\n                this.redrawBounds = undefined;\n            }\n        },\n        {\n            key: \"getTouchedCells\",\n            value: function getTouchedCells(bounds) {\n                var touchedCells = this.cells.map(function() {\n                    return false;\n                });\n                var cellsW = this.getCellsWidth();\n                bounds = {\n                    x1: Math.floor(bounds.x1 / $02d77b8dd5755328$var$cellSize),\n                    y1: Math.floor(bounds.y1 / $02d77b8dd5755328$var$cellSize),\n                    x2: Math.floor(bounds.x2 / $02d77b8dd5755328$var$cellSize),\n                    y2: Math.floor(bounds.y2 / $02d77b8dd5755328$var$cellSize)\n                };\n                for(var i = bounds.x1; i <= bounds.x2; i++)for(var e = bounds.y1; e <= bounds.y2; e++)touchedCells[e * cellsW + i] = true;\n                return touchedCells;\n            }\n        },\n        {\n            key: \"sliceBounds\",\n            value: /**\r\n     * Slice up bounds according to cells\r\n     * @param bounds\r\n     * @private\r\n     */ function sliceBounds(bounds) {\n                var _this = this;\n                var cellsW = this.getCellsWidth();\n                var result = [];\n                var touchedCells = this.getTouchedCells(bounds);\n                touchedCells.forEach(function(cell, i) {\n                    if (!cell) return;\n                    var cellOffsetX = i % cellsW * $02d77b8dd5755328$var$cellSize;\n                    var cellOffsetY = Math.floor(i / cellsW) * $02d77b8dd5755328$var$cellSize;\n                    var cellWidth = _this.cells[i].width;\n                    var cellHeight = _this.cells[i].height;\n                    var inCellBounds = {\n                        x1: Math.max(0, bounds.x1 - cellOffsetX),\n                        y1: Math.max(0, bounds.y1 - cellOffsetY),\n                        x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\n                        y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY)\n                    };\n                    if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) return;\n                    result.push({\n                        index: i,\n                        bounds: inCellBounds\n                    });\n                });\n                return result;\n            }\n        },\n        {\n            key: \"copyFromCanvas\",\n            value: /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */ function copyFromCanvas(bounds) {\n                var _this = this;\n                if (!bounds) return;\n                var touchedCells = this.getTouchedCells(bounds);\n                var cellsW = this.getCellsWidth();\n                touchedCells.forEach(function(item, i) {\n                    if (!item || _this.cells[i]) // not touched, or already copied\n                    return;\n                    var x = i % cellsW;\n                    var y = Math.floor(i / cellsW);\n                    var w = (Math.min(x * $02d77b8dd5755328$var$cellSize + $02d77b8dd5755328$var$cellSize, _this.context.canvas.width) - 1) % $02d77b8dd5755328$var$cellSize + 1;\n                    var h = (Math.min(y * $02d77b8dd5755328$var$cellSize + $02d77b8dd5755328$var$cellSize, _this.context.canvas.height) - 1) % $02d77b8dd5755328$var$cellSize + 1;\n                    // temp canvas to prevent main canvas from getting slowed down in chrome\n                    var tmpCanvas = (0, $eWjiX.BB).canvas(w, h);\n                    var tmpCtx = (0, $eWjiX.BB).ctx(tmpCanvas);\n                    tmpCtx.drawImage(_this.context.canvas, -x * $02d77b8dd5755328$var$cellSize, -y * $02d77b8dd5755328$var$cellSize);\n                    _this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\n                });\n            }\n        },\n        {\n            key: \"getAverage\",\n            value: function getAverage(x, y, size) {\n                var _this = this;\n                size = Math.max(0.5, size * 0.75);\n                var x1 = Math.max(0, Math.floor(x - size));\n                var y1 = Math.max(0, Math.floor(y - size));\n                var x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n                var y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n                if (x1 > x2 || y1 > y2) return {\n                    r: 0,\n                    g: 0,\n                    b: 0,\n                    a: 0\n                };\n                var ar = 0, ag = 0, ab = 0, aa = 0, alpha;\n                var slicedBounds = this.sliceBounds({\n                    x1: x1,\n                    y1: y1,\n                    x2: x2,\n                    y2: y2\n                });\n                slicedBounds.forEach(function(slice) {\n                    var width = _this.cells[slice.index].width;\n                    var data = _this.cells[slice.index].data;\n                    var bounds = slice.bounds;\n                    for(var i = bounds.y1; i <= bounds.y2; i += 4)for(var e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 16){\n                        alpha = data[e2 + 3];\n                        ar += data[e2] * alpha;\n                        ag += data[e2 + 1] * alpha;\n                        ab += data[e2 + 2] * alpha;\n                        aa += alpha;\n                    }\n                });\n                if (aa !== 0) {\n                    ar /= aa;\n                    ag /= aa;\n                    ab /= aa;\n                    aa = Math.min(1, aa);\n                }\n                return {\n                    r: ar,\n                    g: ag,\n                    b: ab,\n                    a: aa\n                };\n            }\n        },\n        {\n            key: \"prepDot\",\n            value: function prepDot(x, y, size) {\n                size = Math.max(0.5, size);\n                var x1 = Math.max(0, Math.floor(x - size));\n                var y1 = Math.max(0, Math.floor(y - size));\n                var x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n                var y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n                if (x1 > x2 || y1 > y2) return undefined;\n                return {\n                    x1: x1,\n                    y1: y1,\n                    x2: x2,\n                    y2: y2\n                };\n            }\n        },\n        {\n            key: \"drawDot\",\n            value: function drawDot(params) {\n                var _this = this;\n                // array with random numbers. faster than Math.random()\n                var randI = 0;\n                var randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n                var randArr = [];\n                for(var i = 0; i < randLen; i++)randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n                // thin lines take more than just 1 sample\n                var sampleArr = [\n                    8,\n                    4,\n                    4,\n                    4,\n                    2,\n                    2,\n                    2,\n                    2,\n                    2,\n                    2\n                ]; // <0.5, 0.5, 1, 1.5, etc.\n                var samples = sampleArr[Math.floor(params.size * 2)];\n                var samplesSquared = samples ? samples * samples : 0;\n                var sampleOffsets = [];\n                if (samples) {\n                    var i1 = 0;\n                    for(var n = 0; n < samples; n++)for(var m = 0; m < samples; m++, i1 += 2){\n                        sampleOffsets[i1] = (n + 1) / samples; // x offset\n                        sampleOffsets[i1 + 1] = (m + 1) / samples; // y offset\n                    }\n                }\n                var sharpness = Math.pow(params.opacity, 2) * 0.8;\n                // to optimize calculations\n                var invSharpness = 1 - sharpness;\n                var sharpnessSubtrahend = sharpness / invSharpness;\n                var sizeSquared = params.size * params.size;\n                var distDivisor = sizeSquared * invSharpness / params.opacity;\n                var alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\n                var slicedBounds = this.sliceBounds({\n                    x1: params.x1,\n                    y1: params.y1,\n                    x2: params.x2,\n                    y2: params.y2\n                });\n                var cellsW = this.getCellsWidth();\n                slicedBounds.forEach(function(slice) {\n                    var cellOffsetX = slice.index % cellsW * $02d77b8dd5755328$var$cellSize;\n                    var cellOffsetY = Math.floor(slice.index / cellsW) * $02d77b8dd5755328$var$cellSize;\n                    var cellWidth = _this.cells[slice.index].width;\n                    var data = _this.cells[slice.index].data;\n                    // i - y index within cell\n                    // e - x index within cell\n                    // e2 - index in image data\n                    // ri - y index within image relative to dot-center\n                    // re - x index within image relative to dot-center\n                    for(var i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++)for(var e = slice.bounds.x1, e2 = i * cellWidth * 4 + slice.bounds.x1 * 4, re = e + cellOffsetX - params.x; e <= slice.bounds.x2; e++, e2 += 4, re++){\n                        // O = over -> brush-dot\n                        // U = under -> image\n                        var alphaO = 0;\n                        if (samplesSquared) {\n                            for(var f = 0; f < sampleOffsets.length; f += 2){\n                                var dist = (0, $eWjiX.BB).lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\n                                if (dist >= sizeSquared) continue;\n                                alphaO += (0, $eg83P.clamp)(alphaMinuend - dist / distDivisor, 0, params.opacity);\n                            }\n                            if (!alphaO) continue;\n                            alphaO /= samplesSquared;\n                        } else {\n                            // technically needs + 0.5 offset, but not noticeable with large brush\n                            var dist1 = Math.pow(re, 2) + Math.pow(ri, 2);\n                            if (dist1 >= sizeSquared) continue;\n                            alphaO = (0, $eg83P.clamp)(alphaMinuend - dist1 / distDivisor, 0, params.opacity);\n                        }\n                        var invAlphaO = 1 - alphaO;\n                        var alphaU = data[e2 + 3] / 255;\n                        if (_this.settingLockLayerAlpha) {\n                            var underR = params.r * alphaO + data[e2] * invAlphaO;\n                            var underG = params.g * alphaO + data[e2 + 1] * invAlphaO;\n                            var underB = params.b * alphaO + data[e2 + 2] * invAlphaO;\n                            if (alphaU) {\n                                data[e2] = Math.floor(underR + randArr[randI]);\n                                data[e2 + 1] = Math.floor(underG + randArr[randI]);\n                                data[e2 + 2] = Math.floor(underB + randArr[randI]);\n                            }\n                        } else {\n                            var underR1 = params.r * alphaO + data[e2] * alphaU * invAlphaO;\n                            var underG1 = params.g * alphaO + data[e2 + 1] * alphaU * invAlphaO;\n                            var underB1 = params.b * alphaO + data[e2 + 2] * alphaU * invAlphaO;\n                            var newAlpha = 1 - invAlphaO * (1 - alphaU);\n                            data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\n                            if (newAlpha) {\n                                data[e2] = Math.floor(underR1 / newAlpha + randArr[randI]);\n                                data[e2 + 1] = Math.floor(underG1 / newAlpha + randArr[randI]);\n                                data[e2 + 2] = Math.floor(underB1 / newAlpha + randArr[randI]);\n                            }\n                        }\n                        randI = (randI + 1) % randLen;\n                    }\n                });\n            }\n        },\n        {\n            key: \"calcSpacing\",\n            value: function calcSpacing(size) {\n                return (0, $eWjiX.BB).mix(size * 2 / 2, size * 2 / 9, (0, $eg83P.clamp)((size - 2.7) / 9.3, 0, 1));\n            }\n        },\n        {\n            key: \"continueLine\",\n            value: function continueLine(x, y, p, isCoalesced) {\n                var _this = this;\n                this.drawBuffer = [];\n                var localPressure;\n                var localOpacity;\n                var localSize = this.settingSizePressure ? Math.max(1, p * this.size) : Math.max(1, this.size);\n                var bDist = this.calcSpacing(localSize);\n                var avgX = x === undefined ? this.lastInput.x : x;\n                var avgY = y === undefined ? this.lastInput.y : y;\n                var localColNew;\n                if (this.blending === 0) {\n                    this.mixCol.r = this.color.r;\n                    this.mixCol.g = this.color.g;\n                    this.mixCol.b = this.color.b;\n                } else {\n                    var average;\n                    if (isCoalesced) average = {\n                        r: this.localColOld.r,\n                        g: this.localColOld.g,\n                        b: this.localColOld.b,\n                        a: 0\n                    };\n                    else {\n                        var avgParams = [\n                            avgX,\n                            avgY,\n                            this.settingSizePressure ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size)\n                        ];\n                        var bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\n                        if (bounds) this.copyFromCanvas(bounds);\n                        average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\n                    }\n                    localColNew = {\n                        r: 0,\n                        g: 0,\n                        b: 0,\n                        a: 0\n                    };\n                    if (average.a > 0 && this.blendCol.a === 0) {\n                        this.blendCol.r = average.r;\n                        this.blendCol.g = average.g;\n                        this.blendCol.b = average.b;\n                        this.blendCol.a = average.a;\n                        localColNew.r = this.blendCol.r;\n                        localColNew.g = this.blendCol.g;\n                        localColNew.b = this.blendCol.b;\n                        localColNew.a = this.blendCol.a;\n                    } else {\n                        if (average.a === 0) {\n                            average.r = this.color.r;\n                            average.g = this.color.g;\n                            average.b = this.color.b;\n                            average.a = 1 - this.blending;\n                        }\n                        this.blendCol.r = (0, $eWjiX.BB).mix(this.blendCol.r, (0, $eWjiX.BB).mix(this.blendCol.r, average.r, this.blendMix), average.a);\n                        this.blendCol.g = (0, $eWjiX.BB).mix(this.blendCol.g, (0, $eWjiX.BB).mix(this.blendCol.g, average.g, this.blendMix), average.a);\n                        this.blendCol.b = (0, $eWjiX.BB).mix(this.blendCol.b, (0, $eWjiX.BB).mix(this.blendCol.b, average.b, this.blendMix), average.a);\n                        this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\n                        localColNew.r = this.blendCol.r;\n                        localColNew.g = this.blendCol.g;\n                        localColNew.b = this.blendCol.b;\n                        localColNew.a = this.blendCol.a;\n                    }\n                }\n                var bezierCallback = function(val) {\n                    if (_this.blending >= 1 && _this.blendCol.a <= 0) return;\n                    var factor = val.t;\n                    localPressure = _this.lastInput2.pressure * (1 - factor) + p * factor;\n                    localOpacity = _this.settingOpacityPressure ? _this.opacity * localPressure * localPressure : _this.opacity;\n                    localSize = _this.settingSizePressure ? Math.max(0.1, localPressure * _this.size) : Math.max(0.1, _this.size);\n                    if (_this.blending != 0) {\n                        _this.mixCol.r = (0, $eWjiX.BB).mix(_this.localColOld.r, localColNew.r, factor);\n                        _this.mixCol.g = (0, $eWjiX.BB).mix(_this.localColOld.g, localColNew.g, factor);\n                        _this.mixCol.b = (0, $eWjiX.BB).mix(_this.localColOld.b, localColNew.b, factor);\n                    }\n                    if (_this.blending === 1 && _this.localColOld.a === 0) {\n                        _this.mixCol.r = localColNew.r;\n                        _this.mixCol.g = localColNew.g;\n                        _this.mixCol.b = localColNew.b;\n                    }\n                    var bounds = _this.prepDot(val.x, val.y, localSize);\n                    if (bounds) {\n                        _this.updateRedrawBounds(bounds);\n                        _this.drawBuffer.push({\n                            x: val.x,\n                            y: val.y,\n                            size: localSize,\n                            opacity: localOpacity,\n                            x1: bounds.x1,\n                            y1: bounds.y1,\n                            x2: bounds.x2,\n                            y2: bounds.y2,\n                            r: (0, $eWjiX.BB).mix(_this.color.r, _this.mixCol.r, _this.blending),\n                            g: (0, $eWjiX.BB).mix(_this.color.g, _this.mixCol.g, _this.blending),\n                            b: (0, $eWjiX.BB).mix(_this.color.b, _this.mixCol.b, _this.blending)\n                        });\n                    }\n                };\n                if (x === undefined || y === undefined) this.bezierLine.addFinal(bDist, bezierCallback);\n                else this.bezierLine.add(x, y, bDist, bezierCallback);\n                this.copyFromCanvas(this.redrawBounds);\n                this.drawBuffer.forEach(function(item) {\n                    _this.drawDot(item);\n                });\n                this.drawBuffer = [];\n                this.localColOld = localColNew;\n            }\n        },\n        {\n            key: \"setHistory\",\n            value: function setHistory(h) {\n                this.history = h;\n            }\n        },\n        {\n            key: \"getSize\",\n            value: function getSize() {\n                return this.size;\n            }\n        },\n        {\n            key: \"setSize\",\n            value: function setSize(s) {\n                this.size = s;\n            }\n        },\n        {\n            key: \"getOpacity\",\n            value: function getOpacity() {\n                return this.opacity;\n            }\n        },\n        {\n            key: \"setOpacity\",\n            value: function setOpacity(o) {\n                this.opacity = o;\n            }\n        },\n        {\n            key: \"getBlending\",\n            value: function getBlending() {\n                return this.blending;\n            }\n        },\n        {\n            key: \"setBlending\",\n            value: function setBlending(b) {\n                this.blending = b;\n            }\n        },\n        {\n            key: \"setColor\",\n            value: function setColor(c) {\n                this.color = (0, $eWjiX.BB).copyObj(c);\n            }\n        },\n        {\n            key: \"setContext\",\n            value: function setContext(c) {\n                this.context = c;\n            }\n        },\n        {\n            key: \"setSizePressure\",\n            value: function setSizePressure(b) {\n                this.settingSizePressure = b;\n            }\n        },\n        {\n            key: \"setOpacityPressure\",\n            value: function setOpacityPressure(b) {\n                this.settingOpacityPressure = b;\n            }\n        },\n        {\n            key: \"getLockAlpha\",\n            value: function getLockAlpha() {\n                return this.settingLockLayerAlpha;\n            }\n        },\n        {\n            key: \"setLockAlpha\",\n            value: function setLockAlpha(b) {\n                this.settingLockLayerAlpha = b;\n            }\n        },\n        {\n            key: \"getIsDrawing\",\n            value: function getIsDrawing() {\n                return this.isDrawing;\n            }\n        },\n        {\n            key: \"setIsTesting\",\n            value: function setIsTesting(b) {\n                this.isTesting = b;\n            }\n        },\n        {\n            key: \"startLine\",\n            value: function startLine(x, y, p) {\n                var _this = this;\n                this.historyEntry = {\n                    tool: [\n                        \"brush\",\n                        \"BlendBrush\"\n                    ],\n                    actions: []\n                };\n                var totalCells = Math.ceil(this.context.canvas.width / $02d77b8dd5755328$var$cellSize) * Math.ceil(this.context.canvas.height / $02d77b8dd5755328$var$cellSize);\n                this.cells = \"0\".repeat(totalCells).split(\"\").map(function() {\n                    return undefined;\n                });\n                this.isDrawing = true;\n                p = Math.max(0, Math.min(1, p));\n                var localOpacity = this.settingOpacityPressure ? this.opacity * p * p : this.opacity;\n                var localSize = this.settingSizePressure ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n                if (this.blending === 0) {\n                    this.mixCol.r = this.color.r;\n                    this.mixCol.g = this.color.g;\n                    this.mixCol.b = this.color.b;\n                } else {\n                    this.copyFromCanvas(this.prepDot(x, y, localSize));\n                    var average = this.getAverage(x, y, this.settingSizePressure ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size));\n                    if (average.a === 0) this.blendCol = {\n                        r: this.color.r,\n                        g: this.color.g,\n                        b: this.color.b,\n                        a: 1 - this.blending\n                    };\n                    else this.blendCol = {\n                        r: average.r,\n                        g: average.g,\n                        b: average.b,\n                        a: average.a\n                    };\n                    this.mixCol.r = this.blendCol.r;\n                    this.mixCol.g = this.blendCol.g;\n                    this.mixCol.b = this.blendCol.b;\n                }\n                this.localColOld = {\n                    r: this.mixCol.r,\n                    g: this.mixCol.g,\n                    b: this.mixCol.b,\n                    a: this.blendCol.a\n                };\n                this.redrawBounds = undefined;\n                this.drawBuffer = [];\n                if (this.blending < 1 || this.blendCol.a > 0) {\n                    var bounds = this.prepDot(x, y, localSize);\n                    if (bounds) {\n                        this.updateRedrawBounds(bounds);\n                        this.drawBuffer.push({\n                            x: x,\n                            y: y,\n                            size: localSize,\n                            opacity: localOpacity,\n                            x1: bounds.x1,\n                            y1: bounds.y1,\n                            x2: bounds.x2,\n                            y2: bounds.y2,\n                            r: (0, $eWjiX.BB).mix(this.color.r, this.mixCol.r, this.blending),\n                            g: (0, $eWjiX.BB).mix(this.color.g, this.mixCol.g, this.blending),\n                            b: (0, $eWjiX.BB).mix(this.color.b, this.mixCol.b, this.blending)\n                        });\n                    }\n                }\n                this.copyFromCanvas(this.redrawBounds);\n                this.drawBuffer.forEach(function(item) {\n                    _this.drawDot(item);\n                });\n                this.drawBuffer = [];\n                this.bezierLine = new (0, $eWjiX.BB).BezierLine();\n                this.bezierLine.add(x, y, 0, function() {});\n                this.lastInput.x = x;\n                this.lastInput.y = y;\n                this.lastInput.pressure = p;\n                this.lastInput2 = (0, $eWjiX.BB).copyObj(this.lastInput);\n                if (!this.isTesting) this.drawChangedCells();\n            }\n        },\n        {\n            key: \"goLine\",\n            value: function goLine(x, y, p, isCoalesced) {\n                if (!this.isDrawing) return;\n                this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\n                this.lastInput2 = (0, $eWjiX.BB).copyObj(this.lastInput);\n                this.lastInput.x = x;\n                this.lastInput.y = y;\n                this.lastInput.pressure = p;\n                if (!this.isTesting) this.drawChangedCells();\n            }\n        },\n        {\n            key: \"endLine\",\n            value: function endLine() {\n                if (this.bezierLine) this.continueLine(undefined, undefined, this.lastInput.pressure, false);\n                this.isDrawing = false;\n                this.bezierLine = undefined;\n                this.drawChangedCells();\n                if (this.historyEntry && this.history && this.cells.find(function(item) {\n                    return !!item;\n                })) {\n                    this.historyEntry.actions.push({\n                        action: \"drawCells\",\n                        params: [\n                            this.cells\n                        ]\n                    });\n                    this.history.push(this.historyEntry);\n                    this.historyEntry = undefined;\n                }\n                this.cells = [];\n            }\n        },\n        {\n            /**\r\n     * draw cells onto context\r\n     * @param cells\r\n     */ key: \"drawCells\",\n            value: function drawCells(cells) {\n                var _this = this;\n                var cellsW = this.getCellsWidth();\n                cells.forEach(function(imageData, index) {\n                    if (!imageData) return;\n                    var cellOffsetX = index % cellsW * $02d77b8dd5755328$var$cellSize;\n                    var cellOffsetY = Math.floor(index / cellsW) * $02d77b8dd5755328$var$cellSize;\n                    _this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\n                });\n            }\n        },\n        {\n            key: \"drawLineSegment\",\n            value: function drawLineSegment(x1, y1, x2, y2) {\n                var _this = this;\n                this.lastInput.x = x2;\n                this.lastInput.y = y2;\n                if (this.isDrawing || x1 === undefined) return;\n                var totalCells = Math.ceil(this.context.canvas.width / $02d77b8dd5755328$var$cellSize) * Math.ceil(this.context.canvas.height / $02d77b8dd5755328$var$cellSize);\n                this.cells = \"0\".repeat(totalCells).split(\"\").map(function() {\n                    return undefined;\n                });\n                this.redrawBounds = undefined;\n                this.drawBuffer = [];\n                this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\n                var average = this.getAverage(x1, y1, Math.max(0.1, this.size));\n                if (average.a === 0) this.blendCol = {\n                    r: this.color.r,\n                    g: this.color.g,\n                    b: this.color.b,\n                    a: 1 - this.blending\n                };\n                else this.blendCol = {\n                    r: average.r,\n                    g: average.g,\n                    b: average.b,\n                    a: average.a\n                };\n                this.mixCol.r = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\n                this.mixCol.g = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\n                this.mixCol.b = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\n                var p = 1;\n                var localOpacity = this.settingOpacityPressure ? this.opacity * p * p : this.opacity;\n                var localSize = this.settingSizePressure ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n                var mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n                var eX = (x2 - x1) / mouseDist;\n                var eY = (y2 - y1) / mouseDist;\n                var bDist = this.calcSpacing(localSize);\n                for(var loopDist = 0; loopDist <= mouseDist; loopDist += bDist){\n                    var bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\n                    if (bounds) {\n                        this.copyFromCanvas(bounds);\n                        this.drawBuffer.push({\n                            x: x1 + eX * loopDist,\n                            y: y1 + eY * loopDist,\n                            size: localSize,\n                            opacity: localOpacity,\n                            x1: bounds.x1,\n                            y1: bounds.y1,\n                            x2: bounds.x2,\n                            y2: bounds.y2,\n                            r: (0, $eWjiX.BB).mix(this.color.r, this.mixCol.r, this.blending),\n                            g: (0, $eWjiX.BB).mix(this.color.g, this.mixCol.g, this.blending),\n                            b: (0, $eWjiX.BB).mix(this.color.b, this.mixCol.b, this.blending)\n                        });\n                    }\n                }\n                this.drawBuffer.forEach(function(item) {\n                    _this.drawDot(item);\n                });\n                this.drawBuffer = [];\n                if (this.history && this.cells.find(function(item) {\n                    return !!item;\n                })) {\n                    this.drawCells(this.cells);\n                    this.historyEntry = {\n                        tool: [\n                            \"brush\",\n                            \"BlendBrush\"\n                        ],\n                        actions: [\n                            {\n                                action: \"drawCells\",\n                                params: [\n                                    this.cells\n                                ]\n                            }\n                        ]\n                    };\n                    this.history.push(this.historyEntry);\n                    this.historyEntry = undefined;\n                }\n                this.cells = [];\n            }\n        }\n    ]);\n    return BlendBrush;\n}();\n\n});\n\nparcelRequire.register(\"ewgr9\", function(module, exports) {\n\n$parcel$export(module.exports, \"SketchyBrush\", function () { return $c214fbe9e4fc15b0$export$566f9061f0f5ba33; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\nvar $c214fbe9e4fc15b0$var$sampleCanvas = (0, $eWjiX.BB).canvas(32, 32);\nvar $c214fbe9e4fc15b0$var$sampleCtx = (0, $eWjiX.BB).ctx($c214fbe9e4fc15b0$var$sampleCanvas);\nvar $c214fbe9e4fc15b0$export$566f9061f0f5ba33 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function SketchyBrush() {\n        (0, $cx0mh._)(this, SketchyBrush);\n        this.context = {};\n        this.settingColor = {};\n        this.settingSize = 1;\n        this.settingOpacity = 0.2;\n        this.settingBlending = 0.5;\n        this.settingScale = 1;\n        this.lastX = 0;\n        this.lastY = 0;\n        this.inputIsDrawing = false;\n        this.lastInput = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.history = new (0, $hrnUX.KL).DecoyKlHistory();\n        this.sketchySeed = 0;\n        this.points = [] // x y\n        ;\n        this.count = 0;\n        this.mixMode = [\n            function(c1) {\n                return c1;\n            },\n            function(c1, c2) {\n                var result = new (0, $eWjiX.BB).RGB(c1.r, c1.g, c1.b);\n                result.r *= c2.r / 255;\n                result.g *= c2.g / 255;\n                result.b *= c2.b / 255;\n                return result;\n            }\n        ];\n    }\n    (0, $7h4XF._)(SketchyBrush, [\n        {\n            key: \"rand\",\n            value: function rand() {\n                this.sketchySeed++;\n                return Math.sin(6324634.2345 * Math.cos(this.sketchySeed * 5342.3423)) * 0.5 + 0.5;\n            }\n        },\n        {\n            // ---- interface ----\n            key: \"setHistory\",\n            value: function setHistory(l) {\n                this.history = l;\n            }\n        },\n        {\n            key: \"setSeed\",\n            value: function setSeed(s) {\n                this.sketchySeed = parseInt(\"\" + s);\n            }\n        },\n        {\n            key: \"getSeed\",\n            value: function getSeed() {\n                return parseInt(\"\" + this.sketchySeed);\n            }\n        },\n        {\n            key: \"getSize\",\n            value: function getSize() {\n                return this.settingSize / 2;\n            }\n        },\n        {\n            key: \"setColor\",\n            value: function setColor(c) {\n                this.settingColor = c;\n            }\n        },\n        {\n            key: \"getOpacity\",\n            value: function getOpacity() {\n                return this.settingOpacity;\n            }\n        },\n        {\n            key: \"setOpacity\",\n            value: function setOpacity(o) {\n                this.settingOpacity = o;\n            }\n        },\n        {\n            key: \"getBlending\",\n            value: function getBlending() {\n                return this.settingBlending;\n            }\n        },\n        {\n            key: \"setBlending\",\n            value: function setBlending(b) {\n                this.settingBlending = b;\n            }\n        },\n        {\n            key: \"setSize\",\n            value: function setSize(s) {\n                this.settingSize = s * 2;\n            }\n        },\n        {\n            key: \"getScale\",\n            value: function getScale() {\n                return this.settingScale;\n            }\n        },\n        {\n            key: \"setScale\",\n            value: function setScale(s) {\n                this.settingScale = s;\n            }\n        },\n        {\n            key: \"setContext\",\n            value: function setContext(c) {\n                this.context = c;\n            }\n        },\n        {\n            key: \"startLine\",\n            value: function startLine(x, y, pressure, shift) {\n                if (shift && this.lastInput.x) {\n                    this.inputIsDrawing = true;\n                    this.endLine();\n                } else {\n                    this.inputIsDrawing = true;\n                    this.lastX = x;\n                    this.lastY = y;\n                    this.lastInput.x = x;\n                    this.lastInput.y = y;\n                    this.historyEntry = {\n                        tool: [\n                            \"brush\",\n                            \"SketchyBrush\"\n                        ],\n                        actions: [\n                            {\n                                action: \"setScale\",\n                                params: [\n                                    this.settingScale\n                                ]\n                            },\n                            {\n                                action: \"setSize\",\n                                params: [\n                                    this.settingSize / 2\n                                ]\n                            },\n                            {\n                                action: \"setOpacity\",\n                                params: [\n                                    this.settingOpacity\n                                ]\n                            },\n                            {\n                                action: \"setColor\",\n                                params: [\n                                    this.settingColor\n                                ]\n                            },\n                            {\n                                action: \"setBlending\",\n                                params: [\n                                    this.settingBlending\n                                ]\n                            },\n                            {\n                                action: \"startLine\",\n                                params: [\n                                    x,\n                                    y,\n                                    pressure\n                                ]\n                            }\n                        ]\n                    };\n                }\n            }\n        },\n        {\n            key: \"goLine\",\n            value: function goLine(p_x, p_y, pressure, preMixedColor) {\n                if (!this.inputIsDrawing || p_x === this.lastInput.x && p_y === this.lastInput.y) return;\n                var e, b, a, g;\n                var x = parseInt(\"\" + p_x);\n                var y = parseInt(\"\" + p_y);\n                this.points.push([\n                    x,\n                    y\n                ]);\n                var mixr = this.settingColor.r;\n                var mixg = this.settingColor.g;\n                var mixb = this.settingColor.b;\n                if (preMixedColor) {\n                    mixr = preMixedColor.r;\n                    mixg = preMixedColor.g;\n                    mixb = preMixedColor.b;\n                } else {\n                    if (this.settingBlending !== 0) {\n                        if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < this.context.canvas.width - 1 && y - 5 < this.context.canvas.height - 1) {\n                            mixr = 0;\n                            mixg = 0;\n                            mixb = 0;\n                            var mixX = Math.min(this.context.canvas.width - 1, Math.max(0, x - 5));\n                            var mixY = Math.min(this.context.canvas.height - 1, Math.max(0, y - 5));\n                            var mixW = Math.min(this.context.canvas.width - 1, Math.max(0, x + 5));\n                            var mixH = Math.min(this.context.canvas.height - 1, Math.max(0, y + 5));\n                            mixW -= mixX;\n                            mixH -= mixY;\n                            if (mixW > 0 && mixH > 0) {\n                                var imDat = this.context.getImageData(mixX, mixY, mixW, mixH);\n                                var countMix = 0;\n                                for(var i = 0; i < imDat.data.length; i += 4){\n                                    mixr += imDat.data[i + 0];\n                                    mixg += imDat.data[i + 1];\n                                    mixb += imDat.data[i + 2];\n                                    countMix++;\n                                }\n                                mixr /= countMix;\n                                mixg /= countMix;\n                                mixb /= countMix;\n                            }\n                            var mixed = this.mixMode[0](new (0, $eWjiX.BB).RGB(mixr, mixg, mixb), this.settingColor);\n                            mixr = parseInt(\"\" + (0, $eWjiX.BB).mix(this.settingColor.r, mixed.r, this.settingBlending));\n                            mixg = parseInt(\"\" + (0, $eWjiX.BB).mix(this.settingColor.g, mixed.g, this.settingBlending));\n                            mixb = parseInt(\"\" + (0, $eWjiX.BB).mix(this.settingColor.b, mixed.b, this.settingBlending));\n                        }\n                    }\n                }\n                this.context.save();\n                this.context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + this.settingOpacity + \")\";\n                this.context.lineWidth = this.settingSize;\n                this.context.beginPath();\n                this.context.moveTo(this.lastX, this.lastY);\n                this.context.lineTo(x, y);\n                for(e = 0; e < this.points.length; e++){\n                    b = this.points[e][0] - this.points[this.count][0];\n                    a = this.points[e][1] - this.points[this.count][1];\n                    g = b * b + a * a;\n                    if (g < 4000 * this.settingScale * this.settingScale && this.rand() > g / 2000 / this.settingScale / this.settingScale) {\n                        this.context.moveTo(this.points[this.count][0] + b * 0.3, this.points[this.count][1] + a * 0.3);\n                        this.context.lineTo(this.points[e][0] - b * 0.3, this.points[e][1] - a * 0.3);\n                    }\n                }\n                this.context.stroke();\n                this.context.restore();\n                this.count++;\n                this.lastX = x;\n                this.lastY = y;\n                this.lastInput.x = x;\n                this.lastInput.y = y;\n                this.historyEntry.actions.push({\n                    action: \"goLine\",\n                    params: [\n                        p_x,\n                        p_y,\n                        pressure,\n                        {\n                            r: mixr,\n                            g: mixg,\n                            b: mixb\n                        }\n                    ]\n                });\n            }\n        },\n        {\n            key: \"endLine\",\n            value: function endLine() {\n                this.inputIsDrawing = false;\n                this.count = 0;\n                this.points = [];\n                if (this.historyEntry) {\n                    this.historyEntry.actions.push({\n                        action: \"endLine\",\n                        params: []\n                    });\n                    this.history.push(this.historyEntry);\n                    this.historyEntry = undefined;\n                }\n            }\n        },\n        {\n            //cheap 'n' ugly\n            key: \"drawLineSegment\",\n            value: function drawLineSegment(x1, y1, x2, y2) {\n                this.lastInput.x = x2;\n                this.lastInput.y = y2;\n                if (this.inputIsDrawing || x1 === undefined) return;\n                this.context.save();\n                this.context.lineWidth = this.settingSize;\n                var mixCol = {\n                    r: this.settingColor.r,\n                    g: this.settingColor.g,\n                    b: this.settingColor.b\n                };\n                if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < this.context.canvas.width - 1 && y1 - 5 < this.context.canvas.height - 1) {\n                    mixCol.r = 0;\n                    mixCol.g = 0;\n                    mixCol.b = 0;\n                    var mixX = Math.min(this.context.canvas.width - 1, Math.max(0, x1 - 5));\n                    var mixY = Math.min(this.context.canvas.height - 1, Math.max(0, y1 - 5));\n                    var mixW = Math.min(this.context.canvas.width - 1, Math.max(0, x1 + 5));\n                    var mixH = Math.min(this.context.canvas.height - 1, Math.max(0, y1 + 5));\n                    mixW -= mixX;\n                    mixH -= mixY;\n                    if (mixW > 0 && mixH > 0) {\n                        var w = Math.min($c214fbe9e4fc15b0$var$sampleCanvas.width, mixW);\n                        var h = Math.min($c214fbe9e4fc15b0$var$sampleCanvas.height, mixH);\n                        $c214fbe9e4fc15b0$var$sampleCtx.save();\n                        $c214fbe9e4fc15b0$var$sampleCtx.globalCompositeOperation = \"copy\";\n                        $c214fbe9e4fc15b0$var$sampleCtx.drawImage(this.context.canvas, mixX, mixY, mixW, mixH, 0, 0, w, h);\n                        $c214fbe9e4fc15b0$var$sampleCtx.restore();\n                        var imDat = $c214fbe9e4fc15b0$var$sampleCtx.getImageData(mixX, mixY, mixW, mixH);\n                        var countMix = 0;\n                        for(var i = 0; i < imDat.data.length; i += 4){\n                            mixCol.r += imDat.data[i + 0];\n                            mixCol.g += imDat.data[i + 1];\n                            mixCol.b += imDat.data[i + 2];\n                            countMix++;\n                        }\n                        mixCol.r /= countMix;\n                        mixCol.g /= countMix;\n                        mixCol.b /= countMix;\n                    }\n                }\n                var mixed = this.mixMode[0](new (0, $eWjiX.BB).RGB(mixCol.r, mixCol.g, mixCol.b), this.settingColor);\n                mixCol.r = parseInt(\"\" + (this.settingBlending * mixed.r + this.settingColor.r * (1 - this.settingBlending)));\n                mixCol.g = parseInt(\"\" + (this.settingBlending * mixed.g + this.settingColor.g * (1 - this.settingBlending)));\n                mixCol.b = parseInt(\"\" + (this.settingBlending * mixed.b + this.settingColor.b * (1 - this.settingBlending)));\n                this.context.strokeStyle = \"rgba(\" + mixCol.r + \", \" + mixCol.g + \", \" + mixCol.b + \", \" + this.settingOpacity + \")\";\n                this.context.beginPath();\n                this.context.moveTo(x1, y1);\n                this.context.lineTo(x2, y2);\n                this.context.stroke();\n                this.context.strokeStyle = \"rgba(\" + mixCol.r + \", \" + mixCol.g + \", \" + mixCol.b + \", \" + this.settingOpacity + \")\";\n                this.context.restore();\n                var historyEntry = {\n                    tool: [\n                        \"brush\",\n                        \"SketchyBrush\"\n                    ],\n                    actions: [\n                        {\n                            action: \"setScale\",\n                            params: [\n                                this.settingScale\n                            ]\n                        },\n                        {\n                            action: \"setSize\",\n                            params: [\n                                this.settingSize / 2\n                            ]\n                        },\n                        {\n                            action: \"setOpacity\",\n                            params: [\n                                this.settingOpacity\n                            ]\n                        },\n                        {\n                            action: \"setColor\",\n                            params: [\n                                this.settingColor\n                            ]\n                        },\n                        {\n                            action: \"setBlending\",\n                            params: [\n                                this.settingBlending\n                            ]\n                        },\n                        {\n                            action: \"drawLineSegment\",\n                            params: [\n                                x1,\n                                y1,\n                                x2,\n                                y2\n                            ]\n                        }\n                    ]\n                };\n                this.history.push(historyEntry);\n            }\n        },\n        {\n            key: \"isDrawing\",\n            value: function isDrawing() {\n                return this.inputIsDrawing;\n            }\n        }\n    ]);\n    return SketchyBrush;\n}();\n\n});\n\nparcelRequire.register(\"kic4a\", function(module, exports) {\n\n$parcel$export(module.exports, \"PixelBrush\", function () { return $58b45953679baa4a$export$4de5ef8eecde6f12; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $fohxs = parcelRequire(\"fohxs\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $58b45953679baa4a$export$4de5ef8eecde6f12 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function PixelBrush() {\n        (0, $cx0mh._)(this, PixelBrush);\n        this.history = new (0, $hrnUX.KL).DecoyKlHistory();\n        this.context = {};\n        this.settingHasSizePressure = true;\n        this.settingHasOpacityPressure = false;\n        this.settingSize = 0.5;\n        this.settingSpacing = 0.9;\n        this.settingOpacity = 1;\n        this.settingColor = {};\n        this.settingColorStr = \"\";\n        this.settingLockLayerAlpha = false;\n        this.settingIsEraser = false;\n        this.settingUseDither = true;\n        this.inputIsDrawing = false;\n        this.lineToolLastDot = 0;\n        this.lastInput = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.lastInput2 = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.bezierLine = null;\n        this.ditherArr = [\n            [\n                3,\n                2\n            ],\n            [\n                1,\n                0\n            ],\n            [\n                3,\n                0\n            ],\n            [\n                1,\n                2\n            ],\n            [\n                2,\n                1\n            ],\n            [\n                0,\n                3\n            ],\n            [\n                0,\n                1\n            ],\n            [\n                2,\n                3\n            ],\n            [\n                2,\n                0\n            ],\n            [\n                0,\n                2\n            ],\n            [\n                0,\n                0\n            ],\n            [\n                2,\n                2\n            ],\n            [\n                1,\n                1\n            ],\n            [\n                3,\n                3\n            ],\n            [\n                3,\n                1\n            ],\n            [\n                1,\n                3\n            ]\n        ];\n        this.ditherPattern = {};\n        this.ditherCanvas = (0, $eWjiX.BB).canvas(4, 4);\n        this.ditherCtx = (0, $eWjiX.BB).ctx(this.ditherCanvas);\n    }\n    (0, $7h4XF._)(PixelBrush, [\n        {\n            key: \"updateDither\",\n            value: function updateDither() {\n                this.ditherCtx.clearRect(0, 0, 4, 4);\n                this.ditherCtx.fillStyle = this.settingIsEraser ? \"rgb(\".concat((0, $fohxs.ERASE_COLOR), \",\").concat((0, $fohxs.ERASE_COLOR), \",\").concat((0, $fohxs.ERASE_COLOR), \")\") : this.settingColorStr;\n                for(var i = 0; i < Math.max(1, Math.round(this.settingOpacity * this.ditherArr.length)); i++)this.ditherCtx.fillRect(this.ditherArr[i][0], this.ditherArr[i][1], 1, 1);\n                this.ditherPattern = (0, $7jh4K.throwIfNull)(this.context.createPattern(this.ditherCanvas, \"repeat\"));\n            }\n        },\n        {\n            key: \"cubicCurveOverThreshold\",\n            value: /**\r\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\r\n     */ function cubicCurveOverThreshold(p1, p2, p3, p4, maxAngleRad) {\n                var d = (0, $eWjiX.BB).Vec2.nor({\n                    x: p4.x - p1.x,\n                    y: p4.y - p1.y\n                });\n                var d2 = (0, $eWjiX.BB).Vec2.nor({\n                    x: p2.x - p1.x,\n                    y: p2.y - p1.y\n                });\n                var d3 = (0, $eWjiX.BB).Vec2.nor({\n                    x: p4.x - p3.x,\n                    y: p4.y - p3.y\n                });\n                // const a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\n                // const a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\n                return Math.max((0, $eWjiX.BB).Vec2.dist(d, d2), (0, $eWjiX.BB).Vec2.dist(d, d3)) > maxAngleRad;\n            }\n        },\n        {\n            key: \"plotCubicBezierLine\",\n            value: function plotCubicBezierLine(p1, p2, p3, p4) {\n                var isOverThreshold = this.cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\n                p1.x = Math.floor(p1.x);\n                p1.y = Math.floor(p1.y);\n                p4.x = Math.floor(p4.x);\n                p4.y = Math.floor(p4.y);\n                var dist = (0, $eWjiX.BB).dist(p1.x, p1.y, p4.x, p4.y);\n                if (!isOverThreshold || dist < 7) {\n                    this.plotLine(p1.x, p1.y, p4.x, p4.y, true);\n                    return;\n                }\n                var n = Math.max(2, Math.round(dist / 4));\n                var pointArr = [];\n                for(var i = 0; i <= n; i++){\n                    var t = i / n;\n                    var a = Math.pow(1 - t, 3);\n                    var b = 3 * t * Math.pow(1 - t, 2);\n                    var c = 3 * Math.pow(t, 2) * (1 - t);\n                    var d = Math.pow(t, 3);\n                    pointArr.push({\n                        x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\n                        y: a * p1.y + b * p2.y + c * p3.y + d * p4.y\n                    });\n                }\n                for(var i1 = 0; i1 < n; i1++)this.plotLine(Math.round(pointArr[i1].x), Math.round(pointArr[i1].y), Math.round(pointArr[i1 + 1].x), Math.round(pointArr[i1 + 1].y), true);\n            }\n        },\n        {\n            key: \"drawDot\",\n            value: function drawDot(x, y, size, opacity) {\n                this.context.save();\n                if (this.settingIsEraser) {\n                    this.context.fillStyle = this.settingUseDither ? this.ditherPattern : \"#fff\";\n                    if (this.settingLockLayerAlpha) this.context.globalCompositeOperation = \"source-atop\";\n                    else this.context.globalCompositeOperation = \"destination-out\";\n                } else {\n                    this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\n                    if (this.settingLockLayerAlpha) this.context.globalCompositeOperation = \"source-atop\";\n                }\n                this.context.globalAlpha = this.settingUseDither ? 1 : opacity;\n                this.context.fillRect(Math.round(x + -size), Math.round(y + -size), Math.round(size * 2), Math.round(size * 2));\n                this.context.restore();\n            }\n        },\n        {\n            key: \"continueLine\",\n            value: function continueLine(x, y, size, pressure) {\n                var _this = this;\n                if (this.bezierLine === null) {\n                    this.bezierLine = new (0, $eWjiX.BB).BezierLine();\n                    this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function() {});\n                }\n                this.context.save();\n                var dotCallback = function(val) {\n                    var localPressure = (0, $eWjiX.BB).mix(_this.lastInput2.pressure, pressure, val.t);\n                    var localOpacity = _this.settingOpacity * (_this.settingHasOpacityPressure ? localPressure * localPressure : 1);\n                    var localSize = Math.max(0.5, _this.settingSize * (_this.settingHasSizePressure ? localPressure : 1));\n                    _this.drawDot(val.x, val.y, localSize, localOpacity);\n                };\n                var controlCallback = function(controlObj) {\n                    _this.plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\n                };\n                if (Math.round(this.settingSize * 2) === 1) {\n                    if (x === null || y === null) this.bezierLine.addFinal(4, undefined, controlCallback);\n                    else this.bezierLine.add(x, y, 4, undefined, controlCallback);\n                } else {\n                    var localSpacing = size * this.settingSpacing;\n                    if (x === null || y === null) this.bezierLine.addFinal(localSpacing, dotCallback);\n                    else this.bezierLine.add(x, y, localSpacing, dotCallback);\n                }\n                this.context.restore();\n            }\n        },\n        {\n            key: \"plotLine\",\n            value: /**\r\n     * bresenheim line drawing\r\n     */ function plotLine(x0, y0, x1, y1, skipFirst) {\n                this.context.save();\n                if (this.settingIsEraser) {\n                    this.context.fillStyle = this.settingUseDither ? this.ditherPattern : \"#fff\";\n                    if (this.settingLockLayerAlpha) this.context.globalCompositeOperation = \"source-atop\";\n                    else this.context.globalCompositeOperation = \"destination-out\";\n                } else {\n                    this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\n                    if (this.settingLockLayerAlpha) this.context.globalCompositeOperation = \"source-atop\";\n                }\n                this.context.globalAlpha = this.settingUseDither ? 1 : this.settingOpacity;\n                x0 = Math.floor(x0);\n                y0 = Math.floor(y0);\n                x1 = Math.floor(x1);\n                y1 = Math.floor(y1);\n                var dX = Math.abs(x1 - x0);\n                var sX = x0 < x1 ? 1 : -1;\n                var dY = -Math.abs(y1 - y0);\n                var sY = y0 < y1 ? 1 : -1;\n                var err = dX + dY;\n                // eslint-disable-next-line no-constant-condition\n                while(true){\n                    if (skipFirst) skipFirst = false;\n                    else this.context.fillRect(x0, y0, 1, 1);\n                    if (x0 === x1 && y0 === y1) break;\n                    var e2 = 2 * err;\n                    if (e2 >= dY) {\n                        err += dY;\n                        x0 += sX;\n                    }\n                    if (e2 <= dX) {\n                        err += dX;\n                        y0 += sY;\n                    }\n                }\n                this.context.restore();\n            }\n        },\n        {\n            // ---- interface ----\n            key: \"startLine\",\n            value: function startLine(x, y, p) {\n                this.historyEntry = {\n                    tool: [\n                        \"brush\",\n                        \"PixelBrush\"\n                    ],\n                    actions: [\n                        {\n                            action: \"sizePressure\",\n                            params: [\n                                this.settingHasSizePressure\n                            ]\n                        },\n                        {\n                            action: \"opacityPressure\",\n                            params: [\n                                this.settingHasOpacityPressure\n                            ]\n                        },\n                        {\n                            action: \"setSize\",\n                            params: [\n                                this.settingSize\n                            ]\n                        },\n                        {\n                            action: \"setSpacing\",\n                            params: [\n                                this.settingSpacing\n                            ]\n                        },\n                        {\n                            action: \"setOpacity\",\n                            params: [\n                                this.settingOpacity\n                            ]\n                        },\n                        {\n                            action: \"setColor\",\n                            params: [\n                                this.settingColor\n                            ]\n                        },\n                        {\n                            action: \"setLockAlpha\",\n                            params: [\n                                this.settingLockLayerAlpha\n                            ]\n                        },\n                        {\n                            action: \"setIsEraser\",\n                            params: [\n                                this.settingIsEraser\n                            ]\n                        },\n                        {\n                            action: \"setUseDither\",\n                            params: [\n                                this.settingUseDither\n                            ]\n                        }\n                    ]\n                };\n                if (this.settingUseDither) this.updateDither();\n                p = Math.max(0, Math.min(1, p));\n                var localOpacity = this.settingHasOpacityPressure ? this.settingOpacity * p * p : this.settingOpacity;\n                var localSize = this.settingHasSizePressure ? Math.max(0.5, p * this.settingSize) : Math.max(0.5, this.settingSize);\n                this.inputIsDrawing = true;\n                this.drawDot(x, y, localSize, localOpacity);\n                this.lineToolLastDot = localSize * this.settingSpacing;\n                this.lastInput.x = x;\n                this.lastInput.y = y;\n                this.lastInput.pressure = p;\n                this.lastInput2 = (0, $eWjiX.BB).copyObj(this.lastInput);\n                this.historyEntry.actions.push({\n                    action: \"startLine\",\n                    params: [\n                        x,\n                        y,\n                        p\n                    ]\n                });\n            }\n        },\n        {\n            key: \"goLine\",\n            value: function goLine(x, y, p) {\n                if (!this.inputIsDrawing) return;\n                this.historyEntry.actions.push({\n                    action: \"goLine\",\n                    params: [\n                        x,\n                        y,\n                        p\n                    ]\n                });\n                //debug\n                //drawDot(x, y, 1, 0.5);\n                var pressure = (0, $eWjiX.BB).clamp(p, 0, 1);\n                var localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n                this.continueLine(x, y, localSize, this.lastInput.pressure);\n                this.lastInput2 = (0, $eWjiX.BB).copyObj(this.lastInput);\n                this.lastInput.x = x;\n                this.lastInput.y = y;\n                this.lastInput.pressure = pressure;\n            }\n        },\n        {\n            key: \"endLine\",\n            value: function endLine(x, y) {\n                var localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n                this.continueLine(null, null, localSize, this.lastInput.pressure);\n                //debug\n                //drawDot(lastInput.x, lastInput.y, 3, 1);\n                //drawDot(x, y, 10, 0.1);\n                this.inputIsDrawing = false;\n                this.bezierLine = null;\n                if (this.historyEntry) {\n                    this.historyEntry.actions.push({\n                        action: \"endLine\",\n                        params: [\n                            x,\n                            y\n                        ]\n                    });\n                    this.history.push(this.historyEntry);\n                    this.historyEntry = undefined;\n                }\n            }\n        },\n        {\n            //cheap n' ugly\n            key: \"drawLineSegment\",\n            value: function drawLineSegment(x1, y1, x2, y2) {\n                this.lastInput.x = x2;\n                this.lastInput.y = y2;\n                this.lastInput.pressure = 1;\n                if (this.inputIsDrawing || x1 === undefined) return;\n                if (this.settingUseDither) this.updateDither();\n                if (Math.round(this.settingSize * 2) === 1) this.plotLine(x1, y1, x2, y2, true);\n                else {\n                    // const angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\n                    var mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n                    var eX = (x2 - x1) / mouseDist;\n                    var eY = (y2 - y1) / mouseDist;\n                    var loopDist;\n                    var bdist = this.settingSize * this.settingSpacing;\n                    this.lineToolLastDot = this.settingSize * this.settingSpacing;\n                    for(loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist)this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity);\n                }\n                var historyEntry = {\n                    tool: [\n                        \"brush\",\n                        \"PixelBrush\"\n                    ],\n                    actions: [\n                        {\n                            action: \"sizePressure\",\n                            params: [\n                                this.settingHasSizePressure\n                            ]\n                        },\n                        {\n                            action: \"opacityPressure\",\n                            params: [\n                                this.settingHasOpacityPressure\n                            ]\n                        },\n                        {\n                            action: \"setSize\",\n                            params: [\n                                this.settingSize\n                            ]\n                        },\n                        {\n                            action: \"setSpacing\",\n                            params: [\n                                this.settingSpacing\n                            ]\n                        },\n                        {\n                            action: \"setOpacity\",\n                            params: [\n                                this.settingOpacity\n                            ]\n                        },\n                        {\n                            action: \"setColor\",\n                            params: [\n                                this.settingColor\n                            ]\n                        },\n                        {\n                            action: \"setLockAlpha\",\n                            params: [\n                                this.settingLockLayerAlpha\n                            ]\n                        },\n                        {\n                            action: \"setIsEraser\",\n                            params: [\n                                this.settingIsEraser\n                            ]\n                        },\n                        {\n                            action: \"setUseDither\",\n                            params: [\n                                this.settingUseDither\n                            ]\n                        },\n                        {\n                            action: \"drawLineSegment\",\n                            params: [\n                                x1,\n                                y1,\n                                x2,\n                                y2\n                            ]\n                        }\n                    ]\n                };\n                this.history.push(historyEntry);\n            }\n        },\n        {\n            //IS\n            key: \"isDrawing\",\n            value: function isDrawing() {\n                return this.inputIsDrawing;\n            }\n        },\n        {\n            //SET\n            key: \"setColor\",\n            value: function setColor(c) {\n                if (this.settingColor === c) return;\n                this.settingColor = c;\n                this.settingColorStr = \"rgb(\" + this.settingColor.r + \",\" + this.settingColor.g + \",\" + this.settingColor.b + \")\";\n            }\n        },\n        {\n            key: \"setContext\",\n            value: function setContext(c) {\n                this.context = c;\n            }\n        },\n        {\n            key: \"setHistory\",\n            value: function setHistory(l) {\n                this.history = l;\n            }\n        },\n        {\n            key: \"setSize\",\n            value: function setSize(s) {\n                this.settingSize = Math.round(s * 2) / 2;\n            }\n        },\n        {\n            key: \"setOpacity\",\n            value: function setOpacity(o) {\n                this.settingOpacity = o;\n            }\n        },\n        {\n            key: \"setSpacing\",\n            value: function setSpacing(s) {\n                this.settingSpacing = s;\n            }\n        },\n        {\n            key: \"sizePressure\",\n            value: function sizePressure(b) {\n                this.settingHasSizePressure = b;\n            }\n        },\n        {\n            key: \"opacityPressure\",\n            value: function opacityPressure(b) {\n                this.settingHasOpacityPressure = b;\n            }\n        },\n        {\n            key: \"setLockAlpha\",\n            value: function setLockAlpha(b) {\n                this.settingLockLayerAlpha = b;\n            }\n        },\n        {\n            key: \"setIsEraser\",\n            value: function setIsEraser(b) {\n                this.settingIsEraser = b;\n            }\n        },\n        {\n            key: \"setUseDither\",\n            value: function setUseDither(b) {\n                this.settingUseDither = b;\n            }\n        },\n        {\n            //GET\n            key: \"getSpacing\",\n            value: function getSpacing() {\n                return this.settingSpacing;\n            }\n        },\n        {\n            key: \"getSize\",\n            value: function getSize() {\n                return this.settingSize;\n            }\n        },\n        {\n            key: \"getOpacity\",\n            value: function getOpacity() {\n                return this.settingOpacity;\n            }\n        },\n        {\n            key: \"getLockAlpha\",\n            value: function getLockAlpha() {\n                return this.settingLockLayerAlpha;\n            }\n        },\n        {\n            key: \"getIsEraser\",\n            value: function getIsEraser() {\n                return this.settingIsEraser;\n            }\n        },\n        {\n            key: \"getUseDither\",\n            value: function getUseDither() {\n                return this.settingUseDither;\n            }\n        }\n    ]);\n    return PixelBrush;\n}();\n\n});\n\nparcelRequire.register(\"7cUpm\", function(module, exports) {\n\n$parcel$export(module.exports, \"EraserBrush\", function () { return $fc1a683099fb2d61$export$fe52c90afd1cf5ba; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $fohxs = parcelRequire(\"fohxs\");\nvar $fc1a683099fb2d61$export$fe52c90afd1cf5ba = /*#__PURE__*/ function() {\n    \"use strict\";\n    function EraserBrush() {\n        (0, $cx0mh._)(this, EraserBrush);\n        this.size = 30;\n        this.spacing = 0.4;\n        this.opacity = 1;\n        this.useSizePressure = true;\n        this.useOpacityPressure = false;\n        this.isTransparentBG = false;\n        this.history = new (0, $hrnUX.KL).DecoyKlHistory();\n        this.isBaseLayer = false;\n        this.context = {};\n        this.started = false;\n        this.lastInput = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.lastInput2 = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n    }\n    (0, $7h4XF._)(EraserBrush, [\n        {\n            key: \"drawDot\",\n            value: function drawDot(x, y, size, opacity) {\n                this.context.save();\n                if (this.isBaseLayer) {\n                    if (this.isTransparentBG) this.context.globalCompositeOperation = \"destination-out\";\n                    else this.context.globalCompositeOperation = \"source-atop\";\n                } else this.context.globalCompositeOperation = \"destination-out\";\n                var radgrad = this.context.createRadialGradient(size, size, 0, size, size, size);\n                var sharpness = Math.pow(opacity, 2);\n                sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\n                var oFac = Math.max(0, Math.min(1, opacity));\n                var localOpacity = 2 * oFac - oFac * oFac;\n                radgrad.addColorStop(sharpness, \"rgba(\".concat((0, $fohxs.ERASE_COLOR), \", \").concat((0, $fohxs.ERASE_COLOR), \", \").concat((0, $fohxs.ERASE_COLOR), \", \") + localOpacity + \")\");\n                radgrad.addColorStop(1, \"rgba(\".concat((0, $fohxs.ERASE_COLOR), \", \").concat((0, $fohxs.ERASE_COLOR), \", \").concat((0, $fohxs.ERASE_COLOR), \", 0)\"));\n                this.context.fillStyle = radgrad;\n                this.context.translate(x - size, y - size);\n                this.context.fillRect(0, 0, size * 2, size * 2);\n                this.context.restore();\n            }\n        },\n        {\n            key: \"continueLine\",\n            value: function continueLine(x, y, p) {\n                var _this = this;\n                p = Math.max(0, Math.min(1, p));\n                var localPressure;\n                var localOpacity;\n                var localSize = this.useSizePressure ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n                var bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * localSize * this.spacing);\n                var bezierCallback = function(val) {\n                    var factor = val.t;\n                    localPressure = _this.lastInput2.pressure * (1 - factor) + p * factor;\n                    localOpacity = _this.useOpacityPressure ? _this.opacity * localPressure * localPressure : _this.opacity;\n                    localSize = _this.useSizePressure ? Math.max(0.1, localPressure * _this.size) : Math.max(0.1, _this.size);\n                    _this.drawDot(val.x, val.y, localSize, localOpacity);\n                };\n                if (x === undefined || y === undefined) this.bezierLine.addFinal(bdist, bezierCallback);\n                else this.bezierLine.add(x, y, bdist, bezierCallback);\n            }\n        },\n        {\n            // ---- interface ----\n            key: \"startLine\",\n            value: function startLine(x, y, p) {\n                this.historyEntry = {\n                    tool: [\n                        \"brush\",\n                        \"EraserBrush\"\n                    ],\n                    actions: [\n                        {\n                            action: \"opacityPressure\",\n                            params: [\n                                this.useOpacityPressure\n                            ]\n                        },\n                        {\n                            action: \"sizePressure\",\n                            params: [\n                                this.useSizePressure\n                            ]\n                        },\n                        {\n                            action: \"setSize\",\n                            params: [\n                                this.size\n                            ]\n                        },\n                        {\n                            action: \"setOpacity\",\n                            params: [\n                                this.opacity\n                            ]\n                        },\n                        {\n                            action: \"setTransparentBG\",\n                            params: [\n                                this.isTransparentBG\n                            ]\n                        },\n                        {\n                            action: \"startLine\",\n                            params: [\n                                x,\n                                y,\n                                p\n                            ]\n                        }\n                    ]\n                };\n                this.isBaseLayer = 0 === this.context.canvas.index;\n                p = Math.max(0, Math.min(1, p));\n                var localOpacity = this.useOpacityPressure ? this.opacity * p * p : this.opacity;\n                var localSize = this.useSizePressure ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n                this.started = true;\n                if (localSize > 1) this.drawDot(x, y, localSize, localOpacity);\n                this.lastDot = localSize * this.spacing;\n                this.lastInput.x = x;\n                this.lastInput.y = y;\n                this.lastInput.pressure = p;\n                this.lastInput2 = (0, $eWjiX.BB).copyObj(this.lastInput);\n                this.bezierLine = new (0, $eWjiX.BB).BezierLine();\n                this.bezierLine.add(x, y, 0, function() {\n                    return undefined;\n                });\n            }\n        },\n        {\n            key: \"goLine\",\n            value: function goLine(x, y, p) {\n                var _this_historyEntry_actions;\n                if (!this.started || !this.historyEntry) return;\n                (_this_historyEntry_actions = this.historyEntry.actions) === null || _this_historyEntry_actions === void 0 ? void 0 : _this_historyEntry_actions.push({\n                    action: \"goLine\",\n                    params: [\n                        x,\n                        y,\n                        p\n                    ]\n                });\n                this.continueLine(x, y, this.lastInput.pressure);\n                this.lastInput2 = (0, $eWjiX.BB).copyObj(this.lastInput);\n                this.lastInput.x = x;\n                this.lastInput.y = y;\n                this.lastInput.pressure = p;\n            }\n        },\n        {\n            key: \"endLine\",\n            value: function endLine() {\n                if (this.bezierLine) this.continueLine(undefined, undefined, this.lastInput.pressure);\n                this.started = false;\n                this.bezierLine = undefined;\n                if (this.historyEntry) {\n                    var _this_historyEntry_actions;\n                    (_this_historyEntry_actions = this.historyEntry.actions) === null || _this_historyEntry_actions === void 0 ? void 0 : _this_historyEntry_actions.push({\n                        action: \"endLine\",\n                        params: []\n                    });\n                    this.history.push(this.historyEntry);\n                    this.historyEntry = undefined;\n                }\n            }\n        },\n        {\n            key: \"drawLineSegment\",\n            value: function drawLineSegment(x1, y1, x2, y2) {\n                this.isBaseLayer = 0 === this.context.canvas.index;\n                this.lastInput.x = x2;\n                this.lastInput.y = y2;\n                if (this.started || x1 === undefined) return;\n                var mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n                var eX = (x2 - x1) / mouseDist;\n                var eY = (y2 - y1) / mouseDist;\n                var loopDist;\n                var bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * this.size * this.spacing);\n                this.lastDot = 0;\n                for(loopDist = this.lastDot; loopDist <= mouseDist; loopDist += bdist)this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.size, this.opacity);\n                var historyEntry = {\n                    tool: [\n                        \"brush\",\n                        \"EraserBrush\"\n                    ],\n                    actions: [\n                        {\n                            action: \"opacityPressure\",\n                            params: [\n                                this.useOpacityPressure\n                            ]\n                        },\n                        {\n                            action: \"sizePressure\",\n                            params: [\n                                this.useSizePressure\n                            ]\n                        },\n                        {\n                            action: \"setSize\",\n                            params: [\n                                this.size\n                            ]\n                        },\n                        {\n                            action: \"setOpacity\",\n                            params: [\n                                this.opacity\n                            ]\n                        },\n                        {\n                            action: \"setTransparentBG\",\n                            params: [\n                                this.isTransparentBG\n                            ]\n                        },\n                        {\n                            action: \"drawLineSegment\",\n                            params: [\n                                x1,\n                                y1,\n                                x2,\n                                y2\n                            ]\n                        }\n                    ]\n                };\n                this.history.push(historyEntry);\n            }\n        },\n        {\n            //IS\n            key: \"isDrawing\",\n            value: function isDrawing() {\n                return this.started;\n            }\n        },\n        {\n            //SET\n            key: \"setContext\",\n            value: function setContext(c) {\n                this.context = c;\n            }\n        },\n        {\n            key: \"setHistory\",\n            value: function setHistory(l) {\n                this.history = l;\n            }\n        },\n        {\n            key: \"setSize\",\n            value: function setSize(s) {\n                this.size = s;\n            }\n        },\n        {\n            key: \"setOpacity\",\n            value: function setOpacity(o) {\n                this.opacity = o;\n            }\n        },\n        {\n            key: \"sizePressure\",\n            value: function sizePressure(b) {\n                this.useSizePressure = b;\n            }\n        },\n        {\n            key: \"opacityPressure\",\n            value: function opacityPressure(b) {\n                this.useOpacityPressure = b;\n            }\n        },\n        {\n            key: \"setTransparentBG\",\n            value: function setTransparentBG(b) {\n                this.isTransparentBG = b;\n            }\n        },\n        {\n            //GET\n            key: \"getSize\",\n            value: function getSize() {\n                return this.size;\n            }\n        },\n        {\n            key: \"getOpacity\",\n            value: function getOpacity() {\n                return this.opacity;\n            }\n        }\n    ]);\n    return EraserBrush;\n}();\n\n});\n\nparcelRequire.register(\"ltaBP\", function(module, exports) {\n\n$parcel$export(module.exports, \"SmudgeBrush\", function () { return $78ad817c60f81b7c$export$c9f800961903deab; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $eg83P = parcelRequire(\"eg83P\");\n// let statCount = 1;\n// let statAcc = 0;\n// stats on win10, chrome, size 100, opacity 80, smudge()\n// unoptimized: 1 ms\n// minimal: 0.09 ms\n// minimal + circle: 0.5ms\n// minimal + circle + ix, iy: 0.23ms\n// unoptimized + ix, iy: 0.64 ms\n// unoptimized + ix, iy + sans rounding: 0.61 ms\n// ix, iy + sans rounding + sans random: 0.32ms\n// ix, iy + sans rounding + fast random: 0.46 ms\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\nvar $78ad817c60f81b7c$var$CELL_SIZE = 256;\n/**\r\n * determine bounds of smudge\r\n * @param imWidth\r\n * @param imHeight\r\n * @param aP\r\n * @param bP\r\n * @param size\r\n */ function $78ad817c60f81b7c$var$prepSmudge(imWidth, imHeight, aP, bP, size) {\n    if (aP.x === bP.x && aP.y === bP.y) return null;\n    aP = (0, $eWjiX.BB).copyObj(aP);\n    bP = (0, $eWjiX.BB).copyObj(bP);\n    size = (0, $eWjiX.BB).copyObj(size);\n    // corner behavior\n    // cut down rectangles, if a or b go outside\n    // i.e. if user drags partially or fully outside the canvas\n    {\n        var top = 0;\n        var right = 0;\n        var bottom = 0;\n        var left = 0;\n        if (aP.x < 0) left = -aP.x;\n        if (aP.y < 0) top = -aP.y;\n        if (bP.x < 0) left = Math.max(left, -bP.x);\n        if (bP.y < 0) top = Math.max(top, -bP.y);\n        if (aP.x + size.w > imWidth) right = aP.x + size.w - imWidth;\n        if (aP.y + size.h > imHeight) bottom = aP.y + size.h - imHeight;\n        if (bP.x + size.w > imWidth) right = Math.max(right, bP.x + size.w - imWidth);\n        if (bP.y + size.h > imHeight) bottom = Math.max(bottom, bP.y + size.h - imHeight);\n        aP.x += left;\n        bP.x += left;\n        aP.y += top;\n        bP.y += top;\n        size.w = size.w - left - right;\n        size.h = size.h - top - bottom;\n        if (size.w <= 0 || size.h <= 0) return null;\n    }\n    return {\n        aP: {\n            x: aP.x,\n            y: aP.y\n        },\n        bP: {\n            x: bP.x,\n            y: bP.y\n        },\n        size: {\n            w: size.w,\n            h: size.h\n        }\n    };\n}\n/**\r\n * Pixel operations that do the smudging via ImageData\r\n * @param imageData\r\n * @param p\r\n */ function $78ad817c60f81b7c$var$smudge(imageData, p) {\n    p = (0, $eWjiX.BB).copyObj(p);\n    var cSize = p.brush.size;\n    var cX = p.brush.center.x;\n    var cY = p.brush.center.y;\n    /*if (statCount % 1000 === 0) {\r\n        console.log(statAcc / 1000);\r\n        statAcc = 0;\r\n    }\r\n    let start = performance.now();*/ // determine offset\n    var aIndex = p.aP.y * imageData.width + p.aP.x;\n    var bIndex = p.bP.y * imageData.width + p.bP.x;\n    var offset = (bIndex - aIndex) * 4;\n    // array with random numbers. faster than Math.random()\n    var randI = 0;\n    var randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n    var randArr = [];\n    for(var i = 0; i < randLen; i++)randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n    var softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\n    var pixel = function(ai, bi, ix, iy) {\n        var dist = (0, $eWjiX.BB).dist(cX, cY, ix, iy);\n        var fac = 1 - p.brush.opacity * (1 - (0, $eg83P.clamp)((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\n        if (fac === 1) return;\n        if (!imageData.data[ai + 3]) ;\n        else if (!imageData.data[bi + 3]) {\n            imageData.data[bi] = imageData.data[ai];\n            imageData.data[bi + 1] = imageData.data[ai + 1];\n            imageData.data[bi + 2] = imageData.data[ai + 2];\n        } else {\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\n            // not totally accurate. TODO same compositing as blend brush\n            var fac2;\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\n            else fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\n            // No +0.5, because it cancels out with rand.\n            imageData.data[bi] = Math.floor((0, $eWjiX.BB).mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\n            imageData.data[bi + 1] = Math.floor((0, $eWjiX.BB).mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\n            imageData.data[bi + 2] = Math.floor((0, $eWjiX.BB).mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\n            randI = (randI + 1) % randLen;\n        }\n        // Always mix alpha. unless alpha lock\n        if (!p.brush.alphaLock) imageData.data[bi + 3] = Math.floor((0, $eWjiX.BB).mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\n    };\n    var bx1 = p.bP.x * 4;\n    var bx2 = bx1 + (p.size.w - 1) * 4;\n    // transfer of pixels depends on direction of smudging if there is overlap\n    if (p.aP.y < p.bP.y) for(var y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--){\n        var yStart = (y + p.bP.y) * imageData.width * 4;\n        for(var x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--)pixel(x2, x, ix, iy);\n    }\n    else if (p.aP.y > p.bP.y) for(var y1 = 0, iy1 = p.bP.y; y1 < p.size.h; y1++, iy1++){\n        var yStart1 = (y1 + p.bP.y) * imageData.width * 4;\n        for(var x1 = bx2 + yStart1, x21 = bx2 + yStart1 - offset, ix1 = p.bP.x + p.size.w - 1; x1 >= bx1 + yStart1; x1 -= 4, x21 -= 4, ix1--)pixel(x21, x1, ix1, iy1);\n    }\n    else {\n        if (p.aP.x < p.bP.x) for(var y2 = p.size.h - 1, iy2 = p.bP.y + p.size.h - 1; y2 >= 0; y2--, iy2--){\n            var yStart2 = (y2 + p.bP.y) * imageData.width * 4;\n            for(var x3 = bx2 + yStart2, x22 = bx2 + yStart2 - offset, ix2 = p.bP.x + p.size.w - 1; x3 >= bx1 + yStart2; x3 -= 4, x22 -= 4, ix2--)pixel(x22, x3, ix2, iy2);\n        }\n        else for(var y3 = 0, iy3 = p.bP.y; y3 < p.size.h; y3++, iy3++){\n            var yStart3 = (y3 + p.bP.y) * imageData.width * 4;\n            for(var x4 = bx1 + yStart3, x23 = bx1 + yStart3 - offset, ix3 = p.bP.x; x4 < bx2 + yStart3; x4 += 4, x23 += 4, ix3++)pixel(x23, x4, ix3, iy3);\n        }\n    }\n//statCount++;\n//statAcc += performance.now() - start;\n}\nvar $78ad817c60f81b7c$export$c9f800961903deab = /*#__PURE__*/ function() {\n    \"use strict\";\n    function SmudgeBrush() {\n        (0, $cx0mh._)(this, SmudgeBrush);\n        this.context = {};\n        this.history = new (0, $hrnUX.KL).DecoyKlHistory();\n        this.settingColor = {\n            r: 0,\n            g: 0,\n            b: 0\n        };\n        this.settingSize = 35;\n        this.settingSpacing = 0.20446882736951905;\n        this.settingOpacity = 0.8;\n        this.settingHasSizePressure = false;\n        this.settingHasOpacityPressure = false;\n        this.settingLockLayerAlpha = false;\n        this.lineToolLastDot = 0;\n        this.lastInput = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.lastInput2 = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.isDrawing = false;\n        this.copyImageData = {};\n        this.drawBuffer = [];\n        this.copiedCells = [];\n    }\n    (0, $7h4XF._)(SmudgeBrush, [\n        {\n            key: \"resetRedrawBounds\",\n            value: // workaround for https://github.com/microsoft/TypeScript/issues/41654\n            function resetRedrawBounds() {\n                this.redrawBounds = undefined;\n            }\n        },\n        {\n            key: \"updateRedrawBounds\",\n            value: function updateRedrawBounds(bounds) {\n                this.redrawBounds = (0, $eWjiX.BB).updateBounds(this.redrawBounds, bounds);\n            }\n        },\n        {\n            key: \"updateCompleteRedrawBounds\",\n            value: function updateCompleteRedrawBounds(x1, y1, x2, y2) {\n                this.completeRedrawBounds = (0, $eWjiX.BB).updateBounds(this.completeRedrawBounds, {\n                    x1: x1,\n                    y1: y1,\n                    x2: x2,\n                    y2: y2\n                });\n            }\n        },\n        {\n            /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */ key: \"copyFromCanvas\",\n            value: function copyFromCanvas() {\n                var _this = this;\n                var touchedCells = this.copiedCells.map(function() {\n                    return false;\n                });\n                var bounds = [];\n                var cellsW = Math.ceil(this.copyImageData.width / $78ad817c60f81b7c$var$CELL_SIZE);\n                if (!this.redrawBounds) return;\n                bounds.push({\n                    x1: Math.floor(this.redrawBounds.x1 / $78ad817c60f81b7c$var$CELL_SIZE),\n                    y1: Math.floor(this.redrawBounds.y1 / $78ad817c60f81b7c$var$CELL_SIZE),\n                    x2: Math.floor(this.redrawBounds.x2 / $78ad817c60f81b7c$var$CELL_SIZE),\n                    y2: Math.floor(this.redrawBounds.y2 / $78ad817c60f81b7c$var$CELL_SIZE)\n                });\n                bounds.forEach(function(item) {\n                    for(var i = item.x1; i <= item.x2; i++)for(var e = item.y1; e <= item.y2; e++)touchedCells[e * cellsW + i] = true;\n                });\n                touchedCells.forEach(function(item, i) {\n                    if (!item || _this.copiedCells[i]) // not touched, or already copied\n                    return;\n                    _this.copiedCells[i] = true;\n                    var x = i % cellsW;\n                    var y = Math.floor(i / cellsW);\n                    var w = (Math.min(x * $78ad817c60f81b7c$var$CELL_SIZE + $78ad817c60f81b7c$var$CELL_SIZE, _this.copyImageData.width) - 1) % $78ad817c60f81b7c$var$CELL_SIZE + 1;\n                    var h = (Math.min(y * $78ad817c60f81b7c$var$CELL_SIZE + $78ad817c60f81b7c$var$CELL_SIZE, _this.copyImageData.height) - 1) % $78ad817c60f81b7c$var$CELL_SIZE + 1;\n                    // temp canvas to prevent main canvas from getting slowed down in chrome\n                    var tmpCanvas = (0, $eWjiX.BB).canvas(w, h);\n                    var tmpCtx = (0, $eWjiX.BB).ctx(tmpCanvas);\n                    tmpCtx.drawImage(_this.context.canvas, -x * $78ad817c60f81b7c$var$CELL_SIZE, -y * $78ad817c60f81b7c$var$CELL_SIZE);\n                    var data = tmpCtx.getImageData(0, 0, w, h);\n                    for(var _$i = 0; _$i < h; _$i++)for(var e = 0, e2 = _$i * w * 4, e3 = ((y * $78ad817c60f81b7c$var$CELL_SIZE + _$i) * _this.copyImageData.width + x * $78ad817c60f81b7c$var$CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4){\n                        _this.copyImageData.data[e3] = data.data[e2];\n                        _this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\n                        _this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\n                        _this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\n                    }\n                });\n            }\n        },\n        {\n            /**\r\n     * fill drawBuffer with params about to be drawn\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     */ key: \"prepDot\",\n            value: function prepDot(x, y, size, opacity) {\n                if (!this.lastDot) {\n                    this.lastDot = {\n                        x: x,\n                        y: y\n                    };\n                    return;\n                }\n                size = Math.round(size);\n                var w = Math.round(size * 2);\n                var h = Math.round(size * 2);\n                var bounds = $78ad817c60f81b7c$var$prepSmudge(this.copyImageData.width, this.copyImageData.height, {\n                    x: Math.round(this.lastDot.x - size),\n                    y: Math.round(this.lastDot.y - size)\n                }, {\n                    x: Math.round(x - size),\n                    y: Math.round(y - size)\n                }, {\n                    w: w,\n                    h: h\n                });\n                if (bounds) {\n                    var params = {\n                        aP: bounds.aP,\n                        bP: bounds.bP,\n                        size: bounds.size,\n                        brush: {\n                            center: {\n                                x: x,\n                                y: y\n                            },\n                            size: size,\n                            opacity: opacity,\n                            alphaLock: this.settingLockLayerAlpha\n                        }\n                    };\n                    this.updateRedrawBounds({\n                        x1: params.bP.x,\n                        y1: params.bP.y,\n                        x2: params.bP.x + params.brush.size * 2,\n                        y2: params.bP.y + params.brush.size * 2\n                    });\n                    this.drawBuffer.push(params);\n                }\n                this.lastDot = {\n                    x: x,\n                    y: y\n                };\n            }\n        },\n        {\n            key: \"continueLine\",\n            value: function continueLine(x, y, size, pressure) {\n                var _this = this;\n                this.drawBuffer = [];\n                if (!this.bezierLine) {\n                    this.bezierLine = new (0, $eWjiX.BB).BezierLine();\n                    this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function() {});\n                }\n                var drawArr = []; //draw instructions. will be all drawn at once\n                var dotCallback = function(val) {\n                    var localPressure = (0, $eWjiX.BB).mix(_this.lastInput2.pressure, pressure, val.t);\n                    var localOpacity = _this.settingOpacity * (_this.settingHasOpacityPressure ? localPressure * localPressure : 1);\n                    var localSize = Math.max(0.1, _this.settingSize * (_this.settingHasSizePressure ? localPressure : 1));\n                    drawArr.push([\n                        val.x,\n                        val.y,\n                        localSize,\n                        localOpacity\n                    ]); //, val.angle]);\n                };\n                var localSpacing = size * this.settingSpacing / 3;\n                if (x === undefined || y === undefined) this.bezierLine.addFinal(localSpacing, dotCallback);\n                else this.bezierLine.add(x, y, localSpacing, dotCallback);\n                // execute draw instructions\n                for(var i = 0; i < drawArr.length; i++){\n                    var item = drawArr[i];\n                    this.prepDot(item[0], item[1], item[2], item[3]);\n                }\n                this.copyFromCanvas();\n                for(var i1 = 0; i1 < this.drawBuffer.length; i1++)$78ad817c60f81b7c$var$smudge(this.copyImageData, this.drawBuffer[i1]);\n            }\n        },\n        {\n            key: \"startLine\",\n            value: function startLine(x, y, p) {\n                this.historyEntry = {\n                    tool: [\n                        \"brush\",\n                        \"SmudgeBrush\"\n                    ],\n                    actions: []\n                };\n                p = (0, $eWjiX.BB).clamp(p, 0, 1);\n                var localOpacity = this.settingHasOpacityPressure ? this.settingOpacity * p * p : this.settingOpacity;\n                var localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\n                this.lastDot = undefined;\n                this.isDrawing = true;\n                this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\n                var totalCells = Math.ceil(this.context.canvas.width / $78ad817c60f81b7c$var$CELL_SIZE) * Math.ceil(this.context.canvas.height / $78ad817c60f81b7c$var$CELL_SIZE);\n                this.copiedCells = \"0\".repeat(totalCells).split(\"\").map(function() {\n                    return false;\n                });\n                this.prepDot(x, y, localSize, localOpacity);\n                this.lineToolLastDot = localSize * this.settingSpacing;\n                this.lastInput.x = x;\n                this.lastInput.y = y;\n                this.lastInput.pressure = p;\n                this.lastInput2.pressure = p;\n                this.completeRedrawBounds = undefined;\n            }\n        },\n        {\n            key: \"goLine\",\n            value: function goLine(x, y, p) {\n                if (!this.isDrawing) return;\n                this.resetRedrawBounds();\n                var pressure = (0, $eWjiX.BB).clamp(p, 0, 1);\n                var localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n                this.continueLine(x, y, localSize, this.lastInput.pressure);\n                if (this.redrawBounds) {\n                    this.context.putImageData(this.copyImageData, 0, 0, this.redrawBounds.x1, this.redrawBounds.y1, this.redrawBounds.x2 - this.redrawBounds.x1 - 1, this.redrawBounds.y2 - this.redrawBounds.y1 - 1);\n                    this.updateCompleteRedrawBounds(this.redrawBounds.x1, this.redrawBounds.y1, this.redrawBounds.x2, this.redrawBounds.y2);\n                }\n                this.lastInput.x = x;\n                this.lastInput.y = y;\n                this.lastInput2.pressure = this.lastInput.pressure;\n                this.lastInput.pressure = pressure;\n            }\n        },\n        {\n            key: \"endLine\",\n            value: function endLine() {\n                this.resetRedrawBounds();\n                var localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n                this.context.save();\n                this.continueLine(undefined, undefined, localSize, this.lastInput.pressure);\n                this.context.restore();\n                this.isDrawing = false;\n                this.bezierLine = undefined;\n                if (this.redrawBounds) {\n                    this.context.putImageData(this.copyImageData, 0, 0, this.redrawBounds.x1, this.redrawBounds.y1, this.redrawBounds.x2 - this.redrawBounds.x1 - 1, this.redrawBounds.y2 - this.redrawBounds.y1 - 1);\n                    this.updateCompleteRedrawBounds(this.redrawBounds.x1, this.redrawBounds.y1, this.redrawBounds.x2, this.redrawBounds.y2);\n                }\n                if (this.historyEntry && this.completeRedrawBounds) {\n                    var historyIm = this.copyImageData;\n                    if (!(this.completeRedrawBounds.x1 === 0 && this.completeRedrawBounds.y1 === 0 && this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 && this.completeRedrawBounds.y2 >= this.context.canvas.height - 1)) {\n                        // temp canvas to prevent main canvas from getting slowed down in chrome\n                        var tmpCanvas = (0, $eWjiX.BB).canvas(this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1, this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1);\n                        var tmpCtx = (0, $eWjiX.BB).ctx(tmpCanvas);\n                        tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\n                        historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\n                    }\n                    this.historyEntry.actions.push({\n                        action: \"drawImage\",\n                        params: [\n                            historyIm,\n                            this.completeRedrawBounds.x1,\n                            this.completeRedrawBounds.y1\n                        ]\n                    });\n                    this.history.push(this.historyEntry);\n                    this.historyEntry = undefined;\n                }\n                this.copyImageData = {};\n            }\n        },\n        {\n            key: \"drawImage\",\n            value: function drawImage(im, x, y) {\n                if (im instanceof ImageData) this.context.putImageData(im, x, y);\n                else {\n                    this.context.clearRect(x, y, im.width, im.height);\n                    this.context.drawImage(im, x, y);\n                }\n            }\n        },\n        {\n            key: \"drawLineSegment\",\n            value: function drawLineSegment(x1, y1, x2, y2) {\n                return;\n            /*\r\n        // todo\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = settingSize * settingSpacing;\r\n        lineToolLastDot = settingSize * settingSpacing;\r\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\r\n        }\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"SmudgeBrush\"],\r\n            actions: []\r\n        };\r\n        // todo\r\n        history.add(historyEntry);*/ }\n        },\n        {\n            key: \"getIsDrawing\",\n            value: function getIsDrawing() {\n                return this.isDrawing;\n            }\n        },\n        {\n            key: \"setColor\",\n            value: function setColor(c) {\n                if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) return;\n                this.settingColor = {\n                    r: c.r,\n                    g: c.g,\n                    b: c.b\n                };\n            }\n        },\n        {\n            key: \"setContext\",\n            value: function setContext(c) {\n                this.context = c;\n            }\n        },\n        {\n            key: \"setHistory\",\n            value: function setHistory(h) {\n                this.history = h;\n            }\n        },\n        {\n            key: \"setSize\",\n            value: function setSize(s) {\n                this.settingSize = s;\n            }\n        },\n        {\n            key: \"setOpacity\",\n            value: function setOpacity(o) {\n                this.settingOpacity = o;\n            }\n        },\n        {\n            key: \"setSpacing\",\n            value: function setSpacing(s) {\n                this.settingSpacing = s;\n            }\n        },\n        {\n            key: \"sizePressure\",\n            value: function sizePressure(b) {\n                this.settingHasSizePressure = b;\n            }\n        },\n        {\n            key: \"opacityPressure\",\n            value: function opacityPressure(b) {\n                this.settingHasOpacityPressure = b;\n            }\n        },\n        {\n            key: \"setLockAlpha\",\n            value: function setLockAlpha(b) {\n                this.settingLockLayerAlpha = b;\n            }\n        },\n        {\n            key: \"getSpacing\",\n            value: function getSpacing() {\n                return this.settingSpacing;\n            }\n        },\n        {\n            key: \"getSize\",\n            value: function getSize() {\n                return this.settingSize;\n            }\n        },\n        {\n            key: \"getOpacity\",\n            value: function getOpacity() {\n                return this.settingOpacity;\n            }\n        },\n        {\n            key: \"getLockAlpha\",\n            value: function getLockAlpha() {\n                return this.settingLockLayerAlpha;\n            }\n        }\n    ]);\n    return SmudgeBrush;\n}();\n\n});\n\nparcelRequire.register(\"6Nq1H\", function(module, exports) {\n\n$parcel$export(module.exports, \"ChemyBrush\", function () { return $348fcce123898af9$export$38b08aa4ea8f61c6; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $cL71g = parcelRequire(\"cL71g\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $fohxs = parcelRequire(\"fohxs\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\nvar $348fcce123898af9$export$38b08aa4ea8f61c6 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function ChemyBrush() {\n        (0, $cx0mh._)(this, ChemyBrush);\n        this.context = {};\n        this.settingColor = {};\n        this.settingSize = 0.25 // radius - 0.5 - 99999\n        ;\n        this.settingOpacity = 1 // 0-1\n        ;\n        this.settingLockLayerAlpha = false;\n        this.settingIsEraser = false;\n        this.settingMode = \"fill\";\n        this.settingDistort = 0 // 0 - 1\n        ;\n        this.settingXSymmetry = false;\n        this.settingYSymmetry = false;\n        this.settingGradient = false;\n        this.isDrawing = false;\n        this.history = new (0, $hrnUX.KL).DecoyKlHistory();\n        this.copyCanvas = {};\n        this.path = [];\n        this.minY = 0;\n        this.maxY = 0;\n    }\n    (0, $7h4XF._)(ChemyBrush, [\n        {\n            key: \"updateCompleteRedrawBounds\",\n            value: function updateCompleteRedrawBounds(x, y) {\n                var bounds = {\n                    x1: x,\n                    y1: y,\n                    x2: x,\n                    y2: y\n                };\n                if (this.settingXSymmetry) bounds = (0, $eWjiX.BB).updateBounds(bounds, {\n                    x1: -x + this.copyCanvas.width,\n                    y1: y,\n                    x2: -x + this.copyCanvas.width,\n                    y2: y\n                });\n                if (this.settingYSymmetry) bounds = (0, $eWjiX.BB).updateBounds(bounds, {\n                    x1: x,\n                    y1: -y + this.copyCanvas.height,\n                    x2: x,\n                    y2: -y + this.copyCanvas.height\n                });\n                var buffer = this.settingMode === \"stroke\" ? this.settingSize + 1 : 1;\n                bounds.x1 = Math.floor(bounds.x1 - buffer);\n                bounds.y1 = Math.floor(bounds.y1 - buffer);\n                bounds.x2 = Math.ceil(bounds.x2 + buffer);\n                bounds.y2 = Math.ceil(bounds.y2 + buffer);\n                this.completeRedrawBounds = (0, $eWjiX.BB).updateBounds(this.completeRedrawBounds, bounds);\n            }\n        },\n        {\n            key: \"drawShape\",\n            value: function drawShape() {\n                var _this = this;\n                this.context.save();\n                this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\n                this.context.drawImage(this.copyCanvas, 0, 0);\n                var color = (0, $cL71g._)({}, this.settingColor);\n                if (this.settingIsEraser) {\n                    color.r = (0, $fohxs.ERASE_COLOR);\n                    color.g = (0, $fohxs.ERASE_COLOR);\n                    color.b = (0, $fohxs.ERASE_COLOR);\n                    if (this.settingLockLayerAlpha) this.context.globalCompositeOperation = \"source-atop\";\n                    else this.context.globalCompositeOperation = \"destination-out\";\n                } else if (this.settingLockLayerAlpha) this.context.globalCompositeOperation = \"source-atop\";\n                if (this.path.length > 1) {\n                    // path\n                    var path = new Path2D();\n                    this.path.forEach(function(item, index) {\n                        if (index === 0) path.moveTo(item.x, item.y);\n                        else path.lineTo(item.x, item.y);\n                    });\n                    var style = (0, $eWjiX.BB).ColorConverter.toRgbaStr({\n                        r: color.r,\n                        g: color.g,\n                        b: color.b,\n                        a: this.settingOpacity\n                    });\n                    if (this.settingGradient) {\n                        var startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\n                        var gradient = this.context.createLinearGradient(0, startAtTop ? this.minY : this.maxY, 0, startAtTop ? this.maxY : this.minY);\n                        gradient.addColorStop(0, (0, $eWjiX.BB).ColorConverter.toRgbaStr({\n                            r: color.r,\n                            g: color.g,\n                            b: color.b,\n                            a: this.settingOpacity\n                        }));\n                        gradient.addColorStop(1, (0, $eWjiX.BB).ColorConverter.toRgbaStr({\n                            r: color.r,\n                            g: color.g,\n                            b: color.b,\n                            a: 0\n                        }));\n                        style = gradient;\n                    }\n                    // setup params\n                    if (this.settingMode === \"fill\") this.context.fillStyle = style;\n                    else {\n                        this.context.lineWidth = this.settingSize * 2;\n                        this.context.lineJoin = \"bevel\";\n                        this.context.strokeStyle = style;\n                    }\n                    // draw\n                    var draw = function() {\n                        if (_this.settingMode === \"fill\") _this.context.fill(path);\n                        else _this.context.stroke(path);\n                    };\n                    draw();\n                    if (this.settingXSymmetry) {\n                        this.context.save();\n                        this.context.translate(this.context.canvas.width / 2, 0);\n                        this.context.scale(-1, 1);\n                        this.context.translate(-this.context.canvas.width / 2, 0);\n                        draw();\n                        this.context.restore();\n                    }\n                    if (this.settingYSymmetry) {\n                        this.context.save();\n                        this.context.translate(0, this.context.canvas.height / 2);\n                        this.context.scale(1, -1);\n                        this.context.translate(0, -this.context.canvas.height / 2);\n                        draw();\n                        this.context.restore();\n                        if (this.settingXSymmetry) {\n                            this.context.save();\n                            this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\n                            this.context.scale(-1, -1);\n                            this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\n                            draw();\n                            this.context.restore();\n                        }\n                    }\n                }\n                this.context.restore();\n            }\n        },\n        {\n            key: \"setHistory\",\n            value: function setHistory(h) {\n                this.history = h;\n            }\n        },\n        {\n            key: \"getSize\",\n            value: function getSize() {\n                return this.settingMode === \"stroke\" ? this.settingSize : 0;\n            }\n        },\n        {\n            key: \"setSize\",\n            value: function setSize(s) {\n                this.settingSize = s;\n            }\n        },\n        {\n            key: \"getOpacity\",\n            value: function getOpacity() {\n                return this.settingOpacity;\n            }\n        },\n        {\n            key: \"setOpacity\",\n            value: function setOpacity(o) {\n                this.settingOpacity = o;\n            }\n        },\n        {\n            key: \"setColor\",\n            value: function setColor(c) {\n                this.settingColor = (0, $eWjiX.BB).copyObj(c);\n            }\n        },\n        {\n            key: \"setContext\",\n            value: function setContext(c) {\n                this.context = c;\n            }\n        },\n        {\n            key: \"setMode\",\n            value: function setMode(mode) {\n                this.settingMode = mode;\n            }\n        },\n        {\n            key: \"getMode\",\n            value: function getMode() {\n                return this.settingMode;\n            }\n        },\n        {\n            key: \"setDistort\",\n            value: function setDistort(distort) {\n                this.settingDistort = (0, $eWjiX.BB).clamp(distort, 0, 1);\n            }\n        },\n        {\n            key: \"getDistort\",\n            value: function getDistort() {\n                return this.settingDistort;\n            }\n        },\n        {\n            key: \"setXSymmetry\",\n            value: function setXSymmetry(b) {\n                this.settingXSymmetry = b;\n            }\n        },\n        {\n            key: \"getXSymmetry\",\n            value: function getXSymmetry() {\n                return this.settingXSymmetry;\n            }\n        },\n        {\n            key: \"setYSymmetry\",\n            value: function setYSymmetry(b) {\n                this.settingYSymmetry = b;\n            }\n        },\n        {\n            key: \"getYSymmetry\",\n            value: function getYSymmetry() {\n                return this.settingYSymmetry;\n            }\n        },\n        {\n            key: \"setGradient\",\n            value: function setGradient(b) {\n                this.settingGradient = b;\n            }\n        },\n        {\n            key: \"getGradient\",\n            value: function getGradient() {\n                return this.settingGradient;\n            }\n        },\n        {\n            key: \"getLockAlpha\",\n            value: function getLockAlpha() {\n                return this.settingLockLayerAlpha;\n            }\n        },\n        {\n            key: \"setLockAlpha\",\n            value: function setLockAlpha(b) {\n                this.settingLockLayerAlpha = b;\n            }\n        },\n        {\n            key: \"getIsEraser\",\n            value: function getIsEraser() {\n                return this.settingIsEraser;\n            }\n        },\n        {\n            key: \"setIsEraser\",\n            value: function setIsEraser(b) {\n                this.settingIsEraser = b;\n            }\n        },\n        {\n            key: \"getIsDrawing\",\n            value: function getIsDrawing() {\n                return this.isDrawing;\n            }\n        },\n        {\n            key: \"startLine\",\n            value: function startLine(x, y) {\n                this.isDrawing = true;\n                this.path = [\n                    {\n                        x: x,\n                        y: y\n                    }\n                ];\n                this.minY = y;\n                this.maxY = y;\n                this.copyCanvas = (0, $eWjiX.BB).canvas(this.context.canvas.width, this.context.canvas.height);\n                (0, $eWjiX.BB).ctx(this.copyCanvas).drawImage(this.context.canvas, 0, 0);\n                this.completeRedrawBounds = undefined;\n                this.updateCompleteRedrawBounds(x, y);\n            }\n        },\n        {\n            key: \"goLine\",\n            value: function goLine(x, y) {\n                if (!this.isDrawing) return;\n                var pos = {\n                    x: x,\n                    y: y\n                };\n                if (this.settingDistort > 0) {\n                    pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\n                    pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\n                }\n                this.minY = Math.min(this.minY, pos.y);\n                this.maxY = Math.max(this.maxY, pos.y);\n                this.path.push(pos);\n                this.updateCompleteRedrawBounds(x, y);\n                this.drawShape();\n            }\n        },\n        {\n            key: \"endLine\",\n            value: function endLine() {\n                this.isDrawing = false;\n                this.completeRedrawBounds = (0, $eWjiX.BB).boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\n                if (this.path.length > 1 && this.completeRedrawBounds) {\n                    var historyCanvas = (0, $eWjiX.BB).canvas(this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1, this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1);\n                    var historyCtx = (0, $eWjiX.BB).ctx(historyCanvas);\n                    historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\n                    this.history.push({\n                        tool: [\n                            \"brush\",\n                            \"ChemyBrush\"\n                        ],\n                        actions: [\n                            {\n                                action: \"drawImage\",\n                                params: [\n                                    historyCanvas,\n                                    this.completeRedrawBounds.x1,\n                                    this.completeRedrawBounds.y1\n                                ]\n                            }\n                        ]\n                    });\n                }\n                this.path = [];\n                this.copyCanvas = {};\n            }\n        },\n        {\n            key: \"drawImage\",\n            value: function drawImage(im, x, y) {\n                this.context.save();\n                this.context.clearRect(x, y, im.width, im.height);\n                this.context.drawImage(im, x, y);\n                this.context.restore();\n            }\n        },\n        {\n            key: \"drawLineSegment\",\n            value: function drawLineSegment(x1, y1, x2, y2) {\n            // might make sense for stroke\n            }\n        }\n    ]);\n    return ChemyBrush;\n}();\n\n});\n\n\nparcelRequire.register(\"3P46L\", function(module, exports) {\n\n$parcel$export(module.exports, \"brushesUI\", function () { return $7de2f0eab7a9ead7$export$f1561c72be54c6a7; });\n\nvar $cVFne = parcelRequire(\"cVFne\");\n\nvar $9mjXI = parcelRequire(\"9mjXI\");\n\nvar $iYbUv = parcelRequire(\"iYbUv\");\n\nvar $brjBD = parcelRequire(\"brjBD\");\n\nvar $9rc5F = parcelRequire(\"9rc5F\");\n\nvar $dS2qM = parcelRequire(\"dS2qM\");\n\nvar $vCnsd = parcelRequire(\"vCnsd\");\nvar $7de2f0eab7a9ead7$export$f1561c72be54c6a7 = {\n    penBrush: (0, $cVFne.penBrushUi),\n    blendBrush: (0, $9mjXI.blendBrushUi),\n    sketchyBrush: (0, $iYbUv.sketchyBrushUi),\n    pixelBrush: (0, $brjBD.pixelBrushUi),\n    chemyBrush: (0, $vCnsd.chemyBrushUi),\n    smudgeBrush: (0, $dS2qM.smudgeBrushUi),\n    eraserBrush: (0, $9rc5F.eraserBrushUi)\n};\n\n});\nparcelRequire.register(\"cVFne\", function(module, exports) {\n\n$parcel$export(module.exports, \"penBrushUi\", function () { return $8b6ca25eb0830594$export$a0d4983f3b0b5c8e; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $dAXbp = parcelRequire(\"dAXbp\");\n\nvar $7NTKy = parcelRequire(\"7NTKy\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $lCF5N = parcelRequire(\"lCF5N\");\n\nvar $iEKHy = parcelRequire(\"iEKHy\");\n\nvar $74D3O = parcelRequire(\"74D3O\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $iFIyy = parcelRequire(\"iFIyy\");\nvar $8b6ca25eb0830594$export$a0d4983f3b0b5c8e = function() {\n    var brushInterface = {\n        image: (0, (/*@__PURE__*/$parcel$interopDefault($iEKHy))),\n        tooltip: (0, $1mH1z.LANG)(\"brush-pen\"),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: (0, $eWjiX.BB).quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 0.01,\n            max: 1,\n            curve: [\n                [\n                    0,\n                    0.01\n                ],\n                [\n                    0.5,\n                    0.3\n                ],\n                [\n                    1,\n                    1\n                ]\n            ]\n        }\n    };\n    var alphaNames = [\n        (0, $1mH1z.LANG)(\"brush-pen-circle\"),\n        (0, $1mH1z.LANG)(\"brush-pen-chalk\"),\n        (0, $1mH1z.LANG)(\"brush-pen-calligraphy\"),\n        (0, $1mH1z.LANG)(\"brush-pen-square\")\n    ];\n    (0, $1mH1z.languageStrings).subscribe(function() {\n        brushInterface.tooltip = (0, $1mH1z.LANG)(\"brush-pen\");\n        alphaNames = [\n            (0, $1mH1z.LANG)(\"brush-pen-circle\"),\n            (0, $1mH1z.LANG)(\"brush-pen-chalk\"),\n            (0, $1mH1z.LANG)(\"brush-pen-calligraphy\"),\n            (0, $1mH1z.LANG)(\"brush-pen-square\")\n        ];\n    });\n    brushInterface.Ui = function(p) {\n        var setSize = function setSize(size) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        };\n        var init = function init() {\n            sizeSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"brush-size\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: (0, $7NTKy.eventResMs),\n                toDisplayValue: function(val) {\n                    return val * 2;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 2;\n                },\n                onChange: function(val) {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: function(displayValue) {\n                    if (displayValue < 10) return (0, $eWjiX.BB).round(displayValue, 1);\n                    else return Math.round(displayValue);\n                },\n                manualInputRoundDigits: 1\n            });\n            opacitySlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"opacity\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: (0, $7NTKy.eventResMs),\n                toDisplayValue: function(val) {\n                    return val * 100;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 100;\n                },\n                onChange: function(val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                }\n            });\n            var pressureSizeToggle = (0, $lCF5N.createPenPressureToggle)(true, function(b) {\n                brush.sizePressure(b);\n            });\n            var pressureOpacityToggle = (0, $lCF5N.createPenPressureToggle)(false, function(b) {\n                brush.opacityPressure(b);\n            });\n            div.append((0, $eWjiX.BB).el({\n                content: [\n                    sizeSlider.getElement(),\n                    pressureSizeToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\",\n                    marginBottom: \"10px\"\n                }\n            }), (0, $eWjiX.BB).el({\n                content: [\n                    opacitySlider.getElement(),\n                    pressureOpacityToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\"\n                }\n            }), (0, $eWjiX.BB).el({\n                content: alphaOptions.getElement(),\n                css: {\n                    marginTop: \"10px\"\n                }\n            }), (0, $eWjiX.BB).el({\n                content: lockAlphaToggle.getElement(),\n                css: {\n                    marginTop: \"10px\"\n                }\n            }));\n        };\n        var div = document.createElement(\"div\"); // the gui\n        var brush = new (0, $dAXbp.brushes).PenBrush();\n        brush.setHistory((0, $gWfkn.klHistory));\n        p.onSizeChange(brush.getSize());\n        var sizeSlider;\n        var opacitySlider;\n        var alphaOptions = new (0, $iFIyy.Options)({\n            optionArr: [\n                0,\n                1,\n                2,\n                3\n            ].map(function(id) {\n                var alpha = (0, $eWjiX.BB).el({\n                    className: \"dark-invert\",\n                    css: {\n                        width: \"31px\",\n                        height: \"31px\",\n                        backgroundSize: \"contain\",\n                        margin: \"2px\"\n                    }\n                });\n                var canvas = (0, $eWjiX.BB).canvas(70, 70);\n                var ctx = (0, $eWjiX.BB).ctx(canvas);\n                if (id === 0 || id === 3) {\n                    if (id === 0) {\n                        ctx.beginPath();\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\n                        ctx.closePath();\n                        ctx.fill();\n                    } else ctx.fillRect(5, 5, 60, 60);\n                } else if (id === 1) ctx.drawImage((0, $74D3O.genBrushAlpha01)(60), 5, 5);\n                else if (id === 2) ctx.drawImage((0, $74D3O.genBrushAlpha02)(60), 5, 5);\n                alpha.style.backgroundImage = \"url(\" + canvas.toDataURL(\"image/png\") + \")\";\n                return {\n                    id: id,\n                    label: alpha,\n                    title: alphaNames[id]\n                };\n            }),\n            initId: 0,\n            onChange: function(id) {\n                brush.setAlpha(id);\n            }\n        });\n        var lockAlphaToggle = new (0, $7bWhB.Checkbox)({\n            init: brush.getLockAlpha(),\n            label: (0, $1mH1z.LANG)(\"lock-alpha\"),\n            callback: function callback(b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: (0, $1mH1z.LANG)(\"lock-alpha-title\"),\n            css: {\n                display: \"inline-block\"\n            }\n        });\n        var spacingSpline = new (0, $eWjiX.BB).SplineInterpolator([\n            [\n                0,\n                15\n            ],\n            [\n                8,\n                7\n            ],\n            [\n                14,\n                4\n            ],\n            [\n                30,\n                3\n            ],\n            [\n                50,\n                2.7\n            ],\n            [\n                100,\n                2\n            ]\n        ]);\n        init();\n        this.increaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(f);\n        };\n        this.decreaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(-f);\n        };\n        this.getSize = function() {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function() {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function(c) {\n            brush.setColor(c);\n        };\n        this.setContext = function(c) {\n            brush.setContext(c);\n        };\n        this.startLine = function(x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function(x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function(x, y) {\n            brush.endLine(x, y);\n        };\n        this.getBrush = function() {\n            return brush;\n        };\n        this.isDrawing = function() {\n            return brush.isDrawing();\n        };\n        this.getElement = function() {\n            return div;\n        };\n    };\n    return brushInterface;\n}();\n\n});\nparcelRequire.register(\"7NTKy\", function(module, exports) {\n\n$parcel$export(module.exports, \"eventResMs\", function () { return $e8a5c017c49bb311$export$5ec472fd0ce20d84; });\nvar $e8a5c017c49bb311$export$5ec472fd0ce20d84 = 20;\n\n});\n\nparcelRequire.register(\"iEKHy\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"6218s\");\n\n});\n\n\nparcelRequire.register(\"9mjXI\", function(module, exports) {\n\n$parcel$export(module.exports, \"blendBrushUi\", function () { return $2e3c50106ba150d5$export$156bb4fe8f4bcb4b; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $lCF5N = parcelRequire(\"lCF5N\");\n\nvar $7NTKy = parcelRequire(\"7NTKy\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $dAXbp = parcelRequire(\"dAXbp\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $jxqXH = parcelRequire(\"jxqXH\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $2e3c50106ba150d5$export$156bb4fe8f4bcb4b = function() {\n    var brushInterface = {\n        image: (0, (/*@__PURE__*/$parcel$interopDefault($jxqXH))),\n        tooltip: (0, $1mH1z.LANG)(\"brush-blend\"),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: (0, $eWjiX.BB).quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 0.01,\n            max: 1\n        }\n    };\n    (0, $1mH1z.languageStrings).subscribe(function() {\n        brushInterface.tooltip = (0, $1mH1z.LANG)(\"brush-blend\");\n    });\n    brushInterface.Ui = function(p) {\n        var setSize = function setSize(size) {\n            brush.setSize(size);\n        };\n        var init = function init() {\n            sizeSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"brush-size\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: 58,\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: (0, $7NTKy.eventResMs),\n                toDisplayValue: function(val) {\n                    return val * 2;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 2;\n                },\n                onChange: function(val) {\n                    setSize(val);\n                    p.onSizeChange(val);\n                }\n            });\n            opacitySlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"opacity\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: (0, $7NTKy.eventResMs),\n                toDisplayValue: function(val) {\n                    return val * 100;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 100;\n                },\n                onChange: function(val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                }\n            });\n            var blendingSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"brush-blending\"),\n                width: 225,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: brush.getBlending(),\n                eventResMs: (0, $7NTKy.eventResMs),\n                toDisplayValue: function(val) {\n                    return val * 100;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 100;\n                },\n                onChange: function onChange(val) {\n                    brush.setBlending(val);\n                }\n            });\n            blendingSlider.getElement().style.marginTop = \"10px\";\n            var pressureSizeToggle = (0, $lCF5N.createPenPressureToggle)(true, function(b) {\n                brush.setSizePressure(b);\n            });\n            var pressureOpacityToggle = (0, $lCF5N.createPenPressureToggle)(false, function(b) {\n                brush.setOpacityPressure(b);\n            });\n            var lockAlphaToggle = new (0, $7bWhB.Checkbox)({\n                init: brush.getLockAlpha(),\n                label: (0, $1mH1z.LANG)(\"lock-alpha\"),\n                callback: function callback(b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: (0, $1mH1z.LANG)(\"lock-alpha-title\"),\n                css: {\n                    marginTop: \"10px\",\n                    display: \"inline-block\"\n                }\n            });\n            div.append((0, $eWjiX.BB).el({\n                content: [\n                    sizeSlider.getElement(),\n                    pressureSizeToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\",\n                    marginBottom: \"10px\"\n                }\n            }), (0, $eWjiX.BB).el({\n                content: [\n                    opacitySlider.getElement(),\n                    pressureOpacityToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\"\n                }\n            }), blendingSlider.getElement(), lockAlphaToggle.getElement());\n        };\n        var div = document.createElement(\"div\"); // the gui\n        var brush = new (0, $dAXbp.brushes).BlendBrush();\n        brush.setHistory((0, $gWfkn.klHistory));\n        p.onSizeChange(brush.getSize());\n        var sizeSlider;\n        var opacitySlider;\n        init();\n        this.increaseSize = function(f) {\n            if (!brush.getIsDrawing()) sizeSlider.changeSliderValue(f);\n        };\n        this.decreaseSize = function(f) {\n            if (!brush.getIsDrawing()) sizeSlider.changeSliderValue(-f);\n        };\n        this.getSize = function() {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function() {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function(c) {\n            brush.setColor(c);\n        };\n        this.setContext = function(c) {\n            brush.setContext(c);\n        };\n        this.startLine = function(x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function(x, y, p, isCoalesced) {\n            brush.goLine(x, y, p, isCoalesced);\n        };\n        this.endLine = function() {\n            brush.endLine();\n        };\n        this.getBrush = function() {\n            return brush;\n        };\n        this.isDrawing = function() {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function() {\n            return div;\n        };\n    };\n    return brushInterface;\n}();\n\n});\nparcelRequire.register(\"jxqXH\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"50oCU\");\n\n});\n\n\nparcelRequire.register(\"iYbUv\", function(module, exports) {\n\n$parcel$export(module.exports, \"sketchyBrushUi\", function () { return $94537af75923b9e3$export$ffae56164d1bde68; });\n\nvar $dAXbp = parcelRequire(\"dAXbp\");\n\nvar $7NTKy = parcelRequire(\"7NTKy\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $1SGPc = parcelRequire(\"1SGPc\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $94537af75923b9e3$export$ffae56164d1bde68 = function() {\n    var brushInterface = {\n        image: (0, (/*@__PURE__*/$parcel$interopDefault($1SGPc))),\n        tooltip: (0, $1mH1z.LANG)(\"brush-sketchy\"),\n        sizeSlider: {\n            min: 0.5,\n            max: 10\n        },\n        opacitySlider: {\n            min: 0.01,\n            max: 1\n        }\n    };\n    (0, $1mH1z.languageStrings).subscribe(function() {\n        brushInterface.tooltip = (0, $1mH1z.LANG)(\"brush-sketchy\");\n    });\n    brushInterface.Ui = function(p) {\n        var setSize = function setSize(size) {\n            brush.setSize(size);\n        };\n        var init = function init() {\n            sizeSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"brush-size\"),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize() * 2,\n                eventResMs: (0, $7NTKy.eventResMs),\n                toDisplayValue: function(val) {\n                    return val * 2;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 2;\n                },\n                onChange: function onChange(val) {\n                    brush.setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: function(displayValue) {\n                    if (displayValue < 10) return (0, $eWjiX.BB).round(displayValue, 1);\n                    else return Math.round(displayValue);\n                },\n                manualInputRoundDigits: 1\n            });\n            opacitySlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"opacity\"),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                eventResMs: (0, $7NTKy.eventResMs),\n                toDisplayValue: function(val) {\n                    return val * 100;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 100;\n                },\n                onChange: function(val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                }\n            });\n            var blendSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"brush-blending\"),\n                width: 250,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: brush.getBlending(),\n                eventResMs: (0, $7NTKy.eventResMs),\n                toDisplayValue: function(val) {\n                    return val * 100;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 100;\n                },\n                onChange: function onChange(val) {\n                    brush.setBlending(val);\n                }\n            });\n            var scaleSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"brush-sketchy-scale\"),\n                width: 250,\n                height: 30,\n                min: 1,\n                max: 20,\n                value: brush.getScale(),\n                eventResMs: (0, $7NTKy.eventResMs),\n                onChange: function onChange(val) {\n                    brush.setScale(val);\n                }\n            });\n            opacitySlider.getElement().style.marginTop = \"10px\";\n            blendSlider.getElement().style.marginTop = \"10px\";\n            scaleSlider.getElement().style.marginTop = \"10px\";\n            div.append(sizeSlider.getElement(), opacitySlider.getElement(), blendSlider.getElement(), scaleSlider.getElement());\n        };\n        var div = document.createElement(\"div\"); // the gui\n        var brush = new (0, $dAXbp.brushes).SketchyBrush();\n        brush.setHistory((0, $gWfkn.klHistory));\n        p.onSizeChange(brush.getSize());\n        var sizeSlider;\n        var opacitySlider;\n        init();\n        this.increaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(f);\n        };\n        this.decreaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(-f);\n        };\n        this.getSize = function() {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function() {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function(c) {\n            brush.setColor(c);\n        };\n        this.setContext = function(c) {\n            brush.setContext(c);\n        };\n        this.startLine = function(x, y, pressure) {\n            brush.startLine(x, y, pressure);\n        };\n        this.goLine = function(x, y, pressure) {\n            brush.goLine(x, y, pressure, undefined);\n        };\n        this.endLine = function() {\n            brush.endLine();\n        };\n        this.getSeed = function() {\n            return parseInt(\"\" + brush.getSeed());\n        };\n        this.setSeed = function(s) {\n            brush.setSeed(parseInt(\"\" + s));\n        };\n        this.getBrush = function() {\n            return brush;\n        };\n        this.isDrawing = function() {\n            return brush.isDrawing();\n        };\n        this.getElement = function() {\n            return div;\n        };\n    };\n    return brushInterface;\n}();\n\n});\nparcelRequire.register(\"1SGPc\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"jDYzC\");\n\n});\n\n\nparcelRequire.register(\"brjBD\", function(module, exports) {\n\n$parcel$export(module.exports, \"pixelBrushUi\", function () { return $9519e739bc9666ee$export$d001f3406562d07; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $dAXbp = parcelRequire(\"dAXbp\");\n\nvar $7NTKy = parcelRequire(\"7NTKy\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $lCF5N = parcelRequire(\"lCF5N\");\n\nvar $1qfk4 = parcelRequire(\"1qfk4\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $9519e739bc9666ee$export$d001f3406562d07 = function() {\n    var brushInterface = {\n        image: (0, (/*@__PURE__*/$parcel$interopDefault($1qfk4))),\n        tooltip: (0, $1mH1z.LANG)(\"brush-pixel\"),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: (0, $eWjiX.BB).quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 0.01,\n            max: 1,\n            curve: [\n                [\n                    0,\n                    0.01\n                ],\n                [\n                    0.5,\n                    0.3\n                ],\n                [\n                    1,\n                    1\n                ]\n            ]\n        }\n    };\n    (0, $1mH1z.languageStrings).subscribe(function() {\n        brushInterface.tooltip = (0, $1mH1z.LANG)(\"brush-pixel\");\n    });\n    brushInterface.Ui = function(p) {\n        var setSize = function setSize(size) {\n            brush.setSize(size);\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\n        };\n        var init = function init() {\n            sizeSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"brush-size\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: (0, $7NTKy.eventResMs),\n                toDisplayValue: function(val) {\n                    return val * 2;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 2;\n                },\n                onChange: function(val) {\n                    setSize(val);\n                    p.onSizeChange(val);\n                }\n            });\n            opacitySlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"opacity\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                eventResMs: (0, $7NTKy.eventResMs),\n                toDisplayValue: function(val) {\n                    return val * 100;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 100;\n                },\n                onChange: function(val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                }\n            });\n            var pressureSizeToggle = (0, $lCF5N.createPenPressureToggle)(true, function(b) {\n                brush.sizePressure(b);\n            });\n            div.append((0, $eWjiX.BB).el({\n                content: [\n                    sizeSlider.getElement(),\n                    pressureSizeToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\",\n                    marginBottom: \"10px\"\n                }\n            }), opacitySlider.getElement());\n            var toggleRow = (0, $eWjiX.BB).el({\n                parent: div,\n                css: {\n                    display: \"flex\",\n                    marginTop: \"10px\"\n                }\n            });\n            toggleRow.append(lockAlphaToggle.getElement(), eraserToggle.getElement(), ditherToggle.getElement());\n        };\n        var div = document.createElement(\"div\"); // the gui\n        var brush = new (0, $dAXbp.brushes).PixelBrush();\n        brush.setHistory((0, $gWfkn.klHistory));\n        p.onSizeChange(brush.getSize());\n        var sizeSlider;\n        var opacitySlider;\n        var lockAlphaToggle = new (0, $7bWhB.Checkbox)({\n            init: brush.getLockAlpha(),\n            label: (0, $1mH1z.LANG)(\"lock-alpha\"),\n            callback: function callback(b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: (0, $1mH1z.LANG)(\"lock-alpha-title\"),\n            css: {\n                marginRight: \"10px\"\n            }\n        });\n        var eraserToggle = new (0, $7bWhB.Checkbox)({\n            init: brush.getIsEraser(),\n            label: (0, $1mH1z.LANG)(\"eraser\"),\n            callback: function callback(b) {\n                brush.setIsEraser(b);\n            },\n            css: {\n                marginRight: \"10px\"\n            }\n        });\n        var ditherToggle = new (0, $7bWhB.Checkbox)({\n            init: brush.getUseDither(),\n            label: (0, $1mH1z.LANG)(\"brush-pixel-dither\"),\n            callback: function callback(b) {\n                brush.setUseDither(b);\n            }\n        });\n        var spacingSpline = new (0, $eWjiX.BB).SplineInterpolator([\n            [\n                0.5,\n                0.45\n            ],\n            [\n                100,\n                4\n            ]\n        ]);\n        init();\n        this.increaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(f);\n        };\n        this.decreaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(-f);\n        };\n        this.getSize = function() {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size * 2);\n        };\n        this.getOpacity = function() {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity * 100);\n        };\n        this.setColor = function(c) {\n            brush.setColor(c);\n        };\n        this.setContext = function(c) {\n            brush.setContext(c);\n        };\n        this.startLine = function(x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function(x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function(x, y) {\n            brush.endLine(x, y);\n        };\n        this.getBrush = function() {\n            return brush;\n        };\n        this.isDrawing = function() {\n            return brush.isDrawing();\n        };\n        this.toggleEraser = function() {\n            eraserToggle.setValue(!eraserToggle.getValue());\n            brush.setIsEraser(eraserToggle.getValue());\n        };\n        this.getElement = function() {\n            return div;\n        };\n    };\n    return brushInterface;\n}();\n\n});\nparcelRequire.register(\"1qfk4\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"j07R3\");\n\n});\n\n\nparcelRequire.register(\"9rc5F\", function(module, exports) {\n\n$parcel$export(module.exports, \"eraserBrushUi\", function () { return $d6fc2ded7d9d56db$export$cf481ecf227135a8; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $dAXbp = parcelRequire(\"dAXbp\");\n\nvar $7NTKy = parcelRequire(\"7NTKy\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $lCF5N = parcelRequire(\"lCF5N\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $6kk87 = parcelRequire(\"6kk87\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $d6fc2ded7d9d56db$export$cf481ecf227135a8 = function() {\n    var brushInterface = {\n        image: (0, (/*@__PURE__*/$parcel$interopDefault($6kk87))),\n        tooltip: (0, $1mH1z.LANG)(\"eraser\") + \" [E]\",\n        sizeSlider: {\n            min: 0.5,\n            max: 200,\n            curve: (0, $eWjiX.BB).quadraticSplineInput(0.5, 200, 0.1)\n        },\n        opacitySlider: {\n            min: 0.01,\n            max: 1\n        }\n    };\n    (0, $1mH1z.languageStrings).subscribe(function() {\n        brushInterface.tooltip = (0, $1mH1z.LANG)(\"eraser\") + \" [E]\";\n    });\n    brushInterface.Ui = function(p) {\n        var setSize = function setSize(size) {\n            brush.setSize(size);\n        };\n        var init = function init() {\n            sizeSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"brush-size\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: 30,\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: (0, $7NTKy.eventResMs),\n                toDisplayValue: function(val) {\n                    return val * 2;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 2;\n                },\n                onChange: function(val) {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: function(displayValue) {\n                    if (displayValue < 10) return (0, $eWjiX.BB).round(displayValue, 1);\n                    else return Math.round(displayValue);\n                },\n                manualInputRoundDigits: 1\n            });\n            opacitySlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"opacity\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                eventResMs: (0, $7NTKy.eventResMs),\n                toDisplayValue: function(val) {\n                    return val * 100;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 100;\n                },\n                onChange: function(val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                }\n            });\n            var pressureSizeToggle = (0, $lCF5N.createPenPressureToggle)(true, function(b) {\n                brush.sizePressure(b);\n            });\n            var pressureOpacityToggle = (0, $lCF5N.createPenPressureToggle)(false, function(b) {\n                brush.opacityPressure(b);\n            });\n            div.append((0, $eWjiX.BB).el({\n                content: [\n                    sizeSlider.getElement(),\n                    pressureSizeToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\",\n                    marginBottom: \"10px\"\n                }\n            }), (0, $eWjiX.BB).el({\n                content: [\n                    opacitySlider.getElement(),\n                    pressureOpacityToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\"\n                }\n            }));\n            var transparencyToggle = new (0, $7bWhB.Checkbox)({\n                init: false,\n                label: (0, $1mH1z.LANG)(\"brush-eraser-transparent-bg\"),\n                callback: function callback(b) {\n                    isTransparentBg = b;\n                    brush.setTransparentBG(b);\n                },\n                css: {\n                    marginTop: \"10px\"\n                }\n            });\n            div.append(transparencyToggle.getElement());\n        };\n        var div = document.createElement(\"div\"); // the gui\n        var brush = new (0, $dAXbp.brushes).EraserBrush();\n        brush.setHistory((0, $gWfkn.klHistory));\n        p.onSizeChange(brush.getSize());\n        var sizeSlider;\n        var opacitySlider;\n        var isTransparentBg = false;\n        init();\n        this.increaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(f);\n        };\n        this.decreaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(-f);\n        };\n        this.getSize = function() {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function() {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function() {};\n        this.setContext = function(c) {\n            brush.setContext(c);\n        };\n        this.startLine = function(x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function(x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function() {\n            brush.endLine();\n        };\n        this.getBrush = function() {\n            return brush;\n        };\n        this.getIsTransparentBg = function() {\n            return isTransparentBg;\n        };\n        this.isDrawing = function() {\n            return brush.isDrawing();\n        };\n        this.getElement = function() {\n            return div;\n        };\n    };\n    return brushInterface;\n}();\n\n});\nparcelRequire.register(\"6kk87\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"fvqmo\");\n\n});\n\n\nparcelRequire.register(\"dS2qM\", function(module, exports) {\n\n$parcel$export(module.exports, \"smudgeBrushUi\", function () { return $1045b9bae2ffbbb4$export$84831662ba707e7a; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $dAXbp = parcelRequire(\"dAXbp\");\n\nvar $7NTKy = parcelRequire(\"7NTKy\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $lCF5N = parcelRequire(\"lCF5N\");\n\nvar $1rnhH = parcelRequire(\"1rnhH\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $1045b9bae2ffbbb4$export$84831662ba707e7a = function() {\n    var brushInterface = {\n        image: (0, (/*@__PURE__*/$parcel$interopDefault($1rnhH))),\n        tooltip: (0, $1mH1z.LANG)(\"brush-smudge\"),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: (0, $eWjiX.BB).quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 0.01,\n            max: 1,\n            curve: [\n                [\n                    0,\n                    0.01\n                ],\n                [\n                    0.5,\n                    0.3\n                ],\n                [\n                    1,\n                    1\n                ]\n            ]\n        }\n    };\n    (0, $1mH1z.languageStrings).subscribe(function() {\n        brushInterface.tooltip = (0, $1mH1z.LANG)(\"brush-smudge\");\n    });\n    brushInterface.Ui = function(p) {\n        var setSize = function setSize(size) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        };\n        var init = function init() {\n            sizeSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"brush-size\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: (0, $7NTKy.eventResMs),\n                toDisplayValue: function(val) {\n                    return val * 2;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 2;\n                },\n                onChange: function(val) {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: function(displayValue) {\n                    if (displayValue < 10) return (0, $eWjiX.BB).round(displayValue, 1);\n                    else return Math.round(displayValue);\n                },\n                manualInputRoundDigits: 1\n            });\n            opacitySlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"opacity\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: (0, $7NTKy.eventResMs),\n                toDisplayValue: function(val) {\n                    return val * 100;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 100;\n                },\n                onChange: function(val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                }\n            });\n            var pressureSizeToggle = (0, $lCF5N.createPenPressureToggle)(false, function(b) {\n                brush.sizePressure(b);\n            });\n            var pressureOpacityToggle = (0, $lCF5N.createPenPressureToggle)(false, function(b) {\n                brush.opacityPressure(b);\n            });\n            div.append((0, $eWjiX.BB).el({\n                content: [\n                    sizeSlider.getElement(),\n                    pressureSizeToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\",\n                    marginBottom: \"10px\"\n                }\n            }), (0, $eWjiX.BB).el({\n                content: [\n                    opacitySlider.getElement(),\n                    pressureOpacityToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\"\n                }\n            }));\n            var bottomRow = (0, $eWjiX.BB).el({\n                parent: div,\n                css: {\n                    marginTop: \"10px\"\n                }\n            });\n            bottomRow.append(lockAlphaToggle.getElement());\n        };\n        var div = document.createElement(\"div\"); // the gui\n        var brush = new (0, $dAXbp.brushes).SmudgeBrush();\n        brush.setHistory((0, $gWfkn.klHistory));\n        p.onSizeChange(brush.getSize());\n        var sizeSlider;\n        var opacitySlider;\n        var lockAlphaToggle = new (0, $7bWhB.Checkbox)({\n            init: brush.getLockAlpha(),\n            label: (0, $1mH1z.LANG)(\"lock-alpha\"),\n            callback: function callback(b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: (0, $1mH1z.LANG)(\"lock-alpha-title\")\n        });\n        var spacingSpline = new (0, $eWjiX.BB).SplineInterpolator([\n            [\n                0,\n                15\n            ],\n            [\n                8,\n                7\n            ],\n            [\n                14,\n                4\n            ],\n            [\n                30,\n                3\n            ],\n            [\n                50,\n                2.7\n            ],\n            [\n                100,\n                2\n            ]\n        ]);\n        init();\n        this.increaseSize = function(f) {\n            if (!brush.getIsDrawing()) sizeSlider.changeSliderValue(f);\n        };\n        this.decreaseSize = function(f) {\n            if (!brush.getIsDrawing()) sizeSlider.changeSliderValue(-f);\n        };\n        this.getSize = function() {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function() {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function(c) {\n            brush.setColor(c);\n        };\n        this.setContext = function(c) {\n            brush.setContext(c);\n        };\n        this.startLine = function(x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function(x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function() {\n            brush.endLine();\n        };\n        this.getBrush = function() {\n            return brush;\n        };\n        this.isDrawing = function() {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function() {\n            return div;\n        };\n    };\n    return brushInterface;\n}();\n\n});\nparcelRequire.register(\"1rnhH\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"gNPk4\");\n\n});\n\n\nparcelRequire.register(\"vCnsd\", function(module, exports) {\n\n$parcel$export(module.exports, \"chemyBrushUi\", function () { return $18456e8104a5a825$export$80819a93636ebb04; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $7NTKy = parcelRequire(\"7NTKy\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $dAXbp = parcelRequire(\"dAXbp\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $5rmB7 = parcelRequire(\"5rmB7\");\n\nvar $iFIyy = parcelRequire(\"iFIyy\");\n\nvar $cmnov = parcelRequire(\"cmnov\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $18456e8104a5a825$export$80819a93636ebb04 = function() {\n    var brushInterface = {\n        image: (0, (/*@__PURE__*/$parcel$interopDefault($5rmB7))),\n        tooltip: (0, $1mH1z.LANG)(\"brush-chemy\"),\n        sizeSlider: {\n            min: 0.25,\n            max: 25,\n            curve: (0, $eWjiX.BB).quadraticSplineInput(0.25, 25, 0.1),\n            isDisabled: true\n        },\n        opacitySlider: {\n            min: 0.01,\n            max: 1\n        }\n    };\n    (0, $1mH1z.languageStrings).subscribe(function() {\n        brushInterface.tooltip = (0, $1mH1z.LANG)(\"brush-chemy\");\n    });\n    brushInterface.Ui = function(p) {\n        var setSize = function setSize(size) {\n            brush.setSize(size);\n        };\n        var init = function init() {\n            sizeSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"brush-size\"),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: (0, $7NTKy.eventResMs),\n                isEnabled: brush.getMode() === \"stroke\",\n                toDisplayValue: function(val) {\n                    return val * 2;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 2;\n                },\n                onChange: function(val) {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: function(displayValue) {\n                    if (displayValue < 5) return (0, $eWjiX.BB).round(displayValue, 1);\n                    else return Math.round(displayValue);\n                },\n                manualInputRoundDigits: 1\n            });\n            opacitySlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"opacity\"),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                eventResMs: (0, $7NTKy.eventResMs),\n                toDisplayValue: function(val) {\n                    return val * 100;\n                },\n                toValue: function(displayValue) {\n                    return displayValue / 100;\n                },\n                onChange: function(val) {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                }\n            });\n            (0, $eWjiX.BB).css(opacitySlider.getElement(), {\n                marginTop: \"10px\"\n            });\n            eraserToggle = new (0, $7bWhB.Checkbox)({\n                init: brush.getIsEraser(),\n                label: (0, $1mH1z.LANG)(\"eraser\"),\n                callback: function callback(b) {\n                    brush.setIsEraser(b);\n                },\n                css: {\n                    marginTop: \"10px\",\n                    marginLeft: \"10px\"\n                }\n            });\n            var lockAlphaToggle = new (0, $7bWhB.Checkbox)({\n                init: brush.getLockAlpha(),\n                label: (0, $1mH1z.LANG)(\"lock-alpha\"),\n                callback: function callback(b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: (0, $1mH1z.LANG)(\"lock-alpha-title\"),\n                css: {\n                    marginTop: \"10px\"\n                }\n            });\n            var toggleRow = (0, $eWjiX.BB).el({\n                css: {\n                    display: \"flex\",\n                    marginTop: \"10px\"\n                }\n            });\n            var iconSize = 35;\n            var padding = 8;\n            var actualIconSize = iconSize - padding * 2;\n            var halfSize = actualIconSize / 2;\n            var modeOptions = new (0, $iFIyy.Options)({\n                optionArr: [\n                    {\n                        id: \"fill\",\n                        label: (0, $eWjiX.BB).createSvg({\n                            class: \"dark-invert\",\n                            elementType: \"svg\",\n                            width: iconSize + \"\",\n                            height: iconSize + \"\",\n                            childrenArr: [\n                                {\n                                    elementType: \"path\",\n                                    fill: \"#000\",\n                                    style: \"transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(\".concat(actualIconSize, \", \").concat(actualIconSize, \") translate(0.5px, 0.5px)\"),\n                                    d: \"M 0,0 C 1.5,0 -0.5,1 1,1\"\n                                }\n                            ]\n                        }),\n                        title: (0, $1mH1z.LANG)(\"brush-chemy-fill\")\n                    },\n                    {\n                        id: \"stroke\",\n                        label: (0, $eWjiX.BB).createSvg({\n                            class: \"dark-invert\",\n                            elementType: \"svg\",\n                            width: iconSize + \"\",\n                            height: iconSize + \"\",\n                            childrenArr: [\n                                {\n                                    elementType: \"path\",\n                                    fill: \"none\",\n                                    stroke: \"#000\",\n                                    style: \"stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(\".concat(actualIconSize, \", \").concat(actualIconSize, \") translate(0.5px, 0.5px)\"),\n                                    d: \"M 0,0 C 1.5,0 -0.5,1 1,1\"\n                                }\n                            ]\n                        }),\n                        title: (0, $1mH1z.LANG)(\"brush-chemy-stroke\")\n                    }\n                ],\n                initId: brush.getMode(),\n                onChange: function(id) {\n                    brush.setMode(id);\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === \"fill\";\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\n                    var brushSize = brush.getSize();\n                    sizeSlider.setValue(brushSize);\n                    p.onSizeChange(brushSize);\n                    p.onConfigChange();\n                }\n            });\n            var mirrorXToggle = new (0, $cmnov.BoxToggle)({\n                label: (0, $eWjiX.BB).createSvg({\n                    class: \"dark-invert\",\n                    elementType: \"svg\",\n                    width: iconSize + \"\",\n                    height: iconSize + \"\",\n                    childrenArr: [\n                        {\n                            elementType: \"path\",\n                            fill: \"none\",\n                            stroke: \"#000\",\n                            style: \"stroke-width: 1px\",\n                            d: \"M \".concat(halfSize + padding, \",\").concat(padding, \" \").concat(halfSize + padding, \",\").concat(actualIconSize + padding)\n                        }\n                    ]\n                }),\n                title: (0, $1mH1z.LANG)(\"brush-chemy-mirror-x\"),\n                init: brush.getXSymmetry(),\n                onChange: function(b) {\n                    brush.setXSymmetry(b);\n                }\n            });\n            var mirrorYToggle = new (0, $cmnov.BoxToggle)({\n                label: (0, $eWjiX.BB).createSvg({\n                    class: \"dark-invert\",\n                    elementType: \"svg\",\n                    width: iconSize + \"\",\n                    height: iconSize + \"\",\n                    childrenArr: [\n                        {\n                            elementType: \"path\",\n                            fill: \"none\",\n                            stroke: \"#000\",\n                            style: \"stroke-width: 1px\",\n                            d: \"M \".concat(padding, \",\").concat(halfSize + padding, \" \").concat(actualIconSize + padding, \",\").concat(halfSize + padding)\n                        }\n                    ]\n                }),\n                title: (0, $1mH1z.LANG)(\"brush-chemy-mirror-y\"),\n                init: brush.getYSymmetry(),\n                onChange: function(b) {\n                    brush.setYSymmetry(b);\n                }\n            });\n            var gradientToggle = new (0, $cmnov.BoxToggle)({\n                label: (0, $eWjiX.BB).createSvg({\n                    class: \"dark-invert\",\n                    elementType: \"svg\",\n                    width: iconSize + \"\",\n                    height: iconSize + \"\",\n                    childrenArr: [\n                        {\n                            elementType: \"defs\",\n                            childrenArr: [\n                                {\n                                    elementType: \"linearGradient\",\n                                    id: \"gradient\",\n                                    x1: \"0\",\n                                    y1: \"0\",\n                                    x2: \"0\",\n                                    y2: \"1\",\n                                    childrenArr: [\n                                        {\n                                            elementType: \"stop\",\n                                            offset: \"0%\",\n                                            \"stop-color\": \"rgba(0,0,0,0)\"\n                                        },\n                                        {\n                                            elementType: \"stop\",\n                                            offset: \"100%\",\n                                            \"stop-color\": \"rgba(0,0,0,1)\"\n                                        }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            elementType: \"rect\",\n                            fill: \"url('#gradient')\",\n                            x: \"\" + padding,\n                            y: \"\" + padding,\n                            width: \"\" + actualIconSize,\n                            height: \"\" + actualIconSize\n                        }\n                    ]\n                }),\n                title: (0, $1mH1z.LANG)(\"brush-chemy-gradient\"),\n                init: brush.getGradient(),\n                onChange: function(b) {\n                    brush.setGradient(b);\n                }\n            });\n            (0, $eWjiX.BB).css(mirrorXToggle.getElement(), {\n                marginLeft: \"10px\"\n            });\n            {\n                var margin = {\n                    marginLeft: \"4px\"\n                };\n                (0, $eWjiX.BB).css(mirrorYToggle.getElement(), margin);\n                (0, $eWjiX.BB).css(gradientToggle.getElement(), margin);\n            }\n            toggleRow.append(modeOptions.getElement(), mirrorXToggle.getElement(), mirrorYToggle.getElement(), gradientToggle.getElement());\n            div.append(sizeSlider.getElement(), opacitySlider.getElement(), toggleRow, (0, $eWjiX.BB).el({\n                content: [\n                    lockAlphaToggle.getElement(),\n                    eraserToggle.getElement()\n                ],\n                css: {\n                    display: \"flex\"\n                }\n            }));\n        };\n        var div = document.createElement(\"div\"); // the gui\n        var brush = new (0, $dAXbp.brushes).ChemyBrush();\n        brush.setHistory((0, $gWfkn.klHistory));\n        p.onSizeChange(brush.getSize());\n        var sizeSlider;\n        var opacitySlider;\n        var eraserToggle;\n        init();\n        this.increaseSize = function(f) {\n            if (!brush.getIsDrawing() && brush.getMode() === \"stroke\") sizeSlider.changeSliderValue(f);\n        };\n        this.decreaseSize = function(f) {\n            if (!brush.getIsDrawing() && brush.getMode() === \"stroke\") sizeSlider.changeSliderValue(-f);\n        };\n        this.getSize = function() {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function() {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function(c) {\n            brush.setColor(c);\n        };\n        this.setContext = function(c) {\n            brush.setContext(c);\n        };\n        this.startLine = function(x, y, p) {\n            brush.startLine(x, y);\n        };\n        this.goLine = function(x, y, p, isCoalesced) {\n            brush.goLine(x, y);\n        };\n        this.endLine = function() {\n            brush.endLine();\n        };\n        this.getBrush = function() {\n            return brush;\n        };\n        this.isDrawing = function() {\n            return brush.getIsDrawing();\n        };\n        this.toggleEraser = function() {\n            eraserToggle.setValue(!eraserToggle.getValue());\n            brush.setIsEraser(eraserToggle.getValue());\n        };\n        this.getElement = function() {\n            return div;\n        };\n    };\n    return brushInterface;\n}();\n\n});\nparcelRequire.register(\"5rmB7\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"371uF\");\n\n});\n\n\n\nparcelRequire.register(\"h62LS\", function(module, exports) {\n\n$parcel$export(module.exports, \"showIframeModal\", function () { return $2d47de6498e5a87c$export$35fa34e5af64bd4a; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $dLlkc = parcelRequire(\"dLlkc\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nfunction $2d47de6498e5a87c$export$35fa34e5af64bd4a(url, isEmbed) {\n    // window very small, modal might look bad\n    if (!isEmbed && (window.innerHeight < 500 || window.innerWidth < 700)) {\n        window.open(url);\n        return;\n    }\n    var iframe = (0, $eWjiX.BB).el({\n        tagName: \"iframe\",\n        custom: {\n            src: url\n        },\n        css: {\n            width: \"100%\",\n            height: \"100%\",\n            opacity: \"0\"\n        }\n    });\n    setTimeout(function() {\n        iframe.style.opacity = \"\"; // fallback\n    }, 500);\n    var titleEl = (0, $eWjiX.BB).el();\n    var linkEl;\n    if (!isEmbed) {\n        linkEl = (0, $eWjiX.BB).el({\n            tagName: \"a\",\n            parent: titleEl,\n            content: (0, $1mH1z.LANG)(\"modal-new-tab\"),\n            custom: {\n                href: \"help\",\n                target: \"_blank\"\n            },\n            onClick: function onClick() {\n                popup.close();\n            }\n        });\n        iframe.onload = function() {\n            if (linkEl && iframe.contentWindow) (0, $eWjiX.BB).setAttributes(linkEl, {\n                href: \"\" + iframe.contentWindow.location\n            });\n            iframe.style.opacity = \"\";\n        };\n    }\n    var popup = new (0, $dLlkc.DynamicModal)({\n        title: titleEl,\n        content: iframe,\n        width: 880,\n        isMaxHeight: true,\n        onClose: function() {\n            if (linkEl) {\n                iframe.src = \"about:blank\";\n                (0, $eWjiX.BB).destroyEl(linkEl);\n                linkEl = undefined;\n            }\n        }\n    });\n}\n\n});\n\nparcelRequire.register(\"fRGIf\", function(module, exports) {\n\n$parcel$export(module.exports, \"RadioList\", function () { return $de98bdc3369d2e4f$export$3dff5655255b5729; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $de98bdc3369d2e4f$export$3dff5655255b5729 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function RadioList(param) {\n        var name = param.name, init = param.init, items = param.items, ignoreFocus = param.ignoreFocus;\n        var _this = this;\n        (0, $cx0mh._)(this, RadioList);\n        this.inputs = [];\n        this.el = (0, $eWjiX.BB).el({\n            className: \"kl-radio\"\n        });\n        items.forEach(function(item) {\n            var label = (0, $eWjiX.BB).el({\n                tagName: \"label\"\n            });\n            var input = (0, $eWjiX.BB).el({\n                tagName: \"input\",\n                parent: label,\n                custom: {\n                    name: name,\n                    value: item.value,\n                    type: \"radio\"\n                }\n            });\n            if (ignoreFocus) input.setAttribute(\"data-ignore-focus\", \"true\");\n            if (init === item.value) input.checked = true;\n            label.append(item.label);\n            _this.el.append(label);\n            _this.inputs.push(input);\n        });\n    }\n    (0, $7h4XF._)(RadioList, [\n        {\n            key: \"getValue\",\n            value: function getValue() {\n                for(var i = 0; i < this.inputs.length; i++){\n                    if (this.inputs[i].checked) return this.inputs[i].value;\n                }\n                return null;\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.el;\n            }\n        }\n    ]);\n    return RadioList;\n}();\n\n});\n\nparcelRequire.register(\"9pcu9\", function(module, exports) {\n\n$parcel$export(module.exports, \"BrowserStorageUi\", function () { return $0e681e75eb3cab30$export$9c72cf485ef46673; });\n\nvar $1LaJZ = parcelRequire(\"1LaJZ\");\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $2gUX3 = parcelRequire(\"2gUX3\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $auzYC = parcelRequire(\"auzYC\");\n\nvar $h62LS = parcelRequire(\"h62LS\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $1C8RU = parcelRequire(\"1C8RU\");\nvar $0e681e75eb3cab30$export$9c72cf485ef46673 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function BrowserStorageUi(projectStore, getProject, saveReminder, klRootEl, options) {\n        var _this = this;\n        (0, $cx0mh._)(this, BrowserStorageUi);\n        var _this_options;\n        this.projectStore = projectStore;\n        this.getProject = getProject;\n        this.saveReminder = saveReminder;\n        this.klRootEl = klRootEl;\n        this.options = options;\n        this.previewEl = {};\n        this.infoEl = {};\n        this.ageEl = {};\n        this.storeButtonEl = {};\n        this.clearButtonEl = {};\n        this.storeListener = {};\n        this.updateCheckerboard = function() {};\n        this.element = (0, $eWjiX.BB).el({\n            css: {\n                display: \"grid\",\n                gridTemplateColumns: \"1fr 0fr\",\n                gridTemplateRows: \"0fr 0fr 0fr\",\n                gap: \"0 0\",\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"'\n            }\n        });\n        var title = (0, $eWjiX.BB).el({\n            parent: this.element,\n            content: (0, $1mH1z.LANG)(\"file-storage\"),\n            css: {\n                gridArea: \"title\",\n                display: \"flex\",\n                margin: \"-5px 0\"\n            }\n        });\n        this.infoEl = (0, $eWjiX.BB).el({\n            parent: title,\n            content: \"?\",\n            className: \"kl-storage-about\",\n            title: (0, $1mH1z.LANG)(\"file-storage-about\"),\n            onClick: function() {\n                (0, $h62LS.showIframeModal)(\"./help/#help-browser-storage\", false);\n            }\n        });\n        if (this.projectStore.isBroken()) {\n            (0, $eWjiX.BB).el({\n                parent: this.element,\n                content: \"\\uD83D\\uDD34 \" + (0, $1mH1z.LANG)(\"file-storage-cant-access\"),\n                css: {\n                    marginTop: \"10px\"\n                }\n            });\n            return;\n        }\n        this.previewEl = (0, $eWjiX.BB).el({\n            parent: this.element,\n            title: (0, $1mH1z.LANG)(\"file-storage-thumb-title\"),\n            className: \"kl-storage-preview\"\n        });\n        this.ageEl = (0, $eWjiX.BB).el({\n            css: {\n                position: \"absolute\",\n                right: \"1px\",\n                bottom: \"1px\",\n                width: \"calc(100% - 2px)\",\n                textAlign: \"center\",\n                background: \"rgba(0,0,0,0.7)\",\n                color: \"#fff\",\n                textSize: \"13px\"\n            }\n        });\n        var btnCustom = (options === null || options === void 0 ? void 0 : options.isFocusable) ? {} : {\n            tabIndex: \"-1\"\n        };\n        this.storeButtonEl = (0, $eWjiX.BB).el({\n            parent: this.element,\n            tagName: \"button\",\n            className: \"grid-button\",\n            content: (0, $1mH1z.LANG)(\"file-storage-store\"),\n            css: {\n                gridArea: \"store\"\n            },\n            custom: btnCustom,\n            onClick: function() {\n                return _this.store();\n            }\n        });\n        this.clearButtonEl = (0, $eWjiX.BB).el({\n            parent: this.element,\n            tagName: \"button\",\n            className: \"grid-button\",\n            content: '<img src=\"' + (0, (/*@__PURE__*/$parcel$interopDefault($auzYC))) + '\" height=\"20\"/> ' + (0, $1mH1z.LANG)(\"file-storage-clear\"),\n            css: {\n                gridArea: \"clear\"\n            },\n            custom: btnCustom,\n            onClick: function() {\n                return _this.clear();\n            }\n        });\n        if ((_this_options = this.options) === null || _this_options === void 0 ? void 0 : _this_options.hideClearButton) this.clearButtonEl.style.visibility = \"hidden\";\n        this.storeListener = {\n            onUpdate: function(timestamp, thumbnail) {\n                _this.updateThumb(timestamp, thumbnail);\n            }\n        };\n        this.projectStore.subscribe(this.storeListener);\n        this.updateCheckerboard = function() {\n            if (!_this.thumbnail) return;\n            (0, $eWjiX.BB).css(_this.thumbnail, {\n                background: \"url('\" + (0, $eWjiX.BB).createCheckerCanvas(4, (0, $1C8RU.theme).isDark()).toDataURL(\"image/png\") + \"')\"\n            });\n        };\n        (0, $1C8RU.theme).addIsDarkListener(this.updateCheckerboard);\n        setInterval(function() {\n            return _this.updateAge();\n        }, 60000);\n        var _this1 = this;\n        (0, $1LaJZ._)(function() {\n            var readResult, e;\n            return (0, $2gUX3.__generator)(this, function(_state) {\n                switch(_state.label){\n                    case 0:\n                        _state.trys.push([\n                            0,\n                            2,\n                            ,\n                            3\n                        ]);\n                        return [\n                            4,\n                            _this1.projectStore.read()\n                        ];\n                    case 1:\n                        readResult = _state.sent();\n                        if (readResult) _this1.updateThumb(readResult.timestamp, readResult.thumbnail);\n                        else _this1.updateThumb();\n                        return [\n                            3,\n                            3\n                        ];\n                    case 2:\n                        e = _state.sent();\n                        setTimeout(function() {\n                            throw new Error(\"storage-ui: failed initial read browser storage, \" + e);\n                        }, 0);\n                        return [\n                            3,\n                            3\n                        ];\n                    case 3:\n                        return [\n                            2\n                        ];\n                }\n            });\n        })();\n    }\n    (0, $7h4XF._)(BrowserStorageUi, [\n        {\n            key: \"updateAge\",\n            value: function updateAge() {\n                if (!this.timestamp) return;\n                var age = new Date().getTime() - this.timestamp;\n                var ageStr;\n                age = Math.floor(age / 1000 / 60);\n                ageStr = (0, $1mH1z.LANG)(\"file-storage-min-ago\").replace(\"{x}\", \"\" + age);\n                if (age > 60) {\n                    age = Math.floor(age / 60);\n                    ageStr = (0, $1mH1z.LANG)(\"file-storage-hours-ago\").replace(\"{x}\", \"\" + age);\n                    if (age > 24) {\n                        age = Math.floor(age / 24);\n                        ageStr = (0, $1mH1z.LANG)(\"file-storage-days-ago\").replace(\"{x}\", \"\" + age);\n                        if (age > 31) ageStr = (0, $1mH1z.LANG)(\"file-storage-month-ago\");\n                    }\n                }\n                this.ageEl.textContent = ageStr;\n            }\n        },\n        {\n            key: \"resetButtons\",\n            value: function resetButtons() {\n                if (this.timestamp) {\n                    this.storeButtonEl.textContent = (0, $1mH1z.LANG)(\"file-storage-overwrite\");\n                    this.storeButtonEl.disabled = false;\n                    this.clearButtonEl.disabled = false;\n                } else {\n                    this.storeButtonEl.textContent = (0, $1mH1z.LANG)(\"file-storage-store\");\n                    this.storeButtonEl.disabled = false;\n                    this.clearButtonEl.disabled = true;\n                }\n            }\n        },\n        {\n            key: \"updateThumb\",\n            value: function updateThumb(timestamp, thumbnail) {\n                this.timestamp = timestamp;\n                this.thumbnail = thumbnail;\n                if (this.timestamp && thumbnail) {\n                    thumbnail.classList.add(\"kl-storage-preview__im\");\n                    this.previewEl.innerHTML = \"\";\n                    this.updateAge();\n                    this.previewEl.append(thumbnail, this.ageEl);\n                } else this.previewEl.innerHTML = (0, $1mH1z.LANG)(\"file-storage-empty\");\n                this.resetButtons();\n            }\n        },\n        {\n            key: \"store\",\n            value: function store() {\n                var _this = this;\n                return (0, $1LaJZ._)(function() {\n                    var e;\n                    return (0, $2gUX3.__generator)(this, function(_state) {\n                        switch(_state.label){\n                            case 0:\n                                _this.storeButtonEl.textContent = (0, $1mH1z.LANG)(\"file-storage-storing\");\n                                _this.storeButtonEl.disabled = true;\n                                _this.clearButtonEl.disabled = true;\n                                return [\n                                    4,\n                                    new Promise(function(resolve) {\n                                        setTimeout(function() {\n                                            return resolve(null);\n                                        }, 20);\n                                    })\n                                ];\n                            case 1:\n                                _state.sent();\n                                _state.label = 2;\n                            case 2:\n                                _state.trys.push([\n                                    2,\n                                    4,\n                                    ,\n                                    5\n                                ]);\n                                return [\n                                    4,\n                                    _this.projectStore.store(_this.getProject())\n                                ];\n                            case 3:\n                                _state.sent();\n                                _this.saveReminder.reset();\n                                return [\n                                    3,\n                                    5\n                                ];\n                            case 4:\n                                e = _state.sent();\n                                _this.resetButtons();\n                                (0, $hrnUX.KL).popup({\n                                    target: _this.klRootEl,\n                                    type: \"error\",\n                                    message: [\n                                        \"\".concat((0, $1mH1z.LANG)(\"file-storage-failed-1\"), \"<ul>\"),\n                                        \"<li>\".concat((0, $1mH1z.LANG)(\"file-storage-failed-2\"), \"</li>\"),\n                                        \"<li>\".concat((0, $1mH1z.LANG)(\"file-storage-failed-3\"), \"</li>\"),\n                                        \"<li>\".concat((0, $1mH1z.LANG)(\"file-storage-failed-4\"), \"</li>\"),\n                                        \"</ul>\"\n                                    ].join(\"\"),\n                                    buttons: [\n                                        \"Ok\"\n                                    ]\n                                });\n                                setTimeout(function() {\n                                    throw new Error(\"storage-ui: failed to store browser storage, \" + e);\n                                }, 0);\n                                return [\n                                    3,\n                                    5\n                                ];\n                            case 5:\n                                return [\n                                    2\n                                ];\n                        }\n                    });\n                })();\n            }\n        },\n        {\n            key: \"clear\",\n            value: function clear() {\n                var _this = this;\n                return (0, $1LaJZ._)(function() {\n                    var e;\n                    return (0, $2gUX3.__generator)(this, function(_state) {\n                        switch(_state.label){\n                            case 0:\n                                _this.storeButtonEl.disabled = true;\n                                _this.clearButtonEl.disabled = true;\n                                _state.label = 1;\n                            case 1:\n                                _state.trys.push([\n                                    1,\n                                    3,\n                                    ,\n                                    4\n                                ]);\n                                return [\n                                    4,\n                                    _this.projectStore.clear()\n                                ];\n                            case 2:\n                                _state.sent();\n                                return [\n                                    3,\n                                    4\n                                ];\n                            case 3:\n                                e = _state.sent();\n                                _this.resetButtons();\n                                (0, $hrnUX.KL).popup({\n                                    target: _this.klRootEl,\n                                    type: \"error\",\n                                    message: (0, $1mH1z.LANG)(\"file-storage-failed-clear\"),\n                                    buttons: [\n                                        \"Ok\"\n                                    ]\n                                });\n                                setTimeout(function() {\n                                    throw new Error(\"storage-ui: failed to clear browser storage, \" + e);\n                                }, 0);\n                                return [\n                                    3,\n                                    4\n                                ];\n                            case 4:\n                                return [\n                                    2\n                                ];\n                        }\n                    });\n                })();\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.element;\n            }\n        },\n        {\n            key: \"show\",\n            value: function show() {\n            // todo\n            }\n        },\n        {\n            key: \"hide\",\n            value: function hide() {\n            // todo\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                (0, $eWjiX.BB).destroyEl(this.infoEl);\n                (0, $eWjiX.BB).destroyEl(this.storeButtonEl);\n                (0, $eWjiX.BB).destroyEl(this.clearButtonEl);\n                (0, $1C8RU.theme).removeIsDarkListener(this.updateCheckerboard);\n                this.projectStore.unsubscribe(this.storeListener);\n            }\n        }\n    ]);\n    return BrowserStorageUi;\n}();\n\n});\n\nparcelRequire.register(\"6mTnI\", function(module, exports) {\n\n$parcel$export(module.exports, \"ProjectStore\", function () { return $14b343f2c12ca9c5$export$93d91060b9af7e2a; });\n\nvar $1LaJZ = parcelRequire(\"1LaJZ\");\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $2gUX3 = parcelRequire(\"2gUX3\");\n\nvar $3hwQ7 = parcelRequire(\"3hwQ7\");\n\nvar $9BlwZ = parcelRequire(\"9BlwZ\");\n\nvar $6l0gQ = parcelRequire(\"6l0gQ\");\nfunction $14b343f2c12ca9c5$var$makeAsync(nonAsyncFunc) {\n    return new Promise(function(resolve, reject) {\n        nonAsyncFunc(resolve, reject);\n    });\n}\nvar $14b343f2c12ca9c5$export$93d91060b9af7e2a = /*#__PURE__*/ function() {\n    \"use strict\";\n    function ProjectStore() {\n        var _this = this;\n        (0, $cx0mh._)(this, ProjectStore);\n        this.listeners = [];\n        this.accessHasFailed = false;\n        window.addEventListener(\"storage\", function(e) {\n            if (e.key !== \"indexedDbUpdatedAt\" || _this.listeners.length === 0) return;\n            try {\n                var _this1 = _this;\n                (0, $1LaJZ._)(function() {\n                    var readResult;\n                    return (0, $2gUX3.__generator)(this, function(_state) {\n                        switch(_state.label){\n                            case 0:\n                                return [\n                                    4,\n                                    _this1.read()\n                                ];\n                            case 1:\n                                readResult = _state.sent();\n                                if (readResult) _this1.emit(readResult.timestamp, readResult.thumbnail);\n                                else _this1.emit();\n                                return [\n                                    2\n                                ];\n                        }\n                    });\n                })();\n            } catch (e) {\n                if (e instanceof Error && e.message.indexOf(\"db-error\") === 0) _this.accessHasFailed = true;\n            }\n        });\n    }\n    (0, $7h4XF._)(ProjectStore, [\n        {\n            key: \"lowLevelStore\",\n            value: function lowLevelStore(project) {\n                return (0, $1LaJZ._)(function() {\n                    return (0, $2gUX3.__generator)(this, function(_state) {\n                        switch(_state.label){\n                            case 0:\n                                return [\n                                    4,\n                                    new Promise(function(resolve, reject) {\n                                        (0, $9BlwZ.storeKlProjectObj)(project, resolve, reject);\n                                    })\n                                ];\n                            case 1:\n                                _state.sent();\n                                return [\n                                    2\n                                ];\n                        }\n                    });\n                })();\n            }\n        },\n        {\n            key: \"lowLevelRead\",\n            value: function lowLevelRead() {\n                return (0, $1LaJZ._)(function() {\n                    return (0, $2gUX3.__generator)(this, function(_state) {\n                        switch(_state.label){\n                            case 0:\n                                return [\n                                    4,\n                                    $14b343f2c12ca9c5$var$makeAsync((0, $9BlwZ.getKlProjectObj))\n                                ];\n                            case 1:\n                                return [\n                                    2,\n                                    _state.sent()\n                                ];\n                        }\n                    });\n                })();\n            }\n        },\n        {\n            key: \"lowLevelClear\",\n            value: function lowLevelClear() {\n                return (0, $1LaJZ._)(function() {\n                    return (0, $2gUX3.__generator)(this, function(_state) {\n                        switch(_state.label){\n                            case 0:\n                                return [\n                                    4,\n                                    $14b343f2c12ca9c5$var$makeAsync((0, $9BlwZ.clear))\n                                ];\n                            case 1:\n                                _state.sent();\n                                return [\n                                    2\n                                ];\n                        }\n                    });\n                })();\n            }\n        },\n        {\n            key: \"emit\",\n            value: function emit(timestamp, thumbnail) {\n                this.listeners.forEach(function(item) {\n                    item.onUpdate(timestamp, thumbnail);\n                });\n            }\n        },\n        {\n            key: \"updateTimestamp\",\n            value: function updateTimestamp() {\n                (0, $6l0gQ.LocalStorage).setItem(\"indexedDbUpdatedAt\", \"\" + new Date().getTime());\n            }\n        },\n        {\n            key: \"read\",\n            value: function read() {\n                var _this = this;\n                return (0, $1LaJZ._)(function() {\n                    var storageProject, e, result, e1;\n                    return (0, $2gUX3.__generator)(this, function(_state) {\n                        switch(_state.label){\n                            case 0:\n                                _state.trys.push([\n                                    0,\n                                    2,\n                                    ,\n                                    3\n                                ]);\n                                return [\n                                    4,\n                                    _this.lowLevelRead()\n                                ];\n                            case 1:\n                                storageProject = _state.sent();\n                                return [\n                                    3,\n                                    3\n                                ];\n                            case 2:\n                                e = _state.sent();\n                                _this.accessHasFailed = true;\n                                throw new Error(\"db-error: \" + e);\n                            case 3:\n                                if (!storageProject) return [\n                                    2,\n                                    undefined\n                                ];\n                                _state.label = 4;\n                            case 4:\n                                _state.trys.push([\n                                    4,\n                                    6,\n                                    ,\n                                    7\n                                ]);\n                                return [\n                                    4,\n                                    (0, $3hwQ7.ProjectConverter).readStorageProject(storageProject)\n                                ];\n                            case 5:\n                                result = _state.sent();\n                                return [\n                                    3,\n                                    7\n                                ];\n                            case 6:\n                                e1 = _state.sent();\n                                throw new Error(\"format-error: \" + e1);\n                            case 7:\n                                return [\n                                    2,\n                                    result\n                                ];\n                        }\n                    });\n                })();\n            }\n        },\n        {\n            key: \"store\",\n            value: function store(project) {\n                var _this = this;\n                return (0, $1LaJZ._)(function() {\n                    var storageProject, e, storageProject1, readResult, e1;\n                    return (0, $2gUX3.__generator)(this, function(_state) {\n                        switch(_state.label){\n                            case 0:\n                                _state.trys.push([\n                                    0,\n                                    2,\n                                    ,\n                                    3\n                                ]);\n                                storageProject = (0, $3hwQ7.ProjectConverter).createStorageProject(project);\n                                return [\n                                    4,\n                                    _this.lowLevelStore(storageProject)\n                                ];\n                            case 1:\n                                _state.sent();\n                                return [\n                                    3,\n                                    3\n                                ];\n                            case 2:\n                                e = _state.sent();\n                                _this.accessHasFailed = true;\n                                throw new Error(\"db-error: \" + e);\n                            case 3:\n                                return [\n                                    4,\n                                    _this.lowLevelRead()\n                                ];\n                            case 4:\n                                storageProject1 = _state.sent();\n                                _state.label = 5;\n                            case 5:\n                                _state.trys.push([\n                                    5,\n                                    7,\n                                    ,\n                                    9\n                                ]);\n                                return [\n                                    4,\n                                    (0, $3hwQ7.ProjectConverter).readStorageProject(storageProject1)\n                                ];\n                            case 6:\n                                readResult = _state.sent();\n                                return [\n                                    3,\n                                    9\n                                ];\n                            case 7:\n                                e1 = _state.sent();\n                                return [\n                                    4,\n                                    _this.lowLevelClear()\n                                ];\n                            case 8:\n                                _state.sent();\n                                _this.updateTimestamp();\n                                setTimeout(function() {\n                                    return _this.emit();\n                                }, 0);\n                                throw new Error(\"format-error: \" + e1);\n                            case 9:\n                                _this.updateTimestamp();\n                                setTimeout(function() {\n                                    return _this.emit(readResult.timestamp, readResult.thumbnail);\n                                }, 0);\n                                return [\n                                    2\n                                ];\n                        }\n                    });\n                })();\n            }\n        },\n        {\n            key: \"clear\",\n            value: function clear() {\n                var _this = this;\n                return (0, $1LaJZ._)(function() {\n                    return (0, $2gUX3.__generator)(this, function(_state) {\n                        switch(_state.label){\n                            case 0:\n                                return [\n                                    4,\n                                    _this.lowLevelClear()\n                                ];\n                            case 1:\n                                _state.sent();\n                                _this.updateTimestamp();\n                                setTimeout(function() {\n                                    return _this.emit();\n                                }, 0);\n                                return [\n                                    2\n                                ];\n                        }\n                    });\n                })();\n            }\n        },\n        {\n            key: \"subscribe\",\n            value: function subscribe(listener) {\n                if (this.listeners.includes(listener)) return;\n                this.listeners.push(listener);\n            }\n        },\n        {\n            key: \"unsubscribe\",\n            value: function unsubscribe(listener) {\n                for(var i = 0; i < this.listeners.length; i++)if (listener === this.listeners[i]) {\n                    this.listeners.splice(i, 1);\n                    return;\n                }\n            }\n        },\n        {\n            key: \"isBroken\",\n            value: function isBroken() {\n                return this.accessHasFailed;\n            }\n        }\n    ]);\n    return ProjectStore;\n}();\n\n});\nparcelRequire.register(\"3hwQ7\", function(module, exports) {\n\n$parcel$export(module.exports, \"ProjectConverter\", function () { return $3ee249752703e788$export$f3c1ac6650038646; });\n\nvar $1LaJZ = parcelRequire(\"1LaJZ\");\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $2gUX3 = parcelRequire(\"2gUX3\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $aSJRf = parcelRequire(\"aSJRf\");\n\nvar $2wCWz = parcelRequire(\"2wCWz\");\nvar $3ee249752703e788$var$thumbSize = 240;\nfunction $3ee249752703e788$var$loadImage(blob) {\n    return new Promise(function(resolve, reject) {\n        var im = new Image();\n        try {\n            im.src = (0, $eWjiX.BB).imageBlobToUrl(blob);\n        } catch (e) {\n            reject(\"imageBlobToUrl, \" + (e instanceof Error ? e.message : \"\"));\n            return;\n        }\n        im.onload = function() {\n            URL.revokeObjectURL(im.src);\n            resolve(im);\n        };\n        im.onabort = function() {\n            reject(\"layer image failed loading\");\n        };\n        im.onerror = function() {\n            reject(\"layer image failed loading\");\n        };\n    });\n}\nvar $3ee249752703e788$export$f3c1ac6650038646 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function ProjectConverter() {\n        (0, $cx0mh._)(this, ProjectConverter);\n    }\n    (0, $7h4XF._)(ProjectConverter, null, [\n        {\n            key: \"createThumbnail\",\n            value: function createThumbnail(project) {\n                var size = (0, $eWjiX.BB).fitInto(project.width, project.height, $3ee249752703e788$var$thumbSize, $3ee249752703e788$var$thumbSize);\n                var factor = size.width / project.width;\n                return (0, $aSJRf.drawProject)(project, factor);\n            }\n        },\n        {\n            key: \"createStorageProject\",\n            value: function createStorageProject(project) {\n                return {\n                    id: 1,\n                    timestamp: new Date().getTime(),\n                    thumbnail: (0, $2wCWz.base64ToBlob)(ProjectConverter.createThumbnail(project).toDataURL(\"image/png\")),\n                    width: project.width,\n                    height: project.height,\n                    layers: project.layers.map(function(item) {\n                        var blob;\n                        if (item.image instanceof HTMLCanvasElement) blob = (0, $2wCWz.base64ToBlob)(item.image.toDataURL(\"image/png\"));\n                        else // todo image\n                        throw new Error(\"Not implemented\");\n                        return {\n                            name: item.name,\n                            isVisible: item.isVisible,\n                            opacity: item.opacity,\n                            mixModeStr: item.mixModeStr,\n                            blob: blob\n                        };\n                    })\n                };\n            }\n        },\n        {\n            key: \"readStorageProject\",\n            value: function readStorageProject(storageProject) {\n                return (0, $1LaJZ._)(function() {\n                    var project, _tmp, thumbnail;\n                    return (0, $2gUX3.__generator)(this, function(_state) {\n                        switch(_state.label){\n                            case 0:\n                                if (!storageProject.width || !storageProject.height || isNaN(storageProject.width) || isNaN(storageProject.height) || storageProject.width < 1 || storageProject.height < 1) throw new Error(\"readStorageProject invalid canvas size: \" + storageProject.width + \", \" + storageProject.height);\n                                _tmp = {\n                                    width: storageProject.width,\n                                    height: storageProject.height\n                                };\n                                return [\n                                    4,\n                                    Promise.all(storageProject.layers.map(function(layer) {\n                                        return $3ee249752703e788$var$loadImage(layer.blob);\n                                    }))\n                                ];\n                            case 1:\n                                project = (_tmp.layers = _state.sent().map(function(image, i) {\n                                    var storageLayer = storageProject.layers[i];\n                                    return {\n                                        name: storageLayer.name,\n                                        isVisible: \"isVisible\" in storageLayer ? storageLayer.isVisible : true,\n                                        opacity: storageLayer.opacity,\n                                        mixModeStr: storageLayer.mixModeStr,\n                                        image: image\n                                    };\n                                }), _tmp);\n                                if (!storageProject.thumbnail) return [\n                                    3,\n                                    3\n                                ];\n                                return [\n                                    4,\n                                    $3ee249752703e788$var$loadImage(storageProject.thumbnail)\n                                ];\n                            case 2:\n                                thumbnail = _state.sent();\n                                return [\n                                    3,\n                                    4\n                                ];\n                            case 3:\n                                thumbnail = ProjectConverter.createThumbnail(project);\n                                _state.label = 4;\n                            case 4:\n                                return [\n                                    2,\n                                    {\n                                        project: project,\n                                        timestamp: storageProject.timestamp,\n                                        thumbnail: thumbnail\n                                    }\n                                ];\n                        }\n                    });\n                })();\n            }\n        }\n    ]);\n    return ProjectConverter;\n}();\n\n});\nparcelRequire.register(\"2wCWz\", function(module, exports) {\n\n$parcel$export(module.exports, \"base64ToBlob\", function () { return $e3587a28373f51f9$export$b3fb17ae4345ac8f; });\nfunction $e3587a28373f51f9$export$b3fb17ae4345ac8f(base64Str) {\n    var parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\n    var binStr = atob(parts[3]);\n    var buf = new ArrayBuffer(binStr.length);\n    var view = new Uint8Array(buf);\n    for(var i = 0; i < view.length; i++)view[i] = binStr.charCodeAt(i);\n    return new Blob([\n        view\n    ], {\n        \"type\": parts[1]\n    });\n}\n\n});\n\n\n\nparcelRequire.register(\"eK8ID\", function(module, exports) {\n\n$parcel$export(module.exports, \"FileTab\", function () { return $01ce2e23a2667e77$export$a2647fbf5f056b0a; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $9pcu9 = parcelRequire(\"9pcu9\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $frUlg = parcelRequire(\"frUlg\");\n\nvar $g2tQ8 = parcelRequire(\"g2tQ8\");\n\nvar $cmBTx = parcelRequire(\"cmBTx\");\n\nvar $fEvzb = parcelRequire(\"fEvzb\");\n\nvar $7qUeg = parcelRequire(\"7qUeg\");\n\nvar $bJupx = parcelRequire(\"bJupx\");\nvar $01ce2e23a2667e77$export$a2647fbf5f056b0a = /*#__PURE__*/ function() {\n    \"use strict\";\n    function FileTab(klRootEl, projectStore, getProject, exportType, onExportTypeChange, onFileSelect, onSaveImageToComputer, onNewImage, onShareImage, onUpload, onCopyToClipboard, saveReminder) {\n        var _this = this;\n        (0, $cx0mh._)(this, FileTab);\n        this.exportType = exportType;\n        this.rootEl = document.createElement(\"div\");\n        var asyncCreation = function() {\n            var fileMenu = document.createElement(\"div\");\n            var newButton = document.createElement(\"button\");\n            var saveButton = document.createElement(\"button\");\n            var shareButton = document.createElement(\"button\");\n            var uploadImgurButton = document.createElement(\"button\");\n            var clipboardButton = document.createElement(\"button\");\n            newButton.style.cssFloat = \"left\";\n            (0, $eWjiX.BB).css(saveButton, {\n                cssFloat: \"left\",\n                clear: \"both\",\n                flexGrow: \"1\"\n            });\n            (0, $eWjiX.BB).css(clipboardButton, {\n                cssFloat: \"left\",\n                clear: \"both\"\n            });\n            newButton.tabIndex = -1;\n            saveButton.tabIndex = -1;\n            shareButton.tabIndex = -1;\n            uploadImgurButton.tabIndex = -1;\n            clipboardButton.tabIndex = -1;\n            newButton.innerHTML = '<img class=\"dark-no-invert\" src=\\''.concat((0, (/*@__PURE__*/$parcel$interopDefault($frUlg))), \"' alt='icon' height='20'/>\").concat((0, $1mH1z.LANG)(\"file-new\"));\n            saveButton.innerHTML = \"<img src='\".concat((0, (/*@__PURE__*/$parcel$interopDefault($g2tQ8))), \"' alt='icon' height='20'/>\").concat((0, $1mH1z.LANG)(\"file-save\"));\n            shareButton.innerHTML = \"<img src='\".concat((0, (/*@__PURE__*/$parcel$interopDefault($cmBTx))), \"' alt='icon' height='20'/>\").concat((0, $1mH1z.LANG)(\"file-share\"));\n            uploadImgurButton.innerHTML = \"<img style='float:left' src='\".concat((0, (/*@__PURE__*/$parcel$interopDefault($fEvzb))), \"' height='20' alt='icon'/>\").concat((0, $1mH1z.LANG)(\"file-upload\"));\n            clipboardButton.innerHTML = \"<img src='\".concat((0, (/*@__PURE__*/$parcel$interopDefault($bJupx))), \"' alt='icon' height='20'/>\").concat((0, $1mH1z.LANG)(\"file-copy\"));\n            clipboardButton.title = (0, $1mH1z.LANG)(\"file-copy-title\");\n            newButton.className = \"grid-button\";\n            saveButton.className = \"grid-button\";\n            shareButton.className = \"grid-button\";\n            uploadImgurButton.className = \"grid-button\";\n            clipboardButton.className = \"grid-button\";\n            var importWrapper = (0, $eWjiX.BB).el({\n                className: \"grid-button\",\n                css: {\n                    position: \"relative\",\n                    cursor: \"pointer\",\n                    cssFloat: \"left\"\n                }\n            });\n            var innerMask = (0, $eWjiX.BB).el({\n                parent: importWrapper,\n                css: {\n                    width: \"120px\",\n                    height: \"28px\",\n                    overflow: \"hidden\",\n                    cursor: \"pointer\",\n                    position: \"relative\"\n                }\n            });\n            _this.importButton = (0, $eWjiX.BB).el({\n                tagName: \"input\",\n                parent: innerMask,\n                css: {\n                    display: \"none\"\n                }\n            });\n            _this.importButton.tabIndex = -1;\n            _this.importButton.type = \"file\";\n            _this.importButton.multiple = true;\n            _this.importButton.accept = \"image\";\n            _this.importButton.size = 71;\n            _this.importButton.onchange = function() {\n                if (!_this.importButton) return;\n                _this.importButton.files && onFileSelect(_this.importButton.files, \"default\");\n                _this.importButton.value = \"\";\n            };\n            var importFakeButton = (0, $eWjiX.BB).el({\n                tagName: \"button\",\n                parent: importWrapper,\n                content: \"<img class=\\\"dark-no-invert\\\" style='float:left' height='20' src='\" + (0, (/*@__PURE__*/$parcel$interopDefault($7qUeg))) + \"' alt='icon'/>\" + (0, $1mH1z.LANG)(\"file-import\"),\n                css: {\n                    width: \"120px\",\n                    display: \"box\",\n                    position: \"absolute\",\n                    left: \"0\",\n                    top: \"0\",\n                    cursor: \"pointer\"\n                }\n            });\n            importFakeButton.tabIndex = -1;\n            importFakeButton.onclick = function() {\n                return _this.importButton && _this.importButton.click();\n            };\n            // --- export filetype dropdown ---\n            var exportTypeSelect = new (0, $hrnUX.KL).Select({\n                optionArr: [\n                    [\n                        \"png\",\n                        \"PNG\"\n                    ],\n                    [\n                        \"psd\",\n                        \"PSD\"\n                    ],\n                    [\n                        \"layers\",\n                        (0, $1mH1z.LANG)(\"layers\") + \" (PNG)\"\n                    ]\n                ],\n                initValue: _this.exportType,\n                onChange: function(val) {\n                    _this.exportType = val;\n                    onExportTypeChange(_this.exportType);\n                    onSaveImageToComputer();\n                },\n                title: (0, $1mH1z.LANG)(\"file-format\")\n            });\n            (0, $eWjiX.BB).css(exportTypeSelect.getElement(), {\n                width: \"50%\",\n                height: \"30px\",\n                marginTop: \"10px\",\n                marginLeft: \"10px\"\n            });\n            newButton.onclick = onNewImage;\n            saveButton.onclick = function() {\n                onSaveImageToComputer();\n            };\n            shareButton.onclick = function() {\n                shareButton.disabled = true;\n                onShareImage(function() {\n                    shareButton.disabled = false;\n                });\n            };\n            uploadImgurButton.onclick = function() {\n                return onUpload();\n            };\n            clipboardButton.onclick = function() {\n                clipboardButton.blur();\n                onCopyToClipboard();\n            };\n            var saveNote = (0, $eWjiX.BB).el({\n                className: \"kl-toolspace-note\",\n                textContent: (0, $1mH1z.LANG)(\"file-no-autosave\"),\n                css: {\n                    margin: \"10px 10px 0 10px\"\n                }\n            });\n            var createSpacer = function() {\n                var el = document.createElement(\"div\");\n                var clearer = document.createElement(\"div\");\n                var line = (0, $eWjiX.BB).el({\n                    className: \"grid-hr\"\n                });\n                el.append(clearer, line);\n                (0, $eWjiX.BB).css(clearer, {\n                    clear: \"both\"\n                });\n                return el;\n            };\n            _this.fileBrowserStorage = new (0, $9pcu9.BrowserStorageUi)(projectStore, getProject, saveReminder, klRootEl);\n            (0, $eWjiX.BB).css(_this.fileBrowserStorage.getElement(), {\n                //background: 'red',\n                margin: \"10px\"\n            });\n            var saveRow = (0, $eWjiX.BB).el({\n                content: [\n                    saveButton,\n                    exportTypeSelect.getElement()\n                ],\n                className: \"kl-file-save-row\"\n            });\n            //actual structure\n            (0, $eWjiX.BB).append(fileMenu, [\n                saveNote,\n                newButton,\n                importWrapper,\n                (0, $eWjiX.BB).el({\n                    css: {\n                        clear: \"both\"\n                    }\n                }),\n                saveRow,\n                clipboardButton,\n                (0, $eWjiX.BB).canShareFiles() ? shareButton : undefined,\n                (0, $eWjiX.BB).el({\n                    css: {\n                        clear: \"both\"\n                    }\n                }),\n                createSpacer(),\n                _this.fileBrowserStorage.getElement(),\n                createSpacer(),\n                uploadImgurButton\n            ]);\n            _this.rootEl.append(fileMenu);\n        };\n        setTimeout(asyncCreation, 1);\n    }\n    (0, $7h4XF._)(FileTab, [\n        {\n            key: \"refresh\",\n            value: function refresh() {}\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"setIsVisible\",\n            value: function setIsVisible(isVisible) {\n                if (isVisible) this.refresh();\n            }\n        },\n        {\n            key: \"triggerImport\",\n            value: function triggerImport() {\n                this.importButton && this.importButton.click();\n            }\n        }\n    ]);\n    return FileTab;\n}();\n\n});\nparcelRequire.register(\"fEvzb\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"gJzzT\");\n\n});\n\n\nparcelRequire.register(\"2umOB\", function(module, exports) {\n\n$parcel$export(module.exports, \"FilterTab\", function () { return $0d10046ca7f6fbd0$export$3f17d740ad471e50; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $8N5YG = parcelRequire(\"8N5YG\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $a5EFw = parcelRequire(\"a5EFw\");\nvar $0d10046ca7f6fbd0$export$3f17d740ad471e50 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function FilterTab(klRootEl, klColorSlider, layerManager, klCanvasWorkspace, handUi, getCurrentColor, getKlMaxCanvasSize, getKlCanvas, getCurrentLayerCtx, isEmbed, statusOverlay) {\n        (0, $cx0mh._)(this, FilterTab);\n        this.klRootEl = klRootEl;\n        this.klColorSlider = klColorSlider;\n        this.layerManager = layerManager;\n        this.klCanvasWorkspace = klCanvasWorkspace;\n        this.handUi = handUi;\n        this.getCurrentColor = getCurrentColor;\n        this.getKlMaxCanvasSize = getKlMaxCanvasSize;\n        this.getKlCanvas = getKlCanvas;\n        this.getCurrentLayerCtx = getCurrentLayerCtx;\n        this.isEmbed = isEmbed;\n        this.statusOverlay = statusOverlay;\n        this.isInit = false;\n        this.rootEl = document.createElement(\"div\");\n    }\n    (0, $7h4XF._)(FilterTab, [\n        {\n            key: \"testHasWebGL\",\n            value: function testHasWebGL() {\n                return !!(0, $a5EFw.getSharedFx)();\n            }\n        },\n        {\n            key: \"init\",\n            value: function init() {\n                var _this = this;\n                var filters = (0, $hrnUX.KL).filterLib;\n                var buttons = [];\n                if (!(0, $hrnUX.KL).filterLibStatus.isLoaded) throw new Error(\"filters not loaded\");\n                var hasWebGL = this.testHasWebGL();\n                if (!hasWebGL) {\n                    var note = (0, $eWjiX.BB).el({\n                        parent: this.rootEl,\n                        className: \"kl-toolspace-note\",\n                        content: \"Features disabled because WebGL is failing.\",\n                        css: {\n                            margin: \"10px\",\n                            marginBottom: \"0\"\n                        }\n                    });\n                    var noteButton = (0, $eWjiX.BB).el({\n                        parent: note,\n                        tagName: \"button\",\n                        textContent: \"Learn More\",\n                        css: {\n                            marginLeft: \"5px\"\n                        }\n                    });\n                    noteButton.onclick = function() {\n                        (0, $hrnUX.KL).popup({\n                            target: _this.klRootEl,\n                            message: \"<b>WebGL is not working</b>\",\n                            div: (0, $eWjiX.BB).el({\n                                content: '\\nSee if your browser supports WebGL and has it enabled: <a href=\"https://get.webgl.org\" target=\"_blank\" rel=\"noopener noreferrer\">get.webgl.org</a><br>\\n<br>\\nRecently (2023-05) a number of Chrome users on Chrome OS reported that WebGL fails, although it is enabled & supported.\\nThis has been reported to Google.\\n'\n                            }),\n                            buttons: [\n                                \"Ok\"\n                            ],\n                            clickOnEnter: \"Ok\"\n                        });\n                    };\n                }\n                var createButton = function(filterKey) {\n                    var filter = filters[filterKey];\n                    var button = document.createElement(\"button\");\n                    var buttonLabel = (0, $1mH1z.LANG)(filter.lang.button);\n                    var imClass = filter.darkNoInvert ? 'class=\"dark-no-invert\"' : \"\";\n                    var im = \"<img \" + imClass + ' height=\"20\" width=\"18\" src=\"' + filter.icon + '\" alt=\"icon\" />';\n                    button.innerHTML = im + buttonLabel;\n                    button.className = \"grid-button\";\n                    (0, $eWjiX.BB).css(button, {\n                        lineHeight: \"20px\",\n                        fontSize: \"12px\"\n                    });\n                    button.tabIndex = -1;\n                    var filterName = (0, $1mH1z.LANG)(filter.lang.name);\n                    var isEnabled = true;\n                    if (filter.webGL && !hasWebGL) isEnabled = false;\n                    if (isEnabled) button.onclick = function() {\n                        var dialogButtons = [\n                            \"Ok\",\n                            \"Cancel\"\n                        ];\n                        var finishedDialog = function(result, filterDialog) {\n                            if (result == \"Cancel\") {\n                                if (filterDialog.destroy) filterDialog.destroy();\n                                return;\n                            }\n                            var input;\n                            try {\n                                input = filterDialog.getInput(); // also destroys\n                            } catch (e) {\n                                if (e.message.indexOf(\".getInput is not a function\") !== -1) throw \"filterDialog.getInput is not a function, filter: \" + filterName;\n                                else throw e;\n                            }\n                            applyFilter(input);\n                        };\n                        if (!(\"apply\" in filters[filterKey])) {\n                            alert(\"Application not fully loaded\");\n                            return;\n                        }\n                        var applyFilter = function(input) {\n                            var filterResult = filters[filterKey].apply({\n                                context: _this.getCurrentLayerCtx(),\n                                klCanvas: _this.getKlCanvas(),\n                                history: (0, $gWfkn.klHistory),\n                                input: input\n                            });\n                            if (filterResult === false) alert(\"Couldn't apply the edit action\");\n                            if (filters[filterKey].updatePos === true) {\n                                _this.klCanvasWorkspace.resetOrFitView();\n                                _this.handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\n                            }\n                            _this.layerManager.update();\n                        };\n                        if (filters[filterKey].isInstant) {\n                            button.blur();\n                            applyFilter(null);\n                            _this.statusOverlay.out('\"' + filterName + '\" ' + (0, $1mH1z.LANG)(\"filter-applied\"), true);\n                        } else {\n                            var secondaryColorRGB = _this.klColorSlider.getSecondaryRGB();\n                            var filterDialog = filters[filterKey].getDialog({\n                                context: _this.getCurrentLayerCtx(),\n                                klCanvas: _this.getKlCanvas(),\n                                maxWidth: _this.getKlMaxCanvasSize(),\n                                maxHeight: _this.getKlMaxCanvasSize(),\n                                currentColorRgb: {\n                                    r: _this.getCurrentColor().r,\n                                    g: _this.getCurrentColor().g,\n                                    b: _this.getCurrentColor().b\n                                },\n                                secondaryColorRgb: {\n                                    r: secondaryColorRGB.r,\n                                    g: secondaryColorRGB.g,\n                                    b: secondaryColorRGB.b\n                                }\n                            });\n                            if (!filterDialog) return;\n                            var closeFunc;\n                            // Todo should move into getDialogParams\n                            filterDialog.errorCallback = function(e) {\n                                setTimeout(function() {\n                                    alert(\"Error: could not perform action\");\n                                    throw e;\n                                }, 0);\n                                closeFunc();\n                            };\n                            var style = {};\n                            if (\"width\" in filterDialog) style.width = filterDialog.width + \"px\";\n                            (0, $hrnUX.KL).popup({\n                                target: _this.klRootEl,\n                                message: \"<b>\" + filterName + \"</b>\",\n                                div: filterDialog.element,\n                                style: style,\n                                buttons: dialogButtons,\n                                clickOnEnter: \"Ok\",\n                                callback: function(result) {\n                                    finishedDialog(result, filterDialog);\n                                },\n                                closeFunc: function(func) {\n                                    closeFunc = func;\n                                }\n                            });\n                        }\n                    };\n                    else button.disabled = true;\n                    buttons.push(button);\n                    return button;\n                };\n                var addGroup = function(groupArr) {\n                    Object.entries(filters).forEach(function(param) {\n                        var _param = (0, $8N5YG._)(param, 2), filterKey = _param[0], filter = _param[1];\n                        if (!groupArr.includes(filterKey)) return;\n                        if (_this.isEmbed && !filter.inEmbed) return;\n                        _this.rootEl.append(createButton(filterKey));\n                    });\n                };\n                var groupA = [\n                    \"cropExtend\",\n                    \"flip\",\n                    \"perspective\",\n                    \"resize\",\n                    \"rotate\",\n                    \"transform\"\n                ];\n                var groupB = [\n                    \"brightnessContrast\",\n                    \"curves\",\n                    \"distort\",\n                    \"hueSaturation\",\n                    \"invert\",\n                    \"tiltShift\",\n                    \"toAlpha\",\n                    \"blur\",\n                    \"unsharpMask\"\n                ];\n                var groupC = [\n                    \"grid\",\n                    \"noise\",\n                    \"pattern\",\n                    \"vanishPoint\"\n                ];\n                addGroup(groupA);\n                this.rootEl.append((0, $eWjiX.BB).el({\n                    className: \"grid-hr\"\n                }));\n                addGroup(groupB);\n                this.rootEl.append((0, $eWjiX.BB).el({\n                    className: \"grid-hr\"\n                }));\n                addGroup(groupC);\n                this.isInit = true;\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"show\",\n            value: function show() {\n                if (!this.isInit) this.init();\n                this.rootEl.style.display = \"block\";\n            }\n        },\n        {\n            key: \"hide\",\n            value: function hide() {\n                this.rootEl.style.display = \"none\";\n            }\n        }\n    ]);\n    return FilterTab;\n}();\n\n});\nparcelRequire.register(\"a5EFw\", function(module, exports) {\n\n$parcel$export(module.exports, \"getSharedFx\", function () { return $02a74dc72797630f$export$8c4423af32b21158; });\n\nvar $6N0h0 = parcelRequire(\"6N0h0\");\nvar $02a74dc72797630f$var$failed = false;\nvar $02a74dc72797630f$var$fx = null;\nfunction $02a74dc72797630f$export$8c4423af32b21158() {\n    // failed previously, don't need to try again.\n    if ($02a74dc72797630f$var$failed) return $02a74dc72797630f$var$fx;\n    if (!$02a74dc72797630f$var$fx || $02a74dc72797630f$var$fx._.gl.isContextLost()) try {\n        $02a74dc72797630f$var$fx = (0, $6N0h0.fxCanvas)();\n    } catch (e) {\n        $02a74dc72797630f$var$failed = true;\n        $02a74dc72797630f$var$fx = null;\n        setTimeout(function() {\n            throw e;\n        });\n    }\n    return $02a74dc72797630f$var$fx;\n}\n\n});\nparcelRequire.register(\"6N0h0\", function(module, exports) {\n\n$parcel$export(module.exports, \"fxCanvas\", function () { return $eeae469bfe7893fd$export$a04cfca62fd2892f; });\n\nvar $76shC = parcelRequire(\"76shC\");\n\nvar $fvBHO = parcelRequire(\"fvBHO\");\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\n\nvar $8dg54 = parcelRequire(\"8dg54\");\n\nvar $1Vq1u = parcelRequire(\"1Vq1u\");\n\nvar $h6IOH = parcelRequire(\"h6IOH\");\n\nvar $9uhWc = parcelRequire(\"9uhWc\");\n\nvar $e0olz = parcelRequire(\"e0olz\");\n\nvar $2myDH = parcelRequire(\"2myDH\");\n\nvar $44j8K = parcelRequire(\"44j8K\");\n\nvar $kSoEy = parcelRequire(\"kSoEy\");\n\nvar $9WU1L = parcelRequire(\"9WU1L\");\n\nvar $bJIp5 = parcelRequire(\"bJIp5\");\n\nvar $fkecp = parcelRequire(\"fkecp\");\n\nvar $3u9Uu = parcelRequire(\"3u9Uu\");\n\nvar $6lIef = parcelRequire(\"6lIef\");\n\nvar $lwXVT = parcelRequire(\"lwXVT\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $eeae469bfe7893fd$export$a04cfca62fd2892f = function() {\n    var wrapTexture = function wrapTexture(texture) {\n        return {\n            _: texture,\n            loadContentsOf: function loadContentsOf(element) {\n                // Make sure that we're using the correct global WebGL context\n                (0, $7dEWP.setGl)(this._.gl);\n                this._.loadContentsOf(element);\n            },\n            destroy: function destroy() {\n                // Make sure that we're using the correct global WebGL context\n                (0, $7dEWP.setGl)(this._.gl);\n                this._.destroy();\n            }\n        };\n    };\n    var texture = function texture(element) {\n        return wrapTexture((0, $8dg54.FxTexture).fromElement(element));\n    };\n    var getTextureType = function getTextureType() {\n        var textureType = (0, $7dEWP.gl).UNSIGNED_BYTE;\n        // Go for floating point buffer textures if we can, it'll make the bokeh\n        // filter look a lot better. Note that on Windows, ANGLE does not let you\n        // render to a floating-point texture when linear filtering is enabled.\n        // See http://crbug.com/172278 for more information.\n        if ((0, $7dEWP.gl).getExtension(\"WEBGL_color_buffer_float\") && // firefox shows warning without this line\n        (0, $7dEWP.gl).getExtension(\"OES_texture_float\") && (0, $7dEWP.gl).getExtension(\"OES_texture_float_linear\")) {\n            var testTexture = new (0, $8dg54.FxTexture)(100, 100, (0, $7dEWP.gl).RGBA, (0, $7dEWP.gl).FLOAT);\n            try {\n                // Only use gl.FLOAT if we can render to it\n                testTexture.drawTo(function() {\n                    textureType = (0, $7dEWP.gl).FLOAT;\n                });\n            } catch (e) {\n            /* empty */ }\n            testTexture.destroy();\n        }\n        return textureType;\n    };\n    var initialize = function initialize(width, height) {\n        var textureType = getTextureType();\n        if (this._.texture) this._.texture.destroy();\n        if (this._.spareTexture) this._.spareTexture.destroy();\n        this.width = width;\n        this.height = height;\n        this._.texture = new (0, $8dg54.FxTexture)(width, height, (0, $7dEWP.gl).RGBA, textureType);\n        this._.spareTexture = new (0, $8dg54.FxTexture)(width, height, (0, $7dEWP.gl).RGBA, textureType);\n        this._.extraTexture = this._.extraTexture || new (0, $8dg54.FxTexture)(0, 0, (0, $7dEWP.gl).RGBA, textureType);\n        this._.flippedShader = this._.flippedShader || new (0, $fvBHO.FxShader)(null, \"\\nuniform sampler2D texture;\\nvarying vec2 texCoord;\\nvoid main() {\\n    gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\\n}\\n        \", \"flippedShader\");\n        this._.isInitialized = true;\n    };\n    var draw = function draw(texture, width, height) {\n        if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\n        texture._.use();\n        this._.texture.drawTo(function() {\n            (0, $fvBHO.FxShader).getDefaultShader().drawRect();\n        });\n        return this;\n    };\n    var update = function update() {\n        this._.texture.use();\n        this._.flippedShader.drawRect();\n        return this;\n    };\n    var contents = function contents() {\n        var texture = new (0, $8dg54.FxTexture)(this._.texture.width, this._.texture.height, (0, $7dEWP.gl).RGBA, (0, $7dEWP.gl).UNSIGNED_BYTE);\n        this._.texture.use();\n        texture.drawTo(function() {\n            (0, $fvBHO.FxShader).getDefaultShader().drawRect();\n        });\n        return wrapTexture(texture);\n    };\n    var getPixelArray = /*\r\n       Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\r\n       Length of the array will be width * height * 4.\r\n    */ function getPixelArray() {\n        var w = this._.texture.width;\n        var h = this._.texture.height;\n        var array = new Uint8Array(w * h * 4);\n        this._.texture.drawTo(function() {\n            (0, $7dEWP.gl).readPixels(0, 0, w, h, (0, $7dEWP.gl).RGBA, (0, $7dEWP.gl).UNSIGNED_BYTE, array);\n        });\n        return array;\n    };\n    var wrap = function wrap(fn) {\n        return function() {\n            for(var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++){\n                args[_key] = arguments[_key];\n            }\n            // Make sure that we're using the correct global WebGL context\n            (0, $7dEWP.setGl)(this._.gl);\n            // Now that the context has been switched, we can call the wrapped function\n            return fn.apply(this, args);\n        };\n    };\n    var getWebGlContext = function getWebGlContext(canvas, options) {\n        var contextNames = [\n            \"webgl\",\n            \"experimental-webgl\",\n            \"webgl2\"\n        ];\n        var context = null;\n        contextNames.forEach(function(name) {\n            if (context) return;\n            // get.webgl.org does a try-catch\n            try {\n                context = canvas.getContext(name, options);\n            } catch (e) {\n            /* empty */ }\n        });\n        return context;\n    };\n    return function() {\n        if (!window.WebGLRenderingContext) throw \"WebGLRenderingContext not set. Browser does not support WebGL.\";\n        var canvas = (0, $eWjiX.BB).canvas();\n        var context = getWebGlContext(canvas, {\n            premultipliedAlpha: false\n        });\n        if (!context) throw \"This browser does not support WebGL\";\n        (0, $7dEWP.setGl)(context);\n        canvas._ = {\n            gl: (0, $7dEWP.gl),\n            isInitialized: false,\n            texture: null,\n            spareTexture: null,\n            flippedShader: null\n        };\n        // Core methods\n        canvas.texture = wrap(texture);\n        canvas.draw = wrap(draw);\n        canvas.update = wrap(update);\n        canvas.contents = wrap(contents);\n        canvas.getPixelArray = wrap(getPixelArray);\n        // Filter methods\n        canvas.brightnessContrast = wrap((0, $76shC.brightnessContrast));\n        canvas.hueSaturation = wrap((0, $h6IOH.hueSaturation));\n        canvas.triangleBlur = wrap((0, $e0olz.triangleBlur));\n        canvas.unsharpMask = wrap((0, $kSoEy.unsharpMask));\n        canvas.perspective = wrap((0, $fkecp.perspective));\n        canvas.matrixWarp = wrap((0, $44j8K.matrixWarp));\n        canvas.tiltShift = wrap((0, $2myDH.tiltShift));\n        canvas.noise = wrap((0, $9uhWc.noise));\n        canvas.curves = wrap((0, $1Vq1u.curves));\n        canvas.invert = wrap((0, $bJIp5.invert));\n        canvas.multiplyAlpha = wrap((0, $lwXVT.multiplyAlpha));\n        canvas.unmultiplyAlpha = wrap((0, $3u9Uu.unmultiplyAlpha));\n        canvas.toAlpha = wrap((0, $9WU1L.toAlpha));\n        canvas.distort = wrap((0, $6lIef.distort));\n        return canvas;\n    };\n}();\n\n});\nparcelRequire.register(\"76shC\", function(module, exports) {\n\n$parcel$export(module.exports, \"brightnessContrast\", function () { return $c50d7229cf0a789e$export$6408eeb1703e74b8; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $jrAes = parcelRequire(\"jrAes\");\n\nvar $fvBHO = parcelRequire(\"fvBHO\");\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\nvar $c50d7229cf0a789e$export$6408eeb1703e74b8 = function brightnessContrast(brightness, contrast) {\n    (0, $7dEWP.gl).brightnessContrast = (0, $7dEWP.gl).brightnessContrast || new (0, $fvBHO.FxShader)(null, \"        uniform sampler2D texture;        uniform float brightness;        uniform float contrast;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color.rgb += brightness;            if (contrast > 0.0) {                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;            } else {                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;            }            gl_FragColor = color;        }    \", \"brightnessContrast\");\n    (0, $jrAes.simpleShader).call(this, (0, $7dEWP.gl).brightnessContrast, {\n        brightness: (0, $eWjiX.BB).clamp(brightness, -1, 1),\n        contrast: (0, $eWjiX.BB).clamp(contrast, -1, 1)\n    });\n    return this;\n};\n\n});\nparcelRequire.register(\"jrAes\", function(module, exports) {\n\n$parcel$export(module.exports, \"simpleShader\", function () { return $8501a2e1e79821a9$export$d731e22ecd0c25d3; });\nfunction $8501a2e1e79821a9$export$d731e22ecd0c25d3(shader, uniforms, textureIn, textureOut) {\n    (textureIn || this._.texture).use();\n    this._.spareTexture.drawTo(function() {\n        shader.uniforms(uniforms).drawRect();\n    });\n    this._.spareTexture.swapWith(textureOut || this._.texture);\n}\n\n});\n\nparcelRequire.register(\"fvBHO\", function(module, exports) {\n\n$parcel$export(module.exports, \"FxShader\", function () { return $e0143068cd462268$export$7d9b0d118d0c4108; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $8N5YG = parcelRequire(\"8N5YG\");\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $e0143068cd462268$var$defaultVertexSource = \"    attribute vec2 vertex;    attribute vec2 _texCoord;    varying vec2 texCoord;    void main() {        texCoord = _texCoord;        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);    }\";\nvar $e0143068cd462268$var$defaultFragmentSource = \"    uniform sampler2D texture;    varying vec2 texCoord;    void main() {        gl_FragColor = texture2D(texture, texCoord);    }\";\nfunction $e0143068cd462268$var$isArray(obj) {\n    return Object.prototype.toString.call(obj) == \"[object Array]\";\n}\nfunction $e0143068cd462268$var$isNumber(obj) {\n    return Object.prototype.toString.call(obj) == \"[object Number]\";\n}\nvar $e0143068cd462268$var$floatPrecision;\nvar $e0143068cd462268$export$7d9b0d118d0c4108 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function FxShader(vertexSource, fragmentSource, nameStr) {\n        (0, $cx0mh._)(this, FxShader);\n        this.vertexAttribute = null;\n        this.texCoordAttribute = null;\n        this.program = (0, $eWjiX.BB).throwIfNull((0, $7dEWP.gl).createProgram());\n        vertexSource = vertexSource || $e0143068cd462268$var$defaultVertexSource;\n        fragmentSource = fragmentSource || $e0143068cd462268$var$defaultFragmentSource;\n        if (!$e0143068cd462268$var$floatPrecision) $e0143068cd462268$var$floatPrecision = this.testPrecisionSupport((0, $7dEWP.gl).HIGH_FLOAT) ? \"highp\" : this.testPrecisionSupport((0, $7dEWP.gl).MEDIUM_FLOAT) ? \"mediump\" : \"lowp\";\n        fragmentSource = \"precision \" + $e0143068cd462268$var$floatPrecision + \" float;\" + fragmentSource; // annoying requirement is annoying\n        (0, $7dEWP.gl).attachShader(this.program, this.compileSource((0, $7dEWP.gl).VERTEX_SHADER, vertexSource, nameStr + \"(vertex)\"));\n        (0, $7dEWP.gl).attachShader(this.program, this.compileSource((0, $7dEWP.gl).FRAGMENT_SHADER, fragmentSource, nameStr + \"(fragment)\"));\n        (0, $7dEWP.gl).linkProgram(this.program);\n        if (!(0, $7dEWP.gl).getProgramParameter(this.program, (0, $7dEWP.gl).LINK_STATUS)) throw \"link error: \" + (0, $7dEWP.gl).getProgramInfoLog(this.program);\n    }\n    (0, $7h4XF._)(FxShader, [\n        {\n            key: \"compileSource\",\n            value: // ---- private ----\n            function compileSource(type, source, nameStr) {\n                var shader = (0, $eWjiX.BB).throwIfNull((0, $7dEWP.gl).createShader(type));\n                (0, $7dEWP.gl).shaderSource(shader, source.replace(/#define.*/, \"\")); // glslify adds a line add the beginning that breaks it\n                (0, $7dEWP.gl).compileShader(shader);\n                if (!(0, $7dEWP.gl).getShaderParameter(shader, (0, $7dEWP.gl).COMPILE_STATUS)) throw \"compile error: \" + nameStr + \" - \" + (0, $7dEWP.gl).getShaderInfoLog(shader);\n                return shader;\n            }\n        },\n        {\n            key: \"testPrecisionSupport\",\n            value: /**\r\n     * HIGH_FLOAT | MEDIUM_FLOAT\r\n     */ function testPrecisionSupport(precisionType) {\n                var format = (0, $7dEWP.gl).getShaderPrecisionFormat((0, $7dEWP.gl).FRAGMENT_SHADER, precisionType);\n                return format !== null && format.precision !== 0;\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                (0, $7dEWP.gl).deleteProgram(this.program);\n                this.program = null;\n            }\n        },\n        {\n            key: \"uniforms\",\n            value: function uniforms(uniforms) {\n                var _this = this;\n                (0, $7dEWP.gl).useProgram(this.program);\n                Object.entries(uniforms).forEach(function(param) {\n                    var _param = (0, $8N5YG._)(param, 2), name = _param[0], value = _param[1];\n                    var location = (0, $7dEWP.gl).getUniformLocation(_this.program, name);\n                    if (location === null) // will be null if the uniform isn't used in the shader\n                    return;\n                    if ($e0143068cd462268$var$isArray(value)) switch(value.length){\n                        case 1:\n                            (0, $7dEWP.gl).uniform1fv(location, new Float32Array(value));\n                            break;\n                        case 2:\n                            (0, $7dEWP.gl).uniform2fv(location, new Float32Array(value));\n                            break;\n                        case 3:\n                            (0, $7dEWP.gl).uniform3fv(location, new Float32Array(value));\n                            break;\n                        case 4:\n                            (0, $7dEWP.gl).uniform4fv(location, new Float32Array(value));\n                            break;\n                        case 9:\n                            (0, $7dEWP.gl).uniformMatrix3fv(location, false, new Float32Array(value));\n                            break;\n                        case 16:\n                            (0, $7dEWP.gl).uniformMatrix4fv(location, false, new Float32Array(value));\n                            break;\n                        default:\n                            throw \"dont't know how to load uniform \\\"\" + name + '\" of length ' + value.length;\n                    }\n                    else if ($e0143068cd462268$var$isNumber(value)) (0, $7dEWP.gl).uniform1f(location, value);\n                    else throw 'attempted to set uniform \"' + name + '\" to invalid value ' + (value || \"undefined\").toString();\n                });\n                // allow chaining\n                return this;\n            }\n        },\n        {\n            //\n            /**\r\n     * textures are uniforms too but for some reason can't be specified by gl.uniform1f,\r\n     * even though floating point numbers represent the integers 0 through 7 exactly\r\n     */ key: \"textures\",\n            value: function textures(textures) {\n                var _this = this;\n                (0, $7dEWP.gl).useProgram(this.program);\n                Object.entries(textures).forEach(function(param) {\n                    var _param = (0, $8N5YG._)(param, 2), name = _param[0], value = _param[1];\n                    (0, $7dEWP.gl).uniform1i((0, $7dEWP.gl).getUniformLocation(_this.program, name), value);\n                });\n                // allow chaining\n                return this;\n            }\n        },\n        {\n            key: \"drawRect\",\n            value: function drawRect(left, top, right, bottom) {\n                var undefined;\n                var viewport = (0, $7dEWP.gl).getParameter((0, $7dEWP.gl).VIEWPORT);\n                top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\n                left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\n                right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\n                bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\n                if ((0, $7dEWP.gl).vertexBuffer === undefined || (0, $7dEWP.gl).vertexBuffer === null) (0, $7dEWP.gl).vertexBuffer = (0, $eWjiX.BB).throwIfNull((0, $7dEWP.gl).createBuffer());\n                (0, $7dEWP.gl).bindBuffer((0, $7dEWP.gl).ARRAY_BUFFER, (0, $7dEWP.gl).vertexBuffer);\n                (0, $7dEWP.gl).bufferData((0, $7dEWP.gl).ARRAY_BUFFER, new Float32Array([\n                    left,\n                    top,\n                    left,\n                    bottom,\n                    right,\n                    top,\n                    right,\n                    bottom\n                ]), (0, $7dEWP.gl).STATIC_DRAW);\n                if ((0, $7dEWP.gl).texCoordBuffer == null) {\n                    (0, $7dEWP.gl).texCoordBuffer = (0, $eWjiX.BB).throwIfNull((0, $7dEWP.gl).createBuffer());\n                    (0, $7dEWP.gl).bindBuffer((0, $7dEWP.gl).ARRAY_BUFFER, (0, $7dEWP.gl).texCoordBuffer);\n                    (0, $7dEWP.gl).bufferData((0, $7dEWP.gl).ARRAY_BUFFER, new Float32Array([\n                        0,\n                        0,\n                        0,\n                        1,\n                        1,\n                        0,\n                        1,\n                        1\n                    ]), (0, $7dEWP.gl).STATIC_DRAW);\n                }\n                if (this.vertexAttribute == null) {\n                    this.vertexAttribute = (0, $7dEWP.gl).getAttribLocation(this.program, \"vertex\");\n                    (0, $7dEWP.gl).enableVertexAttribArray(this.vertexAttribute);\n                }\n                if (this.texCoordAttribute == null) {\n                    this.texCoordAttribute = (0, $7dEWP.gl).getAttribLocation(this.program, \"_texCoord\");\n                    (0, $7dEWP.gl).enableVertexAttribArray(this.texCoordAttribute);\n                }\n                (0, $7dEWP.gl).useProgram(this.program);\n                (0, $7dEWP.gl).bindBuffer((0, $7dEWP.gl).ARRAY_BUFFER, (0, $7dEWP.gl).vertexBuffer);\n                (0, $7dEWP.gl).vertexAttribPointer(this.vertexAttribute, 2, (0, $7dEWP.gl).FLOAT, false, 0, 0);\n                (0, $7dEWP.gl).bindBuffer((0, $7dEWP.gl).ARRAY_BUFFER, (0, $7dEWP.gl).texCoordBuffer);\n                (0, $7dEWP.gl).vertexAttribPointer(this.texCoordAttribute, 2, (0, $7dEWP.gl).FLOAT, false, 0, 0);\n                (0, $7dEWP.gl).drawArrays((0, $7dEWP.gl).TRIANGLE_STRIP, 0, 4);\n            }\n        }\n    ], [\n        {\n            key: \"getDefaultShader\",\n            value: // ---- static ----\n            function getDefaultShader() {\n                (0, $7dEWP.gl).defaultShader = (0, $7dEWP.gl).defaultShader || new FxShader();\n                return (0, $7dEWP.gl).defaultShader;\n            }\n        }\n    ]);\n    return FxShader;\n}();\n\n});\nparcelRequire.register(\"7dEWP\", function(module, exports) {\n\n$parcel$export(module.exports, \"gl\", function () { return $deb6b884ba4ae312$export$5822a9d0880a5d82; });\n$parcel$export(module.exports, \"setGl\", function () { return $deb6b884ba4ae312$export$b59c6427db8463f4; });\nvar $deb6b884ba4ae312$export$5822a9d0880a5d82;\nfunction $deb6b884ba4ae312$export$b59c6427db8463f4(newGl) {\n    // more problems setting type to null\n    $deb6b884ba4ae312$export$5822a9d0880a5d82 = newGl;\n}\n\n});\n\n\n\nparcelRequire.register(\"8dg54\", function(module, exports) {\n\n$parcel$export(module.exports, \"FxTexture\", function () { return $80392da2a95619fd$export$7e6fd232cff50dd1; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $80392da2a95619fd$export$7e6fd232cff50dd1 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function FxTexture(width, height, format, type) {\n        (0, $cx0mh._)(this, FxTexture);\n        this.gl = (0, $7dEWP.gl);\n        this.id = (0, $eWjiX.BB).throwIfNull((0, $7dEWP.gl).createTexture());\n        this.width = width;\n        this.height = height;\n        this.format = format;\n        this.type = type;\n        this.canvas = null;\n        (0, $7dEWP.gl).bindTexture((0, $7dEWP.gl).TEXTURE_2D, this.id);\n        (0, $7dEWP.gl).texParameteri((0, $7dEWP.gl).TEXTURE_2D, (0, $7dEWP.gl).TEXTURE_MAG_FILTER, (0, $7dEWP.gl).LINEAR);\n        (0, $7dEWP.gl).texParameteri((0, $7dEWP.gl).TEXTURE_2D, (0, $7dEWP.gl).TEXTURE_MIN_FILTER, (0, $7dEWP.gl).LINEAR);\n        (0, $7dEWP.gl).texParameteri((0, $7dEWP.gl).TEXTURE_2D, (0, $7dEWP.gl).TEXTURE_WRAP_S, (0, $7dEWP.gl).CLAMP_TO_EDGE);\n        (0, $7dEWP.gl).texParameteri((0, $7dEWP.gl).TEXTURE_2D, (0, $7dEWP.gl).TEXTURE_WRAP_T, (0, $7dEWP.gl).CLAMP_TO_EDGE);\n        if (width && height) (0, $7dEWP.gl).texImage2D((0, $7dEWP.gl).TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n    }\n    (0, $7h4XF._)(FxTexture, [\n        {\n            key: \"loadContentsOf\",\n            value: function loadContentsOf(element) {\n                this.width = element.width || element.videoWidth;\n                this.height = element.height || element.videoHeight;\n                (0, $7dEWP.gl).bindTexture((0, $7dEWP.gl).TEXTURE_2D, this.id);\n                (0, $7dEWP.gl).texImage2D((0, $7dEWP.gl).TEXTURE_2D, 0, this.format, this.format, this.type, element);\n            }\n        },\n        {\n            key: \"initFromBytes\",\n            value: function initFromBytes(width, height, data) {\n                this.width = width;\n                this.height = height;\n                this.format = (0, $7dEWP.gl).RGBA;\n                this.type = (0, $7dEWP.gl).UNSIGNED_BYTE;\n                (0, $7dEWP.gl).bindTexture((0, $7dEWP.gl).TEXTURE_2D, this.id);\n                (0, $7dEWP.gl).texImage2D((0, $7dEWP.gl).TEXTURE_2D, 0, (0, $7dEWP.gl).RGBA, width, height, 0, (0, $7dEWP.gl).RGBA, this.type, new Uint8Array(data));\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                (0, $7dEWP.gl).deleteTexture(this.id);\n                this.id = null;\n            }\n        },\n        {\n            key: \"use\",\n            value: function use(unit) {\n                (0, $7dEWP.gl).activeTexture((0, $7dEWP.gl).TEXTURE0 + (unit || 0));\n                (0, $7dEWP.gl).bindTexture((0, $7dEWP.gl).TEXTURE_2D, this.id);\n            }\n        },\n        {\n            key: \"unuse\",\n            value: function unuse(unit) {\n                (0, $7dEWP.gl).activeTexture((0, $7dEWP.gl).TEXTURE0 + (unit || 0));\n                (0, $7dEWP.gl).bindTexture((0, $7dEWP.gl).TEXTURE_2D, null);\n            }\n        },\n        {\n            key: \"ensureFormat\",\n            value: function ensureFormat(width, height, format, type) {\n                // change the format only if required\n                if (width != this.width || height != this.height || format != this.format || type != this.type) {\n                    this.width = width;\n                    this.height = height;\n                    this.format = format;\n                    this.type = type;\n                    (0, $7dEWP.gl).bindTexture((0, $7dEWP.gl).TEXTURE_2D, this.id);\n                    (0, $7dEWP.gl).texImage2D((0, $7dEWP.gl).TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n                }\n            }\n        },\n        {\n            key: \"ensureFormatViaTexture\",\n            value: function ensureFormatViaTexture(texture) {\n                this.ensureFormat(texture.width, texture.height, texture.format, texture.type);\n            }\n        },\n        {\n            key: \"drawTo\",\n            value: function drawTo(callback) {\n                // start rendering to this texture\n                (0, $7dEWP.gl).framebuffer = (0, $7dEWP.gl).framebuffer || (0, $7dEWP.gl).createFramebuffer();\n                (0, $7dEWP.gl).bindFramebuffer((0, $7dEWP.gl).FRAMEBUFFER, (0, $7dEWP.gl).framebuffer);\n                (0, $7dEWP.gl).framebufferTexture2D((0, $7dEWP.gl).FRAMEBUFFER, (0, $7dEWP.gl).COLOR_ATTACHMENT0, (0, $7dEWP.gl).TEXTURE_2D, this.id, 0);\n                if ((0, $7dEWP.gl).checkFramebufferStatus((0, $7dEWP.gl).FRAMEBUFFER) !== (0, $7dEWP.gl).FRAMEBUFFER_COMPLETE) throw new Error(\"incomplete framebuffer\");\n                (0, $7dEWP.gl).viewport(0, 0, this.width, this.height);\n                // do the drawing\n                callback();\n                // stop rendering to this texture\n                (0, $7dEWP.gl).bindFramebuffer((0, $7dEWP.gl).FRAMEBUFFER, null);\n            }\n        },\n        {\n            /*\r\n    // never seen this being used\r\n    fillUsingCanvas (callback: (canvas: CanvasRenderingContext2D) => void): Texture {\r\n        callback(this.getCanvas(this));\r\n        this.format = gl.RGBA;\r\n        this.type = gl.UNSIGNED_BYTE;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.canvas);\r\n        return this;\r\n    }\r\n\r\n    // never seen this being used\r\n    toImage (image: HTMLImageElement): void {\r\n        this.use();\r\n        Shader.getDefaultShader().drawRect();\r\n        const size = this.width * this.height * 4;\r\n        const pixels = new Uint8Array(size);\r\n        const c = this.getCanvas(this);\r\n        const data = c.createImageData(this.width, this.height);\r\n        gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n        for (let i = 0; i < size; i++) {\r\n            data.data[i] = pixels[i];\r\n        }\r\n        c.putImageData(data, 0, 0);\r\n        image.src = this.canvas.toDataURL();\r\n    }\r\n     */ key: \"swapWith\",\n            value: function swapWith(other) {\n                var temp;\n                temp = other.id;\n                other.id = this.id;\n                this.id = temp;\n                temp = other.width;\n                other.width = this.width;\n                this.width = temp;\n                temp = other.height;\n                other.height = this.height;\n                this.height = temp;\n                temp = other.format;\n                other.format = this.format;\n                this.format = temp;\n            // type?\n            }\n        }\n    ], [\n        {\n            key: \"fromElement\",\n            value: // ---- static ----\n            function fromElement(element) {\n                var texture = new FxTexture(0, 0, (0, $7dEWP.gl).RGBA, (0, $7dEWP.gl).UNSIGNED_BYTE);\n                texture.loadContentsOf(element);\n                return texture;\n            }\n        }\n    ]);\n    return FxTexture;\n}();\n\n});\n\nparcelRequire.register(\"1Vq1u\", function(module, exports) {\n\n$parcel$export(module.exports, \"curves\", function () { return $7480e3ce85bc65db$export$6894093bf294bea5; });\n\nvar $fRyi0 = parcelRequire(\"fRyi0\");\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\n\nvar $fvBHO = parcelRequire(\"fvBHO\");\n\nvar $jrAes = parcelRequire(\"jrAes\");\nvar $7480e3ce85bc65db$export$6894093bf294bea5 = function curves(red, green, blue) {\n    // Create the ramp texture\n    var redRamp = (0, $fRyi0.splineInterpolate)(red);\n    var greenRamp = (0, $fRyi0.splineInterpolate)(green);\n    var blueRamp = (0, $fRyi0.splineInterpolate)(blue);\n    var array = [];\n    for(var i = 0; i < 256; i++)array.splice(array.length, 0, redRamp[i], greenRamp[i], blueRamp[i], 255);\n    this._.extraTexture.initFromBytes(256, 1, array);\n    this._.extraTexture.use(1);\n    (0, $7dEWP.gl).curves = (0, $7dEWP.gl).curves || new (0, $fvBHO.FxShader)(null, \"        uniform sampler2D texture;        uniform sampler2D map;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color.r = texture2D(map, vec2(color.r)).r;            color.g = texture2D(map, vec2(color.g)).g;            color.b = texture2D(map, vec2(color.b)).b;            gl_FragColor = color;        }    \", \"curves\");\n    (0, $7dEWP.gl).curves.textures({\n        map: 1\n    });\n    (0, $jrAes.simpleShader).call(this, (0, $7dEWP.gl).curves, {});\n    return this;\n};\n\n});\nparcelRequire.register(\"fRyi0\", function(module, exports) {\n\n$parcel$export(module.exports, \"splineInterpolate\", function () { return $d747444e26286abc$export$4f237735eca1f248; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nfunction $d747444e26286abc$export$4f237735eca1f248(points) {\n    var interpolator = new (0, $eWjiX.BB).SplineInterpolator(points);\n    var array = [];\n    for(var i = 0; i < 256; i++)array.push((0, $eWjiX.BB).clamp(Math.floor(interpolator.interpolate(i / 255) * 256), 0, 255));\n    return array;\n}\n\n});\n\n\nparcelRequire.register(\"h6IOH\", function(module, exports) {\n\n$parcel$export(module.exports, \"hueSaturation\", function () { return $6dd7d8fac84d64b7$export$ef28bbbd731e79bf; });\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\n\nvar $fvBHO = parcelRequire(\"fvBHO\");\n\nvar $jrAes = parcelRequire(\"jrAes\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $6dd7d8fac84d64b7$export$ef28bbbd731e79bf = function hueSaturation(hue, saturation) {\n    (0, $7dEWP.gl).hueSaturation = (0, $7dEWP.gl).hueSaturation || new (0, $fvBHO.FxShader)(null, \"        uniform sampler2D texture;        uniform float hue;        uniform float saturation;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);                        /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */            float angle = hue * 3.14159265;            float s = sin(angle), c = cos(angle);            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;            float len = length(color.rgb);            color.rgb = vec3(                dot(color.rgb, weights.xyz),                dot(color.rgb, weights.zxy),                dot(color.rgb, weights.yzx)            );                        /* saturation adjustment */            float average = (color.r + color.g + color.b) / 3.0;            if (saturation > 0.0) {                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));            } else {                color.rgb += (average - color.rgb) * (-saturation);            }                        gl_FragColor = color;        }    \", \"hueSaturation\");\n    (0, $jrAes.simpleShader).call(this, (0, $7dEWP.gl).hueSaturation, {\n        hue: (0, $eWjiX.BB).clamp(hue, -1, 1),\n        saturation: (0, $eWjiX.BB).clamp(saturation, -1, 1)\n    });\n    return this;\n};\n\n});\n\nparcelRequire.register(\"9uhWc\", function(module, exports) {\n\n$parcel$export(module.exports, \"noise\", function () { return $dd5d88e299e80db3$export$d3022aad56692482; });\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\n\nvar $fvBHO = parcelRequire(\"fvBHO\");\n\nvar $jrAes = parcelRequire(\"jrAes\");\n\nvar $3TO8L = parcelRequire(\"3TO8L\");\nvar $dd5d88e299e80db3$export$d3022aad56692482 = function noise(seed, type, scale, offset, octaves, samples, peaks, brightness, contrast, isReversed, colA, colB, channels) {\n    (0, $7dEWP.gl).noise = (0, $7dEWP.gl).noise || new (0, $fvBHO.FxShader)(null, (0, (/*@__PURE__*/$parcel$interopDefault($3TO8L))).replace(/#define.*/, \"\"), \"noise\");\n    (0, $jrAes.simpleShader).call(this, (0, $7dEWP.gl).noise, {\n        seed: seed || 0,\n        type: type,\n        scale: [\n            scale[0],\n            scale[1]\n        ],\n        offset: offset,\n        octaves: octaves,\n        samples: samples,\n        texSize: [\n            this.width,\n            this.height\n        ],\n        peaks: peaks,\n        brightness: brightness,\n        contrast: contrast,\n        isReversed: isReversed ? 1.0 : 0.0,\n        colA: colA ? [\n            colA.r / 255,\n            colA.g / 255,\n            colA.b / 255\n        ] : [\n            0,\n            0,\n            0\n        ],\n        colB: colB ? [\n            colB.r / 255,\n            colB.g / 255,\n            colB.b / 255\n        ] : [\n            1,\n            1,\n            1\n        ],\n        channels: channels === \"rgb\" ? 0 : 1\n    });\n    return this;\n};\n\n});\nparcelRequire.register(\"3TO8L\", function(module, exports) {\nmodule.exports = \"#define GLSLIFY 1\\nuniform sampler2D texture;\\nvarying vec2 texCoord;\\nuniform vec2 texSize;\\n\\nuniform float seed;\\nuniform float type;\\nuniform vec2 scale;\\nuniform vec2 offset;\\nuniform float octaves;\\nuniform float samples;\\n\\nuniform float peaks;\\nuniform float contrast;\\nuniform float brightness;\\nuniform float isReversed;\\n\\nuniform vec3 colA;\\nuniform vec3 colB;\\n\\nuniform float channels; // 0 - rgb, 1 - alpha\\n\\n// fbm, cellular_noise based on\\n// https://github.com/Gonkee/Gonkees-Shaders\\n// MIT, Copyright \\xa9 Gonkee\\n\\n// hash & simplex based on\\n// https://www.shadertoy.com/view/Msf3WH\\n// MIT, Copyright \\xa9 2013 Inigo Quilez\\n// https://www.youtube.com/c/InigoQuilez\\n// https://iquilezles.org\\n\\nfloat rand(vec2 co) {\\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\\n}\\n\\nfloat value_noise(vec2 coord){\\n    return rand(floor(coord) / 100.0);\\n}\\n\\nfloat cellular_noise(vec2 coord) {\\n    vec2 i = floor(coord);\\n    vec2 f = fract(coord);\\n\\n    float min_dist = 99999.0;\\n    for (float x = -1.0; x <= 1.0; x++) {\\n        for (float y = -1.0; y <= 1.0; y++) {\\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\\n            min_dist = min(min_dist, dist);\\n        }\\n    }\\n    return min_dist;\\n}\\n\\n// ---------- Simplex Alternative ---------------------\\n\\nvec3 hash(vec3 p)\\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\\n, dot(p, vec3(269.5, 183.3, 246.1))\\n, dot(p, vec3(113.5, 271.9, 124.6)))\\n;return fract(sin(p)*43758.5453123)*2.-1.; }\\n\\nmat3 hash(mat3 p)\\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\\n\\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\\n\\n//return noiseGra13dx as .x, and its derivatives as .yzw\\n// https://www.shadertoy.com/view/llByD1\\nvec3 noiseGra13dx(in vec3 x) {\\n    vec3 p=floor(x), w=fract(x)\\n    #if 1\\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\\n    #else\\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\\n    #endif\\n    //gradients\\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\\n    //projections\\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\\n    //interpolations\\n    float g=dot(G, w), f=dot(F, w-vec3(1));\\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\\n    mat3 S=D-mat3(G, G, G), W=D-E;\\n    a.x=(a.x+a.y+a.z)+f-g;\\n    ;float b=u.x*u.y*u.z;\\n\\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\\n    return 0.5 + 0.5 * result.xxx;\\n}\\n\\nfloat fbm(vec2 coord) {\\n    float normalize_factor = 0.0;\\n    float value = 0.0;\\n    float scale = 0.5;\\n\\n    for (float i = 0.0; i < 7.0; i++){\\n        if (i < octaves) {\\n            if (type == 0.0) {\\n                value += value_noise(coord) * scale;\\n            } else if (type == 1.0) {\\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\\n            } else if (type == 2.0) {\\n                value += cellular_noise(coord) * scale;\\n            }\\n            normalize_factor += scale;\\n            coord *= 2.0;\\n            scale *= 0.5;\\n        }\\n    }\\n    return value / normalize_factor;\\n}\\n\\nfloat render (vec2 pos) {\\n    float result = fbm(pos);\\n    //\\n\\n    if (peaks > 0.0) {\\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\\n    }\\n\\n    result += brightness;\\n    if (contrast > 0.0) {\\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\\n    } else if (contrast < 0.0) {\\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\\n    }\\n\\n    if (isReversed == 1.0) {\\n        result = 1.0 - result;\\n    }\\n    return result;\\n}\\n\\nvoid main() {\\n    vec4 color;\\n\\n    vec2 seedOffset;\\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\\n\\n    float val = 0.0;\\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\\n\\n    if (samples == 1.0) {\\n        val = render(basePos);\\n\\n    }/* else if (samples == 4.0) {\\n        for (float i = 0.0; i < 2.0; i++) {\\n            for (float e = 0.0; e < 2.0; e++) {\\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\\n            }\\n        }\\n        val /= 4.0;\\n\\n    }*/ else if (samples == 16.0) {\\n        for (float i = 0.0; i < 4.0; i++) {\\n            for (float e = 0.0; e < 4.0; e++) {\\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\\n            }\\n        }\\n        val /= 16.0;\\n    }\\n\\n    if (channels == 0.0) {\\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\\n    } else {\\n        gl_FragColor = vec4(vec3(1.0), val);\\n    }\\n}\";\n\n});\n\n\nparcelRequire.register(\"e0olz\", function(module, exports) {\n\n$parcel$export(module.exports, \"triangleBlur\", function () { return $b01b186720ebdc8e$export$6e852234f1597a14; });\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\n\nvar $fvBHO = parcelRequire(\"fvBHO\");\n\nvar $4urfK = parcelRequire(\"4urfK\");\n\nvar $jrAes = parcelRequire(\"jrAes\");\nvar $b01b186720ebdc8e$export$6e852234f1597a14 = function triangleBlur(radius) {\n    (0, $7dEWP.gl).triangleBlur = (0, $7dEWP.gl).triangleBlur || new (0, $fvBHO.FxShader)(null, \"        uniform sampler2D texture;        uniform vec2 delta;        varying vec2 texCoord;        \" + (0, $4urfK.randomShaderFunc) + \"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec4 sample = texture2D(texture, texCoord + delta * percent);                                /* switch to pre-multiplied alpha to correctly blur transparent images */                sample.rgb *= sample.a;                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;                        /* switch back from pre-multiplied alpha */            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;        }    \", \"triangleBlur\");\n    (0, $jrAes.simpleShader).call(this, (0, $7dEWP.gl).triangleBlur, {\n        delta: [\n            radius / this.width,\n            0\n        ]\n    });\n    (0, $jrAes.simpleShader).call(this, (0, $7dEWP.gl).triangleBlur, {\n        delta: [\n            0,\n            radius / this.height\n        ]\n    });\n    return this;\n};\n\n});\nparcelRequire.register(\"4urfK\", function(module, exports) {\n\n$parcel$export(module.exports, \"randomShaderFunc\", function () { return $904e6ba1142f7a16$export$af69f7ca07da04c9; });\n// returns a random number between 0 and 1\nvar $904e6ba1142f7a16$export$af69f7ca07da04c9 = \"    float random(vec3 scale, float seed) {        /* use the fragment position for a different seed per-pixel */        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);    }\";\n\n});\n\n\nparcelRequire.register(\"2myDH\", function(module, exports) {\n\n$parcel$export(module.exports, \"tiltShift\", function () { return $1ec92859a97056c3$export$4545acb2b6bb8f22; });\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\n\nvar $fvBHO = parcelRequire(\"fvBHO\");\n\nvar $4urfK = parcelRequire(\"4urfK\");\n\nvar $jrAes = parcelRequire(\"jrAes\");\nvar $1ec92859a97056c3$export$4545acb2b6bb8f22 = function tiltShift(startX, startY, endX, endY, blurRadius, gradientRadius) {\n    (0, $7dEWP.gl).tiltShift = (0, $7dEWP.gl).tiltShift || new (0, $fvBHO.FxShader)(null, \"        uniform sampler2D texture;        uniform float blurRadius;        uniform float gradientRadius;        uniform vec2 start;        uniform vec2 end;        uniform vec2 delta;        uniform vec2 texSize;        varying vec2 texCoord;        \" + (0, $4urfK.randomShaderFunc) + \"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;            for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);                                /* switch to pre-multiplied alpha to correctly blur transparent images */                sample.rgb *= sample.a;                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;                        /* switch back from pre-multiplied alpha */            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;        }    \", \"tiltShift\");\n    var dx = endX - startX;\n    var dy = endY - startY;\n    var d = Math.sqrt(dx * dx + dy * dy);\n    (0, $jrAes.simpleShader).call(this, (0, $7dEWP.gl).tiltShift, {\n        blurRadius: blurRadius,\n        gradientRadius: gradientRadius,\n        start: [\n            startX,\n            startY\n        ],\n        end: [\n            endX,\n            endY\n        ],\n        delta: [\n            dx / d,\n            dy / d\n        ],\n        texSize: [\n            this.width,\n            this.height\n        ]\n    });\n    (0, $jrAes.simpleShader).call(this, (0, $7dEWP.gl).tiltShift, {\n        blurRadius: blurRadius,\n        gradientRadius: gradientRadius,\n        start: [\n            startX,\n            startY\n        ],\n        end: [\n            endX,\n            endY\n        ],\n        delta: [\n            -dy / d,\n            dx / d\n        ],\n        texSize: [\n            this.width,\n            this.height\n        ]\n    });\n    return this;\n};\n\n});\n\nparcelRequire.register(\"44j8K\", function(module, exports) {\n\n$parcel$export(module.exports, \"matrixWarp\", function () { return $5b33fb39bf5722a9$export$a93b0222aeadc54b; });\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\n\nvar $gDZ5A = parcelRequire(\"gDZ5A\");\n\nvar $jrAes = parcelRequire(\"jrAes\");\n\nvar $5taNf = parcelRequire(\"5taNf\");\nvar $5b33fb39bf5722a9$export$a93b0222aeadc54b = function matrixWarp(matrix, inverse, useTextureSpace) {\n    (0, $7dEWP.gl).matrixWarp = (0, $7dEWP.gl).matrixWarp || (0, $gDZ5A.warpShader)(\"        uniform mat3 matrix;        uniform bool useTextureSpace;    \", \"        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;        vec3 warp = matrix * vec3(coord, 1.0);        coord = warp.xy / warp.z;        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;    \");\n    // Flatten all members of matrix into one big list\n    matrix = matrix.flat();\n    // Extract a 3x3 matrix out of the arguments\n    if (matrix.length == 4) matrix = [\n        matrix[0],\n        matrix[1],\n        0,\n        matrix[2],\n        matrix[3],\n        0,\n        0,\n        0,\n        1\n    ];\n    else if (matrix.length != 9) throw \"can only warp with 2x2 or 3x3 matrix\";\n    (0, $jrAes.simpleShader).call(this, (0, $7dEWP.gl).matrixWarp, {\n        matrix: inverse ? (0, $5taNf.getInverse)(matrix) : matrix,\n        texSize: [\n            this.width,\n            this.height\n        ],\n        useTextureSpace: useTextureSpace ? 1 : 0\n    });\n    return this;\n};\n\n});\nparcelRequire.register(\"gDZ5A\", function(module, exports) {\n\n$parcel$export(module.exports, \"warpShader\", function () { return $1d7339974b05a229$export$820b3a44cb7b2b21; });\n\nvar $fvBHO = parcelRequire(\"fvBHO\");\nfunction $1d7339974b05a229$export$820b3a44cb7b2b21(uniformsStr, warpStr) {\n    return new (0, $fvBHO.FxShader)(null, uniformsStr + \"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;    void main() {        vec2 coord = texCoord * texSize;        \" + warpStr + \"        gl_FragColor = texture2D(texture, coord / texSize);        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);        if (coord != clampedCoord) {            /* fade to transparent if we are outside the image */            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));        }    }\", \"warp\");\n}\n\n});\n\nparcelRequire.register(\"5taNf\", function(module, exports) {\n\n$parcel$export(module.exports, \"getSquareToQuad\", function () { return $303d8d4ec53c4881$export$1c447127d27d7be4; });\n$parcel$export(module.exports, \"getInverse\", function () { return $303d8d4ec53c4881$export$68b3343017e80691; });\n$parcel$export(module.exports, \"multiply\", function () { return $303d8d4ec53c4881$export$2060d2db72cce88f; });\nfunction $303d8d4ec53c4881$export$1c447127d27d7be4(x0, y0, x1, y1, x2, y2, x3, y3) {\n    var dx1 = x1 - x2;\n    var dy1 = y1 - y2;\n    var dx2 = x3 - x2;\n    var dy2 = y3 - y2;\n    var dx3 = x0 - x1 + x2 - x3;\n    var dy3 = y0 - y1 + y2 - y3;\n    var det = dx1 * dy2 - dx2 * dy1;\n    var a = (dx3 * dy2 - dx2 * dy3) / det;\n    var b = (dx1 * dy3 - dx3 * dy1) / det;\n    return [\n        x1 - x0 + a * x1,\n        y1 - y0 + a * y1,\n        a,\n        x3 - x0 + b * x3,\n        y3 - y0 + b * y3,\n        b,\n        x0,\n        y0,\n        1\n    ];\n}\nfunction $303d8d4ec53c4881$export$68b3343017e80691(m) {\n    var a = m[0], b = m[1], c = m[2];\n    var d = m[3], e = m[4], f = m[5];\n    var g = m[6], h = m[7], i = m[8];\n    var det = a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\n    return [\n        (e * i - f * h) / det,\n        (c * h - b * i) / det,\n        (b * f - c * e) / det,\n        (f * g - d * i) / det,\n        (a * i - c * g) / det,\n        (c * d - a * f) / det,\n        (d * h - e * g) / det,\n        (b * g - a * h) / det,\n        (a * e - b * d) / det\n    ];\n}\nfunction $303d8d4ec53c4881$export$2060d2db72cce88f(a, b) {\n    return [\n        a[0] * b[0] + a[1] * b[3] + a[2] * b[6],\n        a[0] * b[1] + a[1] * b[4] + a[2] * b[7],\n        a[0] * b[2] + a[1] * b[5] + a[2] * b[8],\n        a[3] * b[0] + a[4] * b[3] + a[5] * b[6],\n        a[3] * b[1] + a[4] * b[4] + a[5] * b[7],\n        a[3] * b[2] + a[4] * b[5] + a[5] * b[8],\n        a[6] * b[0] + a[7] * b[3] + a[8] * b[6],\n        a[6] * b[1] + a[7] * b[4] + a[8] * b[7],\n        a[6] * b[2] + a[7] * b[5] + a[8] * b[8]\n    ];\n}\n\n});\n\n\nparcelRequire.register(\"kSoEy\", function(module, exports) {\n\n$parcel$export(module.exports, \"unsharpMask\", function () { return $c6e0992c38eb55ab$export$915fb7313c578ba2; });\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\n\nvar $fvBHO = parcelRequire(\"fvBHO\");\n\nvar $jrAes = parcelRequire(\"jrAes\");\nvar $c6e0992c38eb55ab$export$915fb7313c578ba2 = function unsharpMask(radius, strength) {\n    (0, $7dEWP.gl).unsharpMask = (0, $7dEWP.gl).unsharpMask || new (0, $fvBHO.FxShader)(null, \"        uniform sampler2D blurredTexture;        uniform sampler2D originalTexture;        uniform float strength;        uniform float threshold;        varying vec2 texCoord;        void main() {            vec4 blurred = texture2D(blurredTexture, texCoord);            vec4 original = texture2D(originalTexture, texCoord);            gl_FragColor = mix(blurred, original, 1.0 + strength);        }    \", \"unsharpMask\");\n    // Store a copy of the current texture in the second texture unit\n    this._.extraTexture.ensureFormatViaTexture(this._.texture);\n    this._.texture.use();\n    this._.extraTexture.drawTo(function() {\n        (0, $fvBHO.FxShader).getDefaultShader().drawRect();\n    });\n    // Blur the current texture, then use the stored texture to detect edges\n    this._.extraTexture.use(1);\n    this.triangleBlur(radius);\n    (0, $7dEWP.gl).unsharpMask.textures({\n        originalTexture: 1\n    });\n    (0, $jrAes.simpleShader).call(this, (0, $7dEWP.gl).unsharpMask, {\n        strength: strength\n    });\n    this._.extraTexture.unuse(1);\n    return this;\n};\n\n});\n\nparcelRequire.register(\"9WU1L\", function(module, exports) {\n\n$parcel$export(module.exports, \"toAlpha\", function () { return $164716f3bce9dcdb$export$be1ee5ea42904fdc; });\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\n\nvar $fvBHO = parcelRequire(\"fvBHO\");\n\nvar $jrAes = parcelRequire(\"jrAes\");\nvar $164716f3bce9dcdb$export$be1ee5ea42904fdc = function toAlpha(isInverted, replaceRGBA) {\n    (0, $7dEWP.gl).toAlpha = (0, $7dEWP.gl).toAlpha || new (0, $fvBHO.FxShader)(null, \"    uniform bool isInverted;    uniform vec4 replace;    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        float alpha = (color.r + color.g + color.b) / 3.0;        if (isInverted) alpha = 1.0 - alpha;        alpha = min(color.a, alpha);        if (replace.a > 0.0) color = replace;        gl_FragColor = vec4(color.r, color.g, color.b, alpha);    }\", \"toAlpha\");\n    (0, $jrAes.simpleShader).call(this, (0, $7dEWP.gl).toAlpha, {\n        isInverted: isInverted ? 1 : 0,\n        replace: replaceRGBA ? [\n            replaceRGBA.r / 255,\n            replaceRGBA.g / 255,\n            replaceRGBA.b / 255,\n            replaceRGBA.a\n        ] : [\n            0,\n            0,\n            0,\n            0\n        ],\n        texSize: [\n            this.width,\n            this.height\n        ]\n    });\n    return this;\n};\n\n});\n\nparcelRequire.register(\"bJIp5\", function(module, exports) {\n\n$parcel$export(module.exports, \"invert\", function () { return $6fb892cfa80f1621$export$6897c284b6f9f4dc; });\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\n\nvar $fvBHO = parcelRequire(\"fvBHO\");\n\nvar $jrAes = parcelRequire(\"jrAes\");\nvar $6fb892cfa80f1621$export$6897c284b6f9f4dc = function invert() {\n    (0, $7dEWP.gl).invert = (0, $7dEWP.gl).invert || new (0, $fvBHO.FxShader)(null, \"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        color.rgb = 1.0 - color.rgb;        gl_FragColor = color;    }\", \"invert\");\n    (0, $jrAes.simpleShader).call(this, (0, $7dEWP.gl).invert, {\n        texSize: [\n            this.width,\n            this.height\n        ]\n    });\n    return this;\n};\n\n});\n\nparcelRequire.register(\"fkecp\", function(module, exports) {\n\n$parcel$export(module.exports, \"perspective\", function () { return $4d16a2f492bd5d16$export$541149539f3a4684; });\n\nvar $bX4ja = parcelRequire(\"bX4ja\");\n\nvar $5taNf = parcelRequire(\"5taNf\");\nvar $4d16a2f492bd5d16$export$541149539f3a4684 = function perspective(before, after) {\n    var a = (0, $5taNf.getSquareToQuad).apply(void 0, (0, $bX4ja._)(after));\n    var b = (0, $5taNf.getSquareToQuad).apply(void 0, (0, $bX4ja._)(before));\n    var c = (0, $5taNf.multiply)((0, $5taNf.getInverse)(a), b);\n    return this.matrixWarp(c);\n};\n\n});\n\nparcelRequire.register(\"3u9Uu\", function(module, exports) {\n\n$parcel$export(module.exports, \"unmultiplyAlpha\", function () { return $34a2490457ff8aab$export$b324c80262feb891; });\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\n\nvar $fvBHO = parcelRequire(\"fvBHO\");\n\nvar $jrAes = parcelRequire(\"jrAes\");\nvar $34a2490457ff8aab$export$b324c80262feb891 = function unmultiplyAlpha() {\n    (0, $7dEWP.gl).unmultiplyAlpha = (0, $7dEWP.gl).unmultiplyAlpha || new (0, $fvBHO.FxShader)(null, \"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        if(color.a > 0.0) {            color.rgb /= color.a;        }        gl_FragColor = color;    }\", \"unmultiplyAlpha\");\n    (0, $jrAes.simpleShader).call(this, (0, $7dEWP.gl).unmultiplyAlpha, {\n        texSize: [\n            this.width,\n            this.height\n        ]\n    });\n    return this;\n};\n\n});\n\nparcelRequire.register(\"6lIef\", function(module, exports) {\n\n$parcel$export(module.exports, \"distort\", function () { return $55618926ab99fefa$export$7c9b924528782480; });\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\n\nvar $gDZ5A = parcelRequire(\"gDZ5A\");\n\nvar $jrAes = parcelRequire(\"jrAes\");\nvar $55618926ab99fefa$export$7c9b924528782480 = function distort(settings) {\n    (0, $7dEWP.gl).distort = (0, $7dEWP.gl).distort || (0, $gDZ5A.warpShader)(\"        uniform float stepSize;        uniform vec2 scale;        uniform vec2 strength;        uniform vec2 phase;        uniform float type;        \", \"        const float PI = 3.14159265;        float x = coord.x;        float y = coord.y;        if (stepSize > 1.0) {            x = floor(x / stepSize) * stepSize;            y = floor(y / stepSize) * stepSize;        }        float distortX = sin((x/scale.x + phase.x) * PI * 2.0) * strength.x;        float distortY = sin((y/scale.y + phase.y) * PI * 2.0) * strength.y;        if (type == 0.0) {            coord.y += distortX;            coord.x += distortY;        } else if (type == 1.0) {            coord.x += distortX;            coord.y += distortY;        } else if (type == 2.0) {            gl_FragColor = texture2D(texture, vec2(x, y) / texSize);            coord.y += sin(gl_FragColor.r/scale.x*200.0 + phase.x * PI * 2.0) * strength.x;            coord.x += cos(gl_FragColor.g/scale.y*200.0 + phase.y * PI * 2.0) * strength.y;        }        coord.x = mod(coord.x, texSize.x);        coord.y = mod(coord.y, texSize.y);                \");\n    (0, $jrAes.simpleShader).call(this, (0, $7dEWP.gl).distort, {\n        stepSize: settings.stepSize,\n        type: settings.distortType,\n        scale: [\n            settings.scale.x,\n            settings.scale.y\n        ],\n        strength: [\n            settings.strength.x,\n            settings.strength.y\n        ],\n        phase: [\n            settings.phase.x,\n            settings.phase.y\n        ],\n        texSize: [\n            this.width,\n            this.height\n        ]\n    });\n    return this;\n};\n\n});\n\nparcelRequire.register(\"lwXVT\", function(module, exports) {\n\n$parcel$export(module.exports, \"multiplyAlpha\", function () { return $f157b4bc2111ecb8$export$57b05c961ff98d6a; });\n\nvar $7dEWP = parcelRequire(\"7dEWP\");\n\nvar $fvBHO = parcelRequire(\"fvBHO\");\n\nvar $jrAes = parcelRequire(\"jrAes\");\nvar $f157b4bc2111ecb8$export$57b05c961ff98d6a = function multiplyAlpha() {\n    (0, $7dEWP.gl).multiplyAlpha = (0, $7dEWP.gl).multiplyAlpha || new (0, $fvBHO.FxShader)(null, \"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        color.rgb *= color.a;        gl_FragColor = color;    }\", \"multiplyAlpha\");\n    (0, $jrAes.simpleShader).call(this, (0, $7dEWP.gl).multiplyAlpha, {\n        texSize: [\n            this.width,\n            this.height\n        ]\n    });\n    return this;\n};\n\n});\n\n\n\n\nparcelRequire.register(\"5ENro\", function(module, exports) {\n\n$parcel$export(module.exports, \"imgurUpload\", function () { return $6349b006a6604e1b$export$b1dd62fa0b5f32f5; });\n\nvar $1LaJZ = parcelRequire(\"1LaJZ\");\n\nvar $2gUX3 = parcelRequire(\"2gUX3\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $2wCWz = parcelRequire(\"2wCWz\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $2lMgk = parcelRequire(\"2lMgk\");\nfunction $6349b006a6604e1b$var$upload(canvas, title, description, type, imgurKey) {\n    return $6349b006a6604e1b$var$_upload.apply(this, arguments);\n}\nfunction $6349b006a6604e1b$var$_upload() {\n    $6349b006a6604e1b$var$_upload = /**\r\n * uploads canvas, opens new tab with the upload progress & then opens the image page.\r\n */ (0, $1LaJZ._)(function(canvas, title, description, type, imgurKey) {\n        var img, w, label, gif, labelText, response, formData, e, data;\n        return (0, $2gUX3.__generator)(this, function(_state) {\n            switch(_state.label){\n                case 0:\n                    img = (0, $2wCWz.base64ToBlob)(canvas.toDataURL(\"image/\" + type));\n                    w = window.open();\n                    if (!w) throw new Error(\"could not create new tab\");\n                    label = w.document.createElement(\"div\");\n                    gif = w.document.createElement(\"img\");\n                    gif.src = (0, (/*@__PURE__*/$parcel$interopDefault($2lMgk)));\n                    label.append(gif);\n                    (0, $eWjiX.BB).css(gif, {\n                        filter: \"invert(1)\"\n                    });\n                    (0, $eWjiX.BB).css(w.document.body, {\n                        backgroundColor: \"#121211\",\n                        backgroundImage: \"linear-gradient(#2b2b2b 0%, #121211 50%)\",\n                        backgroundRepeat: \"no-repeat\"\n                    });\n                    labelText = w.document.createElement(\"div\");\n                    labelText.style.marginTop = \"10px\";\n                    label.append(labelText);\n                    labelText.textContent = (0, $1mH1z.LANG)(\"upload-uploading\");\n                    w.document.body.append(label);\n                    (0, $eWjiX.BB).css(label, {\n                        marginLeft: \"auto\",\n                        marginRight: \"auto\",\n                        marginTop: \"100px\",\n                        fontFamily: \"Arial, sans-serif\",\n                        fontSize: \"20px\",\n                        textAlign: \"center\",\n                        transition: \"opacity 0.3s ease-in-out\",\n                        opacity: \"0\",\n                        color: \"#ccc\"\n                    });\n                    setTimeout(function() {\n                        label.style.opacity = \"1\";\n                    }, 20);\n                    _state.label = 1;\n                case 1:\n                    _state.trys.push([\n                        1,\n                        3,\n                        ,\n                        4\n                    ]);\n                    formData = new FormData();\n                    formData.append(\"title\", title);\n                    formData.append(\"description\", description);\n                    formData.append(\"image\", img);\n                    return [\n                        4,\n                        fetch(\"https://api.imgur.com/3/image\", {\n                            method: \"POST\",\n                            headers: {\n                                Authorization: \"Client-ID \" + imgurKey\n                            },\n                            body: formData\n                        })\n                    ];\n                case 2:\n                    response = _state.sent();\n                    return [\n                        3,\n                        4\n                    ];\n                case 3:\n                    e = _state.sent();\n                    w.close();\n                    throw e;\n                case 4:\n                    if (!response.ok) {\n                        w.close();\n                        throw new Error();\n                    }\n                    return [\n                        4,\n                        response.json()\n                    ];\n                case 5:\n                    data = _state.sent().data;\n                    w.location.href = data.link.replace(/\\.(jpg|png)/, \"\");\n                    return [\n                        2,\n                        data\n                    ];\n            }\n        });\n    });\n    return $6349b006a6604e1b$var$_upload.apply(this, arguments);\n}\nfunction $6349b006a6604e1b$export$b1dd62fa0b5f32f5(klCanvas, klRootEl, saveReminder, imgurKey) {\n    if (!imgurKey) throw new Error(\"imgur key missing\");\n    var inputTitle = (0, $eWjiX.BB).el({\n        tagName: \"input\"\n    });\n    inputTitle.type = \"text\";\n    inputTitle.value = (0, $1mH1z.LANG)(\"upload-title-untitled\");\n    var inputDescription = (0, $eWjiX.BB).el({\n        tagName: \"textarea\",\n        custom: {\n            rows: \"2\"\n        },\n        css: {\n            width: \"100%\",\n            maxWidth: \"100%\"\n        }\n    });\n    var labelTitle = (0, $eWjiX.BB).el({\n        textContent: (0, $1mH1z.LANG)(\"upload-name\") + \":\"\n    });\n    var labelDescription = (0, $eWjiX.BB).el({\n        textContent: (0, $1mH1z.LANG)(\"upload-caption\") + \":\",\n        css: {\n            marginTop: \"10px\"\n        }\n    });\n    var tos = (0, $eWjiX.BB).el({\n        content: '<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">'.concat((0, $1mH1z.LANG)(\"terms-of-service\"), \"</a>\")\n    });\n    var typeRadio = new (0, $hrnUX.KL).RadioList({\n        name: \"filetype\",\n        init: \"jpeg\",\n        items: [\n            {\n                label: \"JPG\",\n                value: \"jpeg\"\n            },\n            {\n                label: \"PNG\",\n                value: \"png\"\n            }\n        ],\n        ignoreFocus: true\n    });\n    (0, $eWjiX.BB).css(typeRadio.getElement(), {\n        marginBottom: \"10px\"\n    });\n    var outDiv = (0, $eWjiX.BB).el();\n    var infoHint = (0, $eWjiX.BB).el({\n        className: \"info-hint\",\n        textContent: (0, $1mH1z.LANG)(\"upload-link-notice\")\n    });\n    outDiv.append(infoHint, typeRadio.getElement(), labelTitle, inputTitle, labelDescription, inputDescription, tos);\n    (0, $hrnUX.KL).popup({\n        target: klRootEl,\n        message: \"<b>\".concat((0, $1mH1z.LANG)(\"upload-title\"), \"</b>\"),\n        type: \"upload\",\n        div: outDiv,\n        buttons: [\n            (0, $1mH1z.LANG)(\"upload-submit\"),\n            \"Cancel\"\n        ],\n        clickOnEnter: (0, $1mH1z.LANG)(\"upload-submit\"),\n        primaries: [\n            (0, $1mH1z.LANG)(\"upload-submit\")\n        ],\n        autoFocus: (0, $1mH1z.LANG)(\"upload-submit\"),\n        callback: function() {\n            var _ref = (0, $1LaJZ._)(function(val) {\n                var result, e;\n                return (0, $2gUX3.__generator)(this, function(_state) {\n                    switch(_state.label){\n                        case 0:\n                            if (!(val === (0, $1mH1z.LANG)(\"upload-submit\") || val === \"Yes\" || val === \"Ok\")) return [\n                                3,\n                                4\n                            ];\n                            _state.label = 1;\n                        case 1:\n                            _state.trys.push([\n                                1,\n                                3,\n                                ,\n                                4\n                            ]);\n                            return [\n                                4,\n                                $6349b006a6604e1b$var$upload(klCanvas.getCompleteCanvas(1), inputTitle.value, inputDescription.value, typeRadio.getValue(), imgurKey)\n                            ];\n                        case 2:\n                            result = _state.sent();\n                            (0, $hrnUX.KL).popup({\n                                target: klRootEl,\n                                type: \"ok\",\n                                message: \"<h3>\".concat((0, $1mH1z.LANG)(\"upload-success\"), \"</h3><br>\").concat((0, $1mH1z.LANG)(\"upload-delete\"), \"<br><a target='_blank' rel=\\\"noopener noreferrer\\\" href='https://imgur.com/delete/\").concat(result.deletehash, \"'>imgur.com/delete/\").concat(result.deletehash, \"</a><br><br>\"),\n                                buttons: [\n                                    \"Ok\"\n                                ]\n                            });\n                            saveReminder.reset();\n                            return [\n                                3,\n                                4\n                            ];\n                        case 3:\n                            e = _state.sent();\n                            (0, $hrnUX.KL).popup({\n                                target: klRootEl,\n                                type: \"error\",\n                                message: (0, $1mH1z.LANG)(\"upload-failed\"),\n                                buttons: [\n                                    \"Ok\"\n                                ]\n                            });\n                            return [\n                                3,\n                                4\n                            ];\n                        case 4:\n                            return [\n                                2\n                            ];\n                    }\n                });\n            });\n            return function(val) {\n                return _ref.apply(this, arguments);\n            };\n        }()\n    });\n}\n\n});\nparcelRequire.register(\"2lMgk\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"c3ZSC\");\n\n});\n\n\nparcelRequire.register(\"5ngYX\", function(module, exports) {\n\n$parcel$export(module.exports, \"SaveReminder\", function () { return $06e8423858d08972$export$befc6437ad34b28a; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $9pcu9 = parcelRequire(\"9pcu9\");\nvar $06e8423858d08972$var$reminderTimeLimitMs = 1200000; // 20 minutes\nvar $06e8423858d08972$var$unsavedActionsLimit = 100; // number of actions user did since last save\nvar $06e8423858d08972$export$befc6437ad34b28a = /*#__PURE__*/ function() {\n    \"use strict\";\n    function SaveReminder(history, showReminder, changeTitle, onSaveAsPsd, isDrawing, projectStore, getProject) {\n        var title = arguments.length > 7 && arguments[7] !== void 0 ? arguments[7] : \"Klecks\";\n        (0, $cx0mh._)(this, SaveReminder);\n        this.history = history;\n        this.showReminder = showReminder;\n        this.changeTitle = changeTitle;\n        this.onSaveAsPsd = onSaveAsPsd;\n        this.isDrawing = isDrawing;\n        this.projectStore = projectStore;\n        this.getProject = getProject;\n        this.title = title;\n        this.lastSavedAt = 0;\n        this.lastReminderShownAt = 0;\n    }\n    (0, $7h4XF._)(SaveReminder, [\n        {\n            key: \"showPopup\",\n            value: function showPopup() {\n                var _this = this;\n                if (!this.projectStore || !this.getProject) throw new Error(\"projectStore and getProject need to be set\");\n                var min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\n                var contentEl = (0, $eWjiX.BB).el();\n                contentEl.append((0, $eWjiX.BB).el({\n                    content: (0, $1mH1z.LANG)(\"save-reminder-text\", {\n                        a: \"<strong>\" + min,\n                        b: \"</strong>\"\n                    }),\n                    css: {\n                        marginBottom: \"20px\"\n                    }\n                }));\n                var psdWrapper = (0, $eWjiX.BB).el({\n                    css: {\n                        borderTop: \"1px solid #aaa\",\n                        margin: \"0 -20px\",\n                        padding: \"20px\"\n                    }\n                });\n                var storageWrapper = (0, $eWjiX.BB).el({\n                    css: {\n                        borderTop: \"1px solid #aaa\",\n                        margin: \"0 -20px\",\n                        padding: \"20px\",\n                        paddingBottom: \"0\"\n                    }\n                });\n                contentEl.append(psdWrapper, storageWrapper);\n                var psdBtn = (0, $eWjiX.BB).el({\n                    tagName: \"button\",\n                    className: \"kl-button\",\n                    content: (0, $1mH1z.LANG)(\"save-reminder-save-psd\"),\n                    onClick: function() {\n                        return _this.onSaveAsPsd();\n                    }\n                });\n                psdWrapper.append(psdBtn, (0, $eWjiX.BB).el({\n                    content: (0, $1mH1z.LANG)(\"save-reminder-psd-layers\"),\n                    css: {\n                        marginTop: \"10px\"\n                    }\n                }));\n                var storageUi = new (0, $9pcu9.BrowserStorageUi)(this.projectStore, this.getProject, this, document.body, {\n                    hideClearButton: true,\n                    isFocusable: true\n                });\n                storageWrapper.append(storageUi.getElement());\n                (0, $hrnUX.KL).popup({\n                    target: document.body,\n                    message: \"<b>\".concat((0, $1mH1z.LANG)(\"save-reminder-title\"), \"</b>\"),\n                    div: contentEl,\n                    ignoreBackground: true,\n                    callback: function() {\n                        storageUi.destroy();\n                        (0, $eWjiX.BB).destroyEl(psdBtn);\n                        _this.closeFunc = undefined;\n                        _this.lastReminderShownAt = performance.now();\n                    },\n                    closeFunc: function(f) {\n                        _this.closeFunc = f;\n                    }\n                });\n                setTimeout(function() {\n                    psdBtn.focus();\n                }, 40);\n            }\n        },\n        {\n            key: \"init\",\n            value: function init() {\n                var _this = this;\n                var onBeforeUnload = // confirmation dialog when closing tab\n                function onBeforeUnload(e) {\n                    e.preventDefault();\n                    e.returnValue = \"\";\n                };\n                if (this.lastSavedActionNumber !== undefined) return;\n                this.lastSavedActionNumber = this.history.getActionNumber();\n                this.lastReminderShownAt = performance.now();\n                this.lastSavedAt = performance.now();\n                if (this.showReminder) setInterval(function() {\n                    if (document.visibilityState !== \"visible\") return;\n                    var unsavedActions = Math.abs(_this.history.getActionNumber() - _this.lastSavedActionNumber);\n                    if ((0, $hrnUX.KL).dialogCounter.get() === 0 && !_this.isDrawing() && _this.lastReminderShownAt + $06e8423858d08972$var$reminderTimeLimitMs < performance.now() && unsavedActions >= $06e8423858d08972$var$unsavedActionsLimit) _this.showPopup();\n                }, 5000);\n                this.history.addListener(function() {\n                    var actionNumber = _this.history.getActionNumber();\n                    if (_this.lastSavedActionNumber !== actionNumber) window.onbeforeunload = onBeforeUnload;\n                    else window.onbeforeunload = null;\n                });\n                if (this.changeTitle) document.addEventListener(\"visibilitychange\", function() {\n                    if (document.visibilityState === \"visible\") {\n                        document.title = _this.title;\n                        clearInterval(_this.unsavedInterval);\n                    } else {\n                        var actionNumber = _this.history.getActionNumber();\n                        if (_this.lastSavedActionNumber !== actionNumber) {\n                            document.title = (0, $1mH1z.LANG)(\"unsaved\") + \" - \" + _this.title;\n                            var state = 0;\n                            _this.unsavedInterval = setInterval(function() {\n                                state = (state + 1) % 2;\n                                if (state === 1) document.title = (0, $1mH1z.LANG)(\"unsaved\") + \" \\xb7 \" + _this.title;\n                                else document.title = (0, $1mH1z.LANG)(\"unsaved\") + \" - \" + _this.title;\n                            }, 180000);\n                        }\n                    }\n                });\n            }\n        },\n        {\n            key: \"reset\",\n            value: function reset() {\n                if (this.lastSavedActionNumber === undefined) return;\n                this.lastSavedActionNumber = this.history.getActionNumber();\n                this.lastReminderShownAt = performance.now();\n                this.lastSavedAt = performance.now();\n                window.onbeforeunload = null;\n                if (this.closeFunc) this.closeFunc();\n            }\n        }\n    ]);\n    return SaveReminder;\n}();\n\n});\n\nparcelRequire.register(\"eyygR\", function(module, exports) {\n\n$parcel$export(module.exports, \"SaveToComputer\", function () { return $956d06d740fc5053$export$75e7b60500bb415b; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $6hBII = parcelRequire(\"6hBII\");\n\nvar $hAS38 = parcelRequire(\"hAS38\");\nvar $956d06d740fc5053$export$75e7b60500bb415b = /*#__PURE__*/ function() {\n    \"use strict\";\n    function SaveToComputer(saveReminder, getExportType, getKlCanvas) {\n        (0, $cx0mh._)(this, SaveToComputer);\n        this.saveReminder = saveReminder;\n        this.getExportType = getExportType;\n        this.getKlCanvas = getKlCanvas;\n    }\n    (0, $7h4XF._)(SaveToComputer, [\n        {\n            key: \"saveImage\",\n            value: /**\r\n     * Using old code, because saving somehow doesn't work for ipad before ios 13,\r\n     * and it doesn't even throw an exception.\r\n     */ function saveImage(canvas, filename, mimeType) {\n                var parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\n                if (!parts) throw new Error(\"saveImage: empty parts\");\n                //assume base64 encoding\n                var binStr = atob(parts[3]);\n                //convert to binary in ArrayBuffer\n                var buf = new ArrayBuffer(binStr.length);\n                var view = new Uint8Array(buf);\n                for(var i = 0; i < view.length; i++)view[i] = binStr.charCodeAt(i);\n                var blob = new Blob([\n                    view\n                ], {\n                    \"type\": parts[1]\n                });\n                (0, $6hBII.saveAs)(blob, filename);\n            }\n        },\n        {\n            key: \"save\",\n            value: function save(format) {\n                this.saveReminder.reset();\n                if (!format) format = this.getExportType();\n                if (format === \"png\") {\n                    var extension = \"png\";\n                    var mimeType = \"image/png\";\n                    var filename = (0, $eWjiX.BB).getDate() + (0, $hAS38.klConfig).filenameBase + \".\" + extension;\n                    var fullCanvas = this.getKlCanvas().getCompleteCanvas(1);\n                    try {\n                        this.saveImage(fullCanvas, filename, mimeType);\n                    } catch (error) {\n                        alert(\"could not save\");\n                        throw new Error(\"failed png export\");\n                    }\n                } else if (format === \"layers\") {\n                    var extension1 = \"png\";\n                    var mimeType1 = \"image/png\";\n                    var fileBase = (0, $eWjiX.BB).getDate() + (0, $hAS38.klConfig).filenameBase;\n                    var layerArr = this.getKlCanvas().getLayersFast();\n                    for(var i = 0; i < layerArr.length; i++){\n                        var item = layerArr[i];\n                        var fnameArr = [\n                            fileBase,\n                            \"_\",\n                            (\"\" + (i + 1)).padStart(2, \"0\"),\n                            \"_\",\n                            item.name,\n                            \".\",\n                            extension1\n                        ];\n                        this.saveImage(item.canvas, fnameArr.join(\"\"), mimeType1);\n                    }\n                } else if (format === \"psd\") {\n                    var layerArr1 = this.getKlCanvas().getLayersFast();\n                    var psdConfig = {\n                        width: this.getKlCanvas().getWidth(),\n                        height: this.getKlCanvas().getHeight(),\n                        children: [],\n                        canvas: this.getKlCanvas().getCompleteCanvas(1)\n                    };\n                    for(var i1 = 0; i1 < layerArr1.length; i1++){\n                        var item1 = layerArr1[i1];\n                        psdConfig.children.push({\n                            name: item1.name,\n                            hidden: !item1.isVisible,\n                            opacity: item1.opacity,\n                            canvas: item1.canvas,\n                            blendMode: (0, $hrnUX.KL).PSD.blendKlToPsd(item1.mixModeStr),\n                            left: 0,\n                            top: 0\n                        });\n                    }\n                    (0, $hrnUX.KL).loadAgPsd().then(function(agPsdLazy) {\n                        var buffer = agPsdLazy.writePsdBuffer(psdConfig);\n                        var blob = new Blob([\n                            buffer\n                        ], {\n                            type: \"application/octet-stream\"\n                        });\n                        (0, $6hBII.saveAs)(blob, (0, $eWjiX.BB).getDate() + (0, $hAS38.klConfig).filenameBase + \".psd\");\n                    }).catch(function() {\n                        alert(\"Error: failed to load PSD library\");\n                    });\n                }\n            }\n        }\n    ]);\n    return SaveToComputer;\n}();\n\n});\nparcelRequire.register(\"6hBII\", function(module, exports) {\n\n$parcel$export(module.exports, \"saveAs\", function () { return $e1c6fbc08bfda4eb$export$2bc2a80e311129ac; });\n// https://github.com/eligrey/FileSaver.js/issues/774\n// stripped down version of https://github.com/eligrey/FileSaver.js/blob/master/src/FileSaver.js#L81-L108\nfunction $e1c6fbc08bfda4eb$export$2bc2a80e311129ac(blob, name) {\n    // Namespace is used to prevent conflict w/ Chrome Poper Blocker extension (Issue https://github.com/eligrey/FileSaver.js/issues/561)\n    var a = document.createElementNS(\"http://www.w3.org/1999/xhtml\", \"a\");\n    a.download = name;\n    a.rel = \"noopener\";\n    a.href = URL.createObjectURL(blob);\n    setTimeout(function() {\n        return URL.revokeObjectURL(a.href);\n    }, 40000);\n    setTimeout(function() {\n        return a.click();\n    }, 0);\n}\n\n});\n\n\nparcelRequire.register(\"6rdi0\", function(module, exports) {\n\n$parcel$export(module.exports, \"UndoRedoCatchup\", function () { return $48534f13b7192dff$export$5cebd3bb2d68229a; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $8N5YG = parcelRequire(\"8N5YG\");\n\nvar $bX4ja = parcelRequire(\"bX4ja\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nfunction $48534f13b7192dff$var$execHistoryEntry(historyEntry, layerIndex, klCanvas, brushes, setCurrentLayerCtx, getCurrentLayerCtx) {\n    if (historyEntry.tool[0] === \"brush\") {\n        var b = brushes[historyEntry.tool[1]];\n        historyEntry.actions.forEach(function(action) {\n            var _b;\n            (_b = b)[action.action].apply(_b, (0, $bX4ja._)(action.params));\n        });\n    } else if (historyEntry.tool[0] === \"canvas\") {\n        var _klCanvas;\n        var p = historyEntry.params;\n        var id = (_klCanvas = klCanvas)[historyEntry.action].apply(_klCanvas, (0, $bX4ja._)(p));\n        if (typeof id === \"number\") {\n            layerIndex = id;\n            var ctx = (0, $7jh4K.throwIfNull)(klCanvas.getLayerContext(layerIndex));\n            setCurrentLayerCtx(ctx);\n            Object.entries(brushes).forEach(function(param) {\n                var _param = (0, $8N5YG._)(param, 2), brush = _param[1];\n                return brush.setContext(ctx);\n            });\n        }\n    } else if (historyEntry.tool[0] === \"filter\") {\n        var _KL_filterLib_historyEntry_tool_;\n        var p1 = [\n            {\n                context: getCurrentLayerCtx(),\n                klCanvas: klCanvas,\n                input: historyEntry.params[0].input,\n                history: new (0, $hrnUX.KL).DecoyKlHistory()\n            }\n        ];\n        (_KL_filterLib_historyEntry_tool_ = (0, $hrnUX.KL).filterLib[historyEntry.tool[1]])[historyEntry.action].apply(_KL_filterLib_historyEntry_tool_, (0, $bX4ja._)(p1));\n    } else if (historyEntry.tool[0] === \"misc\" && historyEntry.action === \"focusLayer\") {\n        layerIndex = historyEntry.params[0];\n        var ctx1 = (0, $7jh4K.throwIfNull)(klCanvas.getLayerContext(layerIndex));\n        setCurrentLayerCtx(ctx1);\n        Object.entries(brushes).forEach(function(param) {\n            var _param = (0, $8N5YG._)(param, 2), brush = _param[1];\n            return brush.setContext(ctx1);\n        });\n    } else if (historyEntry.tool[0] === \"misc\" && historyEntry.action === \"importImage\") {\n        var id1 = klCanvas.addLayer();\n        if (typeof id1 === \"number\") {\n            layerIndex = id1;\n            if (historyEntry.params[1]) klCanvas.renameLayer(layerIndex, historyEntry.params[1]);\n            var ctx2 = (0, $7jh4K.throwIfNull)(klCanvas.getLayerContext(layerIndex));\n            setCurrentLayerCtx(ctx2);\n            Object.entries(brushes).forEach(function(param) {\n                var _param = (0, $8N5YG._)(param, 2), brush = _param[1];\n                return brush.setContext(ctx2);\n            });\n        }\n        getCurrentLayerCtx().drawImage(historyEntry.params[0], 0, 0);\n    }\n    return layerIndex;\n}\nvar $48534f13b7192dff$export$5cebd3bb2d68229a = /*#__PURE__*/ function() {\n    \"use strict\";\n    function UndoRedoCatchup(brushUiMap, layerPreview, layerManager, handUi, klCanvasWorkspace, getInitState, getKlCanvas, getCurrentLayerCtx, setCurrentLayerCtx, getCurrentBrush) {\n        (0, $cx0mh._)(this, UndoRedoCatchup);\n        this.brushUiMap = brushUiMap;\n        this.layerPreview = layerPreview;\n        this.layerManager = layerManager;\n        this.handUi = handUi;\n        this.klCanvasWorkspace = klCanvasWorkspace;\n        this.getInitState = getInitState;\n        this.getKlCanvas = getKlCanvas;\n        this.getCurrentLayerCtx = getCurrentLayerCtx;\n        this.setCurrentLayerCtx = setCurrentLayerCtx;\n        this.getCurrentBrush = getCurrentBrush;\n        this.doIgnore = false;\n    }\n    (0, $7h4XF._)(UndoRedoCatchup, [\n        {\n            key: \"shouldIgnoreTest\",\n            value: /**\r\n     * Prevent multiple undo / redo getting triggered at once if UI is frozen.\r\n     * true -> ignore, don't undo / redo\r\n     */ function shouldIgnoreTest() {\n                var _this = this;\n                if (this.doIgnore) return true;\n                this.doIgnore = true;\n                setTimeout(function() {\n                    _this.doIgnore = false;\n                }, 0);\n                return false;\n            }\n        },\n        {\n            key: \"undo\",\n            value: function undo() {\n                var _this = this;\n                if (this.shouldIgnoreTest() || !(0, $gWfkn.klHistory).canUndo()) return false;\n                var entries = (0, $gWfkn.klHistory).undo();\n                var klCanvas = this.getKlCanvas();\n                (0, $gWfkn.klHistory).pause(true);\n                var initState = this.getInitState();\n                var oldSize = {\n                    w: klCanvas.getWidth(),\n                    h: klCanvas.getHeight()\n                };\n                klCanvas.copy(initState.canvas);\n                var layerIndex = initState.focus;\n                this.setCurrentLayerCtx((0, $7jh4K.throwIfNull)(klCanvas.getLayerContext(layerIndex)));\n                var brushes = {};\n                Object.entries((0, $hrnUX.KL).brushes).forEach(function(param) {\n                    var _param = (0, $8N5YG._)(param, 2), b = _param[0], brush = _param[1];\n                    brushes[b] = new brush();\n                    brushes[b].setContext(_this.getCurrentLayerCtx());\n                });\n                brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\n                entries.forEach(function(entry) {\n                    layerIndex = $48534f13b7192dff$var$execHistoryEntry(entry, layerIndex, klCanvas, brushes, function(ctx) {\n                        return _this.setCurrentLayerCtx(ctx);\n                    }, function() {\n                        return (0, $7jh4K.throwIfNull)(_this.getCurrentLayerCtx());\n                    });\n                });\n                if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\n                    this.klCanvasWorkspace.resetOrFitView();\n                    this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                }\n                this.layerManager.update(layerIndex);\n                this.layerPreview.setLayer((0, $7jh4K.throwIfNull)(klCanvas.getLayer(layerIndex)));\n                this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\n                this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\n                this.klCanvasWorkspace.setLastDrawEvent();\n                (0, $gWfkn.klHistory).pause(false);\n                return true;\n            }\n        },\n        {\n            key: \"redo\",\n            value: function redo() {\n                var _this = this;\n                if (this.shouldIgnoreTest() || !(0, $gWfkn.klHistory).canRedo()) return false;\n                var entry = (0, $gWfkn.klHistory).redo();\n                if (!entry) {\n                    setTimeout(function() {\n                        throw new Error(\"redo failed. redo entry undefined\");\n                    });\n                    return false;\n                }\n                var klCanvas = this.getKlCanvas();\n                (0, $gWfkn.klHistory).pause(true);\n                var oldSize = {\n                    w: klCanvas.getWidth(),\n                    h: klCanvas.getHeight()\n                };\n                var brushes = {};\n                Object.entries((0, $hrnUX.KL).brushes).forEach(function(param) {\n                    var _param = (0, $8N5YG._)(param, 2), b = _param[0], brush = _param[1];\n                    brushes[b] = new brush();\n                    brushes[b].setContext(_this.getCurrentLayerCtx());\n                });\n                brushes.SketchyBrush.setSeed(this.brushUiMap.sketchyBrush.getSeed());\n                $48534f13b7192dff$var$execHistoryEntry(entry, 0, klCanvas, brushes, function(ctx) {\n                    return _this.setCurrentLayerCtx(ctx);\n                }, function() {\n                    return (0, $7jh4K.throwIfNull)(_this.getCurrentLayerCtx());\n                });\n                if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\n                    this.klCanvasWorkspace.resetOrFitView();\n                    this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                }\n                var currentLayerIndex = (0, $7jh4K.throwIfNull)(klCanvas.getLayerIndex(this.getCurrentLayerCtx().canvas));\n                this.layerManager.update(currentLayerIndex);\n                this.layerPreview.setLayer(klCanvas.getLayer(currentLayerIndex));\n                this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\n                this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\n                this.klCanvasWorkspace.setLastDrawEvent();\n                (0, $gWfkn.klHistory).pause(false);\n                return true;\n            }\n        },\n        {\n            key: \"catchup\",\n            value: function catchup(logParam) {\n                // const start = performance.now();\n                //play catch up (the version that is a few steps behind)\n                if (!logParam || !logParam.bufferUpdate) return;\n                var initState = this.getInitState();\n                var localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\n                initState.focus = $48534f13b7192dff$var$execHistoryEntry(logParam.bufferUpdate, initState.focus, initState.canvas, initState.brushes, function(ctx) {\n                    localCurrentLayerCtx = ctx;\n                }, function() {\n                    return (0, $7jh4K.throwIfNull)(localCurrentLayerCtx);\n                });\n            // console.log('catchup', performance.now() - start);\n            }\n        }\n    ]);\n    return UndoRedoCatchup;\n}();\n\n});\n\nparcelRequire.register(\"7pyBK\", function(module, exports) {\n\n$parcel$export(module.exports, \"BrushSettingService\", function () { return $53cc60fd413705d6$export$272bfd3ef9ef2f48; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\nvar $53cc60fd413705d6$export$272bfd3ef9ef2f48 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function BrushSettingService(onSetColor, onSetSize, onSetOpacity, onGetColor, onGetSize, onGetOpacity, onGetSliderConfig) {\n        (0, $cx0mh._)(this, BrushSettingService);\n        this.onSetColor = onSetColor;\n        this.onSetSize = onSetSize;\n        this.onSetOpacity = onSetOpacity;\n        this.onGetColor = onGetColor;\n        this.onGetSize = onGetSize;\n        this.onGetOpacity = onGetOpacity;\n        this.onGetSliderConfig = onGetSliderConfig;\n        this.subscriberArr = [];\n        if (BrushSettingService.instance) throw new Error(\"BrushSettingService already instantiated\");\n        BrushSettingService.instance = this;\n    }\n    (0, $7h4XF._)(BrushSettingService, [\n        {\n            key: \"emit\",\n            value: function emit(obj, skipSubscriber) {\n                for(var i = 0; i < this.subscriberArr.length; i++){\n                    if (this.subscriberArr[i] === skipSubscriber) continue;\n                    this.subscriberArr[i](obj);\n                }\n            }\n        },\n        {\n            key: \"emitColor\",\n            value: function emitColor(color, skipSubscriber) {\n                this.emit({\n                    type: \"color\",\n                    value: color\n                }, skipSubscriber);\n            }\n        },\n        {\n            key: \"emitSize\",\n            value: function emitSize(size, skipSubscriber) {\n                this.emit({\n                    type: \"size\",\n                    value: size\n                }, skipSubscriber);\n            }\n        },\n        {\n            key: \"emitOpacity\",\n            value: function emitOpacity(opacity, skipSubscriber) {\n                this.emit({\n                    type: \"opacity\",\n                    value: opacity\n                }, skipSubscriber);\n            }\n        },\n        {\n            key: \"emitSliderConfig\",\n            value: function emitSliderConfig(sliderConfig, skipSubscriber) {\n                this.emit({\n                    type: \"sliderConfig\",\n                    value: sliderConfig\n                }, skipSubscriber);\n            }\n        },\n        {\n            /**\r\n     * set current brush color\r\n     * @param color\r\n     * @param skipSubscriber\r\n     */ key: \"setColor\",\n            value: function setColor(color, skipSubscriber) {\n                this.onSetColor(color);\n                this.emitColor(color, skipSubscriber);\n            }\n        },\n        {\n            /**\r\n     * set current brush size\r\n     * @param size\r\n     * @param skipSubscriber\r\n     */ key: \"setSize\",\n            value: function setSize(size, skipSubscriber) {\n                this.onSetSize(size);\n            // why not emitting?\n            }\n        },\n        {\n            /**\r\n     * set current opacity\r\n     * @param opacity\r\n     * @param skipSubscriber\r\n     */ key: \"setOpacity\",\n            value: function setOpacity(opacity, skipSubscriber) {\n                this.onSetOpacity(opacity);\n            // why not emitting?\n            }\n        },\n        {\n            /**\r\n     * get current brush color\r\n     */ key: \"getColor\",\n            value: function getColor() {\n                return this.onGetColor();\n            }\n        },\n        {\n            key: \"getSize\",\n            value: function getSize() {\n                return this.onGetSize();\n            }\n        },\n        {\n            key: \"getOpacity\",\n            value: function getOpacity() {\n                return this.onGetOpacity();\n            }\n        },\n        {\n            key: \"getSliderConfig\",\n            value: function getSliderConfig() {\n                return this.onGetSliderConfig();\n            }\n        },\n        {\n            /**\r\n     * subscribe to changes\r\n     * @param func\r\n     */ key: \"subscribe\",\n            value: function subscribe(func) {\n                if (this.subscriberArr.includes(func)) return;\n                this.subscriberArr.push(func);\n            }\n        },\n        {\n            key: \"unsubscribe\",\n            value: function unsubscribe(func) {\n                for(var i = 0; i < this.subscriberArr.length; i++)if (func === this.subscriberArr[i]) {\n                    this.subscriberArr.splice(i, 1);\n                    i--;\n                }\n            }\n        }\n    ]);\n    return BrushSettingService;\n}();\n\n});\n\nparcelRequire.register(\"bIgqE\", function(module, exports) {\n\n$parcel$export(module.exports, \"SettingsTab\", function () { return $5562b5b6c391a7ca$export$5d396b237bd33221; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $bX4ja = parcelRequire(\"bX4ja\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $fgfvl = parcelRequire(\"fgfvl\");\n\nvar $dd3r9 = parcelRequire(\"dd3r9\");\n\nvar $kX3t5 = parcelRequire(\"kX3t5\");\n\nvar $741YV = parcelRequire(\"741YV\");\n\nvar $6l0gQ = parcelRequire(\"6l0gQ\");\n\nvar $1C8RU = parcelRequire(\"1C8RU\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\n\nvar $2H29m = parcelRequire(\"2H29m\");\nvar $5562b5b6c391a7ca$export$5d396b237bd33221 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function SettingsTab(onLeftRight, customAbout) {\n        (0, $cx0mh._)(this, SettingsTab);\n        var themeToLabel = // ---- theme ----\n        function themeToLabel(theme) {\n            return theme === \"dark\" ? \" \" + (0, $1mH1z.LANG)(\"theme-dark\") : \" \" + (0, $1mH1z.LANG)(\"theme-light\");\n        };\n        var makeLicenses = function makeLicenses() {\n            return (0, $eWjiX.BB).el({\n                tagName: \"a\",\n                content: (0, $1mH1z.LANG)(\"licenses\"),\n                onClick: function() {\n                    return (0, $2H29m.showLicensesDialog)();\n                }\n            });\n        };\n        this.el = (0, $eWjiX.BB).el({\n            css: {\n                margin: \"10px\"\n            }\n        });\n        // ---- language ----\n        var autoLanguage = (0, $1mH1z.languageStrings).getAutoLanguage();\n        var langWrapper = (0, $eWjiX.BB).el({\n            parent: this.el,\n            content: (0, $eWjiX.BB).el({\n                content: (0, $1mH1z.LANG)(\"settings-language\") + \":\",\n                css: {\n                    marginRight: \"5px\",\n                    marginBottom: \"2px\"\n                }\n            }),\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                flexWrap: \"wrap\"\n            }\n        });\n        var options = [\n            [\n                \"auto\",\n                (0, $1mH1z.LANG)(\"auto\") + \"  \".concat(autoLanguage.name, \" (\").concat(autoLanguage.code, \")\")\n            ]\n        ].concat((0, $bX4ja._)((0, $fgfvl.languages).map(function(item) {\n            return [\n                item.code,\n                item.name + \" (\".concat(item.code, \")\")\n            ];\n        })));\n        var languageSelect = new (0, $hrnUX.KL).Select({\n            initValue: (0, $7jh4K.nullToUndefined)((0, $6l0gQ.LocalStorage).getItem((0, $1mH1z.LS_LANGUAGE_KEY)) ? (0, $6l0gQ.LocalStorage).getItem((0, $1mH1z.LS_LANGUAGE_KEY)) : \"auto\"),\n            optionArr: options,\n            onChange: function(val) {\n                if (val === \"auto\") (0, $6l0gQ.LocalStorage).removeItem((0, $1mH1z.LS_LANGUAGE_KEY));\n                else (0, $6l0gQ.LocalStorage).setItem((0, $1mH1z.LS_LANGUAGE_KEY), val);\n                languageHint.style.display = \"block\";\n            }\n        });\n        (0, $eWjiX.BB).css(languageSelect.getElement(), {\n            flexGrow: \"1\"\n        });\n        var languageHint = (0, $eWjiX.BB).el({\n            className: \"kl-toolspace-note\",\n            content: (0, $1mH1z.LANG)(\"settings-language-reload\"),\n            css: {\n                display: \"none\",\n                marginTop: \"5px\",\n                flexGrow: \"1\"\n            }\n        });\n        langWrapper.append(languageSelect.getElement(), languageHint);\n        var themeSelect = new (0, $hrnUX.KL).Select({\n            optionArr: [\n                [\n                    \"auto\",\n                    (0, $1mH1z.LANG)(\"auto\") + \"  \" + themeToLabel((0, $1C8RU.theme).getMediaQueryTheme())\n                ],\n                [\n                    \"light\",\n                    themeToLabel(\"light\")\n                ],\n                [\n                    \"dark\",\n                    themeToLabel(\"dark\")\n                ]\n            ],\n            initValue: (0, $1C8RU.theme).getStoredTheme() || \"auto\",\n            onChange: function(val) {\n                (0, $1C8RU.theme).setStoredTheme(val === \"auto\" ? undefined : val);\n            }\n        });\n        (0, $eWjiX.BB).css(themeSelect.getElement(), {\n            flexGrow: \"1\"\n        });\n        (0, $7jh4K.addIsDarkListener)(function() {\n            themeSelect.updateLabel(\"auto\", (0, $1mH1z.LANG)(\"auto\") + \"  \" + themeToLabel((0, $1C8RU.theme).getMediaQueryTheme()));\n        });\n        (0, $eWjiX.BB).el({\n            parent: this.el,\n            content: [\n                (0, $eWjiX.BB).el({\n                    content: (0, $1mH1z.LANG)(\"settings-theme\") + \":\",\n                    css: {\n                        marginRight: \"5px\",\n                        marginBottom: \"2px\"\n                    }\n                }),\n                themeSelect.getElement()\n            ],\n            css: {\n                marginTop: \"15px\",\n                display: \"flex\",\n                alignItems: \"center\",\n                flexWrap: \"wrap\"\n            }\n        });\n        // ---- flip ui ----\n        (0, $eWjiX.BB).el({\n            tagName: \"button\",\n            parent: this.el,\n            content: '<img height=\"20\" width=\"18\" src=\"' + (0, (/*@__PURE__*/$parcel$interopDefault($741YV))) + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + (0, $1mH1z.LANG)(\"switch-ui-left-right\"),\n            onClick: function() {\n                return onLeftRight();\n            },\n            css: {\n                marginTop: \"15px\"\n            },\n            custom: {\n                tabIndex: \"-1\"\n            }\n        });\n        // ---- about ----\n        this.el.append((0, $eWjiX.BB).el({\n            className: \"grid-hr\",\n            css: {\n                margin: \"10px 0\"\n            }\n        }));\n        if (customAbout) {\n            this.el.append(customAbout);\n            if (!customAbout.innerHTML) {\n                var minimalAbout = (0, $eWjiX.BB).el({\n                    parent: customAbout,\n                    css: {\n                        textAlign: \"center\"\n                    }\n                });\n                minimalAbout.append((0, $eWjiX.BB).el({\n                    content: '<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"'.concat((0, (/*@__PURE__*/$parcel$interopDefault($dd3r9))), '\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a> \\xa9 2023<br>')\n                }), makeLicenses());\n            }\n        } else {\n            var versionEl = (0, $eWjiX.BB).el({\n                parent: this.el,\n                css: {\n                    textAlign: \"center\"\n                },\n                content: '\\n<img alt=\"Klecks\" class=\"dark-invert\" height=\"25\" src=\"'.concat((0, (/*@__PURE__*/$parcel$interopDefault($kX3t5))), '\"><br>\\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"').concat((0, (/*@__PURE__*/$parcel$interopDefault($dd3r9))), '\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a> \\xa9 2023<br>')\n            });\n            versionEl.append(makeLicenses(), document.createTextNode(\" | \"), (0, $eWjiX.BB).el({\n                tagName: \"a\",\n                content: (0, $1mH1z.LANG)(\"donate\"),\n                custom: {\n                    href: \"https://kleki.com/donate/\",\n                    target: \"_blank\"\n                }\n            }), document.createTextNode(\" | \"), (0, $eWjiX.BB).el({\n                tagName: \"a\",\n                content: (0, $1mH1z.LANG)(\"source-code\"),\n                custom: {\n                    href: \"https://klecks.org\",\n                    target: \"_blank\"\n                }\n            }));\n        }\n        window.addEventListener(\"storage\", function(e) {\n            if (e.key !== (0, $1mH1z.LS_LANGUAGE_KEY)) return;\n            languageSelect.setValue((0, $7jh4K.nullToUndefined)((0, $6l0gQ.LocalStorage).getItem((0, $1mH1z.LS_LANGUAGE_KEY)) ? (0, $6l0gQ.LocalStorage).getItem((0, $1mH1z.LS_LANGUAGE_KEY)) : \"auto\"));\n        });\n    }\n    (0, $7h4XF._)(SettingsTab, [\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.el;\n            }\n        }\n    ]);\n    return SettingsTab;\n}();\n\n});\nparcelRequire.register(\"dd3r9\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"hTlU7\");\n\n});\n\nparcelRequire.register(\"741YV\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"hxlHN\");\n\n});\n\nparcelRequire.register(\"2H29m\", function(module, exports) {\n\n$parcel$export(module.exports, \"showLicensesDialog\", function () { return $c57a53a21f44c053$export$d3fe39c7bff44f23; });\n\nvar $amum4 = parcelRequire(\"amum4\");\n\nvar $jXowp = parcelRequire(\"jXowp\");\n\nvar $dLlkc = parcelRequire(\"dLlkc\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\n\nfunction $c57a53a21f44c053$export$d3fe39c7bff44f23() {\n    var licensesCss = (0, $jXowp.css)({\n        display: \"flex\",\n        flexDirection: \"column\",\n        gap: \"10px\",\n        \"details > div\": {\n            padding: \"10px\",\n            boxShadow: \"0 0 0 1px\",\n            marginTop: \"5px\",\n            fontFamily: \"monospace\",\n            background: \"#aaa2\",\n            overflow: \"hidden\"\n        },\n        \"summary\": {\n            cursor: \"pointer\",\n            userSelect: \"none\"\n        }\n    });\n    var libraries = (0, $amum4.c)(\".\" + licensesCss, (0, $1mH1z.LANG)(\"loading\"));\n    var fonts = (0, $amum4.c)(\".\" + licensesCss, (0, $1mH1z.LANG)(\"loading\"));\n    var content = (0, $amum4.c)(\",flex,flexCol,gap-10\", [\n        libraries,\n        fonts\n    ]);\n    new (0, $dLlkc.DynamicModal)({\n        title: (0, $eWjiX.BB).el({\n            content: (0, $1mH1z.LANG)(\"licenses\")\n        }),\n        content: (0, $eWjiX.BB).el({\n            content: content,\n            css: {\n                height: \"100%\",\n                overflowY: \"auto\",\n                padding: \"10px\",\n                boxSizing: \"border-box\"\n            }\n        }),\n        width: 800,\n        isMaxHeight: true\n    });\n    (parcelRequire(\"8iHku\")).then(function(result) {\n        libraries.innerHTML = \"\";\n        result.licenses.forEach(function(item) {\n            libraries.append((0, $amum4.c)(\"details\", [\n                (0, $amum4.c)(\"summary\", item.title),\n                (0, $amum4.c)(\"\", item.full.replace(/\\n/g, \"<br>\"))\n            ]));\n        });\n    });\n    (parcelRequire(\"hIUd1\")).then(function(result) {\n        fonts.innerHTML = \"\";\n        result.fontLicenses.forEach(function(item) {\n            fonts.append((0, $amum4.c)(\"details\", [\n                (0, $amum4.c)(\"summary\", \"Font: \" + item.title),\n                (0, $amum4.c)(\"\", item.full.replace(/\\n/g, \"<br>\"))\n            ]));\n        });\n    });\n}\n\n});\nparcelRequire.register(\"8iHku\", function(module, exports) {\n\n\n\nmodule.exports = (parcelRequire(\"ih7W4\"))((parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"62mlz\")).then(function() {\n    return parcelRequire(\"17YSH\");\n});\n\n});\n\nparcelRequire.register(\"hIUd1\", function(module, exports) {\n\n\n\nmodule.exports = (parcelRequire(\"ih7W4\"))((parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"76QQo\")).then(function() {\n    return parcelRequire(\"evhrb\");\n});\n\n});\n\n\n\nparcelRequire.register(\"iVHpg\", function(module, exports) {\n\n$parcel$export(module.exports, \"ToolspaceScroller\", function () { return $951e508110f8a437$export$42a534af7eb650e8; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $i8UFO = parcelRequire(\"i8UFO\");\nvar $951e508110f8a437$export$42a534af7eb650e8 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function ToolspaceScroller(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, ToolspaceScroller);\n        this.toolspace = p.toolspace;\n        this.upBtn = (0, $eWjiX.BB).el({\n            parent: this.toolspace,\n            title: (0, $1mH1z.LANG)(\"scroll\"),\n            className: \"kl-scroller\",\n            css: {\n                top: \"0\",\n                transform: \"rotate(180deg)\"\n            }\n        });\n        this.downBtn = (0, $eWjiX.BB).el({\n            parent: this.toolspace,\n            title: (0, $1mH1z.LANG)(\"scroll\"),\n            className: \"kl-scroller\",\n            css: {\n                bottom: \"0\"\n            }\n        });\n        this.updateUiState(p.uiState);\n        var upListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.upBtn,\n            onPointer: function(e) {\n                if (e.type === \"pointerdown\") _this.upInterval = setInterval(function() {\n                    _this.toolspace.scrollBy(0, -13);\n                    _this.update();\n                }, 20);\n                if (e.type === \"pointerup\") {\n                    clearInterval(_this.upInterval);\n                    setTimeout(function() {\n                        _this.upInterval = null;\n                        _this.update();\n                    }, 50);\n                }\n            }\n        });\n        var downListener = new (0, $eWjiX.BB).PointerListener({\n            target: this.downBtn,\n            onPointer: function(e) {\n                if (e.type === \"pointerdown\") _this.downInterval = setInterval(function() {\n                    _this.toolspace.scrollBy(0, 13);\n                    _this.update();\n                }, 20);\n                if (e.type === \"pointerup\") {\n                    clearInterval(_this.downInterval);\n                    setTimeout(function() {\n                        _this.downInterval = null;\n                        _this.update();\n                    }, 50);\n                }\n            }\n        });\n        var wheelListener = function(e) {\n            _this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\n            _this.update();\n        };\n        this.upBtn.addEventListener(\"wheel\", wheelListener);\n        this.downBtn.addEventListener(\"wheel\", wheelListener);\n        this.update();\n        var observer = new MutationObserver(function() {\n            return _this.update();\n        });\n        observer.observe(this.toolspace, {\n            attributes: true,\n            childList: true,\n            subtree: true\n        });\n        window.addEventListener(\"resize\", function() {\n            return _this.update();\n        });\n        // hide if in dialog because that can have its own scrollbar\n        (0, $i8UFO.dialogCounter).subscribe(function(v) {\n            // ignores the 0.5 by tool dropdown\n            _this.upBtn.style.opacity = v >= 1 ? \"0\" : \"\";\n            _this.downBtn.style.opacity = v >= 1 ? \"0\" : \"\";\n        });\n    }\n    (0, $7h4XF._)(ToolspaceScroller, [\n        {\n            key: \"update\",\n            value: function update() {\n                if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) {\n                    if (!this.upInterval) this.upBtn.style.display = this.toolspace.scrollTop === 0 ? \"none\" : \"block\";\n                    if (!this.downInterval) this.downBtn.style.display = this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ? \"none\" : \"block\";\n                } else {\n                    this.upBtn.style.display = \"none\";\n                    this.downBtn.style.display = \"none\";\n                }\n            }\n        },\n        {\n            key: \"updateUiState\",\n            value: function updateUiState(uiState) {\n                (0, $eWjiX.BB).css(this.upBtn, {\n                    left: uiState === \"left\" ? \"0\" : \"\",\n                    right: uiState === \"right\" ? \"0\" : \"\"\n                });\n                (0, $eWjiX.BB).css(this.downBtn, {\n                    left: uiState === \"left\" ? \"0\" : \"\",\n                    right: uiState === \"right\" ? \"0\" : \"\"\n                });\n            }\n        }\n    ]);\n    return ToolspaceScroller;\n}();\n\n});\n\nparcelRequire.register(\"5Gc7M\", function(module, exports) {\n\n$parcel$export(module.exports, \"GradientUi\", function () { return $f244572c1923a3ac$export$7fa03d1ef9d3489e; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $iFIyy = parcelRequire(\"iFIyy\");\nvar $f244572c1923a3ac$export$7fa03d1ef9d3489e = /*#__PURE__*/ function() {\n    \"use strict\";\n    function GradientUi(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, GradientUi);\n        this.settings = {\n            opacity: 1,\n            type: \"linear\",\n            doLockAlpha: false,\n            doSnap: false,\n            isReversed: false,\n            isEraser: false\n        };\n        this.colorSlider = p.colorSlider;\n        this.rootEl = (0, $eWjiX.BB).el({\n            css: {\n                margin: \"10px\"\n            }\n        });\n        this.isVisible = true;\n        this.colorDiv = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: \"10px\"\n            }\n        });\n        this.iconArr = [];\n        {\n            var size = 33;\n            [\n                0,\n                1,\n                2\n            ].forEach(function() {\n                var el = (0, $eWjiX.BB).el({\n                    className: \"dark-invert\",\n                    css: {\n                        width: size + \"px\",\n                        height: size + \"px\",\n                        borderRadius: \"3px\",\n                        margin: \"1px\"\n                    }\n                });\n                _this.iconArr.push(el);\n            });\n        }\n        this.updateIcons();\n        var typeOptions = new (0, $iFIyy.Options)({\n            optionArr: [\n                {\n                    id: \"linear\",\n                    label: this.iconArr[0],\n                    title: (0, $1mH1z.LANG)(\"gradient-linear\")\n                },\n                {\n                    id: \"linear-mirror\",\n                    label: this.iconArr[1],\n                    title: (0, $1mH1z.LANG)(\"gradient-linear-mirror\")\n                },\n                {\n                    id: \"radial\",\n                    label: this.iconArr[2],\n                    title: (0, $1mH1z.LANG)(\"gradient-radial\")\n                }\n            ],\n            initId: \"linear\",\n            onChange: function(id) {\n                _this.settings.type = id;\n            }\n        });\n        this.rootEl.append(typeOptions.getElement());\n        var opacitySlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"opacity\"),\n            width: 250,\n            height: 30,\n            min: 0.01,\n            max: 1,\n            value: this.settings.opacity,\n            toValue: function(displayValue) {\n                return displayValue / 100;\n            },\n            toDisplayValue: function(value) {\n                return value * 100;\n            },\n            onChange: function(val) {\n                _this.settings.opacity = val;\n            }\n        });\n        (0, $eWjiX.BB).css(opacitySlider.getElement(), {\n            marginTop: \"10px\"\n        });\n        this.rootEl.append(opacitySlider.getElement());\n        var row1 = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                marginTop: \"10px\"\n            }\n        });\n        var reverseToggle = new (0, $7bWhB.Checkbox)({\n            init: false,\n            label: (0, $1mH1z.LANG)(\"reverse\"),\n            callback: function(b) {\n                _this.settings.isReversed = b;\n                _this.updateIcons();\n            },\n            css: {\n                width: \"50%\"\n            }\n        });\n        var doSnapToggle = new (0, $7bWhB.Checkbox)({\n            init: false,\n            label: (0, $1mH1z.LANG)(\"angle-snap\"),\n            title: (0, $1mH1z.LANG)(\"angle-snap-title\"),\n            callback: function(b) {\n                _this.settings.doSnap = b;\n            },\n            css: {\n                width: \"50%\"\n            }\n        });\n        row1.append(reverseToggle.getElement(), doSnapToggle.getElement());\n        var row2 = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                marginTop: \"10px\"\n            }\n        });\n        var eraserToggle = new (0, $7bWhB.Checkbox)({\n            init: this.settings.isEraser,\n            label: (0, $1mH1z.LANG)(\"eraser\"),\n            callback: function(b) {\n                _this.settings.isEraser = b;\n            },\n            css: {\n                width: \"50%\"\n            }\n        });\n        var lockAlphaToggle = new (0, $7bWhB.Checkbox)({\n            init: false,\n            label: (0, $1mH1z.LANG)(\"lock-alpha\"),\n            title: (0, $1mH1z.LANG)(\"lock-alpha-title\"),\n            callback: function(b) {\n                _this.settings.doLockAlpha = b;\n            },\n            doHighlight: true,\n            css: {\n                width: \"50%\"\n            }\n        });\n        row2.append(eraserToggle.getElement(), lockAlphaToggle.getElement());\n    }\n    (0, $7h4XF._)(GradientUi, [\n        {\n            key: \"updateIcons\",\n            value: function updateIcons() {\n                var col1 = this.settings.isReversed ? \"#0000\" : \"#000\";\n                var col2 = this.settings.isReversed ? \"#000\" : \"#0000\";\n                this.iconArr[0].style.background = \"linear-gradient(\".concat(col1, \", \").concat(col2, \")\");\n                this.iconArr[1].style.background = \"linear-gradient(\".concat(col2, \", \").concat(col1, \", \").concat(col2, \")\");\n                this.iconArr[2].style.background = \"radial-gradient(\".concat(col1, \", \").concat(col2, \")\");\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"setIsVisible\",\n            value: function setIsVisible(isVisible) {\n                this.isVisible = !!isVisible;\n                this.rootEl.style.display = isVisible ? \"block\" : \"none\";\n                if (isVisible) this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\n            }\n        },\n        {\n            key: \"getSettings\",\n            value: function getSettings() {\n                return (0, $eWjiX.BB).copyObj(this.settings);\n            }\n        }\n    ]);\n    return GradientUi;\n}();\n\n});\n\n\nparcelRequire.register(\"jmL5A\", function(module, exports) {\n\n$parcel$export(module.exports, \"EmbedToolspaceTopRow\", function () { return $1eff19bee197987a$export$ce26cd3db18613a3; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $741YV = parcelRequire(\"741YV\");\n\nvar $8pc1M = parcelRequire(\"8pc1M\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $1eff19bee197987a$export$ce26cd3db18613a3 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function EmbedToolspaceTopRow(p) {\n        (0, $cx0mh._)(this, EmbedToolspaceTopRow);\n        var createButton = function createButton(p) {\n            var padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n            var el = (0, $eWjiX.BB).el({\n                className: \"toolspace-row-button nohighlight\",\n                title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.content ? \"\" : p.contain ? padding + \"px 0\" : \"\"\n                }\n            });\n            if (p.content) el.append(p.content);\n            else {\n                var im = (0, $eWjiX.BB).el({\n                    className: \"dark-invert\",\n                    css: {\n                        backgroundImage: \"url('\" + p.image + \"')\",\n                        backgroundRepeat: \"no-repeat\",\n                        backgroundPosition: \"center\",\n                        backgroundSize: p.contain ? \"contain\" : \"\",\n                        //filter: 'grayscale(1)',\n                        height: \"100%\"\n                    }\n                });\n                im.style.pointerEvents = \"none\";\n                el.append(im);\n            }\n            var pointerListener = new (0, $eWjiX.BB).PointerListener({\n                target: el,\n                onEnterLeave: function onEnterLeave(isOver) {\n                    el.classList.toggle(\"toolspace-row-button-hover\", isOver);\n                }\n            });\n            return {\n                el: el,\n                pointerListener: pointerListener\n            };\n        };\n        this.rootEl = (0, $eWjiX.BB).el({\n            className: \"kl-toolspace-row\",\n            css: {\n                height: \"36px\",\n                display: \"flex\"\n            }\n        });\n        var submitButton = createButton({\n            onClick: p.onSubmit,\n            title: (0, $1mH1z.LANG)(\"submit-title\"),\n            content: (0, $eWjiX.BB).el({\n                content: (0, $1mH1z.LANG)(\"submit\"),\n                className: \"toolspace-row-button__submit\",\n                css: {\n                    display: \"flex\",\n                    alignItems: \"center\",\n                    justifyContent: \"center\",\n                    width: \"100%\",\n                    height: \"100%\"\n                }\n            }),\n            contain: true\n        });\n        submitButton.el.style.width = \"45px\";\n        var helpButton = createButton({\n            onClick: p.onHelp,\n            title: (0, $1mH1z.LANG)(\"help\"),\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($8pc1M))),\n            contain: true\n        });\n        var leftRightButton = createButton({\n            onClick: p.onLeftRight,\n            title: (0, $1mH1z.LANG)(\"switch-ui-left-right\"),\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($741YV))),\n            contain: true\n        });\n        this.rootEl.append(submitButton.el, leftRightButton.el, helpButton.el);\n    }\n    (0, $7h4XF._)(EmbedToolspaceTopRow, [\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        }\n    ]);\n    return EmbedToolspaceTopRow;\n}();\n\n});\n\nparcelRequire.register(\"iUR3L\", function(module, exports) {\n\n$parcel$export(module.exports, \"importFilters\", function () { return $4bb0d03ef02dc0c0$export$4283b00eae4a6956; });\n\nvar $kyVjY = parcelRequire(\"kyVjY\");\n\nvar $iiVKq = parcelRequire(\"iiVKq\");\n\nvar $lorQQ = parcelRequire(\"lorQQ\");\n\nvar $8Ri8I = parcelRequire(\"8Ri8I\");\n\nvar $fADXF = parcelRequire(\"fADXF\");\n\nvar $bIns5 = parcelRequire(\"bIns5\");\n\nvar $30jcG = parcelRequire(\"30jcG\");\n\nvar $cCks8 = parcelRequire(\"cCks8\");\n\nvar $huXOx = parcelRequire(\"huXOx\");\n\nvar $dsRff = parcelRequire(\"dsRff\");\n\nvar $lhchB = parcelRequire(\"lhchB\");\n\nvar $lXpcU = parcelRequire(\"lXpcU\");\n\nvar $1CjeM = parcelRequire(\"1CjeM\");\n\nvar $dNWKZ = parcelRequire(\"dNWKZ\");\n\nvar $94Tq7 = parcelRequire(\"94Tq7\");\n\nvar $d8Fqy = parcelRequire(\"d8Fqy\");\n\nvar $gtdB1 = parcelRequire(\"gtdB1\");\n\nvar $lQzx7 = parcelRequire(\"lQzx7\");\n\nvar $10iZP = parcelRequire(\"10iZP\");\n\nvar $dteOZ = parcelRequire(\"dteOZ\");\nfunction $4bb0d03ef02dc0c0$var$importFilter(libObj, moduleObj) {\n    if (moduleObj.getDialog) libObj.getDialog = moduleObj.getDialog;\n    libObj.apply = moduleObj.apply;\n}\nfunction $4bb0d03ef02dc0c0$export$4283b00eae4a6956() {\n    if ((0, $kyVjY.filterLibStatus).isLoaded) return;\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).brightnessContrast, (0, $iiVKq.filterBrightnessContrast));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).cropExtend, (0, $lorQQ.filterCropExtend));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).curves, (0, $8Ri8I.filterCurves));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).flip, (0, $fADXF.filterFlip));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).hueSaturation, (0, $bIns5.filterHueSaturation));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).invert, (0, $30jcG.filterInvert));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).perspective, (0, $cCks8.filterPerspective));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).resize, (0, $huXOx.filterResize));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).rotate, (0, $dsRff.filterRotate));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).tiltShift, (0, $lhchB.filterTiltShift));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).transform, (0, $lXpcU.filterTransform));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).blur, (0, $1CjeM.filterBlur));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).unsharpMask, (0, $dNWKZ.filterUnsharpMask));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).toAlpha, (0, $94Tq7.filterToAlpha));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).grid, (0, $d8Fqy.filterGrid));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).noise, (0, $gtdB1.filterNoise));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).pattern, (0, $lQzx7.filterPattern));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).distort, (0, $10iZP.filterDistort));\n    $4bb0d03ef02dc0c0$var$importFilter((0, $kyVjY.filterLib).vanishPoint, (0, $dteOZ.filterVanishPoint));\n    (0, $kyVjY.filterLibStatus).isLoaded = true;\n}\n\n});\nparcelRequire.register(\"iiVKq\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterBrightnessContrast\", function () { return $024aabab8b30bbfd$export$af433fb90aa90a38; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $cH2YE = parcelRequire(\"cH2YE\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $a5EFw = parcelRequire(\"a5EFw\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $024aabab8b30bbfd$export$af433fb90aa90a38 = {\n    getDialog: function(params) {\n        var finishInit = function finishInit() {\n            var brightness = 0, contrast = 0;\n            div.innerHTML = (0, $1mH1z.LANG)(\"filter-bright-contrast-description\") + \"<br/><br/>\";\n            var fxCanvas = (0, $a5EFw.getSharedFx)();\n            if (!fxCanvas) return; // todo throw?\n            var texture = fxCanvas.texture(tempCanvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            var brightnessSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"filter-bright-contrast-brightness\"),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                value: (brightness + 1) * 50,\n                eventResMs: (0, $cH2YE.eventResMs),\n                onChange: function onChange(val) {\n                    brightness = val / 50 - 1;\n                    fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n                    klCanvasPreview.render();\n                }\n            });\n            var contrastSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"filter-bright-contrast-contrast\"),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                value: (contrast + 1) * 50,\n                eventResMs: (0, $cH2YE.eventResMs),\n                onChange: function onChange(val) {\n                    contrast = val / 50 - 1;\n                    fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n                    klCanvasPreview.render();\n                }\n            });\n            brightnessSlider.getElement().style.marginBottom = \"10px\";\n            div.append(brightnessSlider.getElement(), contrastSlider.getElement());\n            var previewWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper\",\n                css: {\n                    width: \"340px\",\n                    height: \"220px\"\n                }\n            });\n            var previewLayerArr = [];\n            for(var i = 0; i < layers.length; i++)previewLayerArr.push({\n                image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr\n            });\n            var klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n                width: parseInt(\"\" + w),\n                height: parseInt(\"\" + h),\n                layers: previewLayerArr\n            });\n            var previewInnerWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper__canvas\",\n                css: {\n                    width: parseInt(\"\" + w) + \"px\",\n                    height: parseInt(\"\" + h) + \"px\"\n                }\n            });\n            previewInnerWrapper.append(klCanvasPreview.getElement());\n            previewWrapper.append(previewInnerWrapper);\n            div.append(previewWrapper);\n            try {\n                fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n                klCanvasPreview.render();\n            } catch (e) {\n                div.errorCallback(e);\n            }\n            result.destroy = function() {\n                brightnessSlider.destroy();\n                contrastSlider.destroy();\n                texture.destroy();\n                klCanvasPreview.destroy();\n            };\n            result.getInput = function() {\n                result.destroy();\n                return {\n                    brightness: brightness,\n                    contrast: contrast\n                };\n            };\n        };\n        var div = document.createElement(\"div\");\n        var result = {\n            element: div\n        };\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        var layers = klCanvas.getLayers();\n        var selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        var fit = (0, $eWjiX.BB).fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        var w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        var tempCanvas = (0, $eWjiX.BB).canvas(w, h);\n        {\n            var ctx = (0, $eWjiX.BB).ctx(tempCanvas);\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) ctx.imageSmoothingEnabled = false;\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\n        return result;\n    },\n    apply: function(params) {\n        var context = params.context;\n        var brightness = params.input.brightness;\n        var contrast = params.input.contrast;\n        var history = params.history;\n        if (!context || !history) return false;\n        history.pause(true);\n        var fxCanvas = (0, $a5EFw.getSharedFx)();\n        if (!fxCanvas) return false; // todo more specific error?\n        var texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"brightnessContrast\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\nparcelRequire.register(\"cH2YE\", function(module, exports) {\n\n$parcel$export(module.exports, \"eventResMs\", function () { return $fca35583bfaa35b6$export$5ec472fd0ce20d84; });\nvar $fca35583bfaa35b6$export$5ec472fd0ce20d84 = 60;\n\n});\n\n\nparcelRequire.register(\"lorQQ\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterCropExtend\", function () { return $2680b5781517cb67$export$e5937df51b9e1d86; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $dJPtW = parcelRequire(\"dJPtW\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $43qNf = parcelRequire(\"43qNf\");\n\nvar $32CBv = parcelRequire(\"32CBv\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $1C8RU = parcelRequire(\"1C8RU\");\nvar $2680b5781517cb67$export$e5937df51b9e1d86 = {\n    getDialog: function(params) {\n        var updateInput = function updateInput() {\n            left = parseInt(leftInput.value);\n            right = parseInt(rightInput.value);\n            top = parseInt(topInput.value);\n            bottom = parseInt(bottomInput.value);\n            var newWidth = klCanvas.getWidth() + left + right;\n            var newHeight = klCanvas.getHeight() + top + bottom;\n            if (newWidth <= 0) {\n                if (leftChanged) {\n                    left = -klCanvas.getWidth() - right + 1;\n                    leftInput.value = \"\" + left;\n                }\n                if (rightChanged) {\n                    right = -klCanvas.getWidth() - left + 1;\n                    rightInput.value = \"\" + right;\n                }\n                newWidth = 1;\n            }\n            if (newWidth > maxWidth) {\n                if (leftChanged) {\n                    left = -klCanvas.getWidth() - right + maxWidth;\n                    leftInput.value = \"\" + left;\n                }\n                if (rightChanged) {\n                    right = -klCanvas.getWidth() - left + maxWidth;\n                    rightInput.value = \"\" + right;\n                }\n                newWidth = maxWidth;\n            }\n            if (newHeight <= 0) {\n                if (topChanged) {\n                    top = -klCanvas.getHeight() - bottom + 1;\n                    topInput.value = \"\" + top;\n                }\n                if (bottomChanged) {\n                    bottom = -klCanvas.getHeight() - top + 1;\n                    bottomInput.value = \"\" + bottom;\n                }\n                newHeight = 1;\n            }\n            if (newHeight > maxHeight) {\n                if (topChanged) {\n                    top = -klCanvas.getHeight() - bottom + maxHeight;\n                    topInput.value = \"\" + top;\n                }\n                if (bottomChanged) {\n                    bottom = -klCanvas.getHeight() - top + maxHeight;\n                    bottomInput.value = \"\" + bottom;\n                }\n                newHeight = maxHeight;\n            }\n            cropper.setTransform({\n                x: -left,\n                y: -top,\n                width: newWidth,\n                height: newHeight\n            });\n            leftChanged = false;\n            rightChanged = false;\n            topChanged = false;\n            bottomChanged = false;\n        };\n        var update = // when input field changed, or dragging in preview finished\n        // adjusts the zoom\n        function update(transform) {\n            var fit = (0, $eWjiX.BB).fitInto(transform.width, transform.height, 260, 180, 1);\n            scale = fit.width / transform.width;\n            var offset = (0, $eWjiX.BB).centerWithin(340, previewHeight, fit.width, fit.height);\n            tempCanvas.style.width = klCanvas.getWidth() * scale + \"px\";\n            tempCanvas.style.height = klCanvas.getHeight() * scale + \"px\";\n            offsetWrapper.style.left = offset.x - transform.x * scale + \"px\";\n            offsetWrapper.style.top = offset.y - transform.y * scale + \"px\";\n            left = parseInt(\"\" + -transform.x);\n            top = parseInt(\"\" + -transform.y);\n            right = parseInt(\"\" + (transform.x + transform.width - klCanvas.getWidth()));\n            bottom = parseInt(\"\" + (transform.y + transform.height - klCanvas.getHeight()));\n            leftInput.value = \"\" + left;\n            topInput.value = \"\" + top;\n            rightInput.value = \"\" + right;\n            bottomInput.value = \"\" + bottom;\n            (0, $eWjiX.BB).createCheckerDataUrl(parseInt(\"\" + 50 * scale), function(url) {\n                previewWrapper.style.background = \"url(\" + url + \")\";\n                if (selectedRgbaObj.a !== 0) tempCanvas.style.background = \"url(\" + url + \")\";\n            }, (0, $1C8RU.theme).isDark());\n            previewWrapper.style.backgroundPosition = offset.x + \"px \" + offset.y + \"px\";\n            cropper.setScale(scale);\n        };\n        var updateBg = function updateBg() {\n            if (selectedRgbaObj.a === 0) {\n                bgColorOverlay.style.background = \"\";\n                tempCanvas.style.background = \"\";\n            } else {\n                bgColorOverlay.style.background = (0, $eWjiX.BB).ColorConverter.toRgbStr(selectedRgbaObj);\n                (0, $eWjiX.BB).createCheckerDataUrl(parseInt(\"\" + 50 * scale), function(url) {\n                    tempCanvas.style.background = \"url(\" + url + \")\";\n                }, (0, $1C8RU.theme).isDark());\n            }\n        };\n        var updateIsDark = function updateIsDark() {\n            updateInput();\n        };\n        var klCanvas = params.klCanvas;\n        if (!klCanvas) return false;\n        var tempCanvas = (0, $eWjiX.BB).canvas();\n        {\n            var fit = (0, $eWjiX.BB).fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 560, 400, 1);\n            var w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n            var previewFactor = w / klCanvas.getWidth();\n            tempCanvas.width = w;\n            tempCanvas.height = h;\n            tempCanvas.style.display = \"block\";\n            (0, $eWjiX.BB).ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n        }\n        var div = document.createElement(\"div\");\n        var result = {\n            element: div\n        };\n        div.innerHTML = (0, $1mH1z.LANG)(\"filter-crop-description\") + \"<br/><br/>\";\n        var left = 0, right = 0, top = 0, bottom = 0;\n        var leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\n        var maxWidth = params.maxWidth, maxHeight = params.maxHeight;\n        var scale = 1;\n        // --- input elements ---\n        var lrWrapper = (0, $eWjiX.BB).el({\n            css: {\n                lineHeight: \"30px\",\n                height: \"35px\"\n            }\n        });\n        var tbWrapper = (0, $eWjiX.BB).el({\n            css: {\n                lineHeight: \"30px\",\n                height: \"35px\"\n            }\n        });\n        div.append(lrWrapper, tbWrapper);\n        var leftInput = (0, $dJPtW.input)({\n            init: 0,\n            type: \"number\",\n            min: -klCanvas.getWidth(),\n            max: maxWidth,\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function callback() {\n                leftChanged = true;\n                updateInput();\n            }\n        });\n        var rightInput = (0, $dJPtW.input)({\n            init: 0,\n            type: \"number\",\n            min: -klCanvas.getWidth(),\n            max: maxWidth,\n            css: {\n                width: \"75px\"\n            },\n            callback: function callback() {\n                rightChanged = true;\n                updateInput();\n            }\n        });\n        var topInput = (0, $dJPtW.input)({\n            init: 0,\n            type: \"number\",\n            min: -klCanvas.getHeight(),\n            max: maxHeight,\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function callback() {\n                topChanged = true;\n                updateInput();\n            }\n        });\n        var bottomInput = (0, $dJPtW.input)({\n            init: 0,\n            type: \"number\",\n            min: -klCanvas.getHeight(),\n            max: maxHeight,\n            css: {\n                width: \"75px\"\n            },\n            callback: function callback() {\n                bottomChanged = true;\n                updateInput();\n            }\n        });\n        var labelStyle = {\n            display: \"inline-block\",\n            width: \"60px\"\n        };\n        lrWrapper.append((0, $eWjiX.BB).el({\n            content: (0, $1mH1z.LANG)(\"filter-crop-left\") + \":\",\n            css: labelStyle\n        }), leftInput, (0, $eWjiX.BB).el({\n            content: (0, $1mH1z.LANG)(\"filter-crop-right\") + \":\",\n            css: labelStyle\n        }), rightInput);\n        tbWrapper.append((0, $eWjiX.BB).el({\n            content: (0, $1mH1z.LANG)(\"filter-crop-top\") + \":\",\n            css: labelStyle\n        }), topInput, (0, $eWjiX.BB).el({\n            content: (0, $1mH1z.LANG)(\"filter-crop-bottom\") + \":\",\n            css: labelStyle\n        }), bottomInput);\n        var useRuleOfThirds = true;\n        var ruleOThirdsCheckbox = new (0, $7bWhB.Checkbox)({\n            init: true,\n            label: (0, $1mH1z.LANG)(\"filter-crop-rule-thirds\"),\n            allowTab: true,\n            callback: function callback(b) {\n                useRuleOfThirds = b;\n                cropper.showThirds(useRuleOfThirds);\n            }\n        });\n        div.append((0, $eWjiX.BB).el({\n            css: {\n                clear: \"both\"\n            }\n        }));\n        var selectedRgbaObj = {\n            r: 0,\n            g: 0,\n            b: 0,\n            a: 0\n        };\n        var colorOptionsArr = [\n            {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 0\n            },\n            {\n                r: 255,\n                g: 255,\n                b: 255,\n                a: 1\n            },\n            {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 1\n            }\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1\n        });\n        var colorOptions = new (0, $43qNf.ColorOptions)({\n            label: (0, $1mH1z.LANG)(\"filter-crop-fill\"),\n            colorArr: colorOptionsArr,\n            onChange: function onChange(rgbaObj) {\n                selectedRgbaObj = rgbaObj;\n                updateBg();\n            }\n        });\n        var flexRow = (0, $eWjiX.BB).el({\n            css: {\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                alignItems: \"center\",\n                marginTop: \"10px\"\n            }\n        });\n        div.append(flexRow);\n        flexRow.append(ruleOThirdsCheckbox.getElement(), colorOptions.getElement());\n        var previewHeight = 218; // two less because of border\n        var previewWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-edit-crop-preview\",\n            css: {\n                width: \"340px\",\n                marginTop: \"10px\",\n                marginLeft: \"-20px\",\n                height: previewHeight + \"px\",\n                backgroundColor: \"#9e9e9e\",\n                position: \"relative\",\n                borderTop: \"1px solid rgb(144,144,144)\",\n                borderBottom: \"1px solid rgb(144,144,144)\",\n                overflow: \"hidden\",\n                userSelect: \"none\",\n                touchAction: \"none\"\n            }\n        });\n        previewWrapper.oncontextmenu = function() {\n            return false;\n        };\n        var bgColorOverlay = (0, $eWjiX.BB).el({\n            css: {\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\",\n                bottom: \"0\",\n                right: \"0\"\n            }\n        });\n        previewWrapper.append(bgColorOverlay);\n        var offsetWrapper = document.createElement(\"div\");\n        offsetWrapper.style.position = \"absolute\";\n        offsetWrapper.style.left = \"0px\";\n        offsetWrapper.style.top = \"0px\";\n        previewWrapper.append(offsetWrapper);\n        (0, $eWjiX.BB).el({\n            parent: offsetWrapper,\n            content: tempCanvas,\n            css: {\n                boxShadow: \"0 0 0px 1px rgb(130,130,130)\",\n                position: \"absolute\",\n                left: \"0px\",\n                top: \"0px\"\n            }\n        });\n        div.append(previewWrapper);\n        var cropper = new (0, $32CBv.Cropper)({\n            x: 0,\n            y: 0,\n            width: klCanvas.getWidth(),\n            height: klCanvas.getHeight(),\n            scale: scale,\n            callback: update,\n            maxW: maxWidth,\n            maxH: maxHeight\n        });\n        update(cropper.getTransform());\n        offsetWrapper.append(cropper.getElement());\n        (0, $1C8RU.theme).addIsDarkListener(updateIsDark);\n        result.destroy = function() {\n            cropper.destroy();\n            ruleOThirdsCheckbox.destroy();\n            (0, $1C8RU.theme).removeIsDarkListener(updateIsDark);\n            colorOptions.destroy();\n        };\n        result.getInput = function() {\n            result.destroy();\n            return {\n                left: left,\n                right: right,\n                top: top,\n                bottom: bottom,\n                fillColor: selectedRgbaObj.a === 0 ? undefined : selectedRgbaObj\n            };\n        };\n        return result;\n    },\n    apply: function(params) {\n        var klCanvas = params.klCanvas;\n        var history = params.history;\n        if (!klCanvas || !history || isNaN(params.input.left) || isNaN(params.input.right) || isNaN(params.input.top) || isNaN(params.input.bottom)) return false;\n        history.pause(true);\n        klCanvas.resizeCanvas(params.input);\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"cropExtend\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: (0, $eWjiX.BB).copyObj(params.input)\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\n\nparcelRequire.register(\"8Ri8I\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterCurves\", function () { return $4c948640eb8ef791$export$309483fcb6d5c7ca; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $a5EFw = parcelRequire(\"a5EFw\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $hRvnE = parcelRequire(\"hRvnE\");\nvar $4c948640eb8ef791$export$309483fcb6d5c7ca = {\n    getDialog: function(params) {\n        var finishInit = function finishInit() {\n            div.innerHTML = (0, $1mH1z.LANG)(\"filter-curves-description\") + \"<br/><br/>\";\n            var curves = (0, $hRvnE.getDefaultCurvesInput)();\n            var fxCanvas = (0, $a5EFw.getSharedFx)();\n            if (fxCanvas === null) return; // todo throw?\n            var texture = fxCanvas.texture(tempCanvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            function update() {\n                try {\n                    fxCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\n                    if (klCanvasPreview) klCanvasPreview.render();\n                } catch (e) {\n                    div.errorCallback(e);\n                }\n            }\n            var input = new (0, $hRvnE.CurvesInput)({\n                curves: curves,\n                callback: function callback(val) {\n                    curves = val;\n                    update();\n                }\n            });\n            var modeButtons = input.getModeButtons();\n            div.append(input.getElement());\n            var previewWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper\",\n                css: {\n                    width: \"340px\",\n                    height: \"220px\"\n                }\n            });\n            var previewLayerArr = [];\n            for(var i = 0; i < layers.length; i++)previewLayerArr.push({\n                image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr\n            });\n            klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n                width: parseInt(\"\" + w),\n                height: parseInt(\"\" + h),\n                layers: previewLayerArr\n            });\n            var previewInnerWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper__canvas\",\n                css: {\n                    width: parseInt(\"\" + w) + \"px\",\n                    height: parseInt(\"\" + h) + \"px\"\n                }\n            });\n            previewInnerWrapper.append(klCanvasPreview.getElement());\n            previewWrapper.append(previewInnerWrapper);\n            div.append(previewWrapper);\n            result.destroy = function() {\n                input.destroy();\n                texture.destroy();\n                modeButtons.destroy();\n                klCanvasPreview.destroy();\n            };\n            result.getInput = function() {\n                result.destroy();\n                return {\n                    curves: curves\n                };\n            };\n        };\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        var layers = klCanvas.getLayers();\n        var selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        var fit = (0, $eWjiX.BB).fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        var w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        var tempCanvas = (0, $eWjiX.BB).canvas(w, h);\n        {\n            var ctx = (0, $eWjiX.BB).ctx(tempCanvas);\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) ctx.imageSmoothingEnabled = false;\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        var div = (0, $eWjiX.BB).el();\n        var result = {\n            element: div\n        };\n        var klCanvasPreview;\n        setTimeout(finishInit, 1);\n        return result;\n    },\n    apply: function(params) {\n        var context = params.context;\n        var curves = params.input.curves;\n        var history = params.history;\n        if (!context || !history) return false;\n        history.pause(true);\n        var fxCanvas = (0, $a5EFw.getSharedFx)();\n        if (!fxCanvas) return false; // todo more specific error?\n        var texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"curves\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\nparcelRequire.register(\"hRvnE\", function(module, exports) {\n\n$parcel$export(module.exports, \"getDefaultCurvesInput\", function () { return $81ac57466912ccc9$export$4300cf0a0df418a6; });\n$parcel$export(module.exports, \"CurvesInput\", function () { return $81ac57466912ccc9$export$1c43bf66c2a2e4da; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $iFIyy = parcelRequire(\"iFIyy\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nfunction $81ac57466912ccc9$export$4300cf0a0df418a6() {\n    return (0, $eWjiX.BB).copyObj({\n        r: [\n            [\n                0,\n                0\n            ],\n            [\n                1 / 3,\n                1 / 3\n            ],\n            [\n                2 / 3,\n                2 / 3\n            ],\n            [\n                1,\n                1\n            ]\n        ],\n        g: [\n            [\n                0,\n                0\n            ],\n            [\n                1 / 3,\n                1 / 3\n            ],\n            [\n                2 / 3,\n                2 / 3\n            ],\n            [\n                1,\n                1\n            ]\n        ],\n        b: [\n            [\n                0,\n                0\n            ],\n            [\n                1 / 3,\n                1 / 3\n            ],\n            [\n                2 / 3,\n                2 / 3\n            ],\n            [\n                1,\n                1\n            ]\n        ]\n    });\n}\nvar $81ac57466912ccc9$export$1c43bf66c2a2e4da = /*#__PURE__*/ function() {\n    \"use strict\";\n    function CurvesInput(p) {\n        var _this = this;\n        (0, $cx0mh._)(this, CurvesInput);\n        this.rootEl = (0, $eWjiX.BB).el({\n            css: {\n                position: \"relative\",\n                marginBottom: \"10px\"\n            }\n        });\n        this.rootEl.oncontextmenu = function() {\n            return false;\n        };\n        var mode = \"All\";\n        var curves = p.curves;\n        this.modeButtons = new (0, $iFIyy.Options)({\n            optionArr: [\n                {\n                    id: \"All\",\n                    label: (0, $1mH1z.LANG)(\"filter-curves-all\")\n                },\n                {\n                    id: \"Red\",\n                    label: (0, $1mH1z.LANG)(\"red\")\n                },\n                {\n                    id: \"Green\",\n                    label: (0, $1mH1z.LANG)(\"green\")\n                },\n                {\n                    id: \"Blue\",\n                    label: (0, $1mH1z.LANG)(\"blue\")\n                }\n            ],\n            initId: \"All\",\n            onChange: function(id) {\n                mode = id;\n                if (mode === \"All\") curves = $81ac57466912ccc9$export$4300cf0a0df418a6();\n                var curve = curves.r;\n                if (mode === \"Green\") curve = curves.g;\n                if (mode === \"Blue\") curve = curves.b;\n                _this.p0.setPos(0, areaH - curve[0][1] * areaH);\n                _this.p1.setPos(curve[1][0] * areaW, areaH - curve[1][1] * areaH);\n                _this.p2.setPos(curve[2][0] * areaW, areaH - curve[2][1] * areaH);\n                _this.p3.setPos(areaW, areaH - curve[3][1] * areaH);\n                update();\n            }\n        });\n        this.rootEl.append(this.modeButtons.getElement());\n        var curveArea = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            className: \"kl-curves-graph\",\n            css: {\n                position: \"relative\",\n                marginTop: \"10px\"\n            }\n        });\n        var areaW = 300, areaH = 100;\n        var canvas = (0, $eWjiX.BB).canvas(areaW, areaH);\n        var ctx = (0, $eWjiX.BB).ctx(canvas);\n        curveArea.append(canvas);\n        var fit = function(v) {\n            return Math.max(0, Math.min(1, v));\n        };\n        var createPoint = function(x, y, callback, lock) {\n            var gripSize = 14;\n            var internalY = y, internalX = x;\n            var pointEl = (0, $eWjiX.BB).el({\n                className: \"kl-curves-graph__grip\",\n                css: {\n                    left: x - gripSize / 2 + \"px\",\n                    top: y - gripSize / 2 + \"px\",\n                    width: gripSize + \"px\",\n                    height: gripSize + \"px\",\n                    borderRadius: gripSize + \"px\"\n                }\n            });\n            var update = function() {\n                (0, $eWjiX.BB).css(pointEl, {\n                    left: x - gripSize / 2 + \"px\",\n                    top: y - gripSize / 2 + \"px\"\n                });\n            };\n            var pointerListener = new (0, $eWjiX.BB).PointerListener({\n                target: pointEl,\n                onPointer: function(event) {\n                    event.eventPreventDefault();\n                    if (event.type === \"pointerdown\") {\n                        internalX = x;\n                        internalY = y;\n                    }\n                    if (event.button === \"left\" && event.type === \"pointermove\") {\n                        if (!lock) internalX += event.dX;\n                        x = Math.max(0, Math.min(areaW, internalX));\n                        internalY += event.dY;\n                        y = Math.max(0, Math.min(areaH, internalY));\n                        update();\n                        callback({\n                            x: x,\n                            y: y\n                        });\n                    }\n                }\n            });\n            curveArea.append(pointEl);\n            var setPos = function(newX, newY) {\n                x = newX;\n                y = newY;\n                internalY = y;\n                internalX = x;\n                (0, $eWjiX.BB).css(pointEl, {\n                    left: x - gripSize / 2 + \"px\",\n                    top: y - gripSize / 2 + \"px\"\n                });\n            };\n            return {\n                el: pointEl,\n                setPos: setPos,\n                pointerListener: pointerListener\n            };\n        };\n        var updateControl = function(i, x, y) {\n            if (mode === \"All\") {\n                curves.r[i] = [\n                    fit(x / areaW),\n                    fit(1 - y / areaH)\n                ];\n                curves.g[i] = [\n                    fit(x / areaW),\n                    fit(1 - y / areaH)\n                ];\n                curves.b[i] = [\n                    fit(x / areaW),\n                    fit(1 - y / areaH)\n                ];\n            }\n            if (mode === \"Red\") curves.r[i] = [\n                fit(x / areaW),\n                fit(1 - y / areaH)\n            ];\n            if (mode === \"Green\") curves.g[i] = [\n                fit(x / areaW),\n                fit(1 - y / areaH)\n            ];\n            if (mode === \"Blue\") curves.b[i] = [\n                fit(x / areaW),\n                fit(1 - y / areaH)\n            ];\n        };\n        this.p0 = createPoint(0, areaH, function(val) {\n            updateControl(0, val.x, val.y);\n            update();\n        }, true);\n        this.p1 = createPoint(areaW / 3, areaH / 3 * 2, function(val) {\n            updateControl(1, val.x, val.y);\n            update();\n        });\n        this.p2 = createPoint(areaW / 3 * 2, areaH / 3, function(val) {\n            updateControl(2, val.x, val.y);\n            update();\n        });\n        this.p3 = createPoint(areaW, 0, function(val) {\n            updateControl(3, val.x, val.y);\n            update();\n        }, true);\n        var update = function() {\n            ctx = (0, $eWjiX.BB).ctx(canvas);\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            var outCurves = {\n                r: [],\n                g: [],\n                b: []\n            };\n            for(var i = 0; i < curves.r.length; i++){\n                outCurves.r.push(curves.r[i]);\n                outCurves.g.push(curves.g[i]);\n                outCurves.b.push(curves.b[i]);\n            }\n            var drawCurve = function(curve) {\n                ctx.beginPath();\n                var spline = new (0, $eWjiX.BB).SplineInterpolator(curve);\n                for(var i = 0; i < 100; i++){\n                    var y = spline.interpolate(i / 100);\n                    y = Math.max(0, Math.min(1, y));\n                    if (i === 0) ctx.moveTo(i / 100 * areaW, areaH - y * areaH);\n                    else ctx.lineTo(i / 100 * areaW, areaH - y * areaH);\n                }\n                ctx.stroke();\n            };\n            ctx.save();\n            if (mode === \"All\") {\n                ctx.strokeStyle = \"black\";\n                drawCurve(outCurves.r);\n            } else {\n                ctx.globalAlpha = 0.5;\n                ctx.strokeStyle = \"red\";\n                drawCurve(outCurves.r);\n                ctx.strokeStyle = \"green\";\n                drawCurve(outCurves.g);\n                ctx.strokeStyle = \"blue\";\n                drawCurve(outCurves.b);\n            }\n            ctx.restore();\n            p.callback(outCurves);\n        };\n        update();\n    }\n    (0, $7h4XF._)(CurvesInput, [\n        {\n            // ---- interface ----\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        },\n        {\n            key: \"destroy\",\n            value: function destroy() {\n                this.p0.pointerListener.destroy();\n                this.p1.pointerListener.destroy();\n                this.p2.pointerListener.destroy();\n                this.p3.pointerListener.destroy();\n            }\n        },\n        {\n            key: \"getModeButtons\",\n            value: function getModeButtons() {\n                return this.modeButtons;\n            }\n        }\n    ]);\n    return CurvesInput;\n}();\n\n});\n\n\nparcelRequire.register(\"fADXF\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterFlip\", function () { return $6b01e1931d168e01$export$9b1b7b3985b9625a; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\n\nvar $iFIyy = parcelRequire(\"iFIyy\");\nvar $6b01e1931d168e01$export$9b1b7b3985b9625a = {\n    getDialog: function(params) {\n        var updatePreview = function updatePreview() {\n            var ctx = (0, $eWjiX.BB).ctx(previewLayer.image);\n            ctx.save();\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\n            if (doFlipCanvas) {\n                if (isHorizontal) {\n                    ctx.translate(previewLayer.image.width, 0);\n                    ctx.scale(-1, 1);\n                }\n                if (isVertical) {\n                    ctx.translate(0, previewLayer.image.height);\n                    ctx.scale(1, -1);\n                }\n            }\n            for(var i = 0; i < layers.length; i++){\n                if (!layers[i].isVisible) continue;\n                ctx.save();\n                if (!doFlipCanvas && selectedLayerIndex === i) {\n                    if (isHorizontal) {\n                        ctx.translate(previewLayer.image.width, 0);\n                        ctx.scale(-1, 1);\n                    }\n                    if (isVertical) {\n                        ctx.translate(0, previewLayer.image.height);\n                        ctx.scale(1, -1);\n                    }\n                }\n                if (ctx.canvas.width > layers[i].context.canvas.width) ctx.imageSmoothingEnabled = false;\n                ctx.globalAlpha = layers[i].opacity;\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\n                ctx.restore();\n            }\n            klCanvasPreview.render();\n            ctx.restore();\n        };\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        var layers = klCanvas.getLayers();\n        var selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        var fit = (0, $eWjiX.BB).fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        var w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        var div = document.createElement(\"div\");\n        var result = {\n            element: div\n        };\n        var isHorizontal = true;\n        var isVertical = false;\n        var doFlipCanvas = true;\n        div.innerHTML = (0, $1mH1z.LANG)(\"filter-flip-description\") + \"<br/><br/>\";\n        var horizontalCheckbox = new (0, $7bWhB.Checkbox)({\n            init: isHorizontal,\n            label: (0, $1mH1z.LANG)(\"filter-flip-horizontal\") + \" \",\n            allowTab: true,\n            callback: function callback(v) {\n                isHorizontal = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: \"10px\"\n            }\n        });\n        var verticalCheckbox = new (0, $7bWhB.Checkbox)({\n            init: isVertical,\n            label: (0, $1mH1z.LANG)(\"filter-flip-vertical\") + \" \",\n            allowTab: true,\n            callback: function callback(v) {\n                isVertical = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: \"10px\"\n            }\n        });\n        div.append(horizontalCheckbox.getElement());\n        div.append(verticalCheckbox.getElement());\n        var targetOptions = new (0, $iFIyy.Options)({\n            optionArr: [\n                {\n                    id: true,\n                    label: (0, $1mH1z.LANG)(\"filter-flip-image\")\n                },\n                {\n                    id: false,\n                    label: (0, $1mH1z.LANG)(\"filter-flip-layer\")\n                }\n            ],\n            onChange: function(val) {\n                doFlipCanvas = val;\n                updatePreview();\n            }\n        });\n        div.append(targetOptions.getElement());\n        var previewWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper\",\n            css: {\n                width: \"340px\",\n                height: \"220px\"\n            }\n        });\n        var previewLayer = {\n            image: (0, $eWjiX.BB).canvas(Math.round(w), Math.round(h)),\n            isVisible: true,\n            opacity: 1,\n            mixModeStr: \"source-over\"\n        };\n        var klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: [\n                previewLayer\n            ]\n        });\n        var previewInnerWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper__canvas\",\n            css: {\n                width: parseInt(\"\" + w) + \"px\",\n                height: parseInt(\"\" + h) + \"px\"\n            }\n        });\n        previewInnerWrapper.append(klCanvasPreview.getElement());\n        previewWrapper.append(previewInnerWrapper);\n        setTimeout(updatePreview, 0);\n        div.append(previewWrapper);\n        result.destroy = function() {\n            horizontalCheckbox.destroy();\n            verticalCheckbox.destroy();\n            targetOptions.destroy();\n            klCanvasPreview.destroy();\n        };\n        result.getInput = function() {\n            result.destroy();\n            return {\n                horizontal: isHorizontal,\n                vertical: isVertical,\n                flipCanvas: doFlipCanvas\n            };\n        };\n        return result;\n    },\n    apply: function(params) {\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        var history = params.history;\n        var horizontal = params.input.horizontal;\n        var vertical = params.input.vertical;\n        var flipCanvas = params.input.flipCanvas;\n        if (!context || !klCanvas || !history) return false;\n        history.pause(true);\n        klCanvas.flip(horizontal, vertical, flipCanvas ? undefined : (0, $7jh4K.throwIfNull)(klCanvas.getLayerIndex(context.canvas)));\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"flip\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\n\nparcelRequire.register(\"bIns5\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterHueSaturation\", function () { return $041c656037c77a96$export$2aa46bd5587f0eb; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $cH2YE = parcelRequire(\"cH2YE\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $a5EFw = parcelRequire(\"a5EFw\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $041c656037c77a96$export$2aa46bd5587f0eb = {\n    getDialog: function(params) {\n        var finishInit = function finishInit() {\n            var hue = 0, saturation = 0;\n            div.innerHTML = (0, $1mH1z.LANG)(\"filter-hue-sat-description\") + \"<br/><br/>\";\n            var fxCanvas = (0, $a5EFw.getSharedFx)();\n            if (!fxCanvas) return; // todo throw?\n            var texture = fxCanvas.texture(tempCanvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            var hueSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"filter-hue-sat-hue\"),\n                width: 300,\n                height: 30,\n                min: -100,\n                max: 100,\n                value: hue * 100,\n                eventResMs: (0, $cH2YE.eventResMs),\n                onChange: function onChange(val) {\n                    hue = val / 100;\n                    fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\n                    klCanvasPreview.render();\n                }\n            });\n            var saturationSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"filter-hue-sat-saturation\"),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                value: (saturation + 1) * 50,\n                eventResMs: (0, $cH2YE.eventResMs),\n                onChange: function onChange(val) {\n                    saturation = val / 50 - 1;\n                    fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\n                    klCanvasPreview.render();\n                }\n            });\n            hueSlider.getElement().style.marginBottom = \"10px\";\n            div.append(hueSlider.getElement(), saturationSlider.getElement());\n            var previewWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper\",\n                css: {\n                    width: \"340px\",\n                    height: \"220px\"\n                }\n            });\n            var previewLayerArr = [];\n            for(var i = 0; i < layers.length; i++)previewLayerArr.push({\n                image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr\n            });\n            var klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n                width: parseInt(\"\" + w),\n                height: parseInt(\"\" + h),\n                layers: previewLayerArr\n            });\n            var previewInnerWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper__canvas\",\n                css: {\n                    width: parseInt(\"\" + w) + \"px\",\n                    height: parseInt(\"\" + h) + \"px\"\n                }\n            });\n            previewInnerWrapper.append(klCanvasPreview.getElement());\n            previewWrapper.append(previewInnerWrapper);\n            div.append(previewWrapper);\n            try {\n                fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\n                klCanvasPreview.render();\n            } catch (e) {\n                div.errorCallback(e);\n            }\n            result.destroy = function() {\n                hueSlider.destroy();\n                saturationSlider.destroy();\n                texture.destroy();\n                klCanvasPreview.destroy();\n            };\n            result.getInput = function() {\n                result.destroy();\n                return {\n                    hue: hue,\n                    saturation: saturation\n                };\n            };\n        };\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        var layers = klCanvas.getLayers();\n        var selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        var fit = (0, $eWjiX.BB).fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        var w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        var tempCanvas = (0, $eWjiX.BB).canvas(w, h);\n        {\n            var ctx = (0, $eWjiX.BB).ctx(tempCanvas);\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) ctx.imageSmoothingEnabled = false;\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        var div = document.createElement(\"div\");\n        var result = {\n            element: div\n        };\n        setTimeout(finishInit, 1);\n        return result;\n    },\n    apply: function(params) {\n        var context = params.context;\n        var hue = params.input.hue;\n        var history = params.history;\n        var saturation = params.input.saturation;\n        if (!context || hue === null || saturation === null || !history) return false;\n        history.pause(true);\n        var fxCanvas = (0, $a5EFw.getSharedFx)();\n        if (!fxCanvas) return false; // todo more specific error?\n        var texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"hueSaturation\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\n\nparcelRequire.register(\"30jcG\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterInvert\", function () { return $82b3d1ba61b3412f$export$b7ebcfbdc840ef76; });\n\nvar $a5EFw = parcelRequire(\"a5EFw\");\nvar $82b3d1ba61b3412f$export$b7ebcfbdc840ef76 = {\n    apply: function(params) {\n        var context = params.context;\n        var history = params.history;\n        if (!context || !history) return false;\n        var fxCanvas = (0, $a5EFw.getSharedFx)();\n        if (!fxCanvas) return false;\n        history.pause(true);\n        var texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).invert().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"invert\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\n\nparcelRequire.register(\"cCks8\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterPerspective\", function () { return $460859cbeb601dec$export$a76d798fa7d85e4e; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $a5EFw = parcelRequire(\"a5EFw\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $5vheV = parcelRequire(\"5vheV\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $460859cbeb601dec$export$a76d798fa7d85e4e = {\n    getDialog: function(params) {\n        var finishInit = function finishInit() {\n            div.innerHTML = (0, $1mH1z.LANG)(\"filter-perspective-description\") + \"<br/><br/>\";\n            var fxCanvas = (0, $7jh4K.throwIfNull)((0, $a5EFw.getSharedFx)());\n            var texture = fxCanvas.texture(tempCanvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            function update() {\n                try {\n                    fxCanvas.draw(texture).multiplyAlpha().perspective([\n                        ba.x,\n                        ba.y,\n                        bb.x,\n                        bb.y,\n                        bc.x,\n                        bc.y,\n                        bd.x,\n                        bd.y\n                    ].map(function(item, i) {\n                        if (i % 2 === 0) return item / displayW * w;\n                        else return item / displayH * h;\n                    }), [\n                        aa.x,\n                        aa.y,\n                        ab.x,\n                        ab.y,\n                        ac.x,\n                        ac.y,\n                        ad.x,\n                        ad.y\n                    ].map(function(item, i) {\n                        if (i % 2 === 0) return item / displayW * w;\n                        else return item / displayH * h;\n                    })).unmultiplyAlpha().update();\n                    klCanvasPreview.render();\n                } catch (e) {\n                    div.errorCallback(e);\n                }\n            }\n            function createDraggable(x, y, callback) {\n                var size = 14;\n                var div = document.createElement(\"div\");\n                div.x = x;\n                div.y = y;\n                (0, $eWjiX.BB).css(div, {\n                    width: size + \"px\",\n                    height: size + \"px\",\n                    backgroundColor: \"#fff\",\n                    boxShadow: \"inset 0 0 0 2px #000\",\n                    borderRadius: size + \"px\",\n                    position: \"absolute\",\n                    cursor: \"move\",\n                    left: div.x - size / 2 + \"px\",\n                    top: div.y - size / 2 + \"px\",\n                    userSelect: \"none\",\n                    touchAction: \"none\"\n                });\n                var pointerListener = new (0, $eWjiX.BB).PointerListener({\n                    target: div,\n                    onPointer: function onPointer(event) {\n                        event.eventPreventDefault();\n                        if (event.button === \"left\" && event.type === \"pointermove\") {\n                            div.x += event.dX;\n                            div.y += event.dY;\n                            div.style.left = div.x - size / 2 + \"px\";\n                            div.style.top = div.y - size / 2 + \"px\";\n                            if (callback) callback();\n                            update();\n                        }\n                    }\n                });\n                div.copy = function(p) {\n                    div.x = p.x;\n                    div.y = p.y;\n                    div.style.left = div.x - size / 2 + \"px\";\n                    div.style.top = div.y - size / 2 + \"px\";\n                };\n                pointerListenerArr.push(pointerListener);\n                return div;\n            }\n            function updateAfter() {\n                aa.copy(ba);\n                ab.copy(bb);\n                ac.copy(bc);\n                ad.copy(bd);\n            }\n            // b - before\n            var ba = createDraggable(0, 0, updateAfter);\n            var bb = createDraggable(displayW, 0, updateAfter);\n            var bc = createDraggable(displayW, displayH, updateAfter);\n            var bd = createDraggable(0, displayH, updateAfter);\n            // a - after\n            var aa = createDraggable(0, 0);\n            var ab = createDraggable(displayW, 0);\n            var ac = createDraggable(displayW, displayH);\n            var ad = createDraggable(0, displayH);\n            var before = false;\n            var beforeAfterTabs = new (0, $5vheV.TwoTabs)({\n                left: (0, $1mH1z.LANG)(\"compare-before\"),\n                right: (0, $1mH1z.LANG)(\"compare-after\"),\n                init: 1,\n                onChange: function(val) {\n                    before = val === 0;\n                    if (before) {\n                        aa.style.display = \"none\";\n                        ab.style.display = \"none\";\n                        ac.style.display = \"none\";\n                        ad.style.display = \"none\";\n                        ba.style.display = \"block\";\n                        bb.style.display = \"block\";\n                        bc.style.display = \"block\";\n                        bd.style.display = \"block\";\n                        ba.copy(aa);\n                        bb.copy(ab);\n                        bc.copy(ac);\n                        bd.copy(ad);\n                    } else {\n                        ba.style.display = \"none\";\n                        bb.style.display = \"none\";\n                        bc.style.display = \"none\";\n                        bd.style.display = \"none\";\n                        aa.style.display = \"block\";\n                        ab.style.display = \"block\";\n                        ac.style.display = \"block\";\n                        ad.style.display = \"block\";\n                        aa.copy(ba);\n                        ab.copy(bb);\n                        ac.copy(bc);\n                        ad.copy(bd);\n                    }\n                    update();\n                }\n            });\n            div.append(beforeAfterTabs.getElement());\n            var previewWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper\",\n                css: {\n                    width: isSmall ? \"340px\" : \"540px\",\n                    height: isSmall ? \"260px\" : \"300px\",\n                    marginTop: \"0\"\n                }\n            });\n            previewWrapper.oncontextmenu = function() {\n                return false;\n            };\n            var previewLayerArr = [];\n            for(var i = 0; i < layers.length; i++){\n                var canvas = i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas;\n                previewLayerArr.push({\n                    image: canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr\n                });\n            }\n            var klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n                width: parseInt(\"\" + displayW),\n                height: parseInt(\"\" + displayH),\n                layers: previewLayerArr\n            });\n            var previewInnerWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper__canvas\",\n                css: {\n                    width: parseInt(\"\" + displayW) + \"px\",\n                    height: parseInt(\"\" + displayH) + \"px\"\n                }\n            });\n            previewInnerWrapper.append(klCanvasPreview.getElement());\n            previewWrapper.append(previewInnerWrapper);\n            previewInnerWrapper.append(aa, ab, ac, ad);\n            ba.style.display = \"none\";\n            bb.style.display = \"none\";\n            bc.style.display = \"none\";\n            bd.style.display = \"none\";\n            previewInnerWrapper.append(ba, bb, bc, bd);\n            div.append(previewWrapper);\n            update();\n            result.destroy = function() {\n                for(var i = 0; i < pointerListenerArr.length; i++)pointerListenerArr[i].destroy();\n                texture.destroy();\n                klCanvasPreview.destroy();\n            };\n            result.getInput = function() {\n                result.destroy();\n                return {\n                    before: [\n                        ba.x / displayPreviewFactor,\n                        ba.y / displayPreviewFactor,\n                        bb.x / displayPreviewFactor,\n                        bb.y / displayPreviewFactor,\n                        bc.x / displayPreviewFactor,\n                        bc.y / displayPreviewFactor,\n                        bd.x / displayPreviewFactor,\n                        bd.y / displayPreviewFactor\n                    ],\n                    after: [\n                        aa.x / displayPreviewFactor,\n                        aa.y / displayPreviewFactor,\n                        ab.x / displayPreviewFactor,\n                        ab.y / displayPreviewFactor,\n                        ac.x / displayPreviewFactor,\n                        ac.y / displayPreviewFactor,\n                        ad.x / displayPreviewFactor,\n                        ad.y / displayPreviewFactor\n                    ]\n                };\n            };\n        };\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        var isSmall = window.innerWidth < 550;\n        var layers = klCanvas.getLayers();\n        var selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        var fit = (0, $eWjiX.BB).fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\n        var displayW = parseInt(\"\" + fit.width), displayH = parseInt(\"\" + fit.height);\n        var w = Math.min(displayW, context.canvas.width);\n        var h = Math.min(displayH, context.canvas.height);\n        var tempCanvas = (0, $eWjiX.BB).canvas(w, h);\n        {\n            var ctx = (0, $eWjiX.BB).ctx(tempCanvas);\n            ctx.save();\n            if (w > context.canvas.width) ctx.imageSmoothingEnabled = false;\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        var displayPreviewFactor = displayW / context.canvas.width;\n        var div = document.createElement(\"div\");\n        var result = {\n            element: div\n        };\n        if (!isSmall) result.width = 540;\n        var pointerListenerArr = [];\n        setTimeout(finishInit, 1);\n        return result;\n    },\n    apply: function(params) {\n        var context = params.context;\n        var history = params.history;\n        var before = params.input.before;\n        var after = params.input.after;\n        if (!context || !before || !after || !history) return false;\n        history.pause(true);\n        var fxCanvas = (0, $a5EFw.getSharedFx)();\n        if (!fxCanvas) return false; // todo more specific error?\n        var texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).multiplyAlpha().perspective(before, after).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"perspective\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\nparcelRequire.register(\"5vheV\", function(module, exports) {\n\n$parcel$export(module.exports, \"TwoTabs\", function () { return $8b4f5ae4fe73ff76$export$b1241e74876d9bbe; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $8b4f5ae4fe73ff76$export$b1241e74876d9bbe = /*#__PURE__*/ function() {\n    \"use strict\";\n    function TwoTabs(params) {\n        var _this = this;\n        (0, $cx0mh._)(this, TwoTabs);\n        this.value = params.init;\n        this.rootEl = (0, $eWjiX.BB).el({\n            className: \"kl-2-tabs\"\n        });\n        this.leftTab = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            content: params.left,\n            className: \"kl-2-tabs__left\"\n        });\n        this.leftTab.onpointerdown = function() {\n            return false;\n        };\n        this.rightTab = (0, $eWjiX.BB).el({\n            parent: this.rootEl,\n            content: params.right,\n            className: \"kl-2-tabs__right\"\n        });\n        this.rightTab.onpointerdown = function() {\n            return false;\n        };\n        this.update();\n        this.leftTab.onclick = function() {\n            if (_this.value === 0) return;\n            _this.value = 0;\n            _this.update();\n            params.onChange(_this.value);\n        };\n        this.rightTab.onclick = function() {\n            if (_this.value === 1) return;\n            _this.value = 1;\n            _this.update();\n            params.onChange(_this.value);\n        };\n    }\n    (0, $7h4XF._)(TwoTabs, [\n        {\n            key: \"update\",\n            value: function update() {\n                this.leftTab.classList.toggle(\"kl-2-tabs--active\", this.value === 0);\n                this.rightTab.classList.toggle(\"kl-2-tabs--active\", this.value === 1);\n            }\n        },\n        {\n            key: \"getElement\",\n            value: function getElement() {\n                return this.rootEl;\n            }\n        }\n    ]);\n    return TwoTabs;\n}();\n\n});\n\n\nparcelRequire.register(\"huXOx\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterResize\", function () { return $63d62a20f3ba2c7d$export$5705240d31427a82; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $eEL9N = parcelRequire(\"eEL9N\");\n\nvar $bNBIp = parcelRequire(\"bNBIp\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $cNr8p = parcelRequire(\"cNr8p\");\n\nvar $1C8RU = parcelRequire(\"1C8RU\");\nvar $63d62a20f3ba2c7d$export$5705240d31427a82 = {\n    getDialog: function(params) {\n        var updateConstrain = function updateConstrain() {\n            constrainIm.style.display = isConstrained ? \"\" : \"none\";\n            if (isConstrained) {\n                widthInput.value = \"\" + klCanvas.getWidth();\n                heightInput.value = \"\" + klCanvas.getHeight();\n                update();\n            }\n        };\n        var draw = function draw() {\n            if (algorithmSelect.getValue() === \"smooth\") {\n                previewCanvas.style.imageRendering = previewFactor > 1 ? \"pixelated\" : \"\";\n                previewCanvas.width = klCanvas.getWidth();\n                previewCanvas.height = klCanvas.getHeight();\n                previewCtx.save();\n                previewCtx.imageSmoothingQuality = \"high\";\n                previewCtx.drawImage(tempCanvas, 0, 0);\n                (0, $eWjiX.BB).resizeCanvas(previewCanvas, newWidth, newHeight);\n                previewCtx.restore();\n            } else {\n                previewCanvas.style.imageRendering = \"pixelated\";\n                previewCanvas.width = newWidth;\n                previewCanvas.height = newHeight;\n                previewCtx.save();\n                previewCtx.imageSmoothingEnabled = false;\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\n                previewCtx.restore();\n            }\n        };\n        var update = function update() {\n            if (widthInput.value.length === 0 && widthChanged || heightInput.value.length === 0 && heightChanged) {\n                heightChanged = false;\n                widthChanged = false;\n                return;\n            }\n            widthInput.value = \"\" + Math.max(1, parseInt(widthInput.value));\n            heightInput.value = \"\" + Math.max(1, parseInt(heightInput.value));\n            if (isConstrained) {\n                if (heightChanged) widthInput.value = \"\" + parseInt(\"\" + parseInt(heightInput.value) * ratio);\n                if (widthChanged) heightInput.value = \"\" + parseInt(\"\" + parseInt(widthInput.value) / ratio);\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\n                    var fit = (0, $eWjiX.BB).fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\n                    widthInput.value = \"\" + parseInt(\"\" + fit.width);\n                    heightInput.value = \"\" + parseInt(\"\" + fit.height);\n                }\n            }\n            if (parseInt(widthInput.value) > maxWidth) widthInput.value = \"\" + maxWidth;\n            if (parseInt(heightInput.value) > maxHeight) heightInput.value = \"\" + maxHeight;\n            heightChanged = false;\n            widthChanged = false;\n            newWidth = parseInt(widthInput.value);\n            newHeight = parseInt(heightInput.value);\n            var preview = (0, $eWjiX.BB).fitInto(newWidth, newHeight, 280, 200, 1);\n            var previewW = parseInt(\"\" + preview.width), previewH = parseInt(\"\" + preview.height);\n            previewFactor = previewW / newWidth;\n            var offset = (0, $eWjiX.BB).centerWithin(340, 220, previewW, previewH);\n            draw();\n            previewCanvas.style.width = Math.max(1, previewW) + \"px\";\n            previewCanvas.style.height = Math.max(1, previewH) + \"px\";\n            canvasWrapper.style.left = offset.x + \"px\";\n            canvasWrapper.style.top = offset.y + \"px\";\n            canvasWrapper.style.width = Math.max(1, previewW) + \"px\";\n            canvasWrapper.style.height = Math.max(1, previewH) + \"px\";\n        };\n        var updateCheckerboard = function updateCheckerboard() {\n            (0, $eWjiX.BB).createCheckerDataUrl(8, function(url) {\n                previewWrapper.style.background = \"url(\" + url + \")\";\n            }, (0, $1C8RU.theme).isDark());\n        };\n        //BB.centerWithin\n        var klCanvas = params.klCanvas;\n        if (!klCanvas) return false;\n        var fit = (0, $eWjiX.BB).fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\n        var w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        var previewFactor = w / klCanvas.getWidth();\n        var tempCanvas = klCanvas.getCompleteCanvas(1);\n        var div = document.createElement(\"div\");\n        var result = {\n            element: div\n        };\n        var newWidth = klCanvas.getWidth(), newHeight = klCanvas.getHeight();\n        div.innerHTML = (0, $1mH1z.LANG)(\"filter-resize-description\") + \"<br/><br/>\";\n        var maxWidth = params.maxWidth, maxHeight = params.maxHeight;\n        var widthWrapper = (0, $eWjiX.BB).el({\n            css: {\n                width: \"150px\",\n                height: \"35px\",\n                lineHeight: \"30px\"\n            }\n        });\n        var heightWrapper = (0, $eWjiX.BB).el({\n            css: {\n                width: \"150px\",\n                height: \"35px\",\n                lineHeight: \"30px\"\n            }\n        });\n        var widthInput = (0, $eWjiX.BB).el({\n            tagName: \"input\",\n            css: {\n                cssFloat: \"right\",\n                width: \"90px\"\n            },\n            custom: {\n                type: \"number\",\n                min: \"1\",\n                max: \"\" + maxWidth,\n                value: \"\" + klCanvas.getWidth()\n            }\n        });\n        var heightInput = (0, $eWjiX.BB).el({\n            tagName: \"input\",\n            css: {\n                cssFloat: \"right\",\n                width: \"90px\"\n            },\n            custom: {\n                type: \"number\",\n                min: \"1\",\n                max: \"\" + maxHeight,\n                value: \"\" + klCanvas.getHeight()\n            }\n        });\n        widthInput.onclick = function() {\n            this.focus();\n            widthChanged = true;\n            update();\n        };\n        heightInput.onclick = function() {\n            this.focus();\n            heightChanged = true;\n            update();\n        };\n        widthInput.onchange = function() {\n            widthChanged = true;\n            update();\n        };\n        heightInput.onchange = function() {\n            heightChanged = true;\n            update();\n        };\n        widthWrapper.append((0, $1mH1z.LANG)(\"width\") + \": \", widthInput);\n        heightWrapper.append((0, $1mH1z.LANG)(\"height\") + \": \", heightInput);\n        var inputWrapper = (0, $eWjiX.BB).el({\n            css: {\n                background: \"url(\" + (0, (/*@__PURE__*/$parcel$interopDefault($bNBIp))) + \") no-repeat 140px 5px\",\n                backgroundSize: \"50px 52px\"\n            }\n        });\n        inputWrapper.append(widthWrapper, heightWrapper);\n        var constrainIm = new Image();\n        constrainIm.src = (0, (/*@__PURE__*/$parcel$interopDefault($bNBIp)));\n        constrainIm.height = 40;\n        var sizeTable = (0, $cNr8p.table)([\n            [\n                (0, $1mH1z.LANG)(\"width\") + \":&nbsp;\",\n                widthInput,\n                constrainIm\n            ],\n            [\n                (0, $eWjiX.BB).el({\n                    css: {\n                        height: \"5px\"\n                    }\n                }),\n                \"\",\n                \"\"\n            ],\n            [\n                (0, $1mH1z.LANG)(\"height\") + \":&nbsp;\",\n                heightInput\n            ]\n        ], {\n            \"0.2\": {\n                rowspan: 3\n            }\n        });\n        (0, $eWjiX.BB).css(sizeTable, {\n            marginBottom: \"10px\"\n        });\n        div.append(sizeTable);\n        //contrain checkbox\n        var heightChanged = false, widthChanged = false;\n        var ratio = klCanvas.getWidth() / klCanvas.getHeight();\n        var isConstrained = true;\n        var constrainCheckbox = new (0, $7bWhB.Checkbox)({\n            init: true,\n            label: (0, $1mH1z.LANG)(\"constrain-proportions\"),\n            allowTab: true,\n            callback: function callback(b) {\n                isConstrained = b;\n                updateConstrain();\n            }\n        });\n        div.append((0, $eWjiX.BB).el({\n            css: {\n                clear: \"both\"\n            }\n        }));\n        var algorithmSelect = new (0, $eEL9N.Select)({\n            isFocusable: true,\n            optionArr: [\n                [\n                    \"smooth\",\n                    (0, $1mH1z.LANG)(\"algorithm-smooth\")\n                ],\n                [\n                    \"pixelated\",\n                    (0, $1mH1z.LANG)(\"algorithm-pixelated\")\n                ]\n            ],\n            title: (0, $1mH1z.LANG)(\"scaling-algorithm\"),\n            initValue: \"smooth\",\n            onChange: function() {\n                update();\n            }\n        });\n        var secondRowElement = (0, $eWjiX.BB).el({\n            parent: div,\n            css: {\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                \"alignItems\": \"center\"\n            }\n        });\n        secondRowElement.append(constrainCheckbox.getElement(), algorithmSelect.getElement());\n        var previewCanvas = (0, $eWjiX.BB).canvas(w, h);\n        previewCanvas.style.imageRendering = \"pixelated\";\n        var previewCtx = (0, $eWjiX.BB).ctx(previewCanvas);\n        var previewWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-transparent-preview\",\n            css: {\n                width: \"340px\",\n                marginLeft: \"-20px\",\n                height: \"220px\",\n                display: \"table\",\n                marginTop: \"10px\",\n                position: \"relative\",\n                userSelect: \"none\"\n            }\n        });\n        var canvasWrapper = (0, $eWjiX.BB).el({\n            parent: previewWrapper,\n            content: previewCanvas,\n            className: \"kl-transparent-preview__canvas\",\n            css: {\n                width: w + \"px\",\n                height: h + \"px\",\n                position: \"absolute\",\n                overflow: \"hidden\"\n            }\n        });\n        (0, $1C8RU.theme).addIsDarkListener(updateCheckerboard);\n        updateCheckerboard();\n        div.append(previewWrapper);\n        update();\n        result.destroy = function() {\n            constrainCheckbox.destroy();\n            (0, $1C8RU.theme).removeIsDarkListener(updateCheckerboard);\n        };\n        result.getInput = function() {\n            result.destroy();\n            return {\n                width: newWidth,\n                height: newHeight,\n                algorithm: algorithmSelect.getValue()\n            };\n        };\n        return result;\n    },\n    apply: function(params) {\n        var klCanvas = params.klCanvas;\n        var history = params.history;\n        var width = params.input.width;\n        var height = params.input.height;\n        var algorithm = params.input.algorithm;\n        if (!klCanvas || !history) return false;\n        history.pause(true);\n        klCanvas.resize(width, height, algorithm);\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"resize\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\nparcelRequire.register(\"bNBIp\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"c92cL\");\n\n});\n\n\nparcelRequire.register(\"dsRff\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterRotate\", function () { return $878715182dcd377b$export$ac7e9efc751d5791; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $1C8RU = parcelRequire(\"1C8RU\");\nvar $878715182dcd377b$export$ac7e9efc751d5791 = {\n    getDialog: function(params) {\n        var update = function update() {\n            canvasWrapper.style.transform = \"rotate(\" + deg + \"deg)\";\n            if (Math.abs(deg % 180) === 90) {\n                //height has to fit width because of rotation\n                var fit = (0, $eWjiX.BB).fitInto(h, w, 280, 200, 1);\n                var scale = parseInt(\"\" + fit.height) / w;\n                canvasWrapper.style.transform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\n            }\n        };\n        var updateCheckerboard = function updateCheckerboard() {\n            (0, $eWjiX.BB).createCheckerDataUrl(8, function(url) {\n                canvasWrapper.style.background = \"url(\" + url + \")\";\n            }, (0, $1C8RU.theme).isDark());\n        };\n        var klCanvas = params.klCanvas;\n        if (!klCanvas) return false;\n        var fit = (0, $eWjiX.BB).fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\n        var w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        var previewFactor = w / klCanvas.getWidth();\n        var tempCanvas = (0, $eWjiX.BB).canvas(w, h);\n        tempCanvas.style.display = \"block\";\n        (0, $eWjiX.BB).ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n        var div = document.createElement(\"div\");\n        var result = {\n            element: div\n        };\n        var deg = 0;\n        div.innerHTML = (0, $1mH1z.LANG)(\"filter-rotate-description\") + \"<br/><br/>\";\n        var btnPlus = document.createElement(\"button\");\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\\xb0\";\n        var btnMinus = document.createElement(\"button\");\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\\xb0\";\n        btnMinus.style.marginRight = \"5px\";\n        btnPlus.onclick = function() {\n            deg += 90;\n            update();\n        };\n        btnMinus.onclick = function() {\n            deg -= 90;\n            update();\n        };\n        div.append(btnMinus, btnPlus);\n        var previewWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper\",\n            css: {\n                width: \"340px\",\n                height: \"220px\",\n                display: \"table\"\n            }\n        });\n        var previewcell = (0, $eWjiX.BB).el({\n            parent: previewWrapper,\n            css: {\n                display: \"table-cell\",\n                verticalAlign: \"middle\"\n            }\n        });\n        var canvasWrapper = (0, $eWjiX.BB).el({\n            parent: previewcell,\n            content: tempCanvas,\n            className: \"kl-preview-wrapper__canvas\",\n            css: {\n                width: w + \"px\",\n                height: h + \"px\",\n                marginLeft: \"auto\",\n                marginRight: \"auto\",\n                overflow: \"hidden\"\n            }\n        });\n        (0, $1C8RU.theme).addIsDarkListener(updateCheckerboard);\n        updateCheckerboard();\n        canvasWrapper.style.transition = \"all 0.2s ease-out\";\n        div.append(previewWrapper);\n        update();\n        result.destroy = function() {\n            (0, $1C8RU.theme).removeIsDarkListener(updateCheckerboard);\n        };\n        result.getInput = function() {\n            result.destroy();\n            return {\n                deg: deg\n            };\n        };\n        return result;\n    },\n    apply: function(params) {\n        var klCanvas = params.klCanvas;\n        var history = params.history;\n        if (!klCanvas || !history) return false;\n        history.pause(true);\n        klCanvas.rotate(params.input.deg);\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"rotate\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\n\nparcelRequire.register(\"lhchB\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterTiltShift\", function () { return $aa97ed406a9700f0$export$1b8796b18b7c19ed; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $cH2YE = parcelRequire(\"cH2YE\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $a5EFw = parcelRequire(\"a5EFw\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $aa97ed406a9700f0$export$1b8796b18b7c19ed = {\n    getDialog: function(params) {\n        var finishInit = function finishInit() {\n            var blur = 20, gradient = 200;\n            rootEl.innerHTML = (0, $1mH1z.LANG)(\"filter-tilt-shift-description\") + \"<br/><br/>\";\n            var fxCanvas = (0, $7jh4K.throwIfNull)((0, $a5EFw.getSharedFx)());\n            var texture = fxCanvas.texture(tempCanvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            function update() {\n                try {\n                    fxCanvas.draw(texture).tiltShift(fa.x / displayPreviewFactor * previewFactor, fa.y / displayPreviewFactor * previewFactor, fb.x / displayPreviewFactor * previewFactor, fb.y / displayPreviewFactor * previewFactor, blur * previewFactor, gradient * previewFactor).update();\n                    klCanvasPreview.render();\n                } catch (e) {\n                    rootEl.errorCallback(e);\n                }\n            }\n            function createDraggable(x, y) {\n                var size = 14;\n                var div = (0, $eWjiX.BB).el({\n                    css: {\n                        width: size + \"px\",\n                        height: size + \"px\",\n                        backgroundColor: \"#fff\",\n                        boxShadow: \"inset 0 0 0 2px #000\",\n                        borderRadius: size + \"px\",\n                        position: \"absolute\",\n                        cursor: \"move\",\n                        left: x - size / 2 + \"px\",\n                        top: y - size / 2 + \"px\",\n                        userSelect: \"none\",\n                        touchAction: \"none\"\n                    }\n                });\n                div.x = x;\n                div.y = y;\n                var pointerListener = new (0, $eWjiX.BB).PointerListener({\n                    target: div,\n                    onPointer: function onPointer(event) {\n                        event.eventPreventDefault();\n                        if (event.button === \"left\" && event.type === \"pointermove\") {\n                            div.x += event.dX;\n                            div.y += event.dY;\n                            div.style.left = div.x - size / 2 + \"px\";\n                            div.style.top = div.y - size / 2 + \"px\";\n                            update();\n                        }\n                    }\n                });\n                pointerListenerArr.push(pointerListener);\n                return div;\n            }\n            // focus line control points\n            var fa = createDraggable(parseInt(\"\" + displayW / 6), parseInt(\"\" + displayH / 2));\n            var fb = createDraggable(parseInt(\"\" + (displayW - displayW / 6)), parseInt(\"\" + (displayH - displayH / 3)));\n            var blurSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"filter-tilt-shift-blur\"),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 200,\n                value: blur,\n                eventResMs: (0, $cH2YE.eventResMs),\n                onChange: function onChange(val) {\n                    blur = val;\n                    update();\n                }\n            });\n            blurSlider.getElement().style.marginBottom = \"10px\";\n            rootEl.append(blurSlider.getElement());\n            var gradientSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"filter-tilt-shift-gradient\"),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 1000,\n                value: gradient,\n                eventResMs: (0, $cH2YE.eventResMs),\n                onChange: function onChange(val) {\n                    gradient = val;\n                    update();\n                }\n            });\n            rootEl.append(gradientSlider.getElement());\n            var previewWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper\",\n                css: {\n                    width: \"340px\",\n                    height: \"220px\"\n                }\n            });\n            previewWrapper.oncontextmenu = function() {\n                return false;\n            };\n            var previewLayerArr = [];\n            for(var i = 0; i < layers.length; i++)previewLayerArr.push({\n                image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr\n            });\n            var klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n                width: parseInt(\"\" + displayW),\n                height: parseInt(\"\" + displayH),\n                layers: previewLayerArr\n            });\n            var previewInnerWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper__canvas\",\n                css: {\n                    width: parseInt(\"\" + displayW) + \"px\",\n                    height: parseInt(\"\" + displayH) + \"px\"\n                }\n            });\n            previewInnerWrapper.append(klCanvasPreview.getElement());\n            previewWrapper.append(previewInnerWrapper);\n            previewInnerWrapper.append(fa, fb);\n            rootEl.append(previewWrapper);\n            update();\n            result.destroy = function() {\n                for(var i = 0; i < pointerListenerArr.length; i++)pointerListenerArr[i].destroy();\n                blurSlider.destroy();\n                gradientSlider.destroy();\n                texture.destroy();\n                klCanvasPreview.destroy();\n            };\n            result.getInput = function() {\n                result.destroy();\n                return {\n                    a: {\n                        x: fa.x / displayPreviewFactor,\n                        y: fa.y / displayPreviewFactor\n                    },\n                    b: {\n                        x: fb.x / displayPreviewFactor,\n                        y: fb.y / displayPreviewFactor\n                    },\n                    blur: blur,\n                    gradient: gradient\n                };\n            };\n        };\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        var layers = klCanvas.getLayers();\n        var selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        var fit = (0, $eWjiX.BB).fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        var displayW = parseInt(\"\" + fit.width), displayH = parseInt(\"\" + fit.height);\n        var w = Math.min(displayW, context.canvas.width);\n        var h = Math.min(displayH, context.canvas.height);\n        var tempCanvas = (0, $eWjiX.BB).canvas(w, h);\n        {\n            var ctx = (0, $eWjiX.BB).ctx(tempCanvas);\n            ctx.save();\n            if (w > context.canvas.width) ctx.imageSmoothingEnabled = false;\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        var previewFactor = w / context.canvas.width;\n        var displayPreviewFactor = displayW / context.canvas.width;\n        var rootEl = document.createElement(\"div\");\n        var result = {\n            element: rootEl\n        };\n        var pointerListenerArr = [];\n        setTimeout(finishInit, 1);\n        return result;\n    },\n    apply: function(params) {\n        var context = params.context;\n        var history = params.history;\n        var a = params.input.a;\n        var b = params.input.b;\n        var blur = params.input.blur;\n        var gradient = params.input.gradient;\n        if (!context || !history) return false;\n        history.pause(true);\n        var fxCanvas = (0, $a5EFw.getSharedFx)();\n        if (!fxCanvas) return false; // todo more specific error?\n        var texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).tiltShift(a.x, a.y, b.x, b.y, blur, gradient).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"tiltShift\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\n\nparcelRequire.register(\"lXpcU\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterTransform\", function () { return $31a0dd41d7428d32$export$dc15474d94cdc2b3; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $cNhNm = parcelRequire(\"cNhNm\");\n\nvar $eEL9N = parcelRequire(\"eEL9N\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $31a0dd41d7428d32$export$dc15474d94cdc2b3 = {\n    getDialog: function(params) {\n        var updatePreview = function updatePreview() {\n            var doForce = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : false;\n            if (!freeTransform) return;\n            var transform = freeTransform.getTransform();\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) return;\n            lastDrawnTransformStr = JSON.stringify(transform);\n            if (displayPreviewFactor < 1) {\n                transform.x *= displayPreviewFactor;\n                transform.y *= displayPreviewFactor;\n                transform.width *= displayPreviewFactor;\n                transform.height *= displayPreviewFactor;\n            }\n            var transformLayerCanvas = previewLayerArr[selectedLayerIndex].image;\n            var ctx = (0, $eWjiX.BB).ctx(transformLayerCanvas);\n            ctx.save();\n            ctx.clearRect(0, 0, transformLayerCanvas.width, transformLayerCanvas.height);\n            (0, $eWjiX.BB).drawTransformedImageWithBounds(ctx, layers[selectedLayerIndex].context.canvas, transform, boundsObj, algorithmSelect.getValue() === \"pixelated\" || (0, $eWjiX.BB).testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height));\n            ctx.restore();\n            klCanvasPreview.render();\n        };\n        var onInputsChanged = function onInputsChanged() {\n            freeTransform.setPos({\n                x: parseInt(inputX.value) + initTransform.x,\n                y: parseInt(inputY.value) + initTransform.y\n            });\n            freeTransform.setAngleDeg(parseInt(inputR.value));\n            updatePreview();\n        };\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        var isSmall = window.innerWidth < 550;\n        var layers = klCanvas.getLayers();\n        var selectedLayerIndex = (0, $7jh4K.throwIfNull)(klCanvas.getLayerIndex(context.canvas));\n        var fit = (0, $eWjiX.BB).fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\n        var displayW = parseInt(\"\" + fit.width), displayH = parseInt(\"\" + fit.height);\n        var w = Math.min(displayW, context.canvas.width);\n        var h = Math.min(displayH, context.canvas.height);\n        var displayPreviewFactor = displayW / context.canvas.width;\n        // determine bounds and initial transformation\n        var boundsObj = (0, $eWjiX.BB).canvasBounds(context);\n        if (!boundsObj) {\n            alert((0, $1mH1z.LANG)(\"filter-transform-empty\"));\n            return false;\n        }\n        var initTransform = {\n            x: boundsObj.x + boundsObj.width / 2,\n            y: boundsObj.y + boundsObj.height / 2,\n            width: boundsObj.width,\n            height: boundsObj.height,\n            angleDeg: 0\n        };\n        var div = document.createElement(\"div\");\n        var result = {\n            element: div\n        };\n        if (!isSmall) result.width = 540;\n        div.innerHTML = (0, $1mH1z.LANG)(\"filter-transform-description\");\n        var keyListener = new (0, $eWjiX.BB).KeyListener({\n            onDown: function onDown(keyStr) {\n                if ((0, $eWjiX.BB).isInputFocused(true)) return;\n                if (keyStr === \"left\") {\n                    inputX.value = \"\" + (parseFloat(inputX.value) - 1);\n                    onInputsChanged();\n                }\n                if (keyStr === \"right\") {\n                    inputX.value = \"\" + (parseFloat(inputX.value) + 1);\n                    onInputsChanged();\n                }\n                if (keyStr === \"up\") {\n                    inputY.value = \"\" + (parseFloat(inputY.value) - 1);\n                    onInputsChanged();\n                }\n                if (keyStr === \"down\") {\n                    inputY.value = \"\" + (parseFloat(inputY.value) + 1);\n                    onInputsChanged();\n                }\n            }\n        });\n        var leftWrapper = document.createElement(\"div\");\n        var rightWrapper = document.createElement(\"div\");\n        var rotWrapper = document.createElement(\"div\");\n        var inputY = document.createElement(\"input\");\n        var inputX = document.createElement(\"input\");\n        var inputR = document.createElement(\"input\");\n        leftWrapper.style.width = \"100px\";\n        leftWrapper.style.height = \"30px\";\n        rightWrapper.style.width = \"100px\";\n        rightWrapper.style.height = \"30px\";\n        rightWrapper.style.display = \"inline-block\";\n        leftWrapper.style.display = \"inline-block\";\n        rotWrapper.style.display = \"inline-block\";\n        rotWrapper.style.width = \"150px\";\n        rotWrapper.style.height = \"30px\";\n        inputY.type = \"number\";\n        inputX.type = \"number\";\n        inputR.type = \"number\";\n        inputX.style.width = \"70px\";\n        inputY.style.width = \"70px\";\n        inputR.style.width = \"70px\";\n        inputY.value = \"0\";\n        inputX.value = \"0\";\n        inputR.value = \"0\";\n        inputY.onclick = function() {\n            inputY.focus();\n            onInputsChanged();\n        };\n        inputX.onclick = function() {\n            inputX.focus();\n            onInputsChanged();\n        };\n        inputR.onclick = function() {\n            inputR.focus();\n            onInputsChanged();\n        };\n        inputY.onchange = function() {\n            onInputsChanged();\n        };\n        inputX.onchange = function() {\n            onInputsChanged();\n        };\n        inputR.onchange = function() {\n            onInputsChanged();\n        };\n        inputY.onkeyup = function() {\n            onInputsChanged();\n        };\n        inputX.onkeyup = function() {\n            onInputsChanged();\n        };\n        inputR.onkeyup = function() {\n            onInputsChanged();\n        };\n        leftWrapper.append(\"X: \", inputX);\n        rightWrapper.append(\"Y: \", inputY);\n        rotWrapper.append((0, $1mH1z.LANG)(\"filter-transform-rotation\") + \": \", inputR);\n        if (!isSmall) {\n            var inputRow = (0, $eWjiX.BB).el({\n                parent: div,\n                css: {\n                    marginTop: \"10px\"\n                }\n            });\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\n        }\n        // buttons\n        var actionBtnCss = {\n            marginLeft: \"10px\",\n            marginTop: \"10px\"\n        };\n        var buttonRow = (0, $eWjiX.BB).el({\n            parent: div,\n            css: {\n                display: \"flex\",\n                flexWrap: \"wrap\",\n                marginLeft: \"-10px\"\n            }\n        });\n        var flipXBtn = (0, $eWjiX.BB).el({\n            parent: buttonRow,\n            tagName: \"button\",\n            content: (0, $1mH1z.LANG)(\"filter-transform-flip\") + \" X\",\n            onClick: function() {\n                var t = freeTransform.getTransform();\n                freeTransform.setSize(-t.width, t.height);\n            },\n            css: actionBtnCss\n        });\n        var flipYBtn = (0, $eWjiX.BB).el({\n            parent: buttonRow,\n            tagName: \"button\",\n            content: (0, $1mH1z.LANG)(\"filter-transform-flip\") + \" Y\",\n            onClick: function() {\n                var t = freeTransform.getTransform();\n                freeTransform.setSize(t.width, -t.height);\n            },\n            css: actionBtnCss\n        });\n        var scaleRotLeftBtn = (0, $eWjiX.BB).el({\n            parent: buttonRow,\n            tagName: \"button\",\n            content: \"-90\\xb0\",\n            onClick: function() {\n                var t = freeTransform.getTransform();\n                t.angleDeg -= 90;\n                t.angleDeg %= 360;\n                freeTransform.setAngleDeg(t.angleDeg);\n                inputR.value = \"\" + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            css: actionBtnCss\n        });\n        var scaleRotRightBtn = (0, $eWjiX.BB).el({\n            parent: buttonRow,\n            tagName: \"button\",\n            content: \"+90\\xb0\",\n            onClick: function() {\n                var t = freeTransform.getTransform();\n                t.angleDeg += 90;\n                t.angleDeg %= 360;\n                freeTransform.setAngleDeg(t.angleDeg);\n                inputR.value = \"\" + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            css: actionBtnCss\n        });\n        var scaleDoubleBtn = (0, $eWjiX.BB).el({\n            parent: buttonRow,\n            tagName: \"button\",\n            content: \"2x\",\n            onClick: function() {\n                var t = freeTransform.getTransform();\n                if (constrainCheckbox.getValue()) freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\n                else freeTransform.setSize(t.width * 2, t.height * 2);\n            },\n            css: actionBtnCss\n        });\n        var scaleHalfBtn = (0, $eWjiX.BB).el({\n            parent: buttonRow,\n            tagName: \"button\",\n            content: \"1/2x\",\n            onClick: function() {\n                var t = freeTransform.getTransform();\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\n            },\n            css: actionBtnCss\n        });\n        var centerBtn = (0, $eWjiX.BB).el({\n            parent: buttonRow,\n            tagName: \"button\",\n            content: (0, $1mH1z.LANG)(\"center\"),\n            onClick: function() {\n                var t = freeTransform.getTransform();\n                freeTransform.setPos({\n                    x: context.canvas.width / 2,\n                    y: context.canvas.height / 2\n                });\n                freeTransform.setAngleDeg(t.angleDeg);\n                updatePreview();\n            },\n            css: actionBtnCss\n        });\n        var isConstrained = true;\n        var constrainCheckbox = new (0, $7bWhB.Checkbox)({\n            init: true,\n            label: (0, $1mH1z.LANG)(\"filter-transform-constrain\"),\n            title: (0, $1mH1z.LANG)(\"constrain-proportions\"),\n            allowTab: true,\n            callback: function callback(b) {\n                isConstrained = b;\n                freeTransform.setConstrained(isConstrained);\n            },\n            css: {\n                display: \"inline-block\"\n            }\n        });\n        var isSnapping = false;\n        var snappingCheckbox = new (0, $7bWhB.Checkbox)({\n            init: true,\n            label: (0, $1mH1z.LANG)(\"filter-transform-snap\"),\n            title: (0, $1mH1z.LANG)(\"filter-transform-snap-title\"),\n            allowTab: true,\n            callback: function callback(b) {\n                isSnapping = b;\n                freeTransform.setSnapping(isSnapping);\n            },\n            css: {\n                display: \"inline-block\",\n                marginLeft: \"10px\"\n            }\n        });\n        var checkboxWrapper = (0, $eWjiX.BB).el();\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\n        div.append((0, $eWjiX.BB).el({\n            css: {\n                clear: \"both\",\n                height: \"10px\"\n            }\n        }));\n        var bottomRow = (0, $eWjiX.BB).el({\n            parent: div,\n            css: {\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                alignItems: \"center\"\n            }\n        });\n        var algorithmSelect = new (0, $eEL9N.Select)({\n            isFocusable: true,\n            optionArr: [\n                [\n                    \"smooth\",\n                    (0, $1mH1z.LANG)(\"algorithm-smooth\")\n                ],\n                [\n                    \"pixelated\",\n                    (0, $1mH1z.LANG)(\"algorithm-pixelated\")\n                ]\n            ],\n            initValue: \"smooth\",\n            title: (0, $1mH1z.LANG)(\"scaling-algorithm\"),\n            onChange: function() {\n                updatePreview(true);\n            }\n        });\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\n        var previewWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper\",\n            css: {\n                width: isSmall ? \"340px\" : \"540px\",\n                height: isSmall ? \"260px\" : \"300px\"\n            }\n        });\n        previewWrapper.oncontextmenu = function() {\n            return false;\n        };\n        var previewLayerArr = [];\n        for(var i = 0; i < layers.length; i++){\n            var canvas = void 0;\n            if (i === selectedLayerIndex) {\n                canvas = (0, $eWjiX.BB).canvas(parseInt(\"\" + w), parseInt(\"\" + h));\n                var ctx = (0, $eWjiX.BB).ctx(canvas);\n                ctx.drawImage(layers[i].context.canvas, 0, 0, canvas.width, canvas.height);\n            } else canvas = layers[i].context.canvas;\n            previewLayerArr.push({\n                image: canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr\n            });\n        }\n        var klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n            width: parseInt(\"\" + displayW),\n            height: parseInt(\"\" + displayH),\n            layers: previewLayerArr\n        });\n        var previewInnerWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper__canvas\",\n            css: {\n                width: parseInt(\"\" + displayW) + \"px\",\n                height: parseInt(\"\" + displayH) + \"px\"\n            }\n        });\n        previewInnerWrapper.append(klCanvasPreview.getElement());\n        previewWrapper.append(previewInnerWrapper);\n        var lastDrawnTransformStr = \"\";\n        var freeTransform = new (0, $cNhNm.FreeTransform)({\n            x: initTransform.x,\n            y: initTransform.y,\n            width: initTransform.width,\n            height: initTransform.height,\n            angleDeg: initTransform.angleDeg,\n            isConstrained: true,\n            snapX: [\n                0,\n                context.canvas.width\n            ],\n            snapY: [\n                0,\n                context.canvas.height\n            ],\n            callback: function callback(t) {\n                inputX.value = \"\" + Math.round(t.x - initTransform.x);\n                inputY.value = \"\" + Math.round(t.y - initTransform.y);\n                inputR.value = \"\" + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            scale: displayPreviewFactor\n        });\n        (0, $eWjiX.BB).css(freeTransform.getElement(), {\n            position: \"absolute\",\n            left: \"0\",\n            top: \"0\"\n        });\n        previewInnerWrapper.append(freeTransform.getElement());\n        updatePreview();\n        div.append(previewWrapper);\n        result.destroy = function() {\n            keyListener.destroy();\n            freeTransform.destroy();\n            constrainCheckbox.destroy();\n            snappingCheckbox.destroy();\n            (0, $eWjiX.BB).destroyEl(flipXBtn);\n            (0, $eWjiX.BB).destroyEl(flipYBtn);\n            (0, $eWjiX.BB).destroyEl(scaleRotLeftBtn);\n            (0, $eWjiX.BB).destroyEl(scaleRotRightBtn);\n            (0, $eWjiX.BB).destroyEl(scaleDoubleBtn);\n            (0, $eWjiX.BB).destroyEl(scaleHalfBtn);\n            (0, $eWjiX.BB).destroyEl(centerBtn);\n            klCanvasPreview.destroy();\n        };\n        result.getInput = function() {\n            var transform = freeTransform.getTransform();\n            var input = {\n                transform: transform,\n                bounds: boundsObj,\n                isPixelated: algorithmSelect.getValue() === \"pixelated\" || (0, $eWjiX.BB).testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height)\n            };\n            result.destroy();\n            return (0, $eWjiX.BB).copyObj(input);\n        };\n        return result;\n    },\n    apply: function(params) {\n        var context = params.context;\n        var history = params.history;\n        if (!context || !history) return false;\n        history.pause(true);\n        var input = params.input;\n        var copyCanvas = (0, $eWjiX.BB).copyCanvas(context.canvas);\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        (0, $eWjiX.BB).drawTransformedImageWithBounds(context, copyCanvas, input.transform, input.bounds, input.isPixelated);\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"transform\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\n\nparcelRequire.register(\"1CjeM\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterBlur\", function () { return $95b95646154e8218$export$55e7eb2ebd0db869; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $cH2YE = parcelRequire(\"cH2YE\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $a5EFw = parcelRequire(\"a5EFw\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $95b95646154e8218$export$55e7eb2ebd0db869 = {\n    getDialog: function(params) {\n        var finishInit = function finishInit() {\n            var radius = 10;\n            div.innerHTML = (0, $1mH1z.LANG)(\"filter-triangle-blur-description\") + \"<br/><br/>\";\n            var fxCanvas = (0, $a5EFw.getSharedFx)();\n            if (!fxCanvas) return; // todo throw?\n            var texture = fxCanvas.texture(tempCanvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            var radiusSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"radius\"),\n                width: 300,\n                height: 30,\n                min: 1,\n                max: 200,\n                value: radius,\n                eventResMs: (0, $cH2YE.eventResMs),\n                onChange: function(val) {\n                    radius = val;\n                    fxCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\n                    klCanvasPreview.render();\n                }\n            });\n            div.append(radiusSlider.getElement());\n            var previewWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper\",\n                css: {\n                    width: \"340px\",\n                    height: \"220px\"\n                }\n            });\n            var previewLayerArr = [];\n            for(var i = 0; i < layers.length; i++)previewLayerArr.push({\n                image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr\n            });\n            var klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n                width: parseInt(\"\" + displayW),\n                height: parseInt(\"\" + displayH),\n                layers: previewLayerArr\n            });\n            var previewInnerWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper__canvas\",\n                css: {\n                    width: parseInt(\"\" + displayW) + \"px\",\n                    height: parseInt(\"\" + displayH) + \"px\"\n                }\n            });\n            previewInnerWrapper.append(klCanvasPreview.getElement());\n            previewWrapper.append(previewInnerWrapper);\n            div.append(previewWrapper);\n            try {\n                fxCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\n                klCanvasPreview.render();\n            } catch (e) {\n                div.errorCallback(e);\n            }\n            result.destroy = function() {\n                texture.destroy();\n                radiusSlider.destroy();\n                klCanvasPreview.destroy();\n            };\n            result.getInput = function() {\n                result.destroy();\n                return {\n                    radius: radius\n                };\n            };\n        };\n        var klCanvas = params.klCanvas;\n        var context = params.context;\n        if (!klCanvas || !context) return false;\n        var layers = klCanvas.getLayers();\n        var selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        var fit = (0, $eWjiX.BB).fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        var displayW = parseInt(\"\" + fit.width), displayH = parseInt(\"\" + fit.height);\n        var w = Math.min(displayW, context.canvas.width);\n        var h = Math.min(displayH, context.canvas.height);\n        var tempCanvas = (0, $eWjiX.BB).canvas(w, h);\n        {\n            var ctx = (0, $eWjiX.BB).ctx(tempCanvas);\n            ctx.save();\n            if (w > context.canvas.width) ctx.imageSmoothingEnabled = false;\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        var previewFactor = w / context.canvas.width;\n        var div = document.createElement(\"div\");\n        var result = {\n            element: div\n        };\n        setTimeout(finishInit, 1);\n        return result;\n    },\n    apply: function(params) {\n        var context = params.context;\n        var history = params.history;\n        var radius = params.input.radius;\n        if (!context || !radius || !history) return false;\n        history.pause(true);\n        var fxCanvas = (0, $a5EFw.getSharedFx)();\n        if (!fxCanvas) return false; // todo more specific error?\n        var texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).triangleBlur(radius).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"blur\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\n\nparcelRequire.register(\"dNWKZ\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterUnsharpMask\", function () { return $82f12ab116cea855$export$62ac74a5ea43bd5c; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $cH2YE = parcelRequire(\"cH2YE\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $a5EFw = parcelRequire(\"a5EFw\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\nvar $82f12ab116cea855$export$62ac74a5ea43bd5c = {\n    getDialog: function(params) {\n        var finishInit = function finishInit() {\n            var radius = 2, strength = 0.51;\n            div.innerHTML = (0, $1mH1z.LANG)(\"filter-unsharp-mask-description\") + \"<br/><br/>\";\n            var fxCanvas = (0, $a5EFw.getSharedFx)();\n            if (!fxCanvas) return; // todo throw?\n            var texture = fxCanvas.texture(tempCanvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            var radiusSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"radius\"),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 200,\n                value: 2,\n                eventResMs: (0, $cH2YE.eventResMs),\n                onChange: function onChange(val) {\n                    radius = val;\n                    fxCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\n                    klCanvasPreview.render();\n                },\n                curve: [\n                    [\n                        0,\n                        0\n                    ],\n                    [\n                        0.1,\n                        2\n                    ],\n                    [\n                        0.5,\n                        50\n                    ],\n                    [\n                        1,\n                        200\n                    ]\n                ]\n            });\n            var strengthSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"filter-unsharp-mask-strength\"),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 50,\n                value: 5.1,\n                eventResMs: (0, $cH2YE.eventResMs),\n                onChange: function onChange(val) {\n                    strength = val / 10;\n                    fxCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\n                    klCanvasPreview.render();\n                },\n                curve: [\n                    [\n                        0,\n                        0\n                    ],\n                    [\n                        0.1,\n                        2\n                    ],\n                    [\n                        0.5,\n                        10\n                    ],\n                    [\n                        1,\n                        50\n                    ]\n                ]\n            });\n            radiusSlider.getElement().style.marginBottom = \"10px\";\n            div.append(radiusSlider.getElement());\n            div.append(strengthSlider.getElement());\n            var previewWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper\",\n                css: {\n                    width: \"340px\",\n                    height: \"220px\"\n                }\n            });\n            var previewLayerArr = [];\n            for(var i = 0; i < layers.length; i++)previewLayerArr.push({\n                image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr\n            });\n            var klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n                width: parseInt(\"\" + displayW),\n                height: parseInt(\"\" + displayH),\n                layers: previewLayerArr\n            });\n            var previewInnerWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper__canvas\",\n                css: {\n                    width: parseInt(\"\" + displayW) + \"px\",\n                    height: parseInt(\"\" + displayH) + \"px\"\n                }\n            });\n            previewInnerWrapper.append(klCanvasPreview.getElement());\n            previewWrapper.append(previewInnerWrapper);\n            div.append(previewWrapper);\n            try {\n                fxCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\n                klCanvasPreview.render();\n            } catch (e) {\n                div.errorCallback(e);\n            }\n            result.destroy = function() {\n                radiusSlider.destroy();\n                strengthSlider.destroy();\n                texture.destroy();\n                klCanvasPreview.destroy();\n            };\n            result.getInput = function() {\n                result.destroy();\n                return {\n                    radius: radius,\n                    strength: strength\n                };\n            };\n        };\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        var layers = klCanvas.getLayers();\n        var selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        var fit = (0, $eWjiX.BB).fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        var displayW = parseInt(\"\" + fit.width), displayH = parseInt(\"\" + fit.height);\n        var w = Math.min(displayW, context.canvas.width);\n        var h = Math.min(displayH, context.canvas.height);\n        var tempCanvas = (0, $eWjiX.BB).canvas(w, h);\n        {\n            var ctx = (0, $eWjiX.BB).ctx(tempCanvas);\n            ctx.save();\n            if (w > context.canvas.width) ctx.imageSmoothingEnabled = false;\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        var previewFactor = w / context.canvas.width;\n        var div = document.createElement(\"div\");\n        var result = {\n            element: div\n        };\n        setTimeout(finishInit, 1);\n        return result;\n    },\n    apply: function(params) {\n        var context = params.context;\n        var history = params.history;\n        var radius = params.input.radius;\n        var strength = params.input.strength;\n        if (!context || radius === null || strength === null || !history) return false;\n        history.pause(true);\n        var fxCanvas = (0, $a5EFw.getSharedFx)();\n        if (!fxCanvas) return false; // todo more specific error?\n        var texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).unsharpMask(radius, strength).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"unsharpMask\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\n\nparcelRequire.register(\"94Tq7\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterToAlpha\", function () { return $a535e7a374deb8f5$export$6158ed2b22ebf4d9; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $iFIyy = parcelRequire(\"iFIyy\");\n\nvar $43qNf = parcelRequire(\"43qNf\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $a5EFw = parcelRequire(\"a5EFw\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $a535e7a374deb8f5$export$6158ed2b22ebf4d9 = {\n    getDialog: function(params) {\n        var finishInit = function finishInit() {\n            div.append((0, $eWjiX.BB).el({\n                content: (0, $1mH1z.LANG)(\"filter-to-alpha-description\"),\n                css: {\n                    marginBottom: \"5px\"\n                }\n            }));\n            var fxCanvas = (0, $7jh4K.throwIfNull)((0, $a5EFw.getSharedFx)());\n            if (!fxCanvas) return; // todo throw?\n            var texture = fxCanvas.texture(tempCanvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            function updatePreview() {\n                fxCanvas.draw(texture).toAlpha(sourceId === \"inverted-luminance\", selectedRgbaObj).update();\n                klCanvasPreview.render();\n            }\n            // source\n            var sourceId = \"inverted-luminance\";\n            var sourceOptions = new (0, $iFIyy.Options)({\n                optionArr: [\n                    {\n                        id: \"inverted-luminance\",\n                        label: (0, $1mH1z.LANG)(\"filter-to-alpha-inverted-lum\")\n                    },\n                    {\n                        id: \"luminance\",\n                        label: (0, $1mH1z.LANG)(\"filter-to-alpha-lum\")\n                    }\n                ],\n                initId: sourceId,\n                onChange: function onChange(id) {\n                    sourceId = id;\n                    updatePreview();\n                }\n            });\n            div.append(sourceOptions.getElement());\n            // color\n            var selectedRgbaObj = {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 1\n            };\n            var colorOptionsArr = [\n                null,\n                {\n                    r: 0,\n                    g: 0,\n                    b: 0,\n                    a: 1\n                },\n                {\n                    r: 255,\n                    g: 255,\n                    b: 255,\n                    a: 1\n                },\n                {\n                    r: params.currentColorRgb.r,\n                    g: params.currentColorRgb.g,\n                    b: params.currentColorRgb.b,\n                    a: 1\n                },\n                {\n                    r: params.secondaryColorRgb.r,\n                    g: params.secondaryColorRgb.g,\n                    b: params.secondaryColorRgb.b,\n                    a: 1\n                }\n            ];\n            var colorOptions = new (0, $43qNf.ColorOptions)({\n                label: (0, $1mH1z.LANG)(\"filter-to-alpha-replace\"),\n                colorArr: colorOptionsArr,\n                initialIndex: 1,\n                onChange: function onChange(rgbaObj) {\n                    selectedRgbaObj = rgbaObj;\n                    updatePreview();\n                }\n            });\n            colorOptions.getElement().style.marginTop = \"10px\";\n            div.append(colorOptions.getElement());\n            var previewWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper\",\n                css: {\n                    width: \"340px\",\n                    height: \"220px\"\n                }\n            });\n            var previewLayerArr = [];\n            for(var i = 0; i < layers.length; i++)previewLayerArr.push({\n                image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr\n            });\n            var klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n                width: parseInt(\"\" + w),\n                height: parseInt(\"\" + h),\n                layers: previewLayerArr\n            });\n            var previewInnerWrapper = (0, $eWjiX.BB).el({\n                className: \"kl-preview-wrapper__canvas\",\n                css: {\n                    width: parseInt(\"\" + w) + \"px\",\n                    height: parseInt(\"\" + h) + \"px\"\n                }\n            });\n            previewInnerWrapper.append(klCanvasPreview.getElement());\n            previewWrapper.append(previewInnerWrapper);\n            div.append(previewWrapper);\n            setTimeout(function() {\n                try {\n                    updatePreview();\n                } catch (e) {\n                    div.errorCallback(e);\n                }\n            }, 1);\n            result.destroy = function() {\n                texture.destroy();\n                sourceOptions.destroy();\n                klCanvasPreview.destroy();\n            };\n            result.getInput = function() {\n                result.destroy();\n                return {\n                    sourceId: sourceId,\n                    selectedRgbaObj: selectedRgbaObj\n                };\n            };\n        };\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        var layers = klCanvas.getLayers();\n        var selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        var fit = (0, $eWjiX.BB).fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        var w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        var tempCanvas = (0, $eWjiX.BB).canvas(w, h);\n        {\n            var ctx = (0, $eWjiX.BB).ctx(tempCanvas);\n            ctx.save();\n            if (tempCanvas.width > context.canvas.width) ctx.imageSmoothingEnabled = false;\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            ctx.restore();\n        }\n        var div = document.createElement(\"div\");\n        var result = {\n            element: div\n        };\n        setTimeout(finishInit, 1);\n        return result;\n    },\n    apply: function(params) {\n        var context = params.context;\n        var history = params.history;\n        var sourceId = params.input.sourceId;\n        var selectedRgbaObj = params.input.selectedRgbaObj;\n        if (!context || !sourceId || !history) return false;\n        history.pause(true);\n        var fxCanvas = (0, $a5EFw.getSharedFx)();\n        if (!fxCanvas) return false; // todo more specific error?\n        var texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).toAlpha(sourceId === \"inverted-luminance\", selectedRgbaObj).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"toAlpha\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\n\nparcelRequire.register(\"d8Fqy\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterGrid\", function () { return $bad33651972f8d2c$export$50020de79e1bc23; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $dJPtW = parcelRequire(\"dJPtW\");\n\nvar $43qNf = parcelRequire(\"43qNf\");\n\nvar $1xi6g = parcelRequire(\"1xi6g\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $bad33651972f8d2c$export$50020de79e1bc23 = {\n    getDialog: function(params) {\n        var updatePreview = function updatePreview() {\n            var ctx = (0, $eWjiX.BB).ctx(previewLayer.image);\n            ctx.save();\n            ctx.clearRect(0, 0, renderW, renderH);\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\n            (0, $1xi6g.drawGrid)(ctx, settingsObj.x, settingsObj.y, Math.max(settingsObj.thickness * renderFactor, 1), settingsObj.color, settingsObj.opacity);\n            ctx.restore();\n            klCanvasPreview.render();\n        };\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        var layers = klCanvas.getLayers();\n        var selectedLayerIndex = (0, $7jh4K.throwIfNull)(klCanvas.getLayerIndex(context.canvas));\n        var fit = (0, $eWjiX.BB).fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        var w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        var renderW = Math.min(w, context.canvas.width);\n        var renderH = Math.min(h, context.canvas.height);\n        var renderFactor = renderW / context.canvas.width;\n        var div = document.createElement(\"div\");\n        var result = {\n            element: div\n        };\n        div.innerHTML = (0, $1mH1z.LANG)(\"filter-grid-description\") + \"<br/><br/>\";\n        var settingsObj = {\n            x: 2,\n            y: 2,\n            thickness: 2,\n            color: \"#000\",\n            opacity: 1\n        };\n        var line1 = (0, $eWjiX.BB).el({\n            parent: div,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\"\n            }\n        });\n        var line2 = (0, $eWjiX.BB).el({\n            parent: div,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                marginTop: \"10px\"\n            }\n        });\n        var xInput = (0, $dJPtW.input)({\n            init: 2,\n            type: \"number\",\n            min: 1,\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function callback(v) {\n                settingsObj.x = parseFloat(v);\n                updatePreview();\n            }\n        });\n        var yInput = (0, $dJPtW.input)({\n            init: 2,\n            type: \"number\",\n            min: 1,\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function callback(v) {\n                settingsObj.y = parseFloat(v);\n                updatePreview();\n            }\n        });\n        var thicknessInput = (0, $dJPtW.input)({\n            init: 2,\n            type: \"number\",\n            min: 1,\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function callback(v) {\n                settingsObj.thickness = parseFloat(v);\n                updatePreview();\n            }\n        });\n        var selectedRgbaObj = {\n            r: 0,\n            g: 0,\n            b: 0,\n            a: 1\n        };\n        var colorOptionsArr = [\n            {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 1\n            },\n            {\n                r: 255,\n                g: 255,\n                b: 255,\n                a: 1\n            }\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1\n        });\n        settingsObj.color = (0, $eWjiX.BB).ColorConverter.toRgbStr(selectedRgbaObj);\n        var colorOptions = new (0, $43qNf.ColorOptions)({\n            label: (0, $1mH1z.LANG)(\"shape-stroke\"),\n            colorArr: colorOptionsArr,\n            onChange: function onChange(rgbaObj) {\n                selectedRgbaObj = rgbaObj;\n                settingsObj.color = (0, $eWjiX.BB).ColorConverter.toRgbStr(selectedRgbaObj);\n                updatePreview();\n            }\n        });\n        var labelStyle = {\n            display: \"inline-block\",\n            marginRight: \"5px\"\n        };\n        line1.append((0, $eWjiX.BB).el({\n            content: \"X:\",\n            css: labelStyle\n        }), xInput, (0, $eWjiX.BB).el({\n            content: \"Y:\",\n            css: labelStyle\n        }), yInput);\n        line2.append((0, $eWjiX.BB).el({\n            content: (0, $1mH1z.LANG)(\"shape-line-width\") + \":\",\n            css: labelStyle\n        }), thicknessInput, (0, $eWjiX.BB).el({\n            css: {\n                flexGrow: \"1\"\n            }\n        }), colorOptions.getElement());\n        var previewWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper\",\n            css: {\n                width: \"340px\",\n                height: \"220px\"\n            }\n        });\n        var previewLayer = {\n            image: (0, $eWjiX.BB).canvas(renderW, renderH),\n            isVisible: layers[selectedLayerIndex].isVisible,\n            opacity: layers[selectedLayerIndex].opacity,\n            mixModeStr: layers[selectedLayerIndex].mixModeStr\n        };\n        var klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: layers.map(function(item, i) {\n                if (i === selectedLayerIndex) return previewLayer;\n                else return {\n                    image: item.context.canvas,\n                    isVisible: item.isVisible,\n                    opacity: item.opacity,\n                    mixModeStr: item.mixModeStr\n                };\n            })\n        });\n        var previewInnerWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper__canvas\",\n            css: {\n                width: parseInt(\"\" + w) + \"px\",\n                height: parseInt(\"\" + h) + \"px\"\n            }\n        });\n        previewInnerWrapper.append(klCanvasPreview.getElement());\n        previewWrapper.append(previewInnerWrapper);\n        setTimeout(updatePreview, 0);\n        div.append(previewWrapper);\n        result.destroy = function() {\n            klCanvasPreview.destroy();\n            colorOptions.destroy();\n        };\n        result.getInput = function() {\n            result.destroy();\n            return (0, $eWjiX.BB).copyObj(settingsObj);\n        };\n        return result;\n    },\n    apply: function(params) {\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        var history = params.history;\n        if (!context || !klCanvas || !history) return false;\n        history.pause(true);\n        (0, $1xi6g.drawGrid)(context, params.input.x, params.input.y, params.input.thickness, params.input.color, params.input.opacity);\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"grid\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\nparcelRequire.register(\"1xi6g\", function(module, exports) {\n\n$parcel$export(module.exports, \"drawGrid\", function () { return $74df8e8cd35bce4e$export$20d2db9c68afeac; });\n// ideas: padding, gutter, other shapes\nfunction $74df8e8cd35bce4e$export$20d2db9c68afeac(ctx, cellsX, cellsY, thickness, color, opacity) {\n    ctx.save();\n    var w = ctx.canvas.width;\n    var h = ctx.canvas.height;\n    thickness = Math.round(thickness);\n    var thickIsRound = thickness % 2 === 0;\n    ctx.beginPath();\n    ctx.lineWidth = thickness;\n    ctx.strokeStyle = color;\n    ctx.globalAlpha = opacity;\n    for(var i = 0; i < cellsX - 1; i++){\n        var cw = w / cellsX;\n        var pos = cw * (i + 1);\n        if (thickIsRound) pos = Math.round(pos);\n        else pos = Math.round(pos + 0.5) - 0.5;\n        ctx.moveTo(pos, 0);\n        ctx.lineTo(pos, h);\n    }\n    for(var i1 = 0; i1 < cellsY - 1; i1++){\n        var ch = h / cellsY;\n        var pos1 = ch * (i1 + 1);\n        if (thickIsRound) pos1 = Math.round(pos1);\n        else pos1 = Math.round(pos1 + 0.5) - 0.5;\n        ctx.moveTo(0, pos1);\n        ctx.lineTo(w, pos1);\n    }\n    ctx.stroke();\n    ctx.restore();\n}\n\n});\n\n\nparcelRequire.register(\"gtdB1\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterNoise\", function () { return $595c9469b8f94062$export$1dab0536099042f5; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $a5EFw = parcelRequire(\"a5EFw\");\n\nvar $iFIyy = parcelRequire(\"iFIyy\");\n\nvar $cH2YE = parcelRequire(\"cH2YE\");\n\nvar $eEL9N = parcelRequire(\"eEL9N\");\n\nvar $bBcC4 = parcelRequire(\"bBcC4\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $dJ1E2 = parcelRequire(\"dJ1E2\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\n/*export type TFilterNoiseHistoryEntry = TFilterHistoryEntry<\r\n    'replaceLayer',\r\n    TFilterNoiseInput>;*/ var $595c9469b8f94062$var$presetArr = [\n    // each pixel random value\n    {\n        type: 0,\n        scaleX: 1,\n        scaleY: 1,\n        offsetX: 0,\n        offsetY: 0,\n        octaves: 1,\n        samples: 1,\n        peaks: 0,\n        brightness: 0,\n        contrast: 0,\n        isReversed: true\n    },\n    // cloud\n    {\n        type: 1,\n        scaleX: 166,\n        scaleY: 164,\n        offsetX: 105,\n        offsetY: 30,\n        octaves: 6,\n        samples: 1,\n        peaks: 0,\n        brightness: 0.055,\n        contrast: 0.23,\n        isReversed: true\n    },\n    // thin lines\n    {\n        type: 1,\n        scaleX: 235,\n        scaleY: 190,\n        offsetX: 3227,\n        offsetY: 2156,\n        octaves: 4,\n        samples: 16,\n        peaks: 22,\n        brightness: -0.375,\n        contrast: 1,\n        isReversed: false\n    },\n    // soft large simplex, only 1 octave\n    {\n        type: 1,\n        scaleX: 40,\n        scaleY: 40,\n        offsetX: 0,\n        offsetY: 0,\n        octaves: 1,\n        samples: 1,\n        peaks: 0,\n        brightness: 0,\n        contrast: 0,\n        isReversed: false\n    },\n    // two value large pixels\n    {\n        type: 0,\n        scaleX: 26,\n        scaleY: 26,\n        offsetX: 557,\n        offsetY: 365,\n        octaves: 1,\n        samples: 1,\n        peaks: 0,\n        brightness: 0.02,\n        contrast: 1,\n        isReversed: true\n    },\n    // zebra\n    {\n        type: 1,\n        scaleX: 1500,\n        scaleY: 1500,\n        offsetX: 745,\n        offsetY: 2871,\n        octaves: 5,\n        samples: 16,\n        peaks: 156.02,\n        brightness: 0.03,\n        contrast: 1,\n        isReversed: true\n    },\n    // sparse dots / stars\n    {\n        type: 1,\n        scaleX: 11,\n        scaleY: 11,\n        offsetX: 2940,\n        offsetY: 2045,\n        octaves: 1,\n        samples: 16,\n        peaks: 1,\n        brightness: -0.045,\n        contrast: 1,\n        isReversed: true\n    },\n    // pseudo marble\n    {\n        type: 2,\n        scaleX: 74,\n        scaleY: 74,\n        offsetX: 4816,\n        offsetY: 1304,\n        octaves: 3,\n        samples: 1,\n        peaks: 2.78,\n        brightness: 0,\n        contrast: 0,\n        isReversed: false\n    }\n];\nfunction $595c9469b8f94062$var$drawNoise(fxCanvas, settings) {\n    fxCanvas.noise(settings.seed, settings.type, [\n        settings.scaleX,\n        settings.scaleY\n    ], [\n        fxCanvas.width / 2,\n        fxCanvas.height / 2\n    ], settings.octaves, settings.samples, settings.peaks, settings.brightness, settings.contrast, settings.isReversed, settings.colA, settings.colB, settings.channels ? settings.channels : \"rgb\").update();\n}\nvar $595c9469b8f94062$export$1dab0536099042f5 = {\n    getDialog: function(params) {\n        var updatePreview = function updatePreview() {\n            var ctx = (0, $eWjiX.BB).ctx(previewLayer.image);\n            ctx.save();\n            ctx.clearRect(0, 0, renderW, renderH);\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\n            ctx.globalAlpha = settingsObj.opacity;\n            var presetCopy = (0, $eWjiX.BB).copyObj($595c9469b8f94062$var$presetArr[settingsObj.presetIndex]);\n            presetCopy.seed = settingsObj.seed;\n            presetCopy.scaleX = presetCopy.scaleX * settingsObj.scale / 50 * renderFactor;\n            presetCopy.scaleY = presetCopy.scaleY * settingsObj.scale / 50 * renderFactor;\n            presetCopy.colA = settingsObj.colA;\n            presetCopy.colB = settingsObj.colB;\n            presetCopy.isReversed = settingsObj.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\n            presetCopy.channels = settingsObj.channels;\n            $595c9469b8f94062$var$drawNoise(fxCanvas, presetCopy);\n            if (settingsObj.channels === \"alpha\") ctx.globalCompositeOperation = \"destination-out\";\n            else ctx.globalCompositeOperation = settingsObj.mixModeStr;\n            ctx.drawImage(fxCanvas, 0, 0);\n            ctx.restore();\n            klCanvasPreview.render();\n        };\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        var layers = klCanvas.getLayers();\n        var selectedLayerIndex = (0, $7jh4K.throwIfNull)(klCanvas.getLayerIndex(context.canvas));\n        var fit = (0, $eWjiX.BB).fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        var w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        var renderW = Math.min(w, context.canvas.width);\n        var renderH = Math.min(h, context.canvas.height);\n        var renderFactor = renderW / context.canvas.width;\n        var fxCanvas = (0, $7jh4K.throwIfNull)((0, $a5EFw.getSharedFx)());\n        var texture;\n        var thumbImgArr = [];\n        var thumbSize = 32;\n        {\n            var canvas = (0, $eWjiX.BB).canvas(thumbSize, thumbSize);\n            var ctx = (0, $eWjiX.BB).ctx(canvas);\n            texture = fxCanvas.texture(canvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            texture.destroy();\n            $595c9469b8f94062$var$presetArr.forEach(function(preset) {\n                var thumbImg = new Image();\n                var presetCopy = (0, $eWjiX.BB).copyObj(preset);\n                presetCopy.scaleX /= 10;\n                presetCopy.scaleY /= 10;\n                $595c9469b8f94062$var$drawNoise(fxCanvas, presetCopy);\n                ctx.drawImage(fxCanvas, 0, 0);\n                thumbImg.src = canvas.toDataURL(\"image/png\");\n                thumbImgArr.push(thumbImg);\n            });\n        }\n        {\n            var tempCanvas = (0, $eWjiX.BB).canvas(renderW, renderH);\n            texture = fxCanvas.texture(tempCanvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            (0, $eWjiX.BB).freeCanvas(tempCanvas);\n        }\n        var div = document.createElement(\"div\");\n        var result = {\n            element: div\n        };\n        div.innerHTML = (0, $1mH1z.LANG)(\"filter-noise-description\") + \"<br/><br/>\";\n        var settingsObj = {\n            seed: Math.random() * 300,\n            presetIndex: 0,\n            scale: 50,\n            opacity: 0.5,\n            isReversed: false,\n            channels: \"rgb\",\n            mixModeStr: \"source-over\",\n            colA: {\n                r: 0,\n                g: 0,\n                b: 0\n            },\n            colB: {\n                r: 255,\n                g: 255,\n                b: 255\n            }\n        };\n        var presetOptions = new (0, $iFIyy.Options)({\n            optionArr: thumbImgArr.map(function(img, index) {\n                (0, $eWjiX.BB).css(img, {\n                    margin: \"1px\",\n                    borderRadius: \"3px\",\n                    transition: \"all 0.1s ease-in-out\"\n                });\n                return {\n                    id: \"\" + index,\n                    label: img\n                };\n            }),\n            initId: \"0\",\n            onChange: function(id) {\n                settingsObj.presetIndex = Number(id);\n                updatePreview();\n            }\n        });\n        presetOptions.getElement().style.marginBottom = \"10px\";\n        div.append(presetOptions.getElement());\n        var scaleSlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"filter-noise-scale\"),\n            width: 300,\n            height: 30,\n            min: 1,\n            max: 1000,\n            value: settingsObj.scale,\n            eventResMs: (0, $cH2YE.eventResMs),\n            curve: (0, $eWjiX.BB).quadraticSplineInput(1, 1000, 0.1),\n            onChange: function(value) {\n                settingsObj.scale = value;\n                updatePreview();\n            }\n        });\n        scaleSlider.getElement().style.marginBottom = \"10px\";\n        var opacitySlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"opacity\"),\n            width: 300,\n            height: 30,\n            min: 0.01,\n            max: 1,\n            value: settingsObj.opacity,\n            eventResMs: (0, $cH2YE.eventResMs),\n            toValue: function(displayValue) {\n                return displayValue / 100;\n            },\n            toDisplayValue: function(value) {\n                return value * 100;\n            },\n            onChange: function(value) {\n                settingsObj.opacity = value;\n                updatePreview();\n            }\n        });\n        opacitySlider.getElement().style.marginBottom = \"10px\";\n        var row1El = (0, $eWjiX.BB).el({\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                marginBottom: \"10px\"\n            }\n        });\n        var row2El = (0, $eWjiX.BB).el({\n            css: {\n                display: \"flex\"\n            }\n        });\n        var channelsOptions = new (0, $iFIyy.Options)({\n            optionArr: [\n                {\n                    id: \"rgb\",\n                    label: \"RGB\"\n                },\n                {\n                    id: \"alpha\",\n                    label: (0, $1mH1z.LANG)(\"filter-noise-alpha\")\n                }\n            ],\n            initId: \"rgb\",\n            onChange: function(id) {\n                settingsObj.channels = id;\n                if (id === \"rgb\") row2El.style.visibility = \"\";\n                else row2El.style.visibility = \"hidden\";\n                updatePreview();\n            }\n        });\n        var reverseToggle = new (0, $7bWhB.Checkbox)({\n            label: (0, $1mH1z.LANG)(\"reverse\"),\n            callback: function(val) {\n                settingsObj.isReversed = val;\n                updatePreview();\n            },\n            allowTab: true\n        });\n        var mixModes = [\n            \"source-over\",\n            undefined,\n            \"darken\",\n            \"multiply\",\n            \"color-burn\",\n            undefined,\n            \"lighten\",\n            \"screen\",\n            \"color-dodge\",\n            undefined,\n            \"overlay\",\n            \"soft-light\",\n            \"hard-light\",\n            undefined,\n            \"difference\",\n            \"exclusion\",\n            undefined,\n            \"hue\",\n            \"saturation\",\n            \"color\",\n            \"luminosity\"\n        ];\n        var blendSelect = new (0, $eEL9N.Select)({\n            isFocusable: true,\n            optionArr: mixModes.map(function(item) {\n                return item ? [\n                    item,\n                    (0, $bBcC4.translateBlending)(item)\n                ] : undefined;\n            }),\n            initValue: settingsObj.mixModeStr,\n            onChange: function(val) {\n                settingsObj.mixModeStr = val;\n                updatePreview();\n            }\n        });\n        blendSelect.getElement().title = (0, $1mH1z.LANG)(\"layers-blending\");\n        var colorWrapper = (0, $eWjiX.BB).el({\n            css: {\n                display: \"flex\"\n            }\n        });\n        var colInputStyle = {\n            width: \"34px\",\n            height: \"34px\",\n            marginRight: \"5px\"\n        };\n        var colAInput = (0, $hrnUX.KL).input({\n            type: \"color\",\n            init: \"#\" + (0, $dJ1E2.ColorConverter).toHexString(settingsObj.colA),\n            callback: function(val) {\n                var newColor = (0, $dJ1E2.ColorConverter).hexToRGB(val);\n                if (newColor) {\n                    settingsObj.colA = newColor;\n                    updatePreview();\n                }\n            },\n            css: colInputStyle\n        });\n        var colBInput = (0, $hrnUX.KL).input({\n            type: \"color\",\n            init: \"#\" + (0, $dJ1E2.ColorConverter).toHexString(settingsObj.colB),\n            callback: function(val) {\n                var newColor = (0, $dJ1E2.ColorConverter).hexToRGB(val);\n                if (newColor) {\n                    settingsObj.colB = newColor;\n                    updatePreview();\n                }\n            },\n            css: colInputStyle\n        });\n        colorWrapper.append(colAInput, colBInput);\n        row1El.append(channelsOptions.getElement(), (0, $eWjiX.BB).el({\n            css: {\n                flexGrow: \"1\"\n            }\n        }), reverseToggle.getElement());\n        row2El.append(blendSelect.getElement(), (0, $eWjiX.BB).el({\n            css: {\n                flexGrow: \"1\"\n            }\n        }), colorWrapper);\n        div.append(scaleSlider.getElement(), opacitySlider.getElement(), row1El, row2El);\n        var previewWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper\",\n            css: {\n                width: \"340px\",\n                height: \"220px\"\n            }\n        });\n        var previewLayer = {\n            image: (0, $eWjiX.BB).canvas(renderW, renderH),\n            isVisible: layers[selectedLayerIndex].isVisible,\n            opacity: layers[selectedLayerIndex].opacity,\n            mixModeStr: layers[selectedLayerIndex].mixModeStr\n        };\n        var klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: layers.map(function(item, i) {\n                if (i === selectedLayerIndex) return previewLayer;\n                else return {\n                    image: item.context.canvas,\n                    isVisible: item.isVisible,\n                    opacity: item.opacity,\n                    mixModeStr: item.mixModeStr\n                };\n            })\n        });\n        var previewInnerWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper__canvas\",\n            css: {\n                width: parseInt(\"\" + w) + \"px\",\n                height: parseInt(\"\" + h) + \"px\"\n            }\n        });\n        previewInnerWrapper.append(klCanvasPreview.getElement());\n        previewWrapper.append(previewInnerWrapper);\n        setTimeout(updatePreview, 0);\n        div.append(previewWrapper);\n        result.destroy = function() {\n            presetOptions.destroy();\n            scaleSlider.destroy();\n            opacitySlider.destroy();\n            reverseToggle.destroy();\n            channelsOptions.destroy();\n            texture.destroy();\n            blendSelect.destroy();\n            klCanvasPreview.destroy();\n        };\n        result.getInput = function() {\n            result.destroy();\n            return (0, $eWjiX.BB).copyObj(settingsObj);\n        };\n        return result;\n    },\n    apply: function(params) {\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        var history = params.history;\n        if (!context || !klCanvas || !history) return false;\n        history.pause(true);\n        var fxCanvas = (0, $a5EFw.getSharedFx)();\n        if (!fxCanvas) return false; // todo more specific error?\n        var texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).update();\n        texture.destroy();\n        var input = params.input;\n        var presetCopy = (0, $eWjiX.BB).copyObj($595c9469b8f94062$var$presetArr[input.presetIndex]);\n        presetCopy.seed = input.seed;\n        presetCopy.scaleX = presetCopy.scaleX * input.scale / 50;\n        presetCopy.scaleY = presetCopy.scaleY * input.scale / 50;\n        presetCopy.colA = input.colA;\n        presetCopy.colB = input.colB;\n        presetCopy.isReversed = input.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\n        presetCopy.channels = input.channels;\n        $595c9469b8f94062$var$drawNoise(fxCanvas, presetCopy);\n        context.save();\n        context.globalAlpha = input.opacity;\n        if (input.channels === \"alpha\") context.globalCompositeOperation = \"destination-out\";\n        else context.globalCompositeOperation = input.mixModeStr;\n        context.drawImage(fxCanvas, 0, 0);\n        context.restore();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"replaceLayer\",\n            params: [\n                klCanvas.getLayerIndex(context.canvas),\n                context.getImageData(0, 0, context.canvas.width, context.canvas.height)\n            ]\n        });\n        return true;\n    }\n};\n\n});\n\nparcelRequire.register(\"lQzx7\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterPattern\", function () { return $ebbf7e5d844153e5$export$5b48b77a483d9b33; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $dJPtW = parcelRequire(\"dJPtW\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $cH2YE = parcelRequire(\"cH2YE\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $5vheV = parcelRequire(\"5vheV\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\n/**\r\n * Draws pattern onto context. Pattern generated from context.\r\n * Can use blending for smoother transition. Will use area outside of bounds for blending.\r\n *\r\n * @param context\r\n * @param settings\r\n */ function $ebbf7e5d844153e5$var$drawPattern(context, settings) {\n    // keep bounds in center via offset\n    // because blending done towards bottom right\n    var blendOffsetX = settings.blend ? Math.round(settings.blend * settings.width / 2) : 0;\n    var blendOffsetY = settings.blend ? Math.round(settings.blend * settings.height / 2) : 0;\n    var finalPatternCanvas = (0, $eWjiX.BB).canvas(settings.width, settings.height);\n    if (settings.blend) {\n        // construct pattern via linear blending\n        var blendCanvas = (0, $eWjiX.BB).canvas(settings.width * 2, settings.height * 2);\n        var blendCtx = (0, $eWjiX.BB).ctx(blendCanvas);\n        var colTransparent = \"#0000\";\n        var colOpaque = \"#000\";\n        // transfer source to blendCanvas\n        blendCtx.drawImage(context.canvas, -settings.x + blendOffsetX, -settings.y + blendOffsetY);\n        // --- 1 cross-fade vertical ------------------------\n        // erase vertical gradient bottom half\n        blendCtx.save();\n        var blendGradient = blendCtx.createLinearGradient(0, settings.height, 0, settings.height * 2);\n        blendGradient.addColorStop(0, colOpaque);\n        blendGradient.addColorStop(settings.blend, colTransparent);\n        blendCtx.globalCompositeOperation = \"destination-in\";\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\n        blendCtx.restore();\n        // erase vertical gradient top half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(0, 0, 0, settings.height);\n        blendGradient.addColorStop(0, colTransparent);\n        blendGradient.addColorStop(settings.blend, colOpaque);\n        blendCtx.globalCompositeOperation = \"destination-in\";\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\n        blendCtx.restore();\n        // draw bottom half over top half\n        blendCtx.save();\n        // lighter needed for accurate cross-fade\n        blendCtx.globalCompositeOperation = \"lighter\";\n        blendCtx.drawImage(blendCanvas, 0, -settings.height);\n        blendCtx.restore();\n        // --- 2 cross-fade horizontal ------------------------\n        // erase horizontal gradient right half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(settings.width, 0, settings.width * 2, 0);\n        blendGradient.addColorStop(0, colOpaque);\n        blendGradient.addColorStop(settings.blend, colTransparent);\n        blendCtx.globalCompositeOperation = \"destination-in\";\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\n        blendCtx.restore();\n        // erase horizontal gradient left half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(0, 0, settings.width, 0);\n        blendGradient.addColorStop(0, colTransparent);\n        blendGradient.addColorStop(settings.blend, colOpaque);\n        blendCtx.globalCompositeOperation = \"destination-in\";\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\n        blendCtx.restore();\n        // draw right half over left half\n        blendCtx.save();\n        // lighter needed for accurate cross-fade\n        blendCtx.globalCompositeOperation = \"lighter\";\n        blendCtx.drawImage(blendCanvas, -settings.width, 0);\n        blendCtx.restore();\n        // transfer to pattern canvas\n        (0, $eWjiX.BB).ctx(finalPatternCanvas).drawImage(blendCanvas, 0, 0);\n    } else (0, $eWjiX.BB).ctx(finalPatternCanvas).drawImage(context.canvas, -settings.x, -settings.y);\n    context.save();\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n    context.translate(settings.offsetX - blendOffsetX, settings.offsetY - blendOffsetY);\n    context.fillStyle = (0, $7jh4K.throwIfNull)(context.createPattern(finalPatternCanvas, \"repeat\"));\n    context.fillRect(-settings.offsetX + blendOffsetX, -settings.offsetY + blendOffsetY, context.canvas.width, context.canvas.height);\n    context.restore();\n}\nvar $ebbf7e5d844153e5$export$5b48b77a483d9b33 = {\n    getDialog: function(params) {\n        var syncInputs = function syncInputs() {\n            xInput.value = \"\" + settings.x;\n            yInput.value = \"\" + settings.y;\n            widthInput.value = \"\" + settings.width;\n            heightInput.value = \"\" + settings.height;\n        };\n        var sharpStrokeRect = function sharpStrokeRect(context, x, y, width, height) {\n            var drawX = Math.round(x + 0.5) - 0.5;\n            var drawY = Math.round(y + 0.5) - 0.5;\n            var drawWidth = Math.round(x + width - drawX);\n            var drawHeight = Math.round(y + height - drawY);\n            context.strokeRect(drawX, drawY, drawWidth, drawHeight);\n        };\n        var updatePreview = function updatePreview(doForce) {\n            if (!doForce && lastDrawnSettings && JSON.stringify(lastDrawnSettings) === JSON.stringify(settings)) return;\n            if (previewMode === 0) {\n                fullSizeCtx.clearRect(0, 0, width, height);\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\n                var previewCanvas = previewLayer.image;\n                var previewCtx = (0, $eWjiX.BB).ctx(previewCanvas);\n                previewCtx.save();\n                previewCtx.clearRect(0, 0, renderW, renderH);\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\n                previewCtx.restore();\n                var pW = settings.width * previewFactor;\n                var pH = settings.height * previewFactor;\n                var overlayCtx = (0, $eWjiX.BB).ctx(overlayCanvas);\n                overlayCtx.save();\n                overlayCtx.clearRect(0, 0, w, h);\n                overlayCtx.strokeStyle = \"#fff\";\n                sharpStrokeRect(overlayCtx, settings.x * previewFactor, settings.y * previewFactor, pW, pH);\n                if (settings.blend > 0.05) {\n                    overlayCtx.strokeStyle = \"#f0f\";\n                    sharpStrokeRect(overlayCtx, settings.x * previewFactor - pW / 2 * settings.blend, settings.y * previewFactor - pH / 2 * settings.blend, pW * (1 + settings.blend), pH * (1 + settings.blend));\n                }\n                overlayCtx.restore();\n            } else {\n                fullSizeCtx.clearRect(0, 0, width, height);\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\n                $ebbf7e5d844153e5$var$drawPattern(fullSizeCtx, settings);\n                var previewCanvas1 = previewLayer.image;\n                var previewCtx1 = (0, $eWjiX.BB).ctx(previewCanvas1);\n                previewCtx1.clearRect(0, 0, renderW, renderH);\n                previewCtx1.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\n            }\n            klCanvasPreview.render();\n            lastDrawnSettings = (0, $eWjiX.BB).copyObj(settings);\n        };\n        var isSmall = window.innerWidth < 550;\n        var maxSize = 1024;\n        var rootEl = (0, $eWjiX.BB).el({\n            content: (0, $1mH1z.LANG)(\"filter-pattern-description\") + \"<br><br>\"\n        });\n        var context = params.context;\n        var width = context.canvas.width;\n        var height = context.canvas.height;\n        var settings = {\n            x: 0,\n            y: 0,\n            width: width <= 250 ? Math.round(width / 4) : 200,\n            height: height <= 250 ? Math.round(height / 4) : 200,\n            blend: 0,\n            offsetX: 0,\n            offsetY: 0\n        };\n        var lastDrawnSettings;\n        // determine bounds\n        var bounds = (0, $eWjiX.BB).canvasBounds(context);\n        // adjust settings according to bounds\n        if (bounds && bounds.width <= maxSize && bounds.height <= maxSize && // don't exceed max size\n        (bounds.width < width * 0.75 || bounds.height < height * 0.75 // aren't too large (heuristic)\n        )) {\n            settings.x = bounds.x;\n            settings.y = bounds.y;\n            settings.width = bounds.width;\n            settings.height = bounds.height;\n        } else {\n            settings.x = Math.round(width / 2 - settings.width / 2);\n            settings.y = Math.round(height / 2 - settings.height / 2);\n        }\n        // ---- controls ----\n        var xInput = (0, $dJPtW.input)({\n            init: settings.x,\n            type: \"number\",\n            min: 0,\n            max: width,\n            css: {\n                width: \"100%\"\n            },\n            callback: function callback(v) {\n                settings.x = Number(v);\n                updatePreview();\n            }\n        });\n        var yInput = (0, $dJPtW.input)({\n            init: settings.y,\n            type: \"number\",\n            min: 0,\n            max: height,\n            css: {\n                width: \"100%\"\n            },\n            callback: function callback(v) {\n                settings.y = Number(v);\n                updatePreview();\n            }\n        });\n        var widthInput = (0, $dJPtW.input)({\n            init: settings.width,\n            type: \"number\",\n            min: 1,\n            max: Math.min(maxSize, width),\n            css: {\n                width: \"100%\"\n            },\n            callback: function callback(v) {\n                settings.width = Number(v);\n                updatePreview();\n            }\n        });\n        var heightInput = (0, $dJPtW.input)({\n            init: settings.height,\n            type: \"number\",\n            min: 1,\n            max: Math.min(maxSize, height),\n            css: {\n                width: \"100%\"\n            },\n            callback: function callback(v) {\n                settings.height = Number(v);\n                updatePreview();\n            }\n        });\n        var inputStyle = {\n            marginLeft: \"5px\",\n            flex: \"1\"\n        };\n        rootEl.append((0, $eWjiX.BB).el({\n            content: [\n                (0, $eWjiX.BB).el({\n                    tagName: \"label\",\n                    content: [\n                        \"X:\",\n                        xInput\n                    ],\n                    css: inputStyle\n                }),\n                (0, $eWjiX.BB).el({\n                    tagName: \"label\",\n                    content: [\n                        \"Y:\",\n                        yInput\n                    ],\n                    css: inputStyle\n                }),\n                (0, $eWjiX.BB).el({\n                    tagName: \"label\",\n                    content: [\n                        (0, $1mH1z.LANG)(\"width\") + \":\",\n                        widthInput\n                    ],\n                    css: inputStyle\n                }),\n                (0, $eWjiX.BB).el({\n                    tagName: \"label\",\n                    content: [\n                        (0, $1mH1z.LANG)(\"height\") + \":\",\n                        heightInput\n                    ],\n                    css: inputStyle\n                })\n            ],\n            css: {\n                display: \"flex\",\n                marginLeft: \"-5px\"\n            }\n        }));\n        var blendSlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"brush-blending\"),\n            width: 300,\n            height: 30,\n            min: 0,\n            max: 1,\n            value: settings.blend,\n            eventResMs: (0, $cH2YE.eventResMs),\n            onChange: function onChange(val) {\n                settings.blend = val;\n                updatePreview();\n            },\n            formatFunc: function(val) {\n                return (0, $eWjiX.BB).round(val, 2);\n            },\n            manualInputRoundDigits: 2\n        });\n        (0, $eWjiX.BB).css(blendSlider.getElement(), {\n            margin: \"10px 0\"\n        });\n        rootEl.append(blendSlider.getElement());\n        // ---- preview tabs ----\n        var previewMode = 1; // 0 before, 1 after\n        var beforeAfterTabs = new (0, $5vheV.TwoTabs)({\n            left: (0, $1mH1z.LANG)(\"compare-before\"),\n            right: (0, $1mH1z.LANG)(\"compare-after\"),\n            init: previewMode,\n            onChange: function(val) {\n                previewMode = val;\n                overlayCanvas.style.display = val === 0 ? \"block\" : \"none\";\n                updatePreview(true);\n            }\n        });\n        rootEl.append(beforeAfterTabs.getElement());\n        // ---- previews ----\n        var klCanvas = params.klCanvas;\n        var layers = klCanvas.getLayers();\n        var selectedLayerIndex = (0, $7jh4K.throwIfNull)(klCanvas.getLayerIndex(context.canvas));\n        var fit = (0, $eWjiX.BB).fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\n        var w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        var renderW = Math.min(w, context.canvas.width);\n        var renderH = Math.min(h, context.canvas.height);\n        // const renderFactor = renderW / context.canvas.width;\n        var previewFactor = w / context.canvas.width;\n        var previewWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper\",\n            css: {\n                width: isSmall ? \"340px\" : \"540px\",\n                height: isSmall ? \"260px\" : \"300px\",\n                marginTop: \"0\"\n            }\n        });\n        var previewLayer = {\n            image: (0, $eWjiX.BB).canvas(renderW, renderH),\n            isVisible: layers[selectedLayerIndex].isVisible,\n            opacity: layers[selectedLayerIndex].opacity,\n            mixModeStr: layers[selectedLayerIndex].mixModeStr\n        };\n        var previewLayerArr = layers.map(function(item, i) {\n            if (i === selectedLayerIndex) return previewLayer;\n            else return {\n                image: item.context.canvas,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr\n            };\n        });\n        var klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: previewLayerArr\n        });\n        var overlayCanvas = (0, $eWjiX.BB).canvas(w, h);\n        (0, $eWjiX.BB).css(overlayCanvas, {\n            position: \"absolute\",\n            left: \"0\",\n            top: \"0\",\n            mixBlendMode: \"difference\",\n            imageRendering: \"pixelated\"\n        });\n        var previewInnerWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper__canvas\",\n            css: {\n                width: parseInt(\"\" + w) + \"px\",\n                height: parseInt(\"\" + h) + \"px\"\n            }\n        });\n        previewInnerWrapper.append(klCanvasPreview.getElement(), overlayCanvas);\n        previewWrapper.append(previewInnerWrapper);\n        rootEl.append(previewWrapper);\n        // ---- preview input processing ----\n        var inputs = {};\n        var keyListener = new (0, $eWjiX.BB).KeyListener({});\n        previewWrapper.oncontextmenu = function() {\n            return false;\n        };\n        previewInnerWrapper.style.touchAction = \"none\";\n        var pointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: previewInnerWrapper,\n            onPointer: function(event) {\n                if (previewMode === 0) {\n                    if (event.type === \"pointerdown\") {\n                        if (!inputs.state) {\n                            inputs.oldSettings = (0, $eWjiX.BB).copyObj(settings);\n                            var x = event.relX / previewFactor;\n                            var y = event.relY / previewFactor;\n                            if ((0, $eWjiX.BB).isInsideRect({\n                                x: x,\n                                y: y\n                            }, {\n                                x: settings.x,\n                                y: settings.y,\n                                width: settings.width,\n                                height: settings.height\n                            })) inputs.state = \"move\";\n                            else inputs.state = \"select\";\n                            inputs.start = {\n                                x: x,\n                                y: y\n                            };\n                        }\n                    } else if (event.type === \"pointermove\") {\n                        var x1 = event.relX / previewFactor;\n                        var y1 = event.relY / previewFactor;\n                        if (inputs.state === \"select\") {\n                            inputs.end = {\n                                x: x1,\n                                y: y1\n                            };\n                            var x11 = Math.max(0, Math.min(inputs.start.x, inputs.end.x));\n                            var y11 = Math.max(0, Math.min(inputs.start.y, inputs.end.y));\n                            var x2 = Math.min(width, Math.max(inputs.start.x, inputs.end.x));\n                            var y2 = Math.min(height, Math.max(inputs.start.y, inputs.end.y));\n                            settings.x = Math.floor(x11);\n                            settings.y = Math.floor(y11);\n                            settings.width = Math.min(maxSize, Math.ceil(x2 - settings.x));\n                            settings.height = Math.min(maxSize, Math.ceil(y2 - settings.y));\n                            if (keyListener.isPressed(\"shift\")) {\n                                settings.width = Math.min(settings.width, settings.height);\n                                settings.height = Math.min(settings.width, settings.height);\n                            }\n                            if (settings.width === 0 || settings.height === 0) settings = (0, $eWjiX.BB).copyObj(inputs.oldSettings);\n                            syncInputs();\n                            updatePreview();\n                        } else if (inputs.state === \"move\") {\n                            var dX = Math.round(x1 - inputs.start.x);\n                            var dY = Math.round(y1 - inputs.start.y);\n                            settings.x = (0, $eWjiX.BB).clamp(inputs.oldSettings.x + dX, 0, width - settings.width);\n                            settings.y = (0, $eWjiX.BB).clamp(inputs.oldSettings.y + dY, 0, height - settings.height);\n                            syncInputs();\n                            updatePreview();\n                        }\n                    } else if (event.type === \"pointerup\") {\n                        if (inputs.state) inputs.state = null;\n                    }\n                } else {\n                    if (event.type === \"pointerdown\") {\n                        if (!inputs.state) {\n                            inputs.state = \"move\";\n                            inputs.oldSettings = (0, $eWjiX.BB).copyObj(settings);\n                            inputs.start = {\n                                x: event.relX / previewFactor,\n                                y: event.relY / previewFactor\n                            };\n                            inputs.end = null;\n                        }\n                    } else if (event.type === \"pointermove\") {\n                        if (inputs.state) {\n                            inputs.end = {\n                                x: event.relX / previewFactor,\n                                y: event.relY / previewFactor\n                            };\n                            settings.offsetX = Math.round(inputs.end.x - inputs.start.x) + inputs.oldSettings.offsetX;\n                            settings.offsetY = Math.round(inputs.end.y - inputs.start.y) + inputs.oldSettings.offsetY;\n                            updatePreview();\n                        }\n                    } else if (event.type === \"pointerup\") {\n                        if (inputs.state) {\n                            if (!inputs.end) {\n                                settings.offsetX = 0;\n                                settings.offsetY = 0;\n                                updatePreview();\n                            }\n                            inputs.state = null;\n                        }\n                    }\n                }\n            }\n        });\n        // ---------- rendering ---------------------\n        var fullSizeCanvas = (0, $eWjiX.BB).canvas(width, height);\n        var fullSizeCtx = (0, $eWjiX.BB).ctx(fullSizeCanvas);\n        updatePreview();\n        // ----- result -------------------\n        var destroy = function() {\n            blendSlider.destroy();\n            keyListener.destroy();\n            pointerListener.destroy();\n            klCanvasPreview.destroy();\n        };\n        var result = {\n            element: rootEl,\n            destroy: destroy,\n            getInput: function() {\n                destroy();\n                return (0, $eWjiX.BB).copyObj(settings);\n            }\n        };\n        if (!isSmall) result.width = 540;\n        return result;\n    },\n    apply: function(params) {\n        var klCanvas = params.klCanvas;\n        var ctx = params.context;\n        var history = params.history;\n        if (!klCanvas || !history) return false;\n        history.pause(true);\n        $ebbf7e5d844153e5$var$drawPattern(ctx, params.input);\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"pattern\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\n\nparcelRequire.register(\"10iZP\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterDistort\", function () { return $67bee9819cf9d9ba$export$77c344cc65ad0ed2; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $cH2YE = parcelRequire(\"cH2YE\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $a5EFw = parcelRequire(\"a5EFw\");\n\nvar $iFIyy = parcelRequire(\"iFIyy\");\n\nvar $7bWhB = parcelRequire(\"7bWhB\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $67bee9819cf9d9ba$export$77c344cc65ad0ed2 = {\n    getDialog: function(params) {\n        var sync = function sync(from) {\n            if (from === \"x\") {\n                settings.scale.y = settings.scale.x;\n                settings.strength.y = settings.strength.x;\n                settings.phase.y = settings.phase.x;\n                sliderArr[3].setValue(settings.scale.y);\n                sliderArr[4].setValue(settings.strength.y);\n                sliderArr[5].setValue(settings.phase.y);\n            } else {\n                settings.scale.x = settings.scale.y;\n                settings.strength.x = settings.strength.y;\n                settings.phase.x = settings.phase.y;\n                sliderArr[0].setValue(settings.scale.x);\n                sliderArr[1].setValue(settings.strength.x);\n                sliderArr[2].setValue(settings.phase.x);\n            }\n            updatePreview();\n        };\n        var updatePreview = // ---------- rendering ---------------------\n        function updatePreview() {\n            fxCanvas1.draw(texture1).multiplyAlpha().distort(settings).unmultiplyAlpha().update();\n            klCanvasPreview.render();\n        };\n        var isSmall = window.innerWidth < 550;\n        var rootEl = (0, $eWjiX.BB).el({\n            content: (0, $1mH1z.LANG)(\"filter-distort-description\") + \"<br><br>\"\n        });\n        var context = params.context;\n        var isSynced = true;\n        var settings = {\n            distortType: 0,\n            scale: {\n                x: 100,\n                y: 100\n            },\n            strength: {\n                x: 20,\n                y: 20\n            },\n            phase: {\n                x: 0,\n                y: 0\n            },\n            stepSize: 1\n        };\n        // let lastDrawnSettings = null;\n        // ---- thumb -------\n        var thumbImgArr = [];\n        var thumbSize = 32;\n        {\n            var canvas = (0, $eWjiX.BB).canvas(thumbSize, thumbSize);\n            var ctx = (0, $eWjiX.BB).ctx(canvas);\n            ctx.beginPath();\n            ctx.arc(thumbSize / 2, thumbSize / 2, thumbSize / 2.5, 0, Math.PI * 2);\n            ctx.fill();\n            var gradient = ctx.createLinearGradient(0, 0, thumbSize, thumbSize);\n            gradient.addColorStop(0, \"#00f\");\n            gradient.addColorStop(0.5, \"#f00\");\n            gradient.addColorStop(1, \"#fff\");\n            ctx.fillStyle = gradient;\n            ctx.globalCompositeOperation = \"source-atop\";\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\n            gradient = ctx.createLinearGradient(thumbSize, 0, 0, thumbSize);\n            gradient.addColorStop(0, \"#000\");\n            gradient.addColorStop(1, \"#000\");\n            ctx.fillStyle = gradient;\n            ctx.globalCompositeOperation = \"destination-atop\";\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\n            var fxCanvas = (0, $7jh4K.throwIfNull)((0, $a5EFw.getSharedFx)());\n            var texture = fxCanvas.texture(canvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            var scaleFactor = 20;\n            [\n                0,\n                1,\n                2\n            ].forEach(function(item) {\n                var thumbImg = new Image();\n                var settingsCopy = (0, $eWjiX.BB).copyObj(settings);\n                settingsCopy.distortType = item;\n                settingsCopy.scale.x /= scaleFactor;\n                settingsCopy.scale.y /= scaleFactor;\n                settingsCopy.strength.x /= scaleFactor;\n                settingsCopy.strength.y /= scaleFactor;\n                fxCanvas.draw(texture).multiplyAlpha().distort(settingsCopy).unmultiplyAlpha().update();\n                ctx.clearRect(0, 0, thumbSize, thumbSize);\n                ctx.drawImage(fxCanvas, 0, 0);\n                thumbImg.src = canvas.toDataURL(\"image/png\");\n                thumbImgArr.push(thumbImg);\n            });\n            texture.destroy();\n        }\n        // ---- controls ----\n        var topRowEl = (0, $eWjiX.BB).el({\n            parent: rootEl,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\"\n            }\n        });\n        var typeOptions = new (0, $iFIyy.Options)({\n            optionArr: thumbImgArr.map(function(img, index) {\n                (0, $eWjiX.BB).css(img, {\n                    margin: \"1px\",\n                    borderRadius: \"3px\",\n                    transition: \"all 0.1s ease-in-out\"\n                });\n                return {\n                    id: \"\" + index,\n                    label: img\n                };\n            }),\n            initId: \"0\",\n            onChange: function(id) {\n                settings.distortType = Number(id);\n                updatePreview();\n            }\n        });\n        var syncToggle = new (0, $7bWhB.Checkbox)({\n            init: true,\n            label: (0, $1mH1z.LANG)(\"filter-distort-sync-xy\"),\n            callback: function(val) {\n                isSynced = val;\n                if (isSynced) sync(\"x\");\n            }\n        });\n        topRowEl.append(typeOptions.getElement(), (0, $eWjiX.BB).el({\n            css: {\n                flexGrow: \"1\"\n            }\n        }), syncToggle.getElement());\n        var xyRowEl = (0, $eWjiX.BB).el({\n            parent: rootEl,\n            css: {\n                display: \"flex\",\n                flexWrap: \"wrap\"\n            }\n        });\n        var leftCol = (0, $eWjiX.BB).el({\n            parent: xyRowEl,\n            css: {\n                marginRight: \"10px\"\n            }\n        });\n        var rightCol = (0, $eWjiX.BB).el({\n            parent: xyRowEl\n        });\n        var sliderWidth = isSmall ? 300 : 245;\n        var sliderArr = [];\n        [\n            \"x\",\n            \"y\"\n        ].forEach(function(item, index) {\n            var targetEl = index === 0 ? leftCol : rightCol;\n            var scaleSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"filter-noise-scale\") + \" \" + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 1,\n                max: 1000,\n                curve: \"quadratic\",\n                value: settings.scale[item],\n                eventResMs: (0, $cH2YE.eventResMs),\n                onChange: function(val) {\n                    settings.scale[item] = val;\n                    if (isSynced) sync(item);\n                    else updatePreview();\n                }\n            });\n            scaleSlider.getElement().style.marginTop = \"20px\";\n            targetEl.append(scaleSlider.getElement());\n            var strengthSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"filter-unsharp-mask-strength\") + \" \" + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 0,\n                max: 200,\n                curve: \"quadratic\",\n                value: settings.strength[item],\n                eventResMs: (0, $cH2YE.eventResMs),\n                onChange: function(val) {\n                    settings.strength[item] = val;\n                    if (isSynced) sync(item);\n                    else updatePreview();\n                }\n            });\n            strengthSlider.getElement().style.marginTop = \"10px\";\n            targetEl.append(strengthSlider.getElement());\n            var phaseSlider = new (0, $aP0jf.KlSlider)({\n                label: (0, $1mH1z.LANG)(\"filter-distort-phase\") + \" \" + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: settings.phase[item],\n                manualInputRoundDigits: 2,\n                eventResMs: (0, $cH2YE.eventResMs),\n                formatFunc: function(val) {\n                    return (0, $eWjiX.BB).round(val, 2);\n                },\n                onChange: function(val) {\n                    settings.phase[item] = val;\n                    if (isSynced) sync(item);\n                    else updatePreview();\n                }\n            });\n            phaseSlider.getElement().style.marginTop = \"10px\";\n            targetEl.append(phaseSlider.getElement());\n            sliderArr.push(scaleSlider);\n            sliderArr.push(strengthSlider);\n            sliderArr.push(phaseSlider);\n        });\n        var stepSlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"filter-distort-stepsize\"),\n            width: 300,\n            height: 30,\n            min: 1,\n            max: 300,\n            curve: \"quadratic\",\n            value: settings.stepSize,\n            eventResMs: (0, $cH2YE.eventResMs),\n            onChange: function(val) {\n                settings.stepSize = Math.round(val);\n                updatePreview();\n            }\n        });\n        stepSlider.getElement().style.marginTop = \"20px\";\n        rootEl.append(stepSlider.getElement());\n        // ---- preview ----\n        var klCanvas = params.klCanvas;\n        var layers = klCanvas.getLayers();\n        var selectedLayerIndex = (0, $7jh4K.throwIfNull)(klCanvas.getLayerIndex(context.canvas));\n        var fit = (0, $eWjiX.BB).fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\n        var w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        // const renderW = Math.min(w, context.canvas.width);\n        // const renderH = Math.min(h, context.canvas.height);\n        // const renderFactor = renderW / context.canvas.width;\n        // const previewFactor = w / context.canvas.width;\n        var previewWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper\",\n            css: {\n                width: isSmall ? \"340px\" : \"540px\",\n                height: isSmall ? \"260px\" : \"300px\"\n            }\n        });\n        var fxCanvas1 = (0, $7jh4K.throwIfNull)((0, $a5EFw.getSharedFx)());\n        var texture1 = fxCanvas1.texture(context.canvas);\n        fxCanvas1.draw(texture1).update(); // update fxCanvas size\n        var previewLayer = {\n            image: fxCanvas1,\n            isVisible: layers[selectedLayerIndex].isVisible,\n            opacity: layers[selectedLayerIndex].opacity,\n            mixModeStr: layers[selectedLayerIndex].mixModeStr\n        };\n        var previewLayerArr = layers.map(function(item, i) {\n            if (i === selectedLayerIndex) return previewLayer;\n            else return {\n                image: item.context.canvas,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr\n            };\n        });\n        var klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: previewLayerArr\n        });\n        var previewInnerWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper__canvas\",\n            css: {\n                width: parseInt(\"\" + w) + \"px\",\n                height: parseInt(\"\" + h) + \"px\"\n            }\n        });\n        previewInnerWrapper.append(klCanvasPreview.getElement());\n        previewWrapper.append(previewInnerWrapper);\n        rootEl.append(previewWrapper);\n        updatePreview();\n        var destroy = function() {\n            typeOptions.destroy();\n            sliderArr.forEach(function(item) {\n                return item.destroy();\n            });\n            stepSlider.destroy();\n            syncToggle.destroy();\n            texture1.destroy();\n            klCanvasPreview.destroy();\n        };\n        // ----- result -------------------\n        var result = {\n            element: rootEl,\n            destroy: destroy,\n            getInput: function() {\n                destroy();\n                return (0, $eWjiX.BB).copyObj(settings);\n            }\n        };\n        if (!isSmall) result.width = 540;\n        return result;\n    },\n    apply: function(params) {\n        var klCanvas = params.klCanvas;\n        var context = params.context;\n        var history = params.history;\n        if (!klCanvas || !history) return false;\n        history.pause(true);\n        var fxCanvas = (0, $a5EFw.getSharedFx)();\n        if (!fxCanvas) return false; // todo more specific error?\n        var texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).multiplyAlpha().distort(params.input).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"distort\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\n\nparcelRequire.register(\"dteOZ\", function(module, exports) {\n\n$parcel$export(module.exports, \"filterVanishPoint\", function () { return $9939d5f20537fa4b$export$a77e8ecd2a7fa9a5; });\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $i5nyl = parcelRequire(\"i5nyl\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $dJPtW = parcelRequire(\"dJPtW\");\n\nvar $43qNf = parcelRequire(\"43qNf\");\n\nvar $jsIPR = parcelRequire(\"jsIPR\");\n\nvar $aP0jf = parcelRequire(\"aP0jf\");\n\nvar $cH2YE = parcelRequire(\"cH2YE\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $9939d5f20537fa4b$export$a77e8ecd2a7fa9a5 = {\n    getDialog: function(params) {\n        var syncInputs = function syncInputs() {\n            xInput.value = \"\" + settingsObj.x;\n            yInput.value = \"\" + settingsObj.y;\n        };\n        var updatePreview = function updatePreview() {\n            var ctx = (0, $eWjiX.BB).ctx(previewLayer.image);\n            ctx.save();\n            ctx.clearRect(0, 0, renderW, renderH);\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\n            (0, $jsIPR.drawVanishPoint)(ctx, settingsObj.x * renderFactor, settingsObj.y * renderFactor, settingsObj.lines, Math.max(settingsObj.thickness * renderFactor, 1), settingsObj.color, settingsObj.opacity);\n            ctx.restore();\n            klCanvasPreview.render();\n        };\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        var layers = klCanvas.getLayers();\n        var selectedLayerIndex = (0, $7jh4K.throwIfNull)(klCanvas.getLayerIndex(context.canvas));\n        var fit = (0, $eWjiX.BB).fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        var w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        var renderW = Math.min(w, context.canvas.width);\n        var renderH = Math.min(h, context.canvas.height);\n        var renderFactor = renderW / context.canvas.width;\n        var previewFactor = w / context.canvas.width;\n        var div = document.createElement(\"div\");\n        var result = {\n            element: div\n        };\n        div.innerHTML = (0, $1mH1z.LANG)(\"filter-vanish-point-description\") + \"<br/><br/>\";\n        var settingsObj = {\n            x: context.canvas.width / 2,\n            y: context.canvas.height / 2,\n            lines: 8,\n            thickness: 2,\n            color: {\n                r: 0,\n                g: 0,\n                b: 0\n            },\n            opacity: 1\n        };\n        var linesSlider = new (0, $aP0jf.KlSlider)({\n            label: (0, $1mH1z.LANG)(\"filter-vanish-point-lines\"),\n            width: 300,\n            height: 30,\n            min: 2,\n            max: 20,\n            value: settingsObj.lines,\n            curve: \"quadratic\",\n            eventResMs: (0, $cH2YE.eventResMs),\n            onChange: function onChange(val) {\n                settingsObj.lines = Math.round(val);\n                updatePreview();\n            }\n        });\n        linesSlider.getElement().style.marginBottom = \"10px\";\n        div.append(linesSlider.getElement());\n        var line1 = (0, $eWjiX.BB).el({\n            parent: div,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\"\n            }\n        });\n        var line2 = (0, $eWjiX.BB).el({\n            parent: div,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                marginTop: \"10px\"\n            }\n        });\n        var xInput = (0, $dJPtW.input)({\n            init: settingsObj.x,\n            type: \"number\",\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function callback(v) {\n                settingsObj.x = parseFloat(v);\n                updatePreview();\n            }\n        });\n        var yInput = (0, $dJPtW.input)({\n            init: settingsObj.y,\n            type: \"number\",\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function callback(v) {\n                settingsObj.y = parseFloat(v);\n                updatePreview();\n            }\n        });\n        var thicknessInput = (0, $dJPtW.input)({\n            init: 2,\n            type: \"number\",\n            min: 1,\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function callback(v) {\n                settingsObj.thickness = parseFloat(v);\n                updatePreview();\n            }\n        });\n        var selectedRgbaObj = {\n            r: 0,\n            g: 0,\n            b: 0,\n            a: 1\n        };\n        var colorOptionsArr = [\n            {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 1\n            },\n            {\n                r: 255,\n                g: 255,\n                b: 255,\n                a: 1\n            }\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1\n        });\n        settingsObj.color = (0, $eWjiX.BB).copyObj(selectedRgbaObj);\n        var colorOptions = new (0, $43qNf.ColorOptions)({\n            label: (0, $1mH1z.LANG)(\"shape-stroke\"),\n            colorArr: colorOptionsArr,\n            onChange: function onChange(rgbaObj) {\n                selectedRgbaObj = rgbaObj;\n                settingsObj.color = (0, $eWjiX.BB).copyObj(selectedRgbaObj);\n                updatePreview();\n            }\n        });\n        var labelStyle = {\n            display: \"inline-block\",\n            marginRight: \"5px\"\n        };\n        line1.append((0, $eWjiX.BB).el({\n            content: \"X:\",\n            css: labelStyle\n        }), xInput, (0, $eWjiX.BB).el({\n            content: \"Y:\",\n            css: labelStyle\n        }), yInput);\n        line2.append((0, $eWjiX.BB).el({\n            content: (0, $1mH1z.LANG)(\"shape-line-width\") + \":\",\n            css: labelStyle\n        }), thicknessInput, (0, $eWjiX.BB).el({\n            css: {\n                flexGrow: \"1\"\n            }\n        }), colorOptions.getElement());\n        var previewWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper\",\n            css: {\n                width: \"340px\",\n                height: \"220px\"\n            }\n        });\n        var previewLayer = {\n            image: (0, $eWjiX.BB).canvas(renderW, renderH),\n            isVisible: layers[selectedLayerIndex].isVisible,\n            opacity: layers[selectedLayerIndex].opacity,\n            mixModeStr: layers[selectedLayerIndex].mixModeStr\n        };\n        var klCanvasPreview = new (0, $i5nyl.KlCanvasPreview)({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: layers.map(function(item, i) {\n                if (i === selectedLayerIndex) return previewLayer;\n                else return {\n                    image: item.context.canvas,\n                    isVisible: item.isVisible,\n                    opacity: item.opacity,\n                    mixModeStr: item.mixModeStr\n                };\n            })\n        });\n        var previewInnerWrapper = (0, $eWjiX.BB).el({\n            className: \"kl-preview-wrapper__canvas\",\n            css: {\n                width: parseInt(\"\" + w) + \"px\",\n                height: parseInt(\"\" + h) + \"px\",\n                cursor: \"move\"\n            }\n        });\n        previewInnerWrapper.append(klCanvasPreview.getElement());\n        previewWrapper.append(previewInnerWrapper);\n        // ---- preview input processing ----\n        var inputs = {};\n        previewWrapper.oncontextmenu = function() {\n            return false;\n        };\n        previewInnerWrapper.style.touchAction = \"none\";\n        var pointerListener = new (0, $eWjiX.BB).PointerListener({\n            target: previewInnerWrapper,\n            onPointer: function(event) {\n                if (event.type === \"pointerdown\") {\n                    if (!inputs.state) {\n                        inputs.state = \"move\";\n                        inputs.oldSettings = (0, $eWjiX.BB).copyObj(settingsObj);\n                        inputs.start = {\n                            x: event.relX / previewFactor,\n                            y: event.relY / previewFactor\n                        };\n                        inputs.end = null;\n                    }\n                } else if (event.type === \"pointermove\") {\n                    if (inputs.state) {\n                        inputs.end = {\n                            x: event.relX / previewFactor,\n                            y: event.relY / previewFactor\n                        };\n                        settingsObj.x = Math.round(inputs.end.x - inputs.start.x + inputs.oldSettings.x);\n                        settingsObj.y = Math.round(inputs.end.y - inputs.start.y + inputs.oldSettings.y);\n                        syncInputs();\n                        updatePreview();\n                    }\n                } else if (event.type === \"pointerup\") {\n                    if (inputs.state) inputs.state = null;\n                }\n            }\n        });\n        setTimeout(updatePreview, 0);\n        div.append(previewWrapper);\n        result.destroy = function() {\n            linesSlider.destroy();\n            pointerListener.destroy();\n            klCanvasPreview.destroy();\n            colorOptions.destroy();\n        };\n        result.getInput = function() {\n            result.destroy();\n            return (0, $eWjiX.BB).copyObj(settingsObj);\n        };\n        return result;\n    },\n    apply: function(params) {\n        var context = params.context;\n        var klCanvas = params.klCanvas;\n        var history = params.history;\n        if (!context || !klCanvas || !history) return false;\n        history.pause(true);\n        (0, $jsIPR.drawVanishPoint)(context, params.input.x, params.input.y, params.input.lines, params.input.thickness, params.input.color, params.input.opacity);\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"vanishPoint\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n});\nparcelRequire.register(\"jsIPR\", function(module, exports) {\n\n$parcel$export(module.exports, \"drawVanishPoint\", function () { return $cd59789add31bb97$export$8f57d6bdbceb36d0; });\n\nvar $3ujzu = parcelRequire(\"3ujzu\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nfunction $cd59789add31bb97$export$8f57d6bdbceb36d0(ctx, x, y, lines, thickness, color, opacity) {\n    ctx.save();\n    var degIncrement = 180 / lines;\n    for(var deg = 0; deg < 180; deg += degIncrement){\n        var p2 = (0, $eWjiX.BB).rotateAround({\n            x: x,\n            y: y\n        }, {\n            x: x + 9999,\n            y: y\n        }, deg);\n        (0, $3ujzu.drawShape)(ctx, {\n            type: \"line\",\n            x1: x,\n            y1: y,\n            x2: p2.x,\n            y2: p2.y,\n            //angleRad: 0,\n            isOutwards: true,\n            opacity: opacity,\n            //isEraser: false,\n            strokeRgb: color,\n            lineWidth: thickness\n        });\n    }\n    ctx.restore();\n}\n\n});\n\n\n\nparcelRequire.register(\"3WOmu\", function(module, exports) {\n\n$parcel$export(module.exports, \"klCanvasToPsdBlob\", function () { return $40b8cea12adf584e$export$92433b641be3f7a; });\n\nvar $1LaJZ = parcelRequire(\"1LaJZ\");\n\nvar $2gUX3 = parcelRequire(\"2gUX3\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $iVf04 = parcelRequire(\"iVf04\");\nfunction $40b8cea12adf584e$export$92433b641be3f7a(klCanvas) {\n    return $40b8cea12adf584e$var$_klCanvasToPsdBlob.apply(this, arguments);\n}\nfunction $40b8cea12adf584e$var$_klCanvasToPsdBlob() {\n    $40b8cea12adf584e$var$_klCanvasToPsdBlob = (0, $1LaJZ._)(function(klCanvas) {\n        var layerArr, psdConfig, agPsd, buffer;\n        return (0, $2gUX3.__generator)(this, function(_state) {\n            switch(_state.label){\n                case 0:\n                    layerArr = klCanvas.getLayersFast();\n                    psdConfig = {\n                        width: klCanvas.getWidth(),\n                        height: klCanvas.getHeight(),\n                        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\n                        children: layerArr.map(function(item) {\n                            // todo - can be optimized if layer mostly empty\n                            return {\n                                name: item.name,\n                                hidden: !item.isVisible,\n                                opacity: item.opacity,\n                                canvas: item.canvas,\n                                blendMode: (0, $hrnUX.KL).PSD.blendKlToPsd(item.mixModeStr),\n                                left: 0,\n                                top: 0\n                            };\n                        })\n                    };\n                    return [\n                        4,\n                        (0, $iVf04.loadAgPsd)()\n                    ];\n                case 1:\n                    agPsd = _state.sent();\n                    buffer = agPsd.writePsdBuffer(psdConfig);\n                    return [\n                        2,\n                        new Blob([\n                            buffer\n                        ], {\n                            type: \"application/octet-stream\"\n                        })\n                    ];\n            }\n        });\n    });\n    return $40b8cea12adf584e$var$_klCanvasToPsdBlob.apply(this, arguments);\n}\n\n});\n\nparcelRequire.register(\"iuTWx\", function(module, exports) {\n\n$parcel$export(module.exports, \"LineSmoothing\", function () { return $3adbeb1f050c09d3$export$c57e2ed65bcf4d6a; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\nvar $3adbeb1f050c09d3$export$c57e2ed65bcf4d6a = /*#__PURE__*/ function() {\n    \"use strict\";\n    function LineSmoothing(p) {\n        (0, $cx0mh._)(this, LineSmoothing);\n        this.smoothing = (0, $eWjiX.BB).clamp(p.smoothing, 0, 1);\n    }\n    (0, $7h4XF._)(LineSmoothing, [\n        {\n            key: \"chainIn\",\n            value: function chainIn(event) {\n                var _this = this;\n                event = (0, $eWjiX.BB).copyObj(event);\n                this.timeout && clearTimeout(this.timeout);\n                this.interval && clearInterval(this.interval);\n                if (event.type === \"down\") this.lastMixedInput = {\n                    x: event.x,\n                    y: event.y,\n                    pressure: event.pressure\n                };\n                if (event.type === \"move\") {\n                    var inputX = event.x;\n                    var inputY = event.y;\n                    var inputPressure = event.pressure;\n                    event.x = (0, $eWjiX.BB).mix(event.x, this.lastMixedInput.x, this.smoothing);\n                    event.y = (0, $eWjiX.BB).mix(event.y, this.lastMixedInput.y, this.smoothing);\n                    event.pressure = (0, $eWjiX.BB).mix(event.pressure, this.lastMixedInput.pressure, this.smoothing);\n                    this.lastMixedInput = {\n                        x: event.x,\n                        y: event.y,\n                        pressure: event.pressure\n                    };\n                    if (this.smoothing > 0) this.timeout = setTimeout(function() {\n                        _this.interval = setInterval(function() {\n                            event = JSON.parse(JSON.stringify(event));\n                            event.x = (0, $eWjiX.BB).mix(inputX, _this.lastMixedInput.x, _this.smoothing);\n                            event.y = (0, $eWjiX.BB).mix(inputY, _this.lastMixedInput.y, _this.smoothing);\n                            event.pressure = (0, $eWjiX.BB).mix(inputPressure, _this.lastMixedInput.pressure, _this.smoothing);\n                            _this.lastMixedInput = {\n                                x: event.x,\n                                y: event.y,\n                                pressure: event.pressure\n                            };\n                            _this.chainOut && _this.chainOut(event);\n                        }, 35);\n                    }, 80);\n                }\n                return event;\n            }\n        },\n        {\n            key: \"setChainOut\",\n            value: function setChainOut(func) {\n                this.chainOut = func;\n            }\n        },\n        {\n            key: \"setSmoothing\",\n            value: function setSmoothing(s) {\n                this.smoothing = (0, $eWjiX.BB).clamp(s, 0, 1);\n            }\n        }\n    ]);\n    return LineSmoothing;\n}();\n\n});\n\nparcelRequire.register(\"57YJz\", function(module, exports) {\n\n$parcel$export(module.exports, \"LineSanitizer\", function () { return $73298182992a8985$export$91dcf4209534d21f; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\nvar $73298182992a8985$export$91dcf4209534d21f = /*#__PURE__*/ function() {\n    \"use strict\";\n    function LineSanitizer() {\n        (0, $cx0mh._)(this, LineSanitizer);\n        this.isDrawing = false;\n    }\n    (0, $7h4XF._)(LineSanitizer, [\n        {\n            // --- public ---\n            key: \"chainIn\",\n            value: function chainIn(event) {\n                if (event.type === \"down\") {\n                    if (this.isDrawing) //console.log('line sanitizer - down, but already drawing');\n                    this.chainOut && this.chainOut({\n                        type: \"up\",\n                        scale: event.scale,\n                        shiftIsPressed: event.shiftIsPressed,\n                        isCoalesced: false\n                    });\n                    else this.isDrawing = true;\n                }\n                if (!this.isDrawing && (event.type === \"move\" || event.type === \"up\")) //console.log('line sanitizer - ' + event.type + ' but not drawing');\n                return null;\n                if (event.type === \"up\" && this.isDrawing) this.isDrawing = false;\n                return event;\n            }\n        },\n        {\n            key: \"setChainOut\",\n            value: function setChainOut(func) {\n                this.chainOut = func;\n            }\n        },\n        {\n            key: \"getIsDrawing\",\n            value: function getIsDrawing() {\n                return this.isDrawing;\n            }\n        }\n    ]);\n    return LineSanitizer;\n}();\n\n});\n\nparcelRequire.register(\"aId1u\", function(module, exports) {\n\n$parcel$export(module.exports, \"translateSmoothing\", function () { return $7aa12ecc06c22770$export$bcd109042a2e4bb5; });\n/**\r\n * from stabilizer dropdown value to line-smoothing value\r\n * @param s\r\n */ function $7aa12ecc06c22770$export$bcd109042a2e4bb5(s) {\n    if (s == 1) return 0.5;\n    if (s == 2) return 0.84;\n    if (s == 3) return 0.965;\n    if (s == 4) return 0.9825;\n    if (s == 5) return 0.99125;\n    return s;\n}\n\n});\n\nparcelRequire.register(\"iG6pP\", function(module, exports) {\n\n$parcel$export(module.exports, \"ImportHandler\", function () { return $504c8450f977b764$export$4ccbb8938b9d5723; });\n\nvar $cx0mh = parcelRequire(\"cx0mh\");\n\nvar $7h4XF = parcelRequire(\"7h4XF\");\n\nvar $hrnUX = parcelRequire(\"hrnUX\");\n\nvar $1mH1z = parcelRequire(\"1mH1z\");\n\nvar $eWjiX = parcelRequire(\"eWjiX\");\n\nvar $gWfkn = parcelRequire(\"gWfkn\");\n\nvar $7jh4K = parcelRequire(\"7jh4K\");\nvar $504c8450f977b764$export$4ccbb8938b9d5723 = /*#__PURE__*/ function() {\n    \"use strict\";\n    function ImportHandler(input, callback) {\n        (0, $cx0mh._)(this, ImportHandler);\n        this.klRootEl = input.klRootEl;\n        this.klMaxCanvasSize = input.klMaxCanvasSize;\n        this.layerManager = input.layerManager;\n        this.setCurrentLayer = input.setCurrentLayer;\n        this.klCanvas = input.klCanvas;\n        this.klCanvasWorkspace = input.klCanvasWorkspace;\n        this.handUi = input.handUi;\n        this.onColor = callback.onColor;\n    }\n    (0, $7h4XF._)(ImportHandler, [\n        {\n            key: \"importFinishedLoading\",\n            value: /**\r\n     *\r\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\r\n     * @param filename - string e.g. 'drawing.psd'\r\n     * @param optionStr? - 'default' | 'layer' | 'image'\r\n     */ function importFinishedLoading(importedImage, filename, optionStr) {\n                var _this = this;\n                if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\n                    (0, $hrnUX.KL).popup({\n                        target: this.klRootEl,\n                        type: \"error\",\n                        message: (0, $1mH1z.LANG)(\"import-broken-file\"),\n                        buttons: [\n                            \"Ok\"\n                        ]\n                    });\n                    return;\n                }\n                var getResizedDimensions = function(width, height) {\n                    var w = parseInt(\"\" + width);\n                    var h = parseInt(\"\" + height);\n                    if (w > _this.klMaxCanvasSize) {\n                        h = _this.klMaxCanvasSize / w * h;\n                        w = _this.klMaxCanvasSize;\n                    }\n                    if (h > _this.klMaxCanvasSize) {\n                        w = _this.klMaxCanvasSize / h * w;\n                        h = _this.klMaxCanvasSize;\n                    }\n                    w = parseInt(\"\" + w);\n                    h = parseInt(\"\" + h);\n                    return {\n                        width: w,\n                        height: h\n                    };\n                };\n                var importAsImage = function(canvas) {\n                    var resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\n                    //resize first\n                    var tempCanvas = (0, $eWjiX.BB).canvas(canvas.width, canvas.height);\n                    var tempCanvasCtx = (0, $eWjiX.BB).ctx(tempCanvas);\n                    tempCanvasCtx.drawImage(canvas, 0, 0);\n                    (0, $eWjiX.BB).resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\n                    _this.klCanvas.reset({\n                        width: resizedDimensions.width,\n                        height: resizedDimensions.height,\n                        image: tempCanvas,\n                        layerName: filename\n                    });\n                    _this.layerManager.update(0);\n                    _this.setCurrentLayer(_this.klCanvas.getLayer(0));\n                    _this.klCanvasWorkspace.resetOrFitView();\n                    _this.handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\n                };\n                /**\r\n         *\r\n         * @param convertedPsdObj - if flattened then without layers\r\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\r\n         */ var importAsImagePsd = function(convertedPsdObj, cropObj) {\n                    // crop\n                    var crop = function(targetCanvas, cropCanvas, cropObj) {\n                        // eslint-disable-next-line no-self-assign\n                        cropCanvas.width = cropCanvas.width;\n                        (0, $eWjiX.BB).ctx(cropCanvas).drawImage(targetCanvas, -cropObj.x, -cropObj.y);\n                        targetCanvas.width = cropObj.width;\n                        targetCanvas.height = cropObj.height;\n                        (0, $eWjiX.BB).ctx(targetCanvas).drawImage(cropCanvas, 0, 0);\n                    };\n                    if (cropObj && (cropObj.width !== convertedPsdObj.width || cropObj.height !== convertedPsdObj.height)) {\n                        var cropCanvas = (0, $eWjiX.BB).canvas(cropObj.width, cropObj.height);\n                        convertedPsdObj.width = cropObj.width;\n                        convertedPsdObj.height = cropObj.height;\n                        if (!convertedPsdObj.layers) crop(convertedPsdObj.canvas, cropCanvas, cropObj);\n                        if (convertedPsdObj.layers) for(var i = 0; i < convertedPsdObj.layers.length; i++){\n                            var item = convertedPsdObj.layers[i];\n                            crop(item.image, cropCanvas, cropObj);\n                        }\n                    }\n                    // resize\n                    var resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\n                    convertedPsdObj.width = resizedDimensions.width;\n                    convertedPsdObj.height = resizedDimensions.height;\n                    if (!convertedPsdObj.layers) (0, $eWjiX.BB).resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\n                    if (convertedPsdObj.layers) for(var i1 = 0; i1 < convertedPsdObj.layers.length; i1++){\n                        var item1 = convertedPsdObj.layers[i1];\n                        (0, $eWjiX.BB).resizeCanvas(item1.image, convertedPsdObj.width, convertedPsdObj.height);\n                    }\n                    var layerIndex;\n                    if (convertedPsdObj.layers) layerIndex = _this.klCanvas.reset({\n                        width: convertedPsdObj.width,\n                        height: convertedPsdObj.height,\n                        layers: convertedPsdObj.layers\n                    });\n                    else layerIndex = _this.klCanvas.reset({\n                        width: convertedPsdObj.width,\n                        height: convertedPsdObj.height,\n                        image: convertedPsdObj.canvas\n                    });\n                    _this.layerManager.update(layerIndex);\n                    _this.setCurrentLayer((0, $7jh4K.throwIfNull)(_this.klCanvas.getLayer(layerIndex)));\n                    _this.klCanvasWorkspace.resetOrFitView();\n                    _this.handUi.update(_this.klCanvasWorkspace.getScale(), _this.klCanvasWorkspace.getAngleDeg());\n                };\n                var importAsLayer = function(canvas) {\n                    (0, $hrnUX.KL).showImportAsLayerDialog({\n                        target: _this.klRootEl,\n                        klCanvas: _this.klCanvas,\n                        importImage: canvas,\n                        callback: function(transformObj, isPixelated) {\n                            if (!transformObj) return;\n                            (0, $gWfkn.klHistory).pause(true);\n                            _this.klCanvas.addLayer();\n                            var layers = _this.klCanvas.getLayers();\n                            var activeLayerIndex = layers.length - 1;\n                            if (filename) _this.klCanvas.renameLayer(activeLayerIndex, filename);\n                            var activeLayerContext = (0, $7jh4K.throwIfNull)(_this.klCanvas.getLayerContext(activeLayerIndex));\n                            (0, $eWjiX.BB).drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, undefined, isPixelated);\n                            _this.setCurrentLayer((0, $7jh4K.throwIfNull)(_this.klCanvas.getLayer(activeLayerIndex)));\n                            _this.layerManager.update(activeLayerIndex);\n                            (0, $gWfkn.klHistory).pause(false);\n                            (0, $gWfkn.klHistory).push({\n                                tool: [\n                                    \"misc\"\n                                ],\n                                action: \"importImage\",\n                                params: [\n                                    (0, $eWjiX.BB).copyCanvas(activeLayerContext.canvas),\n                                    filename\n                                ]\n                            });\n                        }\n                    });\n                };\n                if (optionStr === \"default\" || !optionStr) (0, $hrnUX.KL).showImportImageDialog({\n                    image: importedImage,\n                    target: this.klRootEl,\n                    maxSize: this.klMaxCanvasSize,\n                    callback: function(res) {\n                        if (res.type === \"as-image\") importAsImage(res.image);\n                        else if (res.type === \"as-image-psd\") importAsImagePsd(res.image, res.cropObj);\n                        else if (res.type === \"as-layer\") importAsLayer(res.image);\n                        else res.type;\n                    }\n                });\n                if (optionStr === \"layer\") importAsLayer(importedImage.canvas);\n                if (optionStr === \"image\") {\n                    if (importedImage.type === \"psd\") importAsImagePsd(importedImage);\n                    else importAsImage(importedImage.canvas);\n                }\n            }\n        },\n        {\n            // ---- interface ----\n            key: \"onPaste\",\n            value: function onPaste(e) {\n                var _this = this;\n                if ((0, $hrnUX.KL).dialogCounter.get() > 0) return;\n                var retrieveImageFromClipboardAsBlob = function(items, callback) {\n                    if (!items) return;\n                    for(var i = 0; i < items.length; i++){\n                        if (items[i].type.indexOf(\"image\") == -1) continue;\n                        var file = items[i].getAsFile();\n                        file && callback(file);\n                    }\n                };\n                e.stopPropagation();\n                e.preventDefault();\n                if (!e.clipboardData) return;\n                if (e.clipboardData.files[0]) retrieveImageFromClipboardAsBlob(e.clipboardData.items, function(imageBlob) {\n                    // If there's an image, display it in the canvas\n                    var img = new Image();\n                    img.onload = function() {\n                        URL.revokeObjectURL(img.src);\n                        _this.importFinishedLoading({\n                            type: \"image\",\n                            width: img.width,\n                            height: img.height,\n                            canvas: img\n                        }, undefined, \"default\");\n                    };\n                    var URLObj = window.URL || window.webkitURL;\n                    img.src = URLObj.createObjectURL(imageBlob);\n                });\n                else if (e.clipboardData.items[0]) e.clipboardData.items[0].getAsString(function(pasteStr) {\n                    pasteStr = pasteStr.trim();\n                    if (pasteStr.match(/^https?/)) {\n                        // url\n                        var img = new Image();\n                        img.onload = function() {\n                            _this.importFinishedLoading({\n                                type: \"image\",\n                                width: img.width,\n                                height: img.height,\n                                canvas: img\n                            }, undefined, \"default\");\n                        };\n                        img.onerror = function(e) {\n                            console.log(\"error loading\", e);\n                        };\n                        img.crossOrigin = \"Anonymous\";\n                        img.src = pasteStr;\n                    } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\n                        // url\n                        var rgbObj = (0, $eWjiX.BB).ColorConverter.hexToRGB(pasteStr.replace(\"#\", \"\"));\n                        rgbObj && _this.onColor(rgbObj);\n                    }\n                });\n            }\n        },\n        {\n            key: \"handleFileSelect\",\n            value: function handleFileSelect(files, optionStr) {\n                var _this = this;\n                var showWarningPsdFlattened = function() {\n                    (0, $hrnUX.KL).popup({\n                        target: _this.klRootEl,\n                        type: \"warning\",\n                        message: (0, $1mH1z.LANG)(\"import-psd-unsupported\") + \"<br /><br />\",\n                        buttons: [\n                            \"Ok\"\n                        ]\n                    });\n                };\n                var hasUnsupportedFile = false;\n                // eslint-disable-next-line no-cond-assign\n                for(var i = 0, file; file = files[i]; i++){\n                    var nameSplit = file.name.split(\".\");\n                    var extension = nameSplit[nameSplit.length - 1].toLowerCase();\n                    if (extension === \"psd\") (function(f) {\n                        var loaderSizeBytes = 26214400; // 25mb\n                        var maxSizeBytes = 1073741824; // 1gb\n                        var maxResolution = 4096;\n                        if (f.size >= maxSizeBytes) {\n                            (0, $hrnUX.KL).popup({\n                                target: _this.klRootEl,\n                                type: \"error\",\n                                message: \"File too big. Unable to import.<br /><br />\",\n                                buttons: [\n                                    \"Ok\"\n                                ]\n                            });\n                            return;\n                        }\n                        var doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\n                        var loaderIsOpen = true;\n                        var closeLoader;\n                        if (doShowLoader) (0, $hrnUX.KL).popup({\n                            target: _this.klRootEl,\n                            message: (0, $1mH1z.LANG)(\"import-opening\"),\n                            callback: function(result) {\n                                loaderIsOpen = false;\n                                closeLoader = null;\n                            },\n                            closeFunc: function(f) {\n                                closeLoader = f;\n                            }\n                        });\n                        var reader = new FileReader();\n                        reader.onload = function(readerResult) {\n                            var target = (0, $7jh4K.throwIfNull)(readerResult.target);\n                            (0, $hrnUX.KL).loadAgPsd().then(function(agPsdLazy) {\n                                if (doShowLoader && !loaderIsOpen) return;\n                                try {\n                                    var psd;\n                                    // first pass, only read metadata\n                                    psd = agPsdLazy.readPsd(target.result, {\n                                        skipLayerImageData: true,\n                                        skipThumbnail: true,\n                                        skipCompositeImageData: true\n                                    });\n                                    if (psd.width > maxResolution || psd.height > maxResolution) {\n                                        if (closeLoader) closeLoader();\n                                        (0, $hrnUX.KL).popup({\n                                            target: _this.klRootEl,\n                                            type: \"error\",\n                                            message: (0, $1mH1z.LANG)(\"import-psd-too-large\").replace(/{x}/g, \"\" + maxResolution) + \"<br /><br />\" + (0, $1mH1z.LANG)(\"import-psd-size\") + \": \" + psd.width + \" x \" + psd.height + \" pixels\" + \"<br /><br />\",\n                                            buttons: [\n                                                \"Ok\"\n                                            ]\n                                        });\n                                        return;\n                                    }\n                                    // second pass, now load actual data.\n                                    psd = null;\n                                    try {\n                                        psd = agPsdLazy.readPsd(target.result);\n                                    } catch (e) {\n                                    //console.log('failed regular psd import', e);\n                                    }\n                                    if (psd) {\n                                        //console.log('psd', psd);\n                                        var convertedPsd = (0, $hrnUX.KL).PSD.readPsd(psd);\n                                        //console.log('converted', convertedPsd);\n                                        if (optionStr === \"image\" && convertedPsd.error) showWarningPsdFlattened();\n                                        if (closeLoader) closeLoader();\n                                        _this.importFinishedLoading(convertedPsd, f.name, optionStr);\n                                    } else {\n                                        psd = agPsdLazy.readPsd(target.result, {\n                                            skipLayerImageData: true,\n                                            skipThumbnail: true\n                                        });\n                                        if (optionStr === \"image\") showWarningPsdFlattened();\n                                        if (closeLoader) closeLoader();\n                                        _this.importFinishedLoading({\n                                            type: \"psd\",\n                                            width: psd.width,\n                                            height: psd.height,\n                                            canvas: (0, $7jh4K.throwIfUndefined)(psd.canvas),\n                                            error: true\n                                        }, f.name, optionStr);\n                                    }\n                                } catch (e) {\n                                    closeLoader && closeLoader();\n                                    (0, $hrnUX.KL).popup({\n                                        target: _this.klRootEl,\n                                        type: \"error\",\n                                        message: \"Failed to load PSD.<br /><br />\",\n                                        buttons: [\n                                            \"Ok\"\n                                        ]\n                                    });\n                                    console.log(e);\n                                    setTimeout(function() {\n                                        throw new Error(\"psd load error\");\n                                    });\n                                }\n                            }).catch(function(e) {\n                                closeLoader && closeLoader();\n                                alert(\"Error: failed to load PSD library\");\n                            });\n                        };\n                        reader.readAsArrayBuffer(f);\n                    })(file);\n                    else if (file.type.match(\"image.*\")) (function(f) {\n                        window.URL = window.URL || window.webkitURL;\n                        var url = window.URL.createObjectURL(f);\n                        var im = new Image();\n                        im.src = url;\n                        (0, $eWjiX.BB).loadImage(im, function() {\n                            _this.importFinishedLoading({\n                                type: \"image\",\n                                width: im.width,\n                                height: im.height,\n                                canvas: im\n                            }, f.name, optionStr);\n                        });\n                    })(file);\n                    else hasUnsupportedFile = true;\n                }\n                if (hasUnsupportedFile) (0, $hrnUX.KL).popup({\n                    target: this.klRootEl,\n                    message: (0, $1mH1z.LANG)(\"import-unsupported-file\"),\n                    type: \"error\",\n                    buttons: [\n                        \"OK\"\n                    ]\n                });\n            }\n        }\n    ]);\n    return ImportHandler;\n}();\n\n});\n\nparcelRequire.register(\"fX22P\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"kycpJ\");\n\n});\n\nparcelRequire.register(\"i7SrA\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"f6OTe\")).getBundleURL(\"dafOa\") + (parcelRequire(\"2evKT\")).resolve(\"TzbtI\");\n\n});\n\nparcelRequire.register(\"qur3y\", function(module, exports) {\n\n$parcel$export(module.exports, \"createConsoleApi\", function () { return $a8abbf3a9def9692$export$982e7602957287fa; });\n\nvar $bX4ja = parcelRequire(\"bX4ja\");\nfunction $a8abbf3a9def9692$export$982e7602957287fa(p) {\n    var _console, _console1;\n    var output = [\n        \"Draw via the console! Learn more: %cKL.help()\",\n        \"background: #000; color: #0f0;\"\n    ];\n    \"info\" in console ? (_console = console).info.apply(_console, (0, $bX4ja._)(output)) : (_console1 = console).log.apply(_console1, (0, $bX4ja._)(output));\n    return Object.freeze({\n        draw: function(path) {\n            p.onDraw(path);\n        },\n        help: function() {\n            console.log(\"KL.draw({x: number; y: number}[]) // draw a line\\nKL.help() // print help\\n\");\n        }\n    });\n}\n\n});\n\n\n\n})();\n//# sourceMappingURL=main-embed.6a06ff2a.js.map\n","import './polyfills/polyfills';\r\nimport {KlApp} from './app/kl-app';\r\nimport {IKlProject} from './klecks/kl-types';\r\nimport {SaveReminder} from './klecks/ui/components/save-reminder';\r\nimport {klHistory} from './klecks/history/kl-history';\r\nimport {klPsdToKlProject, readPsd} from './klecks/storage/psd';\r\nimport {LANG} from './language/language';\r\nimport {loadAgPsd, TAgPsd} from './klecks/storage/load-ag-psd';\r\nimport {klConfig} from './klecks/kl-config';\r\n\r\nexport interface IEmbedParams {\r\n    project?: IKlProject;\r\n    psdBlob?: Blob;\r\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    embedUrl: string;\r\n    logoImg?: any;\r\n    bottomBar?: HTMLElement;\r\n    aboutEl?: HTMLElement;\r\n    disableAutoFit?: boolean; // disable automatic Fit to View for small canvases\r\n}\r\n\r\nexport interface IReadPSD {\r\n    blob: Blob;\r\n    callback: (k: IKlProject | null) => void;\r\n}\r\n\r\n/**\r\n * Note: Wrapped by EmbedWrapper, which quickly provides feedback for the user without having loaded everything.\r\n * Embed runs when the main bundle is loaded. It instantiates Klecks.\r\n */\r\nexport class Embed {\r\n\r\n    private isInitialized: boolean = false;\r\n    private klApp: KlApp | undefined;\r\n    private readonly psdQueue: IReadPSD[] = []; // queue of psds waiting while ag-psd is loading\r\n    private agPsd: TAgPsd | 'error' | undefined;\r\n    private loadingScreenEl: HTMLElement | null;\r\n    private loadingScreenTextEl: HTMLElement | null;\r\n\r\n\r\n    onProjectReady (project: IKlProject) {\r\n        try {\r\n            if (this.isInitialized) {\r\n                throw new Error('Already called openProject');\r\n            }\r\n            this.isInitialized = true;\r\n\r\n            const saveReminder = new SaveReminder(\r\n                klHistory,\r\n                false,\r\n                false,\r\n                () => {},\r\n                () => this.klApp ? this.klApp.isDrawing() : false,\r\n                null,\r\n                null,\r\n            );\r\n            this.klApp = new KlApp(\r\n                project,\r\n                {\r\n                    saveReminder,\r\n                    bottomBar: this.p.bottomBar,\r\n                    aboutEl: this.p.aboutEl,\r\n                    embed: {\r\n                        url: this.p.embedUrl,\r\n                        onSubmit: this.p.onSubmit,\r\n                    },\r\n                }\r\n            );\r\n            saveReminder.init();\r\n\r\n            this.loadingScreenEl && this.loadingScreenEl.remove();\r\n            this.loadingScreenEl = null;\r\n            this.loadingScreenTextEl = null;\r\n\r\n            document.body.append(this.klApp.getEl());\r\n        } catch (e) {\r\n            if (this.loadingScreenTextEl) {\r\n                this.loadingScreenTextEl.textContent = ' ' + e;\r\n            }\r\n            if (this.loadingScreenEl) {\r\n                this.loadingScreenEl.className += 'loading-screen-error';\r\n            }\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    // ----- public ----------\r\n    constructor (private p: IEmbedParams) {\r\n\r\n        this.loadingScreenEl = document.getElementById('loading-screen');\r\n        this.loadingScreenTextEl = document.getElementById('loading-screen-text');\r\n        if (this.loadingScreenTextEl) {\r\n            this.loadingScreenTextEl.textContent = LANG('embed-init-waiting');\r\n        }\r\n\r\n        if (p.disableAutoFit) {\r\n            klConfig.disableAutoFit = true;\r\n        }\r\n        if (p.project) {\r\n            this.onProjectReady(p.project);\r\n        }\r\n    }\r\n\r\n    openProject: Embed['onProjectReady'] = (project) => {\r\n        this.onProjectReady(project);\r\n    };\r\n\r\n    initError (error: string) {\r\n        if (this.loadingScreenTextEl) {\r\n            this.loadingScreenTextEl.textContent = ' ' + error;\r\n        }\r\n        if (this.loadingScreenEl) {\r\n            this.loadingScreenEl.className += 'loading-screen-error';\r\n        }\r\n    }\r\n\r\n    getPNG (): Blob {\r\n        if (!this.klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return this.klApp.getPNG();\r\n    }\r\n\r\n    async getPSD (): Promise<Blob> {\r\n        if (!this.klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return await this.klApp.getPSD();\r\n    }\r\n\r\n    readPSDs (psds: IReadPSD[]) {\r\n        if (psds.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const readItem = (item: IReadPSD) => {\r\n            try {\r\n                const psd = (this.agPsd as any).readPsd(item.blob as any);\r\n                const project = klPsdToKlProject(readPsd(psd));\r\n                item.callback(project);\r\n            } catch (e) {\r\n                console.error('failed to read psd', e);\r\n                item.callback(null);\r\n            }\r\n        };\r\n\r\n        // library not loaded yet\r\n        if (!this.agPsd) {\r\n            if (this.psdQueue.length === 0) {\r\n                // load ag-psd\r\n                (async () => {\r\n                    try {\r\n                        this.agPsd = await loadAgPsd();\r\n                    } catch (e) {\r\n                        this.agPsd = 'error';\r\n                    }\r\n                    while (this.psdQueue.length) {\r\n                        readItem(this.psdQueue.shift()!);\r\n                    }\r\n                })();\r\n            }\r\n            psds.forEach(item => {\r\n                this.psdQueue.push(item);\r\n            });\r\n        } else {\r\n            psds.forEach(readItem);\r\n        }\r\n    }\r\n\r\n}\r\n",null,"import './polyfills-nomodule';\r\n\r\n/*\r\n * ---- Below ----------------------\r\n * features that didn't have support until *after* browsers supported the modules script tag:\r\n * Chrome 61\r\n * Edge 16\r\n * Safari 11\r\n * Firefox 60\r\n * https://caniuse.com/es6-module\r\n */\r\n\r\n// chrome 61, edge 79, safari 16, firefox 107\r\nif (!('scrollTo' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollTo', {\r\n        value: function (x: number, y: number) {\r\n            this.scrollLeft = x;\r\n            this.scrollTop = y;\r\n        },\r\n    });\r\n}\r\n\r\n// chrome 61, edge 79, safari 16, firefox 107\r\nif (!('scrollBy' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollBy', {\r\n        value: function (x: number, y: number) {\r\n            this.scrollLeft += x;\r\n            this.scrollTop += y;\r\n        },\r\n    });\r\n}\r\n\r\n// chrome 69, edge 79, safari 12, firefox 62\r\nif (!Array.prototype.flat) {\r\n    Object.defineProperty(Array.prototype, 'flat', {\r\n        configurable: true,\r\n        value: function flat (...args: any[]) {\r\n            const depth = isNaN(args[0]) ? 1 : Number(args[0]);\r\n\r\n            return depth ? Array.prototype.reduce.call(this, function (acc: any, cur) {\r\n                if (Array.isArray(cur)) {\r\n                    // eslint-disable-next-line prefer-spread\r\n                    acc.push.apply(acc, flat.call(cur, depth - 1));\r\n                } else {\r\n                    acc.push(cur);\r\n                }\r\n\r\n                return acc;\r\n            }, []) : Array.prototype.slice.call(this);\r\n        },\r\n        writable: true,\r\n    });\r\n}\r\n\r\n// Chrome 85, Firefox 77, Safari 13.1\r\n// if there are problems, maybe use core-js\r\nif (!String.prototype.replaceAll) {\r\n    Object.defineProperty(String.prototype, 'replaceAll', {\r\n        value: function (searchValue: string | RegExp, replaceValue: string): string {\r\n            if (typeof replaceValue === 'function') {\r\n                throw new Error('replaceAll polyfill does not support replaceValue: function');\r\n            }\r\n            return this.replace(new RegExp(searchValue, 'g'), replaceValue);\r\n        },\r\n    });\r\n}\r\n\r\n/*\r\n    Copyright 2018  Alfredo Mungo <alfredo.mungo@protonmail.ch>\r\n\r\n    Permission is hereby granted, free of charge, to any person obtaining a copy\r\n    of this software and associated documentation files (the \"Software\"), to\r\n    deal in the Software without restriction, including without limitation the\r\n    rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\r\n    sell copies of the Software, and to permit persons to whom the Software is\r\n    furnished to do so, subject to the following conditions:\r\n\r\n    The above copyright notice and this permission notice shall be included in\r\n    all copies or substantial portions of the Software.\r\n\r\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\r\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\r\n    IN THE SOFTWARE.\r\n*/\r\nif (!Object.fromEntries) {\r\n    Object.defineProperty(Object, 'fromEntries', {\r\n        value (entries: any) {\r\n            if (!entries || !entries[Symbol.iterator]) {\r\n                throw new Error('Object.fromEntries() requires a single iterable argument');\r\n            }\r\n            const o: any = {};\r\n            Object.keys(entries).forEach((key) => {\r\n                const [k, v] = entries[key];\r\n                o[k] = v;\r\n            });\r\n            return o;\r\n        },\r\n    });\r\n}\r\n\r\n// sometimes Android WebView has no localStorage\r\nif (!('localStorage' in window)) {\r\n    try {\r\n        (window as any).localStorage = {\r\n            getItem: () => null,\r\n            setItem: () => {},\r\n            removeItem: () => {},\r\n        };\r\n    } catch (e) {\r\n        // maybe it fails?\r\n    }\r\n}\r\n","/**\r\n * features that were available before module script tags:\r\n * chrome 61\r\n * edge 16\r\n * safari 11\r\n * firefox 60\r\n * https://caniuse.com/es6-module\r\n */\r\n\r\nimport 'mdn-polyfills/Node.prototype.append';\r\nimport 'mdn-polyfills/Node.prototype.prepend'; // edge 17 (one version after module)\r\nimport 'mdn-polyfills/String.prototype.padStart';\r\nimport 'mdn-polyfills/Array.prototype.findIndex';","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"append\")||Object.defineProperty(e,\"append\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(n,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"prepend\")||Object.defineProperty(e,\"prepend\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","String.prototype.padStart||(String.prototype.padStart=function(t,n){return t>>=0,n=String(n||\" \"),this.length>t?String(this):((t-=this.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(this))});\n","Array.prototype.findIndex||Object.defineProperty(Array.prototype,\"findIndex\",{value:function(r){if(null==this)throw new TypeError('\"this\" is null or not defined');var e=Object(this),t=e.length>>>0;if(\"function\"!=typeof r)throw new TypeError(\"predicate must be a function\");for(var n=arguments[1],o=0;o<t;){var i=e[o];if(r.call(n,i,o,e))return o;o++}return-1}});\n","import {KL} from '../klecks/kl';\r\nimport {klHistory, TMiscFocusLayerHistoryEntry} from '../klecks/history/kl-history';\r\nimport {BB} from '../bb/bb';\r\nimport {showIframeModal} from '../klecks/ui/modals/show-iframe-modal';\r\nimport {EmbedToolspaceTopRow} from '../embed/embed-toolspace-top-row';\r\nimport {\r\n    IGradient,\r\n    IInitState,\r\n    IKlProject, IRGB,\r\n    TDrawEvent,\r\n    TExportType,\r\n    TKlCanvasLayer,\r\n    TUiLayout,\r\n} from '../klecks/kl-types';\r\nimport {importFilters} from '../klecks/filters/filters-lazy';\r\nimport {base64ToBlob} from '../klecks/storage/base-64-to-blob';\r\nimport {klCanvasToPsdBlob} from '../klecks/storage/kl-canvas-to-psd-blob';\r\nimport {ProjectStore} from '../klecks/storage/project-store';\r\nimport {SaveReminder} from '../klecks/ui/components/save-reminder';\r\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\r\nimport {LANG} from '../language/language';\r\nimport {LocalStorage} from '../bb/base/local-storage';\r\nimport {LineSmoothing} from '../klecks/events/line-smoothing';\r\nimport {LineSanitizer} from '../klecks/events/line-sanitizer';\r\nimport {TabRow} from '../klecks/ui/components/tab-row';\r\nimport {LayerPreview} from '../klecks/ui/components/layer-preview';\r\nimport {KlColorSlider} from '../klecks/ui/components/kl-color-slider';\r\nimport {ToolspaceToolRow} from '../klecks/ui/components/toolspace-tool-row';\r\nimport {StatusOverlay} from '../klecks/ui/components/status-overlay';\r\nimport {SaveToComputer} from '../klecks/storage/save-to-computer';\r\nimport {ToolspaceCollapser} from '../klecks/ui/components/toolspace-collapser';\r\nimport {ToolspaceScroller} from '../klecks/ui/components/toolspace-scroller';\r\nimport {translateSmoothing} from '../klecks/utils/translate-smoothing';\r\nimport {ImportHandler} from './import-handler';\r\n\r\nimport toolPaintImg from '/src/app/img/ui/tool-paint.svg';\r\nimport toolHandImg from '/src/app/img/ui/tool-hand.svg';\r\nimport toolFillImg from '/src/app/img/ui/tool-fill.svg';\r\nimport toolGradientImg from '/src/app/img/ui/tool-gradient.svg';\r\nimport toolTextImg from '/src/app/img/ui/tool-text.svg';\r\nimport toolShapeImg from '/src/app/img/ui/tool-shape.svg';\r\nimport tabSettingsImg from '/src/app/img/ui/tab-settings.svg';\r\nimport tabLayersImg from '/src/app/img/ui/tab-layers.svg';\r\nimport {LayerManager} from '../klecks/ui/tool-tabs/layer-manager/layer-manager';\r\nimport {IVector2D} from '../bb/bb-types';\r\nimport {createConsoleApi} from './console-api';\r\nimport {ERASE_COLOR} from '../klecks/brushes/erase-color';\r\nimport {throwIfNull} from '../bb/base/base';\r\nimport {klConfig} from '../klecks/kl-config';\r\nimport {TRenderTextParam} from '../klecks/image-operations/render-text';\r\n\r\ntype KlAppOptionsEmbed = {\r\n    url: string;\r\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n};\r\n\r\ninterface IKlAppOptions {\r\n    saveReminder?: SaveReminder;\r\n    projectStore?: ProjectStore;\r\n    logoImg?: string; // app logo\r\n    bottomBar?: HTMLElement; // row at bottom of toolspace\r\n    embed?: KlAppOptionsEmbed;\r\n    app?: {\r\n        imgurKey?: string; // for imgur uploads\r\n    };\r\n    aboutEl?: HTMLElement; // replaces info about Klecks in settings tab\r\n}\r\n\r\nimportFilters();\r\n\r\nexport class KlApp {\r\n\r\n    private readonly klRootEl: HTMLElement;\r\n    private uiWidth: number;\r\n    private uiHeight: number;\r\n    private readonly layerPreview: LayerPreview;\r\n    private readonly klColorSlider: KlColorSlider;\r\n    private readonly toolspaceToolRow: ToolspaceToolRow;\r\n    private readonly statusOverlay: StatusOverlay;\r\n    private readonly klCanvas: KlCanvas;\r\n    private uiState: TUiLayout;\r\n    private readonly embed: undefined | KlAppOptionsEmbed;\r\n    private readonly saveToComputer: SaveToComputer;\r\n    private readonly lineSanitizer: LineSanitizer;\r\n    private readonly klCanvasWorkspace: KlCanvasWorkspace;\r\n    private readonly collapseThreshold: number = 820;\r\n    private readonly toolspaceCollapser: ToolspaceCollapser;\r\n    private readonly toolspace: HTMLElement;\r\n    private readonly toolspaceInner: HTMLElement;\r\n    private readonly toolWidth: number = 271;\r\n    private readonly bottomBar: HTMLElement | undefined;\r\n    private readonly layerManager: LayerManager;\r\n    private readonly toolspaceScroller: ToolspaceScroller;\r\n    private readonly bottomBarWrapper: HTMLElement;\r\n\r\n    private updateCollapse (): void {\r\n\r\n        //collapser\r\n        if (this.uiWidth < this.collapseThreshold) {\r\n            this.toolspaceCollapser.getElement().style.display = 'block';\r\n\r\n            this.toolspaceCollapser.setDirection(this.uiState);\r\n            if (this.toolspaceCollapser.isOpen()) {\r\n                if (this.uiState === 'left') {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '271px',\r\n                        right: '',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '271px',\r\n                    });\r\n                } else {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '271px',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '0',\r\n                    });\r\n                }\r\n                this.toolspace.style.display = 'block';\r\n                this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\r\n                this.statusOverlay.setWide(false);\r\n\r\n            } else {\r\n                if (this.uiState === 'left') {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '0',\r\n                        right: '',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '0',\r\n                    });\r\n                } else {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '0',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '0',\r\n                    });\r\n                }\r\n                this.toolspace.style.display = 'none';\r\n                this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth), this.uiHeight);\r\n                this.statusOverlay.setWide(true);\r\n\r\n            }\r\n\r\n        } else {\r\n            this.toolspaceCollapser.getElement().style.display = 'none';\r\n            if (this.uiState === 'left') {\r\n                BB.css(this.klCanvasWorkspace.getElement(), {\r\n                    left: '271px',\r\n                });\r\n            } else {\r\n                BB.css(this.klCanvasWorkspace.getElement(), {\r\n                    left: '0',\r\n                });\r\n            }\r\n            this.toolspace.style.display = 'block';\r\n            this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\r\n            this.statusOverlay.setWide(false);\r\n        }\r\n    }\r\n\r\n    private updateBottomBar (): void {\r\n        if (!this.bottomBar) {\r\n            return;\r\n        }\r\n        const isVisible = (this.toolspaceInner.scrollHeight + 40 < window.innerHeight);\r\n        this.bottomBarWrapper.style.display = isVisible ? '' : 'none';\r\n    }\r\n\r\n    private updateUi (): void {\r\n        this.toolspace.classList.toggle('kl-toolspace--left', this.uiState === 'left');\r\n        this.toolspace.classList.toggle('kl-toolspace--right', this.uiState === 'right');\r\n        if (this.uiState === 'left') {\r\n            BB.css(this.toolspace, {\r\n                left: '0',\r\n                right: '',\r\n            });\r\n            BB.css(this.klCanvasWorkspace.getElement(), {\r\n                left: '271px',\r\n            });\r\n        } else {\r\n            BB.css(this.toolspace, {\r\n                left: '',\r\n                right: '0',\r\n            });\r\n            BB.css(this.klCanvasWorkspace.getElement(), {\r\n                left: '0',\r\n            });\r\n        }\r\n        this.statusOverlay.setUiState(this.uiState);\r\n        this.layerPreview.setUiState(this.uiState);\r\n        this.layerManager.setUiState(this.uiState);\r\n        this.updateCollapse();\r\n        this.toolspaceScroller.updateUiState(this.uiState);\r\n    }\r\n\r\n    // -------- public --------\r\n    constructor (\r\n        pProject: IKlProject | null,\r\n        pOptions: IKlAppOptions,\r\n    ) {\r\n        this.embed = pOptions.embed;\r\n        // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\r\n        // but not larger than 4096 - a fairly arbitrary decision\r\n        const klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\r\n        this.uiState = (this.embed ? 'left' : (LocalStorage.getItem('uiState') ? LocalStorage.getItem('uiState') : 'right')) as TUiLayout;\r\n        const projectStore = pOptions.projectStore;\r\n        this.klRootEl = BB.el({\r\n            className: 'g-root',\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n            },\r\n        });\r\n        this.uiWidth = Math.max(0, window.innerWidth);\r\n        this.uiHeight = Math.max(0, window.innerHeight);\r\n        let exportType: TExportType = 'png';\r\n        this.klCanvas = new KL.KlCanvas(\r\n            pProject ? {\r\n                projectObj: pProject,\r\n            } : {\r\n                width: Math.max(10, Math.min(klMaxCanvasSize, window.innerWidth < this.collapseThreshold ? this.uiWidth : this.uiWidth - this.toolWidth)),\r\n                height: Math.max(10, Math.min(klMaxCanvasSize, this.uiHeight)),\r\n            }, this.embed ? -1 : 0);\r\n        this.klCanvas.setHistory(klHistory);\r\n        let initState: IInitState;\r\n        let mainTabRow: TabRow | undefined = undefined;\r\n\r\n        if (!pOptions.saveReminder) {\r\n            pOptions.saveReminder = {init: () => {}, reset: () => {}} as SaveReminder;\r\n        }\r\n\r\n        if (pProject) {\r\n            // attempt at freeing memory\r\n            pProject.layers.forEach(layer => {\r\n                layer.image = null as any;\r\n            });\r\n            pProject = null;\r\n        } else {\r\n            klHistory.pause(true);\r\n            this.klCanvas.addLayer();\r\n            this.klCanvas.layerFill(0, {r: ERASE_COLOR, g: ERASE_COLOR, b: ERASE_COLOR});\r\n            klHistory.pause(false);\r\n        }\r\n        try {\r\n            initState = {\r\n                canvas: new KL.KlCanvas({copy: this.klCanvas}, this.embed ? -1 : 0),\r\n                focus: this.klCanvas.getLayerCount() - 1,\r\n                brushes: {},\r\n            };\r\n        } catch (e) {\r\n            if ((e as Error).message === 'kl-create-canvas-error') {\r\n                this.klCanvas.destroy();\r\n            }\r\n            throw e;\r\n        }\r\n        Object.entries(KL.brushes).forEach(([b, Brush]) => {\r\n            initState.brushes[b] = new Brush();\r\n            if (initState.canvas) {\r\n                initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\r\n            }\r\n        });\r\n\r\n\r\n        let currentColor = new BB.RGB(0, 0, 0);\r\n        let currentBrushUi: any; // todo\r\n        let currentBrushId: string;\r\n        let lastNonEraserBrushId: string;\r\n        let currentLayerCtx = throwIfNull(this.klCanvas.getLayerContext(this.klCanvas.getLayerCount() - 1));\r\n\r\n        // when cycling through brushes you need to know the next non-eraser brush\r\n        const getNextBrushId = (): string => {\r\n            if (currentBrushId === 'eraserBrush') {\r\n                return lastNonEraserBrushId;\r\n            }\r\n            const keyArr = Object.keys(brushUiMap).filter(item => item !== 'eraserBrush');\r\n            const i = keyArr.findIndex(item => item === currentBrushId);\r\n            return keyArr[(i + 1) % keyArr.length];\r\n        };\r\n\r\n        const sizeWatcher = (val: number) => {\r\n            brushSettingService.emitSize(val);\r\n            if (this.klCanvasWorkspace) {\r\n                this.klCanvasWorkspace.setCursorSize(val * 2);\r\n            }\r\n        };\r\n\r\n        const brushSettingService = new KL.BrushSettingService(\r\n            (color) => {\r\n                this.klColorSlider.setColor(color);\r\n                currentBrushUi.setColor(color);\r\n                currentColor = BB.copyObj(color);\r\n            },\r\n            (size) => {\r\n                currentBrushUi.setSize(size);\r\n                this.klCanvasWorkspace.setCursorSize(size * 2);\r\n            },\r\n            (opacity) => {\r\n                currentBrushUi.setOpacity(opacity);\r\n            },\r\n            () => this.klColorSlider.getColor(),\r\n            () => brushUiMap[currentBrushId].getSize(),\r\n            () => brushUiMap[currentBrushId].getOpacity(),\r\n            () => {\r\n                return {\r\n                    sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                    opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\r\n                };\r\n            }\r\n        );\r\n\r\n        const lineSmoothing = new LineSmoothing({\r\n            smoothing: translateSmoothing(1),\r\n        });\r\n        this.lineSanitizer = new LineSanitizer();\r\n\r\n        const drawEventChain = new BB.EventChain({\r\n            chainArr: [\r\n                this.lineSanitizer as any,\r\n                lineSmoothing as any,\r\n            ],\r\n        });\r\n\r\n        drawEventChain.setChainOut(((event: TDrawEvent) => {\r\n            if (event.type === 'down') {\r\n                this.toolspace.style.pointerEvents = 'none';\r\n                currentBrushUi.startLine(event.x, event.y, event.pressure);\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n            if (event.type === 'move') {\r\n                currentBrushUi.goLine(event.x, event.y, event.pressure, false, event.isCoalesced);\r\n                this.klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n            if (event.type === 'up') {\r\n                this.toolspace.style.pointerEvents = '';\r\n                currentBrushUi.endLine();\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n            if (event.type === 'line') {\r\n                currentBrushUi.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n        }) as any);\r\n\r\n        let textToolSettings = {\r\n            size: 20,\r\n            align: 'left' as ('left' | 'center' | 'right'),\r\n            isBold: false,\r\n            isItalic: false,\r\n            font: 'sans-serif',\r\n            letterSpacing: 0,\r\n            lineHeight: 1,\r\n            fill: {\r\n                color: {r: 0, g: 0, b: 0, a: 1},\r\n            },\r\n        } as TRenderTextParam;\r\n\r\n        this.klCanvasWorkspace = new KL.KlCanvasWorkspace({\r\n            klCanvas: this.klCanvas,\r\n            width: Math.max(0, this.uiWidth - this.toolWidth),\r\n            height: this.uiHeight,\r\n            onDraw: (e) => drawEventChain.chainIn(e as any),\r\n            onPick: (rgbObj, isDragDone) => {\r\n                brushSettingService.setColor(rgbObj);\r\n                if (isDragDone) {\r\n                    this.klColorSlider.pickingDone();\r\n                    this.klCanvasWorkspace.setMode(this.toolspaceToolRow.getActive());\r\n                }\r\n            },\r\n            onFill: (canvasX, canvasY) => {\r\n                const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\r\n                this.klCanvas.floodFill(\r\n                    layerIndex,\r\n                    canvasX,\r\n                    canvasY,\r\n                    fillUi.getIsEraser() ? null : this.klColorSlider.getColor(),\r\n                    fillUi.getOpacity(),\r\n                    fillUi.getTolerance(),\r\n                    fillUi.getSample(),\r\n                    fillUi.getGrow(),\r\n                    fillUi.getContiguous()\r\n                );\r\n                this.klCanvasWorkspace.requestFrame();\r\n            },\r\n            onGradient: (typeStr, canvasX, canvasY, angleRad) => {\r\n                if (typeStr === 'down') {\r\n                    gradientTool.onDown(canvasX, canvasY, angleRad);\r\n                }\r\n                if (typeStr === 'move') {\r\n                    gradientTool.onMove(canvasX, canvasY);\r\n                }\r\n                if (typeStr === 'up') {\r\n                    gradientTool.onUp(canvasX, canvasY);\r\n                }\r\n            },\r\n            onText: (canvasX, canvasY, angleRad) => {\r\n                if (KL.dialogCounter.get() > 0) {\r\n                    return;\r\n                }\r\n\r\n                KL.textToolDialog({\r\n                    klCanvas: this.klCanvas,\r\n                    layerIndex: throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)),\r\n                    primaryColor: this.klColorSlider.getColor(),\r\n                    secondaryColor: this.klColorSlider.getSecondaryRGB(),\r\n\r\n                    text: {\r\n                        ...textToolSettings,\r\n                        text: '',\r\n                        x: canvasX,\r\n                        y: canvasY,\r\n                        angleRad: angleRad,\r\n                        fill : textToolSettings.fill ? {\r\n                            color: {\r\n                                ...this.klColorSlider.getColor(),\r\n                                a: textToolSettings.fill.color.a,\r\n                            },\r\n                        } : undefined,\r\n                        stroke : textToolSettings.stroke ? {\r\n                            ...textToolSettings.stroke,\r\n                            color: {\r\n                                ...this.klColorSlider.getSecondaryRGB(),\r\n                                a: textToolSettings.stroke.color.a,\r\n                            },\r\n                        } : undefined,\r\n                    },\r\n\r\n                    onConfirm: (val) => {\r\n                        textToolSettings = {\r\n                            ...val,\r\n                            text: '',\r\n                        };\r\n                        const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\r\n                        this.klCanvas.text(layerIndex, val);\r\n                        this.klCanvasWorkspace.requestFrame();\r\n                    },\r\n                });\r\n\r\n            },\r\n            onShape: (typeStr, canvasX, canvasY, angleRad) => {\r\n                if (typeStr === 'down') {\r\n                    shapeTool.onDown(canvasX, canvasY, angleRad);\r\n                }\r\n                if (typeStr === 'move') {\r\n                    shapeTool.onMove(canvasX, canvasY);\r\n                }\r\n                if (typeStr === 'up') {\r\n                    shapeTool.onUp(canvasX, canvasY);\r\n                }\r\n            },\r\n\r\n            onViewChange: (viewChangeObj) => {\r\n\r\n                if (viewChangeObj.changed.includes('scale')) {\r\n                    this.statusOverlay.out({\r\n                        type: 'transform',\r\n                        scale: viewChangeObj.scale,\r\n                        angleDeg: viewChangeObj.angle * 180 / Math.PI,\r\n                    });\r\n                }\r\n\r\n                this.toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== this.klCanvasWorkspace.getMaxScale());\r\n                this.toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== this.klCanvasWorkspace.getMinScale());\r\n\r\n                handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\r\n            },\r\n            onUndo: () => {\r\n                if (klHistory.canUndo()) {\r\n                    if (undoRedoCatchup.undo()) {\r\n                        this.statusOverlay.out(LANG('undo'), true);\r\n                    }\r\n                }\r\n            },\r\n            onRedo: () => {\r\n                if (klHistory.canRedo()) {\r\n                    if (undoRedoCatchup.redo()) {\r\n                        this.statusOverlay.out(LANG('redo'), true);\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        const updateMainTabVisibility = () => {\r\n            if (!mainTabRow) {\r\n                return;\r\n            }\r\n\r\n            const toolObj = {\r\n                'draw': {},\r\n                'hand': {},\r\n                'fill': {},\r\n                'gradient': {},\r\n                'text': {},\r\n                'shape': {},\r\n            };\r\n\r\n            const activeStr = this.toolspaceToolRow.getActive();\r\n            const oldTabId = mainTabRow.getOpenedTabId();\r\n\r\n            const keysArr = Object.keys(toolObj);\r\n            for (let i = 0; i < keysArr.length; i++) {\r\n                if (activeStr === keysArr[i]) {\r\n                    mainTabRow.setIsVisible(keysArr[i], true);\r\n                } else {\r\n                    mainTabRow.setIsVisible(keysArr[i], false);\r\n                    if (oldTabId === keysArr[i]) {\r\n                        mainTabRow.open(activeStr);\r\n                    }\r\n                }\r\n            }\r\n\r\n        };\r\n\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr) => {\r\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n\r\n                const isDrawing = this.lineSanitizer.getIsDrawing() || this.klCanvasWorkspace.getIsDrawing();\r\n                if (isDrawing) {\r\n                    return;\r\n                }\r\n\r\n                if (comboStr === 'plus') {\r\n                    this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n                }\r\n                if (comboStr === 'minus') {\r\n                    this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n                }\r\n                if (comboStr === 'home') {\r\n                    this.klCanvasWorkspace.fitView(true);\r\n                }\r\n                if (comboStr === 'end') {\r\n                    this.klCanvasWorkspace.resetView(true);\r\n                }\r\n                if (['ctrl+z', 'cmd+z'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    undoRedoCatchup.undo();\r\n                }\r\n                if (\r\n                    ['ctrl+y', 'cmd+y'].includes(comboStr) ||\r\n                    (\r\n                        (\r\n                            BB.sameKeys('ctrl+shift+z', comboStr) ||\r\n                            BB.sameKeys('cmd+shift+z', comboStr)\r\n                        ) && keyStr === 'z'\r\n                    )\r\n                ) {\r\n                    event.preventDefault();\r\n                    undoRedoCatchup.redo();\r\n                }\r\n                if (!this.embed) {\r\n                    if (['ctrl+s', 'cmd+s'].includes(comboStr)) {\r\n                        event.preventDefault();\r\n                        this.saveToComputer.save();\r\n                    }\r\n                    if (['ctrl+shift+s', 'cmd+shift+s'].includes(comboStr)) {\r\n                        event.preventDefault();\r\n\r\n                        (async () => {\r\n                            let success = true;\r\n                            try {\r\n                                await projectStore!.store(this.klCanvas.getProject());\r\n                            } catch (e) {\r\n                                success = false;\r\n                                setTimeout(() => {\r\n                                    throw new Error('keyboard-shortcut: failed to store browser storage, ' + e);\r\n                                }, 0);\r\n                                this.statusOverlay.out(' ' + LANG('file-storage-failed'), true);\r\n                            }\r\n                            if (success) {\r\n                                pOptions.saveReminder!.reset();\r\n                                this.statusOverlay.out(LANG('file-storage-stored'), true);\r\n                            }\r\n                        })();\r\n                    }\r\n                    if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\r\n                        event.preventDefault();\r\n                        copyToClipboard(true);\r\n                    }\r\n                }\r\n                if (['ctrl+a', 'cmd+a'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                }\r\n\r\n\r\n                if (keyListener.comboOnlyContains(['left', 'right', 'up', 'down'])) {\r\n                    if (keyStr === 'left') {\r\n                        this.klCanvasWorkspace.translateView(1, 0);\r\n                    }\r\n                    if (keyStr === 'right') {\r\n                        this.klCanvasWorkspace.translateView(-1, 0);\r\n                    }\r\n                    if (keyStr === 'up') {\r\n                        this.klCanvasWorkspace.translateView(0, 1);\r\n                    }\r\n                    if (keyStr === 'down') {\r\n                        this.klCanvasWorkspace.translateView(0, -1);\r\n                    }\r\n                }\r\n\r\n\r\n                if (['r+left','r+right'].includes(comboStr)) {\r\n                    if (keyStr === 'left') {\r\n                        this.klCanvasWorkspace.setAngle(-15, true);\r\n                        handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                    if (keyStr === 'right') {\r\n                        this.klCanvasWorkspace.setAngle(15, true);\r\n                        handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                }\r\n                if (['r+up'].includes(comboStr)) {\r\n                    this.klCanvasWorkspace.setAngle(0);\r\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                }\r\n\r\n\r\n                if (comboStr === 'sqbr_open') {\r\n                    currentBrushUi.decreaseSize(0.03 / this.klCanvasWorkspace.getScale());\r\n                }\r\n                if (comboStr === 'sqbr_close') {\r\n                    currentBrushUi.increaseSize(0.03 / this.klCanvasWorkspace.getScale());\r\n                }\r\n                if (comboStr === 'enter') {\r\n                    this.klCanvas.layerFill(\r\n                        throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)),\r\n                        this.klColorSlider.getColor(),\r\n                    );\r\n                    this.statusOverlay.out(LANG('filled'), true);\r\n                }\r\n                if (['delete', 'backspace'].includes(comboStr)) {\r\n                    const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\r\n                    if (layerIndex === 0 && !brushUiMap.eraserBrush.getIsTransparentBg()) {\r\n                        this.klCanvas.layerFill(layerIndex, {r: 255, g: 255, b: 255}, 'source-in');\r\n                    } else {\r\n                        this.klCanvas.clearLayer(layerIndex);\r\n                    }\r\n                    this.statusOverlay.out(LANG('cleared-layer'), true);\r\n                }\r\n                if (comboStr === 'shift+e') {\r\n                    event.preventDefault();\r\n                    currentBrushUi.toggleEraser && currentBrushUi.toggleEraser();\r\n\r\n                } else if (comboStr === 'e') {\r\n                    event.preventDefault();\r\n                    this.klCanvasWorkspace.setMode('draw');\r\n                    this.toolspaceToolRow.setActive('draw');\r\n                    mainTabRow && mainTabRow.open('draw');\r\n                    updateMainTabVisibility();\r\n                    brushTabRow.open('eraserBrush');\r\n                }\r\n                if (comboStr === 'b') {\r\n                    event.preventDefault();\r\n                    const prevMode = this.klCanvasWorkspace.getMode();\r\n                    this.klCanvasWorkspace.setMode('draw');\r\n                    this.toolspaceToolRow.setActive('draw');\r\n                    mainTabRow && mainTabRow.open('draw');\r\n                    updateMainTabVisibility();\r\n                    brushTabRow.open(prevMode === 'draw' ? getNextBrushId() : currentBrushId);\r\n                }\r\n                if (comboStr === 'g') {\r\n                    event.preventDefault();\r\n                    const newMode = this.klCanvasWorkspace.getMode() === 'fill' ? 'gradient' : 'fill';\r\n                    this.klCanvasWorkspace.setMode(newMode);\r\n                    this.toolspaceToolRow.setActive(newMode);\r\n                    mainTabRow && mainTabRow.open(newMode);\r\n                    updateMainTabVisibility();\r\n                }\r\n                if (comboStr === 't') {\r\n                    event.preventDefault();\r\n                    this.klCanvasWorkspace.setMode('text');\r\n                    this.toolspaceToolRow.setActive('text');\r\n                    mainTabRow && mainTabRow.open('text');\r\n                    updateMainTabVisibility();\r\n                }\r\n                if (comboStr === 'u') {\r\n                    event.preventDefault();\r\n                    this.klCanvasWorkspace.setMode('shape');\r\n                    this.toolspaceToolRow.setActive('shape');\r\n                    mainTabRow && mainTabRow.open('shape');\r\n                    updateMainTabVisibility();\r\n                }\r\n                if (comboStr === 'x') {\r\n                    event.preventDefault();\r\n                    this.klColorSlider.swapColors();\r\n                }\r\n\r\n\r\n            },\r\n            onUp: (keyStr, event) => {\r\n            },\r\n        });\r\n\r\n        const brushUiMap: {\r\n            [key: string]: any;\r\n        } = {};\r\n        // create brush UIs\r\n        Object.entries(KL.brushesUI).forEach(([b, brushUi]) => {\r\n            const ui = new (brushUi.Ui as any)({\r\n                onSizeChange: sizeWatcher,\r\n                onOpacityChange: (opacity: number) => {\r\n                    brushSettingService.emitOpacity(opacity);\r\n                },\r\n                onConfigChange: () => {\r\n                    brushSettingService.emitSliderConfig({\r\n                        sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                        opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\r\n                    });\r\n                },\r\n            });\r\n            brushUiMap[b] = ui;\r\n            ui.getElement().style.padding = 10 + 'px';\r\n        });\r\n\r\n        this.statusOverlay = new KL.StatusOverlay();\r\n\r\n        this.toolspace = BB.el({\r\n            className: 'kl-toolspace',\r\n            css: {\r\n                position: 'absolute',\r\n                right: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                width: (this.toolWidth) + 'px',\r\n                overflow: 'hidden',\r\n                userSelect: 'none',\r\n                touchAction: 'none',\r\n            },\r\n        });\r\n        this.toolspaceInner = BB.el({\r\n            parent: this.toolspace,\r\n        });\r\n        this.toolspace.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n        this.toolspace.onclick = BB.handleClick;\r\n\r\n\r\n        this.toolspaceCollapser = new KL.ToolspaceCollapser({\r\n            onChange: () => {\r\n                this.updateCollapse();\r\n            },\r\n        });\r\n\r\n        this.updateCollapse();\r\n\r\n\r\n\r\n\r\n\r\n        let overlayToolspace;\r\n        setTimeout(() => {\r\n            overlayToolspace = new KL.OverlayToolspace({\r\n                enabledTest: () => {\r\n                    return KL.dialogCounter.get() === 0 && !this.lineSanitizer.getIsDrawing();\r\n                },\r\n                brushSettingService,\r\n            });\r\n            this.klRootEl.append(overlayToolspace.getElement());\r\n        }, 0);\r\n\r\n        BB.append(\r\n            this.klRootEl,\r\n            [\r\n                this.klCanvasWorkspace.getElement(),\r\n                this.toolspace,\r\n                this.toolspaceCollapser.getElement(),\r\n            ]\r\n        );\r\n\r\n        let toolspaceTopRow;\r\n        if (this.embed) {\r\n            toolspaceTopRow = new EmbedToolspaceTopRow({\r\n                onHelp: () => {\r\n                    showIframeModal(this.embed!.url + '/help.html', !!this.embed);\r\n                },\r\n                onSubmit: () => {\r\n                    const onFailure = () => {\r\n                        let closeFunc: () => void;\r\n                        const saveBtn = BB.el({\r\n                            tagName: 'button',\r\n                            textContent: LANG('save-reminder-save-psd'),\r\n                            css: {\r\n                                display: 'block',\r\n                            },\r\n                        });\r\n                        saveBtn.onclick = () => {\r\n                            this.saveAsPsd();\r\n                            closeFunc();\r\n                        };\r\n                        KL.popup({\r\n                            target: this.klRootEl,\r\n                            message: '<b>' + LANG('upload-failed') + '</b>',\r\n                            div: BB.el({\r\n                                    content: [\r\n                                        BB.el({\r\n                                            content: LANG('backup-drawing'),\r\n                                            css: {\r\n                                                marginBottom: '10px',\r\n                                            },\r\n                                        }),\r\n                                        saveBtn,\r\n                                    ],\r\n                                }),\r\n                            ignoreBackground: true,\r\n                            closeFunc: (f) => {\r\n                                closeFunc = f;\r\n                            },\r\n                        });\r\n                    };\r\n\r\n                    KL.popup({\r\n                        target: this.klRootEl,\r\n                        message: LANG('submit-prompt'),\r\n                        buttons: [LANG('submit'), 'Cancel'],\r\n                        callback: async (result) => {\r\n                            if (result !== LANG('submit')) {\r\n                                return;\r\n                            }\r\n\r\n                            const overlay = BB.el({\r\n                                parent: this.klRootEl,\r\n                                className: 'upload-overlay',\r\n                                content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\r\n                            });\r\n\r\n                            this.embed!.onSubmit(\r\n                                () => {\r\n                                    pOptions.saveReminder!.reset();\r\n                                    overlay.remove();\r\n                                },\r\n                                () => {\r\n                                    overlay.remove();\r\n                                    onFailure();\r\n                                });\r\n                        },\r\n                    });\r\n                },\r\n                onLeftRight: () => {\r\n                    this.uiState = this.uiState === 'left' ? 'right' : 'left';\r\n                    this.updateUi();\r\n                },\r\n            });\r\n        } else {\r\n            toolspaceTopRow = new KL.ToolspaceTopRow({\r\n                logoImg: pOptions.logoImg!,\r\n                onLogo: () => {\r\n                    showIframeModal('./home/', !!this.embed);\r\n                },\r\n                onNew: () => {\r\n                    showNewImageDialog();\r\n                },\r\n                onImport: () => {\r\n                    fileTab!.triggerImport();\r\n                },\r\n                onSave: () => {\r\n                    this.saveToComputer.save();\r\n                },\r\n                onShare: () => {\r\n                    shareImage();\r\n                },\r\n                onHelp: () => {\r\n                    showIframeModal('./help/', !!this.embed);\r\n                },\r\n            });\r\n        }\r\n        toolspaceTopRow.getElement().style.marginBottom = '10px';\r\n        this.toolspaceInner.append(toolspaceTopRow.getElement());\r\n\r\n        this.toolspaceToolRow = new KL.ToolspaceToolRow({\r\n            onActivate: (activeStr) => {\r\n                if (activeStr === 'draw') {\r\n                    this.klCanvasWorkspace.setMode('draw');\r\n                } else if (activeStr === 'hand') {\r\n                    this.klCanvasWorkspace.setMode('hand');\r\n                } else if (activeStr === 'fill') {\r\n                    this.klCanvasWorkspace.setMode('fill');\r\n                } else if (activeStr === 'gradient') {\r\n                    this.klCanvasWorkspace.setMode('gradient');\r\n                } else if (activeStr === 'text') {\r\n                    this.klCanvasWorkspace.setMode('text');\r\n                } else if (activeStr === 'shape') {\r\n                    this.klCanvasWorkspace.setMode('shape');\r\n                } else {\r\n                    throw new Error('unknown activeStr');\r\n                }\r\n                mainTabRow && mainTabRow.open(activeStr);\r\n                updateMainTabVisibility();\r\n                this.klColorSlider.pickingDone();\r\n            },\r\n            onZoomIn: () => {\r\n                this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n            },\r\n            onZoomOut: () => {\r\n                this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n            },\r\n            onUndo: () => {\r\n                undoRedoCatchup.undo();\r\n            },\r\n            onRedo: () => {\r\n                undoRedoCatchup.redo();\r\n            },\r\n        });\r\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\r\n        klHistory.addListener(() => {\r\n            this.toolspaceToolRow.setEnableUndo(klHistory.canUndo());\r\n            this.toolspaceToolRow.setEnableRedo(klHistory.canRedo());\r\n        });\r\n        this.toolspaceInner.append(this.toolspaceToolRow.getElement());\r\n\r\n        const setBrushColor = (p_color: IRGB) => {\r\n            currentColor = p_color;\r\n            currentBrushUi.setColor(p_color);\r\n            brushSettingService.emitColor(p_color);\r\n            this.klColorSlider.pickingDone();\r\n        };\r\n\r\n        this.klColorSlider = new KL.KlColorSlider({\r\n            width: 250,\r\n            height: 30,\r\n            svHeight: 100,\r\n            startValue: new BB.RGB(0, 0, 0),\r\n            onPick: setBrushColor,\r\n        });\r\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\r\n        this.klColorSlider.setPickCallback((doPick) => {\r\n\r\n            if (doPick) {\r\n                this.klCanvasWorkspace.setMode('pick');\r\n            } else {\r\n                this.klCanvasWorkspace.setMode(this.toolspaceToolRow.getActive());\r\n                updateMainTabVisibility();\r\n            }\r\n\r\n        });\r\n\r\n        const setCurrentBrush = (brushId: string) => {\r\n            if (brushId !== 'eraserBrush') {\r\n                lastNonEraserBrushId = brushId;\r\n            }\r\n\r\n            if (this.klColorSlider) {\r\n                if (brushId === 'eraserBrush') {\r\n                    this.klColorSlider.enable(false);\r\n                } else {\r\n                    this.klColorSlider.enable(true);\r\n                }\r\n            }\r\n\r\n            currentBrushId = brushId;\r\n            currentBrushUi = brushUiMap[brushId];\r\n            currentBrushUi.setColor(currentColor);\r\n            currentBrushUi.setContext(currentLayerCtx);\r\n            this.klCanvasWorkspace.setMode('draw');\r\n            this.toolspaceToolRow.setActive('draw');\r\n            updateMainTabVisibility();\r\n        };\r\n\r\n        const setCurrentLayer = (layer: TKlCanvasLayer) => { //BrushContext(p_context) {\r\n            currentLayerCtx = layer.context;\r\n            currentBrushUi.setContext(layer.context);\r\n            this.layerPreview.setLayer(layer);\r\n        };\r\n\r\n        const brushDiv = BB.el();\r\n        const colorDiv = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'flex-end',\r\n            },\r\n        });\r\n        const toolspaceStabilizerRow = new KL.ToolspaceStabilizerRow({\r\n            smoothing: 1,\r\n            onSelect: (v) => {\r\n                lineSmoothing.setSmoothing(translateSmoothing(v));\r\n            },\r\n        });\r\n\r\n\r\n        brushDiv.append(colorDiv);\r\n        BB.append(\r\n            colorDiv,\r\n            [this.klColorSlider.getElement(), this.klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n        );\r\n\r\n        const brushTabRow = new KL.TabRow({\r\n            initialId: 'penBrush',\r\n            useAccent: true,\r\n            tabArr: (() => {\r\n                const result = [];\r\n\r\n                const createTab = (keyStr: string) => {\r\n                    return {\r\n                        id: keyStr,\r\n                        image: KL.brushesUI[keyStr].image,\r\n                        title: KL.brushesUI[keyStr].tooltip,\r\n                        onOpen: () => {\r\n                            brushUiMap[keyStr].getElement().style.display = 'block';\r\n                            setCurrentBrush(keyStr);\r\n                            this.klColorSlider.pickingDone();\r\n                            brushSettingService.emitSliderConfig({\r\n                                sizeSlider: KL.brushesUI[keyStr].sizeSlider,\r\n                                opacitySlider: KL.brushesUI[keyStr].opacitySlider,\r\n                            });\r\n                            sizeWatcher(brushUiMap[keyStr].getSize());\r\n                            brushSettingService.emitOpacity(brushUiMap[keyStr].getOpacity());\r\n                        },\r\n                        onClose: () => {\r\n                            brushUiMap[keyStr].getElement().style.display = 'none';\r\n                        },\r\n                    };\r\n                };\r\n\r\n                const keyArr = Object.keys(brushUiMap);\r\n                for (let i = 0; i < keyArr.length; i++) {\r\n                    result.push(createTab(keyArr[i]));\r\n                }\r\n                return result;\r\n            })(),\r\n        });\r\n        BB.append(brushDiv, [\r\n            brushTabRow.getElement(),\r\n            ...Object.entries(KL.brushesUI).map(([b]) => brushUiMap[b].getElement()),\r\n        ]);\r\n\r\n        const handUi = new KL.HandUi({\r\n            scale: this.klCanvasWorkspace.getScale(),\r\n            angleDeg: 0,\r\n            onReset: () => {\r\n                this.klCanvasWorkspace.resetView(true);\r\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n            },\r\n            onFit: () => {\r\n                this.klCanvasWorkspace.fitView(true);\r\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n            },\r\n            onAngleChange: (angleDeg, isRelative) => {\r\n                this.klCanvasWorkspace.setAngle(angleDeg, isRelative);\r\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n            },\r\n        });\r\n\r\n        const fillUi = new KL.FillUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const gradientUi = new KL.GradientUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const textUi = new KL.TextUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const shapeUi = new KL.ShapeUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const gradientTool = new KL.GradientTool({\r\n            onGradient: (isDone, x1, y1, x2, y2, angleRad) => {\r\n                const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\r\n                const settings = gradientUi.getSettings();\r\n                const gradientObj: IGradient = {\r\n                    type: settings.type,\r\n                    color1: this.klColorSlider.getColor(),\r\n                    isReversed: settings.isReversed,\r\n                    opacity: settings.opacity,\r\n                    doLockAlpha: settings.doLockAlpha,\r\n                    isEraser: settings.isEraser,\r\n                    doSnap: keyListener.isPressed('shift') || settings.doSnap,\r\n                    x1,\r\n                    y1,\r\n                    x2,\r\n                    y2,\r\n                    angleRad,\r\n                };\r\n\r\n                if (isDone) {\r\n                    this.klCanvas.setComposite(layerIndex, null);\r\n                    this.klCanvas.drawGradient(layerIndex, gradientObj);\r\n                } else {\r\n                    this.klCanvas.setComposite(layerIndex, {\r\n                        draw: (ctx) => {\r\n                            KL.drawGradient(ctx, gradientObj);\r\n                        },\r\n                    });\r\n                }\r\n                this.klCanvasWorkspace.requestFrame();\r\n            },\r\n        });\r\n\r\n        const shapeTool = new KL.ShapeTool({\r\n            onShape: (isDone, x1, y1, x2, y2, angleRad) => {\r\n\r\n                const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\r\n\r\n                const shapeObj: any = {\r\n                    type: shapeUi.getShape(),\r\n                    x1: x1,\r\n                    y1: y1,\r\n                    x2: x2,\r\n                    y2: y2,\r\n                    angleRad: angleRad,\r\n                    isOutwards: shapeUi.getIsOutwards(),\r\n                    opacity: shapeUi.getOpacity(),\r\n                    isEraser: shapeUi.getIsEraser(),\r\n                    doLockAlpha: shapeUi.getDoLockAlpha(),\r\n                };\r\n                if (shapeUi.getShape() === 'line') {\r\n                    shapeObj.strokeRgb = this.klColorSlider.getColor();\r\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                    shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed('shift');\r\n                } else {\r\n                    shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed('shift');\r\n                    if (shapeUi.getMode() === 'stroke') {\r\n                        shapeObj.strokeRgb = this.klColorSlider.getColor();\r\n                        shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                    } else {\r\n                        shapeObj.fillRgb = this.klColorSlider.getColor();\r\n                    }\r\n                }\r\n\r\n                if (isDone) {\r\n                    this.klCanvas.setComposite(layerIndex, null);\r\n                    this.klCanvas.drawShape(layerIndex, shapeObj);\r\n                } else {\r\n                    this.klCanvas.setComposite(layerIndex, {\r\n                        draw: (ctx) => {\r\n                            KL.drawShape(ctx, shapeObj);\r\n                        },\r\n                    });\r\n                }\r\n                this.klCanvasWorkspace.requestFrame();\r\n\r\n            },\r\n        });\r\n\r\n        this.layerManager = new KL.LayerManager(\r\n            this.klCanvas,\r\n            (val) => {\r\n                setCurrentLayer(throwIfNull(this.klCanvas.getLayer(val)));\r\n                klHistory.push({\r\n                    tool: ['misc'],\r\n                    action: 'focusLayer',\r\n                    params: [val],\r\n                } as TMiscFocusLayerHistoryEntry);\r\n            },\r\n            this.klRootEl,\r\n            this.uiState,\r\n        );\r\n        this.layerPreview = new KL.LayerPreview({\r\n            klRootEl: this.klRootEl,\r\n            onClick: () => {\r\n                mainTabRow && mainTabRow.open('layers');\r\n            },\r\n            uiState: this.uiState,\r\n        });\r\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\r\n        this.layerPreview.setLayer(this.klCanvas.getLayer(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)!)!);\r\n\r\n        const filterTab = new KL.FilterTab(\r\n            this.klRootEl,\r\n            this.klColorSlider,\r\n            this.layerManager,\r\n            this.klCanvasWorkspace,\r\n            handUi,\r\n            () => currentColor,\r\n            () => klMaxCanvasSize,\r\n            () => this.klCanvas,\r\n            () => currentLayerCtx,\r\n            !!this.embed,\r\n            this.statusOverlay,\r\n        );\r\n\r\n        const undoRedoCatchup = new KL.UndoRedoCatchup(\r\n            brushUiMap,\r\n            this.layerPreview,\r\n            this.layerManager,\r\n            handUi,\r\n            this.klCanvasWorkspace,\r\n            () => {\r\n                if (!initState) {\r\n                    throw new Error('initState not initialized');\r\n                }\r\n                return initState;\r\n            },\r\n            () => this.klCanvas,\r\n            () => currentLayerCtx,\r\n            (ctx) => {\r\n                currentLayerCtx = ctx;\r\n            },\r\n            () => currentBrushUi,\r\n        );\r\n        klHistory.addListener((p) => {\r\n            undoRedoCatchup.catchup(p);\r\n        });\r\n\r\n        const showNewImageDialog = () => {\r\n            KL.newImageDialog({\r\n                currentColor: currentColor,\r\n                secondaryColor: this.klColorSlider.getSecondaryRGB(),\r\n                maxCanvasSize: klMaxCanvasSize,\r\n                canvasWidth: this.klCanvas.getWidth(),\r\n                canvasHeight: this.klCanvas.getHeight(),\r\n                workspaceWidth: window.innerWidth < this.collapseThreshold ? this.uiWidth : this.uiWidth - this.toolWidth,\r\n                workspaceHeight: this.uiHeight,\r\n                onConfirm: (width, height, color) => {\r\n                    this.klCanvas.reset({\r\n                        width: width,\r\n                        height: height,\r\n                        color: color.a === 1 ? color : undefined,\r\n                    });\r\n\r\n                    this.layerManager.update(0);\r\n                    setCurrentLayer(throwIfNull(this.klCanvas.getLayer(0)));\r\n                    this.klCanvasWorkspace.resetOrFitView();\r\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                },\r\n                onCancel: () => {},\r\n            });\r\n        };\r\n\r\n        const shareImage = (callback?: () => void) => {\r\n            BB.shareCanvas({\r\n                canvas: this.klCanvas.getCompleteCanvas(1),\r\n                fileName: BB.getDate() + klConfig.filenameBase + '.png',\r\n                title: BB.getDate() + klConfig.filenameBase + '.png',\r\n                callback: callback ? callback : () => {},\r\n            });\r\n        };\r\n\r\n        this.saveToComputer = new KL.SaveToComputer(\r\n            pOptions.saveReminder,\r\n            () => exportType,\r\n            () => this.klCanvas,\r\n        );\r\n\r\n        const copyToClipboard = (showCrop?: boolean) => {\r\n            KL.clipboardDialog(\r\n                this.klRootEl,\r\n                this.klCanvas.getCompleteCanvas(1),\r\n                (inputObj) => {\r\n                    if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) {\r\n                        return;\r\n                    }\r\n                    //do a crop\r\n                    KL.filterLib.cropExtend.apply!({\r\n                        context: currentLayerCtx,\r\n                        klCanvas: this.klCanvas,\r\n                        input: inputObj,\r\n                        history: klHistory,\r\n                    });\r\n                    this.layerManager.update();\r\n                    this.klCanvasWorkspace.resetOrFitView();\r\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                },\r\n                this.statusOverlay,\r\n                showCrop || false,\r\n            );\r\n        };\r\n\r\n        const fileTab = this.embed ? null : new KL.FileTab(\r\n            this.klRootEl,\r\n            projectStore!,\r\n            () => this.klCanvas.getProject(),\r\n            exportType,\r\n            (type) => {\r\n                exportType = type;\r\n            },\r\n            (files, optionsStr) => importHandler.handleFileSelect(files, optionsStr),\r\n            () => this.saveToComputer.save(),\r\n            showNewImageDialog,\r\n            shareImage,\r\n            () => { // on upload\r\n                KL.imgurUpload(\r\n                    this.klCanvas,\r\n                    this.klRootEl,\r\n                    pOptions.saveReminder!,\r\n                    pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : '',\r\n                );\r\n            },\r\n            copyToClipboard,\r\n            pOptions.saveReminder,\r\n        );\r\n\r\n        const settingsTab = new KL.SettingsTab(\r\n            () => {\r\n                this.uiState = this.uiState === 'left' ? 'right' : 'left';\r\n                this.updateUi();\r\n                if (!this.embed) {\r\n                    LocalStorage.setItem('uiState', this.uiState);\r\n                }\r\n            },\r\n            pOptions.aboutEl\r\n        );\r\n\r\n        mainTabRow = new KL.TabRow({\r\n            initialId: 'draw',\r\n            tabArr: [\r\n                {\r\n                    id: 'draw',\r\n                    title: LANG('tool-brush'),\r\n                    image: toolPaintImg,\r\n                    onOpen: () => {\r\n                        if (currentBrushId === 'eraserBrush') {\r\n                            this.klColorSlider.enable(false);\r\n                        }\r\n                        BB.append(\r\n                            colorDiv,\r\n                            [this.klColorSlider.getElement(), this.klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n                        );\r\n                        brushDiv.style.display = 'block';\r\n                    },\r\n                    onClose: () => {\r\n                        brushDiv.style.display = 'none';\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'hand',\r\n                    title: LANG('tool-hand'),\r\n                    image: toolHandImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        handUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        handUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'fill',\r\n                    title: LANG('tool-paint-bucket'),\r\n                    image: toolFillImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        fillUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        fillUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'gradient',\r\n                    title: LANG('tool-gradient'),\r\n                    image: toolGradientImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        gradientUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        gradientUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'text',\r\n                    title: LANG('tool-text'),\r\n                    image: toolTextImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        textUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        textUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'shape',\r\n                    title: LANG('tool-shape'),\r\n                    image: toolShapeImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        shapeUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        shapeUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'layers',\r\n                    title: LANG('layers'),\r\n                    image: tabLayersImg,\r\n                    onOpen: () => {\r\n                        this.layerManager.update();\r\n                        this.layerManager.getElement().style.display = 'block';\r\n                    },\r\n                    onClose: () => {\r\n                        this.layerManager.getElement().style.display = 'none';\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'edit',\r\n                    label: LANG('tab-edit'),\r\n                    onOpen: () => {\r\n                        filterTab.show();\r\n                    },\r\n                    onClose: () => {\r\n                        filterTab.hide();\r\n                    },\r\n                    css: {\r\n                        padding: '0 7px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'file',\r\n                    label: LANG('tab-file'),\r\n                    isVisible: !!fileTab,\r\n                    onOpen: () => {\r\n                        if (!fileTab) {\r\n                            return;\r\n                        }\r\n                        fileTab.getElement().style.display = 'block';\r\n                        fileTab.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        if (!fileTab) {\r\n                            return;\r\n                        }\r\n                        fileTab.getElement().style.display = 'none';\r\n                        fileTab.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        padding: '0 7px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'settings',\r\n                    title: LANG('tab-settings'),\r\n                    image: tabSettingsImg,\r\n                    onOpen: () => {\r\n                        settingsTab.getElement().style.display = 'block';\r\n                        // settingsTab.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        settingsTab.getElement().style.display = 'none';\r\n                        // settingsTab.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n            ],\r\n        });\r\n\r\n        this.bottomBarWrapper = BB.el({\r\n            css: {\r\n                width: '270px',\r\n                position: 'absolute',\r\n                bottom: '0',\r\n                left: '0',\r\n            },\r\n        });\r\n        if (pOptions.bottomBar) {\r\n            this.bottomBar = pOptions.bottomBar;\r\n            this.bottomBarWrapper.append(this.bottomBar);\r\n            const observer = new MutationObserver(() => this.updateBottomBar());\r\n            observer.observe(\r\n                this.toolspaceInner,\r\n                {\r\n                    attributes: true,\r\n                    childList: true,\r\n                    subtree: true,\r\n                }\r\n            );\r\n        }\r\n\r\n\r\n\r\n\r\n        BB.append(this.toolspaceInner, [\r\n            this.layerPreview.getElement(),\r\n            mainTabRow.getElement(),\r\n            brushDiv,\r\n            handUi.getElement(),\r\n            fillUi.getElement(),\r\n            gradientUi.getElement(),\r\n            textUi.getElement(),\r\n            shapeUi.getElement(),\r\n            this.layerManager.getElement(),\r\n            filterTab.getElement(),\r\n            fileTab ? fileTab.getElement() : undefined,\r\n            settingsTab.getElement(),\r\n            BB.el({\r\n                css: {\r\n                    height: '10px', // a bit of spacing at the bottom\r\n                },\r\n            }),\r\n            this.bottomBarWrapper ? this.bottomBarWrapper : undefined,\r\n        ]);\r\n\r\n        this.toolspaceScroller = new KL.ToolspaceScroller({\r\n            toolspace: this.toolspace,\r\n            uiState: this.uiState,\r\n        });\r\n\r\n        if (!this.embed) {\r\n            Object.defineProperty(window, 'KL', {\r\n                value: createConsoleApi({\r\n                    onDraw: (path: IVector2D[]): void => {\r\n                        if (!path || path.length === 0) {\r\n                            return;\r\n                        }\r\n                        path.forEach((p, index) => {\r\n                            if (index === 0) {\r\n                                currentBrushUi.startLine(p.x, p.y, 1);\r\n                            } else {\r\n                                currentBrushUi.goLine(p.x, p.y, 1);\r\n                            }\r\n                        });\r\n                        currentBrushUi.endLine();\r\n                        this.klCanvasWorkspace.requestFrame();\r\n                    },\r\n                }),\r\n                writable: false,\r\n            });\r\n        }\r\n\r\n        this.resize(this.uiWidth, this.uiHeight);\r\n        this.updateUi();\r\n\r\n        const importHandler = new ImportHandler({\r\n            klRootEl: this.klRootEl,\r\n            klMaxCanvasSize,\r\n            layerManager: this.layerManager,\r\n            setCurrentLayer,\r\n            klCanvas: this.klCanvas,\r\n            klCanvasWorkspace: this.klCanvasWorkspace,\r\n            handUi,\r\n        }, {\r\n            onColor: (rgb) => brushSettingService.setColor(rgb),\r\n        });\r\n\r\n        if (!this.embed) {\r\n            new KL.KlImageDropper({\r\n                target: document.body,\r\n                onDrop: (files, optionStr) => {\r\n                    if (KL.dialogCounter.get() > 0) {\r\n                        return;\r\n                    }\r\n                    importHandler.handleFileSelect(files, optionStr);\r\n                },\r\n                enabledTest: () => {\r\n                    return KL.dialogCounter.get() === 0;\r\n                },\r\n            });\r\n\r\n            window.document.addEventListener(\r\n                'paste',\r\n                (e: ClipboardEvent) => importHandler.onPaste(e),\r\n                false\r\n            );\r\n        }\r\n\r\n        {\r\n            window.addEventListener('resize', () => {\r\n                this.resize(window.innerWidth, window.innerHeight);\r\n            });\r\n            window.addEventListener('orientationchange', () => {\r\n                this.resize(window.innerWidth, window.innerHeight);\r\n            });\r\n\r\n            // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\r\n            // Workaround: place a div in the body that fills the window, and use a ResizeObserver\r\n            const windowResizeWatcher = BB.el({\r\n                parent: document.body,\r\n                css: {\r\n                    position: 'fixed',\r\n                    left: '0',\r\n                    top: '0',\r\n                    right: '0',\r\n                    bottom: '0',\r\n                    pointerEvents: 'none',\r\n                    zIndex: '-1',\r\n                    userSelect: 'none',\r\n                },\r\n            });\r\n            try {\r\n                // Not all browsers support ResizeObserver. Not critical though.\r\n                const observer = new ResizeObserver(() => this.resize(window.innerWidth, window.innerHeight));\r\n                observer.observe(windowResizeWatcher);\r\n            } catch (e) {\r\n                windowResizeWatcher.remove();\r\n            }\r\n\r\n            // prevent ctrl scroll -> zooming page\r\n            this.klRootEl.addEventListener('wheel', (event) => {\r\n                if (keyListener.isPressed('ctrl')) {\r\n                    event.preventDefault();\r\n                }\r\n            });\r\n            //maybe prevent zooming on safari mac os - todo still needed?\r\n            const prevent = (e: Event) => {\r\n                e.preventDefault();\r\n            };\r\n            window.addEventListener('gesturestart', prevent);\r\n            window.addEventListener('gesturechange', prevent);\r\n            window.addEventListener('gestureend', prevent);\r\n        }\r\n    }\r\n\r\n    // -------- interface --------\r\n\r\n    getEl (): HTMLElement {\r\n        return this.klRootEl;\r\n    }\r\n\r\n    resize (w: number, h: number): void {\r\n\r\n        // iPad scrolls down when increasing text zoom\r\n        if (window.scrollY > 0) {\r\n            window.scrollTo(0, 0);\r\n        }\r\n\r\n        if (this.uiWidth === Math.max(0, w) && this.uiHeight === Math.max(0, h)) {\r\n            return;\r\n        }\r\n\r\n        this.uiWidth = Math.max(0, w);\r\n        this.uiHeight = Math.max(0, h);\r\n\r\n        this.updateCollapse();\r\n        this.updateBottomBar();\r\n\r\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\r\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\r\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\r\n    }\r\n\r\n    out (msg: string): void {\r\n        this.statusOverlay.out(msg);\r\n    }\r\n\r\n    getPNG (): Blob {\r\n        return base64ToBlob(this.klCanvas.getCompleteCanvas(1).toDataURL('image/png'));\r\n    }\r\n\r\n    getPSD = async ():  Promise<Blob> => {\r\n        return await klCanvasToPsdBlob(this.klCanvas);\r\n    };\r\n\r\n    getProject (): IKlProject {\r\n        return this.klCanvas.getProject();\r\n    }\r\n\r\n    swapUiLeftRight (): void {\r\n        this.uiState = this.uiState === 'left' ? 'right' : 'left';\r\n        if (!this.embed) {\r\n            LocalStorage.setItem('uiState', this.uiState);\r\n        }\r\n        this.updateUi();\r\n    }\r\n\r\n    saveAsPsd (): void {\r\n        this.saveToComputer.save('psd');\r\n    }\r\n\r\n    isDrawing (): boolean {\r\n        return this.lineSanitizer.getIsDrawing() || this.klCanvasWorkspace.getIsDrawing();\r\n    }\r\n}\r\n","import { _array_without_holes } from \"./_array_without_holes.js\";\nimport { _iterable_to_array } from \"./_iterable_to_array.js\";\nimport { _non_iterable_spread } from \"./_non_iterable_spread.js\";\nimport { _unsupported_iterable_to_array } from \"./_unsupported_iterable_to_array.js\";\n\nexport function _to_consumable_array(arr) {\n    return _array_without_holes(arr) || _iterable_to_array(arr) || _unsupported_iterable_to_array(arr) || _non_iterable_spread();\n}\nexport { _to_consumable_array as _ };\n","import { _array_like_to_array } from \"./_array_like_to_array.js\";\n\nexport function _array_without_holes(arr) {\n    if (Array.isArray(arr)) return _array_like_to_array(arr);\n}\nexport { _array_without_holes as _ };\n","export function _iterable_to_array(iter) {\n    if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) {\n        return Array.from(iter);\n    }\n}\nexport { _iterable_to_array as _ };\n","export function _non_iterable_spread() {\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nexport { _non_iterable_spread as _ };\n","import {DecoyKlHistory, klHistory} from './history/kl-history';\r\nimport {showModal} from './ui/modals/base/showModal';\r\nimport {DynamicModal} from './ui/modals/base/dynamic-modal';\r\nimport {dialogCounter} from './ui/modals/modal-count';\r\nimport {Checkbox} from './ui/components/checkbox';\r\nimport {input} from './ui/components/input';\r\nimport {Select} from './ui/components/select';\r\nimport {ImageToggle} from './ui/components/image-toggle';\r\nimport {ImageRadioList} from './ui/components/image-radio-list';\r\nimport {createPenPressureToggle} from './ui/components/create-pen-pressure-toggle';\r\nimport {KlSlider} from './ui/components/kl-slider';\r\nimport {calcSliderFalloffFactor} from './ui/components/slider-falloff';\r\nimport {HexColorDialog} from './ui/modals/color-slider-hex-dialog';\r\nimport {KlColorSlider} from './ui/components/kl-color-slider';\r\nimport {KlColorSliderSmall} from './ui/components/kl-color-slider-small';\r\nimport {PointSlider} from './ui/components/point-slider';\r\nimport {ColorOptions} from './ui/components/color-options';\r\nimport {Options} from './ui/components/options';\r\nimport {StatusOverlay} from './ui/components/status-overlay';\r\nimport {CropCopy} from './ui/components/crop-copy';\r\nimport {clipboardDialog} from './ui/modals/clipboard-dialog';\r\nimport {LayerManager} from './ui/tool-tabs/layer-manager/layer-manager';\r\nimport {WorkspaceSvgOverlay} from './canvas-ui/workspace-svg-overlay';\r\nimport {KlCanvasWorkspace} from './canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvasPreview} from './canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './ui/components/free-transform';\r\nimport {FreeTransformCanvas} from './ui/components/free-transform-canvas';\r\nimport {Cropper} from './ui/components/cropper';\r\nimport {LayerPreview} from './ui/components/layer-preview';\r\nimport {showImportAsLayerDialog} from './ui/modals/show-import-as-layer-dialog';\r\nimport {KlImageDropper} from './ui/components/kl-image-dropper';\r\nimport {OverlayToolspace} from './ui/components/overlay-toolspace';\r\nimport {ToolspaceTopRow} from './ui/components/toolspace-top-row';\r\nimport {ToolDropdown} from './ui/components/tool-dropdown';\r\nimport {ToolspaceToolRow} from './ui/components/toolspace-tool-row';\r\nimport {ToolspaceStabilizerRow} from './ui/components/toolspace-stabilizer-row';\r\nimport {TabRow} from './ui/components/tab-row';\r\nimport {HandUi} from './ui/tool-tabs/hand-ui';\r\nimport {FillUi} from './ui/tool-tabs/fill-ui';\r\nimport {TextUi} from './ui/tool-tabs/text-ui';\r\nimport {ShapeUi} from './ui/tool-tabs/shape-ui';\r\nimport {newImageDialog} from './ui/modals/new-image-dialog';\r\nimport {ToolspaceCollapser} from './ui/components/toolspace-collapser';\r\nimport {renderText} from './image-operations/render-text';\r\nimport {textToolDialog} from './ui/modals/text-tool-dialog/text-tool-dialog';\r\nimport {showImportImageDialog} from './ui/modals/show-import-image-dialog';\r\nimport {floodFillBits} from './image-operations/flood-fill';\r\nimport * as PSD from './storage/psd';\r\nimport {drawShape, ShapeTool} from './image-operations/shape-tool';\r\nimport {KlCanvas} from './canvas/kl-canvas';\r\nimport * as indexedDb from './storage/indexed-db';\r\nimport {setDbName} from './storage/indexed-db';\r\nimport {filterLib, filterLibStatus} from './filters/filters';\r\nimport {brushes} from './brushes/brushes';\r\nimport {brushesUI} from './brushes-ui/brushes-ui';\r\nimport {showIframeModal} from './ui/modals/show-iframe-modal';\r\nimport {RadioList} from './ui/components/radio-list';\r\nimport {BrowserStorageUi} from './ui/components/browser-storage-ui';\r\nimport {drawProject} from './canvas/draw-project';\r\nimport {ProjectStore} from './storage/project-store';\r\nimport {FileTab} from './ui/tool-tabs/file-tab';\r\nimport {FilterTab} from './ui/tool-tabs/filter-tab';\r\nimport {imgurUpload} from './ui/modals/imgur-upload';\r\nimport {loadAgPsd} from './storage/load-ag-psd';\r\nimport {SaveReminder} from './ui/components/save-reminder';\r\nimport {SaveToComputer} from './storage/save-to-computer';\r\nimport {UndoRedoCatchup} from './history/undo-redo-catchup';\r\nimport {BrushSettingService} from './brushes-ui/brush-setting-service';\r\nimport {BoxToggle} from './ui/components/box-toggle';\r\nimport {SettingsTab} from './ui/tool-tabs/settings-tab';\r\nimport {ToolspaceScroller} from './ui/components/toolspace-scroller';\r\nimport {GradientUi} from './ui/tool-tabs/gradient-ui';\r\nimport {drawGradient, GradientTool} from './image-operations/gradient-tool';\r\n\r\n/**\r\n * paint tool functionality\r\n */\r\nexport const KL = {\r\n\r\n    // --- brushes ---\r\n    brushes,\r\n    brushesUI,\r\n    BrushSettingService,\r\n\r\n    // --- canvas ---\r\n    KlCanvas,\r\n    drawProject,\r\n\r\n    // --- canvas ui ---\r\n    WorkspaceSvgOverlay,\r\n    KlCanvasWorkspace,\r\n    KlCanvasPreview,\r\n\r\n    // --- filters ---\r\n    filterLibStatus,\r\n    filterLib,\r\n\r\n    // --- history ---\r\n    UndoRedoCatchup,\r\n\r\n    // --- image operations ---\r\n    renderText,\r\n    floodFillBits,\r\n    ShapeTool,\r\n    drawShape,\r\n    GradientTool,\r\n    drawGradient,\r\n\r\n    // --- storage ---\r\n    PSD,\r\n    setDbName,\r\n    indexedDb,\r\n    ProjectStore,\r\n    loadAgPsd,\r\n    SaveToComputer,\r\n    \r\n    // --- ui - components ---\r\n    calcSliderFalloffFactor,\r\n    Checkbox,\r\n    input,\r\n    Select,\r\n    ImageToggle,\r\n    ImageRadioList,\r\n    RadioList,\r\n    createPenPressureToggle,\r\n    KlSlider,\r\n    HexColorDialog,\r\n    KlColorSlider,\r\n    KlColorSliderSmall,\r\n    PointSlider,\r\n    ColorOptions,\r\n    Options,\r\n    BoxToggle,\r\n    StatusOverlay,\r\n    CropCopy,\r\n    FreeTransform,\r\n    FreeTransformCanvas,\r\n    Cropper,\r\n    LayerPreview,\r\n    KlImageDropper,\r\n    OverlayToolspace,\r\n    ToolspaceTopRow,\r\n    ToolDropdown,\r\n    ToolspaceToolRow,\r\n    ToolspaceStabilizerRow,\r\n    TabRow,\r\n    ToolspaceCollapser,\r\n    BrowserStorageUi,\r\n    SaveReminder,\r\n    ToolspaceScroller,\r\n\r\n    // --- ui - modals ---\r\n    dialogCounter,\r\n    popup: showModal,\r\n    Popup: DynamicModal,\r\n    clipboardDialog,\r\n    showImportAsLayerDialog,\r\n    newImageDialog,\r\n    textToolDialog,\r\n    showImportImageDialog,\r\n    showIframePopup: showIframeModal,\r\n    imgurUpload,\r\n\r\n    // --- ui - tool tabs ---\r\n    HandUi,\r\n    FillUi,\r\n    GradientUi,\r\n    TextUi,\r\n    ShapeUi,\r\n    FileTab,\r\n    FilterTab,\r\n    SettingsTab,\r\n    LayerManager,\r\n\r\n    klHistory,\r\n    DecoyKlHistory,\r\n};\r\n\r\nObject.keys(KL); // without this, parcel build may break this object","\r\n\r\n// --------- history entry types ------------------------------\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\nexport interface IHistoryAction {\r\n    action: string;\r\n    params: any[];\r\n}\r\n\r\nexport interface IHistoryEntry {\r\n    tool: string[];\r\n    action?: string;\r\n    params?: any[];\r\n    actions?: IHistoryAction[];\r\n}\r\n\r\ntype THistoryActionParams<T> = T extends (...args: infer A) => void ? A : never;\r\nexport type THistoryActions<ToolName, T> = {\r\n    [K in keyof T]: {\r\n        tool: [ToolName];\r\n        action: K;\r\n        params: THistoryActionParams<T[K]>;\r\n    }\r\n}[keyof T];\r\n\r\nexport type THistoryInnerActions<T> = {\r\n    [K in keyof T]: {\r\n        action: K;\r\n        params: THistoryActionParams<T[K]>;\r\n    }\r\n}[keyof T];\r\n\r\nexport type THistoryEntryG<Tool extends string[], Action extends string, Params extends unknown[]> = {\r\n    tool: Tool;\r\n    action: Action;\r\n    params: Params;\r\n}\r\n\r\nexport type TMiscImportImageHistoryEntry = THistoryEntryG<\r\n    ['misc'],\r\n    'importImage',\r\n    [HTMLCanvasElement, string | undefined]>;\r\n\r\nexport type TMiscFocusLayerHistoryEntry = THistoryEntryG<\r\n    ['misc'],\r\n    'focusLayer',\r\n    [number]>;\r\n\r\n// --------- classes etc ------------------------------\r\n\r\nexport interface IHistoryBroadcast {\r\n    bufferUpdate: IHistoryEntry;\r\n}\r\n\r\nlet historyInstance: boolean = false;\r\n\r\nexport type IHistoryListener = (p: IHistoryBroadcast | null) => void;\r\n\r\nexport interface KlHistoryInterface {\r\n    pause (b: boolean): void;\r\n    addListener (l: IHistoryListener): void;\r\n    push (e: IHistoryEntry): void;\r\n    undo (): IHistoryEntry[];\r\n    redo (): IHistoryEntry | undefined;\r\n    getAll (): (IHistoryEntry | null)[];\r\n    canRedo (): boolean;\r\n    canUndo (): boolean;\r\n    getState (): number;\r\n    getActionNumber (): number;\r\n}\r\n\r\nexport class DecoyKlHistory implements KlHistoryInterface {\r\n    pause (): void {}\r\n    addListener (): void {}\r\n    push (): void {}\r\n    undo (): IHistoryEntry[] { return []; }\r\n    redo (): (IHistoryEntry | undefined) { return undefined; }\r\n    getAll (): (IHistoryEntry | null)[] { return []; }\r\n    canRedo (): boolean { return false; }\r\n    canUndo (): boolean { return false; }\r\n    getState (): number { return 0; }\r\n    getActionNumber (): number { return 0; }\r\n}\r\n\r\nconst DO_DELETE_OLD = true;\r\n\r\nexport class KlHistory implements KlHistoryInterface {\r\n\r\n    private state: number; // on .push state increments by one\r\n    private readonly entries: (IHistoryEntry | null)[]; // null if beyond max undo to trigger garbage collection\r\n    private readonly listeners: IHistoryListener[];\r\n    private pauseStack: number; // how often paused without unpause\r\n    private readonly max: number = 20; // max number undo steps\r\n    private maxState: number; // can't go backwards -> max state is the buffer image(klCanvas)\r\n    private actionNumber: number; // current action the user is on. untouched document = -1 because dataArr.length is 0\r\n    \r\n    private broadcast (p: IHistoryBroadcast | null): void {\r\n        setTimeout(() => {\r\n            for (let i = 0; i < this.listeners.length; i++) {\r\n                this.listeners[i](p);\r\n            }\r\n            this.state++;\r\n        }, 1);\r\n    }\r\n    \r\n    // ---- public ----\r\n    \r\n    constructor () {\r\n        if (historyInstance) {\r\n            throw new Error('klHistory already instantiated');\r\n        }\r\n        historyInstance = true;\r\n        this.state = 0;\r\n        this.entries = [];\r\n        this.listeners = [];\r\n        this.pauseStack = 0;\r\n        this.maxState = -1;\r\n        this.actionNumber = -1;\r\n    }\r\n\r\n    /**\r\n     * Needed, because sometimes there are actions that would cause other undo steps.\r\n     * For example a filter that does something with two layers and then merges them.\r\n     * That should be a single undo step, and prevent merging from creating its own undo step.\r\n     * Pause prevents creation of unintended undo steps.\r\n     */\r\n    pause (b: boolean): void {\r\n        if (b) {\r\n            this.pauseStack++;\r\n        } else {\r\n            this.pauseStack = Math.max(0, this.pauseStack - 1);\r\n        }\r\n    }\r\n\r\n    addListener (l: IHistoryListener): void {\r\n        this.listeners.push(l);\r\n    }\r\n\r\n    push (newEntry: IHistoryEntry): void {\r\n        if (this.pauseStack > 0) {\r\n            return;\r\n        }\r\n        while (this.actionNumber < this.entries.length - 1) {\r\n            this.entries.pop();\r\n        }\r\n\r\n        //taking care of actions that shouldn't cause a new undo step\r\n        const lastEntry = this.entries[this.entries.length - 1];\r\n        // opacity\r\n        if (\r\n            lastEntry && newEntry.tool[0] === 'canvas' && lastEntry.tool[0] === 'canvas' &&\r\n            newEntry.action === 'layerOpacity' && lastEntry.action === 'layerOpacity' &&\r\n            lastEntry.params![0] === newEntry.params![0]\r\n        ) {\r\n            this.entries[this.entries.length - 1] = newEntry;\r\n            this.state++; //still needs to increment because something changed\r\n            return;\r\n        }\r\n        // layer visibility\r\n        if (\r\n            lastEntry && newEntry.tool[0] === 'canvas' && lastEntry.tool[0] === 'canvas' &&\r\n            newEntry.action === 'setLayerIsVisible' && lastEntry.action === 'setLayerIsVisible' &&\r\n            lastEntry.params![0] === newEntry.params![0] &&\r\n            lastEntry.params![1] != newEntry.params![1]\r\n        ) {\r\n            // if last and current step toggle visibility -> that means it's the way it was before\r\n            this.entries.pop();\r\n            this.actionNumber--;\r\n            this.state++; //still needs to increment because something changed\r\n            this.broadcast(null);\r\n            return;\r\n        }\r\n        // select layer\r\n        if (newEntry.action === 'focusLayer' && lastEntry && lastEntry.action === 'focusLayer') {\r\n            this.entries[this.entries.length - 1] = newEntry;\r\n            this.state++;\r\n            return;\r\n        }\r\n\r\n        this.entries[this.entries.length] = newEntry;\r\n        this.actionNumber = this.entries.length - 1;\r\n        const maxBefore = this.maxState;\r\n        this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\r\n        if (maxBefore < this.maxState) {\r\n            const item = this.entries[this.maxState];\r\n            if (!item) {\r\n                throw new Error('this.dataArr[this.maxState] null');\r\n            }\r\n            this.broadcast({bufferUpdate: item});\r\n        } else {\r\n            this.broadcast(null);\r\n        }\r\n        if (DO_DELETE_OLD && this.maxState >= 0) {\r\n            this.entries[this.maxState] = null; //to free some memory...imported images take a lot of space\r\n        }\r\n    }\r\n\r\n    /**\r\n     * lowers action number, returns all entries that need to be executed\r\n     * on trailing snapshot to represent the canvas one undo step back.\r\n     * Empty array if it can't undo\r\n     */\r\n    undo (): IHistoryEntry[] {\r\n        const result: IHistoryEntry[] = [];\r\n        if (!this.canUndo()) {\r\n            return result;\r\n        }\r\n        for (let i = this.maxState + 1; i < this.actionNumber; i++) {\r\n            result.push(throwIfNull(this.entries[i]));\r\n        }\r\n        this.actionNumber--;\r\n        this.broadcast(null);\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * raises action number, returns the action to be redone\r\n     */\r\n    redo (): (IHistoryEntry | undefined) {\r\n        if (!this.canRedo()) {\r\n            return undefined;\r\n        }\r\n        this.actionNumber++;\r\n        this.broadcast(null);\r\n        return throwIfNull(this.entries[this.actionNumber]);\r\n    }\r\n\r\n    getAll (): (IHistoryEntry | null)[] {\r\n        return [...this.entries];\r\n    }\r\n\r\n    canRedo (): boolean {\r\n        return this.actionNumber < this.entries.length - 1;\r\n    }\r\n\r\n    canUndo (): boolean {\r\n        return this.actionNumber > this.maxState;\r\n    }\r\n\r\n    getState (): number {\r\n        return this.state;\r\n    }\r\n\r\n    /**\r\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\r\n     */\r\n    getActionNumber (): number {\r\n        return (this.actionNumber + 1);\r\n    }\r\n    \r\n}\r\n\r\nexport const klHistory = new KlHistory();\r\n","import {IKeyString} from '../../../../bb/bb-types';\r\nimport {dialogCounter} from '../modal-count';\r\nimport {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport './scroll-fix';\r\nimport cancelImg from '/src/app/img/ui/cancel.svg';\r\nimport checkImg from '/src/app/img/ui/check.svg';\r\n\r\nexport function showModal (\r\n    p: {\r\n        target: HTMLElement;\r\n        div?: HTMLElement; // node with content\r\n        message: string; // can be html\r\n        callback?: (result: string) => void;\r\n        buttons?: string[]; // \"Ok\", and \"Cancel\" will be automatically translated\r\n        primaries?: string[];\r\n        type?: 'error' | 'warning' | 'upload' | 'ok'; // todo\r\n        closeFunc?: (f: () => void) => void; // returns a function you can call to close (Cancel) the dialog\r\n        style?: IKeyString;\r\n        clickOnEnter?: string; // name of button - will be clicked if enter key pressed\r\n        autoFocus?: false | string; // name of  to automatically focus - default 'Ok' - false -> none\r\n        ignoreBackground?: boolean; // default false; if true clicking on background doesn't close\r\n    }\r\n): {\r\n    setIgnoreBackground: (b: boolean) => void;\r\n} {\r\n    dialogCounter.increase();\r\n    let isClosed = false;\r\n    let ignoreBackground = !!p.ignoreBackground;\r\n\r\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\r\n    const rootRootEl = BB.el({\r\n        parent: document.body,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            overflow: 'hidden',\r\n        },\r\n    });\r\n    const rootEl = BB.el({\r\n        parent: rootRootEl,\r\n        className: 'kl-popup',\r\n    });\r\n\r\n    const scrollContent = BB.el({\r\n        parent: rootEl,\r\n        css: {\r\n            width: '100%',\r\n            minHeight: '100%',\r\n            // padding: '10px 0',\r\n            position: 'relative',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n        },\r\n    });\r\n\r\n    const bgEl = BB.el({\r\n        parent: scrollContent,\r\n        onClick: () => {\r\n            if (ignoreBackground) {\r\n                return;\r\n            }\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            zIndex: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n        },\r\n    });\r\n\r\n    const titleHeight = 40;\r\n    const xButton = BB.el({\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: () => {\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            position: 'absolute',\r\n            right: '0',\r\n            top: '0',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        },\r\n    });\r\n\r\n    let icon: HTMLElement | undefined = undefined;\r\n    if (p.type) {\r\n\r\n        icon = BB.el({\r\n            className: {\r\n                error: 'kl-popup__icon-error',\r\n                ok: 'kl-popup__icon-ok',\r\n                warning: 'kl-popup__icon-warning',\r\n                upload: 'kl-popup__icon-upload',\r\n            }[p.type],\r\n        });\r\n    }\r\n\r\n    const boxClasses = ['kl-popup-box'];\r\n    boxClasses.push('kl-popup-box--sm');\r\n    const boxEl = BB.el({\r\n        content: [\r\n            xButton,\r\n            icon,\r\n            BB.el({\r\n                content:p.message,\r\n                css: {\r\n                    marginRight: '15px',\r\n                    marginBottom: p.div ? '10px' : undefined,\r\n                },\r\n            }),\r\n            p.div,\r\n        ],\r\n        className: boxClasses.join(' '),\r\n        css: p.style ? p.style : undefined,\r\n    });\r\n\r\n    scrollContent.append(\r\n        BB.el({\r\n            css: {\r\n                flex: '0.5',\r\n            },\r\n        }),\r\n        boxEl,\r\n        BB.el({\r\n            css: {\r\n                flex: '1',\r\n            },\r\n        })\r\n    );\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, e, comboStr): void {\r\n            if (isClosed) {\r\n                return;\r\n            }\r\n            if (clickOnEnterBtn && comboStr === 'enter' && !BB.isInputFocused()) {\r\n                e.stopPropagation();\r\n                setTimeout(() => {\r\n                    clickOnEnterBtn && clickOnEnterBtn.click();\r\n                }, 10);\r\n            }\r\n            if (comboStr === 'esc') {\r\n                e.stopPropagation();\r\n                close('Cancel');\r\n            }\r\n        },\r\n    });\r\n    // prevent ctrl scroll -> zooming page\r\n    const wheelPrevent = (event: WheelEvent): void => {\r\n        if (keyListener.isPressed('ctrl')) {\r\n            event.preventDefault();\r\n        }\r\n    };\r\n    rootEl.addEventListener('wheel', wheelPrevent);\r\n    rootEl.onclick = BB.handleClick;\r\n\r\n    let autoFocus: string | undefined;\r\n    if (p.autoFocus) {\r\n        autoFocus = p.autoFocus;\r\n    } else if (p.autoFocus === false) {\r\n        autoFocus = undefined;\r\n    } else {\r\n        autoFocus = 'Ok';\r\n    }\r\n\r\n    const buttonRowEl = p.buttons && p.buttons.length > 0 ? BB.el({\r\n        parent: boxEl,\r\n        css: {\r\n            display: 'flex',\r\n            flexWrap: 'wrap',\r\n            justifyContent: 'flex-end',\r\n            marginTop: '12px', // 8px already via buttons\r\n            marginLeft: '-8px',\r\n        },\r\n    }) : undefined;\r\n    let clickOnEnterBtn: HTMLButtonElement | undefined;\r\n    const btnElArr: HTMLButtonElement[] = [];\r\n    if (p.buttons) {\r\n        p.buttons.forEach(buttonName => {\r\n            const btnClasses = ['kl-popup__btn'];\r\n            if (buttonName === 'Ok' || (p.primaries && p.primaries.includes(buttonName))) {\r\n                btnClasses.push('kl-button-primary');\r\n            }\r\n            let iconUrl;\r\n            let label = buttonName;\r\n            if (buttonName === 'Ok') {\r\n                label = LANG('modal-ok');\r\n                iconUrl = checkImg;\r\n            }\r\n            if (buttonName === 'Cancel') {\r\n                label = LANG('modal-cancel');\r\n                iconUrl = cancelImg;\r\n                btnClasses.push('kl-button-cancel');\r\n            }\r\n            let iconImg: HTMLElement | undefined = undefined;\r\n            if (iconUrl) {\r\n                iconImg = BB.el({\r\n                    tagName: 'img',\r\n                    custom: {\r\n                        src: iconUrl,\r\n                        height: '17',\r\n                    },\r\n                });\r\n            }\r\n            const btn = BB.el({\r\n                parent: buttonRowEl,\r\n                tagName: 'button',\r\n                className: btnClasses.join(' '),\r\n                content: [\r\n                    iconImg,\r\n                    BB.el({\r\n                        className: 'kl-popup__btn__text',\r\n                        content: label,\r\n                    }),\r\n                ],\r\n                onClick: () => {\r\n                    close(buttonName);\r\n                },\r\n            });\r\n            btnElArr.push(btn);\r\n            if (autoFocus === buttonName) {\r\n                setTimeout(() => {\r\n                    btn.focus();\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 10);\r\n                setTimeout(() => {\r\n                    // safari needs a separate timeout\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 20);\r\n            }\r\n            if (buttonName === p.clickOnEnter) {\r\n                clickOnEnterBtn = btn;\r\n            }\r\n        });\r\n    }\r\n\r\n    function close (value: string): void {\r\n        if (isClosed) {\r\n            return;\r\n        }\r\n\r\n        isClosed = true;\r\n        BB.clearSelection();\r\n        BB.unfocusAnyInput();\r\n        rootRootEl.remove();\r\n        dialogCounter.decrease();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        keyListener.destroy();\r\n        rootEl.removeEventListener('wheel', wheelPrevent);\r\n        // (disabled) eslint-disable-next-line no-null/no-null\r\n        rootEl.onclick = null;\r\n        btnElArr.forEach(item => BB.destroyEl(item));\r\n        btnElArr.splice(0, btnElArr.length);\r\n\r\n        if (p.callback) {\r\n            p.callback(value);\r\n        }\r\n    }\r\n\r\n    if (p.closeFunc) {\r\n        p.closeFunc(function () {\r\n            close('Cancel');\r\n        });\r\n    }\r\n\r\n    return {\r\n        setIgnoreBackground: (b: boolean) => {\r\n            ignoreBackground = b;\r\n        },\r\n    } as const;\r\n}","\r\n// not the best\r\n\r\n/**\r\n * how many modals are open\r\n */\r\n\r\nexport class DialogCounter {\r\n    private listeners: ((v: number) => void)[] = [];\r\n    private count = 0;\r\n\r\n    private emit (): void {\r\n        this.listeners.forEach(item => {\r\n            item(this.count);\r\n        });\r\n    }\r\n\r\n    increase (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count += v;\r\n        } else {\r\n            this.count++;\r\n        }\r\n        this.emit();\r\n    }\r\n    decrease (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count -= v;\r\n        } else {\r\n            this.count--;\r\n        }\r\n        this.emit();\r\n    }\r\n    get (): number {\r\n        return this.count;\r\n    }\r\n    subscribe (listener: (v: number) => void): void {\r\n        this.listeners.push(listener);\r\n    }\r\n}\r\n\r\nexport const dialogCounter = new DialogCounter();\r\n","import {\r\n    append,\r\n    centerWithin,\r\n    copyObj,\r\n    createSvg,\r\n    css,\r\n    dateDayDifference,\r\n    decToFraction,\r\n    fitInto,\r\n    gcd,\r\n    getDate,\r\n    handleClick,\r\n    imageBlobToUrl,\r\n    insertAfter, isDark,\r\n    loadImage, nullToUndefined,\r\n    reduce,\r\n    setAttributes,\r\n    shareCanvas,\r\n    throwIfNull,\r\n} from './base/base';\r\nimport {\r\n    canShareFiles,\r\n    eventUsesHighResTimeStamp,\r\n    hasPointerEvents,\r\n    isCssMinMaxSupported, unsetEventHandler,\r\n} from './base/browser';\r\nimport {KeyListener, sameKeys} from './input/key-listener';\r\nimport {PointerListener} from './input/pointer-listener';\r\nimport {\r\n    canvasBounds,\r\n    convertToAlphaChannelCanvas,\r\n    copyCanvas,\r\n    createCheckerCanvas,\r\n    createCheckerDataUrl,\r\n    ctx,\r\n    drawTransformedImageOnCanvas,\r\n    drawTransformedImageWithBounds,\r\n    freeCanvas,\r\n    resizeCanvas,\r\n    testShouldPixelate,\r\n} from './base/canvas';\r\nimport {Matrix} from './math/matrix';\r\nimport {Vec2} from './math/vec2';\r\nimport {BezierLine, PointLine, projectPointOnLine, quadraticSplineInput, SplineInterpolator} from './math/line';\r\nimport {CMYK, ColorConverter, HSV, RGB, testIsWhiteBestContrast} from './color/color';\r\nimport {\r\n    appendTextDiv,\r\n    clearSelection,\r\n    destroyEl,\r\n    el,\r\n    isInputFocused,\r\n    makeUnfocusable,\r\n    unfocusAnyInput,\r\n} from './base/ui';\r\nimport {\r\n    boundsInArea,\r\n    clamp,\r\n    dist,\r\n    distSquared,\r\n    intDxy,\r\n    isInsideRect,\r\n    lenSquared,\r\n    mix,\r\n    pointsToAngleDeg,\r\n    pointsToAngleRad,\r\n    rotate,\r\n    rotateAround,\r\n    round,\r\n    roundEven,\r\n    roundUneven,\r\n    updateBounds,\r\n} from './math/math';\r\nimport {createCanvas} from './base/create-canvas';\r\nimport {BbLog} from './base/bb-log';\r\nimport {LocalStorage} from './base/local-storage';\r\nimport {CoalescedExploder} from './input/event-chain/coalesced-exploder';\r\nimport {NFingerTapper} from './input/event-chain/n-finger-tapper';\r\nimport {PinchZoomer} from './input/event-chain/pinch-zoomer';\r\nimport {DoubleTapper} from './input/event-chain/double-tapper';\r\nimport {OnePointerLimiter} from './input/event-chain/one-pointer-limiter';\r\nimport {EventChain} from './input/event-chain/event-chain';\r\n\r\nexport const BB = {\r\n\r\n    // ---- browser ----\r\n    eventUsesHighResTimeStamp,\r\n    hasPointerEvents,\r\n    isCssMinMaxSupported,\r\n    canShareFiles,\r\n    unsetEventHandler,\r\n\r\n    // ---- base ----\r\n    insertAfter,\r\n    loadImage,\r\n    css,\r\n    setAttributes,\r\n    append,\r\n    fitInto,\r\n    centerWithin,\r\n    getDate,\r\n    gcd,\r\n    reduce,\r\n    decToFraction,\r\n    imageBlobToUrl,\r\n    dateDayDifference,\r\n    copyObj,\r\n    shareCanvas,\r\n    handleClick,\r\n    createSvg,\r\n    BbLog,\r\n    LocalStorage,\r\n    throwIfNull,\r\n    nullToUndefined,\r\n    isDark,\r\n\r\n    // ---- math ----\r\n    mix,\r\n    dist,\r\n    distSquared,\r\n    lenSquared,\r\n    pointsToAngleRad,\r\n    pointsToAngleDeg,\r\n    isInsideRect,\r\n    clamp,\r\n    rotate,\r\n    rotateAround,\r\n    Matrix,\r\n    Vec2,\r\n    intDxy,\r\n    roundEven,\r\n    roundUneven,\r\n    round,\r\n    updateBounds,\r\n    boundsInArea,\r\n\r\n    // ---- line ----\r\n    projectPointOnLine,\r\n    PointLine,\r\n    BezierLine,\r\n    SplineInterpolator,\r\n    quadraticSplineInput,\r\n\r\n    // ---- canvas ----\r\n    canvas: createCanvas,\r\n    ctx,\r\n    copyCanvas,\r\n    testShouldPixelate,\r\n    drawTransformedImageWithBounds,\r\n    drawTransformedImageOnCanvas,\r\n    createCheckerCanvas,\r\n    createCheckerDataUrl,\r\n    resizeCanvas,\r\n    convertToAlphaChannelCanvas,\r\n    freeCanvas,\r\n    canvasBounds,\r\n\r\n    // ---- color ----\r\n    HSV,\r\n    RGB,\r\n    CMYK,\r\n    ColorConverter,\r\n    testIsWhiteBestContrast,\r\n\r\n    // ---- UI ----\r\n    appendTextDiv,\r\n    clearSelection,\r\n    makeUnfocusable,\r\n    el,\r\n    destroyEl,\r\n    isInputFocused,\r\n    unfocusAnyInput,\r\n\r\n\r\n    // ---- events / input ----\r\n\r\n    KeyListener,\r\n    PointerListener,\r\n    sameKeys,\r\n\r\n    EventChain,\r\n    DoubleTapper,\r\n    NFingerTapper,\r\n    PinchZoomer,\r\n    CoalescedExploder,\r\n    OnePointerLimiter,\r\n};\r\n\r\nObject.keys(BB); // without this, parcel build may break this object","\r\nexport const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\r\n\r\nexport const eventUsesHighResTimeStamp = (function (): (() => boolean) {\r\n    const eventUsesHighResTimeStamp: boolean = new Event('').timeStamp < 1000 * 60 * 60;\r\n    return function (): boolean {\r\n        return eventUsesHighResTimeStamp;\r\n    };\r\n})();\r\n\r\nexport const hasPointerEvents = !!window.PointerEvent;\r\n\r\nexport const isCssMinMaxSupported = (function (): (() => boolean) {\r\n    let result: boolean | undefined;\r\n\r\n    function test (): void {\r\n        const div = document.createElement('div');\r\n        div.style.position = 'absolute';\r\n        div.style.top = '0';\r\n        div.style.left = 'max(0px, 25px)';\r\n        document.body.append(div);\r\n        setTimeout(function () {\r\n            result = div.offsetLeft === 25;\r\n            div.remove();\r\n        }, 25);\r\n    }\r\n\r\n    if (document.body) {\r\n        test();\r\n    } else {\r\n        window.addEventListener('DOMContentLoaded', function () {\r\n            test();\r\n        });\r\n    }\r\n\r\n    return function (): boolean {\r\n        if (result === undefined) {\r\n            throw new Error('isCssMinMaxSupported not initialized');\r\n        }\r\n        return result;\r\n    };\r\n})();\r\n\r\nexport const canShareFiles = function (): boolean {\r\n    return 'share' in navigator && 'canShare' in navigator;\r\n};\r\n\r\ntype THandler = 'onchange' | 'onclick' | 'onkeyup';\r\nexport function unsetEventHandler (obj: HTMLElement, ...handlers: [...THandler[]]): void {\r\n    handlers.forEach(handler => {\r\n        // (disabled) eslint-disable-next-line no-null/no-null\r\n        obj[handler] = null;\r\n    });\r\n}","import {IKeyString} from '../bb-types';\r\n\r\ntype TGlobalKey = {\r\n    add: (keyListenerRef: TKeyListenerRef) => void;\r\n    remove: (keyListenerRef: TKeyListenerRef) => void;\r\n    getIsDown: () => TIsDown;\r\n    getCombo: () => string[];\r\n}\r\n\r\ntype TIsDown = {\r\n    [key: string]: boolean;\r\n};\r\n\r\nexport type TOnKeyDown = (keyStr: string, e: KeyboardEvent, comboStr: string, isRepeat?: boolean) => void;\r\nexport type TOnKeyUp = (keyStr: string, e: KeyboardEvent, oldComboStr: string) => void;\r\ntype TOnBlur = () => void;\r\ntype TKeyListenerRef = [\r\n    TOnKeyDown | undefined,\r\n    TOnKeyUp | undefined,\r\n    TOnBlur | undefined,\r\n];\r\n\r\n\r\nconst globalKey = ((): TGlobalKey => {\r\n\r\n    // keyStr - our key naming system\r\n    // key - KeyboardEvent.key\r\n    // code - KeyboardEvent.code\r\n\r\n    const keyStrToKeyObj = { // keyStr not to contain a '+', because that's used for the comboStr\r\n        'space': [' ', 'Spacebar'], // Spacebar in IE\r\n        'alt': ['Alt', 'AltGraph'],\r\n        'shift': 'Shift',\r\n        'ctrl': 'Control',\r\n        'cmd': ['Meta', 'MetaLeft', 'MetaRight'],\r\n        'enter': 'Enter',\r\n        'esc': 'Escape',\r\n        'backspace': 'Backspace',\r\n        'delete': 'Delete',\r\n        'sqbr_open': '[',\r\n        'sqbr_close': ']',\r\n        'a': ['a', 'A'],\r\n        'b': ['b', 'B'],\r\n        'c': ['c', 'C'],\r\n        'e': ['e', 'E'],\r\n        'f': ['f', 'F'],\r\n        'g': ['g', 'G'],\r\n        'r': ['r', 'R'], // when holding shift\r\n        's': ['s', 'S'],\r\n        't': ['t', 'T'],\r\n        'u': ['u', 'U'],\r\n        'x': ['x', 'X'],\r\n        'y': ['y', 'Y'],\r\n        'z': ['z', 'Z'],\r\n        'plus': '+',\r\n        'minus': '-',\r\n        'left': 'ArrowLeft',\r\n        'right': 'ArrowRight',\r\n        'up': 'ArrowUp',\r\n        'down': 'ArrowDown',\r\n        'home': 'Home',\r\n        'end': 'End',\r\n    };\r\n\r\n    // ['space', 'alt', ... ]\r\n    const keyStrArr = Object.keys(keyStrToKeyObj);\r\n\r\n    // { space: false, ... }\r\n    const isDownObj: TIsDown = Object.entries(keyStrToKeyObj).reduce((acc, [key]) => {\r\n        acc[key] = false;\r\n        return acc;\r\n    }, {} as TIsDown);\r\n\r\n    // event.key to keyStr\r\n    // { ArrowLeft: 'left', ... }\r\n    const keyToKeyStrObj = Object.entries(keyStrToKeyObj).reduce((acc, [key, code]) => {\r\n        if (typeof code === 'string') {\r\n            acc[code] = key;\r\n        } else {\r\n            code.forEach(item => {\r\n                acc[item] = key;\r\n            });\r\n        }\r\n        return acc;\r\n    }, {} as IKeyString);\r\n\r\n    let comboArr: string[] = [];\r\n\r\n    // a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\r\n    // { KeyE: 'e', KeyF: undefined } - undefined - not down, string - the associated keyStr\r\n    let codeIsDownObj: {\r\n        [key: string]: string | undefined;\r\n    } = {};\r\n    const listenerArr: TKeyListenerRef[] = [];\r\n\r\n\r\n    const emitDown: TOnKeyDown = function (a, b, c, d?): void {\r\n        listenerArr.forEach(item => {\r\n            if (!item[0]) {\r\n                return;\r\n            }\r\n            item[0](a, b, c, d);\r\n        });\r\n    };\r\n\r\n    const emitUp: TOnKeyUp = function (a, b, c): void {\r\n        listenerArr.forEach(item => {\r\n            if (!item[1]) {\r\n                return;\r\n            }\r\n            item[1](a, b, c);\r\n        });\r\n    };\r\n\r\n    const emitBlur: TOnBlur = function (): void {\r\n        listenerArr.forEach(item => {\r\n            if (!item[2]) {\r\n                return;\r\n            }\r\n            item[2]();\r\n        });\r\n    };\r\n\r\n    function keyDown (e: KeyboardEvent): void {\r\n        const key = e.key;\r\n        const code = e.code;\r\n\r\n        if (key in keyToKeyStrObj) {\r\n            const keyStr = keyToKeyStrObj[key];\r\n            if (isDownObj[keyStr]) {\r\n                emitDown(keyStr, e, comboArr.join('+'), true);\r\n                return;\r\n            }\r\n            isDownObj[keyStr] = true;\r\n            codeIsDownObj[code] = keyStr;\r\n\r\n            //add to combo\r\n            comboArr.push(keyStr);\r\n\r\n            emitDown(keyStr, e, comboArr.join('+'));\r\n        }\r\n    }\r\n\r\n\r\n    function keyUp (e: KeyboardEvent): void {\r\n        const code = e.code;\r\n        const oldComboStr = comboArr.join('+');\r\n\r\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\r\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\r\n        if ([\r\n            'Meta', 'MetaLeft', 'MetaRight',\r\n            'OSLeft', 'OSRight', // Firefox\r\n        ].includes(code)) {\r\n            blur();\r\n            return;\r\n        }\r\n\r\n        const keyStr = codeIsDownObj[code];\r\n        if (keyStr !== undefined) {\r\n            isDownObj[keyStr] = false;\r\n            codeIsDownObj[code] = undefined;\r\n\r\n            // remove from combo\r\n            for (let i = 0; i < comboArr.length; i++) {\r\n                if (comboArr[i] == keyStr) {\r\n                    comboArr.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n\r\n            emitUp(keyStr, e, oldComboStr);\r\n        }\r\n    }\r\n\r\n    function blur (): void {\r\n        const oldComboStr = comboArr.join('+');\r\n        comboArr = [];\r\n        codeIsDownObj = {};\r\n\r\n        const eventArr: string[] = [];\r\n        keyStrArr.forEach(keyStr => {\r\n            if (isDownObj[keyStr]) {\r\n                isDownObj[keyStr] = false;\r\n                eventArr.push(keyStr);\r\n            }\r\n        });\r\n        for (let i = 0; i < eventArr.length; i++) {\r\n            emitUp(\r\n                eventArr[i],\r\n                {\r\n                    preventDefault: function () {},\r\n                    stopPropagation: function () {},\r\n                } as KeyboardEvent,\r\n                oldComboStr,\r\n            );\r\n        }\r\n        emitBlur();\r\n    }\r\n\r\n\r\n\r\n    return {\r\n        add: (keyListenerRef: TKeyListenerRef): void => {\r\n            if (listenerArr.includes(keyListenerRef)) {\r\n                return;\r\n            }\r\n            const first = listenerArr.length === 0;\r\n            listenerArr.push(keyListenerRef);\r\n\r\n            if (first) {\r\n                document.addEventListener('keydown', keyDown);\r\n                document.addEventListener('keyup', keyUp);\r\n                window.addEventListener('blur', blur);\r\n            }\r\n        },\r\n        remove: (keyListenerRef: TKeyListenerRef): void => {\r\n            if (!listenerArr.includes(keyListenerRef)) {\r\n                return;\r\n            }\r\n            const last = listenerArr.length === 1;\r\n            for (let i = 0; i < listenerArr.length; i++) {\r\n                if (listenerArr[i] === keyListenerRef) {\r\n                    listenerArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n            if (last) {\r\n                document.removeEventListener('keydown', keyDown);\r\n                document.removeEventListener('keyup', keyUp);\r\n                window.removeEventListener('blur', blur);\r\n            }\r\n        },\r\n        getIsDown: (): TIsDown => isDownObj,\r\n        getCombo: (): string[] => comboArr,\r\n    };\r\n})();\r\n\r\n\r\n\r\n/**\r\n * Listens to key events in window. Makes combos easier - e.g. ctrl + z\r\n *\r\n * keyStr - see in implementation - my representation of a key. e.g. 'r' can be 'r' and 'R'\r\n * comboStr - string joins currently pressed keyStr with a +\r\n *              e.g. 'ctrl+z'\r\n *\r\n */\r\nexport class KeyListener {\r\n\r\n    private readonly onDown: TOnKeyDown | undefined;\r\n    private readonly onUp: TOnKeyUp | undefined;\r\n    private readonly onBlur: TOnBlur | undefined;\r\n    private readonly ref: TKeyListenerRef;\r\n\r\n    constructor (\r\n        p: {\r\n            onDown?: TOnKeyDown;\r\n            onUp?: TOnKeyUp;\r\n            onBlur?: TOnBlur;\r\n        },\r\n    ) {\r\n        this.onDown = p.onDown;\r\n        this.onUp = p.onUp;\r\n        this.onBlur = p.onBlur;\r\n        this.ref = [this.onDown, this.onUp, this.onBlur];\r\n        globalKey.add(this.ref);\r\n    }\r\n\r\n    isPressed (keyStr: string): boolean {\r\n        if (!(keyStr in globalKey.getIsDown())) {\r\n            throw 'key \"' + keyStr + '\" not found';\r\n        }\r\n        return globalKey.getIsDown()[keyStr];\r\n    }\r\n\r\n    getComboStr (): string {\r\n        return globalKey.getCombo().join('+');\r\n    }\r\n\r\n    comboOnlyContains (keyStrArr: string[]): boolean {\r\n        for (let i = 0; i < globalKey.getCombo().length; i++) {\r\n            if (!keyStrArr.includes(globalKey.getCombo()[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    destroy (): void {\r\n        globalKey.remove(this.ref);\r\n    }\r\n}\r\n\r\n/**\r\n * Test, are the same keys pressed. Order does not matter.\r\n */\r\nexport function sameKeys (comboAStr: string, comboBStr: string): boolean {\r\n    return comboAStr.split('+').sort().join('+') === comboBStr.split('+').sort().join('+');\r\n}","import {eventUsesHighResTimeStamp, hasPointerEvents, isFirefox} from '../base/browser';\r\nimport {WheelCleaner} from './wheel-cleaner';\r\nimport {IPointerEvent, IWheelEvent, TPointerButton, TPointerEventType, TPointerType} from './event.types';\r\nimport {PressureNormalizer} from './pressure-normalizer';\r\n\r\nexport interface IPointerListenerParams {\r\n    target: HTMLElement | SVGElement;\r\n    onPointer?: (pointerEvent: IPointerEvent) => void;\r\n    onWheel?: (wheelEvent: IWheelEvent) => void;\r\n    onEnterLeave?: (isOver: boolean) => void; // optional\r\n    maxPointers?: number; // int [1,n] default is 1 - how many concurrent pointers to pay attention to\r\n    fixScribble?: boolean; // fix ipad scribble issue - TODO remove, fixed start of 2022 -> https://bugs.webkit.org/show_bug.cgi?id=217430#c2\r\n}\r\n\r\ninterface IPointer {\r\n    pointerId: number;\r\n    lastPageX: number | null;\r\n    lastPageY: number | null;\r\n}\r\n\r\ninterface IDragObj {\r\n    pointerId: number; // long\r\n    pointerType?: TPointerType;\r\n    downPageX: number; //where was pointer when down-event occurred\r\n    downPageY: number;\r\n    buttons: number; // long\r\n    lastPageX: number; //pageX in previous event - only for touch events, because they don't have movementX/Y\r\n    lastPageY: number;\r\n    lastTimeStamp?: number;\r\n}\r\n\r\ninterface ICoalescedPointerEvent {\r\n    pageX: number;\r\n    pageY: number;\r\n    clientX: number;\r\n    clientY: number;\r\n    movementX: number;\r\n    movementY: number;\r\n    timeStamp: number;\r\n    pressure: number;\r\n}\r\n\r\ninterface ICorrectedPointerEvent {\r\n    pointerId: number;\r\n    pointerType: string;\r\n    pageX: number;\r\n    pageY: number;\r\n    clientX: number;\r\n    clientY: number;\r\n    movementX: number;\r\n    movementY: number;\r\n    timeStamp: number;\r\n    pressure: number; // normalized\r\n    buttons: number;\r\n    button: number;\r\n    coalescedArr: ICoalescedPointerEvent[];\r\n    eventPreventDefault: () => void;\r\n    eventStopPropagation: () => void;\r\n}\r\n\r\ninterface TExtendedDOMPointerEvent extends PointerEvent {\r\n    corrected: ICorrectedPointerEvent;\r\n}\r\n\r\n\r\n// keeping track of pointers for movement fallback\r\nconst pointerArr: IPointer[] = [];\r\n\r\nfunction addPointer (event: ICorrectedPointerEvent): IPointer {\r\n    const pointerObj: IPointer = {\r\n        pointerId: event.pointerId,\r\n        lastPageX: null,\r\n        lastPageY: null,\r\n    };\r\n    pointerArr.push(pointerObj);\r\n\r\n    if (pointerArr.length > 15) {\r\n        pointerArr.shift();\r\n    }\r\n\r\n    return pointerObj;\r\n}\r\n\r\nfunction getPointer (event: ICorrectedPointerEvent): IPointer | null {\r\n    for (let i = pointerArr.length - 1; i >= 0; i--) {\r\n        if (event.pointerId === pointerArr[i].pointerId) {\r\n            return pointerArr[i];\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction getButtonStr (buttons: number): TPointerButton | undefined {\r\n    switch (buttons) {\r\n        case 1:\r\n            return 'left';\r\n        case 2:\r\n            return 'right';\r\n        case 4:\r\n            return 'middle';\r\n        default:\r\n            return undefined;\r\n    }\r\n}\r\n\r\nconst pressureNormalizer = new PressureNormalizer();\r\nconst timeStampOffset = eventUsesHighResTimeStamp() ? 0 : -performance.timing.navigationStart;\r\n\r\n\r\nconst pointerDownEvt = (hasPointerEvents ? 'pointerdown' : 'mousedown') as 'pointerdown';\r\nconst pointerMoveEvt = (hasPointerEvents ? 'pointermove' : 'mousemove') as 'pointermove';\r\nconst pointerUpEvt = (hasPointerEvents ? 'pointerup' : 'mouseup') as 'pointerup';\r\nconst pointerCancelEvt = (hasPointerEvents ? 'pointercancel' : 'mousecancel') as 'pointercancel';\r\nconst pointerLeaveEvt = (hasPointerEvents ? 'pointerleave' : 'mouseleave') as 'pointerleave';\r\nconst pointerEnterEvt = (hasPointerEvents ? 'pointerenter' : 'mouseenter') as 'pointerenter';\r\n\r\n\r\n/**\r\n * More trustworthy pointer attributes. that behave the same across browsers.\r\n * returns a new object. Also attaches itself to the orig event. -> event.corrected\r\n */\r\nfunction correctPointerEvent (event: PointerEvent | TExtendedDOMPointerEvent): ICorrectedPointerEvent {\r\n    if ('corrected' in event) {\r\n        return event.corrected;\r\n    }\r\n\r\n    function determineButtons (): number {\r\n        if (event.buttons !== undefined) {\r\n            return event.buttons;\r\n        }\r\n        /*\r\n                button -> buttons\r\n        none:\tundefined -> 0\r\n        left:\t0 -> 1\r\n        middle:\t1 -> 4\r\n        right:\t2 -> 2\r\n        fourth:\t3 -> 8\r\n        fifth:\t4 -> 16\r\n         */\r\n        if (event.button !== undefined) { // old safari on mac has no buttons. remove eventually.\r\n            return [1,4,2,8,16][event.button];\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    const correctedObj: ICorrectedPointerEvent = {\r\n        pointerId: event.pointerId,\r\n        pointerType: event.pointerType,\r\n        pageX: event.pageX,\r\n        pageY: event.pageY,\r\n        clientX: event.clientX,\r\n        clientY: event.clientY,\r\n        movementX: event.movementX,\r\n        movementY: event.movementY,\r\n        timeStamp: event.timeStamp + timeStampOffset,\r\n        pressure: pressureNormalizer.normalize(event.pressure),\r\n        buttons: determineButtons(),\r\n        button: event.button,\r\n        coalescedArr: [],\r\n        eventPreventDefault: () => event.preventDefault(),\r\n        eventStopPropagation: () => event.stopPropagation(),\r\n    };\r\n    (event as TExtendedDOMPointerEvent).corrected = correctedObj;\r\n\r\n    let customPressure = null;\r\n    if ('pointerId' in event) {\r\n        if ('pressure' in event && event.buttons !== 0 && (['mouse'].includes(event.pointerType) || (event.pointerType === 'touch' && event.pressure === 0))) {\r\n            correctedObj.pressure = 1;\r\n            customPressure = 1;\r\n        }\r\n    } else {\r\n        correctedObj.pointerId = 0;\r\n        correctedObj.pointerType = 'mouse';\r\n        correctedObj.pressure = (event as PointerEvent).buttons !== 0 ? 1 : 0;\r\n        customPressure = correctedObj.pressure;\r\n    }\r\n\r\n    if (isFirefox && event.pointerType != 'mouse' && event.type === 'pointermove' && event.buttons === 0) { // once again firefox\r\n        correctedObj.buttons = 1; // todo wrong if no buttons actually pressed\r\n    }\r\n\r\n    let coalescedEventArr: PointerEvent[] = [];\r\n    if ('getCoalescedEvents' in event) {\r\n        coalescedEventArr = event.getCoalescedEvents();\r\n    }\r\n\r\n    // chrome somehow movementX not same scale as pageX. todo: only chrome?\r\n    // so make my own\r\n\r\n    const pointerObj: IPointer = getPointer(correctedObj) || addPointer(correctedObj);\r\n\r\n    const totalLastX = pointerObj.lastPageX;\r\n    const totalLastY = pointerObj.lastPageY;\r\n\r\n    for (let i = 0; i < coalescedEventArr.length; i++) {\r\n        const eventItem = coalescedEventArr[i];\r\n\r\n        correctedObj.coalescedArr.push({\r\n            pageX: eventItem.pageX,\r\n            pageY: eventItem.pageY,\r\n            clientX: eventItem.clientX,\r\n            clientY: eventItem.clientY,\r\n            movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\r\n            movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\r\n            timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : (eventItem.timeStamp + timeStampOffset), // 0 in firefox\r\n            pressure: customPressure === null ? pressureNormalizer.normalize(eventItem.pressure) : customPressure,\r\n        });\r\n\r\n        pointerObj.lastPageX = eventItem.pageX;\r\n        pointerObj.lastPageY = eventItem.pageY;\r\n    }\r\n\r\n    pointerObj.lastPageX = correctedObj.pageX;\r\n    pointerObj.lastPageY = correctedObj.pageY;\r\n    correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\r\n    correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\r\n\r\n    return correctedObj;\r\n}\r\n\r\n/**\r\n * PointerListener - for pointer events, wheel events. uses fallbacks. ideally consistent behavior across browsers.\r\n * Has some workarounds for browser specific bugs. As browsers evolve this constructor should get smaller.\r\n */\r\nexport class PointerListener {\r\n\r\n    private isDestroyed: boolean = false;\r\n\r\n    // ts has problems with (HTMLElement|SVGElement) when adding event listeners\r\n    // https://github.com/microsoft/TypeScript/issues/46819\r\n    private readonly targetElement: HTMLElement;\r\n    private readonly onPointerCallback: undefined | ((pointerEvent: IPointerEvent) => void);\r\n    private readonly onWheelCallback: undefined | ((wheelEvent: IWheelEvent) => void);\r\n    private readonly onEnterLeaveCallback: undefined | ((isOver: boolean) => void);\r\n    private readonly maxPointers: number;\r\n    private readonly wheelCleaner: WheelCleaner;\r\n    private isOverCounter: number = 0;\r\n\r\n    // pointers that are pressing a button\r\n    private dragObjArr: IDragObj[] = [];\r\n    private dragPointerIdArr: number[] = [];\r\n\r\n    // chrome input glitch workaround\r\n    private lastPointerType: TPointerType | null = null;\r\n    private didSkip: boolean = false;\r\n\r\n    // listeners\r\n    private readonly onPointerEnter: (() => void) | undefined;\r\n    private readonly onPointerLeave: (() => void) | undefined;\r\n    private readonly onPointerMove: ((event: PointerEvent) => void) | undefined;\r\n    private readonly onPointerDown: ((event: PointerEvent, skipGlobal?: boolean) => void) | undefined;\r\n    private readonly onWheel: ((e: WheelEvent) => void) | undefined;\r\n    private readonly onTouchMoveScribbleFix: ((e: TouchEvent) => void) | undefined;\r\n    private readonly windowOnPointerMove: ((event: PointerEvent) => void) | undefined;\r\n    private readonly windowOnPointerUp: ((event: PointerEvent) => void) | undefined;\r\n    private readonly windowOnPointerLeave: ((event: PointerEvent) => void) | undefined;\r\n    // fallback pre pointer events (iOS < 13, as of 2023-02, still 4.4% of iOS users)\r\n    private readonly onTouchStart: ((e: TouchEvent) => void) | undefined;\r\n    private readonly onTouchMove: ((e: TouchEvent) => void) | undefined;\r\n    private readonly onTouchEnd: ((e: TouchEvent) => void) | undefined;\r\n    private readonly onTouchCancel: ((e: TouchEvent) => void) | undefined;\r\n\r\n\r\n    private getDragObj (pointerId: number): IDragObj | null {\r\n        for (let i = 0; i < this.dragObjArr.length; i++) {\r\n            if (pointerId === this.dragObjArr[i].pointerId) {\r\n                return this.dragObjArr[i];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private removeDragObj (pointerId: number): IDragObj | null {\r\n        let removedDragObj: IDragObj | null = null;\r\n        for (let i = 0; i < this.dragPointerIdArr.length; i++) {\r\n            if (this.dragPointerIdArr[i] === pointerId) {\r\n                removedDragObj = this.dragObjArr[i];\r\n                this.dragObjArr.splice(i, 1);\r\n                this.dragPointerIdArr.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n        return removedDragObj;\r\n    }\r\n\r\n    /**\r\n     * Creates a value for onPointer, from a pointer event handler.\r\n     */\r\n    private createPointerOutEvent (\r\n        typeStr: TPointerEventType,\r\n        correctedEvent: ICorrectedPointerEvent,\r\n        custom?: Partial<IPointerEvent>,\r\n    ): IPointerEvent {\r\n\r\n        const bounds: DOMRect = this.targetElement.getBoundingClientRect();\r\n        const result: IPointerEvent = {\r\n            type: typeStr,\r\n            pointerId: correctedEvent.pointerId,\r\n            pointerType: correctedEvent.pointerType as TPointerType,\r\n            pageX: correctedEvent.pageX,\r\n            pageY: correctedEvent.pageY,\r\n            clientX: correctedEvent.clientX,\r\n            clientY: correctedEvent.clientY,\r\n            relX: correctedEvent.clientX - bounds.left + this.targetElement.scrollLeft,\r\n            relY: correctedEvent.clientY - bounds.top + this.targetElement.scrollTop,\r\n            dX: correctedEvent.movementX,\r\n            dY: correctedEvent.movementY,\r\n            time: correctedEvent.timeStamp,\r\n            eventPreventDefault: correctedEvent.eventPreventDefault,\r\n            eventStopPropagation: correctedEvent.eventStopPropagation,\r\n            ...custom,\r\n        };\r\n\r\n        if (typeStr === 'pointermove') {\r\n            result.coalescedArr = [];\r\n            if (correctedEvent.coalescedArr.length > 1) {\r\n                let coalescedItem;\r\n                for (let i = 0; i < correctedEvent.coalescedArr.length; i++) {\r\n                    coalescedItem = correctedEvent.coalescedArr[i];\r\n                    result.coalescedArr.push({\r\n                        pageX: coalescedItem.pageX,\r\n                        pageY: coalescedItem.pageY,\r\n                        clientX: coalescedItem.clientX,\r\n                        clientY: coalescedItem.clientY,\r\n                        relX: coalescedItem.clientX - bounds.left + this.targetElement.scrollLeft,\r\n                        relY: coalescedItem.clientY - bounds.top + this.targetElement.scrollTop,\r\n                        dX: coalescedItem.movementX,\r\n                        dY: coalescedItem.movementY,\r\n                        time: coalescedItem.timeStamp,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private setupDocumentListeners () {\r\n        this.windowOnPointerMove && document.addEventListener(pointerMoveEvt, this.windowOnPointerMove);\r\n        this.windowOnPointerUp && document.addEventListener(pointerUpEvt, this.windowOnPointerUp);\r\n        this.windowOnPointerLeave && document.addEventListener(pointerCancelEvt, this.windowOnPointerLeave);\r\n        this.windowOnPointerLeave && document.addEventListener(pointerLeaveEvt, this.windowOnPointerLeave);\r\n    }\r\n\r\n    private destroyDocumentListeners () {\r\n        this.windowOnPointerMove && document.removeEventListener(pointerMoveEvt, this.windowOnPointerMove);\r\n        this.windowOnPointerUp && document.removeEventListener(pointerUpEvt, this.windowOnPointerUp);\r\n        this.windowOnPointerLeave && document.removeEventListener(pointerCancelEvt, this.windowOnPointerLeave);\r\n        this.windowOnPointerLeave && document.removeEventListener(pointerLeaveEvt, this.windowOnPointerLeave);\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (p: IPointerListenerParams) {\r\n        this.targetElement = p.target as HTMLElement;\r\n        this.onPointerCallback = p.onPointer;\r\n        this.onWheelCallback = p.onWheel;\r\n        this.onEnterLeaveCallback = p.onEnterLeave;\r\n        this.maxPointers = Math.max(1, p.maxPointers || 1);\r\n\r\n\r\n        this.wheelCleaner = new WheelCleaner((cleanerEvent) => {\r\n            if (this.isDestroyed || !this.onWheelCallback) {\r\n                return;\r\n            }\r\n            const bounds = this.targetElement.getBoundingClientRect();\r\n            const whlEvent = {\r\n                ...cleanerEvent,\r\n                relX: cleanerEvent.clientX - bounds.left + this.targetElement.scrollLeft,\r\n                relY: cleanerEvent.clientY - bounds.top + this.targetElement.scrollTop,\r\n            };\r\n            this.onWheelCallback(whlEvent);\r\n        });\r\n\r\n        if (this.onPointerCallback) {\r\n            this.onPointerMove = (event: PointerEvent) => {\r\n                const correctedEvent = correctPointerEvent(event);\r\n\r\n                const tempLastPointerType = this.lastPointerType;\r\n                this.lastPointerType = correctedEvent.pointerType as TPointerType;\r\n\r\n                if (\r\n                    this.dragPointerIdArr.includes(correctedEvent.pointerId) ||\r\n                    this.dragPointerIdArr.length === this.maxPointers ||\r\n                    correctedEvent.pointerType === 'touch'\r\n                ) {\r\n                    this.didSkip = false;\r\n                    return;\r\n                }\r\n\r\n                // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\r\n                if (!this.didSkip && correctedEvent.pointerType === 'mouse' && tempLastPointerType === 'pen') {\r\n                    this.didSkip = true;\r\n                    return;\r\n                }\r\n                this.didSkip = false;\r\n\r\n                const outEvent = this.createPointerOutEvent('pointermove', correctedEvent);\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.onPointerDown = (event: PointerEvent, onSkipGlobal? : boolean) => {\r\n\r\n                //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' pointerdown');\r\n                if (this.dragPointerIdArr.includes(correctedEvent.pointerId) || this.dragPointerIdArr.length === this.maxPointers || ![1, 2, 4].includes(correctedEvent.buttons)) {\r\n                    //BB.throwOut('pointerdown ignored');\r\n                    return;\r\n                }\r\n\r\n                //set up global listeners\r\n                if (this.dragObjArr.length === 0 && !onSkipGlobal) {\r\n                    this.setupDocumentListeners();\r\n                }\r\n                const dragObj: IDragObj = {\r\n                    pointerId: correctedEvent.pointerId,\r\n                    pointerType: correctedEvent.pointerType as TPointerType,\r\n                    downPageX: correctedEvent.pageX,\r\n                    downPageY: correctedEvent.pageY,\r\n                    buttons: correctedEvent.buttons,\r\n                    lastPageX: correctedEvent.pageX,\r\n                    lastPageY: correctedEvent.pageY,\r\n                    lastTimeStamp: correctedEvent.timeStamp,\r\n                };\r\n                this.dragObjArr.push(dragObj);\r\n                this.dragPointerIdArr.push(correctedEvent.pointerId);\r\n\r\n                const outEvent: IPointerEvent = this.createPointerOutEvent('pointerdown', correctedEvent, {\r\n                    downPageX: correctedEvent.pageX,\r\n                    downPageY: correctedEvent.pageY,\r\n                    button: getButtonStr(correctedEvent.buttons),\r\n                    pressure: correctedEvent.pressure,\r\n                });\r\n\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.windowOnPointerMove = (event: PointerEvent) => {\r\n                //BB.throwOut('pointermove ' + event.pointerId);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\r\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) {\r\n                    return;\r\n                }\r\n\r\n                const dragObj = this.getDragObj(correctedEvent.pointerId);\r\n\r\n                if (!dragObj) {\r\n                    // todo need to handle this!\r\n                    return;\r\n                }\r\n\r\n                //if pointer changes button its pressing -> turn into pointerup\r\n                if (correctedEvent.buttons !== dragObj.buttons) {\r\n                    //pointer up\r\n\r\n                    //remove listener\r\n                    if (this.dragObjArr.length === 1) {\r\n                        this.destroyDocumentListeners();\r\n                    }\r\n                    this.removeDragObj(correctedEvent.pointerId);\r\n\r\n                    const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\r\n                        downPageX: dragObj.downPageX,\r\n                        downPageY: dragObj.downPageY,\r\n                    });\r\n                    this.onPointerCallback && this.onPointerCallback(outEvent);\r\n                    return;\r\n                }\r\n\r\n                // ipad likes to do this\r\n                if (\r\n                    correctedEvent.pointerType === 'pen' &&\r\n                    correctedEvent.pageX === dragObj.lastPageX &&\r\n                    correctedEvent.pageY === dragObj.lastPageY &&\r\n                    correctedEvent.timeStamp === dragObj.lastTimeStamp\r\n                ) {\r\n                    //ignore\r\n                    return;\r\n                }\r\n\r\n                const outEvent = this.createPointerOutEvent('pointermove', correctedEvent, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY,\r\n                    button: getButtonStr(correctedEvent.buttons),\r\n                    pressure: correctedEvent.pressure,\r\n                });\r\n\r\n                dragObj.lastPageX = correctedEvent.pageX;\r\n                dragObj.lastPageY = correctedEvent.pageY;\r\n                dragObj.lastTimeStamp = correctedEvent.timeStamp;\r\n\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.windowOnPointerUp = (event: PointerEvent) => {\r\n                //BB.throwOut('pointerup ' + event.pointerId);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\r\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) {\r\n                    return;\r\n                }\r\n\r\n                //remove listener\r\n                if (this.dragObjArr.length === 1) {\r\n                    this.destroyDocumentListeners();\r\n                }\r\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\r\n                if (!dragObj) {\r\n                    // todo need to handle this!\r\n                    return;\r\n                }\r\n\r\n                const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY,\r\n                });\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n\r\n            };\r\n\r\n            this.windowOnPointerLeave = (event: PointerEvent) => {\r\n                //BB.throwOut('pointerleave ' + event.pointerId);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\r\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) { //} || event.target !== document) {\r\n                    return;\r\n                }\r\n\r\n                //remove listener\r\n                if (this.dragObjArr.length === 1) {\r\n                    this.destroyDocumentListeners();\r\n                }\r\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\r\n                if (!dragObj) {\r\n                    // todo need to handle this!\r\n                    return;\r\n                }\r\n\r\n                const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY,\r\n                });\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.targetElement.addEventListener(pointerMoveEvt, this.onPointerMove);\r\n            this.targetElement.addEventListener(pointerDownEvt, this.onPointerDown);\r\n\r\n            if (!hasPointerEvents) {\r\n                const touchToFakePointer = (touch: Touch, touchEvent: TouchEvent, isDown: boolean) => {\r\n                    return {\r\n                        pointerId: touch.identifier,\r\n                        pointerType: 'touch',\r\n                        pageX: touch.pageX,\r\n                        pageY: touch.pageY,\r\n                        clientX: touch.clientX,\r\n                        clientY: touch.clientY,\r\n                        button: isDown ? 0 : undefined,\r\n                        buttons: isDown ? 1 : 0,\r\n                        timeStamp: touchEvent.timeStamp,\r\n                        target: touchEvent.target,\r\n                        pressure: isDown ? 1 : 0,\r\n                        preventDefault: () => touchEvent.preventDefault(),\r\n                        stopPropagation: () => touchEvent.stopPropagation(),\r\n                    };\r\n                };\r\n\r\n                const handleTouch = (e: TouchEvent, type: 'start' | 'move' | 'end' | 'cancel'): void => {\r\n                    for (let i = 0; i < e.changedTouches.length; i++) {\r\n                        const touch = e.changedTouches[i];\r\n                        const fakePointer = touchToFakePointer(touch, e, ['start', 'move'].includes(type));\r\n                        if (type === 'start') {\r\n                            this.onPointerDown!(fakePointer as PointerEvent, false);\r\n                        } else if (type === 'move') {\r\n                            this.windowOnPointerMove!(fakePointer as PointerEvent);\r\n                        } else if (type === 'end') {\r\n                            this.windowOnPointerUp!(fakePointer as PointerEvent);\r\n                        } else {\r\n                            this.windowOnPointerLeave!(fakePointer as PointerEvent);\r\n                        }\r\n                    }\r\n                };\r\n\r\n                this.onTouchStart = (e: TouchEvent): void => {\r\n                    e.preventDefault();\r\n                    handleTouch(e, 'start');\r\n                };\r\n                this.onTouchMove = (e: TouchEvent): void => {\r\n                    handleTouch(e, 'move');\r\n                };\r\n                this.onTouchEnd = (e: TouchEvent): void => {\r\n                    handleTouch(e, 'end');\r\n                };\r\n                this.onTouchCancel = (e: TouchEvent): void => {\r\n                    handleTouch(e, 'cancel');\r\n                };\r\n\r\n                this.targetElement.addEventListener('touchstart', this.onTouchStart);\r\n                this.targetElement.addEventListener('touchmove', this.onTouchMove);\r\n                this.targetElement.addEventListener('touchend', this.onTouchEnd);\r\n                this.targetElement.addEventListener('touchcancel', this.onTouchCancel);\r\n            }\r\n        }\r\n        if (this.onWheelCallback) {\r\n            this.onWheel = (e: WheelEvent) => {\r\n                this.wheelCleaner.process(e);\r\n            };\r\n            this.targetElement.addEventListener('wheel', this.onWheel);\r\n        }\r\n        if (this.onEnterLeaveCallback) {\r\n            this.onPointerEnter = () => {\r\n                this.isOverCounter++;\r\n                this.onEnterLeaveCallback && this.onEnterLeaveCallback(true);\r\n            };\r\n\r\n            this.onPointerLeave = () => {\r\n                this.isOverCounter--;\r\n                this.onEnterLeaveCallback && this.onEnterLeaveCallback(false);\r\n            };\r\n\r\n            this.targetElement.addEventListener(pointerEnterEvt, this.onPointerEnter);\r\n            this.targetElement.addEventListener(pointerLeaveEvt, this.onPointerLeave);\r\n        }\r\n\r\n        if (p.fixScribble) {\r\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\r\n            this.onTouchMoveScribbleFix = (e: TouchEvent) => e.preventDefault();\r\n            this.targetElement.addEventListener('touchmove', this.onTouchMoveScribbleFix);\r\n        }\r\n    }\r\n\r\n    destroy (): void {\r\n        if (this.isDestroyed) {\r\n            return;\r\n        }\r\n        this.isDestroyed = true;\r\n        this.onPointerEnter && this.targetElement.removeEventListener(pointerEnterEvt, this.onPointerEnter);\r\n        this.onPointerLeave && this.targetElement.removeEventListener(pointerLeaveEvt, this.onPointerLeave);\r\n        this.onPointerMove && this.targetElement.removeEventListener(pointerMoveEvt, this.onPointerMove);\r\n        this.onPointerDown && this.targetElement.removeEventListener(pointerDownEvt, this.onPointerDown);\r\n        this.onWheel && this.targetElement.removeEventListener('wheel', this.onWheel);\r\n        this.destroyDocumentListeners();\r\n        this.onTouchMoveScribbleFix && document.removeEventListener('touchmove', this.onTouchMoveScribbleFix);\r\n\r\n        this.onTouchStart && this.targetElement.removeEventListener('touchstart', this.onTouchStart);\r\n        this.onTouchMove && this.targetElement.removeEventListener('touchmove', this.onTouchMove);\r\n        this.onTouchEnd && this.targetElement.removeEventListener('touchend', this.onTouchEnd);\r\n        this.onTouchCancel && this.targetElement.removeEventListener('touchcancel', this.onTouchCancel);\r\n    }\r\n\r\n}","export interface IWheelCleanerEvent {\r\n    deltaY: number;\r\n    pageX: number;\r\n    pageY: number;\r\n    clientX: number;\r\n    clientY: number;\r\n}\r\n\r\nconst SEQUENCE_TIMEOUT_MS = 200;\r\n\r\n/**\r\n * Filters wheel events. removes swipe scrolling and pinch scrolling that trackpads do. (as best as it can)\r\n * Normalizes regular scrolls.\r\n *\r\n * Why:\r\n * - trackpad scrolling is different from old school mouse scrolling\r\n * - but there is no way to learn from the browser if it's trackpad scrolling\r\n * - browsers don't even give access to the raw swiping or pinching movement, but some abstraction on top, making the scrolling\r\n *      continue an arbitrary amount, at an arbitrary scale\r\n * - each browser does this differently. So you can't offer a consistent/controlled experience\r\n *\r\n * - also trackpads are painful to draw with. So supporting a trackpad-based workflow makes not much sense.\r\n */\r\nexport class WheelCleaner {\r\n\r\n    private readonly knownUnitArr: number[] = [100];\r\n    private sequenceLength: number = 0;\r\n    private sequenceUnit: null | number = null;\r\n    private endSequenceTimeout: undefined | ReturnType<typeof setTimeout>;\r\n    private toEmitDelta: null | number = null;\r\n    private position: null | {\r\n        pageX: number;\r\n        pageY: number;\r\n        clientX: number;\r\n        clientY: number;\r\n    } = null;\r\n\r\n\r\n    private emit (delta: number): void {\r\n        if (this.position === null || this.sequenceUnit === null) {\r\n            return;\r\n        }\r\n        this.callback({\r\n            deltaY: Math.round(delta / this.sequenceUnit),\r\n            pageX: this.position.pageX,\r\n            pageY: this.position.pageY,\r\n            clientX: this.position.clientX,\r\n            clientY: this.position.clientY,\r\n        });\r\n    }\r\n\r\n    private endSequence (): void {\r\n        if (this.toEmitDelta !== null) {\r\n            this.emit(this.toEmitDelta);\r\n            this.toEmitDelta = null;\r\n        }\r\n        if (this.sequenceUnit !== null && !(this.knownUnitArr.includes(this.sequenceUnit))) {\r\n            this.knownUnitArr.push(this.sequenceUnit);\r\n        }\r\n        this.sequenceLength = 0;\r\n        this.sequenceUnit = null;\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (private callback: (p: IWheelCleanerEvent) => void) {}\r\n\r\n    process (event: WheelEvent): void {\r\n        this.position = {\r\n            pageX: event.pageX,\r\n            pageY: event.pageY,\r\n            clientX: event.clientX,\r\n            clientY: event.clientY,\r\n        };\r\n\r\n        if (this.endSequenceTimeout) {\r\n            clearTimeout(this.endSequenceTimeout);\r\n        }\r\n        this.endSequenceTimeout = setTimeout(() => this.endSequence(), SEQUENCE_TIMEOUT_MS);\r\n\r\n        //prep delta\r\n        let delta = event.deltaY;\r\n        if ('deltaMode' in event && event.deltaMode === 1) {\r\n            delta *= 100 / 3;\r\n        }\r\n        const absDelta = Math.abs(delta);\r\n\r\n        //sequence begins\r\n        if (this.sequenceLength === 0) {\r\n            this.sequenceLength++;\r\n            if (absDelta < 50) {\r\n                //dirty - probably a swipe scroll or pinch scroll on trackpad\r\n                return;\r\n            }\r\n\r\n            this.sequenceUnit = absDelta;\r\n            if (this.knownUnitArr.includes(this.sequenceUnit)) {\r\n                //we know this unit - emit right away\r\n                this.emit(delta);\r\n            } else {\r\n                //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\r\n                this.toEmitDelta = delta;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (this.sequenceUnit === null) {\r\n            //previously determined dirty sequence\r\n            this.toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n        //sequence continues\r\n        if (absDelta === 0) {\r\n            //ignore zero scroll\r\n            return;\r\n        }\r\n        if (\r\n            absDelta === this.sequenceUnit ||\r\n            (absDelta / this.sequenceUnit) % 1 < 0.0001// a multiple\r\n        ) {\r\n            //fine\r\n        } else if ((this.sequenceUnit / absDelta) % 1 < 0.0001) {\r\n            //unit was actually a multiple - update it\r\n            this.sequenceUnit = absDelta;\r\n\r\n        } else if (absDelta !== this.sequenceUnit) {\r\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\r\n            this.sequenceUnit = null;\r\n            this.toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n\r\n        if (this.toEmitDelta !== null) {\r\n            this.emit(this.toEmitDelta);\r\n            this.toEmitDelta = null;\r\n        }\r\n        this.emit(delta);\r\n    }\r\n\r\n}\r\n","import {mix} from '../math/math';\r\n\r\n/**\r\n * different devices/browsers have different pressure curves\r\n * pressure normalize attempts to achieve similar mapping\r\n *\r\n * pressure range [0, 1]\r\n */\r\nexport class PressureNormalizer {\r\n    \r\n    private count: number = 0;\r\n    private avgPressure: number = 0; // float [0, 1]\r\n    private normalizeIsComplete: boolean = false;\r\n    private normalizeFactor: number = 1;\r\n    \r\n    // ---- public ----\r\n    normalize (pressure: number): number {\r\n        if (pressure === 0 || pressure === 1) {\r\n            return pressure;\r\n        }\r\n\r\n        if (this.count < 60) {\r\n            if (this.count === 0 || this.count === null) {\r\n                this.avgPressure = pressure;\r\n            } else {\r\n                this.avgPressure = mix(pressure, this.avgPressure, 0.95);\r\n            }\r\n            this.count++;\r\n        } else if (!this.normalizeIsComplete) {\r\n            this.normalizeIsComplete = true;\r\n            //BB.throwOut('avg pressure decision!' + this.avgPressure);\r\n            if (this.avgPressure < 0.13) { // absurd pressure needed\r\n                this.normalizeFactor = 2.3;\r\n            }\r\n        }\r\n\r\n        return Math.pow(pressure, 1 / this.normalizeFactor);\r\n    }\r\n    \r\n}","import {IBounds, IRect, IVector2D} from '../bb-types';\r\n\r\nexport function mix (a: number, b: number, f: number): number {\r\n    return a * (1 - f) + b * f;\r\n}\r\n\r\nexport function dist (ax: number, ay: number, bx: number, by: number): number {\r\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\r\n}\r\n\r\nexport function distSquared (ax: number, ay: number, bx: number, by: number): number {\r\n    // faster because no square-root\r\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\r\n}\r\n\r\nexport function lenSquared (x: number, y: number): number {\r\n    // faster because no square-root\r\n    return x * x + y * y;\r\n}\r\n\r\nexport function pointsToAngleRad (p1: IVector2D, p2: IVector2D): number {\r\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n}\r\n\r\nexport function pointsToAngleDeg (p1: IVector2D, p2: IVector2D): number {\r\n    return pointsToAngleRad(p1, p2) * 180 / Math.PI;\r\n}\r\n\r\nexport function isInsideRect (p: IVector2D, rect: IRect): boolean {\r\n    return rect.x <= p.x && p.x <= rect.x + rect.width &&\r\n        rect.y <= p.y && p.y <= rect.y + rect.height;\r\n}\r\n\r\nexport function clamp (num: number, min: number, max: number): number {\r\n    return num < min\r\n        ? min\r\n        : num > max\r\n            ? max\r\n            : num;\r\n}\r\n\r\nexport function rotate (x: number, y: number, deg: number): IVector2D {\r\n    const theta = deg * (Math.PI / 180);\r\n    const cs = Math.cos(theta);\r\n    const sn = Math.sin(theta);\r\n\r\n    return {\r\n        x: x * cs - y * sn,\r\n        y: x * sn + y * cs,\r\n    };\r\n}\r\n\r\nexport function rotateAround (center: IVector2D, point: IVector2D, deg: number): IVector2D {\r\n    const rot = rotate(point.x - center.x, point.y - center.y, deg);\r\n    rot.x += center.x;\r\n    rot.y += center.y;\r\n    return rot;\r\n}\r\n\r\nexport function intDxy (remainder: IVector2D, fDx: number, fDy: number): {dX: number; dY: number} {\r\n    remainder.x += fDx;\r\n    remainder.y += fDy;\r\n    const dX = Math.round(remainder.x);\r\n    const dY = Math.round(remainder.y);\r\n    remainder.x -= dX;\r\n    remainder.y -= dY;\r\n    return {\r\n        dX,\r\n        dY,\r\n    };\r\n}\r\n\r\n/**\r\n * return closest even number\r\n * @param f\r\n */\r\nexport function roundEven (f: number): number {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f;\r\n        }\r\n        return f + 1;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 0) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * return closest uneven number\r\n * @param f\r\n */\r\nexport function roundUneven (f: number): number {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f + 1;\r\n        }\r\n        return f;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 1) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * round number to certain precision.\r\n * round(1.2345, 2) = 1.23\r\n * round(1.2345, 0) = 0\r\n * round(123, -1) = 120\r\n *\r\n * @param f\r\n * @param digits\r\n */\r\nexport function round (f: number, digits: number): number {\r\n    const digitMult = Math.pow(10, digits);\r\n    return Math.round((f/* + Number.EPSILON*/) * digitMult) / digitMult;\r\n}\r\n\r\n/**\r\n * update target so it includes bounds\r\n * @param target\r\n * @param bounds\r\n */\r\nexport function updateBounds (target: IBounds | undefined, bounds: IBounds | undefined): IBounds {\r\n    if (!bounds && !target) {\r\n        throw new Error('at least one param needs to be defined');\r\n    }\r\n    if (!bounds) {\r\n        return target!;\r\n    }\r\n    if (!target) {\r\n        target = { x1: bounds.x1, y1: bounds.y1, x2: bounds.x2, y2: bounds.y2 };\r\n    } else {\r\n        target.x1 = Math.min(target.x1, bounds.x1);\r\n        target.y1 = Math.min(target.y1, bounds.y1);\r\n        target.x2 = Math.max(target.x2, bounds.x2);\r\n        target.y2 = Math.max(target.y2, bounds.y2);\r\n    }\r\n    return target;\r\n}\r\n\r\n/**\r\n * determine overlap of bounds with width&height\r\n */\r\nexport function boundsInArea (bounds: IBounds | undefined, width: number, height: number): IBounds | undefined {\r\n    if (!bounds) {\r\n        return undefined;\r\n    }\r\n    const x1 = Math.max(0, bounds.x1);\r\n    const y1 = Math.max(0, bounds.y1);\r\n    const x2 = Math.min(width - 1, bounds.x2);\r\n    const y2 = Math.min(height - 1, bounds.y2);\r\n    if (x1 > x2 || y1 > y2) {\r\n        return undefined;\r\n    }\r\n    return { x1, y1, x2, y2 };\r\n}","import {IBounds, IKeyString, IRect} from '../bb-types';\r\nimport {createCanvas} from './create-canvas';\r\nimport {copyObj} from './base';\r\n\r\nexport function copyCanvas (canvas: HTMLCanvasElement): HTMLCanvasElement {\r\n    const resultCanvas = createCanvas(canvas.width, canvas.height);\r\n    const ctx = resultCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.drawImage(canvas, 0, 0);\r\n    return resultCanvas;\r\n}\r\n\r\nexport function ctx (canvas: HTMLCanvasElement): CanvasRenderingContext2D {\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error(\"couldn't get 2d context\");\r\n    }\r\n    return ctx;\r\n}\r\n\r\n/**\r\n * Determine if we should disable imageSmoothing for transformation.\r\n * ImageSmoothing can make images blurry even when they're in the original scale and aligned with the pixelgrid.\r\n */\r\nexport function testShouldPixelate (\r\n    transform: {x: number; y: number; width:number; height: number; angleDeg: number},\r\n    scaleX: number,\r\n    scaleY: number,\r\n): boolean {\r\n    if (\r\n        ![1, -1].includes(scaleX) || ![1, -1].includes(scaleY) ||\r\n        transform.width % 1 !== 0 || transform.height % 1 !== 0 ||\r\n        Math.abs(transform.angleDeg) % 90 !== 0\r\n    ) {\r\n        return false;\r\n    }\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    const width = whSwapped ? transform.height : transform.width;\r\n    const height = whSwapped ? transform.width : transform.height;\r\n    return (\r\n            (Math.abs(width) % 2 === 0 && transform.x % 1 === 0) ||\r\n            (Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5)\r\n        ) &&\r\n        (\r\n            (Math.abs(height) % 2 === 0 && transform.y % 1 === 0) ||\r\n            (Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5)\r\n        );\r\n}\r\n\r\n\r\n/**\r\n * @param destCtx - the canvas that will be drawn on\r\n * @param transformImage - image that will be drawn on canvas\r\n * @param transform - {x, y, width, height, angle} - x and y are center of transformImage\r\n * @param bounds object - optional {x, y, width, height} - crop of transformImage in transformImage image space\r\n * @param pixelated\r\n */\r\nexport function drawTransformedImageWithBounds (\r\n    destCtx: CanvasRenderingContext2D,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transform: {x: number; y: number; width:number; height: number; angleDeg: number},\r\n    bounds?: {x: number; y: number; width: number; height: number},\r\n    pixelated?: boolean,\r\n): void {\r\n    if (!bounds) {\r\n        bounds = {\r\n            x: 0,\r\n            y: 0,\r\n            width: transformImage.width,\r\n            height: transformImage.height,\r\n        };\r\n    }\r\n\r\n    destCtx.save();\r\n    if (pixelated) {\r\n        destCtx.imageSmoothingEnabled = false;\r\n    } else {\r\n        destCtx.imageSmoothingEnabled = true;\r\n        destCtx.imageSmoothingQuality = 'high';\r\n    }\r\n\r\n    destCtx.translate(transform.x, transform.y);\r\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\r\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\r\n    destCtx.drawImage(\r\n        transformImage,\r\n        bounds.x, bounds.y, bounds.width, bounds.height,\r\n        -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\r\n\r\n    destCtx.restore();\r\n}\r\n\r\n/**\r\n * all transformations are optional\r\n * center is the point around which will be scaled and rotated\r\n *\r\n * @param baseCanvas canvas - the canvas that will be drawn on\r\n * @param transformImage image|canvas - image that will be drawn on canvas\r\n * @param transformObj {center: {x, y}, scale: {x, y}, translate: {x, y}, angleDegree}\r\n */\r\nexport function drawTransformedImageOnCanvas (\r\n    baseCanvas: HTMLCanvasElement,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transformObj: {\r\n        center: {x: number; y: number};\r\n        scale: {x: number; y: number};\r\n        translate: {x: number; y: number};\r\n        angleDegree: number;\r\n    },\r\n): void {\r\n    transformObj = copyObj(transformObj);\r\n    if (!transformObj.center) {\r\n        transformObj.center = {\r\n            x: transformImage.width / 2,\r\n            y: transformImage.height / 2,\r\n        };\r\n    }\r\n    if (!transformObj.scale) {\r\n        transformObj.scale = {\r\n            x: 1,\r\n            y: 1,\r\n        };\r\n    }\r\n    if (!transformObj.angleDegree) {\r\n        transformObj.angleDegree = 0;\r\n    }\r\n    if (!transformObj.translate) {\r\n        transformObj.translate = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n    }\r\n\r\n    const ctx = baseCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.save();\r\n    if (\r\n        Math.abs(transformObj.scale.x - 1) >  0.000001 ||\r\n        Math.abs(transformObj.scale.y - 1) > 0.000001 ||\r\n        Math.abs(transformObj.angleDegree % 90) > 0.000001\r\n    ) {\r\n        ctx.imageSmoothingEnabled = true;\r\n        ctx.imageSmoothingQuality = 'high';\r\n    } else {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n\r\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\r\n    ctx.translate(transformObj.center.x, transformObj.center.y);\r\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\r\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\r\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\r\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\r\n\r\n    ctx.restore();\r\n}\r\n\r\nexport const createCheckerCanvas = function (size: number, isDark?: boolean): HTMLCanvasElement {\r\n    const canvas = createCanvas();\r\n    let ctx;\r\n    if (size < 1) {\r\n        canvas.width = 1;\r\n        canvas.height = 1;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = 'rgb(128, 128, 128)';\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    } else if (size > 200) {\r\n        canvas.width = 401;\r\n        canvas.height = 401;\r\n    } else {\r\n        canvas.width = size * 2;\r\n        canvas.height = size * 2;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = isDark ? 'rgb(90, 90, 90)' : 'rgb(255, 255, 255)';\r\n        ctx.fillRect(0, 0, size * 2, size * 2);\r\n        ctx.fillStyle = isDark ? 'rgb(63, 63, 63)': 'rgb(200, 200, 200)';\r\n        ctx.fillRect(0, 0, size, size);\r\n        ctx.fillRect(size, size, size * 2, size * 2);\r\n    }\r\n    return canvas;\r\n};\r\n\r\nexport const createCheckerDataUrl = (function () {\r\n    const cache: IKeyString = { // previously created dataUrls\r\n        '8l': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC',\r\n        '4l': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC',\r\n    };\r\n\r\n    return function (size: number, callback?: (s: string) => void, isDark?: boolean): string | void {\r\n        const modeStr = isDark ? 'd' : 'l';\r\n\r\n        function create (size: number): string {\r\n            size = parseInt('' + size);\r\n            if (cache['' + size + modeStr]) {\r\n                return cache['' + size + modeStr];\r\n            }\r\n            const canvas = createCheckerCanvas(size, isDark);\r\n            const result = canvas.toDataURL('image/png');\r\n            cache['' + size + modeStr] = result;\r\n            return result;\r\n        }\r\n\r\n        if (callback) { //async\r\n            setTimeout(function () {\r\n                callback(create(size));\r\n            }, 1);\r\n        } else { //sync\r\n            return create(size);\r\n        }\r\n    };\r\n})();\r\n\r\n/**\r\n * smooth resize image\r\n * @param canvas canvas - will be resized (modified)\r\n * @param w\r\n * @param h\r\n * @param tmp1 canvas - optional, provide to save resources\r\n * @param tmp2 canvas - optional, provide to save resources\r\n */\r\nexport function resizeCanvas (\r\n    canvas: HTMLCanvasElement,\r\n    w: number,\r\n    h: number,\r\n    tmp1?: HTMLCanvasElement,\r\n    tmp2?: HTMLCanvasElement,\r\n): void {\r\n\r\n    //determine base 2 exponents of old and new size\r\n    function getBase2Obj (oldW: number, oldH: number, newW: number, newH: number) {\r\n        const result = {\r\n            oldWidthEx: Math.round(Math.log2(oldW)),\r\n            oldHeightEx: Math.round(Math.log2(oldH)),\r\n            newWidthEx: Math.ceil(Math.log2(newW)),\r\n            newHeightEx: Math.ceil(Math.log2(newH)),\r\n        };\r\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\r\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\r\n        return result;\r\n    }\r\n\r\n    if (!w || !h || (w === canvas.width && h === canvas.height)) {\r\n        return;\r\n    }\r\n    w = Math.max(w, 1);\r\n    h = Math.max(h, 1);\r\n    if (w <= canvas.width && h <= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp2 = !tmp2 ? createCanvas() : tmp2;\r\n\r\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\r\n\r\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\r\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\r\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\r\n        tmp1.getContext('2d')!.save();\r\n        tmp2.getContext('2d')!.save();\r\n\r\n        let ew, eh;\r\n        let buffer1 = tmp1, buffer2 = tmp2;\r\n\r\n        ew = base2.oldWidthEx;\r\n        eh = base2.oldHeightEx;\r\n\r\n        let bufferCtx = buffer2.getContext('2d')!;\r\n        bufferCtx.imageSmoothingEnabled = true;\r\n        bufferCtx.imageSmoothingQuality  = 'high';\r\n        bufferCtx.globalCompositeOperation  = 'copy';\r\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\r\n\r\n        let currentWidth = buffer2.width;\r\n        let currentHeight = buffer2.height;\r\n\r\n        //stepwise half the size\r\n        for (; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--) {\r\n            bufferCtx = buffer1.getContext('2d')!;\r\n            bufferCtx.imageSmoothingEnabled = true;\r\n            bufferCtx.imageSmoothingQuality  = 'high';\r\n            bufferCtx.globalCompositeOperation  = 'copy';\r\n\r\n            const newWidth = (ew > base2.newWidthEx) ? currentWidth / 2 : currentWidth;\r\n            const newHeight = (eh > base2.newHeightEx) ? currentHeight / 2 : currentHeight;\r\n\r\n            //buffer also needs to be properly sized, unfortunately\r\n            buffer1.width = newWidth;\r\n            buffer1.height = newHeight;\r\n\r\n            bufferCtx.drawImage(\r\n                buffer2,\r\n                0, 0,\r\n                currentWidth, currentHeight,\r\n                0, 0,\r\n                newWidth, newHeight\r\n            );\r\n            currentWidth = newWidth;\r\n            currentHeight = newHeight;\r\n\r\n            //swap\r\n            const tmp = buffer1;\r\n            buffer1 = buffer2;\r\n            buffer2 = tmp;\r\n        }\r\n\r\n        //when no longer can be halved, bring to target size\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        const canvasCtx = canvas.getContext('2d')!;\r\n        canvasCtx.save();\r\n        canvasCtx.imageSmoothingEnabled = true;\r\n        canvasCtx.imageSmoothingQuality  = 'high';\r\n        canvasCtx.drawImage(\r\n            buffer2,\r\n            0, 0,\r\n            currentWidth, currentHeight,\r\n            0, 0,\r\n            w, h\r\n        );\r\n        canvasCtx.restore();\r\n        tmp1.getContext('2d')!.restore();\r\n        tmp2.getContext('2d')!.restore();\r\n\r\n    } else if (w >= canvas.width && h >= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp1.width = w;\r\n        tmp1.height = h;\r\n        const tmp1Ctx = tmp1.getContext('2d')!;\r\n        tmp1Ctx.save();\r\n        tmp1Ctx.imageSmoothingEnabled = true;\r\n        tmp1Ctx.imageSmoothingQuality  = 'high';\r\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\r\n        tmp1Ctx.restore();\r\n\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        canvas.getContext('2d')!.drawImage(tmp1, 0, 0);\r\n\r\n    } else {\r\n        resizeCanvas(canvas, w, canvas.height, tmp1, tmp2);\r\n        resizeCanvas(canvas, w, h, tmp1, tmp2);\r\n    }\r\n}\r\n\r\n/**\r\n * puts naive greyscale version of image into alpha channel.\r\n * only writes a, doesn't write rgb\r\n * @param canvas\r\n */\r\nexport function convertToAlphaChannelCanvas (canvas: HTMLCanvasElement): void {\r\n    const imdat = canvas.getContext('2d')!.getImageData(0, 0, canvas.width, canvas.height);\r\n    for (let i = 0; i < imdat.data.length; i += 4) {\r\n        if (imdat.data[i + 3] === 0) {\r\n            continue;\r\n        }\r\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\r\n    }\r\n    canvas.getContext('2d')!.putImageData(imdat, 0, 0);\r\n}\r\n\r\n/**\r\n * Sometimes garbage collection is too slow, and canvases use up too much memory,\r\n * or there is a hard to fix memory leak.\r\n * This function manually makes the canvas use as little memory as possible.\r\n */\r\nexport function freeCanvas (canvas: HTMLCanvasElement): void {\r\n    canvas.width = 1;\r\n    canvas.height = 1;\r\n    const ctx = canvas.getContext('2d');\r\n    ctx && ctx.clearRect(0, 0, 1, 1);\r\n}\r\n\r\n/**\r\n * Determine bounding box that describes all pixels which are not fully transparent.\r\n * Returns null if empty.\r\n *\r\n * @param context\r\n */\r\nexport function canvasBounds (context: CanvasRenderingContext2D): IRect | undefined {\r\n    const boundsObj: {\r\n        x: number;\r\n        y: number;\r\n        width: number;\r\n        height: number;\r\n    } = { x: 0, y: 0, width: 0, height: 0 };\r\n    {\r\n        const tempBounds: Partial<IBounds> = {\r\n            x1: undefined,\r\n            y1: undefined,\r\n            x2: undefined,\r\n            y2: undefined,\r\n        };\r\n        const imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\r\n\r\n        if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\r\n            tempBounds.x1 = 0;\r\n            tempBounds.y1 = 0;\r\n            tempBounds.x2 = context.canvas.width - 1;\r\n            tempBounds.y2 = context.canvas.height - 1;\r\n        } else {\r\n            for (let i = 3; i < imdat.data.length; i += 4) {\r\n                if (imdat.data[i] > 0 ) {\r\n                    const x = ((i - 3) / 4) %  context.canvas.width;\r\n                    const y = Math.floor((i - 3) / 4 / context.canvas.width);\r\n                    if (tempBounds.x1 === undefined || tempBounds.x1 > x) {\r\n                        tempBounds.x1 = x;\r\n                    }\r\n                    if (tempBounds.y1 === undefined) {\r\n                        tempBounds.y1 = y;\r\n                    }\r\n                    if (tempBounds.x2 === undefined || tempBounds.x2 < x) {\r\n                        tempBounds.x2 = x;\r\n                    }\r\n                    if (tempBounds.y2 === undefined || tempBounds.y2 < y) {\r\n                        tempBounds.y2 = y;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (tempBounds.x1 === undefined || tempBounds.y1 === undefined || tempBounds.x2 === undefined || tempBounds.y2 === undefined) {\r\n            return undefined;\r\n        }\r\n        boundsObj.x = tempBounds.x1;\r\n        boundsObj.y = tempBounds.y1;\r\n        boundsObj.width = tempBounds.x2! - tempBounds.x1 + 1;\r\n        boundsObj.height = tempBounds.y2! - tempBounds.y1 + 1;\r\n    }\r\n    return boundsObj;\r\n}","/*window['canvases'] = [];\r\n\r\nwindow['printCanvases'] = () => {\r\n    let total = 0;\r\n\r\n    console.log(window['canvases'].map(item => {\r\n        total += item.width * item.height;\r\n        return {w: item.width, h: item.height};\r\n    }));\r\n\r\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\r\n};*/\r\n\r\nexport function createCanvas (w?: number, h?: number): HTMLCanvasElement {\r\n    const result = document.createElement('canvas');\r\n    if (w && h) {\r\n        result.width = w;\r\n        result.height = h;\r\n    }\r\n    // window['canvases'].push(result);\r\n    return result;\r\n}","\r\n// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\r\n// not optimized\r\n\r\ntype TMatrix4x4 = [\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n];\r\n\r\nexport type TVec4 = [number, number, number, number];\r\n\r\nfunction getIdentity (): TMatrix4x4 {\r\n    return [\r\n        1, 0, 0, 0,\r\n        0, 1, 0, 0,\r\n        0, 0, 1, 0,\r\n        0, 0, 0, 1,\r\n    ];\r\n}\r\n\r\n// point  matrix\r\nfunction multiplyMatrixAndPoint (matrix: TMatrix4x4, point: TVec4): TVec4 {\r\n    return [\r\n        (point[0] * matrix[0]) + (point[1] * matrix[4]) + (point[2] * matrix[8]) + (point[3] * matrix[12]), // x\r\n        (point[0] * matrix[1]) + (point[1] * matrix[5]) + (point[2] * matrix[9]) + (point[3] * matrix[13]), // y\r\n        (point[0] * matrix[2]) + (point[1] * matrix[6]) + (point[2] * matrix[10]) + (point[3] * matrix[14]), // z\r\n        (point[0] * matrix[3]) + (point[1] * matrix[7]) + (point[2] * matrix[11]) + (point[3] * matrix[15]), // w\r\n    ];\r\n}\r\n\r\n//matrixB  matrixA\r\nfunction multiplyMatrices (matrixA: TMatrix4x4, matrixB: TMatrix4x4): TMatrix4x4 {\r\n\r\n    // Slice the second matrix up into rows\r\n    const row0: TVec4 = [matrixB[0], matrixB[1], matrixB[2], matrixB[3]];\r\n    const row1: TVec4 = [matrixB[4], matrixB[5], matrixB[6], matrixB[7]];\r\n    const row2: TVec4 = [matrixB[8], matrixB[9], matrixB[10], matrixB[11]];\r\n    const row3: TVec4 = [matrixB[12], matrixB[13], matrixB[14], matrixB[15]];\r\n\r\n    // Multiply each row by matrixA\r\n    const result0 = multiplyMatrixAndPoint(matrixA, row0);\r\n    const result1 = multiplyMatrixAndPoint(matrixA, row1);\r\n    const result2 = multiplyMatrixAndPoint(matrixA, row2);\r\n    const result3 = multiplyMatrixAndPoint(matrixA, row3);\r\n\r\n    // Turn the result rows back into a single matrix\r\n    return [\r\n        result0[0], result0[1], result0[2], result0[3],\r\n        result1[0], result1[1], result1[2], result1[3],\r\n        result2[0], result2[1], result2[2], result2[3],\r\n        result3[0], result3[1], result3[2], result3[3],\r\n    ];\r\n}\r\n\r\nfunction createTranslationMatrix (x: number, y: number): TMatrix4x4 {\r\n    return [\r\n        1, 0, 0, 0,\r\n        0, 1, 0, 0,\r\n        0, 0, 1, 0,\r\n        x, y, 0, 1,\r\n    ];\r\n}\r\n\r\nfunction createRotationMatrix (angleRad: number): TMatrix4x4 {\r\n    //let angleRad = angleDeg / 360 * 2 * Math.PI;\r\n    return [\r\n        Math.cos(-angleRad), -Math.sin(-angleRad), 0, 0,\r\n        Math.sin(-angleRad), Math.cos(-angleRad), 0, 0,\r\n        0, 0, 1, 0,\r\n        0, 0, 0, 1,\r\n    ];\r\n}\r\n\r\nfunction createScaleMatrix (f: number): TMatrix4x4 {\r\n    return [\r\n        f, 0, 0, 0,\r\n        0, f, 0, 0,\r\n        0, 0, 1, 0,\r\n        0, 0, 0, 1,\r\n    ];\r\n}\r\n\r\nexport const Matrix = Object.freeze({\r\n    getIdentity,\r\n    multiplyMatrixAndPoint,\r\n    multiplyMatrices,\r\n    createTranslationMatrix,\r\n    createRotationMatrix,\r\n    createScaleMatrix,\r\n});\r\n","import {IVector2D} from '../bb-types';\r\n\r\nexport const Vec2 = {\r\n    add: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x + p2.x, y: p1.y + p2.y};\r\n    },\r\n    sub: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x - p2.x, y: p1.y - p2.y};\r\n    },\r\n    nor: function (p: IVector2D): IVector2D {\r\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n        return {x: p.x / len, y: p.y / len};\r\n    },\r\n    len: function (p: IVector2D): number {\r\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n    },\r\n    dist: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Vec2.len(Vec2.sub(p1, p2));\r\n    },\r\n    mul: function (p: IVector2D, s: number): IVector2D {\r\n        return {x: p.x * s, y: p.y * s};\r\n    },\r\n    angle: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n    },\r\n    dot: function (a: IVector2D, b: IVector2D): number {\r\n        const aArr = [a.x, a.y];\r\n        const bArr = [b.x, b.y];\r\n        return aArr.map((x, i) => aArr[i] * bArr[i]).reduce((m, n) => m + n);\r\n    },\r\n};","import {Vec2} from './vec2';\r\nimport {clamp, dist, mix, pointsToAngleDeg} from './math';\r\nimport {IVector2D} from '../bb-types';\r\nimport {copyObj} from '../base/base';\r\n\r\n/**\r\n * project p onto line\r\n * @param lineStart\r\n * @param lineEnd\r\n * @param p\r\n */\r\nexport const projectPointOnLine = function (lineStart: IVector2D, lineEnd: IVector2D, p: IVector2D): IVector2D {\r\n    let x, y;\r\n    if (lineStart.x === lineEnd.x) {\r\n        x = lineStart.x;\r\n        y = p.y;\r\n\r\n        return {\r\n            x: x,\r\n            y: y,\r\n        };\r\n    }\r\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\r\n    const b = lineStart.y - (m * lineStart.x);\r\n\r\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\r\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\r\n\r\n    return {\r\n        x: x,\r\n        y: y,\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * Operations on a line made up of points\r\n */\r\nexport class PointLine {\r\n\r\n    private readonly segmentArr: {\r\n        x: number;\r\n        y: number;\r\n        length: number; // last is 0\r\n    }[];\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            points: IVector2D[];\r\n        }\r\n    ) {\r\n        this.segmentArr = [];\r\n\r\n        for (let i = 0; i < p.points.length; i++) {\r\n            ((i) => {\r\n                let length = 0;\r\n                if (i < p.points.length - 1) {\r\n                    length = dist(p.points[i].x, p.points[i].y, p.points[i + 1].x, p.points[i + 1].y);\r\n                }\r\n                this.segmentArr[i] = {\r\n                    x: p.points[i].x,\r\n                    y: p.points[i].y,\r\n                    length: length,\r\n                };\r\n            })(i);\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    /**\r\n     * returns point when traveling *dist* along the line, > 0\r\n     * @param dist\r\n     */\r\n    getAtDist (dist: number): IVector2D {\r\n        let remainder = Math.min(this.getLength(), dist);\r\n        let i = 0;\r\n\r\n        for (; remainder > this.segmentArr[i].length && i < this.segmentArr.length - 2; i++) {\r\n            remainder -= this.segmentArr[i].length;\r\n        }\r\n\r\n        const fac = Math.min(1, Math.max(0, remainder / this.segmentArr[i].length));\r\n\r\n        return {\r\n            x: (this.segmentArr[i].x * (1 - fac) + this.segmentArr[i + 1].x * fac),\r\n            y: (this.segmentArr[i].y * (1 - fac) + this.segmentArr[i + 1].y * fac),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * total length of line\r\n     */\r\n    getLength (): number {\r\n        let result = 0;\r\n        for (let i = 0; i < this.segmentArr.length - 1; i++) {\r\n            result += this.segmentArr[i].length;\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\nexport type TBezierLineCallback = (\r\n    v: {\r\n        x: number;\r\n        y: number;\r\n        t: number; // [0, 1] - how far along\r\n        angle?: number;\r\n        dAngle: number;\r\n    }\r\n) => void;\r\ntype TBezierLineControlsCallback = (\r\n    v: {\r\n        p1: IVector2D;\r\n        p2: IVector2D;\r\n        p3: IVector2D;\r\n        p4: IVector2D;\r\n    }\r\n) => void;\r\n\r\ntype TBezierLinePoint = {\r\n    x: number;\r\n    y: number;\r\n    spacing: number;\r\n    dir: IVector2D;\r\n};\r\n\r\n/**\r\n * Each instance is one line made up of bezier interpolated segments.\r\n * You feed it points. It calculates control points on its own, and the resulting curve.\r\n */\r\nexport class BezierLine {\r\n\r\n    private readonly pointArr: TBezierLinePoint[];\r\n    private lastDot: number = 0;\r\n    private lastPoint: IVector2D | undefined;\r\n    private lastCallbackPoint: IVector2D | undefined;\r\n    private lastAngle: number | undefined;\r\n    private lastSpacing: number | undefined;\r\n\r\n    /**\r\n     * creates bezier curve from control points\r\n     * @param p1 - control point 1 {x: float, y: float}\r\n     * @param p2 - control point 2 {x: float, y: float}\r\n     * @param p3 - control point 3 {x: float, y: float}\r\n     * @param p4 - control point 4 {x: float, y: float}\r\n     * @param resolution - int\r\n     * @returns bezier curve made up of points {x: float, y: float}\r\n     */\r\n    private getBezierPoints (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D, resolution: number): IVector2D[] {\r\n        const curvePoints = [];\r\n        let t;\r\n        for (let i = 0; i <= resolution; i++) {\r\n            t = i / resolution;\r\n            curvePoints[curvePoints.length] = {\r\n                x: Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x,\r\n                y: Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y,\r\n            };\r\n        }\r\n        return curvePoints;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor () {\r\n        this.pointArr = [];\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    /**\r\n     * Add new point to line. \"Drawn\" line will go until the previous point.\r\n     *\r\n     * @param x - coord of new point\r\n     * @param y\r\n     * @param spacing - space between each step\r\n     * @param callback - calls for each step\r\n     * @param controlsCallback - calls that callback with the bezier control points\r\n     */\r\n    add (\r\n        x: number,\r\n        y: number,\r\n        spacing: number,\r\n        callback?: TBezierLineCallback,\r\n        controlsCallback?: TBezierLineControlsCallback,\r\n    ): void {\r\n        if (this.lastPoint && x === this.lastPoint.x && y === this.lastPoint.y) {\r\n            return;\r\n        }\r\n        this.lastPoint = {x, y};\r\n        this.pointArr[this.pointArr.length] = {\r\n            x,\r\n            y,\r\n            spacing,\r\n        } as TBezierLinePoint;\r\n\r\n        //calculate directions\r\n        if (this.pointArr.length === 1) {\r\n            this.lastSpacing = spacing;\r\n            return;\r\n        } else if (this.pointArr.length === 2) {\r\n            this.pointArr[0].dir = Vec2.nor(Vec2.sub(this.pointArr[1], this.pointArr[0]));\r\n            this.lastDot = spacing;\r\n            this.lastSpacing = spacing;\r\n            return;\r\n        } else {\r\n            const pointM1 = this.pointArr[this.pointArr.length - 1];\r\n            const pointM2 = this.pointArr[this.pointArr.length - 2];\r\n            const pointM3 = this.pointArr[this.pointArr.length - 3];\r\n            pointM2.dir = Vec2.nor(Vec2.sub(pointM1, pointM3));\r\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) {\r\n                //when xy -3 == -1\r\n                pointM2.dir = copyObj(pointM3.dir);\r\n            }\r\n        }\r\n\r\n        //get bezier curve\r\n        const a = this.pointArr[this.pointArr.length - 3];\r\n        const b = this.pointArr[this.pointArr.length - 2];\r\n        const p1 = a;\r\n        const p2 = Vec2.add(a, Vec2.mul(a.dir, Vec2.dist(a, b) / 4));\r\n        const p3 = Vec2.sub(b, Vec2.mul(b.dir, Vec2.dist(a, b) / 4));\r\n        const p4 = b;\r\n\r\n\r\n        let pointLine: PointLine;\r\n        if (callback) {\r\n            const curvePoints = this.getBezierPoints(p1, p2, p3, p4, 20);\r\n            pointLine = new PointLine({points: curvePoints});\r\n        } else {\r\n            pointLine = new PointLine({points: [p1, p4]});\r\n        }\r\n\r\n        //iterate over curve with spacing and callback\r\n        const len = pointLine.getLength();\r\n        let tempSpacing = mix(this.lastSpacing!, spacing, clamp(this.lastDot / len, 0, 1));\r\n        let d = this.lastDot;\r\n        for (; d <= len; d += tempSpacing) {\r\n            tempSpacing = mix(this.lastSpacing!, spacing, clamp(d / len, 0, 1));\r\n            const point = pointLine.getAtDist(d);\r\n            const angle = this.lastCallbackPoint ? pointsToAngleDeg(this.lastCallbackPoint, point) : undefined;\r\n            if (callback) {\r\n                callback({\r\n                    x: point.x,\r\n                    y: point.y,\r\n                    t: d / len,\r\n                    angle: angle,\r\n                    dAngle: this.lastCallbackPoint ? angle! - this.lastAngle! : 0,\r\n                });\r\n            }\r\n            this.lastCallbackPoint = point;\r\n            this.lastAngle = angle;\r\n        }\r\n\r\n        if (callback) {\r\n            this.lastDot = d - len;\r\n        } else {\r\n            this.lastDot = 0;\r\n            controlsCallback && controlsCallback({p1: p1, p2: p2, p3: p3, p4: p4});\r\n        }\r\n\r\n        this.lastSpacing = spacing;\r\n    }\r\n\r\n    addFinal (\r\n        spacing: number,\r\n        callback?: TBezierLineCallback,\r\n        controlsCallback?: TBezierLineControlsCallback,\r\n    ): void {\r\n        if (this.pointArr.length < 2) {\r\n            return;\r\n        }\r\n\r\n        const p1 = this.pointArr[this.pointArr.length - 2];\r\n        const p2 = this.pointArr[this.pointArr.length - 1];\r\n\r\n        const newP = Vec2.add(p2, Vec2.sub(p2, p1));\r\n\r\n        this.add(newP.x, newP.y, spacing, callback, controlsCallback);\r\n    }\r\n}\r\n\r\n/**\r\n * from SplineInterpolator.cs in the Paint.NET source code\r\n */\r\nexport class SplineInterpolator {\r\n\r\n    private readonly xa: number[];\r\n    private readonly ya: number[];\r\n    private readonly u: number[];\r\n    private readonly y2: number[];\r\n    private readonly first: number;\r\n    private readonly last: number;\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        points: [number, number][],\r\n    ) {\r\n        const n = points.length;\r\n        this.xa = [];\r\n        this.ya = [];\r\n        this.u = [];\r\n        this.y2 = [];\r\n        let i;\r\n\r\n        this.first = points[0][0];\r\n        this.last = points[points.length - 1][0];\r\n\r\n        points.sort(function (a, b) {\r\n            return a[0] - b[0];\r\n        });\r\n        for (i = 0; i < n; i++) {\r\n            this.xa.push(points[i][0]);\r\n            this.ya.push(points[i][1]);\r\n        }\r\n\r\n        this.u[0] = 0;\r\n        this.y2[0] = 0;\r\n\r\n        for (i = 1; i < n - 1; ++i) {\r\n            // This is the decomposition loop of the tridiagonal algorithm.\r\n            // y2 and u are used for temporary storage of the decomposed factors.\r\n            const wx = this.xa[i + 1] - this.xa[i - 1];\r\n            const sig = (this.xa[i] - this.xa[i - 1]) / wx;\r\n            const p = sig * this.y2[i - 1] + 2.0;\r\n\r\n            this.y2[i] = (sig - 1.0) / p;\r\n\r\n            const ddydx =\r\n                (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\r\n                (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\r\n\r\n            this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\r\n        }\r\n\r\n        this.y2[n - 1] = 0;\r\n\r\n        // This is the backsubstitution loop of the tridiagonal algorithm\r\n        for (i = n - 2; i >= 0; --i) {\r\n            this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getFirstX (): number {\r\n        return this.first;\r\n    }\r\n\r\n    getLastX (): number {\r\n        return this.last;\r\n    }\r\n\r\n    interpolate (x: number): number {\r\n        const n = this.ya.length;\r\n        let klo = 0;\r\n        let khi = n - 1;\r\n\r\n        // We will find the right place in the table by means of\r\n        // bisection. This is optimal if sequential calls to this\r\n        // routine are at random values of x. If sequential calls\r\n        // are in order, and closely spaced, one would do better\r\n        // to store previous values of klo and khi.\r\n        while (khi - klo > 1) {\r\n            const k = (khi + klo) >> 1;\r\n\r\n            if (this.xa[k] > x) {\r\n                khi = k;\r\n            } else {\r\n                klo = k;\r\n            }\r\n        }\r\n\r\n        const h = this.xa[khi] - this.xa[klo];\r\n        const a = (this.xa[khi] - x) / h;\r\n        const b = (x - this.xa[klo]) / h;\r\n\r\n        // Cubic spline polynomial is now evaluated.\r\n        return a * this.ya[klo] + b * this.ya[khi] +\r\n            ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\r\n    }\r\n\r\n    /**\r\n     * find x to y. simply by stepping through. suboptimal, so don't call often.\r\n     * searches in x 0-1 range\r\n     */\r\n    findX (y: number, resolution: number): number | undefined {\r\n        let x;\r\n        let dist: number;\r\n        for (let i = 0; i <= resolution; i++) {\r\n            const tempX = i / resolution;\r\n            const tempY = this.interpolate(tempX);\r\n            if (x === undefined) {\r\n                x = tempX;\r\n                dist = Math.abs(tempY - y);\r\n                continue;\r\n            }\r\n\r\n            const tempDist = Math.abs(tempY - y);\r\n\r\n            if (tempDist < dist!) {\r\n                x = tempX;\r\n                dist = tempDist;\r\n            } else {\r\n                //distance increasing\r\n                break;\r\n            }\r\n        }\r\n        return x;\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * input for a spline, following curve of quadratic function x^2 [0 - 1]\r\n * returns [[0, startVal], ..., [1, endVal]]\r\n * @param startVal\r\n * @param endVal\r\n * @param stepSize\r\n */\r\nexport function quadraticSplineInput (\r\n    startVal: number,\r\n    endVal: number,\r\n    stepSize: number,\r\n): [number, number][] {\r\n    function round (v: number, dec: number): number {\r\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\r\n    }\r\n\r\n    const resultArr: [number, number][] = [];\r\n    for (let i = 0; i <= 1; i += stepSize) {\r\n        resultArr.push([round(i, 4), round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)]);\r\n    }\r\n    return resultArr;\r\n}","\r\n\r\n\r\n// based on js color conversion http://www.webtoolkit.info/\r\n\r\n\r\nexport class HSV {\r\n    h: number;\r\n    s: number;\r\n    v: number;\r\n    constructor (h: number, s: number, v: number) {\r\n        this.h = Math.max(0, Math.min(360, h));\r\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\r\n        this.v = Math.max(0, Math.min(100, v));\r\n    }\r\n}\r\n\r\nexport class RGB {\r\n    r : number;\r\n    g: number;\r\n    b: number;\r\n    constructor (r: number, g: number, b: number) {\r\n        this.r = Math.max(0, Math.min(255, r));\r\n        this.g = Math.max(0, Math.min(255, g));\r\n        this.b = Math.max(0, Math.min(255, b));\r\n    }\r\n}\r\n\r\nexport class CMYK {\r\n    c: number;\r\n    m: number;\r\n    y: number;\r\n    k: number;\r\n    constructor (c: number, m: number, y: number, k: number) {\r\n        this.c = Math.max(0, Math.min(100, c));\r\n        this.m = Math.max(0, Math.min(100, m));\r\n        this.y = Math.max(0, Math.min(100, y));\r\n        this.k = Math.max(0, Math.min(100, k));\r\n    }\r\n}\r\n\r\nexport const ColorConverter = {\r\n\r\n    _RGBtoHSV: function (RGB: RGB): HSV {\r\n        const result = new HSV(0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        const minVal = Math.min(r, g, b);\r\n        const maxVal = Math.max(r, g, b);\r\n        const delta = maxVal - minVal;\r\n\r\n        result.v = maxVal;\r\n\r\n        if (delta == 0) {\r\n            result.h = 0;\r\n            result.s = 0;\r\n        } else {\r\n            result.s = delta / maxVal;\r\n            const del_R = (((maxVal - r) / 6) + (delta / 2)) / delta;\r\n            const del_G = (((maxVal - g) / 6) + (delta / 2)) / delta;\r\n            const del_B = (((maxVal - b) / 6) + (delta / 2)) / delta;\r\n\r\n            if (r == maxVal) {\r\n                result.h = del_B - del_G;\r\n            } else if (g == maxVal) {\r\n                result.h = (1 / 3) + del_R - del_B;\r\n            } else if (b == maxVal) {\r\n                result.h = (2 / 3) + del_G - del_R;\r\n            }\r\n\r\n            if (result.h < 0) {\r\n                result.h += 1;\r\n            }\r\n            if (result.h > 1) {\r\n                result.h -= 1;\r\n            }\r\n        }\r\n\r\n        result.h = Math.round(result.h * 360);\r\n        result.s = Math.round(result.s * 100);\r\n        result.v = Math.round(result.v * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    _HSVtoRGB: function (HSV: HSV): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\r\n\r\n        const h = (HSV.h / 360) % 1;\r\n        const s = HSV.s / 100;\r\n        const v = HSV.v / 100;\r\n\r\n        if (s == 0) {\r\n            result.r = v * 255;\r\n            result.g = v * 255;\r\n            result.b = v * 255;\r\n        } else {\r\n            var_h = h * 6;\r\n            var_i = Math.floor(var_h);\r\n            var_1 = v * (1 - s);\r\n            var_2 = v * (1 - s * (var_h - var_i));\r\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\r\n\r\n            if (var_i == 0) {\r\n                var_r = v;\r\n                var_g = var_3;\r\n                var_b = var_1;\r\n            } else if (var_i == 1) {\r\n                var_r = var_2;\r\n                var_g = v;\r\n                var_b = var_1;\r\n            } else if (var_i == 2) {\r\n                var_r = var_1;\r\n                var_g = v;\r\n                var_b = var_3;\r\n            } else if (var_i == 3) {\r\n                var_r = var_1;\r\n                var_g = var_2;\r\n                var_b = v;\r\n            } else if (var_i == 4) {\r\n                var_r = var_3;\r\n                var_g = var_1;\r\n                var_b = v;\r\n            } else {\r\n                var_r = v;\r\n                var_g = var_1;\r\n                var_b = var_2;\r\n            }\r\n\r\n            result.r = var_r * 255;\r\n            result.g = var_g * 255;\r\n            result.b = var_b * 255;\r\n\r\n            result.r = Math.round(result.r);\r\n            result.g = Math.round(result.g);\r\n            result.b = Math.round(result.b);\r\n        }\r\n\r\n        return result;\r\n    },\r\n\r\n    _CMYKtoRGB: function (CMYK: CMYK): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        const c = CMYK.c / 100;\r\n        const m = CMYK.m / 100;\r\n        const y = CMYK.y / 100;\r\n        const k = CMYK.k / 100;\r\n\r\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\r\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\r\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\r\n\r\n        result.r = Math.round(result.r * 255);\r\n        result.g = Math.round(result.g * 255);\r\n        result.b = Math.round(result.b * 255);\r\n\r\n        return result;\r\n    },\r\n\r\n    _RGBtoCMYK: function (RGB: RGB): CMYK {\r\n        const result = new CMYK(0, 0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\r\n        result.c = (1 - r - result.k) / (1 - result.k);\r\n        result.m = (1 - g - result.k) / (1 - result.k);\r\n        result.y = (1 - b - result.k) / (1 - result.k);\r\n\r\n        result.c = Math.round(result.c * 100);\r\n        result.m = Math.round(result.m * 100);\r\n        result.y = Math.round(result.y * 100);\r\n        result.k = Math.round(result.k * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    toRGB: function (o: RGB | HSV | CMYK): RGB {\r\n        if (o instanceof RGB) {\r\n            return o;\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._HSVtoRGB(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._CMYKtoRGB(o);\r\n        }\r\n        throw new Error('unknown type');\r\n    },\r\n\r\n    toHSV: function (o: RGB | HSV | CMYK): HSV {\r\n        if (o instanceof HSV) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoHSV(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._RGBtoHSV(this._CMYKtoRGB(o));\r\n        }\r\n        throw new Error('unknown type');\r\n    },\r\n\r\n    toCMYK: function (o: RGB | HSV | CMYK): CMYK {\r\n        if (o instanceof CMYK) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoCMYK(o);\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._RGBtoCMYK(this._HSVtoRGB(o));\r\n        }\r\n        throw new Error('unknown type');\r\n    },\r\n    toHexString: function (o: RGB): string {\r\n        if (o instanceof RGB || ('r' in o && 'g' in o && 'b' in o)) {\r\n            let ha = (parseInt('' + o.r)).toString(16);\r\n            let hb = (parseInt('' + o.g)).toString(16);\r\n            let hc = (parseInt('' + o.b)).toString(16);\r\n            if (ha.length == 1) {\r\n                ha = '0' + ha;\r\n            }\r\n            if (hb.length == 1) {\r\n                hb = '0' + hb;\r\n            }\r\n            if (hc.length == 1) {\r\n                hc = '0' + hc;\r\n            }\r\n            return ha + hb + hc;\r\n        }\r\n        return '#000';\r\n    },\r\n    toRgbStr: function (rgbObj: {r: number; g: number; b: number}): string {\r\n        return 'rgb(' + Math.round(rgbObj.r) + ', ' + Math.round(rgbObj.g) + ', ' + Math.round(rgbObj.b) + ')';\r\n    },\r\n    toRgbaStr: function (rgbaObj: {r: number; g: number; b: number; a: number}): string {\r\n        return 'rgba(' + Math.round(rgbaObj.r) + ', ' + Math.round(rgbaObj.g) + ', ' + Math.round(rgbaObj.b) + ', ' + rgbaObj.a + ')';\r\n    },\r\n    hexToRGB: function (hexStr: string): RGB | undefined {\r\n        hexStr = hexStr.trim();\r\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\r\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n        hexStr = hexStr.replace(shorthandRegex, function (m, r, g, b) {\r\n            return r + r + g + g + b + b;\r\n        });\r\n\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\r\n        return result ? new RGB(\r\n            parseInt(result[1], 16),\r\n            parseInt(result[2], 16),\r\n            parseInt(result[3], 16)\r\n        ) : undefined;\r\n    },\r\n\r\n};\r\n\r\nexport function testIsWhiteBestContrast (rgbObj: {r: number; g: number; b: number}): boolean {\r\n    return (rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114) < 125;\r\n}","import {css} from './base';\r\nimport {BB} from '../bb';\r\nimport {IKeyStringOptional} from '../bb-types';\r\n\r\n\r\nexport function appendTextDiv (target: HTMLElement, text: string): HTMLDivElement {\r\n    const div = document.createElement('div');\r\n    div.innerHTML = text;\r\n    target.append(div);\r\n    return div;\r\n}\r\n\r\n/**\r\n * Is an input element focused.\r\n * Set attribute \"data-ignore-focus\" to \"true\" if its focus should be ignored.\r\n *\r\n * @param getAll - check all, even those with \"data-ignore-focus\" = \"true\"\r\n */\r\nexport function isInputFocused (getAll: boolean = false): boolean {\r\n    const result: boolean = !!document.activeElement && ['INPUT', 'TEXTAREA', 'SELECT'].includes(document.activeElement.tagName);\r\n    if (getAll) {\r\n        return result;\r\n    } else {\r\n        return result && !document.activeElement?.getAttribute('data-ignore-focus');\r\n    }\r\n}\r\n\r\nexport function unfocusAnyInput (): void {\r\n    if (isInputFocused(true)) {\r\n        /*\r\n            Unfocus anything that is focused.\r\n\r\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\r\n            that isn't its direct parent, then Firefox will keep anything attached to this\r\n            Input in memory. It will not be garbage collected until a new Input is focused.\r\n\r\n            Workaround: Temporarily create an input, focus it, detach it.\r\n             */\r\n        const focusEl = BB.el({\r\n            parent: document.body,\r\n            tagName: 'input',\r\n            css: {\r\n                opacity: '0',\r\n                width: '0',\r\n                height: '0',\r\n            },\r\n        });\r\n        setTimeout(() => {\r\n            focusEl.select();\r\n            focusEl.focus();\r\n            focusEl.remove();\r\n        }, 10);\r\n    }\r\n}\r\n\r\n/**\r\n * clears text selection in window\r\n */\r\nexport function clearSelection (): void {\r\n    if (window.getSelection) {\r\n        const sel = window.getSelection();\r\n        if (sel) {\r\n            if (sel.empty) {\r\n                sel.empty();\r\n            } else if (sel.removeAllRanges) {\r\n                sel.removeAllRanges();\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * prevents being able to focus element.\r\n * warning: it creates a listener\r\n *\r\n * @param el - dom element\r\n */\r\nexport const makeUnfocusable = (function (): ((el: HTMLElement) => void) {\r\n\r\n    function preventFocus (event: FocusEvent): void {\r\n        event.preventDefault();\r\n        let didFocusRelated = false;\r\n        if (event.relatedTarget) {\r\n            try {\r\n                (event.relatedTarget as HTMLElement).focus();\r\n                didFocusRelated = true;\r\n            } catch(e) {\r\n                console.error('failed to focus');\r\n            }\r\n        }\r\n        if (!didFocusRelated) {\r\n            (event.currentTarget as HTMLElement).blur();\r\n        }\r\n    }\r\n\r\n    return function (el) {\r\n        el.setAttribute('tabindex', '-1');\r\n        el.addEventListener('focus', preventFocus);\r\n    };\r\n})();\r\n\r\n\r\nconst els: {\r\n    el: HTMLElement;\r\n    listeners: [keyof HTMLElementEventMap, EventListener][];\r\n}[] = [];\r\n// window['els'] = els;\r\n\r\n/**\r\n *\r\n * Create DOM element - div by default\r\n * params = {\r\n * \t    parent: someOtherDiv,\r\n * \t    css: {\r\n * \t\t    width: \"500px\",\r\n * \t\t    backgroundColor: \"#fff\"\r\n * \t    },\r\n * \t    content: \"test\", //or  content: [divA, divB, divC]   or content: someDiv\r\n * \t    className: \"bla\",\r\n *      id: \"bla\"\r\n * }\r\n *\r\n *  If onClick or onChange is used, then BB.destroyEl MUST be called\r\n *  to prevent a memory leak.\r\n *\r\n * @param params\r\n */\r\nexport function el <GTag extends keyof HTMLElementTagNameMap = 'div'> (\r\n    params?: {\r\n        parent?: HTMLElement;\r\n        css?: IKeyStringOptional;\r\n        custom?: { [key: string]: string };\r\n        content?: string | (HTMLElement | string | undefined)[] | Element;\r\n        textContent?: string;\r\n        className?: string;\r\n        title?: string;\r\n        id?: string;\r\n        tagName?: GTag;\r\n        onClick?: (e: Event) => void;\r\n        onChange?: (e: Event) => void;\r\n    }\r\n) {\r\n    if (!params) {\r\n        return document.createElement('div') as HTMLElementTagNameMap[GTag];\r\n    }\r\n    const result = document.createElement(params.tagName ? params.tagName : 'div');\r\n    params.css && css(result, params.css);\r\n\r\n    if (params.content) {\r\n        if (typeof params.content === typeof 'aa') {\r\n            result.innerHTML = params.content as string;\r\n\r\n        } else if (Array.isArray(params.content)) {\r\n            BB.append(result, params.content);\r\n\r\n        } else {\r\n            result.append(params.content as HTMLElement);\r\n\r\n        }\r\n    }\r\n    if (params.textContent) {\r\n        result.textContent = params.textContent;\r\n    }\r\n    if (params.className) {\r\n        result.className = params.className;\r\n    }\r\n    if (params.id) {\r\n        result.id = params.id;\r\n    }\r\n    if (params.parent) {\r\n        params.parent.append(result);\r\n    }\r\n    if ('title' in params && params.title !== undefined) {\r\n        result.title = params.title;\r\n    }\r\n    const listeners: [keyof HTMLElementEventMap, EventListener][] = [];\r\n    if (params.onClick !== undefined) {\r\n        result.addEventListener('click', params.onClick);\r\n        listeners.push(['click', params.onClick as EventListener]);\r\n    }\r\n    if (params.onChange !== undefined) {\r\n        result.addEventListener('change', params.onChange);\r\n        listeners.push(['change', params.onChange]);\r\n    }\r\n    if (listeners.length > 0) {\r\n        els.push({\r\n            el: result,\r\n            listeners,\r\n        });\r\n        /*div.style.backgroundColor = '#ff0';\r\n        div.style.border = '1px solid #ff0';*/\r\n    }\r\n    if ('custom' in params && params.custom) {\r\n        const customKeyArr = Object.keys(params.custom);\r\n        for (let i = 0; i < customKeyArr.length; i++) {\r\n            result.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\r\n        }\r\n    }\r\n    return result as HTMLElementTagNameMap[GTag];\r\n}\r\n\r\n/**\r\n * removes event listeners for Elements created via el()\r\n * @param el\r\n */\r\nexport function destroyEl (el?: HTMLElement): void {\r\n    if (!el) {\r\n        return;\r\n    }\r\n    for (let i = 0; i < els.length; i++) {\r\n        const item = els[i];\r\n        if (item.el === el) {\r\n            item.listeners.forEach(item => {\r\n                el.removeEventListener(item[0], item[1]);\r\n            });\r\n            els.splice(i, 1);\r\n            return;\r\n        }\r\n    }\r\n    // not found\r\n    return;\r\n}\r\n","\r\ntype TLogListener = (msg: any) => void;\r\n\r\nexport class BbLog {\r\n\r\n    private static listeners: TLogListener[] = [];\r\n\r\n    constructor () {\r\n    }\r\n\r\n    static subscribe (listener: TLogListener): void {\r\n        if (BbLog.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        BbLog.listeners.push(listener);\r\n    }\r\n\r\n    static unsubscribe (listener: TLogListener): void {\r\n        for (let i = 0; i < BbLog.listeners.length; i++) {\r\n            if (listener === BbLog.listeners[i]) {\r\n                BbLog.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    static emit (msg: any): void {\r\n        BbLog.listeners.forEach(item => {\r\n            item(msg);\r\n        });\r\n    }\r\n}","/**\r\n * LocalStorage wrapper that does not throw exceptions.\r\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\r\n */\r\nexport class LocalStorage {\r\n\r\n    private static error: unknown | undefined;\r\n\r\n    static getItem (key: string): string | null {\r\n        // (disabled) eslint-disable-next-line no-null/no-null\r\n        let result = null;\r\n        try {\r\n            result = localStorage.getItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static setItem (key: string, value: string): void {\r\n        try {\r\n            localStorage.setItem(key, value);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static removeItem (key: string): void {\r\n        try {\r\n            localStorage.removeItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static getError (): unknown {\r\n        return this.error;\r\n    }\r\n}","import {IPointerEvent} from '../event.types';\r\nimport {copyObj} from '../../base/base';\r\n\r\nexport interface ICoalescedPointerEvent extends IPointerEvent {\r\n    isCoalesced?: true;\r\n}\r\n\r\n/**\r\n * A ChainElement. Splits up coalesced events into their own pointermove events. Otherwise regular pass through.\r\n *\r\n * in: IPointerEvent\r\n * out: IPointerEvent with property isCoalesced: boolean\r\n *\r\n * todo: eventPreventDefault and eventStopPropagation are broken events w coalesced events. (because of json parse json stringify)\r\n * but how could that even work?\r\n */\r\nexport class CoalescedExploder {\r\n\r\n    private chainOut: ((e: ICoalescedPointerEvent) => void) | undefined;\r\n\r\n    // ---- public ----\r\n\r\n    setChainOut (func: (e: ICoalescedPointerEvent) => void) {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (event.coalescedArr && event.coalescedArr.length > 0) {\r\n                for (let i = 0; i < event.coalescedArr.length; i++) {\r\n                    const eventCopy: ICoalescedPointerEvent = copyObj(event);\r\n                    if (i === 0) {\r\n                        eventCopy.coalescedArr = [];\r\n                    }\r\n                    const coalescedItem = event.coalescedArr[i];\r\n\r\n                    eventCopy.pageX = coalescedItem.pageX;\r\n                    eventCopy.pageY = coalescedItem.pageY;\r\n                    eventCopy.relX = coalescedItem.relX;\r\n                    eventCopy.relY = coalescedItem.relY;\r\n                    eventCopy.dX = coalescedItem.dX;\r\n                    eventCopy.dY = coalescedItem.dY;\r\n                    eventCopy.time = coalescedItem.time;\r\n                    if (i < event.coalescedArr.length - 1) {\r\n                        eventCopy.isCoalesced = true;\r\n                    }\r\n\r\n                    this.chainOut && this.chainOut(eventCopy);\r\n                }\r\n\r\n            } else {\r\n                return event;\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n}\r\n","import {dist} from '../../math/math';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\n/**\r\n * A ChainElement. Detects a single tap with N 'touch' pointers\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class NFingerTapper {\r\n\r\n    private readonly minSilenceBeforeDurationMs = 50;\r\n    private readonly maxTapMs = 500;\r\n    private readonly maxFirstLastFingerDownMs = 250;\r\n    private readonly maxPressedDistancePx = 12; //5 + fingers * 5;\r\n\r\n    private chainOut: ((e: IPointerEvent) => void) | undefined;\r\n    private fingerArr: {\r\n        pointerId: number;\r\n        downTimeMs: number;\r\n        downPageX: number;\r\n        downPageY: number;\r\n        isUp?: boolean;\r\n    }[] = [];\r\n    private eventQueueArr: IPointerEvent[] = [];\r\n    private firstDownTime: number = 0;\r\n    private lastEventTime: number = 0;\r\n    private nowTime: number = performance.now();\r\n    private readonly pointersDownIdArr: number[] = [];\r\n    private readonly fingers: number;\r\n    private readonly onTap: () => void;\r\n    private readonly timeoutObj: {\r\n        firstLastDownTimeout: ReturnType<typeof setTimeout> | null;\r\n        tapTimeout: ReturnType<typeof setTimeout> | null;\r\n    } = {\r\n        firstLastDownTimeout: null,\r\n        tapTimeout: null,\r\n    };\r\n\r\n    private failGesture (): void {\r\n        if (this.eventQueueArr.length === 0) {\r\n            return;\r\n        }\r\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\r\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\r\n        for (let i = 0; i < this.eventQueueArr.length; i++) {\r\n            this.chainOut && this.chainOut(this.eventQueueArr[i]);\r\n        }\r\n        this.eventQueueArr = [];\r\n        this.fingerArr = [];\r\n    }\r\n\r\n    private success (): void {\r\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\r\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\r\n        this.eventQueueArr = []; // events get swallowed\r\n        this.fingerArr = [];\r\n        this.onTap();\r\n    }\r\n\r\n    private setupTimeout (timeoutStr: 'firstLastDownTimeout' | 'tapTimeout', timeMS: number): boolean {\r\n        const diff = timeMS - this.nowTime;\r\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        this.timeoutObj[timeoutStr] = setTimeout(() => this.failGesture(), diff);\r\n        return true;\r\n    }\r\n\r\n    private processEvent (event: IPointerEvent): true | void {\r\n\r\n        const tempLastEventTime = this.lastEventTime;\r\n        this.lastEventTime = event.time;\r\n\r\n        if (event.type === 'pointerdown') {\r\n            this.pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\r\n                if (this.pointersDownIdArr[i] === event.pointerId) {\r\n                    this.pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (event.pointerType !== 'touch') {\r\n            if (this.fingerArr.length > 0) { // already in gesture -> fail\r\n                this.failGesture();\r\n            }\r\n            return;\r\n        }\r\n\r\n        this.nowTime = performance.now();\r\n\r\n        if (event.type === 'pointerdown') {\r\n            //console.log('down');\r\n            if (this.fingerArr.length + 1 !== this.pointersDownIdArr.length) { // failed before, and some fingers are still down -> fail\r\n                this.failGesture();\r\n                return;\r\n            }\r\n            if (this.fingerArr.length === this.fingers) { // too many fingers down -> fail\r\n                //console.log(fingers + ': too many fingers down -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n            if (this.fingerArr.length > 0 && event.time - this.maxFirstLastFingerDownMs > this.fingerArr[0].downTimeMs) { // took too long to touch with all fingers -> fail\r\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n            if (this.fingerArr.length === 0 && event.time - this.minSilenceBeforeDurationMs < tempLastEventTime) { // not enough silence before -> fail\r\n                //console.log(fingers + ': not enough silence before -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            if (this.fingerArr.length === 0) {\r\n                this.firstDownTime = event.time;\r\n\r\n                if (!this.setupTimeout('firstLastDownTimeout', event.time + this.maxFirstLastFingerDownMs) || !this.setupTimeout('tapTimeout', event.time + this.maxTapMs)) { // timeouts already up -> fail\r\n                    this.failGesture();\r\n                    return;\r\n                }\r\n\r\n            }\r\n            this.fingerArr.push({\r\n                pointerId: event.pointerId,\r\n                downTimeMs: event.time,\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY,\r\n            });\r\n            return;\r\n\r\n        }\r\n\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (this.fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            for (let i = 0; i < this.fingerArr.length; i++) {\r\n                if (this.fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = this.fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) { // finger not part of the tap is on screen -> fail\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            if (event.time - this.maxTapMs > this.firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > this.maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'pointerup') {\r\n\r\n            if (this.fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            //console.log('up', event.pageX, event.pageY);\r\n            if (this.fingerArr.length !== this.fingers) { // not enough fingers -> fail\r\n                //console.log(fingers + ': not enough fingers -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            let i = 0;\r\n            for (; i < this.fingerArr.length; i++) {\r\n                if (this.fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = this.fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) {\r\n                //do nothing\r\n                return;\r\n            }\r\n\r\n            if (event.time - this.maxTapMs > this.firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > this.maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\r\n                //console.log(fingerArr);\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            fingerObj.isUp = true;\r\n\r\n            let allAreUp = true;\r\n            for (let i = 0; i < this.fingerArr.length; i++) {\r\n                if (!this.fingerArr[i].isUp) {\r\n                    allAreUp = false;\r\n                    break;\r\n                }\r\n            }\r\n            //console.log('fingerArr', fingerArr);\r\n\r\n            if (allAreUp) { // success\r\n                this.success();\r\n                return true;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            fingers: number;\r\n            onTap: () => void;\r\n        }\r\n    ) {\r\n        this.fingers = p.fingers;\r\n        this.onTap = p.onTap;\r\n    }\r\n\r\n\r\n    chainIn (event: IPointerEvent): (IPointerEvent | null) {\r\n\r\n        const result = this.processEvent(event);\r\n\r\n        //console.log(fingerArr.length);\r\n\r\n        if (result === true) {\r\n            //tap success -> event gets swallowed\r\n            return null;\r\n        }\r\n        if (this.fingerArr.length === 0) {\r\n            return event;\r\n        } else {\r\n            this.eventQueueArr.push(event);\r\n        }\r\n\r\n        return null;\r\n\r\n    }\r\n\r\n    setChainOut (func: (e: IPointerEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n\r\n}\r\n","import {dist, pointsToAngleRad} from '../../math/math';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\nexport type TPinchZoomerEvent = { type: 'end' } | {\r\n    type: 'move';\r\n\r\n    downRelX: number;\r\n    downRelY: number;\r\n    relX: number;\r\n    relY: number;\r\n\r\n    angleRad: number;\r\n    scale: number;\r\n};\r\n\r\ntype TTouchPointer =  {\r\n    pointerId: number;\r\n    relX: number;\r\n    relY: number;\r\n    downRelX?: number; // only for first\r\n    downRelY?: number;\r\n};\r\n\r\ntype TPinchGesture = {\r\n    touchPointerArr: TTouchPointer[];\r\n    otherPointerIdArr: number[];\r\n    isInProgress: boolean;\r\n};\r\n\r\n/**\r\n * A ChainElement. Detects a pinch zooming (2 touch pointers). If one finger lifts, then will use the remaining.\r\n * Further pointers are ignored, but their events get swallowed during the pinching.\r\n * pinching ends when ALL pointers are lifted.\r\n * Events passed through if no pinching.\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class PinchZoomer {\r\n\r\n    private readonly firstFingerMaxDistancePx = 10;\r\n    private readonly untilSecondFingerDurationMs = 250;\r\n\r\n\r\n    private chainOut: ((e: IPointerEvent) => void) | undefined;\r\n    private readonly pointersDownIdArr: number[] = [];\r\n    private gestureObj: null | TPinchGesture = null;\r\n    private eventQueueArr: IPointerEvent[] = [];\r\n    private nowTime: number = performance.now();\r\n    private readonly timeoutObj: {\r\n        secondFingerTimeout: ReturnType<typeof setTimeout> | null;\r\n    } = {\r\n        secondFingerTimeout: null,\r\n    };\r\n    private pincherArr: {\r\n        pointerId: number;\r\n        relX: number;\r\n        relY: number;\r\n        downRelX: number;\r\n        downRelY: number;\r\n    }[] = [];\r\n    private readonly onPinch: (e: TPinchZoomerEvent) => void;\r\n\r\n\r\n    private end (): void {\r\n        this.gestureObj = null;\r\n        this.eventQueueArr = [];\r\n    }\r\n\r\n    private fail (doSwallow?: boolean): void {\r\n        if (!this.gestureObj) { // no gesture happening -> ignore\r\n            return;\r\n        }\r\n\r\n        this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\r\n        if (!doSwallow) {\r\n            for (let i = 0; i < this.eventQueueArr.length; i++) {\r\n                this.chainOut && this.chainOut(this.eventQueueArr[i]);\r\n            }\r\n        }\r\n        this.end();\r\n    }\r\n\r\n    private setupFailTimeout (timeMS: number): boolean {\r\n        const diff = timeMS - this.nowTime;\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        this.timeoutObj.secondFingerTimeout = setTimeout(() => this.fail(), diff);\r\n        return true;\r\n    }\r\n\r\n    private processEvent (event: IPointerEvent): void {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            this.pointersDownIdArr.push(event.pointerId);\r\n\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\r\n                if (this.pointersDownIdArr[i] === event.pointerId) {\r\n                    this.pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        //pass through scenarios\r\n        if (\r\n            !this.gestureObj && (\r\n                event.pointerType !== 'touch' || // wrong pointer type\r\n                (event.type === 'pointermove' && this.pointersDownIdArr.length > 0) || // failed before\r\n                this.pointersDownIdArr.length > 1 || // failed before\r\n                event.type === 'pointerup' // failed before\r\n            )\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        this.nowTime = performance.now();\r\n\r\n\r\n        //pointer down\r\n        if (event.type === 'pointerdown') {\r\n\r\n            if (this.gestureObj) {\r\n                if (event.pointerType === 'touch') { // touch finger down - as nth pointer\r\n\r\n                    this.gestureObj.touchPointerArr.push({\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY,\r\n                    });\r\n\r\n                    if (this.gestureObj.isInProgress) {\r\n                        this.continuePinch(this.gestureObj, {\r\n                            type: 'down',\r\n                            index: this.gestureObj.touchPointerArr.length - 1,\r\n                        });\r\n                    } else {\r\n                        this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\r\n                        this.gestureObj.isInProgress = true;\r\n                        this.beginPinch(this.gestureObj);\r\n                    }\r\n                    return;\r\n\r\n                } else { // non-touch finger down - as nth pointer\r\n\r\n                    if (this.gestureObj.isInProgress) {\r\n                        this.gestureObj.otherPointerIdArr.push(event.pointerId);\r\n                    } else { // second pointer wrong type -> fail\r\n                        this.fail();\r\n                    }\r\n                    return;\r\n                }\r\n\r\n\r\n            } else {\r\n                // first finger down - can only be touch if no gestureObj\r\n                this.gestureObj = {\r\n                    touchPointerArr: [{\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY,\r\n                        downRelX: event.relX,\r\n                        downRelY: event.relY,\r\n                    }],\r\n                    otherPointerIdArr: [],\r\n                    isInProgress: false,\r\n                };\r\n                if (!this.setupFailTimeout(event.time + this.untilSecondFingerDurationMs)) { // time ran out -> fail\r\n                    this.fail();\r\n                    return;\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        // should not happen. something went wrong\r\n        if (!this.gestureObj) {\r\n            // throw? would make it less robust\r\n            this.fail();\r\n            return;\r\n        }\r\n\r\n        //pointer move\r\n        if (event.type === 'pointermove' && event.pointerType === 'touch') {\r\n            //gesture object should always exist here\r\n\r\n            let touchPointerObj: TTouchPointer | null = null;\r\n            let i = 0;\r\n            for (; i < this.gestureObj.touchPointerArr.length; i++) {\r\n                if (event.pointerId === this.gestureObj.touchPointerArr[i].pointerId) {\r\n                    touchPointerObj = this.gestureObj.touchPointerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n\r\n            //null should not be possible. something went wrong\r\n            if (!touchPointerObj) {\r\n                // throw? would make it less robust\r\n                this.fail();\r\n                return;\r\n            }\r\n\r\n            touchPointerObj.relX = event.relX;\r\n            touchPointerObj.relY = event.relY;\r\n\r\n            if (!this.gestureObj.isInProgress) { // only one finger down & pinching hasn't started\r\n\r\n                // should not happen. something went wrong\r\n                if (\r\n                    !('downRelX' in touchPointerObj && touchPointerObj.downRelX !== undefined) ||\r\n                    !('downRelY' in touchPointerObj && touchPointerObj.downRelY !== undefined)\r\n                ) {\r\n                    this.fail();\r\n                    return;\r\n                }\r\n\r\n                const distance = dist(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\r\n                if (distance > this.firstFingerMaxDistancePx) { // moved too much -> fail\r\n                    this.fail();\r\n                    return;\r\n                }\r\n\r\n            } else {\r\n                if (i < 2) { // only first two touches can affect pinching\r\n                    this.continuePinch(this.gestureObj, {\r\n                        type: 'move',\r\n                        index: i,\r\n                    });\r\n                }\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n\r\n        //pointer up\r\n        if (event.type === 'pointerup') {\r\n            //gesture object should always exist here\r\n\r\n            if (event.pointerType === 'touch') {\r\n                let i = 0;\r\n                for (; i < this.gestureObj.touchPointerArr.length; i++) {\r\n                    if (this.gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\r\n                        this.gestureObj.touchPointerArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n                if (this.gestureObj.touchPointerArr.length > 0) {\r\n                    this.continuePinch(this.gestureObj, {\r\n                        type: 'up',\r\n                        index: i,\r\n                    });\r\n                }\r\n\r\n            } else { // non-touch\r\n                for (let i = 0; i < this.gestureObj.otherPointerIdArr.length; i++) {\r\n                    if (this.gestureObj.otherPointerIdArr[i] === event.pointerId) {\r\n                        this.gestureObj.otherPointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            //all fingers lifted?\r\n            if (this.gestureObj.touchPointerArr.length === 0 && this.gestureObj.otherPointerIdArr.length === 0) {\r\n                if (this.gestureObj.isInProgress) { // lifted last finger -> end of pinching\r\n                    this.end();\r\n                    this.endPinch();\r\n                } else { // lifted finger again before pinching started -> fail\r\n                    this.fail();\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    private beginPinch (gestureObj: TPinchGesture): void {\r\n\r\n        for (let i = 0; i < gestureObj.touchPointerArr.length; i++) {\r\n            const pointerObj = gestureObj.touchPointerArr[i];\r\n            this.pincherArr.push({\r\n                pointerId: pointerObj.pointerId,\r\n                relX: pointerObj.relX,\r\n                relY: pointerObj.relY,\r\n                downRelX: pointerObj.relX,\r\n                downRelY: pointerObj.relY,\r\n            });\r\n        }\r\n\r\n        const event: TPinchZoomerEvent = {\r\n            type: 'move',\r\n\r\n            // temp\r\n            downRelX: 0,\r\n            downRelY: 0,\r\n            relX: 0,\r\n            relY: 0,\r\n\r\n            angleRad: 0,\r\n            scale: 1,\r\n        };\r\n\r\n        if (this.pincherArr.length === 1) {\r\n            event.relX = this.pincherArr[0].downRelX;\r\n            event.relY = this.pincherArr[0].downRelY;\r\n        } else {\r\n            event.relX = 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX);\r\n            event.relY = 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY);\r\n        }\r\n        event.downRelX = event.relX;\r\n        event.downRelY = event.relY;\r\n\r\n        this.onPinch(event);\r\n\r\n    }\r\n\r\n    //actionObj = {type: 'down'|'move'|'up', index: number}\r\n    private continuePinch (\r\n        gestureObj: TPinchGesture,\r\n        actionObj: {\r\n            type: 'down' | 'move' | 'up';\r\n            index: number;\r\n        }\r\n    ): void {\r\n\r\n        if (actionObj.index > 1) { // only first two pointers matter\r\n            return;\r\n        }\r\n\r\n        if (actionObj.type === 'move') {\r\n\r\n            let event: TPinchZoomerEvent;\r\n            this.pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\r\n            this.pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\r\n\r\n            if (this.pincherArr.length === 1) {\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: this.pincherArr[0].downRelX,\r\n                    downRelY: this.pincherArr[0].downRelY,\r\n                    relX: this.pincherArr[0].relX,\r\n                    relY: this.pincherArr[0].relY,\r\n                    angleRad: 0,\r\n                    scale: 1,\r\n                };\r\n\r\n            } else {\r\n\r\n                const startDist = dist(this.pincherArr[0].downRelX, this.pincherArr[0].downRelY, this.pincherArr[1].downRelX, this.pincherArr[1].downRelY);\r\n                const distance = dist(this.pincherArr[0].relX, this.pincherArr[0].relY, this.pincherArr[1].relX, this.pincherArr[1].relY);\r\n\r\n                const startAngle = pointsToAngleRad({\r\n                    x: this.pincherArr[0].downRelX,\r\n                    y: this.pincherArr[0].downRelY,\r\n                }, {x: this.pincherArr[1].downRelX, y: this.pincherArr[1].downRelY});\r\n                const angle = pointsToAngleRad({\r\n                    x: this.pincherArr[0].relX,\r\n                    y: this.pincherArr[0].relY,\r\n                }, {x: this.pincherArr[1].relX, y: this.pincherArr[1].relY});\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX),\r\n                    downRelY: 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY),\r\n                    relX: 0.5 * (this.pincherArr[0].relX + this.pincherArr[1].relX),\r\n                    relY: 0.5 * (this.pincherArr[0].relY + this.pincherArr[1].relY),\r\n                    angleRad: angle - startAngle,\r\n                    scale: distance / startDist,\r\n                };\r\n\r\n            }\r\n\r\n            this.onPinch(event);\r\n\r\n        } else if (actionObj.type === 'down' || actionObj.type === 'up') {\r\n            this.endPinch();\r\n            this.beginPinch(gestureObj);\r\n        }\r\n\r\n    }\r\n\r\n    private endPinch (): void {\r\n        this.pincherArr = [];\r\n        this.onPinch({\r\n            type: 'end',\r\n        });\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onPinch: (e: TPinchZoomerEvent) => void;\r\n        }\r\n    ) {\r\n        this.onPinch = p.onPinch;\r\n    }\r\n\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n        this.processEvent(event);\r\n        if (this.gestureObj) {\r\n            if (!this.gestureObj.isInProgress) { // might still fail -> into queue\r\n                this.eventQueueArr.push(event);\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    setChainOut (func: (e: IPointerEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n}\r\n","import {TChainOutFunc} from './event-chain.types';\r\nimport {dist} from '../../math/math';\r\nimport {IPointerEvent, TPointerButton, TPointerType} from '../event.types';\r\n\r\n\r\nexport interface IDoubleTapperEvent {\r\n    pageX: number;\r\n    pageY: number;\r\n    relX: number;\r\n    relY: number;\r\n}\r\n\r\ntype TDoubleTapperTimeoutType = 'fail' | 'maxUntilSecondDown' | 'success';\r\n\r\n/**\r\n * A ChainElement. Detects double taps.\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class DoubleTapper {\r\n\r\n    private readonly onDoubleTap: (e: IDoubleTapperEvent) => void;\r\n    private chainOut: TChainOutFunc | undefined;\r\n    private allowedPointerTypeArr: TPointerType[] = ['touch', 'mouse', 'pen'];\r\n    private allowedButtonArr: TPointerButton[] = ['left'];\r\n    private minSilenceBeforeDurationMs: number = 400;\r\n    private maxPressedDurationMs: number = 300;\r\n    private maxPressedDistancePx: number = 10;\r\n    private maxInbetweenDistancePx: number = 19;\r\n    private maxUpToUpDurationMs: number = 500;\r\n    private maxUntilSecondDownDurationMs: number = 300;\r\n    private minSilenceAfterMs: number = 250;\r\n    private sequenceArr: (\r\n        {\r\n            isDown: boolean;\r\n            time: number;\r\n            position: [number, number];\r\n            pointerId: number;\r\n        } |\r\n        {\r\n            isUp: boolean;\r\n            time: number;\r\n            position: [number, number];\r\n        } |\r\n        {\r\n            pageX: number;\r\n            pageY: number;\r\n            relX: number;\r\n            relY: number;\r\n        }\r\n        )[] = [];\r\n    private pointersDownIdArr: number[] = [];\r\n    private lastUpTime: number = 0;\r\n    private nowTime: number = 0;\r\n    private eventQueueArr: IPointerEvent[] = [];\r\n    private timeoutObj: {\r\n        [K in TDoubleTapperTimeoutType]: ReturnType<typeof setTimeout> | null;\r\n    } = {\r\n        fail: null,\r\n        maxUntilSecondDown: null,\r\n        success: null,\r\n    };\r\n    private readonly gestureFailed: () => void;\r\n\r\n    // double tap achieved\r\n    private success (): void {\r\n        this.timeoutObj.fail = null;\r\n        this.timeoutObj.success = null;\r\n        this.eventQueueArr = []; // events get swallowed\r\n        const lastSequenceItem = this.sequenceArr[this.sequenceArr.length - 1];\r\n        this.sequenceArr = [];\r\n        if ('pageX' in lastSequenceItem) {\r\n            this.onDoubleTap({\r\n                pageX: lastSequenceItem.pageX,\r\n                pageY: lastSequenceItem.pageY,\r\n                relX: lastSequenceItem.relX,\r\n                relY: lastSequenceItem.relY,\r\n            });\r\n        }\r\n    }\r\n\r\n    // returns false if time already up. otherwise sets up timeout\r\n    private setupTimeout (timeoutStr: TDoubleTapperTimeoutType, targetFunc: () => void, timeMS: number): boolean {\r\n        const diff = timeMS - this.nowTime;\r\n        // console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        this.timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @param event object - a pointer event from BB.PointerListener\r\n     */\r\n    private processEvent (event: IPointerEvent): void {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            this.pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\r\n                if (this.pointersDownIdArr[i] === event.pointerId) {\r\n                    this.pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!this.allowedPointerTypeArr.includes(event.pointerType)) { //wrong input type -> fail\r\n            //console.log('wrong input type -> fail');\r\n            this.gestureFailed();\r\n            return;\r\n        }\r\n\r\n        this.nowTime = performance.now();\r\n        const lastSequenceItem = this.sequenceArr.length > 0 ? this.sequenceArr[this.sequenceArr.length - 1] : null;\r\n        if (event.type === 'pointerup') {\r\n            this.lastUpTime = event.time;\r\n        }\r\n\r\n        if (event.type === 'pointerdown') {\r\n            if (this.pointersDownIdArr.length > 1) { // more than one pointer down -> fail\r\n                //console.log('more than one pointer down -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (this.timeoutObj.success !== null) { // silence-after not achieved -> fail\r\n                //console.log('silence-after not achieved -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (this.sequenceArr.length === 0 && this.nowTime - this.lastUpTime < this.minSilenceBeforeDurationMs) { // silence before not achieved -> fail\r\n                //console.log('silence before not achieved -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (event.button && !this.allowedButtonArr.includes(event.button)) { // wrong button -> fail\r\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if ((lastSequenceItem && 'isDown' in lastSequenceItem && lastSequenceItem.isDown) || this.sequenceArr.length > 2) { // jumbled -> fail\r\n                //console.log('jumbled -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (lastSequenceItem && 'position' in lastSequenceItem) {\r\n                const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n                if (distance > this.maxInbetweenDistancePx) { //moved too much -> reset\r\n                    //console.log('maxInbetweenDistancePx -> reset');\r\n                    this.gestureFailed();\r\n\r\n\r\n                    if ('time' in lastSequenceItem && this.nowTime - lastSequenceItem.time < this.minSilenceBeforeDurationMs) { //silence before not achieved -> fail\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            this.sequenceArr.push({\r\n                isDown: true,\r\n                time: this.nowTime,\r\n                position: [event.pageX, event.pageY],\r\n                pointerId: event.pointerId,\r\n            });\r\n            //maxUntilSecondDown\r\n\r\n            if (this.sequenceArr.length > 1) {\r\n                this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\r\n            } else if (!this.setupTimeout('maxUntilSecondDown', () => this.gestureFailed(), event.time + this.maxUntilSecondDownDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n\r\n\r\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\r\n            if (!this.setupTimeout('fail', () => this.gestureFailed(), event.time + this.maxPressedDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointermove' && 'pointerId' in lastSequenceItem && lastSequenceItem.pointerId === event.pointerId) {\r\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                console.log('another pointer mixing in -> fail');\r\n                this.fail();\r\n                return;\r\n            }*/\r\n            const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n            if (distance > this.maxPressedDistancePx) { //moved too much -> fail\r\n                //console.log('maxPressedDistancePx -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointerup') {\r\n            if ('pointerId' in lastSequenceItem && lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if ('time' in lastSequenceItem && this.nowTime >= lastSequenceItem.time + this.maxPressedDurationMs) { //pressed too long -> fail\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\r\n\r\n            if (this.sequenceArr.length < 3) {\r\n                if (!this.setupTimeout('fail', () => this.gestureFailed(), event.time + this.maxUpToUpDurationMs)) {\r\n                    this.gestureFailed();\r\n                    return;\r\n                }\r\n\r\n                this.sequenceArr = [\r\n                    lastSequenceItem,\r\n                    {\r\n                        isUp: true,\r\n                        time: this.nowTime,\r\n                        position: [event.pageX, event.pageY],\r\n                    },\r\n                ];\r\n                return;\r\n            }\r\n\r\n            if ('time' in this.sequenceArr[1] && this.nowTime < this.sequenceArr[1].time + this.maxUpToUpDurationMs) {\r\n                // double tap almost success\r\n                // only needs silence\r\n                this.sequenceArr.push({\r\n                    pageX: event.pageX,\r\n                    pageY: event.pageY,\r\n                    relX: event.relX,\r\n                    relY: event.relY,\r\n                });\r\n                if (!this.setupTimeout('success', () => this.success(), event.time + this.minSilenceAfterMs)) {\r\n                    this.gestureFailed();\r\n                }\r\n            } else { // time up -> fail\r\n                this.gestureFailed();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onDoubleTap: (e: IDoubleTapperEvent) => void; // fires when double tap occurs\r\n        }\r\n    ) {\r\n        this.onDoubleTap = p.onDoubleTap;\r\n        this.gestureFailed = () => {\r\n            if (this.sequenceArr.length === 0) { // no gesture started -> can be ignored\r\n                return;\r\n            }\r\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\r\n            this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\r\n            this.timeoutObj.success && clearTimeout(this.timeoutObj.success);\r\n            this.timeoutObj.fail = null;\r\n            this.timeoutObj.maxUntilSecondDown = null;\r\n            this.timeoutObj.success = null;\r\n\r\n            if (this.chainOut) {\r\n                for (let i = 0; i < this.eventQueueArr.length; i++) {\r\n                    this.chainOut(this.eventQueueArr[i]);\r\n                }\r\n            }\r\n\r\n            this.eventQueueArr = [];\r\n            this.sequenceArr = [];\r\n        };\r\n    }\r\n\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n\r\n        this.processEvent(event);\r\n\r\n        if (this.sequenceArr.length === 0) { //existing events can not become a double tap\r\n            this.gestureFailed();\r\n            return event;\r\n        }\r\n        // events might become a double tap -> queue\r\n        this.eventQueueArr.push(event);\r\n        return null;\r\n    }\r\n\r\n    setChainOut (func: TChainOutFunc): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    setAllowedPointerTypeArr (arr: TPointerType[]): void {\r\n        this.allowedPointerTypeArr = [...arr];\r\n    }\r\n\r\n    setAllowedButtonArr (arr: TPointerButton[]): void {\r\n        this.allowedButtonArr = [...arr];\r\n    }\r\n\r\n}\r\n","import {TChainOutFunc} from './event-chain.types';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\n/**\r\n * only lets through events from one pointer at a time.\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class OnePointerLimiter {\r\n\r\n    private chainOut: TChainOutFunc | undefined;\r\n    private downPointerId: number | null = null;\r\n    private readonly ignorePointerIdArr: number[] = [];\r\n\r\n    // ---- public ----\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n\r\n        if (this.ignorePointerIdArr.includes(event.pointerId)) {\r\n            if (event.type === 'pointerup') {\r\n                for (let i = 0; i < this.ignorePointerIdArr.length; i++) {\r\n                    if (this.ignorePointerIdArr[i] === event.pointerId) {\r\n                        this.ignorePointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        if (this.downPointerId === null) {\r\n            if (event.type === 'pointerdown') {\r\n                this.downPointerId = event.pointerId;\r\n            }\r\n            return event;\r\n\r\n        } else {\r\n            if (event.pointerId !== this.downPointerId) {\r\n                if (event.type === 'pointerdown') {\r\n                    this.ignorePointerIdArr.push(event.pointerId);\r\n                }\r\n                return null;\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                this.downPointerId = null;\r\n            }\r\n            return event;\r\n        }\r\n    }\r\n\r\n    setChainOut (func: TChainOutFunc): void {\r\n        this.chainOut = func;\r\n    }\r\n}","import {IChainElement, TChainOutFunc} from './event-chain.types';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\n/**\r\n * for chaining event processing. useful for gestures (double tap, pinch zoom, max pointer filter).\r\n * each element in the chain might hold back the events, swallow them, transform them, or create new ones\r\n */\r\nexport class EventChain {\r\n    private readonly chainArr: IChainElement[];\r\n    private chainOut: TChainOutFunc | undefined;\r\n\r\n    private continueChain (i: number, event: IPointerEvent): null {\r\n        for (; i < this.chainArr.length; i++) {\r\n            event = this.chainArr[i].chainIn(event);\r\n            if (event === null) {\r\n                return null;\r\n            }\r\n        }\r\n        this.chainOut && this.chainOut(event);\r\n        return null;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            chainArr: IChainElement[];\r\n        }\r\n    ) {\r\n        this.chainArr = p.chainArr;\r\n\r\n        for (let i = 0; i < this.chainArr.length; i++) {\r\n            ( (i) => {\r\n                this.chainArr[i].setChainOut((event: IPointerEvent) => {\r\n                    this.continueChain(i + 1, event);\r\n                });\r\n            })(i);\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * feed an event into the chain\r\n     */\r\n    chainIn (event: IPointerEvent): null {\r\n        return this.continueChain(0, event);\r\n    }\r\n\r\n    /**\r\n     * func will be called when event has passed through the chain\r\n     */\r\n    setChainOut (func: TChainOutFunc): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n}\r\n","window.onscroll = (e) => {\r\n    e.preventDefault();\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hWwEP\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"83Fnk\");","import {KeyListener} from '../../../../bb/input/key-listener';\r\nimport {dialogCounter} from '../modal-count';\r\nimport {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport './scroll-fix';\r\nimport cancelImg from '/src/app/img/ui/cancel.svg';\r\n\r\n/**\r\n * popup that fill whole height, with some padding.\r\n * currently only used for iframe popups.\r\n */\r\nexport class DynamicModal {\r\n\r\n    private readonly parent: HTMLElement;\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly updatePos: () => void;\r\n    private readonly keyListener: KeyListener;\r\n    private readonly xButton: HTMLElement;\r\n    private readonly bgEl: HTMLElement;\r\n    private readonly onClose: ((result?: string) => void) | undefined;\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            title?: HTMLElement;\r\n            content?: HTMLElement;\r\n            buttonArr?: string[];\r\n            autoFocus?: string | false; // todo - not implemented\r\n            clickOnEnter?: string; // button name - todo not implemented\r\n            onClose?: (result?: string) => void;\r\n\r\n            //size and position\r\n            width: number;\r\n            isMaxHeight: boolean; // todo - not implemented\r\n        }\r\n    ) {\r\n        dialogCounter.increase();\r\n        this.onClose = p.onClose;\r\n        this.parent = document.body;\r\n        this.rootEl = BB.el({\r\n            parent: this.parent,\r\n            className: 'g-root kl-d-modal-root',\r\n            css: {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0',\r\n                overflow: 'auto',\r\n                animationName: 'consoleIn',\r\n                animationDuration: '0.3s',\r\n                animationTimingFunction: 'ease-out',\r\n            },\r\n            onClick: BB.handleClick,\r\n        });\r\n\r\n        //background element registering clicks\r\n        this.bgEl = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0',\r\n            },\r\n            onClick: () => this.close(),\r\n        });\r\n\r\n        //the actual popup box\r\n        const popupEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-d-modal',\r\n            css: {\r\n                position: 'absolute',\r\n                width: (BB.isCssMinMaxSupported() ?\r\n                    'min(calc(100% - 40px), ' + (p.width ? p.width : 400) + 'px)' :\r\n                    (p.width ? p.width : 400) + 'px'),\r\n                height: 'calc(100% - 40px)',\r\n                borderRadius: '10px',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n        //x and y position via script. flex not powerful enough imo\r\n        this.updatePos = () => {\r\n            const elW = popupEl.offsetWidth;\r\n            const elH = popupEl.offsetHeight;\r\n\r\n            BB.css(popupEl, {\r\n                left: Math.max(0, (window.innerWidth - elW) / 2) + 'px',\r\n                top: Math.max(20, (window.innerHeight - elH) / 2 - (elH * 0.20)) + 'px',\r\n            });\r\n        };\r\n\r\n        this.updatePos();\r\n        window.addEventListener('resize', this.updatePos);\r\n\r\n        //title row in popup\r\n        const titleHeight = 40;\r\n        const titleEl = BB.el({\r\n            parent: popupEl,\r\n            css: {\r\n                height: titleHeight + 'px',\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center',\r\n                paddingLeft: (titleHeight / 2) + 'px',\r\n            },\r\n        });\r\n        if (p.title) {\r\n            titleEl.append(p.title);\r\n        }\r\n        this.xButton = BB.el({\r\n            parent: titleEl,\r\n            tagName: 'button',\r\n            className: 'popup-x',\r\n            content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n            title: LANG('modal-close'),\r\n            onClick: () => this.close(),\r\n            css: {\r\n                width: titleHeight + 'px',\r\n                height: titleHeight + 'px',\r\n                lineHeight: titleHeight + 'px',\r\n                background: 'none',\r\n                boxShadow: 'none',\r\n            },\r\n            custom: {\r\n                tabindex: '0',\r\n            },\r\n        });\r\n\r\n        const contentEl = BB.el({\r\n            parent: popupEl,\r\n            css: {\r\n                height: 'calc(100% - ' + titleHeight + 'px)',\r\n            },\r\n        });\r\n        if (p.content) {\r\n            contentEl.append(p.content);\r\n        }\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, e) => {\r\n                if (keyStr === 'esc') {\r\n                    e.stopPropagation();\r\n                    this.close();\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n    close (): void {\r\n        dialogCounter.decrease();\r\n        BB.destroyEl(this.rootEl);\r\n        this.rootEl.remove();\r\n        window.removeEventListener('resize', this.updatePos);\r\n        this.keyListener.destroy();\r\n        BB.destroyEl(this.xButton);\r\n        BB.destroyEl(this.bgEl);\r\n        this.onClose && this.onClose();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IKeyStringOptional} from '../../../bb/bb-types';\r\n\r\n/**\r\n * Checkbox - with label\r\n */\r\nexport class Checkbox {\r\n\r\n    private readonly element: HTMLElement;\r\n    private check: HTMLInputElement;\r\n    private readonly doHighlight: boolean;\r\n\r\n    // --- public ---\r\n\r\n    constructor (params: {\r\n        init?: boolean; // default false\r\n        label: string;\r\n        callback?: (b: boolean) => void;\r\n        allowTab?: boolean; // default false\r\n        title?: string;\r\n        doHighlight?: boolean; // default false\r\n        css?: IKeyStringOptional;\r\n    }) {\r\n        this.doHighlight = !!params.doHighlight;\r\n\r\n        this.element = BB.el({\r\n            className: 'kl-checkbox',\r\n        });\r\n\r\n        const innerEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'label',\r\n            className: 'kl-checkbox__inner',\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        this.check = BB.el({\r\n            parent: innerEl,\r\n            tagName: 'input',\r\n            css: {\r\n                margin: '0 5px 0 0',\r\n            },\r\n            custom: {\r\n                type: 'checkbox',\r\n            },\r\n        });\r\n\r\n        this.check.checked = !!params.init;\r\n        if (this.doHighlight && this.check.checked) {\r\n            this.element.classList.add('kl-checkbox--highlight');\r\n        }\r\n        if (!params.allowTab) {\r\n            this.check.tabIndex = -1;\r\n        }\r\n\r\n        if (params.title) {\r\n            innerEl.title = params.title;\r\n        }\r\n\r\n        const label = BB.el({\r\n            parent: innerEl,\r\n            content: params.label,\r\n            css: {},\r\n        });\r\n        (label as any).allowClick = true;\r\n\r\n        this.check.onchange = () => {\r\n            if (this.doHighlight) {\r\n                this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\r\n            }\r\n            params.callback && params.callback(this.check.checked);\r\n            setTimeout(() => {\r\n                this.check.blur();\r\n            }, 0);\r\n        };\r\n        if (params.css) {\r\n            BB.css(this.element, params.css);\r\n        }\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.check.checked;\r\n    }\r\n\r\n    setValue (b: boolean): void {\r\n        this.check.checked = !!b;\r\n        if (this.doHighlight) {\r\n            this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.element;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.check.onchange = null;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb-types';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\n\r\ntype TInputType = 'button' | 'checkbox' | 'number' | 'text' | 'color';\r\n\r\nexport type TInputParams = {\r\n    type?: TInputType; // default: text\r\n    init: string | number;\r\n    title?: string;\r\n    label?: string | HTMLElement;\r\n\r\n    // for type: number\r\n    min?: number;\r\n    max?: number;\r\n    step?: number;\r\n\r\n    onChange?: (v: string) => void;\r\n\r\n    doScrollWithoutFocus?: boolean; // default: false\r\n    doResetIfInvalid?: boolean; // default: false\r\n\r\n    css?: IKeyString;\r\n};\r\n\r\nexport class Input {\r\n    private readonly rootEl: HTMLLabelElement;\r\n    private readonly input: HTMLInputElement;\r\n    private readonly type: TInputType;\r\n    private readonly pointerListener;\r\n    private readonly keyListener: KeyListener = {destroy: () => {}} as KeyListener;\r\n\r\n    // ---- public ----\r\n    constructor (p: TInputParams) {\r\n        this.rootEl = BB.el({\r\n            tagName: 'label',\r\n            content: p.label,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                gap: '5px',\r\n            },\r\n        });\r\n\r\n\r\n        this.input = BB.el({\r\n            tagName: 'input',\r\n            parent: this.rootEl,\r\n            title: p.title,\r\n        });\r\n\r\n        this.input.type;\r\n\r\n        this.type = p.type ?? 'text';\r\n        try {\r\n            this.input.type = this.type;\r\n        } catch(e) {\r\n            // ie can't deal with number\r\n        }\r\n\r\n        const stepSize = p.step ?? 1;\r\n\r\n        if (this.type === 'number') {\r\n            if (p.min !== undefined) {\r\n                this.input.min = '' + p.min;\r\n            }\r\n            if (p.max !== undefined) {\r\n                this.input.max = '' + p.max;\r\n            }\r\n            if (p.step !== undefined) {\r\n                this.input.step = '' + stepSize;\r\n            }\r\n        }\r\n\r\n        this.input.value = '' + p.init;\r\n\r\n        let lastValidValue = this.input.value;\r\n\r\n        /**\r\n         * return true if not changed\r\n         */\r\n        const handleChange = (): boolean => {\r\n            const oldVal = lastValidValue;\r\n            let newValue = this.input.value;\r\n            if (p.doResetIfInvalid) {\r\n                let didChange = false;\r\n                if (newValue === '') {\r\n                    newValue = lastValidValue;\r\n                    didChange = true;\r\n                }\r\n                if (p.min !== undefined && parseFloat(newValue) < p.min) {\r\n                    newValue = '' + p.min;\r\n                    didChange = true;\r\n                }\r\n                if (p.max !== undefined && parseFloat(newValue) > p.max) {\r\n                    newValue = '' + p.max;\r\n                    didChange = true;\r\n                }\r\n                if (didChange) {\r\n                    this.input.value = '' + newValue;\r\n                }\r\n            }\r\n\r\n            lastValidValue = newValue;\r\n\r\n            return oldVal !== newValue;\r\n        };\r\n\r\n        if (p.onChange) {\r\n            const onChange = p.onChange;\r\n            this.input.onchange = () => {\r\n                handleChange() && onChange(this.input.value);\r\n            };\r\n        }\r\n        if (p.css) {\r\n            BB.css(this.input, p.css);\r\n        }\r\n\r\n        if (p.doScrollWithoutFocus && p.type === 'number' && p.onChange) {\r\n            const onChange = p.onChange;\r\n            this.keyListener = new BB.KeyListener({});\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.input,\r\n                onWheel: (e) => {\r\n                    /*if (document.hasFocus()) { // what was the point of this?\r\n                        return;\r\n                    }*/\r\n                    const fac = this.keyListener.isPressed('shift') ? 4 : 1;\r\n                    this.input.value = '' + (parseFloat(this.input.value) - e.deltaY * stepSize * fac);\r\n                    handleChange() && onChange(this.input.value);\r\n                },\r\n            });\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValue (): string {\r\n        return this.input.value;\r\n    }\r\n\r\n    setValue (v: string | number): void {\r\n        this.input.value = '' + v;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.pointerListener && this.pointerListener.destroy();\r\n        this.keyListener.destroy();\r\n    }\r\n}\r\n\r\n// todo replace instances with class\r\nexport const input = function (params: {\r\n    type?: TInputType; // default text\r\n    min?: number;\r\n    max?: number;\r\n    callback: (val: string) => void;\r\n    init: string | number;\r\n    css?: IKeyString;\r\n}) {\r\n    const result = document.createElement('input');\r\n    if (params.type) {\r\n        try {\r\n            result.type = params.type;\r\n        } catch(e) {\r\n            /* empty */\r\n            // ie can't deal with number\r\n        }\r\n    } else {\r\n        result.type = 'text';\r\n    }\r\n    if (params.min !== undefined) {\r\n        result.min = '' + params.min;\r\n    }\r\n    if (params.max !== undefined) {\r\n        result.max = '' + params.max;\r\n    }\r\n    result.value = '' + params.init;\r\n    if (params.callback) {\r\n        result.onchange = function () {\r\n            params.callback(result.value);\r\n        };\r\n    }\r\n    if (params.css) {\r\n        BB.css(result, params.css);\r\n    }\r\n\r\n    return result;\r\n};","import {BB} from '../../../bb/bb';\r\nimport {IKeyString, IKeyStringOptional} from '../../../bb/bb-types';\r\n\r\n\r\ntype TSelectItem<ValueType> = [ValueType, string] | [ValueType, string, { css: IKeyStringOptional }]; // [value, label, properties]\r\n\r\n/**\r\n * A select dropdown\r\n */\r\nexport class Select<ValueType extends string> {\r\n\r\n    private readonly selectEl: HTMLSelectElement;\r\n    private optionArr: {\r\n        item: (TSelectItem<ValueType> | undefined);\r\n        el?: HTMLOptionElement;\r\n    }[] = [];\r\n    private readonly changeListener: () => void;\r\n    private readonly onChange: ((val: ValueType) => void) | undefined;\r\n\r\n    \r\n    // --- public ---\r\n    constructor (p: {\r\n        isFocusable?: boolean; // default false\r\n        optionArr: (TSelectItem<ValueType> | undefined)[];\r\n        initValue?: ValueType; // default ''\r\n        onChange?: (val: ValueType) => void;\r\n        css?: IKeyString;\r\n        title?: string;\r\n    }) {\r\n        this.selectEl = BB.el({\r\n            tagName: 'select',\r\n            title: p.title,\r\n            className: 'kl-select',\r\n            css: {\r\n                cursor: 'pointer',\r\n                fontSize: '15px',\r\n                padding: '3px',\r\n            },\r\n        });\r\n        if (p.css) {\r\n            BB.css(this.selectEl, p.css);\r\n        }\r\n\r\n        const isFocusable = p.isFocusable;\r\n        if (!isFocusable) {\r\n            this.selectEl.tabIndex = -1;\r\n        }\r\n        this.setOptionArr(p.optionArr);\r\n        if (p.onChange) {\r\n            this.onChange = p.onChange;\r\n        }\r\n        this.changeListener = () => {\r\n            if (!isFocusable) {\r\n                this.selectEl.blur();\r\n            }\r\n            this.onChange && this.onChange(this.getValue());\r\n        };\r\n        this.selectEl.addEventListener('change', this.changeListener);\r\n        this.selectEl.value = p.initValue !== undefined ? p.initValue : '';\r\n    }\r\n\r\n    setValue (val: ValueType | undefined): void {\r\n        this.selectEl.value = val === undefined ? '' : val;\r\n    }\r\n\r\n    getValue (): ValueType {\r\n        return this.selectEl.value as ValueType;\r\n    }\r\n\r\n    setDeltaValue (delta: number): void {\r\n        let index = 0;\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            const option = this.optionArr[i];\r\n            if (option.item && '' + option.item[0] === this.selectEl.value) {\r\n                index = i;\r\n                break;\r\n            }\r\n        }\r\n        index = Math.max(0, Math.min(this.optionArr.length -1, index + delta));\r\n        const option = this.optionArr[index];\r\n        this.selectEl.value = option.item ? option.item[0] : '';\r\n        this.onChange && this.onChange(this.getValue());\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.selectEl;\r\n    }\r\n\r\n    updateLabel (id: ValueType, label: string): void {\r\n        this.optionArr.forEach(option => {\r\n            if (option.item && option.item[0] === id && option.el) {\r\n                option.item[1] = label;\r\n                option.el.textContent = option.item[1];\r\n            }\r\n        });\r\n    }\r\n\r\n    setOptionArr (optionArr: (TSelectItem<ValueType> | undefined)[]): void {\r\n        this.optionArr = [];\r\n        this.selectEl.innerHTML = '';\r\n        for (let i = 0; i < optionArr.length; i++) {\r\n            const item = optionArr[i];\r\n            if (!item) {\r\n                this.optionArr.push({\r\n                    item,\r\n                });\r\n                continue;\r\n            }\r\n            const el = document.createElement('option');\r\n            el.value = item[0];\r\n            el.textContent = item[1];\r\n            if (item[2]) {\r\n                BB.css(el, item[2].css);\r\n            }\r\n            this.optionArr.push({\r\n                item,\r\n                el,\r\n            });\r\n            this.selectEl.append(el);\r\n        }\r\n    }\r\n\r\n    destroy (): void {\r\n        this.selectEl.removeEventListener('change', this.changeListener);\r\n    }\r\n    \r\n}\r\n","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Toggle button with an image\r\n */\r\nexport class ImageToggle {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private isActive: boolean;\r\n\r\n    private update (): void {\r\n        this.rootEl.classList.toggle('image-toggle-active', this.isActive);\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            initValue: boolean;\r\n            title: string;\r\n            isRadio?: boolean; // if true, can't click when active\r\n            onChange: (b: boolean) => void;\r\n            image: string;\r\n            darkInvert?: boolean;\r\n        }\r\n    ) {\r\n        this.isActive = !!p.initValue;\r\n        this.rootEl = BB.el({\r\n            className: 'image-toggle',\r\n            title: p.title,\r\n            content: BB.el({\r\n                className: 'image-toggle__im' + (p.darkInvert ? ' dark-invert' : ''),\r\n                css: {\r\n                    backgroundImage: \"url('\" + p.image + \"')\",\r\n                },\r\n            }),\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                if (p.isRadio && this.isActive) {\r\n                    return;\r\n                }\r\n                this.isActive = !this.isActive;\r\n                this.update();\r\n                p.onChange(this.isActive);\r\n            },\r\n        });\r\n\r\n\r\n        this.update();\r\n    }\r\n\r\n    // --- interface ---\r\n    setValue (b: boolean): void {\r\n        this.isActive = !!b;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.isActive;\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.rootEl);\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {ImageToggle} from './image-toggle';\r\n\r\ntype TOptionItem<IdType> = {\r\n    id: IdType;\r\n    title: string;\r\n    image: string;\r\n    darkInvert?: boolean;\r\n};\r\n\r\n/**\r\n * Radio input group. each one has an image\r\n */\r\nexport class ImageRadioList<IdType> {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private activeIndex: number;\r\n    private readonly optionArr: {\r\n        id: IdType;\r\n        radioEl: ImageToggle;\r\n    }[];\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            optionArr: TOptionItem<IdType>[];\r\n            initId: string;\r\n            onChange: (id: IdType) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'image-radio-wrapper',\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        this.optionArr = [];\r\n\r\n        const select = (index: number, id: IdType): void => {\r\n            this.activeIndex = index;\r\n            for (let i = 0; i < this.optionArr.length; i++) {\r\n                this.optionArr[i].radioEl.setValue(i === this.activeIndex);\r\n            }\r\n            p.onChange(id);\r\n        };\r\n\r\n        let initialIndex;\r\n        const createOption = (index: number, o: TOptionItem<IdType>): {\r\n            id: IdType;\r\n            radioEl: ImageToggle;\r\n        } => {\r\n            if (o.id === p.initId) {\r\n                initialIndex = index;\r\n            }\r\n            const radioEl = new ImageToggle({\r\n                image: o.image,\r\n                title: o.title,\r\n                initValue: o.id === p.initId,\r\n                isRadio: true,\r\n                onChange: () => {\r\n                    select(index, o.id);\r\n                },\r\n                darkInvert: o.darkInvert,\r\n            });\r\n            this.rootEl.append(radioEl.getElement());\r\n\r\n            return {\r\n                id: o.id,\r\n                radioEl,\r\n            };\r\n        };\r\n\r\n        for (let i = 0; i < p.optionArr.length; i++) {\r\n            this.optionArr.push(createOption(i, p.optionArr[i]));\r\n        }\r\n\r\n        if (initialIndex === undefined) {\r\n            throw new Error('initId not in optionArr');\r\n        }\r\n        this.activeIndex = initialIndex;\r\n    }\r\n\r\n    // --- interface ---\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValue (): IdType {\r\n        return this.optionArr[this.activeIndex].id;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.optionArr.forEach(item => {\r\n            item.radioEl.destroy();\r\n        });\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\nimport iconImg from '/src/app/img/ui/brush-pressure.svg';\r\nimport {BoxToggle} from './box-toggle';\r\n\r\n/**\r\n * small toggle button with a pen icon - representing toggling pressure sensitivity\r\n * @param isChecked initial value\r\n * @param changeCallback called on change\r\n */\r\nexport const createPenPressureToggle = function (\r\n    isChecked: boolean,\r\n    changeCallback: (b: boolean) => void,\r\n): HTMLElement {\r\n\r\n    const toggleEl = new BoxToggle({\r\n        label: BB.el({\r\n            className: 'dark-invert',\r\n            css: {\r\n                width: '17px',\r\n                height: '17px',\r\n                backgroundImage: 'url(\"' + iconImg + '\")',\r\n                backgroundSize: 'contain',\r\n                backgroundRepeat: 'no-repeat',\r\n                margin: '1px',\r\n                borderRadius: '3px',\r\n            },\r\n        }),\r\n        title: LANG('brush-toggle-pressure'),\r\n        init: isChecked,\r\n        onChange: (b) => {\r\n            changeCallback(b);\r\n        },\r\n    });\r\n\r\n\r\n    return toggleEl.getElement();\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h8ubb\");","import {BB} from '../../../bb/bb';\r\n\r\nexport class BoxToggle {\r\n    el: HTMLElement;\r\n    value: boolean;\r\n\r\n    update (): void {\r\n        this.el.classList.toggle('kl-box-toggle--active', this.value);\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            label: string | HTMLElement | SVGElement;\r\n            title?: string;\r\n            init?: boolean;\r\n            onChange: (b: boolean) => void;\r\n        }\r\n    ) {\r\n        this.value = !!p.init;\r\n        this.el = BB.el({\r\n            content: p.label,\r\n            title: p.title,\r\n            className: (typeof p.label === 'string') ? 'kl-box-toggle' : 'kl-box-toggle kl-box-toggle--custom-el',\r\n            onClick: () => {\r\n                this.value = !this.value;\r\n                this.update();\r\n                p.onChange(this.value);\r\n            },\r\n            css: {\r\n                cursor: 'pointer',\r\n            },\r\n        });\r\n        if (typeof p.label !== 'string') {\r\n            BB.css(p.label, {\r\n                display: 'block',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n        this.update();\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.value;\r\n    }\r\n\r\n    setValue (b: boolean): void {\r\n        this.value = !!b;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.el);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport {IKlSliderConfig} from '../../kl-types';\r\nimport {languageStrings} from '../../../language/language';\r\nimport {KlSliderManualInput} from './kl-slider-manual-input';\r\nimport {SplineInterpolator} from '../../../bb/math/line';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {IPointerEvent} from '../../../bb/input/event.types';\r\nimport {IChainElement} from '../../../bb/input/event-chain/event-chain.types';\r\n\r\n/**\r\n * Horizontal slider, can be changed by dragging anywhere on it. Has a label & value.\r\n * e.g. used for brush size\r\n *\r\n * left mouse button - set absolute value\r\n * right mouse button - change relative value\r\n * drag mouse vertically away - precision mode\r\n * double-click/tap slider - manual input mode\r\n *\r\n * Values can be spline interpolated\r\n * On change callback can be debounced\r\n *\r\n */\r\nexport class KlSlider {\r\n\r\n    /*\r\n    Three types of values\r\n    - value - the actual value, when using setValue(), getValue(), and what is emitted\r\n    - displayValue - the number that the user sees on the slider and in the manual input field\r\n        - might be further formatted with formatFunc\r\n        - also might be the same as value, if no toDisplayValue function provided\r\n    - sliderValue - the draggable position of the slider, 0 - 1\r\n     */\r\n\r\n    private value: number;\r\n\r\n    private readonly elementWidth: number;\r\n    private readonly elementHeight: number;\r\n    private isEnabled: boolean;\r\n\r\n    private min: number; // min value\r\n    private max: number; // max value\r\n    private useSpline: boolean;\r\n    private splineInterpolator: undefined | SplineInterpolator;\r\n    private readonly resolution: number;\r\n\r\n    private readonly isChangeOnFinal: boolean;\r\n    private readonly formatFunc: undefined | ((val: number) => number | string);\r\n    private readonly unit: string | undefined;\r\n\r\n    private readonly onChange: (val: number) => void;\r\n    private readonly valueToDisplayValue: (value: number) => number;\r\n    private readonly displayValueToValue: (displayValue: number) => number;\r\n\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly sliderWrapperEl: HTMLElement;\r\n    private readonly textEl: HTMLElement; // displays label, displayValue\r\n    private readonly label: string;\r\n    private readonly control: HTMLElement;\r\n    private manualInput: undefined | KlSliderManualInput;\r\n    private readonly manualInputRoundDigits: number | undefined;\r\n\r\n    private pointerListener: PointerListener | undefined;\r\n    private readonly pointerListenerTimeout: ReturnType<typeof setTimeout>;\r\n\r\n    private readonly eventResMs: undefined | number;\r\n    private emitValue: undefined | number; // next value for interval\r\n    private emitInterval: (ReturnType<typeof setTimeout> | undefined); // interval of eventResMs which calls onChange()\r\n\r\n    private valueToSliderValue (value: number): number {\r\n        if (this.useSpline && this.splineInterpolator) {\r\n            return this.splineInterpolator.findX(value, Math.floor(this.resolution)) || 0;\r\n        }\r\n        return (value - this.min) / (this.max - this.min);\r\n    }\r\n\r\n    private sliderValueToValue (sliderValue: number): number {\r\n        let result = this.min + sliderValue * (this.max - this.min);\r\n        if (this.useSpline && this.splineInterpolator) {\r\n            result = this.splineInterpolator.interpolate(sliderValue) || 0;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private updateLabel (): void {\r\n        let displayValue: number | string = this.valueToDisplayValue(this.value);\r\n        displayValue = this.formatFunc ? this.formatFunc(displayValue) : Math.round(displayValue);\r\n        displayValue = displayValue.toLocaleString(languageStrings.getCode());\r\n        const unit = this.unit !== undefined ? this.unit : '';\r\n        this.textEl.innerHTML = this.label + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + displayValue + unit + '</span>';\r\n\r\n        const sliderValue = this.valueToSliderValue(this.value);\r\n        this.control.style.width = (sliderValue * this.elementWidth) + 'px';\r\n    }\r\n\r\n    private emit (isFinal: boolean): void {\r\n        if (!isFinal && this.isChangeOnFinal) {\r\n            return;\r\n        }\r\n\r\n        if (isFinal || !this.eventResMs) {\r\n            this.onChange(this.value);\r\n            if (this.emitInterval) {\r\n                clearInterval(this.emitInterval);\r\n                this.emitInterval = undefined;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (this.emitInterval) {\r\n            this.emitValue = this.value;\r\n\r\n        } else {\r\n            this.onChange(this.value);\r\n\r\n            this.emitInterval = setInterval(() => {\r\n                if (this.emitValue === undefined) {\r\n                    clearInterval(this.emitInterval);\r\n                    this.emitInterval = undefined;\r\n                } else {\r\n                    this.onChange(this.emitValue);\r\n                    this.emitValue = undefined;\r\n                }\r\n            }, this.eventResMs);\r\n        }\r\n    }\r\n\r\n    private updateEnable (): void {\r\n        this.sliderWrapperEl.classList.toggle('slider-wrapper--disabled', !this.isEnabled);\r\n        BB.css(this.sliderWrapperEl, {\r\n            opacity: this.isEnabled ? '' : '0.5',\r\n            pointerEvents: this.isEnabled ? '' : 'none',\r\n        });\r\n        if (this.manualInput) {\r\n            this.manualInput.setIsEnabled(this.isEnabled);\r\n        }\r\n    }\r\n\r\n    private showManualInput (): void {\r\n\r\n        this.manualInput = new KlSliderManualInput(\r\n            this.valueToDisplayValue(this.value),\r\n            this.valueToDisplayValue(this.min),\r\n            this.valueToDisplayValue(this.max),\r\n            this.sliderWrapperEl.getBoundingClientRect(),\r\n            (val) => {\r\n                val = this.displayValueToValue(val);\r\n                this.setValue(BB.clamp(val, this.min, this.max));\r\n                this.onChange(this.value);\r\n            },\r\n            () => {\r\n                BB.css(this.sliderWrapperEl, {\r\n                    display: '',\r\n                });\r\n                if (this.manualInput) {\r\n                    this.manualInput.getElement().remove();\r\n                    this.manualInput.destroy();\r\n                }\r\n                this.manualInput = undefined;\r\n            },\r\n            (this.manualInputRoundDigits && this.manualInputRoundDigits > 0) ? this.manualInputRoundDigits : 0,\r\n        );\r\n        this.manualInput.setIsEnabled(this.isEnabled);\r\n        this.rootEl.append(this.manualInput.getElement());\r\n        setTimeout(() => {\r\n            this.manualInput && this.manualInput.focus();\r\n        });\r\n        BB.css(this.sliderWrapperEl, {\r\n            display: 'none',\r\n        });\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        p: {\r\n            label: string;\r\n            width: number; // px\r\n            height: number; // px\r\n            min: number; // min value\r\n            max: number;\r\n            value: number;\r\n            resolution?: number; // int, if you want spline.findX() to use a custom resolution\r\n            curve?: 'quadratic' | [number, number][]; // optional. array is BB.SplineInterpolator points. 0-1\r\n            formatFunc?: (val: number) => number | string; // function to display a different number than value\r\n            onChange?: (val: number) => void;\r\n            isChangeOnFinal?: boolean; // only fire onChange on pointerUp\r\n            eventResMs?: number; // frequency of change events\r\n            isEnabled?: boolean; // default = true\r\n            manualInputRoundDigits?: number; // default 0, how value should be rounded for manual input\r\n            toDisplayValue?: (value: number) => number;\r\n            toValue?: (displayValue: number) => number;\r\n            unit?: string; // attached to end of value in output\r\n        }\r\n    ) {\r\n        this.isEnabled = p.isEnabled !== false;\r\n        this.manualInputRoundDigits = p.manualInputRoundDigits;\r\n        this.useSpline = !!p.curve;\r\n\r\n        if (!p.label) {\r\n            throw new Error('KlSlider missing params');\r\n        }\r\n        if (p.min != 0 && p.max != 0 && p.value != 0) {\r\n            if (!p.min || !p.max || !p.value) {\r\n                throw new Error('KlSlider broken params');\r\n            }\r\n        }\r\n        if (p.min >= p.max) {\r\n            throw new Error('KlSlider broken params');\r\n        }\r\n\r\n        this.min = p.min;\r\n        this.max = p.max;\r\n        this.value = BB.clamp(p.value, this.min, this.max);\r\n        this.elementWidth = p.width;\r\n        this.elementHeight = p.height;\r\n        this.resolution = p.resolution ? p.resolution : this.elementWidth * 2;\r\n\r\n        this.onChange = p.onChange ? p.onChange : () => {};\r\n        if (!p.toValue !== !p.toDisplayValue) {\r\n            throw new Error('both or neither have to be set, toValue and toDisplayValue');\r\n        }\r\n        this.displayValueToValue = p.toValue ? p.toValue : (displayValue) => displayValue;\r\n        this.valueToDisplayValue = p.toDisplayValue ? p.toDisplayValue : (value) => value;\r\n        this.isChangeOnFinal = !!p.isChangeOnFinal;\r\n        this.formatFunc = p.formatFunc;\r\n        this.eventResMs = p.eventResMs;\r\n        this.unit = p.unit;\r\n\r\n        if (this.useSpline) {\r\n            if (!p.curve) {\r\n                throw new Error('curve needs to be set if useSpline true');\r\n            }\r\n            const curveArr: [number, number][] = p.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : p.curve;\r\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        }\r\n\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n        this.sliderWrapperEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'slider-wrapper',\r\n            css: {\r\n                overflow: 'hidden',\r\n                position: 'relative',\r\n                width: this.elementWidth + 'px',\r\n                height: this.elementHeight + 'px',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        this.label = p.label;\r\n        const labelFontSize = this.elementHeight - 14;\r\n        this.textEl = BB.el({\r\n            content: this.label,\r\n            css: {\r\n                position: 'absolute',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginLeft: '7px',\r\n                height: '100%',\r\n                fontSize: labelFontSize + 'px',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        this.control = BB.el({\r\n            className: 'slider-inner',\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                width: (this.valueToSliderValue(this.value) * this.elementWidth) + 'px',\r\n                height: this.elementHeight + 'px',\r\n            },\r\n        });\r\n        const controlInner = document.createElement('div');\r\n\r\n        this.sliderWrapperEl.append(this.control, this.textEl);\r\n        this.control.append(controlInner);\r\n\r\n        this.updateEnable();\r\n\r\n\r\n        const doubleTapper = new BB.DoubleTapper({\r\n            onDoubleTap: () => {\r\n                this.showManualInput();\r\n            },\r\n        });\r\n        doubleTapper.setAllowedButtonArr(['left', 'right']);\r\n        const eventChain = new BB.EventChain({\r\n            chainArr: [\r\n                doubleTapper as IChainElement,\r\n            ],\r\n        });\r\n\r\n        let virtualVal: number;\r\n        const onPointer = (event: IPointerEvent) => {\r\n            event.eventPreventDefault();\r\n\r\n            if (!this.isEnabled) {\r\n                return;\r\n            }\r\n\r\n            if (event.type === 'pointerdown') {\r\n\r\n                // unfocus manual slider input\r\n                BB.unfocusAnyInput();\r\n\r\n                this.sliderWrapperEl.className = 'slider-wrapper slider-wrapper--active';\r\n\r\n                if (event.button === 'left') {\r\n                    let sliderValue = event.relX / this.elementWidth;\r\n                    sliderValue = Math.max(0, Math.min(1, sliderValue));\r\n                    this.value = this.sliderValueToValue(sliderValue);\r\n                    this.updateLabel();\r\n                    this.emit(false);\r\n                }\r\n                virtualVal = this.valueToSliderValue(this.value);\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button || '')) {\r\n\r\n                let deltaX = event.dX;\r\n                const deltaY = Math.abs(event.pageY - (event.downPageY || 0));\r\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n                deltaX *= factor;\r\n                deltaX /= this.elementWidth;\r\n\r\n                virtualVal += deltaX;\r\n\r\n                const sliderValue = Math.max(0, Math.min(1, virtualVal));\r\n                this.value = this.sliderValueToValue(sliderValue);\r\n                this.updateLabel();\r\n                this.emit(false);\r\n            }\r\n\r\n            if (event.type === 'pointerup') {\r\n                this.sliderWrapperEl.className = 'slider-wrapper';\r\n                this.emit(true);\r\n            }\r\n\r\n        };\r\n\r\n        this.pointerListenerTimeout = setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.sliderWrapperEl,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    onPointer(e);\r\n                    eventChain.chainIn(e);\r\n                },\r\n                onWheel: (event) => {\r\n                    let sliderValue = this.valueToSliderValue(this.value);\r\n                    sliderValue = BB.clamp(sliderValue - event.deltaY / 40, 0, 1);\r\n                    this.value = this.sliderValueToValue(sliderValue);\r\n                    this.updateLabel();\r\n                    this.onChange(this.value);\r\n                },\r\n            });\r\n            this.updateLabel();\r\n        }, 1);\r\n    }\r\n\r\n    changeSliderValue (f: number): void {\r\n        if (!this.isEnabled) {\r\n            return;\r\n        }\r\n        let sliderValue = this.valueToSliderValue(this.value);\r\n        sliderValue = BB.clamp(sliderValue + f, 0, 1);\r\n        this.value = this.sliderValueToValue(sliderValue);\r\n        this.updateLabel();\r\n        this.onChange(this.value);\r\n    }\r\n\r\n    setValue (v: number): void {\r\n        this.value = BB.clamp(v, this.min, this.max);\r\n        this.updateLabel();\r\n    }\r\n\r\n    getValue (): number {\r\n        return this.value;\r\n    }\r\n\r\n    update (config: IKlSliderConfig): void {\r\n        this.min = config.min;\r\n        this.max = config.max;\r\n        this.useSpline = !!config.curve;\r\n        if (this.useSpline) {\r\n            if (!config.curve) {\r\n                throw new Error('curve needs to be set if useSpline true');\r\n            }\r\n            const curveArr = config.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : config.curve;\r\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        } else {\r\n            this.splineInterpolator = undefined;\r\n        }\r\n        this.setIsEnabled(!config.isDisabled);\r\n    }\r\n\r\n    setIsEnabled (e: boolean): void {\r\n        this.isEnabled = !!e;\r\n        this.updateEnable();\r\n    }\r\n\r\n    destroy (): void {\r\n        clearTimeout(this.pointerListenerTimeout);\r\n        this.pointerListener && this.pointerListener.destroy();\r\n        if (this.manualInput) {\r\n            this.manualInput.destroy();\r\n        }\r\n        if (this.emitInterval) {\r\n            clearInterval(this.emitInterval);\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n}\r\n","/**\r\n * To make sliders more fine-grained. The falloff when moving cursor away from cursor.\r\n * Returns the factor [0,1]\r\n *  0 -> infinite movement required for change of 1\r\n *  1 -> 1px movement for change of 1\r\n *\r\n * @param deltaY vertical distance from pointerdown\r\n * @param isRightButton\r\n */\r\nexport function calcSliderFalloffFactor (deltaY: number, isRightButton: boolean): number {\r\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\r\n    if (isRightButton) {\r\n        result *= 2;\r\n    }\r\n    return 1 / result;\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {input} from './input';\r\n\r\n/**\r\n * Used by KlSlider. Allows user to type in value in input (type=number) field, instead of dragging with mouse.\r\n * Input goes away when losing focus, or when pressing Enter/Escape.\r\n */\r\nexport class KlSliderManualInput {\r\n\r\n    private readonly input: HTMLInputElement;\r\n    private isEnabled: boolean = true;\r\n    private scrollBefore: { x: number; y: number } | undefined; // window scroll position on creation\r\n    private lastValue: number; // last emitted value\r\n    private isClosed: boolean = false;\r\n\r\n    private emit (): void {\r\n        if (this.lastValue !== Number(this.input.value)) {\r\n            this.onChange(Number(this.input.value));\r\n            this.lastValue = Number(this.input.value);\r\n        }\r\n    }\r\n\r\n    private privateOnClose (): void {\r\n        if (this.isClosed) {\r\n            return;\r\n        }\r\n        this.isClosed = true;\r\n\r\n        this.emit();\r\n        this.onClose();\r\n        setTimeout(() => {\r\n            // because iPad keyboard changes the scroll position\r\n            this.scrollBefore && window.scrollTo(this.scrollBefore.x, this.scrollBefore.y);\r\n            this.scrollBefore = undefined;\r\n        });\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        value: number, // initial value (displayValue)\r\n        min: number,\r\n        max: number,\r\n        rect: DOMRect, // size of input field\r\n        private onChange: (displayValue: number) => void,\r\n        private onClose: () => void,\r\n        roundDigits?: number,\r\n    ) {\r\n\r\n        this.input = input({\r\n            type: 'number',\r\n            init: value,\r\n            min,\r\n            max,\r\n            callback: (val) => {\r\n                this.emit();\r\n            },\r\n        });\r\n        if (roundDigits !== 0) {\r\n            this.input.setAttribute('step', 'any');\r\n        }\r\n        this.input.onblur = () => {\r\n            this.privateOnClose();\r\n        };\r\n        this.input.addEventListener('keyup', (e) => {\r\n            if (['Enter', 'Escape'].includes(e.key)) {\r\n                this.privateOnClose();\r\n            } else {\r\n                this.emit();\r\n            }\r\n        });\r\n        this.input.addEventListener('wheel', () => this.emit());\r\n\r\n        this.scrollBefore = {\r\n            x: window.scrollX,\r\n            y: window.scrollY,\r\n        };\r\n\r\n        let currentValue;\r\n        if (roundDigits || roundDigits === 0) {\r\n            currentValue = BB.round(value, roundDigits);\r\n        } else {\r\n            currentValue = value;\r\n        }\r\n        this.lastValue = currentValue;\r\n        this.input.value = '' + currentValue;\r\n\r\n        BB.css(this.input, {\r\n            width: rect.width + 'px',\r\n            height: rect.height + 'px',\r\n        });\r\n    }\r\n\r\n    getElement () {\r\n        return this.input;\r\n    }\r\n\r\n    setIsEnabled (b: boolean): void {\r\n        this.isEnabled = !!b;\r\n    }\r\n\r\n    focus (): void {\r\n        this.input.focus();\r\n        this.input.select();\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.input);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {input} from '../components/input';\r\nimport {showModal} from './base/showModal';\r\nimport {LANG} from '../../../language/language';\r\nimport copyImg from '/src/app/img/ui/copy.svg';\r\nimport {IRGB} from '../../kl-types';\r\nimport {RGB} from '../../../bb/color/color';\r\n\r\n\r\ntype TInputRow = {\r\n    update: () => void;\r\n    destroy: () => void;\r\n};\r\n\r\n/**\r\n * dialog for manually inputting the color\r\n */\r\nexport class HexColorDialog {\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            color: IRGB;\r\n            onClose: (rgb: IRGB | undefined) => void;\r\n        }\r\n    ) {\r\n        let lastValidRgb: RGB = new BB.RGB(p.color.r, p.color.g, p.color.b);\r\n\r\n        const div = BB.el();\r\n\r\n        const previewEl = BB.el({\r\n            css: {\r\n                width: '20px',\r\n                height: '20px',\r\n                marginBottom: '10px',\r\n                boxShadow: 'inset 0 0 0 1px #fff, 0 0 0 1px #000',\r\n                background: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n            },\r\n        });\r\n        div.append(previewEl);\r\n\r\n\r\n        // --- Hex ---\r\n        const hexRowEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginBottom: '15px',\r\n            },\r\n        });\r\n        const hexLabel = BB.el({\r\n            content: LANG('mci-hex'),\r\n            css: {\r\n                width: '60px',\r\n            },\r\n        });\r\n        const hexInput = input({\r\n            init: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n            css: {\r\n                width: '80px',\r\n            },\r\n            callback: function () {\r\n                let rgbObj = BB.ColorConverter.hexToRGB(hexInput.value);\r\n                if (!rgbObj) {\r\n                    rgbObj = lastValidRgb;\r\n                    hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                } else {\r\n                    lastValidRgb = rgbObj;\r\n                }\r\n                previewEl.style.background = '#' + BB.ColorConverter.toHexString(rgbObj);\r\n\r\n                for (let i = 0; i < rgbArr.length; i++) {\r\n                    rgbArr[i].update();\r\n                }\r\n            },\r\n        });\r\n        const copyButton = BB.el({\r\n            tagName: 'button',\r\n            content: '<img src=\"' + copyImg + '\" height=\"20\" alt=\"\"/>',\r\n            title: LANG('mci-copy'),\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: function () {\r\n                hexInput.select();\r\n                document.execCommand('copy');\r\n            },\r\n        });\r\n        hexRowEl.append(hexLabel, hexInput, copyButton);\r\n        div.append(hexRowEl);\r\n        setTimeout(function () {\r\n            hexInput.focus();\r\n            hexInput.select();\r\n        }, 0);\r\n\r\n\r\n        // --- R G B ---\r\n        function createRgbInputRow (labelStr: string, attributeStr: 'r' | 'g' | 'b'): TInputRow {\r\n\r\n            const rowEl = BB.el({\r\n                css: {\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    marginTop: '5px',\r\n                },\r\n            });\r\n            const labelEl = BB.el({\r\n                content: labelStr,\r\n                css: {\r\n                    width: '60px',\r\n                },\r\n            });\r\n\r\n            const inputEl = input({\r\n                init: lastValidRgb[attributeStr],\r\n                min: 0,\r\n                max: 255,\r\n                type: 'number',\r\n                css: {\r\n                    width: '80px',\r\n                },\r\n                callback: function () {\r\n                    if (inputEl.value === '' || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\r\n                        result.update();\r\n                        return;\r\n                    }\r\n                    inputEl.value = '' + Math.round(parseFloat(inputEl.value));\r\n                    lastValidRgb[attributeStr] = Number(inputEl.value);\r\n                    previewEl.style.background = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                    hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                },\r\n            });\r\n\r\n            rowEl.append(labelEl, inputEl);\r\n            div.append(rowEl);\r\n\r\n            const result = {\r\n                update: (): void => {\r\n                    inputEl.value = '' + lastValidRgb[attributeStr];\r\n                },\r\n                destroy: (): void => {\r\n                    BB.unsetEventHandler(inputEl, 'onchange');\r\n                },\r\n            };\r\n            return result;\r\n        }\r\n        const rgbArr: TInputRow[] = [];\r\n        rgbArr.push(createRgbInputRow(LANG('red'), 'r'));\r\n        rgbArr.push(createRgbInputRow(LANG('green'), 'g'));\r\n        rgbArr.push(createRgbInputRow(LANG('blue'), 'b'));\r\n\r\n\r\n        showModal({\r\n            target: document.body,\r\n            message: `<b>${LANG('manual-color-input')}</b>`,\r\n            div: div,\r\n            autoFocus: false,\r\n            clickOnEnter: 'Ok',\r\n            buttons: ['Ok', 'Cancel'],\r\n            callback: function (resultStr) {\r\n                BB.destroyEl(copyButton);\r\n                rgbArr.forEach(item => item.destroy());\r\n                rgbArr.splice(0, rgbArr.length);\r\n\r\n                p.onClose(resultStr === 'Ok' ? BB.ColorConverter.hexToRGB(hexInput.value) : undefined);\r\n            },\r\n        });\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"htADd\");","import {BB} from '../../../bb/bb';\r\nimport {HexColorDialog} from '../modals/color-slider-hex-dialog';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport eyedropperImg from '/src/app/img/ui/tool-picker.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {IRGB} from '../../kl-types';\r\nimport {HSV, RGB} from '../../../bb/color/color';\r\nimport {ERASE_COLOR} from '../../brushes/erase-color';\r\n\r\n/**\r\n * big main HS+V color slider\r\n * 2 elements: slider, and colorpreview(output) + eyedropper\r\n */\r\nexport class KlColorSlider {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly outputDiv: HTMLElement;\r\n    private readonly divPreview: HTMLElement;\r\n    private readonly hexButton: HTMLElement;\r\n    private readonly secondaryColorBtn: HTMLElement;\r\n    private primaryColorRGB: RGB;\r\n    private primaryColorHSV: HSV;\r\n    private secondaryColorRGB: RGB;\r\n    private secondaryColorHSV: HSV;\r\n    private readonly controlH: HTMLElement;\r\n    private pickCallback: undefined | ((b: boolean) => void);\r\n    private isPicking: boolean;\r\n    private readonly pickerButton: HTMLElement;\r\n    private readonly width: number;\r\n    private readonly height: number; // hue slider and output height\r\n    private readonly hueStop: Element;\r\n\r\n    private readonly SVContainer: HTMLElement;\r\n    private readonly pointerSV: HTMLElement;\r\n    private svHeight: number;\r\n    private readonly svSvg: HTMLElement;\r\n\r\n    private readonly emitColor: (rgb: RGB) => void;\r\n\r\n\r\n\r\n    private updatePrimaryHSV (hsv: HSV): void {\r\n        if (hsv.s === 0) {\r\n            this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, hsv.s, hsv.v);\r\n        } else {\r\n            this.primaryColorHSV = new BB.HSV(hsv.h, hsv.s, hsv.v);\r\n        }\r\n    }\r\n\r\n    private updateSVCanvas (): void {\r\n        const rgb = BB.ColorConverter.toRGB(new BB.HSV(this.primaryColorHSV.h, 100, 100));\r\n        BB.setAttributes(this.hueStop, {\r\n            'stop-color': '#' + BB.ColorConverter.toHexString(rgb),\r\n        });\r\n    }\r\n\r\n    private updateSVPointer (): void {\r\n        const left = this.primaryColorHSV.s / 100 * this.width - 7;\r\n        const top = (1 - this.primaryColorHSV.v / 100) * this.svHeight - 6;\r\n        BB.css(this.pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px',\r\n        });\r\n    }\r\n\r\n    private setColPreview (): void {\r\n        this.divPreview.style.backgroundColor = 'rgb(' + this.primaryColorRGB.r + ',' + this.primaryColorRGB.g + ',' + this.primaryColorRGB.b + ')';\r\n\r\n        if (BB.testIsWhiteBestContrast(this.primaryColorRGB)) {\r\n            BB.css(this.pickerButton, {\r\n                filter: 'invert(1)',\r\n            });\r\n            BB.css(this.hexButton, {\r\n                filter: 'invert(1)',\r\n            });\r\n        } else{\r\n            BB.css(this.pickerButton, {\r\n                filter: '',\r\n            });\r\n            BB.css(this.hexButton, {\r\n                filter: '',\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    private updateSecondaryColor (): void {\r\n        this.secondaryColorBtn.style.backgroundColor = BB.ColorConverter.toRgbStr(this.secondaryColorRGB);\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number; // hue slider and output height\r\n            svHeight: number;\r\n            startValue: IRGB; // 0-255\r\n            onPick: (rgb: IRGB) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-color-picker',\r\n            css: {\r\n                position: 'relative',\r\n            },\r\n        });\r\n        this.outputDiv = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        this.width = p.width;\r\n        this.svHeight = p.svHeight;\r\n        this.height = p.height;\r\n        this.emitColor = p.onPick;\r\n\r\n        this.primaryColorRGB = {\r\n            r: parseInt('' + p.startValue.r),\r\n            g: parseInt('' + p.startValue.g),\r\n            b: parseInt('' + p.startValue.b),\r\n        };\r\n        this.primaryColorHSV = BB.ColorConverter.toHSV(p.startValue); // BB.HSV\r\n        this.secondaryColorRGB = {r: ERASE_COLOR, g: ERASE_COLOR, b: ERASE_COLOR};\r\n        this.secondaryColorHSV = BB.ColorConverter._RGBtoHSV(this.secondaryColorRGB); // BB.HSV\r\n\r\n        const svWrapper = BB.el();\r\n        this.svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"><defs><linearGradient id=\"value\" gradientTransform=\"rotate(90)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop offset=\"100%\" stop-color=\"#000\"/></linearGradient><linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/></linearGradient></defs><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\" style=\"mix-blend-mode: multiply\"/></svg>', 'image/svg+xml').documentElement;\r\n        {\r\n            const hueStop = this.svSvg.querySelector('#hue-stop');\r\n            if (!hueStop) {\r\n                throw Error('#hue-stop not found in svSvg');\r\n            }\r\n            this.hueStop = hueStop;\r\n        }\r\n        BB.setAttributes(this.hueStop, {\r\n            'stop-color': '#f0f',\r\n        });\r\n        BB.css(this.svSvg, {\r\n            width: this.width + 'px',\r\n            height: this.svHeight + 'px',\r\n        });\r\n        svWrapper.append(this.svSvg);\r\n\r\n        const divH = BB.el({\r\n            className: 'kl-color-picker__h',\r\n            css: {\r\n                overflow: 'hidden',\r\n                position: 'relative',\r\n                width: this.width + 'px',\r\n                height: this.height + 'px',\r\n                cursor: 'ew-resize',\r\n                marginTop: '1px',\r\n                marginBottom: '1px',\r\n            },\r\n        });\r\n        this.divPreview = BB.el({\r\n            className: 'kl-color-picker__preview',\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                width: (this.height * 2.5) + 'px',\r\n                height: this.height + 'px',\r\n            },\r\n        });\r\n        this.controlH = BB.el();\r\n\r\n\r\n\r\n        const createHueBg = (targetEl: HTMLElement) => {\r\n            const im = new Image();\r\n            BB.css(im, {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                display: 'none',\r\n                pointerEvents: 'none',\r\n            });\r\n            const cv = BB.canvas(this.width, this.height);\r\n            const ctx = BB.ctx(cv);\r\n            const gradH = ctx.createLinearGradient(0, 0, this.width, 0);\r\n            for (let i = 0; i < 1; i += 0.01) {\r\n                const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n                let ha = (parseInt('' + col.r)).toString(16);\r\n                let hb = (parseInt('' + col.g)).toString(16);\r\n                let hc = (parseInt('' + col.b)).toString(16);\r\n                if (ha.length === 1) {\r\n                    ha = '0' + ha;\r\n                }\r\n                if (hb.length === 1) {\r\n                    hb = '0' + hb;\r\n                }\r\n                if (hc.length === 1) {\r\n                    hc = '0' + hc;\r\n                }\r\n                gradH.addColorStop(i, '#' + ha + hb + hc);\r\n            }\r\n            ctx.fillStyle = gradH;\r\n            ctx.fillRect(0, 0, this.width, this.height);\r\n\r\n            targetEl.append(im);\r\n            im.alt = 'hue';\r\n            im.src = cv.toDataURL('image/png');\r\n            im.style.display = 'block';\r\n        };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        this.updateSVCanvas();\r\n        this.rootEl.style.width = this.width + 'px';\r\n        this.rootEl.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n\r\n        this.SVContainer = BB.el({\r\n            className: 'kl-color-picker__sv',\r\n            css: {\r\n                width: this.width + 'px',\r\n                height: this.svHeight + 'px',\r\n                overflow: 'hidden',\r\n                display: 'block',\r\n                position: 'relative',\r\n                cursor: 'crosshair',\r\n            },\r\n        });\r\n\r\n        this.pointerSV = BB.el({\r\n           css: {\r\n               width: '12px',\r\n               height: '12px',\r\n               borderRadius: '6px',\r\n               position: 'absolute',\r\n               pointerEvents: 'none',\r\n               boxShadow: '0px 0px 0 1px #000, inset 0px 0px 0 1px #fff',\r\n           },\r\n        });\r\n\r\n        this.SVContainer.append(svWrapper, this.pointerSV);\r\n        this.updateSVPointer();\r\n        this.rootEl.append(this.SVContainer, divH);\r\n        this.outputDiv.append(this.divPreview);\r\n\r\n        //divH.className = \"svSlider\";\r\n        BB.css(this.controlH, {\r\n            width: '1px',\r\n            height: this.height + 'px',\r\n            background: '#000',\r\n            borderLeft: '1px solid #fff',\r\n            position: 'absolute',\r\n            top: '0',\r\n            left: parseInt('' + (this.primaryColorHSV.h / 360 * this.width - 1)) + 'px',\r\n        });\r\n\r\n\r\n        const virtualHSV = {\r\n            h: 0,\r\n            s: 0,\r\n            v: 0,\r\n        };\r\n\r\n\r\n        this.pickerButton = BB.el({\r\n            title: LANG('eyedropper') + ' [Alt]',\r\n            className: 'color-picker-preview-button',\r\n            css: {\r\n                width: '30px',\r\n                height: '30px',\r\n                backgroundImage: 'url(' + eyedropperImg + ')',\r\n                backgroundRepeat:  'no-repeat',\r\n                backgroundSize: '70%',\r\n                backgroundPosition: 'center',\r\n            },\r\n            onClick: () => {\r\n                if (this.isPicking) {\r\n                    this.pickCallback && this.pickCallback(false);\r\n                    this.pickingDone();\r\n                } else {\r\n                    this.pickerButton.classList.remove('color-picker-preview-button-hover');\r\n                    this.pickerButton.classList.add('color-picker-preview-button-active');\r\n                    this.isPicking = true;\r\n                    this.pickCallback && this.pickCallback(true);\r\n                }\r\n            },\r\n        });\r\n        this.isPicking = false;\r\n\r\n        const pickerButtonPointerListener = new BB.PointerListener({\r\n            target: this.pickerButton,\r\n            onEnterLeave: (isOver) => {\r\n                if (this.isPicking) {\r\n                    return;\r\n                }\r\n                this.pickerButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n            },\r\n        });\r\n        this.divPreview.append(this.pickerButton);\r\n\r\n\r\n        this.hexButton = BB.el({\r\n            content: '#',\r\n            className: 'color-picker-preview-button',\r\n            title: LANG('manual-color-input'),\r\n            css: {\r\n                height: '100%',\r\n                width: this.height + 'px',\r\n                lineHeight: this.height + 'px',\r\n                fontSize: (this.height * 0.65) + 'px',\r\n            },\r\n            onClick: () => {\r\n                new HexColorDialog({\r\n                    color: new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b),\r\n                    onClose: (rgbObj) => {\r\n                        if (!rgbObj) {\r\n                            return;\r\n                        }\r\n                        this.setColor(rgbObj);\r\n                        this.emitColor(new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b));\r\n                    },\r\n                });\r\n            },\r\n        });\r\n        const hexButtonPointerListener = new BB.PointerListener({\r\n            target: this.hexButton,\r\n            onEnterLeave: (isOver) => {\r\n                this.hexButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n            },\r\n        });\r\n        this.divPreview.append(this.hexButton);\r\n\r\n        this.setColPreview();\r\n\r\n\r\n        setTimeout(() => {\r\n            createHueBg(divH);\r\n            divH.append(this.controlH);\r\n            const svPointerListener = new BB.PointerListener({\r\n                target: svWrapper,\r\n                fixScribble: true,\r\n                onPointer: (event) => {\r\n                    if (event.type === 'pointerdown') {\r\n\r\n                        // prevent manual slider input keeping focus on iPad\r\n                        BB.unfocusAnyInput();\r\n\r\n                        this.SVContainer.classList.toggle('kl-color-picker--active', true);\r\n\r\n                        if (event.button === 'left') {\r\n\r\n                            virtualHSV.s = event.relX / this.width * 100;\r\n                            virtualHSV.v = 100 - event.relY / this.svHeight * 100;\r\n\r\n                            this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                            this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n\r\n                            this.updateSVPointer();\r\n                            this.setColPreview();\r\n                            this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n                        } else {\r\n                            virtualHSV.s = this.primaryColorHSV.s;\r\n                            virtualHSV.v = this.primaryColorHSV.v;\r\n                        }\r\n                    }\r\n\r\n                    if (event.type === 'pointermove' && ['left', 'right'].includes(event.button || '')) {\r\n\r\n                        let factor = 1;\r\n                        if (event.button === 'right') {\r\n                            factor = 0.5;\r\n                        }\r\n\r\n                        virtualHSV.s += event.dX / this.width * 100 * factor;\r\n                        virtualHSV.v -= event.dY / this.svHeight * 100 * factor;\r\n\r\n                        this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                        this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n                        this.updateSVPointer();\r\n                        this.setColPreview();\r\n                        this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n\r\n                    }\r\n\r\n                    if (event.type === 'pointerup') {\r\n                        this.SVContainer.classList.toggle('kl-color-picker--active', false);\r\n                    }\r\n\r\n                },\r\n            });\r\n            const hPointerListener = new BB.PointerListener({\r\n                target: divH,\r\n                fixScribble: true,\r\n                onPointer: (event) => {\r\n\r\n                    if (event.type === 'pointerdown') {\r\n\r\n                        // prevent manual slider input keeping focus on iPad\r\n                        BB.unfocusAnyInput();\r\n\r\n                        divH.classList.toggle('kl-color-picker--active', true);\r\n\r\n                        if (event.button === 'left') {\r\n\r\n                            virtualHSV.h = event.relX / this.width * 359.99;\r\n\r\n                            this.primaryColorHSV = new BB.HSV(virtualHSV.h, this.primaryColorHSV.s, this.primaryColorHSV.v);\r\n                            this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n                            this.controlH.style.left = (Math.round(this.primaryColorHSV.h / 359.99 * this.width) - 1) + 'px';\r\n                            this.updateSVCanvas();\r\n                            this.setColPreview();\r\n                            this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n                        } else {\r\n                            virtualHSV.h = this.primaryColorHSV.h;\r\n                        }\r\n                    }\r\n\r\n                    if (event.type === 'pointermove' && ['left', 'right'].includes(event.button || '')) {\r\n\r\n                        const deltaY = Math.abs(event.pageY - event.downPageY!);\r\n                        const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                        virtualHSV.h += event.dX / this.width * 359.99 * factor;\r\n\r\n                        if (event.button === 'right') {\r\n                            virtualHSV.h = virtualHSV.h % 359.99;\r\n                            if (virtualHSV.h < 0) {\r\n                                virtualHSV.h += 359.99;\r\n                            }\r\n                        }\r\n                        virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                        this.primaryColorHSV = new BB.HSV(virtualHSV.h, this.primaryColorHSV.s, this.primaryColorHSV.v);\r\n                        this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n                        this.controlH.style.left = (Math.round(this.primaryColorHSV.h / 359.99 * this.width) - 1) + 'px';\r\n                        this.updateSVCanvas();\r\n                        this.setColPreview();\r\n                        this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n\r\n                    }\r\n\r\n                    if (event.type === 'pointerup') {\r\n                        divH.classList.toggle('kl-color-picker--active', false);\r\n                    }\r\n                },\r\n            });\r\n        }, 1);\r\n\r\n\r\n        // --- secondary color ---\r\n\r\n        this.secondaryColorBtn = BB.el({\r\n            parent: this.outputDiv,\r\n            title: LANG('secondary-color') + ' [X]',\r\n            className: 'kl-color-picker__secondary',\r\n            css: {\r\n                cursor: 'pointer',\r\n                marginLeft: '5px',\r\n                width: '22px',\r\n                height: '22px',\r\n            },\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                this.swapColors();\r\n            },\r\n        });\r\n        this.updateSecondaryColor();\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.primaryColorRGB = {r: parseInt('' + c.r), g: parseInt('' + c.g), b: parseInt('' + c.b)};\r\n        this.updatePrimaryHSV(BB.ColorConverter.toHSV(c));\r\n        this.controlH.style.left = parseInt('' + (this.primaryColorHSV.h / 359 * this.width - 1)) + 'px';\r\n        this.updateSVCanvas();\r\n        this.updateSVPointer();\r\n        this.setColPreview();\r\n    }\r\n\r\n    getColor (): RGB {\r\n        return new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b);\r\n    }\r\n\r\n    getSecondaryRGB (): RGB {\r\n        return new BB.RGB(this.secondaryColorRGB.r, this.secondaryColorRGB.g, this.secondaryColorRGB.b);\r\n    }\r\n\r\n    setPickCallback (func: (b: boolean) => void): void {\r\n        this.pickCallback = func;\r\n    }\r\n\r\n    pickingDone (): void {\r\n        if (!this.isPicking) {\r\n            return;\r\n        }\r\n        this.isPicking = false;\r\n        this.pickerButton.classList.remove('color-picker-preview-button-active');\r\n    }\r\n\r\n    enable (e: boolean): void {\r\n        if (e) {\r\n            this.rootEl.style.pointerEvents = '';\r\n            this.rootEl.style.opacity = '1';\r\n            this.outputDiv.style.pointerEvents = '';\r\n            this.outputDiv.style.opacity = '1';\r\n        } else {\r\n            this.rootEl.style.pointerEvents = 'none';\r\n            this.rootEl.style.opacity = '0.5';\r\n            this.outputDiv.style.pointerEvents = 'none';\r\n            this.outputDiv.style.opacity = '0.5';\r\n        }\r\n    }\r\n\r\n    setHeight (h: number): void {\r\n        h = parseInt('' +(h - this.height * 2 - 3), 10);\r\n        if (h === this.svHeight) {\r\n            return;\r\n        }\r\n        this.svHeight = h;\r\n        BB.css(this.svSvg, {\r\n            width: this.width + 'px',\r\n            height: this.svHeight + 'px',\r\n        });\r\n        this.SVContainer.style.height = this.svHeight + 'px';\r\n        this.updateSVPointer();\r\n    }\r\n\r\n    swapColors (): void {\r\n        // swap hsv\r\n        let tmp: RGB | HSV = this.secondaryColorHSV;\r\n        this.secondaryColorHSV = this.primaryColorHSV;\r\n        this.updatePrimaryHSV(tmp);\r\n        // swap rgb\r\n        tmp = this.secondaryColorRGB;\r\n        this.secondaryColorRGB = this.primaryColorRGB;\r\n        this.primaryColorRGB = tmp;\r\n\r\n        this.controlH.style.left = parseInt('' + (this.primaryColorHSV.h / 359 * this.width - 1)) + 'px';\r\n        this.updateSVCanvas();\r\n        this.updateSVPointer();\r\n        this.setColPreview();\r\n        this.updateSecondaryColor();\r\n\r\n        this.emitColor(new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b));\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getOutputElement (): HTMLElement {\r\n        return this.outputDiv;\r\n    }\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ffKNP\");","import {theme} from '../../theme/theme';\r\n\r\nexport const ERASE_COLOR = theme.isDark() ? 255 : 255;","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport {IRGB} from '../../kl-types';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {HSV} from '../../../bb/color/color';\r\n\r\n/**\r\n * a small color slider\r\n */\r\nexport class KlColorSliderSmall {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private color: HSV;\r\n    private readonly svPointerListener: PointerListener;\r\n    private readonly hPointerListener: PointerListener;\r\n    private svPointerId: number | null;\r\n    private hPointerId: number | null;\r\n    private readonly width: number;\r\n    private readonly heightSV: number;\r\n    private readonly pointerSV: HTMLElement;\r\n    private readonly pointerH: HTMLElement;\r\n    private readonly canvasSV: HTMLCanvasElement;\r\n\r\n\r\n    private updateSV (): void {\r\n        const ctx = BB.ctx(this.canvasSV);\r\n        if(!ctx) {\r\n            throw new Error('couldnt create canvas');\r\n        }\r\n        for (let i = 0; i < this.canvasSV.height; i += 1) {\r\n            const gradient1 = ctx.createLinearGradient(0, 0, this.canvasSV.width, 0);\r\n\r\n            const colleft = BB.ColorConverter.toRGB(new BB.HSV(this.color.h, 1, 100 - (i / this.canvasSV.height * 100.0)));\r\n            const colright = BB.ColorConverter.toRGB(new BB.HSV(this.color.h, 100, 100 - (i / this.canvasSV.height * 100.0)));\r\n            gradient1.addColorStop(0, '#' + BB.ColorConverter.toHexString(colleft));\r\n            gradient1.addColorStop(1, '#' + BB.ColorConverter.toHexString(colright));\r\n            ctx.fillStyle = '#ff0000'; //needed for chrome...otherwise alpha problem\r\n            ctx.fillStyle = gradient1;\r\n            ctx.fillRect(0, i, this.canvasSV.width, 1);\r\n        }\r\n    }\r\n\r\n    private updateSVPointer (): void {\r\n        const left = this.color.s / 100 * this.width - 4;\r\n        const top = (1 - this.color.v / 100) * this.heightSV - 4;\r\n        BB.css(this.pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px',\r\n        });\r\n    }\r\n\r\n    private updateHPointer (): void {\r\n        this.pointerH.style.left = (this.color.h / 359.999 * this.width - 1) + 'px';\r\n    }\r\n\r\n\r\n\r\n\r\n    // ----- public ----\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            heightSV: number; // height of saturation/value\r\n            heightH: number; // height of hue\r\n            color: IRGB;\r\n            callback: (c: IRGB) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                width: p.width + 'px',\r\n                position: 'relative',\r\n                overflow: 'hidden',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = (e) => {\r\n            e.preventDefault();\r\n        };\r\n        this.color = BB.ColorConverter.toHSV(new BB.RGB(p.color.r, p.color.g, p.color.b));\r\n        this.width = p.width;\r\n        this.heightSV = p.heightSV;\r\n\r\n        this.canvasSV = BB.canvas(10, 10);\r\n        BB.css(this.canvasSV, {\r\n            width: this.width + 'px',\r\n            height: this.heightSV + 'px',\r\n            cursor: 'crosshair',\r\n        });\r\n\r\n\r\n        this.updateSV();\r\n\r\n        const canvasH = BB.canvas(p.width, p.heightH);\r\n        canvasH.style.cursor = 'ew-resize';\r\n        (() => {\r\n            const ctx = BB.ctx(canvasH);\r\n\r\n            const gradH = ctx.createLinearGradient(0, 0, p.width, 0);\r\n            for (let i = 0; i < 1; i += 0.01) {\r\n                const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n                gradH.addColorStop(i, 'rgba(' + parseInt('' + col.r) + ', ' + parseInt('' + col.g) + ', ' + parseInt('' + col.b) + ', 1)');\r\n            }\r\n            ctx.fillStyle = gradH;\r\n            ctx.fillRect(0, 0, p.width, p.heightH);\r\n\r\n        })();\r\n        BB.css(this.canvasSV, {\r\n            width: p.width + 'px',\r\n            height: p.heightSV + 'px',\r\n            overflow: 'hidden',\r\n            position: 'relative',\r\n        });\r\n        this.canvasSV.style.cssFloat = 'left';\r\n        canvasH.style.cssFloat = 'left';\r\n\r\n        this.rootEl.append(this.canvasSV, canvasH);\r\n\r\n        this.pointerSV = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                width: '8px',\r\n                height: '8px',\r\n                borderRadius: '8px',\r\n                position: 'absolute',\r\n                pointerEvents: 'none',\r\n                boxShadow: '0 0 0 1px #000, inset 0 0 0 1px #fff',\r\n            },\r\n        });\r\n\r\n        this.pointerH = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                width: '0',\r\n                height: p.heightH + 'px',\r\n                borderLeft: '1px solid #fff',\r\n                borderRight: '1px solid #000',\r\n                position: 'absolute',\r\n                top: p.heightSV + 'px',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n\r\n        this.updateSVPointer();\r\n        this.updateHPointer();\r\n\r\n        const virtualHSV = {\r\n            h: 0,\r\n            s: 0,\r\n            v: 0,\r\n        };\r\n\r\n        this.svPointerId = null;\r\n        this.svPointerListener = new BB.PointerListener({\r\n            target: this.canvasSV,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n\r\n                if (event.type === 'pointerdown') {\r\n\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    BB.unfocusAnyInput();\r\n\r\n                    this.svPointerId = event.pointerId;\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.s = event.relX / p.width * 100;\r\n                        virtualHSV.v = 100 - event.relY / p.heightSV * 100;\r\n\r\n                        this.color = new BB.HSV(this.color.h, virtualHSV.s, virtualHSV.v);\r\n\r\n                        this.updateSVPointer();\r\n                        p.callback(BB.ColorConverter.toRGB(this.color));\r\n                    } else {\r\n                        virtualHSV.s = this.color.s;\r\n                        virtualHSV.v = this.color.v;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes('' + event.button) && this.svPointerId === event.pointerId) {\r\n\r\n                    let factor = 1;\r\n                    if (event.button === 'right') {\r\n                        factor = 0.5;\r\n                    }\r\n\r\n                    virtualHSV.s += event.dX / p.width * 100 * factor;\r\n                    virtualHSV.v -= event.dY / p.heightSV * 100 * factor;\r\n\r\n                    this.color = new BB.HSV(this.color.h, virtualHSV.s, virtualHSV.v);\r\n                    this.updateSVPointer();\r\n                    p.callback(BB.ColorConverter.toRGB(this.color));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.svPointerId = null;\r\n                }\r\n\r\n            },\r\n        });\r\n\r\n        this.hPointerId = null;\r\n        this.hPointerListener = new BB.PointerListener({\r\n            target: canvasH,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n\r\n                if (event.type === 'pointerdown') {\r\n                    this.hPointerId = event.pointerId;\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.h = event.relX / p.width * 359.99;\r\n\r\n                        this.color = new BB.HSV(virtualHSV.h, this.color.s, this.color.v);\r\n                        this.updateSV();\r\n                        this.updateHPointer();\r\n                        p.callback(BB.ColorConverter.toRGB(this.color));\r\n                    } else {\r\n                        virtualHSV.h = this.color.h;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes('' + event.button) && this.hPointerId === event.pointerId) {\r\n\r\n                    const deltaY = Math.abs(event.pageY - event.downPageY!);\r\n                    const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                    virtualHSV.h += event.dX / p.width * 359.99 * factor;\r\n\r\n                    if (event.button === 'right') {\r\n                        virtualHSV.h = virtualHSV.h % 359.99;\r\n                        if (virtualHSV.h < 0) {\r\n                            virtualHSV.h += 359.99;\r\n                        }\r\n                    }\r\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                    this.color = new BB.HSV(virtualHSV.h, this.color.s, this.color.v);\r\n                    this.updateSV();\r\n                    this.updateHPointer();\r\n                    p.callback(BB.ColorConverter.toRGB(this.color));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.hPointerId = null;\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n        const cleardiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                clear: 'both',\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n    setColor (c: IRGB): void {\r\n        this.color = BB.ColorConverter.toHSV(new BB.RGB(c.r, c.g, c.b));\r\n        this.updateSV();\r\n        this.updateSVPointer();\r\n        this.updateHPointer();\r\n    }\r\n\r\n    getColor (): IRGB {\r\n        return BB.ColorConverter.toRGB(this.color);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.svPointerListener.destroy();\r\n        this.hPointerListener.destroy();\r\n    }\r\n\r\n    end (): void {\r\n        this.svPointerId = null;\r\n        this.hPointerId = null;\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n/**\r\n * A slider that looks like this\r\n * ------O----\r\n */\r\nexport class PointSlider {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly sliderPoint: HTMLElement;\r\n    private readonly pointerListener: PointerListener;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            init: number;\r\n            width: number;\r\n            pointSize: number;\r\n            callback: (value: number, isFirst: boolean, isLast: boolean) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n            },\r\n        });\r\n        const sliderLine = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-point-slider__line',\r\n            css: {\r\n                marginTop: parseInt('' + (p.pointSize / 2 - 1)) + 'px',\r\n                width: p.width + 'px',\r\n            },\r\n        });\r\n        this.sliderPoint = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-point-slider__point',\r\n        });\r\n        let sliderPos: number;\r\n        let isDragging = false;\r\n\r\n        //sliderPoint\r\n        const touchAreaEl = BB.el({ // expand clickable area\r\n            parent: this.sliderPoint,\r\n            css: {\r\n                // background: 'rgba(255,0,0,0.4)',\r\n                margin: '-7px 0 0 -7px',\r\n                width: 'calc(100% + 14px)',\r\n                height: 'calc(100% + 7px)',\r\n            },\r\n        });\r\n\r\n        const redrawPoint = () => {\r\n            BB.css(this.sliderPoint, {\r\n                left: sliderPos + 'px',\r\n            });\r\n        };\r\n        const getValue = () => {\r\n            return sliderPos /  (p.width - p.pointSize);\r\n        };\r\n\r\n        {\r\n            let isFirst: boolean;\r\n            sliderPos = BB.clamp(p.init * (p.width - p.pointSize), 0, p.width - p.pointSize);\r\n            BB.css(this.sliderPoint, {\r\n                width: p.pointSize + 'px',\r\n                height: p.pointSize + 'px',\r\n                borderRadius: p.pointSize + 'px',\r\n            });\r\n            redrawPoint();\r\n            let imaginaryPos: number;\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.sliderPoint,\r\n                fixScribble: true,\r\n                onPointer: (event): void => {\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        isFirst = true;\r\n                        isDragging = true;\r\n                        imaginaryPos = sliderPos;\r\n                        redrawPoint();\r\n                        event.eventStopPropagation();\r\n                    } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                        event.eventStopPropagation();\r\n                        imaginaryPos = imaginaryPos + event.dX;\r\n                        sliderPos = parseInt('' + BB.clamp(imaginaryPos, 0, p.width - p.pointSize));\r\n                        redrawPoint();\r\n                        p.callback(getValue(), isFirst, false);\r\n                        isFirst = false;\r\n                    }\r\n                    if (event.type === 'pointerup') {\r\n                        event.eventStopPropagation();\r\n                        isDragging = false;\r\n                        redrawPoint();\r\n                        p.callback(getValue(), false, true);\r\n                    }\r\n                },\r\n            });\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getEl (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setActive (isActive: boolean): void {\r\n        this.sliderPoint.style.backgroundColor = isActive ? '#fff' : '#eaeaea';\r\n    }\r\n\r\n    destroy (): void {\r\n        this.pointerListener.destroy();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IRGBA} from '../../kl-types';\r\nimport {theme} from '../../../theme/theme';\r\nimport {ColorConverter} from '../../../bb/color/color';\r\nimport {c} from '../../../bb/base/c';\r\n\r\n/**\r\n * UI to pick between colors in colorArr. can display full transparent (checkerboard).\r\n * Can't deal with 0.5 alpha.\r\n * Rectangular buttons.\r\n */\r\nexport class ColorOptions {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly buttonArr: {\r\n        el: HTMLElement;\r\n        setIsSelected: (b: boolean) => void;\r\n    }[];\r\n    private readonly colorArr: (IRGBA | null)[] = [];\r\n    private selectedIndex: number = 0;\r\n    private colorInput: HTMLInputElement;\r\n\r\n    private readonly updateCheckerboard: () => void;\r\n    private readonly onColorInputChange: () => void;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            colorArr: (IRGBA | null)[]; // duplicates will be removed\r\n            onChange: (rgbaObj: IRGBA | null) => void;\r\n            label?: string;\r\n            initialIndex?: number; // index before duplicates were removed\r\n            title?: string;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            content: p.label ? p.label : '',\r\n            title: p.title ?? undefined,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                gap: '7px',\r\n            },\r\n        });\r\n\r\n        this.buttonArr = [];\r\n        const buttonSize = 22;\r\n        const checkerUrl = BB.createCheckerDataUrl(5, undefined, theme.isDark());\r\n\r\n        this.onColorInputChange = () => {\r\n            const i = this.selectedIndex;\r\n            const color = this.colorArr[i];\r\n            if (!color || color.a < 1) {\r\n                // ignore\r\n                return;\r\n            }\r\n\r\n            const newRawColor = this.colorInput.value;\r\n            this.buttonArr[this.selectedIndex].el.style.backgroundColor = newRawColor;\r\n            this.colorArr[i] = {\r\n                ...ColorConverter.hexToRGB(newRawColor)!,\r\n                a: 1,\r\n            };\r\n            p.onChange(this.colorArr[i]);\r\n        };\r\n        this.colorInput = BB.el({\r\n            tagName: 'input',\r\n            custom: {\r\n                type: 'color',\r\n                tabIndex: '-1',\r\n            },\r\n        });\r\n        this.colorInput.onchange = this.onColorInputChange;\r\n        this.colorInput.oninput = this.onColorInputChange;\r\n\r\n        // build colorArr while removing duplicates\r\n        for (let i = 0; i < p.colorArr.length; i++) {\r\n            const item = p.colorArr[i];\r\n            let found = false;\r\n            for (let e = 0; e < this.colorArr.length; e++) {\r\n                const sItem = this.colorArr[e];\r\n                if (sItem === item) {\r\n                    found = true;\r\n                    break;\r\n                }\r\n                if (sItem === null || item === null) {\r\n                    continue;\r\n                }\r\n                if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\r\n                    found = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (found) {\r\n                continue;\r\n            }\r\n            this.colorArr.push(item);\r\n            if ('initialIndex' in p && p.initialIndex === i) {\r\n                this.selectedIndex = this.colorArr.length - 1;\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < this.colorArr.length; i++) {\r\n            ((i) => {\r\n                const color = this.colorArr[i];\r\n\r\n                const colorButton = BB.el({\r\n                    parent: this.rootEl,\r\n                    content: color ? '' : 'X',\r\n                    className: 'kl-color-option',\r\n                    css: {\r\n                        width: buttonSize + 'px',\r\n                        height: buttonSize + 'px',\r\n                        backgroundColor: color ? BB.ColorConverter.toRgbaStr(color) : 'transparent',\r\n                        lineHeight: (buttonSize + 1) + 'px',\r\n                    },\r\n                    onClick: (e) => {\r\n                        if (this.selectedIndex === i) {\r\n                            if (color && color.a === 1) {\r\n                                this.colorInput.showPicker ? this.colorInput.showPicker() : this.colorInput.click();\r\n                            }\r\n                            return;\r\n                        }\r\n\r\n                        e.preventDefault();\r\n                        this.selectedIndex = i;\r\n                        update();\r\n                        p.onChange(this.colorArr[i]); // color may change\r\n                    },\r\n                });\r\n                if (color && color.a === 0) {\r\n                    colorButton.style.backgroundImage = 'url(' + checkerUrl + ')';\r\n                }\r\n\r\n                const setIsSelected = (b: boolean): void => {\r\n                    colorButton.classList.toggle('kl-color-option--active', b);\r\n                };\r\n\r\n                this.buttonArr.push({\r\n                    el: colorButton,\r\n                    setIsSelected,\r\n                });\r\n            })(i);\r\n        }\r\n\r\n        this.rootEl.append(c(',w-0,h-0,overflow-hidden', [this.colorInput]));\r\n\r\n\r\n        const update = () => {\r\n            for (let i = 0; i < this.buttonArr.length; i++) {\r\n                this.buttonArr[i].setIsSelected(i === this.selectedIndex);\r\n            }\r\n        };\r\n        update();\r\n\r\n        this.updateCheckerboard = (): void => {\r\n            const checkerUrl = BB.createCheckerDataUrl(5, undefined, theme.isDark());\r\n            this.buttonArr.forEach((button, i) => {\r\n                const color = this.colorArr[i];\r\n                if (color && color.a === 0) {\r\n                    button.el.style.backgroundImage = 'url(' + checkerUrl + ')';\r\n                }\r\n            });\r\n        };\r\n        theme.addIsDarkListener(this.updateCheckerboard);\r\n    }\r\n\r\n    // ---- interface ----\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValue (): IRGBA | null {\r\n        return this.colorArr[this.selectedIndex];\r\n    }\r\n\r\n    destroy (): void {\r\n        this.buttonArr.forEach(item => {\r\n            BB.destroyEl(item.el);\r\n        });\r\n        this.buttonArr.splice(0, this.buttonArr.length);\r\n        theme.removeIsDarkListener(this.updateCheckerboard);\r\n        this.colorInput.onchange = null;\r\n        this.colorInput.oninput = null;\r\n    }\r\n\r\n}\r\n\r\n","import {IKeyStringOptional} from '../bb-types';\r\nimport {BB} from '../bb';\r\n\r\nfunction decomposeElString (el: string) {\r\n    if (el === '') {\r\n        return {};\r\n    }\r\n\r\n    let split: string[];\r\n    let tagName: string;\r\n    const classes: string[] = [];\r\n\r\n    split = el.split('.');\r\n\r\n    if (split.length === 1) {\r\n        split = split[0].split(',');\r\n        tagName = split.shift()!;\r\n\r\n    } else {\r\n        tagName = split.shift()!;\r\n        split.forEach((item, index) => {\r\n            const isLast = index === split.length - 1;\r\n            if (isLast) {\r\n                split = item.split(',');\r\n                const last = split.shift();\r\n                if (last !== undefined) {\r\n                    classes.push(last);\r\n                }\r\n            } else {\r\n                classes.push(item);\r\n            }\r\n        });\r\n    }\r\n\r\n    const result = {} as {\r\n        tagName?: string;\r\n        classes?: string[];\r\n        styles?: string[];\r\n    };\r\n    if (tagName !== '') {\r\n        result.tagName = tagName;\r\n    }\r\n    if (classes.length > 0) {\r\n        result.classes = classes;\r\n    }\r\n    if (split.length > 0) {\r\n        result.styles = split;\r\n    }\r\n    return result;\r\n}\r\n\r\nfunction applyStyleNames (el: HTMLElement, styleNames: string[]) {\r\n    const style: IKeyStringOptional = {};\r\n\r\n    const operations: {\r\n        [key: string]: (params: string[]) => void;\r\n    } = {\r\n        c: (params) => {\r\n            style.color = params[0];\r\n        },\r\n        bg: (params) => {\r\n            style.background = params[0];\r\n        },\r\n        p: (params) => {\r\n            style.padding = params[0] + 'px';\r\n        },\r\n        py: (params) => {\r\n            style.paddingTop = params[0] + 'px';\r\n            style.paddingBottom = params[0] + 'px';\r\n        },\r\n\r\n        // flex\r\n        flex: () => {\r\n            style.display = 'flex';\r\n        },\r\n        'flexCol': () => {\r\n            style.flexDirection = 'column';\r\n        },\r\n        'flexWrap': () => {\r\n            style.flexWrap = 'wrap';\r\n        },\r\n        gap: (params) => {\r\n            style.gap = params.map(item => item + 'px').join(' ');\r\n        },\r\n        grow: () => {\r\n            style.flexGrow = '1';\r\n        },\r\n        justify: (params) => {\r\n            style.justifyContent = params[0];\r\n        },\r\n        items: (params) => {\r\n            style.alignItems = params[0];\r\n        },\r\n\r\n        hidden: () => {\r\n            style.display = 'none';\r\n        },\r\n        abs: (params) => {\r\n            style.position = 'absolute';\r\n            style.left = params[0] + 'px';\r\n            style.top = params[1] + 'px';\r\n        },\r\n        w: (params) => {\r\n            style.width = params[0] + 'px';\r\n        },\r\n        h: (params) => {\r\n            style.height = params[0] + 'px';\r\n        },\r\n        minh: (params) => {\r\n            style.minHeight = params[0] + 'px';\r\n        },\r\n        z: (params) => {\r\n            style.zIndex = params[0];\r\n        },\r\n        overflow: (params) => {\r\n            style.overflow = params[0];\r\n        },\r\n    };\r\n\r\n    styleNames.forEach(item => {\r\n        const params = item.split('-');\r\n        const operation = params.shift()!;\r\n        operations[operation](params);\r\n    });\r\n    BB.css(el, style);\r\n}\r\n\r\n/**\r\n * composes HTML\r\n */\r\nexport function c (\r\n    el?: HTMLElement | string,\r\n    inner?: string | (SVGElement | HTMLElement | string)[]\r\n): HTMLElement {\r\n    if (el === undefined) {\r\n        return document.createElement('div');\r\n    }\r\n    if (typeof el !== 'string') {\r\n        if (inner) {\r\n            if (typeof inner === 'string') {\r\n                el.innerHTML = inner;\r\n            } else {\r\n                el.append(...inner);\r\n            }\r\n        }\r\n        return el;\r\n    }\r\n\r\n    const decomp = decomposeElString(el);\r\n    const result = document.createElement(decomp.tagName ?? 'div');\r\n    decomp.classes && result.classList.add(...decomp.classes);\r\n    decomp.styles && applyStyleNames(result, decomp.styles);\r\n\r\n    if (inner) {\r\n        if (typeof inner === 'string') {\r\n            result.innerHTML = inner;\r\n        } else {\r\n            result.append(...inner);\r\n        }\r\n    }\r\n    return result;\r\n}","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * selectable options\r\n */\r\nexport class Options<IdType> {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private selectedId: IdType;\r\n    private readonly optionArr: {\r\n        id: IdType;\r\n        el: HTMLElement;\r\n    }[];\r\n    private readonly onChange: ((id: IdType) => void) | undefined;\r\n\r\n    private getIndex (): number {\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            if (this.optionArr[i].id === this.selectedId) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    private update (): void {\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            this.optionArr[i].el.classList.toggle(\r\n                'kl-option-selected',\r\n                this.optionArr[i].id === this.selectedId\r\n            );\r\n        }\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            optionArr: {\r\n                id: IdType;\r\n                label: string | HTMLElement | SVGElement;\r\n                title?: string;\r\n            }[];\r\n            initId?: IdType;\r\n            onChange?: (id: IdType) => void;\r\n            changeOnInit?: boolean; // trigger change on creation\r\n            isSmall? :boolean;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el();\r\n\r\n        const wrapperEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-option-wrapper',\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        if (p.onChange) {\r\n            this.onChange = p.onChange;\r\n        }\r\n        this.optionArr = [];\r\n        this.selectedId = ('initialId' in p && p.initId !== undefined) ? p.initId : p.optionArr[0].id;\r\n\r\n        const createOption = (o: {\r\n            id: IdType;\r\n            label: string | HTMLElement | SVGElement;\r\n            title?: string;\r\n        }) => {\r\n\r\n            const classArr = ['kl-option'];\r\n            if (p.isSmall) {\r\n                classArr.push('kl-option--small');\r\n            }\r\n            if (typeof o.label !== 'string') {\r\n                classArr.push('kl-option--custom-el');\r\n                BB.css(o.label, {\r\n                    display: 'block',\r\n                    pointerEvents: 'none',\r\n                });\r\n            }\r\n\r\n            const optionObj = {\r\n                id: o.id,\r\n                el: BB.el({\r\n                    parent: wrapperEl,\r\n                    content: o.label,\r\n                    className: classArr.join(' '),\r\n                    onClick: () => {\r\n                        if (this.selectedId !== optionObj.id) {\r\n                            this.selectedId = optionObj.id;\r\n                            this.update();\r\n                            this.onChange && this.onChange(this.selectedId);\r\n                        }\r\n                    },\r\n                }),\r\n            };\r\n\r\n            if (o.title) {\r\n                optionObj.el.title = o.title;\r\n            }\r\n\r\n            this.optionArr.push(optionObj);\r\n        };\r\n\r\n        for (let i = 0; i < p.optionArr.length; i++) {\r\n            createOption(p.optionArr[i]);\r\n        }\r\n\r\n        this.update();\r\n\r\n        if (p.changeOnInit) {\r\n            setTimeout(() => {\r\n                this.onChange && this.onChange(this.selectedId);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValue (): IdType {\r\n        return this.selectedId;\r\n    }\r\n\r\n    next (): void {\r\n        this.selectedId = this.optionArr[(this.getIndex() + 1) % this.optionArr.length].id;\r\n        this.update();\r\n        this.onChange && this.onChange(this.selectedId);\r\n    }\r\n\r\n    previous (): void {\r\n        this.selectedId = this.optionArr[(this.optionArr.length + this.getIndex() - 1) % this.optionArr.length].id;\r\n        this.update();\r\n        this.onChange && this.onChange(this.selectedId);\r\n    }\r\n\r\n    destroy (): void {\r\n        this.optionArr.forEach(item => {\r\n            BB.destroyEl(item.el);\r\n        });\r\n        this.optionArr.splice(0, this.optionArr.length);\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport angleSvg from '/src/app/img/ui/angle.svg';\r\n\r\n\r\ntype TUiState = 'left' | 'right';\r\n\r\n/**\r\n * display little messages at the top of KlWorkspace\r\n */\r\nexport class StatusOverlay {\r\n\r\n    private readonly el: HTMLDivElement;\r\n    private readonly innerEl: HTMLDivElement;\r\n    private readonly angleIm: HTMLImageElement;\r\n    private readonly innerInnerEl: HTMLDivElement;\r\n    private isWide: boolean = false; // tool space hidden\r\n    private uiState: TUiState = 'right';\r\n\r\n    private timeout: ReturnType<typeof setTimeout> | undefined;\r\n    private timeout2: ReturnType<typeof setTimeout> | undefined;\r\n    private timeout3: ReturnType<typeof setTimeout> | undefined;\r\n\r\n    private updateUiState () {\r\n        if (this.uiState === 'left') {\r\n            this.el.style.left = '271px';\r\n        } else {\r\n            this.el.style.removeProperty('left');\r\n        }\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        this.el = BB.el({\r\n            className: 'top-overlay g-root',\r\n            onClick: BB.handleClick,\r\n        });\r\n\r\n        this.updateUiState();\r\n\r\n        this.innerEl = BB.el({\r\n            className: 'top-overlay--inner',\r\n        });\r\n\r\n\r\n        this.angleIm = new Image();\r\n        this.angleIm.src = angleSvg;\r\n        BB.css(this.angleIm, {\r\n            verticalAlign: 'bottom',\r\n            width: '20px',\r\n            height: '20px',\r\n            marginLeft: '5px',\r\n            borderRadius: '10px',\r\n        });\r\n\r\n        this.innerInnerEl = document.createElement('div');\r\n        this.innerInnerEl.style.display = 'inline-block';\r\n\r\n        this.innerEl.append(this.innerInnerEl, this.angleIm);\r\n        this.el.append(this.innerEl);\r\n        document.body.append(this.el);\r\n        this.el.style.display = 'none';\r\n    }\r\n\r\n    setWide (b: boolean) {\r\n        this.isWide = b;\r\n\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n            this.el.style.left = '';\r\n        } else {\r\n            this.el.style.removeProperty('width');\r\n            this.el.style.left = this.uiState === 'left' ? '271px' : '';\r\n        }\r\n    }\r\n\r\n    setUiState (state: TUiState) {\r\n        this.uiState = state;\r\n        this.updateUiState();\r\n    }\r\n\r\n    out (msg: string | {type: 'transform'; angleDeg: number; scale: number}, doPulse?: boolean) {\r\n\r\n        if (typeof msg === 'string') {\r\n            this.angleIm.style.display = 'none';\r\n            this.innerInnerEl.innerHTML = msg;\r\n        } else {\r\n            if (msg.type === 'transform') {\r\n                this.angleIm.style.display = 'inline-block';\r\n                this.angleIm.style.transform = 'rotate(' + msg.angleDeg + 'deg)';\r\n\r\n                if (msg.angleDeg % 90 === 0) {\r\n                    this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255, 255, 255, 0.7)';\r\n                } else {\r\n                    this.angleIm.style.boxShadow = '';\r\n                }\r\n\r\n                this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + '%';\r\n\r\n\r\n            } else {\r\n                this.angleIm.style.display = 'none';\r\n            }\r\n        }\r\n\r\n        if (doPulse) {\r\n            this.innerEl.style.animation = '';\r\n            setTimeout(\r\n                () => this.innerEl.style.animation = 'topOverlayPulse 0.5s ease-out',\r\n                20\r\n            );\r\n            clearTimeout(this.timeout3);\r\n            this.timeout3 = setTimeout(\r\n                () => this.innerEl.style.animation = '',\r\n                520\r\n            );\r\n        }\r\n\r\n\r\n\r\n        clearTimeout(this.timeout);\r\n        clearTimeout(this.timeout2);\r\n        this.el.style.animationName = doPulse ? 'consoleInFast' : 'consoleIn';\r\n        this.el.style.opacity = '1';\r\n        this.timeout = setTimeout(() => {\r\n            this.el.style.opacity = '0';\r\n            this.el.style.animationName = 'consoleOut';\r\n            this.timeout2 = setTimeout(() => {\r\n                this.el.style.display = 'none';\r\n            }, 450);\r\n        }, 1200);\r\n        this.el.style.display = 'flex';\r\n    }\r\n\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iqIgb\");","import {BB} from '../../../bb/bb';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {IRect, IVector2D} from '../../../bb/bb-types';\r\nimport {theme} from '../../../theme/theme';\r\n\r\n/**\r\n * element that lets you crop an image and copy it via right click\r\n */\r\nexport class CropCopy {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly eventTarget: HTMLElement;\r\n    private crop: IRect = {x: 0, y: 0, width: 0, height: 0};\r\n    private readonly croppedCanvas: HTMLCanvasElement;\r\n    private readonly keyListener: KeyListener;\r\n    private readonly pointerListener: PointerListener;\r\n    private readonly canvas: HTMLImageElement | HTMLCanvasElement;\r\n    private readonly onChange: undefined | ((width: number, height: number) => void);\r\n    private readonly selectionRect: HTMLElement;\r\n    private readonly thumbX: number;\r\n    private readonly thumbY: number;\r\n    private readonly scaleW: number;\r\n    private readonly scaleH: number;\r\n    private readonly croppedImage: undefined | HTMLImageElement;\r\n\r\n\r\n    private resetCrop (): void {\r\n        this.crop = {\r\n            x: 0,\r\n            y: 0,\r\n            width: this.canvas.width,\r\n            height: this.canvas.height,\r\n        };\r\n    }\r\n    private updateCroppedCanvas (): void {\r\n        this.croppedCanvas.width = Math.round(this.crop.width);\r\n        this.croppedCanvas.height = Math.round(this.crop.height);\r\n        const ctx = BB.ctx(this.croppedCanvas);\r\n        ctx.drawImage(this.canvas, Math.round(-this.crop.x), Math.round(-this.crop.y));\r\n        if (this.croppedImage) {\r\n            this.croppedImage.src = this.croppedCanvas.toDataURL('image/png');\r\n        }\r\n\r\n        this.onChange && this.onChange(this.croppedCanvas.width, this.croppedCanvas.height);\r\n    }\r\n    private updateSelectionRect (): void {\r\n        BB.css(this.selectionRect, {\r\n            left: (this.thumbX + this.crop.x * this.scaleW) + 'px',\r\n            top: (this.thumbY + this.crop.y * this.scaleH) + 'px',\r\n            width: (this.crop.width * this.scaleW) + 'px',\r\n            height: (this.crop.height * this.scaleH) + 'px',\r\n        });\r\n        this.onChange && this.onChange(Math.round(this.crop.width), Math.round(this.crop.height));\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        param: {\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLImageElement | HTMLCanvasElement;\r\n            isNotCopy: boolean;\r\n            onChange?: (width: number, height: number) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-edit-crop-preview',\r\n            css: {\r\n                position: 'relative',\r\n                height: param.height + 'px',\r\n                width: param.width + 'px',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n        if (param.onChange) {\r\n            this.onChange = param.onChange;\r\n        }\r\n        this.canvas = param.canvas;\r\n\r\n        this.resetCrop();\r\n\r\n\r\n\r\n\r\n        const isInsideSelectionRect = (p: IVector2D): boolean => {\r\n            const rect = {\r\n                x: Math.round(this.thumbX + this.crop.x * this.scaleW),\r\n                y: Math.round(this.thumbY + this.crop.y * this.scaleH),\r\n                width: Math.round(this.crop.width * this.scaleW),\r\n                height: Math.round(this.crop.height * this.scaleH),\r\n            };\r\n            return BB.isInsideRect(p, rect);\r\n        };\r\n\r\n        this.croppedCanvas = BB.canvas();\r\n        this.eventTarget = this.croppedCanvas;\r\n        if (!param.isNotCopy) {\r\n            this.croppedImage = new Image();\r\n            this.eventTarget = this.croppedImage;\r\n        }\r\n        BB.css(this.eventTarget, {\r\n            height: param.height + 'px',\r\n            width: param.width + 'px',\r\n        });\r\n        this.rootEl.append(this.eventTarget);\r\n        this.updateCroppedCanvas();\r\n\r\n        const padding = 20;\r\n        const previewWrapper = BB.el({\r\n            css: {\r\n                width: param.width + 'px',\r\n                height: param.height + 'px',\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        this.rootEl.append(previewWrapper);\r\n        BB.createCheckerDataUrl(4, (v) => {\r\n            previewWrapper.style.backgroundImage = 'url('+v+')';\r\n        }, theme.isDark());\r\n\r\n        const thumbSize = BB.fitInto(this.canvas.width, this.canvas.height, param.width - padding * 2, param.height - padding * 2, 1);\r\n        const thumbCanvas = BB.canvas(Math.round(thumbSize.width), Math.round(thumbSize.height));\r\n        thumbCanvas.style.imageRendering = 'pixelated';\r\n        this.scaleW = thumbCanvas.width / this.canvas.width;\r\n        this.scaleH = thumbCanvas.height / this.canvas.height;\r\n        const thumbCtx = BB.ctx(thumbCanvas);\r\n        thumbCtx.imageSmoothingEnabled = false;\r\n        thumbCtx.drawImage(this.canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);\r\n        previewWrapper.append(thumbCanvas);\r\n        this.thumbX = parseInt('' + ((param.width - thumbCanvas.width) / 2));\r\n        this.thumbY = parseInt('' + ((param.height - thumbCanvas.height) / 2));\r\n        BB.css(thumbCanvas, {\r\n            position: 'absolute',\r\n            left: this.thumbX + 'px',\r\n            top: this.thumbY + 'px',\r\n        });\r\n\r\n        this.selectionRect = BB.el({\r\n            parent: previewWrapper,\r\n            className: 'kl-edit-crop-preview__sel',\r\n        });\r\n        this.updateSelectionRect();\r\n\r\n\r\n        const toOriginalSpace = (p: IVector2D): IVector2D => {\r\n            return {\r\n                x: BB.clamp((p.x - this.thumbX) / this.scaleW, 0, this.canvas.width),\r\n                y: BB.clamp((p.y - this.thumbY) / this.scaleH, 0, this.canvas.height),\r\n            };\r\n        };\r\n        //gen crop from thumb-space points\r\n        const genCrop = (p1: IVector2D, p2: IVector2D): IRect => {\r\n            const topLeftP = {\r\n                x: Math.min(p1.x, p2.x),\r\n                y: Math.min(p1.y, p2.y),\r\n            };\r\n            const bottomRightP = {\r\n                x: Math.max(p1.x, p2.x),\r\n                y: Math.max(p1.y, p2.y),\r\n            };\r\n            const origTopLeftP = toOriginalSpace(topLeftP);\r\n            const origBottomRightP = toOriginalSpace(bottomRightP);\r\n            origTopLeftP.x = Math.floor(origTopLeftP.x);\r\n            origTopLeftP.y = Math.floor(origTopLeftP.y);\r\n            origBottomRightP.x = Math.ceil(origBottomRightP.x);\r\n            origBottomRightP.y = Math.ceil(origBottomRightP.y);\r\n            return {\r\n                x: origTopLeftP.x,\r\n                y: origTopLeftP.y,\r\n                width: origBottomRightP.x - origTopLeftP.x,\r\n                height: origBottomRightP.y - origTopLeftP.y,\r\n            };\r\n        };\r\n\r\n\r\n\r\n        let startP: IVector2D | null;\r\n        let startCrop: IRect | null = null;\r\n        let isDragging = false;\r\n        let didMove = false;\r\n        let updateCropTimeout: ReturnType<typeof setTimeout>;\r\n        this.pointerListener = new BB.PointerListener({\r\n            target: this.eventTarget,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    event.eventPreventDefault();\r\n                    isDragging = true;\r\n                    startP = {\r\n                        x: event.relX,\r\n                        y: event.relY,\r\n                    };\r\n                    if (!this.isReset() && isInsideSelectionRect(startP)) {\r\n                        startCrop = {\r\n                            x: this.crop.x,\r\n                            y: this.crop.y,\r\n                            width: this.crop.width,\r\n                            height: this.crop.height,\r\n                        };\r\n                    } else {\r\n                        this.crop = genCrop(startP, startP);\r\n                    }\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                    event.eventPreventDefault();\r\n                    didMove = true;\r\n                    if (startCrop) {\r\n                        this.crop.x = startCrop.x + Math.round((event.relX - startP!.x) / this.scaleW);\r\n                        this.crop.y = startCrop.y + Math.round((event.relY - startP!.y) / this.scaleH);\r\n                        this.crop.x = BB.clamp(this.crop.x, 0, this.canvas.width - this.crop.width);\r\n                        this.crop.y = BB.clamp(this.crop.y, 0, this.canvas.height - this.crop.height);\r\n                    } else {\r\n                        this.crop = genCrop(startP!, {x: event.relX, y: event.relY});\r\n                    }\r\n                    this.updateSelectionRect();\r\n                } else if (event.type === 'pointerup' && startP) {\r\n                    event.eventPreventDefault();\r\n                    isDragging = false;\r\n                    startCrop = null;\r\n                    startP = null;\r\n                    if (this.crop.width === 0 || this.crop.height === 0 || !didMove) {\r\n                        this.resetCrop();\r\n                        this.updateSelectionRect();\r\n                    }\r\n                    didMove = false;\r\n                    updateCropTimeout = setTimeout(() => this.updateCroppedCanvas(), 1);\r\n                }\r\n            },\r\n        });\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, e, comboStr) => {\r\n                if (isDragging) {\r\n                    return;\r\n                }\r\n                let doUpdate = false;\r\n\r\n                const stepSize = Math.max(1, 1 / this.scaleW);\r\n                const shiftIsPressed = this.keyListener.isPressed('shift');\r\n\r\n                if (keyStr === 'left') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.width = BB.clamp(this.crop.width - stepSize, 1, this.canvas.width - this.crop.x);\r\n                    } else {\r\n                        this.crop.x = BB.clamp(this.crop.x - stepSize, 0, this.canvas.width - this.crop.width);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n                if (keyStr === 'right') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.width = BB.clamp(this.crop.width + stepSize, 1, this.canvas.width - this.crop.x);\r\n                    } else {\r\n                        this.crop.x = BB.clamp(this.crop.x + stepSize, 0, this.canvas.width - this.crop.width);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n                if (keyStr === 'up') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.height = BB.clamp(this.crop.height - stepSize, 1, this.canvas.height - this.crop.y);\r\n                    } else {\r\n                        this.crop.y = BB.clamp(this.crop.y - stepSize, 0, this.canvas.height - this.crop.height);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n                if (keyStr === 'down') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.height = BB.clamp(this.crop.height + stepSize, 1, this.canvas.height - this.crop.y);\r\n                    } else {\r\n                        this.crop.y = BB.clamp(this.crop.y + stepSize, 0, this.canvas.height - this.crop.height);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n\r\n                if (doUpdate) {\r\n                    e.preventDefault();\r\n                    this.updateSelectionRect();\r\n                    clearTimeout(updateCropTimeout);\r\n                    updateCropTimeout = setTimeout(() => this.updateCroppedCanvas(), 100);\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getEl (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n    reset (): void {\r\n        this.resetCrop();\r\n        this.updateCroppedCanvas();\r\n        this.updateSelectionRect();\r\n    }\r\n    destroy (): void {\r\n        this.eventTarget.style.removeProperty('width');\r\n        this.eventTarget.style.removeProperty('height');\r\n        this.keyListener.destroy();\r\n        this.pointerListener.destroy();\r\n    }\r\n    isReset (): boolean {\r\n        return this.crop.x === 0 && this.crop.y === 0 && this.crop.width === this.canvas.width && this.crop.height === this.canvas.height;\r\n    }\r\n    getRect (): IRect {\r\n        return BB.copyObj(this.crop);\r\n    }\r\n    getCroppedImage (): HTMLCanvasElement {\r\n        return this.croppedCanvas;\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {showModal} from './base/showModal';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {LANG} from '../../../language/language';\r\nimport {StatusOverlay} from '../components/status-overlay';\r\nimport {ICropRect} from '../../../bb/bb-types';\r\n\r\nexport function clipboardDialog (\r\n    parent: HTMLElement,\r\n    fullCanvas: HTMLCanvasElement,\r\n    cropCallback: (crop: ICropRect) => void,\r\n    output: StatusOverlay,\r\n    showCrop: boolean, // show crop button\r\n): void {\r\n\r\n    let clipboardItemIsSupported: boolean = false;\r\n    try {\r\n        clipboardItemIsSupported = !!ClipboardItem;\r\n    } catch (e) { /* empty */ }\r\n\r\n    const div = document.createElement('div');\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n\r\n    const topWrapper = BB.el({\r\n        content: LANG('crop-drag-to-crop') + (clipboardItemIsSupported ? '' : '<br>' + LANG('cropcopy-click-hold')),\r\n        css: {\r\n            textAlign: 'center',\r\n        },\r\n    });\r\n    div.append(topWrapper);\r\n\r\n\r\n    const cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 350,\r\n        canvas: fullCanvas,\r\n        isNotCopy: false,\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n    });\r\n    div.append(cropCopy.getEl());\r\n\r\n    function toClipboard () {\r\n        const imgURL = cropCopy.getCroppedImage().toDataURL('image/png');\r\n        setTimeout(async function () {\r\n            try {\r\n                const data = await fetch(imgURL);\r\n                const blob = await data.blob();\r\n                await (navigator.clipboard as any).write([\r\n                    new ClipboardItem({\r\n                        [blob.type]: blob,\r\n                    } as any), // todo check is possible?\r\n                ]);\r\n                setTimeout(function () {\r\n                    output.out(LANG('cropcopy-copied'), true);\r\n                }, 200);\r\n            } catch (err) {\r\n                console.error((err as Error).name, (err as Error).message);\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, KeyEvent, comboStr) {\r\n            if (comboStr === 'ctrl+c') {\r\n                toClipboard();\r\n                closeFunc && closeFunc();\r\n            }\r\n        },\r\n    });\r\n\r\n    let closeFunc: () => void;\r\n    function blur () {\r\n        closeFunc && closeFunc();\r\n    }\r\n    window.addEventListener('blur', blur);\r\n\r\n    const buttonArr = [];\r\n    if (clipboardItemIsSupported) {\r\n        buttonArr.push(LANG('cropcopy-btn-copy'));\r\n    }\r\n    if (showCrop) {\r\n        buttonArr.push(LANG('cropcopy-btn-crop'));\r\n    }\r\n    buttonArr.push('Cancel');\r\n\r\n    showModal({\r\n        target: parent,\r\n        message: '<b>' + (showCrop ? `${LANG('cropcopy-title-copy')} / ${LANG('cropcopy-title-crop')}` : `${LANG('cropcopy-title-copy')}`) + '</b>',\r\n        div: div,\r\n        style: isSmall ? {} : {\r\n            width: '540px',\r\n        },\r\n        buttons: buttonArr,\r\n        primaries: [LANG('cropcopy-btn-copy')],\r\n        callback: function (result) {\r\n            if (result === LANG('cropcopy-btn-copy')) {\r\n                toClipboard();\r\n            } else if (result === LANG('cropcopy-btn-crop')) {\r\n                const rectObj = cropCopy.getRect();\r\n                cropCallback({\r\n                    left: Math.round(-rectObj.x),\r\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\r\n                    top: Math.round(-rectObj.y),\r\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height),\r\n                });\r\n            }\r\n            window.removeEventListener('blur', blur);\r\n            cropCopy.destroy();\r\n            keyListener.destroy();\r\n        },\r\n        clickOnEnter: LANG('cropcopy-btn-copy'),\r\n        closeFunc: function (func) {\r\n            closeFunc = func;\r\n        },\r\n    });\r\n}","import {BB} from '../../../../bb/bb';\r\nimport {klHistory} from '../../../history/kl-history';\r\nimport {Select} from '../../components/select';\r\nimport {PointSlider} from '../../components/point-slider';\r\nimport {KlCanvas, MAX_LAYERS} from '../../../canvas/kl-canvas';\r\nimport {TMixMode, TUiLayout} from '../../../kl-types';\r\nimport {LANG} from '../../../../language/language';\r\nimport {translateBlending} from '../../../canvas/translate-blending';\r\nimport {PointerListener} from '../../../../bb/input/pointer-listener';\r\nimport {IPointerEvent} from '../../../../bb/input/event.types';\r\nimport {renameLayerDialog} from './rename-layer-dialog';\r\nimport {mergeLayerDialog} from './merge-layer-dialog';\r\nimport addLayerImg from '/src/app/img/ui/add-layer.svg';\r\nimport duplicateLayerImg from '/src/app/img/ui/duplicate-layer.svg';\r\nimport mergeLayerImg from '/src/app/img/ui/merge-layers.svg';\r\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\r\nimport renameLayerImg from '/src/app/img/ui/rename-layer.svg';\r\nimport {theme} from '../../../../theme/theme';\r\nimport {throwIfNull} from '../../../../bb/base/base';\r\nimport {hasPointerEvents} from '../../../../bb/base/browser';\r\n\r\ntype TLayerEl = HTMLElement & {\r\n    label: HTMLElement;\r\n    opacityLabel: HTMLElement;\r\n    thumb: HTMLCanvasElement;\r\n\r\n    spot: number;\r\n    posY: number;\r\n    layerName: string;\r\n    opacity: number;\r\n    pointerListener: PointerListener;\r\n    opacitySlider: PointSlider;\r\n    isSelected: boolean;\r\n};\r\n\r\nconst paddingLeft = 25;\r\n\r\nexport class LayerManager {\r\n\r\n    private readonly parentEl: HTMLElement;\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly klCanvas: KlCanvas;\r\n    private klCanvasLayerArr: {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: TMixMode;\r\n    }[];\r\n    private readonly layerListEl: HTMLElement;\r\n    private layerElArr: TLayerEl[];\r\n    private selectedSpotIndex: number;\r\n    private readonly removeBtn: HTMLButtonElement;\r\n    private readonly addBtn: HTMLButtonElement;\r\n    private readonly duplicateBtn: HTMLButtonElement;\r\n    private readonly mergeBtn: HTMLButtonElement;\r\n    private readonly modeSelect: Select<TMixMode>;\r\n    private uiState: TUiLayout;\r\n    private readonly largeThumbDiv: HTMLElement;\r\n    private oldHistoryState: number | undefined;\r\n\r\n    private readonly largeThumbCanvas: HTMLCanvasElement;\r\n    private largeThumbInDocument: boolean;\r\n    private largeThumbInTimeout: undefined | ReturnType<typeof setTimeout>;\r\n    private largeThumbTimeout: undefined | ReturnType<typeof setTimeout>;\r\n    private lastpos: number = 0;\r\n\r\n    private readonly onSelect: (layerIndex: number) => void;\r\n    private readonly layerHeight: number = 35;\r\n    private readonly layerSpacing: number = 0;\r\n\r\n    private move (oldSpotIndex: number, newSpotIndex: number): void {\r\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) {\r\n            throw 'layermanager - invalid move';\r\n        }\r\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\r\n            ((i) => {\r\n                let posy = this.layerElArr[i].spot; // <- here\r\n                if (this.layerElArr[i].spot === oldSpotIndex) {\r\n                    posy = newSpotIndex;\r\n                } else {\r\n                    if (this.layerElArr[i].spot > oldSpotIndex) {\r\n                        posy--;\r\n                    }\r\n                    if (posy >= newSpotIndex) {\r\n                        posy++;\r\n                    }\r\n                }\r\n                this.layerElArr[i].spot = posy;\r\n                this.layerElArr[i].posY = (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\r\n                this.layerElArr[i].style.top = this.layerElArr[i].posY + 'px';\r\n            })(i);\r\n        }\r\n        if (oldSpotIndex === newSpotIndex) {\r\n            return;\r\n        }\r\n        this.klCanvas.moveLayer(this.selectedSpotIndex, newSpotIndex - oldSpotIndex);\r\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n        this.selectedSpotIndex = newSpotIndex;\r\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\r\n    }\r\n\r\n    private posToSpot (p: number): number {\r\n        let result = parseInt('' + (p / (this.layerHeight + this.layerSpacing) + 0.5));\r\n        result = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, result));\r\n        result = this.klCanvasLayerArr.length - result - 1;\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * update css position of all layers that are not being dragged, while dragging\r\n     */\r\n    private updateLayersVerticalPosition (id: number, newspot: number): void {\r\n        newspot = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, newspot));\r\n        if (newspot === this.lastpos) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\r\n            if (this.layerElArr[i].spot === id) { // <- here\r\n                continue;\r\n            }\r\n            let posy = this.layerElArr[i].spot;\r\n            if (this.layerElArr[i].spot > id) {\r\n                posy--;\r\n            }\r\n            if (posy >= newspot) {\r\n                posy++;\r\n            }\r\n            this.layerElArr[i].posY = (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\r\n            this.layerElArr[i].style.top = this.layerElArr[i].posY + 'px';\r\n        }\r\n        this.lastpos = newspot;\r\n    }\r\n\r\n    private renameLayer (layerSpot: number): void {\r\n\r\n        renameLayerDialog(\r\n            this.parentEl,\r\n            this.klCanvas.getLayer(layerSpot)!.name,\r\n            (newName) => {\r\n                if (newName === undefined || newName === this.klCanvas.getLayer(layerSpot)!.name) {\r\n                    return;\r\n                }\r\n                this.klCanvas.renameLayer(layerSpot, newName);\r\n                this.createLayerList();\r\n                klHistory.pause(true);\r\n                this.onSelect(layerSpot);\r\n                klHistory.pause(false);\r\n            }\r\n        );\r\n    }\r\n\r\n    private updateHeight (): void {\r\n        this.layerListEl.style.height = (this.layerElArr.length * 35) + 'px';\r\n    }\r\n\r\n    private createLayerList (): void {\r\n        this.oldHistoryState = klHistory.getState();\r\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n        const checkerImUrl = BB.createCheckerDataUrl(4, undefined, theme.isDark());\r\n\r\n        const createLayerEntry = (index: number): void => {\r\n            const klLayer = throwIfNull(this.klCanvas.getLayer(index));\r\n            const layerName = klLayer.name;\r\n            const opacity = this.klCanvasLayerArr[index].opacity;\r\n            const isVisible = klLayer.isVisible;\r\n            const layercanvas = this.klCanvasLayerArr[index].context.canvas;\r\n\r\n            const layer: TLayerEl = BB.el({\r\n                className: 'kl-layer',\r\n            }) as HTMLElement as TLayerEl;\r\n            this.layerElArr[index] = layer;\r\n            layer.posY = ((this.klCanvasLayerArr.length - 1) * 35 - index * 35);\r\n            BB.css(layer, {\r\n                top: layer.posY + 'px',\r\n            });\r\n            const innerLayer = BB.el();\r\n            BB.css(innerLayer, {\r\n                position: 'relative',\r\n            });\r\n\r\n            const container1 = BB.el();\r\n            BB.css(container1, {\r\n                width: '270px',\r\n                height: '34px',\r\n            });\r\n            const container2 = BB.el();\r\n            layer.append(innerLayer);\r\n            innerLayer.append(container1, container2);\r\n\r\n            layer.spot = index;\r\n\r\n            //checkbox - visibility\r\n            {\r\n                const checkWrapper = BB.el({\r\n                    tagName: 'label',\r\n                    parent: container1,\r\n                    title: LANG('layers-visibility-toggle'),\r\n                    css: {\r\n                        display: 'flex',\r\n                        width: '25px',\r\n                        height: '100%',\r\n                        justifyContent: 'right',\r\n                        alignItems: 'center',\r\n                        cursor: 'pointer',\r\n                    },\r\n                });\r\n                const check = BB.el({\r\n                    tagName: 'input',\r\n                    parent: checkWrapper,\r\n                    custom: {\r\n                        type: 'checkbox',\r\n                        tabindex: '-1',\r\n                    },\r\n                    css: {\r\n                        display: 'block',\r\n                        cursor: 'pointer',\r\n                        margin: '0',\r\n                        marginRight: '5px',\r\n                    },\r\n                });\r\n                check.checked = isVisible;\r\n                check.onchange = () => {\r\n                    this.klCanvas.setLayerIsVisible(layer.spot, check.checked);\r\n                    this.createLayerList();\r\n                    if (layer.spot === this.selectedSpotIndex) {\r\n                        klHistory.pause(true);\r\n                        this.onSelect(this.selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                };\r\n                // prevent layer getting dragged\r\n                const preventFunc = (e: PointerEvent | MouseEvent) => {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                };\r\n                if (hasPointerEvents) {\r\n                    checkWrapper.onpointerdown = preventFunc;\r\n                } else {\r\n                    checkWrapper.onmousedown = preventFunc;\r\n                }\r\n            }\r\n\r\n\r\n            //thumb\r\n            {\r\n                const thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\r\n                layer.thumb = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n\r\n                const thc = BB.ctx(layer.thumb);\r\n                thc.save();\r\n                if (layer.thumb.width > layercanvas.width) {\r\n                    thc.imageSmoothingEnabled = false;\r\n                }\r\n                thc.drawImage(layercanvas, 0, 0, layer.thumb.width, layer.thumb.height);\r\n                thc.restore();\r\n                BB.css(layer.thumb, {\r\n                    position: 'absolute',\r\n                    left: ((32 - layer.thumb.width) / 2 + paddingLeft) + 'px',\r\n                    top: ((32 - layer.thumb.height) / 2 + 1) + 'px',\r\n                });\r\n                layer.thumb.style.backgroundImage = 'url(' + checkerImUrl + ')';\r\n            }\r\n\r\n            //layerlabel\r\n            {\r\n                layer.label = BB.el({\r\n                    className: 'kl-layer__label',\r\n                });\r\n                layer.layerName = layerName;\r\n                layer.label.append(layer.layerName);\r\n\r\n                BB.css(layer.label, {\r\n                    position: 'absolute',\r\n                    left: (1 + 32 + 5 + paddingLeft) + 'px',\r\n                    top: 1 + 'px',\r\n                    fontSize: '13px',\r\n                    width: '170px',\r\n                    height: '20px',\r\n                    overflow: 'hidden',\r\n                    whiteSpace: 'nowrap',\r\n                });\r\n\r\n                layer.label.ondblclick = () => {\r\n                    this.renameLayer(layer.spot);\r\n                };\r\n            }\r\n            //layer label opacity\r\n            {\r\n                layer.opacityLabel = BB.el({\r\n                    className: 'kl-layer__opacity-label',\r\n                });\r\n                layer.opacity = opacity;\r\n                layer.opacityLabel.append(parseInt('' + (layer.opacity * 100)) + '%');\r\n\r\n                BB.css(layer.opacityLabel, {\r\n                    position: 'absolute',\r\n                    left: (250 - 1 - 5 - 50 - 5 + paddingLeft) + 'px',\r\n                    top: 1 + 'px',\r\n                    fontSize: '13px',\r\n                    textAlign: 'right',\r\n                    width: '50px',\r\n                    transition: 'color 0.2s ease-in-out',\r\n                    textDecoration: isVisible ? undefined : 'line-through',\r\n                });\r\n            }\r\n\r\n            let oldOpacity: number;\r\n            const opacitySlider = new PointSlider({\r\n                init: layer.opacity,\r\n                width: 200,\r\n                pointSize: 14,\r\n                callback: (sliderValue, isFirst, isLast) => {\r\n                    if (isFirst) {\r\n                        oldOpacity = this.klCanvas.getLayer(layer.spot)!.opacity;\r\n                        klHistory.pause(true);\r\n                        return;\r\n                    }\r\n                    if (isLast) {\r\n                        klHistory.pause(false);\r\n                        if (oldOpacity !== sliderValue) {\r\n                            this.klCanvas.layerOpacity(layer.spot, sliderValue);\r\n                        }\r\n                        return;\r\n                    }\r\n                    layer.opacityLabel.innerHTML = Math.round(sliderValue * 100) + '%';\r\n                    this.klCanvas.layerOpacity(layer.spot, sliderValue);\r\n                },\r\n            });\r\n            BB.css(opacitySlider.getEl(), {\r\n                position: 'absolute',\r\n                left: (39 + paddingLeft) + 'px',\r\n                top: '17px',\r\n            });\r\n            layer.opacitySlider = opacitySlider;\r\n\r\n            //larger layer preview - hover\r\n            layer.thumb.onpointerover = (e) => {\r\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== 'touch')) { //shouldn't show while dragging\r\n                    return;\r\n                }\r\n\r\n                const thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\r\n\r\n                if (this.largeThumbCanvas.width !== thumbDimensions.width || this.largeThumbCanvas.height !== thumbDimensions.height) {\r\n                    this.largeThumbCanvas.width = thumbDimensions.width;\r\n                    this.largeThumbCanvas.height = thumbDimensions.height;\r\n                }\r\n                const ctx = BB.ctx(this.largeThumbCanvas);\r\n                ctx.save();\r\n                if (this.largeThumbCanvas.width > layercanvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.imageSmoothingQuality = 'high';\r\n                ctx.clearRect(0, 0, this.largeThumbCanvas.width, this.largeThumbCanvas.height);\r\n                ctx.drawImage(layercanvas, 0, 0, this.largeThumbCanvas.width, this.largeThumbCanvas.height);\r\n                ctx.restore();\r\n                BB.css(this.largeThumbDiv, {\r\n                    top: (e.clientY - this.largeThumbCanvas.height / 2) + 'px',\r\n                    opacity: '0',\r\n                });\r\n                if (!this.largeThumbInDocument) {\r\n                    document.body.append(this.largeThumbDiv);\r\n                    this.largeThumbInDocument = true;\r\n                }\r\n                clearTimeout(this.largeThumbInTimeout);\r\n                this.largeThumbInTimeout = setTimeout(() => {\r\n                    BB.css(this.largeThumbDiv, {\r\n                        opacity: '1',\r\n                    });\r\n                }, 20);\r\n                clearTimeout(this.largeThumbTimeout);\r\n            };\r\n            layer.thumb.onpointerout = () => {\r\n                clearTimeout(this.largeThumbInTimeout);\r\n                BB.css(this.largeThumbDiv, {\r\n                    opacity: '0',\r\n                });\r\n                clearTimeout(this.largeThumbTimeout);\r\n                this.largeThumbTimeout = setTimeout(() => {\r\n                    if (!this.largeThumbInDocument) {\r\n                        return;\r\n                    }\r\n                    this.largeThumbDiv.remove();\r\n                    this.largeThumbInDocument = false;\r\n                }, 300);\r\n            };\r\n\r\n            container1.append(layer.thumb, layer.label, layer.opacityLabel, opacitySlider.getEl());\r\n            let dragstart = false;\r\n            let freshSelection = false;\r\n\r\n            //events for moving layers up and down\r\n            const dragEventHandler = (event: IPointerEvent) => {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    BB.css(layer, {\r\n                        transition: 'box-shadow 0.3s ease-in-out',\r\n                    });\r\n                    layer.style.zIndex = '1';\r\n                    this.lastpos = layer.spot;\r\n                    freshSelection = false;\r\n                    if (!layer.isSelected) {\r\n                        freshSelection = true;\r\n                        this.activateLayer(layer.spot);\r\n                    }\r\n                    dragstart = true;\r\n\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    if (dragstart) {\r\n                        dragstart = false;\r\n                        BB.css(layer, {\r\n                            boxShadow: '1px 3px 5px rgba(0,0,0,0.4)',\r\n                        });\r\n                    }\r\n                    layer.posY += event.dY;\r\n                    const corrected = Math.max(0, Math.min((this.klCanvasLayerArr.length - 1) * (35), layer.posY));\r\n                    layer.style.top = corrected + 'px';\r\n                    this.updateLayersVerticalPosition(layer.spot, this.posToSpot(layer.posY));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(layer, {\r\n                        transition: 'all 0.1s linear',\r\n                    });\r\n                    setTimeout(() => {\r\n                        BB.css(layer, {\r\n                            boxShadow: '',\r\n                        });\r\n                    }, 20);\r\n                    layer.posY = Math.max(0, Math.min((this.klCanvasLayerArr.length - 1) * (35), layer.posY));\r\n                    layer.style.zIndex = '';\r\n                    const newSpot = this.posToSpot(layer.posY);\r\n                    const oldSpot = layer.spot;\r\n                    this.move(layer.spot, newSpot);\r\n                    if (oldSpot != newSpot) {\r\n                        klHistory.pause(true);\r\n                        this.onSelect(this.selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                    if (oldSpot === newSpot && freshSelection) {\r\n                        this.onSelect(this.selectedSpotIndex);\r\n                    }\r\n                    freshSelection = false;\r\n                }\r\n            };\r\n\r\n            layer.pointerListener = new BB.PointerListener({\r\n                target: container1,\r\n                onPointer: dragEventHandler,\r\n            });\r\n\r\n            this.layerListEl.append(layer);\r\n        };\r\n        this.layerElArr = [];\r\n        while (this.layerListEl.firstChild) {\r\n            const child = this.layerListEl.firstChild as TLayerEl;\r\n            child.pointerListener.destroy();\r\n            child.opacitySlider.destroy();\r\n            child.remove();\r\n        }\r\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\r\n            createLayerEntry(i);\r\n        }\r\n        this.activateLayer(this.selectedSpotIndex);\r\n        this.updateHeight();\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        klCanvas: KlCanvas,\r\n        onSelect: (layerIndex: number) => void,\r\n        parentEl: HTMLElement,\r\n        uiState: TUiLayout,\r\n    ) {\r\n        this.parentEl = parentEl;\r\n        this.klCanvas = klCanvas;\r\n        this.layerElArr = [];\r\n        this.layerHeight = 35;\r\n        this.layerSpacing = 0;\r\n        const width = 270;\r\n        this.onSelect = onSelect;\r\n        this.uiState = uiState;\r\n\r\n        this.largeThumbDiv = BB.el({\r\n            onClick: BB.handleClick,\r\n            css: {\r\n                position: 'absolute',\r\n                top: '500px',\r\n                background: '#aaa',\r\n                boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\r\n                pointerEvents: 'none',\r\n                padding: '0',\r\n                border: '1px solid #aaa',\r\n                transition: 'opacity 0.3s ease-out',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.setUiState(uiState);\r\n        BB.createCheckerDataUrl(4, (url) => {\r\n            this.largeThumbDiv.style.backgroundImage = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n        this.largeThumbCanvas = BB.canvas(200, 200);\r\n        this.largeThumbCanvas.style.display = 'block';\r\n        this.largeThumbDiv.append(this.largeThumbCanvas);\r\n        this.largeThumbInDocument = false;\r\n\r\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n        this.selectedSpotIndex = this.klCanvasLayerArr.length - 1;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                marginRight: '10px',\r\n                marginBottom: '10px',\r\n                marginLeft: '10px',\r\n                marginTop: '10px',\r\n                cursor: 'default',\r\n            },\r\n        });\r\n\r\n        const listDiv = BB.el({\r\n            css: {\r\n                width: width + 'px',\r\n                position: 'relative',\r\n                margin: '0 -10px',\r\n                zIndex: '0',\r\n            },\r\n        });\r\n\r\n        this.layerListEl = BB.el({\r\n            parent: listDiv,\r\n        });\r\n\r\n        this.addBtn = BB.el({tagName: 'button'});\r\n        this.duplicateBtn = BB.el({tagName: 'button'});\r\n        this.mergeBtn = BB.el({tagName: 'button'});\r\n        this.removeBtn = BB.el({tagName: 'button'});\r\n        const renameBtn = BB.el({tagName: 'button'});\r\n\r\n        const createButtons = () => {\r\n            const div = BB.el();\r\n            const async = () => {\r\n                BB.makeUnfocusable(this.addBtn);\r\n                BB.makeUnfocusable(this.duplicateBtn);\r\n                BB.makeUnfocusable(this.mergeBtn);\r\n                BB.makeUnfocusable(this.removeBtn);\r\n                BB.makeUnfocusable(renameBtn);\r\n\r\n                this.addBtn.style.cssFloat = 'left';\r\n                this.duplicateBtn.style.cssFloat = 'left';\r\n                this.mergeBtn.style.cssFloat = 'left';\r\n                this.removeBtn.style.cssFloat = 'left';\r\n                renameBtn.style.cssFloat = 'left';\r\n\r\n                this.addBtn.title = LANG('layers-new');\r\n                this.duplicateBtn.title = LANG('layers-duplicate');\r\n                this.removeBtn.title = LANG('layers-remove');\r\n                this.mergeBtn.title = LANG('layers-merge');\r\n                renameBtn.title = LANG('layers-rename-title');\r\n\r\n                this.addBtn.style.paddingLeft = '5px';\r\n                this.addBtn.style.paddingRight = '3px';\r\n\r\n                this.removeBtn.style.paddingLeft = '5px';\r\n                this.removeBtn.style.paddingRight = '3px';\r\n\r\n                this.duplicateBtn.style.paddingLeft = '5px';\r\n                this.duplicateBtn.style.paddingRight = '3px';\r\n\r\n                this.mergeBtn.style.paddingLeft = '5px';\r\n                this.mergeBtn.style.paddingRight = '3px';\r\n\r\n                renameBtn.style.height = '30px';\r\n                renameBtn.style.lineHeight = '20px';\r\n\r\n                this.addBtn.innerHTML = \"<img src='\" + addLayerImg + \"' height='20'/>\";\r\n                this.duplicateBtn.innerHTML = \"<img src='\" + duplicateLayerImg + \"' height='20'/>\";\r\n                this.mergeBtn.innerHTML = \"<img src='\" + mergeLayerImg + \"' height='20'/>\";\r\n                this.removeBtn.innerHTML = \"<img src='\" + removeLayerImg + \"' height='20'/>\";\r\n                renameBtn.innerHTML = \"<img src='\" + renameLayerImg + \"' height='20'/>\";\r\n                this.addBtn.style.marginRight = '5px';\r\n                this.removeBtn.style.marginRight = '5px';\r\n                this.duplicateBtn.style.marginRight = '5px';\r\n                this.mergeBtn.style.marginRight = '5px';\r\n                div.append(\r\n                    this.addBtn,\r\n                    this.removeBtn,\r\n                    this.duplicateBtn,\r\n                    this.mergeBtn,\r\n                    renameBtn,\r\n                    BB.el({\r\n                        css: {\r\n                            clear: 'both',\r\n                            height: '10px',\r\n                        },\r\n                    }),\r\n                );\r\n\r\n                this.addBtn.onclick = () => {\r\n                    if (this.klCanvas.addLayer(this.selectedSpotIndex) === false) {\r\n                        return;\r\n                    }\r\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n\r\n                    if (this.klCanvasLayerArr.length === MAX_LAYERS) {\r\n                        this.addBtn.disabled = true;\r\n                        this.duplicateBtn.disabled = true;\r\n                    }\r\n                    this.removeBtn.disabled = false;\r\n                    this.selectedSpotIndex = this.selectedSpotIndex + 1;\r\n                    this.createLayerList();\r\n                    klHistory.pause(true);\r\n                    this.onSelect(this.selectedSpotIndex);\r\n                    klHistory.pause(false);\r\n                };\r\n                this.duplicateBtn.onclick = () => {\r\n                    if (this.klCanvas.duplicateLayer(this.selectedSpotIndex) === false) {\r\n                        return;\r\n                    }\r\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n                    if (this.klCanvasLayerArr.length === MAX_LAYERS) {\r\n                        this.addBtn.disabled = true;\r\n                        this.duplicateBtn.disabled = true;\r\n                    }\r\n                    this.removeBtn.disabled = false;\r\n                    this.selectedSpotIndex++;\r\n                    this.createLayerList();\r\n                    klHistory.pause(true);\r\n                    this.onSelect(this.selectedSpotIndex);\r\n                    klHistory.pause(false);\r\n                };\r\n                this.removeBtn.onclick = () => {\r\n                    if (this.layerElArr.length <= 1) {\r\n                        return;\r\n                    }\r\n\r\n                    this.klCanvas.removeLayer(this.selectedSpotIndex);\r\n                    if (this.selectedSpotIndex > 0) {\r\n                        this.selectedSpotIndex--;\r\n                    }\r\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n                    this.createLayerList();\r\n                    klHistory.pause(true);\r\n                    this.onSelect(this.selectedSpotIndex);\r\n                    klHistory.pause(false);\r\n                    if (this.klCanvasLayerArr.length === 1) {\r\n                        this.removeBtn.disabled = true;\r\n                    }\r\n                    if (this.klCanvasLayerArr.length < MAX_LAYERS) {\r\n                        this.addBtn.disabled = false;\r\n                        this.duplicateBtn.disabled = false;\r\n                    }\r\n                };\r\n                this.mergeBtn.onclick = () => {\r\n                    if (this.selectedSpotIndex <= 0) {\r\n                        return;\r\n                    }\r\n                    mergeLayerDialog(this.parentEl, {\r\n                        topCanvas: this.klCanvasLayerArr[this.selectedSpotIndex].context.canvas,\r\n                        bottomCanvas: this.klCanvasLayerArr[this.selectedSpotIndex - 1].context.canvas,\r\n                        topOpacity: this.klCanvas.getLayer(this.selectedSpotIndex)!.opacity,\r\n                        mixModeStr: this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr,\r\n                        callback: (mode) => {\r\n                            this.klCanvas.mergeLayers(this.selectedSpotIndex, this.selectedSpotIndex - 1, mode as TMixMode | 'as-alpha');\r\n                            this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n                            this.selectedSpotIndex--;\r\n                            if (this.klCanvasLayerArr.length === 1) {\r\n                                this.removeBtn.disabled = true;\r\n                            }\r\n                            if (this.klCanvasLayerArr.length < MAX_LAYERS) {\r\n                                this.addBtn.disabled = false;\r\n                                this.duplicateBtn.disabled = false;\r\n                            }\r\n                            this.createLayerList();\r\n                            klHistory.pause(true);\r\n                            this.onSelect(this.selectedSpotIndex);\r\n                            klHistory.pause(false);\r\n                        },\r\n                    });\r\n                };\r\n\r\n                renameBtn.onclick = () => {\r\n                    this.renameLayer(this.selectedSpotIndex);\r\n                };\r\n            };\r\n            setTimeout(async, 1);\r\n            return div;\r\n        };\r\n        this.rootEl.append(createButtons());\r\n\r\n        let modeWrapper;\r\n        {\r\n            modeWrapper = BB.el({\r\n                content: LANG('layers-blending') + '&nbsp;',\r\n                css: {\r\n                    fontSize: '15px',\r\n                },\r\n            });\r\n\r\n            this.modeSelect = new Select<TMixMode>({\r\n                optionArr: [\r\n                    'source-over',\r\n                    undefined,\r\n                    'darken',\r\n                    'multiply',\r\n                    'color-burn',\r\n                    undefined,\r\n                    'lighten',\r\n                    'screen',\r\n                    'color-dodge',\r\n                    undefined,\r\n                    'overlay',\r\n                    'soft-light',\r\n                    'hard-light',\r\n                    undefined,\r\n                    'difference',\r\n                    'exclusion',\r\n                    undefined,\r\n                    'hue',\r\n                    'saturation',\r\n                    'color',\r\n                    'luminosity',\r\n                ].map((item: any) => {\r\n                    return item ? [item, translateBlending(item)] : undefined;\r\n                }),\r\n                onChange: (val) => {\r\n                    this.klCanvas.setMixMode(this.selectedSpotIndex, val as TMixMode);\r\n                    this.update(this.selectedSpotIndex);\r\n                },\r\n                css: {\r\n                    marginBottom: '10px',\r\n                },\r\n            });\r\n\r\n            modeWrapper.append(this.modeSelect.getElement());\r\n            this.rootEl.append(modeWrapper);\r\n\r\n        }\r\n\r\n\r\n        this.rootEl.append(listDiv);\r\n\r\n        //updating the thumbs in interval\r\n        //don't update when: manager not visible || layer didn't change || is drawing\r\n        setInterval(() => {\r\n            if (this.rootEl.style.display !== 'block') {\r\n                return;\r\n            }\r\n\r\n            const historyState = klHistory.getState();\r\n            if (historyState === this.oldHistoryState) {\r\n                return;\r\n            }\r\n            this.oldHistoryState = historyState;\r\n\r\n            for (let i = 0; i < this.layerElArr.length; i++) {\r\n                if (this.selectedSpotIndex === this.layerElArr[i].spot && this.klCanvasLayerArr[this.layerElArr[i].spot]) { // second check, because might be out of date\r\n                    const ctx = BB.ctx(this.layerElArr[i].thumb);\r\n                    ctx.save();\r\n                    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n                    if (this.klCanvasLayerArr[this.layerElArr[i].spot].context.canvas.width < this.layerElArr[i].thumb.width) {\r\n                        ctx.imageSmoothingEnabled = false;\r\n                    }\r\n                    ctx.drawImage(this.klCanvasLayerArr[this.layerElArr[i].spot].context.canvas, 0, 0, this.layerElArr[i].thumb.width, this.layerElArr[i].thumb.height);\r\n                    ctx.restore();\r\n                }\r\n            }\r\n\r\n        }, 1);\r\n\r\n        theme.addIsDarkListener(() => {\r\n            this.createLayerList();\r\n        });\r\n\r\n        this.createLayerList();\r\n    }\r\n\r\n    // ---- interface ----\r\n    update (activeLayerSpotIndex?: number): void {\r\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) {\r\n            this.selectedSpotIndex = activeLayerSpotIndex;\r\n        }\r\n        this.removeBtn.disabled = this.klCanvasLayerArr.length === 1;\r\n        if (this.klCanvasLayerArr.length === MAX_LAYERS) {\r\n            this.addBtn.disabled = true;\r\n            this.duplicateBtn.disabled = true;\r\n        } else {\r\n            this.addBtn.disabled = false;\r\n            this.duplicateBtn.disabled = false;\r\n        }\r\n        setTimeout(() => this.createLayerList(), 1);\r\n    }\r\n\r\n    getSelected (): number {\r\n        return this.selectedSpotIndex;\r\n    }\r\n\r\n    activateLayer (spotIndex: number): void {\r\n        if (spotIndex < 0 || spotIndex > this.layerElArr.length - 1) {\r\n            throw 'invalid spotIndex ' + spotIndex + ', layerElArr.length ' + this.layerElArr.length;\r\n        }\r\n        this.selectedSpotIndex = spotIndex;\r\n        this.modeSelect.setValue(this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr);\r\n        for (let i = 0; i < this.layerElArr.length; i++) {\r\n            const layer = this.layerElArr[i];\r\n            const isSelected = this.selectedSpotIndex === layer.spot;\r\n\r\n            BB.css(layer, {\r\n                boxShadow: '',\r\n            });\r\n            layer.classList.toggle('kl-layer--selected', isSelected);\r\n            layer.opacitySlider.setActive(isSelected);\r\n            layer.isSelected = isSelected;\r\n        }\r\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\r\n    }\r\n\r\n    setUiState (stateStr: TUiLayout): void {\r\n        this.uiState = stateStr;\r\n\r\n        if (this.uiState === 'left') {\r\n            BB.css(this.largeThumbDiv, {\r\n                left: '280px',\r\n                right: '',\r\n            });\r\n        } else {\r\n            BB.css(this.largeThumbDiv, {\r\n                left: '',\r\n                right: '280px',\r\n            });\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {floodFillBits} from '../image-operations/flood-fill';\r\nimport {drawShape} from '../image-operations/shape-tool';\r\nimport {TRenderTextParam, renderText} from '../image-operations/render-text';\r\nimport {IGradient, IKlProject, IRGB, IShapeToolObject, TFillSampling, TKlCanvasLayer, TMixMode} from '../kl-types';\r\nimport {DecoyKlHistory, KlHistoryInterface, THistoryActions} from '../history/kl-history';\r\nimport {drawProject} from './draw-project';\r\nimport {LANG} from '../../language/language';\r\nimport {drawGradient} from '../image-operations/gradient-tool';\r\nimport {nullToUndefined} from '../../bb/base/base';\r\n\r\nexport type TKlCanvasHistoryEntry = THistoryActions<'canvas', KlCanvas>;\r\n\r\nconst allowedMixModes = [\r\n    'source-over',\r\n    'darken',\r\n    'multiply',\r\n    'color-burn',\r\n    'lighten',\r\n    'screen',\r\n    'color-dodge',\r\n    'overlay',\r\n    'soft-light',\r\n    'hard-light',\r\n    'difference',\r\n    'exclusion',\r\n    'hue',\r\n    'saturation',\r\n    'color',\r\n    'luminosity',\r\n] as const;\r\n\r\nexport const MAX_LAYERS = 16;\r\n\r\nexport interface KlCanvasLayer extends HTMLCanvasElement {\r\n    name: string;\r\n    mixModeStr: TMixMode;\r\n    isVisible: boolean;\r\n    opacity: number;\r\n    compositeObj?: {\r\n        draw: (ctx: CanvasRenderingContext2D) => void;\r\n    };\r\n    index: number; // certain brushes need to know\r\n}\r\n\r\nexport type KlCanvasContext = CanvasRenderingContext2D & {\r\n    canvas: KlCanvasLayer;\r\n};\r\n\r\n/**\r\n * The image/canvas that the user paints on\r\n * Has layers. layers have names and opacity.\r\n *\r\n * Interacts with the history you specify (for undo/redo)\r\n */\r\nexport class KlCanvas {\r\n\r\n    // todo changeListener consistent concept\r\n    // todo history interaction, consistent concept - currently have to look at code to know if something pushes on history\r\n\r\n    private isDestroyed = false;\r\n    private width: number;\r\n    private height: number;\r\n    private layerCanvasArr: KlCanvasLayer[];\r\n    private pickCanvas: HTMLCanvasElement; // canvas to draw into for color picker\r\n    private history: KlHistoryInterface;\r\n    private changeListenerArr:  (() => void)[]; // subscribers get notified when opacity changes\r\n\r\n\r\n    private init (w: number, h: number): void {\r\n        if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            throw new Error('init - invalid canvas size: ' + w + ', ' + h);\r\n        }\r\n        this.width = w;\r\n        this.height = h;\r\n    }\r\n\r\n    private emitChange (): void {\r\n        // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\r\n        this.changeListenerArr.forEach(item => item());\r\n    }\r\n\r\n    private updateIndices (): void {\r\n        this.layerCanvasArr.forEach((item, index) => {\r\n            item.index = index;\r\n        });\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        params: {\r\n            projectObj: IKlProject;\r\n        } | {\r\n            // creates blank KlCanvas, 0 layers\r\n            width: number;\r\n            height: number;\r\n        } | {\r\n            copy: KlCanvas;\r\n        },\r\n        private layerNrOffset: number = 0,\r\n    ) {\r\n        this.layerCanvasArr = [];\r\n        this.pickCanvas = BB.canvas(1, 1);\r\n        this.history = new DecoyKlHistory();\r\n        if ('copy' in params) {\r\n            this.width = 1;\r\n            this.height = 1;\r\n        } else {\r\n            if ('width' in params && 'height' in params) {\r\n                this.width = params.width;\r\n                this.height = params.height;\r\n            } else {\r\n                this.width = 1;\r\n                this.height = 1;\r\n            }\r\n        }\r\n        this.init(this.width, this.height);\r\n\r\n        this.changeListenerArr = [];\r\n\r\n        if ('copy' in params) {\r\n            try {\r\n                this.copy(params.copy);\r\n            } catch (e) {\r\n                this.destroy();\r\n                throw e;\r\n            }\r\n        } else if ('projectObj' in params) {\r\n            const inLayers = [...params.projectObj.layers];\r\n            this.init(params.projectObj.width, params.projectObj.height);\r\n\r\n            if (!inLayers.length) {\r\n                throw new Error('project.layers needs at least 1 layer');\r\n            }\r\n\r\n            for (let i = 0; i < inLayers.length; i++) {\r\n                const mixModeStr = inLayers[i].mixModeStr;\r\n                if (mixModeStr && !allowedMixModes.includes(mixModeStr)) {\r\n                    throw new Error('unknown mixModeStr ' + inLayers[i].mixModeStr);\r\n                }\r\n\r\n                this.addLayer();\r\n                this.layerOpacity(i, inLayers[i].opacity);\r\n                this.layerCanvasArr[i].name = inLayers[i].name;\r\n                this.layerCanvasArr[i].isVisible = inLayers[i].isVisible;\r\n                this.layerCanvasArr[i].mixModeStr = mixModeStr || 'source-over';\r\n                BB.ctx(this.layerCanvasArr[i]).drawImage(inLayers[i].image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    /**\r\n     * Resets canvas -> 1 layer, 100% opacity,\r\n     * unless layers provided.\r\n     * @param p\r\n     */\r\n    reset (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n            color?: IRGB; // optional - fill color\r\n            image?: HTMLImageElement | HTMLCanvasElement; // image drawn on layer\r\n            layerName?: string; // if via image\r\n            layers?: {\r\n                name: string;\r\n                isVisible: boolean;\r\n                opacity: number;\r\n                mixModeStr: TMixMode;\r\n                image: HTMLCanvasElement;\r\n            }[];\r\n        }\r\n    ): number {\r\n        if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height) ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        this.history.pause(true);\r\n\r\n        this.width = p.width;\r\n        this.height = p.height;\r\n\r\n        this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\r\n\r\n        if (p.layers) {\r\n            for (let i = 0; i < p.layers.length; i++) {\r\n                const item = p.layers[i];\r\n                if (!this.layerCanvasArr[i]) {\r\n                    this.addLayer();\r\n                }\r\n                this.layerCanvasArr[i].name = item.name;\r\n                this.layerCanvasArr[i].isVisible = item.isVisible;\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n                this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : 'source-over';\r\n                BB.ctx(this.layerCanvasArr[i]).drawImage(item.image, 0, 0);\r\n                this.layerOpacity(i, item.opacity);\r\n            }\r\n        } else {\r\n            this.layerCanvasArr[0].name = p.layerName ? p.layerName : LANG('layers-layer') + ' 1';\r\n            this.layerCanvasArr[0].isVisible = true;\r\n            this.layerCanvasArr[0].width = this.width;\r\n            this.layerCanvasArr[0].height = this.height;\r\n            this.layerCanvasArr[0].mixModeStr = 'source-over';\r\n            this.layerOpacity(0, 1);\r\n            if (p.color) {\r\n                this.layerFill(0, p.color);\r\n            } else if (p.image) {\r\n                BB.ctx(this.layerCanvasArr[0]).drawImage(p.image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n\r\n        this.history.pause(false);\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'reset',\r\n            params: [p], // don't modify with p\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return this.layerCanvasArr.length - 1;\r\n    }\r\n\r\n    isLayerLimitReached (): boolean {\r\n        return this.layerCanvasArr.length >= MAX_LAYERS;\r\n    }\r\n\r\n    getWidth (): number {\r\n        return this.width;\r\n    }\r\n\r\n    getHeight (): number {\r\n        return this.height;\r\n    }\r\n\r\n    copy (toCopyCanvas: KlCanvas): void {\r\n        if (\r\n            toCopyCanvas.getWidth() < 1 ||\r\n            toCopyCanvas.getHeight() < 1 ||\r\n            isNaN(toCopyCanvas.getWidth()) ||\r\n            isNaN(toCopyCanvas.getHeight())\r\n        ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        // keep existing canvases\r\n\r\n        const origLayers = toCopyCanvas.getLayers();\r\n\r\n        while (this.layerCanvasArr.length > origLayers.length) {\r\n            this.removeLayer(this.layerCanvasArr.length - 1);\r\n        }\r\n\r\n        if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) {\r\n            this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\r\n        }\r\n        for (let i = 0; i < origLayers.length; i++) {\r\n            if (i >= this.layerCanvasArr.length) {\r\n                this.addLayer();\r\n            } else {\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n            }\r\n            this.layerOpacity(i, origLayers[i].opacity);\r\n            this.layerCanvasArr[i].name = origLayers[i].name;\r\n            this.layerCanvasArr[i].isVisible = origLayers[i].isVisible;\r\n            this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\r\n            BB.ctx(this.layerCanvasArr[i]).drawImage(origLayers[i].context.canvas, 0, 0);\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    getLayerCount (): number {\r\n        return this.layerCanvasArr.length;\r\n    }\r\n\r\n    resize (w: number, h: number, algorithm: 'smooth' | 'pixelated' = 'smooth'): boolean {\r\n        if (!w || !h || (w === this.width && h === this.height) || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            return false;\r\n        }\r\n        w = Math.max(w, 1);\r\n        h = Math.max(h, 1);\r\n\r\n        let tmp1, tmp2;\r\n\r\n        if (algorithm === 'pixelated') {\r\n            tmp1 = BB.canvas(w, h);\r\n            const tmp1Ctx = BB.ctx(tmp1);\r\n            tmp1Ctx.imageSmoothingEnabled = false;\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                if (i > 0) {\r\n                    tmp1Ctx.clearRect(0, 0, w, h);\r\n                }\r\n                const layerCanvas = this.layerCanvasArr[i];\r\n                tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\r\n                layerCanvas.width = w;\r\n                layerCanvas.height = h;\r\n                const layerContext = BB.ctx(layerCanvas);\r\n                layerContext.drawImage(tmp1, 0, 0);\r\n            }\r\n\r\n        } else if (algorithm === 'smooth') {\r\n            tmp1 = BB.canvas();\r\n            tmp2 = BB.canvas();\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                BB.resizeCanvas(this.layerCanvasArr[i], w, h, tmp1, tmp2);\r\n            }\r\n        } else {\r\n            throw new Error('unknown resize algorithm');\r\n        }\r\n\r\n        this.width = w;\r\n        this.height = h;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * crop / extend\r\n     * @param p\r\n     */\r\n    resizeCanvas (p: {\r\n        left: number;\r\n        top: number;\r\n        right: number;\r\n        bottom: number;\r\n        fillColor?: IRGB;\r\n    }): void {\r\n\r\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\r\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\r\n        const offX = Math.round(p.left);\r\n        const offY = Math.round(p.top);\r\n\r\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) {\r\n            throw new Error('KlCanvas.resizeCanvas - invalid canvas size');\r\n        }\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            const ctemp = BB.canvas(this.width, this.height);\r\n            const layerCanvas = this.layerCanvasArr[i];\r\n            const layerCtx = BB.ctx(this.layerCanvasArr[i]);\r\n            BB.ctx(ctemp).drawImage(layerCanvas, 0, 0);\r\n\r\n            this.layerCanvasArr[i].width = newW;\r\n            this.layerCanvasArr[i].height = newH;\r\n\r\n            layerCtx.save();\r\n            if (i === 0 && p.fillColor) {\r\n                layerCtx.fillStyle = BB.ColorConverter.toRgbStr(p.fillColor);\r\n                layerCtx.fillRect(0, 0, newW, newH);\r\n                layerCtx.clearRect(offX, offY, this.width, this.height);\r\n            }\r\n            layerCtx.drawImage(ctemp, offX, offY);\r\n            layerCtx.restore();\r\n        }\r\n        this.width = newW;\r\n        this.height = newH;\r\n    }\r\n\r\n    /**\r\n     * will be inserted on top of selected\r\n     * @param selected\r\n     */\r\n    addLayer (selected?: number): false | number {\r\n        if (this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        const canvas = BB.canvas(this.width, this.height) as KlCanvasLayer;\r\n        if (!canvas.getContext('2d')) {\r\n            throw new Error('kl-create-canvas-error');\r\n        }\r\n\r\n        canvas.isVisible = true;\r\n        canvas.mixModeStr = 'source-over';\r\n\r\n        if (selected === undefined) {\r\n            this.layerCanvasArr[this.layerCanvasArr.length] = canvas;\r\n            selected = Math.max(0, this.layerCanvasArr.length - 1);\r\n        } else {\r\n            this.layerCanvasArr.splice(selected + 1, 0, canvas);\r\n            selected++;\r\n        }\r\n\r\n        canvas.name = LANG('layers-layer') + ' ' + (this.layerCanvasArr.length + this.layerNrOffset);\r\n        this.history.pause(true);\r\n        this.layerOpacity(selected, 1);\r\n        this.history.pause(false);\r\n        this.updateIndices();\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'addLayer',\r\n            params: [selected - 1],\r\n        } as TKlCanvasHistoryEntry);\r\n        return selected;\r\n    }\r\n\r\n    duplicateLayer (i: number): false | number {\r\n        if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        const canvas = BB.canvas(this.width, this.height) as KlCanvasLayer;\r\n        this.layerCanvasArr.splice(i + 1, 0, canvas);\r\n\r\n        canvas.name = this.layerCanvasArr[i].name + ' ' + LANG('layers-copy');\r\n        canvas.isVisible = this.layerCanvasArr[i].isVisible;\r\n        canvas.mixModeStr = this.layerCanvasArr[i].mixModeStr;\r\n        // 2023-04-30 workaround for https://bugs.webkit.org/show_bug.cgi?id=256151\r\n        // todo replace with simple drawImage eventually when fixed\r\n        BB.ctx(canvas).putImageData(BB.ctx(this.layerCanvasArr[i]).getImageData(0, 0, this.width, this.height), 0, 0);\r\n        this.history.pause(true);\r\n        this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\r\n        this.history.pause(false);\r\n\r\n        this.updateIndices();\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'duplicateLayer',\r\n            params: [i],\r\n        } as TKlCanvasHistoryEntry);\r\n        return i + 1;\r\n    }\r\n\r\n    getLayerContext (i: number, doReturnNull?: boolean): CanvasRenderingContext2D | null {\r\n        if (this.layerCanvasArr[i]) {\r\n            return BB.ctx(this.layerCanvasArr[i]);\r\n        }\r\n        if (doReturnNull) {\r\n            return null;\r\n        }\r\n        throw new Error('layer of index ' + i + ' not found (in ' + this.layerCanvasArr.length + ' layers)');\r\n    }\r\n\r\n    removeLayer (i: number): false | number {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr.splice(i, 1);\r\n            this.updateIndices();\r\n        } else {\r\n            return false;\r\n        }\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'removeLayer',\r\n            params: [i],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return Math.max(0, i - 1);\r\n    }\r\n\r\n    renameLayer (i: number, name: string): boolean {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr[i].name = name;\r\n        } else {\r\n            return false;\r\n        }\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'renameLayer',\r\n            params: [i, name],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return true;\r\n    }\r\n\r\n    layerOpacity (layerIndex: number, opacity: number): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            return;\r\n        }\r\n        opacity = Math.max(0, Math.min(1, opacity));\r\n        this.layerCanvasArr[layerIndex].opacity = opacity;\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'layerOpacity',\r\n            params: [layerIndex, opacity],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        this.emitChange();\r\n    }\r\n\r\n    setLayerIsVisible (layerIndex: number, isVisible: boolean): void {\r\n        if (this.layerCanvasArr[layerIndex]) {\r\n            this.layerCanvasArr[layerIndex].isVisible = isVisible;\r\n        } else {\r\n            throw new Error(`layer ${layerIndex} undefined`);\r\n        }\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'setLayerIsVisible',\r\n            params: [layerIndex, isVisible],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    moveLayer (i: number, d: number): void | number {\r\n        if (d === 0) {\r\n            return;\r\n        }\r\n        if (this.layerCanvasArr[i]) {\r\n            const temp = this.layerCanvasArr[i];\r\n            this.layerCanvasArr.splice(i, 1);\r\n            const targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\r\n            this.layerCanvasArr.splice(targetIndex, 0, temp);\r\n            this.updateIndices();\r\n            this.history.push({\r\n                tool: ['canvas'],\r\n                action: 'moveLayer',\r\n                params: [i, d],\r\n            } as TKlCanvasHistoryEntry);\r\n            return targetIndex;\r\n        }\r\n    }\r\n\r\n    mergeLayers (layerBottomIndex: number, layerTopIndex: number, mixModeStr: TMixMode | 'as-alpha'): void | number {\r\n        if (\r\n            !this.layerCanvasArr[layerBottomIndex] ||\r\n            !this.layerCanvasArr[layerTopIndex] ||\r\n            layerBottomIndex === layerTopIndex\r\n        ) {\r\n            return;\r\n        }\r\n        //order messed up\r\n        if (layerBottomIndex > layerTopIndex) {\r\n            const temp = layerBottomIndex;\r\n            layerBottomIndex = layerTopIndex;\r\n            layerTopIndex = temp;\r\n        }\r\n\r\n        const topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\r\n        if (topOpacity !== 0 && topOpacity) {\r\n            const ctx = BB.ctx(this.layerCanvasArr[layerBottomIndex]);\r\n            ctx.save();\r\n\r\n            if (mixModeStr === 'as-alpha') { // todo remove this?\r\n\r\n                BB.convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\r\n                ctx.globalCompositeOperation = 'destination-in';\r\n                ctx.globalAlpha = topOpacity;\r\n                BB.ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            } else {\r\n\r\n                if (mixModeStr) {\r\n                    ctx.globalCompositeOperation = mixModeStr;\r\n                }\r\n                ctx.globalAlpha = topOpacity;\r\n                BB.ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            }\r\n\r\n            ctx.restore();\r\n\r\n            // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n            // TODO remove if chrome updated\r\n            if (mixModeStr) {\r\n                ctx.save();\r\n                ctx.fillStyle = 'rgba(0,0,0,0.01)';\r\n                ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n                ctx.restore();\r\n            }\r\n        }\r\n        this.updateIndices();\r\n        this.history.pause(true);\r\n        this.removeLayer(layerTopIndex);\r\n        this.history.pause(false);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'mergeLayers',\r\n            params: [layerBottomIndex, layerTopIndex, mixModeStr],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return layerBottomIndex;\r\n    }\r\n\r\n    rotate (deg: number): void {\r\n        while (deg < 0) {\r\n            deg += 360;\r\n        }\r\n        deg %= 360;\r\n        if (deg % 90 != 0 || deg === 0) {\r\n            return;\r\n        }\r\n        const temp = BB.canvas();\r\n        if (deg === 0 || deg === 180) {\r\n            temp.width = this.width;\r\n            temp.height = this.height;\r\n        } else if (deg === 90 || deg === 270) {\r\n            temp.width = (this.height);\r\n            temp.height = (this.width);\r\n        }\r\n        const ctx = BB.ctx(temp);\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.clearRect(0, 0, temp.width, temp.height);\r\n            ctx.save();\r\n            ctx.translate(temp.width / 2, temp.height / 2);\r\n            ctx.rotate(deg * Math.PI / 180);\r\n            if (deg === 180) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            } else if (deg === 90 || deg === 270) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\r\n            }\r\n            this.layerCanvasArr[i].width = temp.width;\r\n            this.layerCanvasArr[i].height = temp.height;\r\n            BB.ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            BB.ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\r\n            ctx.restore();\r\n        }\r\n        this.width = temp.width;\r\n        this.height = temp.height;\r\n    }\r\n\r\n    flip (isHorizontal: boolean, isVertical: boolean, layerIndex?: number): void {\r\n        if (!isHorizontal && !isVertical) {\r\n            return;\r\n        }\r\n\r\n        const temp = BB.canvas(this.width, this.height);\r\n        temp.width = this.width;\r\n        temp.height = this.height;\r\n        const tempCtx = BB.ctx(temp);\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n\r\n            if ( (layerIndex || layerIndex === 0) && i !== layerIndex) {\r\n                continue;\r\n            }\r\n\r\n            tempCtx.save();\r\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\r\n            tempCtx.translate(temp.width / 2, temp.height / 2);\r\n            tempCtx.scale((isHorizontal ? -1 : 1), (isVertical ? -1 : 1));\r\n            tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            tempCtx.restore();\r\n\r\n            BB.ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            BB.ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\r\n        }\r\n    }\r\n\r\n    layerFill (layerIndex: number, colorObj: IRGB, compositeOperation?: string): void {\r\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n        ctx.save();\r\n        if (compositeOperation) {\r\n            ctx.globalCompositeOperation = compositeOperation as GlobalCompositeOperation;\r\n        }\r\n        ctx.fillStyle = 'rgba(' + colorObj.r + ',' + colorObj.g + ',' + colorObj.b + ',1)';\r\n        ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n        // TODO remove if chrome updated\r\n        ctx.save();\r\n        ctx.fillStyle = 'rgba(0,0,0,0.01)';\r\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n        ctx.restore();\r\n\r\n        /*if (!document.getElementById('testocanvas')) {\r\n            layerCanvasArr[layerIndex].id = 'testocanvas';\r\n            document.body.append(layerCanvasArr[layerIndex]);\r\n            BB.css(layerCanvasArr[layerIndex], {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }\r\n        if (!document.getElementById('testocanvas')) {\r\n            let c = document.createElement('canvas');\r\n            c.width = 1000;\r\n            c.height = 1000;\r\n            let ctx2 = c.getContext('2d');\r\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\r\n            c.id = 'testocanvas';\r\n            document.body.append(c);\r\n            BB.css(c, {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }*/\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'layerFill',\r\n            params: [layerIndex, colorObj, compositeOperation],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    floodFill (\r\n        layerIndex: number, // index of layer to be filled\r\n        x: number, // starting point\r\n        y: number,\r\n        rgb: IRGB | null, // fill color, if null -> erase\r\n        opacity: number,\r\n        tolerance: number,\r\n        sampleStr: TFillSampling,\r\n        grow: number, // int >= 0 - radius around filled area that is to be filled too\r\n        isContiguous: boolean,\r\n    ): void {\r\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) {\r\n            return;\r\n        }\r\n        tolerance = Math.round(tolerance);\r\n\r\n        if (!(['above', 'current', 'all'].includes(sampleStr))) {\r\n            throw new Error('invalid sampleStr');\r\n        }\r\n\r\n        let result;\r\n        let targetCtx;\r\n        let targetImageData;\r\n\r\n        if (sampleStr === 'all') {\r\n\r\n            const srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\r\n            const srcCtx = BB.ctx(srcCanvas);\r\n            const srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            const srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            targetCtx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        } else {\r\n            const srcIndex = sampleStr === 'above' ? layerIndex + 1 : layerIndex;\r\n\r\n            if (srcIndex >= this.layerCanvasArr.length) {\r\n                return;\r\n            }\r\n\r\n            const srcCtx = BB.ctx(this.layerCanvasArr[srcIndex]);\r\n            const srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            const srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            targetCtx = layerIndex === srcIndex ? srcCtx : BB.ctx(this.layerCanvasArr[layerIndex]);\r\n            targetImageData = layerIndex === srcIndex ? srcImageData : targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        }\r\n\r\n        const targetData = targetImageData.data;\r\n        if (rgb) {\r\n            if (opacity === 1) {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4] = rgb.r;\r\n                        targetData[i * 4 + 1] = rgb.g;\r\n                        targetData[i * 4 + 2] = rgb.b;\r\n                        targetData[i * 4 + 3] = 255;\r\n                    }\r\n                }\r\n            } else {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4] = BB.mix(targetData[i * 4], rgb.r, opacity);\r\n                        targetData[i * 4 + 1] = BB.mix(targetData[i * 4 + 1], rgb.g, opacity);\r\n                        targetData[i * 4 + 2] = BB.mix(targetData[i * 4 + 2], rgb.b, opacity);\r\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 255, opacity);\r\n                    }\r\n                }\r\n            }\r\n        } else { // erase\r\n            if (opacity === 1) {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4 + 3] = 0;\r\n                    }\r\n                }\r\n            } else {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 0, opacity);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        targetCtx.putImageData(targetImageData, 0, 0);\r\n\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'replaceLayer',\r\n            params: [layerIndex, targetImageData],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    /**\r\n     * draw shape via BB.drawShape\r\n     * @param layerIndex\r\n     * @param shapeObj\r\n     */\r\n    drawShape (layerIndex: number, shapeObj: IShapeToolObject): void {\r\n        if (shapeObj.x1 === shapeObj.x2 && shapeObj.y1 === shapeObj.y2) {\r\n            return;\r\n        }\r\n        drawShape(BB.ctx(this.layerCanvasArr[layerIndex]), shapeObj);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'drawShape',\r\n            params: [layerIndex, BB.copyObj(shapeObj)],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    drawGradient (layerIndex: number, gradientObj: IGradient): void {\r\n        drawGradient(BB.ctx(this.layerCanvasArr[layerIndex]), gradientObj);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'drawGradient',\r\n            params: [layerIndex, BB.copyObj(gradientObj)],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    text (layerIndex: number, p: TRenderTextParam): void {\r\n        renderText(this.layerCanvasArr[layerIndex], BB.copyObj(p));\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'text',\r\n            params: [layerIndex, BB.copyObj(p)],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    replaceLayer (layerIndex: number, imageData: ImageData): void {\r\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n        ctx.putImageData(imageData, 0, 0);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'replaceLayer',\r\n            params: [layerIndex, imageData],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    clearLayer (layerIndex: number): void {\r\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'clearLayer',\r\n            params: [layerIndex],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    getLayers (): {\r\n        context: CanvasRenderingContext2D;\r\n        isVisible: boolean;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: TMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                context: BB.ctx(item),\r\n                isVisible: item.isVisible,\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayersFast (): {\r\n        canvas: KlCanvasLayer;\r\n        isVisible: boolean;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: TMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                canvas: item,\r\n                isVisible: item.isVisible,\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayerIndex (canvasObj: HTMLCanvasElement, doReturnNull?: boolean): null | number {\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            if (this.layerCanvasArr[i] === canvasObj) {\r\n                return i;\r\n            }\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error('layer not found (in ' + this.layerCanvasArr.length + ' layers)');\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getLayer (index: number, doReturnNull?: boolean): null | TKlCanvasLayer {\r\n        if (this.layerCanvasArr[index]) {\r\n            return {\r\n                context: BB.ctx(this.layerCanvasArr[index]),\r\n                isVisible: this.layerCanvasArr[index].isVisible,\r\n                opacity: this.layerCanvasArr[index].opacity,\r\n                name: this.layerCanvasArr[index].name,\r\n                id: index,\r\n            };\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error('layer of index ' + index + ' not found (in ' + this.layerCanvasArr.length + ' layers)');\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getColorAt (x: number, y: number): IRGB {\r\n        x = Math.floor(x);\r\n        y = Math.floor(y);\r\n        const ctx = BB.ctx(this.pickCanvas);\r\n        ctx.save();\r\n        ctx.imageSmoothingEnabled = false;\r\n        ctx.clearRect(0, 0, 1, 1);\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            const layer = this.layerCanvasArr[i];\r\n            if (!layer.isVisible || layer.opacity === 0) {\r\n                continue;\r\n            }\r\n            ctx.globalAlpha = layer.opacity;\r\n            ctx.globalCompositeOperation = layer.mixModeStr;\r\n            ctx.drawImage(layer, -x, -y);\r\n        }\r\n        ctx.restore();\r\n        const imData = ctx.getImageData(0, 0, 1, 1);\r\n        return new BB.RGB(imData.data[0], imData.data[1], imData.data[2]);\r\n    }\r\n\r\n    getCompleteCanvas (factor: number): HTMLCanvasElement {\r\n        return drawProject(this.getProject(), factor);\r\n    }\r\n\r\n    getProject (): IKlProject {\r\n        return {\r\n            width: this.width,\r\n            height: this.height,\r\n            layers: this.layerCanvasArr.map(layer => {\r\n                return {\r\n                    name: layer.name,\r\n                    isVisible: layer.isVisible,\r\n                    opacity: layer.opacity,\r\n                    mixModeStr: layer.mixModeStr,\r\n                    image: layer,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    addChangeListener (func: () => void): void {\r\n        if (this.changeListenerArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.changeListenerArr.push(func);\r\n    }\r\n\r\n    removeChangeListener (func: () => void): void {\r\n        for (let i = 0; i < this.changeListenerArr.length; i++) {\r\n            if (this.changeListenerArr[i] === func) {\r\n                this.changeListenerArr.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    setMixMode (layerIndex: number, mixModeStr: TMixMode): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'setMixMode',\r\n            params: [layerIndex, '' + mixModeStr],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    /**\r\n     * Set composite drawing step for KlCanvasWorkspace.\r\n     * To apply temporary manipulations to a layer.\r\n     *\r\n     * @param layerIndex\r\n     * @param compositeObj\r\n     */\r\n    setComposite (\r\n        layerIndex: number,\r\n        compositeObj: null | {\r\n            draw: (ctx: CanvasRenderingContext2D) => void;\r\n        }\r\n    ): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].compositeObj = nullToUndefined(compositeObj);\r\n    }\r\n\r\n    destroy (): void {\r\n        if (this.isDestroyed) {\r\n            return;\r\n        }\r\n        this.layerCanvasArr.forEach(canvas => {\r\n            BB.freeCanvas(canvas);\r\n        });\r\n        this.layerCanvasArr = [];\r\n        this.isDestroyed = true;\r\n    }\r\n\r\n}\r\n","\r\n/**\r\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/, but it implemented tolerance wrong, and had bugs.\r\n * So, my own implementation. can handle tolerance, grow, opacity.\r\n * Needs to be optimized.\r\n */\r\n\r\n/**\r\n * Set values in data within rect to 254, unless they're 255\r\n *\r\n * @param data Uint8Array\r\n * @param width int\r\n * @param x0 int\r\n * @param y0 int\r\n * @param x1 int >x0\r\n * @param y1 int >y0\r\n */\r\nfunction fillRect (data: Uint8Array, width: number, x0: number, y0: number, x1: number, y1: number): void {\r\n    for (let x = x0; x <= x1; x++) {\r\n        for (let y = y0; y <= y1; y++) {\r\n            if (data[y * width + x] === 255) {\r\n                continue;\r\n            }\r\n            data[y * width + x] = 254;\r\n        }\r\n    }\r\n}\r\n\r\nlet mx, my;\r\n\r\n/**\r\n * Get index i moved by dX, dY. in array with dimensions width height.\r\n * Returns null if outside bounds.\r\n *\r\n * @param width int\r\n * @param height int\r\n * @param i int\r\n * @param dX int\r\n * @param dY int\r\n */\r\nfunction moveIndex (width: number, height: number, i: number, dX: number, dY: number): (undefined | number) {\r\n    mx = i % width + dX;\r\n    my = Math.floor(i / width) + dY;\r\n\r\n    if (mx < 0 || my < 0 || mx >= width || my >= height) {\r\n        return undefined;\r\n    }\r\n\r\n    return my * width + mx;\r\n}\r\n\r\n/**\r\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\r\n * returns false if already filled, or i is null\r\n *\r\n * @param srcArr Uint8ClampedArray rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param initRgba rgba\r\n * @param tolerance int 0 - 255\r\n * @param i int - srcArr index\r\n * @returns {boolean}\r\n */\r\nfunction testAndFill (\r\n    srcArr: Uint8ClampedArray,\r\n    targetArr: Uint8Array,\r\n    width: number,\r\n    height: number,\r\n    initRgba: [number, number, number, number],\r\n    tolerance: number,\r\n    i: number | undefined,\r\n): boolean {\r\n    if (i === undefined || targetArr[i] === 255) {\r\n        return false;\r\n    }\r\n\r\n    if (\r\n        srcArr[i * 4] === initRgba[0] &&\r\n        srcArr[i * 4 + 1] === initRgba[1] &&\r\n        srcArr[i * 4 + 2] === initRgba[2] &&\r\n        srcArr[i * 4 + 3] === initRgba[3]\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    if (\r\n        tolerance > 0 &&\r\n        Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n\r\n/**\r\n *\r\n * @param srcArr Uint8ClampedArray rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param px int\r\n * @param py int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n */\r\nfunction floodFill (\r\n    srcArr: Uint8ClampedArray,\r\n    targetArr: Uint8Array,\r\n    width: number,\r\n    height: number,\r\n    px: number,\r\n    py: number,\r\n    tolerance: number,\r\n    grow: number,\r\n    isContiguous: boolean,\r\n): void {\r\n\r\n    const initRgba: [number, number, number, number] = [\r\n        srcArr[(py * width + px) * 4],\r\n        srcArr[(py * width + px) * 4 + 1],\r\n        srcArr[(py * width + px) * 4 + 2],\r\n        srcArr[(py * width + px) * 4 + 3],\r\n    ];\r\n\r\n    if (isContiguous) {\r\n        const q: number[] = [];\r\n        q.push(py * width + px);\r\n        targetArr[py * width + px] = 255;\r\n\r\n        let i: number, e: number | undefined;\r\n        while (q.length) {\r\n            i = q.pop() as number; // a test would slow down the code\r\n\r\n            // queue up unfilled neighbors\r\n            e = moveIndex(width, height, i, -1, 0); // left\r\n            // test will return false if e is undefined -> only numbers will be pushed to q\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n\r\n            e = moveIndex(width, height, i, 1, 0); // right\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n\r\n            e = moveIndex(width, height, i, 0, -1); // up\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n\r\n            e = moveIndex(width, height, i, 0, 1); // bottom\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n        }\r\n    } else {\r\n        for (let i = 0; i < width * height; i++) {\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i);\r\n        }\r\n    }\r\n\r\n    // grow\r\n    if (grow === 0) {\r\n        return;\r\n    }\r\n\r\n    // how does it grow? it finds all pixel at the edge.\r\n    // then depending on what kind of edge it is, it draws a rectangle into target\r\n    // the rectangle has the value 254, or else it will mess it all up.\r\n    // after it's all done, replaces it with 255\r\n    let x0, x1, y0, y1;\r\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\r\n    for (let x = 0; x < width; x++) {\r\n        for (let y = 0; y < height; y++) {\r\n            if (targetArr[y * width + x] !== 255) {\r\n                continue;\r\n            }\r\n\r\n            // bounds of rectangle\r\n            x0 = x;\r\n            x1 = x;\r\n            y0 = y;\r\n            y1 = y;\r\n\r\n            l = targetArr[(y) * width + x - 1] !== 255;\r\n            tl = targetArr[(y - 1) * width + x - 1] !== 255;\r\n            t = targetArr[(y - 1) * width + x] !== 255;\r\n            tr = targetArr[(y - 1) * width + x + 1] !== 255;\r\n            r = targetArr[(y) * width + x + 1] !== 255;\r\n            br = targetArr[(y + 1) * width + x + 1] !== 255;\r\n            b = targetArr[(y + 1) * width + x] !== 255;\r\n            bl = targetArr[(y + 1) * width + x - 1] !== 255;\r\n\r\n            if (l) { // left\r\n                x0 = x - grow;\r\n            }\r\n            if (l && tl && t) { // top left\r\n                x0 = x - grow;\r\n                y0 = y - grow;\r\n            }\r\n            if (t) { // top\r\n                y0 = Math.min(y0, y - grow);\r\n            }\r\n            if (t && tr && r) { // top right\r\n                y0 = Math.min(y0, y - grow);\r\n                x1 = x + grow;\r\n            }\r\n            if (r) { // right\r\n                x1 = Math.max(x1, x + grow);\r\n            }\r\n            if (r && br && b) { // bottom right\r\n                x1 = Math.max(x1, x + grow);\r\n                y1 = Math.max(y1, y + grow);\r\n            }\r\n            if (b) { // bottom\r\n                y1 = Math.max(y1, y + grow);\r\n            }\r\n            if (b && bl && l) { // bottom left\r\n                x0 = Math.min(x0, x - grow);\r\n                y1 = Math.max(y1, y + grow);\r\n            }\r\n\r\n            if (!l && !tl && !t && !tr && !r && !br && !b && !bl) {\r\n                continue;\r\n            }\r\n\r\n            fillRect(\r\n                targetArr,\r\n                width,\r\n                Math.max(0, x0),\r\n                Math.max(0, y0),\r\n                Math.min(width - 1, x1),\r\n                Math.min(height - 1, y1)\r\n            );\r\n        }\r\n    }\r\n    for (let i = 0; i < width * height; i++) {\r\n        if (targetArr[i] === 254) {\r\n            targetArr[i] = 255;\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * Does flood fill, and returns that. an array - 0 not filled. 255 filled\r\n\r\n * @param rgbaArr Uint8ClampedArray rgba\r\n * @param width int\r\n * @param height int\r\n * @param x int\r\n * @param y int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n */\r\nexport function floodFillBits (\r\n    rgbaArr: Uint8ClampedArray,\r\n    width: number,\r\n    height: number,\r\n    x: number,\r\n    y: number,\r\n    tolerance: number,\r\n    grow: number,\r\n    isContiguous: boolean,\r\n): {\r\n    data: Uint8Array;\r\n} {\r\n    x = Math.round(x);\r\n    y = Math.round(y);\r\n\r\n    const resultArr = new Uint8Array(new ArrayBuffer(width * height));\r\n\r\n    floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\r\n\r\n    return {\r\n        data: resultArr,\r\n    };\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB, IShapeToolObject} from '../kl-types';\r\n\r\n/**\r\n * Input processor for shape tool.\r\n * Coordinates are in canvas space.\r\n * angleRad is the angle of the canvas.\r\n */\r\nexport class ShapeTool {\r\n\r\n    private readonly onShape: (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\r\n    private downX: number = 0;\r\n    private downY: number = 0;\r\n    private downAngleRad: number = 0;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onShape: (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\r\n        }\r\n    ) {\r\n        this.onShape = p.onShape;\r\n    }\r\n\r\n    onDown (x: number, y: number, angleRad: number): void {\r\n        this.downX = x;\r\n        this.downY = y;\r\n        this.downAngleRad = angleRad;\r\n    }\r\n\r\n    onMove (x: number, y: number): void {\r\n        this.onShape(false, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n\r\n    onUp (x: number, y: number): void {\r\n        this.onShape(true, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n}\r\n\r\n/**\r\n * Draw a shape (rectangle, ellipse, line)\r\n */\r\nexport function drawShape (\r\n    ctx: CanvasRenderingContext2D,\r\n    shapeObj: IShapeToolObject,\r\n): void {\r\n    shapeObj = {\r\n        // defaults\r\n        angleRad: 0,\r\n        isOutwards: false,\r\n        opacity: 1,\r\n        isEraser: false,\r\n        doLockAlpha: false,\r\n\r\n        ...BB.copyObj(shapeObj),\r\n    };\r\n\r\n    if (['rect', 'ellipse', 'line'].includes(shapeObj.type)) {\r\n        if (shapeObj.angleRad === undefined) {\r\n            throw new Error('angleRad undefined');\r\n        }\r\n\r\n        const lineWidth = shapeObj.lineWidth === undefined ? -1 : Math.round(shapeObj.lineWidth);\r\n        const angleDeg = shapeObj.angleRad * 180 / Math.PI;\r\n\r\n        // --- prep color ---\r\n        if (!shapeObj.isEraser && shapeObj.fillRgb === undefined && shapeObj.strokeRgb === undefined) {\r\n            throw new Error('fillRgb and strokeRgb undefined');\r\n        }\r\n        const colorRGB: IRGB = shapeObj.isEraser ? {r: 255, g: 255, b: 255} : (shapeObj.fillRgb ? shapeObj.fillRgb : shapeObj.strokeRgb!);\r\n\r\n\r\n        // --- prep canvas ---\r\n        ctx.save();\r\n        if (shapeObj.opacity) {\r\n            ctx.globalAlpha = shapeObj.opacity;\r\n        }\r\n        if (shapeObj.isEraser) {\r\n            ctx.globalCompositeOperation = 'destination-out';\r\n        }\r\n        if (shapeObj.doLockAlpha) {\r\n            ctx.globalCompositeOperation = 'source-atop';\r\n        }\r\n        ctx.rotate(-shapeObj.angleRad);\r\n        if (shapeObj.fillRgb) {\r\n            ctx.fillStyle = BB.ColorConverter.toRgbStr(colorRGB);\r\n        } else if (shapeObj.strokeRgb) {\r\n            ctx.strokeStyle = BB.ColorConverter.toRgbStr(colorRGB);\r\n            ctx.lineWidth = lineWidth;\r\n        }\r\n\r\n        let x1 = shapeObj.x1;\r\n        let y1 = shapeObj.y1;\r\n        let x2 = shapeObj.x2;\r\n        let y2 = shapeObj.y2;\r\n\r\n        // --- angle snapping ---\r\n        if (shapeObj.isAngleSnap) {\r\n            const r1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            const r2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            const pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\r\n            const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\r\n            const rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\r\n            x2 = rotated.x;\r\n            y2 = rotated.y;\r\n\r\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\r\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\r\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\r\n                    x2 = x1;\r\n                } else { // left or right\r\n                    y2 = y1;\r\n                }\r\n            }\r\n        }\r\n\r\n        let x = x1;\r\n        let y = y1;\r\n        let dX = x2 - x1;\r\n        let dY = y2 - y1;\r\n\r\n        // --- 1:1 ratio ---\r\n        if (shapeObj.type !== 'line' && shapeObj.isFixedRatio) {\r\n            let r1 = BB.rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\r\n            let r2 = BB.rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            const rx = r1.x;\r\n            const ry = r1.y;\r\n            let rdX = r2.x - r1.x;\r\n            let rdY = r2.y - r1.y;\r\n\r\n            if (Math.abs(rdX) < Math.abs(rdY)) {\r\n                rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\r\n            } else {\r\n                rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\r\n            }\r\n            r2.x = rx + rdX;\r\n            r2.y = ry + rdY;\r\n\r\n            r1 = BB.rotate(r1.x, r1.y, -shapeObj.angleRad / Math.PI * 180);\r\n            r2 = BB.rotate(r2.x, r2.y, -shapeObj.angleRad / Math.PI * 180);\r\n\r\n            x1 = r1.x;\r\n            y1 = r1.y;\r\n            x2 = r2.x;\r\n            y2 = r2.y;\r\n\r\n            x = x1;\r\n            y = y1;\r\n            dX = x2 - x1;\r\n            dY = y2 - y1;\r\n        }\r\n\r\n        // outwards modifier\r\n        if (shapeObj.isOutwards) {\r\n            x -= dX;\r\n            y -= dY;\r\n            dX *= 2;\r\n            dY *= 2;\r\n\r\n            x1 = x;\r\n            y1 = y;\r\n            x2 = x + dX;\r\n            y2 = y + dY;\r\n        }\r\n\r\n        let p1;\r\n        let p2;\r\n        if (shapeObj.type === 'line') { // --- line ---\r\n\r\n            // rounded\r\n            const x1r = Math.round(x1);\r\n            const y1r = Math.round(y1);\r\n            const x2r = Math.round(x2);\r\n            const y2r = Math.round(y2);\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (lineWidth % 2 === 0) {\r\n\r\n                if (y1r === y2r) {\r\n                    p1 = {\r\n                        x: x1f,\r\n                        y: y1r,\r\n                    };\r\n                    p2 = {\r\n                        x: x2f,\r\n                        y: y2r,\r\n                    };\r\n\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                } else if (x1r === x2r) {\r\n                    p1 = {\r\n                        x: x1r,\r\n                        y: y1f,\r\n                    };\r\n                    p2 = {\r\n                        x: x2r,\r\n                        y: y2f,\r\n                    };\r\n\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                } else {\r\n                    p1 = {\r\n                        x: x1,\r\n                        y: y1,\r\n                    };\r\n                    p2 = {\r\n                        x: x2,\r\n                        y: y2,\r\n                    };\r\n                }\r\n\r\n            } else {\r\n                p1 = {\r\n                    x: x1f,\r\n                    y: y1f,\r\n                };\r\n                p2 = {\r\n                    x: x2f,\r\n                    y: y2f,\r\n                };\r\n                if (y1f === y2f) {\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                    p1.y += 0.5;\r\n                    p2.y += 0.5;\r\n                } else if (x1f === x2f) {\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                    p1.x += 0.5;\r\n                    p2.x += 0.5;\r\n                } else {\r\n                    p1.x = x1;\r\n                    p1.y = y1;\r\n                    p2.x = x2;\r\n                    p2.y = y2;\r\n                }\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            ctx.beginPath();\r\n            ctx.moveTo(p1.x, p1.y);\r\n            ctx.lineTo(p2.x, p2.y);\r\n            ctx.stroke();\r\n\r\n        } else if (shapeObj.type === 'rect') { // --- rect ---\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (angleDeg % 90 === 0) {\r\n                if (shapeObj.fillRgb) {\r\n                    if (x1 % 1 === 0) {\r\n                        x1 += 1;\r\n                    }\r\n                    if (y1 % 1 === 0) {\r\n                        y1 += 1;\r\n                    }\r\n                    if (x2 % 1 === 0) {\r\n                        x2 += 1;\r\n                    }\r\n                    if (y2 % 1 === 0) {\r\n                        y2 += 1;\r\n                    }\r\n\r\n                    p1 = {\r\n                        x: x1 < x2 ? x1f : x2f,\r\n                        y: y1 < y2 ? y1f : y2f,\r\n                    };\r\n                    p2 = {\r\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\r\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y),\r\n                    };\r\n                    p2.x = p1.x + p2.x;\r\n                    p2.y = p1.y + p2.y;\r\n\r\n                } else {\r\n                    if (lineWidth % 2 === 0) {\r\n                        p1 = {\r\n                            x: x1f,\r\n                            y: y1f,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f,\r\n                            y: y2f,\r\n                        };\r\n                    } else {\r\n                        p1 = {\r\n                            x: x1f + 0.5,\r\n                            y: y1f + 0.5,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f + 0.5,\r\n                            y: y2f + 0.5,\r\n                        };\r\n                    }\r\n                }\r\n            } else {\r\n                p1 = {\r\n                    x: x1,\r\n                    y: y1,\r\n                };\r\n                p2 = {\r\n                    x: x2,\r\n                    y: y2,\r\n                };\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2.x = p2.x - p1.x;\r\n            p2.y = p2.y - p1.y;\r\n\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\r\n            } else {\r\n                ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\r\n            }\r\n\r\n        } else {  // --- circle ---\r\n            p1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n            x = p1.x;\r\n            y = p1.y;\r\n            dX = p2.x - p1.x;\r\n            dY = p2.y - p1.y;\r\n\r\n            ctx.beginPath();\r\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fill();\r\n            } else {\r\n                ctx.stroke();\r\n            }\r\n        }\r\n\r\n\r\n        ctx.restore();\r\n\r\n    } else {\r\n        throw new Error('unknown shape');\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {IBounds, IRect} from '../../bb/bb-types';\r\nimport {IRGBA} from '../kl-types';\r\n\r\nexport type TTextFormat = 'left' | 'center' | 'right';\r\nexport type TTextFont = 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy' | string;\r\n\r\nexport type TRenderTextParam = {\r\n    text: string; // text to be drawn. can contain newlines\r\n\r\n    x: number;\r\n    y: number;\r\n    angleRad: number;\r\n    size: number; // px\r\n    align: TTextFormat;\r\n    isBold: boolean;\r\n    isItalic: boolean;\r\n    font: TTextFont;\r\n    letterSpacing?: number;\r\n    lineHeight?: number; // em\r\n    fill?: {\r\n        color: IRGBA;\r\n    };\r\n    stroke?: {\r\n        color: IRGBA;\r\n        lineWidth: number;\r\n    };\r\n}\r\n\r\nfunction textMetricToRect (metrics: TextMetrics, align: TTextFormat): IRect {\r\n    // fallback for older browsers\r\n    const ascent = metrics.fontBoundingBoxAscent ?? metrics.actualBoundingBoxAscent;\r\n    const descent = metrics.fontBoundingBoxDescent ?? metrics.actualBoundingBoxDescent;\r\n\r\n    if (align === 'left') {\r\n        return {\r\n            x: 0,\r\n            y: -ascent,\r\n            width: metrics.width,\r\n            height: ascent + descent,\r\n        };\r\n    }\r\n    if (align === 'right') {\r\n        return {\r\n            x: -metrics.width,\r\n            y: -ascent,\r\n            width: metrics.width,\r\n            height: ascent + descent,\r\n        };\r\n    }\r\n    // center\r\n    return {\r\n        x: -metrics.width / 2,\r\n        y: -ascent,\r\n        width: metrics.width,\r\n        height: ascent + descent,\r\n    };\r\n}\r\n\r\n/**\r\n * Draws text on a canvas.\r\n * Return bounds, relative to p.x, p.y.\r\n *\r\n * @param canvas\r\n * @param p\r\n */\r\nexport function renderText (canvas: HTMLCanvasElement, p: TRenderTextParam): IRect {\r\n\r\n    p = BB.copyObj(p);\r\n\r\n    // setup context\r\n    const ctx = BB.ctx(canvas) as CanvasRenderingContext2D & {letterSpacing: string};\r\n    ctx.save();\r\n    ctx.textAlign = p.align;\r\n    ctx.letterSpacing = p.letterSpacing ? p.letterSpacing + 'px' : '0';\r\n\r\n    // font\r\n    const fontArr = [p.size + 'px ' + (p.font ? p.font : 'sans-serif')];\r\n    if (p.isBold) {\r\n        fontArr.unshift('bold');\r\n    }\r\n    if (p.isItalic) {\r\n        fontArr.unshift('italic');\r\n    }\r\n    ctx.font = fontArr.join(' ');\r\n\r\n    // fill\r\n    ctx.fillStyle = p.fill ? BB.ColorConverter.toRgbaStr(p.fill.color) : 'transparent';\r\n\r\n    // stroke\r\n    ctx.strokeStyle = p.stroke ? BB.ColorConverter.toRgbaStr(p.stroke.color) : 'transparent';\r\n    if (p.stroke) {\r\n        ctx.lineWidth = p.stroke.lineWidth;\r\n        ctx.lineJoin = 'round';\r\n    }\r\n\r\n    ctx.translate(p.x, p.y);\r\n    ctx.rotate(-p.angleRad);\r\n\r\n\r\n    const lines = p.text.split('\\n').map(line => line.replaceAll('\\t', '    '));\r\n\r\n    // bounds\r\n    const bounds: IBounds = {\r\n        x1: 0,\r\n        y1: 0,\r\n        x2: 0,\r\n        y2: 0,\r\n    };\r\n    {\r\n        let isFirst = true;\r\n        lines.forEach((line, lineIndex) => {\r\n            const metrics = ctx.measureText(line);\r\n            const x = 0;\r\n            const y =  p.size * (p.lineHeight ?? 1) * lineIndex;\r\n            const mRect = textMetricToRect(metrics, p.align);\r\n            if (isFirst) {\r\n                isFirst = false;\r\n                bounds.x1 = x + mRect.x;\r\n                bounds.y1 = y + mRect.y;\r\n                bounds.x2 = x + mRect.x + mRect.width;\r\n                bounds.y2 = y + mRect.y + mRect.height;\r\n            } else {\r\n                bounds.x1 = Math.min(bounds.x1, x + mRect.x);\r\n                bounds.y1 = Math.min(bounds.y1, y + mRect.y);\r\n                bounds.x2 = Math.max(bounds.x2, x + mRect.x + mRect.width);\r\n                bounds.y2 = Math.max(bounds.y2, y + mRect.y + mRect.height);\r\n            }\r\n        });\r\n    }\r\n\r\n    // draw stroke\r\n    lines.forEach((line, lineIndex) => {\r\n        const x = 0;\r\n        const y =  p.size * (p.lineHeight ?? 1) * lineIndex;\r\n        ctx.strokeText(line, x, y);\r\n    });\r\n\r\n    // draw fill\r\n    lines.forEach((line, lineIndex) => {\r\n        const x = 0;\r\n        const y =  p.size * (p.lineHeight ?? 1) * lineIndex;\r\n        ctx.fillText(line, x, y);\r\n    });\r\n\r\n    ctx.restore();\r\n    return {\r\n        x: bounds.x1,\r\n        y: bounds.y1,\r\n        width: bounds.x2 - bounds.x1,\r\n        height: bounds.y2 - bounds.y1,\r\n    };\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IKlProject} from '../kl-types';\r\n\r\nexport function drawProject (project: IKlProject, factor: number): HTMLCanvasElement {\r\n    const resultCanvas = BB.canvas(\r\n        Math.max(1, Math.round(project.width * factor)),\r\n        Math.max(1, Math.round(project.height * factor))\r\n    );\r\n    const ctx = BB.ctx(resultCanvas);\r\n    ctx.save();\r\n    if (factor > 1) {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n    for (let i = 0; i < project.layers.length; i++) {\r\n        const layer = project.layers[i];\r\n        if (!layer.isVisible || layer.opacity === 0) {\r\n            continue;\r\n        }\r\n        ctx.globalAlpha = layer.opacity;\r\n        const mixModeStr = layer.mixModeStr;\r\n        ctx.globalCompositeOperation = mixModeStr !== undefined ? mixModeStr : 'source-over';\r\n        ctx.drawImage(layer.image, 0, 0, resultCanvas.width, resultCanvas.height);\r\n    }\r\n    ctx.restore();\r\n    return resultCanvas;\r\n}","import {IGradient, IRGBA} from '../kl-types';\r\nimport {BB} from '../../bb/bb';\r\n\r\n\r\ntype TOnGradient = (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\r\n\r\n/**\r\n * Input processor for gradient tool.\r\n * Coordinates are in canvas space.\r\n * angleRad is the angle of the canvas.\r\n */\r\nexport class GradientTool {\r\n    private downX: number = 0;\r\n    private downY: number = 0;\r\n    private downAngleRad: number = 0;\r\n    private readonly onGradient: TOnGradient;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onGradient: TOnGradient;\r\n        }\r\n    ) {\r\n        this.onGradient = p.onGradient;\r\n    }\r\n\r\n    onDown (x: number, y: number, angleRad: number): void {\r\n        this.downX = x;\r\n        this.downY = y;\r\n        this.downAngleRad = angleRad;\r\n    }\r\n\r\n    onMove (x: number, y: number): void {\r\n        this.onGradient(false, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n\r\n    onUp (x: number, y: number): void {\r\n        this.onGradient(true, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n}\r\n\r\nexport function drawGradient (\r\n    ctx: CanvasRenderingContext2D,\r\n    gradientObj: IGradient,\r\n): void {\r\n    ctx.save();\r\n\r\n    const x1 = gradientObj.x1;\r\n    const y1 = gradientObj.y1;\r\n    let x2 = gradientObj.x2;\r\n    let y2 = gradientObj.y2;\r\n\r\n    if (gradientObj.doSnap) {\r\n        const angleDeg = gradientObj.angleRad * 180 / Math.PI;\r\n\r\n        const r1 = BB.rotate(x1, y1, gradientObj.angleRad / Math.PI * 180);\r\n        const r2 = BB.rotate(x2, y2, gradientObj.angleRad / Math.PI * 180);\r\n\r\n        const pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\r\n        const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\r\n        const rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\r\n        x2 = rotated.x;\r\n        y2 = rotated.y;\r\n\r\n        // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\r\n        if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\r\n            if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\r\n                x2 = x1;\r\n            } else { // left or right\r\n                y2 = y1;\r\n            }\r\n        }\r\n    }\r\n\r\n    let baseColor = gradientObj.color1;\r\n    if (gradientObj.isEraser && gradientObj.doLockAlpha) {\r\n        baseColor = {r: 255, g: 255, b: 255};\r\n    }\r\n    let color1: IRGBA = {\r\n        ...baseColor,\r\n        a: gradientObj.opacity,\r\n    };\r\n    let color2: IRGBA = {\r\n        ...baseColor,\r\n        a: 0,\r\n    };\r\n    if (gradientObj.isReversed) {\r\n        const temp = color1;\r\n        color1 = color2;\r\n        color2 = temp;\r\n    }\r\n\r\n    let gradient: CanvasGradient;\r\n    if (gradientObj.type === 'linear') {\r\n        gradient = ctx.createLinearGradient(x1, y1, x2, y2);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n\r\n    } else if (gradientObj.type === 'linear-mirror') {\r\n        const d = {\r\n            x: x2 - x1,\r\n            y: y2 - y1,\r\n        };\r\n        gradient = ctx.createLinearGradient(x1 - d.x,y1 - d.y, x2, y2);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color2));\r\n        gradient.addColorStop(0.5, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n\r\n    } else if (gradientObj.type === 'radial') {\r\n        const r = BB.Vec2.dist(\r\n            {x: x1, y: y1},\r\n            {x: x2, y: y2},\r\n        );\r\n        gradient = ctx.createRadialGradient(x1, y1, 0, x1, y1, r);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n    }\r\n\r\n    ctx.fillStyle = gradient!;\r\n    if (gradientObj.isEraser) {\r\n        ctx.globalCompositeOperation = 'destination-out';\r\n    }\r\n    if (gradientObj.doLockAlpha) {\r\n        ctx.globalCompositeOperation = 'source-atop';\r\n    }\r\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n\r\n    ctx.restore();\r\n}","import {TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TTranslationCode} from '../../../languages/languages';\r\n\r\nexport function translateBlending (blendMode?: TMixMode): string {\r\n    if (!blendMode) {\r\n        return LANG('layers-blend-normal');\r\n    }\r\n\r\n    const codes: {\r\n        [key: string]: TTranslationCode;\r\n    } = {\r\n        'source-over': 'layers-blend-normal',\r\n        'darken': 'layers-blend-darken',\r\n        'multiply': 'layers-blend-multiply',\r\n        'color-burn': 'layers-blend-color-burn',\r\n        'lighten': 'layers-blend-lighten',\r\n        'screen': 'layers-blend-screen',\r\n        'color-dodge': 'layers-blend-color-dodge',\r\n        'overlay': 'layers-blend-overlay',\r\n        'soft-light': 'layers-blend-soft-light',\r\n        'hard-light': 'layers-blend-hard-light',\r\n        'difference': 'layers-blend-difference',\r\n        'exclusion': 'layers-blend-exclusion',\r\n        'hue': 'layers-blend-hue',\r\n        'saturation': 'layers-blend-saturation',\r\n        'color': 'layers-blend-color',\r\n        'luminosity': 'layers-blend-luminosity',\r\n    };\r\n\r\n    if (!(blendMode in codes)) {\r\n        throw new Error('unknown blend mode');\r\n    }\r\n    return LANG(codes[blendMode]);\r\n}","import {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport {showModal} from '../../modals/base/showModal';\r\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\r\n\r\n\r\nexport function renameLayerDialog (\r\n    parentEl: HTMLElement,\r\n    currentName: string,\r\n    callback: (newName: string | undefined) => void\r\n): void {\r\n    const div = BB.el();\r\n\r\n    const label = BB.el({\r\n        content: LANG('layers-rename-name') + ':',\r\n        css: {\r\n            marginRight: '5px',\r\n        },\r\n    });\r\n\r\n    const row = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n        },\r\n    });\r\n    const input = BB.el({tagName: 'input'});\r\n    input.value = currentName;\r\n    input.setAttribute('data-ignore-focus', 'true');\r\n    const clearBtn = BB.el({\r\n        tagName: 'button',\r\n        content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/>',\r\n        title: LANG('layers-rename-clear'),\r\n        css: {\r\n            marginLeft: '10px',\r\n        },\r\n        onClick: () => {\r\n            input.value = '';\r\n            input.focus();\r\n        },\r\n    });\r\n    const suggestions = [\r\n        LANG('layers-rename-sketch'),\r\n        LANG('layers-rename-colors'),\r\n        LANG('layers-rename-shading'),\r\n        LANG('layers-rename-lines'),\r\n        LANG('layers-rename-effects'),\r\n        LANG('background'),\r\n        LANG('layers-rename-foreground'),\r\n    ];\r\n    const suggestionBtns: HTMLButtonElement[] = [];\r\n    const row2 = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            flexWrap: 'wrap',\r\n            marginTop: '5px',\r\n            marginLeft: '-5px',\r\n        },\r\n    });\r\n    suggestions.forEach(item => {\r\n        const btn = BB.el({\r\n            parent: row2,\r\n            tagName: 'button',\r\n            content: item,\r\n            onClick: () => {\r\n                input.value = '' + btn.textContent;\r\n            },\r\n            css: {\r\n                margin: '5px 0 0 5px',\r\n            },\r\n        });\r\n        suggestionBtns.push(btn);\r\n    });\r\n\r\n    div.append(label);\r\n    label.append(row, row2);\r\n    row.append(input, clearBtn);\r\n\r\n    setTimeout(() => {\r\n        input.focus();\r\n        input.select();\r\n    }, 10);\r\n\r\n    showModal({\r\n        target: parentEl,\r\n        message: `<b>${LANG('layers-rename-title')}</b>`,\r\n        div: div,\r\n        buttons: [LANG('layers-rename'), 'Cancel'],\r\n        primaries: [LANG('layers-rename')],\r\n        callback: (val) => {\r\n            BB.destroyEl(clearBtn);\r\n            suggestionBtns.forEach(item => {\r\n                BB.destroyEl(item);\r\n            });\r\n            suggestionBtns.splice(0, suggestionBtns.length);\r\n            if (val === LANG('layers-rename')) {\r\n                callback(input.value);\r\n            } else {\r\n                callback(undefined);\r\n            }\r\n        },\r\n        clickOnEnter: LANG('layers-rename'),\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1twgF\");","import {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport {Options} from '../../components/options';\r\nimport {translateBlending} from '../../../canvas/translate-blending';\r\nimport {showModal} from '../../modals/base/showModal';\r\nimport {TMixMode} from '../../../kl-types';\r\nimport {theme} from '../../../../theme/theme';\r\n\r\nexport function mergeLayerDialog (\r\n    parentEl: HTMLElement,\r\n    p: {\r\n        topCanvas: HTMLCanvasElement;\r\n        bottomCanvas: HTMLCanvasElement;\r\n        topOpacity: number;\r\n        mixModeStr: TMixMode;\r\n        callback: (mode: string) => void;\r\n    }\r\n): void {\r\n    const div = BB.el();\r\n    div.innerHTML = LANG('layers-merge-description');\r\n\r\n    const options = new Options({\r\n        optionArr: [\r\n            {id: p.mixModeStr, label: translateBlending(p.mixModeStr)},\r\n            {id: 'source-in', label: 'source-in'},\r\n            {id: 'source-out', label: 'source-out'},\r\n            {id: 'source-atop', label: 'source-atop'},\r\n            {id: 'destination-in', label: 'destination-in'},\r\n            {id: 'destination-out', label: 'destination-out'},\r\n            {id: 'destination-atop', label: 'destination-atop'},\r\n            {id: 'xor', label: 'xor'},\r\n        ],\r\n        initId: p.mixModeStr,\r\n        onChange: () => {\r\n            update();\r\n        },\r\n        isSmall: true,\r\n    });\r\n    options.getElement().style.marginTop = '5px';\r\n    div.append(options.getElement());\r\n\r\n    const thumbDimensions = BB.fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\r\n    const preview = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n    preview.title = LANG('preview');\r\n    preview.className = 'kl-merge-preview';\r\n    const spacer = BB.el({\r\n        content: '<br/>',\r\n        css: {\r\n            clear: 'both',\r\n        },\r\n    });\r\n    div.append(spacer, preview);\r\n\r\n    function updateCheckerboard (): void {\r\n        BB.createCheckerDataUrl(4, (url) => {\r\n            preview.style.backgroundImage = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n    }\r\n    updateCheckerboard();\r\n    theme.addIsDarkListener(updateCheckerboard);\r\n\r\n    const alphaCanvas = BB.copyCanvas(preview);\r\n    BB.ctx(alphaCanvas).drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\r\n    BB.convertToAlphaChannelCanvas(alphaCanvas);\r\n\r\n    const update = () => {\r\n        const ctx = BB.ctx(preview);\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, preview.width, preview.height);\r\n        if (preview.width > p.topCanvas.width) {\r\n            ctx.imageSmoothingEnabled = false;\r\n        }\r\n        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\r\n\r\n        if (options.getValue() === 'as-alpha') {\r\n            ctx.globalCompositeOperation = 'destination-in';\r\n            ctx.globalAlpha = p.topOpacity;\r\n            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\r\n        } else {\r\n            ctx.globalCompositeOperation = options.getValue() as GlobalCompositeOperation;\r\n            ctx.globalAlpha = p.topOpacity;\r\n            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\r\n        }\r\n        ctx.restore();\r\n    };\r\n\r\n    update();\r\n\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: (keyStr: string) => {\r\n            if (keyStr === 'right') {\r\n                options.next();\r\n            }\r\n            if (keyStr === 'left') {\r\n                options.previous();\r\n            }\r\n        },\r\n    });\r\n\r\n    showModal({\r\n        target: parentEl,\r\n        message: `<b>${LANG('layers-merge-modal-title')}</b>`,\r\n        div: div,\r\n        buttons: ['Ok', 'Cancel'],\r\n        clickOnEnter: 'Ok',\r\n        callback: (val) => {\r\n            keyListener.destroy();\r\n            options.destroy();\r\n            theme.removeIsDarkListener(updateCheckerboard);\r\n            if (val === 'Ok') {\r\n                p.callback(options.getValue());\r\n            }\r\n        },\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"70WHw\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3huo1\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1AvFX\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ftA1L\");","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl-types';\r\n\r\n/**\r\n * Overlay for KlCanvasWorkspace.\r\n * - brush circle\r\n * - eyedropper circle\r\n * - compass needle (rotation hud)\r\n */\r\nexport class WorkspaceSvgOverlay {\r\n    private readonly rootElement: SVGElement;\r\n    private readonly brushCircleOuter: SVGElement;\r\n    private readonly brushCircleInner: SVGElement;\r\n    private readonly pickerPreviewBorder: SVGElement;\r\n    private readonly pickerPreviewCol: SVGElement;\r\n    private readonly compassSize: number;\r\n    private readonly compass: SVGElement;\r\n    private readonly compassInner: SVGElement;\r\n    private readonly compassBaseCircle: SVGElement;\r\n    private readonly compassLineCircle: SVGElement;\r\n    private readonly compassUpperTriangle: SVGElement;\r\n    private readonly compassLowerTriangle: SVGElement;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n        }\r\n    ) {\r\n        this.rootElement = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + p.width,\r\n            height: '' + p.height,\r\n        });\r\n        BB.css(this.rootElement, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            pointerEvents: 'none',\r\n            userSelect: 'none',\r\n        });\r\n\r\n        //brush circles\r\n        this.brushCircleOuter = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '10',\r\n            stroke: 'rgba(0,0,0,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.brushCircleInner = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '9',\r\n            stroke: 'rgba(255,255,255,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\r\n\r\n        //color picker preview circle\r\n        this.pickerPreviewBorder = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '22',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewBorder.style.opacity = '0';\r\n        this.pickerPreviewCol = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '20',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewCol.style.opacity = '0';\r\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\r\n\r\n\r\n        //rotation compass\r\n        this.compassSize = 30;\r\n        this.compass = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'translate(' + (p.width/2) + ', ' + (p.height/2) + ')',\r\n        });\r\n        BB.css(this.compass, {\r\n            transition: 'opacity 0.25s ease-in-out',\r\n            opacity: '0',\r\n        });\r\n        this.compassInner = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'rotate(45)',\r\n        });\r\n        this.compassBaseCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'rgba(0,0,0,0.9)',\r\n            stroke: 'none',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + this.compassSize,\r\n        });\r\n        this.compassLineCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'none',\r\n            stroke: 'rgba(255,255,255,0.75)',\r\n            'stroke-width': '1',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + (this.compassSize * 0.9),\r\n        });\r\n        this.compassUpperTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#f00',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,-'+(this.compassSize * 0.9)+' z',\r\n        });\r\n        this.compassLowerTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#fff',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,'+(this.compassSize * 0.9)+' z',\r\n        });\r\n\r\n        this.compassInner.append(\r\n            this.compassBaseCircle,\r\n            this.compassLineCircle,\r\n            this.compassUpperTriangle,\r\n            this.compassLowerTriangle\r\n        );\r\n        this.compass.append(this.compassInner);\r\n        this.rootElement.append(this.compass);\r\n    }\r\n\r\n    getElement (): SVGElement {\r\n        return this.rootElement;\r\n    }\r\n\r\n    setSize (width: number, height: number): void {\r\n        this.rootElement.setAttribute('width', '' + width);\r\n        this.rootElement.setAttribute('height', '' + height);\r\n        this.compass.setAttribute('transform', 'translate(' + (width/2) + ', ' + (height/2) + ')');\r\n    }\r\n\r\n    updateCursor (p: {\r\n        x?: number;\r\n        y?: number;\r\n        radius?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if (p.x !== undefined) {\r\n            this.brushCircleOuter.setAttribute('cx', '' + p.x);\r\n            this.brushCircleInner.setAttribute('cx', '' + p.x);\r\n        }\r\n        if (p.y !== undefined) {\r\n            this.brushCircleOuter.setAttribute('cy', '' + p.y);\r\n            this.brushCircleInner.setAttribute('cy', '' + p.y);\r\n        }\r\n        if (p.radius !== undefined) {\r\n            this.brushCircleOuter.setAttribute('r', '' + Math.max(0, p.radius));\r\n            this.brushCircleInner.setAttribute('r', '' + Math.max(0, p.radius - 1));\r\n        }\r\n        if (p.isVisible !== undefined) {\r\n            this.brushCircleOuter.style.opacity = p.isVisible ? '1' : '0';\r\n            this.brushCircleInner.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateColorPreview (p: {\r\n        x?: number;\r\n        y?: number;\r\n        color?: IRGB;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if (p.x !== undefined) {\r\n            this.pickerPreviewCol.setAttribute('cx', '' + p.x);\r\n            this.pickerPreviewBorder.setAttribute('cx', '' + p.x);\r\n        }\r\n        if (p.y !== undefined) {\r\n            this.pickerPreviewCol.setAttribute('cy', '' + p.y);\r\n            this.pickerPreviewBorder.setAttribute('cy', '' + p.y);\r\n        }\r\n        if (p.color) {\r\n            this.pickerPreviewCol.setAttribute('stroke', BB.ColorConverter.toRgbStr(p.color));\r\n            const borderColor = BB.testIsWhiteBestContrast(p.color) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)';\r\n            this.pickerPreviewBorder.setAttribute('stroke', borderColor);\r\n        }\r\n        if (p.isVisible !== undefined) {\r\n            this.pickerPreviewCol.style.opacity = p.isVisible ? '1' : '0';\r\n            this.pickerPreviewBorder.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateCompass (p: {\r\n        angleDeg?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if (p.angleDeg !== undefined) {\r\n            this.compassInner.setAttribute('transform', 'rotate(' + p.angleDeg + ')');\r\n            this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? '1' : '0';\r\n        }\r\n        if (p.isVisible !== undefined) {\r\n            this.compass.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB, ITransform, TDrawEvent} from '../kl-types';\r\nimport {WorkspaceSvgOverlay} from './workspace-svg-overlay';\r\nimport {klHistory} from '../history/kl-history';\r\nimport pickerImg from '/src/app/img/ui/cursor-picker.png';\r\nimport zoomEwImg from '/src/app/img/ui/cursor-zoom-ew.png';\r\nimport fillImg from '/src/app/img/ui/cursor-fill.png';\r\nimport textImg from '/src/app/img/ui/cursor-text.png';\r\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb-types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {KeyListener, TOnKeyDown, TOnKeyUp} from '../../bb/input/key-listener';\r\nimport {KL} from '../kl';\r\nimport {LinetoolProcessor} from '../events/linetool-processor';\r\nimport {PinchZoomer} from '../../bb/input/event-chain/pinch-zoomer';\r\nimport {DoubleTapper, IDoubleTapperEvent} from '../../bb/input/event-chain/double-tapper';\r\nimport {NFingerTapper} from '../../bb/input/event-chain/n-finger-tapper';\r\nimport {EventChain} from '../../bb/input/event-chain/event-chain';\r\nimport {PointerListener} from '../../bb/input/pointer-listener';\r\nimport {theme} from '../../theme/theme';\r\nimport {TVec4} from '../../bb/math/matrix';\r\nimport {IChainElement} from '../../bb/input/event-chain/event-chain.types';\r\nimport {ICoalescedPointerEvent} from '../../bb/input/event-chain/coalesced-exploder';\r\nimport {klConfig} from '../kl-config';\r\n\r\nexport interface IViewChangeEvent {\r\n    changed: ('scale' | 'angle')[];\r\n    angle: number;\r\n    scale: number;\r\n}\r\n\r\ntype TModeStr = 'draw' | 'pick' | 'hand' | 'shape' | 'fill' | 'gradient' | 'text'; // | 'transform' | 'select'\r\n\r\ntype TInputProcessorKeys = |\r\n    'draw' |\r\n    'fill' |\r\n    'gradient' |\r\n    'text' |\r\n    'shape' |\r\n    'hand' |\r\n    'spaceHand' |\r\n    'zoom' |\r\n    'picker' |\r\n    'altPicker' |\r\n    'rotate';\r\n\r\ntype TInputProcessorItem = {\r\n    onPointer: (val: ICoalescedPointerEvent) => void;\r\n    onKeyDown: TOnKeyDown;\r\n    onKeyUp: TOnKeyUp;\r\n}\r\n\r\nconst MIN_SCALE = 1 / 16;\r\nconst MAX_SCALE = Math.pow(2, 7);\r\nenum TMode {\r\n    Draw,\r\n    Hand,\r\n    HandGrabbing,\r\n    Pick,\r\n    Zoom,\r\n    Rotate,\r\n    Rotating,\r\n    Fill,\r\n    Gradient,\r\n    Text,\r\n    Shape,\r\n}\r\nconst ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\r\n\r\n/**\r\n * Work area that displays the KlCanvas.\r\n * - pan, zoom, rotate (also via multi-touch)\r\n * - input modes: drawing, hand, pick, fill, text // transform, select\r\n * - drawing input events\r\n * - view change events\r\n * - eyedropper input events (pick)\r\n * - draws cursor, eyedropper overlay\r\n *\r\n * subscribes to klCanvas changes\r\n * listens to kl history for changes\r\n * and you can manually trigger redraw\r\n */\r\nexport class KlCanvasWorkspace {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private klCanvas: KlCanvas;\r\n    private readonly renderTargetCanvas: HTMLCanvasElement;\r\n    private readonly renderTargetCtx: CanvasRenderingContext2D;\r\n    private renderWidth: number;\r\n    private renderHeight: number;\r\n    private readonly compositeCanvas: HTMLCanvasElement; // for drawing klcanvas layer composite\r\n    private readonly compositeCtx: CanvasRenderingContext2D;\r\n    private doResizeCanvas: boolean;\r\n    private oldTransformObj: ITransform | null;\r\n    private targetTransformObj: ITransform; // animation target\r\n    private highResTransformObj: ITransform; // animated, internal high-res\r\n    private readonly renderedTransformObj: ITransform; // same as highRes, but rounded - what's actually displayed\r\n    private cursorPos: IVector2D;\r\n    private readonly usesCssCursor: boolean;\r\n    private bgVisible: boolean;\r\n    private transformIsDirty: boolean;\r\n    private doAnimateTranslate: boolean;\r\n    private svgOverlay: WorkspaceSvgOverlay;\r\n    private readonly emptyCanvas: HTMLCanvasElement;\r\n    private readonly emptyLightCanvas: HTMLCanvasElement;\r\n    private keyListener: KeyListener;\r\n    private currentMode: TMode;\r\n    private globalMode: TMode;\r\n    private renderTime: number; // for debugging - average ms per render()\r\n    private lastDrawEvent: IPressureInput | null; // previous drawing input\r\n    private linetoolProcessor: LinetoolProcessor;\r\n    private pointer: IVector2D | null; // position of cursor\r\n    private isDrawing: boolean;\r\n    private inputProcessorObj: {\r\n        [key in TInputProcessorKeys]: TInputProcessorItem;\r\n    };\r\n    private currentInputProcessor: TInputProcessorItem | null;\r\n    private angleIsExtraSticky: boolean;\r\n    private readonly pinchZoomer: PinchZoomer;\r\n    private readonly mainDoubleTapper: DoubleTapper;\r\n    private readonly middleDoubleTapper: DoubleTapper;\r\n    private readonly twoFingerTap: NFingerTapper;\r\n    private readonly threeFingerTap: NFingerTapper;\r\n    private pointerEventChain: EventChain;\r\n    private pointerListener: PointerListener | undefined;\r\n    private brushRadius: number;\r\n    private animationFrameRequested: boolean;\r\n    private lastRenderedState: number; // KlHistory state - to detect if there are changes to draw\r\n    private lastRenderTime: number; // ms from performance.now()\r\n    private hideBrushCursorTimeout: (ReturnType<typeof setTimeout>) | undefined;\r\n    private readonly onViewChange: (e:  IViewChangeEvent) => void;\r\n\r\n    private getRenderedTransform (): ITransform {\r\n        // rounded x & y so canvas is less blurry.\r\n        const result = this.renderedTransformObj;\r\n        result.x = this.highResTransformObj.x;\r\n        result.y = this.highResTransformObj.y;\r\n        result.scale = this.highResTransformObj.scale;\r\n        result.angle = this.highResTransformObj.angle;\r\n\r\n        if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\r\n            result.x = Math.round(result.x);\r\n            result.y = Math.round(result.y);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private updateChangeListener (): void {\r\n        this.klCanvas.addChangeListener(() => {\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n        });\r\n    }\r\n\r\n    private updateCursor (modeInt: TMode, doForce?: boolean): void {\r\n        if (modeInt === this.currentMode && !doForce) {\r\n            return;\r\n        }\r\n        const oldMode = this.currentMode;\r\n        this.currentMode = modeInt;\r\n        this.lastRenderedState = -1;\r\n        if (this.currentMode === TMode.Draw) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        } else if (this.currentMode === TMode.Hand) {\r\n            this.rootEl.style.cursor = 'grab';\r\n        } else if (this.currentMode === TMode.HandGrabbing) {\r\n            this.rootEl.style.cursor = 'grabbing';\r\n        } else if (this.currentMode === TMode.Pick) {\r\n            this.rootEl.style.cursor = \"url('\" + pickerImg + \"') 0 15, crosshair\";\r\n        } else if (this.currentMode === TMode.Zoom) {\r\n            this.rootEl.style.cursor = \"url('\" + zoomEwImg + \"') 7 7, zoom-in\";\r\n        } else if (this.currentMode === TMode.Rotate) {\r\n            this.rootEl.style.cursor = 'grab';\r\n        } else if (this.currentMode === TMode.Rotating) {\r\n            this.rootEl.style.cursor = 'grabbing';\r\n        } else if (this.currentMode === TMode.Fill) {\r\n            this.rootEl.style.cursor = \"url('\" + fillImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Gradient) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        } else if (this.currentMode === TMode.Text) {\r\n            this.rootEl.style.cursor = \"url('\" + textImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Shape) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        }\r\n\r\n        if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode)) {\r\n            const oldIsHand = [TMode.Hand, TMode.HandGrabbing].includes(oldMode);\r\n            const currentIsHand = [TMode.Hand, TMode.HandGrabbing].includes(this.currentMode);\r\n            if (!oldIsHand && currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n            }\r\n            if (oldIsHand && !currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n            }\r\n        }\r\n\r\n        if (this.currentMode !== TMode.Pick) {\r\n            this.svgOverlay.updateColorPreview({isVisible: false});\r\n        }\r\n    }\r\n\r\n    /**\r\n     * returns false if no change of zoom\r\n     * @param stepNum\r\n     * @param centerX\r\n     * @param centerY\r\n     * @private\r\n     */\r\n    private internalZoomByStep (stepNum: number, centerX: number, centerY: number): boolean {\r\n        const step = Math.log2(this.targetTransformObj.scale);\r\n\r\n        let newStep = step / Math.abs(stepNum);\r\n        newStep += stepNum > 0 ? 1 : -1;\r\n        newStep = Math.round(newStep);\r\n        newStep *= Math.abs(stepNum);\r\n        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, Math.pow(2, newStep)));\r\n\r\n        //has zoomed?\r\n        if (newScale === this.targetTransformObj.scale) {\r\n            return false;\r\n        }\r\n\r\n\r\n        const effectiveFactor = newScale / this.targetTransformObj.scale;\r\n        this.targetTransformObj.scale = newScale;\r\n\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerX, centerY));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerX, -centerY));\r\n\r\n        let origin: TVec4 = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.transformIsDirty = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * mixes two transform objects. modifies A\r\n     * @param transformA\r\n     * @param transformB\r\n     * @param blendFactor 0 -> A, 1 -> B\r\n     * @private\r\n     */\r\n    private mixTransformObj (transformA: ITransform, transformB: ITransform, blendFactor: number): void {\r\n        if (transformA.angle === transformB.angle) {\r\n            transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n            transformA.x = BB.mix(transformA.x, transformB.x, blendFactor);\r\n            transformA.y = BB.mix(transformA.y, transformB.y, blendFactor);\r\n            transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n            return;\r\n        }\r\n\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        // --- determine centerPosA, centerPosB ---\r\n        const centerPosA = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2,\r\n        }, transformA);\r\n        const centerPosB = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2,\r\n        }, transformB);\r\n\r\n        // --- centerPosMixed ---\r\n        transformA.x = BB.mix(centerPosA.x , centerPosB.x, blendFactor);\r\n        transformA.y = BB.mix(centerPosA.y , centerPosB.y, blendFactor);\r\n\r\n        // --- scale and angle ---\r\n        transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n        transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n\r\n        // --- x and y ---\r\n        const mixedPos = this.canvasToWorkspaceCoord({\r\n            x: -w / 2,\r\n            y: -h / 2,\r\n        }, transformA);\r\n        transformA.x = mixedPos.x;\r\n        transformA.y = mixedPos.y;\r\n    }\r\n\r\n    private render (): void {\r\n        if (this.doResizeCanvas) {\r\n            this.doResizeCanvas = false;\r\n            this.renderTargetCanvas.width = this.renderWidth;\r\n            this.renderTargetCanvas.height = this.renderHeight;\r\n        }\r\n        this.renderContext(this.renderTargetCtx);\r\n    }\r\n\r\n    /**\r\n     * is the gray background that surrounds canvas visible?\r\n     * @private\r\n     */\r\n    private testBgVisible (): boolean {\r\n        //bring workspace points (corners of workspace) into canvas coordinate system\r\n        //then check if any corner point is outside of the canvas -> that means the bg is visible\r\n\r\n        const workspacePointArr = [\r\n            [0, 0], // top left\r\n            [this.renderWidth, 0], // top right\r\n            [this.renderWidth, this.renderHeight], // bottom right\r\n            [0, this.renderHeight], // bottom left\r\n        ];\r\n\r\n        const art = this.getRenderedTransform();\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        //transform points, then test if outside of canvas\r\n        for (let i = 0; i < workspacePointArr.length; i++) {\r\n            let coords: TVec4 = [workspacePointArr[i][0], workspacePointArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n            if (\r\n                !(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() &&\r\n                    0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())\r\n            ){\r\n                //if not inside -> bg visible\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private renderContext (ctx: CanvasRenderingContext2D): void {\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        const art = this.getRenderedTransform();\r\n        const isDark = theme.isDark();\r\n\r\n        if (art.scale >= 4 || (art.scale === 1 && art.angle === 0)) {\r\n            ctx.imageSmoothingEnabled = false;\r\n        } else {\r\n            ctx.imageSmoothingEnabled = true;\r\n            ctx.imageSmoothingQuality  = 'low'; // art.scale >= 1 ? 'low' : 'medium';\r\n        }\r\n        //ctx.imageSmoothingEnabled = false;\r\n        //renderTargetCtx.globalCompositeOperation  = 'multiply';\r\n\r\n\r\n\r\n        ctx.save();\r\n        {\r\n            if (this.bgVisible) {\r\n                ctx.fillStyle = isDark ? 'rgb(33, 33, 33)' : 'rgb(158,158,158)'; // 'rgb(185,185,185)';\r\n                ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\r\n            } else {\r\n                ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\r\n            }\r\n\r\n\r\n\r\n            if (this.bgVisible) {\r\n                ctx.save();\r\n\r\n                ctx.translate(art.x, art.y);\r\n                ctx.scale(art.scale, art.scale);\r\n                ctx.rotate(art.angle);\r\n\r\n                ctx.imageSmoothingEnabled = false;\r\n\r\n                //outline\r\n                const borderSize = 1;\r\n                ctx.globalAlpha = isDark ? 0.25 : 0.2;\r\n                ctx.drawImage(\r\n                    isDark ? this.emptyLightCanvas : this.emptyCanvas,\r\n                    -borderSize / art.scale,\r\n                    -borderSize / art.scale,\r\n                    w + borderSize * 2 / art.scale,\r\n                    h + borderSize * 2 / art.scale\r\n                );\r\n                ctx.globalAlpha = 1;\r\n\r\n                //erase\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n                ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\r\n\r\n                ctx.restore();\r\n            }\r\n\r\n            /*const region = new Path2D();\r\n            region.rect(80, 10, 20, 130);\r\n            ctx.clip(region);*/\r\n\r\n            ctx.translate(art.x, art.y);\r\n            ctx.scale(art.scale, art.scale);\r\n            ctx.rotate(art.angle);\r\n\r\n            const layerArr = this.klCanvas.getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                if (!layerArr[i].isVisible || layerArr[i].opacity === 0) {\r\n                    continue;\r\n                }\r\n\r\n                ctx.globalAlpha = layerArr[i].opacity;\r\n                ctx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n\r\n                const compositeObj = layerArr[i].canvas.compositeObj;\r\n                if (compositeObj) {\r\n                    if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\r\n                        this.compositeCanvas.width = layerArr[i].canvas.width;\r\n                        this.compositeCanvas.height = layerArr[i].canvas.height;\r\n                    } else {\r\n                        this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\r\n                    }\r\n                    this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\r\n                    compositeObj.draw(this.compositeCtx);\r\n                    ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\r\n                } else {\r\n                    ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\r\n                }\r\n            }\r\n            ctx.globalAlpha = 1;\r\n\r\n\r\n\r\n        }\r\n        ctx.restore();\r\n\r\n        // rotation hud\r\n        if (TMode.Rotate === this.currentMode || TMode.Rotating === this.currentMode) {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: true,\r\n                angleDeg: art.angle / Math.PI * 180,\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: false,\r\n            });\r\n        }\r\n    }\r\n\r\n    private workspaceToCanvasCoord (p: IVector2D): IVector2D {\r\n        const art = this.getRenderedTransform();\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        let coords: TVec4 = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private canvasToWorkspaceCoord (p: IVector2D, transformObj: ITransform): IVector2D {\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(transformObj.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(transformObj.scale));\r\n\r\n        let coords: TVec4 = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private snapAngleRad (angleRad: number, snapDegIncrement: number, maxDistDeg: number): number {\r\n        let angleDeg = angleRad * 180 / Math.PI;\r\n        const modDeg = Math.abs(angleDeg % snapDegIncrement);\r\n        const dist = Math.min(modDeg, snapDegIncrement - modDeg);\r\n\r\n        if (dist <= maxDistDeg) {\r\n            angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\r\n        }\r\n\r\n        return angleDeg / 180 * Math.PI;\r\n    }\r\n\r\n    /**\r\n     * angle always in range [-PI, PI]\r\n     * @param angleRad\r\n     * @private\r\n     */\r\n    private minimizeAngleRad (angleRad: number): number {\r\n        angleRad = angleRad % (2 * Math.PI);\r\n        if (angleRad > Math.PI) {\r\n            angleRad -= 2 * Math.PI;\r\n        } else if (angleRad < -Math.PI) {\r\n            angleRad += 2 * Math.PI;\r\n        }\r\n        return angleRad;\r\n    }\r\n\r\n    private resetInputProcessor (): void {\r\n        this.currentInputProcessor = null;\r\n        this.updateCursor(this.globalMode);\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    private reqFrame (doRedrawCanvas?: boolean): void {\r\n        this.animationFrameRequested = true;\r\n        if (doRedrawCanvas) {\r\n            this.lastRenderedState = -1;\r\n        }\r\n    }\r\n\r\n    private updateLoop (): void {\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState;\r\n\r\n        //handle variable framerate\r\n        const nowTime = performance.now();\r\n        const elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\r\n        this.lastRenderTime = nowTime;\r\n\r\n        if (this.animationFrameRequested || doRender) {\r\n            this.animationFrameRequested = false;\r\n            this.checkChange(elapsedFrames);\r\n        }\r\n    }\r\n\r\n    private checkChange (elapsedFrames: number): void {\r\n\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState ||\r\n            this.highResTransformObj.scale !== this.targetTransformObj.scale ||\r\n            this.highResTransformObj.x !== this.targetTransformObj.x ||\r\n            this.highResTransformObj.y !== this.targetTransformObj.y;\r\n\r\n        //update transform\r\n        if (\r\n            !this.doAnimateTranslate &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else if (\r\n            (this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) &&\r\n            (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            this. doAnimateTranslate = false;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else {\r\n            this.reqFrame(); //probably needs another frame\r\n            const blendFactor = Math.min(1, ANIMATION_SPEED * elapsedFrames);\r\n            this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\r\n            this.bgVisible = true; // spare yourself the calculation\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        }\r\n\r\n        if (this.pointer && this.currentMode == TMode.Draw && !this.usesCssCursor) {\r\n            this.svgOverlay.updateCursor({\r\n                x: this.pointer.x,\r\n                y: this.pointer.y,\r\n                isVisible: true,\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCursor({isVisible: false});\r\n        }\r\n\r\n\r\n        if (doRender) {\r\n            //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\r\n            this.lastRenderedState = newState;\r\n            const start = performance.now();\r\n            this.render();\r\n            this.renderTime = BB.mix(this.renderTime, performance.now() - start, 0.05);\r\n        }\r\n        //setTimeout(this.checkChange, 100);\r\n\r\n\r\n\r\n        if (doRender) {\r\n\r\n            //console.log('rendertime ms: ', this.renderTime);\r\n        }\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            klCanvas: KlCanvas;\r\n            width: number;\r\n            height: number;\r\n            onDraw: (val: TDrawEvent) => void;\r\n            onPick: (rgb: IRGB, isPointerup: boolean) => void;\r\n            onFill: (canvasX: number, canvasY: number) => void;\r\n            onGradient: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onText: (canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onShape: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onViewChange: (e:  IViewChangeEvent) => void;\r\n            onUndo: () => void;\r\n            onRedo: () => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                right: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                cursor: 'crosshair',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.klCanvas = p.klCanvas;\r\n        this.onViewChange = p.onViewChange;\r\n        this.renderTargetCanvas = BB.canvas(p.width, p.height);\r\n        this.renderTargetCtx = BB.ctx(this.renderTargetCanvas);\r\n        this.renderWidth = p.width;\r\n        this.renderHeight = p.height;\r\n        this.compositeCanvas = BB.canvas(1, 1); // for drawing klcanvas layer composite\r\n        this.compositeCtx = BB.ctx(this.compositeCanvas);\r\n        this.doResizeCanvas = false;\r\n        this.oldTransformObj = null;\r\n        this.targetTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0,\r\n        };\r\n        this.highResTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0,\r\n        };\r\n        this.renderedTransformObj = {} as ITransform;\r\n        this.cursorPos = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        this.usesCssCursor = false;\r\n        this.bgVisible = true;\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n\r\n        this.svgOverlay = new WorkspaceSvgOverlay({\r\n            width: p.width,\r\n            height: p.height,\r\n        });\r\n\r\n        BB.css(this.renderTargetCanvas, {\r\n            userSelect: 'none',\r\n            pointerEvents: 'none',\r\n        });\r\n        BB.createCheckerDataUrl(8, (url) => {\r\n            this.renderTargetCanvas.style.background = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n\r\n        theme.addIsDarkListener(() => {\r\n            this.renderTargetCanvas.style.background = 'url(' + BB.createCheckerDataUrl(8, undefined, theme.isDark()) + ')';\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n        });\r\n\r\n        this.rootEl.append(this.renderTargetCanvas, this.svgOverlay.getElement());\r\n        this.rootEl.addEventListener( 'touchend', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        this.rootEl.addEventListener('contextmenu', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        this.rootEl.addEventListener('dragstart', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n\r\n        this.emptyCanvas = BB.canvas(1, 1);\r\n        this.emptyLightCanvas = BB.canvas(1, 1);\r\n        {\r\n            let ctx = BB.ctx(this.emptyCanvas);\r\n            ctx.fillRect(0, 0, 1, 1);\r\n            ctx = BB.ctx(this.emptyLightCanvas);\r\n            ctx.fillStyle = '#fff';\r\n            ctx.fillRect(0, 0, 1, 1);\r\n        }\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n                if (isRepeat) {\r\n                    return;\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n\r\n                } else {\r\n\r\n                    if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'space') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.spaceHand;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ([TMode.Draw, TMode.Hand, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'alt') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.altPicker;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if (['r', 'shift+r'].includes(comboStr)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.rotate;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ('z' === comboStr) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.zoom;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                }\r\n\r\n            },\r\n            onUp: (keyStr, event, oldComboStr) => {\r\n                // prevent menu bar in Firefox\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\r\n                }\r\n            },\r\n        });\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.currentMode = TMode.Draw;\r\n        this.globalMode = TMode.Draw;\r\n\r\n        this.renderTime = 0;\r\n\r\n        this.lastDrawEvent = null;\r\n\r\n        this.linetoolProcessor = new LinetoolProcessor({\r\n            onDraw: (event) => {\r\n                const getMatrix = () => {\r\n                    const art = this.getRenderedTransform();\r\n                    let matrix = BB.Matrix.getIdentity();\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n                    return matrix;\r\n                };\r\n\r\n                if (event.type === 'line' && !this.lastDrawEvent) {\r\n                    const matrix = getMatrix();\r\n                    let coords: TVec4 = [event.x1, event.y1, 0, 1];\r\n                    coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                    this.lastDrawEvent = {\r\n                        x: coords[0],\r\n                        y: coords[1],\r\n                        pressure: event.pressure1,\r\n                    };\r\n                    return;\r\n                }\r\n\r\n                if ('x' in event || 'x0' in event) {\r\n\r\n                    const matrix = getMatrix();\r\n\r\n                    if ('x' in event) { //down or move\r\n                        let coords: TVec4 = [event.x, event.y, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x = coords[0];\r\n                        event.y = coords[1];\r\n                    }\r\n                    if ('x0' in event) { //line\r\n                        event.x0 = this.lastDrawEvent!.x;\r\n                        event.y0 = this.lastDrawEvent!.y;\r\n                        event.pressure0 = this.lastDrawEvent!.pressure;\r\n                        let coords: TVec4 = [event.x1, event.y1, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x1 = coords[0];\r\n                        event.y1 = coords[1];\r\n\r\n                        this.lastDrawEvent = {\r\n                            x: event.x1,\r\n                            y: event.y1,\r\n                            pressure: event.pressure1,\r\n                        };\r\n                    }\r\n                }\r\n\r\n\r\n                if (event.type === 'down' || event.type === 'move') {\r\n                    this.lastDrawEvent = {\r\n                        x: event.x,\r\n                        y: event.y,\r\n                        pressure: event.pressure,\r\n                    };\r\n                }\r\n                p.onDraw(event);\r\n            },\r\n        });\r\n\r\n        this.pointer = null;\r\n        this.isDrawing = false;\r\n\r\n\r\n        this.inputProcessorObj = {\r\n            draw: {\r\n                onPointer: (val) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Draw);\r\n\r\n                    const comboStr = this.keyListener.getComboStr();\r\n\r\n                    const event: any = {\r\n                        scale: this.highResTransformObj.scale,\r\n                    };\r\n                    event.shiftIsPressed = comboStr === 'shift';\r\n                    event.pressure = val.pressure;\r\n                    event.isCoalesced = !!val.isCoalesced;\r\n\r\n                    if (val.type === 'pointerdown') {\r\n\r\n                        this.isDrawing = true;\r\n                        event.type = 'down';\r\n\r\n                    } else if (val.button) {\r\n                        event.type = 'move';\r\n\r\n                    } else if (val.type === 'pointerup') {\r\n\r\n                        this.isDrawing = false;\r\n                        event.type = 'up';\r\n\r\n                        this.linetoolProcessor.process(event);\r\n                        this.resetInputProcessor();\r\n                        return;\r\n                    } else {\r\n                        return;\r\n                    }\r\n\r\n                    event.x = val.relX;\r\n                    event.y = val.relY;\r\n\r\n                    this.linetoolProcessor.process(event);\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            fill: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Fill);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            gradient: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Gradient);\r\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        this.isDrawing = true;\r\n                        p.onGradient('down', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        p.onGradient('move', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.isDrawing = false;\r\n                        p.onGradient('up', coord.x, coord.y, this.renderedTransformObj.angle);\r\n                        this.resetInputProcessor();\r\n\r\n                    }\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            text: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Text);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            shape: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Shape);\r\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        this.isDrawing = true;\r\n                        p.onShape('down', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        p.onShape('move', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.isDrawing = false;\r\n                        p.onShape('up', coord.x, coord.y, this.renderedTransformObj.angle);\r\n                        this.resetInputProcessor();\r\n\r\n                    }\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            hand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button || '')) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            spaceHand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button || '')) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    }\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'space') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                },\r\n            },\r\n            zoom: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Zoom);\r\n\r\n                    if (event.button === 'left' && !event.isCoalesced && event.dX != 0) {\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n\r\n                        this.internalZoomByStep(event.dX / 175, event.downPageX! - offsetX, event.downPageY! - offsetY);\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale,\r\n                        });\r\n                    }\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'z') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Zoom);\r\n                    }\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                },\r\n            },\r\n            picker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button || '') && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup',\r\n                        });\r\n\r\n                        if (event.type === 'pointerup') {\r\n                            this.resetInputProcessor();\r\n                        }\r\n                    }\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            altPicker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button || '') && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup',\r\n                        });\r\n                    }\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'alt') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                },\r\n            },\r\n            rotate: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(event.button === 'left' ? TMode.Rotating : TMode.Rotate);\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.oldTransformObj = BB.copyObj(this.targetTransformObj);\r\n                    } else if (event.button === 'left' && !event.isCoalesced && this.oldTransformObj) {\r\n\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n                        //rotation done around center\r\n                        const centerObj = {\r\n                            x: this.renderWidth / 2,\r\n                            y: this.renderHeight / 2,\r\n                        };\r\n\r\n                        const startAngleRad = BB.Vec2.angle(centerObj, {x: event.downPageX! - offsetX, y: event.downPageY! - offsetY});\r\n                        const angleRad = BB.Vec2.angle(centerObj, {x: event.pageX - offsetX, y: event.pageY - offsetY});\r\n                        let dAngleRad = angleRad - startAngleRad;\r\n\r\n                        //apply angle\r\n                        this.targetTransformObj = BB.copyObj(this.oldTransformObj);\r\n                        this.targetTransformObj.angle += dAngleRad;\r\n\r\n                        if (this.keyListener.isPressed('shift')) {\r\n                            this.targetTransformObj.angle = Math.round(this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\r\n                            dAngleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n                        }\r\n\r\n                        this.targetTransformObj.angle = this.minimizeAngleRad(this.targetTransformObj.angle);\r\n\r\n                        //rotate transform.xy\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(dAngleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\r\n\r\n                        let origin: TVec4 = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n\r\n                        this.transformIsDirty = true;\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['angle'],\r\n                            scale: this.targetTransformObj.scale,\r\n                            angle: this.targetTransformObj.angle,\r\n                        });\r\n\r\n                    }\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    const comboStr = this.keyListener.getComboStr();\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n            },\r\n        };\r\n        this.currentInputProcessor = null;\r\n\r\n\r\n        this.angleIsExtraSticky = false;\r\n        this.pinchZoomer = new BB.PinchZoomer({\r\n            onPinch: (event) => {\r\n\r\n                if (event.type === 'move') {\r\n\r\n                    if (!this.oldTransformObj) {\r\n                        this.oldTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.angleIsExtraSticky = this.targetTransformObj.angle % (Math.PI / 2) === 0;\r\n                    }\r\n\r\n                    this.targetTransformObj = BB.copyObj(this.oldTransformObj);\r\n\r\n                    event.scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, this.targetTransformObj.scale * event.scale)) / this.targetTransformObj.scale;\r\n\r\n                    this.targetTransformObj.scale *= event.scale;\r\n                    this.targetTransformObj.angle += event.angleRad;\r\n                    this.targetTransformObj.angle = this.minimizeAngleRad(\r\n                        this.snapAngleRad(\r\n                            this.targetTransformObj.angle,\r\n                            90,\r\n                            this.angleIsExtraSticky ? 12 : 4\r\n                        )\r\n                    );\r\n                    if (this.targetTransformObj.angle % (Math.PI / 2) !== 0) {\r\n                        this.angleIsExtraSticky = false;\r\n                    }\r\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\r\n                    event.angleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n\r\n                    //calc translation\r\n                    {\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX, event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(event.scale));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(event.angleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-event.relX, -event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\r\n\r\n\r\n                        let origin: TVec4 = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                    }\r\n\r\n                    this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n\r\n                    //if (event.scale !== 1) {\r\n                    this.onViewChange({\r\n                        changed: ['scale', 'angle'],\r\n                        scale: this.targetTransformObj.scale,\r\n                        angle: this.targetTransformObj.angle,\r\n                    });\r\n                    //}\r\n                    this.reqFrame();\r\n                    this.transformIsDirty = true;\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                } else if (event.type === 'end') {\r\n                    this.oldTransformObj = null;\r\n                }\r\n\r\n\r\n            },\r\n        });\r\n\r\n        const onDoubleTap = (event: IDoubleTapperEvent) => {\r\n            if (this.fitView(true)) {\r\n                this.lastRenderedState = -1;\r\n                this.reqFrame();\r\n            } else {\r\n                // zoom 2 steps further\r\n\r\n                const didZoom = this.internalZoomByStep(\r\n                    2,\r\n                    event.relX,\r\n                    event.relY,\r\n                );\r\n                if (didZoom) {\r\n                    this.onViewChange({\r\n                        changed: ['scale'],\r\n                        angle: this.targetTransformObj.angle,\r\n                        scale: this.targetTransformObj.scale,\r\n                    });\r\n                }\r\n\r\n                //updateCursor(TMode.Draw, true);\r\n                this.lastRenderedState = -1;\r\n            }\r\n        };\r\n\r\n        this.mainDoubleTapper = new BB.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper = new BB.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper.setAllowedButtonArr(['middle']);\r\n\r\n\r\n        this.twoFingerTap = new BB.NFingerTapper({\r\n            fingers: 2,\r\n            onTap: () => {\r\n                p.onUndo();\r\n            },\r\n        });\r\n        this.threeFingerTap = new BB.NFingerTapper({\r\n            fingers: 3,\r\n            onTap: () => {\r\n                p.onRedo();\r\n            },\r\n        });\r\n\r\n\r\n        this.pointerEventChain = new BB.EventChain({\r\n            chainArr: [\r\n                this.twoFingerTap as IChainElement,\r\n                this.threeFingerTap as IChainElement,\r\n                this.mainDoubleTapper as IChainElement,\r\n                this.middleDoubleTapper as IChainElement,\r\n                this.pinchZoomer as IChainElement,\r\n                new BB.OnePointerLimiter() as IChainElement,\r\n                new BB.CoalescedExploder() as IChainElement,\r\n            ],\r\n        });\r\n        this.pointerEventChain.setChainOut((event: ICoalescedPointerEvent) => {\r\n\r\n            this.cursorPos.x = event.relX;\r\n            this.cursorPos.y = event.relY;\r\n            if (event.type === 'pointerup' && event.pointerType === 'touch') {\r\n                this.pointer = null;\r\n                this.lastRenderedState = -1;\r\n                this.reqFrame();\r\n            } else {\r\n                if (!this.pointer) {\r\n                    this.pointer = { x: 0, y: 0 };\r\n                }\r\n                this.pointer.x = event.relX;\r\n                this.pointer.y = event.relY;\r\n            }\r\n\r\n            if (this.currentInputProcessor) {\r\n                this.currentInputProcessor.onPointer(event);\r\n\r\n            } else {\r\n\r\n                const comboStr = this.keyListener.getComboStr();\r\n\r\n                if (this.globalMode === TMode.Draw) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.draw;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Draw);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Hand) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'middle'].includes(event.button || '')) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Pick) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'right'].includes(event.button || '')) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Fill) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.fill;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Fill);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Gradient) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.gradient;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Gradient);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Text) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.text;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Text);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Shape) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.shape;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Shape);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n        });\r\n\r\n        //prevent ctrl scroll -> zooming page\r\n        this.rootEl.addEventListener('wheel', (event) => {\r\n            event.preventDefault();\r\n        });\r\n\r\n\r\n        setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.rootEl,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    if (e.type === 'pointerdown' && e.button === 'middle') {\r\n                        try {\r\n                            e.eventPreventDefault();\r\n                        } catch (e) {\r\n                            /* empty */\r\n                        }\r\n                    }\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    if (e.type === 'pointerdown') {\r\n                        BB.unfocusAnyInput();\r\n                    }\r\n                    /*if (e.type === 'pointermove') {\r\n                        BB.throwOut(JSON.stringify(e));\r\n                    }*/\r\n\r\n                    this.pointerEventChain.chainIn(e);\r\n                },\r\n                onWheel: (wheelEvent) => {\r\n\r\n                    if (this.isDrawing) {\r\n                        return;\r\n                    }\r\n\r\n                    this.reqFrame();\r\n                    const didZoom = this.internalZoomByStep(\r\n                        -wheelEvent.deltaY / (this.keyListener.isPressed('shift') ? 8 : 2),\r\n                        wheelEvent.relX,\r\n                        wheelEvent.relY\r\n                    );\r\n                    if (didZoom) {\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale,\r\n                        });\r\n                    }\r\n\r\n                    //updateCursor(TMode.Draw, true);\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                },\r\n                onEnterLeave: (isOver) => {\r\n                    if (!isOver) {\r\n                        if (!this.isDrawing) {\r\n                            this.pointer = null;\r\n                            this.lastRenderedState = -1;\r\n                        }\r\n                    }\r\n                },\r\n                maxPointers: 4,\r\n            });\r\n        }, 1);\r\n\r\n        this.brushRadius = 1;\r\n\r\n        this.animationFrameRequested = false;\r\n\r\n\r\n\r\n\r\n        //setup rendering\r\n        this.lastRenderedState = -2;\r\n        this.lastRenderTime = performance.now();\r\n\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n\r\n        this.resetOrFitView();\r\n    }\r\n\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setCanvas (klC: KlCanvas): void {\r\n        this.klCanvas = klC;\r\n        this.lastDrawEvent = null;\r\n        this.resetView();\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    /**\r\n     * set size of workspace area in pixels\r\n     * @param width\r\n     * @param height\r\n     */\r\n    setSize (width: number, height: number): void {\r\n        const oldWidth = this.renderWidth;\r\n        const oldHeight = this.renderHeight;\r\n\r\n        if (width === oldWidth && height === oldHeight) {\r\n            return;\r\n        }\r\n\r\n        this.doResizeCanvas = true;\r\n        this.renderWidth = width;\r\n        this.renderHeight = height;\r\n\r\n        this.svgOverlay.setSize(width, height);\r\n\r\n        this.targetTransformObj.x += (width - oldWidth) / 2;\r\n        this.targetTransformObj.y += (height - oldHeight) / 2;\r\n\r\n        this.highResTransformObj.x = this.targetTransformObj.x;\r\n        this.highResTransformObj.y = this.targetTransformObj.y;\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setMode (modeStr: TModeStr): void {\r\n        //only sets the base mode\r\n        if (modeStr === 'draw') {\r\n            this.globalMode = TMode.Draw;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'fill') {\r\n            this.globalMode = TMode.Fill;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'gradient') {\r\n            this.globalMode = TMode.Gradient;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'text') {\r\n            this.globalMode = TMode.Text;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'shape') {\r\n            this.globalMode = TMode.Shape;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'hand') {\r\n            this.globalMode = TMode.Hand;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n        }\r\n        if (modeStr === 'pick') {\r\n            this.globalMode = TMode.Pick;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n    }\r\n\r\n    getMode (): TModeStr {\r\n        if (this.globalMode === TMode.Draw) {\r\n            return 'draw';\r\n        }\r\n        if (this.globalMode === TMode.Fill) {\r\n            return 'fill';\r\n        }\r\n        if (this.globalMode === TMode.Gradient) {\r\n            return 'gradient';\r\n        }\r\n        if (this.globalMode === TMode.Text) {\r\n            return 'text';\r\n        }\r\n        if (this.globalMode === TMode.Shape) {\r\n            return 'shape';\r\n        }\r\n        if (this.globalMode === TMode.Hand) {\r\n            return 'hand';\r\n        }\r\n        if (this.globalMode === TMode.Pick) {\r\n            return 'pick';\r\n        }\r\n        throw new Error('unknown globalMode');\r\n    }\r\n\r\n    setCursorSize (diameter: number): void {\r\n        this.brushRadius = diameter / 2;\r\n\r\n        this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n\r\n        if (this.pointer === null) {\r\n            this.hideBrushCursorTimeout && clearTimeout(this.hideBrushCursorTimeout);\r\n\r\n            this.svgOverlay.updateCursor({\r\n                x: this.renderWidth / 2,\r\n                y: this.renderHeight / 2,\r\n                isVisible: true,\r\n            });\r\n\r\n            this.hideBrushCursorTimeout = setTimeout(() => {\r\n                if (this.pointer !== null) {\r\n                    return;\r\n                }\r\n                this.svgOverlay.updateCursor({isVisible: false});\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n    zoomByStep (stepNum: number): void {\r\n        if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) {\r\n            return;\r\n        }\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale'],\r\n            angle: this.targetTransformObj.angle,\r\n            scale: this.targetTransformObj.scale,\r\n        });\r\n    }\r\n\r\n    resetView (doAnimate?: boolean): void {\r\n        this.targetTransformObj.scale = 1;\r\n        this.targetTransformObj.angle = 0;\r\n\r\n        this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\r\n        this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\r\n\r\n        if (doAnimate) {\r\n            this.doAnimateTranslate = true;\r\n            this.transformIsDirty = true;\r\n        } else {\r\n            this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n        }\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n        this.reqFrame();\r\n\r\n        if (doAnimate) {\r\n            this.onViewChange({\r\n                changed: ['scale', 'angle'],\r\n                scale: this.targetTransformObj.scale,\r\n                angle: this.targetTransformObj.angle,\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * fit into view. center. snap angle. padding\r\n     * returns true if transform changes\r\n     */\r\n    fitView (doAnimate?: boolean): boolean {\r\n        // determine new transform\r\n        const newAngle = this.snapAngleRad(this.targetTransformObj.angle, 90, 90);\r\n\r\n        //calc width and height of bounds\r\n        const canvasPointsArr = [\r\n            [0, 0], // top left\r\n            [this.klCanvas.getWidth(), 0], // top right\r\n            [this.klCanvas.getWidth(), this.klCanvas.getHeight()], // bottom right\r\n            [0, this.klCanvas.getHeight()], // bottom left\r\n            [this.klCanvas.getWidth() / 2, this.klCanvas.getHeight() / 2], // center\r\n        ];\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(newAngle));\r\n\r\n        //rotate points\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            let coords: TVec4 = [canvasPointsArr[i][0], canvasPointsArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n            canvasPointsArr[i][0] = coords[0];\r\n            canvasPointsArr[i][1] = coords[1];\r\n        }\r\n\r\n        const boundsObj: Partial<IBounds> = {};\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            if (boundsObj.x1 === undefined || canvasPointsArr[i][0] < boundsObj.x1) {\r\n                boundsObj.x1 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y1 === undefined || canvasPointsArr[i][1] < boundsObj.y1) {\r\n                boundsObj.y1 = canvasPointsArr[i][1];\r\n            }\r\n            if (boundsObj.x2 === undefined || canvasPointsArr[i][0] > boundsObj.x2) {\r\n                boundsObj.x2 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y2 === undefined || canvasPointsArr[i][1] > boundsObj.y2) {\r\n                boundsObj.y2 = canvasPointsArr[i][1];\r\n            }\r\n        }\r\n        const boundsWidth = boundsObj.x2! - boundsObj.x1!;\r\n        const boundsHeight = boundsObj.y2! - boundsObj.y1!;\r\n\r\n        //fit bounds\r\n        const padding = 0;\r\n        const { width: fitWidth } = BB.fitInto(\r\n            boundsWidth,\r\n            boundsHeight, \r\n            this.renderWidth - padding, \r\n            this.renderHeight - padding, \r\n            1\r\n        );\r\n\r\n        //determine scale\r\n        const factor = Math.min(MAX_SCALE, fitWidth / boundsWidth);\r\n\r\n        const newTargetTransformObj = {\r\n            angle: newAngle,\r\n            x: (this.renderWidth / 2) - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor,\r\n            y: (this.renderHeight / 2) - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor,\r\n            scale: factor,\r\n        };\r\n\r\n        if (\r\n            newTargetTransformObj.angle === this.targetTransformObj.angle &&\r\n            Math.abs(newTargetTransformObj.x - this.targetTransformObj.x) < 0.0000000001 &&\r\n            Math.abs(newTargetTransformObj.y - this.targetTransformObj.y) < 0.0000000001 &&\r\n            newTargetTransformObj.scale === this.targetTransformObj.scale\r\n        ) {\r\n            return false;\r\n        }\r\n        this.targetTransformObj = newTargetTransformObj;\r\n\r\n        if (doAnimate) {\r\n            this.doAnimateTranslate = true;\r\n        } else {\r\n            this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n        }\r\n        this.transformIsDirty = true;\r\n        this.reqFrame();\r\n\r\n        if (doAnimate) {\r\n            this.onViewChange({\r\n                changed: ['scale', 'angle'],\r\n                scale: this.targetTransformObj.scale,\r\n                angle: this.targetTransformObj.angle,\r\n            });\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * let the workspace decide what is best. E.g. if it's pixel art, Fit might be better.\r\n     */\r\n    resetOrFitView (): void {\r\n        const threshold = 4; // >= 400% zoom. pixelated, not blurry\r\n        if (\r\n            !klConfig.disableAutoFit &&\r\n            this.klCanvas.getWidth() <= this.renderWidth / threshold &&\r\n            this.klCanvas.getHeight() <= this.renderHeight / threshold\r\n        ) {\r\n            this.fitView();\r\n        } else {\r\n            this.resetView();\r\n        }\r\n    }\r\n\r\n    setAngle (angleDeg: number, isRelative?: boolean): void {\r\n        //rotation done around center\r\n        const centerObj = {\r\n            x: this.renderWidth / 2,\r\n            y: this.renderHeight / 2,\r\n        };\r\n\r\n        const oldAngleRad = this.targetTransformObj.angle;\r\n        const angleRad = angleDeg / 180 * Math.PI;\r\n\r\n        if (isRelative) {\r\n            this.targetTransformObj.angle += angleRad;\r\n        } else {\r\n            this.targetTransformObj.angle = angleRad;\r\n        }\r\n\r\n        this.targetTransformObj.angle = this.minimizeAngleRad(\r\n            this.snapAngleRad(\r\n                this.targetTransformObj.angle,\r\n                90,\r\n                4\r\n            )\r\n        );\r\n\r\n        //rotate transform.xy\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n\r\n        let origin: TVec4 = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n        this.transformIsDirty = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    /**\r\n     * translate canvas by viewport pixels\r\n     * @param tx\r\n     * @param ty\r\n     */\r\n    translateView (tx: number, ty: number): void {\r\n        const scale = 40;\r\n\r\n        this.targetTransformObj.x += tx * scale;\r\n        this.targetTransformObj.y += ty * scale;\r\n\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    getScale (): number {\r\n        return this.targetTransformObj.scale;\r\n    }\r\n\r\n    getAngleDeg (): number {\r\n        return this.targetTransformObj.angle * 180 / Math.PI;\r\n    }\r\n\r\n    getMaxScale (): number {\r\n        return MAX_SCALE;\r\n    }\r\n\r\n    getMinScale (): number {\r\n        return MIN_SCALE;\r\n    }\r\n\r\n    requestFrame (): void {\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setLastDrawEvent (x?: number, y?: number, pressure?: number): void {\r\n        if (x === undefined) {\r\n            this.lastDrawEvent = null;\r\n            return;\r\n        }\r\n\r\n        if (!this.lastDrawEvent) {\r\n            this.lastDrawEvent = {x: 0, y: 0, pressure: 0};\r\n        }\r\n        this.lastDrawEvent.x = x;\r\n        this.lastDrawEvent.y = y!;\r\n        this.lastDrawEvent.pressure = pressure!;\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ayl5b\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"8Sx0P\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ixtEz\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3iHbP\");","import {IDrawDownEvent, IDrawMoveEvent, IDrawUpEvent, TDrawEvent} from '../kl-types';\r\nimport {BB} from '../../bb/bb';\r\n\r\nconst DIR_X = 0;\r\nconst DIR_Y = 1;\r\n\r\n/**\r\n * Not really and event chain element. but pretty similar.\r\n *\r\n * Processes draw input events. When shift held -> linetool\r\n * line events - what KlCanvasWorkspace passes onDraw(e)\r\n *\r\n * pass input in with process(drawEvent)\r\n *\r\n * modifies draw event to include such events:\r\n * {\r\n *     type: 'line',\r\n *     x0: null, // you have to fill that in\r\n *     y0: null, // you have to fill that in\r\n *     pressure0: null, // you have to fill that in\r\n *     x1: number,\r\n *     y1: number,\r\n *     pressure1: number\r\n * }\r\n */\r\nexport class LinetoolProcessor {\r\n\r\n    private readonly onDraw: (drawEvent: TDrawEvent) => void;\r\n    private downEvent: IDrawDownEvent | null = null;\r\n    private eventQueue: (IDrawDownEvent | IDrawMoveEvent | IDrawUpEvent)[] = [];\r\n    private direction: 0 | 1 | null = null;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p : {\r\n            onDraw: (drawEvent: TDrawEvent) => void;\r\n        }\r\n    ) {\r\n        this.onDraw = p.onDraw;\r\n    }\r\n\r\n    process (event: IDrawDownEvent | IDrawMoveEvent | IDrawUpEvent): void {\r\n        if (event.type === 'down') {\r\n            this.downEvent = event;\r\n            this.direction = null;\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                this.onDraw({\r\n                    type: 'line',\r\n                    x0: null,\r\n                    y0: null,\r\n                    pressure0: null,\r\n                    x1: event.x,\r\n                    y1: event.y,\r\n                    pressure1: event.pressure,\r\n                });\r\n\r\n                this.eventQueue.push(event);\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'move' && this.downEvent) {\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                if (this.direction === null) {\r\n                    const dX = Math.abs(event.x - this.downEvent.x);\r\n                    const dY = Math.abs(event.y - this.downEvent.y);\r\n\r\n                    if (dX > 5 || dY > 5) {\r\n                        this.direction = dX > dY ? DIR_X : DIR_Y;\r\n\r\n                        for (let i = 0; i < this.eventQueue.length; i++) {\r\n                            const e = this.eventQueue[i];\r\n                            if (e.type !== 'up') {\r\n                                if (this.direction === DIR_X) {\r\n                                    e.y = this.downEvent.y;\r\n                                } else {\r\n                                    e.x = this.downEvent.x;\r\n                                }\r\n                            }\r\n                            this.onDraw(BB.copyObj(e));\r\n                        }\r\n                        this.eventQueue = [];\r\n                    }\r\n                }\r\n\r\n                if (this.direction === null) {\r\n                    this.eventQueue.push(event);\r\n                    return;\r\n                }\r\n\r\n                if (this.direction === DIR_X) {\r\n                    event.y = this.downEvent.y;\r\n                } else {\r\n                    event.x = this.downEvent.x;\r\n                }\r\n\r\n            } else {\r\n                if (this.eventQueue.length > 0) {\r\n                    for (let i = 0; i < this.eventQueue.length; i++) {\r\n                        this.onDraw(BB.copyObj(this.eventQueue[i]));\r\n                    }\r\n                    this.eventQueue = [];\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'up') {\r\n            this.eventQueue = [];\r\n            this.downEvent = null;\r\n        }\r\n\r\n        this.onDraw(BB.copyObj(event));\r\n    }\r\n}\r\n","\r\ntype TKlConfig = {\r\n    filenameBase: string; // part of filename when downloading drawing\r\n    disableAutoFit?: boolean;\r\n};\r\n\r\nexport const klConfig: TKlConfig = {\r\n    filenameBase: 'Klecks',\r\n};\r\n","import {BB} from '../../bb/bb';\r\nimport {IKlBasicLayer} from '../kl-types';\r\nimport {theme} from '../../theme/theme';\r\n\r\n/**\r\n * preview of image with layers. can do mix modes and opacity.\r\n * creates a canvas.\r\n */\r\nexport class KlCanvasPreview {\r\n\r\n    private readonly canvas: HTMLCanvasElement;\r\n    private readonly ctx: CanvasRenderingContext2D | null;\r\n    private readonly layers: IKlBasicLayer[];\r\n    private readonly updateCheckerboard: () => void;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n            layers: IKlBasicLayer[]; // items can be changed after the fact - but not the object\r\n        }\r\n    ) {\r\n        this.layers = p.layers;\r\n\r\n        const scale = p.width / p.layers[0].image.width;\r\n        const width = scale > 1 ? p.layers[0].image.width : p.width;\r\n        const height = scale > 1 ? p.layers[0].image.height : p.height;\r\n\r\n        this.canvas = BB.canvas(width, height);\r\n        this.updateCheckerboard = () => {\r\n            this.canvas.style.backgroundImage = 'url(' + BB.createCheckerDataUrl(8, undefined, theme.isDark()) + ')';\r\n        };\r\n        this.updateCheckerboard();\r\n        this.ctx = BB.ctx(this.canvas);\r\n\r\n        BB.css(this.canvas, {\r\n            width: '100%',\r\n            height: '100%',\r\n            imageRendering: scale > 1 ? 'pixelated' : undefined,\r\n        });\r\n\r\n        setTimeout(() => this.render(), 0);\r\n        theme.addIsDarkListener(this.updateCheckerboard);\r\n    }\r\n\r\n    getElement (): HTMLCanvasElement {\r\n        return this.canvas;\r\n    }\r\n\r\n    render (): void {\r\n        if (!this.ctx) {\r\n            return;\r\n        }\r\n\r\n        this.ctx.save();\r\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        for (let i = 0; i < this.layers.length; i++) {\r\n            const layer = this.layers[i];\r\n            if (!layer.isVisible || layer.opacity === 0) {\r\n                continue;\r\n            }\r\n            this.ctx.globalAlpha = this.layers[i].opacity;\r\n            this.ctx.globalCompositeOperation = this.layers[i].mixModeStr as GlobalCompositeOperation;\r\n            if (this.canvas.width > this.layers[i].image.width) {\r\n                this.ctx.imageSmoothingEnabled = false;\r\n            }\r\n            this.ctx.drawImage(this.layers[i].image, 0, 0, this.canvas.width, this.canvas.height);\r\n        }\r\n        this.ctx.restore();\r\n    }\r\n\r\n    destroy (): void {\r\n        theme.removeIsDarkListener(this.updateCheckerboard);\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport rotateImg from '/src/app/img/ui/cursor-rotate.png';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {\r\n    copyTransform,\r\n    IFreeTransform,\r\n    snapToPixel,\r\n    TFreeTransformCorner,\r\n    TFreeTransformEdge,\r\n    toImageSpace,\r\n    toTransformSpace,\r\n} from './free-transform-utils';\r\n\r\n/**\r\n * Free Transform UI\r\n * rotate, scale, translate\r\n *\r\n * - if rotation is multiple of 90 it will snap to pixels, to be more useful for pixel art\r\n * - when rotation goes from non-multiple of 90 to a multiple, it will snap position and width height to pixels\r\n * - transform.x, transform.y can sit between pixels (by 0.5) if width or height is odd number.\r\n *      - this is what complicates things\r\n * - if transform region small, corner grips move out of the way\r\n *\r\n * iX iY, iP.x, iP.y - i indicates image space\r\n * tX tY, tP.x, tP.y - t indicates transform space\r\n *\r\n * Not sure if it can be used for navigable canvas. (especially if canvas rotates view)\r\n * Probably can't be extended for distort. Needs a different approach.\r\n *\r\n * --- DOM structure ---\r\n * rootEl {\r\n * \ttransEl [\r\n * \t\tboundsEl\r\n * \t\tedges[]\r\n * \t\tcorners[] - round grips in the corner of transform region\r\n * \t\tangleGrip\r\n * \t]\r\n * }\r\n *\r\n */\r\nexport class FreeTransform {\r\n\r\n    // --- private ---\r\n    private readonly transform: IFreeTransform; // coordinates and dimensions of transformation\r\n    private isConstrained: boolean;\r\n    private ratio: number; // aspect ratio of transform\r\n    private readonly scale: number;\r\n    private readonly scaled = { // scaled coordinates and dimensions for screen space\r\n        x: 0,\r\n        y: 0,\r\n        width: 0,\r\n        height: 0,\r\n        corners: [{x: 0, y: 0}], // in transform space\r\n    };\r\n    private readonly minSnapDist = 7; // minimal snapping distance in px screen space\r\n    private snappingEnabled: boolean;\r\n    private readonly snapX: number[];\r\n    private readonly snapY: number[];\r\n    private readonly callback: (transform: IFreeTransform) => void;\r\n\r\n\r\n    private readonly cornerCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n    private readonly gripSize = 14;\r\n    private readonly edgeSize = 10;\r\n\r\n    private readonly rootEl: HTMLElement; // sits at origin of image\r\n    private readonly transEl: HTMLElement; // at middle of transform. rotates\r\n    private readonly boundsEl: HTMLElement; // draggable bounds rectangle with outline\r\n    private readonly corners: TFreeTransformCorner[] = [];\r\n    private keyListener: KeyListener;\r\n    private boundsPointerListener: PointerListener; // BB.PointerListener\r\n    private anglePointerListener: PointerListener; // BB.PointerListener\r\n    private readonly edges: TFreeTransformEdge[] = [];\r\n    private readonly angleGrip: {\r\n        el: HTMLElement;\r\n        x: number; // transform space\r\n        y: number;\r\n        snap: boolean;\r\n        updateDOM: () => void;\r\n    };\r\n\r\n    private updateScaled (): void {\r\n        this.scaled.x = this.transform.x * this.scale;\r\n        this.scaled.y = this.transform.y * this.scale;\r\n        this.scaled.width = this.transform.width * this.scale;\r\n        this.scaled.height = this.transform.height * this.scale;\r\n        this.scaled.corners = this.corners.map((item) => {\r\n            return {x: item.x * this.scale, y: item.y * this.scale};\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\r\n     * both in image space\r\n     *\r\n     * @param iX - image space\r\n     * @param iY - image space\r\n     * @private\r\n     */\r\n    private snapCorner (iX: number, iY: number): IVector2D {\r\n        if (!this.snappingEnabled) {\r\n            return {x: iX, y: iY};\r\n        }\r\n        let dist: number;\r\n        const snap: {\r\n            x?: number;\r\n            y?: number;\r\n            dist: {\r\n                x?: number;\r\n                y?: number;\r\n            };\r\n        } = {\r\n            x: undefined,\r\n            y: undefined,\r\n            dist: {\r\n                x: undefined,\r\n                y: undefined,\r\n            },\r\n        };\r\n        for (let e = 0; e < this.snapX.length; e++) {\r\n            dist = Math.abs(iX - this.snapX[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.x === undefined || dist < snap.dist.x!) {\r\n                    snap.x = this.snapX[e];\r\n                    snap.dist.x = dist;\r\n                }\r\n            }\r\n        }\r\n        for (let e = 0; e < this.snapY.length; e++) {\r\n            dist = Math.abs(iY - this.snapY[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.y === undefined || dist < snap.dist.y!) {\r\n                    snap.y = this.snapY[e];\r\n                    snap.dist.y = dist;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (snap.x === undefined && snap.y === undefined) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        return {\r\n            x: snap.x ?? iX,\r\n            y: snap.y ?? iY,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * If constrained return nearest corner pos that fits aspect ratio\r\n     *\r\n     * @param cornerIndex\r\n     * @param iX\r\n     * @param iY\r\n     * @private\r\n     */\r\n    private constrainCorner (cornerIndex: number, iX: number, iY: number): IVector2D {\r\n        if (!this.isConstrained) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        const flip = this.transform.width * this.transform.height < 0 ? -1 : 1;\r\n        return BB.projectPointOnLine(\r\n            {x: this.transform.x, y: this.transform.y},\r\n            toImageSpace(this.ratio, flip * ([0, 2].includes(cornerIndex) ? 1 : -1), this.transform),\r\n            {x: iX, y: iY}\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Update corners according to width height.\r\n     * Not their DOM.\r\n     */\r\n    private updateCornerPositions (): void {\r\n        this.corners[0].x = (-this.transform.width / 2); // top left\r\n        this.corners[0].y = (-this.transform.height / 2);\r\n\r\n        this.corners[1].x = (this.transform.width / 2); // top right\r\n        this.corners[1].y = (-this.transform.height / 2);\r\n\r\n        this.corners[2].x = (this.transform.width / 2); // bottom right\r\n        this.corners[2].y = (this.transform.height / 2);\r\n\r\n        this.corners[3].x = (-this.transform.width / 2); // bottom left\r\n        this.corners[3].y = (this.transform.height / 2);\r\n    }\r\n\r\n    /**\r\n     * If constrained and dragging an edge, restore aspect ratio\r\n     * Updates corner positions.\r\n     *\r\n     * @param widthChanged\r\n     * @param heightChanged\r\n     * @private\r\n     */\r\n    private restoreRatio (widthChanged: boolean, heightChanged: boolean): void {\r\n        if (!this.isConstrained) {\r\n            return;\r\n        }\r\n        const angle90 = Math.abs(this.transform.angleDeg) % 90 === 0;\r\n        const whSwapped = Math.abs(this.transform.angleDeg - 90) % 180 === 0;\r\n        if (heightChanged && !widthChanged) {\r\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\r\n            let newWidth = this.ratio * newHeight;\r\n            if (angle90) {\r\n                newWidth = (whSwapped ? this.transform.y % 1 : this.transform.x % 1) === 0 ?\r\n                    BB.roundEven(newWidth) : BB.roundUneven(newWidth);\r\n            }\r\n            if (this.corners[1].x - this.corners[0].x < 0) {\r\n                newWidth *= -1;\r\n            }\r\n            this.corners[0].x = -newWidth / 2;\r\n            this.corners[3].x = -newWidth / 2;\r\n            this.corners[1].x = newWidth / 2;\r\n            this.corners[2].x = newWidth / 2;\r\n        }\r\n        if (!heightChanged && widthChanged) {\r\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\r\n            let newHeight = newWidth / this.ratio;\r\n            if (angle90) {\r\n                newHeight = (whSwapped ? this.transform.x % 1 : this.transform.y % 1) === 0  ?\r\n                    BB.roundEven(newHeight) : BB.roundUneven(newHeight);\r\n            }\r\n            if (this.corners[3].y - this.corners[0].y < 0) {\r\n                newHeight *= -1;\r\n            }\r\n            this.corners[0].y = -newHeight / 2;\r\n            this.corners[1].y = -newHeight / 2;\r\n            this.corners[2].y = newHeight / 2;\r\n            this.corners[3].y = newHeight / 2;\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * update transform based on corners\r\n     * @private\r\n     */\r\n    private updateTransformViaCorners (): void {\r\n\r\n        // calc transform center in image space\r\n        const rot = BB.rotateAround(\r\n            {x: 0, y: 0},\r\n            {\r\n                x: (this.corners[0].x + this.corners[1].x) / 2,\r\n                y: (this.corners[0].y + this.corners[3].y) / 2,\r\n            },\r\n            this.transform.angleDeg\r\n        );\r\n        this.transform.x = rot.x + this.transform.x;\r\n        this.transform.y = rot.y + this.transform.y;\r\n\r\n        // update size\r\n        this.transform.width = this.corners[1].x - this.corners[0].x;\r\n        this.transform.height = this.corners[3].y - this.corners[0].y;\r\n\r\n        // new center means corners changed their position\r\n        this.updateCornerPositions();\r\n\r\n        this.updateDOM();\r\n    }\r\n\r\n    /**\r\n     * updates DOM according to transform\r\n     * @param skipCallback\r\n     */\r\n    private updateDOM (skipCallback?: boolean): void {\r\n        this.updateScaled();\r\n\r\n        BB.css(this.transEl, {\r\n            left: this.scaled.x + 'px',\r\n            top: this.scaled.y + 'px',\r\n            transformOrigin: '0 0',\r\n            transform: 'rotate(' + this.transform.angleDeg + 'deg)',\r\n        });\r\n\r\n        BB.css(this.boundsEl, {\r\n            width: Math.abs(this.scaled.width) + 'px',\r\n            height: Math.abs(this.scaled.height) + 'px',\r\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\r\n        });\r\n\r\n        this.corners[0].updateDOM();\r\n        this.corners[1].updateDOM();\r\n        this.corners[2].updateDOM();\r\n        this.corners[3].updateDOM();\r\n\r\n        this.edges[0].updateDOM();\r\n        this.edges[1].updateDOM();\r\n        this.edges[2].updateDOM();\r\n        this.edges[3].updateDOM();\r\n\r\n\r\n        this.angleGrip.x = 0;\r\n        this.angleGrip.y = (-Math.abs(this.transform.height * this.scale) / 2) - 20;\r\n        this.angleGrip.updateDOM();\r\n        if (!skipCallback) {\r\n            if (this.callback) { // why should updateDOM trigger the callback?\r\n                this.callback(copyTransform(this.transform));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // --- public ---\r\n    constructor (\r\n        params: {\r\n            x: number; // center of transform region. image space\r\n            y: number;\r\n            width: number; // size of transform region. image space\r\n            height: number;\r\n            angleDeg: number; // angle of transform region. degrees\r\n\r\n            isConstrained: boolean; // proportions constrained\r\n            snapX: number[]; // where snapping along X axis. image space\r\n            snapY: number[]; // where snapping along X axis. image space\r\n            scale: number; // ratio of screen-space / image-space\r\n            callback: (transform: IFreeTransform) => void;\r\n        }\r\n    ) {\r\n        this.transform = { // coordinates and dimensions of transformation\r\n            x: params.x,\r\n            y: params.y,\r\n            width: params.width,\r\n            height: params.height,\r\n            angleDeg: params.angleDeg,\r\n        };\r\n\r\n        this.isConstrained = params.isConstrained;\r\n\r\n        this.snapX = params.snapX;\r\n        this.snapY = params.snapY;\r\n        this.callback = params.callback;\r\n        this.scale = params.scale;\r\n        this.snappingEnabled = true;\r\n        this.ratio = this.transform.width / this.transform.height;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-free-transform',\r\n            css: {\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.transEl = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                position: 'absolute',\r\n            },\r\n        });\r\n\r\n        this.boundsEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                cursor: 'move',\r\n                boxShadow: 'rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px',\r\n            },\r\n        });\r\n\r\n        const pointerRemainder = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        function resetRemainder (): void {\r\n            pointerRemainder.x = 0;\r\n            pointerRemainder.y = 0;\r\n        }\r\n        this.keyListener = new BB.KeyListener({});\r\n\r\n        let boundsStartP = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        this.boundsPointerListener = new BB.PointerListener({\r\n            target: this.boundsEl,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointerdown') {\r\n                    boundsStartP = {x: this.transform.x, y: this.transform.y};\r\n                }\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    this.transform.x = boundsStartP.x + (event.pageX - event.downPageX!) / this.scale;\r\n                    this.transform.y = boundsStartP.y + (event.pageY - event.downPageY!) / this.scale;\r\n\r\n\r\n                    let dist: number;\r\n                    let snap: {\r\n                        x?: number;\r\n                        y?: number;\r\n                        distX: number;\r\n                        distY: number;\r\n                    } = {\r\n                        distX: -1,\r\n                        distY: -1,\r\n                    };\r\n                    if (this.snappingEnabled) {\r\n                        let i;\r\n                        for (i = 0; i < this.snapX.length; i++) {\r\n                            dist = Math.abs(this.transform.x - this.snapX[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (snap.x === undefined || dist < snap.distX) {\r\n                                    snap.x = this.snapX[i];\r\n                                    snap.distX = dist;\r\n                                }\r\n                            }\r\n                        }\r\n                        for (i = 0; i < this.snapY.length; i++) {\r\n                            dist = Math.abs(this.transform.y - this.snapY[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (snap.y === undefined || dist < snap.distY) {\r\n                                    snap.y = this.snapY[i];\r\n                                    snap.distY = dist;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        let iP;\r\n                        for (i = 0; i < 4; i++) {\r\n                            iP = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n                            let j;\r\n                            for (j = 0; j < this.snapX.length; j++) {\r\n                                dist = Math.abs(iP.x - this.snapX[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (snap.x === undefined || dist < snap.distX) {\r\n                                        snap.x = this.snapX[j] - (iP.x - this.transform.x);\r\n                                        snap.distX = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                            for (j = 0; j < this.snapY.length; j++) {\r\n                                dist = Math.abs(iP.y - this.snapY[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (snap.y === undefined || dist < snap.distY) {\r\n                                        snap.y = this.snapY[j] - (iP.y - this.transform.y);\r\n                                        snap.distY = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        let projected = BB.projectPointOnLine(\r\n                            {x: 0, y: boundsStartP.y},\r\n                            {x: 10, y: boundsStartP.y},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        let dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        snap = {\r\n                            x: projected.x,\r\n                            y: projected.y,\r\n                            distX: dist,\r\n                            distY: dist,\r\n                        };\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: 0},\r\n                            {x: boundsStartP.x, y: 10},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap = {\r\n                                x: projected.x,\r\n                                y: projected.y,\r\n                                distX: dist,\r\n                                distY: dist,\r\n                            };\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y + 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap = {\r\n                                x: projected.x,\r\n                                y: projected.y,\r\n                                distX: dist,\r\n                                distY: dist,\r\n                            };\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y - 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap = {\r\n                                x: projected.x,\r\n                                y: projected.y,\r\n                                distX: dist,\r\n                                distY: dist,\r\n                            };\r\n                        }\r\n                    }\r\n                    if (snap.x != undefined) {\r\n                        this.transform.x = snap.x;\r\n                    }\r\n                    if (snap.y != undefined) {\r\n                        this.transform.y = snap.y;\r\n                    }\r\n\r\n                    // snap to pixels\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                    }\r\n\r\n                    this.updateDOM();\r\n                }\r\n            },\r\n        });\r\n\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                const g = this.corners[i] = {\r\n                    i: i,\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.gripSize + 'px',\r\n                            height: this.gripSize + 'px',\r\n                            background: '#fff',\r\n                            /*background: [\r\n                                '#ff0000',\r\n                                '#00ff00',\r\n                                '#0000ff',\r\n                                '#ff00ff',\r\n                            ][i],*/\r\n                            borderRadius: this.gripSize + 'px',\r\n                            position: 'absolute',\r\n                            boxShadow: 'inset 0 0 0 2px #000',\r\n                        },\r\n                    }) as HTMLElement,\r\n                    x: 0,\r\n                    y: 0,\r\n                    virtualPos: {\r\n                        x: 0,\r\n                        y: 0,\r\n                    },\r\n                } as TFreeTransformCorner;\r\n                g.updateDOM = (): void => {\r\n\r\n                    // grip position\r\n                    // if it gets small: slightly offset grips, so easier to handle\r\n                    const offsetArr = [[-1, -1], [1, -1], [1, 1], [-1, 1]].map(item => {\r\n                        item[0] *= this.transform.width > 0 ? 1 : -1;\r\n                        item[1] *= this.transform.height > 0 ? 1 : -1;\r\n                        return item;\r\n                    });\r\n                    const tinyOffset = Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20 ? 10 : 0;\r\n\r\n                    BB.css(g.el, {\r\n                        left: (this.scaled.corners[g.i].x - this.gripSize / 2 + offsetArr[i][0] * tinyOffset) + 'px',\r\n                        top: (this.scaled.corners[g.i].y - this.gripSize / 2 + offsetArr[i][1] * tinyOffset) + 'px',\r\n                    });\r\n\r\n\r\n                    // cursor\r\n                    let angle = BB.pointsToAngleDeg(\r\n                        {\r\n                            x: this.transform.x,\r\n                            y: this.transform.y,\r\n                        },\r\n                        toImageSpace(g.x, g.y, this.transform),\r\n                    ) + 135; // offset so nw is 0\r\n                    while (angle < 0) {\r\n                        angle += 360;\r\n                    }\r\n                    const index = Math.round(angle / 45) % this.cornerCursors.length;\r\n                    BB.css(g.el, {\r\n                        cursor: this.cornerCursors[index] + '-resize',\r\n                    });\r\n                };\r\n\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.corners[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            this.corners[i].virtualPos = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n\r\n                        } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                            this.corners[i].virtualPos.x += event.dX / this.scale;\r\n                            this.corners[i].virtualPos.y += event.dY / this.scale;\r\n\r\n                            let iP = {\r\n                                x: this.corners[i].virtualPos.x,\r\n                                y: this.corners[i].virtualPos.y,\r\n                            };\r\n                            iP = this.constrainCorner(i, iP.x, iP.y);\r\n                            if (!this.isConstrained) {\r\n                                iP = this.snapCorner(iP.x, iP.y);\r\n                            }\r\n\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                iP.x = Math.round(iP.x);\r\n                                iP.y = Math.round(iP.y);\r\n                            }\r\n\r\n                            const tP = toTransformSpace(iP.x, iP.y, this.transform);\r\n\r\n                            const dX = tP.x - this.corners[i].x;\r\n                            const dY = tP.y - this.corners[i].y;\r\n                            this.corners[i].x = tP.x;\r\n                            this.corners[i].y = tP.y;\r\n\r\n                            let indexes: number[] = [];\r\n                            if (i === 0) { // top left\r\n                                indexes = [3, 1, 2];\r\n                            } else if (i === 1) { // top right\r\n                                indexes = [2, 0, 3];\r\n                            } else if (i === 2) { // bottom right\r\n                                indexes = [1, 3, 0];\r\n                            } else if (i === 3) { // bottom left\r\n                                indexes = [0, 2, 1];\r\n                            }\r\n\r\n                            this.corners[indexes[0]].x = this.corners[i].x;\r\n                            this.corners[indexes[1]].y = this.corners[i].y;\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                this.corners[indexes[2]].x -= dX;\r\n                                this.corners[indexes[2]].y -= dY;\r\n                                this.corners[indexes[1]].x = this.corners[indexes[2]].x;\r\n                                this.corners[indexes[0]].y = this.corners[indexes[2]].y;\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    },\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.updateCornerPositions();\r\n        this.updateScaled();\r\n\r\n        let isInverted: boolean;\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i): void => {\r\n                this.edges[i] = {\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.edgeSize + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                            /*background: [\r\n                                '#ff000044',\r\n                                '#00ff0044',\r\n                                '#0000ff44',\r\n                                '#ff00ff44',\r\n                            ][i],*/\r\n                            position: 'absolute',\r\n                        },\r\n                    }) as HTMLElement,\r\n                } as TFreeTransformEdge;\r\n                const g = this.edges[i];\r\n                g.updateDOM = () => {\r\n                    if (i === 0) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: (Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) - this.edgeSize) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 1) {\r\n                        BB.css(g.el, {\r\n                            left: Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    } else if (i === 2) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + 'px',\r\n                            top: Math.max(this.scaled.corners[0].y,this.scaled.corners[3].y) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 3) {\r\n                        BB.css(g.el, {\r\n                            left: (Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) - this.edgeSize) + 'px',\r\n                            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    }\r\n                    let angleOffset = Math.round(this.transform.angleDeg / 45);\r\n                    while (angleOffset < 0) {\r\n                        angleOffset += 8;\r\n                    }\r\n                    angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\r\n                    g.el.style.cursor = this.cornerCursors[angleOffset] + '-resize';\r\n\r\n                };\r\n\r\n                const isVertical = [0, 2].includes(i);\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.edges[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            if (isVertical) { // top bottom\r\n                                isInverted = this.corners[0].y >= this.corners[3].y;\r\n                            } else { // left right\r\n                                isInverted = this.corners[0].x >= this.corners[1].x;\r\n                            }\r\n                            resetRemainder();\r\n                        }\r\n                        if (event.type === 'pointermove' && event.button === 'left') {\r\n                            const tfD = BB.rotateAround({x: 0, y: 0},\r\n                                {x: event.dX / this.scale, y: event.dY / this.scale},\r\n                                -this.transform.angleDeg);\r\n                            let ti = {\r\n                                dX: tfD.x,\r\n                                dY: tfD.y,\r\n                            };\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                ti = BB.intDxy(pointerRemainder, tfD.x, tfD.y);\r\n                            }\r\n\r\n                            let indexes: number[] = [];\r\n                            if (i === 0) { // top\r\n                                indexes = [2, 3, 0, 1];\r\n                            } else if (i === 1) { // right\r\n                                indexes = [0, 3, 1, 2];\r\n                            } else if (i === 2) { // bottom\r\n                                indexes = [0, 1, 2, 3];\r\n                            } else if (i === 3) { // left\r\n                                indexes = [1, 2, 0, 3];\r\n                            }\r\n\r\n                            const dimension = isVertical ? 'y' : 'x';\r\n                            const d = isVertical ? ti.dY : ti.dX;\r\n\r\n                            if (isInverted) {\r\n                                this.corners[indexes[0]][dimension] += d;\r\n                                this.corners[indexes[1]][dimension] += d;\r\n                            } else {\r\n                                this.corners[indexes[2]][dimension] += d;\r\n                                this.corners[indexes[3]][dimension] += d;\r\n                            }\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                if (isInverted) {\r\n                                    this.corners[indexes[2]][dimension] -= d;\r\n                                    this.corners[indexes[3]][dimension] -= d;\r\n                                } else {\r\n                                    this.corners[indexes[0]][dimension] -= d;\r\n                                    this.corners[indexes[1]][dimension] -= d;\r\n                                }\r\n                            }\r\n\r\n                            if (isVertical) { // top bottom\r\n                                this.restoreRatio(false, true);\r\n                            } else { // left right\r\n                                this.restoreRatio(true, false);\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    },\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.angleGrip = {\r\n            el: BB.el({\r\n                css: {\r\n                    cursor: 'url(' + rotateImg + ') 10 10, move',\r\n                    width: this.gripSize + 'px',\r\n                    height: this.gripSize + 'px',\r\n                    background: '#0ff',\r\n                    borderRadius: this.gripSize + 'px',\r\n                    position: 'absolute',\r\n                    boxShadow: 'inset 0 0 0 2px #000',\r\n                },\r\n            }),\r\n            x: 0,\r\n            y: 0,\r\n            snap: false,\r\n            updateDOM: () => {\r\n                BB.css(this.angleGrip.el, {\r\n                    left: (this.angleGrip.x - this.gripSize / 2) + 'px',\r\n                    top: (this.angleGrip.y - this.gripSize / 2) + 'px',\r\n                });\r\n            },\r\n        };\r\n        BB.el({\r\n            parent: this.angleGrip.el,\r\n            css: {\r\n                width: '2px',\r\n                height: '13px',\r\n                left: (this.gripSize / 2 - 1) + 'px',\r\n                top: this.gripSize + 'px',\r\n                background: '#0ff',\r\n                position: 'absolute',\r\n            },\r\n        });\r\n\r\n        this.anglePointerListener = new BB.PointerListener({\r\n            target: this.angleGrip.el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    const bounds = this.rootEl.getBoundingClientRect();\r\n                    const offset = {\r\n                        x: bounds.left - this.rootEl.scrollLeft,\r\n                        y: bounds.top - this.rootEl.scrollTop,\r\n                    };\r\n                    const iP = {x: (event.clientX - offset.x) / this.scale, y: (event.clientY - offset.y) / this.scale};\r\n\r\n                    const a = BB.pointsToAngleDeg({x: this.transform.x, y: this.transform.y}, iP) + 90;\r\n                    this.transform.angleDeg = a;\r\n                    const snapDeg = Math.round(a / 360 * 8) * 45;\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    } else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    }\r\n                    this.updateDOM();\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                        this.updateDOM();\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        snapToPixel(this.transform);\r\n        this.updateDOM(true);\r\n        BB.append(this.transEl, [\r\n            this.boundsEl,\r\n            this.edges[0].el,\r\n            this.edges[1].el,\r\n            this.edges[2].el,\r\n            this.edges[3].el,\r\n            this.corners[0].el,\r\n            this.corners[1].el,\r\n            this.corners[2].el,\r\n            this.corners[3].el,\r\n            this.angleGrip.el,\r\n        ]);\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    getTransform (): IFreeTransform {\r\n        return copyTransform(this.transform);\r\n    }\r\n\r\n    setConstrained (b: boolean): void {\r\n        this.isConstrained = b;\r\n        if (b && this.transform.width !== 0 && this.transform.height !== 0) {\r\n            this.ratio = Math.abs(this.transform.width / this.transform.height);\r\n        }\r\n    }\r\n\r\n    setSnapping (s: boolean): void {\r\n        this.snappingEnabled = s;\r\n    }\r\n\r\n    setPos (p: IVector2D): void {\r\n        this.transform.x = p.x;\r\n        this.transform.y = p.y;\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    move (dX: number, dY: number): void {\r\n        this.transform.x += dX;\r\n        this.transform.y += dY;\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setSize (w: number, h: number): void {\r\n        this.transform.width = w;\r\n        this.transform.height = h;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n        }\r\n        this.updateCornerPositions();\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setAngleDeg (a: number): void {\r\n        this.transform.angleDeg = a;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n            this.updateCornerPositions();\r\n        }\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getRatio (): number {\r\n        return this.ratio;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.keyListener.destroy();\r\n        this.boundsPointerListener.destroy();\r\n        this.corners[0].pointerListener.destroy();\r\n        this.corners[1].pointerListener.destroy();\r\n        this.corners[2].pointerListener.destroy();\r\n        this.corners[3].pointerListener.destroy();\r\n        this.edges[0].pointerListener.destroy();\r\n        this.edges[1].pointerListener.destroy();\r\n        this.edges[2].pointerListener.destroy();\r\n        this.edges[3].pointerListener.destroy();\r\n        this.anglePointerListener.destroy();\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fcdZI\");","import {IVector2D} from '../../../bb/bb-types';\r\nimport {BB} from '../../../bb/bb';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\nexport interface IFreeTransform {\r\n    x: number; // center of transform region. image space\r\n    y: number;\r\n    width: number; // size of transform region. image space\r\n    height: number;\r\n    angleDeg: number; // angle of transform region. degrees\r\n}\r\n\r\n\r\nexport type TFreeTransformCorner = {\r\n    i: number; // index in corners array\r\n    el: HTMLElement; // draggable corner circle in DOM\r\n    x: number; // unscaled position (transform space)\r\n    y: number;\r\n    virtualPos: IVector2D; // unscaled temporary position (image space)\r\n    updateDOM: () => void; // update styling in DOM\r\n    pointerListener: PointerListener;\r\n};\r\n\r\nexport type TFreeTransformEdge = { // derive position from corners\r\n    el: HTMLElement;\r\n    updateDOM: () => void;\r\n    pointerListener: PointerListener;\r\n};\r\n\r\n/**\r\n * snap entire transform to pixel grid. changes transform\r\n *\r\n * for x y:\r\n * If a dimension has an even size, it be an integer.\r\n * If it's uneven, it's sits exactly half way between two pixels.\r\n *\r\n * @param transform\r\n */\r\nexport function snapToPixel (transform: IFreeTransform): void {\r\n    if (Math.abs(transform.angleDeg) % 90 !== 0) {\r\n        return;\r\n    }\r\n\r\n    transform.width = Math.round(transform.width);\r\n    transform.height = Math.round(transform.height);\r\n    // 0 is original orientation.\r\n    // At 90 and 270 width and height become swapped due to different orientation.\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    transform.x = ((whSwapped ? transform.height : transform.width) % 2 === 0) ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\r\n    transform.y = ((whSwapped ? transform.width : transform.height) % 2 === 0)  ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\r\n}\r\n\r\nexport function copyTransform (transform: IFreeTransform): IFreeTransform {\r\n    return {\r\n        x: transform.x,\r\n        y: transform.y,\r\n        width: transform.width,\r\n        height: transform.height,\r\n        angleDeg: transform.angleDeg,\r\n    };\r\n}\r\n\r\n/**\r\n * image space to transform space\r\n * - origin of transform space is at center of transform bounds.\r\n * - same scale as image space. -> one unit is x: 1/width, y: 1/height\r\n * - up is where transform points up\r\n * - x goes right\r\n * - y goes down\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nexport function toTransformSpace (x: number, y: number, transform: IFreeTransform): IVector2D {\r\n    let px, py;\r\n    px = x - transform.x;\r\n    py = y - transform.y;\r\n\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: px, y: py},\r\n        -transform.angleDeg);\r\n    px = rot.x;\r\n    py = rot.y;\r\n\r\n    return {\r\n        x: px,\r\n        y: py,\r\n    };\r\n}\r\n\r\n/**\r\n * transform space to image space\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nexport function toImageSpace (x: number, y: number, transform: IFreeTransform): IVector2D {\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: x, y: y},\r\n        transform.angleDeg);\r\n    return {\r\n        x: rot.x + transform.x,\r\n        y: rot.y + transform.y,\r\n    };\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {KlCanvasPreview} from '../../canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './free-transform';\r\nimport {IKlBasicLayer} from '../../kl-types';\r\nimport {IRect} from '../../../bb/bb-types';\r\n\r\n/**\r\n * a basic canvas where you can transform one layer(move around, rotate, scale)\r\n *\r\n * DOM Structure:\r\n * div\r\n *      innerWrapper\r\n *          klCanvasPreview\r\n *          transform.div\r\n *\r\n */\r\nexport class FreeTransformCanvas {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly freeTransform: FreeTransform;\r\n    private readonly layers: IKlBasicLayer[];\r\n    private readonly transformIndex: number;\r\n    private readonly imageWidth: number;\r\n    private readonly imageHeight: number;\r\n    private readonly initTransform: IRect;\r\n    private readonly scale: number;\r\n    private readonly previewLayerArr: IKlBasicLayer[];\r\n    private readonly klCanvasPreview: KlCanvasPreview;\r\n\r\n    private updatePreview (): void {\r\n        if (!this.freeTransform) {\r\n            return;\r\n        }\r\n\r\n        const transform = this.freeTransform.getTransform();\r\n        if (this.scale < 1) {\r\n            transform.x *= this.scale;\r\n            transform.y *= this.scale;\r\n            transform.width *= this.scale;\r\n            transform.height *= this.scale;\r\n        }\r\n\r\n        const destCanvas = this.previewLayerArr[this.transformIndex].image;\r\n        const ctx = BB.ctx((destCanvas as HTMLCanvasElement));\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, destCanvas.width, destCanvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            ctx,\r\n            this.layers[this.transformIndex].image,\r\n            transform,\r\n            undefined,\r\n            BB.testShouldPixelate(\r\n                transform,\r\n                transform.width / this.initTransform.width,\r\n                transform.height / this.initTransform.height\r\n            ),\r\n        );\r\n        ctx.restore();\r\n        this.klCanvasPreview.render();\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            elementWidth: number;\r\n            elementHeight: number;\r\n            imageWidth: number;\r\n            imageHeight: number;\r\n            layers: IKlBasicLayer[];\r\n            transformIndex: number;\r\n        }\r\n    ) {\r\n        this.imageWidth = p.imageWidth;\r\n        this.imageHeight = p.imageHeight;\r\n        const previewFit = BB.fitInto(\r\n            p.imageWidth,\r\n            this.imageHeight,\r\n            p.elementWidth - 20,\r\n            p.elementHeight - 60,\r\n            1\r\n        );\r\n        this.scale = previewFit.width / p.imageWidth;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: p.elementWidth + 'px',\r\n                height: p.elementHeight + 'px',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n        this.layers = p.layers;\r\n        this.transformIndex = p.transformIndex;\r\n\r\n\r\n        const innerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: previewFit.width + 'px',\r\n                height: previewFit.height + 'px',\r\n            },\r\n        });\r\n        this.rootEl.append(innerWrapper);\r\n\r\n        this.previewLayerArr = this.layers.map(item => {\r\n            return {\r\n                image: item.image,\r\n                isVisible: item.isVisible,\r\n                mixModeStr: item.mixModeStr,\r\n                opacity: item.opacity,\r\n            };\r\n        });\r\n        this.previewLayerArr[this.previewLayerArr.length - 1].image = BB.canvas(\r\n            this.scale > 1 ? this.imageWidth : previewFit.width,\r\n            this.scale > 1 ? this.imageHeight : previewFit.height,\r\n        );\r\n        this.klCanvasPreview = new KlCanvasPreview({\r\n            width: previewFit.width,\r\n            height: previewFit.height,\r\n            layers: this.previewLayerArr,\r\n        });\r\n        innerWrapper.append(this.klCanvasPreview.getElement());\r\n\r\n        {\r\n            let transformSize = {\r\n                width: this.layers[this.transformIndex].image.width * this.scale,\r\n                height: this.layers[this.transformIndex].image.height * this.scale,\r\n            };\r\n            if (transformSize.width > previewFit.width || transformSize.height > previewFit.height) {\r\n                transformSize = BB.fitInto(\r\n                    this.layers[this.transformIndex].image.width,\r\n                    this.layers[this.transformIndex].image.height,\r\n                    previewFit.width,\r\n                    previewFit.height,\r\n                    1\r\n                );\r\n            }\r\n            this.initTransform = {\r\n                x: this.imageWidth / 2,\r\n                y: this.imageHeight / 2,\r\n                width: this.layers[this.transformIndex].image.width,\r\n                height: this.layers[this.transformIndex].image.height,\r\n            };\r\n            this.freeTransform = new FreeTransform({\r\n                x: this.initTransform.x,\r\n                y: this.initTransform.y,\r\n                width: this.initTransform.width,\r\n                height: this.initTransform.height,\r\n                angleDeg: 0,\r\n                isConstrained: true,\r\n                snapX: [0, this.imageWidth],\r\n                snapY: [0, this.imageHeight],\r\n                scale: this.scale,\r\n                callback: () => {\r\n                    this.updatePreview();\r\n                },\r\n            });\r\n        }\r\n        BB.css(this.freeTransform.getElement(), {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n        });\r\n        innerWrapper.append(this.freeTransform.getElement());\r\n        setTimeout(() => this.updatePreview(), 0);\r\n    }\r\n\r\n\r\n    // ---- interface ----\r\n    move (dX: number, dY: number): void {\r\n        this.freeTransform.move(dX, dY);\r\n    }\r\n\r\n    reset (): void {\r\n        const w = this.layers[this.transformIndex].image.width;\r\n        const h = this.layers[this.transformIndex].image.height;\r\n\r\n        this.freeTransform.setSize(w, h);\r\n        this.freeTransform.setPos({x: w / 2, y: h / 2});\r\n        this.freeTransform.setAngleDeg(0);\r\n        this.updatePreview();\r\n    }\r\n\r\n    setTransformFit (): void {\r\n\r\n        const fit = BB.fitInto(\r\n            this.layers[this.transformIndex].image.width,\r\n            this.layers[this.transformIndex].image.height,\r\n            this.imageWidth,\r\n            this.imageHeight,\r\n            1\r\n        );\r\n\r\n        this.freeTransform.setSize(fit.width, fit.height);\r\n        this.freeTransform.setPos({x: fit.width / 2, y: fit.height / 2});\r\n        this.freeTransform.setAngleDeg(0);\r\n        this.updatePreview();\r\n    }\r\n\r\n    setTransformCenter (): void {\r\n        this.freeTransform.setPos({x: this.imageWidth / 2, y: this.imageHeight / 2});\r\n        this.freeTransform.setAngleDeg(0);\r\n        this.updatePreview();\r\n    }\r\n\r\n    /**\r\n     * gives you the transformation in the original scale\r\n     */\r\n    getTransformation (): any { // todo\r\n        if (!this.freeTransform) {\r\n            return false;\r\n        }\r\n        return this.freeTransform.getTransform();\r\n    }\r\n\r\n    getIsPixelated (): boolean {\r\n        const transform = this.freeTransform.getTransform();\r\n        return BB.testShouldPixelate(\r\n            transform,\r\n            transform.width / this.initTransform.width,\r\n            transform.height / this.initTransform.height\r\n        );\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.freeTransform.destroy();\r\n        this.klCanvasPreview.destroy();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IRect, IVector2D} from '../../../bb/bb-types';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n\r\ntype TUpdateElement = {\r\n    el: HTMLElement;\r\n    update: () => void;\r\n};\r\n\r\n/**\r\n * Interactive preview for crop filter. Corners and edges can be dragged.\r\n * the div that you append this to must be relative\r\n */\r\nexport class Cropper {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private x: number;\r\n    private y: number;\r\n    private width: number;\r\n    private height: number;\r\n    private scale: number;\r\n    private readonly grips: IVector2D[]; // aka corner coordinates\r\n    private readonly edges: TUpdateElement[];\r\n    private readonly cornerElArr: TUpdateElement[];\r\n    private readonly darken: TUpdateElement[];\r\n    private readonly outline: TUpdateElement;\r\n    private readonly thirdsHorizontal: TUpdateElement;\r\n    private readonly thirdsVertical: TUpdateElement;\r\n    private readonly keyListener: KeyListener;\r\n    private readonly pointerRemainder: IVector2D;\r\n\r\n    private readonly outlinePointerListener: PointerListener;\r\n\r\n    private readonly corner0PointerListener: PointerListener;\r\n    private readonly corner1PointerListener: PointerListener;\r\n    private readonly corner2PointerListener: PointerListener;\r\n    private readonly corner3PointerListener: PointerListener;\r\n\r\n    private readonly edge0PointerListener: PointerListener;\r\n    private readonly edge1PointerListener: PointerListener;\r\n    private readonly edge2PointerListener: PointerListener;\r\n    private readonly edge3PointerListener: PointerListener;\r\n\r\n    private readonly callback: (val: IRect) => void;\r\n\r\n    private update (): void {\r\n        this.edges[0].update();\r\n        this.edges[1].update();\r\n        this.edges[2].update();\r\n        this.edges[3].update();\r\n        this.cornerElArr[0].update();\r\n        this.cornerElArr[1].update();\r\n        this.cornerElArr[2].update();\r\n        this.cornerElArr[3].update();\r\n        this.darken[0].update();\r\n        this.darken[1].update();\r\n        this.darken[2].update();\r\n        this.darken[3].update();\r\n        this.outline.update();\r\n        this.thirdsHorizontal.update();\r\n        this.thirdsVertical.update();\r\n    }\r\n\r\n    private commit (): void {\r\n        this.pointerRemainder.x = 0;\r\n        this.pointerRemainder.y = 0;\r\n        this.callback(this.getTransform());\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        params: {\r\n            x: number; // int, pos in relation to image\r\n            y: number; // int\r\n            width: number; // int\r\n            height: number; // int\r\n            maxW: number;\r\n            maxH: number;\r\n            scale: number; // float, zoom\r\n            callback: (val: IRect) => void;\r\n        }\r\n    ) {\r\n\r\n        this.x = params.x;\r\n        this.y = params.y;\r\n        this.width = params.width;\r\n        this.height = params.height;\r\n        this.scale = params.scale;\r\n        this.callback = params.callback;\r\n\r\n        const maxW = params.maxW;\r\n        const maxH = params.maxW;\r\n        this.rootEl = BB.el();\r\n        const gripCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n\r\n        this.keyListener = new BB.KeyListener({});\r\n\r\n        BB.css(this.rootEl, {\r\n            position: 'absolute',\r\n            left: (this.x * this.scale) + 'px',\r\n            top: (this.y * this.scale) + 'px',\r\n        });\r\n\r\n        this.outline = {\r\n            el: BB.el({\r\n                css: {\r\n                    position: 'absolute',\r\n                    border: '1px dashed #fff',\r\n                    cursor: 'move',\r\n                },\r\n            }),\r\n            update: () => {\r\n                BB.css(this.outline.el, {\r\n                    left: (this.grips[0].x * this.scale - 1) + 'px',\r\n                    top: (this.grips[0].y * this.scale - 1) + 'px',\r\n                    width: ((this.grips[2].x - this.grips[0].x) * this.scale) + 'px',\r\n                    height: ((this.grips[2].y - this.grips[0].y) * this.scale) + 'px',\r\n                });\r\n            },\r\n        };\r\n\r\n        this.pointerRemainder = { // needs to be reset after dragging complete\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        this.outlinePointerListener = new BB.PointerListener({\r\n            target: this.outline.el,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n\r\n                    this.grips[0].x += dX;\r\n                    this.grips[0].y += dY;\r\n                    this.grips[1].x += dX;\r\n                    this.grips[1].y += dY;\r\n                    this.grips[2].x += dX;\r\n                    this.grips[2].y += dY;\r\n                    this.grips[3].x += dX;\r\n                    this.grips[3].y += dY;\r\n\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n\r\n        this.thirdsHorizontal = {\r\n            el: BB.el({\r\n                css: {\r\n                    position: 'absolute',\r\n                    borderTop: '1px solid #0ff',\r\n                    borderBottom: '1px solid #0ff',\r\n                },\r\n            }),\r\n            update: () => {\r\n                BB.css(this.thirdsHorizontal.el, {\r\n                    left: (this.grips[0].x * this.scale) + 'px',\r\n                    top: ((this.grips[0].y + (this.grips[2].y - this.grips[0].y) / 3) * this.scale) + 'px',\r\n                    width: ((this.grips[2].x - this.grips[0].x) * this.scale) + 'px',\r\n                    height: ((this.grips[2].y - this.grips[0].y) / 3 * this.scale) + 'px',\r\n                });\r\n            },\r\n        };\r\n\r\n        this.thirdsVertical = {\r\n            el: BB.el({\r\n                css: {\r\n                    position: 'absolute',\r\n                    borderLeft: '1px solid #0ff',\r\n                    borderRight: '1px solid #0ff',\r\n                },\r\n            }),\r\n            update: () => {\r\n                BB.css(this.thirdsVertical.el, {\r\n                    left: ((this.grips[0].x + (this.grips[2].x - this.grips[0].x) / 3) * this.scale) + 'px',\r\n                    top: (this.grips[0].y * this.scale) + 'px',\r\n                    width: ((this.grips[2].x - this.grips[0].x) / 3 * this.scale) + 'px',\r\n                    height: ((this.grips[2].y - this.grips[0].y) * this.scale) + 'px',\r\n                });\r\n            },\r\n        };\r\n\r\n        const gripSize = 40;\r\n        const gripOverlay = 10;\r\n\r\n        this.grips = [\r\n            {x: 0, y: 0}, // top left\r\n            {x: this.width, y: 0}, // top right\r\n            {x: this.width, y: this.height}, // bottom right\r\n            {x: 0, y: this.height}, //bottom left\r\n        ];\r\n\r\n        const transformTop = (dY: number) => {\r\n            this.grips[0].y += dY;\r\n            this.grips[0].y = BB.clamp(this.grips[0].y, this.grips[3].y - maxH, this.grips[3].y - 1);\r\n            this.grips[1].y = this.grips[0].y;\r\n        };\r\n        const transformRight = (dX: number) => {\r\n            this.grips[1].x += dX;\r\n            this.grips[1].x = BB.clamp(this.grips[1].x, this.grips[0].x + 1, this.grips[0].x + maxW);\r\n            this.grips[2].x = this.grips[1].x;\r\n        };\r\n        const transformBottom = (dY: number) => {\r\n            this.grips[2].y += dY;\r\n            this.grips[2].y = BB.clamp(this.grips[2].y, this.grips[1].y + 1, this.grips[1].y + maxH);\r\n            this.grips[3].y = this.grips[2].y;\r\n        };\r\n        const transformLeft = (dX: number) => {\r\n            this.grips[0].x += dX;\r\n            this.grips[0].x = BB.clamp(this.grips[0].x, this.grips[1].x - maxW, this.grips[1].x - 1);\r\n            this.grips[3].x = this.grips[0].x;\r\n        };\r\n\r\n\r\n\r\n\r\n        this.edges = [];\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n\r\n                const el = BB.el({\r\n                    css: {\r\n                        width: gripSize + 'px',\r\n                        height: gripSize + 'px',\r\n                        //background: '#0f0',\r\n                        position: 'absolute',\r\n                    },\r\n                });\r\n\r\n                const update = () => {\r\n                    if (i === 0) { //top\r\n                        BB.css(el, {\r\n                            left: (this.grips[0].x * this.scale + gripOverlay) + 'px',\r\n                            top: (this.grips[0].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            width: ((this.grips[1].x - this.grips[0].x) * this.scale - gripOverlay * 2) + 'px',\r\n                            height: (gripSize * 2) + 'px',\r\n                        });\r\n                    } else if (i === 1) { //right\r\n                        BB.css(el, {\r\n                            left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\r\n                            top: (this.grips[1].y * this.scale + gripOverlay) + 'px',\r\n                            width: (gripSize * 2) + 'px',\r\n                            height: ((this.grips[2].y - this.grips[1].y) * this.scale - gripOverlay * 2) + 'px',\r\n                        });\r\n                    } else if (i === 2) { //bottom\r\n                        BB.css(el, {\r\n                            left: (this.grips[3].x * this.scale + gripOverlay) + 'px',\r\n                            top: (this.grips[3].y * this.scale - gripOverlay) + 'px',\r\n                            width: ((this.grips[2].x - this.grips[3].x) * this.scale - gripOverlay * 2) + 'px',\r\n                            height: (gripSize * 2) + 'px',\r\n                        });\r\n                    } else if (i === 3) { //left\r\n                        BB.css(el, {\r\n                            left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            top: (this.grips[0].y * this.scale + gripOverlay) + 'px',\r\n                            width: (gripSize * 2) + 'px',\r\n                            height: ((this.grips[3].y - this.grips[0].y) * this.scale - gripOverlay * 2) + 'px',\r\n                        });\r\n                    }\r\n                    const angleOffset = i * 2 + 1;\r\n                    el.style.cursor = gripCursors[angleOffset] + '-resize';\r\n\r\n                };\r\n\r\n                this.edges[i] = {\r\n                    el,\r\n                    update,\r\n                };\r\n            })(i);\r\n        }\r\n\r\n        this.darken = [];\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                const g = BB.el({\r\n                    css: {\r\n                        position: 'absolute',\r\n                        background: '#000',\r\n                        opacity: '0.5',\r\n                    },\r\n                });\r\n                const update = () => {\r\n                    if (i === 0) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[0].x * this.scale) + 'px',\r\n                            top: (this.grips[0].y * this.scale - 8000) + 'px',\r\n                            width: ((this.grips[1].x - this.grips[0].x) * this.scale) + 'px',\r\n                            height: '8000px',\r\n                        });\r\n                    } else if (i === 1) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[1].x * this.scale) + 'px',\r\n                            top: (this.grips[1].y * this.scale - 8000) + 'px',\r\n                            width: '8000px',\r\n                            height: 16000 + 'px',\r\n                        });\r\n                    } else if (i === 2) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[3].x * this.scale) + 'px',\r\n                            top: (this.grips[3].y * this.scale) + 'px',\r\n                            width: ((this.grips[2].x - this.grips[3].x) * this.scale) + 'px',\r\n                            height: '8000px',\r\n                        });\r\n                    } else if (i === 3) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[0].x * this.scale - 8000) + 'px',\r\n                            top: (this.grips[0].y * this.scale - 8000) + 'px',\r\n                            width: '8000px',\r\n                            height: 16000 + 'px',\r\n                        });\r\n                    }\r\n\r\n                };\r\n\r\n                this.darken[i] = {\r\n                    el: g,\r\n                    update,\r\n                };\r\n            })(i);\r\n        }\r\n\r\n        this.edge0PointerListener = new BB.PointerListener({\r\n            target: this.edges[0].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformTop(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformBottom(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        this.edge1PointerListener = new BB.PointerListener({\r\n            target: this.edges[1].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformRight(dX);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformLeft(-dX);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        this.edge2PointerListener = new BB.PointerListener({\r\n            target: this.edges[2].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformBottom(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformTop(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        this.edge3PointerListener = new BB.PointerListener({\r\n            target: this.edges[3].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformLeft(dX);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformRight(-dX);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n        this.cornerElArr = [];\r\n        (() => {\r\n            for (let i = 0; i < 4; i++) {\r\n                ((i) => {\r\n                    const g = BB.el({\r\n                        css: {\r\n                            //background: '#f00',\r\n                            width: (gripSize * 2) + 'px',\r\n                            height: (gripSize * 2) + 'px',\r\n                            position: 'absolute',\r\n                            cursor: ['nwse-resize', 'nesw-resize'][i % 2],\r\n                        },\r\n                    });\r\n\r\n                    const update = () => {\r\n                        if (i === 0) { //top left\r\n                            BB.css(g, {\r\n                                left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                                top: (this.grips[0].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            });\r\n                        } else if (i === 1) { //top right\r\n                            BB.css(g, {\r\n                                left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\r\n                                top: (this.grips[1].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            });\r\n                        } else if (i === 2) { //bottom right\r\n                            BB.css(g, {\r\n                                left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\r\n                                top: (this.grips[2].y * this.scale - gripOverlay) + 'px',\r\n                            });\r\n                        } else if (i === 3) { //bottom left\r\n                            BB.css(g, {\r\n                                left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                                top: (this.grips[2].y * this.scale - gripOverlay) + 'px',\r\n                            });\r\n                        }\r\n                    };\r\n\r\n                    this.cornerElArr[i] = {\r\n                        el: g,\r\n                        update,\r\n                    };\r\n                })(i);\r\n            }\r\n        })();\r\n        //top left\r\n        this.corner0PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[0].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformLeft(dX);\r\n                    transformTop(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformRight(-dX);\r\n                        transformBottom(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        //top right\r\n        this.corner1PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[1].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformRight(dX);\r\n                    transformTop(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformLeft(-dX);\r\n                        transformBottom(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        //bottom right\r\n        this.corner2PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[2].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformRight(dX);\r\n                    transformBottom(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformLeft(-dX);\r\n                        transformTop(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        //bottom left\r\n        this.corner3PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[3].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformLeft(dX);\r\n                    transformBottom(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformRight(-dX);\r\n                        transformTop(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n        this.rootEl.append(\r\n            this.darken[1].el,\r\n            this.darken[0].el,\r\n            this.darken[2].el,\r\n            this.darken[3].el,\r\n            this.thirdsHorizontal.el,\r\n            this.thirdsVertical.el,\r\n            this.outline.el,\r\n\r\n            this.edges[1].el,\r\n            this.edges[0].el,\r\n            this.edges[2].el,\r\n            this.edges[3].el,\r\n\r\n            this.cornerElArr[0].el,\r\n            this.cornerElArr[1].el,\r\n            this.cornerElArr[2].el,\r\n            this.cornerElArr[3].el,\r\n        );\r\n\r\n        this.update();\r\n\r\n    }\r\n\r\n    // ---- interface ----\r\n    getTransform (): IRect {\r\n        this.grips[1].x -= this.grips[0].x;\r\n        this.grips[1].y -= this.grips[0].y;\r\n        this.grips[2].x -= this.grips[0].x;\r\n        this.grips[2].y -= this.grips[0].y;\r\n        this.grips[3].x -= this.grips[0].x;\r\n        this.grips[3].y -= this.grips[0].y;\r\n        this.x += this.grips[0].x;\r\n        this.y += this.grips[0].y;\r\n        this.grips[0].x = 0;\r\n        this.grips[0].y = 0;\r\n        return {\r\n            x: this.x,\r\n            y: this.y,\r\n            width: this.grips[1].x,\r\n            height: this.grips[2].y,\r\n        };\r\n    }\r\n\r\n    setTransform (p: IRect): void {\r\n        this.x = p.x;\r\n        this.y = p.y;\r\n        this.width = p.width;\r\n        this.height = p.height;\r\n\r\n        BB.css(this.rootEl, {\r\n            left: (this.x * this.scale) + 'px',\r\n            top: (this.y * this.scale) + 'px',\r\n        });\r\n\r\n        this.grips[0].x = 0;\r\n        this.grips[0].y = 0;\r\n        this.grips[1].x = this.width;\r\n        this.grips[1].y = 0;\r\n        this.grips[2].x = this.width;\r\n        this.grips[2].y = this.height;\r\n        this.grips[3].x = 0;\r\n        this.grips[3].y = this.height;\r\n\r\n        this.update();\r\n        this.commit();\r\n    }\r\n\r\n    setScale (s: number): void {\r\n        this.scale = s;\r\n        BB.css(this.rootEl, {\r\n            left: (this.x * this.scale) + 'px',\r\n            top: (this.y * this.scale) + 'px',\r\n        });\r\n        this.update();\r\n    }\r\n\r\n    showThirds (b: boolean): void {\r\n\r\n        this.thirdsHorizontal.el.style.display = b ? 'block' : 'none';\r\n        this.thirdsVertical.el.style.display = b ? 'block' : 'none';\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.keyListener.destroy();\r\n        this.outlinePointerListener.destroy();\r\n        this.corner0PointerListener.destroy();\r\n        this.corner1PointerListener.destroy();\r\n        this.corner2PointerListener.destroy();\r\n        this.corner3PointerListener.destroy();\r\n        this.edge0PointerListener.destroy();\r\n        this.edge1PointerListener.destroy();\r\n        this.edge2PointerListener.destroy();\r\n        this.edge3PointerListener.destroy();\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\nimport {TKlCanvasLayer, TUiLayout} from '../../kl-types';\r\nimport {ISize2D} from '../../../bb/bb-types';\r\nimport {theme} from '../../../theme/theme';\r\nimport {KlCanvasLayer} from '../../canvas/kl-canvas';\r\nimport {throwIfNull} from '../../../bb/base/base';\r\n\r\n\r\n/**\r\n * Previews currently active layer\r\n * thumbnail (hover shows bigger preview), layername, opacity\r\n *\r\n * internally listens to kl history. updates when there's a change.\r\n * but you need to update it when the active layer changed. (different canvas object)\r\n *\r\n * update visibility for performance\r\n */\r\nexport class LayerPreview {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly contentWrapperEl: HTMLElement;\r\n    private readonly height: number;\r\n    private layerObj: TKlCanvasLayer | undefined;\r\n    private isVisible: boolean;\r\n    private uiState: TUiLayout;\r\n\r\n    private readonly checkEl: HTMLInputElement;\r\n\r\n    private readonly nameLabelEl: HTMLElement;\r\n    private readonly opacityEl: HTMLElement;\r\n    private lastDrawnSize: ISize2D;\r\n    private lastDrawnState: number; // from KlHistory\r\n\r\n    private readonly canvasSize: number;\r\n    private readonly canvas: HTMLCanvasElement;\r\n    private readonly canvasCtx: CanvasRenderingContext2D;\r\n\r\n    private animationCount: number; // >0 means it's animating\r\n    private readonly animationLength: number;\r\n\r\n    private readonly animationCanvas: HTMLCanvasElement;\r\n    private readonly animationCanvasCtx: CanvasRenderingContext2D;\r\n    private animationCanvasCheckerPattern: CanvasPattern = {} as CanvasPattern;\r\n\r\n    private largeCanvasIsVisible: boolean;\r\n    private readonly largeCanvasWrapper: HTMLElement;\r\n    private readonly largeCanvasSize: number;\r\n    private readonly largeCanvas: HTMLCanvasElement;\r\n    private readonly largeCanvasCtx: CanvasRenderingContext2D;\r\n    private largeCanvasCheckerPattern: CanvasPattern = {} as CanvasPattern;\r\n\r\n\r\n    private updateCheckerPatterns (): void {\r\n        const checker = BB.createCheckerCanvas(4, theme.isDark());\r\n        this.animationCanvasCheckerPattern = throwIfNull(this.animationCanvasCtx.createPattern(checker, 'repeat'));\r\n        this.largeCanvasCheckerPattern = throwIfNull(this.canvasCtx.createPattern(checker, 'repeat'));\r\n    }\r\n    \r\n    private animate (): void {\r\n        if (this.animationCount === 0) {\r\n            return;\r\n        }\r\n\r\n        this.animationCount--;\r\n\r\n        this.canvasCtx.save();\r\n        this.canvasCtx.globalAlpha = Math.pow((this.animationLength - this.animationCount) / this.animationLength, 2);\r\n        this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\r\n        this.canvasCtx.restore();\r\n\r\n        if (this.animationCount > 0) {\r\n            requestAnimationFrame(() => this.animate());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * is always instant\r\n     */\r\n    private drawLargeCanvas (): void {\r\n\r\n        if (!this.largeCanvasIsVisible || !this.layerObj) {\r\n            return;\r\n        }\r\n\r\n        const layerCanvas = this.layerObj.context.canvas;\r\n\r\n        const canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, this.largeCanvasSize, this.largeCanvasSize, 1);\r\n        this.largeCanvas.width = Math.round(canvasDimensions.width);\r\n        this.largeCanvas.height = Math.round(canvasDimensions.height);\r\n        this.largeCanvasCtx.save();\r\n        if (this.largeCanvas.width > layerCanvas.width) {\r\n            this.largeCanvasCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            this.largeCanvasCtx.imageSmoothingEnabled = true;\r\n            this.largeCanvasCtx.imageSmoothingQuality = 'high';\r\n        }\r\n        this.largeCanvasCtx.fillStyle = this.largeCanvasCheckerPattern;\r\n        this.largeCanvasCtx.fillRect(0, 0, this.largeCanvas.width, this.largeCanvas.height);\r\n        this.largeCanvasCtx.drawImage(layerCanvas, 0, 0, this.largeCanvas.width, this.largeCanvas.height);\r\n        this.largeCanvasCtx.restore();\r\n\r\n        const bounds = this.rootEl.getBoundingClientRect();\r\n        BB.css(this.largeCanvasWrapper, {\r\n            top: Math.max(10, (bounds.top + this.height / 2 - this.largeCanvas.height / 2)) + 'px',\r\n        });\r\n\r\n    }\r\n\r\n    private draw (isInstant: boolean): void {\r\n        if (!this.isVisible || !this.layerObj) {\r\n            return;\r\n        }\r\n\r\n        const layerIsVisible = this.layerObj.isVisible;\r\n        this.checkEl.parentElement!.title = layerIsVisible ? LANG('layers-active-layer-visible') : LANG('layers-active-layer-hidden');\r\n        this.checkEl.checked = layerIsVisible;\r\n        this.checkEl.style.boxShadow = layerIsVisible ? '' : '0 0 0 1px red';\r\n\r\n        this.nameLabelEl.textContent = this.layerObj.name;\r\n        if (this.layerObj.isVisible) {\r\n            this.opacityEl.innerHTML = LANG('opacity') + '<br>' + Math.round(this.layerObj.opacity * 100) + '%';\r\n        } else {\r\n            this.opacityEl.innerHTML = LANG('opacity') + '<br><s>' + Math.round(this.layerObj.opacity * 100) + '%</s>';\r\n        }\r\n\r\n        const layerCanvas = this.layerObj.context.canvas;\r\n\r\n        if (layerCanvas.width !== this.lastDrawnSize.width || layerCanvas.height !== this.lastDrawnSize.height) {\r\n            const canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, this.canvasSize, this.canvasSize, 1);\r\n            this.canvas.width = Math.round(canvasDimensions.width);\r\n            this.canvas.height = Math.round(canvasDimensions.height);\r\n\r\n            isInstant = true;\r\n        }\r\n\r\n        this.animationCanvas.width = this.canvas.width;\r\n        this.animationCanvas.height = this.canvas.height;\r\n\r\n        this.animationCanvasCtx.save();\r\n        this.animationCanvasCtx.imageSmoothingEnabled = false;\r\n        this.animationCanvasCtx.fillStyle = this.animationCanvasCheckerPattern;\r\n        this.animationCanvasCtx.fillRect(0, 0, this.animationCanvas.width, this.animationCanvas.height);\r\n        this.animationCanvasCtx.drawImage(layerCanvas, 0, 0, this.animationCanvas.width, this.animationCanvas.height);\r\n        this.animationCanvasCtx.restore();\r\n\r\n        if (isInstant) {\r\n            this.animationCount = 0;\r\n            this.canvasCtx.save();\r\n            this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\r\n            this.canvasCtx.restore();\r\n\r\n        } else {\r\n            this.animationCount = this.animationLength;\r\n            this.animate();\r\n\r\n        }\r\n\r\n        this.drawLargeCanvas();\r\n\r\n        this.lastDrawnState = klHistory.getState();\r\n        this.lastDrawnSize.width = layerCanvas.width;\r\n        this.lastDrawnSize.height = layerCanvas.height;\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onClick: () => void; // when clicking on layer name\r\n            klRootEl: HTMLElement;\r\n            uiState: TUiLayout;\r\n        }\r\n    ) {\r\n        // internally redraws with in an interval. checks history is something changed\r\n        // this update will be animated\r\n        // it will not be animated if the resolution changed\r\n        // also redraws when you call updateLayer - not animated\r\n\r\n        // syncs via updateLayer, and internally updates layer opacity via a hack\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-layer-preview',\r\n        });\r\n        this.isVisible = true;\r\n        this.height = 40;\r\n        this.canvasSize = this.height - 10;\r\n        this.largeCanvasSize = 300;\r\n        this.lastDrawnState = -2;\r\n        this.lastDrawnSize = {\r\n            width: 0,\r\n            height: 0,\r\n        };\r\n        this.animationCanvas = BB.canvas(); // to help animate the transition\r\n        this.animationCanvasCtx = BB.ctx(this.animationCanvas);\r\n        this.animationLength = 30;\r\n        this.animationCount = 0;\r\n        this.largeCanvasIsVisible = false;\r\n        let largeCanvasAnimationTimeout: ReturnType<typeof setTimeout>;\r\n        const largeCanvasAnimationDurationMs = 300;\r\n        this.uiState = p.uiState;\r\n\r\n\r\n        // --- setup dom ---\r\n        this.contentWrapperEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                height: this.height + 'px',\r\n            },\r\n        });\r\n\r\n\r\n        const checkWrapper = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'flex-end',\r\n                alignItems: 'center',\r\n                width: '23px',\r\n            },\r\n        });\r\n        this.checkEl = BB.el({\r\n            parent: checkWrapper,\r\n            tagName: 'input',\r\n            css: {\r\n                pointerEvents: 'none',\r\n            },\r\n            custom: {\r\n                type: 'checkbox',\r\n                disabled: 'true',\r\n            },\r\n        });\r\n\r\n        const canvasWrapperEl = BB.el({\r\n            css: {\r\n                //background: '#f00',\r\n                minWidth: this.height + 'px',\r\n                height: this.height + 'px',\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        this.canvas = BB.canvas(this.canvasSize, this.canvasSize);\r\n        this.canvasCtx = BB.ctx(this.canvas);\r\n        this.canvas.title = LANG('layers-active-layer');\r\n        const nameWrapper = BB.el({\r\n            css: {\r\n                //background: '#ff0',\r\n                flexGrow: '1',\r\n                paddingLeft: '10px',\r\n                fontSize: '13px',\r\n                overflow: 'hidden',\r\n                position: 'relative',\r\n            },\r\n        });\r\n        this.nameLabelEl = BB.el({\r\n            content: '',\r\n            css: {\r\n                cssFloat: 'left',\r\n                whiteSpace: 'nowrap',\r\n            },\r\n        });\r\n        const clickableEl = BB.el({\r\n            css: {\r\n                // background: 'rgba(0,255,0,0.6)',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '0',\r\n                width: '90px',\r\n                height: '100%',\r\n            },\r\n        });\r\n        if (p.onClick) {\r\n            clickableEl.addEventListener('click', () => p.onClick());\r\n            this.canvas.addEventListener('click', () => p.onClick());\r\n            checkWrapper.addEventListener('click', () => p.onClick());\r\n        }\r\n        this.opacityEl = BB.el({\r\n            content: LANG('opacity') + '<br>100%',\r\n            css: {\r\n                minWidth: '60px',\r\n                fontSize: '12px',\r\n                textAlign: 'center',\r\n            },\r\n        });\r\n\r\n        this.largeCanvasWrapper = BB.el({\r\n            onClick: BB.handleClick,\r\n            css: {\r\n                pointerEvents: 'none',\r\n                background: '#fff',\r\n                position: 'absolute',\r\n                right: '280px',\r\n                top: '10px',\r\n                border: '1px solid #aaa',\r\n                boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\r\n                transition: 'opacity '+largeCanvasAnimationDurationMs+'ms ease-in-out',\r\n                userSelect: 'none',\r\n                display: 'block',\r\n                webkitTouchCallout: 'none',\r\n            },\r\n        });\r\n        this.largeCanvas = BB.canvas(this.largeCanvasSize, this.largeCanvasSize);\r\n        this.largeCanvasWrapper.append(this.largeCanvas);\r\n        this.largeCanvasCtx = BB.ctx(this.largeCanvas);\r\n        BB.css(this.largeCanvas, {\r\n            display: 'block',\r\n        });\r\n\r\n\r\n        canvasWrapperEl.append(this.canvas);\r\n        nameWrapper.append(this.nameLabelEl, clickableEl);\r\n        this.contentWrapperEl.append(checkWrapper, canvasWrapperEl, nameWrapper, this.opacityEl);\r\n        this.rootEl.append(this.contentWrapperEl);\r\n\r\n\r\n        this.updateCheckerPatterns();\r\n        theme.addIsDarkListener(() => {\r\n            this.updateCheckerPatterns();\r\n            this.draw(true);\r\n        });\r\n\r\n\r\n\r\n        // --- update logic ---\r\n\r\n        // cross-fade done via 2 canvases (old and new state)\r\n        // both have checkerboard background drawn on them, both fully opaque\r\n        // -> no \"lighter\" is needed for accurate cross-fading\r\n\r\n        setInterval(() => {\r\n\r\n            if (!this.layerObj) {\r\n                return;\r\n            }\r\n\r\n            const currentState = klHistory.getState();\r\n            if (currentState === this.lastDrawnState) {\r\n                return;\r\n            }\r\n\r\n            //update opacity w hack\r\n            this.layerObj.opacity = (this.layerObj.context.canvas as KlCanvasLayer).opacity;\r\n\r\n            this.draw(false);\r\n\r\n        }, 2000);\r\n        \r\n\r\n        const removeLargeCanvas = () => {\r\n            this.largeCanvasWrapper.remove();\r\n        };\r\n\r\n        const showLargeCanvas = (b: boolean) => {\r\n            if (this.largeCanvasIsVisible === b) {\r\n                return;\r\n            }\r\n\r\n            clearTimeout(largeCanvasAnimationTimeout);\r\n            this.largeCanvasIsVisible = b;\r\n\r\n            if (b) {\r\n                largeCanvasAnimationTimeout = setTimeout(() => {\r\n                    this.drawLargeCanvas();\r\n                    this.largeCanvasWrapper.style.opacity = '0';\r\n                    p.klRootEl.append(this.largeCanvasWrapper);\r\n                    setTimeout(() => {\r\n                        this.largeCanvasWrapper.style.opacity = '1';\r\n                    }, 20);\r\n                }, 250);\r\n\r\n            } else {\r\n                this.largeCanvasWrapper.style.opacity = '0';\r\n                largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\r\n            }\r\n\r\n        };\r\n\r\n        const pointerListener = new BB.PointerListener({\r\n            target: this.canvas,\r\n            onEnterLeave: (b) => {\r\n                showLargeCanvas(b);\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (b: boolean): void {\r\n        if (this.isVisible === b) {\r\n            return;\r\n        }\r\n        this.isVisible = b;\r\n        this.contentWrapperEl.style.display = this.isVisible ? 'flex' : 'none';\r\n        this.rootEl.style.marginBottom = this.isVisible ? '' : '10px';\r\n\r\n        const currentState = klHistory.getState();\r\n        if (b && this.lastDrawnState !== currentState) {\r\n            this.draw(true);\r\n        }\r\n    }\r\n\r\n    //when the layer might have changed\r\n    setLayer (klCanvasLayerObj: TKlCanvasLayer): void {\r\n        this.layerObj = klCanvasLayerObj;\r\n        this.draw(true);\r\n    }\r\n\r\n    setUiState (stateStr: TUiLayout): void {\r\n        this.uiState = stateStr;\r\n\r\n        if (this.uiState === 'left') {\r\n            BB.css(this.largeCanvasWrapper, {\r\n                left: '280px',\r\n                right: '',\r\n            });\r\n        } else {\r\n            BB.css(this.largeCanvasWrapper, {\r\n                left: '',\r\n                right: '280px',\r\n            });\r\n        }\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {FreeTransformCanvas} from '../components/free-transform-canvas';\r\nimport {showModal} from './base/showModal';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {IKlBasicLayer} from '../../kl-types';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showImportAsLayerDialog (\r\n    params: {\r\n        target: HTMLElement;\r\n        klCanvas: KlCanvas;\r\n        importImage: HTMLImageElement | HTMLCanvasElement;\r\n        callback: (\r\n            p?: {x: number; y: number; width:number; height: number; angleDeg: number},\r\n            isPixelated?: boolean\r\n        ) => void;\r\n    }\r\n): void {\r\n\r\n    const div = document.createElement('div');\r\n    BB.appendTextDiv(div, LANG('import-as-layer-description'));\r\n    if (params.klCanvas.isLayerLimitReached()) {\r\n        const noteEl = BB.el({\r\n            content: LANG('import-as-layer-limit-reached'),\r\n            css: {\r\n                background: '#ff0',\r\n                padding: '10px',\r\n                marginTop: '5px',\r\n                marginBottom: '5px',\r\n                border: '1px solid #e7d321',\r\n                borderRadius: '5px',\r\n            },\r\n        });\r\n        div.append(noteEl);\r\n    }\r\n    const isSmall = window.innerWidth < 550;\r\n\r\n    const buttonRowEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n        },\r\n    });\r\n    const originalSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: '1:1',\r\n        css: {\r\n            marginRight: '10px',\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.reset();\r\n        },\r\n    });\r\n    const fitSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('import-as-layer-fit'),\r\n        css: {\r\n            marginRight: '10px',\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.setTransformFit();\r\n        },\r\n    });\r\n    const centerBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('center'),\r\n        css: {\r\n            marginRight: '10px',\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.setTransformCenter();\r\n        },\r\n    });\r\n    buttonRowEl.append(originalSizeBtn, fitSizeBtn, centerBtn);\r\n    div.append(buttonRowEl);\r\n\r\n\r\n\r\n    const layers: IKlBasicLayer[] = [];\r\n    {\r\n        const klCanvasLayerArr = params.klCanvas.getLayers();\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            layers.push({\r\n                image: klCanvasLayerArr[i].context.canvas,\r\n                isVisible: klCanvasLayerArr[i].isVisible,\r\n                opacity: klCanvasLayerArr[i].opacity,\r\n                mixModeStr: klCanvasLayerArr[i].mixModeStr,\r\n            });\r\n        }\r\n    }\r\n    layers.push({\r\n        image: params.importImage,\r\n        isVisible: true,\r\n        opacity: 1,\r\n        mixModeStr: 'source-over',\r\n    });\r\n\r\n\r\n    const freeTransformCanvas = new FreeTransformCanvas({\r\n        elementWidth: isSmall ? 340 : 540,\r\n        elementHeight: isSmall ? 280 : 350,\r\n        imageWidth: params.klCanvas.getLayerContext(0)!.canvas.width,\r\n        imageHeight: params.klCanvas.getLayerContext(0)!.canvas.height,\r\n        layers: layers,\r\n        transformIndex: layers.length - 1,\r\n    });\r\n    BB.css(freeTransformCanvas.getElement(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n    });\r\n    div.append(freeTransformCanvas.getElement());\r\n\r\n    function move (x: number, y: number): void {\r\n        freeTransformCanvas.move(x, y);\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr) {\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        },\r\n    });\r\n\r\n    showModal({\r\n        target: params.target,\r\n        message: `<b>${LANG('import-as-layer-title')}</b>`,\r\n        div: div,\r\n        style: isSmall ? undefined : {\r\n            width: '540px',\r\n        },\r\n        buttons: ['Ok', 'Cancel'],\r\n        clickOnEnter: 'Ok',\r\n        callback: function (buttonStr) {\r\n            keyListener.destroy();\r\n            freeTransformCanvas.destroy();\r\n            BB.destroyEl(originalSizeBtn);\r\n            BB.destroyEl(fitSizeBtn);\r\n            BB.destroyEl(centerBtn);\r\n            if (buttonStr === 'Ok') {\r\n                params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\r\n            } else {\r\n                params.callback();\r\n            }\r\n        },\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\ntype TDropOption = 'default' | 'layer' | 'image';\r\n\r\n/**\r\n * Not really generalized. UI when you drag/drop an image into window.\r\n * The moment you create it, it will listen.\r\n * */\r\nexport class KlImageDropper {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onDrop: (files: FileList, optionStr: TDropOption) => void;\r\n            target: HTMLElement;\r\n            enabledTest: () => boolean;\r\n        }\r\n    ) {\r\n        //set up DOM\r\n        this.rootEl = BB.el({\r\n            content: 'Drop to import',\r\n            css: {\r\n                paddingTop: '100px',\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                width: '100%',\r\n                height: '100%',\r\n                background: 'rgba(50, 50, 50, 0.7)',\r\n                color: '#fff',\r\n                textShadow: '2px 2px #000',\r\n                textAlign: 'center',\r\n                fontSize: '25px',\r\n            },\r\n        });\r\n        const wrapperEl = BB.el({\r\n            css: {\r\n                'marginTop': '50px',\r\n                'display': 'flex',\r\n                'justifyContent': 'center',\r\n            },\r\n        });\r\n        const optionStyle = {\r\n            width: '200px',\r\n            padding: '50px',\r\n            margin: '10px',\r\n            //opacity: 0.5,\r\n            borderRadius: '20px',\r\n            border: '1px dashed #fff',\r\n            background: '#00aefe',\r\n            fontWeight: 'bold',\r\n        };\r\n        const optionLayerEl = BB.el({\r\n            content: 'As Layer',\r\n            css: optionStyle,\r\n        });\r\n        const optionImageEl = BB.el({\r\n            content: 'As New Image',\r\n            css: optionStyle,\r\n        });\r\n\r\n        this.rootEl.append(wrapperEl);\r\n        wrapperEl.append(optionLayerEl, optionImageEl);\r\n\r\n\r\n        let rootCounter = 0;\r\n        let optionLayerCounter = 0;\r\n        let optionImageCounter = 0;\r\n\r\n        const destroy = () => {\r\n            rootCounter = 0;\r\n            optionLayerCounter = 0;\r\n            optionImageCounter = 0;\r\n            this.rootEl.remove();\r\n        };\r\n\r\n        /**\r\n         * check, can drop content be imported\r\n         */\r\n        const testAcceptType = (event: DragEvent): boolean => {\r\n            return !!event.dataTransfer && !event.dataTransfer.types.includes('text/plain');\r\n        };\r\n\r\n        const updateOptions = () => {\r\n            const boxShadow = '0 0 20px 4px #fff';\r\n            if (optionLayerCounter > 0) {\r\n                optionLayerEl.style.boxShadow = boxShadow;\r\n                optionImageEl.style.boxShadow = '';\r\n            } else if (optionImageCounter > 0) {\r\n                optionLayerEl.style.boxShadow = '';\r\n                optionImageEl.style.boxShadow = boxShadow;\r\n            } else {\r\n                optionLayerEl.style.boxShadow = '';\r\n                optionImageEl.style.boxShadow = '';\r\n            }\r\n        };\r\n\r\n        optionLayerEl.addEventListener('dragenter', () => {\r\n            optionLayerCounter++;\r\n            updateOptions();\r\n        });\r\n        optionLayerEl.addEventListener('dragleave', () => {\r\n            optionLayerCounter--;\r\n            updateOptions();\r\n        });\r\n        optionImageEl.addEventListener('dragenter', () => {\r\n            optionImageCounter++;\r\n            updateOptions();\r\n        });\r\n        optionImageEl.addEventListener('dragleave', () => {\r\n            optionImageCounter--;\r\n            updateOptions();\r\n        });\r\n\r\n\r\n        const rootDragOver = (event: DragEvent): void => {\r\n            if (!testAcceptType(event)) {\r\n                return;\r\n            }\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n        };\r\n\r\n        const rootDragEnter = (event: DragEvent): void => {\r\n            if (!p.enabledTest() || !testAcceptType(event)) {\r\n                return;\r\n            }\r\n            if (rootCounter === 0) {\r\n                p.target.append(this.rootEl);\r\n            }\r\n            rootCounter++;\r\n        };\r\n\r\n        const rootDragLeave = (event: DragEvent): void => {\r\n            if (!testAcceptType(event) || rootCounter === 0) {\r\n                return;\r\n            }\r\n            rootCounter = Math.max(0, rootCounter - 1);\r\n            if (rootCounter === 0) {\r\n                this.rootEl.remove();\r\n            }\r\n        };\r\n\r\n        const rootDrop = (event: DragEvent): void => {\r\n            if (!testAcceptType(event) || !event.dataTransfer || event.dataTransfer.files.length === 0) {\r\n                destroy();\r\n                return;\r\n            }\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n\r\n            let optionStr: TDropOption = 'default';\r\n            if (optionLayerCounter > 0) {\r\n                optionStr = 'layer';\r\n            } else if (optionImageCounter > 0) {\r\n                optionStr = 'image';\r\n            }\r\n\r\n            p.onDrop(event.dataTransfer.files, optionStr);\r\n\r\n\r\n            if (rootCounter > 0) {\r\n                this.rootEl.remove();\r\n            }\r\n            rootCounter = 0;\r\n            optionLayerCounter = 0;\r\n            optionImageCounter = 0;\r\n            updateOptions();\r\n        };\r\n\r\n        window.addEventListener('dragover', rootDragOver, false);\r\n        window.addEventListener('dragenter', rootDragEnter, false);\r\n        window.addEventListener('dragleave', rootDragLeave, false);\r\n        window.addEventListener('drop', rootDrop, false);\r\n\r\n        // if something goes wrong and you're stuck with overlay\r\n        this.rootEl.addEventListener('pointerdown', () => {\r\n            destroy();\r\n        });\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: (keyStr) => {\r\n                if (rootCounter > 0 && keyStr === 'esc') {\r\n                    destroy();\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {KlColorSliderSmall} from './kl-color-slider-small';\r\nimport {KlSlider} from './kl-slider';\r\nimport {BrushSettingService, TBrushSettingEmit} from '../../brushes-ui/brush-setting-service';\r\nimport {LANG} from '../../../language/language';\r\nimport {IRGB} from '../../kl-types';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\n\r\n/**\r\n * Compressed HUD toolspace. When you hold ctrl+alt.\r\n * small color picker, brush settings\r\n */\r\nexport class OverlayToolspace {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            brushSettingService: BrushSettingService; // to sync with outside\r\n            enabledTest: () => boolean; // calls to see if it's allowed to show\r\n        }\r\n    ) {\r\n        const sizeObj = {\r\n            width: 150,\r\n            svHeight: 90,\r\n            hHeight: 20,\r\n            sliderHeight: 25,\r\n        };\r\n\r\n        let isVisible = false;\r\n        this.rootEl = BB.el({\r\n            className: 'kl-overlay-toolspace',\r\n        });\r\n        const queuedObj: {\r\n            color: IRGB | null;\r\n            size: number | null;\r\n            opacity: number | null;\r\n        } = {\r\n            color: null,\r\n            size: null,\r\n            opacity: null,\r\n        };\r\n\r\n\r\n        // --- inputs ---\r\n\r\n        //color selection\r\n        const colorEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-overlay-toolspace__color',\r\n        });\r\n        const colorSlider = new KlColorSliderSmall({\r\n            width: sizeObj.width,\r\n            heightSV: sizeObj.svHeight,\r\n            heightH: sizeObj.hHeight,\r\n            color: p.brushSettingService.getColor(),\r\n            callback: (rgbObj: IRGB) => {\r\n                selectedColorEl.style.backgroundColor = 'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')';\r\n                p.brushSettingService.setColor(rgbObj, subscriptionFunc);\r\n            },\r\n        });\r\n        const selectedColorEl = BB.el({\r\n            css: {\r\n                width: sizeObj.width + 'px',\r\n                height: sizeObj.hHeight + 'px',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        {\r\n            const initialColor = p.brushSettingService.getColor();\r\n            selectedColorEl.style.backgroundColor = 'rgb(' + initialColor.r + ',' + initialColor.g + ',' + initialColor.b + ')';\r\n        }\r\n\r\n        colorEl.append(selectedColorEl, colorSlider.getElement());\r\n\r\n\r\n        const updateColor = (rgbObj: IRGB) => {\r\n            colorSlider.setColor(rgbObj);\r\n            selectedColorEl.style.backgroundColor = 'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')';\r\n        };\r\n\r\n\r\n\r\n        //brushsize slider\r\n\r\n        const sizeSlider = new KlSlider({\r\n            label: LANG('brush-size'),\r\n            width: sizeObj.width,\r\n            height: sizeObj.sliderHeight,\r\n            min: 0,\r\n            max: 500,\r\n            value: 50,\r\n            resolution: 225,\r\n            eventResMs: 1000 / 30,\r\n            toDisplayValue: (val) => val * 2,\r\n            toValue: (displayValue) => displayValue / 2,\r\n            onChange: (v) => {\r\n                p.brushSettingService.setSize(v);\r\n            },\r\n            formatFunc: (displayValue) => {\r\n                if (displayValue < 10) {\r\n                    return BB.round(displayValue, 1);\r\n                } else {\r\n                    return Math.round(displayValue);\r\n                }\r\n            },\r\n        });\r\n        BB.css(sizeSlider.getElement(), {\r\n            marginTop: '2px',\r\n        });\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: sizeObj.width,\r\n            height: sizeObj.sliderHeight,\r\n            min: 0,\r\n            max: 1,\r\n            value: 1,\r\n            resolution: 225,\r\n            eventResMs: 1000 / 30,\r\n            toDisplayValue: (val) => val * 100,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            onChange: (v) => {\r\n                p.brushSettingService.setOpacity(v);\r\n            },\r\n        });\r\n        BB.css(opacitySlider.getElement(), {\r\n            margin: '2px 0',\r\n        });\r\n        this.rootEl.append(sizeSlider.getElement(), opacitySlider.getElement());\r\n\r\n\r\n\r\n        // --- general setup ---\r\n\r\n        const subscriptionFunc = (event: TBrushSettingEmit) => {\r\n            if (event.type === 'color') {\r\n                if (!isVisible) {\r\n                    queuedObj.color = event.value;\r\n                } else {\r\n                    updateColor(event.value);\r\n                }\r\n            }\r\n            if (event.type === 'size') {\r\n                if (!isVisible) {\r\n                    queuedObj.size = event.value;\r\n                } else {\r\n                    sizeSlider.setValue(event.value);\r\n                }\r\n            }\r\n            if (event.type === 'opacity') {\r\n                if (!isVisible) {\r\n                    queuedObj.opacity = event.value;\r\n                } else {\r\n                    opacitySlider.setValue(event.value);\r\n                }\r\n            }\r\n            if (event.type === 'sliderConfig') {\r\n                sizeSlider.update(event.value.sizeSlider);\r\n                opacitySlider.update(event.value.opacitySlider);\r\n            }\r\n        };\r\n        p.brushSettingService.subscribe(subscriptionFunc);\r\n        {\r\n            const sliderConfig = p.brushSettingService.getSliderConfig();\r\n            sizeSlider.update(sliderConfig.sizeSlider);\r\n            opacitySlider.update(sliderConfig.opacitySlider);\r\n            sizeSlider.setValue(p.brushSettingService.getSize());\r\n            opacitySlider.setValue(p.brushSettingService.getOpacity());\r\n        }\r\n\r\n        const updateUI = () => {\r\n\r\n            // unfocus manual slider input\r\n            BB.unfocusAnyInput();\r\n\r\n            this.rootEl.style.display = isVisible ? 'block' : 'none';\r\n            if (isVisible && mousePos) {\r\n                BB.css(this.rootEl, {\r\n                    left: (mousePos.x - Math.round(sizeObj.width / 2)) + 'px',\r\n                    top: (mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2)) + 'px',\r\n                });\r\n            }\r\n        };\r\n\r\n        let mousePos: IVector2D | null = null;\r\n        document.addEventListener('pointermove', (event) => {\r\n            mousePos = {\r\n                x: event.pageX,\r\n                y: event.pageY,\r\n            };\r\n        });\r\n\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr, isRepeat) => {\r\n                if (isRepeat) {\r\n                    return;\r\n                }\r\n                if (isVisible) {\r\n                    isVisible = false;\r\n                    updateUI();\r\n                    return;\r\n                }\r\n\r\n                if (!p.enabledTest() || !mousePos) {\r\n                    return;\r\n                }\r\n\r\n                if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    isVisible = true;\r\n\r\n                    if (queuedObj.color !== null) {\r\n                        updateColor(queuedObj.color);\r\n                        queuedObj.color = null;\r\n                    }\r\n                    if (queuedObj.size !== null) {\r\n                        sizeSlider.setValue(queuedObj.size);\r\n                        queuedObj.size = null;\r\n                    }\r\n                    if (queuedObj.opacity !== null) {\r\n                        opacitySlider.setValue(queuedObj.opacity);\r\n                        queuedObj.opacity = null;\r\n                    }\r\n\r\n                    updateUI();\r\n                }\r\n\r\n            },\r\n            onUp: (keyStr, event, oldComboStr) => {\r\n                if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(oldComboStr) && isVisible) {\r\n                    isVisible = false;\r\n                    colorSlider.end();\r\n                    updateUI();\r\n                }\r\n            },\r\n            onBlur: () => {\r\n                if (isVisible) {\r\n                    isVisible = false;\r\n                    colorSlider.end();\r\n                    updateUI();\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport klecksLogoImg from '/src/app/img/klecks-logo.png';\r\nimport newImageImg from '/src/app/img/ui/new-image.svg';\r\nimport importImg from '/src/app/img/ui/import.svg';\r\nimport exportImg from '/src/app/img/ui/export.svg';\r\nimport shareImg from '/src/app/img/ui/share.svg';\r\nimport helpImg from '/src/app/img/ui/help.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n\r\n/**\r\n * Topmost row of buttons in toolspace (with the app logo)\r\n */\r\nexport class ToolspaceTopRow {\r\n    \r\n    private readonly rootEl: HTMLElement;\r\n    \r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            logoImg: string;\r\n            onLogo: () => void;\r\n            onNew: () => void;\r\n            onImport: () => void;\r\n            onSave: () => void;\r\n            onShare: () => void;\r\n            onHelp: () => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-toolspace-row',\r\n            css: {\r\n                height: '36px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        function createButton (\r\n            p: {\r\n                onClick: () => void;\r\n                title: string;\r\n                image: string;\r\n                contain: boolean;\r\n                extraPadding?: number;\r\n                darkInvert?: boolean;\r\n            }\r\n        ): {\r\n            el: HTMLElement;\r\n            pointerListener: PointerListener;\r\n        } {\r\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n            const el = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.contain ? padding + 'px 0' : '',\r\n                },\r\n            });\r\n            const im = BB.el({\r\n                className: p.darkInvert ? 'dark-invert' : undefined,\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundPosition: 'center',\r\n                    backgroundSize: p.contain ? 'contain' : '',\r\n                    //filter: 'grayscale(1)',\r\n                    height: '100%',\r\n                },\r\n            });\r\n            im.style.pointerEvents = 'none';\r\n            el.append(im);\r\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: el,\r\n                onEnterLeave: function (isOver) {\r\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\r\n                },\r\n            });\r\n            return {\r\n                el,\r\n                pointerListener,\r\n            };\r\n        }\r\n\r\n        const logoButton = createButton({\r\n            onClick: p.onLogo,\r\n            title: LANG('home'),\r\n            image: p.logoImg ? p.logoImg : klecksLogoImg,\r\n            contain: true,\r\n            darkInvert: true,\r\n        });\r\n        logoButton.el.classList.add('kl-tool-row-border-right');\r\n        BB.css(logoButton.el, {\r\n            width: '46px',\r\n        });\r\n        const newButton = createButton({\r\n            onClick: p.onNew,\r\n            title: LANG('file-new'),\r\n            image: newImageImg,\r\n            extraPadding: 1,\r\n            contain: true,\r\n        });\r\n        const importButton = createButton({\r\n            onClick: p.onImport,\r\n            title: LANG('file-import'),\r\n            image: importImg,\r\n            extraPadding: 1,\r\n            contain: true,\r\n        });\r\n        const saveButton = createButton({\r\n            onClick: p.onSave,\r\n            title: LANG('file-save'),\r\n            image: exportImg,\r\n            extraPadding: 1,\r\n            contain: true,\r\n        });\r\n\r\n        let shareButton = null;\r\n        if (BB.canShareFiles()) {\r\n            shareButton = createButton({\r\n                onClick: p.onShare,\r\n                title: LANG('file-share'),\r\n                image: shareImg,\r\n                contain: true,\r\n                darkInvert: true,\r\n            });\r\n        }\r\n        const helpButton = createButton({\r\n            onClick: p.onHelp,\r\n            title: LANG('help'),\r\n            image: helpImg,\r\n            contain: true,\r\n            darkInvert: true,\r\n        });\r\n\r\n        BB.append(this.rootEl, [\r\n            logoButton.el,\r\n            newButton.el,\r\n            importButton.el,\r\n            saveButton.el,\r\n            shareButton ? shareButton.el : undefined,\r\n            helpButton.el,\r\n        ]);\r\n    }\r\n    \r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6Sfz2\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eaJmh\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kV8IH\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"SROeX\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"lFrok\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cvYlU\");","import {BB} from '../../../bb/bb';\r\nimport {dialogCounter} from '../modals/modal-count';\r\nimport toolPaintImg from '/src/app/img/ui/tool-paint.svg';\r\nimport toolFillImg from '/src/app/img/ui/tool-fill.svg';\r\nimport toolGradientImg from '/src/app/img/ui/tool-gradient.svg';\r\nimport toolTextImg from '/src/app/img/ui/tool-text.svg';\r\nimport toolShapeImg from '/src/app/img/ui/tool-shape.svg';\r\nimport caretDownImg from '/src/app/img/ui/caret-down.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {TToolType} from '../../kl-types';\r\n\r\n\r\ntype TDropdownButton = {\r\n    wrapper: HTMLElement;\r\n    show: (b: boolean) => void;\r\n    setIsSmall: (b: boolean) => void;\r\n};\r\n\r\n/**\r\n * Toolrow Dropdown. The button where you select: brush, fill, select, transform, etc.\r\n */\r\nexport class ToolDropdown {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly activeButton: HTMLElement;\r\n    private readonly smallMargin: string = '6px 0';\r\n    private readonly optionArr: TToolType[] = ['draw', 'fill', 'gradient', 'text', 'shape'];\r\n    private readonly dropdownBtnArr: TDropdownButton[];\r\n    private readonly arrowButton: HTMLElement;\r\n    private isActive: boolean;\r\n    private currentActiveIndex: number;\r\n    private readonly titleArr: string[];\r\n    private activeButtonIm: HTMLElement;\r\n    private readonly imArr;\r\n\r\n    private updateButton () {\r\n        this.activeButton.title = this.titleArr[this.currentActiveIndex];\r\n        this.activeButtonIm.style.backgroundImage = 'url(\\'' + this.imArr[this.currentActiveIndex] + '\\')';\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onChange: (activeStr: TToolType) => void;\r\n        }\r\n    ) {\r\n        this.imArr = [\r\n            toolPaintImg,\r\n            toolFillImg,\r\n            toolGradientImg,\r\n            toolTextImg,\r\n            toolShapeImg,\r\n        ];\r\n        this.titleArr = [\r\n            `${LANG('tool-brush')} [B]`,\r\n            `${LANG('tool-paint-bucket')} [G]`,\r\n            `${LANG('tool-gradient')} [G]`,\r\n            `${LANG('tool-text')} [T]`,\r\n            `${LANG('tool-shape')} [U]`,\r\n        ];\r\n        this.currentActiveIndex = 0;\r\n        this.isActive = true;\r\n        let isOpen = false;\r\n\r\n        //preload images\r\n        setTimeout(() => {\r\n            for (let i = 1; i < this.imArr.length; i++) {\r\n                const im = new Image();\r\n                im.src = this.imArr[i];\r\n            }\r\n        }, 100);\r\n\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n\r\n        let openTimeout: ReturnType<typeof setTimeout>;\r\n        let isDragging = false;\r\n        let startX: number;\r\n        let startY: number;\r\n        let pointerListener;\r\n        if (BB.hasPointerEvents) {\r\n            pointerListener = new BB.PointerListener({\r\n                target: this.rootEl,\r\n                onPointer: (event) => {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (isOpen) {\r\n                            return;\r\n                        }\r\n\r\n                        openTimeout = setTimeout(() => {\r\n                            showDropdown();\r\n                        }, 400);\r\n                        isDragging = true;\r\n                        startX = event.pageX;\r\n                        startY = event.pageY;\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        if (isDragging && !isOpen && BB.dist(startX, startY, event.pageX, event.pageY) > 5) {\r\n                            clearTimeout(openTimeout);\r\n                            showDropdown();\r\n                        }\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        clearTimeout(openTimeout);\r\n                        if (isOpen && isDragging) {\r\n                            const target = document.elementFromPoint(event.pageX, event.pageY);\r\n                            for (let i = 0; i < this.dropdownBtnArr.length; i++) {\r\n                                if (target === this.dropdownBtnArr[i].wrapper) {\r\n                                    closeDropdown();\r\n                                    this.isActive = true;\r\n                                    this.currentActiveIndex = i;\r\n                                    this.updateButton();\r\n                                    p.onChange(this.optionArr[this.currentActiveIndex]);\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                        isDragging = false;\r\n                    }\r\n                },\r\n            });\r\n        }\r\n\r\n        this.activeButton = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'toolspace-row-button nohighlight toolspace-row-button-activated',\r\n            title: this.titleArr[this.currentActiveIndex],\r\n            onClick: (e) => {\r\n                if (this.isActive && !isOpen) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    showDropdown();\r\n                    return;\r\n                }\r\n\r\n                this.isActive = true;\r\n                p.onChange(this.optionArr[this.currentActiveIndex]);\r\n                if (isOpen) {\r\n                    closeDropdown();\r\n                }\r\n            },\r\n            css: {\r\n                padding: '10px 0',\r\n                pointerEvents: 'auto',\r\n                height: '100%',\r\n                boxSizing: 'border-box',\r\n            },\r\n        });\r\n\r\n        this.activeButtonIm = BB.el({\r\n            parent: this.activeButton,\r\n            className: 'dark-invert',\r\n            css: {\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: 'contain',\r\n                width: 'calc(100% - 7px)',\r\n                height: '100%',\r\n                pointerEvents: 'none',\r\n                opacity: '0.75',\r\n            },\r\n        });\r\n\r\n        this.arrowButton = BB.el({\r\n            parent: this.activeButton,\r\n            className: 'dark-invert',\r\n            css: {\r\n                position: 'absolute',\r\n                right: '1px',\r\n                bottom: '1px',\r\n                width: '18px',\r\n                height: '18px',\r\n                //background: '#aaa',\r\n                //borderRadius: '2px',\r\n                cursor: 'pointer',\r\n\r\n                backgroundImage: 'url(\\'' + caretDownImg + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: '60%',\r\n            },\r\n            title: 'More Tools',\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                showDropdown();\r\n            },\r\n        });\r\n\r\n\r\n        const overlay = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                //background: 'rgba(255,0,0,0.5)',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n            },\r\n        });\r\n        const overlayPointerListener = new BB.PointerListener({\r\n            target: overlay,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    e.eventPreventDefault();\r\n                    closeDropdown();\r\n                }\r\n            },\r\n        });\r\n\r\n        const dropdownWrapper = BB.el({\r\n            className: 'tool-dropdown-wrapper',\r\n            css: {\r\n                position: 'absolute',\r\n                width: '100%',\r\n                height: (100 * (this.optionArr.length - 1)) + '%',\r\n                top: '100%',\r\n                left: '0',\r\n                zIndex: '1',\r\n                boxSizing: 'border-box',\r\n                cursor: 'pointer',\r\n                transition: 'height 0.1s ease-in-out, opacity 0.1s ease-in-out',\r\n                borderBottomLeftRadius: '5px',\r\n                borderBottomRightRadius: '5px',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n        this.dropdownBtnArr = [];\r\n\r\n        const createDropdownButton = (\r\n            p: {\r\n                index: number;\r\n                id: TToolType;\r\n                image: string;\r\n                title: string;\r\n                onClick: (index: number) => void;\r\n            }\r\n        ): TDropdownButton => {\r\n            const wrapper = BB.el({\r\n                parent: dropdownWrapper,\r\n                className: 'tool-dropdown-button',\r\n                title: p.title,\r\n                css: {\r\n                    padding: '10px 0',\r\n                    height: (100 / (this.optionArr.length - 1)) + '%',\r\n                    boxSizing: 'border-box',\r\n                },\r\n                onClick: (e) => {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    p.onClick(p.index);\r\n                },\r\n            });\r\n\r\n            BB.el({\r\n                parent: wrapper,\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundPosition: 'center',\r\n                    backgroundSize: 'contain',\r\n                    height: '100%',\r\n                    pointerEvents: 'none',\r\n                    opacity: '0.75',\r\n                },\r\n            });\r\n\r\n            // --- interface ---\r\n            const show = (b: boolean) => {\r\n                wrapper.style.display = b ? 'block' : 'none';\r\n            };\r\n\r\n            const setIsSmall = (b: boolean) => {\r\n                wrapper.style.padding = b ? this.smallMargin : '10px 0';\r\n            };\r\n\r\n            return {\r\n                wrapper,\r\n                show,\r\n                setIsSmall,\r\n            };\r\n        };\r\n\r\n        const onClickDropdownBtn = (index: number) => {\r\n            closeDropdown();\r\n\r\n            this.isActive = true;\r\n            this.currentActiveIndex = index;\r\n\r\n            this.updateButton();\r\n\r\n            p.onChange(this.optionArr[this.currentActiveIndex]);\r\n        };\r\n\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            this.dropdownBtnArr.push(createDropdownButton({\r\n                index: i,\r\n                id: this.optionArr[i],\r\n                image: this.imArr[i],\r\n                title: this.titleArr[i],\r\n                onClick: onClickDropdownBtn,\r\n            }));\r\n        }\r\n\r\n        const showDropdown = () => {\r\n            dialogCounter.increase(0.5);\r\n            isOpen = true;\r\n\r\n            for (let i = 0; i < this.optionArr.length; i++) {\r\n                this.dropdownBtnArr[i].show(this.currentActiveIndex !== i);\r\n            }\r\n\r\n            this.arrowButton.style.display = 'none';\r\n            this.rootEl.style.zIndex = '1';\r\n            document.body.append(overlay);\r\n            this.rootEl.append(dropdownWrapper);\r\n        };\r\n\r\n        const closeDropdown = () => {\r\n            dialogCounter.decrease(0.5);\r\n            isOpen = false;\r\n            this.arrowButton.style.removeProperty('display');\r\n            this.rootEl.style.removeProperty('z-index');\r\n            overlay.remove();\r\n            dropdownWrapper.remove();\r\n        };\r\n\r\n        this.updateButton();\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    setIsSmall (b: boolean): void {\r\n        this.activeButton.style.padding = b ? this.smallMargin : '10px 0';\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            this.dropdownBtnArr[i].setIsSmall(b);\r\n        }\r\n        if (b) {\r\n            this.arrowButton.style.width = '14px';\r\n            this.arrowButton.style.height = '14px';\r\n        } else {\r\n            this.arrowButton.style.width = '18px';\r\n            this.arrowButton.style.height = '18px';\r\n        }\r\n    }\r\n\r\n    setActive (activeStr: TToolType): void {\r\n        if (this.optionArr.includes(activeStr)) {\r\n            this.isActive = true;\r\n            for (let i = 0; i < this.optionArr.length; i++) {\r\n                if (this.optionArr[i] === activeStr) {\r\n                    this.currentActiveIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n            this.activeButton.classList.add('toolspace-row-button-activated');\r\n            this.updateButton();\r\n        } else {\r\n            this.isActive = false;\r\n            this.activeButton.classList.remove('toolspace-row-button-activated');\r\n        }\r\n    }\r\n\r\n    getActive (): TToolType {\r\n        return this.optionArr[this.currentActiveIndex];\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dW3eU\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fnumN\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6J8A8\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"da34V\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eStsa\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eW5wL\");","import {BB} from '../../../bb/bb';\r\nimport {ToolDropdown} from './tool-dropdown';\r\nimport toolHandImg from '/src/app/img/ui/tool-hand.svg';\r\nimport toolZoomInImg from '/src/app/img/ui/tool-zoom-in.svg';\r\nimport toolZoomOutImg from '/src/app/img/ui/tool-zoom-out.svg';\r\nimport toolUndoImg from '/src/app/img/ui/tool-undo.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {TToolType} from '../../kl-types';\r\n\r\n\r\ntype TBaseToolRowButton = {\r\n    el: HTMLElement;\r\n};\r\n\r\ntype TToolRowButton = TBaseToolRowButton & {\r\n    pointerListener: PointerListener;\r\n    setIsSmall: (b: boolean) => void;\r\n};\r\n\r\ntype TToolRowTriangleButton = TBaseToolRowButton & {\r\n    setIsEnabledLeft: (b: boolean) => void;\r\n    setIsEnabledRight: (b: boolean) => void;\r\n    leftPointerListener: PointerListener;\r\n    rightPointerListener: PointerListener;\r\n};\r\n\r\n/**\r\n * Row of buttons in toolspace. image-operations (draw, hand), zoom, undo/redo\r\n * Need to do syncing. So tool is correct, and zoom/undo/redo buttons are properly enabled/disabled\r\n * heights: 54px tall, 36px small -> via setIsSmall\r\n */\r\nexport class ToolspaceToolRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly toolDropdown: ToolDropdown;\r\n    private readonly handButton: TToolRowButton;\r\n    private readonly zoomInButton: TToolRowButton;\r\n    private readonly zoomOutButton: TToolRowButton;\r\n    private readonly undoButton: TToolRowButton;\r\n    private readonly redoButton: TToolRowButton;\r\n    private readonly zoomInNOutButton: TToolRowTriangleButton;\r\n    private readonly undoNRedoButton: TToolRowTriangleButton;\r\n    private currentActiveStr: TToolType;\r\n    private readonly onActivate: (activeStr: TToolType) => void;\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            onActivate: (activeStr: TToolType) => void; // clicking on tool button - activating it\r\n            onZoomIn: () => void;\r\n            onZoomOut: () => void;\r\n            onUndo: () => void;\r\n            onRedo: () => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el( {\r\n            className: 'kl-toolspace-row',\r\n            css: {\r\n                height: '54px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        this.onActivate = p.onActivate;\r\n        this.currentActiveStr = 'draw'; // 'draw' | 'hand' | 'fill'\r\n\r\n\r\n        const createButton = (p: {\r\n            onClick: () => void;\r\n            image: string;\r\n            contain: boolean;\r\n            doLighten?: boolean;\r\n            doMirror?: boolean;\r\n        }): TToolRowButton => {\r\n\r\n            const smallMargin = p.doLighten ? '6px 0' : '8px 0';\r\n\r\n            const el = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                //title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.contain ? '10px 0' : '',\r\n                },\r\n            });\r\n            const im = BB.el({\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundPosition: 'center',\r\n                    backgroundSize: p.contain ? 'contain' : '',\r\n                    //filter: 'grayscale(1)',\r\n                    height: '100%',\r\n                    transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                    pointerEvents: 'none',\r\n                    opacity: p.doLighten ? '0.75' : '1',\r\n                },\r\n            });\r\n            el.append(im);\r\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: el,\r\n                onEnterLeave: (isOver) => {\r\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\r\n                },\r\n            });\r\n            const setIsSmall = (b: boolean) => {\r\n                el.style.padding = p.contain ? (b ? smallMargin : '10px 0') : '';\r\n            };\r\n            return {\r\n                el,\r\n                pointerListener,\r\n                setIsSmall,\r\n            };\r\n        };\r\n\r\n\r\n        const createTriangleButton = (p: {\r\n            onLeft: () => void;\r\n            onRight: () => void;\r\n            leftImage: string;\r\n            rightImage: string | null;\r\n        }): TToolRowTriangleButton => { // because IE and Edge don't support clip path\r\n\r\n            const result = BB.el({\r\n                css: {\r\n                    flexGrow: '1',\r\n                    position: 'relative',\r\n                },\r\n            });\r\n\r\n            const svg = BB.createSvg({\r\n                elementType: 'svg',\r\n                width: '67px', // can't think of a way doing with percentage\r\n                height: '54px',\r\n                viewBox: '0 0 100 100',\r\n                preserveAspectRatio: 'none',\r\n            });\r\n            BB.css(svg, {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n            });\r\n\r\n            const blurRadius = 10;\r\n            const blurOffsetX = 2;\r\n            const blurOffsetY = 2;\r\n\r\n            const defs = BB.createSvg( { // inset shadow via svg\r\n                elementType: 'defs',\r\n                childrenArr: [\r\n                    {\r\n                        elementType: 'filter',\r\n                        id: 'innershadow',\r\n                        x0: '-50%',\r\n                        y0: '-50%',\r\n                        width: '200%',\r\n                        height: '200%',\r\n                        childrenArr: [\r\n                            {\r\n                                elementType: 'feGaussianBlur',\r\n                                in: 'SourceAlpha',\r\n                                stdDeviation: '' + blurRadius,\r\n                                result: 'blur',\r\n                            }, {\r\n                                elementType: 'feOffset',\r\n                                dx: '' + blurOffsetX,\r\n                                dy: '' + blurOffsetY,\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'SourceAlpha',\r\n                                operator: 'arithmetic',\r\n                                k2: '-1',\r\n                                k3: '1',\r\n                                result: 'shadowDiff',\r\n                            },\r\n\r\n                            {\r\n                                elementType: 'feFlood',\r\n                                'flood-color': '#000',\r\n                                'flood-opacity': '0.2',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'shadowDiff',\r\n                                operator: 'in',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'SourceGraphic',\r\n                                operator: 'over',\r\n                                result: 'firstfilter',\r\n                            },\r\n\r\n                            {\r\n                                elementType: 'feGaussianBlur',\r\n                                in: 'firstfilter',\r\n                                stdDeviation: '' + blurRadius,\r\n                                result: 'blur2',\r\n                            }, {\r\n                                elementType: 'feOffset',\r\n                                dx: '' + blurOffsetX,\r\n                                dy: '' + blurOffsetY,\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'firstfilter',\r\n                                operator: 'arithmetic',\r\n                                k2: '-1',\r\n                                k3: '1',\r\n                                result: 'shadowDiff',\r\n                            },\r\n\r\n                            {\r\n                                elementType: 'feFlood',\r\n                                'flood-color': '#000',\r\n                                'flood-opacity': '0.2',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'shadowDiff',\r\n                                operator: 'in',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'firstfilter',\r\n                                operator: 'over',\r\n                            },\r\n                        ],\r\n                    },\r\n                ],\r\n            });\r\n\r\n\r\n            const svgTriangleLeft = BB.createSvg({\r\n                elementType: 'path',\r\n                'vector-effect': 'non-scaling-stroke',\r\n                d: 'M0,0 L 100,0 0,100 z',\r\n                fill: 'rgba(0,0,0,0)',\r\n                class: 'toolspace-svg-triangle-button',\r\n            });\r\n            svgTriangleLeft.onclick = () => {\r\n                p.onLeft();\r\n                svgTriangleLeft.classList.remove('toolspace-svg-triangle-button-hover');\r\n            };\r\n\r\n            const svgTriangleRight = BB.createSvg({\r\n                elementType: 'path',\r\n                'vector-effect': 'non-scaling-stroke',\r\n                d: 'M100,100 L 100,0 0,100 z',\r\n                fill: 'rgba(0,0,0,0)',\r\n                class: 'toolspace-svg-triangle-button',\r\n            });\r\n            svgTriangleRight.onclick = () => {\r\n                p.onRight();\r\n                svgTriangleRight.classList.remove('toolspace-svg-triangle-button-hover');\r\n            };\r\n\r\n            // because :hover causes problems w touch\r\n            const leftPointerListener = new BB.PointerListener({\r\n                target: svgTriangleLeft,\r\n                onEnterLeave: (isOver) => {\r\n                    svgTriangleLeft.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n                },\r\n            });\r\n            const rightPointerListener = new BB.PointerListener({\r\n                target: svgTriangleRight,\r\n                onEnterLeave: (isOver) => {\r\n                    svgTriangleRight.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n                },\r\n            });\r\n\r\n\r\n            svg.append(defs, svgTriangleLeft, svgTriangleRight);\r\n            result.append(svg);\r\n\r\n\r\n            const leftIm = BB.el({\r\n                parent: result,\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundSize: 'contain',\r\n                    width: '20px',\r\n                    height: '20px',\r\n                    position: 'absolute',\r\n                    left: '10px',\r\n                    top: '8px',\r\n                    //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                    pointerEvents: 'none',\r\n                },\r\n            });\r\n            result.append(leftIm);\r\n\r\n\r\n            const rightIm = BB.el({\r\n                parent: result,\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundSize: 'contain',\r\n                    width: '20px',\r\n                    height: '20px',\r\n                    position: 'absolute',\r\n                    right: '10px',\r\n                    bottom: '8px',\r\n                    transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                    pointerEvents: 'none',\r\n                },\r\n            });\r\n\r\n\r\n\r\n\r\n\r\n            const setIsEnabledLeft = (b: boolean) => {\r\n                svgTriangleLeft.classList.toggle('toolspace-row-button-disabled', !b);\r\n                leftIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n            };\r\n\r\n            const setIsEnabledRight = (b: boolean) => {\r\n                svgTriangleRight.classList.toggle('toolspace-row-button-disabled', !b);\r\n                rightIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n            };\r\n\r\n            return {\r\n                el: result,\r\n                setIsEnabledLeft,\r\n                setIsEnabledRight,\r\n                leftPointerListener,\r\n                rightPointerListener,\r\n            };\r\n        };\r\n\r\n        this.toolDropdown = new ToolDropdown({\r\n            onChange: (activeStr) => {\r\n                this.setActive(activeStr, true);\r\n            },\r\n        });\r\n        this.rootEl.append(this.toolDropdown.getElement());\r\n\r\n        this.handButton = createButton({\r\n            onClick: () => {\r\n                this.setActive('hand', true);\r\n            },\r\n            image: toolHandImg,\r\n            contain: true,\r\n            doLighten: true,\r\n        });\r\n        this.handButton.el.classList.add('kl-tool-row-border-right');\r\n        this.handButton.el.title = LANG('tool-hand');\r\n        this.rootEl.append(this.handButton.el);\r\n\r\n        this.zoomInNOutButton = createTriangleButton({\r\n            onLeft: p.onZoomIn,\r\n            onRight: p.onZoomOut,\r\n            leftImage: toolZoomInImg,\r\n            rightImage: toolZoomOutImg,\r\n        });\r\n        this.zoomInNOutButton.el.title = LANG('tool-zoom');\r\n        this.rootEl.append(this.zoomInNOutButton.el);\r\n\r\n        this.zoomInButton = createButton({\r\n            onClick: p.onZoomIn,\r\n            image: toolZoomInImg,\r\n            contain: true,\r\n        });\r\n        this.zoomInButton.el.title = LANG('zoom-in');\r\n        this.rootEl.append(this.zoomInButton.el);\r\n\r\n        this.zoomOutButton = createButton({\r\n            onClick: p.onZoomOut,\r\n            image: toolZoomOutImg,\r\n            contain: true,\r\n        });\r\n        this.zoomOutButton.el.title = LANG('zoom-out');\r\n        this.rootEl.append(this.zoomOutButton.el);\r\n\r\n        this.undoNRedoButton = createTriangleButton({\r\n            onLeft: p.onUndo,\r\n            onRight: p.onRedo,\r\n            leftImage: toolUndoImg,\r\n            rightImage: null,\r\n        });\r\n        this.undoNRedoButton.el.title = LANG('undo') + '/' + LANG('redo');\r\n        this.undoNRedoButton.setIsEnabledLeft(false);\r\n        this.undoNRedoButton.setIsEnabledRight(false);\r\n        this.rootEl.append(this.undoNRedoButton.el);\r\n\r\n        this.undoButton = createButton({\r\n            onClick: p.onUndo,\r\n            image: toolUndoImg,\r\n            contain: true,\r\n        });\r\n        this.undoButton.el.title = LANG('undo');\r\n        this.undoButton.el.classList.add('toolspace-row-button-disabled');\r\n        this.rootEl.append(this.undoButton.el);\r\n\r\n        this.redoButton = createButton({\r\n            onClick: p.onRedo,\r\n            image: toolUndoImg,\r\n            contain: true,\r\n            doMirror: true,\r\n        });\r\n        this.redoButton.el.title = LANG('redo');\r\n        this.redoButton.el.classList.add('toolspace-row-button-disabled');\r\n        this.rootEl.append(this.redoButton.el);\r\n\r\n        this.zoomInButton.el.style.display = 'none';\r\n        this.zoomOutButton.el.style.display = 'none';\r\n        this.undoButton.el.style.display = 'none';\r\n        this.redoButton.el.style.display = 'none';\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsSmall (b: boolean): void {\r\n        BB.css(this.rootEl, {\r\n            height: b ? '36px' : '54px',\r\n        });\r\n\r\n        this.toolDropdown.setIsSmall(b);\r\n        this.handButton.setIsSmall(b);\r\n        this.zoomInButton.setIsSmall(b);\r\n        this.zoomOutButton.setIsSmall(b);\r\n        this.undoButton.setIsSmall(b);\r\n        this.redoButton.setIsSmall(b);\r\n\r\n        if (b) {\r\n            this.zoomInNOutButton.el.style.display = 'none';\r\n            this.undoNRedoButton.el.style.display = 'none';\r\n            this.zoomInButton.el.style.display = 'block';\r\n            this.zoomOutButton.el.style.display = 'block';\r\n            this.undoButton.el.style.display = 'block';\r\n            this.redoButton.el.style.display = 'block';\r\n        } else {\r\n            this.zoomInNOutButton.el.style.display = 'block';\r\n            this.undoNRedoButton.el.style.display = 'block';\r\n            this.zoomInButton.el.style.display = 'none';\r\n            this.zoomOutButton.el.style.display = 'none';\r\n            this.undoButton.el.style.display = 'none';\r\n            this.redoButton.el.style.display = 'none';\r\n        }\r\n\r\n    }\r\n\r\n    setEnableZoomIn (b: boolean): void {\r\n        this.zoomInButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.zoomInNOutButton.setIsEnabledLeft(b);\r\n    }\r\n\r\n    setEnableZoomOut (b: boolean): void {\r\n        this.zoomOutButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.zoomInNOutButton.setIsEnabledRight(b);\r\n    }\r\n\r\n    setEnableUndo (b: boolean): void {\r\n        this.undoButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.undoNRedoButton.setIsEnabledLeft(b);\r\n    }\r\n\r\n    setEnableRedo (b: boolean): void {\r\n        this.redoButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.undoNRedoButton.setIsEnabledRight(b);\r\n    }\r\n\r\n    setActive (activeStr: TToolType, doEmit?: boolean): void {\r\n        if (this.currentActiveStr === activeStr) {\r\n            return;\r\n        }\r\n\r\n        this.currentActiveStr = activeStr;\r\n\r\n        this.toolDropdown.setActive(this.currentActiveStr);\r\n        this.handButton.el.classList.toggle('toolspace-row-button-activated', this.currentActiveStr === 'hand');\r\n\r\n        if (doEmit) {\r\n            this.onActivate(this.currentActiveStr);\r\n        }\r\n    }\r\n\r\n    getActive (): TToolType {\r\n        return this.currentActiveStr;\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"b30IN\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"jYhj7\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"44EC1\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1YnIA\");","import {BB} from '../../../bb/bb';\r\nimport {Select} from './select';\r\nimport {LANG} from '../../../language/language';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n/**\r\n * Ui to select stabilizer level. 4 options. returned as 0-3\r\n */\r\nexport class ToolspaceStabilizerRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly pointerListener: PointerListener;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            smoothing: number; // initial level [0,3]\r\n            onSelect: (level: number) => void; // [0-3], when level changes\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            tagName: 'label',\r\n            className: 'kl-stabilizer',\r\n            content: LANG('stabilizer') + '&nbsp;',\r\n            title: LANG('stabilizer-title'),\r\n        });\r\n\r\n        const strengthSelect = new Select({\r\n            optionArr: [\r\n                ['0', '0'],\r\n                ['1', '1'],\r\n                ['2', '2'],\r\n                ['3', '3'],\r\n                ['4', '4'],\r\n                ['5', '5'],\r\n            ],\r\n            initValue: '' + p.smoothing,\r\n            onChange: function (val) {\r\n                p.onSelect(parseInt(val));\r\n            },\r\n        });\r\n        this.rootEl.append(strengthSelect.getElement());\r\n\r\n        this.pointerListener = new BB.PointerListener({\r\n            target: this.rootEl,\r\n            onWheel: function (e) {\r\n                strengthSelect.setDeltaValue(e.deltaY);\r\n            },\r\n        });\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport invertedBorderImg from '/src/app/img/ui/inverted-border.svg';\r\nimport {IKeyStringOptional} from '../../../bb/bb-types';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n\r\n// type all functions\r\n\r\n\r\ntype TTabInit = {\r\n    id: string; // e.g. 'draw',\r\n    label?: string;\r\n    image?: string; // background image\r\n    title?: string;\r\n    isVisible?: boolean; // default is true\r\n    onOpen: () => void;\r\n    onClose: () => void;\r\n    css?: IKeyStringOptional;\r\n};\r\n\r\ntype TTab = {\r\n    id: string;\r\n    isVisible: boolean;\r\n    onOpen: () => void;\r\n    onClose: () => void;\r\n    update: (activeTab: TTab) => void;\r\n    el: HTMLElement;\r\n    pointerListener: PointerListener;\r\n};\r\n\r\n\r\n/**\r\n * row of tabs. uses css class .tabrow__tab\r\n */\r\nexport class TabRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly tabArr: TTab[];\r\n    private activeTab: TTab;\r\n    private readonly roundRight: HTMLElement;\r\n    private readonly roundLeft: HTMLElement;\r\n    \r\n    \r\n    // update\r\n    update (): void {\r\n        for (let i = 0; i < this.tabArr.length; i++) {\r\n            this.tabArr[i].update(this.activeTab);\r\n        }\r\n    }\r\n    \r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            initialId: string; // e.g. 'draw'\r\n            useAccent?: boolean;\r\n            tabArr: TTabInit[];\r\n            height?: number;\r\n        }\r\n    ) {\r\n        const height = p.height ?? 35;\r\n        this.rootEl = BB.el({\r\n            className: 'tabrow',\r\n            css: {\r\n                height: (height + 1) + 'px',\r\n            },\r\n        });\r\n\r\n        this.tabArr = []; //creates its own internal arr\r\n\r\n        const roundSize = 10;\r\n        this.roundRight = BB.el({\r\n            css: {\r\n                width: roundSize + 'px',\r\n                height: roundSize + 'px',\r\n                backgroundImage: `url('${invertedBorderImg}')`,\r\n                backgroundSize: 'cover',\r\n                position: 'absolute',\r\n                right: -roundSize + 'px',\r\n                bottom: '0',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        this.roundLeft = BB.el({\r\n            css: {\r\n                width: roundSize + 'px',\r\n                height: roundSize + 'px',\r\n                backgroundImage: `url('${invertedBorderImg}')`,\r\n                backgroundSize: 'cover',\r\n                position: 'absolute',\r\n                left: -roundSize + 'px',\r\n                bottom: '0',\r\n                transform: 'scale(-1,1)',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n\r\n        const createTab = (pTabObj: TTabInit, initialId: string, useAccent: boolean): TTab => {\r\n            const isVisible = ('isVisible' in pTabObj && pTabObj.isVisible !== undefined) ? pTabObj.isVisible : true;\r\n            const result: TTab = {\r\n                id: pTabObj.id,\r\n                isVisible: isVisible,\r\n                onOpen: pTabObj.onOpen,\r\n                onClose: pTabObj.onClose,\r\n                update: (openedTabObj: TTab) => {\r\n                    result.el.className = openedTabObj === result ? (useAccent ? 'tabrow__tab tabrow__tab--opened-accented' : 'tabrow__tab tabrow__tab--opened') : 'tabrow__tab';\r\n                    result.el.style.display = result.isVisible ? 'block' : 'none';\r\n                },\r\n                el: BB.el({\r\n                    parent: this.rootEl,\r\n                    content: 'label' in pTabObj ? pTabObj.label : '',\r\n                    title: 'title' in pTabObj ? pTabObj.title : undefined,\r\n                    className: initialId === pTabObj.id ? (useAccent ? 'tabrow__tab tabrow__tab--opened-accented' : 'tabrow__tab tabrow__tab--opened') : 'tabrow__tab',\r\n                    css: {\r\n                        lineHeight: height + 'px',\r\n                        display: isVisible ? 'block' : 'none',\r\n                        zIndex: '0',\r\n                    },\r\n                    onClick: () => {\r\n                        if (this.activeTab === result) {\r\n                            return;\r\n                        }\r\n                        this.open(result.id);\r\n                    },\r\n                }),\r\n                pointerListener: {} as PointerListener,\r\n            };\r\n            if ('image' in pTabObj) {\r\n\r\n                BB.el({\r\n                    tagName: 'span',\r\n                    parent: result.el,\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        backgroundImage: `url(\"${pTabObj.image}\")`,\r\n                        backgroundSize: 'contain',\r\n                        backgroundPosition: 'center',\r\n                        backgroundRepeat: 'no-repeat',\r\n                        display: 'flex',\r\n                        height: (height - 7) + 'px',\r\n                        justifyContent: 'center',\r\n                        margin: '4px auto',\r\n                    },\r\n                });\r\n            }\r\n            if ('css' in pTabObj && pTabObj.css !== undefined) {\r\n                BB.css(result.el, pTabObj.css);\r\n            }\r\n\r\n            result.pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: result.el,\r\n                onEnterLeave: (isOver) => {\r\n                    result.el.classList.toggle('tabrow__tab-hover', isOver);\r\n                },\r\n            });\r\n\r\n            if (initialId === result.id) {\r\n                result.onOpen();\r\n                result.el.append(this.roundRight, this.roundLeft);\r\n            } else {\r\n                result.onClose();\r\n            }\r\n\r\n            return result;\r\n        };\r\n\r\n        let initTabObj = null;\r\n        for (let i = 0; i < p.tabArr.length; i++) {\r\n            const tab = createTab(p.tabArr[i], p.initialId, p.useAccent || false);\r\n            if (tab.id === p.initialId) {\r\n                initTabObj = tab;\r\n            }\r\n            this.tabArr.push(tab);\r\n        }\r\n        if (!initTabObj) {\r\n            throw 'invalid initialId';\r\n        }\r\n        this.activeTab = initTabObj;\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    open (tabId: string): void {\r\n        for (let i = 0; i < this.tabArr.length; i++) {\r\n            if (this.tabArr[i].id === tabId) {\r\n                if (this.activeTab === this.tabArr[i]) { // already open\r\n                    return;\r\n                }\r\n                this.activeTab.onClose();\r\n                this.activeTab = this.tabArr[i];\r\n                this.activeTab.onOpen();\r\n                this.activeTab.el.append(this.roundRight, this.roundLeft);\r\n                this.update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.open - invalid tabId';\r\n    }\r\n\r\n    getOpenedTabId (): string {\r\n        return '' + this.activeTab.id;\r\n    }\r\n\r\n    setIsVisible (tabId: string, isVisible: boolean): void {\r\n        for (let i = 0; i < this.tabArr.length; i++) {\r\n            if (this.tabArr[i].id === tabId) {\r\n                this.tabArr[i].isVisible = isVisible;\r\n                this.update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.setIsVisible - invalid tabId';\r\n    }\r\n\r\n    destroy (): void {\r\n        this.tabArr.forEach(item => {\r\n            BB.destroyEl(item.el);\r\n            item.pointerListener.destroy();\r\n        });\r\n    }\r\n}\r\n\r\n\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6ae9h\");","import {BB} from '../../../bb/bb';\r\nimport angleImg from '/src/app/img/ui/angle.svg';\r\nimport rotateImg from '/src/app/img/ui/edit-rotate.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Ui, when hand tool tab is open.\r\n */\r\nexport class HandUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly onAngleChange: (angleDeg: number, isRelative?: boolean) => void;\r\n    private isVisible: boolean = true;\r\n    private scale: number;\r\n    private angleDeg: number;\r\n    private readonly scaleEl: HTMLElement;\r\n    private readonly angleEl: HTMLElement;\r\n    private readonly angleIm: HTMLImageElement;\r\n\r\n\r\n    private updateUi (): void {\r\n        this.scaleEl.innerHTML = Math.round(this.scale * 100) + '%';\r\n        this.angleEl.innerHTML =  Math.round(this.angleDeg) + '';\r\n\r\n        this.angleIm.style.transform = 'rotate(' + this.angleDeg + 'deg)';\r\n        if (this.angleDeg % 90 === 0) {\r\n            this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)';\r\n        } else {\r\n            this.angleIm.style.boxShadow = '';\r\n        }\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            scale: number; // initial value\r\n            angleDeg: number; // initial value\r\n            onReset: () => void;\r\n            onFit: () => void;\r\n            onAngleChange: (angleDeg: number, isRelative?: boolean) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.scale = p.scale;\r\n        this.angleDeg = p.angleDeg;\r\n        this.onAngleChange = p.onAngleChange;\r\n\r\n        const row1 = BB.el({\r\n            css: {\r\n                marginBottom: '10px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n        const row2 = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        const row3 = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n        this.rootEl.append(row1, row2, row3);\r\n\r\n\r\n        this.scaleEl = BB.el({\r\n            css: {\r\n                width: '55px',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        row1.append(this.scaleEl);\r\n\r\n        this.angleIm = new Image();\r\n        this.angleIm.src = angleImg;\r\n        BB.css(this.angleIm, {\r\n            verticalAlign: 'bottom',\r\n            width: '20px',\r\n            height: '20px',\r\n            marginRight: '5px',\r\n            borderRadius: '10px',\r\n            background: 'rgba(0,0,0,0.2)',\r\n            userSelect: 'none',\r\n        });\r\n        row1.append(this.angleIm);\r\n\r\n        this.angleEl = BB.el({\r\n            parent: row1,\r\n            css: {\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n\r\n        this.updateUi();\r\n\r\n\r\n        const resetButton = BB.el({\r\n            tagName: 'button',\r\n            content: LANG('hand-reset'),\r\n            onClick: p.onReset,\r\n        });\r\n        BB.makeUnfocusable(resetButton);\r\n\r\n        const fitButton = BB.el({\r\n            tagName: 'button',\r\n            content: LANG('hand-fit'),\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: p.onFit,\r\n        });\r\n        BB.makeUnfocusable(fitButton);\r\n        row2.append(resetButton, fitButton);\r\n\r\n        const leftRotateButton = BB.el({\r\n            tagName: 'button',\r\n            content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\r\n            onClick: function () {\r\n                p.onAngleChange(-15, true);\r\n            },\r\n        });\r\n        BB.makeUnfocusable(leftRotateButton);\r\n\r\n        const resetAngleButton = BB.el({\r\n            tagName: 'button',\r\n            content: '0',\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: function () {\r\n                p.onAngleChange(0);\r\n            },\r\n        });\r\n        BB.makeUnfocusable(resetAngleButton);\r\n\r\n        const rightRotateButton = BB.el({\r\n            tagName: 'button',\r\n            content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\"/>',\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: function () {\r\n                p.onAngleChange(15, true);\r\n            },\r\n        });\r\n        BB.makeUnfocusable(rightRotateButton);\r\n        row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.updateUi();\r\n        }\r\n    }\r\n\r\n    update (pScale: number, pAngleDeg: number): void {\r\n        this.scale = pScale;\r\n        this.angleDeg = pAngleDeg;\r\n        if (this.isVisible) {\r\n            this.updateUi();\r\n        }\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"8l03e\");","import {BB} from '../../../bb/bb';\r\nimport {KlSlider} from '../components/kl-slider';\r\nimport {Select} from '../components/select';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {LANG} from '../../../language/language';\r\nimport {TFillSampling} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n/**\r\n * Paint Bucket tab contents (color slider, opacity slider, etc)\r\n */\r\nexport class FillUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private isVisible: boolean;\r\n    private readonly colorDiv: HTMLElement;\r\n    private readonly colorSlider: KlColorSlider;\r\n    private readonly toleranceSlider: KlSlider;\r\n    private readonly opacitySlider: KlSlider;\r\n    private readonly modeSelect: Select<string>;\r\n    private readonly growSelect: Select<string>;\r\n    private isContiguous: boolean;\r\n    private readonly eraserToggle: Checkbox;\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.isVisible = true;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        this.colorSlider = p.colorSlider;\r\n\r\n        this.opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: 1,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n        });\r\n        this.rootEl.append(this.opacitySlider.getElement());\r\n\r\n        this.toleranceSlider = new KlSlider({\r\n            label: LANG('bucket-tolerance'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 0,\r\n            max: 255,\r\n            value: 20 * (255 / 100),\r\n            toValue: (displayValue) => displayValue * (255 / 100),\r\n            toDisplayValue: (value) => value / (255 / 100),\r\n        });\r\n        BB.css(this.toleranceSlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(this.toleranceSlider.getElement());\r\n\r\n        const selectRow = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const modeWrapper = BB.el({\r\n            content: LANG('bucket-sample') + '&nbsp;',\r\n            title: LANG('bucket-sample-title'),\r\n            css: {\r\n                fontSize: '15px',\r\n            },\r\n        });\r\n        this.modeSelect = new Select({\r\n            optionArr: [\r\n                ['all', LANG('bucket-sample-all')],\r\n                ['current', LANG('bucket-sample-active')],\r\n                ['above', LANG('bucket-sample-above')],\r\n            ],\r\n            initValue: 'all',\r\n        });\r\n        const modePointerListener = new BB.PointerListener({\r\n            target: this.modeSelect.getElement(),\r\n            onWheel: (e) => {\r\n                this.modeSelect.setDeltaValue(e.deltaY);\r\n            },\r\n        });\r\n        modeWrapper.append(this.modeSelect.getElement());\r\n        selectRow.append(modeWrapper);\r\n\r\n        const growWrapper = BB.el({\r\n            content: LANG('bucket-grow') + '&nbsp;',\r\n            title: LANG('bucket-grow-title'),\r\n            css: {\r\n                fontSize: '15px',\r\n                marginLeft: '10px',\r\n            },\r\n        });\r\n        this.growSelect = new Select({\r\n            optionArr: [\r\n                ['0', '0'],\r\n                ['1', '1'],\r\n                ['2', '2'],\r\n                ['3', '3'],\r\n                ['4', '4'],\r\n                ['5', '5'],\r\n                ['6', '6'],\r\n                ['7', '7'],\r\n            ],\r\n            initValue: '0',\r\n        });\r\n        const growPointerListener = new BB.PointerListener({\r\n            target: this.growSelect.getElement(),\r\n            onWheel: (e) => {\r\n                this.growSelect.setDeltaValue(e.deltaY);\r\n            },\r\n        });\r\n        growWrapper.append(this.growSelect.getElement());\r\n        selectRow.append(growWrapper);\r\n\r\n\r\n        this.isContiguous = true;\r\n        const contiguousToggle = new Checkbox({\r\n            init: true,\r\n            label: LANG('bucket-contiguous'),\r\n            title: LANG('bucket-contiguous-title'),\r\n            callback: (b) => {\r\n                this.isContiguous = b;\r\n            },\r\n            css: {\r\n                paddingRight: '5px',\r\n                display: 'inline-block',\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        this.eraserToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('eraser'),\r\n            css: {\r\n\r\n                paddingRight: '5px',\r\n                display: 'inline-block',\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        this.rootEl.append(BB.el({\r\n            content: [\r\n                contiguousToggle.getElement(),\r\n                this.eraserToggle.getElement(),\r\n            ],\r\n            css: {\r\n                display: 'flex',\r\n                marginTop: '10px',\r\n            },\r\n        }));\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * [0, 1]\r\n     */\r\n    getTolerance (): number {\r\n        return this.toleranceSlider.getValue();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacitySlider.getValue();\r\n    }\r\n\r\n    getSample (): TFillSampling {\r\n        return this.modeSelect.getValue() as TFillSampling;\r\n    }\r\n\r\n    getGrow (): number {\r\n        return parseInt(this.growSelect.getValue(), 10);\r\n    }\r\n\r\n    getContiguous (): boolean {\r\n        return this.isContiguous;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.eraserToggle.getValue();\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n/**\r\n * Text Tool tab contents (color slider)\r\n */\r\nexport class TextUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly colorDiv: HTMLElement;\r\n    private isVisible: boolean = true;\r\n    private readonly colorSlider: KlColorSlider;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.colorSlider = p.colorSlider;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        const hint = BB.el({\r\n            parent: this.rootEl,\r\n            content: LANG('text-instruction'),\r\n        });\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\r\n        }\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {Options} from '../components/options';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {KlSlider} from '../components/kl-slider';\r\nimport {LANG} from '../../../language/language';\r\nimport {TShapeToolMode, TShapeToolType} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n/**\r\n * Shape Tool tab contents\r\n */\r\nexport class ShapeUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private isVisible: boolean;\r\n    private readonly colorDiv: HTMLElement;\r\n    private readonly colorSlider: KlColorSlider;\r\n    private shape: TShapeToolType = 'rect';\r\n    private mode: TShapeToolMode = 'stroke';\r\n    private readonly eraserToggle: Checkbox;\r\n    private readonly opacitySlider: KlSlider;\r\n    private readonly lineWidthSlider: KlSlider;\r\n    private readonly outwardsToggle: Checkbox;\r\n    private readonly fixedToggle: Checkbox;\r\n    private readonly snapToggle:Checkbox;\r\n    private readonly lockAlphaToggle: Checkbox;\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.isVisible = true;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        this.colorSlider = p.colorSlider;\r\n\r\n        const previewSize = 35;\r\n        const previewPadding = 8;\r\n\r\n\r\n        const rectStrokeSvgRect = BB.createSvg({\r\n            elementType: 'rect',\r\n            x: '' + previewPadding,\r\n            width: '' + (previewSize - previewPadding * 2),\r\n        });\r\n        const rectStrokeSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        rectStrokeSvg.classList.add('dark-invert');\r\n        rectStrokeSvg.append(rectStrokeSvgRect);\r\n        BB.css(rectStrokeSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n        const rectFilledSvgRect = BB.createSvg({\r\n            elementType: 'rect',\r\n            x: '' + previewPadding,\r\n            width: '' + (previewSize - previewPadding * 2),\r\n        });\r\n        const rectFilledSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        rectFilledSvg.classList.add('dark-invert');\r\n        rectFilledSvg.append(rectFilledSvgRect);\r\n        BB.css(rectFilledSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n\r\n        const ellipseStrokeSvgEllipse = BB.createSvg({\r\n            elementType: 'ellipse',\r\n            cx: '' + (previewSize / 2),\r\n            cy: '' + (previewSize / 2),\r\n            rx: '' + (previewSize / 2 - previewPadding),\r\n        });\r\n        const ellipseStrokeSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        ellipseStrokeSvg.classList.add('dark-invert');\r\n        ellipseStrokeSvg.append(ellipseStrokeSvgEllipse);\r\n        BB.css(ellipseStrokeSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n        const ellipseFilledSvgEllipse = BB.createSvg({\r\n            elementType: 'ellipse',\r\n            cx: '' + (previewSize / 2),\r\n            cy: '' + (previewSize / 2),\r\n            rx: '' + (previewSize / 2 - previewPadding),\r\n        });\r\n        const ellipseFilledSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        ellipseFilledSvg.classList.add('dark-invert');\r\n        ellipseFilledSvg.append(ellipseFilledSvgEllipse);\r\n        BB.css(ellipseFilledSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n\r\n        const lineSvgLine = BB.createSvg({\r\n            elementType: 'line',\r\n            x1: '' + previewPadding,\r\n            x2: '' + (previewSize - previewPadding),\r\n        });\r\n        const lineSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        lineSvg.classList.add('dark-invert');\r\n        lineSvg.append(lineSvgLine);\r\n        BB.css(lineSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n        const updatePreviews = () => {\r\n            const strokeWidth = BB.clamp(Math.round(this.lineWidthSlider.getValue() / 10), 1, 10) + 'px';\r\n\r\n            const squish = 1.35;\r\n\r\n            BB.css(rectStrokeSvgRect, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n            BB.css(rectFilledSvgRect, { fill: 'black', stroke: 'none' });\r\n\r\n            BB.css(ellipseStrokeSvgEllipse, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n            BB.css(ellipseFilledSvgEllipse, { fill: 'black', stroke: 'none' });\r\n\r\n            BB.css(\r\n                lineSvgLine,\r\n                { fill: 'none', stroke: 'black', strokeWidth: strokeWidth }\r\n            );\r\n\r\n            if (this.fixedToggle.getValue()) {\r\n                rectStrokeSvgRect.setAttribute('y', '' + previewPadding);\r\n                rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n                rectFilledSvgRect.setAttribute('y', '' + previewPadding);\r\n                rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n\r\n                ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n                ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n            } else {\r\n                rectStrokeSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n                rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n                rectFilledSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n                rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n\r\n                ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n                ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n            }\r\n\r\n            if (this.snapToggle.getValue()) {\r\n                lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding));\r\n                lineSvgLine.setAttribute('y2', '' + previewPadding);\r\n            } else {\r\n                lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding * squish));\r\n                lineSvgLine.setAttribute('y2', '' + (previewPadding * squish));\r\n            }\r\n        };\r\n\r\n        const row1 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'start',\r\n            },\r\n        });\r\n\r\n        const shapeOptions = new Options({\r\n            optionArr: [\r\n                {\r\n                    id: 'rect-stroke',\r\n                    label: rectStrokeSvg,\r\n                    title: LANG('shape-rect') + ' ' + LANG('shape-stroke'),\r\n                },\r\n                {\r\n                    id: 'ellipse-stroke',\r\n                    label: ellipseStrokeSvg,\r\n                    title: LANG('shape-ellipse') + ' ' + LANG('shape-stroke'),\r\n                },\r\n                {\r\n                    id: 'line',\r\n                    label: lineSvg,\r\n                    title: LANG('shape-line'),\r\n                },\r\n                {\r\n                    id: 'rect-fill',\r\n                    label: rectFilledSvg,\r\n                    title: LANG('shape-rect') + ' ' + LANG('shape-fill'),\r\n                },\r\n                {\r\n                    id: 'ellipse-fill',\r\n                    label: ellipseFilledSvg,\r\n                    title: LANG('shape-ellipse') + ' ' + LANG('shape-fill'),\r\n                },\r\n            ],\r\n            initId: this.shape + ' ' + this.mode,\r\n            onChange: (id) => {\r\n                const split = id.split('-');\r\n                this.shape = split[0] as TShapeToolType;\r\n                this.mode = split[1] as TShapeToolMode;\r\n\r\n                BB.css(this.fixedToggle.getElement(), {\r\n                    display: this.shape === 'line' ? 'none' : '',\r\n                });\r\n                BB.css(this.snapToggle.getElement(), {\r\n                    display: this.shape === 'line' ? '' : 'none',\r\n                });\r\n                BB.css(this.lineWidthSlider.getElement(), {\r\n                    display: (this.shape !== 'line' && this.mode === 'fill') ? 'none' : '',\r\n                });\r\n            },\r\n            changeOnInit: true,\r\n        });\r\n        shapeOptions.getElement().style.width = '120px';\r\n        row1.append(shapeOptions.getElement());\r\n\r\n        this.eraserToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('eraser'),\r\n            callback: () => {\r\n                updatePreviews();\r\n            },\r\n        });\r\n\r\n        this.lockAlphaToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('lock-alpha'),\r\n            title: LANG('lock-alpha-title'),\r\n            doHighlight: true,\r\n        });\r\n        this.lockAlphaToggle.getElement().style.marginTop = '10px';\r\n\r\n        row1.append(BB.el({\r\n            content: [\r\n                this.eraserToggle.getElement(),\r\n                this.lockAlphaToggle.getElement(),\r\n            ],\r\n        }));\r\n\r\n        this.lineWidthSlider = new KlSlider({\r\n            label: LANG('shape-line-width'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1,\r\n            max: 200,\r\n            value: 4,\r\n            curve: 'quadratic',\r\n            onChange: () => {\r\n                updatePreviews();\r\n            },\r\n        });\r\n        BB.css(this.lineWidthSlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(this.lineWidthSlider.getElement());\r\n\r\n        this.opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: 1,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n        });\r\n        BB.css(this.opacitySlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(this.opacitySlider.getElement());\r\n\r\n        const row2 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        this.outwardsToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('shape-outwards'),\r\n            css: {\r\n                width: '50%',\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n        row2.append(this.outwardsToggle.getElement());\r\n\r\n        this.fixedToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('shape-fixed'),\r\n            callback: () => {\r\n                updatePreviews();\r\n            },\r\n            css: {\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n        row2.append(this.fixedToggle.getElement());\r\n\r\n        this.snapToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('angle-snap'),\r\n            title: LANG('angle-snap-title'),\r\n            callback: () => {\r\n                updatePreviews();\r\n            },\r\n            css: {\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n        row2.append(this.snapToggle.getElement());\r\n\r\n\r\n        updatePreviews();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement());\r\n            this.colorDiv.append(this.colorSlider.getOutputElement());\r\n            //update();\r\n        }\r\n    }\r\n\r\n    getShape (): TShapeToolType {\r\n        return this.shape;\r\n    }\r\n\r\n    getMode (): TShapeToolMode {\r\n        return this.mode;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.eraserToggle.getValue();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacitySlider.getValue();\r\n    }\r\n\r\n    getLineWidth (): number {\r\n        return this.lineWidthSlider.getValue();\r\n    }\r\n\r\n    getIsOutwards (): boolean {\r\n        return this.outwardsToggle.getValue();\r\n    }\r\n\r\n    getIsFixed (): boolean {\r\n        return this.fixedToggle.getValue();\r\n    }\r\n\r\n    getIsSnap (): boolean {\r\n        return this.snapToggle.getValue();\r\n    }\r\n\r\n    getDoLockAlpha (): boolean {\r\n        return this.lockAlphaToggle.getValue();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../components/select';\r\nimport {ColorOptions} from '../components/color-options';\r\nimport {showModal} from './base/showModal';\r\nimport {LANG} from '../../../language/language';\r\nimport {IRGB, IRGBA} from '../../kl-types';\r\nimport {ISize2D} from '../../../bb/bb-types';\r\nimport {table} from '../components/table';\r\nimport {ERASE_COLOR} from '../../brushes/erase-color';\r\nimport {theme} from '../../../theme/theme';\r\n\r\nexport function newImageDialog (\r\n    p: {\r\n        currentColor: IRGB; // current color\r\n        secondaryColor: IRGB;\r\n        maxCanvasSize: number;\r\n        canvasWidth: number; // current canvas size\r\n        canvasHeight: number; // current canvas size\r\n        workspaceWidth: number;\r\n        workspaceHeight: number;\r\n        onConfirm: (width: number, height: number, color: IRGBA) => void;\r\n        onCancel: () => void;\r\n    }\r\n): void {\r\n\r\n    const currentColor = p.currentColor;\r\n    const secondaryColor = p.secondaryColor;\r\n    const maxCanvasSize = p.maxCanvasSize;\r\n    const canvasWidth = p.canvasWidth;\r\n    const canvasHeight = p.canvasHeight;\r\n    const workspaceWidth = p.workspaceWidth;\r\n    const workspaceHeight = p.workspaceHeight;\r\n    const onConfirm = p.onConfirm;\r\n    const onCancel = p.onCancel;\r\n\r\n    function createRatioSize (ratioX: number, ratioY: number, width: number, height: number, padding: number): ISize2D {\r\n        return BB.fitInto(\r\n            ratioX,\r\n            ratioY,\r\n            Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding),\r\n            1\r\n        );\r\n    }\r\n\r\n    const newImDiv = BB.el();\r\n    const widthInput = BB.el({tagName: 'input'});\r\n    const unitStyle = {\r\n        color: '#888',\r\n        fontSize: '12px',\r\n        marginLeft: '5px',\r\n    };\r\n    const widthUnit = BB.el({\r\n        textContent: LANG('new-px'),\r\n        css: unitStyle,\r\n    });\r\n    const heightInput = BB.el({tagName: 'input'});\r\n    const heightUnit = BB.el({\r\n        textContent: LANG('new-px'),\r\n        css: unitStyle,\r\n    });\r\n\r\n    widthInput.setAttribute('data-ignore-focus', 'true');\r\n    heightInput.setAttribute('data-ignore-focus', 'true');\r\n\r\n    widthInput.type = 'number';\r\n    widthInput.min = '1';\r\n    widthInput.max = '' + maxCanvasSize;\r\n    BB.css(widthInput, {\r\n        width: '70px',\r\n    });\r\n\r\n    heightInput.type = 'number';\r\n    heightInput.min = '1';\r\n    heightInput.max = '' + maxCanvasSize;\r\n    heightInput.style.width = '70px';\r\n    widthInput.value = '' + canvasWidth;\r\n    heightInput.value = '' + canvasHeight;\r\n    widthInput.onclick = (): void => {\r\n        widthInput.focus();\r\n        updateRatio();\r\n    };\r\n    heightInput.onclick = (): void => {\r\n        heightInput.focus();\r\n        updateRatio();\r\n    };\r\n\r\n\r\n    const sizeTable = table([\r\n        [\r\n            LANG('width') + ':&nbsp;',\r\n            widthInput,\r\n            widthUnit,\r\n        ],\r\n        [\r\n            BB.el({css: {height: '5px'}}),\r\n            '',\r\n            '',\r\n        ],\r\n        [\r\n            LANG('height') + ':&nbsp;',\r\n            heightInput,\r\n            heightUnit,\r\n        ],\r\n    ]);\r\n    BB.css(sizeTable, {\r\n        marginBottom: '10px',\r\n    });\r\n\r\n\r\n    const ratioWrapper = BB.el({\r\n        css: {\r\n            marginTop: '5px',\r\n            color: '#888',\r\n        },\r\n    });\r\n\r\n    const templateWrapper = BB.el();\r\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\r\n    const presetFitBtn = BB.el({tagName: 'button'});\r\n    templateWrapper.style.marginBottom = '10px';\r\n    const presetCurrentBtn = BB.el({tagName: 'button'});\r\n    const presetSquareBtn = BB.el({tagName: 'button'});\r\n    const presetLandscapeBtn = BB.el({tagName: 'button'});\r\n    const presetPortraitBtn = BB.el({tagName: 'button'});\r\n    const presetOversizeBtn = BB.el({tagName: 'button'});\r\n\r\n    presetCurrentBtn.textContent = LANG('new-current');\r\n    presetFitBtn.textContent = LANG('new-fit');\r\n    presetOversizeBtn.textContent = LANG('new-oversize');\r\n    presetLandscapeBtn.textContent = LANG('new-landscape');\r\n    presetPortraitBtn.textContent = LANG('new-portrait');\r\n    presetSquareBtn.textContent = LANG('new-square');\r\n\r\n    presetCurrentBtn.style.marginRight = '5px';\r\n    presetFitBtn.style.marginRight = '5px';\r\n    presetOversizeBtn.style.marginRight = '5px';\r\n    presetLandscapeBtn.style.marginTop = '5px';\r\n    presetLandscapeBtn.style.marginRight = '5px';\r\n    presetPortraitBtn.style.marginTop = '5px';\r\n    presetPortraitBtn.style.marginRight = '5px';\r\n\r\n    templateWrapper.append(\r\n        presetCurrentBtn,\r\n        presetFitBtn,\r\n        presetOversizeBtn,\r\n        presetSquareBtn,\r\n        presetLandscapeBtn,\r\n        presetPortraitBtn\r\n    );\r\n\r\n    const templatePadding = 0;\r\n\r\n    presetCurrentBtn.onclick = function (): void {\r\n        widthInput.value = '' + canvasWidth;\r\n        heightInput.value = '' + canvasHeight;\r\n        updateRatio();\r\n    };\r\n    presetFitBtn.onclick = function (): void {\r\n        widthInput.value = '' + workspaceWidth;\r\n        heightInput.value = '' + workspaceHeight;\r\n        updateRatio();\r\n    };\r\n    presetOversizeBtn.onclick = function (): void {\r\n        widthInput.value = '' + (workspaceWidth + 500);\r\n        heightInput.value = '' + (workspaceHeight + 500);\r\n        updateRatio();\r\n    };\r\n    presetSquareBtn.onclick = function (): void {\r\n        const sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetLandscapeBtn.onclick = function (): void {\r\n        const sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetPortraitBtn.onclick = function (): void {\r\n        const sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n\r\n    const select = new Select({\r\n        isFocusable: true,\r\n        optionArr: [\r\n            ['screen', LANG('new-screen')],\r\n            ['16 9', LANG('new-video') + ' 16:9'],\r\n            ['3 2', '3:2'],\r\n            ['5 3', '5:3'],\r\n            ['2 1', '2:1'],\r\n            ['paper', LANG('new-din-paper') + ' 2:1'],\r\n            ['9 16', '9:16'],\r\n            ['2 3', '2:3'],\r\n            ['3 5', '3:5'],\r\n            ['1 2', '1:2'],\r\n            ['1 1.4142135623730951', '1:2'],\r\n        ],\r\n        onChange: function (val): void {\r\n            if (val === 'screen') {\r\n                widthInput.value = '' + window.screen.width;\r\n                heightInput.value = '' + window.screen.height;\r\n            } else if (val === 'paper') {\r\n                const sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            } else {\r\n                const split = val.split(' ');\r\n                const sizeObj = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            }\r\n            updateRatio();\r\n            select.setValue(undefined);\r\n        },\r\n    });\r\n    setTimeout(() => {\r\n        // safari: not empty without also setting it to null via timeout\r\n        select.setValue(undefined);\r\n    }, 0);\r\n    BB.css(select.getElement(), {\r\n        width: '80px',\r\n    });\r\n    templateWrapper.append(select.getElement());\r\n\r\n\r\n\r\n    let backgroundRGBA = {r: 255, g: 255, b: 255, a: 1};\r\n\r\n    const colorOptionsArr = [\r\n        {r: 255, g: 255, b: 255, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 0},\r\n        {\r\n            r: currentColor.r,\r\n            g: currentColor.g,\r\n            b: currentColor.b,\r\n            a: 1,\r\n        },\r\n        {\r\n            r: secondaryColor.r,\r\n            g: secondaryColor.g,\r\n            b: secondaryColor.b,\r\n            a: 1,\r\n        },\r\n    ];\r\n    let initColorIndex = 0;\r\n    if (theme.isDark()) {\r\n        colorOptionsArr.forEach((item, index) => {\r\n            if (item.r === ERASE_COLOR && item.g === ERASE_COLOR && item.b === ERASE_COLOR) {\r\n                initColorIndex = index;\r\n                backgroundRGBA = item;\r\n            }\r\n        });\r\n    }\r\n\r\n    const colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        initialIndex: initColorIndex,\r\n        onChange: function (rgbaObj): void {\r\n            backgroundRGBA = rgbaObj!;\r\n            preview.style.backgroundColor = 'rgba(' + rgbaObj!.r + ',' + rgbaObj!.g + ',' + rgbaObj!.b + ', ' + rgbaObj!.a + ')';\r\n        },\r\n    });\r\n\r\n    const previewWrapper = BB.el({\r\n        className: 'kl-transparent-preview',\r\n        css: {\r\n            boxSizing: 'border-box',\r\n            width: '340px',\r\n            height: '140px',\r\n            display: 'table',\r\n            padding: '10px',\r\n            marginTop: '10px',\r\n            marginLeft: '-20px',\r\n        },\r\n    });\r\n    const preview = BB.el({\r\n        className: 'kl-transparent-preview__canvas',\r\n        css: {\r\n            width: 200 + 'px',\r\n            height: 100 + 'px',\r\n            backgroundColor: 'rgba(' + backgroundRGBA.r + ',' + backgroundRGBA.g + ',' + backgroundRGBA.b + ', ' + backgroundRGBA.a + ')',\r\n            marginLeft: 'auto',\r\n            marginRight: 'auto',\r\n            color: '#aaa',\r\n            fontSize: '16px',\r\n            fontWeight: 'bold',\r\n            textAlign: 'center',\r\n            verticalAlign: 'center',\r\n            display: 'table',\r\n            overflow: 'hidden',\r\n        },\r\n    });\r\n    BB.el({\r\n        parent: previewWrapper,\r\n        content: preview,\r\n        css: {\r\n            display: 'table-cell',\r\n            verticalAlign: 'middle',\r\n        },\r\n    });\r\n    BB.el({\r\n        parent: preview,\r\n        css: {\r\n            display: 'table-cell',\r\n            verticalAlign: 'middle',\r\n        },\r\n    });\r\n\r\n    function updateRatio (): void {\r\n        widthInput.value = '' + Math.min(maxCanvasSize, parseInt(widthInput.value));\r\n        heightInput.value = '' + Math.min(maxCanvasSize, parseInt(heightInput.value));\r\n\r\n        function hcf (u: number, v: number): number {\r\n            let U = u, V = v;\r\n            // eslint-disable-next-line no-constant-condition\r\n            while (true) {\r\n                if (!(U %= V)) {\r\n                    return V;\r\n                }\r\n                if (!(V %= U)) {\r\n                    return U;\r\n                }\r\n            }\r\n        }\r\n\r\n        let w = parseInt(widthInput.value);\r\n        let h = parseInt(heightInput.value);\r\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\r\n            if (w > maxCanvasSize) {\r\n                w = maxCanvasSize;\r\n            } else if (h > maxCanvasSize) {\r\n                h = maxCanvasSize;\r\n            }\r\n\r\n            widthInput.value = '' + w;\r\n            heightInput.value = '' + h;\r\n        }\r\n\r\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\r\n        const commonRatios = [\r\n            [1, 2], [2, 1],\r\n            [2, 3], [3, 2],\r\n            [3, 4], [4, 3],\r\n            [4, 5], [5, 4],\r\n            [16, 9], [9, 16],\r\n            [3, 2], [2, 3],\r\n            [5, 3], [3, 5],\r\n            [2, 1], [1, 2],\r\n            [1.414, 1], [1, 1.414],\r\n        ];\r\n        const reducedArr = BB.reduce(w, h);\r\n        let closestRatio = commonRatios[0];\r\n        let closestDistance = Math.abs(commonRatios[0][0] / commonRatios[0][1] - reducedArr[0] / reducedArr[1]);\r\n        for (let i = 0; i < commonRatios.length; i++) {\r\n            if (Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\r\n                closestRatio = commonRatios[i];\r\n                closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\r\n            }\r\n        }\r\n        //display ratio\r\n        if (closestDistance > 0 && closestDistance < 0.005) {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ~' + closestRatio[0] + ':' + closestRatio[1];\r\n        } else {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ' + reducedArr[0] + ':' + reducedArr[1];\r\n        }\r\n\r\n        const realw = w;\r\n        const T = hcf(w, h);\r\n        w /= T;\r\n        h /= T;\r\n        w *= 260;\r\n        h *= 260;\r\n        if (w > 260) {\r\n            h = 260 / w * h;\r\n            w = 260;\r\n        }\r\n        if (h > 100) {\r\n            w = 100 / h * w;\r\n            h = 100;\r\n\r\n        }\r\n\r\n        preview.style.width = w + 'px';\r\n        preview.style.height = h + 'px';\r\n        BB.createCheckerDataUrl(parseInt('' + (30 * (w / realw))), function (url) {\r\n            previewWrapper.style.background = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n    }\r\n    theme.addIsDarkListener(updateRatio);\r\n\r\n    widthInput.onchange = (): void => {\r\n        if (widthInput.value === '' || parseInt(widthInput.value) < 0) {\r\n            widthInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    widthInput.onkeyup = (): void => {\r\n        updateRatio();\r\n    };\r\n    heightInput.onchange = (): void => {\r\n        if (heightInput.value === '' || parseFloat(heightInput.value) < 0) {\r\n            heightInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    heightInput.onkeyup = (): void => {\r\n        updateRatio();\r\n    };\r\n    updateRatio();\r\n\r\n    newImDiv.append(templateWrapper);\r\n    const secondRow = BB.el({\r\n        parent: newImDiv,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'flex-end',\r\n        },\r\n    });\r\n    const secondRowLeft = BB.el({\r\n        parent: secondRow,\r\n    });\r\n    secondRowLeft.append(sizeTable, ratioWrapper);\r\n    secondRow.append(colorOptions.getElement());\r\n\r\n    newImDiv.append(previewWrapper);\r\n\r\n    showModal({\r\n        target: document.body,\r\n        message: `<b>${LANG('new-title')}</b>`,\r\n        div: newImDiv,\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (result) {\r\n            BB.unsetEventHandler(widthInput, 'onclick', 'onchange', 'onkeyup');\r\n            BB.unsetEventHandler(widthInput, 'onclick', 'onchange', 'onkeyup');\r\n\r\n            BB.unsetEventHandler(presetCurrentBtn, 'onclick');\r\n            BB.unsetEventHandler(presetFitBtn, 'onclick');\r\n            BB.unsetEventHandler(presetOversizeBtn, 'onclick');\r\n            BB.unsetEventHandler(presetSquareBtn, 'onclick');\r\n            BB.unsetEventHandler(presetLandscapeBtn, 'onclick');\r\n            BB.unsetEventHandler(presetPortraitBtn, 'onclick');\r\n\r\n            select.destroy();\r\n            colorOptions.destroy();\r\n            theme.removeIsDarkListener(updateRatio);\r\n\r\n            if (\r\n                result === 'Cancel'\r\n                || parseInt(widthInput.value) <= 0\r\n                || parseInt(heightInput.value) <= 0\r\n                || isNaN(parseInt(widthInput.value))\r\n                || isNaN(parseInt(heightInput.value))\r\n            ) {\r\n                onCancel();\r\n                return;\r\n            }\r\n            onConfirm(\r\n                parseInt(widthInput.value),\r\n                parseInt(heightInput.value),\r\n                backgroundRGBA\r\n            );\r\n        },\r\n        clickOnEnter: 'Ok',\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nexport function table (\r\n    data: (HTMLElement | string)[][],\r\n    cellProps?: Record<string, {rowspan: number}>, // {'0.2': {...}} -> row 1, col 3\r\n): HTMLElement {\r\n    const result = BB.el({\r\n        tagName: 'table',\r\n        className: 'kl-table',\r\n    });\r\n    data.forEach((row, rowIndex) => {\r\n        const rowEl = BB.el({\r\n            tagName: 'tr',\r\n        });\r\n        rowEl.append(...row.map((el, colIndex) => {\r\n            const cellEl = BB.el({\r\n                tagName: 'td',\r\n                content: el,\r\n            });\r\n\r\n            const key = rowIndex + '.' + colIndex;\r\n            if (cellProps !== undefined && key in cellProps) {\r\n                cellEl.rowSpan = cellProps[key].rowspan;\r\n            }\r\n\r\n            return cellEl;\r\n        }));\r\n        result.append(rowEl);\r\n    });\r\n    return result;\r\n}","import {BB} from '../../../bb/bb';\r\nimport collapseImg from '/src/app/img/ui/ui-collapse.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {TUiLayout} from '../../kl-types';\r\n\r\n/**\r\n * button that allows to collapse toolspace (for mobile)\r\n */\r\nexport class ToolspaceCollapser {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private directionStr: TUiLayout;\r\n    private readonly icon: HTMLElement;\r\n    private stateIsOpen: boolean;\r\n\r\n\r\n    private update (): void {\r\n        if (this.directionStr === 'left') {\r\n            this.icon.style.transform = this.stateIsOpen ? 'rotate(180deg)' : '';\r\n        } else {\r\n            this.icon.style.transform = this.stateIsOpen ? '' : 'rotate(180deg)';\r\n        }\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onChange: () => void;\r\n        }\r\n    ) {\r\n        this.stateIsOpen = true;\r\n        this.directionStr = 'right';\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-toolspace-toggle',\r\n            css: {\r\n                width: '36px',\r\n                height: '36px',\r\n                background: 'rgba(100, 100, 100, 0.9)',\r\n                color: '#fff',\r\n                position: 'absolute',\r\n                top: '0',\r\n                textAlign: 'center',\r\n                lineHeight: '36px',\r\n                cursor: 'pointer',\r\n                userSelect: 'none',\r\n                padding: '6px',\r\n                boxSizing: 'border-box',\r\n            },\r\n            title: LANG('toggle-show-tools'),\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                this.stateIsOpen = !this.stateIsOpen;\r\n                this.update();\r\n                p.onChange();\r\n            },\r\n        });\r\n\r\n        this.icon = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                backgroundImage: `url(${collapseImg})`,\r\n                width: '100%',\r\n                height: '100%',\r\n                backgroundSize: 'contain',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    isOpen (): boolean {\r\n        return this.stateIsOpen;\r\n    }\r\n\r\n    setDirection (dirStr: TUiLayout): void {\r\n        this.directionStr = dirStr;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"8K12o\");","import {BB} from '../../../../bb/bb';\r\nimport { TRenderTextParam} from '../../../image-operations/render-text';\r\nimport {showModal} from '../base/showModal';\r\nimport {IRGB} from '../../../kl-types';\r\nimport {KlCanvas} from '../../../canvas/kl-canvas';\r\nimport {LANG} from '../../../../language/language';\r\nimport {TextToolFillUI} from './text-tool-fill-ui';\r\nimport {TextToolFontUI} from './text-tool-font-ui';\r\nimport {TextToolStrokeUI} from './text-tool-stroke-ui';\r\nimport {TextToolTextUI} from './text-tool-text-ui';\r\nimport {TextToolViewportUI} from './text-tool-viewport-ui';\r\nimport * as classes from './text-tool-dialog.module.scss';\r\nimport {c} from '../../../../bb/base/c';\r\nimport {css} from '@emotion/css';\r\nimport {TabRow} from '../../components/tab-row';\r\n\r\nexport function textToolDialog (\r\n    p: {\r\n        klCanvas: KlCanvas;\r\n        layerIndex: number;\r\n        primaryColor: IRGB;\r\n        secondaryColor: IRGB;\r\n\r\n        text: TRenderTextParam;\r\n        onConfirm: (confirmP: TRenderTextParam) => void;\r\n\r\n    }\r\n): void {\r\n    const rootEl = BB.el({});\r\n    let text = BB.copyObj(p.text);\r\n\r\n    const viewportWrapper = BB.el({\r\n        className: classes.viewportWrapper,\r\n    });\r\n\r\n    const viewportUI = new TextToolViewportUI({\r\n        text: text,\r\n        klCanvas: p.klCanvas,\r\n        layerIndex: p.layerIndex,\r\n        onDragEnd: () => tabs.getOpenedTabId() === 'text' ? textUI.focus() : 0,\r\n    });\r\n    viewportUI.render();\r\n\r\n    function onUpdate (p: Partial<TRenderTextParam>) {\r\n        text = {\r\n            ...text,\r\n            ...p,\r\n        };\r\n        viewportUI.setText(text);\r\n    }\r\n\r\n    const fontUI = new TextToolFontUI({\r\n        ...text,\r\n        onUpdate: (p) => {\r\n            onUpdate(p);\r\n        },\r\n    });\r\n\r\n    const colorWrapper = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            gap: '10px',\r\n            flexDirection: 'column',\r\n        },\r\n    });\r\n    const fillUI = new TextToolFillUI({\r\n        fill: text.fill,\r\n        primaryColor: p.primaryColor,\r\n        secondaryColor: p.secondaryColor,\r\n        onUpdate: (p) => {\r\n            onUpdate(p);\r\n        },\r\n    });\r\n    const strokeUI = new TextToolStrokeUI({\r\n        stroke: text.stroke,\r\n        primaryColor: p.primaryColor,\r\n        secondaryColor: p.secondaryColor,\r\n        onUpdate: (p) => {\r\n            onUpdate(p);\r\n        },\r\n    });\r\n    const textUI = new TextToolTextUI({\r\n        text: text.text,\r\n        onUpdate: (p) => {\r\n            p.text !== undefined && modal.setIgnoreBackground(p.text.length > 0);\r\n            onUpdate(p);\r\n        },\r\n    });\r\n\r\n    const tabs = new TabRow({\r\n        initialId: 'text',\r\n        height: 40,\r\n        tabArr: [\r\n            {\r\n                id: 'text',\r\n                label: LANG('text-text'),\r\n                onOpen: () => {\r\n                    textUI.getElement().style.display = '';\r\n                    textUI.focus();\r\n                },\r\n                onClose: () => {\r\n                    textUI.getElement().style.display = 'none';\r\n                },\r\n            },\r\n            {\r\n                id: 'font',\r\n                label: LANG('text-font'),\r\n                onOpen: () => {\r\n                    fontUI.getElement().style.display = 'flex';\r\n                },\r\n                onClose: () => {\r\n                    fontUI.getElement().style.display = 'none';\r\n                },\r\n            },\r\n            {\r\n                id: 'color',\r\n                label: LANG('text-color'),\r\n                onOpen: () => {\r\n                    colorWrapper.style.display = 'flex';\r\n                },\r\n                onClose: () => {\r\n                    colorWrapper.style.display = 'none';\r\n                },\r\n            },\r\n        ],\r\n    });\r\n    tabs.getElement().classList.add(css({\r\n        minWidth: '200px',\r\n        maxWidth: '500px',\r\n        flexGrow: '1',\r\n        borderBottom: 'none !important',\r\n    }));\r\n\r\n    const viewportInputsCss = css({\r\n        position: 'relative',\r\n        '>*': {\r\n            position: 'absolute',\r\n            right: 0,\r\n            top: 10,\r\n        },\r\n    });\r\n\r\n    const tabWrapperCss = css({\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        flexDirection: 'row-reverse',\r\n        flexWrap: 'wrap',\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n        marginRight: '-20px',\r\n        padding: '0 20px',\r\n        '@media (min-width: 700px) and (min-height: 700px)': {\r\n            display: 'none !important',\r\n        },\r\n    });\r\n\r\n\r\n\r\n    const inputsCss = css({\r\n        minHeight: 72,\r\n        marginTop: '10px',\r\n        '@media (min-width: 700px) and (min-height: 700px)': {\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            gap: '10px',\r\n            '>*': {\r\n                display: 'flex !important',\r\n            },\r\n        },\r\n    });\r\n\r\n    rootEl.append(c('', [\r\n        c(viewportWrapper, [viewportUI.getElement()]),\r\n        c('.' + viewportInputsCss, [viewportUI.getInputsElement()]),\r\n        c('.tabrow.' + tabWrapperCss, [\r\n            c(',w-240,h-40'),\r\n            tabs.getElement(),\r\n        ]),\r\n\r\n        c('.' + inputsCss, [\r\n            c(colorWrapper, [\r\n                fillUI.getElement(),\r\n                strokeUI.getElement(),\r\n            ]),\r\n            fontUI.getElement(),\r\n            textUI.getElement(),\r\n        ]),\r\n    ]));\r\n\r\n\r\n\r\n    const onResize = () => {\r\n        const b = viewportWrapper.getBoundingClientRect();\r\n        const w = Math.ceil(b.width);\r\n        const h = Math.ceil(b.height);\r\n        viewportUI.setSize(w, h);\r\n    };\r\n    window.addEventListener('resize', onResize);\r\n    setTimeout(() => {\r\n        onResize();\r\n    });\r\n    setTimeout(() => {\r\n        textUI.focus();\r\n    }, 100);\r\n\r\n\r\n    // prevent mobile keyboards scrolling page\r\n    function onScroll (): void {\r\n        window.scrollTo(0, 0);\r\n    }\r\n    window.addEventListener('scroll', onScroll);\r\n\r\n    const onModalExit = (val: string) => {\r\n        window.removeEventListener('resize', onResize);\r\n        window.removeEventListener('scroll', onScroll);\r\n        viewportUI.destroy();\r\n        fontUI.destroy();\r\n        fillUI.destroy();\r\n        strokeUI.destroy();\r\n        textUI.destroy();\r\n        tabs.destroy();\r\n\r\n        if (val === 'Ok') {\r\n            p.onConfirm({\r\n                ...viewportUI.getValues(),\r\n                ...fontUI.getValues(),\r\n                ...fillUI.getValues(),\r\n                ...strokeUI.getValues(),\r\n                ...textUI.getValues(),\r\n            });\r\n        }\r\n    };\r\n\r\n\r\n    const modal = showModal({\r\n        target: document.body,\r\n        message: `<b>${LANG('text-title')}</b>`,\r\n        div: rootEl,\r\n        buttons: ['Ok', 'Cancel'],\r\n        ignoreBackground: p.text.text.length > 0,\r\n        callback: onModalExit,\r\n        style: {\r\n            width: 'calc(100% - 50px)',\r\n            maxWidth: '1000px',\r\n            minWidth: '300px',\r\n            boxSizing: 'border-box',\r\n        },\r\n        clickOnEnter: 'Ok',\r\n    });\r\n}\r\n","import {TRenderTextParam} from '../../../image-operations/render-text';\r\nimport {IRGB, IRGBA} from '../../../kl-types';\r\nimport {ColorOptions} from '../../components/color-options';\r\nimport {KlSlider} from '../../components/kl-slider';\r\nimport {LANG} from '../../../../language/language';\r\nimport {c} from '../../../../bb/base/c';\r\nimport {createSvg} from '../../../../bb/base/base';\r\n\r\ntype TFillParams = Pick<\r\n    TRenderTextParam,\r\n    'fill'\r\n>;\r\n\r\nexport type TFillUIParams = TFillParams & {\r\n    primaryColor: IRGB;\r\n    secondaryColor: IRGB;\r\n    onUpdate: (v: Partial<TFillParams>) => void;\r\n};\r\n\r\nexport class TextToolFillUI {\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    private readonly colorOptions: ColorOptions;\r\n    private readonly opacitySlider: KlSlider;\r\n\r\n\r\n    // ---- public ----\r\n    constructor (p: TFillUIParams) {\r\n\r\n        const emit = (): void => {\r\n            p.onUpdate(this.getValues());\r\n        };\r\n\r\n        const colorOptionsArr: (IRGBA | null)[] = [\r\n            null,\r\n            p.fill ? {\r\n                ...p.fill.color,\r\n                a: 1,\r\n            } : null,\r\n            {\r\n                ...p.primaryColor,\r\n                a: 1,\r\n            },\r\n            {\r\n                ...p.secondaryColor,\r\n                a: 1,\r\n            },\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n        ];\r\n\r\n        this.colorOptions = new ColorOptions({\r\n            colorArr: colorOptionsArr,\r\n            initialIndex: p.fill ? 1 : 0,\r\n            title: LANG('shape-fill'),\r\n            onChange: (c) => {\r\n                this.opacitySlider.getElement().style.display = c !== null ? '' : 'none';\r\n                emit();\r\n            },\r\n        });\r\n\r\n        this.opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 150,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: p.fill ? p.fill.color.a : 1,\r\n            resolution: 225,\r\n            eventResMs: 1000 / 30,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n            onChange: () => emit(),\r\n        });\r\n        this.opacitySlider.getElement().style.display = p.fill ? '' : 'none';\r\n\r\n        const svg = createSvg({\r\n            elementType: 'svg',\r\n            class: 'dark-invert',\r\n            width: '25px',\r\n            height: '25px',\r\n            viewBox: '0 0 30 30',\r\n\r\n            childrenArr: [\r\n                {\r\n                    elementType: 'polyline',\r\n                    points: '0,0 30,0 30,8 19,8 19,30 11,30 11,8 0,8 0,0 1,0',\r\n                    'transform-origin': '15px 15px',\r\n                    transform: 'scale(0.8)',\r\n                    fill: '#000c',\r\n                },\r\n            ],\r\n        });\r\n\r\n        this.rootEl = c(',flex,gap-10,items-center,flexWrap,minh-30', [\r\n            svg,\r\n            this.colorOptions.getElement(),\r\n            this.opacitySlider.getElement(),\r\n        ]);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValues (): TFillParams {\r\n        const c = this.colorOptions.getValue();\r\n        if (c === null || c?.a === 0) {\r\n            return {\r\n                fill: undefined,\r\n            };\r\n        }\r\n        const color = {\r\n            ...c,\r\n            a: this.opacitySlider.getValue(),\r\n        };\r\n        return {\r\n            fill: {\r\n                color,\r\n            },\r\n        };\r\n    }\r\n\r\n    destroy (): void {\r\n        this.colorOptions.destroy();\r\n        this.opacitySlider.destroy();\r\n    }\r\n}","import {BB} from '../../../../bb/bb';\r\nimport {TRenderTextParam, TTextFormat} from '../../../image-operations/render-text';\r\nimport {Input} from '../../components/input';\r\nimport {LANG} from '../../../../language/language';\r\nimport {ImageRadioList} from '../../components/image-radio-list';\r\nimport alignLeftImg from '/src/app/img/ui/align-left.svg';\r\nimport alignCenterImg from '/src/app/img/ui/align-center.svg';\r\nimport alignRightImg from '/src/app/img/ui/align-right.svg';\r\nimport typoItalicImg from '/src/app/img/ui/typo-italic.svg';\r\nimport typoBoldImg from '/src/app/img/ui/typo-bold.svg';\r\nimport {ImageToggle} from '../../components/image-toggle';\r\nimport {Select} from '../../components/select';\r\nimport {c} from '../../../../bb/base/c';\r\nimport {PointerListener} from '../../../../bb/input/pointer-listener';\r\nimport {fonts} from '../../../../../fonts/fonts';\r\n\r\ntype TFontParams = Pick<\r\n    TRenderTextParam,\r\n    'font' | 'size' | 'letterSpacing' | 'lineHeight' | 'align' | 'isItalic' | 'isBold'\r\n>;\r\n\r\nexport type TFontUIParams = TFontParams & {\r\n    onUpdate: (v: Partial<TFontParams>) => void;\r\n};\r\n\r\n\r\nconst importedFonts: {\r\n    fontFamily: string;\r\n    fontName: string; // visible to user\r\n}[] = [\r\n    {fontFamily: 'sans-serif', fontName: 'Sans-serif'},\r\n    {fontFamily: 'serif', fontName: 'Serif'},\r\n    {fontFamily: 'monospace', fontName: 'Monospace'},\r\n    {fontFamily: 'cursive', fontName: 'Cursive'},\r\n    {fontFamily: 'fantasy', fontName: 'Fantasy'},\r\n    ...fonts.map(item => {\r\n        return {\r\n            fontFamily: item.name,\r\n            fontName: item.name,\r\n        };\r\n    }),\r\n];\r\n\r\nlet didLoadBundledFonts = false;\r\nasync function loadBundledFonts (): Promise<void> {\r\n    if (didLoadBundledFonts) {\r\n        return;\r\n    }\r\n    didLoadBundledFonts = true;\r\n    const promises: Promise<void>[] = [];\r\n    for (let i = 0; i < fonts.length; i++) {\r\n        promises.push((async () => {\r\n            const item = fonts[i];\r\n            const response = await fetch(item.url);\r\n            const buffer = await response.arrayBuffer();\r\n            const font = new FontFace(item.name, buffer);\r\n            document.fonts.add(font);\r\n        })());\r\n    }\r\n    await Promise.all(promises);\r\n}\r\n\r\nexport class TextToolFontUI {\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    private readonly fontSelect: Select<string>;\r\n    private readonly fontPointerListener: PointerListener;\r\n\r\n    private readonly importButton: HTMLButtonElement;\r\n\r\n    private readonly sizeInput: Input;\r\n    private readonly lineHeightInput: Input;\r\n    private readonly letterSpacingInput: Input;\r\n\r\n    private readonly alignRadioList: ImageRadioList<TTextFormat>;\r\n    private readonly italicToggle: ImageToggle;\r\n    private readonly boldToggle: ImageToggle;\r\n\r\n    private readonly onUpdate: (v: Partial<TFontParams>) => void;\r\n    private readonly onFocus: () => void;\r\n\r\n    // only load fonts when interacting with the font input\r\n    private loadBundledFonts (): void {\r\n        !didLoadBundledFonts && loadBundledFonts().then(() => {\r\n            this.onUpdate({\r\n                font: this.fontSelect.getValue(),\r\n            });\r\n        });\r\n    }\r\n\r\n    private importFont (): void {\r\n        const input = document.createElement('input');\r\n        input.type = 'file';\r\n        input.multiple = true;\r\n        input.accept = '.ttf, .otf, .woff, .woff2, .eot';\r\n        input.focus();\r\n        input.click();\r\n        input.onchange = async () => {\r\n            if (!input.files || input.files.length === 0) {\r\n                return;\r\n            }\r\n            let toSelect: string | undefined = undefined;\r\n\r\n            const fontFamilies = importedFonts.map(i => i.fontFamily);\r\n            for (let i = 0; i < input.files.length; i++) {\r\n                const file = input.files[i];\r\n                const fontName = 'kl-' + importedFonts.length;\r\n                if (fontFamilies.includes(fontName)) {\r\n                    continue;\r\n                }\r\n                if (!toSelect) {\r\n                    toSelect = fontName;\r\n                    this.importButton.disabled = true;\r\n                    this.importButton.innerText = LANG('loading');\r\n                }\r\n\r\n                const split = file.name.split('.');\r\n                split.pop();\r\n\r\n                importedFonts.push({\r\n                    fontFamily: fontName,\r\n                    fontName: split.join('.'),\r\n                });\r\n                const font = new FontFace(fontName, await file.arrayBuffer());\r\n                document.fonts.add(font);\r\n            }\r\n\r\n            // update font selection\r\n            setTimeout(() => {\r\n                this.fontSelect.setOptionArr(importedFonts.map(i => {\r\n                    return [\r\n                        i.fontFamily,\r\n                        i.fontName,\r\n                        {\r\n                            css: {\r\n                                fontFamily: i.fontFamily,\r\n                                fontSize: '1.2em',\r\n                            },\r\n                        },\r\n                    ];\r\n                }));\r\n                this.fontSelect.setValue(toSelect);\r\n                this.onUpdate({\r\n                    font: toSelect,\r\n                });\r\n                this.importButton.disabled = false;\r\n                this.importButton.innerText = LANG('file-import');\r\n            });\r\n        };\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (p: TFontUIParams) {\r\n        this.onUpdate = p.onUpdate;\r\n\r\n        this.fontSelect = new Select<string>({\r\n            initValue: p.font,\r\n            optionArr: importedFonts.map(i => {\r\n                return [\r\n                    i.fontFamily,\r\n                    i.fontName,\r\n                    {\r\n                        css: {\r\n                            fontFamily: i.fontFamily,\r\n                            fontSize: '1.2em',\r\n                        },\r\n                    },\r\n                ];\r\n            }),\r\n            isFocusable: true,\r\n            css: {\r\n                width: '180px',\r\n            },\r\n            onChange: (v) => {\r\n                this.loadBundledFonts();\r\n                p.onUpdate({\r\n                    font: v,\r\n                });\r\n            },\r\n        });\r\n        this.onFocus = () => this.loadBundledFonts();\r\n        this.fontSelect.getElement().addEventListener('focus', this.onFocus);\r\n        this.fontPointerListener = new BB.PointerListener({\r\n            target: this.fontSelect.getElement(),\r\n            onWheel: (e) => this.fontSelect.setDeltaValue(e.deltaY),\r\n        });\r\n\r\n        this.importButton = BB.el({\r\n            tagName: 'button',\r\n            content: LANG('file-import'),\r\n            onClick: () => {\r\n                this.importFont();\r\n            },\r\n        });\r\n\r\n        const sizeLabel = BB.el({\r\n            content: '<div><span style=\"font-size: 0.6em; margin-right: -1px\">A</span>A</div>',\r\n            css: {\r\n                width: '25px',\r\n                height: '25px',\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n                alignItems: 'center',\r\n                fontSize: '1.2em',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.sizeInput = new Input({\r\n            title: LANG('text-size'),\r\n            type: 'number',\r\n            min: 0,\r\n            max: 1000,\r\n            init: p.size,\r\n            onChange: (v) => {\r\n                p.onUpdate({\r\n                    size: parseFloat(v),\r\n                });\r\n            },\r\n            doResetIfInvalid: true,\r\n            doScrollWithoutFocus: true,\r\n            css: {\r\n                width: '70px',\r\n            },\r\n        });\r\n\r\n        this.lineHeightInput = new Input({\r\n            label: LANG('text-line-height'),\r\n            type: 'number',\r\n            min: 0,\r\n            max: 10,\r\n            step: 0.1,\r\n            init: p.lineHeight ?? 1,\r\n            onChange: (v) => {\r\n                p.onUpdate({\r\n                    lineHeight: parseFloat(v),\r\n                });\r\n            },\r\n            doResetIfInvalid: true,\r\n            doScrollWithoutFocus: true,\r\n            css: {\r\n                width: '60px',\r\n            },\r\n        });\r\n\r\n        this.letterSpacingInput = new Input({\r\n            label: LANG('text-letter-spacing'),\r\n            type: 'number',\r\n            min: -100,\r\n            max: 100,\r\n            init: p.letterSpacing ?? 0,\r\n            onChange: (v) => {\r\n                p.onUpdate({\r\n                    letterSpacing: parseFloat(v),\r\n                });\r\n            },\r\n            doResetIfInvalid: true,\r\n            doScrollWithoutFocus: true,\r\n            css: {\r\n                width: '60px',\r\n            },\r\n        });\r\n\r\n\r\n\r\n        this.alignRadioList = new ImageRadioList<TTextFormat>({\r\n            optionArr: [\r\n                {\r\n                    id: 'left',\r\n                    title: LANG('text-left'),\r\n                    image: alignLeftImg,\r\n                    darkInvert: true,\r\n                },\r\n                {\r\n                    id: 'center',\r\n                    title: LANG('text-center'),\r\n                    image: alignCenterImg,\r\n                    darkInvert: true,\r\n                },\r\n                {\r\n                    id: 'right',\r\n                    title: LANG('text-right'),\r\n                    image: alignRightImg,\r\n                    darkInvert: true,\r\n                },\r\n            ],\r\n            initId: p.align,\r\n            onChange: (v) => p.onUpdate({\r\n                align: v,\r\n            }),\r\n        });\r\n\r\n        this.italicToggle = new ImageToggle({\r\n            image: typoItalicImg,\r\n            title: LANG('text-italic'),\r\n            initValue: p.isItalic,\r\n            onChange: (v) => p.onUpdate({\r\n                isItalic: v,\r\n            }),\r\n            darkInvert: true,\r\n        });\r\n\r\n        this.boldToggle = new ImageToggle({\r\n            image: typoBoldImg,\r\n            title: LANG('text-bold'),\r\n            initValue: p.isBold,\r\n            onChange: (v) => p.onUpdate({\r\n                isBold: v,\r\n            }),\r\n            darkInvert: true,\r\n        });\r\n\r\n        this.rootEl = c(',flex,flexWrap,gap-10-15,items-center', [\r\n            c(',flex,gap-5,items-center', [\r\n                sizeLabel,\r\n                this.sizeInput.getElement(),\r\n            ]),\r\n            c(',flex,gap-5', [\r\n                this.fontSelect.getElement(),\r\n                this.importButton,\r\n            ]),\r\n            c(',flex,gap-7', [\r\n                this.alignRadioList.getElement(),\r\n                this.italicToggle.getElement(),\r\n                this.boldToggle.getElement(),\r\n            ]),\r\n            this.letterSpacingInput.getElement(),\r\n            this.lineHeightInput.getElement(),\r\n        ]);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValues (): TFontParams {\r\n        return {\r\n            font: this.fontSelect.getValue(),\r\n            size: +this.sizeInput.getValue(),\r\n            letterSpacing: +this.letterSpacingInput.getValue(),\r\n            lineHeight: +this.lineHeightInput.getValue(),\r\n            align: this.alignRadioList.getValue(),\r\n            isItalic: this.italicToggle.getValue(),\r\n            isBold: this.boldToggle.getValue(),\r\n        };\r\n    }\r\n\r\n    destroy (): void {\r\n        this.fontPointerListener.destroy();\r\n        this.fontSelect.getElement().removeEventListener('focus', this.onFocus);\r\n        this.fontSelect.destroy();\r\n        BB.destroyEl(this.importButton);\r\n        this.sizeInput.destroy();\r\n        this.lineHeightInput.destroy();\r\n        this.letterSpacingInput.destroy();\r\n        this.alignRadioList.destroy();\r\n        this.italicToggle.destroy();\r\n        this.boldToggle.destroy();\r\n    }\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2WSh2\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"lHK8L\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3kjmQ\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"g8nvA\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"axEKL\");","import fontCaveat from 'url:./Caveat-Regular.woff2';\r\nimport fontClimateCrisis from 'url:./ClimateCrisis-Regular-VariableFont_YEAR.woff2';\r\nimport fontCorrectionBrush from 'url:./CorrectionBrush.woff2';\r\nimport fontDancingScript from 'url:./DancingScript-Regular.woff2';\r\nimport fontDiabolik from 'url:./Diabolik-Regular-VF.woff2';\r\nimport fontFreckleFace from 'url:./FreckleFace-Regular.woff2';\r\nimport fontGloock from 'url:./Gloock-Regular.woff2';\r\nimport fontPacha from 'url:./Pacha.woff2';\r\nimport fontGochiHand from 'url:./GochiHand-Regular.woff2';\r\nimport fontPassionOne from 'url:./PassionOne-Bold.woff2';\r\nimport fontPixeloidSans from 'url:./PixeloidSans.woff2';\r\nimport fontPlaypenSans from 'url:./PlaypenSans-Thin.woff2';\r\nimport fontQuicksandLight from 'url:./Quicksand-Light.woff2';\r\nimport fontSilkscreen from 'url:./Silkscreen-Regular.woff2';\r\nimport fontTehroc from 'url:./Tehroc-Regular.woff2';\r\nimport fontYunga from 'url:./YUNGA-Display.woff2';\r\n\r\nexport const fonts: {\r\n    name: string;\r\n    url: string;\r\n}[] = [\r\n    { name: 'Caveat', url: fontCaveat },\r\n    { name: 'ClimateCrisis', url: fontClimateCrisis },\r\n    { name: 'CorrectionBrush', url: fontCorrectionBrush },\r\n    { name: 'DancingScript', url: fontDancingScript },\r\n    { name: 'Diabolik', url: fontDiabolik },\r\n    { name: 'FreckleFace', url: fontFreckleFace },\r\n    { name: 'Gloock', url: fontGloock },\r\n    { name: 'GochiHand', url: fontGochiHand },\r\n    { name: 'Pacha', url: fontPacha },\r\n    { name: 'PassionOne', url: fontPassionOne },\r\n    { name: 'PixeloidSans', url: fontPixeloidSans },\r\n    { name: 'PlaypenSans', url: fontPlaypenSans },\r\n    { name: 'Quicksand', url: fontQuicksandLight },\r\n    { name: 'Silkscreen', url: fontSilkscreen },\r\n    { name: 'Tehroc', url: fontTehroc },\r\n    { name: 'YUNGA', url: fontYunga },\r\n];\r\n\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hapKl\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dqzux\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"l7VGL\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dm0T7\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2U3dq\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"axzlU\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"avgh6\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"H9bSu\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"emBfm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kjRvm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"c79R0\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fndWQ\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iAFmc\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2Bq6W\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hmfbp\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iItsG\");","import {BB} from '../../../../bb/bb';\r\nimport {TRenderTextParam} from '../../../image-operations/render-text';\r\nimport {IRGB, IRGBA} from '../../../kl-types';\r\nimport {ColorOptions} from '../../components/color-options';\r\nimport {KlSlider} from '../../components/kl-slider';\r\nimport {LANG} from '../../../../language/language';\r\nimport {c} from '../../../../bb/base/c';\r\nimport {createSvg} from '../../../../bb/base/base';\r\n\r\ntype TStrokeParams = Pick<\r\n    TRenderTextParam,\r\n    'stroke'\r\n>;\r\n\r\nexport type TStrokeUIParams = TStrokeParams & {\r\n    primaryColor: IRGB;\r\n    secondaryColor: IRGB;\r\n    onUpdate: (v: Partial<TStrokeParams>) => void;\r\n};\r\n\r\nexport class TextToolStrokeUI {\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    private readonly colorOptions: ColorOptions;\r\n    private readonly opacitySlider: KlSlider;\r\n    private readonly lineWidthSlider: KlSlider;\r\n\r\n\r\n\r\n    // ---- public ----\r\n    constructor (p: TStrokeUIParams) {\r\n\r\n\r\n\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                boxShadow: '0 0 0 1px #aaa',\r\n            },\r\n        });\r\n\r\n        const emit = (): void => {\r\n            p.onUpdate(this.getValues());\r\n        };\r\n\r\n        const colorOptionsArr: (IRGBA | null)[] = [\r\n            null,\r\n            p.stroke ? {\r\n                ...p.stroke.color,\r\n                a: 1,\r\n            } : null,\r\n            {\r\n                ...p.secondaryColor,\r\n                a: 1,\r\n            },\r\n            {\r\n                ...p.primaryColor,\r\n                a: 1,\r\n            },\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n        ];\r\n\r\n        this.colorOptions = new ColorOptions({\r\n            colorArr: colorOptionsArr,\r\n            initialIndex: p.stroke ? 1 : 0,\r\n            title: LANG('shape-stroke'),\r\n            onChange: (c) => {\r\n                this.opacitySlider.getElement().style.display = c !== null ? '' : 'none';\r\n                this.lineWidthSlider.getElement().style.display = c !== null ? '' : 'none';\r\n                emit();\r\n            },\r\n        });\r\n\r\n        this.opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 150,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: p.stroke ? p.stroke.color.a : 1,\r\n            resolution: 225,\r\n            eventResMs: 1000 / 30,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n            onChange: () => emit(),\r\n        });\r\n\r\n        this.lineWidthSlider = new KlSlider({\r\n            label: LANG('shape-line-width'),\r\n            width: 150,\r\n            height: 30,\r\n            min: 0.5,\r\n            max: 100,\r\n            value: p.stroke ? p.stroke.lineWidth : 2,\r\n            eventResMs: 1000 / 30,\r\n            curve: 'quadratic',\r\n            onChange: () => emit(),\r\n        });\r\n\r\n        this.opacitySlider.getElement().style.display = p.stroke ? '' : 'none';\r\n        this.lineWidthSlider.getElement().style.display = p.stroke ? '' : 'none';\r\n\r\n        const svg = createSvg({\r\n            elementType: 'svg',\r\n            class: 'dark-invert',\r\n            width: '25px',\r\n            height: '25px',\r\n            viewBox: '0 0 30 30',\r\n\r\n            childrenArr: [\r\n                {\r\n                    elementType: 'polyline',\r\n                    points: '0,0 30,0 30,8 19,8 19,30 11,30 11,8 0,8 0,0 1,0',\r\n                    fill: 'none',\r\n                    stroke: '#000c',\r\n                    'stroke-width': '3',\r\n                    'transform-origin': '15px 15px',\r\n                    transform: 'scale(0.8)',\r\n                },\r\n            ],\r\n        });\r\n\r\n        this.rootEl = c(',flex,gap-10,items-center,flexWrap,minh-30', [\r\n            svg,\r\n            this.colorOptions.getElement(),\r\n            this.opacitySlider.getElement(),\r\n            this.lineWidthSlider.getElement(),\r\n        ]);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValues (): TStrokeParams {\r\n        const c = this.colorOptions.getValue();\r\n        if (c === null || c?.a === 0) {\r\n            return {\r\n                stroke: undefined,\r\n            };\r\n        }\r\n        const color = {\r\n            ...c,\r\n            a: this.opacitySlider.getValue(),\r\n        };\r\n        return {\r\n            stroke: {\r\n                color,\r\n                lineWidth: this.lineWidthSlider.getValue(),\r\n            },\r\n        };\r\n    }\r\n\r\n    destroy (): void {\r\n        this.colorOptions.destroy();\r\n        this.opacitySlider.destroy();\r\n        this.lineWidthSlider.destroy();\r\n    }\r\n}","import {TRenderTextParam} from '../../../image-operations/render-text';\r\nimport {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport {c} from '../../../../bb/base/c';\r\n\r\ntype TTextParams = Pick<\r\n    TRenderTextParam,\r\n    'text'\r\n>;\r\n\r\nexport type TTextUIParams = TTextParams & {\r\n    onUpdate: (v: Partial<TTextParams>) => void;\r\n};\r\n\r\nexport class TextToolTextUI {\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    private readonly textInput: HTMLTextAreaElement;\r\n    private lastEmittedText: string;\r\n    private readonly onUpdate: (v: Partial<TTextParams>) => void;\r\n\r\n    private readonly onInput = (): void => {\r\n        this.emit();\r\n    };\r\n\r\n    private emit (): void {\r\n        const text = this.textInput.value;\r\n        if (text === this.lastEmittedText) {\r\n            return;\r\n        }\r\n        this.lastEmittedText = text;\r\n        this.onUpdate({\r\n            text,\r\n        });\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (p: TTextUIParams) {\r\n        this.lastEmittedText = p.text;\r\n        this.onUpdate = p.onUpdate;\r\n\r\n        this.rootEl = c('');\r\n\r\n        this.textInput = BB.el({\r\n            tagName: 'textarea',\r\n            parent: this.rootEl,\r\n            content: p.text,\r\n            custom: {\r\n                placeholder: LANG('text-placeholder'),\r\n            },\r\n            css: {\r\n                whiteSpace: 'pre',\r\n                overflow: 'auto',\r\n                width: '100%',\r\n                height: '70px',\r\n                resize: 'vertical',\r\n            },\r\n            onChange: () => {\r\n                this.emit();\r\n            },\r\n        });\r\n\r\n        this.textInput.addEventListener('input', this.onInput);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValues (): TTextParams {\r\n        return {\r\n            text: this.textInput.value,\r\n        };\r\n    }\r\n\r\n    focus (): void {\r\n        this.textInput.focus();\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.textInput);\r\n        this.textInput.removeEventListener('input', this.onInput);\r\n    }\r\n}","import {BB} from '../../../../bb/bb';\r\nimport {throwIfNull} from '../../../../bb/base/base';\r\nimport {theme} from '../../../../theme/theme';\r\nimport {renderText, TRenderTextParam} from '../../../image-operations/render-text';\r\nimport {KlCanvas} from '../../../canvas/kl-canvas';\r\nimport {KlSlider} from '../../components/kl-slider';\r\nimport {PointerListener} from '../../../../bb/input/pointer-listener';\r\nimport {LANG} from '../../../../language/language';\r\nimport toolZoomInImg from '/src/app/img/ui/tool-zoom-in.svg';\r\nimport toolZoomOutImg from '/src/app/img/ui/tool-zoom-out.svg';\r\nimport {c} from '../../../../bb/base/c';\r\nimport {IVector2D} from '../../../../bb/bb-types';\r\nimport {KeyListener} from '../../../../bb/input/key-listener';\r\n\r\ntype TViewportParams = Pick<\r\n    TRenderTextParam,\r\n    'x' | 'y' | 'angleRad'\r\n>;\r\n\r\ntype TViewportUIParams = {\r\n    text: TRenderTextParam;\r\n    klCanvas: KlCanvas;\r\n    layerIndex: number;\r\n    onDragEnd: () => void;\r\n};\r\n\r\nexport class TextToolViewportUI {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly inputsRootEl: HTMLElement;\r\n    private readonly previewWrapper: HTMLElement;\r\n    private text: TRenderTextParam;\r\n    private offset: IVector2D = {x: 0, y: 0};\r\n    private interval: ReturnType<typeof setInterval> | undefined;\r\n\r\n    private width: number;\r\n    private height: number;\r\n    private zoomFac: number = 0;\r\n    private scale: number = 1;\r\n\r\n    private readonly layerArr: ReturnType<KlCanvas['getLayersFast']> = [];\r\n    private readonly layerIndex: number;\r\n\r\n    private readonly textCanvas: HTMLCanvasElement;\r\n    private readonly textCtx: CanvasRenderingContext2D;\r\n\r\n    private readonly targetCanvas: HTMLCanvasElement;\r\n    private readonly targetCtx: CanvasRenderingContext2D;\r\n\r\n    private readonly layersCanvas: HTMLCanvasElement;\r\n    private readonly layersCtx: CanvasRenderingContext2D;\r\n\r\n    private readonly previewCanvas: HTMLCanvasElement;\r\n    private readonly previewCtx: CanvasRenderingContext2D;\r\n\r\n    private readonly emptyCanvas: HTMLCanvasElement;\r\n    private readonly emptyCanvasLight: HTMLCanvasElement;\r\n\r\n    private checkerPattern: CanvasPattern;\r\n\r\n    private readonly rotationSlider: KlSlider;\r\n    private readonly zoomInBtn: HTMLButtonElement;\r\n    private readonly zoomOutBtn: HTMLButtonElement;\r\n\r\n    private readonly eventCapture: HTMLElement;\r\n\r\n    private readonly previewPointerListener: PointerListener;\r\n    private readonly keyListener: KeyListener;\r\n\r\n    private readonly onDarkChange = () => {\r\n        this.checkerPattern = throwIfNull(this.previewCtx.createPattern(BB.createCheckerCanvas(8, theme.isDark()), 'repeat'));\r\n        this.render();\r\n    };\r\n\r\n    private canZoom (d: number): boolean {\r\n        return this.zoomFac !== Math.min(2, Math.max(-2, this.zoomFac + d));\r\n    }\r\n\r\n    private changeZoomFac (d: number): void {\r\n        this.zoomFac = Math.min(2, Math.max(-2, this.zoomFac + d));\r\n        this.render();\r\n        this.zoomInBtn.disabled = !this.canZoom(1);\r\n        this.zoomOutBtn.disabled = !this.canZoom(-1);\r\n    }\r\n\r\n    /** Move text by x y **/\r\n    private move (x: number, y: number): void {\r\n        const rotated = BB.rotate(x, y, -this.rotationSlider.getValue() / Math.PI * 180);\r\n        this.text.x += rotated.x / this.scale;\r\n        this.text.y += rotated.y / this.scale;\r\n        this.render();\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (p: TViewportUIParams) {\r\n        this.rootEl = c();\r\n        this.text = p.text;\r\n        this.layerIndex = p.layerIndex;\r\n\r\n        const isSmallWidth = window.innerWidth < 550;\r\n        const isSmallHeight = window.innerHeight < 630;\r\n\r\n        // --- preview ---\r\n        // Text drawn on klCanvas-sized canvas: textCanvas\r\n        // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\r\n        //      they are transformed. canvas size of final preview\r\n        // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\r\n        // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\r\n\r\n        this.width = isSmallWidth ? 340 : 540;\r\n        this.height = isSmallWidth ? (isSmallHeight ? 210 : 260) : (isSmallHeight ? 230 : 350);\r\n\r\n        this.layerArr = p.klCanvas.getLayersFast();\r\n        this.textCanvas = BB.canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\r\n        this.textCtx = BB.ctx(this.textCanvas);\r\n        this.targetCanvas = BB.canvas(this.width, this.height);\r\n        this.targetCtx = BB.ctx(this.targetCanvas);\r\n        this.layersCanvas = BB.canvas(this.width, this.height);\r\n        this.layersCtx = BB.ctx(this.layersCanvas);\r\n        this.previewCanvas = BB.canvas(this.width, this.height); // the one that is visible\r\n        this.previewCtx = BB.ctx(this.previewCanvas);\r\n        BB.css(this.previewCanvas, {\r\n            display: 'block',\r\n        });\r\n        this.previewWrapper = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                position: 'relative',\r\n                width: this.width + 'px',\r\n                cursor: 'move',\r\n                touchAction: 'none',\r\n            },\r\n        });\r\n        BB.el({ // inset shadow on preview\r\n            parent: this.previewWrapper,\r\n            className: 'kl-text-preview-wrapper',\r\n        });\r\n        this.previewWrapper.append(this.previewCanvas);\r\n        this.checkerPattern = throwIfNull(this.previewCtx.createPattern(BB.createCheckerCanvas(8, theme.isDark()), 'repeat'));\r\n        this.emptyCanvas = BB.canvas(1, 1);\r\n        this.emptyCanvasLight = BB.canvas(1, 1);\r\n        {\r\n            let ctx = BB.ctx(this.emptyCanvas);\r\n            ctx.fillRect(0, 0, 1, 1);\r\n\r\n            ctx = BB.ctx(this.emptyCanvasLight);\r\n            ctx.fillStyle = '#fff';\r\n            ctx.fillRect(0, 0, 1, 1);\r\n        }\r\n\r\n        theme.addIsDarkListener(this.onDarkChange);\r\n\r\n        this.previewCanvas.oncontextmenu = (e) => e.preventDefault();\r\n        let dragged = false;\r\n        let isDown = false;\r\n        let offsetDragged = false;\r\n        this.previewPointerListener = new BB.PointerListener({\r\n            target: this.previewCanvas,\r\n            onPointer: (e) => {\r\n\r\n                // drag detect\r\n                if (e.type === 'pointerdown') {\r\n                    dragged = false;\r\n                    isDown = true;\r\n                }\r\n                if (e.type === 'pointermove' && isDown) {\r\n                    dragged = true;\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    if (isDown && dragged && e.pointerType === 'mouse') {\r\n                        // With touch/pen it would be annoying to focus again,\r\n                        // because it probably pops out the keyboard.\r\n                        p.onDragEnd();\r\n                    }\r\n                    dragged = false;\r\n                    isDown = false;\r\n                }\r\n\r\n\r\n\r\n                if (e.type === 'pointermove' && e.button === 'left') {\r\n                    e.eventPreventDefault();\r\n                    this.offset = {x: 0, y: 0};\r\n                    this.move(-e.dX, -e.dY);\r\n                }\r\n                if (e.type === 'pointerdown' && e.button === 'right') {\r\n                    document.body.append(this.eventCapture);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    setTimeout(() => this.eventCapture.remove(), 20);\r\n                }\r\n                if (e.type === 'pointermove' && e.button === 'right') {\r\n                    offsetDragged = true;\r\n                    e.eventPreventDefault();\r\n                    this.offset.x -= e.dX;\r\n                    this.offset.y -= e.dY;\r\n                    this.render();\r\n                }\r\n                if (e.type === 'pointerup' && offsetDragged) {\r\n                    let count = 0;\r\n                    this.interval = setInterval(() => {\r\n                        if (count > 8) {\r\n                            clearInterval(this.interval);\r\n                            this.offset = {x: 0, y: 0};\r\n                            this.render();\r\n                        }\r\n                        this.offset = {x: this.offset.x * 0.6, y: this.offset.y * 0.6};\r\n                        this.render();\r\n                        count++;\r\n                    }, 10);\r\n\r\n                    this.offset = {x: this.offset.x * 0.6, y: this.offset.y * 0.6};\r\n                    this.render();\r\n                }\r\n            },\r\n            onWheel: (e) => {\r\n                this.changeZoomFac(-e.deltaY);\r\n            },\r\n        });\r\n\r\n        const wheelPrevent = (event: WheelEvent): void => event.preventDefault();\r\n        this.previewCanvas.addEventListener('wheel', wheelPrevent);\r\n\r\n\r\n        this.rotationSlider = new KlSlider({\r\n            label: LANG('filter-transform-rotation'),\r\n            width: 150,\r\n            height: 30,\r\n            min: -Math.PI,\r\n            max: Math.PI,\r\n            value: p.text.angleRad,\r\n            resolution: 225,\r\n            // eventResMs: 1000 / 30,\r\n            toValue: (deg) => deg * Math.PI / 180,\r\n            toDisplayValue: (rad) => rad / Math.PI * 180,\r\n            onChange: () => {\r\n                this.offset = {x: 0, y: 0};\r\n                this.render();\r\n            },\r\n            unit: '',\r\n        });\r\n\r\n        this.zoomInBtn = BB.el({\r\n            tagName: 'button',\r\n            content: `<img height=\"20\" src=\"${toolZoomInImg}\">`,\r\n            title: LANG('zoom-in'),\r\n            onClick: () => this.changeZoomFac(1),\r\n            css: {\r\n                fontWeight: 'bold',\r\n            },\r\n        });\r\n        this.zoomOutBtn = BB.el({\r\n            tagName: 'button',\r\n            content: `<img height=\"20\" src=\"${toolZoomOutImg}\">`,\r\n            title: LANG('zoom-out'),\r\n            onClick: () => this.changeZoomFac(-1),\r\n            css: {\r\n                fontWeight: 'bold',\r\n            },\r\n        });\r\n\r\n        this.eventCapture = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n                zIndex: '999',\r\n                cursor: 'move',\r\n            },\r\n        });\r\n        this.eventCapture.oncontextmenu = (e) => e.preventDefault();\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr) => {\r\n                if (BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n                const factor = this.keyListener.isPressed('shift') ? 4 : 1;\r\n                if (keyStr === 'left') {\r\n                    this.move(-factor, 0);\r\n                }\r\n                if (keyStr === 'right') {\r\n                    this.move(factor, 0);\r\n                }\r\n                if (keyStr === 'up') {\r\n                    this.move(0, -factor);\r\n                }\r\n                if (keyStr === 'down') {\r\n                    this.move(0, factor);\r\n                }\r\n            },\r\n        });\r\n\r\n        this.inputsRootEl = c(',flex,gap-5', [\r\n            this.rotationSlider.getElement(),\r\n            c(),\r\n            this.zoomInBtn,\r\n            this.zoomOutBtn,\r\n        ]);\r\n    }\r\n\r\n    render (): void {\r\n        // try to draw very much like klCanvasWorkspace\r\n\r\n        const angleRad = this.rotationSlider.getValue();\r\n\r\n        // --- draw text ---\r\n        this.textCtx.clearRect(0, 0, this.textCanvas.width, this.textCanvas.height);\r\n        const bounds = renderText(this.textCanvas, {\r\n            ...this.text,\r\n            x: this.text.x,\r\n            y: this.text.y,\r\n            angleRad: this.rotationSlider.getValue(),\r\n        });\r\n\r\n        // transform offset\r\n        const transformedOffset = BB.Vec2.mul(\r\n            BB.rotate(this.offset.x, this.offset.y, -angleRad / Math.PI * 180),\r\n            1 / this.scale,\r\n        );\r\n\r\n        // --- determine transformation of viewport ---\r\n        // text should always be visible\r\n        bounds.width = Math.max(bounds.width, 1);\r\n        bounds.height = Math.max(bounds.height, 1);\r\n        const rotatedXY = BB.rotate(bounds.x, bounds.y, -angleRad / Math.PI * 180);\r\n        const rotatedWH = BB.rotate(bounds.width, bounds.height, -angleRad / Math.PI * 180);\r\n        const centerX = this.text.x + rotatedXY.x + rotatedWH.x / 2 + transformedOffset.x;\r\n        const centerY = this.text.y + rotatedXY.y + rotatedWH.y / 2 + transformedOffset.y;\r\n\r\n        const padding = 100;\r\n        const fitBounds = BB.fitInto(\r\n            bounds.width, bounds.height,\r\n            this.width - padding,\r\n            this.height - padding\r\n        );\r\n        this.scale = Math.min(1, fitBounds.width / bounds.width);\r\n        this.scale = Math.min(4, this.scale * Math.pow(2, this.zoomFac));\r\n\r\n\r\n        // --- compose text and target layer ---\r\n        this.targetCtx.save();\r\n\r\n        if (this.scale >= 4) {\r\n            this.targetCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            this.targetCtx.imageSmoothingEnabled = true;\r\n            this.targetCtx.imageSmoothingQuality  = this.scale >= 1 ? 'low' : 'medium';\r\n        }\r\n\r\n        this.targetCtx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\r\n        this.targetCtx.translate(this.width / 2, this.height / 2);\r\n        this.targetCtx.scale(this.scale, this.scale);\r\n        this.targetCtx.rotate(angleRad);\r\n        this.targetCtx.drawImage(this.layerArr[this.layerIndex].canvas, -centerX, -centerY);\r\n        this.targetCtx.drawImage(this.textCanvas, -centerX, -centerY);\r\n        this.targetCtx.restore();\r\n\r\n        const isDark = theme.isDark();\r\n\r\n        // --- layers ---\r\n        this.layersCtx.save();\r\n\r\n        this.layersCtx.fillStyle = isDark ? 'rgb(33,33,33)' : 'rgb(158,158,158)';\r\n        this.layersCtx.fillRect(0, 0, this.width, this.height);\r\n\r\n        { // bg\r\n            this.layersCtx.save();\r\n\r\n            this.layersCtx.translate(this.width / 2, this.height / 2);\r\n            this.layersCtx.scale(this.scale, this.scale);\r\n            this.layersCtx.rotate(angleRad);\r\n\r\n            this.layersCtx.imageSmoothingEnabled = false;\r\n\r\n            //outline\r\n            const borderSize = 1 / this.scale;\r\n            this.layersCtx.globalAlpha = isDark ? 0.25 : 0.2;\r\n            this.layersCtx.drawImage(\r\n                isDark ? this.emptyCanvasLight : this.emptyCanvas,\r\n                -centerX - borderSize,\r\n                -centerY - borderSize,\r\n                this.textCanvas.width + borderSize * 2,\r\n                this.textCanvas.height + borderSize * 2,\r\n            );\r\n            this.layersCtx.globalAlpha = 1;\r\n\r\n            //erase\r\n            this.layersCtx.globalCompositeOperation = 'destination-out';\r\n            this.layersCtx.drawImage(this.emptyCanvas, -centerX, -centerY, this.textCanvas.width, this.textCanvas.height);\r\n\r\n            this.layersCtx.restore();\r\n        }\r\n\r\n        { // individual layers\r\n\r\n            if (this.scale >= 4) {\r\n                this.layersCtx.imageSmoothingEnabled = false;\r\n            } else {\r\n                this.layersCtx.imageSmoothingEnabled = true;\r\n                this.layersCtx.imageSmoothingQuality  = this.scale >= 1 ? 'low' : 'medium';\r\n            }\r\n\r\n            // layers below\r\n            this.layersCtx.save();\r\n            this.layersCtx.translate(this.width / 2, this.height / 2);\r\n            this.layersCtx.scale(this.scale, this.scale);\r\n            this.layersCtx.rotate(angleRad);\r\n            for (let i = 0; i < this.layerIndex; i++) {\r\n                if (this.layerArr[i].isVisible && this.layerArr[i].opacity > 0) {\r\n                    this.layersCtx.globalAlpha = this.layerArr[i].opacity;\r\n                    this.layersCtx.globalCompositeOperation = this.layerArr[i].mixModeStr;\r\n                    this.layersCtx.drawImage(this.layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            this.layersCtx.restore();\r\n\r\n            // target layer\r\n            this.layersCtx.globalAlpha = (\r\n                this.layerArr[this.layerIndex].opacity *\r\n                (this.layerArr[this.layerIndex].isVisible ? 1 : 0)\r\n            );\r\n            this.layersCtx.globalCompositeOperation = this.layerArr[this.layerIndex].mixModeStr;\r\n            this.layersCtx.drawImage(this.targetCanvas, 0, 0);\r\n\r\n            // layers above\r\n            this.layersCtx.save();\r\n            this.layersCtx.translate(this.width / 2, this.height / 2);\r\n            this.layersCtx.scale(this.scale, this.scale);\r\n            this.layersCtx.rotate(angleRad);\r\n            for (let i = this.layerIndex + 1; i < this.layerArr.length; i++) {\r\n                if (this.layerArr[i].isVisible && this.layerArr[i].opacity > 0) {\r\n                    this.layersCtx.globalAlpha = this.layerArr[i].opacity;\r\n                    this.layersCtx.globalCompositeOperation = this.layerArr[i].mixModeStr;\r\n                    this.layersCtx.drawImage(this.layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            this.layersCtx.restore();\r\n\r\n        }\r\n\r\n        this.layersCtx.restore();\r\n\r\n\r\n\r\n        // --- final composite ---\r\n        this.previewCtx.save();\r\n        this.previewCtx.fillStyle = this.checkerPattern;\r\n        this.previewCtx.fillRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\r\n        this.previewCtx.drawImage(this.layersCanvas, 0, 0);\r\n        this.previewCtx.restore();\r\n\r\n        // bounds\r\n        this.previewCtx.save();\r\n        this.previewCtx.globalCompositeOperation = 'difference';\r\n        this.previewCtx.strokeStyle = '#fff';\r\n        this.previewCtx.lineWidth = 0.5;\r\n        this.previewCtx.translate(-this.offset.x, -this.offset.y);\r\n        this.previewCtx.strokeRect(\r\n            Math.round(this.width / 2 - (bounds.width / 2) * this.scale) + 0.5,\r\n            Math.round(this.height / 2 - (bounds.height / 2) * this.scale) + 0.5,\r\n            Math.round(bounds.width * this.scale),\r\n            Math.round(bounds.height * this.scale)\r\n        );\r\n        this.previewCtx.restore();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getInputsElement (): HTMLElement {\r\n        return this.inputsRootEl;\r\n    }\r\n\r\n    getValues (): TViewportParams {\r\n        return {\r\n            x: this.text.x,\r\n            y: this.text.y,\r\n            angleRad: this.rotationSlider.getValue(),\r\n        };\r\n    }\r\n\r\n    setText (text: Omit<TRenderTextParam, 'x' | 'y' | 'angleRad'>): void {\r\n        const x = this. text.x;\r\n        const y = this. text.y;\r\n        const angleRad = this. text.angleRad;\r\n        this.text = {\r\n            ...text,\r\n            x,\r\n            y,\r\n            angleRad,\r\n        };\r\n        this.render();\r\n    }\r\n\r\n    setSize (width: number, height: number): void {\r\n        if (width === this.width && height === this.height) {\r\n            return;\r\n        }\r\n\r\n        this.width = width;\r\n        this.height = height;\r\n\r\n        this.targetCanvas.width = this.width;\r\n        this.targetCanvas.height = this.height;\r\n\r\n        this.layersCanvas.width = this.width;\r\n        this.layersCanvas.height = this.height;\r\n\r\n        this.previewCanvas.width = this.width;\r\n        this.previewCanvas.height = this.height;\r\n\r\n        this.previewWrapper.style.width = this.width + 'px';\r\n\r\n        this.render();\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.rootEl);\r\n        BB.destroyEl(this.inputsRootEl);\r\n        BB.destroyEl(this.previewWrapper);\r\n        clearInterval(this.interval);\r\n\r\n        this.rotationSlider.destroy();\r\n        BB.destroyEl(this.zoomInBtn);\r\n        BB.destroyEl(this.zoomOutBtn);\r\n        this.eventCapture.remove();\r\n        this.previewPointerListener.destroy();\r\n        this.keyListener.destroy();\r\n        theme.removeIsDarkListener(this.onDarkChange);\r\n    }\r\n}","\r\n.viewportWrapper {\r\n  margin-left: -20px;\r\n  box-shadow: rgba(0, 0, 0, 0.2) 0 1px, rgba(0, 0, 0, 0.2) 0 -1px;\r\n  width: calc(100% + 40px);\r\n  height: calc(100vh - 400px);\r\n  min-height: 200px;\r\n  max-height: 600px;\r\n  overflow: hidden;\r\n}\r\n\r\n:global(body.kl-theme-dark) {\r\n  .viewportWrapper {\r\n    box-shadow: 0 1px #636363, 0 -1px #636363;\r\n  }\r\n}\r\n","import createEmotion from '../create-instance/dist/emotion-css-create-instance.esm.js';\nimport '@emotion/cache';\nimport '@emotion/serialize';\nimport '@emotion/utils';\n\nvar _createEmotion = createEmotion({\n  key: 'css'\n}),\n    flush = _createEmotion.flush,\n    hydrate = _createEmotion.hydrate,\n    cx = _createEmotion.cx,\n    merge = _createEmotion.merge,\n    getRegisteredStyles = _createEmotion.getRegisteredStyles,\n    injectGlobal = _createEmotion.injectGlobal,\n    keyframes = _createEmotion.keyframes,\n    css = _createEmotion.css,\n    sheet = _createEmotion.sheet,\n    cache = _createEmotion.cache;\n\nexport { cache, css, cx, flush, getRegisteredStyles, hydrate, injectGlobal, keyframes, merge, sheet };\n","import createCache from '@emotion/cache';\nimport { serializeStyles } from '@emotion/serialize';\nimport { getRegisteredStyles, insertStyles } from '@emotion/utils';\n\nfunction insertWithoutScoping(cache, serialized) {\n  if (cache.inserted[serialized.name] === undefined) {\n    return cache.insert('', serialized, cache.sheet, true);\n  }\n}\n\nfunction merge(registered, css, className) {\n  var registeredStyles = [];\n  var rawClassName = getRegisteredStyles(registered, registeredStyles, className);\n\n  if (registeredStyles.length < 2) {\n    return className;\n  }\n\n  return rawClassName + css(registeredStyles);\n}\n\nvar createEmotion = function createEmotion(options) {\n  var cache = createCache(options); // $FlowFixMe\n\n  cache.sheet.speedy = function (value) {\n    if (process.env.NODE_ENV !== 'production' && this.ctr !== 0) {\n      throw new Error('speedy must be changed before any rules are inserted');\n    }\n\n    this.isSpeedy = value;\n  };\n\n  cache.compat = true;\n\n  var css = function css() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    var serialized = serializeStyles(args, cache.registered, undefined);\n    insertStyles(cache, serialized, false);\n    return cache.key + \"-\" + serialized.name;\n  };\n\n  var keyframes = function keyframes() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    var serialized = serializeStyles(args, cache.registered);\n    var animation = \"animation-\" + serialized.name;\n    insertWithoutScoping(cache, {\n      name: serialized.name,\n      styles: \"@keyframes \" + animation + \"{\" + serialized.styles + \"}\"\n    });\n    return animation;\n  };\n\n  var injectGlobal = function injectGlobal() {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    var serialized = serializeStyles(args, cache.registered);\n    insertWithoutScoping(cache, serialized);\n  };\n\n  var cx = function cx() {\n    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      args[_key4] = arguments[_key4];\n    }\n\n    return merge(cache.registered, css, classnames(args));\n  };\n\n  return {\n    css: css,\n    cx: cx,\n    injectGlobal: injectGlobal,\n    keyframes: keyframes,\n    hydrate: function hydrate(ids) {\n      ids.forEach(function (key) {\n        cache.inserted[key] = true;\n      });\n    },\n    flush: function flush() {\n      cache.registered = {};\n      cache.inserted = {};\n      cache.sheet.flush();\n    },\n    // $FlowFixMe\n    sheet: cache.sheet,\n    cache: cache,\n    getRegisteredStyles: getRegisteredStyles.bind(null, cache.registered),\n    merge: merge.bind(null, cache.registered, css)\n  };\n};\n\nvar classnames = function classnames(args) {\n  var cls = '';\n\n  for (var i = 0; i < args.length; i++) {\n    var arg = args[i];\n    if (arg == null) continue;\n    var toAdd = void 0;\n\n    switch (typeof arg) {\n      case 'boolean':\n        break;\n\n      case 'object':\n        {\n          if (Array.isArray(arg)) {\n            toAdd = classnames(arg);\n          } else {\n            toAdd = '';\n\n            for (var k in arg) {\n              if (arg[k] && k) {\n                toAdd && (toAdd += ' ');\n                toAdd += k;\n              }\n            }\n          }\n\n          break;\n        }\n\n      default:\n        {\n          toAdd = arg;\n        }\n    }\n\n    if (toAdd) {\n      cls && (cls += ' ');\n      cls += toAdd;\n    }\n  }\n\n  return cls;\n};\n\nexport { createEmotion as default };\n","import { StyleSheet } from '@emotion/sheet';\nimport { dealloc, alloc, next, token, from, peek, delimit, slice, position, RULESET, combine, match, serialize, copy, replace, WEBKIT, MOZ, MS, KEYFRAMES, DECLARATION, hash, charat, strlen, indexof, stringify, COMMENT, rulesheet, middleware, compile } from 'stylis';\nimport '@emotion/weak-memoize';\nimport '@emotion/memoize';\n\nvar identifierWithPointTracking = function identifierWithPointTracking(begin, points, index) {\n  var previous = 0;\n  var character = 0;\n\n  while (true) {\n    previous = character;\n    character = peek(); // &\\f\n\n    if (previous === 38 && character === 12) {\n      points[index] = 1;\n    }\n\n    if (token(character)) {\n      break;\n    }\n\n    next();\n  }\n\n  return slice(begin, position);\n};\n\nvar toRules = function toRules(parsed, points) {\n  // pretend we've started with a comma\n  var index = -1;\n  var character = 44;\n\n  do {\n    switch (token(character)) {\n      case 0:\n        // &\\f\n        if (character === 38 && peek() === 12) {\n          // this is not 100% correct, we don't account for literal sequences here - like for example quoted strings\n          // stylis inserts \\f after & to know when & where it should replace this sequence with the context selector\n          // and when it should just concatenate the outer and inner selectors\n          // it's very unlikely for this sequence to actually appear in a different context, so we just leverage this fact here\n          points[index] = 1;\n        }\n\n        parsed[index] += identifierWithPointTracking(position - 1, points, index);\n        break;\n\n      case 2:\n        parsed[index] += delimit(character);\n        break;\n\n      case 4:\n        // comma\n        if (character === 44) {\n          // colon\n          parsed[++index] = peek() === 58 ? '&\\f' : '';\n          points[index] = parsed[index].length;\n          break;\n        }\n\n      // fallthrough\n\n      default:\n        parsed[index] += from(character);\n    }\n  } while (character = next());\n\n  return parsed;\n};\n\nvar getRules = function getRules(value, points) {\n  return dealloc(toRules(alloc(value), points));\n}; // WeakSet would be more appropriate, but only WeakMap is supported in IE11\n\n\nvar fixedElements = /* #__PURE__ */new WeakMap();\nvar compat = function compat(element) {\n  if (element.type !== 'rule' || !element.parent || // positive .length indicates that this rule contains pseudo\n  // negative .length indicates that this rule has been already prefixed\n  element.length < 1) {\n    return;\n  }\n\n  var value = element.value,\n      parent = element.parent;\n  var isImplicitRule = element.column === parent.column && element.line === parent.line;\n\n  while (parent.type !== 'rule') {\n    parent = parent.parent;\n    if (!parent) return;\n  } // short-circuit for the simplest case\n\n\n  if (element.props.length === 1 && value.charCodeAt(0) !== 58\n  /* colon */\n  && !fixedElements.get(parent)) {\n    return;\n  } // if this is an implicitly inserted rule (the one eagerly inserted at the each new nested level)\n  // then the props has already been manipulated beforehand as they that array is shared between it and its \"rule parent\"\n\n\n  if (isImplicitRule) {\n    return;\n  }\n\n  fixedElements.set(element, true);\n  var points = [];\n  var rules = getRules(value, points);\n  var parentRules = parent.props;\n\n  for (var i = 0, k = 0; i < rules.length; i++) {\n    for (var j = 0; j < parentRules.length; j++, k++) {\n      element.props[k] = points[i] ? rules[i].replace(/&\\f/g, parentRules[j]) : parentRules[j] + \" \" + rules[i];\n    }\n  }\n};\nvar removeLabel = function removeLabel(element) {\n  if (element.type === 'decl') {\n    var value = element.value;\n\n    if ( // charcode for l\n    value.charCodeAt(0) === 108 && // charcode for b\n    value.charCodeAt(2) === 98) {\n      // this ignores label\n      element[\"return\"] = '';\n      element.value = '';\n    }\n  }\n};\nvar ignoreFlag = 'emotion-disable-server-rendering-unsafe-selector-warning-please-do-not-use-this-the-warning-exists-for-a-reason';\n\nvar isIgnoringComment = function isIgnoringComment(element) {\n  return element.type === 'comm' && element.children.indexOf(ignoreFlag) > -1;\n};\n\nvar createUnsafeSelectorsAlarm = function createUnsafeSelectorsAlarm(cache) {\n  return function (element, index, children) {\n    if (element.type !== 'rule' || cache.compat) return;\n    var unsafePseudoClasses = element.value.match(/(:first|:nth|:nth-last)-child/g);\n\n    if (unsafePseudoClasses) {\n      var isNested = !!element.parent; // in nested rules comments become children of the \"auto-inserted\" rule and that's always the `element.parent`\n      //\n      // considering this input:\n      // .a {\n      //   .b /* comm */ {}\n      //   color: hotpink;\n      // }\n      // we get output corresponding to this:\n      // .a {\n      //   & {\n      //     /* comm */\n      //     color: hotpink;\n      //   }\n      //   .b {}\n      // }\n\n      var commentContainer = isNested ? element.parent.children : // global rule at the root level\n      children;\n\n      for (var i = commentContainer.length - 1; i >= 0; i--) {\n        var node = commentContainer[i];\n\n        if (node.line < element.line) {\n          break;\n        } // it is quite weird but comments are *usually* put at `column: element.column - 1`\n        // so we seek *from the end* for the node that is earlier than the rule's `element` and check that\n        // this will also match inputs like this:\n        // .a {\n        //   /* comm */\n        //   .b {}\n        // }\n        //\n        // but that is fine\n        //\n        // it would be the easiest to change the placement of the comment to be the first child of the rule:\n        // .a {\n        //   .b { /* comm */ }\n        // }\n        // with such inputs we wouldn't have to search for the comment at all\n        // TODO: consider changing this comment placement in the next major version\n\n\n        if (node.column < element.column) {\n          if (isIgnoringComment(node)) {\n            return;\n          }\n\n          break;\n        }\n      }\n\n      unsafePseudoClasses.forEach(function (unsafePseudoClass) {\n        console.error(\"The pseudo class \\\"\" + unsafePseudoClass + \"\\\" is potentially unsafe when doing server-side rendering. Try changing it to \\\"\" + unsafePseudoClass.split('-child')[0] + \"-of-type\\\".\");\n      });\n    }\n  };\n};\n\nvar isImportRule = function isImportRule(element) {\n  return element.type.charCodeAt(1) === 105 && element.type.charCodeAt(0) === 64;\n};\n\nvar isPrependedWithRegularRules = function isPrependedWithRegularRules(index, children) {\n  for (var i = index - 1; i >= 0; i--) {\n    if (!isImportRule(children[i])) {\n      return true;\n    }\n  }\n\n  return false;\n}; // use this to remove incorrect elements from further processing\n// so they don't get handed to the `sheet` (or anything else)\n// as that could potentially lead to additional logs which in turn could be overhelming to the user\n\n\nvar nullifyElement = function nullifyElement(element) {\n  element.type = '';\n  element.value = '';\n  element[\"return\"] = '';\n  element.children = '';\n  element.props = '';\n};\n\nvar incorrectImportAlarm = function incorrectImportAlarm(element, index, children) {\n  if (!isImportRule(element)) {\n    return;\n  }\n\n  if (element.parent) {\n    console.error(\"`@import` rules can't be nested inside other rules. Please move it to the top level and put it before regular rules. Keep in mind that they can only be used within global styles.\");\n    nullifyElement(element);\n  } else if (isPrependedWithRegularRules(index, children)) {\n    console.error(\"`@import` rules can't be after other rules. Please put your `@import` rules before your other rules.\");\n    nullifyElement(element);\n  }\n};\n\n/* eslint-disable no-fallthrough */\n\nfunction prefix(value, length) {\n  switch (hash(value, length)) {\n    // color-adjust\n    case 5103:\n      return WEBKIT + 'print-' + value + value;\n    // animation, animation-(delay|direction|duration|fill-mode|iteration-count|name|play-state|timing-function)\n\n    case 5737:\n    case 4201:\n    case 3177:\n    case 3433:\n    case 1641:\n    case 4457:\n    case 2921: // text-decoration, filter, clip-path, backface-visibility, column, box-decoration-break\n\n    case 5572:\n    case 6356:\n    case 5844:\n    case 3191:\n    case 6645:\n    case 3005: // mask, mask-image, mask-(mode|clip|size), mask-(repeat|origin), mask-position, mask-composite,\n\n    case 6391:\n    case 5879:\n    case 5623:\n    case 6135:\n    case 4599:\n    case 4855: // background-clip, columns, column-(count|fill|gap|rule|rule-color|rule-style|rule-width|span|width)\n\n    case 4215:\n    case 6389:\n    case 5109:\n    case 5365:\n    case 5621:\n    case 3829:\n      return WEBKIT + value + value;\n    // appearance, user-select, transform, hyphens, text-size-adjust\n\n    case 5349:\n    case 4246:\n    case 4810:\n    case 6968:\n    case 2756:\n      return WEBKIT + value + MOZ + value + MS + value + value;\n    // flex, flex-direction\n\n    case 6828:\n    case 4268:\n      return WEBKIT + value + MS + value + value;\n    // order\n\n    case 6165:\n      return WEBKIT + value + MS + 'flex-' + value + value;\n    // align-items\n\n    case 5187:\n      return WEBKIT + value + replace(value, /(\\w+).+(:[^]+)/, WEBKIT + 'box-$1$2' + MS + 'flex-$1$2') + value;\n    // align-self\n\n    case 5443:\n      return WEBKIT + value + MS + 'flex-item-' + replace(value, /flex-|-self/, '') + value;\n    // align-content\n\n    case 4675:\n      return WEBKIT + value + MS + 'flex-line-pack' + replace(value, /align-content|flex-|-self/, '') + value;\n    // flex-shrink\n\n    case 5548:\n      return WEBKIT + value + MS + replace(value, 'shrink', 'negative') + value;\n    // flex-basis\n\n    case 5292:\n      return WEBKIT + value + MS + replace(value, 'basis', 'preferred-size') + value;\n    // flex-grow\n\n    case 6060:\n      return WEBKIT + 'box-' + replace(value, '-grow', '') + WEBKIT + value + MS + replace(value, 'grow', 'positive') + value;\n    // transition\n\n    case 4554:\n      return WEBKIT + replace(value, /([^-])(transform)/g, '$1' + WEBKIT + '$2') + value;\n    // cursor\n\n    case 6187:\n      return replace(replace(replace(value, /(zoom-|grab)/, WEBKIT + '$1'), /(image-set)/, WEBKIT + '$1'), value, '') + value;\n    // background, background-image\n\n    case 5495:\n    case 3959:\n      return replace(value, /(image-set\\([^]*)/, WEBKIT + '$1' + '$`$1');\n    // justify-content\n\n    case 4968:\n      return replace(replace(value, /(.+:)(flex-)?(.*)/, WEBKIT + 'box-pack:$3' + MS + 'flex-pack:$3'), /s.+-b[^;]+/, 'justify') + WEBKIT + value + value;\n    // (margin|padding)-inline-(start|end)\n\n    case 4095:\n    case 3583:\n    case 4068:\n    case 2532:\n      return replace(value, /(.+)-inline(.+)/, WEBKIT + '$1$2') + value;\n    // (min|max)?(width|height|inline-size|block-size)\n\n    case 8116:\n    case 7059:\n    case 5753:\n    case 5535:\n    case 5445:\n    case 5701:\n    case 4933:\n    case 4677:\n    case 5533:\n    case 5789:\n    case 5021:\n    case 4765:\n      // stretch, max-content, min-content, fill-available\n      if (strlen(value) - 1 - length > 6) switch (charat(value, length + 1)) {\n        // (m)ax-content, (m)in-content\n        case 109:\n          // -\n          if (charat(value, length + 4) !== 45) break;\n        // (f)ill-available, (f)it-content\n\n        case 102:\n          return replace(value, /(.+:)(.+)-([^]+)/, '$1' + WEBKIT + '$2-$3' + '$1' + MOZ + (charat(value, length + 3) == 108 ? '$3' : '$2-$3')) + value;\n        // (s)tretch\n\n        case 115:\n          return ~indexof(value, 'stretch') ? prefix(replace(value, 'stretch', 'fill-available'), length) + value : value;\n      }\n      break;\n    // position: sticky\n\n    case 4949:\n      // (s)ticky?\n      if (charat(value, length + 1) !== 115) break;\n    // display: (flex|inline-flex)\n\n    case 6444:\n      switch (charat(value, strlen(value) - 3 - (~indexof(value, '!important') && 10))) {\n        // stic(k)y\n        case 107:\n          return replace(value, ':', ':' + WEBKIT) + value;\n        // (inline-)?fl(e)x\n\n        case 101:\n          return replace(value, /(.+:)([^;!]+)(;|!.+)?/, '$1' + WEBKIT + (charat(value, 14) === 45 ? 'inline-' : '') + 'box$3' + '$1' + WEBKIT + '$2$3' + '$1' + MS + '$2box$3') + value;\n      }\n\n      break;\n    // writing-mode\n\n    case 5936:\n      switch (charat(value, length + 11)) {\n        // vertical-l(r)\n        case 114:\n          return WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'tb') + value;\n        // vertical-r(l)\n\n        case 108:\n          return WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'tb-rl') + value;\n        // horizontal(-)tb\n\n        case 45:\n          return WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'lr') + value;\n      }\n\n      return WEBKIT + value + MS + value + value;\n  }\n\n  return value;\n}\n\nvar prefixer = function prefixer(element, index, children, callback) {\n  if (element.length > -1) if (!element[\"return\"]) switch (element.type) {\n    case DECLARATION:\n      element[\"return\"] = prefix(element.value, element.length);\n      break;\n\n    case KEYFRAMES:\n      return serialize([copy(element, {\n        value: replace(element.value, '@', '@' + WEBKIT)\n      })], callback);\n\n    case RULESET:\n      if (element.length) return combine(element.props, function (value) {\n        switch (match(value, /(::plac\\w+|:read-\\w+)/)) {\n          // :read-(only|write)\n          case ':read-only':\n          case ':read-write':\n            return serialize([copy(element, {\n              props: [replace(value, /:(read-\\w+)/, ':' + MOZ + '$1')]\n            })], callback);\n          // :placeholder\n\n          case '::placeholder':\n            return serialize([copy(element, {\n              props: [replace(value, /:(plac\\w+)/, ':' + WEBKIT + 'input-$1')]\n            }), copy(element, {\n              props: [replace(value, /:(plac\\w+)/, ':' + MOZ + '$1')]\n            }), copy(element, {\n              props: [replace(value, /:(plac\\w+)/, MS + 'input-$1')]\n            })], callback);\n        }\n\n        return '';\n      });\n  }\n};\n\nvar defaultStylisPlugins = [prefixer];\n\nvar createCache = function createCache(options) {\n  var key = options.key;\n\n  if (process.env.NODE_ENV !== 'production' && !key) {\n    throw new Error(\"You have to configure `key` for your cache. Please make sure it's unique (and not equal to 'css') as it's used for linking styles to your cache.\\n\" + \"If multiple caches share the same key they might \\\"fight\\\" for each other's style elements.\");\n  }\n\n  if (key === 'css') {\n    var ssrStyles = document.querySelectorAll(\"style[data-emotion]:not([data-s])\"); // get SSRed styles out of the way of React's hydration\n    // document.head is a safe place to move them to(though note document.head is not necessarily the last place they will be)\n    // note this very very intentionally targets all style elements regardless of the key to ensure\n    // that creating a cache works inside of render of a React component\n\n    Array.prototype.forEach.call(ssrStyles, function (node) {\n      // we want to only move elements which have a space in the data-emotion attribute value\n      // because that indicates that it is an Emotion 11 server-side rendered style elements\n      // while we will already ignore Emotion 11 client-side inserted styles because of the :not([data-s]) part in the selector\n      // Emotion 10 client-side inserted styles did not have data-s (but importantly did not have a space in their data-emotion attributes)\n      // so checking for the space ensures that loading Emotion 11 after Emotion 10 has inserted some styles\n      // will not result in the Emotion 10 styles being destroyed\n      var dataEmotionAttribute = node.getAttribute('data-emotion');\n\n      if (dataEmotionAttribute.indexOf(' ') === -1) {\n        return;\n      }\n      document.head.appendChild(node);\n      node.setAttribute('data-s', '');\n    });\n  }\n\n  var stylisPlugins = options.stylisPlugins || defaultStylisPlugins;\n\n  if (process.env.NODE_ENV !== 'production') {\n    // $FlowFixMe\n    if (/[^a-z-]/.test(key)) {\n      throw new Error(\"Emotion key must only contain lower case alphabetical characters and - but \\\"\" + key + \"\\\" was passed\");\n    }\n  }\n\n  var inserted = {};\n  var container;\n  var nodesToHydrate = [];\n\n  {\n    container = options.container || document.head;\n    Array.prototype.forEach.call( // this means we will ignore elements which don't have a space in them which\n    // means that the style elements we're looking at are only Emotion 11 server-rendered style elements\n    document.querySelectorAll(\"style[data-emotion^=\\\"\" + key + \" \\\"]\"), function (node) {\n      var attrib = node.getAttribute(\"data-emotion\").split(' '); // $FlowFixMe\n\n      for (var i = 1; i < attrib.length; i++) {\n        inserted[attrib[i]] = true;\n      }\n\n      nodesToHydrate.push(node);\n    });\n  }\n\n  var _insert;\n\n  var omnipresentPlugins = [compat, removeLabel];\n\n  if (process.env.NODE_ENV !== 'production') {\n    omnipresentPlugins.push(createUnsafeSelectorsAlarm({\n      get compat() {\n        return cache.compat;\n      }\n\n    }), incorrectImportAlarm);\n  }\n\n  {\n    var currentSheet;\n    var finalizingPlugins = [stringify, process.env.NODE_ENV !== 'production' ? function (element) {\n      if (!element.root) {\n        if (element[\"return\"]) {\n          currentSheet.insert(element[\"return\"]);\n        } else if (element.value && element.type !== COMMENT) {\n          // insert empty rule in non-production environments\n          // so @emotion/jest can grab `key` from the (JS)DOM for caches without any rules inserted yet\n          currentSheet.insert(element.value + \"{}\");\n        }\n      }\n    } : rulesheet(function (rule) {\n      currentSheet.insert(rule);\n    })];\n    var serializer = middleware(omnipresentPlugins.concat(stylisPlugins, finalizingPlugins));\n\n    var stylis = function stylis(styles) {\n      return serialize(compile(styles), serializer);\n    };\n\n    _insert = function insert(selector, serialized, sheet, shouldCache) {\n      currentSheet = sheet;\n\n      if (process.env.NODE_ENV !== 'production' && serialized.map !== undefined) {\n        currentSheet = {\n          insert: function insert(rule) {\n            sheet.insert(rule + serialized.map);\n          }\n        };\n      }\n\n      stylis(selector ? selector + \"{\" + serialized.styles + \"}\" : serialized.styles);\n\n      if (shouldCache) {\n        cache.inserted[serialized.name] = true;\n      }\n    };\n  }\n\n  var cache = {\n    key: key,\n    sheet: new StyleSheet({\n      key: key,\n      container: container,\n      nonce: options.nonce,\n      speedy: options.speedy,\n      prepend: options.prepend,\n      insertionPoint: options.insertionPoint\n    }),\n    nonce: options.nonce,\n    inserted: inserted,\n    registered: {},\n    insert: _insert\n  };\n  cache.sheet.hydrate(nodesToHydrate);\n  return cache;\n};\n\nexport { createCache as default };\n","/*\n\nBased off glamor's StyleSheet, thanks Sunil \n\nhigh performance StyleSheet for css-in-js systems\n\n- uses multiple style tags behind the scenes for millions of rules\n- uses `insertRule` for appending in production for *much* faster performance\n\n// usage\n\nimport { StyleSheet } from '@emotion/sheet'\n\nlet styleSheet = new StyleSheet({ key: '', container: document.head })\n\nstyleSheet.insert('#box { border: 1px solid red; }')\n- appends a css rule into the stylesheet\n\nstyleSheet.flush()\n- empties the stylesheet of all its contents\n\n*/\n// $FlowFixMe\nfunction sheetForTag(tag) {\n  if (tag.sheet) {\n    // $FlowFixMe\n    return tag.sheet;\n  } // this weirdness brought to you by firefox\n\n  /* istanbul ignore next */\n\n\n  for (var i = 0; i < document.styleSheets.length; i++) {\n    if (document.styleSheets[i].ownerNode === tag) {\n      // $FlowFixMe\n      return document.styleSheets[i];\n    }\n  }\n}\n\nfunction createStyleElement(options) {\n  var tag = document.createElement('style');\n  tag.setAttribute('data-emotion', options.key);\n\n  if (options.nonce !== undefined) {\n    tag.setAttribute('nonce', options.nonce);\n  }\n\n  tag.appendChild(document.createTextNode(''));\n  tag.setAttribute('data-s', '');\n  return tag;\n}\n\nvar StyleSheet = /*#__PURE__*/function () {\n  // Using Node instead of HTMLElement since container may be a ShadowRoot\n  function StyleSheet(options) {\n    var _this = this;\n\n    this._insertTag = function (tag) {\n      var before;\n\n      if (_this.tags.length === 0) {\n        if (_this.insertionPoint) {\n          before = _this.insertionPoint.nextSibling;\n        } else if (_this.prepend) {\n          before = _this.container.firstChild;\n        } else {\n          before = _this.before;\n        }\n      } else {\n        before = _this.tags[_this.tags.length - 1].nextSibling;\n      }\n\n      _this.container.insertBefore(tag, before);\n\n      _this.tags.push(tag);\n    };\n\n    this.isSpeedy = options.speedy === undefined ? process.env.NODE_ENV === 'production' : options.speedy;\n    this.tags = [];\n    this.ctr = 0;\n    this.nonce = options.nonce; // key is the value of the data-emotion attribute, it's used to identify different sheets\n\n    this.key = options.key;\n    this.container = options.container;\n    this.prepend = options.prepend;\n    this.insertionPoint = options.insertionPoint;\n    this.before = null;\n  }\n\n  var _proto = StyleSheet.prototype;\n\n  _proto.hydrate = function hydrate(nodes) {\n    nodes.forEach(this._insertTag);\n  };\n\n  _proto.insert = function insert(rule) {\n    // the max length is how many rules we have per style tag, it's 65000 in speedy mode\n    // it's 1 in dev because we insert source maps that map a single rule to a location\n    // and you can only have one source map per style tag\n    if (this.ctr % (this.isSpeedy ? 65000 : 1) === 0) {\n      this._insertTag(createStyleElement(this));\n    }\n\n    var tag = this.tags[this.tags.length - 1];\n\n    if (process.env.NODE_ENV !== 'production') {\n      var isImportRule = rule.charCodeAt(0) === 64 && rule.charCodeAt(1) === 105;\n\n      if (isImportRule && this._alreadyInsertedOrderInsensitiveRule) {\n        // this would only cause problem in speedy mode\n        // but we don't want enabling speedy to affect the observable behavior\n        // so we report this error at all times\n        console.error(\"You're attempting to insert the following rule:\\n\" + rule + '\\n\\n`@import` rules must be before all other types of rules in a stylesheet but other rules have already been inserted. Please ensure that `@import` rules are before all other rules.');\n      }\n      this._alreadyInsertedOrderInsensitiveRule = this._alreadyInsertedOrderInsensitiveRule || !isImportRule;\n    }\n\n    if (this.isSpeedy) {\n      var sheet = sheetForTag(tag);\n\n      try {\n        // this is the ultrafast version, works across browsers\n        // the big drawback is that the css won't be editable in devtools\n        sheet.insertRule(rule, sheet.cssRules.length);\n      } catch (e) {\n        if (process.env.NODE_ENV !== 'production' && !/:(-moz-placeholder|-moz-focus-inner|-moz-focusring|-ms-input-placeholder|-moz-read-write|-moz-read-only|-ms-clear|-ms-expand|-ms-reveal){/.test(rule)) {\n          console.error(\"There was a problem inserting the following rule: \\\"\" + rule + \"\\\"\", e);\n        }\n      }\n    } else {\n      tag.appendChild(document.createTextNode(rule));\n    }\n\n    this.ctr++;\n  };\n\n  _proto.flush = function flush() {\n    // $FlowFixMe\n    this.tags.forEach(function (tag) {\n      return tag.parentNode && tag.parentNode.removeChild(tag);\n    });\n    this.tags = [];\n    this.ctr = 0;\n\n    if (process.env.NODE_ENV !== 'production') {\n      this._alreadyInsertedOrderInsensitiveRule = false;\n    }\n  };\n\n  return StyleSheet;\n}();\n\nexport { StyleSheet };\n","var e=\"-ms-\";var r=\"-moz-\";var a=\"-webkit-\";var n=\"comm\";var c=\"rule\";var s=\"decl\";var t=\"@page\";var u=\"@media\";var i=\"@import\";var f=\"@charset\";var o=\"@viewport\";var l=\"@supports\";var v=\"@document\";var p=\"@namespace\";var h=\"@keyframes\";var b=\"@font-face\";var w=\"@counter-style\";var d=\"@font-feature-values\";var $=\"@layer\";var g=Math.abs;var k=String.fromCharCode;var m=Object.assign;function x(e,r){return O(e,0)^45?(((r<<2^O(e,0))<<2^O(e,1))<<2^O(e,2))<<2^O(e,3):0}function y(e){return e.trim()}function j(e,r){return(e=r.exec(e))?e[0]:e}function z(e,r,a){return e.replace(r,a)}function C(e,r){return e.indexOf(r)}function O(e,r){return e.charCodeAt(r)|0}function A(e,r,a){return e.slice(r,a)}function M(e){return e.length}function S(e){return e.length}function q(e,r){return r.push(e),e}function B(e,r){return e.map(r).join(\"\")}var D=1;var E=1;var F=0;var G=0;var H=0;var I=\"\";function J(e,r,a,n,c,s,t){return{value:e,root:r,parent:a,type:n,props:c,children:s,line:D,column:E,length:t,return:\"\"}}function K(e,r){return m(J(\"\",null,null,\"\",null,null,0),e,{length:-e.length},r)}function L(){return H}function N(){H=G>0?O(I,--G):0;if(E--,H===10)E=1,D--;return H}function P(){H=G<F?O(I,G++):0;if(E++,H===10)E=1,D++;return H}function Q(){return O(I,G)}function R(){return G}function T(e,r){return A(I,e,r)}function U(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function V(e){return D=E=1,F=M(I=e),G=0,[]}function W(e){return I=\"\",e}function X(e){return y(T(G-1,re(e===91?e+2:e===40?e+1:e)))}function Y(e){return W(_(V(e)))}function Z(e){while(H=Q())if(H<33)P();else break;return U(e)>2||U(H)>3?\"\":\" \"}function _(e){while(P())switch(U(H)){case 0:q(ne(G-1),e);break;case 2:q(X(H),e);break;default:q(k(H),e)}return e}function ee(e,r){while(--r&&P())if(H<48||H>102||H>57&&H<65||H>70&&H<97)break;return T(e,R()+(r<6&&Q()==32&&P()==32))}function re(e){while(P())switch(H){case e:return G;case 34:case 39:if(e!==34&&e!==39)re(H);break;case 40:if(e===41)re(e);break;case 92:P();break}return G}function ae(e,r){while(P())if(e+H===47+10)break;else if(e+H===42+42&&Q()===47)break;return\"/*\"+T(r,G-1)+\"*\"+k(e===47?e:P())}function ne(e){while(!U(Q()))P();return T(e,G)}function ce(e){return W(se(\"\",null,null,null,[\"\"],e=V(e),0,[0],e))}function se(e,r,a,n,c,s,t,u,i){var f=0;var o=0;var l=t;var v=0;var p=0;var h=0;var b=1;var w=1;var d=1;var $=0;var g=\"\";var m=c;var x=s;var y=n;var j=g;while(w)switch(h=$,$=P()){case 40:if(h!=108&&O(j,l-1)==58){if(C(j+=z(X($),\"&\",\"&\\f\"),\"&\\f\")!=-1)d=-1;break}case 34:case 39:case 91:j+=X($);break;case 9:case 10:case 13:case 32:j+=Z(h);break;case 92:j+=ee(R()-1,7);continue;case 47:switch(Q()){case 42:case 47:q(ue(ae(P(),R()),r,a),i);break;default:j+=\"/\"}break;case 123*b:u[f++]=M(j)*d;case 125*b:case 59:case 0:switch($){case 0:case 125:w=0;case 59+o:if(d==-1)j=z(j,/\\f/g,\"\");if(p>0&&M(j)-l)q(p>32?ie(j+\";\",n,a,l-1):ie(z(j,\" \",\"\")+\";\",n,a,l-2),i);break;case 59:j+=\";\";default:q(y=te(j,r,a,f,o,c,u,g,m=[],x=[],l),s);if($===123)if(o===0)se(j,r,y,y,m,s,l,u,x);else switch(v===99&&O(j,3)===110?100:v){case 100:case 108:case 109:case 115:se(e,y,y,n&&q(te(e,y,y,0,0,c,u,g,c,m=[],l),x),c,x,l,u,n?m:x);break;default:se(j,y,y,y,[\"\"],x,0,u,x)}}f=o=p=0,b=d=1,g=j=\"\",l=t;break;case 58:l=1+M(j),p=h;default:if(b<1)if($==123)--b;else if($==125&&b++==0&&N()==125)continue;switch(j+=k($),$*b){case 38:d=o>0?1:(j+=\"\\f\",-1);break;case 44:u[f++]=(M(j)-1)*d,d=1;break;case 64:if(Q()===45)j+=X(P());v=Q(),o=l=M(g=j+=ne(R())),$++;break;case 45:if(h===45&&M(j)==2)b=0}}return s}function te(e,r,a,n,s,t,u,i,f,o,l){var v=s-1;var p=s===0?t:[\"\"];var h=S(p);for(var b=0,w=0,d=0;b<n;++b)for(var $=0,k=A(e,v+1,v=g(w=u[b])),m=e;$<h;++$)if(m=y(w>0?p[$]+\" \"+k:z(k,/&\\f/g,p[$])))f[d++]=m;return J(e,r,a,s===0?c:i,f,o,l)}function ue(e,r,a){return J(e,r,a,n,k(L()),A(e,2,-2),0)}function ie(e,r,a,n){return J(e,r,a,s,A(e,0,n),A(e,n+1,-1),n)}function fe(n,c,s){switch(x(n,c)){case 5103:return a+\"print-\"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return a+n+n;case 4789:return r+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return a+n+r+n+e+n+n;case 5936:switch(O(n,c+11)){case 114:return a+n+e+z(n,/[svh]\\w+-[tblr]{2}/,\"tb\")+n;case 108:return a+n+e+z(n,/[svh]\\w+-[tblr]{2}/,\"tb-rl\")+n;case 45:return a+n+e+z(n,/[svh]\\w+-[tblr]{2}/,\"lr\")+n}case 6828:case 4268:case 2903:return a+n+e+n+n;case 6165:return a+n+e+\"flex-\"+n+n;case 5187:return a+n+z(n,/(\\w+).+(:[^]+)/,a+\"box-$1$2\"+e+\"flex-$1$2\")+n;case 5443:return a+n+e+\"flex-item-\"+z(n,/flex-|-self/g,\"\")+(!j(n,/flex-|baseline/)?e+\"grid-row-\"+z(n,/flex-|-self/g,\"\"):\"\")+n;case 4675:return a+n+e+\"flex-line-pack\"+z(n,/align-content|flex-|-self/g,\"\")+n;case 5548:return a+n+e+z(n,\"shrink\",\"negative\")+n;case 5292:return a+n+e+z(n,\"basis\",\"preferred-size\")+n;case 6060:return a+\"box-\"+z(n,\"-grow\",\"\")+a+n+e+z(n,\"grow\",\"positive\")+n;case 4554:return a+z(n,/([^-])(transform)/g,\"$1\"+a+\"$2\")+n;case 6187:return z(z(z(n,/(zoom-|grab)/,a+\"$1\"),/(image-set)/,a+\"$1\"),n,\"\")+n;case 5495:case 3959:return z(n,/(image-set\\([^]*)/,a+\"$1\"+\"$`$1\");case 4968:return z(z(n,/(.+:)(flex-)?(.*)/,a+\"box-pack:$3\"+e+\"flex-pack:$3\"),/s.+-b[^;]+/,\"justify\")+a+n+n;case 4200:if(!j(n,/flex-|baseline/))return e+\"grid-column-align\"+A(n,c)+n;break;case 2592:case 3360:return e+z(n,\"template-\",\"\")+n;case 4384:case 3616:if(s&&s.some((function(e,r){return c=r,j(e.props,/grid-\\w+-end/)}))){return~C(n+(s=s[c].value),\"span\")?n:e+z(n,\"-start\",\"\")+n+e+\"grid-row-span:\"+(~C(s,\"span\")?j(s,/\\d+/):+j(s,/\\d+/)-+j(n,/\\d+/))+\";\"}return e+z(n,\"-start\",\"\")+n;case 4896:case 4128:return s&&s.some((function(e){return j(e.props,/grid-\\w+-start/)}))?n:e+z(z(n,\"-end\",\"-span\"),\"span \",\"\")+n;case 4095:case 3583:case 4068:case 2532:return z(n,/(.+)-inline(.+)/,a+\"$1$2\")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(M(n)-1-c>6)switch(O(n,c+1)){case 109:if(O(n,c+4)!==45)break;case 102:return z(n,/(.+:)(.+)-([^]+)/,\"$1\"+a+\"$2-$3\"+\"$1\"+r+(O(n,c+3)==108?\"$3\":\"$2-$3\"))+n;case 115:return~C(n,\"stretch\")?fe(z(n,\"stretch\",\"fill-available\"),c,s)+n:n}break;case 5152:case 5920:return z(n,/(.+?):(\\d+)(\\s*\\/\\s*(span)?\\s*(\\d+))?(.*)/,(function(r,a,c,s,t,u,i){return e+a+\":\"+c+i+(s?e+a+\"-span:\"+(t?u:+u-+c)+i:\"\")+n}));case 4949:if(O(n,c+6)===121)return z(n,\":\",\":\"+a)+n;break;case 6444:switch(O(n,O(n,14)===45?18:11)){case 120:return z(n,/(.+:)([^;\\s!]+)(;|(\\s+)?!.+)?/,\"$1\"+a+(O(n,14)===45?\"inline-\":\"\")+\"box$3\"+\"$1\"+a+\"$2$3\"+\"$1\"+e+\"$2box$3\")+n;case 100:return z(n,\":\",\":\"+e)+n}break;case 5719:case 2647:case 2135:case 3927:case 2391:return z(n,\"scroll-\",\"scroll-snap-\")+n}return n}function oe(e,r){var a=\"\";var n=S(e);for(var c=0;c<n;c++)a+=r(e[c],c,e,r)||\"\";return a}function le(e,r,a,t){switch(e.type){case $:if(e.children.length)break;case i:case s:return e.return=e.return||e.value;case n:return\"\";case h:return e.return=e.value+\"{\"+oe(e.children,t)+\"}\";case c:e.value=e.props.join(\",\")}return M(a=oe(e.children,t))?e.return=e.value+\"{\"+a+\"}\":\"\"}function ve(e){var r=S(e);return function(a,n,c,s){var t=\"\";for(var u=0;u<r;u++)t+=e[u](a,n,c,s)||\"\";return t}}function pe(e){return function(r){if(!r.root)if(r=r.return)e(r)}}function he(n,t,u,i){if(n.length>-1)if(!n.return)switch(n.type){case s:n.return=fe(n.value,n.length,u);return;case h:return oe([K(n,{value:z(n.value,\"@\",\"@\"+a)})],i);case c:if(n.length)return B(n.props,(function(c){switch(j(c,/(::plac\\w+|:read-\\w+)/)){case\":read-only\":case\":read-write\":return oe([K(n,{props:[z(c,/:(read-\\w+)/,\":\"+r+\"$1\")]})],i);case\"::placeholder\":return oe([K(n,{props:[z(c,/:(plac\\w+)/,\":\"+a+\"input-$1\")]}),K(n,{props:[z(c,/:(plac\\w+)/,\":\"+r+\"$1\")]}),K(n,{props:[z(c,/:(plac\\w+)/,e+\"input-$1\")]})],i)}return\"\"}))}}function be(e){switch(e.type){case c:e.props=e.props.map((function(r){return B(Y(r),(function(r,a,n){switch(O(r,0)){case 12:return A(r,1,M(r));case 0:case 40:case 43:case 62:case 126:return r;case 58:if(n[++a]===\"global\")n[a]=\"\",n[++a]=\"\\f\"+A(n[a],a=1,-1);case 32:return a===1?\"\":r;default:switch(a){case 0:e=r;return S(n)>1?\"\":r;case a=S(n)-1:case 2:return a===2?r+e+e:r+e;default:return r}}}))}))}}export{f as CHARSET,n as COMMENT,w as COUNTER_STYLE,s as DECLARATION,v as DOCUMENT,b as FONT_FACE,d as FONT_FEATURE_VALUES,i as IMPORT,h as KEYFRAMES,$ as LAYER,u as MEDIA,r as MOZ,e as MS,p as NAMESPACE,t as PAGE,c as RULESET,l as SUPPORTS,o as VIEWPORT,a as WEBKIT,g as abs,V as alloc,q as append,m as assign,R as caret,L as char,H as character,I as characters,O as charat,E as column,B as combine,ue as comment,ae as commenter,ce as compile,K as copy,W as dealloc,ie as declaration,X as delimit,re as delimiter,ee as escaping,k as from,x as hash,ne as identifier,C as indexof,F as length,D as line,j as match,ve as middleware,be as namespace,P as next,J as node,se as parse,Q as peek,G as position,fe as prefix,he as prefixer,N as prev,z as replace,te as ruleset,pe as rulesheet,oe as serialize,S as sizeof,T as slice,le as stringify,M as strlen,A as substr,U as token,Y as tokenize,_ as tokenizer,y as trim,Z as whitespace};\n//# sourceMappingURL=stylis.mjs.map\n","export var MS = '-ms-'\nexport var MOZ = '-moz-'\nexport var WEBKIT = '-webkit-'\n\nexport var COMMENT = 'comm'\nexport var RULESET = 'rule'\nexport var DECLARATION = 'decl'\n\nexport var PAGE = '@page'\nexport var MEDIA = '@media'\nexport var IMPORT = '@import'\nexport var CHARSET = '@charset'\nexport var VIEWPORT = '@viewport'\nexport var SUPPORTS = '@supports'\nexport var DOCUMENT = '@document'\nexport var NAMESPACE = '@namespace'\nexport var KEYFRAMES = '@keyframes'\nexport var FONT_FACE = '@font-face'\nexport var COUNTER_STYLE = '@counter-style'\nexport var FONT_FEATURE_VALUES = '@font-feature-values'\nexport var LAYER = '@layer'\n","/**\n * @param {number}\n * @return {number}\n */\nexport var abs = Math.abs\n\n/**\n * @param {number}\n * @return {string}\n */\nexport var from = String.fromCharCode\n\n/**\n * @param {object}\n * @return {object}\n */\nexport var assign = Object.assign\n\n/**\n * @param {string} value\n * @param {number} length\n * @return {number}\n */\nexport function hash (value, length) {\n\treturn charat(value, 0) ^ 45 ? (((((((length << 2) ^ charat(value, 0)) << 2) ^ charat(value, 1)) << 2) ^ charat(value, 2)) << 2) ^ charat(value, 3) : 0\n}\n\n/**\n * @param {string} value\n * @return {string}\n */\nexport function trim (value) {\n\treturn value.trim()\n}\n\n/**\n * @param {string} value\n * @param {RegExp} pattern\n * @return {string?}\n */\nexport function match (value, pattern) {\n\treturn (value = pattern.exec(value)) ? value[0] : value\n}\n\n/**\n * @param {string} value\n * @param {(string|RegExp)} pattern\n * @param {string} replacement\n * @return {string}\n */\nexport function replace (value, pattern, replacement) {\n\treturn value.replace(pattern, replacement)\n}\n\n/**\n * @param {string} value\n * @param {string} search\n * @return {number}\n */\nexport function indexof (value, search) {\n\treturn value.indexOf(search)\n}\n\n/**\n * @param {string} value\n * @param {number} index\n * @return {number}\n */\nexport function charat (value, index) {\n\treturn value.charCodeAt(index) | 0\n}\n\n/**\n * @param {string} value\n * @param {number} begin\n * @param {number} end\n * @return {string}\n */\nexport function substr (value, begin, end) {\n\treturn value.slice(begin, end)\n}\n\n/**\n * @param {string} value\n * @return {number}\n */\nexport function strlen (value) {\n\treturn value.length\n}\n\n/**\n * @param {any[]} value\n * @return {number}\n */\nexport function sizeof (value) {\n\treturn value.length\n}\n\n/**\n * @param {any} value\n * @param {any[]} array\n * @return {any}\n */\nexport function append (value, array) {\n\treturn array.push(value), value\n}\n\n/**\n * @param {string[]} array\n * @param {function} callback\n * @return {string}\n */\nexport function combine (array, callback) {\n\treturn array.map(callback).join('')\n}\n","import {from, trim, charat, strlen, substr, append, assign} from './Utility.js'\n\nexport var line = 1\nexport var column = 1\nexport var length = 0\nexport var position = 0\nexport var character = 0\nexport var characters = ''\n\n/**\n * @param {string} value\n * @param {object | null} root\n * @param {object | null} parent\n * @param {string} type\n * @param {string[] | string} props\n * @param {object[] | string} children\n * @param {number} length\n */\nexport function node (value, root, parent, type, props, children, length) {\n\treturn {value: value, root: root, parent: parent, type: type, props: props, children: children, line: line, column: column, length: length, return: ''}\n}\n\n/**\n * @param {object} root\n * @param {object} props\n * @return {object}\n */\nexport function copy (root, props) {\n\treturn assign(node('', null, null, '', null, null, 0), root, {length: -root.length}, props)\n}\n\n/**\n * @return {number}\n */\nexport function char () {\n\treturn character\n}\n\n/**\n * @return {number}\n */\nexport function prev () {\n\tcharacter = position > 0 ? charat(characters, --position) : 0\n\n\tif (column--, character === 10)\n\t\tcolumn = 1, line--\n\n\treturn character\n}\n\n/**\n * @return {number}\n */\nexport function next () {\n\tcharacter = position < length ? charat(characters, position++) : 0\n\n\tif (column++, character === 10)\n\t\tcolumn = 1, line++\n\n\treturn character\n}\n\n/**\n * @return {number}\n */\nexport function peek () {\n\treturn charat(characters, position)\n}\n\n/**\n * @return {number}\n */\nexport function caret () {\n\treturn position\n}\n\n/**\n * @param {number} begin\n * @param {number} end\n * @return {string}\n */\nexport function slice (begin, end) {\n\treturn substr(characters, begin, end)\n}\n\n/**\n * @param {number} type\n * @return {number}\n */\nexport function token (type) {\n\tswitch (type) {\n\t\t// \\0 \\t \\n \\r \\s whitespace token\n\t\tcase 0: case 9: case 10: case 13: case 32:\n\t\t\treturn 5\n\t\t// ! + , / > @ ~ isolate token\n\t\tcase 33: case 43: case 44: case 47: case 62: case 64: case 126:\n\t\t// ; { } breakpoint token\n\t\tcase 59: case 123: case 125:\n\t\t\treturn 4\n\t\t// : accompanied token\n\t\tcase 58:\n\t\t\treturn 3\n\t\t// \" ' ( [ opening delimit token\n\t\tcase 34: case 39: case 40: case 91:\n\t\t\treturn 2\n\t\t// ) ] closing delimit token\n\t\tcase 41: case 93:\n\t\t\treturn 1\n\t}\n\n\treturn 0\n}\n\n/**\n * @param {string} value\n * @return {any[]}\n */\nexport function alloc (value) {\n\treturn line = column = 1, length = strlen(characters = value), position = 0, []\n}\n\n/**\n * @param {any} value\n * @return {any}\n */\nexport function dealloc (value) {\n\treturn characters = '', value\n}\n\n/**\n * @param {number} type\n * @return {string}\n */\nexport function delimit (type) {\n\treturn trim(slice(position - 1, delimiter(type === 91 ? type + 2 : type === 40 ? type + 1 : type)))\n}\n\n/**\n * @param {string} value\n * @return {string[]}\n */\nexport function tokenize (value) {\n\treturn dealloc(tokenizer(alloc(value)))\n}\n\n/**\n * @param {number} type\n * @return {string}\n */\nexport function whitespace (type) {\n\twhile (character = peek())\n\t\tif (character < 33)\n\t\t\tnext()\n\t\telse\n\t\t\tbreak\n\n\treturn token(type) > 2 || token(character) > 3 ? '' : ' '\n}\n\n/**\n * @param {string[]} children\n * @return {string[]}\n */\nexport function tokenizer (children) {\n\twhile (next())\n\t\tswitch (token(character)) {\n\t\t\tcase 0: append(identifier(position - 1), children)\n\t\t\t\tbreak\n\t\t\tcase 2: append(delimit(character), children)\n\t\t\t\tbreak\n\t\t\tdefault: append(from(character), children)\n\t\t}\n\n\treturn children\n}\n\n/**\n * @param {number} index\n * @param {number} count\n * @return {string}\n */\nexport function escaping (index, count) {\n\twhile (--count && next())\n\t\t// not 0-9 A-F a-f\n\t\tif (character < 48 || character > 102 || (character > 57 && character < 65) || (character > 70 && character < 97))\n\t\t\tbreak\n\n\treturn slice(index, caret() + (count < 6 && peek() == 32 && next() == 32))\n}\n\n/**\n * @param {number} type\n * @return {number}\n */\nexport function delimiter (type) {\n\twhile (next())\n\t\tswitch (character) {\n\t\t\t// ] ) \" '\n\t\t\tcase type:\n\t\t\t\treturn position\n\t\t\t// \" '\n\t\t\tcase 34: case 39:\n\t\t\t\tif (type !== 34 && type !== 39)\n\t\t\t\t\tdelimiter(character)\n\t\t\t\tbreak\n\t\t\t// (\n\t\t\tcase 40:\n\t\t\t\tif (type === 41)\n\t\t\t\t\tdelimiter(type)\n\t\t\t\tbreak\n\t\t\t// \\\n\t\t\tcase 92:\n\t\t\t\tnext()\n\t\t\t\tbreak\n\t\t}\n\n\treturn position\n}\n\n/**\n * @param {number} type\n * @param {number} index\n * @return {number}\n */\nexport function commenter (type, index) {\n\twhile (next())\n\t\t// //\n\t\tif (type + character === 47 + 10)\n\t\t\tbreak\n\t\t// /*\n\t\telse if (type + character === 42 + 42 && peek() === 47)\n\t\t\tbreak\n\n\treturn '/*' + slice(index, position - 1) + '*' + from(type === 47 ? type : next())\n}\n\n/**\n * @param {number} index\n * @return {string}\n */\nexport function identifier (index) {\n\twhile (!token(peek()))\n\t\tnext()\n\n\treturn slice(index, position)\n}\n","import {COMMENT, RULESET, DECLARATION} from './Enum.js'\nimport {abs, charat, trim, from, sizeof, strlen, substr, append, replace, indexof} from './Utility.js'\nimport {node, char, prev, next, peek, caret, alloc, dealloc, delimit, whitespace, escaping, identifier, commenter} from './Tokenizer.js'\n\n/**\n * @param {string} value\n * @return {object[]}\n */\nexport function compile (value) {\n\treturn dealloc(parse('', null, null, null, [''], value = alloc(value), 0, [0], value))\n}\n\n/**\n * @param {string} value\n * @param {object} root\n * @param {object?} parent\n * @param {string[]} rule\n * @param {string[]} rules\n * @param {string[]} rulesets\n * @param {number[]} pseudo\n * @param {number[]} points\n * @param {string[]} declarations\n * @return {object}\n */\nexport function parse (value, root, parent, rule, rules, rulesets, pseudo, points, declarations) {\n\tvar index = 0\n\tvar offset = 0\n\tvar length = pseudo\n\tvar atrule = 0\n\tvar property = 0\n\tvar previous = 0\n\tvar variable = 1\n\tvar scanning = 1\n\tvar ampersand = 1\n\tvar character = 0\n\tvar type = ''\n\tvar props = rules\n\tvar children = rulesets\n\tvar reference = rule\n\tvar characters = type\n\n\twhile (scanning)\n\t\tswitch (previous = character, character = next()) {\n\t\t\t// (\n\t\t\tcase 40:\n\t\t\t\tif (previous != 108 && charat(characters, length - 1) == 58) {\n\t\t\t\t\tif (indexof(characters += replace(delimit(character), '&', '&\\f'), '&\\f') != -1)\n\t\t\t\t\t\tampersand = -1\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t// \" ' [\n\t\t\tcase 34: case 39: case 91:\n\t\t\t\tcharacters += delimit(character)\n\t\t\t\tbreak\n\t\t\t// \\t \\n \\r \\s\n\t\t\tcase 9: case 10: case 13: case 32:\n\t\t\t\tcharacters += whitespace(previous)\n\t\t\t\tbreak\n\t\t\t// \\\n\t\t\tcase 92:\n\t\t\t\tcharacters += escaping(caret() - 1, 7)\n\t\t\t\tcontinue\n\t\t\t// /\n\t\t\tcase 47:\n\t\t\t\tswitch (peek()) {\n\t\t\t\t\tcase 42: case 47:\n\t\t\t\t\t\tappend(comment(commenter(next(), caret()), root, parent), declarations)\n\t\t\t\t\t\tbreak\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tcharacters += '/'\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t// {\n\t\t\tcase 123 * variable:\n\t\t\t\tpoints[index++] = strlen(characters) * ampersand\n\t\t\t// } ; \\0\n\t\t\tcase 125 * variable: case 59: case 0:\n\t\t\t\tswitch (character) {\n\t\t\t\t\t// \\0 }\n\t\t\t\t\tcase 0: case 125: scanning = 0\n\t\t\t\t\t// ;\n\t\t\t\t\tcase 59 + offset: if (ampersand == -1) characters = replace(characters, /\\f/g, '')\n\t\t\t\t\t\tif (property > 0 && (strlen(characters) - length))\n\t\t\t\t\t\t\tappend(property > 32 ? declaration(characters + ';', rule, parent, length - 1) : declaration(replace(characters, ' ', '') + ';', rule, parent, length - 2), declarations)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t// @ ;\n\t\t\t\t\tcase 59: characters += ';'\n\t\t\t\t\t// { rule/at-rule\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tappend(reference = ruleset(characters, root, parent, index, offset, rules, points, type, props = [], children = [], length), rulesets)\n\n\t\t\t\t\t\tif (character === 123)\n\t\t\t\t\t\t\tif (offset === 0)\n\t\t\t\t\t\t\t\tparse(characters, root, reference, reference, props, rulesets, length, points, children)\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tswitch (atrule === 99 && charat(characters, 3) === 110 ? 100 : atrule) {\n\t\t\t\t\t\t\t\t\t// d l m s\n\t\t\t\t\t\t\t\t\tcase 100: case 108: case 109: case 115:\n\t\t\t\t\t\t\t\t\t\tparse(value, reference, reference, rule && append(ruleset(value, reference, reference, 0, 0, rules, points, type, rules, props = [], length), children), rules, children, length, points, rule ? props : children)\n\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\tparse(characters, reference, reference, reference, [''], children, 0, points, children)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tindex = offset = property = 0, variable = ampersand = 1, type = characters = '', length = pseudo\n\t\t\t\tbreak\n\t\t\t// :\n\t\t\tcase 58:\n\t\t\t\tlength = 1 + strlen(characters), property = previous\n\t\t\tdefault:\n\t\t\t\tif (variable < 1)\n\t\t\t\t\tif (character == 123)\n\t\t\t\t\t\t--variable\n\t\t\t\t\telse if (character == 125 && variable++ == 0 && prev() == 125)\n\t\t\t\t\t\tcontinue\n\n\t\t\t\tswitch (characters += from(character), character * variable) {\n\t\t\t\t\t// &\n\t\t\t\t\tcase 38:\n\t\t\t\t\t\tampersand = offset > 0 ? 1 : (characters += '\\f', -1)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t// ,\n\t\t\t\t\tcase 44:\n\t\t\t\t\t\tpoints[index++] = (strlen(characters) - 1) * ampersand, ampersand = 1\n\t\t\t\t\t\tbreak\n\t\t\t\t\t// @\n\t\t\t\t\tcase 64:\n\t\t\t\t\t\t// -\n\t\t\t\t\t\tif (peek() === 45)\n\t\t\t\t\t\t\tcharacters += delimit(next())\n\n\t\t\t\t\t\tatrule = peek(), offset = length = strlen(type = characters += identifier(caret())), character++\n\t\t\t\t\t\tbreak\n\t\t\t\t\t// -\n\t\t\t\t\tcase 45:\n\t\t\t\t\t\tif (previous === 45 && strlen(characters) == 2)\n\t\t\t\t\t\t\tvariable = 0\n\t\t\t\t}\n\t\t}\n\n\treturn rulesets\n}\n\n/**\n * @param {string} value\n * @param {object} root\n * @param {object?} parent\n * @param {number} index\n * @param {number} offset\n * @param {string[]} rules\n * @param {number[]} points\n * @param {string} type\n * @param {string[]} props\n * @param {string[]} children\n * @param {number} length\n * @return {object}\n */\nexport function ruleset (value, root, parent, index, offset, rules, points, type, props, children, length) {\n\tvar post = offset - 1\n\tvar rule = offset === 0 ? rules : ['']\n\tvar size = sizeof(rule)\n\n\tfor (var i = 0, j = 0, k = 0; i < index; ++i)\n\t\tfor (var x = 0, y = substr(value, post + 1, post = abs(j = points[i])), z = value; x < size; ++x)\n\t\t\tif (z = trim(j > 0 ? rule[x] + ' ' + y : replace(y, /&\\f/g, rule[x])))\n\t\t\t\tprops[k++] = z\n\n\treturn node(value, root, parent, offset === 0 ? RULESET : type, props, children, length)\n}\n\n/**\n * @param {number} value\n * @param {object} root\n * @param {object?} parent\n * @return {object}\n */\nexport function comment (value, root, parent) {\n\treturn node(value, root, parent, COMMENT, from(char()), substr(value, 2, -2), 0)\n}\n\n/**\n * @param {string} value\n * @param {object} root\n * @param {object?} parent\n * @param {number} length\n * @return {object}\n */\nexport function declaration (value, root, parent, length) {\n\treturn node(value, root, parent, DECLARATION, substr(value, 0, length), substr(value, length + 1, -1), length)\n}\n","import {MS, MOZ, WEBKIT} from './Enum.js'\nimport {hash, charat, strlen, indexof, replace, substr, match} from './Utility.js'\n\n/**\n * @param {string} value\n * @param {number} length\n * @param {object[]} children\n * @return {string}\n */\nexport function prefix (value, length, children) {\n\tswitch (hash(value, length)) {\n\t\t// color-adjust\n\t\tcase 5103:\n\t\t\treturn WEBKIT + 'print-' + value + value\n\t\t// animation, animation-(delay|direction|duration|fill-mode|iteration-count|name|play-state|timing-function)\n\t\tcase 5737: case 4201: case 3177: case 3433: case 1641: case 4457: case 2921:\n\t\t// text-decoration, filter, clip-path, backface-visibility, column, box-decoration-break\n\t\tcase 5572: case 6356: case 5844: case 3191: case 6645: case 3005:\n\t\t// mask, mask-image, mask-(mode|clip|size), mask-(repeat|origin), mask-position, mask-composite,\n\t\tcase 6391: case 5879: case 5623: case 6135: case 4599: case 4855:\n\t\t// background-clip, columns, column-(count|fill|gap|rule|rule-color|rule-style|rule-width|span|width)\n\t\tcase 4215: case 6389: case 5109: case 5365: case 5621: case 3829:\n\t\t\treturn WEBKIT + value + value\n\t\t// tab-size\n\t\tcase 4789:\n\t\t\treturn MOZ + value + value\n\t\t// appearance, user-select, transform, hyphens, text-size-adjust\n\t\tcase 5349: case 4246: case 4810: case 6968: case 2756:\n\t\t\treturn WEBKIT + value + MOZ + value + MS + value + value\n\t\t// writing-mode\n\t\tcase 5936:\n\t\t\tswitch (charat(value, length + 11)) {\n\t\t\t\t// vertical-l(r)\n\t\t\t\tcase 114:\n\t\t\t\t\treturn WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'tb') + value\n\t\t\t\t// vertical-r(l)\n\t\t\t\tcase 108:\n\t\t\t\t\treturn WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'tb-rl') + value\n\t\t\t\t// horizontal(-)tb\n\t\t\t\tcase 45:\n\t\t\t\t\treturn WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'lr') + value\n\t\t\t\t// default: fallthrough to below\n\t\t\t}\n\t\t// flex, flex-direction, scroll-snap-type, writing-mode\n\t\tcase 6828: case 4268: case 2903:\n\t\t\treturn WEBKIT + value + MS + value + value\n\t\t// order\n\t\tcase 6165:\n\t\t\treturn WEBKIT + value + MS + 'flex-' + value + value\n\t\t// align-items\n\t\tcase 5187:\n\t\t\treturn WEBKIT + value + replace(value, /(\\w+).+(:[^]+)/, WEBKIT + 'box-$1$2' + MS + 'flex-$1$2') + value\n\t\t// align-self\n\t\tcase 5443:\n\t\t\treturn WEBKIT + value + MS + 'flex-item-' + replace(value, /flex-|-self/g, '') + (!match(value, /flex-|baseline/) ? MS + 'grid-row-' + replace(value, /flex-|-self/g, '') : '') + value\n\t\t// align-content\n\t\tcase 4675:\n\t\t\treturn WEBKIT + value + MS + 'flex-line-pack' + replace(value, /align-content|flex-|-self/g, '') + value\n\t\t// flex-shrink\n\t\tcase 5548:\n\t\t\treturn WEBKIT + value + MS + replace(value, 'shrink', 'negative') + value\n\t\t// flex-basis\n\t\tcase 5292:\n\t\t\treturn WEBKIT + value + MS + replace(value, 'basis', 'preferred-size') + value\n\t\t// flex-grow\n\t\tcase 6060:\n\t\t\treturn WEBKIT + 'box-' + replace(value, '-grow', '') + WEBKIT + value + MS + replace(value, 'grow', 'positive') + value\n\t\t// transition\n\t\tcase 4554:\n\t\t\treturn WEBKIT + replace(value, /([^-])(transform)/g, '$1' + WEBKIT + '$2') + value\n\t\t// cursor\n\t\tcase 6187:\n\t\t\treturn replace(replace(replace(value, /(zoom-|grab)/, WEBKIT + '$1'), /(image-set)/, WEBKIT + '$1'), value, '') + value\n\t\t// background, background-image\n\t\tcase 5495: case 3959:\n\t\t\treturn replace(value, /(image-set\\([^]*)/, WEBKIT + '$1' + '$`$1')\n\t\t// justify-content\n\t\tcase 4968:\n\t\t\treturn replace(replace(value, /(.+:)(flex-)?(.*)/, WEBKIT + 'box-pack:$3' + MS + 'flex-pack:$3'), /s.+-b[^;]+/, 'justify') + WEBKIT + value + value\n\t\t// justify-self\n\t\tcase 4200:\n\t\t\tif (!match(value, /flex-|baseline/)) return MS + 'grid-column-align' + substr(value, length) + value\n\t\t\tbreak\n\t\t// grid-template-(columns|rows)\n\t\tcase 2592: case 3360:\n\t\t\treturn MS + replace(value, 'template-', '') + value\n\t\t// grid-(row|column)-start\n\t\tcase 4384: case 3616:\n\t\t\tif (children && children.some(function (element, index) { return length = index, match(element.props, /grid-\\w+-end/) })) {\n\t\t\t\treturn ~indexof(value + (children = children[length].value), 'span') ? value : (MS + replace(value, '-start', '') + value + MS + 'grid-row-span:' + (~indexof(children, 'span') ? match(children, /\\d+/) : +match(children, /\\d+/) - +match(value, /\\d+/)) + ';')\n\t\t\t}\n\t\t\treturn MS + replace(value, '-start', '') + value\n\t\t// grid-(row|column)-end\n\t\tcase 4896: case 4128:\n\t\t\treturn (children && children.some(function (element) { return match(element.props, /grid-\\w+-start/) })) ? value : MS + replace(replace(value, '-end', '-span'), 'span ', '') + value\n\t\t// (margin|padding)-inline-(start|end)\n\t\tcase 4095: case 3583: case 4068: case 2532:\n\t\t\treturn replace(value, /(.+)-inline(.+)/, WEBKIT + '$1$2') + value\n\t\t// (min|max)?(width|height|inline-size|block-size)\n\t\tcase 8116: case 7059: case 5753: case 5535:\n\t\tcase 5445: case 5701: case 4933: case 4677:\n\t\tcase 5533: case 5789: case 5021: case 4765:\n\t\t\t// stretch, max-content, min-content, fill-available\n\t\t\tif (strlen(value) - 1 - length > 6)\n\t\t\t\tswitch (charat(value, length + 1)) {\n\t\t\t\t\t// (m)ax-content, (m)in-content\n\t\t\t\t\tcase 109:\n\t\t\t\t\t\t// -\n\t\t\t\t\t\tif (charat(value, length + 4) !== 45)\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t// (f)ill-available, (f)it-content\n\t\t\t\t\tcase 102:\n\t\t\t\t\t\treturn replace(value, /(.+:)(.+)-([^]+)/, '$1' + WEBKIT + '$2-$3' + '$1' + MOZ + (charat(value, length + 3) == 108 ? '$3' : '$2-$3')) + value\n\t\t\t\t\t// (s)tretch\n\t\t\t\t\tcase 115:\n\t\t\t\t\t\treturn ~indexof(value, 'stretch') ? prefix(replace(value, 'stretch', 'fill-available'), length, children) + value : value\n\t\t\t\t}\n\t\t\tbreak\n\t\t// grid-(column|row)\n\t\tcase 5152: case 5920:\n\t\t\treturn replace(value, /(.+?):(\\d+)(\\s*\\/\\s*(span)?\\s*(\\d+))?(.*)/, function (_, a, b, c, d, e, f) { return (MS + a + ':' + b + f) + (c ? (MS + a + '-span:' + (d ? e : +e - +b)) + f : '') + value })\n\t\t// position: sticky\n\t\tcase 4949:\n\t\t\t// stick(y)?\n\t\t\tif (charat(value, length + 6) === 121)\n\t\t\t\treturn replace(value, ':', ':' + WEBKIT) + value\n\t\t\tbreak\n\t\t// display: (flex|inline-flex|grid|inline-grid)\n\t\tcase 6444:\n\t\t\tswitch (charat(value, charat(value, 14) === 45 ? 18 : 11)) {\n\t\t\t\t// (inline-)?fle(x)\n\t\t\t\tcase 120:\n\t\t\t\t\treturn replace(value, /(.+:)([^;\\s!]+)(;|(\\s+)?!.+)?/, '$1' + WEBKIT + (charat(value, 14) === 45 ? 'inline-' : '') + 'box$3' + '$1' + WEBKIT + '$2$3' + '$1' + MS + '$2box$3') + value\n\t\t\t\t// (inline-)?gri(d)\n\t\t\t\tcase 100:\n\t\t\t\t\treturn replace(value, ':', ':' + MS) + value\n\t\t\t}\n\t\t\tbreak\n\t\t// scroll-margin, scroll-margin-(top|right|bottom|left)\n\t\tcase 5719: case 2647: case 2135: case 3927: case 2391:\n\t\t\treturn replace(value, 'scroll-', 'scroll-snap-') + value\n\t}\n\n\treturn value\n}\n","import {IMPORT, LAYER, COMMENT, RULESET, DECLARATION, KEYFRAMES} from './Enum.js'\nimport {strlen, sizeof} from './Utility.js'\n\n/**\n * @param {object[]} children\n * @param {function} callback\n * @return {string}\n */\nexport function serialize (children, callback) {\n\tvar output = ''\n\tvar length = sizeof(children)\n\n\tfor (var i = 0; i < length; i++)\n\t\toutput += callback(children[i], i, children, callback) || ''\n\n\treturn output\n}\n\n/**\n * @param {object} element\n * @param {number} index\n * @param {object[]} children\n * @param {function} callback\n * @return {string}\n */\nexport function stringify (element, index, children, callback) {\n\tswitch (element.type) {\n\t\tcase LAYER: if (element.children.length) break\n\t\tcase IMPORT: case DECLARATION: return element.return = element.return || element.value\n\t\tcase COMMENT: return ''\n\t\tcase KEYFRAMES: return element.return = element.value + '{' + serialize(element.children, callback) + '}'\n\t\tcase RULESET: element.value = element.props.join(',')\n\t}\n\n\treturn strlen(children = serialize(element.children, callback)) ? element.return = element.value + '{' + children + '}' : ''\n}\n","import {MS, MOZ, WEBKIT, RULESET, KEYFRAMES, DECLARATION} from './Enum.js'\nimport {match, charat, substr, strlen, sizeof, replace, combine} from './Utility.js'\nimport {copy, tokenize} from './Tokenizer.js'\nimport {serialize} from './Serializer.js'\nimport {prefix} from './Prefixer.js'\n\n/**\n * @param {function[]} collection\n * @return {function}\n */\nexport function middleware (collection) {\n\tvar length = sizeof(collection)\n\n\treturn function (element, index, children, callback) {\n\t\tvar output = ''\n\n\t\tfor (var i = 0; i < length; i++)\n\t\t\toutput += collection[i](element, index, children, callback) || ''\n\n\t\treturn output\n\t}\n}\n\n/**\n * @param {function} callback\n * @return {function}\n */\nexport function rulesheet (callback) {\n\treturn function (element) {\n\t\tif (!element.root)\n\t\t\tif (element = element.return)\n\t\t\t\tcallback(element)\n\t}\n}\n\n/**\n * @param {object} element\n * @param {number} index\n * @param {object[]} children\n * @param {function} callback\n */\nexport function prefixer (element, index, children, callback) {\n\tif (element.length > -1)\n\t\tif (!element.return)\n\t\t\tswitch (element.type) {\n\t\t\t\tcase DECLARATION: element.return = prefix(element.value, element.length, children)\n\t\t\t\t\treturn\n\t\t\t\tcase KEYFRAMES:\n\t\t\t\t\treturn serialize([copy(element, {value: replace(element.value, '@', '@' + WEBKIT)})], callback)\n\t\t\t\tcase RULESET:\n\t\t\t\t\tif (element.length)\n\t\t\t\t\t\treturn combine(element.props, function (value) {\n\t\t\t\t\t\t\tswitch (match(value, /(::plac\\w+|:read-\\w+)/)) {\n\t\t\t\t\t\t\t\t// :read-(only|write)\n\t\t\t\t\t\t\t\tcase ':read-only': case ':read-write':\n\t\t\t\t\t\t\t\t\treturn serialize([copy(element, {props: [replace(value, /:(read-\\w+)/, ':' + MOZ + '$1')]})], callback)\n\t\t\t\t\t\t\t\t// :placeholder\n\t\t\t\t\t\t\t\tcase '::placeholder':\n\t\t\t\t\t\t\t\t\treturn serialize([\n\t\t\t\t\t\t\t\t\t\tcopy(element, {props: [replace(value, /:(plac\\w+)/, ':' + WEBKIT + 'input-$1')]}),\n\t\t\t\t\t\t\t\t\t\tcopy(element, {props: [replace(value, /:(plac\\w+)/, ':' + MOZ + '$1')]}),\n\t\t\t\t\t\t\t\t\t\tcopy(element, {props: [replace(value, /:(plac\\w+)/, MS + 'input-$1')]})\n\t\t\t\t\t\t\t\t\t], callback)\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn ''\n\t\t\t\t\t\t})\n\t\t\t}\n}\n\n/**\n * @param {object} element\n * @param {number} index\n * @param {object[]} children\n */\nexport function namespace (element) {\n\tswitch (element.type) {\n\t\tcase RULESET:\n\t\t\telement.props = element.props.map(function (value) {\n\t\t\t\treturn combine(tokenize(value), function (value, index, children) {\n\t\t\t\t\tswitch (charat(value, 0)) {\n\t\t\t\t\t\t// \\f\n\t\t\t\t\t\tcase 12:\n\t\t\t\t\t\t\treturn substr(value, 1, strlen(value))\n\t\t\t\t\t\t// \\0 ( + > ~\n\t\t\t\t\t\tcase 0: case 40: case 43: case 62: case 126:\n\t\t\t\t\t\t\treturn value\n\t\t\t\t\t\t// :\n\t\t\t\t\t\tcase 58:\n\t\t\t\t\t\t\tif (children[++index] === 'global')\n\t\t\t\t\t\t\t\tchildren[index] = '', children[++index] = '\\f' + substr(children[index], index = 1, -1)\n\t\t\t\t\t\t// \\s\n\t\t\t\t\t\tcase 32:\n\t\t\t\t\t\t\treturn index === 1 ? '' : value\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tswitch (index) {\n\t\t\t\t\t\t\t\tcase 0: element = value\n\t\t\t\t\t\t\t\t\treturn sizeof(children) > 1 ? '' : value\n\t\t\t\t\t\t\t\tcase index = sizeof(children) - 1: case 2:\n\t\t\t\t\t\t\t\t\treturn index === 2 ? value + element + element : value + element\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\treturn value\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t}\n}\n","var weakMemoize = function weakMemoize(func) {\n  // $FlowFixMe flow doesn't include all non-primitive types as allowed for weakmaps\n  var cache = new WeakMap();\n  return function (arg) {\n    if (cache.has(arg)) {\n      // $FlowFixMe\n      return cache.get(arg);\n    }\n\n    var ret = func(arg);\n    cache.set(arg, ret);\n    return ret;\n  };\n};\n\nexport { weakMemoize as default };\n","function memoize(fn) {\n  var cache = Object.create(null);\n  return function (arg) {\n    if (cache[arg] === undefined) cache[arg] = fn(arg);\n    return cache[arg];\n  };\n}\n\nexport { memoize as default };\n","import hashString from '@emotion/hash';\nimport unitless from '@emotion/unitless';\nimport memoize from '@emotion/memoize';\n\nvar ILLEGAL_ESCAPE_SEQUENCE_ERROR = \"You have illegal escape sequence in your template literal, most likely inside content's property value.\\nBecause you write your CSS inside a JavaScript string you actually have to do double escaping, so for example \\\"content: '\\\\00d7';\\\" should become \\\"content: '\\\\\\\\00d7';\\\".\\nYou can read more about this here:\\nhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#ES2018_revision_of_illegal_escape_sequences\";\nvar UNDEFINED_AS_OBJECT_KEY_ERROR = \"You have passed in falsy value as style object's key (can happen when in example you pass unexported component as computed key).\";\nvar hyphenateRegex = /[A-Z]|^ms/g;\nvar animationRegex = /_EMO_([^_]+?)_([^]*?)_EMO_/g;\n\nvar isCustomProperty = function isCustomProperty(property) {\n  return property.charCodeAt(1) === 45;\n};\n\nvar isProcessableValue = function isProcessableValue(value) {\n  return value != null && typeof value !== 'boolean';\n};\n\nvar processStyleName = /* #__PURE__ */memoize(function (styleName) {\n  return isCustomProperty(styleName) ? styleName : styleName.replace(hyphenateRegex, '-$&').toLowerCase();\n});\n\nvar processStyleValue = function processStyleValue(key, value) {\n  switch (key) {\n    case 'animation':\n    case 'animationName':\n      {\n        if (typeof value === 'string') {\n          return value.replace(animationRegex, function (match, p1, p2) {\n            cursor = {\n              name: p1,\n              styles: p2,\n              next: cursor\n            };\n            return p1;\n          });\n        }\n      }\n  }\n\n  if (unitless[key] !== 1 && !isCustomProperty(key) && typeof value === 'number' && value !== 0) {\n    return value + 'px';\n  }\n\n  return value;\n};\n\nif (process.env.NODE_ENV !== 'production') {\n  var contentValuePattern = /(var|attr|counters?|url|element|(((repeating-)?(linear|radial))|conic)-gradient)\\(|(no-)?(open|close)-quote/;\n  var contentValues = ['normal', 'none', 'initial', 'inherit', 'unset'];\n  var oldProcessStyleValue = processStyleValue;\n  var msPattern = /^-ms-/;\n  var hyphenPattern = /-(.)/g;\n  var hyphenatedCache = {};\n\n  processStyleValue = function processStyleValue(key, value) {\n    if (key === 'content') {\n      if (typeof value !== 'string' || contentValues.indexOf(value) === -1 && !contentValuePattern.test(value) && (value.charAt(0) !== value.charAt(value.length - 1) || value.charAt(0) !== '\"' && value.charAt(0) !== \"'\")) {\n        throw new Error(\"You seem to be using a value for 'content' without quotes, try replacing it with `content: '\\\"\" + value + \"\\\"'`\");\n      }\n    }\n\n    var processed = oldProcessStyleValue(key, value);\n\n    if (processed !== '' && !isCustomProperty(key) && key.indexOf('-') !== -1 && hyphenatedCache[key] === undefined) {\n      hyphenatedCache[key] = true;\n      console.error(\"Using kebab-case for css properties in objects is not supported. Did you mean \" + key.replace(msPattern, 'ms-').replace(hyphenPattern, function (str, _char) {\n        return _char.toUpperCase();\n      }) + \"?\");\n    }\n\n    return processed;\n  };\n}\n\nvar noComponentSelectorMessage = 'Component selectors can only be used in conjunction with ' + '@emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware ' + 'compiler transform.';\n\nfunction handleInterpolation(mergedProps, registered, interpolation) {\n  if (interpolation == null) {\n    return '';\n  }\n\n  if (interpolation.__emotion_styles !== undefined) {\n    if (process.env.NODE_ENV !== 'production' && interpolation.toString() === 'NO_COMPONENT_SELECTOR') {\n      throw new Error(noComponentSelectorMessage);\n    }\n\n    return interpolation;\n  }\n\n  switch (typeof interpolation) {\n    case 'boolean':\n      {\n        return '';\n      }\n\n    case 'object':\n      {\n        if (interpolation.anim === 1) {\n          cursor = {\n            name: interpolation.name,\n            styles: interpolation.styles,\n            next: cursor\n          };\n          return interpolation.name;\n        }\n\n        if (interpolation.styles !== undefined) {\n          var next = interpolation.next;\n\n          if (next !== undefined) {\n            // not the most efficient thing ever but this is a pretty rare case\n            // and there will be very few iterations of this generally\n            while (next !== undefined) {\n              cursor = {\n                name: next.name,\n                styles: next.styles,\n                next: cursor\n              };\n              next = next.next;\n            }\n          }\n\n          var styles = interpolation.styles + \";\";\n\n          if (process.env.NODE_ENV !== 'production' && interpolation.map !== undefined) {\n            styles += interpolation.map;\n          }\n\n          return styles;\n        }\n\n        return createStringFromObject(mergedProps, registered, interpolation);\n      }\n\n    case 'function':\n      {\n        if (mergedProps !== undefined) {\n          var previousCursor = cursor;\n          var result = interpolation(mergedProps);\n          cursor = previousCursor;\n          return handleInterpolation(mergedProps, registered, result);\n        } else if (process.env.NODE_ENV !== 'production') {\n          console.error('Functions that are interpolated in css calls will be stringified.\\n' + 'If you want to have a css call based on props, create a function that returns a css call like this\\n' + 'let dynamicStyle = (props) => css`color: ${props.color}`\\n' + 'It can be called directly with props or interpolated in a styled call like this\\n' + \"let SomeComponent = styled('div')`${dynamicStyle}`\");\n        }\n\n        break;\n      }\n\n    case 'string':\n      if (process.env.NODE_ENV !== 'production') {\n        var matched = [];\n        var replaced = interpolation.replace(animationRegex, function (match, p1, p2) {\n          var fakeVarName = \"animation\" + matched.length;\n          matched.push(\"const \" + fakeVarName + \" = keyframes`\" + p2.replace(/^@keyframes animation-\\w+/, '') + \"`\");\n          return \"${\" + fakeVarName + \"}\";\n        });\n\n        if (matched.length) {\n          console.error('`keyframes` output got interpolated into plain string, please wrap it with `css`.\\n\\n' + 'Instead of doing this:\\n\\n' + [].concat(matched, [\"`\" + replaced + \"`\"]).join('\\n') + '\\n\\nYou should wrap it with `css` like this:\\n\\n' + (\"css`\" + replaced + \"`\"));\n        }\n      }\n\n      break;\n  } // finalize string values (regular strings and functions interpolated into css calls)\n\n\n  if (registered == null) {\n    return interpolation;\n  }\n\n  var cached = registered[interpolation];\n  return cached !== undefined ? cached : interpolation;\n}\n\nfunction createStringFromObject(mergedProps, registered, obj) {\n  var string = '';\n\n  if (Array.isArray(obj)) {\n    for (var i = 0; i < obj.length; i++) {\n      string += handleInterpolation(mergedProps, registered, obj[i]) + \";\";\n    }\n  } else {\n    for (var _key in obj) {\n      var value = obj[_key];\n\n      if (typeof value !== 'object') {\n        if (registered != null && registered[value] !== undefined) {\n          string += _key + \"{\" + registered[value] + \"}\";\n        } else if (isProcessableValue(value)) {\n          string += processStyleName(_key) + \":\" + processStyleValue(_key, value) + \";\";\n        }\n      } else {\n        if (_key === 'NO_COMPONENT_SELECTOR' && process.env.NODE_ENV !== 'production') {\n          throw new Error(noComponentSelectorMessage);\n        }\n\n        if (Array.isArray(value) && typeof value[0] === 'string' && (registered == null || registered[value[0]] === undefined)) {\n          for (var _i = 0; _i < value.length; _i++) {\n            if (isProcessableValue(value[_i])) {\n              string += processStyleName(_key) + \":\" + processStyleValue(_key, value[_i]) + \";\";\n            }\n          }\n        } else {\n          var interpolated = handleInterpolation(mergedProps, registered, value);\n\n          switch (_key) {\n            case 'animation':\n            case 'animationName':\n              {\n                string += processStyleName(_key) + \":\" + interpolated + \";\";\n                break;\n              }\n\n            default:\n              {\n                if (process.env.NODE_ENV !== 'production' && _key === 'undefined') {\n                  console.error(UNDEFINED_AS_OBJECT_KEY_ERROR);\n                }\n\n                string += _key + \"{\" + interpolated + \"}\";\n              }\n          }\n        }\n      }\n    }\n  }\n\n  return string;\n}\n\nvar labelPattern = /label:\\s*([^\\s;\\n{]+)\\s*(;|$)/g;\nvar sourceMapPattern;\n\nif (process.env.NODE_ENV !== 'production') {\n  sourceMapPattern = /\\/\\*#\\ssourceMappingURL=data:application\\/json;\\S+\\s+\\*\\//g;\n} // this is the cursor for keyframes\n// keyframes are stored on the SerializedStyles object as a linked list\n\n\nvar cursor;\nvar serializeStyles = function serializeStyles(args, registered, mergedProps) {\n  if (args.length === 1 && typeof args[0] === 'object' && args[0] !== null && args[0].styles !== undefined) {\n    return args[0];\n  }\n\n  var stringMode = true;\n  var styles = '';\n  cursor = undefined;\n  var strings = args[0];\n\n  if (strings == null || strings.raw === undefined) {\n    stringMode = false;\n    styles += handleInterpolation(mergedProps, registered, strings);\n  } else {\n    if (process.env.NODE_ENV !== 'production' && strings[0] === undefined) {\n      console.error(ILLEGAL_ESCAPE_SEQUENCE_ERROR);\n    }\n\n    styles += strings[0];\n  } // we start at 1 since we've already handled the first arg\n\n\n  for (var i = 1; i < args.length; i++) {\n    styles += handleInterpolation(mergedProps, registered, args[i]);\n\n    if (stringMode) {\n      if (process.env.NODE_ENV !== 'production' && strings[i] === undefined) {\n        console.error(ILLEGAL_ESCAPE_SEQUENCE_ERROR);\n      }\n\n      styles += strings[i];\n    }\n  }\n\n  var sourceMap;\n\n  if (process.env.NODE_ENV !== 'production') {\n    styles = styles.replace(sourceMapPattern, function (match) {\n      sourceMap = match;\n      return '';\n    });\n  } // using a global regex with .exec is stateful so lastIndex has to be reset each time\n\n\n  labelPattern.lastIndex = 0;\n  var identifierName = '';\n  var match; // https://esbench.com/bench/5b809c2cf2949800a0f61fb5\n\n  while ((match = labelPattern.exec(styles)) !== null) {\n    identifierName += '-' + // $FlowFixMe we know it's not null\n    match[1];\n  }\n\n  var name = hashString(styles) + identifierName;\n\n  if (process.env.NODE_ENV !== 'production') {\n    // $FlowFixMe SerializedStyles type doesn't have toString property (and we don't want to add it)\n    return {\n      name: name,\n      styles: styles,\n      map: sourceMap,\n      next: cursor,\n      toString: function toString() {\n        return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\";\n      }\n    };\n  }\n\n  return {\n    name: name,\n    styles: styles,\n    next: cursor\n  };\n};\n\nexport { serializeStyles };\n","/* eslint-disable */\n// Inspired by https://github.com/garycourt/murmurhash-js\n// Ported from https://github.com/aappleby/smhasher/blob/61a0530f28277f2e850bfc39600ce61d02b518de/src/MurmurHash2.cpp#L37-L86\nfunction murmur2(str) {\n  // 'm' and 'r' are mixing constants generated offline.\n  // They're not really 'magic', they just happen to work well.\n  // const m = 0x5bd1e995;\n  // const r = 24;\n  // Initialize the hash\n  var h = 0; // Mix 4 bytes at a time into the hash\n\n  var k,\n      i = 0,\n      len = str.length;\n\n  for (; len >= 4; ++i, len -= 4) {\n    k = str.charCodeAt(i) & 0xff | (str.charCodeAt(++i) & 0xff) << 8 | (str.charCodeAt(++i) & 0xff) << 16 | (str.charCodeAt(++i) & 0xff) << 24;\n    k =\n    /* Math.imul(k, m): */\n    (k & 0xffff) * 0x5bd1e995 + ((k >>> 16) * 0xe995 << 16);\n    k ^=\n    /* k >>> r: */\n    k >>> 24;\n    h =\n    /* Math.imul(k, m): */\n    (k & 0xffff) * 0x5bd1e995 + ((k >>> 16) * 0xe995 << 16) ^\n    /* Math.imul(h, m): */\n    (h & 0xffff) * 0x5bd1e995 + ((h >>> 16) * 0xe995 << 16);\n  } // Handle the last few bytes of the input array\n\n\n  switch (len) {\n    case 3:\n      h ^= (str.charCodeAt(i + 2) & 0xff) << 16;\n\n    case 2:\n      h ^= (str.charCodeAt(i + 1) & 0xff) << 8;\n\n    case 1:\n      h ^= str.charCodeAt(i) & 0xff;\n      h =\n      /* Math.imul(h, m): */\n      (h & 0xffff) * 0x5bd1e995 + ((h >>> 16) * 0xe995 << 16);\n  } // Do a few final mixes of the hash to ensure the last few\n  // bytes are well-incorporated.\n\n\n  h ^= h >>> 13;\n  h =\n  /* Math.imul(h, m): */\n  (h & 0xffff) * 0x5bd1e995 + ((h >>> 16) * 0xe995 << 16);\n  return ((h ^ h >>> 15) >>> 0).toString(36);\n}\n\nexport { murmur2 as default };\n","var unitlessKeys = {\n  animationIterationCount: 1,\n  aspectRatio: 1,\n  borderImageOutset: 1,\n  borderImageSlice: 1,\n  borderImageWidth: 1,\n  boxFlex: 1,\n  boxFlexGroup: 1,\n  boxOrdinalGroup: 1,\n  columnCount: 1,\n  columns: 1,\n  flex: 1,\n  flexGrow: 1,\n  flexPositive: 1,\n  flexShrink: 1,\n  flexNegative: 1,\n  flexOrder: 1,\n  gridRow: 1,\n  gridRowEnd: 1,\n  gridRowSpan: 1,\n  gridRowStart: 1,\n  gridColumn: 1,\n  gridColumnEnd: 1,\n  gridColumnSpan: 1,\n  gridColumnStart: 1,\n  msGridRow: 1,\n  msGridRowSpan: 1,\n  msGridColumn: 1,\n  msGridColumnSpan: 1,\n  fontWeight: 1,\n  lineHeight: 1,\n  opacity: 1,\n  order: 1,\n  orphans: 1,\n  tabSize: 1,\n  widows: 1,\n  zIndex: 1,\n  zoom: 1,\n  WebkitLineClamp: 1,\n  // SVG-related properties\n  fillOpacity: 1,\n  floodOpacity: 1,\n  stopOpacity: 1,\n  strokeDasharray: 1,\n  strokeDashoffset: 1,\n  strokeMiterlimit: 1,\n  strokeOpacity: 1,\n  strokeWidth: 1\n};\n\nexport { unitlessKeys as default };\n","var isBrowser = \"object\" !== 'undefined';\nfunction getRegisteredStyles(registered, registeredStyles, classNames) {\n  var rawClassName = '';\n  classNames.split(' ').forEach(function (className) {\n    if (registered[className] !== undefined) {\n      registeredStyles.push(registered[className] + \";\");\n    } else {\n      rawClassName += className + \" \";\n    }\n  });\n  return rawClassName;\n}\nvar registerStyles = function registerStyles(cache, serialized, isStringTag) {\n  var className = cache.key + \"-\" + serialized.name;\n\n  if ( // we only need to add the styles to the registered cache if the\n  // class name could be used further down\n  // the tree but if it's a string tag, we know it won't\n  // so we don't have to add it to registered cache.\n  // this improves memory usage since we can avoid storing the whole style string\n  (isStringTag === false || // we need to always store it if we're in compat mode and\n  // in node since emotion-server relies on whether a style is in\n  // the registered cache to know whether a style is global or not\n  // also, note that this check will be dead code eliminated in the browser\n  isBrowser === false ) && cache.registered[className] === undefined) {\n    cache.registered[className] = serialized.styles;\n  }\n};\nvar insertStyles = function insertStyles(cache, serialized, isStringTag) {\n  registerStyles(cache, serialized, isStringTag);\n  var className = cache.key + \"-\" + serialized.name;\n\n  if (cache.inserted[serialized.name] === undefined) {\n    var current = serialized;\n\n    do {\n      cache.insert(serialized === current ? \".\" + className : '', current, cache.sheet, true);\n\n      current = current.next;\n    } while (current !== undefined);\n  }\n};\n\nexport { getRegisteredStyles, insertStyles, registerStyles };\n","import {BB} from '../../../bb/bb';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {showModal} from './base/showModal';\r\nimport {LANG} from '../../../language/language';\r\nimport {IKeyString, IRect} from '../../../bb/bb-types';\r\nimport {IKlPsd, TKlPsdError} from '../../kl-types';\r\n\r\n/**\r\n * Shows first dialog when importing an image.\r\n * Where you can crop, and select import as layer or as image.\r\n */\r\nexport function showImportImageDialog (\r\n    p: {\r\n        image: IKlPsd | {\r\n            type: 'image';\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLImageElement | HTMLCanvasElement;\r\n        };\r\n        maxSize: number;\r\n        target: HTMLElement;\r\n        callback: (\r\n            val: {\r\n                type: 'as-image' | 'as-layer';\r\n                image: HTMLImageElement | HTMLCanvasElement;\r\n            } | {\r\n                type: 'as-image-psd';\r\n                image: IKlPsd;\r\n                cropObj: IRect;\r\n            } | {\r\n                type: 'cancel';\r\n            }\r\n        ) => void;\r\n    }\r\n): void {\r\n    const rootEl = BB.el();\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n    const style: IKeyString = isSmall ? {} : { width: '540px' };\r\n\r\n    const resolutionEl = BB.el({\r\n        css: {\r\n            marginTop: '10px',\r\n            textAlign: 'center',\r\n            color: '#888',\r\n            lineHeight: '20px',\r\n        },\r\n    });\r\n\r\n    const cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 400,\r\n        canvas: p.image.canvas,\r\n        isNotCopy: true,\r\n        onChange: (width, height): void => {\r\n            if (!resolutionEl) {\r\n                return;\r\n            }\r\n            updateResolution(width, height);\r\n        },\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginLeft: '-20px',\r\n    });\r\n    cropCopy.getEl().title = LANG('crop-drag-to-crop');\r\n\r\n    rootEl.append(cropCopy.getEl(), resolutionEl);\r\n\r\n    function updateResolution (w: number, h: number): void {\r\n        const fit = BB.fitInto(w, h, p.maxSize, p.maxSize);\r\n\r\n        if (fit.width < w) {\r\n            resolutionEl.innerHTML = `<span class=\"kl-text-error\">${w} X ${h}</span>  ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\r\n            resolutionEl.title = LANG('import-too-large');\r\n        } else {\r\n            resolutionEl.innerHTML = `${w} X ${h}`;\r\n            resolutionEl.title = '';\r\n        }\r\n    }\r\n    updateResolution(p.image.width, p.image.height);\r\n\r\n\r\n    let doFlatten = false;\r\n    function showWarnings (psdWarningArr: TKlPsdError[]): void {\r\n        const contentArr = [];\r\n        const warningMap = {\r\n            'mask': 'Masks not supported. Mask was applied.',\r\n            'clipping': 'Clipping not supported. Clipping layers were merged.',\r\n            'group': 'Groups not supported. Layers were ungrouped.',\r\n            'adjustment': 'Adjustment layers not supported.',\r\n            'layer-effect': 'Layer effects not supported.',\r\n            'smart-object': 'Smart objects not supported.',\r\n            'blend-mode': 'Unsupported layer blend mode.',\r\n            'bits-per-channel': 'Unsupported color depth. Only 8bit per channel supported.',\r\n        };\r\n        for (let i = 0; i < psdWarningArr.length; i++) {\r\n            contentArr.push('- ' + warningMap[psdWarningArr[i]]);\r\n        }\r\n        alert(contentArr.join('\\n'));\r\n    }\r\n\r\n    let flattenCheckbox: Checkbox;\r\n    let warningsEl: HTMLElement | undefined;\r\n    if (p.image.type === 'psd') {\r\n        if (p.image.layers) {\r\n            flattenCheckbox = new Checkbox({\r\n                init: doFlatten,\r\n                label: LANG('import-flatten'),\r\n                callback: (b): void => {\r\n                    doFlatten = b;\r\n                },\r\n            });\r\n            rootEl.append(flattenCheckbox.getElement());\r\n\r\n            if (p.image.warningArr) {\r\n                const noteEl = BB.el({\r\n                    className: 'kl-import-note',\r\n                    content: LANG('import-psd-limited-support'),\r\n                });\r\n                const warnings = p.image.warningArr;\r\n                warningsEl = BB.el({\r\n                    parent: noteEl,\r\n                    tagName: 'a',\r\n                    content: 'Details',\r\n                    css: { marginLeft: '5px'},\r\n                    onClick: () => showWarnings(warnings),\r\n                });\r\n                rootEl.append(noteEl);\r\n            }\r\n        } else {\r\n            const noteEl = BB.el({\r\n                className: 'kl-import-note',\r\n                content: LANG('import-psd-unsupported'),\r\n            });\r\n            rootEl.append(noteEl);\r\n        }\r\n    }\r\n\r\n    function callback (result: string): void {\r\n        const croppedImage = cropCopy.getCroppedImage();\r\n        const cropRect = cropCopy.getRect();\r\n        const isCropped = p.image.width !== cropRect.width && p.image.height !== cropRect.height;\r\n        cropCopy.destroy();\r\n        BB.destroyEl(warningsEl);\r\n        if (flattenCheckbox) {\r\n            flattenCheckbox.destroy();\r\n        }\r\n\r\n        if (result === LANG('import-btn-as-layer')) {\r\n            p.callback({\r\n                type: 'as-layer',\r\n                image: isCropped ? croppedImage : p.image.canvas,\r\n            });\r\n\r\n        } else if (result === LANG('import-btn-as-image')) {\r\n            if (p.image.type === 'psd') {\r\n                if (doFlatten) {\r\n                    delete p.image.layers;\r\n                }\r\n                p.callback({\r\n                    type: 'as-image-psd',\r\n                    image: p.image,\r\n                    cropObj: cropRect,\r\n                });\r\n            } else if (p.image.type === 'image') {\r\n                p.callback({\r\n                    type: 'as-image',\r\n                    image: croppedImage,\r\n                });\r\n            }\r\n        } else {\r\n            p.callback({\r\n                type: 'cancel',\r\n            });\r\n        }\r\n    }\r\n    showModal({\r\n        target: p.target,\r\n        message: `<b>${LANG('import-title')}</b>`,\r\n        div: rootEl,\r\n        style,\r\n        buttons: [LANG('import-btn-as-layer'), LANG('import-btn-as-image'), 'Cancel'],\r\n        primaries: [LANG('import-btn-as-layer'), LANG('import-btn-as-image')],\r\n        callback,\r\n        autoFocus: 'As Image',\r\n    });\r\n}","import {createCanvas} from '../../bb/base/create-canvas';\r\nimport {BlendMode, Layer, Psd} from 'ag-psd/dist/psd';\r\nimport {IKlProject, IKlPsd, TKlPsdError, TKlPsdLayer, TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {MAX_LAYERS} from '../canvas/kl-canvas';\r\nimport {BB} from '../../bb/bb';\r\nimport {throwIfUndefined} from '../../bb/base/base';\r\n\r\nlet kl2PsdMap: Record<TMixMode, BlendMode>;\r\nlet psd2KlMap: Record<BlendMode, TMixMode>;\r\n\r\nfunction init (): void {\r\n    if (kl2PsdMap) {\r\n        return;\r\n    }\r\n    kl2PsdMap = {\r\n        'source-over': 'normal',\r\n\r\n        'darken': 'darken',\r\n        'multiply': 'multiply',\r\n        'color-burn': 'color burn',\r\n\r\n        'lighten': 'lighten',\r\n        'screen': 'screen',\r\n        'color-dodge': 'color dodge',\r\n\r\n        'overlay': 'overlay',\r\n        'soft-light': 'soft light',\r\n        'hard-light': 'hard light',\r\n\r\n        'difference': 'difference',\r\n        'exclusion': 'exclusion',\r\n\r\n        'hue': 'hue',\r\n        'saturation': 'saturation',\r\n        'color': 'color',\r\n        'luminosity': 'luminosity',\r\n    };\r\n    psd2KlMap = Object.fromEntries(Object.entries(kl2PsdMap).map(a => a.reverse()));\r\n}\r\n\r\nexport function blendPsdToKl (str: BlendMode): TMixMode {\r\n    init();\r\n    return psd2KlMap[str];\r\n}\r\n\r\nexport function blendKlToPsd (str: TMixMode): BlendMode {\r\n    init();\r\n    return kl2PsdMap[str];\r\n}\r\n\r\n\r\n/**\r\n * Converts ag-psd object into something that KlCanvas can represent\r\n * @param psdObj\r\n */\r\nexport function readPsd (psdObj: Psd): IKlPsd {\r\n    if (!psdObj.canvas) {\r\n        throw new Error('psdObj.canvas undefined');\r\n    }\r\n    const result: IKlPsd = {\r\n        type: 'psd',\r\n        canvas: psdObj.canvas,\r\n        width: psdObj.width,\r\n        height: psdObj.height,\r\n    };\r\n\r\n    function addWarning (warningStr: TKlPsdError): void {\r\n        if (!result.warningArr) {\r\n            result.warningArr = [];\r\n        }\r\n        if (result.warningArr.includes(warningStr)) {\r\n            return;\r\n        }\r\n        result.warningArr.push(warningStr);\r\n    }\r\n\r\n    function getMixModeStr (blendMode: BlendMode): TMixMode {\r\n        let mixModeStr: TMixMode = blendPsdToKl(blendMode);\r\n        if (!mixModeStr) {\r\n            addWarning('blend-mode');\r\n            mixModeStr = 'source-over';\r\n        }\r\n        return mixModeStr;\r\n    }\r\n\r\n    if (psdObj.bitsPerChannel !== 8) {\r\n        addWarning('bits-per-channel');\r\n    }\r\n\r\n    if (!psdObj.children) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    // count resulting layers\r\n    const maxLayers = MAX_LAYERS;\r\n    let layerCount = 0;\r\n    function countWithinGroup (groupObj: Layer): number {\r\n        let result = 0;\r\n        if (groupObj.blendMode) {\r\n            const mixModeStr = blendPsdToKl(groupObj.blendMode);\r\n            if (mixModeStr && mixModeStr !== 'source-over') {\r\n                return 1;\r\n            }\r\n        }\r\n        if (groupObj.children) {\r\n            for (let i = 0; i < groupObj.children.length; i++) {\r\n                const item = groupObj.children[i];\r\n                if (item.clipping || item.adjustment) {\r\n                    continue;\r\n                }\r\n\r\n                if (item.children) {\r\n                    addWarning('group');\r\n                    result += countWithinGroup(item);\r\n                } else {\r\n                    result++;\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    layerCount += countWithinGroup(psdObj);\r\n    if (layerCount > maxLayers) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    result.layers = [];\r\n\r\n    function prepareMask (maskCanvas: HTMLCanvasElement, defaultColor: number): void {\r\n        const groupMaskCtx = BB.ctx(maskCanvas);\r\n        const imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n        if (defaultColor === 0) {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = imData.data[i];\r\n            }\r\n        } else {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = 255 - imData.data[i];\r\n            }\r\n        }\r\n        groupMaskCtx.putImageData(imData, 0, 0);\r\n    }\r\n\r\n    function convertGroup (psdGroupObj: Layer): TKlPsdLayer[] {\r\n\r\n        let resultArr: TKlPsdLayer[] = [];\r\n        const groupIsVisible = !psdGroupObj.hidden;\r\n        const groupOpacity = throwIfUndefined(psdGroupObj.opacity, 'groupOpacity is undefined');\r\n        const groupMixModeStr = getMixModeStr(psdGroupObj.blendMode!);\r\n        let groupCanvas;\r\n        let groupCtx;\r\n        if (groupMixModeStr !== 'source-over') {\r\n            groupCanvas = createCanvas(result.width, result.height);\r\n            groupCtx = BB.ctx(groupCanvas);\r\n        }\r\n\r\n        // prepare group mask\r\n        if (psdGroupObj.mask) {\r\n            addWarning('mask');\r\n            prepareMask(psdGroupObj.mask.canvas!, psdGroupObj.mask.defaultColor!);\r\n        }\r\n\r\n        if (psdGroupObj.children) {\r\n            for (let i = 0; i < psdGroupObj.children.length; i++) {\r\n                const item = psdGroupObj.children[i];\r\n                if (item.clipping) {\r\n                    continue;\r\n                }\r\n                if (item.adjustment) {\r\n                    addWarning('adjustment');\r\n                    continue;\r\n                }\r\n\r\n                const hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\r\n                if (hasClipping) {\r\n                    addWarning('clipping');\r\n                }\r\n\r\n                if (item.children) {\r\n                    const convertedChildGroupItems = convertGroup(item);\r\n\r\n                    for (let e = 0; e < convertedChildGroupItems.length; e++) {\r\n                        const innerItem = convertedChildGroupItems[e];\r\n                        const innerCtx = BB.ctx(innerItem.image);\r\n\r\n                        // clipping\r\n                        if (hasClipping) {\r\n                            const clippingCanvas = createCanvas(result.width, result.height);\r\n                            const clippingCtx = BB.ctx(clippingCanvas);\r\n                            clippingCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                            for (let f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++) {\r\n                                const clippingItem = psdGroupObj.children[f];\r\n                                if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                                    continue;\r\n                                }\r\n                                if (clippingItem.blendMode === undefined) {\r\n                                    throw new Error('clippingItem.blendMode undefined');\r\n                                }\r\n                                if (clippingItem.opacity === undefined) {\r\n                                    throw new Error('clippingItem.opacity undefined');\r\n                                }\r\n                                if (clippingItem.canvas === undefined) {\r\n                                    throw new Error('clippingItem.canvas undefined');\r\n                                }\r\n                                if (clippingItem.left === undefined) {\r\n                                    throw new Error('clippingItem.left undefined');\r\n                                }\r\n                                if (clippingItem.top === undefined) {\r\n                                    throw new Error('clippingItem.top undefined');\r\n                                }\r\n                                clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                                clippingCtx.globalAlpha = clippingItem.opacity;\r\n                                clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\r\n                            }\r\n\r\n                            innerCtx.globalCompositeOperation = 'source-atop';\r\n                            innerCtx.drawImage(clippingCanvas, 0, 0);\r\n                        }\r\n\r\n\r\n\r\n                        // group mask\r\n                        if (psdGroupObj.mask) {\r\n                            innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                            if (psdGroupObj.mask.canvas === undefined) {\r\n                                throw new Error('psdGroupObj.mask.canvas undefined');\r\n                            }\r\n                            if (psdGroupObj.mask.left === undefined) {\r\n                                throw new Error('psdGroupObj.mask.left undefined');\r\n                            }\r\n                            if (psdGroupObj.mask.top === undefined) {\r\n                                throw new Error('psdGroupObj.mask.top undefined');\r\n                            }\r\n                            innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n                        }\r\n\r\n                        if (groupCanvas) {\r\n                            if (groupCtx === undefined) {\r\n                                throw new Error('groupCtx undefined');\r\n                            }\r\n                            groupCtx.globalCompositeOperation = innerItem.mixModeStr;\r\n                            groupCtx.globalAlpha = innerItem.opacity;\r\n                            groupCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                        } else {\r\n                            innerItem.opacity = innerItem.opacity * groupOpacity;\r\n                            resultArr.push(innerItem);\r\n                        }\r\n                    }\r\n\r\n                    continue;\r\n                }\r\n\r\n                const canvas = createCanvas(result.width, result.height);\r\n                const ctx = BB.ctx(canvas);\r\n                if (item.canvas) { // if a layer is empty it has no canvas\r\n                    if (item.top === undefined) {\r\n                        throw new Error('item.top undefined');\r\n                    }\r\n                    if (item.left === undefined) {\r\n                        throw new Error('item.left undefined');\r\n                    }\r\n                    ctx.drawImage(item.canvas, item.left, item.top);\r\n                }\r\n\r\n                // effects\r\n                if (item.effects) {\r\n                    addWarning('layer-effect');\r\n                }\r\n\r\n                // mask\r\n                if (item.mask) {\r\n                    addWarning('mask');\r\n                    if (item.mask.canvas === undefined) {\r\n                        throw new Error('item.mask.canvas undefined');\r\n                    }\r\n                    if (item.mask.defaultColor === undefined) {\r\n                        throw new Error('item.mask.defaultColor undefined');\r\n                    }\r\n                    if (item.mask.left === undefined) {\r\n                        throw new Error('item.mask.left undefined');\r\n                    }\r\n                    if (item.mask.top === undefined) {\r\n                        throw new Error('item.mask.top undefined');\r\n                    }\r\n                    prepareMask(item.mask.canvas, item.mask.defaultColor);\r\n\r\n                    ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                    ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\r\n                }\r\n\r\n                // clipping\r\n                if (hasClipping) {\r\n                    if (item.right === undefined) {\r\n                        throw new Error('item.right undefined');\r\n                    }\r\n                    if (item.left === undefined) {\r\n                        throw new Error('item.left undefined');\r\n                    }\r\n                    if (item.bottom === undefined) {\r\n                        throw new Error('item.bottom undefined');\r\n                    }\r\n                    if (item.top === undefined) {\r\n                        throw new Error('item.top undefined');\r\n                    }\r\n                    if (item.canvas === undefined) {\r\n                        throw new Error('item.canvas undefined');\r\n                    }\r\n                    const clippingCanvas = createCanvas(item.right - item.left, item.bottom - item.top);\r\n                    const clippingCtx = BB.ctx(clippingCanvas);\r\n                    clippingCtx.drawImage(item.canvas, 0, 0);\r\n\r\n                    for (let e = i + 1; e < psdGroupObj.children.length && psdGroupObj.children[e].clipping; e++) {\r\n                        const clippingItem = psdGroupObj.children[e];\r\n                        if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                            continue;\r\n                        }\r\n                        if (clippingItem.blendMode === undefined) {\r\n                            throw new Error('clippingItem.blendMode undefined');\r\n                        }\r\n                        if (clippingItem.opacity === undefined) {\r\n                            throw new Error('clippingItem.opacity undefined');\r\n                        }\r\n                        if (clippingItem.canvas === undefined) {\r\n                            throw new Error('clippingItem.canvas undefined');\r\n                        }\r\n                        if (clippingItem.left === undefined) {\r\n                            throw new Error('clippingItem.left undefined');\r\n                        }\r\n                        if (clippingItem.top === undefined) {\r\n                            throw new Error('clippingItem.top undefined');\r\n                        }\r\n                        clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                        clippingCtx.globalAlpha = clippingItem.opacity;\r\n                        clippingCtx.drawImage(clippingItem.canvas, clippingItem.left - item.left, clippingItem.top - item.top);\r\n                    }\r\n\r\n                    ctx.globalCompositeOperation = 'source-atop';\r\n                    ctx.drawImage(clippingCanvas, item.left, item.top);\r\n                }\r\n\r\n                // group mask\r\n                if (psdGroupObj.mask) {\r\n                    ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                    if (psdGroupObj.mask.canvas === undefined) {\r\n                        throw new Error('psdGroupObj.mask.canvas undefined');\r\n                    }\r\n                    if (psdGroupObj.mask.left === undefined) {\r\n                        throw new Error('psdGroupObj.mask.left undefined');\r\n                    }\r\n                    if (psdGroupObj.mask.top === undefined) {\r\n                        throw new Error('psdGroupObj.mask.top undefined');\r\n                    }\r\n                    ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n                }\r\n\r\n                if (item.blendMode === undefined) {\r\n                    throw new Error('item.blendMode undefined');\r\n                }\r\n                if (item.hidden  === undefined) {\r\n                    throw new Error('item.hidden  undefined');\r\n                }\r\n                if (item.opacity === undefined) {\r\n                    throw new Error('item.opacity undefined');\r\n                }\r\n\r\n                if (groupCanvas && groupCtx) {\r\n                    if (groupOpacity > 0) {\r\n                        groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\r\n                        groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\r\n                        groupCtx.drawImage(canvas, 0, 0);\r\n                    }\r\n\r\n                } else {\r\n                    if (item.name === undefined) {\r\n                        throw new Error('item.name undefined');\r\n                    }\r\n                    resultArr.push({\r\n                        name: item.name,\r\n                        isVisible: !item.hidden && groupIsVisible,\r\n                        opacity: item.opacity * groupOpacity,\r\n                        mixModeStr: getMixModeStr(item.blendMode),\r\n                        image: canvas,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        if (groupCanvas) {\r\n            if (psdGroupObj.name === undefined) {\r\n                throw new Error('psdGroupObj.name undefined');\r\n            }\r\n            resultArr = [\r\n                {\r\n                    name: psdGroupObj.name,\r\n                    isVisible: groupIsVisible,\r\n                    opacity: groupOpacity,\r\n                    mixModeStr: groupMixModeStr,\r\n                    image: groupCanvas,\r\n                },\r\n            ];\r\n        }\r\n\r\n        return resultArr;\r\n    }\r\n\r\n    result.layers = convertGroup({\r\n        name: 'root',\r\n        opacity: 1,\r\n        blendMode: 'normal',\r\n        children: psdObj.children,\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\nexport function klPsdToKlProject (klPsd: IKlPsd): IKlProject {\r\n    // only share references to Canvas elements\r\n    const result: IKlProject = {\r\n        width: klPsd.width,\r\n        height: klPsd.height,\r\n        layers: [],\r\n    };\r\n    if (klPsd.layers) {\r\n        result.layers = klPsd.layers.map(item => {\r\n            return {\r\n                name: item.name,\r\n                isVisible: item.isVisible,\r\n                opacity: item.opacity,\r\n                mixModeStr: item.mixModeStr,\r\n                image: item.image,\r\n            };\r\n        });\r\n    } else {\r\n        // flattened\r\n        result.layers = [{\r\n            name: LANG('background'),\r\n            isVisible: true,\r\n            opacity: 1,\r\n            mixModeStr: 'source-over',\r\n            image: klPsd.canvas,\r\n        }];\r\n    }\r\n    return result;\r\n}","import {IKlStorageProject} from '../kl-types';\r\n\r\nconst indexedDbIsSupported = !!window.indexedDB;\r\nlet dbNameStr = 'Klecks';\r\nconst storageNameStr = 'ProjectStore';\r\n\r\nexport function setDbName (name: string): void {\r\n    dbNameStr = '' + name;\r\n}\r\n\r\n/**\r\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\r\n * with index 'id'\r\n *\r\n * @param actionFunction what to execute during transaction\r\n * @param successCallback on successful transaction\r\n * @param errorCallback on error\r\n */\r\nfunction execIndexedDBTransaction (\r\n    actionFunction: (storeObj: IDBObjectStore) => void,\r\n    successCallback: () => void,\r\n    errorCallback: (errorStr: string) => void,\r\n): void {\r\n\r\n    let hasFinished = false;\r\n\r\n    function onSuccess (): void {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        successCallback();\r\n    }\r\n\r\n    function onError (errorStr: string): void {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        errorCallback(errorStr);\r\n    }\r\n\r\n    if (!indexedDbIsSupported) {\r\n        setTimeout(function () {\r\n            onError('no indexed db available');\r\n        }, 0);\r\n        return;\r\n    }\r\n    let requestObj: IDBOpenDBRequest;\r\n\r\n    try {\r\n        requestObj = window.indexedDB.open(dbNameStr, 1);\r\n    } catch (e) {\r\n        onError((e as {message: string}).message);\r\n        return;\r\n    }\r\n\r\n    requestObj.onupgradeneeded = function (): void {\r\n        try {\r\n            const db: IDBDatabase = requestObj.result;\r\n            const store = db.createObjectStore(storageNameStr, {keyPath: 'id'});\r\n            store.createIndex('id', 'id', {unique: true});\r\n        } catch (e) {\r\n            onError((e as {message: string}).message);\r\n        }\r\n    };\r\n    requestObj.onerror = function (): void {\r\n        onError('indexedDB.open failed, ' + requestObj.error);\r\n    };\r\n    requestObj.onsuccess = function (): void {\r\n        let databaseObj: IDBDatabase;\r\n        let transactionObj: IDBTransaction;\r\n        let storeObj: IDBObjectStore;\r\n\r\n        try {\r\n            databaseObj = requestObj.result;\r\n            if (!databaseObj.objectStoreNames.contains(storageNameStr)) {\r\n                //someone maybe messed with the db, or creation failed earlier\r\n                //it's broken -> destroy\r\n                window.indexedDB.deleteDatabase(dbNameStr);\r\n                onError('object store ' + storageNameStr + ' missing. destroying db');\r\n                return;\r\n            }\r\n            transactionObj = databaseObj.transaction(storageNameStr, 'readwrite');\r\n            storeObj = transactionObj.objectStore(storageNameStr);\r\n            storeObj.index('id');\r\n        } catch (e) {\r\n            onError((e as {message: string}).message);\r\n            return;\r\n        }\r\n\r\n        databaseObj.onerror = function (): void {\r\n            onError('database error, ' + (databaseObj as IDBDatabase & {error: string}).error);\r\n        };\r\n\r\n        try {\r\n            actionFunction(storeObj);\r\n        } catch (e) {\r\n            onError((e as {message: string}).message);\r\n            return;\r\n        }\r\n\r\n        transactionObj.oncomplete = function (): void {\r\n            onSuccess();\r\n            databaseObj.close();\r\n        };\r\n        transactionObj.onerror = function (): void {\r\n            onError('transaction error, ' + transactionObj.error);\r\n        };\r\n    };\r\n}\r\n\r\nexport function getKlProjectObj (\r\n    successCallback: (result: undefined | IKlStorageProject) => void,\r\n    errorCallback: (error: string) => void,\r\n): void {\r\n    if (indexedDbIsSupported) {\r\n        let query: IDBRequest<undefined | IKlStorageProject>;\r\n        execIndexedDBTransaction(function (storeObj) {\r\n            query = storeObj.get(1);\r\n        }, function () {\r\n            successCallback(query.result);\r\n        }, function (errorStr) {\r\n            errorCallback('execIndexedDBTransaction error, ' + errorStr);\r\n        });\r\n    } else {\r\n        successCallback(undefined);\r\n    }\r\n}\r\n\r\n/**\r\n * stores a project into id = 1 in database:dbNameStr > storage: storageNameStr\r\n */\r\nexport function storeKlProjectObj (\r\n    storageProject: IKlStorageProject,\r\n    successCallback: () => void,\r\n    errorCallback: (error: string) => void,\r\n): void {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.put(storageProject);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (errorStr) {\r\n        errorCallback(errorStr);\r\n    });\r\n\r\n}\r\n\r\n/**\r\n * deletes stored project, by removing id = 1 from database:dbNameStr > storage: storageNameStr\r\n */\r\nexport function clear (\r\n    successCallback: () => void,\r\n    errorCallback: (error: string) => void,\r\n): void {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.delete(1);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (error) {\r\n        errorCallback(error);\r\n    });\r\n\r\n}\r\n","import {IFilter} from '../kl-types';\r\nimport glBrightnessContrastImg from '/src/app/img/ui/edit-brightness-contrast.svg';\r\nimport cropExtendImg from '/src/app/img/ui/edit-crop.svg';\r\nimport glCurvesImg from '/src/app/img/ui/edit-curves.svg';\r\nimport flipImg from '/src/app/img/ui/edit-flip.svg';\r\nimport glHueSaturationImg from '/src/app/img/ui/edit-hue-saturation.svg';\r\nimport invertImg from '/src/app/img/ui/edit-invert.png';\r\nimport glPerspectiveImg from '/src/app/img/ui/edit-perspective.svg';\r\nimport resizeImg from '/src/app/img/ui/edit-resize.svg';\r\nimport rotateImg from '/src/app/img/ui/edit-rotate.svg';\r\nimport glTiltShiftImg from '/src/app/img/ui/edit-tilt-shift.png';\r\nimport toAlphaImg from '/src/app/img/ui/edit-to-alpha.svg';\r\nimport transformImg from '/src/app/img/ui/edit-transform.svg';\r\nimport glBlurImg from '/src/app/img/ui/edit-triangle-blur.png';\r\nimport glUnsharpMaskImg from '/src/app/img/ui/edit-unsharp-mask.png';\r\nimport gridImg from '/src/app/img/ui/edit-grid.svg';\r\nimport noiseImg from '/src/app/img/ui/edit-noise.svg';\r\nimport patternImg from '/src/app/img/ui/edit-pattern.svg';\r\nimport vanishPointImg from '/src/app/img/ui/edit-vanish-point.svg';\r\nimport distortImg from '/src/app/img/ui/edit-distort.svg';\r\nimport {THistoryEntryG} from '../history/kl-history';\r\n\r\nexport type TFilterHistoryEntry<Filter extends string, Input> = THistoryEntryG<['filter', Filter], 'apply', [{ input: Input }]>;\r\n\r\nexport const filterLibStatus = {\r\n    isLoaded: false,\r\n};\r\nexport const filterLib: {\r\n    [key:string]: IFilter;\r\n} = {\r\n    brightnessContrast: {\r\n        lang: {name: 'filter-bright-contrast-title', button: 'filter-bright-contrast'},\r\n        icon: glBrightnessContrastImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        webGL: true,\r\n    },\r\n    cropExtend: {\r\n        lang: {name: 'filter-crop-title', button: 'filter-crop-extend'},\r\n        icon: cropExtendImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    curves: {\r\n        lang: {name: 'filter-curves-title', button: 'filter-curves'},\r\n        icon: glCurvesImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        webGL: true,\r\n    },\r\n    distort: {\r\n        lang: {name: 'filter-distort', button: 'filter-distort'},\r\n        icon: distortImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        webGL: true,\r\n    },\r\n    flip: {\r\n        lang: {name: 'filter-flip-title', button: 'filter-flip'},\r\n        icon: flipImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    hueSaturation: {\r\n        lang: {name: 'filter-hue-sat-title', button: 'filter-hue-sat'},\r\n        icon: glHueSaturationImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n        webGL: true,\r\n    },\r\n    invert: {\r\n        lang: {name: 'filter-invert', button: 'filter-invert'},\r\n        icon: invertImg,\r\n        updatePos: false,\r\n        isInstant: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n        webGL: true,\r\n    },\r\n    perspective: {\r\n        lang: {name: 'filter-perspective-title', button: 'filter-perspective'},\r\n        icon: glPerspectiveImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        webGL: true,\r\n    },\r\n    resize: {\r\n        lang: {name: 'filter-resize-title', button: 'filter-resize'},\r\n        icon: resizeImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    rotate: {\r\n        lang: {name: 'filter-rotate-title', button: 'filter-rotate'},\r\n        icon: rotateImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    tiltShift: {\r\n        lang: {name: 'filter-tilt-shift-title', button: 'filter-tilt-shift'},\r\n        icon: glTiltShiftImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        webGL: true,\r\n    },\r\n    toAlpha: {\r\n        lang: {name: 'filter-to-alpha-title', button: 'filter-to-alpha'},\r\n        icon: toAlphaImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n        webGL: true,\r\n    },\r\n    transform: {\r\n        lang: {name: 'filter-transform-title', button: 'filter-transform'},\r\n        icon: transformImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    blur: {\r\n        lang: {name: 'filter-triangle-blur-title', button: 'filter-triangle-blur'},\r\n        icon: glBlurImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n        webGL: true,\r\n    },\r\n    unsharpMask: {\r\n        lang: {name: 'filter-unsharp-mask-title', button: 'filter-unsharp-mask'},\r\n        icon: glUnsharpMaskImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n        webGL: true,\r\n    },\r\n    grid: {\r\n        lang: {name: 'filter-grid', button: 'filter-grid'},\r\n        icon: gridImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    noise: {\r\n        lang: {name: 'filter-noise', button: 'filter-noise'},\r\n        icon: noiseImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        webGL: true,\r\n    },\r\n    pattern: {\r\n        lang: {name: 'filter-pattern', button: 'filter-pattern'},\r\n        icon: patternImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    vanishPoint: {\r\n        lang: {name: 'filter-vanish-point-title', button: 'filter-vanish-point'},\r\n        icon: vanishPointImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n};\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7tOPd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fduLu\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ijSd4\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3lCpH\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hhylW\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kV0ed\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dNk9L\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"aj5Gc\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6D2tK\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7nesm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"leHUT\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3lP2j\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7G4sY\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7n1Rt\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ijwf0\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"18gIG\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"786LQ\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kcnOE\");","import {PenBrush} from './pen-brush';\r\nimport {BlendBrush} from './blend-brush';\r\nimport {SketchyBrush} from './sketchy-brush';\r\nimport {PixelBrush} from './pixel-brush';\r\nimport {EraserBrush} from './eraser-brush';\r\nimport {SmudgeBrush} from './smudge-brush';\r\nimport {ChemyBrush} from './chemy-brush';\r\n\r\nexport type TBrush = |\r\n    PenBrush |\r\n    BlendBrush |\r\n    SketchyBrush |\r\n    PixelBrush |\r\n    ChemyBrush |\r\n    SmudgeBrush |\r\n    EraserBrush;\r\n\r\nexport const brushes = {\r\n    PenBrush,\r\n    BlendBrush,\r\n    SketchyBrush,\r\n    PixelBrush,\r\n    ChemyBrush,\r\n    SmudgeBrush,\r\n    EraserBrush,\r\n};\r\n","import {BB} from '../../bb/bb';\r\nimport {alphaImArr} from './brushes-common';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB, TPressureInput} from '../kl-types';\r\nimport {BezierLine} from '../../bb/math/line';\r\n\r\nexport interface IPenBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'PenBrush'];\r\n    actions: THistoryInnerActions<PenBrush>[];\r\n}\r\n\r\nconst ALPHA_CIRCLE = 0;\r\nconst ALPHA_CHALK = 1;\r\nconst ALPHA_CAL = 2; // calligraphy\r\nconst ALPHA_SQUARE = 3;\r\n\r\nconst TWO_PI = 2 * Math.PI;\r\n\r\nexport class PenBrush {\r\n\r\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IPenBrushHistoryEntry | undefined;\r\n\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingHasSizePressure: boolean = true;\r\n    private settingSize: number = 2;\r\n    private settingSpacing: number = 0.8489;\r\n    private settingOpacity: number = 1;\r\n    private settingColor: IRGB = {} as IRGB;\r\n    private settingColorStr: string = '';\r\n    private settingAlphaId: number = ALPHA_CIRCLE;\r\n    private settingLockLayerAlpha: boolean = false;\r\n\r\n    private hasDrawnDot: boolean = false;\r\n    private lineToolLastDot: number = 0;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private inputArr: TPressureInput[] = [];\r\n    private inputIsDrawing: boolean = false;\r\n    private bezierLine: BezierLine | null = null;\r\n\r\n    // mipmapping\r\n    private readonly alphaCanvas128: HTMLCanvasElement = BB.canvas(128, 128);\r\n    private readonly alphaCanvas64: HTMLCanvasElement = BB.canvas(64, 64);\r\n    private readonly alphaCanvas32: HTMLCanvasElement = BB.canvas(32, 32);\r\n    private readonly alphaOpacityArr: number[] = [1, 0.9, 1, 1];\r\n\r\n\r\n    private updateAlphaCanvas () {\r\n        if (this.settingAlphaId === ALPHA_CIRCLE || this.settingAlphaId === ALPHA_SQUARE) {\r\n            return;\r\n        }\r\n\r\n        const instructionArr: [HTMLCanvasElement, number][] = [\r\n            [this.alphaCanvas128, 128],\r\n            [this.alphaCanvas64, 64],\r\n            [this.alphaCanvas32, 32],\r\n        ];\r\n\r\n        let ctx;\r\n\r\n        for (let i = 0; i < instructionArr.length; i++) {\r\n            ctx = BB.ctx((instructionArr[i][0] as any));\r\n\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.fillStyle = 'rgba(' + this.settingColor.r\r\n                + ', ' + this.settingColor.g\r\n                + ', ' + this.settingColor.b\r\n                + ', ' + this.alphaOpacityArr[this.settingAlphaId] + ')';\r\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.globalCompositeOperation = 'destination-in';\r\n            ctx.imageSmoothingQuality = 'high';\r\n            ctx.drawImage(alphaImArr[this.settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.restore();\r\n        }\r\n    }\r\n\r\n    private calcOpacity (pressure: number): number {\r\n        return this.settingOpacity * (this.settingHasOpacityPressure ? pressure * pressure : 1);\r\n    }\r\n\r\n    /**\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     * @param angle\r\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\r\n     */\r\n    private drawDot (\r\n        x: number,\r\n        y:number,\r\n        size: number,\r\n        opacity: number,\r\n        angle?: number,\r\n        before?: [number, number, number, number, (number | undefined)]\r\n    ): void {\r\n        if (size <= 0) {\r\n            return;\r\n        }\r\n\r\n        if (this.settingLockLayerAlpha) {\r\n            this.context.globalCompositeOperation = 'source-atop';\r\n        }\r\n\r\n        if (!before || before[3] !== opacity) {\r\n            this.context.globalAlpha = opacity;\r\n        }\r\n\r\n        if (!before && (this.settingAlphaId === ALPHA_CIRCLE || this.settingAlphaId === ALPHA_SQUARE)) {\r\n            this.context.fillStyle = this.settingColorStr;\r\n        }\r\n\r\n        if (this.settingAlphaId === ALPHA_CIRCLE) {\r\n            this.context.beginPath();\r\n            this.context.arc(x, y, size, 0, TWO_PI);\r\n            this.context.closePath();\r\n            this.context.fill();\r\n            this.hasDrawnDot = true;\r\n\r\n        } else if (this.settingAlphaId === ALPHA_SQUARE) {\r\n            if (angle !== undefined) {\r\n                this.context.save();\r\n                this.context.translate(x, y);\r\n                this.context.rotate(angle / 180 * Math.PI);\r\n                this.context.fillRect(-size, -size, size * 2, size * 2);\r\n                this.context.restore();\r\n                this.hasDrawnDot = true;\r\n            }\r\n\r\n        } else { // other brush alphas\r\n            this.context.save();\r\n            this.context.translate(x, y);\r\n            let targetMipmap = this.alphaCanvas128;\r\n            if (size <= 32 && size > 16) {\r\n                targetMipmap = this.alphaCanvas64;\r\n            } else if (size <= 16) {\r\n                targetMipmap = this.alphaCanvas32;\r\n            }\r\n            this.context.scale(size, size);\r\n            if (this.settingAlphaId === ALPHA_CHALK) {\r\n                this.context.rotate(((x + y) * 53123) % TWO_PI); // without mod it sometimes looks different\r\n            }\r\n            this.context.drawImage(targetMipmap, -1, -1, 2, 2);\r\n\r\n            this.context.restore();\r\n            this.hasDrawnDot = true;\r\n        }\r\n    }\r\n\r\n    // continueLine\r\n    private continueLine (\r\n        x: number | null,\r\n        y: number | null,\r\n        size: number,\r\n        pressure: number,\r\n    ): void {\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, () => {});\r\n        }\r\n\r\n        const drawArr: [number, number, number, number, (number | undefined)][] = []; //draw instructions. will be all drawn at once\r\n\r\n        const dotCallback = (val: {\r\n            x: number;\r\n            y: number;\r\n            t: number;\r\n            angle?: number;\r\n            dAngle: number;\r\n        }): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.calcOpacity(localPressure);\r\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        };\r\n\r\n        const localSpacing = size * this.settingSpacing;\r\n        if (x === null || y === null) {\r\n            this.bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        this.context.save();\r\n        let before: typeof drawArr[number] | undefined = undefined;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            const item = drawArr[i];\r\n            this.drawDot(item[0], item[1], item[2], item[3], item[4], before);\r\n            before = item;\r\n        }\r\n        this.context.restore();\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor () {}\r\n\r\n    // ---- interface ----\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'PenBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setAlpha',\r\n                    params: [this.settingAlphaId],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n            ],\r\n        };\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        const localOpacity = this.calcOpacity(p);\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.hasDrawnDot = false;\r\n\r\n        this.inputIsDrawing = true;\r\n        this.context.save();\r\n        this.drawDot(x, y, localSize, localOpacity);\r\n        this.context.restore();\r\n\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2.pressure = p;\r\n\r\n        this.inputArr = [{\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        }];\r\n\r\n        this.historyEntry.actions!.push({\r\n            action: 'startLine',\r\n            params: [x, y, p],\r\n        });\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.inputIsDrawing) {\r\n            return;\r\n        }\r\n        this.historyEntry!.actions!.push({\r\n            action: 'goLine',\r\n            params: [x, y, p],\r\n        });\r\n\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.context.save();\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n        /*context.fillStyle = 'red';\r\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\r\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/\r\n\r\n        this.context.restore();\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput2.pressure = this.lastInput.pressure;\r\n        this.lastInput.pressure = pressure;\r\n\r\n        this.inputArr.push({\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        });\r\n    }\r\n\r\n    endLine (x: number, y: number): void {\r\n\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.context.save();\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n        this.context.restore();\r\n\r\n        this.inputIsDrawing = false;\r\n\r\n        if (this.settingAlphaId === ALPHA_SQUARE && !this.hasDrawnDot) {\r\n            // find max pressure input, use that one\r\n            let maxInput = this.inputArr[0];\r\n            this.inputArr.forEach(item => {\r\n                if (item.pressure > maxInput.pressure) {\r\n                    maxInput = item;\r\n                }\r\n            });\r\n\r\n            this.context.save();\r\n            const p = BB.clamp(maxInput.pressure, 0, 1);\r\n            const localOpacity = this.calcOpacity(p);\r\n            this.drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\r\n            this.context.restore();\r\n        }\r\n\r\n        this.bezierLine = null;\r\n\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions!.push({\r\n                action: 'endLine',\r\n                params: [x, y],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n\r\n        this.hasDrawnDot = false;\r\n        this.inputArr = [];\r\n    }\r\n\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n        this.lastInput.pressure = 1;\r\n\r\n        if (this.inputIsDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        const bdist = this.settingSize * this.settingSpacing;\r\n        this.lineToolLastDot = this.settingSize * this.settingSpacing;\r\n        this.context.save();\r\n        for (loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity, angle);\r\n        }\r\n        this.context.restore();\r\n\r\n\r\n        const historyEntry: IPenBrushHistoryEntry = {\r\n            tool: ['brush', 'PenBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setAlpha',\r\n                    params: [this.settingAlphaId],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n    //IS\r\n    isDrawing (): boolean {\r\n        return this.inputIsDrawing;\r\n    }\r\n\r\n    //SET\r\n    setAlpha (a: number): void {\r\n        if (this.settingAlphaId === a) {\r\n            return;\r\n        }\r\n        this.settingAlphaId = a;\r\n        this.updateAlphaCanvas();\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor === c) {\r\n            return;\r\n        }\r\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\r\n        this.settingColorStr = 'rgb(' + this.settingColor.r + ',' + this.settingColor.g + ',' + this.settingColor.b + ')';\r\n        this.updateAlphaCanvas();\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = b;\r\n    }\r\n\r\n    //GET\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n}\r\n\r\n","import {genBrushAlpha01, genBrushAlpha02} from './alphas/brush-alphas';\r\n\r\nexport const alphaImArr: HTMLCanvasElement[] = []; //used by default brush\r\nalphaImArr[1] = genBrushAlpha01(128);\r\nalphaImArr[2] = genBrushAlpha02(128);","import {BB} from '../../../bb/bb';\r\nimport {noise} from '../../../bb/math/perlin';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\n\r\n// chalk\r\nexport function genBrushAlpha01 (w: number): HTMLCanvasElement {\r\n\r\n    const scaleFac = w / 500;\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    const ctx = BB.ctx(canvas);\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            const i = (y * w + x) * 4;\r\n\r\n            // base noise\r\n            const sFac2 = scaleFac + noise.simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\r\n            let noisePattern = 100 + (noise.simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\r\n            noisePattern -= (noise.simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\r\n\r\n            // fade out in circular shape\r\n            const centerDist = BB.dist(w / 2, h / 2, x, y);\r\n            const falloff = BB.clamp(\r\n                1 - ((centerDist - (w / 2.5)) / (w / 14) + noise.simplex2(x / 22 / sFac2, y / 22 / sFac2)),\r\n                0,\r\n                1);\r\n            noisePattern = noisePattern * falloff;\r\n\r\n            // make the middle darker\r\n            const falloff2 = BB.clamp(1 - centerDist / w, 0, 1) * 2;\r\n            noisePattern = noisePattern * falloff2;\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = BB.clamp(noisePattern, 0, 255);\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}\r\n\r\n// https://www.shadertoy.com/view/3tdSDj\r\nfunction udSegment ( p: IVector2D, a: IVector2D, b: IVector2D ): number {\r\n    const ba = BB.Vec2.sub(b, a);\r\n    const pa = BB.Vec2.sub(p, a);\r\n    const h = BB.clamp( BB.Vec2.dot(pa,ba) / BB.Vec2.dot(ba,ba), 0.0, 1.0 );\r\n    return BB.Vec2.len(BB.Vec2.sub(pa, BB.Vec2.mul(ba, h)));\r\n}\r\n\r\n// calligraphy\r\nexport function genBrushAlpha02 (w: number): HTMLCanvasElement {\r\n\r\n    const pDist = 1 / 4;\r\n    let centerSize = 2 / 3;\r\n    let transitionSize = 1 / 3;\r\n    centerSize *= pDist;\r\n    transitionSize *= pDist;\r\n    const p1 = {x: pDist * w, y: w - (w * pDist)};\r\n    const p2 = {x: w - (w * pDist), y: pDist * w};\r\n\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    const ctx = BB.ctx(canvas);\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            const i = (y * w + x) * 4;\r\n\r\n            let col = udSegment({x: x, y: y}, p1, p2);\r\n\r\n            col = BB.clamp(\r\n                255 - ((col - (w * centerSize)) / (w * transitionSize) * 255),\r\n                0,\r\n                255\r\n            );\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = col;\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}","/*\r\n * A speed-improved perlin and simplex noise algorithms for 2D.\r\n *\r\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\n * Better rank ordering method by Stefan Gustavson in 2012.\r\n * Converted to Javascript by Joseph Gentle.\r\n *\r\n * Version 2012-03-09\r\n *\r\n * This code was placed in the public domain by its original author,\r\n * Stefan Gustavson. You may use it as you see fit, but\r\n * attribution is appreciated.\r\n *\r\n */\r\n\r\nconst myModule = {} as any;\r\n\r\nclass Grad {\r\n    constructor (public x: number, public y: number, public z:number) {}\r\n\r\n    dot2 (x: number, y: number): number {\r\n        return this.x*x + this.y*y;\r\n    }\r\n}\r\n/*\r\nGrad.prototype.dot3 = function(x, y, z) {\r\n    return this.x*x + this.y*y + this.z*z;\r\n};*/\r\n\r\nconst grad3 = [new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),\r\n    new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),\r\n    new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];\r\n\r\nconst p = [151,160,137,91,90,15,\r\n    131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,\r\n    190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,\r\n    88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,\r\n    77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,\r\n    102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,\r\n    135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,\r\n    5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,\r\n    223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,\r\n    129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,\r\n    251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,\r\n    49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,\r\n    138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\r\n// To remove the need for index wrapping, double the permutation table length\r\nconst perm = new Array(512);\r\nconst gradP = new Array(512);\r\n\r\n// This isn't a very good seeding function, but it works ok. It supports 2^16\r\n// different seed values. Write something better if you need more seeds.\r\nmyModule.seed = function (seed: number): void {\r\n    if (seed > 0 && seed < 1) {\r\n        // Scale the seed out\r\n        seed *= 65536;\r\n    }\r\n\r\n    seed = Math.floor(seed);\r\n    if (seed < 256) {\r\n        seed |= seed << 8;\r\n    }\r\n\r\n    for (let i = 0; i < 256; i++) {\r\n        let v;\r\n        if (i & 1) {\r\n            v = p[i] ^ (seed & 255);\r\n        } else {\r\n            v = p[i] ^ ((seed>>8) & 255);\r\n        }\r\n\r\n        perm[i] = perm[i + 256] = v;\r\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\r\n    }\r\n};\r\n\r\nmyModule.seed(0);\r\n\r\n/*\r\nfor (let i=0; i<256; i++) {\r\n  perm[i] = perm[i + 256] = p[i];\r\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\r\n}*/\r\n\r\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\r\nconst F2 = 0.5*(Math.sqrt(3)-1);\r\nconst G2 = (3-Math.sqrt(3))/6;\r\n\r\n/*let F3 = 1/3;\r\nlet G3 = 1/6;*/\r\n\r\n// 2D simplex noise\r\nmyModule.simplex2 = function (xin: number, yin: number): number {\r\n    let n0, n1, n2; // Noise contributions from the three corners\r\n    // Skew the input space to determine which simplex cell we're in\r\n    const s = (xin+yin)*F2; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    const t = (i+j)*G2;\r\n    const x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    const y0 = yin-j+t;\r\n    // For the 2D case, the simplex shape is an equilateral triangle.\r\n    // Determine which simplex we are in.\r\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n    if (x0>y0) { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n        i1=1; j1=0;\r\n    } else {    // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n        i1=0; j1=1;\r\n    }\r\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n    // c = (3-sqrt(3))/6\r\n    const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n    const y1 = y0 - j1 + G2;\r\n    const x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n    const y2 = y0 - 1 + 2 * G2;\r\n    // Work out the hashed gradient indices of the three simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    const gi0 = gradP[i+perm[j]];\r\n    const gi1 = gradP[i+i1+perm[j+j1]];\r\n    const gi2 = gradP[i+1+perm[j+1]];\r\n    // Calculate the contribution from the three corners\r\n    let t0 = 0.5 - x0*x0-y0*y0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot2(x0, y0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.5 - x1*x1-y1*y1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\r\n    }\r\n    let t2 = 0.5 - x2*x2-y2*y2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 70 * (n0 + n1 + n2);\r\n};\r\n/*\r\n// 3D simplex noise\r\nmyModule.simplex3 = function(xin, yin, zin) {\r\n    let n0, n1, n2, n3; // Noise contributions from the four corners\r\n\r\n    // Skew the input space to determine which simplex cell we're in\r\n    let s = (xin+yin+zin)*F3; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    let k = Math.floor(zin+s);\r\n\r\n    let t = (i+j+k)*G3;\r\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin-j+t;\r\n    let z0 = zin-k+t;\r\n\r\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n    // Determine which simplex we are in.\r\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n    if (x0 >= y0) {\r\n        if (y0 >= z0)      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; }\r\n        else if (x0 >= z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; }\r\n        else              { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; }\r\n    } else {\r\n        if (y0 < z0)      { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; }\r\n        else if (x0 < z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; }\r\n        else             { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; }\r\n    }\r\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n    // c = 1/6.\r\n    let x1 = x0 - i1 + G3; // Offsets for second corner\r\n    let y1 = y0 - j1 + G3;\r\n    let z1 = z0 - k1 + G3;\r\n\r\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\r\n    let y2 = y0 - j2 + 2 * G3;\r\n    let z2 = z0 - k2 + 2 * G3;\r\n\r\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\r\n    let y3 = y0 - 1 + 3 * G3;\r\n    let z3 = z0 - 1 + 3 * G3;\r\n\r\n    // Work out the hashed gradient indices of the four simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    k &= 255;\r\n    let gi0 = gradP[i+   perm[j+   perm[k   ]]];\r\n    let gi1 = gradP[i+i1+perm[j+j1+perm[k+k1]]];\r\n    let gi2 = gradP[i+i2+perm[j+j2+perm[k+k2]]];\r\n    let gi3 = gradP[i+ 1+perm[j+ 1+perm[k+ 1]]];\r\n\r\n    // Calculate the contribution from the four corners\r\n    let t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\r\n    }\r\n    let t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\r\n    }\r\n    let t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\r\n    if (t3<0) {\r\n        n3 = 0;\r\n    } else {\r\n        t3 *= t3;\r\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 32 * (n0 + n1 + n2 + n3);\r\n\r\n};\r\n*/\r\n// ##### Perlin noise stuff\r\n/*\r\nfunction fade(t) {\r\n    return t*t*t*(t*(t*6-15)+10);\r\n}\r\n\r\nfunction lerp(a, b, t) {\r\n    return (1-t)*a + t*b;\r\n}\r\n\r\n// 2D Perlin Noise\r\nmyModule.perlin2 = function(x, y) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y);\r\n    // Get relative xy coordinates of point within that cell\r\n    x = x - X; y = y - Y;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255;\r\n\r\n    // Calculate noise contributions from each of the four corners\r\n    let n00 = gradP[X+perm[Y]].dot2(x, y);\r\n    let n01 = gradP[X+perm[Y+1]].dot2(x, y-1);\r\n    let n10 = gradP[X+1+perm[Y]].dot2(x-1, y);\r\n    let n11 = gradP[X+1+perm[Y+1]].dot2(x-1, y-1);\r\n\r\n    // Compute the fade curve value for x\r\n    let u = fade(x);\r\n\r\n    // Interpolate the four results\r\n    return lerp(\r\n        lerp(n00, n10, u),\r\n        lerp(n01, n11, u),\r\n        fade(y));\r\n};*/\r\n/*\r\n// 3D Perlin Noise\r\nmyModule.perlin3 = function(x, y, z) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y), Z = Math.floor(z);\r\n    // Get relative xyz coordinates of point within that cell\r\n    x = x - X; y = y - Y; z = z - Z;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255; Z = Z & 255;\r\n\r\n    // Calculate noise contributions from each of the eight corners\r\n    let n000 = gradP[X+  perm[Y+  perm[Z  ]]].dot3(x,   y,     z);\r\n    let n001 = gradP[X+  perm[Y+  perm[Z+1]]].dot3(x,   y,   z-1);\r\n    let n010 = gradP[X+  perm[Y+1+perm[Z  ]]].dot3(x,   y-1,   z);\r\n    let n011 = gradP[X+  perm[Y+1+perm[Z+1]]].dot3(x,   y-1, z-1);\r\n    let n100 = gradP[X+1+perm[Y+  perm[Z  ]]].dot3(x-1,   y,   z);\r\n    let n101 = gradP[X+1+perm[Y+  perm[Z+1]]].dot3(x-1,   y, z-1);\r\n    let n110 = gradP[X+1+perm[Y+1+perm[Z  ]]].dot3(x-1, y-1,   z);\r\n    let n111 = gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1, y-1, z-1);\r\n\r\n    // Compute the fade curve value for x, y, z\r\n    let u = fade(x);\r\n    let v = fade(y);\r\n    let w = fade(z);\r\n\r\n    // Interpolate\r\n    return lerp(\r\n        lerp(\r\n            lerp(n000, n100, u),\r\n            lerp(n001, n101, u), w),\r\n        lerp(\r\n            lerp(n010, n110, u),\r\n            lerp(n011, n111, u), w),\r\n        v);\r\n};*/\r\n\r\nexport const noise = myModule;","import {BB} from '../../bb/bb';\r\nimport {IRGB, IRGBA} from '../kl-types';\r\nimport {IBounds, IPressureInput} from '../../bb/bb-types';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {clamp} from '../../bb/math/math';\r\nimport {BezierLine, TBezierLineCallback} from '../../bb/math/line';\r\n\r\nexport interface IBlendBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'BlendBrush'];\r\n    actions: THistoryInnerActions<BlendBrush>[];\r\n}\r\n\r\nconst cellSize = 256;\r\n\r\ninterface IDrawBufferItem {\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    opacity: number;\r\n    x1: number;\r\n    y1: number;\r\n    x2: number;\r\n    y2: number;\r\n    r: number;\r\n    g: number;\r\n    b: number;\r\n}\r\n\r\nexport class BlendBrush {\r\n\r\n    private isTesting: boolean = false; // testing mode - context only gets updated when line is finished\r\n\r\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\r\n    private color: IRGB = {} as IRGB;\r\n    private size: number = 29; // radius - 0.5 - 99999\r\n    private opacity: number = 0.6; // 0-1\r\n    private blending: number = 0.65; // 0-1\r\n\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingSizePressure: boolean = true;\r\n    private settingOpacityPressure: boolean = false;\r\n\r\n    private blendCol: IRGBA = {r: 0, g: 0, b: 0, a: 1}; // todo docs\r\n    private blendMix: number = 0.45; // todo docs\r\n    private mixCol: IRGB = {r: 0, g: 0, b: 0}; // todo docs\r\n    private localColOld: IRGBA = {} as IRGBA; // todo docs\r\n\r\n    private isDrawing: boolean = false;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private bezierLine: undefined | BezierLine;\r\n\r\n    private history: KlHistoryInterface | undefined;\r\n    private historyEntry: IBlendBrushHistoryEntry | undefined;\r\n    private redrawBounds: IBounds | undefined;\r\n    private cells: (ImageData | undefined)[] = [];\r\n    private drawBuffer: IDrawBufferItem[] = [];\r\n\r\n    private updateRedrawBounds (bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    private getCellsWidth (): number {\r\n        return Math.ceil(this.context.canvas.width / cellSize);\r\n    }\r\n\r\n    /**\r\n     * draw changed cells (changed by brushstroke) onto context\r\n     * @private\r\n     */\r\n    private drawChangedCells (): void {\r\n        if (!this.redrawBounds) {\r\n            return;\r\n        }\r\n\r\n        const cells: typeof this.cells = this.cells.map(() => undefined);\r\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\r\n        touchedCells.forEach((isTouched, index) => {\r\n            if (isTouched) {\r\n                cells[index] = this.cells[index];\r\n            }\r\n        });\r\n        this.drawCells(cells);\r\n        this.redrawBounds = undefined;\r\n    }\r\n\r\n    private getTouchedCells (bounds: IBounds): boolean[] {\r\n        const touchedCells = this.cells.map(() => false);\r\n        const cellsW = this.getCellsWidth();\r\n        bounds = {\r\n            x1: Math.floor(bounds.x1 / cellSize),\r\n            y1: Math.floor(bounds.y1 / cellSize),\r\n            x2: Math.floor(bounds.x2 / cellSize),\r\n            y2: Math.floor(bounds.y2 / cellSize),\r\n        };\r\n        for (let i = bounds.x1; i <= bounds.x2; i++) {\r\n            for (let e = bounds.y1; e <= bounds.y2; e++) {\r\n                touchedCells[e * cellsW + i] = true;\r\n            }\r\n        }\r\n        return touchedCells;\r\n    }\r\n\r\n    /**\r\n     * Slice up bounds according to cells\r\n     * @param bounds\r\n     * @private\r\n     */\r\n    private sliceBounds (bounds: IBounds): {index: number; bounds: IBounds}[] {\r\n        const cellsW = this.getCellsWidth();\r\n        const result: {index: number; bounds: IBounds}[] = [];\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n\r\n        touchedCells.forEach((cell, i) => {\r\n            if (!cell) {\r\n                return;\r\n            }\r\n\r\n            const cellOffsetX = (i % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(i / cellsW) * cellSize;\r\n            const cellWidth = this.cells[i]!.width;\r\n            const cellHeight = this.cells[i]!.height;\r\n\r\n            const inCellBounds = {\r\n                x1: Math.max(0, bounds.x1 - cellOffsetX),\r\n                y1: Math.max(0, bounds.y1 - cellOffsetY),\r\n                x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\r\n                y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY),\r\n            };\r\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) {\r\n                return;\r\n            }\r\n            result.push({\r\n                index: i,\r\n                bounds: inCellBounds,\r\n            });\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    private copyFromCanvas (bounds: IBounds | undefined): void {\r\n        if (!bounds) {\r\n            return;\r\n        }\r\n\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n        const cellsW = this.getCellsWidth();\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.cells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * cellSize + cellSize, this.context.canvas.width) - 1) % cellSize + 1;\r\n            const h = (Math.min(y * cellSize + cellSize, this.context.canvas.height) - 1) % cellSize + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = BB.ctx(tmpCanvas);\r\n            tmpCtx.drawImage(this.context.canvas, -x * cellSize, -y * cellSize);\r\n\r\n            this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\r\n        });\r\n    }\r\n\r\n    private getAverage (x: number, y: number, size: number): IRGBA {\r\n\r\n        size = Math.max(0.5, size * 0.75);\r\n        const x1 = Math.max(0, Math.floor(x - size));\r\n        const y1 = Math.max(0, Math.floor(y - size));\r\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return {\r\n                r: 0,\r\n                g: 0,\r\n                b: 0,\r\n                a: 0,\r\n            };\r\n        }\r\n\r\n        let ar = 0, ag = 0, ab = 0, aa = 0, alpha;\r\n\r\n        const slicedBounds = this.sliceBounds({ x1, y1, x2, y2 });\r\n        slicedBounds.forEach(slice => {\r\n            const width = this.cells[slice.index]!.width;\r\n            const data = this.cells[slice.index]!.data;\r\n            const bounds = slice.bounds;\r\n\r\n            for (let i = bounds.y1; i <= bounds.y2; i += 4) {\r\n                for (let e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 4 * 4) {\r\n                    alpha = data[e2 + 3];\r\n                    ar += data[e2] * alpha;\r\n                    ag += data[e2 + 1] * alpha;\r\n                    ab += data[e2 + 2] * alpha;\r\n                    aa += alpha;\r\n                }\r\n            }\r\n        });\r\n\r\n        if (aa !== 0) {\r\n            ar /= aa;\r\n            ag /= aa;\r\n            ab /= aa;\r\n            aa = Math.min(1, aa);\r\n        }\r\n        return {\r\n            r: ar,\r\n            g: ag,\r\n            b: ab,\r\n            a: aa,\r\n        };\r\n    }\r\n\r\n    private prepDot (x: number, y: number, size: number): IBounds | undefined {\r\n        size = Math.max(0.5, size);\r\n        const x1 = Math.max(0, Math.floor(x - size));\r\n        const y1 = Math.max(0, Math.floor(y - size));\r\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return undefined;\r\n        }\r\n        return { x1, y1, x2, y2 };\r\n    }\r\n\r\n    private drawDot (params: IDrawBufferItem): void {\r\n        // array with random numbers. faster than Math.random()\r\n        let randI = 0;\r\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n        const randArr: number[] = [];\r\n        for (let i = 0; i < randLen; i++) {\r\n            randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n        }\r\n\r\n        // thin lines take more than just 1 sample\r\n        const sampleArr = [8,4,4,4,2,2,2,2,2,2]; // <0.5, 0.5, 1, 1.5, etc.\r\n        const samples = sampleArr[Math.floor(params.size * 2)];\r\n        const samplesSquared: number = samples ? samples * samples : 0;\r\n        const sampleOffsets: number[] = [];\r\n        if (samples) {\r\n            let i = 0;\r\n            for (let n = 0; n < samples; n++) {\r\n                for (let m = 0; m < samples; m++, i += 2) {\r\n                    sampleOffsets[i] = (n + 1) / samples; // x offset\r\n                    sampleOffsets[i + 1] = (m + 1) / samples; // y offset\r\n                }\r\n            }\r\n        }\r\n\r\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\r\n        // to optimize calculations\r\n        const invSharpness = 1 - sharpness;\r\n        const sharpnessSubtrahend = sharpness / invSharpness;\r\n        const sizeSquared = params.size * params.size;\r\n        const distDivisor = sizeSquared * invSharpness / params.opacity;\r\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\r\n\r\n\r\n        const slicedBounds = this.sliceBounds({\r\n            x1: params.x1,\r\n            y1: params.y1,\r\n            x2: params.x2,\r\n            y2: params.y2,\r\n        });\r\n\r\n        const cellsW = this.getCellsWidth();\r\n        slicedBounds.forEach(slice => {\r\n            const cellOffsetX = (slice.index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(slice.index / cellsW) * cellSize;\r\n            const cellWidth = this.cells[slice.index]!.width;\r\n            const data = this.cells[slice.index]!.data;\r\n\r\n            // i - y index within cell\r\n            // e - x index within cell\r\n\r\n            // e2 - index in image data\r\n\r\n            // ri - y index within image relative to dot-center\r\n            // re - x index within image relative to dot-center\r\n\r\n            for (let i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++) {\r\n                for (\r\n                    let e = slice.bounds.x1,\r\n                        e2 = i * cellWidth * 4 + slice.bounds.x1 * 4,\r\n                        re = e + cellOffsetX - params.x;\r\n                    e <= slice.bounds.x2;\r\n                    e++,\r\n                        e2 += 4,\r\n                        re++\r\n                ) {\r\n                    // O = over -> brush-dot\r\n                    // U = under -> image\r\n\r\n                    let alphaO = 0;\r\n                    if (samplesSquared) {\r\n                        for (let f = 0; f < sampleOffsets.length; f += 2) {\r\n                            const dist = BB.lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\r\n                            if (dist >= sizeSquared) {\r\n                                continue;\r\n                            }\r\n                            alphaO += clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                        }\r\n                        if (!alphaO) {\r\n                            continue;\r\n                        }\r\n                        alphaO /= samplesSquared;\r\n                    } else {\r\n                        // technically needs + 0.5 offset, but not noticeable with large brush\r\n                        const dist = Math.pow(re, 2) + Math.pow(ri, 2);\r\n                        if (dist >= sizeSquared) {\r\n                            continue;\r\n                        }\r\n                        alphaO = clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                    }\r\n\r\n                    const invAlphaO = 1 - alphaO;\r\n                    const alphaU =data[e2 + 3] / 255;\r\n\r\n                    if (this.settingLockLayerAlpha) {\r\n                        const underR = (params.r * alphaO) + ((data[e2]) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1]) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2]) * invAlphaO);\r\n                        if (alphaU) {\r\n                            data[e2] = Math.floor(underR + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB + randArr[randI]);\r\n                        }\r\n                    } else {\r\n                        const underR = (params.r * alphaO) + ((data[e2] * alphaU) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1] * alphaU) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2] * alphaU) * invAlphaO);\r\n\r\n                        const newAlpha = 1 - invAlphaO * (1 - alphaU);\r\n                        data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\r\n                        if (newAlpha) {\r\n                            data[e2] = Math.floor(underR / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB / (newAlpha) + randArr[randI]);\r\n                        }\r\n                    }\r\n                    randI = (randI + 1) % randLen;\r\n\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    private calcSpacing (size: number): number {\r\n        return BB.mix(\r\n            (size * 2) / 2, // until size 5.3\r\n            (size * 2) / 9, // at size 24\r\n            clamp((size - 2.7) / (12 - 2.7), 0, 1)\r\n        );\r\n    }\r\n\r\n    private continueLine (x: number | undefined, y: number | undefined, p: number, isCoalesced: boolean): void {\r\n\r\n        this.drawBuffer = [];\r\n\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (this.settingSizePressure) ? Math.max(1, p * this.size) : Math.max(1, this.size);\r\n\r\n        const bDist = this.calcSpacing(localSize);\r\n\r\n        const avgX = (x === undefined) ? this.lastInput.x : x;\r\n        const avgY = (y === undefined) ? this.lastInput.y : y;\r\n\r\n        let localColNew: IRGBA;\r\n\r\n        if (this.blending === 0) {\r\n            this.mixCol.r = this.color.r;\r\n            this.mixCol.g = this.color.g;\r\n            this.mixCol.b = this.color.b;\r\n        } else {\r\n            let average;\r\n            if (isCoalesced) {\r\n                average = {r: this.localColOld.r, g: this.localColOld.g, b: this.localColOld.b, a: 0};\r\n            } else {\r\n                const avgParams = [avgX, avgY, ((this.settingSizePressure) ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size))];\r\n                const bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\r\n                if (bounds) {\r\n                    this.copyFromCanvas(bounds);\r\n                }\r\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\r\n            }\r\n            localColNew = {r: 0, g: 0, b: 0, a: 0};\r\n\r\n            if (average.a > 0 && this.blendCol.a === 0) {\r\n                this.blendCol.r = average.r;\r\n                this.blendCol.g = average.g;\r\n                this.blendCol.b = average.b;\r\n                this.blendCol.a = average.a;\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n\r\n            } else {\r\n                if (average.a === 0) {\r\n                    average.r = this.color.r;\r\n                    average.g = this.color.g;\r\n                    average.b = this.color.b;\r\n                    average.a = 1 - this.blending;\r\n                }\r\n\r\n                this.blendCol.r = BB.mix(this.blendCol.r, BB.mix(this.blendCol.r, average.r, this.blendMix), average.a);\r\n                this.blendCol.g = BB.mix(this.blendCol.g, BB.mix(this.blendCol.g, average.g, this.blendMix), average.a);\r\n                this.blendCol.b = BB.mix(this.blendCol.b, BB.mix(this.blendCol.b, average.b, this.blendMix), average.a);\r\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n            }\r\n\r\n        }\r\n\r\n\r\n        const bezierCallback: TBezierLineCallback  = (val) => {\r\n            if (this.blending >= 1 && this.blendCol.a <= 0) {\r\n                return;\r\n            }\r\n            const factor = val.t;\r\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (this.settingOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\r\n            localSize = (this.settingSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\r\n            if (this.blending != 0) {\r\n                this.mixCol.r = BB.mix(this.localColOld.r, localColNew.r, factor);\r\n                this.mixCol.g = BB.mix(this.localColOld.g, localColNew.g, factor);\r\n                this.mixCol.b = BB.mix(this.localColOld.b, localColNew.b, factor);\r\n            }\r\n            if (this.blending === 1 && this.localColOld.a === 0) {\r\n                this.mixCol.r = localColNew.r;\r\n                this.mixCol.g = localColNew.g;\r\n                this.mixCol.b = localColNew.b;\r\n            }\r\n            const bounds = this.prepDot(val.x, val.y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: val.x,\r\n                    y: val.y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixCol.r, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixCol.g, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixCol.b, this.blending),\r\n                });\r\n            }\r\n        };\r\n\r\n        if (x === undefined || y === undefined) {\r\n            this.bezierLine!.addFinal(bDist, bezierCallback);\r\n        } else {\r\n            this.bezierLine!.add(x, y, bDist, bezierCallback);\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.localColOld = localColNew!;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.size;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.size = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.opacity = o;\r\n    }\r\n\r\n    getBlending (): number {\r\n        return this.blending;\r\n    }\r\n\r\n    setBlending (b: number): void {\r\n        this.blending = b;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.color = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setSizePressure (b: boolean): void {\r\n        this.settingSizePressure = b;\r\n    }\r\n\r\n    setOpacityPressure (b: boolean): void {\r\n        this.settingOpacityPressure = b;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setIsTesting (b: boolean): void {\r\n        this.isTesting = b;\r\n    }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'BlendBrush'],\r\n            actions: [],\r\n        };\r\n\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(() => undefined);\r\n\r\n        this.isDrawing = true;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n        if (this.blending === 0) {\r\n            this.mixCol.r = this.color.r;\r\n            this.mixCol.g = this.color.g;\r\n            this.mixCol.b = this.color.b;\r\n        } else {\r\n            this.copyFromCanvas(this.prepDot(x, y, localSize));\r\n\r\n            const average = this.getAverage(\r\n                x,\r\n                y,\r\n                ((this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size))\r\n            );\r\n            if (average.a === 0) {\r\n                this.blendCol = {\r\n                    r: this.color.r,\r\n                    g: this.color.g,\r\n                    b: this.color.b,\r\n                    a: 1 - this.blending,\r\n                };\r\n            } else {\r\n                this.blendCol = {\r\n                    r: average.r,\r\n                    g: average.g,\r\n                    b: average.b,\r\n                    a: average.a,\r\n                };\r\n            }\r\n\r\n            this.mixCol.r = this.blendCol.r;\r\n            this.mixCol.g = this.blendCol.g;\r\n            this.mixCol.b = this.blendCol.b;\r\n        }\r\n\r\n        this.localColOld = {r: this.mixCol.r, g: this.mixCol.g, b: this.mixCol.b, a: this.blendCol.a};\r\n\r\n        this.redrawBounds = undefined;\r\n        this.drawBuffer = [];\r\n\r\n        if (this.blending < 1 || this.blendCol.a > 0) {\r\n            const bounds = this.prepDot(x, y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x,\r\n                    y: y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixCol.r, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixCol.g, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixCol.b, this.blending),\r\n                });\r\n            }\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.bezierLine = new BB.BezierLine();\r\n        this.bezierLine.add(x, y, 0, function () {\r\n        });\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        if (!this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n\r\n        if (!this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    endLine (): void {\r\n        if (this.bezierLine) {\r\n            this.continueLine(undefined, undefined, this.lastInput.pressure, false);\r\n        }\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = undefined;\r\n\r\n\r\n        this.drawChangedCells();\r\n\r\n        if (this.historyEntry && this.history && this.cells.find(item => !!item)) {\r\n            this.historyEntry.actions.push({\r\n                action: 'drawCells',\r\n                params: [this.cells],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n        this.cells = [];\r\n    }\r\n\r\n    /**\r\n     * draw cells onto context\r\n     * @param cells\r\n     */\r\n    drawCells (cells: (ImageData | undefined)[]): void {\r\n        const cellsW = this.getCellsWidth();\r\n        cells.forEach((imageData, index) => {\r\n            if (!imageData) {\r\n                return;\r\n            }\r\n            const cellOffsetX = (index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(index / cellsW) * cellSize;\r\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\r\n        });\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(() => undefined);\r\n        this.redrawBounds = undefined;\r\n        this.drawBuffer = [];\r\n\r\n        this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\r\n        const average = this.getAverage(x1, y1, Math.max(0.1, this.size));\r\n\r\n        if (average.a === 0) {\r\n            this.blendCol = {\r\n                r: this.color.r,\r\n                g: this.color.g,\r\n                b: this.color.b,\r\n                a: 1 - this.blending,\r\n            };\r\n        } else {\r\n            this.blendCol = {\r\n                r: average.r,\r\n                g: average.g,\r\n                b: average.b,\r\n                a: average.a,\r\n            };\r\n        }\r\n\r\n        this.mixCol.r = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixCol.g = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixCol.b = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\r\n\r\n\r\n        const p = 1;\r\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        const bDist = this.calcSpacing(localSize);\r\n        for (let loopDist = 0; loopDist <= mouseDist; loopDist += bDist) {\r\n            const bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\r\n            if (bounds) {\r\n                this.copyFromCanvas(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x1 + eX * loopDist,\r\n                    y: y1 + eY * loopDist,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixCol.r, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixCol.g, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixCol.b, this.blending),\r\n                });\r\n            }\r\n        }\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        if (this.history && this.cells.find(item => !!item)) {\r\n            this.drawCells(this.cells);\r\n            this.historyEntry = {\r\n                tool: ['brush', 'BlendBrush'],\r\n                actions: [{\r\n                    action: 'drawCells',\r\n                    params: [this.cells],\r\n                }],\r\n            };\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n        this.cells = [];\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB, TPressureInput} from '../kl-types';\r\n\r\nexport interface ISketchyBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'SketchyBrush'];\r\n    actions: THistoryInnerActions<SketchyBrush>[];\r\n}\r\n\r\nconst sampleCanvas = BB.canvas(32, 32);\r\nconst sampleCtx = BB.ctx(sampleCanvas);\r\n\r\nexport class SketchyBrush {\r\n\r\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\r\n    private settingColor: IRGB = {} as IRGB;\r\n    private settingSize: number = 1;\r\n    private settingOpacity: number = 0.2;\r\n    private settingBlending: number = 0.5;\r\n    private settingScale: number = 1;\r\n    private lastX: number = 0;\r\n    private lastY: number = 0;\r\n    private inputIsDrawing: boolean = false;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: ISketchyBrushHistoryEntry | undefined;\r\n    private sketchySeed: number = 0;\r\n    private points: [number, number][] = []; // x y\r\n    private count: number = 0;\r\n    private readonly mixMode = [\r\n        (c1: IRGB): IRGB => {\r\n            return c1;\r\n        },\r\n        (c1: IRGB, c2: IRGB): IRGB => { // why\r\n            const result = new BB.RGB(c1.r, c1.g, c1.b);\r\n            result.r *= c2.r / 255;\r\n            result.g *= c2.g / 255;\r\n            result.b *= c2.b / 255;\r\n            return result;\r\n        },\r\n    ];\r\n\r\n\r\n    private rand (): number {\r\n        this.sketchySeed++;\r\n        return Math.sin(6324634.2345 * Math.cos(this.sketchySeed * 5342.3423)) * 0.5 + 0.5;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor () {}\r\n\r\n    // ---- interface ----\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSeed (s: number): void {\r\n        this.sketchySeed = parseInt('' + s);\r\n    }\r\n\r\n    getSeed (): number {\r\n        return parseInt('' + this.sketchySeed);\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize / 2;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.settingColor = c;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    getBlending (): number {\r\n        return this.settingBlending;\r\n    }\r\n\r\n    setBlending (b: number): void {\r\n        this.settingBlending = b;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s * 2;\r\n    }\r\n\r\n    getScale (): number {\r\n        return this.settingScale;\r\n    }\r\n\r\n    setScale (s: number): void {\r\n        this.settingScale = s;\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    startLine (x: number, y: number, pressure: number, shift?: boolean): void {\r\n        if (shift && this.lastInput.x) {\r\n            this.inputIsDrawing = true;\r\n            this.endLine();\r\n        } else {\r\n            this.inputIsDrawing = true;\r\n            this.lastX = x;\r\n            this.lastY = y;\r\n            this.lastInput.x = x;\r\n            this.lastInput.y = y;\r\n            this.historyEntry = {\r\n                tool: ['brush', 'SketchyBrush'],\r\n                actions: [\r\n                    {\r\n                        action: 'setScale',\r\n                        params: [this.settingScale],\r\n                    },\r\n                    {\r\n                        action: 'setSize',\r\n                        params: [this.settingSize / 2],\r\n                    },\r\n                    {\r\n                        action: 'setOpacity',\r\n                        params: [this.settingOpacity],\r\n                    },\r\n                    {\r\n                        action: 'setColor',\r\n                        params: [this.settingColor],\r\n                    },\r\n                    {\r\n                        action: 'setBlending',\r\n                        params: [this.settingBlending],\r\n                    },\r\n                    {\r\n                        action: 'startLine',\r\n                        params: [x, y, pressure],\r\n                    },\r\n                ],\r\n            };\r\n        }\r\n\r\n    }\r\n\r\n    goLine (p_x: number, p_y: number, pressure: number, preMixedColor: IRGB | undefined): void {\r\n        if (!this.inputIsDrawing || (p_x === this.lastInput.x && p_y === this.lastInput.y)) {\r\n            return;\r\n        }\r\n\r\n        let e, b, a, g;\r\n        const x = parseInt('' + p_x);\r\n        const y = parseInt('' + p_y);\r\n        this.points.push([x, y]);\r\n\r\n        let mixr = this.settingColor.r;\r\n        let mixg = this.settingColor.g;\r\n        let mixb = this.settingColor.b;\r\n\r\n        if (preMixedColor) {\r\n            mixr = preMixedColor.r;\r\n            mixg = preMixedColor.g;\r\n            mixb = preMixedColor.b;\r\n        } else {\r\n            if (this.settingBlending !== 0) {\r\n                if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < this.context.canvas.width - 1 && y - 5 < this.context.canvas.height - 1) {\r\n                    mixr = 0;\r\n                    mixg = 0;\r\n                    mixb = 0;\r\n                    const mixX = Math.min(this.context.canvas.width - 1, Math.max(0, x - 5));\r\n                    const mixY = Math.min(this.context.canvas.height - 1, Math.max(0, y - 5));\r\n                    let mixW = Math.min(this.context.canvas.width - 1, Math.max(0, x + 5));\r\n                    let mixH = Math.min(this.context.canvas.height - 1, Math.max(0, y + 5));\r\n                    mixW -= mixX;\r\n                    mixH -= mixY;\r\n\r\n                    if (mixW > 0 && mixH > 0) {\r\n                        const imDat = this.context.getImageData(mixX, mixY, mixW, mixH);\r\n                        let countMix = 0;\r\n                        for (let i = 0; i < imDat.data.length; i += 4) {\r\n                            mixr += imDat.data[i + 0];\r\n                            mixg += imDat.data[i + 1];\r\n                            mixb += imDat.data[i + 2];\r\n                            countMix++;\r\n                        }\r\n                        mixr /= countMix;\r\n                        mixg /= countMix;\r\n                        mixb /= countMix;\r\n                    }\r\n\r\n                    const mixed = this.mixMode[0](new BB.RGB(mixr, mixg, mixb), this.settingColor);\r\n                    mixr = parseInt('' + BB.mix(this.settingColor.r, mixed.r, this.settingBlending));\r\n                    mixg = parseInt('' + BB.mix(this.settingColor.g, mixed.g, this.settingBlending));\r\n                    mixb = parseInt('' + BB.mix(this.settingColor.b, mixed.b, this.settingBlending));\r\n                }\r\n            }\r\n        }\r\n\r\n        this.context.save();\r\n        this.context.strokeStyle = 'rgba(' + mixr + ', ' + mixg + ', ' + mixb + ', ' + this.settingOpacity + ')';\r\n        this.context.lineWidth = this.settingSize;\r\n\r\n        this.context.beginPath();\r\n        this.context.moveTo(this.lastX, this.lastY);\r\n        this.context.lineTo(x, y);\r\n\r\n        for (e = 0; e < this.points.length; e++) {\r\n            b = this.points[e][0] - this.points[this.count][0];\r\n            a = this.points[e][1] - this.points[this.count][1];\r\n            g = b * b + a * a;\r\n            if (g < 4000 * this.settingScale * this.settingScale && this.rand() > g / 2000 / this.settingScale / this.settingScale) {\r\n                this.context.moveTo(this.points[this.count][0] + (b * 0.3), this.points[this.count][1] + (a * 0.3));\r\n                this.context.lineTo(this.points[e][0] - (b * 0.3), this.points[e][1] - (a * 0.3));\r\n            }\r\n        }\r\n\r\n        this.context.stroke();\r\n        this.context.restore();\r\n\r\n\r\n        this.count++;\r\n        this.lastX = x;\r\n        this.lastY = y;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.historyEntry!.actions!.push({\r\n            action: 'goLine',\r\n            params: [p_x, p_y, pressure, {r: mixr, g: mixg, b: mixb}],\r\n        });\r\n    }\r\n\r\n    endLine (): void {\r\n        this.inputIsDrawing = false;\r\n        this.count = 0;\r\n        this.points = [];\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions!.push({\r\n                action: 'endLine',\r\n                params: [],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n    }\r\n    //cheap 'n' ugly\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.inputIsDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n\r\n        this.context.save();\r\n        this.context.lineWidth = this.settingSize;\r\n\r\n        const mixCol = {\r\n            r: this.settingColor.r,\r\n            g: this.settingColor.g,\r\n            b: this.settingColor.b,\r\n        };\r\n        if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < this.context.canvas.width - 1 && y1 - 5 < this.context.canvas.height - 1) {\r\n            mixCol.r = 0;\r\n            mixCol.g = 0;\r\n            mixCol.b = 0;\r\n            const mixX = Math.min(this.context.canvas.width - 1, Math.max(0, x1 - 5));\r\n            const mixY = Math.min(this.context.canvas.height - 1, Math.max(0, y1 - 5));\r\n            let mixW = Math.min(this.context.canvas.width - 1, Math.max(0, x1 + 5));\r\n            let mixH = Math.min(this.context.canvas.height - 1, Math.max(0, y1 + 5));\r\n            mixW -= mixX;\r\n            mixH -= mixY;\r\n            if (mixW > 0 && mixH > 0) {\r\n                const w = Math.min(sampleCanvas.width, mixW);\r\n                const h = Math.min(sampleCanvas.height, mixH);\r\n                sampleCtx.save();\r\n                sampleCtx.globalCompositeOperation = 'copy';\r\n                sampleCtx.drawImage(this.context.canvas, mixX, mixY, mixW, mixH, 0, 0, w, h);\r\n                sampleCtx.restore();\r\n\r\n                const imDat = sampleCtx.getImageData(mixX, mixY, mixW, mixH);\r\n                let countMix = 0;\r\n                for (let i = 0; i < imDat.data.length; i += 4) {\r\n                    mixCol.r += imDat.data[i + 0];\r\n                    mixCol.g += imDat.data[i + 1];\r\n                    mixCol.b += imDat.data[i + 2];\r\n                    countMix++;\r\n                }\r\n                mixCol.r /= countMix;\r\n                mixCol.g /= countMix;\r\n                mixCol.b /= countMix;\r\n            }\r\n        }\r\n        const mixed = this.mixMode[0](new BB.RGB(mixCol.r, mixCol.g, mixCol.b), this.settingColor);\r\n        mixCol.r = parseInt('' + (this.settingBlending * mixed.r + this.settingColor.r * (1 - this.settingBlending)));\r\n        mixCol.g = parseInt('' + (this.settingBlending * mixed.g + this.settingColor.g * (1 - this.settingBlending)));\r\n        mixCol.b = parseInt('' + (this.settingBlending * mixed.b + this.settingColor.b * (1 - this.settingBlending)));\r\n        this.context.strokeStyle = 'rgba(' + mixCol.r + ', ' + mixCol.g + ', ' + mixCol.b + ', ' + this.settingOpacity + ')';\r\n        this.context.beginPath();\r\n        this.context.moveTo(x1, y1);\r\n        this.context.lineTo(x2, y2);\r\n        this.context.stroke();\r\n        this.context.strokeStyle = 'rgba(' + mixCol.r + ', ' + mixCol.g + ', ' + mixCol.b + ', ' + this.settingOpacity + ')';\r\n        this.context.restore();\r\n\r\n        const historyEntry: ISketchyBrushHistoryEntry = {\r\n            tool: ['brush', 'SketchyBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'setScale',\r\n                    params: [this.settingScale],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize / 2],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setBlending',\r\n                    params: [this.settingBlending],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n\r\n    isDrawing (): boolean {\r\n        return this.inputIsDrawing;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB, TPressureInput} from '../kl-types';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {BezierLine} from '../../bb/math/line';\r\nimport {ERASE_COLOR} from './erase-color';\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\nexport interface IPixelBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'PixelBrush'];\r\n    actions: THistoryInnerActions<PixelBrush>[];\r\n}\r\n\r\n\r\nexport class PixelBrush {\r\n\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IPixelBrushHistoryEntry | undefined;\r\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\r\n    private settingHasSizePressure: boolean = true;\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingSize: number = 0.5;\r\n    private settingSpacing: number = 0.9;\r\n    private settingOpacity: number = 1;\r\n    private settingColor: IRGB = {} as IRGB;\r\n    private settingColorStr: string = '';\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingIsEraser: boolean = false;\r\n    private settingUseDither: boolean = true;\r\n    private inputIsDrawing: boolean = false;\r\n    private lineToolLastDot: number = 0;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private bezierLine: BezierLine | null = null;\r\n    private readonly ditherArr: [number, number][] = [\r\n        [3, 2],\r\n        [1, 0],\r\n        [3, 0],\r\n        [1, 2],\r\n        [2, 1],\r\n        [0, 3],\r\n        [0, 1],\r\n        [2, 3],\r\n\r\n        [2, 0],\r\n        [0, 2],\r\n        [0, 0],\r\n        [2, 2],\r\n        [1, 1],\r\n        [3, 3],\r\n        [3, 1],\r\n        [1, 3],\r\n    ];\r\n    private readonly ditherCanvas: HTMLCanvasElement;\r\n    private readonly ditherCtx: CanvasRenderingContext2D;\r\n    private ditherPattern: CanvasPattern = {} as CanvasPattern;\r\n\r\n\r\n    private updateDither (): void {\r\n        this.ditherCtx.clearRect(0, 0, 4, 4);\r\n        this.ditherCtx.fillStyle = this.settingIsEraser ? `rgb(${ERASE_COLOR},${ERASE_COLOR},${ERASE_COLOR})` : this.settingColorStr;\r\n        for (let i = 0; i < Math.max(1, Math.round(this.settingOpacity * this.ditherArr.length)); i++) {\r\n            this.ditherCtx.fillRect(this.ditherArr[i][0], this.ditherArr[i][1], 1, 1);\r\n        }\r\n        this.ditherPattern = throwIfNull(this.context.createPattern(this.ditherCanvas, 'repeat'));\r\n    }\r\n\r\n    /**\r\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\r\n     */\r\n    private cubicCurveOverThreshold (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D, maxAngleRad: number): boolean {\r\n        const d = BB.Vec2.nor({\r\n            x: p4.x - p1.x,\r\n            y: p4.y - p1.y,\r\n        });\r\n        const d2 = BB.Vec2.nor({\r\n            x: p2.x - p1.x,\r\n            y: p2.y - p1.y,\r\n        });\r\n        const d3 = BB.Vec2.nor({\r\n            x: p4.x - p3.x,\r\n            y: p4.y - p3.y,\r\n        });\r\n        // const a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\r\n        // const a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\r\n\r\n        return Math.max(BB.Vec2.dist(d, d2), BB.Vec2.dist(d, d3)) > maxAngleRad;\r\n    }\r\n\r\n    private plotCubicBezierLine (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D): void {\r\n\r\n        const isOverThreshold = this.cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\r\n\r\n        p1.x = Math.floor(p1.x);\r\n        p1.y = Math.floor(p1.y);\r\n        p4.x = Math.floor(p4.x);\r\n        p4.y = Math.floor(p4.y);\r\n\r\n        const dist = BB.dist(p1.x, p1.y, p4.x, p4.y);\r\n        if (!isOverThreshold || dist < 7) {\r\n            this.plotLine(p1.x, p1.y, p4.x, p4.y, true);\r\n            return;\r\n        }\r\n\r\n        const n = Math.max(2, Math.round(dist / 4));\r\n        const pointArr = [];\r\n        for (let i = 0; i <= n; i++) {\r\n            const t = i / n;\r\n            const a = Math.pow(1 - t, 3);\r\n            const b = 3 * t * Math.pow(1 - t, 2);\r\n            const c = 3 * Math.pow(t, 2) * (1 - t);\r\n            const d = Math.pow(t, 3);\r\n            pointArr.push({\r\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\r\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y,\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            this.plotLine(\r\n                Math.round(pointArr[i].x),\r\n                Math.round(pointArr[i].y),\r\n                Math.round(pointArr[i + 1].x),\r\n                Math.round(pointArr[i + 1].y),\r\n                true\r\n            );\r\n        }\r\n    }\r\n\r\n    private drawDot (x: number, y: number, size: number, opacity: number): void {\r\n        this.context.save();\r\n        if (this.settingIsEraser) {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : '#fff';\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            }\r\n        } else {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        }\r\n        this.context.globalAlpha = this.settingUseDither ? 1 : opacity;\r\n        this.context.fillRect(\r\n            Math.round(x + -size),\r\n            Math.round(y + -size),\r\n            Math.round(size * 2),\r\n            Math.round(size * 2)\r\n        );\r\n        this.context.restore();\r\n    }\r\n\r\n    private continueLine (\r\n        x: number | null,\r\n        y: number | null,\r\n        size: number,\r\n        pressure: number\r\n    ): void {\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, () => {});\r\n        }\r\n\r\n        this.context.save();\r\n\r\n        const dotCallback = (\r\n            val: {\r\n                x: number;\r\n                y: number;\r\n                t: number;\r\n                angle?: number;\r\n                dAngle: number;\r\n            }\r\n        ): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            const localSize = Math.max(0.5, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            this.drawDot(val.x, val.y, localSize, localOpacity);\r\n        };\r\n\r\n        const controlCallback = (\r\n            controlObj: {\r\n                p1: IVector2D;\r\n                p2: IVector2D;\r\n                p3: IVector2D;\r\n                p4: IVector2D;\r\n            }\r\n        ): void => {\r\n            this.plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\r\n        };\r\n\r\n        if (Math.round(this.settingSize * 2) === 1) {\r\n            if (x === null || y === null) {\r\n                this.bezierLine.addFinal(4, undefined, controlCallback);\r\n            } else {\r\n                this.bezierLine.add(x, y, 4, undefined, controlCallback);\r\n            }\r\n\r\n        } else {\r\n            const localSpacing = size * this.settingSpacing;\r\n\r\n            if (x === null || y === null) {\r\n                this.bezierLine.addFinal(localSpacing, dotCallback);\r\n            } else {\r\n                this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n\r\n    /**\r\n     * bresenheim line drawing\r\n     */\r\n    private plotLine (x0: number, y0: number, x1: number, y1: number, skipFirst: boolean): void {\r\n        this.context.save();\r\n\r\n        if (this.settingIsEraser) {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : '#fff';\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            }\r\n        } else {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        }\r\n        this.context.globalAlpha = this.settingUseDither ? 1 : this.settingOpacity;\r\n\r\n        x0 = Math.floor(x0);\r\n        y0 = Math.floor(y0);\r\n        x1 = Math.floor(x1);\r\n        y1 = Math.floor(y1);\r\n\r\n        const dX = Math.abs(x1 - x0);\r\n        const sX = x0 < x1 ? 1 : -1;\r\n        const dY = -Math.abs(y1 - y0);\r\n        const sY = y0 < y1 ? 1 : -1;\r\n        let err = dX + dY;\r\n        // eslint-disable-next-line no-constant-condition\r\n        while (true) {\r\n            if (skipFirst) {\r\n                skipFirst = false;\r\n            } else {\r\n                this.context.fillRect(x0, y0, 1, 1);\r\n            }\r\n            if (x0 === x1 && y0 === y1) {\r\n                break;\r\n            }\r\n            const e2 = 2 * err;\r\n            if (e2 >= dY) {\r\n                err += dY;\r\n                x0 += sX;\r\n            }\r\n            if (e2 <= dX) {\r\n                err += dX;\r\n                y0 += sY;\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n    constructor () {\r\n        this.ditherCanvas = BB.canvas(4, 4);\r\n        this.ditherCtx = BB.ctx(this.ditherCanvas);\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'PixelBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n                {\r\n                    action: 'setIsEraser',\r\n                    params: [this.settingIsEraser],\r\n                },\r\n                {\r\n                    action: 'setUseDither',\r\n                    params: [this.settingUseDither],\r\n                },\r\n            ],\r\n        };\r\n\r\n        if (this.settingUseDither) {\r\n            this.updateDither();\r\n        }\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.5, p * this.settingSize) : Math.max(0.5, this.settingSize);\r\n\r\n        this.inputIsDrawing = true;\r\n        this.drawDot(x, y, localSize, localOpacity);\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        this.historyEntry.actions!.push({\r\n            action: 'startLine',\r\n            params: [x, y, p],\r\n        });\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.inputIsDrawing) {\r\n            return;\r\n        }\r\n        this.historyEntry!.actions!.push({\r\n            action: 'goLine',\r\n            params: [x, y, p],\r\n        });\r\n\r\n        //debug\r\n        //drawDot(x, y, 1, 0.5);\r\n\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = pressure;\r\n    }\r\n\r\n    endLine (x: number, y: number): void {\r\n\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n\r\n        //debug\r\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\r\n        //drawDot(x, y, 10, 0.1);\r\n\r\n        this.inputIsDrawing = false;\r\n\r\n        this.bezierLine = null;\r\n\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions!.push({\r\n                action: 'endLine',\r\n                params: [x, y],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n    }\r\n\r\n    //cheap n' ugly\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n        this.lastInput.pressure = 1;\r\n\r\n        if (this.inputIsDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (this.settingUseDither) {\r\n            this.updateDither();\r\n        }\r\n\r\n        if (Math.round(this.settingSize * 2) === 1) {\r\n            this.plotLine(x1, y1, x2, y2, true);\r\n        } else {\r\n            // const angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\r\n            const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n            const eX = (x2 - x1) / mouseDist;\r\n            const eY = (y2 - y1) / mouseDist;\r\n            let loopDist;\r\n            const bdist = this.settingSize * this.settingSpacing;\r\n            this.lineToolLastDot = this.settingSize * this.settingSpacing;\r\n            for (loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n                this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity);\r\n            }\r\n        }\r\n\r\n        const historyEntry: IPixelBrushHistoryEntry = {\r\n            tool: ['brush', 'PixelBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n                {\r\n                    action: 'setIsEraser',\r\n                    params: [this.settingIsEraser],\r\n                },\r\n                {\r\n                    action: 'setUseDither',\r\n                    params: [this.settingUseDither],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n    //IS\r\n    isDrawing (): boolean {\r\n        return this.inputIsDrawing;\r\n    }\r\n\r\n    //SET\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor === c) {\r\n            return;\r\n        }\r\n        this.settingColor = c;\r\n        this.settingColorStr = 'rgb(' + this.settingColor.r + ',' + this.settingColor.g + ',' + this.settingColor.b + ')';\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = Math.round(s * 2) / 2;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = b;\r\n    }\r\n\r\n    setIsEraser (b: boolean): void {\r\n        this.settingIsEraser = b;\r\n    }\r\n\r\n    setUseDither (b: boolean): void {\r\n        this.settingUseDither = b;\r\n    }\r\n\r\n    //GET\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.settingIsEraser;\r\n    }\r\n\r\n    getUseDither (): boolean {\r\n        return this.settingUseDither;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {TPressureInput} from '../kl-types';\r\nimport {BezierLine} from '../../bb/math/line';\r\nimport {ERASE_COLOR} from './erase-color';\r\nimport {KlCanvasContext} from '../canvas/kl-canvas';\r\n\r\nexport interface IEraserBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'EraserBrush'];\r\n    actions: THistoryInnerActions<EraserBrush>[];\r\n}\r\n\r\nexport class EraserBrush {\r\n\r\n    private size: number = 30;\r\n    private spacing: number = 0.4;\r\n    private opacity: number = 1;\r\n    private useSizePressure: boolean = true;\r\n    private useOpacityPressure: boolean = false;\r\n    private isTransparentBG: boolean = false;\r\n\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IEraserBrushHistoryEntry | undefined;\r\n    private isBaseLayer: boolean = false;\r\n    private context: KlCanvasContext = {} as KlCanvasContext;\r\n\r\n    private started: boolean = false;\r\n    private lastDot: number | undefined;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private bezierLine: BezierLine | undefined;\r\n\r\n\r\n    private drawDot (x: number, y: number, size: number, opacity: number): void {\r\n        this.context.save();\r\n        if (this.isBaseLayer) {\r\n            if (this.isTransparentBG) {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        } else {\r\n            this.context.globalCompositeOperation = 'destination-out';\r\n        }\r\n        const radgrad = this.context.createRadialGradient(size, size, 0, size, size, size);\r\n        let sharpness = Math.pow(opacity, 2);\r\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\r\n        const oFac = Math.max(0, Math.min(1, opacity));\r\n        const localOpacity = 2 * oFac - oFac * oFac;\r\n        radgrad.addColorStop(sharpness, `rgba(${ERASE_COLOR}, ${ERASE_COLOR}, ${ERASE_COLOR}, ` + localOpacity + ')');\r\n        radgrad.addColorStop(1, `rgba(${ERASE_COLOR}, ${ERASE_COLOR}, ${ERASE_COLOR}, 0)`);\r\n        this.context.fillStyle = radgrad;\r\n        this.context.translate(x - size, y - size);\r\n        this.context.fillRect(0, 0, size * 2, size * 2);\r\n        this.context.restore();\r\n    }\r\n\r\n    private continueLine (x: number | undefined, y: number | undefined, p: number): void {\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (this.useSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * localSize * this.spacing);\r\n\r\n        const bezierCallback = (val: {\r\n            x: number;\r\n            y: number;\r\n            t: number;\r\n            angle?: number;\r\n            dAngle: number;\r\n        }): void => {\r\n            const factor = val.t;\r\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (this.useOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\r\n            localSize = (this.useSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\r\n\r\n            this.drawDot(val.x, val.y, localSize, localOpacity);\r\n        };\r\n\r\n        if (x === undefined || y === undefined) {\r\n            this.bezierLine!.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            this.bezierLine!.add(x, y, bdist, bezierCallback);\r\n        }\r\n    }\r\n\r\n    // ---- public -----\r\n    constructor () {}\r\n\r\n    // ---- interface ----\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'EraserBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.useOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.useSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.size],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.opacity],\r\n                },\r\n                {\r\n                    action: 'setTransparentBG',\r\n                    params: [this.isTransparentBG],\r\n                },\r\n                {\r\n                    action: 'startLine',\r\n                    params: [x, y, p],\r\n                },\r\n            ],\r\n        };\r\n\r\n        this.isBaseLayer = 0 === this.context.canvas.index;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        const localOpacity = (this.useOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.useSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n        this.started = true;\r\n        if (localSize > 1) {\r\n            this.drawDot(x, y, localSize, localOpacity);\r\n        }\r\n        this.lastDot = localSize * this.spacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        this.bezierLine = new BB.BezierLine();\r\n        this.bezierLine.add(x, y, 0, () => undefined);\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.started || !this.historyEntry) {\r\n            return;\r\n        }\r\n        this.historyEntry.actions?.push({\r\n            action: 'goLine',\r\n            params: [x, y, p],\r\n        });\r\n\r\n        this.continueLine(x, y, this.lastInput.pressure);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n    }\r\n\r\n    endLine (): void {\r\n\r\n        if (this.bezierLine) {\r\n            this.continueLine(undefined, undefined, this.lastInput.pressure);\r\n        }\r\n\r\n        this.started = false;\r\n        this.bezierLine = undefined;\r\n\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions?.push({\r\n                action: 'endLine',\r\n                params: [],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n\r\n        this.isBaseLayer = 0 === this.context.canvas.index;\r\n\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.started || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * this.size * this.spacing);\r\n        this.lastDot = 0;\r\n        for (loopDist = this.lastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.size, this.opacity);\r\n        }\r\n\r\n\r\n        const historyEntry: IEraserBrushHistoryEntry = {\r\n            tool: ['brush', 'EraserBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.useOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.useSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.size],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.opacity],\r\n                },\r\n                {\r\n                    action: 'setTransparentBG',\r\n                    params: [this.isTransparentBG],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n    //IS\r\n    isDrawing (): boolean {\r\n        return this.started;\r\n    }\r\n\r\n    //SET\r\n    setContext (c: KlCanvasContext): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.size = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.opacity = o;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.useSizePressure = b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.useOpacityPressure = b;\r\n    }\r\n\r\n    setTransparentBG (b: boolean): void {\r\n        this.isTransparentBG = b;\r\n    }\r\n\r\n    //GET\r\n    getSize (): number {\r\n        return this.size;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacity;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb-types';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB} from '../kl-types';\r\nimport {clamp} from '../../bb/math/math';\r\nimport {BezierLine, TBezierLineCallback} from '../../bb/math/line';\r\n\r\nexport interface ISmudgeBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'SmudgeBrush'];\r\n    actions: THistoryInnerActions<SmudgeBrush>[];\r\n}\r\n\r\n// let statCount = 1;\r\n// let statAcc = 0;\r\n// stats on win10, chrome, size 100, opacity 80, smudge()\r\n// unoptimized: 1 ms\r\n// minimal: 0.09 ms\r\n// minimal + circle: 0.5ms\r\n// minimal + circle + ix, iy: 0.23ms\r\n// unoptimized + ix, iy: 0.64 ms\r\n// unoptimized + ix, iy + sans rounding: 0.61 ms\r\n// ix, iy + sans rounding + sans random: 0.32ms\r\n// ix, iy + sans rounding + fast random: 0.46 ms\r\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\r\n\r\nconst CELL_SIZE = 256;\r\n\r\ninterface ISmudgeParams {\r\n    aP: IVector2D;\r\n    bP: IVector2D;\r\n    size: {\r\n        w: number;\r\n        h: number;\r\n    };\r\n    brush: {\r\n        center: IVector2D;\r\n        size: number;\r\n        opacity: number;\r\n        alphaLock: boolean;\r\n    };\r\n}\r\n\r\n\r\n/**\r\n * determine bounds of smudge\r\n * @param imWidth\r\n * @param imHeight\r\n * @param aP\r\n * @param bP\r\n * @param size\r\n */\r\nfunction prepSmudge (\r\n    imWidth: number,\r\n    imHeight: number,\r\n    aP: IVector2D, // top left of source, integers\r\n    bP: IVector2D, // top left of dest, integers\r\n    size: {w: number; h: number}, // size of both rectangles, integers\r\n): ({\r\n    aP: IVector2D;\r\n    bP: IVector2D;\r\n    size: {w: number; h: number};\r\n} | null) {\r\n\r\n    if (aP.x === bP.x && aP.y === bP.y) {\r\n        return null;\r\n    }\r\n\r\n    aP = BB.copyObj(aP);\r\n    bP = BB.copyObj(bP);\r\n    size = BB.copyObj(size);\r\n\r\n    // corner behavior\r\n    // cut down rectangles, if a or b go outside\r\n    // i.e. if user drags partially or fully outside the canvas\r\n    {\r\n        let top = 0;\r\n        let right = 0;\r\n        let bottom = 0;\r\n        let left = 0;\r\n\r\n        if (aP.x < 0) {\r\n            left = -aP.x;\r\n        }\r\n        if (aP.y < 0) {\r\n            top = -aP.y;\r\n        }\r\n        if (bP.x < 0) {\r\n            left = Math.max(left, -bP.x);\r\n        }\r\n        if (bP.y < 0) {\r\n            top = Math.max(top, -bP.y);\r\n        }\r\n        if (aP.x + size.w > imWidth) {\r\n            right = aP.x + size.w - imWidth;\r\n        }\r\n        if (aP.y + size.h > imHeight) {\r\n            bottom = aP.y + size.h - imHeight;\r\n        }\r\n        if (bP.x + size.w > imWidth) {\r\n            right = Math.max(right, bP.x + size.w - imWidth);\r\n        }\r\n        if (bP.y + size.h > imHeight) {\r\n            bottom = Math.max(bottom, bP.y + size.h - imHeight);\r\n        }\r\n\r\n        aP.x += left;\r\n        bP.x += left;\r\n        aP.y += top;\r\n        bP.y += top;\r\n\r\n        size.w = size.w - left - right;\r\n        size.h = size.h - top - bottom;\r\n        if (size.w <= 0 || size.h <= 0) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    return {\r\n        aP: {\r\n            x: aP.x,\r\n            y: aP.y,\r\n        },\r\n        bP: {\r\n            x: bP.x,\r\n            y: bP.y,\r\n        },\r\n        size: {\r\n            w: size.w,\r\n            h: size.h,\r\n        },\r\n    };\r\n}\r\n\r\n/**\r\n * Pixel operations that do the smudging via ImageData\r\n * @param imageData\r\n * @param p\r\n */\r\nfunction smudge (imageData: ImageData, p : ISmudgeParams): void {\r\n\r\n    p = BB.copyObj(p);\r\n\r\n    const cSize = p.brush.size;\r\n    const cX = p.brush.center.x;\r\n    const cY = p.brush.center.y;\r\n\r\n    /*if (statCount % 1000 === 0) {\r\n        console.log(statAcc / 1000);\r\n        statAcc = 0;\r\n    }\r\n    let start = performance.now();*/\r\n\r\n\r\n    // determine offset\r\n    const aIndex = p.aP.y * imageData.width + p.aP.x;\r\n    const bIndex = p.bP.y * imageData.width + p.bP.x;\r\n    const offset = (bIndex - aIndex) * 4;\r\n\r\n    // array with random numbers. faster than Math.random()\r\n    let randI = 0;\r\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n    const randArr: number[] = [];\r\n    for (let i = 0; i < randLen; i++) {\r\n        randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n    }\r\n\r\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\r\n\r\n    const pixel = (ai: number, bi: number, ix: number, iy: number): void => {\r\n\r\n        const dist = BB.dist(cX, cY, ix, iy);\r\n        const fac = 1 - p.brush.opacity * (1 - clamp((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\r\n\r\n        if (fac === 1) {\r\n            return;\r\n        }\r\n\r\n        if (!imageData.data[ai + 3]) {\r\n            /* empty */\r\n        } else if (!imageData.data[bi + 3]) { // don't mix if target fully transparent. pixel might have a strange color.\r\n            imageData.data[bi] = imageData.data[ai];\r\n            imageData.data[bi + 1] = imageData.data[ai + 1];\r\n            imageData.data[bi + 2] = imageData.data[ai + 2];\r\n        } else {\r\n\r\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\r\n            // not totally accurate. TODO same compositing as blend brush\r\n            let fac2;\r\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) {\r\n                fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\r\n            } else {\r\n                fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\r\n            }\r\n\r\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\r\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\r\n            // No +0.5, because it cancels out with rand.\r\n            imageData.data[bi] = Math.floor(BB.mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\r\n            imageData.data[bi + 1] = Math.floor(BB.mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\r\n            imageData.data[bi + 2] = Math.floor(BB.mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\r\n\r\n            randI = (randI + 1) % randLen;\r\n        }\r\n        // Always mix alpha. unless alpha lock\r\n        if (!p.brush.alphaLock) {\r\n            imageData.data[bi + 3] = Math.floor(BB.mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\r\n        }\r\n\r\n    };\r\n\r\n    const bx1 = p.bP.x * 4;\r\n    const bx2 = bx1 + (p.size.w - 1) * 4;\r\n\r\n    // transfer of pixels depends on direction of smudging if there is overlap\r\n    if (p.aP.y < p.bP.y) {\r\n        for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else if (p.aP.y > p.bP.y) {\r\n        for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else {\r\n        if (p.aP.x < p.bP.x) {\r\n            for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        } else {\r\n            for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x; x < bx2 + yStart; x += 4, x2 += 4, ix++) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //statCount++;\r\n    //statAcc += performance.now() - start;\r\n}\r\n\r\nexport class SmudgeBrush {\r\n\r\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: ISmudgeBrushHistoryEntry | undefined;\r\n\r\n    private settingColor: IRGB = {r: 0, g: 0, b: 0};\r\n    private settingSize: number = 35;\r\n    private settingSpacing: number = 0.20446882736951905;\r\n    private settingOpacity: number = 0.8;\r\n    private settingHasSizePressure: boolean = false;\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingLockLayerAlpha: boolean = false;\r\n\r\n    private lineToolLastDot: number = 0;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastDot: IVector2D | undefined;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private bezierLine: BezierLine | undefined;\r\n\r\n    private redrawBounds: IBounds | undefined;\r\n    private completeRedrawBounds: IBounds | undefined;\r\n\r\n    private copyImageData: ImageData = {} as ImageData;\r\n\r\n    private drawBuffer: ISmudgeParams[] = [];\r\n\r\n    private copiedCells: boolean[] = [];\r\n\r\n    // workaround for https://github.com/microsoft/TypeScript/issues/41654\r\n    private resetRedrawBounds (): void {\r\n        this.redrawBounds = undefined;\r\n    }\r\n\r\n    private updateRedrawBounds (bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    private updateCompleteRedrawBounds (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.completeRedrawBounds = BB.updateBounds(\r\n            this.completeRedrawBounds,\r\n            { x1, y1, x2, y2 }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    copyFromCanvas (): void {\r\n\r\n        const touchedCells = this.copiedCells.map(() => false);\r\n\r\n        const bounds: IBounds[] = [];\r\n        const cellsW = Math.ceil(this.copyImageData.width / CELL_SIZE);\r\n\r\n        if (!this.redrawBounds) {\r\n            return;\r\n        }\r\n        bounds.push({\r\n            x1: Math.floor(this.redrawBounds.x1 / CELL_SIZE),\r\n            y1: Math.floor(this.redrawBounds.y1 / CELL_SIZE),\r\n            x2: Math.floor(this.redrawBounds.x2 / CELL_SIZE),\r\n            y2: Math.floor(this.redrawBounds.y2 / CELL_SIZE),\r\n        });\r\n        bounds.forEach(item => {\r\n            for (let i = item.x1; i <= item.x2; i++) {\r\n                for (let e = item.y1; e <= item.y2; e++) {\r\n                    touchedCells[e * cellsW + i] = true;\r\n                }\r\n            }\r\n        });\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.copiedCells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            this.copiedCells[i] = true;\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * CELL_SIZE + CELL_SIZE, this.copyImageData.width) - 1) % CELL_SIZE + 1;\r\n            const h = (Math.min(y * CELL_SIZE + CELL_SIZE, this.copyImageData.height) - 1) % CELL_SIZE + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = BB.ctx(tmpCanvas);\r\n            tmpCtx.drawImage(this.context.canvas, -x * CELL_SIZE, -y * CELL_SIZE);\r\n\r\n            const data = tmpCtx.getImageData(0, 0, w, h);\r\n\r\n            for (let i = 0; i < h; i++) {\r\n                for (let e = 0, e2 = i * w * 4, e3 = ((y * CELL_SIZE + i) * this.copyImageData.width + x * CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4) {\r\n                    this.copyImageData.data[e3] = data.data[e2];\r\n                    this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\r\n                    this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\r\n                    this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * fill drawBuffer with params about to be drawn\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     */\r\n    prepDot (x: number, y: number, size: number, opacity: number): void {\r\n        if (!this.lastDot) {\r\n            this.lastDot = {\r\n                x: x,\r\n                y: y,\r\n            };\r\n            return;\r\n        }\r\n\r\n        size = Math.round(size);\r\n\r\n\r\n        const w = Math.round(size * 2);\r\n        const h = Math.round(size * 2);\r\n\r\n        const bounds = prepSmudge(\r\n            this.copyImageData.width,\r\n            this.copyImageData.height,\r\n            {\r\n                x: Math.round(this.lastDot.x - size),\r\n                y: Math.round(this.lastDot.y - size),\r\n            },\r\n            {\r\n                x: Math.round(x - size),\r\n                y: Math.round(y - size),\r\n            },\r\n            {\r\n                w,\r\n                h,\r\n            },\r\n        );\r\n\r\n        if (bounds) {\r\n            const params: ISmudgeParams = {\r\n                aP: bounds.aP,\r\n                bP: bounds.bP,\r\n                size: bounds.size,\r\n                brush: {\r\n                    center: { x, y },\r\n                    size,\r\n                    opacity,\r\n                    alphaLock: this.settingLockLayerAlpha,\r\n                },\r\n            };\r\n            this.updateRedrawBounds({\r\n                x1: params.bP.x,\r\n                y1: params.bP.y,\r\n                x2: params.bP.x + params.brush.size * 2,\r\n                y2: params.bP.y + params.brush.size * 2,\r\n            });\r\n            this.drawBuffer.push(params);\r\n        }\r\n\r\n        this.lastDot = {\r\n            x: x,\r\n            y: y,\r\n        };\r\n    }\r\n\r\n    continueLine (x: number | undefined, y: number | undefined, size: number, pressure: number): void {\r\n        this.drawBuffer = [];\r\n\r\n        if (!this.bezierLine) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function (){});\r\n        }\r\n\r\n        const drawArr: Parameters<typeof this.prepDot>[] = []; //draw instructions. will be all drawn at once\r\n\r\n        const dotCallback: TBezierLineCallback = (val): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity]);//, val.angle]);\r\n        };\r\n\r\n        const localSpacing = size * this.settingSpacing / 3;\r\n        if (x === undefined || y === undefined) {\r\n            this.bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            const item = drawArr[i];\r\n            this.prepDot(item[0], item[1], item[2], item[3]);\r\n        }\r\n\r\n        this.copyFromCanvas();\r\n\r\n        for (let i = 0; i < this.drawBuffer.length; i++) {\r\n            smudge(this.copyImageData, this.drawBuffer[i]);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor () { }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'SmudgeBrush'],\r\n            actions: [],\r\n        };\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.lastDot = undefined;\r\n        this.isDrawing = true;\r\n\r\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\r\n        const totalCells = Math.ceil(this.context.canvas.width / CELL_SIZE) * Math.ceil(this.context.canvas.height / CELL_SIZE);\r\n        this.copiedCells = '0'.repeat(totalCells).split('').map(() => false);\r\n\r\n        this.prepDot(x, y, localSize, localOpacity);\r\n\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2.pressure = p;\r\n\r\n        this.completeRedrawBounds = undefined;\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        this.resetRedrawBounds();\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput2.pressure = this.lastInput.pressure;\r\n        this.lastInput.pressure = pressure;\r\n    }\r\n\r\n    endLine (): void {\r\n        this.resetRedrawBounds();\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.context.save();\r\n        this.continueLine(undefined, undefined, localSize, this.lastInput.pressure);\r\n        this.context.restore();\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = undefined;\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        if (this.historyEntry && this.completeRedrawBounds) {\r\n            let historyIm: ImageData | HTMLCanvasElement = this.copyImageData;\r\n            if (!(\r\n                this.completeRedrawBounds.x1 === 0 &&\r\n                this.completeRedrawBounds.y1 === 0 &&\r\n                this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 &&\r\n                this.completeRedrawBounds.y2 >= this.context.canvas.height - 1\r\n            )) {\r\n\r\n                // temp canvas to prevent main canvas from getting slowed down in chrome\r\n                const tmpCanvas = BB.canvas(\r\n                    this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                    this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n                );\r\n                const tmpCtx = BB.ctx(tmpCanvas);\r\n                tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n                historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\r\n            }\r\n            this.historyEntry.actions.push({\r\n                action: 'drawImage',\r\n                params: [\r\n                    historyIm,\r\n                    this.completeRedrawBounds.x1,\r\n                    this.completeRedrawBounds.y1,\r\n                ],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n        this.copyImageData = {} as ImageData;\r\n    }\r\n\r\n    drawImage (im: ImageData | HTMLCanvasElement, x: number, y: number): void {\r\n        if (im instanceof ImageData) {\r\n            this.context.putImageData(im, x, y);\r\n        } else {\r\n            this.context.clearRect(x, y, im.width, im.height);\r\n            this.context.drawImage(im, x, y);\r\n        }\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        return;\r\n        /*\r\n        // todo\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = settingSize * settingSpacing;\r\n        lineToolLastDot = settingSize * settingSpacing;\r\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\r\n        }\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"SmudgeBrush\"],\r\n            actions: []\r\n        };\r\n        // todo\r\n        history.add(historyEntry);*/\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) {\r\n            return;\r\n        }\r\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = b;\r\n    }\r\n\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl-types';\r\nimport {IBounds} from '../../bb/bb-types';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {ERASE_COLOR} from './erase-color';\r\nimport {KL} from '../kl';\r\n\r\nexport interface IChemyBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'ChemyBrush'];\r\n    actions: THistoryInnerActions<ChemyBrush>[];\r\n}\r\n\r\ntype TChemyMode = 'fill' | 'stroke';\r\n\r\nexport class ChemyBrush {\r\n\r\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\r\n    private settingColor: IRGB = {} as IRGB;\r\n    private settingSize: number = 0.25; // radius - 0.5 - 99999\r\n    private settingOpacity: number = 1; // 0-1\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingIsEraser: boolean = false;\r\n    private settingMode: TChemyMode = 'fill';\r\n    private settingDistort: number = 0; // 0 - 1\r\n    private settingXSymmetry: boolean = false;\r\n    private settingYSymmetry: boolean = false;\r\n    private settingGradient: boolean = false;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n\r\n    private copyCanvas: HTMLCanvasElement = {} as HTMLCanvasElement;\r\n    private path: {x: number; y: number}[] = [];\r\n    private minY: number = 0;\r\n    private maxY: number = 0;\r\n    private completeRedrawBounds: IBounds | undefined;\r\n\r\n    private updateCompleteRedrawBounds (x: number, y: number): void {\r\n        let bounds = { x1: x, y1: y, x2: x, y2: y};\r\n        if (this.settingXSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: -x + this.copyCanvas.width,\r\n                    y1: y,\r\n                    x2: -x + this.copyCanvas.width,\r\n                    y2: y,\r\n                }\r\n                );\r\n        }\r\n        if (this.settingYSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: x,\r\n                    y1: -y + this.copyCanvas.height,\r\n                    x2: x,\r\n                    y2: -y + this.copyCanvas.height,\r\n                }\r\n            );\r\n        }\r\n        const buffer = this.settingMode === 'stroke' ? this.settingSize + 1 : 1;\r\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\r\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\r\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\r\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\r\n\r\n        this.completeRedrawBounds = BB.updateBounds(this.completeRedrawBounds, bounds);\r\n    }\r\n\r\n    private drawShape (): void {\r\n        this.context.save();\r\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\r\n        this.context.drawImage(this.copyCanvas, 0, 0);\r\n\r\n        const color = {...this.settingColor};\r\n        if (this.settingIsEraser) {\r\n            color.r = ERASE_COLOR;\r\n            color.g = ERASE_COLOR;\r\n            color.b = ERASE_COLOR;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            }\r\n        } else {\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        }\r\n\r\n        if (this.path.length > 1) {\r\n\r\n            // path\r\n            const path = new Path2D();\r\n            this.path.forEach((item, index) => {\r\n                if (index === 0) {\r\n                    path.moveTo(item.x, item.y);\r\n                } else {\r\n                    path.lineTo(item.x, item.y);\r\n                }\r\n            });\r\n\r\n            let style: string | CanvasGradient = BB.ColorConverter.toRgbaStr({\r\n                r: color.r,\r\n                g: color.g,\r\n                b: color.b,\r\n                a: this.settingOpacity,\r\n            });\r\n            if (this.settingGradient) {\r\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\r\n                const gradient = this.context.createLinearGradient(\r\n                    0, startAtTop ? this.minY : this.maxY,\r\n                    0, startAtTop ? this.maxY : this.minY,\r\n                );\r\n                gradient.addColorStop(\r\n                    0,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: this.settingOpacity,\r\n                    })\r\n                );\r\n                gradient.addColorStop(\r\n                    1,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: 0,\r\n                    })\r\n                );\r\n                style = gradient;\r\n            }\r\n\r\n            // setup params\r\n            if (this.settingMode === 'fill') {\r\n                this.context.fillStyle = style;\r\n\r\n            } else {\r\n                this.context.lineWidth = this.settingSize * 2;\r\n                this.context.lineJoin = 'bevel';\r\n                this.context.strokeStyle = style;\r\n            }\r\n\r\n            // draw\r\n            const draw = () => {\r\n                if (this.settingMode === 'fill') {\r\n                    this.context.fill(path);\r\n                } else {\r\n                    this.context.stroke(path);\r\n                }\r\n            };\r\n\r\n            draw();\r\n            if (this.settingXSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(this.context.canvas.width / 2, 0);\r\n                this.context.scale(-1, 1);\r\n                this.context.translate(-this.context.canvas.width / 2, 0);\r\n                draw();\r\n                this.context.restore();\r\n            }\r\n            if (this.settingYSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(0, this.context.canvas.height / 2);\r\n                this.context.scale(1, -1);\r\n                this.context.translate(0, -this.context.canvas.height / 2);\r\n                draw();\r\n                this.context.restore();\r\n                if (this.settingXSymmetry) {\r\n                    this.context.save();\r\n                    this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\r\n                    this.context.scale(-1, -1);\r\n                    this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\r\n                    draw();\r\n                    this.context.restore();\r\n                }\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingMode === 'stroke' ? this.settingSize : 0;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.settingColor = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setMode (mode: TChemyMode): void {\r\n        this.settingMode = mode;\r\n    }\r\n\r\n    getMode (): TChemyMode {\r\n        return this.settingMode;\r\n    }\r\n\r\n    setDistort (distort: number): void {\r\n        this.settingDistort = BB.clamp(distort, 0, 1);\r\n    }\r\n\r\n    getDistort (): number {\r\n        return this.settingDistort;\r\n    }\r\n\r\n    setXSymmetry (b: boolean): void {\r\n        this.settingXSymmetry = b;\r\n    }\r\n\r\n    getXSymmetry (): boolean {\r\n        return this.settingXSymmetry;\r\n    }\r\n\r\n    setYSymmetry (b: boolean): void {\r\n        this.settingYSymmetry = b;\r\n    }\r\n\r\n    getYSymmetry (): boolean {\r\n        return this.settingYSymmetry;\r\n    }\r\n\r\n    setGradient (b: boolean): void {\r\n        this.settingGradient = b;\r\n    }\r\n\r\n    getGradient (): boolean {\r\n        return this.settingGradient;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = b;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.settingIsEraser;\r\n    }\r\n\r\n    setIsEraser (b: boolean): void {\r\n        this.settingIsEraser = b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    startLine (x: number, y: number): void {\r\n        this.isDrawing = true;\r\n        this.path = [{x, y}];\r\n        this.minY = y;\r\n        this.maxY = y;\r\n        this.copyCanvas = BB.canvas(this.context.canvas.width, this.context.canvas.height);\r\n        BB.ctx(this.copyCanvas).drawImage(this.context.canvas, 0, 0);\r\n        this.completeRedrawBounds = undefined;\r\n        this.updateCompleteRedrawBounds(x, y);\r\n    }\r\n\r\n    goLine (x: number, y: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        const pos = { x, y };\r\n        if (this.settingDistort > 0) {\r\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\r\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\r\n        }\r\n\r\n        this.minY = Math.min(this.minY, pos.y);\r\n        this.maxY = Math.max(this.maxY, pos.y);\r\n        this.path.push(pos);\r\n        this.updateCompleteRedrawBounds(x, y);\r\n        this.drawShape();\r\n    }\r\n\r\n    endLine (): void {\r\n        this.isDrawing = false;\r\n        this.completeRedrawBounds = BB.boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\r\n        if (this.path.length > 1 && this.completeRedrawBounds) {\r\n            const historyCanvas = BB.canvas(\r\n                this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n            );\r\n            const historyCtx = BB.ctx(historyCanvas);\r\n            historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n            this.history.push({\r\n                tool: ['brush', 'ChemyBrush'],\r\n                actions: [\r\n                    {\r\n                        action: 'drawImage',\r\n                        params: [\r\n                            historyCanvas, // faster than getting image data (measured on 2018 lenovo chromebook)\r\n                            this.completeRedrawBounds.x1,\r\n                            this.completeRedrawBounds.y1,\r\n                        ],\r\n                    },\r\n                ],\r\n            } as IChemyBrushHistoryEntry);\r\n        }\r\n        this.path = [];\r\n        this.copyCanvas = {} as HTMLCanvasElement;\r\n    }\r\n\r\n    drawImage (im: HTMLCanvasElement, x: number, y: number): void {\r\n        this.context.save();\r\n        this.context.clearRect(x, y, im.width, im.height);\r\n        this.context.drawImage(im, x, y);\r\n        this.context.restore();\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        // might make sense for stroke\r\n    }\r\n}\r\n","import {penBrushUi} from './pen-brush-ui';\r\nimport {blendBrushUi} from './blend-brush-ui';\r\nimport {sketchyBrushUi} from './sketchy-brush-ui';\r\nimport {pixelBrushUi} from './pixel-brush-ui';\r\nimport {eraserBrushUi} from './eraser-brush-ui';\r\nimport {smudgeBrushUi} from './smudge-brush-ui';\r\nimport {chemyBrushUi} from './chemy-brush-ui';\r\nimport {IBrushUi} from '../kl-types';\r\n\r\n/**\r\n * UI for brushes.\r\n * Each brush ui carries the brush with it.\r\n * So if you want to draw, you do it through the UI. should be changed sometime.\r\n */\r\n\r\nexport const brushesUI: {\r\n    [key: string]: IBrushUi<any>;\r\n} = {\r\n    penBrush: penBrushUi,\r\n    blendBrush: blendBrushUi,\r\n    sketchyBrush: sketchyBrushUi,\r\n    pixelBrush: pixelBrushUi,\r\n    chemyBrush: chemyBrushUi,\r\n    smudgeBrush: smudgeBrushUi,\r\n    eraserBrush: eraserBrushUi,\r\n};\r\n","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport brushIconImg from '/src/app/img/ui/brush-pen.svg';\r\nimport {genBrushAlpha01, genBrushAlpha02} from '../brushes/alphas/brush-alphas';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {Options} from '../ui/components/options';\r\nimport {PenBrush} from '../brushes/pen-brush';\r\n\r\n\r\nexport const penBrushUi = (function () {\r\n    const brushInterface = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pen'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1/100,\r\n            max: 1,\r\n            curve: [[0, 1/100], [0.5, 30/100], [1, 1]],\r\n        },\r\n    } as IBrushUi<PenBrush>;\r\n\r\n    let alphaNames = [\r\n        LANG('brush-pen-circle'),\r\n        LANG('brush-pen-chalk'),\r\n        LANG('brush-pen-calligraphy'),\r\n        LANG('brush-pen-square'),\r\n    ];\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pen');\r\n        alphaNames = [\r\n            LANG('brush-pen-circle'),\r\n            LANG('brush-pen-chalk'),\r\n            LANG('brush-pen-calligraphy'),\r\n            LANG('brush-pen-square'),\r\n        ];\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.PenBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider: KlSlider;\r\n        let opacitySlider: KlSlider;\r\n\r\n        const alphaOptions = new Options({\r\n            optionArr: [0, 1, 2, 3].map(id => {\r\n\r\n                const alpha = BB.el({\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        width: '31px',\r\n                        height: '31px',\r\n                        backgroundSize: 'contain',\r\n                        margin: '2px',\r\n                    },\r\n                });\r\n                const canvas = BB.canvas(70, 70);\r\n                const ctx = BB.ctx(canvas);\r\n                if (id === 0 || id === 3) {\r\n                    if (id === 0) {\r\n                        ctx.beginPath();\r\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\r\n                        ctx.closePath();\r\n                        ctx.fill();\r\n                    } else {\r\n                        ctx.fillRect(5, 5, 60, 60);\r\n                    }\r\n                } else if (id === 1) {\r\n                    ctx.drawImage(genBrushAlpha01(60), 5, 5);\r\n                } else if (id === 2) {\r\n                    ctx.drawImage(genBrushAlpha02(60), 5, 5);\r\n                }\r\n                alpha.style.backgroundImage = 'url(' + canvas.toDataURL('image/png') + ')';\r\n\r\n                return {\r\n                    id: id,\r\n                    label: alpha,\r\n                    title: alphaNames[id],\r\n                };\r\n            }),\r\n            initId: 0,\r\n            onChange: (id) => {\r\n                brush.setAlpha(id);\r\n            },\r\n        });\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n            css: {\r\n                display: 'inline-block',\r\n            },\r\n        });\r\n\r\n        const spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize (size: number) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: alphaOptions.getElement(),\r\n                    css: {\r\n                        marginTop: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: lockAlphaToggle.getElement(),\r\n                    css: {\r\n                        marginTop: '10px',\r\n                    },\r\n                }),\r\n            );\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    } as IBrushUi<PenBrush>['Ui'];\r\n    return brushInterface;\r\n})();","\r\nexport const eventResMs = 20;","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6218s\");","import {BB} from '../../bb/bb';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport brushIconImg from '/src/app/img/ui/brush-blend.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {BlendBrush} from '../brushes/blend-brush';\r\n\r\nexport const blendBrushUi = (function () {\r\n    const brushInterface = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-blend'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n    } as IBrushUi<BlendBrush>;\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-blend');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.BlendBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider: KlSlider;\r\n        let opacitySlider: KlSlider;\r\n\r\n        function setSize (size: number): void {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: 58,\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n            const blendingSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 225,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: brush.getBlending(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val);\r\n                },\r\n            });\r\n            blendingSlider.getElement().style.marginTop = '10px';\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.setSizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.setOpacityPressure(b);\r\n            });\r\n\r\n            const lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                    display: 'inline-block',\r\n                },\r\n            });\r\n\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                }),\r\n                blendingSlider.getElement(),\r\n                lockAlphaToggle.getElement()\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y, p, isCoalesced);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    } as IBrushUi<BlendBrush>['Ui'];\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"50oCU\");","import {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport brushIconImg from '/src/app/img/ui/brush-sketchy.png';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {BB} from '../../bb/bb';\r\nimport {SketchyBrush} from '../brushes/sketchy-brush';\r\n\r\nexport const sketchyBrushUi = (function () {\r\n    const brushInterface = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-sketchy'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 10,\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n    } as IBrushUi<SketchyBrush>;\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-sketchy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.SketchyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider: KlSlider;\r\n        let opacitySlider: KlSlider;\r\n\r\n        function setSize (size: number) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize() * 2,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: function (val) {\r\n                    brush.setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n            const blendSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: brush.getBlending(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val);\r\n                },\r\n            });\r\n            const scaleSlider = new KlSlider({\r\n                label: LANG('brush-sketchy-scale'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 1,\r\n                max: 20,\r\n                value: brush.getScale(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setScale(val);\r\n                },\r\n            });\r\n            opacitySlider.getElement().style.marginTop = '10px';\r\n            blendSlider.getElement().style.marginTop = '10px';\r\n            scaleSlider.getElement().style.marginTop = '10px';\r\n            div.append(\r\n                sizeSlider.getElement(),\r\n                opacitySlider.getElement(),\r\n                blendSlider.getElement(),\r\n                scaleSlider.getElement(),\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, pressure) {\r\n            brush.startLine(x, y, pressure);\r\n        };\r\n        this.goLine = function (x, y, pressure) {\r\n            brush.goLine(x, y, pressure, undefined);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getSeed = function () {\r\n            return parseInt('' + brush.getSeed());\r\n        };\r\n        this.setSeed = function (s) {\r\n            brush.setSeed(parseInt('' + s));\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    } as IBrushUi<SketchyBrush>['Ui'];\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"jDYzC\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport brushIconImg from '/src/app/img/ui/brush-pixel.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {PixelBrush} from '../brushes/pixel-brush';\r\n\r\nexport const pixelBrushUi = (function () {\r\n    const brushInterface = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pixel'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]],\r\n        },\r\n    } as IBrushUi<PixelBrush>;\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pixel');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.PixelBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider: KlSlider;\r\n        let opacitySlider: KlSlider;\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n            css: {\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n\r\n        const eraserToggle = new Checkbox({\r\n            init: brush.getIsEraser(),\r\n            label: LANG('eraser'),\r\n            callback: function (b) {\r\n                brush.setIsEraser(b);\r\n            },\r\n            css: {\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n\r\n        const ditherToggle = new Checkbox({\r\n            init: brush.getUseDither(),\r\n            label: LANG('brush-pixel-dither'),\r\n            callback: function (b) {\r\n                brush.setUseDither(b);\r\n            },\r\n        });\r\n\r\n        const spacingSpline = new BB.SplineInterpolator([[0.5, 0.45], [100, 4]]);\r\n\r\n        function setSize (size: number) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                opacitySlider.getElement()\r\n            );\r\n\r\n            const toggleRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n\r\n            toggleRow.append(\r\n                lockAlphaToggle.getElement(),\r\n                eraserToggle.getElement(),\r\n                ditherToggle.getElement(),\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size * 2);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity * 100);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.toggleEraser = () => {\r\n            eraserToggle.setValue(!eraserToggle.getValue());\r\n            brush.setIsEraser(eraserToggle.getValue());\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    } as IBrushUi<PixelBrush>['Ui'];\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"j07R3\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport brushIconImg from '/src/app/img/ui/brush-eraser.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {EraserBrush} from '../brushes/eraser-brush';\r\n\r\nexport const eraserBrushUi = (function () {\r\n    const brushInterface = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('eraser') + ' [E]',\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 200,\r\n            curve: BB.quadraticSplineInput(0.5, 200, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n    } as IBrushUi<EraserBrush>;\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('eraser') + ' [E]';\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.EraserBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider: KlSlider;\r\n        let opacitySlider: KlSlider;\r\n        let isTransparentBg = false;\r\n\r\n        function setSize (size: number) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: 30,\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                })\r\n            );\r\n\r\n            const transparencyToggle = new Checkbox({\r\n                init: false,\r\n                label: LANG('brush-eraser-transparent-bg'),\r\n                callback: function (b) {\r\n                    isTransparentBg = b;\r\n                    brush.setTransparentBG(b);\r\n                },\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            div.append(transparencyToggle.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function () {\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c as Parameters<EraserBrush['setContext']>[0]);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.getIsTransparentBg = function () {\r\n            return isTransparentBg;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    } as IBrushUi<EraserBrush>['Ui'];\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fvqmo\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport brushIconImg from '/src/app/img/ui/brush-smudge.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {SmudgeBrush} from '../brushes/smudge-brush';\r\n\r\nexport const smudgeBrushUi = (function () {\r\n    const brushInterface = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-smudge'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]],\r\n        },\r\n    } as IBrushUi<SmudgeBrush>;\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-smudge');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.SmudgeBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider: KlSlider;\r\n        let opacitySlider: KlSlider;\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n        });\r\n\r\n        const spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize (size: number) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(false, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                })\r\n            );\r\n\r\n            const bottomRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            bottomRow.append(lockAlphaToggle.getElement());\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    } as IBrushUi<SmudgeBrush>['Ui'];\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"gNPk4\");","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport brushIconImg from '/src/app/img/ui/brush-chemy.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {Options} from '../ui/components/options';\r\nimport {BoxToggle} from '../ui/components/box-toggle';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {ChemyBrush} from '../brushes/chemy-brush';\r\n\r\nexport const chemyBrushUi = (function () {\r\n    const brushInterface = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-chemy'),\r\n        sizeSlider: {\r\n            min: 0.25,\r\n            max: 25,\r\n            curve: BB.quadraticSplineInput(0.25, 25, 0.1),\r\n            isDisabled: true,\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n    } as IBrushUi<ChemyBrush>;\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-chemy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.ChemyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider: KlSlider;\r\n        let opacitySlider: KlSlider;\r\n\r\n        function setSize (size: number) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        let eraserToggle: Checkbox;\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                isEnabled: brush.getMode() === 'stroke',\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 5) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            BB.css(opacitySlider.getElement(), {\r\n                marginTop: '10px',\r\n            });\r\n\r\n            eraserToggle = new Checkbox({\r\n                init: brush.getIsEraser(),\r\n                label: LANG('eraser'),\r\n                callback: function (b) {\r\n                    brush.setIsEraser(b);\r\n                },\r\n                css: {\r\n                    marginTop: '10px',\r\n                    marginLeft: '10px',\r\n                },\r\n            });\r\n\r\n            const lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n\r\n            const toggleRow = BB.el({\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n\r\n            const iconSize = 35;\r\n            const padding = 8;\r\n            const actualIconSize = iconSize - padding * 2;\r\n            const halfSize = actualIconSize / 2;\r\n\r\n            const modeOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'fill',\r\n                        label: BB.createSvg({\r\n                            class: 'dark-invert',\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: '#000',\r\n                                    style: `transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-fill'),\r\n                    },\r\n                    {\r\n                        id: 'stroke',\r\n                        label: BB.createSvg({\r\n                            class: 'dark-invert',\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: 'none',\r\n                                    stroke: '#000',\r\n                                    style: `stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-stroke'),\r\n                    },\r\n                ],\r\n                initId: brush.getMode(),\r\n                onChange: (id: string): void => {\r\n                    brush.setMode(id as 'stroke' | 'fill');\r\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === 'fill';\r\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\r\n\r\n                    const brushSize = brush.getSize();\r\n                    sizeSlider.setValue(brushSize);\r\n                    p.onSizeChange(brushSize);\r\n                    p.onConfigChange();\r\n                },\r\n            });\r\n\r\n            const mirrorXToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    class: 'dark-invert',\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`,\r\n                        },\r\n                    ],\r\n                }),\r\n                title: LANG('brush-chemy-mirror-x'),\r\n                init: brush.getXSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setXSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const mirrorYToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    class: 'dark-invert',\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`,\r\n                        },\r\n                    ],\r\n                }),\r\n                title: LANG('brush-chemy-mirror-y'),\r\n                init: brush.getYSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setYSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const gradientToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    class: 'dark-invert',\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'defs',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'linearGradient',\r\n                                    id: 'gradient',\r\n                                    x1: '0',\r\n                                    y1: '0',\r\n                                    x2: '0',\r\n                                    y2: '1',\r\n                                    childrenArr: [\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '0%',\r\n                                            'stop-color': 'rgba(0,0,0,0)',\r\n                                        },\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '100%',\r\n                                            'stop-color': 'rgba(0,0,0,1)',\r\n                                        },\r\n                                    ],\r\n                                },\r\n                            ],\r\n                        },\r\n                        {\r\n                            elementType: 'rect',\r\n                            fill: \"url('#gradient')\",\r\n                            x: '' + padding,\r\n                            y: '' + padding,\r\n                            width: '' + actualIconSize,\r\n                            height: '' + actualIconSize,\r\n                        },\r\n                    ],\r\n                }),\r\n                title: LANG('brush-chemy-gradient'),\r\n                init: brush.getGradient(),\r\n                onChange: (b) => {\r\n                    brush.setGradient(b);\r\n                },\r\n            });\r\n\r\n            BB.css(mirrorXToggle.getElement(), {\r\n                marginLeft: '10px',\r\n            });\r\n            {\r\n                const margin = {\r\n                    marginLeft: '4px',\r\n                };\r\n                BB.css(mirrorYToggle.getElement(), margin);\r\n                BB.css(gradientToggle.getElement(), margin);\r\n            }\r\n\r\n            toggleRow.append(\r\n                modeOptions.getElement(),\r\n                mirrorXToggle.getElement(),\r\n                mirrorYToggle.getElement(),\r\n                gradientToggle.getElement(),\r\n            );\r\n\r\n            div.append(\r\n                sizeSlider.getElement(),\r\n                opacitySlider.getElement(),\r\n                toggleRow,\r\n                BB.el({\r\n                    content: [\r\n                        lockAlphaToggle.getElement(),\r\n                        eraserToggle.getElement(),\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                    },\r\n                })\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.toggleEraser = () => {\r\n            eraserToggle.setValue(!eraserToggle.getValue());\r\n            brush.setIsEraser(eraserToggle.getValue());\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    } as IBrushUi<ChemyBrush>['Ui'];\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"371uF\");","import {BB} from '../../../bb/bb';\r\nimport {DynamicModal} from './base/dynamic-modal';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showIframeModal (\r\n    url: string,\r\n    isEmbed: boolean,\r\n) {\r\n\r\n    // window very small, modal might look bad\r\n    if (!isEmbed && (window.innerHeight < 500 || window.innerWidth < 700)) {\r\n        window.open(url);\r\n        return;\r\n    }\r\n\r\n    const iframe = BB.el({\r\n        tagName: 'iframe',\r\n        custom: {\r\n            src: url,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            height: '100%',\r\n            opacity: '0',\r\n        },\r\n    });\r\n    setTimeout(() => {\r\n        iframe.style.opacity = ''; // fallback\r\n    }, 500);\r\n\r\n    const titleEl = BB.el();\r\n\r\n    let linkEl: HTMLElement | undefined;\r\n    if (!isEmbed) {\r\n        linkEl = BB.el({\r\n            tagName: 'a',\r\n            parent: titleEl,\r\n            content: LANG('modal-new-tab'),\r\n            custom: {\r\n                href: 'help',\r\n                target: '_blank',\r\n            },\r\n            onClick: function () {\r\n                popup.close();\r\n            },\r\n        });\r\n        iframe.onload = () => {\r\n            if (linkEl && iframe.contentWindow) {\r\n                BB.setAttributes(linkEl, {\r\n                    href: '' + iframe.contentWindow.location,\r\n                });\r\n            }\r\n            iframe.style.opacity = '';\r\n        };\r\n    }\r\n\r\n\r\n    const popup = new DynamicModal({\r\n        title: titleEl,\r\n        content: iframe,\r\n        width: 880,\r\n        isMaxHeight: true,\r\n        onClose: () => {\r\n            if (linkEl) {\r\n                iframe.src = 'about:blank';\r\n                BB.destroyEl(linkEl);\r\n                linkEl = undefined;\r\n            }\r\n        },\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nexport class RadioList {\r\n\r\n    el: HTMLDivElement;\r\n    inputs: HTMLInputElement[] = [];\r\n\r\n    constructor ({name, init, items, ignoreFocus}: {\r\n        name: string;\r\n        init?: string;\r\n        items: {\r\n            label: string;\r\n            value: string;\r\n        }[];\r\n        ignoreFocus?: boolean; // default false\r\n    }) {\r\n        this.el = BB.el({\r\n            className: 'kl-radio',\r\n        });\r\n\r\n        items.forEach(item => {\r\n            const label = BB.el({\r\n                tagName: 'label',\r\n            });\r\n            const input = BB.el({\r\n                tagName: 'input',\r\n                parent: label,\r\n                custom: {\r\n                    name: name,\r\n                    value: item.value,\r\n                    type: 'radio',\r\n                },\r\n            });\r\n            if (ignoreFocus) {\r\n                input.setAttribute('data-ignore-focus', 'true');\r\n            }\r\n            if (init === item.value) {\r\n                input.checked = true;\r\n            }\r\n            label.append(item.label);\r\n            this.el.append(label);\r\n            this.inputs.push(input);\r\n        });\r\n    }\r\n\r\n\r\n    getValue (): string | null {\r\n        for (let i = 0; i < this.inputs.length; i++) {\r\n            if (this.inputs[i].checked) {\r\n                return this.inputs[i].value;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getElement () {\r\n        return this.el;\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\r\nimport {IKlProject} from '../../kl-types';\r\nimport {showIframeModal} from '../modals/show-iframe-modal';\r\nimport {SaveReminder} from './save-reminder';\r\nimport {IProjectStoreListener, ProjectStore} from '../../storage/project-store';\r\nimport {KL} from '../../kl';\r\nimport {LANG} from '../../../language/language';\r\nimport {theme} from '../../../theme/theme';\r\n\r\nexport class BrowserStorageUi {\r\n\r\n    private previewEl: HTMLDivElement = {} as HTMLDivElement;\r\n    private readonly infoEl: HTMLElement = {} as HTMLElement;\r\n    private readonly ageEl: HTMLElement = {} as HTMLElement;\r\n    private readonly storeButtonEl: HTMLButtonElement = {} as HTMLButtonElement;\r\n    private readonly clearButtonEl: HTMLButtonElement = {} as HTMLButtonElement;\r\n    private readonly storeListener: IProjectStoreListener = {} as IProjectStoreListener;\r\n    private readonly updateCheckerboard: () => void = () => {};\r\n\r\n    private timestamp: number | undefined;\r\n    private thumbnail: HTMLImageElement | HTMLCanvasElement | undefined;\r\n\r\n    private updateAge () {\r\n        if (!this.timestamp) {\r\n            return;\r\n        }\r\n        let age = new Date().getTime() - this.timestamp;\r\n        let ageStr;\r\n        age = Math.floor(age / 1000 / 60);\r\n        ageStr = LANG('file-storage-min-ago').replace('{x}', '' + age);\r\n        if (age > 60) {\r\n            age = Math.floor(age / 60);\r\n            ageStr = LANG('file-storage-hours-ago').replace('{x}', '' + age);\r\n            if (age > 24) {\r\n                age = Math.floor(age / 24);\r\n                ageStr = LANG('file-storage-days-ago').replace('{x}', '' + age);\r\n                if (age > 31) {\r\n                    ageStr = LANG('file-storage-month-ago');\r\n                }\r\n            }\r\n        }\r\n        this.ageEl.textContent = ageStr;\r\n    }\r\n\r\n    private resetButtons () {\r\n        if (this.timestamp) {\r\n            this.storeButtonEl.textContent = LANG('file-storage-overwrite');\r\n            this.storeButtonEl.disabled = false;\r\n            this.clearButtonEl.disabled = false;\r\n        } else {\r\n            this.storeButtonEl.textContent = LANG('file-storage-store');\r\n            this.storeButtonEl.disabled = false;\r\n            this.clearButtonEl.disabled = true;\r\n        }\r\n    }\r\n\r\n    private updateThumb (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.timestamp = timestamp;\r\n        this.thumbnail = thumbnail;\r\n        if (this.timestamp && thumbnail) {\r\n            thumbnail.classList.add('kl-storage-preview__im');\r\n            this.previewEl.innerHTML = '';\r\n            this.updateAge();\r\n            this.previewEl.append(thumbnail, this.ageEl);\r\n        } else {\r\n            this.previewEl.innerHTML = LANG('file-storage-empty');\r\n        }\r\n        this.resetButtons();\r\n    }\r\n\r\n    private async store () {\r\n        this.storeButtonEl.textContent = LANG('file-storage-storing');\r\n        this.storeButtonEl.disabled = true;\r\n        this.clearButtonEl.disabled = true;\r\n        await new Promise((resolve) => {\r\n            setTimeout(() => resolve(null), 20);\r\n        });\r\n        try {\r\n            await this.projectStore.store(this.getProject());\r\n            this.saveReminder.reset();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: [\r\n                    `${LANG('file-storage-failed-1')}<ul>`,\r\n                    `<li>${LANG('file-storage-failed-2')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-3')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-4')}</li>`,\r\n                    '</ul>',\r\n                ].join(''),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to store browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    private async clear () {\r\n        this.storeButtonEl.disabled = true;\r\n        this.clearButtonEl.disabled = true;\r\n        try {\r\n            await this.projectStore.clear();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: LANG('file-storage-failed-clear'),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to clear browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    element: HTMLDivElement;\r\n\r\n    constructor (\r\n        private projectStore: ProjectStore,\r\n        private getProject: () => IKlProject,\r\n        private saveReminder: SaveReminder,\r\n        private klRootEl: HTMLElement,\r\n        private options?: { hideClearButton?: boolean; isFocusable?: boolean }, // isFocusable default = false\r\n    ) {\r\n        this.element = BB.el({\r\n            css: {\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 0fr',\r\n                gridTemplateRows: '0fr 0fr 0fr',\r\n                gap: '0 0',\r\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"',\r\n            },\r\n        });\r\n\r\n\r\n        const title = BB.el({\r\n            parent: this.element,\r\n            content: LANG('file-storage'),\r\n            css: {\r\n                gridArea: 'title',\r\n                display: 'flex',\r\n                margin: '-5px 0',\r\n                //background: '#f00',\r\n            },\r\n        });\r\n\r\n        this.infoEl = BB.el({\r\n            parent: title,\r\n            content: '?',\r\n            className: 'kl-storage-about',\r\n            title: LANG('file-storage-about'),\r\n            onClick: () => {\r\n                showIframeModal('./help/#help-browser-storage', false);\r\n            },\r\n        });\r\n\r\n        if (this.projectStore.isBroken()) {\r\n            BB.el({\r\n                parent: this.element,\r\n                content: ' ' + LANG('file-storage-cant-access'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            return;\r\n        }\r\n\r\n        this.previewEl = BB.el({\r\n            parent: this.element,\r\n            title: LANG('file-storage-thumb-title'),\r\n            className: 'kl-storage-preview',\r\n        });\r\n        this.ageEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                right: '1px',\r\n                bottom: '1px',\r\n                width: 'calc(100% - 2px)',\r\n                textAlign: 'center',\r\n                background: 'rgba(0,0,0,0.7)',\r\n                color: '#fff',\r\n                textSize: '13px',\r\n            },\r\n        });\r\n        const btnCustom: { [key: string]: string } = options?.isFocusable ?  {} : {\r\n            tabIndex: '-1',\r\n        };\r\n        this.storeButtonEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'grid-button',\r\n            content: LANG('file-storage-store'),\r\n            css: {\r\n                gridArea: 'store',\r\n                //background: '#00f',\r\n            },\r\n            custom: btnCustom,\r\n            onClick: () => this.store(),\r\n        });\r\n        this.clearButtonEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'grid-button',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/> ' + LANG('file-storage-clear'),\r\n            css: {\r\n                gridArea: 'clear',\r\n                //background: '#ff0',\r\n            },\r\n            custom: btnCustom,\r\n            onClick: () => this.clear(),\r\n        });\r\n\r\n        if (this.options?.hideClearButton) {\r\n            this.clearButtonEl.style.visibility = 'hidden';\r\n        }\r\n\r\n        this.storeListener = {\r\n            onUpdate: (timestamp, thumbnail) => {\r\n                this.updateThumb(timestamp, thumbnail);\r\n            },\r\n        };\r\n        this.projectStore.subscribe(this.storeListener);\r\n\r\n        this.updateCheckerboard = (): void => {\r\n            if (!this.thumbnail) {\r\n                return;\r\n            }\r\n            BB.css(this.thumbnail, {\r\n                background: \"url('\" + BB.createCheckerCanvas(4, theme.isDark()).toDataURL('image/png') + \"')\",\r\n            });\r\n        };\r\n        theme.addIsDarkListener(this.updateCheckerboard);\r\n\r\n        setInterval(() => this.updateAge(), 1000 * 60);\r\n\r\n        (async () => {\r\n            try {\r\n                const readResult = await this.projectStore.read();\r\n                if (readResult) {\r\n                    this.updateThumb(readResult.timestamp, readResult.thumbnail);\r\n                } else {\r\n                    this.updateThumb();\r\n                }\r\n            } catch (e) {\r\n                setTimeout(() => {\r\n                    throw new Error('storage-ui: failed initial read browser storage, ' + e);\r\n                }, 0);\r\n            }\r\n        })();\r\n    }\r\n\r\n\r\n    getElement () {\r\n        return this.element;\r\n    }\r\n\r\n    show () {\r\n        // todo\r\n    }\r\n\r\n    hide () {\r\n        // todo\r\n    }\r\n\r\n    destroy () {\r\n        BB.destroyEl(this.infoEl);\r\n        BB.destroyEl(this.storeButtonEl);\r\n        BB.destroyEl(this.clearButtonEl);\r\n        theme.removeIsDarkListener(this.updateCheckerboard);\r\n        this.projectStore.unsubscribe(this.storeListener);\r\n    }\r\n}","import {IKlProject, IKlStorageProject} from '../kl-types';\r\nimport {ProjectConverter, TReadStorageProjectResult} from './project-converter';\r\nimport {clear, getKlProjectObj, storeKlProjectObj} from './indexed-db';\r\nimport {LocalStorage} from '../../bb/base/local-storage';\r\n\r\n\r\nexport interface IProjectStoreListener {\r\n    onUpdate: (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) => void;\r\n}\r\n\r\nfunction makeAsync<T> (\r\n    nonAsyncFunc: (\r\n        resolveCallback: (value: T) => void,\r\n        rejectCallback: (reason?: unknown) => void\r\n    ) => void,\r\n): Promise<T> {\r\n    return new Promise<T>((resolve, reject) => {\r\n        nonAsyncFunc(resolve, reject);\r\n    });\r\n}\r\n\r\n/**\r\n * simplified interface for storing projects into browser storage\r\n */\r\nexport class ProjectStore {\r\n\r\n    private listeners: IProjectStoreListener[] = [];\r\n    private accessHasFailed: boolean = false;\r\n\r\n    async lowLevelStore (project: IKlStorageProject): Promise<void> {\r\n        await new Promise<void>((resolve, reject) => {\r\n            storeKlProjectObj(project, resolve, reject);\r\n        });\r\n    }\r\n\r\n    async lowLevelRead (): Promise<IKlStorageProject> {\r\n        return await makeAsync(getKlProjectObj) as IKlStorageProject;\r\n    }\r\n\r\n    async lowLevelClear (): Promise<void> {\r\n        await makeAsync<void>(clear);\r\n    }\r\n\r\n\r\n\r\n    private emit (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement): void {\r\n        this.listeners.forEach(item => {\r\n            item.onUpdate(timestamp, thumbnail);\r\n        });\r\n    }\r\n\r\n    private updateTimestamp (): void {\r\n        LocalStorage.setItem('indexedDbUpdatedAt', '' + new Date().getTime());\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== 'indexedDbUpdatedAt' || this.listeners.length === 0) {\r\n                return;\r\n            }\r\n            try {\r\n                ( async (): Promise<void> => {\r\n                    const readResult = await this.read();\r\n                    if (readResult) {\r\n                        this.emit(readResult.timestamp, readResult.thumbnail);\r\n                    } else {\r\n                        this.emit();\r\n                    }\r\n                })();\r\n            } catch (e) {\r\n                if (e instanceof Error && e.message.indexOf('db-error') === 0) {\r\n                    this.accessHasFailed = true;\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    async read (): Promise<{\r\n        project: IKlProject;\r\n        timestamp: number;\r\n        thumbnail: HTMLImageElement | HTMLCanvasElement;\r\n    } | undefined> {\r\n        let storageProject;\r\n        try {\r\n            storageProject = await this.lowLevelRead();\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        if (!storageProject) {\r\n            return undefined;\r\n        }\r\n        let result;\r\n        try {\r\n            result = await ProjectConverter.readStorageProject(storageProject);\r\n        } catch (e) {\r\n            throw new Error('format-error: ' + e);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    async store (project: IKlProject): Promise<void> {\r\n        try {\r\n            const storageProject = ProjectConverter.createStorageProject(project);\r\n            await this.lowLevelStore(storageProject);\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        {\r\n            // immediately test if it can be read\r\n            const storageProject = await this.lowLevelRead();\r\n            let readResult: TReadStorageProjectResult;\r\n            try {\r\n                readResult = await ProjectConverter.readStorageProject(storageProject);\r\n            } catch (e) {\r\n                await this.lowLevelClear();\r\n                this.updateTimestamp();\r\n                setTimeout(() => this.emit(), 0);\r\n                throw new Error('format-error: ' + e);\r\n            }\r\n            this.updateTimestamp();\r\n            setTimeout(() => this.emit(readResult.timestamp, readResult.thumbnail), 0);\r\n        }\r\n    }\r\n\r\n    async clear (): Promise<void> {\r\n        await this.lowLevelClear();\r\n        this.updateTimestamp();\r\n        setTimeout(() => this.emit(), 0);\r\n    }\r\n\r\n    subscribe (listener: IProjectStoreListener): void {\r\n        if (this.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        this.listeners.push(listener);\r\n    }\r\n\r\n    unsubscribe (listener: IProjectStoreListener): void {\r\n        for (let i = 0; i < this.listeners.length; i++) {\r\n            if (listener === this.listeners[i]) {\r\n                this.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    isBroken (): boolean {\r\n        return this.accessHasFailed;\r\n    }\r\n\r\n}","import {IKlProject, IKlStorageProject} from '../kl-types';\r\nimport {BB} from '../../bb/bb';\r\nimport {drawProject} from '../canvas/draw-project';\r\nimport {base64ToBlob} from './base-64-to-blob';\r\n\r\nexport type TReadStorageProjectResult = {\r\n    project: IKlProject;\r\n    timestamp: number;\r\n    thumbnail: HTMLImageElement | HTMLCanvasElement;\r\n};\r\n\r\nconst thumbSize = 240;\r\n\r\nfunction loadImage (blob: Blob): Promise<HTMLImageElement> {\r\n    return new Promise<HTMLImageElement>((resolve, reject) => {\r\n        const im = new Image();\r\n        try {\r\n            im.src = BB.imageBlobToUrl(blob);\r\n        } catch (e) {\r\n            reject('imageBlobToUrl, ' + (e instanceof Error ? e.message : ''));\r\n            return;\r\n        }\r\n        im.onload = (): void => {\r\n            URL.revokeObjectURL(im.src);\r\n            resolve(im);\r\n        };\r\n        im.onabort = (): void => {\r\n            reject('layer image failed loading');\r\n        };\r\n        im.onerror = (): void => {\r\n            reject('layer image failed loading');\r\n        };\r\n    });\r\n}\r\n\r\n/**\r\n * for:\r\n * - preparing project to be stored in ProjectStore\r\n * - reading a project that came out of the ProjectStore\r\n */\r\nexport class ProjectConverter {\r\n\r\n    private static createThumbnail (project: IKlProject): HTMLCanvasElement {\r\n        const size = BB.fitInto(project.width, project.height, thumbSize, thumbSize);\r\n        const factor = size.width / project.width;\r\n        return drawProject(project, factor);\r\n    }\r\n\r\n    static createStorageProject (project: IKlProject): IKlStorageProject {\r\n        return {\r\n            id: 1,\r\n            timestamp: new Date().getTime(),\r\n            thumbnail: base64ToBlob(ProjectConverter.createThumbnail(project).toDataURL('image/png')),\r\n            width: project.width,\r\n            height: project.height,\r\n            layers: project.layers.map(item => {\r\n                let blob;\r\n                if (item.image instanceof HTMLCanvasElement) {\r\n                    blob = base64ToBlob((item.image as HTMLCanvasElement).toDataURL('image/png'));\r\n                } else {\r\n                    // todo image\r\n                    throw new Error('Not implemented');\r\n                }\r\n                return {\r\n                    name: item.name,\r\n                    isVisible: item.isVisible,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                    blob,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    static async readStorageProject (storageProject: IKlStorageProject): Promise<TReadStorageProjectResult> {\r\n        if (\r\n            !storageProject.width || !storageProject.height ||\r\n            isNaN(storageProject.width) || isNaN(storageProject.height) ||\r\n            storageProject.width < 1 || storageProject.height < 1\r\n        ) {\r\n            throw new Error('readStorageProject invalid canvas size: ' + storageProject.width + ', ' + storageProject.height);\r\n        }\r\n        const project: IKlProject = {\r\n            width: storageProject.width,\r\n            height: storageProject.height,\r\n            layers: (await Promise.all(storageProject.layers.map(layer => loadImage(layer.blob))))\r\n                .map((image, i) => {\r\n                    const storageLayer = storageProject.layers[i];\r\n                    return {\r\n                        name: storageLayer.name,\r\n                        isVisible: 'isVisible' in storageLayer ? storageLayer.isVisible : true, // isVisible added 2023-07\r\n                        opacity: storageLayer.opacity,\r\n                        mixModeStr: storageLayer.mixModeStr,\r\n                        image,\r\n                    };\r\n                }),\r\n        };\r\n\r\n        let thumbnail;\r\n        if (storageProject.thumbnail) {\r\n            thumbnail = await loadImage(storageProject.thumbnail);\r\n        } else {\r\n            thumbnail = ProjectConverter.createThumbnail(project);\r\n        }\r\n\r\n        return {\r\n            project: project,\r\n            timestamp: storageProject.timestamp,\r\n            thumbnail: thumbnail,\r\n        };\r\n    }\r\n\r\n}","\r\nexport function base64ToBlob (base64Str: string): Blob {\r\n    const parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/) as [string, string ,string, string];\r\n    const binStr = atob(parts[3]);\r\n    const buf = new ArrayBuffer(binStr.length);\r\n    const view = new Uint8Array(buf);\r\n    for (let i = 0; i < view.length; i++) {\r\n        view[i] = binStr.charCodeAt(i);\r\n    }\r\n    return new Blob([view], {'type': parts[1]});\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {BrowserStorageUi} from '../components/browser-storage-ui';\r\nimport {IKlProject, TDropOption, TExportType} from '../../kl-types';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {LANG} from '../../../language/language';\r\nimport newImageImg from '/src/app/img/ui/new-image.svg';\r\nimport exportImg from '/src/app/img/ui/export.svg';\r\nimport shareImg from '/src/app/img/ui/share.svg';\r\nimport uploadImg from '/src/app/img/ui/upload.svg';\r\nimport importImg from '/src/app/img/ui/import.svg';\r\nimport copyImg from '/src/app/img/ui/copy.svg';\r\n\r\nexport class FileTab {\r\n\r\n    private readonly rootEl: HTMLDivElement;\r\n    private importButton: undefined | HTMLInputElement;\r\n    private fileBrowserStorage: undefined | BrowserStorageUi;\r\n\r\n    constructor (\r\n        klRootEl: HTMLElement,\r\n        projectStore: ProjectStore,\r\n        getProject: () => IKlProject,\r\n        private exportType: TExportType,\r\n        onExportTypeChange: (type: TExportType) => void,\r\n        onFileSelect: (fileList: FileList, optionStr: TDropOption) => void,\r\n        onSaveImageToComputer: () => void,\r\n        onNewImage: () => void,\r\n        onShareImage: (callback: () => void) => void,\r\n        onUpload: () => void,\r\n        onCopyToClipboard: () => void,\r\n        saveReminder: SaveReminder,\r\n    ) {\r\n        this.rootEl = document.createElement('div');\r\n\r\n        const asyncCreation = (): void => {\r\n            const fileMenu = document.createElement('div');\r\n            const newButton = document.createElement('button');\r\n            const saveButton = document.createElement('button');\r\n            const shareButton = document.createElement('button');\r\n            const uploadImgurButton = document.createElement('button');\r\n            const clipboardButton = document.createElement('button');\r\n\r\n            newButton.style.cssFloat = 'left';\r\n            BB.css(saveButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n                flexGrow: '1',\r\n            });\r\n            BB.css(clipboardButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n            });\r\n\r\n            newButton.tabIndex = -1;\r\n            saveButton.tabIndex = -1;\r\n            shareButton.tabIndex = -1;\r\n            uploadImgurButton.tabIndex = -1;\r\n            clipboardButton.tabIndex = -1;\r\n\r\n            newButton.innerHTML = `<img class=\"dark-no-invert\" src='${newImageImg}' alt='icon' height='20'/>${LANG('file-new')}`;\r\n            saveButton.innerHTML = `<img src='${exportImg}' alt='icon' height='20'/>${LANG('file-save')}`;\r\n            shareButton.innerHTML = `<img src='${shareImg}' alt='icon' height='20'/>${LANG('file-share')}`;\r\n            uploadImgurButton.innerHTML = `<img style='float:left' src='${uploadImg}' height='20' alt='icon'/>${LANG('file-upload')}`;\r\n            clipboardButton.innerHTML = `<img src='${copyImg}' alt='icon' height='20'/>${LANG('file-copy')}`;\r\n            clipboardButton.title = LANG('file-copy-title');\r\n            newButton.className = 'grid-button';\r\n            saveButton.className = 'grid-button';\r\n            shareButton.className = 'grid-button';\r\n            uploadImgurButton.className = 'grid-button';\r\n            clipboardButton.className = 'grid-button';\r\n\r\n            const importWrapper = BB.el({\r\n                className: 'grid-button',\r\n                css: {\r\n                    position: 'relative',\r\n                    cursor: 'pointer',\r\n                    cssFloat: 'left',\r\n                },\r\n            });\r\n            const innerMask = BB.el({\r\n                parent: importWrapper,\r\n                css: {\r\n                    width: '120px',\r\n                    height: '28px',\r\n                    overflow: 'hidden',\r\n                    cursor: 'pointer',\r\n                    position: 'relative',\r\n                },\r\n            });\r\n            this.importButton = BB.el({\r\n                tagName: 'input',\r\n                parent: innerMask,\r\n                css: {\r\n                    display: 'none',\r\n                },\r\n            });\r\n            this.importButton.tabIndex = -1;\r\n            this.importButton.type = 'file';\r\n            this.importButton.multiple = true;\r\n            this.importButton.accept = 'image';\r\n            this.importButton.size = 71;\r\n            this.importButton.onchange = () => {\r\n                if (!this.importButton) {\r\n                    return;\r\n                }\r\n                this.importButton.files && onFileSelect(this.importButton.files, 'default');\r\n                this.importButton.value = '';\r\n            };\r\n\r\n            const importFakeButton = BB.el({\r\n                tagName: 'button',\r\n                parent: importWrapper,\r\n                content: \"<img class=\\\"dark-no-invert\\\" style='float:left' height='20' src='\" + importImg + \"' alt='icon'/>\" + LANG('file-import'),\r\n                css: {\r\n                    width: '120px',\r\n                    display: 'box',\r\n                    position: 'absolute',\r\n                    left: '0',\r\n                    top: '0',\r\n                    cursor: 'pointer',\r\n                },\r\n            });\r\n            importFakeButton.tabIndex = -1;\r\n            importFakeButton.onclick = () => this.importButton && this.importButton.click();\r\n\r\n            // --- export filetype dropdown ---\r\n            const exportTypeSelect = new KL.Select({\r\n                optionArr: [\r\n                    ['png', 'PNG'],\r\n                    ['psd', 'PSD'],\r\n                    ['layers', LANG('layers') + ' (PNG)'],\r\n                ],\r\n                initValue: this.exportType,\r\n                onChange: (val) => {\r\n                    this.exportType = val as TExportType;\r\n                    onExportTypeChange(this.exportType);\r\n                    onSaveImageToComputer();\r\n                },\r\n                title: LANG('file-format'),\r\n            });\r\n            BB.css(exportTypeSelect.getElement(), {\r\n                width: '50%',\r\n                height: '30px',\r\n                marginTop: '10px',\r\n                marginLeft: '10px',\r\n            });\r\n\r\n\r\n\r\n            newButton.onclick = onNewImage;\r\n            saveButton.onclick = () => {\r\n                onSaveImageToComputer();\r\n            };\r\n            shareButton.onclick = () => {\r\n                shareButton.disabled = true;\r\n                onShareImage(() => {\r\n                    shareButton.disabled = false;\r\n                });\r\n            };\r\n            uploadImgurButton.onclick = () => onUpload();\r\n\r\n            clipboardButton.onclick = () => {\r\n                clipboardButton.blur();\r\n                onCopyToClipboard();\r\n            };\r\n\r\n            const saveNote = BB.el({\r\n                className: 'kl-toolspace-note',\r\n                textContent: LANG('file-no-autosave'),\r\n                css: {\r\n                    margin: '10px 10px 0 10px',\r\n                },\r\n            });\r\n\r\n            const createSpacer = () => {\r\n                const el = document.createElement('div');\r\n                const clearer = document.createElement('div');\r\n                const line = BB.el({\r\n                    className: 'grid-hr',\r\n                });\r\n                el.append(clearer, line);\r\n                BB.css(clearer, {\r\n                    clear: 'both',\r\n                });\r\n                return el;\r\n            };\r\n\r\n            this.fileBrowserStorage = new BrowserStorageUi(projectStore, getProject, saveReminder, klRootEl);\r\n            BB.css(this.fileBrowserStorage.getElement(), {\r\n                //background: 'red',\r\n                margin: '10px',\r\n            });\r\n\r\n            const saveRow = BB.el({\r\n                content: [saveButton, exportTypeSelect.getElement()],\r\n                className: 'kl-file-save-row',\r\n            });\r\n\r\n            //actual structure\r\n            BB.append(fileMenu, [\r\n                saveNote,\r\n                newButton,\r\n                importWrapper,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                saveRow,\r\n\r\n                clipboardButton,\r\n                BB.canShareFiles() ? shareButton : undefined,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                createSpacer(),\r\n                this.fileBrowserStorage.getElement(),\r\n                createSpacer(),\r\n                uploadImgurButton,\r\n            ]);\r\n\r\n            this.rootEl.append(fileMenu);\r\n        };\r\n\r\n        setTimeout(asyncCreation, 1);\r\n    }\r\n\r\n    refresh (): void {\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (isVisible: boolean): void {\r\n        if (isVisible) {\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    triggerImport (): void {\r\n        this.importButton && this.importButton.click();\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"gJzzT\");","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {IKeyString} from '../../../bb/bb-types';\r\nimport {StatusOverlay} from '../components/status-overlay';\r\nimport {KlCanvasWorkspace} from '../../canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\nimport {LayerManager} from './layer-manager/layer-manager';\r\nimport {HandUi} from './hand-ui';\r\nimport {RGB} from '../../../bb/color/color';\r\nimport {getSharedFx} from '../../../fx-canvas/shared-fx';\r\n\r\n\r\nexport class FilterTab {\r\n\r\n    private readonly rootEl: HTMLDivElement;\r\n    private isInit = false;\r\n\r\n    private testHasWebGL (): boolean {\r\n        return !!getSharedFx();\r\n    }\r\n\r\n    constructor (\r\n        private klRootEl: HTMLElement,\r\n        private klColorSlider: KlColorSlider,\r\n        private layerManager: LayerManager,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private handUi: HandUi,\r\n        private getCurrentColor: () => RGB,\r\n        private getKlMaxCanvasSize: () => number,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx: () => CanvasRenderingContext2D | null,\r\n        private isEmbed: boolean,\r\n        private statusOverlay: StatusOverlay,\r\n    ) {\r\n        this.rootEl = document.createElement('div');\r\n    }\r\n\r\n    private init (): void {\r\n        const filters = KL.filterLib;\r\n        const buttons = [];\r\n\r\n        if (!KL.filterLibStatus.isLoaded) {\r\n            throw new Error('filters not loaded');\r\n        }\r\n\r\n        const hasWebGL: boolean = this.testHasWebGL();\r\n\r\n        if (!hasWebGL) {\r\n            const note = BB.el({\r\n                parent: this.rootEl,\r\n                className: 'kl-toolspace-note',\r\n                content: 'Features disabled because WebGL is failing.',\r\n                css: {\r\n                    margin: '10px',\r\n                    marginBottom: '0',\r\n                },\r\n            });\r\n            const noteButton = BB.el({\r\n                parent: note,\r\n                tagName: 'button',\r\n                textContent: 'Learn More',\r\n                css: {\r\n                    marginLeft: '5px',\r\n                },\r\n            });\r\n            noteButton.onclick = () => {\r\n                KL.popup({\r\n                    target: this.klRootEl,\r\n                    message: '<b>WebGL is not working</b>',\r\n                    div: BB.el({\r\n                        content: `\r\nSee if your browser supports WebGL and has it enabled: <a href=\"https://get.webgl.org\" target=\"_blank\" rel=\"noopener noreferrer\">get.webgl.org</a><br>\r\n<br>\r\nRecently (2023-05) a number of Chrome users on Chrome OS reported that WebGL fails, although it is enabled & supported.\r\nThis has been reported to Google.\r\n`,\r\n                    }),\r\n                    buttons: ['Ok'],\r\n                    clickOnEnter: 'Ok',\r\n                });\r\n            };\r\n        }\r\n\r\n        const createButton = (filterKey: string): HTMLElement => {\r\n            const filter = filters[filterKey];\r\n\r\n            const button = document.createElement('button');\r\n            const buttonLabel = LANG(filter.lang.button);\r\n            const imClass = filter.darkNoInvert ? 'class=\"dark-no-invert\"' : '';\r\n            const im = '<img ' + imClass + ' height=\"20\" width=\"18\" src=\"' + filter.icon + '\" alt=\"icon\" />';\r\n            button.innerHTML = im + buttonLabel;\r\n            button.className = 'grid-button';\r\n            BB.css(button, {\r\n                lineHeight: '20px',\r\n                fontSize: '12px',\r\n            });\r\n            button.tabIndex = -1;\r\n\r\n            const filterName = LANG(filter.lang.name);\r\n\r\n            let isEnabled = true;\r\n            if (filter.webGL && !hasWebGL) {\r\n                isEnabled = false;\r\n            }\r\n\r\n            if (isEnabled) {\r\n                button.onclick = () => {\r\n\r\n                    type TOptions = 'Ok' | 'Cancel';\r\n                    const dialogButtons: TOptions[] = ['Ok', 'Cancel'];\r\n\r\n                    const finishedDialog = (result: TOptions, filterDialog: IFilterGetDialogResult<any>): void => {\r\n                        if (result == 'Cancel') {\r\n                            if (filterDialog.destroy) {\r\n                                filterDialog.destroy();\r\n                            }\r\n                            return;\r\n                        }\r\n                        let input;\r\n                        try {\r\n                            input = filterDialog.getInput!(); // also destroys\r\n                        } catch (e) {\r\n                            if ((e as Error).message.indexOf('.getInput is not a function') !== -1) {\r\n                                throw 'filterDialog.getInput is not a function, filter: ' + filterName;\r\n                            } else {\r\n                                throw e;\r\n                            }\r\n                        }\r\n                        applyFilter(input);\r\n                    };\r\n\r\n                    if (!('apply' in filters[filterKey])) {\r\n                        alert('Application not fully loaded');\r\n                        return;\r\n                    }\r\n\r\n                    const applyFilter = (input: any) => {\r\n                        const filterResult = filters[filterKey].apply!({\r\n                            context: this.getCurrentLayerCtx(),\r\n                            klCanvas: this.getKlCanvas(),\r\n                            history: klHistory,\r\n                            input: input,\r\n                        } as IFilterApply);\r\n                        if (filterResult === false) {\r\n                            alert(\"Couldn't apply the edit action\");\r\n                        }\r\n                        if (filters[filterKey].updatePos === true) {\r\n                            this.klCanvasWorkspace.resetOrFitView();\r\n                            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                        }\r\n                        this.layerManager.update();\r\n                    };\r\n\r\n                    if (filters[filterKey].isInstant){\r\n                        button.blur();\r\n                        applyFilter(null);\r\n                        this.statusOverlay.out('\"' + filterName + '\" ' + LANG('filter-applied'), true);\r\n                    } else {\r\n                        const secondaryColorRGB = this.klColorSlider.getSecondaryRGB();\r\n                        const filterDialog = filters[filterKey].getDialog!({\r\n                            context: this.getCurrentLayerCtx(),\r\n                            klCanvas: this.getKlCanvas(),\r\n                            maxWidth: this.getKlMaxCanvasSize(),\r\n                            maxHeight: this.getKlMaxCanvasSize(),\r\n                            currentColorRgb: {r: this.getCurrentColor().r, g: this.getCurrentColor().g, b: this.getCurrentColor().b},\r\n                            secondaryColorRgb: {r: secondaryColorRGB.r, g: secondaryColorRGB.g, b: secondaryColorRGB.b},\r\n                        } as IFilterGetDialogParam) as IFilterGetDialogResult;\r\n\r\n                        if (!filterDialog) {\r\n                            return;\r\n                            //alert('Error: could not perform action');\r\n                            //throw('filter['+filterKey+'].getDialog returned '+filterDialog+'. ctx:' + currentLayerCtx + ' klCanvas:' + klCanvas);\r\n                        }\r\n\r\n                        let closeFunc: () => void;\r\n                        // Todo should move into getDialogParams\r\n                        filterDialog.errorCallback = (e) => {\r\n                            setTimeout(() => {\r\n                                alert('Error: could not perform action');\r\n                                throw e;\r\n                            }, 0);\r\n                            closeFunc();\r\n                        };\r\n\r\n\r\n                        const style: IKeyString = {};\r\n                        if ('width' in filterDialog) {\r\n                            style.width = filterDialog.width + 'px';\r\n                        }\r\n\r\n                        KL.popup({\r\n                            target: this.klRootEl,\r\n                            message: '<b>' + filterName + '</b>',\r\n                            div: filterDialog.element,\r\n                            style: style,\r\n                            buttons: dialogButtons,\r\n                            clickOnEnter: 'Ok',\r\n                            callback: (result) => {\r\n                                finishedDialog(result as TOptions, filterDialog);\r\n                            },\r\n                            closeFunc: (func) => {\r\n                                closeFunc = func;\r\n                            },\r\n                        });\r\n                    }\r\n                };\r\n            } else {\r\n                button.disabled = true;\r\n            }\r\n\r\n            buttons.push(button);\r\n            return button;\r\n        };\r\n\r\n        const addGroup = (groupArr: string[]): void => {\r\n            Object.entries(filters).forEach(([filterKey, filter]) => {\r\n                if (!groupArr.includes(filterKey)) {\r\n                    return;\r\n                }\r\n                if (this.isEmbed && !filter.inEmbed) {\r\n                    return;\r\n                }\r\n                this.rootEl.append(createButton(filterKey));\r\n            });\r\n        };\r\n\r\n        const groupA = [\r\n            'cropExtend',\r\n            'flip',\r\n            'perspective',\r\n            'resize',\r\n            'rotate',\r\n            'transform',\r\n        ];\r\n        const groupB = [\r\n            'brightnessContrast',\r\n            'curves',\r\n            'distort',\r\n            'hueSaturation',\r\n            'invert',\r\n            'tiltShift',\r\n            'toAlpha',\r\n            'blur',\r\n            'unsharpMask',\r\n        ];\r\n        const groupC = [\r\n            'grid',\r\n            'noise',\r\n            'pattern',\r\n            'vanishPoint',\r\n        ];\r\n\r\n        addGroup(groupA);\r\n        this.rootEl.append(BB.el({className: 'grid-hr'}));\r\n        addGroup(groupB);\r\n        this.rootEl.append(BB.el({className: 'grid-hr'}));\r\n        addGroup(groupC);\r\n\r\n        this.isInit = true;\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    show (): void {\r\n        if (!this.isInit) {\r\n            this.init();\r\n        }\r\n        this.rootEl.style.display = 'block';\r\n    }\r\n\r\n    hide (): void {\r\n        this.rootEl.style.display = 'none';\r\n    }\r\n\r\n}","import {fxCanvas} from './fx-canvas';\r\nimport {TFxCanvas} from './fx-canvas-types';\r\n\r\nlet failed = false;\r\nlet fx: TFxCanvas | null = null;\r\n\r\nexport function getSharedFx (): TFxCanvas | null {\r\n    // failed previously, don't need to try again.\r\n    if (failed) {\r\n        return fx;\r\n    }\r\n\r\n    if (!fx || fx._.gl.isContextLost()) {\r\n        try {\r\n            fx = fxCanvas();\r\n        } catch (e) {\r\n            failed = true;\r\n            fx = null;\r\n            setTimeout(() => {\r\n                throw e;\r\n            });\r\n        }\r\n    }\r\n    return fx;\r\n}","import {brightnessContrast} from './filters/brightness-contrast';\r\nimport {FxShader} from './core/fx-shader';\r\nimport {gl, setGl} from './core/gl';\r\nimport {FxTexture} from './core/fx-texture';\r\nimport {curves} from './filters/curves';\r\nimport {hueSaturation} from './filters/hue-saturation';\r\nimport {noise} from './filters/noise';\r\nimport {triangleBlur} from './filters/triangle-blur';\r\nimport {tiltShift} from './filters/tilt-shift';\r\nimport {matrixWarp} from './filters/matrix-warp';\r\nimport {unsharpMask} from './filters/unsharp-mask';\r\nimport {toAlpha} from './filters/to-alpha';\r\nimport {invert} from './filters/invert';\r\nimport {perspective} from './filters/perspective';\r\nimport {unmultiplyAlpha} from './filters/unmultiply-alpha';\r\nimport {distort} from './filters/distort';\r\nimport {multiplyAlpha} from './filters/multiply-alpha';\r\nimport {TFxCanvas, TFxGl, TFxSupportedElements, TWrappedTexture} from './fx-canvas-types';\r\nimport {BB} from '../bb/bb';\r\n\r\n/*\r\n * based on glfx.js\r\n * https://github.com/evanw/glfx.js/\r\n * Copyright 2011 Evan Wallace\r\n * Released under the MIT license\r\n */\r\n\r\n/**\r\n * Before you can apply any filters you will need a canvas, which stores the result of the filters you apply.\r\n * Canvas creation is done through fxCanvas(), which creates and returns a new WebGL <canvas> tag with additional\r\n * methods specific to fxCanvas. This call will throw an error message if the browser doesn't support WebGL.\r\n *\r\n * This library provides realtime image effects using WebGL. There are three parts to it:\r\n * - texture - a raw source of image data (created from <img> <canvas> or <video>)\r\n * - filter - an image effect (represents one or more WebGL shaders)\r\n * - canvas - an image buffer that stores the results (a WebGL <canvas> tag)\r\n */\r\nexport const fxCanvas: (() => TFxCanvas) = (function () {\r\n\r\n    function wrapTexture (texture: FxTexture): TWrappedTexture {\r\n        return {\r\n            _: texture,\r\n            loadContentsOf: function (element) {\r\n                // Make sure that we're using the correct global WebGL context\r\n                setGl(this._.gl);\r\n                this._.loadContentsOf(element);\r\n            },\r\n            destroy: function () {\r\n                // Make sure that we're using the correct global WebGL context\r\n                setGl(this._.gl);\r\n                this._.destroy();\r\n            },\r\n        };\r\n    }\r\n\r\n    function texture (element: TFxSupportedElements) {\r\n        return wrapTexture(FxTexture.fromElement(element));\r\n    }\r\n\r\n    function getTextureType (): GLenum {\r\n        let textureType: GLenum = gl.UNSIGNED_BYTE;\r\n\r\n        // Go for floating point buffer textures if we can, it'll make the bokeh\r\n        // filter look a lot better. Note that on Windows, ANGLE does not let you\r\n        // render to a floating-point texture when linear filtering is enabled.\r\n        // See http://crbug.com/172278 for more information.\r\n        if (\r\n            gl.getExtension('WEBGL_color_buffer_float') && // firefox shows warning without this line\r\n            gl.getExtension('OES_texture_float') &&\r\n            gl.getExtension('OES_texture_float_linear')\r\n        ) {\r\n            const testTexture = new FxTexture(100, 100, gl.RGBA, gl.FLOAT);\r\n            try {\r\n                // Only use gl.FLOAT if we can render to it\r\n                testTexture.drawTo(function () {\r\n                    textureType = gl.FLOAT;\r\n                });\r\n            } catch (e) {\r\n                /* empty */\r\n            }\r\n            testTexture.destroy();\r\n        }\r\n        return textureType;\r\n    }\r\n\r\n    function initialize (this: TFxCanvas, width: number, height: number): void {\r\n        const textureType = getTextureType();\r\n        if (this._.texture) {\r\n            this._.texture.destroy();\r\n        }\r\n        if (this._.spareTexture) {\r\n            this._.spareTexture.destroy();\r\n        }\r\n        this.width = width;\r\n        this.height = height;\r\n        this._.texture = new FxTexture(width, height, gl.RGBA, textureType);\r\n        this._.spareTexture = new FxTexture(width, height, gl.RGBA, textureType);\r\n        this._.extraTexture = this._.extraTexture || new FxTexture(0, 0, gl.RGBA, textureType);\r\n        this._.flippedShader = this._.flippedShader || new FxShader(null, `\r\nuniform sampler2D texture;\r\nvarying vec2 texCoord;\r\nvoid main() {\r\n    gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\r\n}\r\n        `, 'flippedShader');\r\n        this._.isInitialized = true;\r\n    }\r\n\r\n    function draw (this: TFxCanvas, texture: TWrappedTexture, width?: number, height?: number): TFxCanvas {\r\n        if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\r\n            initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\r\n        }\r\n\r\n        texture._.use();\r\n        this._.texture.drawTo(function () {\r\n            FxShader.getDefaultShader().drawRect();\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    function update (this: TFxCanvas): TFxCanvas {\r\n        this._.texture.use();\r\n        this._.flippedShader.drawRect();\r\n        return this;\r\n    }\r\n\r\n    function contents (this: TFxCanvas): TWrappedTexture {\r\n        const texture = new FxTexture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\r\n        this._.texture.use();\r\n        texture.drawTo(function () {\r\n            FxShader.getDefaultShader().drawRect();\r\n        });\r\n        return wrapTexture(texture);\r\n    }\r\n\r\n    /*\r\n       Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\r\n       Length of the array will be width * height * 4.\r\n    */\r\n    function getPixelArray (this: TFxCanvas): Uint8Array {\r\n        const w = this._.texture.width;\r\n        const h = this._.texture.height;\r\n        const array = new Uint8Array(w * h * 4);\r\n        this._.texture.drawTo(function () {\r\n            gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\r\n        });\r\n        return array;\r\n    }\r\n\r\n    function wrap<F extends (...args: any[]) => unknown>(fn: F): F {\r\n        return <F>function (this: TFxCanvas, ...args: any[]) {\r\n            // Make sure that we're using the correct global WebGL context\r\n            setGl(this._.gl);\r\n            // Now that the context has been switched, we can call the wrapped function\r\n            return fn.apply(this, args);\r\n        };\r\n    }\r\n\r\n    function getWebGlContext (canvas: HTMLCanvasElement, options?: WebGLContextAttributes): WebGLRenderingContext | null {\r\n        const contextNames = ['webgl', 'experimental-webgl', 'webgl2'];\r\n        let context: WebGLRenderingContext | null = null;\r\n        contextNames.forEach(name => {\r\n            if (context) {\r\n                return;\r\n            }\r\n            // get.webgl.org does a try-catch\r\n            try {\r\n                context = canvas.getContext(name, options) as (typeof context);\r\n            } catch (e) {\r\n                /* empty */\r\n            }\r\n        });\r\n        return context;\r\n    }\r\n\r\n    return (): TFxCanvas => {\r\n        if (!window.WebGLRenderingContext) {\r\n            throw 'WebGLRenderingContext not set. Browser does not support WebGL.';\r\n        }\r\n\r\n        const canvas: TFxCanvas = BB.canvas() as TFxCanvas;\r\n        const context = getWebGlContext(canvas, {premultipliedAlpha: false});\r\n        if (!context) {\r\n            throw 'This browser does not support WebGL';\r\n        }\r\n        setGl(context as TFxGl);\r\n\r\n        canvas._ = {\r\n            gl,\r\n            isInitialized: false,\r\n            texture: null,\r\n            spareTexture: null,\r\n            flippedShader: null,\r\n        } as any;\r\n\r\n        // Core methods\r\n        canvas.texture = wrap(texture);\r\n        canvas.draw = wrap(draw);\r\n        canvas.update = wrap(update);\r\n        canvas.contents = wrap(contents);\r\n        canvas.getPixelArray = wrap(getPixelArray);\r\n\r\n        // Filter methods\r\n        canvas.brightnessContrast = wrap(brightnessContrast);\r\n        canvas.hueSaturation = wrap(hueSaturation);\r\n        canvas.triangleBlur = wrap(triangleBlur);\r\n        canvas.unsharpMask = wrap(unsharpMask);\r\n        canvas.perspective = wrap(perspective);\r\n        canvas.matrixWarp = wrap(matrixWarp);\r\n        canvas.tiltShift = wrap(tiltShift);\r\n        canvas.noise = wrap(noise);\r\n        canvas.curves = wrap(curves);\r\n        canvas.invert = wrap(invert);\r\n        canvas.multiplyAlpha = wrap(multiplyAlpha);\r\n        canvas.unmultiplyAlpha = wrap(unmultiplyAlpha);\r\n        canvas.toAlpha = wrap(toAlpha);\r\n        canvas.distort = wrap(distort);\r\n\r\n        return canvas as TFxCanvas;\r\n    };\r\n})();","import {BB} from '../../bb/bb';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {gl} from '../core/gl';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * @type Brightness / Contrast\r\n * Provides additive brightness and multiplicative contrast control.\r\n * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\r\n * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n */\r\nexport type TFilterBrightnessContrast = (\r\n    this: TFxCanvas,\r\n    brightness: number,\r\n    contrast: number\r\n) => TFxCanvas;\r\n\r\nexport const brightnessContrast: TFilterBrightnessContrast = function (brightness, contrast) {\r\n    gl.brightnessContrast = gl.brightnessContrast || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float brightness;\\\r\n        uniform float contrast;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.rgb += brightness;\\\r\n            if (contrast > 0.0) {\\\r\n                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\r\n            } else {\\\r\n                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\r\n            }\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'brightnessContrast');\r\n\r\n    simpleShader.call(this, gl.brightnessContrast, {\r\n        brightness: BB.clamp(brightness, -1, 1),\r\n        contrast: BB.clamp(contrast, -1, 1),\r\n    });\r\n\r\n    return this;\r\n};","import {TFxCanvas, TUniforms} from '../fx-canvas-types';\r\nimport {FxTexture} from './fx-texture';\r\nimport {FxShader} from './fx-shader';\r\n\r\nexport function simpleShader (\r\n    this: TFxCanvas,\r\n    shader: FxShader,\r\n    uniforms: TUniforms<number | number[]>,\r\n    textureIn?: FxTexture,\r\n    textureOut?: FxTexture\r\n): void {\r\n    (textureIn || this._.texture).use();\r\n    this._.spareTexture.drawTo(function () {\r\n        shader.uniforms(uniforms).drawRect();\r\n    });\r\n    this._.spareTexture.swapWith(textureOut || this._.texture);\r\n}","import {gl} from './gl';\r\nimport {TUniforms} from '../fx-canvas-types';\r\nimport {BB} from '../../bb/bb';\r\n\r\n// VERTEX_SHADER | FRAGMENT_SHADER\r\ntype TShaderType = GLenum;\r\n\r\nconst defaultVertexSource = '\\\r\n    attribute vec2 vertex;\\\r\n    attribute vec2 _texCoord;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        texCoord = _texCoord;\\\r\n        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\r\n    }';\r\n\r\nconst defaultFragmentSource = '\\\r\n    uniform sampler2D texture;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        gl_FragColor = texture2D(texture, texCoord);\\\r\n    }';\r\n\r\nfunction isArray (obj: unknown): obj is unknown[] {\r\n    return Object.prototype.toString.call(obj) == '[object Array]';\r\n}\r\n\r\nfunction isNumber (obj: unknown): obj is number {\r\n    return Object.prototype.toString.call(obj) == '[object Number]';\r\n}\r\n\r\nlet floatPrecision: 'lowp' | 'mediump' | 'highp' | undefined;\r\n\r\nexport class FxShader {\r\n\r\n    // ---- static ----\r\n    static getDefaultShader (): FxShader {\r\n        gl.defaultShader = gl.defaultShader || new FxShader();\r\n        return gl.defaultShader;\r\n    }\r\n\r\n\r\n    // ---- private ----\r\n\r\n    private compileSource (type: TShaderType, source: string, nameStr: string): WebGLShader {\r\n        const shader = BB.throwIfNull(gl.createShader(type));\r\n        gl.shaderSource(shader, source.replace(/#define.*/, '')); // glslify adds a line add the beginning that breaks it\r\n        gl.compileShader(shader);\r\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n            throw 'compile error: ' + nameStr + ' - ' + gl.getShaderInfoLog(shader);\r\n        }\r\n        return shader;\r\n    }\r\n\r\n    /**\r\n     * HIGH_FLOAT | MEDIUM_FLOAT\r\n     */\r\n    private testPrecisionSupport (precisionType: GLenum): boolean {\r\n        const format = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, precisionType);\r\n        return format !== null && format.precision !== 0;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        vertexSource?: string | null,\r\n        fragmentSource?: string | null,\r\n        nameStr?: string,\r\n    ) {\r\n        this.vertexAttribute = null;\r\n        this.texCoordAttribute = null;\r\n        this.program = BB.throwIfNull(gl.createProgram());\r\n        vertexSource = vertexSource || defaultVertexSource;\r\n        fragmentSource = fragmentSource || defaultFragmentSource;\r\n        if (!floatPrecision) {\r\n            floatPrecision = this.testPrecisionSupport(gl.HIGH_FLOAT) ? 'highp' : (this.testPrecisionSupport(gl.MEDIUM_FLOAT) ? 'mediump' : 'lowp');\r\n        }\r\n        fragmentSource = 'precision ' + floatPrecision + ' float;' + fragmentSource; // annoying requirement is annoying\r\n        gl.attachShader(this.program, this.compileSource(gl.VERTEX_SHADER, vertexSource, nameStr + '(vertex)'));\r\n        gl.attachShader(this.program, this.compileSource(gl.FRAGMENT_SHADER, fragmentSource, nameStr + '(fragment)'));\r\n        gl.linkProgram(this.program);\r\n        if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\r\n            throw 'link error: ' + gl.getProgramInfoLog(this.program);\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n    \r\n    vertexAttribute: null | number;\r\n    texCoordAttribute: null | number;\r\n    program: WebGLProgram | null; // null = destroyed\r\n\r\n    destroy (): void {\r\n        gl.deleteProgram(this.program);\r\n        this.program = null;\r\n    }\r\n\r\n    uniforms (uniforms: TUniforms<number | number[]>): FxShader {\r\n        gl.useProgram(this.program);\r\n        Object.entries(uniforms).forEach(([name, value]) => {\r\n\r\n            const location = gl.getUniformLocation(this.program!, name);\r\n            if (location === null) {\r\n                // will be null if the uniform isn't used in the shader\r\n                return;\r\n            }\r\n\r\n            if (isArray(value)) {\r\n                switch (value.length) {\r\n                    case 1:\r\n                        gl.uniform1fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 2:\r\n                        gl.uniform2fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 3:\r\n                        gl.uniform3fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 4:\r\n                        gl.uniform4fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 9:\r\n                        gl.uniformMatrix3fv(location, false, new Float32Array(value));\r\n                        break;\r\n                    case 16:\r\n                        gl.uniformMatrix4fv(location, false, new Float32Array(value));\r\n                        break;\r\n                    default:\r\n                        throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\r\n                }\r\n            } else if (isNumber(value)) {\r\n                gl.uniform1f(location, value);\r\n            } else {\r\n                throw 'attempted to set uniform \"' + name + '\" to invalid value ' + ((value as any) || 'undefined').toString();\r\n            }\r\n        });\r\n        // allow chaining\r\n        return this;\r\n    }\r\n\r\n    //\r\n    /**\r\n     * textures are uniforms too but for some reason can't be specified by gl.uniform1f,\r\n     * even though floating point numbers represent the integers 0 through 7 exactly\r\n     */\r\n    textures (textures: Record<string, GLint>): FxShader {\r\n        gl.useProgram(this.program);\r\n\r\n        Object.entries(textures).forEach(([name, value]) => {\r\n            gl.uniform1i(gl.getUniformLocation(this.program!, name), value);\r\n        });\r\n\r\n        // allow chaining\r\n        return this;\r\n    }\r\n\r\n   drawRect (left?: number, top?: number, right?: number, bottom?: number): void {\r\n        let undefined;\r\n        const viewport = gl.getParameter(gl.VIEWPORT);\r\n        top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\r\n        left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\r\n        right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\r\n        bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\r\n        if (gl.vertexBuffer === undefined || gl.vertexBuffer === null) {\r\n            gl.vertexBuffer = BB.throwIfNull(gl.createBuffer());\r\n        }\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([left, top, left, bottom, right, top, right, bottom]), gl.STATIC_DRAW);\r\n        if (gl.texCoordBuffer == null) {\r\n            gl.texCoordBuffer = BB.throwIfNull(gl.createBuffer());\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\r\n        }\r\n        if (this.vertexAttribute == null) {\r\n            this.vertexAttribute = gl.getAttribLocation(this.program!, 'vertex');\r\n            gl.enableVertexAttribArray(this.vertexAttribute);\r\n        }\r\n        if (this.texCoordAttribute == null) {\r\n            this.texCoordAttribute = gl.getAttribLocation(this.program!, '_texCoord');\r\n            gl.enableVertexAttribArray(this.texCoordAttribute);\r\n        }\r\n        gl.useProgram(this.program);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n        gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n        gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    }\r\n\r\n}","import {TFxGl} from '../fx-canvas-types';\r\n\r\nexport let gl: TFxGl;\r\n\r\nexport function setGl (newGl: TFxGl | null): void {\r\n    // more problems setting type to null\r\n    gl = newGl as TFxGl;\r\n}","import {gl} from './gl';\r\nimport {BB} from '../../bb/bb';\r\nimport {TFxGl, TFxSupportedElements} from '../fx-canvas-types';\r\n\r\n/**\r\n * Format           Type                    Channels    Bytes per pixel\r\n * RGBA             UNSIGNED_BYTE           4           4\r\n * RGB              UNSIGNED_BYTE           3           3\r\n * RGBA             UNSIGNED_SHORT_4_4_4_4  4           2\r\n * RGBA             UNSIGNED_SHORT_5_5_5_1  4           2\r\n * RGB              UNSIGNED_SHORT_5_6_5    3           2\r\n * LUMINANCE_ALPHA  UNSIGNED_BYTE           2           2\r\n * LUMINANCE        UNSIGNED_BYTE           1           1\r\n * ALPHA            UNSIGNED_BYTE           1           1\r\n *\r\n * https://webglfundamentals.org/webgl/lessons/webgl-data-textures.html\r\n */\r\nexport type TTextureFormat = GLenum;\r\nexport type TTextureType = GLenum;\r\n\r\n\r\nexport class FxTexture {\r\n    \r\n    // ---- static ----\r\n    static fromElement (element: TFxSupportedElements): FxTexture {\r\n        const texture = new FxTexture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\r\n        texture.loadContentsOf(element);\r\n        return texture;\r\n    }\r\n    \r\n    \r\n    // ---- private ----\r\n    private canvas: HTMLCanvasElement | null;\r\n    private type: TTextureType;\r\n\r\n    /*\r\n    // never seen this being used\r\n    private getCanvas(texture: Texture): CanvasRenderingContext2D {\r\n        if (this.canvas == null) {\r\n            this.canvas = BB.canvas(texture.width, texture.height);\r\n        }\r\n        this.canvas.width = texture.width;\r\n        this.canvas.height = texture.height;\r\n        const c = BB.ctx(this.canvas);\r\n        c.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        return c;\r\n    }*/\r\n\r\n    \r\n    // ---- public ----\r\n    constructor (\r\n        width: number,\r\n        height: number,\r\n        format: TTextureFormat,\r\n        type: TTextureType,\r\n    ) {\r\n        this.gl = gl;\r\n        this.id = BB.throwIfNull(gl.createTexture());\r\n        this.width = width;\r\n        this.height = height;\r\n        this.format = format;\r\n        this.type = type;\r\n        this.canvas = null;\r\n\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        if (width && height) {\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n        }\r\n    }\r\n    \r\n    // ---- interface ----\r\n\r\n    gl: TFxGl;\r\n    width: number;\r\n    height: number;\r\n    id: WebGLTexture | null; // null -> destroyed\r\n    format: TTextureFormat;\r\n    \r\n    loadContentsOf (element: TFxSupportedElements): void {\r\n        this.width = element.width || (element as HTMLVideoElement).videoWidth;\r\n        this.height = element.height || (element as HTMLVideoElement).videoHeight!;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\r\n    }\r\n\r\n    initFromBytes (width: number, height: number, data: number[]): void {\r\n        this.width = width;\r\n        this.height = height;\r\n        this.format = gl.RGBA;\r\n        this.type = gl.UNSIGNED_BYTE;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\r\n    }\r\n\r\n    destroy (): void {\r\n        gl.deleteTexture(this.id);\r\n        this.id = null;\r\n    }\r\n\r\n    use (unit?: number): void {\r\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n    }\r\n\r\n    unuse (unit: number): void {\r\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n        gl.bindTexture(gl.TEXTURE_2D, null);\r\n    }\r\n\r\n    ensureFormat (width: number, height: number, format: TTextureFormat, type: TTextureType): void {\r\n        // change the format only if required\r\n        if (width != this.width || height != this.height || format != this.format || type != this.type) {\r\n            this.width = width;\r\n            this.height = height;\r\n            this.format = format;\r\n            this.type = type;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n        }\r\n    }\r\n\r\n    ensureFormatViaTexture (texture: FxTexture): void {\r\n        this.ensureFormat(texture.width, texture.height, texture.format, texture.type);\r\n    }\r\n\r\n    drawTo (callback: () => void): void {\r\n        // start rendering to this texture\r\n        gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\r\n        if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\r\n            throw new Error('incomplete framebuffer');\r\n        }\r\n        gl.viewport(0, 0, this.width, this.height);\r\n\r\n        // do the drawing\r\n        callback();\r\n\r\n        // stop rendering to this texture\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    }\r\n\r\n\r\n    /*\r\n    // never seen this being used\r\n    fillUsingCanvas (callback: (canvas: CanvasRenderingContext2D) => void): Texture {\r\n        callback(this.getCanvas(this));\r\n        this.format = gl.RGBA;\r\n        this.type = gl.UNSIGNED_BYTE;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.canvas);\r\n        return this;\r\n    }\r\n\r\n    // never seen this being used\r\n    toImage (image: HTMLImageElement): void {\r\n        this.use();\r\n        Shader.getDefaultShader().drawRect();\r\n        const size = this.width * this.height * 4;\r\n        const pixels = new Uint8Array(size);\r\n        const c = this.getCanvas(this);\r\n        const data = c.createImageData(this.width, this.height);\r\n        gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n        for (let i = 0; i < size; i++) {\r\n            data.data[i] = pixels[i];\r\n        }\r\n        c.putImageData(data, 0, 0);\r\n        image.src = this.canvas.toDataURL();\r\n    }\r\n     */\r\n\r\n    swapWith (other: FxTexture): void {\r\n        let temp;\r\n\r\n        temp = other.id;\r\n        other.id = this.id;\r\n        this.id = temp;\r\n\r\n        temp = other.width;\r\n        other.width = this.width;\r\n        this.width = temp;\r\n\r\n        temp = other.height;\r\n        other.height = this.height;\r\n        this.height = temp;\r\n\r\n        temp = other.format;\r\n        other.format = this.format;\r\n        this.format = temp;\r\n\r\n        // type?\r\n    }\r\n}\r\n","import {splineInterpolate} from '../math/spline-interpolate';\r\nimport {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Curves\r\n * @description A powerful mapping tool that transforms the colors in the image\r\n *              by an arbitrary function. The function is interpolated between\r\n *              a set of 2D points using splines. The curves filter can take\r\n *              either one or three arguments which will apply the mapping to\r\n *              either luminance or RGB values, respectively.\r\n * @param red   A list of points that define the function for the red channel.\r\n *              Each point is a list of two values: the value before the mapping\r\n *              and the value after the mapping, both in the range 0 to 1. For\r\n *              example, [[0,1], [1,0]] would invert the red channel while\r\n *              [[0,0], [1,1]] would leave the red channel unchanged.\r\n * @param green A list of points that define the function for the green\r\n *              channel (just like for red).\r\n * @param blue  list of points that define the function for the blue\r\n *              channel (just like for red).\r\n */\r\nexport type TFilterCurves = (\r\n    this: TFxCanvas,\r\n    red: [number, number][],\r\n    green: [number, number][],\r\n    blue: [number, number][],\r\n) => TFxCanvas;\r\n\r\nexport const curves: TFilterCurves = function (red, green, blue) {\r\n    // Create the ramp texture\r\n    const redRamp = splineInterpolate(red);\r\n    const greenRamp = splineInterpolate(green);\r\n    const blueRamp = splineInterpolate(blue);\r\n    const array: number[] = [];\r\n    for (let i = 0; i < 256; i++) {\r\n        array.splice(array.length, 0, redRamp[i], greenRamp[i], blueRamp[i], 255);\r\n    }\r\n    this._.extraTexture.initFromBytes(256, 1, array);\r\n    this._.extraTexture.use(1);\r\n\r\n    gl.curves = gl.curves || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform sampler2D map;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.r = texture2D(map, vec2(color.r)).r;\\\r\n            color.g = texture2D(map, vec2(color.g)).g;\\\r\n            color.b = texture2D(map, vec2(color.b)).b;\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'curves');\r\n\r\n    gl.curves.textures({\r\n        map: 1,\r\n    });\r\n    simpleShader.call(this, gl.curves, {});\r\n\r\n    return this;\r\n};","import {BB} from '../../bb/bb';\r\n\r\nexport function splineInterpolate (points: [number, number][]): number[] {\r\n    const interpolator = new BB.SplineInterpolator(points);\r\n    const array = [];\r\n    for (let i = 0; i < 256; i++) {\r\n        array.push(\r\n            BB.clamp(\r\n                Math.floor(interpolator.interpolate(i / 255) * 256),\r\n                0,\r\n                255\r\n            )\r\n        );\r\n    }\r\n    return array;\r\n}","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {BB} from '../../bb/bb';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Hue / Saturation\r\n * @description      Provides rotational hue and multiplicative saturation control. RGB color space\r\n *                   can be imagined as a cube where the axes are the red, green, and blue color\r\n *                   values. Hue changing works by rotating the color vector around the grayscale\r\n *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\r\n *                   Saturation is implemented by scaling all color channel values either toward\r\n *                   or away from the average color channel value.\r\n * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\r\n *                   and 1 is 180 degree rotation in the positive direction)\r\n * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n */\r\nexport type TFilterHueSaturation = (\r\n    this: TFxCanvas,\r\n    hue: number,\r\n    saturation: number,\r\n) => TFxCanvas;\r\n\r\nexport const hueSaturation: TFilterHueSaturation = function (hue, saturation) {\r\n    gl.hueSaturation = gl.hueSaturation || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float hue;\\\r\n        uniform float saturation;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\r\n            float angle = hue * 3.14159265;\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\r\n            float len = length(color.rgb);\\\r\n            color.rgb = vec3(\\\r\n                dot(color.rgb, weights.xyz),\\\r\n                dot(color.rgb, weights.zxy),\\\r\n                dot(color.rgb, weights.yzx)\\\r\n            );\\\r\n            \\\r\n            /* saturation adjustment */\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            if (saturation > 0.0) {\\\r\n                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\r\n            } else {\\\r\n                color.rgb += (average - color.rgb) * (-saturation);\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'hueSaturation');\r\n\r\n    simpleShader.call(this, gl.hueSaturation, {\r\n        hue: BB.clamp(hue, -1, 1),\r\n        saturation: BB.clamp(saturation, -1, 1),\r\n    });\r\n\r\n    return this;\r\n};\r\n","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport shaderNoise from '../shaders/shader-noise.glsl';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Noise\r\n * draws noise, completely replaces original image\r\n */\r\nexport type TFilterNoise = (\r\n    this: TFxCanvas,\r\n    seed: number | undefined, // float, any value okay - default 0\r\n    type: number, // 1 value, 2 simplex, 3 cellular\r\n    scale: [number, number], // float, small scale will show repeating patterns\r\n    offset: [number, number], // offset x, y - large offsets will show repeating patterns\r\n    octaves: number, // int 0 - 4\r\n    samples: number, // 1 | 4 | 8 -> super-sampling\r\n    peaks: number, // how often it will ramp *additionally* from 0 to 1\r\n    brightness: number, // range [-1, 1]\r\n    contrast: number, // range [-1, 1]\r\n    isReversed: boolean, // reverse 0-1 range\r\n    colA: {r: number; g: number; b: number} | undefined, // which color at 0, if rgb - default black\r\n    colB: {r: number; g: number; b: number} | undefined, // which color at 1, if rgb - default white\r\n    channels: 'rgb' | 'alpha', // which channel to target\r\n) => TFxCanvas;\r\n\r\nexport const noise: TFilterNoise = function (\r\n    seed,\r\n    type,\r\n    scale,\r\n    offset,\r\n    octaves,\r\n    samples,\r\n    peaks,\r\n    brightness,\r\n    contrast,\r\n    isReversed,\r\n    colA,\r\n    colB,\r\n    channels,\r\n) {\r\n    gl.noise = gl.noise || new FxShader(null, shaderNoise.replace(/#define.*/, ''), 'noise');\r\n    simpleShader.call(this, gl.noise, {\r\n        seed: seed || 0,\r\n        type,\r\n        scale: [scale[0], scale[1]],\r\n        offset,\r\n        octaves,\r\n        samples,\r\n        texSize: [this.width, this.height],\r\n        peaks,\r\n        brightness,\r\n        contrast,\r\n        isReversed: isReversed ? 1.0 : 0.0,\r\n        colA: colA ? [colA.r / 255, colA.g / 255, colA.b / 255] : [0, 0, 0],\r\n        colB: colB ? [colB.r / 255, colB.g / 255, colB.b / 255] : [1, 1, 1],\r\n        channels: channels === 'rgb' ? 0 : 1,\r\n    });\r\n\r\n    return this;\r\n};","uniform sampler2D texture;\r\nvarying vec2 texCoord;\r\nuniform vec2 texSize;\r\n\r\nuniform float seed;\r\nuniform float type;\r\nuniform vec2 scale;\r\nuniform vec2 offset;\r\nuniform float octaves;\r\nuniform float samples;\r\n\r\nuniform float peaks;\r\nuniform float contrast;\r\nuniform float brightness;\r\nuniform float isReversed;\r\n\r\nuniform vec3 colA;\r\nuniform vec3 colB;\r\n\r\nuniform float channels; // 0 - rgb, 1 - alpha\r\n\r\n// fbm, cellular_noise based on\r\n// https://github.com/Gonkee/Gonkees-Shaders\r\n// MIT, Copyright  Gonkee\r\n\r\n// hash & simplex based on\r\n// https://www.shadertoy.com/view/Msf3WH\r\n// MIT, Copyright  2013 Inigo Quilez\r\n// https://www.youtube.com/c/InigoQuilez\r\n// https://iquilezles.org\r\n\r\n\r\n\r\nfloat rand(vec2 co) {\r\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\r\n}\r\n\r\nfloat value_noise(vec2 coord){\r\n    return rand(floor(coord) / 100.0);\r\n}\r\n\r\nfloat cellular_noise(vec2 coord) {\r\n    vec2 i = floor(coord);\r\n    vec2 f = fract(coord);\r\n\r\n    float min_dist = 99999.0;\r\n    for (float x = -1.0; x <= 1.0; x++) {\r\n        for (float y = -1.0; y <= 1.0; y++) {\r\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\r\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\r\n            min_dist = min(min_dist, dist);\r\n        }\r\n    }\r\n    return min_dist;\r\n}\r\n\r\n// ---------- Simplex Alternative ---------------------\r\n\r\nvec3 hash(vec3 p)\r\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\r\n, dot(p, vec3(269.5, 183.3, 246.1))\r\n, dot(p, vec3(113.5, 271.9, 124.6)))\r\n;return fract(sin(p)*43758.5453123)*2.-1.; }\r\n\r\nmat3 hash(mat3 p)\r\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\r\n\r\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\r\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\r\n\r\n//return noiseGra13dx as .x, and its derivatives as .yzw\r\n// https://www.shadertoy.com/view/llByD1\r\nvec3 noiseGra13dx(in vec3 x) {\r\n    vec3 p=floor(x), w=fract(x)\r\n    #if 1\r\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\r\n    #else\r\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\r\n    #endif\r\n    //gradients\r\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\r\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\r\n    //projections\r\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\r\n    //interpolations\r\n    float g=dot(G, w), f=dot(F, w-vec3(1));\r\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\r\n    mat3 S=D-mat3(G, G, G), W=D-E;\r\n    a.x=(a.x+a.y+a.z)+f-g;\r\n    ;float b=u.x*u.y*u.z;\r\n\r\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\r\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\r\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\r\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\r\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\r\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\r\n    return 0.5 + 0.5 * result.xxx;\r\n}\r\n\r\nfloat fbm(vec2 coord) {\r\n    float normalize_factor = 0.0;\r\n    float value = 0.0;\r\n    float scale = 0.5;\r\n\r\n    for (float i = 0.0; i < 7.0; i++){\r\n        if (i < octaves) {\r\n            if (type == 0.0) {\r\n                value += value_noise(coord) * scale;\r\n            } else if (type == 1.0) {\r\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\r\n            } else if (type == 2.0) {\r\n                value += cellular_noise(coord) * scale;\r\n            }\r\n            normalize_factor += scale;\r\n            coord *= 2.0;\r\n            scale *= 0.5;\r\n        }\r\n    }\r\n    return value / normalize_factor;\r\n}\r\n\r\nfloat render (vec2 pos) {\r\n    float result = fbm(pos);\r\n    //\r\n\r\n    if (peaks > 0.0) {\r\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\r\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\r\n    }\r\n\r\n    result += brightness;\r\n    if (contrast > 0.0) {\r\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\r\n    } else if (contrast < 0.0) {\r\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\r\n    }\r\n\r\n    if (isReversed == 1.0) {\r\n        result = 1.0 - result;\r\n    }\r\n    return result;\r\n}\r\n\r\n\r\nvoid main() {\r\n    vec4 color;\r\n\r\n    vec2 seedOffset;\r\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\r\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\r\n\r\n    float val = 0.0;\r\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\r\n\r\n    if (samples == 1.0) {\r\n        val = render(basePos);\r\n\r\n    }/* else if (samples == 4.0) {\r\n        for (float i = 0.0; i < 2.0; i++) {\r\n            for (float e = 0.0; e < 2.0; e++) {\r\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\r\n            }\r\n        }\r\n        val /= 4.0;\r\n\r\n    }*/ else if (samples == 16.0) {\r\n        for (float i = 0.0; i < 4.0; i++) {\r\n            for (float e = 0.0; e < 4.0; e++) {\r\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\r\n            }\r\n        }\r\n        val /= 16.0;\r\n    }\r\n\r\n    if (channels == 0.0) {\r\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\r\n    } else {\r\n        gl_FragColor = vec4(vec3(1.0), val);\r\n    }\r\n}","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {randomShaderFunc} from '../shaders/random-shader-func';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Triangle Blur\r\n * @description  This is the most basic blur filter, which convolves the image with a\r\n *               pyramid filter. The pyramid filter is separable and is applied as two\r\n *               perpendicular triangle filters.\r\n * @param radius The radius of the pyramid convolved with the image.\r\n */\r\nexport type TFilterTriangleBlur = (\r\n    this: TFxCanvas,\r\n    radius: number,\r\n) => TFxCanvas;\r\n\r\n\r\nexport const triangleBlur: TFilterTriangleBlur = function (radius) {\r\n    gl.triangleBlur = gl.triangleBlur || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta * percent);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'triangleBlur');\r\n\r\n    simpleShader.call(this, gl.triangleBlur, {\r\n        delta: [radius / this.width, 0],\r\n    });\r\n    simpleShader.call(this, gl.triangleBlur, {\r\n        delta: [0, radius / this.height],\r\n    });\r\n\r\n    return this;\r\n};","// returns a random number between 0 and 1\r\nexport const randomShaderFunc = '\\\r\n    float random(vec3 scale, float seed) {\\\r\n        /* use the fragment position for a different seed per-pixel */\\\r\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\r\n    }\\\r\n';","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {randomShaderFunc} from '../shaders/random-shader-func';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Tilt Shift\r\n * @description          Simulates the shallow depth of field normally encountered in close-up\r\n *                       photography, which makes the scene seem much smaller than it actually\r\n *                       is. This filter assumes the scene is relatively planar, in which case\r\n *                       the part of the scene that is completely in focus can be described by\r\n *                       a line (the intersection of the focal plane and the scene). An example\r\n *                       of a planar scene might be looking at a road from above at a downward\r\n *                       angle. The image is then blurred with a blur radius that starts at zero\r\n *                       on the line and increases further from the line.\r\n * @param startX         The x coordinate of the start of the line segment.\r\n * @param startY         The y coordinate of the start of the line segment.\r\n * @param endX           The x coordinate of the end of the line segment.\r\n * @param endY           The y coordinate of the end of the line segment.\r\n * @param blurRadius     The maximum radius of the pyramid blur.\r\n * @param gradientRadius The distance from the line at which the maximum blur radius is reached.\r\n */\r\nexport type TFilterTiltShift = (\r\n    this: TFxCanvas,\r\n    startX: number,\r\n    startY: number,\r\n    endX: number,\r\n    endY: number,\r\n    blurRadius: number,\r\n    gradientRadius: number,\r\n) => TFxCanvas;\r\n\r\nexport const tiltShift: TFilterTiltShift = function (\r\n    startX,\r\n    startY,\r\n    endX,\r\n    endY,\r\n    blurRadius,\r\n    gradientRadius,\r\n) {\r\n    gl.tiltShift = gl.tiltShift || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float blurRadius;\\\r\n        uniform float gradientRadius;\\\r\n        uniform vec2 start;\\\r\n        uniform vec2 end;\\\r\n        uniform vec2 delta;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\\\r\n            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'tiltShift');\r\n\r\n    const dx = endX - startX;\r\n    const dy = endY - startY;\r\n    const d = Math.sqrt(dx * dx + dy * dy);\r\n    simpleShader.call(this, gl.tiltShift, {\r\n        blurRadius: blurRadius,\r\n        gradientRadius: gradientRadius,\r\n        start: [startX, startY],\r\n        end: [endX, endY],\r\n        delta: [dx / d, dy / d],\r\n        texSize: [this.width, this.height],\r\n    });\r\n    simpleShader.call(this, gl.tiltShift, {\r\n        blurRadius: blurRadius,\r\n        gradientRadius: gradientRadius,\r\n        start: [startX, startY],\r\n        end: [endX, endY],\r\n        delta: [-dy / d, dx / d],\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {warpShader} from '../shaders/warp-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {getInverse} from '../math/matrix';\r\nimport {TFxCanvas, TMat2x2, TMat3x3, TMatDeep3x3} from '../fx-canvas-types';\r\n\r\n/**\r\n * Matrix Warp\r\n * @description           Transforms an image by a 2x2 or 3x3 matrix. The coordinates used in\r\n *                        the transformation are (x, y) for a 2x2 matrix or (x, y, 1) for a\r\n *                        3x3 matrix, where x and y are in units of pixels.\r\n * @param matrix          A 2x2 or 3x3 matrix represented as either a list or a list of lists.\r\n *                        For example, the 3x3 matrix [[2,0,0],[0,3,0],[0,0,1]] can also be\r\n *                        represented as [2,0,0,0,3,0,0,0,1] or just [2,0,0,3].\r\n * @param inverse         A boolean value that, when true, applies the inverse transformation\r\n *                        instead. (optional, defaults to false)\r\n * @param useTextureSpace A boolean value that, when true, uses texture-space coordinates\r\n *                        instead of screen-space coordinates. Texture-space coordinates range\r\n *                        from -1 to 1 instead of 0 to width - 1 or height - 1, and are easier\r\n *                        to use for simple operations like flipping and rotating.\r\n */\r\nexport type TFilterMatrixWarp = (\r\n    this: TFxCanvas,\r\n    matrix: TMat2x2 | TMat3x3 | TMatDeep3x3,\r\n    inverse?: boolean,\r\n    useTextureSpace?: boolean,\r\n) => TFxCanvas;\r\n\r\n\r\nexport const matrixWarp: TFilterMatrixWarp = function (matrix, inverse, useTextureSpace) {\r\n    gl.matrixWarp = gl.matrixWarp || warpShader('\\\r\n        uniform mat3 matrix;\\\r\n        uniform bool useTextureSpace;\\\r\n    ', '\\\r\n        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;\\\r\n        vec3 warp = matrix * vec3(coord, 1.0);\\\r\n        coord = warp.xy / warp.z;\\\r\n        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;\\\r\n    ');\r\n\r\n    // Flatten all members of matrix into one big list\r\n    matrix = matrix.flat() as (TMat2x2 | TMat3x3);\r\n\r\n    // Extract a 3x3 matrix out of the arguments\r\n    if (matrix.length == 4) {\r\n        matrix = [\r\n            matrix[0], matrix[1], 0,\r\n            matrix[2], matrix[3], 0,\r\n            0, 0, 1,\r\n        ];\r\n    } else if (matrix.length != 9) {\r\n        throw 'can only warp with 2x2 or 3x3 matrix';\r\n    }\r\n\r\n    simpleShader.call(this, gl.matrixWarp, {\r\n        matrix: inverse ? getInverse(matrix) : matrix,\r\n        texSize: [this.width, this.height],\r\n        useTextureSpace: useTextureSpace ? 1 : 0,\r\n    });\r\n\r\n    return this;\r\n};","import {FxShader} from '../core/fx-shader';\r\n\r\nexport function warpShader (uniformsStr: string, warpStr: string): FxShader {\r\n    return new FxShader(null, uniformsStr + '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        vec2 coord = texCoord * texSize;\\\r\n        ' + warpStr + '\\\r\n        gl_FragColor = texture2D(texture, coord / texSize);\\\r\n        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\r\n        if (coord != clampedCoord) {\\\r\n            /* fade to transparent if we are outside the image */\\\r\n            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\r\n        }\\\r\n    }', 'warp');\r\n}","import {TMat3x3} from '../fx-canvas-types';\r\n\r\n// from javax.media.jai.PerspectiveTransform\r\n\r\n/**\r\n * Creates a PerspectiveTransform that maps the unit square onto an arbitrary quadrilateral.\r\n */\r\nexport function getSquareToQuad (\r\n    x0: number,\r\n    y0: number,\r\n    x1: number,\r\n    y1: number,\r\n    x2: number,\r\n    y2: number,\r\n    x3: number,\r\n    y3: number\r\n): TMat3x3 {\r\n    const dx1 = x1 - x2;\r\n    const dy1 = y1 - y2;\r\n    const dx2 = x3 - x2;\r\n    const dy2 = y3 - y2;\r\n    const dx3 = x0 - x1 + x2 - x3;\r\n    const dy3 = y0 - y1 + y2 - y3;\r\n    const det = dx1 * dy2 - dx2 * dy1;\r\n    const a = (dx3 * dy2 - dx2 * dy3) / det;\r\n    const b = (dx1 * dy3 - dx3 * dy1) / det;\r\n    return [\r\n        x1 - x0 + a * x1, y1 - y0 + a * y1, a,\r\n        x3 - x0 + b * x3, y3 - y0 + b * y3, b,\r\n        x0, y0, 1,\r\n    ];\r\n}\r\n\r\nexport function getInverse (m: TMat3x3): TMat3x3 {\r\n    const a = m[0], b = m[1], c = m[2];\r\n    const d = m[3], e = m[4], f = m[5];\r\n    const g = m[6], h = m[7], i = m[8];\r\n    const det = a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\r\n    return [\r\n        (e * i - f * h) / det, (c * h - b * i) / det, (b * f - c * e) / det,\r\n        (f * g - d * i) / det, (a * i - c * g) / det, (c * d - a * f) / det,\r\n        (d * h - e * g) / det, (b * g - a * h) / det, (a * e - b * d) / det,\r\n    ];\r\n}\r\n\r\nexport function multiply (a: TMat3x3, b: TMat3x3): TMat3x3 {\r\n    return [\r\n        a[0] * b[0] + a[1] * b[3] + a[2] * b[6],\r\n        a[0] * b[1] + a[1] * b[4] + a[2] * b[7],\r\n        a[0] * b[2] + a[1] * b[5] + a[2] * b[8],\r\n        a[3] * b[0] + a[4] * b[3] + a[5] * b[6],\r\n        a[3] * b[1] + a[4] * b[4] + a[5] * b[7],\r\n        a[3] * b[2] + a[4] * b[5] + a[5] * b[8],\r\n        a[6] * b[0] + a[7] * b[3] + a[8] * b[6],\r\n        a[6] * b[1] + a[7] * b[4] + a[8] * b[7],\r\n        a[6] * b[2] + a[7] * b[5] + a[8] * b[8],\r\n    ];\r\n}","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Unsharp Mask\r\n * @description    A form of image sharpening that amplifies high-frequencies in the image. It\r\n *                 is implemented by scaling pixels away from the average of their neighbors.\r\n * @param radius   The blur radius that calculates the average of the neighboring pixels.\r\n * @param strength A scale factor where 0 is no effect and higher values cause a stronger effect.\r\n */\r\nexport type TFilterUnsharpMask = (\r\n    this: TFxCanvas,\r\n    radius: number,\r\n    strength: number,\r\n) => TFxCanvas;\r\n\r\nexport const unsharpMask: TFilterUnsharpMask = function (radius, strength) {\r\n    gl.unsharpMask = gl.unsharpMask || new FxShader(null, '\\\r\n        uniform sampler2D blurredTexture;\\\r\n        uniform sampler2D originalTexture;\\\r\n        uniform float strength;\\\r\n        uniform float threshold;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 blurred = texture2D(blurredTexture, texCoord);\\\r\n            vec4 original = texture2D(originalTexture, texCoord);\\\r\n            gl_FragColor = mix(blurred, original, 1.0 + strength);\\\r\n        }\\\r\n    ', 'unsharpMask');\r\n\r\n    // Store a copy of the current texture in the second texture unit\r\n    this._.extraTexture.ensureFormatViaTexture(this._.texture);\r\n    this._.texture.use();\r\n    this._.extraTexture.drawTo(function () {\r\n        FxShader.getDefaultShader().drawRect();\r\n    });\r\n\r\n    // Blur the current texture, then use the stored texture to detect edges\r\n    this._.extraTexture.use(1);\r\n    this.triangleBlur(radius);\r\n    gl.unsharpMask.textures({\r\n        originalTexture: 1,\r\n    });\r\n    simpleShader.call(this, gl.unsharpMask, {\r\n        strength: strength,\r\n    });\r\n    this._.extraTexture.unuse(1);\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\nimport {IRGBA} from '../../klecks/kl-types';\r\n\r\n/**\r\n * To Alpha\r\n * @description   Generates alpha channel from luminance (r+g+b)\r\n * @param isInverted    boolean - invert luminance\r\n * @param replaceRGBA    rgba - color to replace rgb with. if a = 0 -> keep orig color\r\n */\r\nexport type TFilterToAlpha = (\r\n    this: TFxCanvas,\r\n    isInverted: boolean,\r\n    replaceRGBA: IRGBA | null,\r\n) => TFxCanvas;\r\n\r\nexport const toAlpha: TFilterToAlpha = function (isInverted, replaceRGBA) {\r\n    gl.toAlpha = gl.toAlpha || new FxShader(null, '\\\r\n    uniform bool isInverted;\\\r\n    uniform vec4 replace;\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        float alpha = (color.r + color.g + color.b) / 3.0;\\\r\n        if (isInverted) alpha = 1.0 - alpha;\\\r\n        alpha = min(color.a, alpha);\\\r\n        if (replace.a > 0.0) color = replace;\\\r\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha);\\\r\n    }\\\r\n', 'toAlpha');\r\n\r\n    simpleShader.call(this, gl.toAlpha, {\r\n        isInverted: isInverted ? 1 : 0,\r\n        replace: replaceRGBA ? [replaceRGBA.r / 255, replaceRGBA.g / 255, replaceRGBA.b / 255, replaceRGBA.a] : [0, 0, 0, 0],\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Invert\r\n * @description   Inverts color of each pixel\r\n */\r\nexport type TFilterInvert = (\r\n    this: TFxCanvas,\r\n) => TFxCanvas;\r\n\r\nexport const invert: TFilterInvert = function () {\r\n    gl.invert = gl.invert || new FxShader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        color.rgb = 1.0 - color.rgb;\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'invert');\r\n\r\n    simpleShader.call(this, gl.invert, {\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {getInverse, getSquareToQuad, multiply} from '../math/matrix';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\nexport type TRectanglePoints = [\r\n    number, number, // point a\r\n    number, number, // point b\r\n    number, number, // point c\r\n    number, number, // point d\r\n];\r\n\r\n/**\r\n * Perspective\r\n * @description  Warps one quadrangle to another with a perspective transform. This can be used to\r\n *               make a 2D image look 3D or to recover a 2D image captured in a 3D environment.\r\n * @param before The x and y coordinates of four points before the transform in a flat list. This\r\n *               would look like [ax, ay, bx, by, cx, cy, dx, dy] for four points (ax, ay), (bx, by),\r\n *               (cx, cy), and (dx, dy).\r\n * @param after  The x and y coordinates of four points after the transform in a flat list, just\r\n *               like the other argument.\r\n */\r\nexport type TFilterPerspective = (\r\n    this: TFxCanvas,\r\n    before: TRectanglePoints,\r\n    after: TRectanglePoints,\r\n) => TFxCanvas;\r\n\r\nexport const perspective: TFilterPerspective = function (before, after) {\r\n    const a = getSquareToQuad(...after);\r\n    const b = getSquareToQuad(...before);\r\n    const c = multiply(getInverse(a), b);\r\n    return this.matrixWarp(c);\r\n};\r\n","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * unmultiplyAlpha\r\n * reverses alpha multiply\r\n */\r\nexport type TFilterUnmultiplyAlpha = (\r\n    this: TFxCanvas,\r\n) => TFxCanvas;\r\n\r\nexport const unmultiplyAlpha: TFilterUnmultiplyAlpha = function () {\r\n    gl.unmultiplyAlpha = gl.unmultiplyAlpha || new FxShader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        if(color.a > 0.0) {\\\r\n            color.rgb /= color.a;\\\r\n        }\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'unmultiplyAlpha');\r\n\r\n    simpleShader.call(this, gl.unmultiplyAlpha, {\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {warpShader} from '../shaders/warp-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n\r\nexport type TFilterDistortSettings = {\r\n    stepSize: number; // [1, inf]\r\n    distortType: 0 | 1 | 2;\r\n    scale: { x: number; y: number };\r\n    strength: { x: number; y: number };\r\n    phase: { x: number; y: number };\r\n};\r\n\r\n/**\r\n * Distort\r\n * Distorts image (moves pixels around)\r\n */\r\nexport type TFilterDistort = (\r\n    this: TFxCanvas,\r\n    settings: TFilterDistortSettings,\r\n) => TFxCanvas;\r\n\r\n/**\r\n * @filter        Distort\r\n * @description   Distorts image (moves pixels around)\r\n */\r\nexport const distort: TFilterDistort = function (settings) {\r\n    gl.distort = gl.distort || warpShader('\\\r\n        uniform float stepSize;\\\r\n        uniform vec2 scale;\\\r\n        uniform vec2 strength;\\\r\n        uniform vec2 phase;\\\r\n        uniform float type;\\\r\n        ', '\\\r\n        const float PI = 3.14159265;\\\r\n        float x = coord.x;\\\r\n        float y = coord.y;\\\r\n        if (stepSize > 1.0) {\\\r\n            x = floor(x / stepSize) * stepSize;\\\r\n            y = floor(y / stepSize) * stepSize;\\\r\n        }\\\r\n        float distortX = sin((x/scale.x + phase.x) * PI * 2.0) * strength.x;\\\r\n        float distortY = sin((y/scale.y + phase.y) * PI * 2.0) * strength.y;\\\r\n        if (type == 0.0) {\\\r\n            coord.y += distortX;\\\r\n            coord.x += distortY;\\\r\n        } else if (type == 1.0) {\\\r\n            coord.x += distortX;\\\r\n            coord.y += distortY;\\\r\n        } else if (type == 2.0) {\\\r\n            gl_FragColor = texture2D(texture, vec2(x, y) / texSize);\\\r\n            coord.y += sin(gl_FragColor.r/scale.x*200.0 + phase.x * PI * 2.0) * strength.x;\\\r\n            coord.x += cos(gl_FragColor.g/scale.y*200.0 + phase.y * PI * 2.0) * strength.y;\\\r\n        }\\\r\n        coord.x = mod(coord.x, texSize.x);\\\r\n        coord.y = mod(coord.y, texSize.y);\\\r\n        \\\r\n        ');\r\n\r\n    simpleShader.call(this, gl.distort, {\r\n        stepSize: settings.stepSize,\r\n        type: settings.distortType,\r\n        scale: [settings.scale.x, settings.scale.y],\r\n        strength: [settings.strength.x, settings.strength.y],\r\n        phase: [settings.phase.x, settings.phase.y],\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};\r\n\r\n","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * multiplyAlpha\r\n * applies alpha multiply\r\n */\r\nexport type TFilterMultiplyAlpha = (\r\n    this: TFxCanvas,\r\n) => TFxCanvas;\r\n\r\nexport const multiplyAlpha: TFilterMultiplyAlpha = function () {\r\n    gl.multiplyAlpha = gl.multiplyAlpha || new FxShader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        color.rgb *= color.a;\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'multiplyAlpha');\r\n\r\n    simpleShader.call(this, gl.multiplyAlpha, {\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {base64ToBlob} from '../../storage/base-64-to-blob';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\nimport loadingImg from '/src/app/img/ui/loading.gif';\r\n\r\ntype TImgurUploadResponse = {\r\n    // just a subset\r\n    id: string;\r\n    datetime: number;\r\n    type: string;\r\n    width: number;\r\n    height: number;\r\n    deletehash: string;\r\n    name: string;\r\n    link: string;\r\n};\r\n\r\n/**\r\n * uploads canvas, opens new tab with the upload progress & then opens the image page.\r\n */\r\nasync function upload (\r\n    canvas: HTMLCanvasElement,\r\n    title: string,\r\n    description: string,\r\n    type: 'png' | 'jpeg',\r\n    imgurKey: string,\r\n): Promise<TImgurUploadResponse> {\r\n    const img = base64ToBlob(canvas.toDataURL('image/' + type));\r\n\r\n    const w = window.open();\r\n\r\n    if (!w) {\r\n        throw new Error('could not create new tab');\r\n    }\r\n\r\n    const label = w.document.createElement('div');\r\n    const gif = w.document.createElement('img');\r\n    gif.src = loadingImg;\r\n    label.append(gif);\r\n    BB.css(gif, {\r\n        filter: 'invert(1)',\r\n    });\r\n    BB.css(w.document.body, {\r\n        backgroundColor: '#121211',\r\n        backgroundImage: 'linear-gradient(#2b2b2b 0%, #121211 50%)',\r\n        backgroundRepeat: 'no-repeat',\r\n    });\r\n    \r\n    const labelText = w.document.createElement('div');\r\n    labelText.style.marginTop = '10px';\r\n    label.append(labelText);\r\n    labelText.textContent = LANG('upload-uploading');\r\n\r\n    w.document.body.append(label);\r\n    BB.css(label, {\r\n        marginLeft: 'auto',\r\n        marginRight: 'auto',\r\n        marginTop: '100px',\r\n        fontFamily: 'Arial, sans-serif',\r\n        fontSize: '20px',\r\n        textAlign: 'center',\r\n        transition: 'opacity 0.3s ease-in-out',\r\n        opacity: '0',\r\n        color: '#ccc',\r\n    });\r\n    setTimeout(function () {\r\n        label.style.opacity = '1';\r\n    }, 20);\r\n\r\n    let response;\r\n    try {\r\n        const formData = new FormData();\r\n        formData.append('title', title);\r\n        formData.append('description', description);\r\n        formData.append('image', img);\r\n        response = await fetch('https://api.imgur.com/3/image',  {\r\n            method: 'POST',\r\n            headers: {\r\n                Authorization: 'Client-ID ' + imgurKey,\r\n            },\r\n            body: formData,\r\n        });\r\n\r\n    } catch (e) {\r\n        w.close();\r\n        throw e;\r\n    }\r\n    if (!response.ok) {\r\n        w.close();\r\n        throw new Error();\r\n    }\r\n    const data: TImgurUploadResponse = (await response.json()).data;\r\n\r\n    w.location.href = data.link.replace(/\\.(jpg|png)/, '');\r\n\r\n    return data;\r\n}\r\n\r\n\r\nexport function imgurUpload (\r\n    klCanvas: KlCanvas,\r\n    klRootEl: HTMLElement,\r\n    saveReminder: SaveReminder,\r\n    imgurKey: string, // API key\r\n): void {\r\n    if (!imgurKey) {\r\n        throw new Error('imgur key missing');\r\n    }\r\n\r\n    const inputTitle = BB.el({tagName: 'input'});\r\n    inputTitle.type = 'text';\r\n    inputTitle.value = LANG('upload-title-untitled');\r\n    const inputDescription = BB.el({\r\n        tagName: 'textarea',\r\n        custom: {\r\n            rows: '2',\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            maxWidth: '100%',\r\n        },\r\n    });\r\n\r\n    const labelTitle =  BB.el({\r\n        textContent: LANG('upload-name') + ':',\r\n    });\r\n    const labelDescription = BB.el({\r\n        textContent: LANG('upload-caption') + ':',\r\n        css: {\r\n            marginTop: '10px',\r\n        },\r\n    });\r\n\r\n    const tos = BB.el({\r\n        content: `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${LANG('terms-of-service')}</a>`,\r\n    });\r\n\r\n    const typeRadio = new KL.RadioList({\r\n        name: 'filetype',\r\n        init: 'jpeg',\r\n        items: [\r\n            { label: 'JPG', value: 'jpeg' },\r\n            { label: 'PNG', value: 'png' },\r\n        ],\r\n        ignoreFocus: true,\r\n    });\r\n    BB.css(typeRadio.getElement(), {\r\n        marginBottom: '10px',\r\n    });\r\n\r\n\r\n    const outDiv = BB.el();\r\n    const infoHint = BB.el({\r\n        className: 'info-hint',\r\n        textContent: LANG('upload-link-notice'),\r\n    });\r\n    outDiv.append(\r\n        infoHint,\r\n        typeRadio.getElement(),\r\n        labelTitle,\r\n        inputTitle,\r\n        labelDescription,\r\n        inputDescription,\r\n        tos\r\n    );\r\n    KL.popup({\r\n        target: klRootEl,\r\n        message: `<b>${LANG('upload-title')}</b>`,\r\n        type: 'upload',\r\n        div: outDiv,\r\n        buttons: [LANG('upload-submit'), 'Cancel'],\r\n        clickOnEnter: LANG('upload-submit'),\r\n        primaries: [LANG('upload-submit')],\r\n        autoFocus: LANG('upload-submit'),\r\n        callback: async function (val) {\r\n            if (val === LANG('upload-submit') || val === 'Yes' || val === 'Ok') {\r\n                try {\r\n                    const result = await upload(\r\n                        klCanvas.getCompleteCanvas(1),\r\n                        inputTitle.value,\r\n                        inputDescription.value,\r\n                        typeRadio.getValue() as 'png' | 'jpeg',\r\n                        imgurKey,\r\n                    );\r\n\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: 'ok',\r\n                        message: `<h3>${LANG('upload-success')}</h3><br>${LANG('upload-delete')}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/delete/${result.deletehash}</a><br><br>`,\r\n                        buttons: ['Ok'],\r\n                    });\r\n                    saveReminder.reset();\r\n\r\n                } catch(e) {\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: 'error',\r\n                        message: LANG('upload-failed'),\r\n                        buttons: ['Ok'],\r\n                    });\r\n                }\r\n            }\r\n        },\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"c3ZSC\");","import {KL} from '../../kl';\r\nimport {BB} from '../../../bb/bb';\r\nimport {KlHistoryInterface} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\nimport {BrowserStorageUi} from './browser-storage-ui';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {IKlProject} from '../../kl-types';\r\n\r\n\r\nconst reminderTimeLimitMs = 1000 * 60 * 20; // 20 minutes\r\nconst unsavedActionsLimit = 100; // number of actions user did since last save\r\n\r\n\r\n/**\r\n * remind user of saving, keep user aware of save state\r\n */\r\nexport class SaveReminder {\r\n    private lastSavedActionNumber: number | undefined;\r\n    private lastSavedAt: number = 0;\r\n\r\n    private lastReminderShownAt: number = 0;\r\n    private unsavedInterval: ReturnType<typeof setInterval> | undefined;\r\n    private closeFunc: (() => void) | undefined;\r\n\r\n    showPopup (): void {\r\n        if (!this.projectStore || !this.getProject) {\r\n            throw new Error('projectStore and getProject need to be set');\r\n        }\r\n\r\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\r\n\r\n        const contentEl = BB.el();\r\n\r\n        contentEl.append(\r\n            BB.el({\r\n                content: LANG(\r\n                    'save-reminder-text',\r\n                    {\r\n                        a: '<strong>' + min,\r\n                        b: '</strong>',\r\n                    }\r\n                ),\r\n                css: {\r\n                    marginBottom: '20px',\r\n                },\r\n            }),\r\n        );\r\n\r\n        const psdWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n            },\r\n        });\r\n        const storageWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n                paddingBottom: '0',\r\n            },\r\n        });\r\n        contentEl.append(psdWrapper, storageWrapper);\r\n\r\n\r\n        const psdBtn = BB.el({\r\n            tagName: 'button',\r\n            className: 'kl-button',\r\n            content: LANG('save-reminder-save-psd'),\r\n            onClick: () => this.onSaveAsPsd(),\r\n        });\r\n        psdWrapper.append(\r\n            psdBtn,\r\n            BB.el({\r\n                content: LANG('save-reminder-psd-layers'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            }),\r\n        );\r\n\r\n\r\n        const storageUi = new BrowserStorageUi(\r\n            this.projectStore,\r\n            this.getProject,\r\n            this,\r\n            document.body,\r\n            {\r\n                hideClearButton: true,\r\n                isFocusable: true,\r\n            }\r\n        );\r\n        storageWrapper.append(storageUi.getElement());\r\n\r\n\r\n        KL.popup({\r\n            target: document.body,\r\n            message: `<b>${LANG('save-reminder-title')}</b>`,\r\n            div: contentEl,\r\n            ignoreBackground: true,\r\n            callback: () => {\r\n                storageUi.destroy();\r\n                BB.destroyEl(psdBtn);\r\n                this.closeFunc = undefined;\r\n                this.lastReminderShownAt = performance.now();\r\n            },\r\n            closeFunc: (f) => {\r\n                this.closeFunc = f;\r\n            },\r\n        });\r\n        setTimeout(() => {\r\n            psdBtn.focus();\r\n        }, 40);\r\n    }\r\n\r\n    constructor (\r\n        private history: KlHistoryInterface,\r\n        private showReminder: boolean,\r\n        private changeTitle: boolean,\r\n        private onSaveAsPsd: () => void,\r\n        private isDrawing: () => boolean,\r\n        private projectStore: ProjectStore | null, // needed if showReminder\r\n        private getProject: (() => IKlProject) | null, // needed if showReminder\r\n        private title: string = 'Klecks',\r\n    ) { }\r\n\r\n    init (): void {\r\n        if (this.lastSavedActionNumber !== undefined) { // already initialized\r\n            return;\r\n        }\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n\r\n        if (this.showReminder) {\r\n            setInterval(() => {\r\n                if (document.visibilityState !== 'visible') {\r\n                    return;\r\n                }\r\n\r\n                const unsavedActions = Math.abs(this.history.getActionNumber() - this.lastSavedActionNumber!);\r\n\r\n                if (\r\n                    KL.dialogCounter.get() === 0 &&\r\n                    !this.isDrawing() &&\r\n                    this.lastReminderShownAt + reminderTimeLimitMs < performance.now() &&\r\n                    unsavedActions >= unsavedActionsLimit\r\n                ) {\r\n                    this.showPopup();\r\n                }\r\n            }, 1000 * 5);\r\n        }\r\n\r\n        // confirmation dialog when closing tab\r\n        function onBeforeUnload (e: BeforeUnloadEvent) {\r\n            e.preventDefault();\r\n            e.returnValue = '';\r\n        }\r\n\r\n        this.history.addListener(() => {\r\n            const actionNumber = this.history.getActionNumber();\r\n            if (this.lastSavedActionNumber !== actionNumber) {\r\n                window.onbeforeunload =  onBeforeUnload;\r\n            } else {\r\n                window.onbeforeunload = null;\r\n            }\r\n        });\r\n\r\n        if (this.changeTitle) {\r\n            document.addEventListener('visibilitychange', () => {\r\n                if (document.visibilityState === 'visible') {\r\n                    document.title = this.title;\r\n                    clearInterval(this.unsavedInterval);\r\n                } else {\r\n                    const actionNumber = this.history.getActionNumber();\r\n                    if (this.lastSavedActionNumber !== actionNumber) {\r\n                        document.title = LANG('unsaved') + ' - ' + this.title;\r\n                        let state = 0;\r\n                        this.unsavedInterval = setInterval(() => {\r\n                            state = (state + 1) % 2;\r\n                            if (state === 1) {\r\n                                document.title = LANG('unsaved') + '  ' + this.title;\r\n                            } else {\r\n                                document.title = LANG('unsaved') + ' - ' + this.title;\r\n                            }\r\n                        }, 1000 * 60 * 3);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    reset (): void {\r\n        if (this.lastSavedActionNumber === undefined) { // not initialized\r\n            return;\r\n        }\r\n\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n        window.onbeforeunload = null;\r\n\r\n        if (this.closeFunc) {\r\n            this.closeFunc();\r\n        }\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {KL} from '../kl';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {TExportType} from '../kl-types';\r\nimport {SaveReminder} from '../ui/components/save-reminder';\r\nimport {saveAs} from '../../bb/base/save-as';\r\nimport {Psd} from 'ag-psd/dist/psd';\r\nimport {klConfig} from '../kl-config';\r\n\r\nexport class SaveToComputer {\r\n\r\n    /**\r\n     * Using old code, because saving somehow doesn't work for ipad before ios 13,\r\n     * and it doesn't even throw an exception.\r\n     */\r\n    private saveImage (canvas: HTMLCanvasElement, filename: string, mimeType: string): void {\r\n        const parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n\r\n        if (!parts) {\r\n            throw new Error('saveImage: empty parts');\r\n        }\r\n\r\n        //assume base64 encoding\r\n        const binStr = atob(parts[3]);\r\n        //convert to binary in ArrayBuffer\r\n        const buf = new ArrayBuffer(binStr.length);\r\n        const view = new Uint8Array(buf);\r\n        for (let i = 0; i < view.length; i++) {\r\n            view[i] = binStr.charCodeAt(i);\r\n        }\r\n        const blob = new Blob([view], {'type': parts[1]});\r\n        saveAs(blob, filename);\r\n    }\r\n\r\n    constructor (\r\n        private saveReminder: SaveReminder,\r\n        private getExportType: () => TExportType,\r\n        private getKlCanvas: () => KlCanvas,\r\n    ) {}\r\n\r\n    save (format?: 'psd' | 'layers' | 'png'): void {\r\n        this.saveReminder.reset();\r\n\r\n        if (!format) {\r\n            format = this.getExportType();\r\n        }\r\n\r\n        if (format === 'png') {\r\n            const extension = 'png';\r\n            const mimeType = 'image/png';\r\n            const filename = BB.getDate() + klConfig.filenameBase + '.' + extension;\r\n            const fullCanvas = this.getKlCanvas().getCompleteCanvas(1);\r\n            try {\r\n                this.saveImage(fullCanvas, filename, mimeType);\r\n            } catch (error) { //fallback for old browsers\r\n                alert('could not save');\r\n                throw new Error('failed png export');\r\n            }\r\n        } else if (format === 'layers') {\r\n            const extension = 'png';\r\n            const mimeType = 'image/png';\r\n            const fileBase = BB.getDate() + klConfig.filenameBase;\r\n            const layerArr = this.getKlCanvas().getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                const item = layerArr[i];\r\n                const fnameArr = [\r\n                    fileBase,\r\n                    '_',\r\n                    ('' + (i + 1)).padStart(2, '0'),\r\n                    '_',\r\n                    item.name,\r\n                    '.',\r\n                    extension,\r\n                ];\r\n                this.saveImage(item.canvas, fnameArr.join(''), mimeType);\r\n            }\r\n        } else if (format === 'psd') {\r\n\r\n            const layerArr = this.getKlCanvas().getLayersFast();\r\n\r\n            const psdConfig: Psd = {\r\n                width: this.getKlCanvas().getWidth(),\r\n                height: this.getKlCanvas().getHeight(),\r\n                children: [],\r\n                canvas: this.getKlCanvas().getCompleteCanvas(1),\r\n            };\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                const item = layerArr[i];\r\n                psdConfig.children!.push({\r\n                    name: item.name,\r\n                    hidden: !item.isVisible,\r\n                    opacity: item.opacity,\r\n                    canvas: item.canvas,\r\n                    blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n                    left: 0,\r\n                    top: 0,\r\n                });\r\n            }\r\n\r\n            KL.loadAgPsd().then((agPsdLazy) => {\r\n                const buffer = agPsdLazy.writePsdBuffer(psdConfig);\r\n                const blob = new Blob([buffer], { type: 'application/octet-stream' });\r\n                saveAs(blob, BB.getDate() + klConfig.filenameBase + '.psd');\r\n            }).catch(() => {\r\n                alert('Error: failed to load PSD library');\r\n            });\r\n\r\n        }\r\n\r\n    }\r\n\r\n}","// https://github.com/eligrey/FileSaver.js/issues/774\r\n// stripped down version of https://github.com/eligrey/FileSaver.js/blob/master/src/FileSaver.js#L81-L108\r\n\r\nexport function saveAs (blob: Blob, name: string): void {\r\n    // Namespace is used to prevent conflict w/ Chrome Poper Blocker extension (Issue https://github.com/eligrey/FileSaver.js/issues/561)\r\n    const a = document.createElementNS('http://www.w3.org/1999/xhtml', 'a') as HTMLAnchorElement;\r\n    a.download = name;\r\n    a.rel = 'noopener';\r\n    a.href = URL.createObjectURL(blob);\r\n\r\n    setTimeout(() => URL.revokeObjectURL(a.href), 40 /* sec */ * 1000);\r\n    setTimeout(() => a.click(), 0);\r\n}\r\n","import {KL} from '../kl';\r\nimport {IHistoryBroadcast, IHistoryEntry, klHistory} from './kl-history';\r\nimport {KlCanvasWorkspace} from '../canvas-ui/kl-canvas-workspace';\r\nimport {IFilter, IFilterApply, IInitState} from '../kl-types';\r\nimport {KlCanvas, KlCanvasContext} from '../canvas/kl-canvas';\r\nimport {LayerManager} from '../ui/tool-tabs/layer-manager/layer-manager';\r\nimport {LayerPreview} from '../ui/components/layer-preview';\r\nimport {HandUi} from '../ui/tool-tabs/hand-ui';\r\nimport {throwIfNull} from '../../bb/base/base';\r\nimport {TBrush} from '../brushes/brushes';\r\n\r\nfunction execHistoryEntry (\r\n    historyEntry: IHistoryEntry,\r\n    layerIndex: number,\r\n    klCanvas: KlCanvas,\r\n    brushes: TBrush[],\r\n    setCurrentLayerCtx: (ctx: CanvasRenderingContext2D) => void,\r\n    getCurrentLayerCtx: () => CanvasRenderingContext2D,\r\n): number {\r\n    if (historyEntry.tool[0] === 'brush') {\r\n        const b = brushes[historyEntry.tool[1] as any];\r\n        historyEntry.actions!.forEach(action => {\r\n            (b[action.action as keyof TBrush] as any)(...action.params);\r\n        });\r\n\r\n    } else if (historyEntry.tool[0] === 'canvas') {\r\n        const p = historyEntry.params!;\r\n        const id = (klCanvas[historyEntry.action as keyof KlCanvas] as any)(...p);\r\n        if (typeof id === 'number') {\r\n            layerIndex = id;\r\n            const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex)) as KlCanvasContext;\r\n            setCurrentLayerCtx(ctx);\r\n            Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\r\n        }\r\n\r\n    } else if (historyEntry.tool[0] === 'filter') {\r\n        const p = [{\r\n            context: getCurrentLayerCtx(),\r\n            klCanvas,\r\n            input: historyEntry.params![0].input,\r\n            history: new KL.DecoyKlHistory(),\r\n        } as IFilterApply];\r\n        (KL.filterLib[historyEntry.tool[1]][historyEntry.action! as keyof IFilter] as any)(...p);\r\n\r\n    } else if (historyEntry.tool[0] === 'misc' && historyEntry.action === 'focusLayer') {\r\n        layerIndex = historyEntry.params![0];\r\n        const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex)) as KlCanvasContext;\r\n        setCurrentLayerCtx(ctx);\r\n        Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\r\n\r\n    } else if (historyEntry.tool[0] === 'misc' && historyEntry.action === 'importImage') {\r\n        const id = klCanvas.addLayer();\r\n        if (typeof id === 'number') {\r\n            layerIndex = id;\r\n            if (historyEntry.params![1]) {\r\n                klCanvas.renameLayer(layerIndex, historyEntry.params![1]);\r\n            }\r\n            const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex)) as KlCanvasContext;\r\n            setCurrentLayerCtx(ctx);\r\n            Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\r\n        }\r\n        getCurrentLayerCtx().drawImage(historyEntry.params![0], 0, 0);\r\n    }\r\n    return layerIndex;\r\n}\r\n\r\nexport class UndoRedoCatchup {\r\n\r\n    private doIgnore = false;\r\n\r\n    /**\r\n     * Prevent multiple undo / redo getting triggered at once if UI is frozen.\r\n     * true -> ignore, don't undo / redo\r\n     */\r\n    private shouldIgnoreTest (): boolean {\r\n        if (this.doIgnore) {\r\n            return true;\r\n        }\r\n        this.doIgnore = true;\r\n        setTimeout(() => {\r\n            this.doIgnore = false;\r\n        }, 0);\r\n        return false;\r\n    }\r\n    \r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        private brushUiMap: any, // todo\r\n        private layerPreview: LayerPreview,\r\n        private layerManager: LayerManager,\r\n        private handUi: HandUi,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private getInitState: () => IInitState,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx: () => CanvasRenderingContext2D | null,\r\n        private setCurrentLayerCtx: (ctx: CanvasRenderingContext2D) => void,\r\n        private getCurrentBrush: () => TBrush,\r\n    ) { }\r\n\r\n    undo (): boolean {\r\n        if (this.shouldIgnoreTest() || !klHistory.canUndo()) {\r\n            return false;\r\n        }\r\n        const entries: IHistoryEntry[] = klHistory.undo();\r\n        const klCanvas = this.getKlCanvas();\r\n        klHistory.pause(true);\r\n        const initState: IInitState = this.getInitState();\r\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\r\n        klCanvas.copy(initState.canvas);\r\n        let layerIndex = initState.focus;\r\n        this.setCurrentLayerCtx(throwIfNull(klCanvas.getLayerContext(layerIndex)));\r\n        const brushes: any = {};\r\n        Object.entries(KL.brushes).forEach(([b, brush]) => {\r\n            brushes[b] = new brush();\r\n            brushes[b].setContext(this.getCurrentLayerCtx());\r\n        });\r\n        brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\r\n        entries.forEach(entry => {\r\n            layerIndex = execHistoryEntry(\r\n                entry,\r\n                layerIndex,\r\n                klCanvas,\r\n                brushes,\r\n                (ctx) => this.setCurrentLayerCtx(ctx),\r\n                () => throwIfNull(this.getCurrentLayerCtx()),\r\n            );\r\n        });\r\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\r\n            this.klCanvasWorkspace.resetOrFitView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        this.layerManager.update(layerIndex);\r\n        this.layerPreview.setLayer(throwIfNull(klCanvas.getLayer(layerIndex)));\r\n        this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx()! as KlCanvasContext);\r\n        this.klCanvasWorkspace.setLastDrawEvent();\r\n\r\n        klHistory.pause(false);\r\n        return true;\r\n    }\r\n\r\n    redo (): boolean {\r\n        if (this.shouldIgnoreTest() || !klHistory.canRedo()) {\r\n            return false;\r\n        }\r\n        const entry = klHistory.redo();\r\n        if (!entry) {\r\n            setTimeout(() => {\r\n                throw new Error('redo failed. redo entry undefined');\r\n            });\r\n            return false;\r\n        }\r\n        const klCanvas = this.getKlCanvas();\r\n        klHistory.pause(true);\r\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\r\n        const brushes: any = {};\r\n        Object.entries(KL.brushes).forEach(([b, brush]) => {\r\n            brushes[b] = new brush();\r\n            brushes[b].setContext(this.getCurrentLayerCtx());\r\n        });\r\n        brushes.SketchyBrush.setSeed(this.brushUiMap.sketchyBrush.getSeed());\r\n        execHistoryEntry(\r\n            entry,\r\n            0, // doesn't matter, because result not used\r\n            klCanvas,\r\n            brushes,\r\n            (ctx) => this.setCurrentLayerCtx(ctx),\r\n            () => throwIfNull(this.getCurrentLayerCtx()),\r\n        );\r\n\r\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\r\n            this.klCanvasWorkspace.resetOrFitView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        const currentLayerIndex = throwIfNull(klCanvas.getLayerIndex(this.getCurrentLayerCtx()!.canvas));\r\n        this.layerManager.update(currentLayerIndex);\r\n        this.layerPreview.setLayer(klCanvas.getLayer(currentLayerIndex)!);\r\n        this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx()! as KlCanvasContext);\r\n        this.klCanvasWorkspace.setLastDrawEvent();\r\n        klHistory.pause(false);\r\n\r\n        return true;\r\n    }\r\n\r\n    catchup (logParam: IHistoryBroadcast | null): void {\r\n        // const start = performance.now();\r\n        //play catch up (the version that is a few steps behind)\r\n\r\n        if (!logParam || !logParam.bufferUpdate) {\r\n            return;\r\n        }\r\n\r\n        const initState: IInitState = this.getInitState();\r\n        let localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\r\n\r\n        initState.focus = execHistoryEntry(\r\n            logParam.bufferUpdate,\r\n            initState.focus,\r\n            initState.canvas,\r\n            initState.brushes,\r\n            (ctx) => {\r\n                localCurrentLayerCtx = ctx;\r\n            },\r\n            () => throwIfNull(localCurrentLayerCtx),\r\n        );\r\n\r\n        // console.log('catchup', performance.now() - start);\r\n    }\r\n\r\n\r\n}","import {IRGB, ISliderConfig} from '../kl-types';\r\n\r\nexport type TBrushSettingEmit = { type: 'color'; value: IRGB } |\r\n    { type: 'opacity'; value: number } |\r\n    { type: 'size'; value: number } |\r\n    { type: 'sliderConfig'; value: ISliderConfig };\r\n\r\nexport type TBrushSettingSubscriber = (p : TBrushSettingEmit) => void;\r\n\r\n/**\r\n * Central place to update brush settings, and to subscribe to changes.\r\n */\r\nexport class BrushSettingService {\r\n\r\n    private static instance: BrushSettingService;\r\n    subscriberArr: TBrushSettingSubscriber[] = [];\r\n\r\n    private emit (obj: TBrushSettingEmit, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (this.subscriberArr[i] === skipSubscriber) {\r\n                continue;\r\n            }\r\n            this.subscriberArr[i](obj);\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        private onSetColor: (rgb: IRGB) => void,\r\n        private onSetSize: (size: number) => void,\r\n        private onSetOpacity: (opacity: number) => void,\r\n        private onGetColor: () => IRGB,\r\n        private onGetSize: () => number,\r\n        private onGetOpacity: () => number,\r\n        private onGetSliderConfig: () => ISliderConfig,\r\n    ) {\r\n        if (BrushSettingService.instance) {\r\n            throw new Error('BrushSettingService already instantiated');\r\n        }\r\n        BrushSettingService.instance = this;\r\n    }\r\n\r\n    emitColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'color',\r\n                value: color,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSize (size: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'size',\r\n                value: size,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'opacity',\r\n                value: opacity,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSliderConfig (sliderConfig: ISliderConfig, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.emit(\r\n            {\r\n                type: 'sliderConfig',\r\n                value: sliderConfig,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    /**\r\n     * set current brush color\r\n     * @param color\r\n     * @param skipSubscriber\r\n     */\r\n    setColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetColor(color);\r\n        this.emitColor(color, skipSubscriber);\r\n    }\r\n\r\n    /**\r\n     * set current brush size\r\n     * @param size\r\n     * @param skipSubscriber\r\n     */\r\n    setSize (size: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetSize(size);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * set current opacity\r\n     * @param opacity\r\n     * @param skipSubscriber\r\n     */\r\n    setOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetOpacity(opacity);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * get current brush color\r\n     */\r\n    getColor (): IRGB {\r\n        return this.onGetColor();\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.onGetSize();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.onGetOpacity();\r\n    }\r\n\r\n    getSliderConfig (): ISliderConfig {\r\n        return this.onGetSliderConfig();\r\n    }\r\n\r\n    /**\r\n     * subscribe to changes\r\n     * @param func\r\n     */\r\n    subscribe (func: TBrushSettingSubscriber): void {\r\n        if (this.subscriberArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.subscriberArr.push(func);\r\n    }\r\n\r\n    unsubscribe (func: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (func === this.subscriberArr[i]) {\r\n                this.subscriberArr.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG, languageStrings, LS_LANGUAGE_KEY} from '../../../language/language';\r\nimport {KL} from '../../kl';\r\nimport {languages} from '../../../../languages/languages';\r\nimport bitbofLogoImg from '/src/app/img/bitbof-logo.svg';\r\nimport klecksLogoImg from '/src/app/img/klecks-logo.png';\r\nimport uiSwapImg from '/src/app/img/ui/ui-swap-lr.svg';\r\nimport {LocalStorage} from '../../../bb/base/local-storage';\r\nimport {theme, TTheme} from '../../../theme/theme';\r\nimport {addIsDarkListener, nullToUndefined} from '../../../bb/base/base';\r\nimport {showLicensesDialog} from '../modals/licenses-dialog/show-licenses-dialog';\r\n\r\nexport class SettingsTab {\r\n\r\n    private el: HTMLElement;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        onLeftRight: () => void,\r\n        customAbout?: HTMLElement,\r\n    ) {\r\n        this.el = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n\r\n        // ---- language ----\r\n        const autoLanguage = languageStrings.getAutoLanguage();\r\n\r\n        const langWrapper = BB.el({\r\n            parent: this.el,\r\n            content: BB.el({\r\n                content: LANG('settings-language') + ':',\r\n                css: {\r\n                    marginRight: '5px',\r\n                    marginBottom: '2px',\r\n                },\r\n            }),\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                flexWrap: 'wrap',\r\n            },\r\n        });\r\n\r\n        const options: [string, string][] = [\r\n            ['auto', LANG('auto') + `  ${autoLanguage.name} (${autoLanguage.code})`] as [string, string],\r\n            ...languages.map(item => {\r\n                return [item.code, item.name + ` (${item.code})`] as [string, string];\r\n            }),\r\n        ];\r\n        const languageSelect = new KL.Select({\r\n            initValue: nullToUndefined(LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'),\r\n            optionArr: options,\r\n            onChange: (val) => {\r\n                if (val === 'auto') {\r\n                    LocalStorage.removeItem(LS_LANGUAGE_KEY);\r\n                } else {\r\n                    LocalStorage.setItem(LS_LANGUAGE_KEY, val);\r\n                }\r\n                languageHint.style.display = 'block';\r\n            },\r\n        });\r\n        BB.css(languageSelect.getElement(), {\r\n            flexGrow: '1',\r\n        });\r\n        const languageHint = BB.el({\r\n            className: 'kl-toolspace-note',\r\n            content: LANG('settings-language-reload'),\r\n            css: {\r\n                display: 'none',\r\n                marginTop: '5px',\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n\r\n        langWrapper.append(\r\n            languageSelect.getElement(),\r\n            languageHint,\r\n        );\r\n\r\n\r\n        // ---- theme ----\r\n        function themeToLabel (theme: TTheme): string {\r\n            return theme === 'dark' ? ' ' + LANG('theme-dark') : ' ' + LANG('theme-light');\r\n        }\r\n        const themeSelect = new KL.Select({\r\n            optionArr: [\r\n                ['auto', LANG('auto') + '  ' + themeToLabel(theme.getMediaQueryTheme())],\r\n                ['light', themeToLabel('light')],\r\n                ['dark', themeToLabel('dark')],\r\n            ],\r\n            initValue: theme.getStoredTheme() || 'auto',\r\n            onChange: (val): void => {\r\n                theme.setStoredTheme(val === 'auto' ? undefined : val);\r\n            },\r\n        });\r\n        BB.css(themeSelect.getElement(), {\r\n            flexGrow: '1',\r\n        });\r\n        addIsDarkListener(() => {\r\n            themeSelect.updateLabel('auto', LANG('auto') + '  ' + themeToLabel(theme.getMediaQueryTheme()));\r\n        });\r\n        BB.el({\r\n            parent: this.el,\r\n            content: [\r\n                BB.el({\r\n                    content: LANG('settings-theme') + ':',\r\n                    css: {\r\n                        marginRight: '5px',\r\n                        marginBottom: '2px',\r\n                    },\r\n                }),\r\n                themeSelect.getElement(),\r\n            ],\r\n            css: {\r\n                marginTop: '15px',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                flexWrap: 'wrap',\r\n            },\r\n        });\r\n\r\n        // ---- flip ui ----\r\n        BB.el({\r\n            tagName: 'button',\r\n            parent: this.el,\r\n            content: '<img height=\"20\" width=\"18\" src=\"' + uiSwapImg + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + LANG('switch-ui-left-right'),\r\n            onClick: () => onLeftRight(),\r\n            css: {\r\n                marginTop: '15px',\r\n            },\r\n            custom: {\r\n                tabIndex: '-1',\r\n            },\r\n        });\r\n\r\n\r\n        // ---- about ----\r\n        this.el.append(BB.el({className: 'grid-hr', css: {margin: '10px 0'}}));\r\n\r\n        function makeLicenses () {\r\n            return BB.el({\r\n                tagName: 'a',\r\n                content: LANG('licenses'),\r\n                onClick: () => showLicensesDialog(),\r\n            });\r\n        }\r\n\r\n        if (customAbout) {\r\n            this.el.append(customAbout);\r\n            if (!customAbout.innerHTML) {\r\n                const minimalAbout = BB.el({\r\n                    parent: customAbout,\r\n                    css: {\r\n                       textAlign: 'center',\r\n                   },\r\n                });\r\n                minimalAbout.append(\r\n                    BB.el({\r\n                        content: `<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2023<br>`,\r\n                    }),\r\n                    makeLicenses(),\r\n                );\r\n            }\r\n        } else {\r\n            const versionEl = BB.el({\r\n                parent: this.el,\r\n                css: {\r\n                    textAlign: 'center',\r\n                },\r\n                content: `\r\n<img alt=\"Klecks\" class=\"dark-invert\" height=\"25\" src=\"${klecksLogoImg}\"><br>\r\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2023<br>`,\r\n            });\r\n\r\n            versionEl.append(\r\n                makeLicenses(),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('donate'),\r\n                    custom: {\r\n                        href: 'https://kleki.com/donate/',\r\n                        target: '_blank',\r\n                    },\r\n                }),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('source-code'),\r\n                    custom: {\r\n                        href: 'https://klecks.org',\r\n                        target: '_blank',\r\n                    },\r\n                }),\r\n            );\r\n\r\n\r\n        }\r\n\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== LS_LANGUAGE_KEY) {\r\n                return;\r\n            }\r\n            languageSelect.setValue(\r\n                nullToUndefined(LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'),\r\n            );\r\n        });\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hTlU7\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hxlHN\");","import {c} from '../../../../bb/base/c';\r\nimport {css as emotionCss} from '@emotion/css';\r\nimport {DynamicModal} from '../base/dynamic-modal';\r\nimport {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\n\r\nexport function showLicensesDialog () {\r\n    const licensesCss = emotionCss({\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        gap: '10px',\r\n        'details > div': {\r\n            padding: '10px',\r\n            boxShadow: '0 0 0 1px',\r\n            marginTop: '5px',\r\n            fontFamily: 'monospace',\r\n            background: '#aaa2',\r\n            overflow: 'hidden',\r\n        },\r\n        'summary': {\r\n            cursor: 'pointer',\r\n            userSelect: 'none',\r\n        },\r\n    });\r\n\r\n    const libraries = c('.' + licensesCss, LANG('loading'));\r\n    const fonts = c('.' + licensesCss, LANG('loading'));\r\n\r\n    const content = c(',flex,flexCol,gap-10', [\r\n        libraries,\r\n        fonts,\r\n    ]);\r\n\r\n    new DynamicModal({\r\n        title: BB.el({\r\n            content: LANG('licenses'),\r\n        }),\r\n        content: BB.el({\r\n            content,\r\n            css: {\r\n                height: '100%',\r\n                overflowY: 'auto',\r\n                padding: '10px',\r\n                boxSizing: 'border-box',\r\n            },\r\n        }),\r\n        width: 800,\r\n        isMaxHeight: true,\r\n    });\r\n\r\n    import('./licenses').then(result => {\r\n        libraries.innerHTML = '';\r\n        result.licenses.forEach(item => {\r\n            libraries.append(c('details', [\r\n                c('summary', item.title),\r\n                c('', item.full.replace(/\\n/g, '<br>')),\r\n            ]));\r\n        });\r\n    });\r\n\r\n    import('../../../../../fonts/font-licenses').then(result => {\r\n        fonts.innerHTML = '';\r\n        result.fontLicenses.forEach(item => {\r\n            fonts.append(c('details', [\r\n                c('summary', 'Font: ' + item.title),\r\n                c('', item.full.replace(/\\n/g, '<br>')),\r\n            ]));\r\n        });\r\n    });\r\n}","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"62mlz\"))).then(() => parcelRequire('17YSH'));","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"76QQo\"))).then(() => parcelRequire('evhrb'));","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n\r\n/**\r\n * Scroll buttons at the top and bottom of toolspace\r\n * Show up when window is very small.\r\n * Allow user to scroll up and down toolspace.\r\n */\r\nexport class ToolspaceScroller {\r\n\r\n    private readonly toolspace: HTMLElement;\r\n    private readonly upBtn: HTMLElement;\r\n    private readonly downBtn: HTMLElement;\r\n    private downInterval: any;\r\n    private upInterval: any;\r\n\r\n    private update (): void {\r\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) { // small buffer where it's not worth it\r\n            if (!this.upInterval) {\r\n                this.upBtn.style.display = this.toolspace.scrollTop === 0 ? 'none' : 'block';\r\n            }\r\n            if (!this.downInterval) {\r\n                this.downBtn.style.display = (\r\n                    this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ?\r\n                        'none' : 'block'\r\n                );\r\n            }\r\n        } else {\r\n            this.upBtn.style.display = 'none';\r\n            this.downBtn.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (p: {toolspace: HTMLElement; uiState: 'left' | 'right'}) {\r\n        this.toolspace = p.toolspace;\r\n        this.upBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                top: '0',\r\n                transform: 'rotate(180deg)',\r\n            },\r\n        });\r\n        this.downBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                bottom: '0',\r\n            },\r\n        });\r\n        this.updateUiState(p.uiState);\r\n\r\n        const upListener = new BB.PointerListener({\r\n            target: this.upBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.upInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, -13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.upInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.upInterval = null;\r\n                        this.update();\r\n                    }, 50);\r\n                }\r\n            },\r\n        });\r\n        const downListener = new BB.PointerListener({\r\n            target: this.downBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.downInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, 13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.downInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.downInterval = null;\r\n                        this.update();\r\n                    }, 50);\r\n                }\r\n            },\r\n        });\r\n\r\n        const wheelListener = (e: WheelEvent) => {\r\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\r\n            this.update();\r\n        };\r\n        this.upBtn.addEventListener('wheel', wheelListener);\r\n        this.downBtn.addEventListener('wheel', wheelListener);\r\n\r\n        this.update();\r\n\r\n        const observer = new MutationObserver(() => this.update());\r\n        observer.observe(\r\n            this.toolspace,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n        window.addEventListener('resize', () => this.update());\r\n\r\n        // hide if in dialog because that can have its own scrollbar\r\n        dialogCounter.subscribe((v) => {\r\n            // ignores the 0.5 by tool dropdown\r\n            this.upBtn.style.opacity = v >= 1 ? '0' : '';\r\n            this.downBtn.style.opacity = v >= 1 ? '0' : '';\r\n        });\r\n    }\r\n\r\n    updateUiState (uiState: 'left' | 'right'): void {\r\n        BB.css(this.upBtn, {\r\n            left: uiState === 'left' ? '0' : '',\r\n            right: uiState === 'right' ? '0' : '',\r\n        });\r\n        BB.css(this.downBtn, {\r\n            left: uiState === 'left' ? '0' : '',\r\n            right: uiState === 'right' ? '0' : '',\r\n        });\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KlSlider} from '../components/kl-slider';\r\nimport {LANG} from '../../../language/language';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {Options} from '../components/options';\r\nimport {TGradientType} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n\r\ninterface IGradientUiSettings {\r\n    opacity: number;\r\n    type: TGradientType;\r\n    doLockAlpha: boolean;\r\n    doSnap: boolean;\r\n    isReversed: boolean;\r\n    isEraser: boolean;\r\n}\r\n\r\n/**\r\n * Gradient Tool tab contents\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport class GradientUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private colorDiv: HTMLElement;\r\n    private colorSlider: KlColorSlider;\r\n    private isVisible: boolean;\r\n    private readonly iconArr: HTMLElement[];\r\n\r\n    private settings: IGradientUiSettings = {\r\n        opacity: 1,\r\n        type: 'linear',\r\n        doLockAlpha: false,\r\n        doSnap: false,\r\n        isReversed: false,\r\n        isEraser: false,\r\n    };\r\n\r\n    private updateIcons (): void {\r\n        const col1 = this.settings.isReversed ? '#0000' : '#000';\r\n        const col2 = this.settings.isReversed ? '#000' : '#0000';\r\n        this.iconArr[0].style.background = `linear-gradient(${col1}, ${col2})`;\r\n        this.iconArr[1].style.background = `linear-gradient(${col2}, ${col1}, ${col2})`;\r\n        this.iconArr[2].style.background = `radial-gradient(${col1}, ${col2})`;\r\n    }\r\n\r\n    // ----- public -------\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.colorSlider = p.colorSlider;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.isVisible = true;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        this.iconArr = [];\r\n        {\r\n            const size = 33;\r\n            [0, 1, 2].forEach(() => {\r\n                const el = BB.el({\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        width: size + 'px',\r\n                        height: size + 'px',\r\n                        borderRadius: '3px',\r\n                        margin: '1px',\r\n                    },\r\n                });\r\n                this.iconArr.push(el);\r\n            });\r\n        }\r\n        this.updateIcons();\r\n\r\n        const typeOptions = new Options<TGradientType>({\r\n            optionArr: [\r\n                {\r\n                    id: 'linear',\r\n                    label: this.iconArr[0],\r\n                    title: LANG('gradient-linear'),\r\n                },\r\n                {\r\n                    id: 'linear-mirror',\r\n                    label: this.iconArr[1],\r\n                    title: LANG('gradient-linear-mirror'),\r\n                },\r\n                {\r\n                    id: 'radial',\r\n                    label: this.iconArr[2],\r\n                    title: LANG('gradient-radial'),\r\n                },\r\n            ],\r\n            initId: 'linear',\r\n            onChange: (id) => {\r\n                this.settings.type = id;\r\n            },\r\n        });\r\n        this.rootEl.append(typeOptions.getElement());\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: this.settings.opacity,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n            onChange: (val) => {\r\n                this.settings.opacity = val;\r\n            },\r\n        });\r\n        BB.css(opacitySlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(opacitySlider.getElement());\r\n\r\n\r\n\r\n        const row1 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const reverseToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('reverse'),\r\n            callback: (b) => {\r\n                this.settings.isReversed = b;\r\n                this.updateIcons();\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        const doSnapToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('angle-snap'),\r\n            title: LANG('angle-snap-title'),\r\n            callback: (b) => {\r\n                this.settings.doSnap = b;\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        row1.append(\r\n            reverseToggle.getElement(),\r\n            doSnapToggle.getElement(),\r\n        );\r\n\r\n\r\n        const row2 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const eraserToggle = new Checkbox({\r\n            init: this.settings.isEraser,\r\n            label: LANG('eraser'),\r\n            callback: (b) => {\r\n                this.settings.isEraser = b;\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('lock-alpha'),\r\n            title: LANG('lock-alpha-title'),\r\n            callback: (b) => {\r\n                this.settings.doLockAlpha = b;\r\n            },\r\n            doHighlight: true,\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        row2.append(\r\n            eraserToggle.getElement(),\r\n            lockAlphaToggle.getElement(),\r\n        );\r\n\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (isVisible: boolean): void {\r\n        this.isVisible = !!isVisible;\r\n        this.rootEl.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\r\n        }\r\n    }\r\n\r\n    getSettings (): IGradientUiSettings {\r\n        return BB.copyObj(this.settings);\r\n    }\r\n\r\n}","import {BB} from '../bb/bb';\r\nimport uiSwapImg from '/src/app/img/ui/ui-swap-lr.svg';\r\nimport helpImg from '/src/app/img/ui/help.svg';\r\nimport {LANG} from '../language/language';\r\nimport {PointerListener} from '../bb/input/pointer-listener';\r\n\r\n/**\r\n * Topmost row of buttons in toolspace. (embed)\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport class EmbedToolspaceTopRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (p: {onSubmit: () => void; onLeftRight: () => void; onHelp: () => void}) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-toolspace-row',\r\n            css: {\r\n                height: '36px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        function createButton (p: {\r\n            title: string;\r\n            content?: HTMLElement;\r\n            image?: string;\r\n            onClick: () => void;\r\n            extraPadding?: number;\r\n            contain: boolean;\r\n        }): {\r\n            el: HTMLElement;\r\n            pointerListener: PointerListener;\r\n        } {\r\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n            const el = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.content ? '' : (p.contain ? padding + 'px 0' : ''),\r\n                },\r\n            });\r\n            if (p.content) {\r\n                el.append(p.content);\r\n            } else {\r\n                const im = BB.el({\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                        backgroundRepeat: 'no-repeat',\r\n                        backgroundPosition: 'center',\r\n                        backgroundSize: p.contain ? 'contain' : '',\r\n                        //filter: 'grayscale(1)',\r\n                        height: '100%',\r\n                    },\r\n                });\r\n                im.style.pointerEvents = 'none';\r\n                el.append(im);\r\n            }\r\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: el,\r\n                onEnterLeave: function (isOver): void {\r\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\r\n                },\r\n            });\r\n\r\n            return {\r\n                el,\r\n                pointerListener,\r\n            };\r\n        }\r\n\r\n        const submitButton = createButton({\r\n            onClick: p.onSubmit,\r\n            title: LANG('submit-title'),\r\n            content: BB.el({\r\n                content: LANG('submit'),\r\n                className: 'toolspace-row-button__submit',\r\n                css: {\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    width: '100%',\r\n                    height: '100%',\r\n                },\r\n            }),\r\n            contain: true,\r\n        });\r\n        submitButton.el.style.width = '45px';\r\n\r\n        const helpButton = createButton({\r\n            onClick: p.onHelp,\r\n            title: LANG('help'),\r\n            image: helpImg,\r\n            contain: true,\r\n        });\r\n\r\n        const leftRightButton = createButton({\r\n            onClick: p.onLeftRight,\r\n            title: LANG('switch-ui-left-right'),\r\n            image: uiSwapImg,\r\n            contain: true,\r\n        });\r\n\r\n        this.rootEl.append(submitButton.el, leftRightButton.el, helpButton.el);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n","import {filterLib, filterLibStatus} from './filters';\r\nimport {filterBrightnessContrast} from './filter-brightness-contrast';\r\nimport {filterCropExtend} from './filter-crop-extend';\r\nimport {filterCurves} from './filter-curves';\r\nimport {filterFlip} from './filter-flip';\r\nimport {filterHueSaturation} from './filter-hue-saturation';\r\nimport {filterInvert} from './filter-invert';\r\nimport {filterPerspective} from './filter-perspective';\r\nimport {filterResize} from './filter-resize';\r\nimport {filterRotate} from './filter-rotate';\r\nimport {filterTiltShift} from './filter-tilt-shift';\r\nimport {filterTransform} from './filter-transform';\r\nimport {filterBlur} from './filter-blur';\r\nimport {filterUnsharpMask} from './filter-unsharp-mask';\r\nimport {filterToAlpha} from './filter-to-alpha';\r\nimport {filterGrid} from './filter-grid';\r\nimport {filterNoise} from './filter-noise';\r\nimport {filterPattern} from './filter-pattern';\r\nimport {filterDistort} from './filter-distort';\r\nimport {filterVanishPoint} from './filter-vanish-point';\r\nimport {IFilter} from '../kl-types';\r\n\r\ntype TModuleFilter = Pick<IFilter, 'getDialog' | 'apply'>;\r\n\r\nfunction importFilter (libObj: IFilter, moduleObj: TModuleFilter): void {\r\n    if (moduleObj.getDialog) {\r\n        libObj.getDialog = moduleObj.getDialog;\r\n    }\r\n    libObj.apply = moduleObj.apply;\r\n}\r\n\r\n\r\nexport function importFilters (): void {\r\n    if (filterLibStatus.isLoaded) {\r\n        return;\r\n    }\r\n    importFilter(filterLib.brightnessContrast, filterBrightnessContrast as TModuleFilter);\r\n    importFilter(filterLib.cropExtend, filterCropExtend as TModuleFilter);\r\n    importFilter(filterLib.curves, filterCurves as TModuleFilter);\r\n    importFilter(filterLib.flip, filterFlip as TModuleFilter);\r\n    importFilter(filterLib.hueSaturation, filterHueSaturation as TModuleFilter);\r\n    importFilter(filterLib.invert, filterInvert as TModuleFilter);\r\n    importFilter(filterLib.perspective, filterPerspective as TModuleFilter);\r\n    importFilter(filterLib.resize, filterResize as TModuleFilter);\r\n    importFilter(filterLib.rotate, filterRotate as TModuleFilter);\r\n    importFilter(filterLib.tiltShift, filterTiltShift as TModuleFilter);\r\n    importFilter(filterLib.transform, filterTransform as TModuleFilter);\r\n    importFilter(filterLib.blur, filterBlur as TModuleFilter);\r\n    importFilter(filterLib.unsharpMask, filterUnsharpMask as TModuleFilter);\r\n    importFilter(filterLib.toAlpha, filterToAlpha as TModuleFilter);\r\n    importFilter(filterLib.grid, filterGrid as TModuleFilter);\r\n    importFilter(filterLib.noise, filterNoise as TModuleFilter);\r\n    importFilter(filterLib.pattern, filterPattern as TModuleFilter);\r\n    importFilter(filterLib.distort, filterDistort as TModuleFilter);\r\n    importFilter(filterLib.vanishPoint, filterVanishPoint as TModuleFilter);\r\n\r\n    filterLibStatus.isLoaded = true;\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterBrightnessContrastInput = {\r\n    brightness: number;\r\n    contrast: number;\r\n}\r\n\r\nexport type TFilterBrightnessContrastHistoryEntry = TFilterHistoryEntry<\r\n    'brightnessContrast',\r\n    TFilterBrightnessContrastInput>;\r\n\r\nexport const filterBrightnessContrast = {\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterBrightnessContrastInput> = {\r\n            element: div,\r\n        };\r\n\r\n\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n\r\n        function finishInit (): void {\r\n\r\n            let brightness = 0, contrast = 0;\r\n            div.innerHTML = LANG('filter-bright-contrast-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const brightnessSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-brightness'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (brightness + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brightness = val / 50 - 1;\r\n                    fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            const contrastSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-contrast'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (contrast + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    contrast = val / 50 - 1;\r\n                    fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            brightnessSlider.getElement().style.marginBottom = '10px';\r\n            div.append(brightnessSlider.getElement(), contrastSlider.getElement());\r\n\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        isVisible: layers[i].isVisible,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                brightnessSlider.destroy();\r\n                contrastSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterBrightnessContrastInput {\r\n                result.destroy!();\r\n                return {\r\n                    brightness: brightness,\r\n                    contrast: contrast,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterBrightnessContrastInput>): boolean {\r\n        const context = params.context;\r\n        const brightness = params.input.brightness;\r\n        const contrast = params.input.contrast;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'brightnessContrast'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterBrightnessContrastHistoryEntry);\r\n\r\n        return true;\r\n    },\r\n};","\r\nexport const eventResMs = 60;","import {BB} from '../../bb/bb';\r\nimport {input} from '../ui/components/input';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {Cropper} from '../ui/components/cropper';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IRGBA} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {theme} from '../../theme/theme';\r\nimport {IRect} from '../../bb/bb-types';\r\n\r\nexport type TFilterCropExtendInput = {\r\n    left: number;\r\n    right: number;\r\n    top: number;\r\n    bottom: number;\r\n    fillColor?: IRGBA;\r\n};\r\n\r\nexport type TFilterCropExtendHistoryEntry = TFilterHistoryEntry<\r\n    'cropExtend',\r\n    TFilterCropExtendInput>;\r\n\r\nexport const filterCropExtend = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const klCanvas = params.klCanvas;\r\n        if (!klCanvas) {\r\n            return false;\r\n        }\r\n        const tempCanvas = BB.canvas();\r\n        {\r\n            const fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 560, 400, 1);\r\n            const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n            const previewFactor = w / klCanvas.getWidth();\r\n            tempCanvas.width = w;\r\n            tempCanvas.height = h;\r\n            tempCanvas.style.display = 'block';\r\n            BB.ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n        }\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterCropExtendInput> = {\r\n            element: div,\r\n        };\r\n        div.innerHTML = LANG('filter-crop-description') + '<br/><br/>';\r\n        let left = 0, right = 0, top = 0, bottom = 0;\r\n        let leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\r\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n        let scale: number = 1;\r\n\r\n\r\n\r\n        // --- input elements ---\r\n\r\n        const lrWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'},\r\n        });\r\n        const tbWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'},\r\n        });\r\n        div.append(lrWrapper, tbWrapper);\r\n\r\n        const leftInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function () {\r\n                leftChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n        const rightInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px'},\r\n            callback: function () {\r\n                rightChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n        const topInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function () {\r\n                topChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n        const bottomInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px'},\r\n            callback: function () {\r\n                bottomChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            width: '60px',\r\n        };\r\n        lrWrapper.append(\r\n            BB.el({content: LANG('filter-crop-left') + ':', css: labelStyle}),\r\n            leftInput,\r\n            BB.el({content: LANG('filter-crop-right') + ':', css: labelStyle}),\r\n            rightInput\r\n        );\r\n        tbWrapper.append(\r\n            BB.el({content: LANG('filter-crop-top') + ':', css: labelStyle}),\r\n            topInput,\r\n            BB.el({content: LANG('filter-crop-bottom') + ':', css: labelStyle}),\r\n            bottomInput\r\n        );\r\n\r\n        function updateInput (): void {\r\n            left = parseInt(leftInput.value);\r\n            right = parseInt(rightInput.value);\r\n            top = parseInt(topInput.value);\r\n            bottom = parseInt(bottomInput.value);\r\n            let newWidth = klCanvas.getWidth() + left + right;\r\n            let newHeight = klCanvas.getHeight() + top + bottom;\r\n\r\n            if (newWidth <= 0) {\r\n                if (leftChanged) {\r\n                    left = -klCanvas.getWidth() - right + 1;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -klCanvas.getWidth() - left + 1;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = 1;\r\n            }\r\n            if (newWidth > maxWidth) {\r\n                if (leftChanged) {\r\n                    left = -klCanvas.getWidth() - right + maxWidth;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -klCanvas.getWidth() - left + maxWidth;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = maxWidth;\r\n            }\r\n            if (newHeight <= 0) {\r\n                if (topChanged) {\r\n                    top = -klCanvas.getHeight() - bottom + 1;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -klCanvas.getHeight() - top + 1;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = 1;\r\n            }\r\n            if (newHeight > maxHeight) {\r\n                if (topChanged) {\r\n                    top = -klCanvas.getHeight() - bottom + maxHeight;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -klCanvas.getHeight() - top + maxHeight;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = maxHeight;\r\n            }\r\n            cropper.setTransform({\r\n                x: -left,\r\n                y: -top,\r\n                width: newWidth,\r\n                height: newHeight,\r\n            });\r\n\r\n\r\n            leftChanged = false;\r\n            rightChanged = false;\r\n            topChanged = false;\r\n            bottomChanged = false;\r\n        }\r\n\r\n        let useRuleOfThirds = true;\r\n        const ruleOThirdsCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-crop-rule-thirds'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                useRuleOfThirds = b;\r\n                cropper.showThirds(useRuleOfThirds);\r\n            },\r\n        });\r\n        div.append(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n            },\r\n        }));\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 0};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 0},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('filter-crop-fill'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function (rgbaObj) {\r\n                selectedRgbaObj = rgbaObj!;\r\n                updateBg();\r\n            },\r\n        });\r\n\r\n\r\n        const flexRow = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n        div.append(flexRow);\r\n        flexRow.append(ruleOThirdsCheckbox.getElement(), colorOptions.getElement());\r\n\r\n\r\n        // when input field changed, or dragging in preview finished\r\n        // adjusts the zoom\r\n        function update (transform: IRect): void {\r\n            const fit = BB.fitInto(transform.width, transform.height, 260, 180, 1);\r\n            scale = fit.width / transform.width;\r\n\r\n            const offset = BB.centerWithin(340, previewHeight, fit.width, fit.height);\r\n\r\n            tempCanvas.style.width = klCanvas.getWidth() * scale + 'px';\r\n            tempCanvas.style.height = klCanvas.getHeight() * scale + 'px';\r\n\r\n            offsetWrapper.style.left = (offset.x - transform.x * scale) + 'px';\r\n            offsetWrapper.style.top = (offset.y - transform.y * scale) + 'px';\r\n\r\n            left = parseInt('' + -transform.x);\r\n            top = parseInt('' + -transform.y);\r\n            right = parseInt('' + (transform.x + transform.width - klCanvas.getWidth()));\r\n            bottom = parseInt('' + (transform.y + transform.height - klCanvas.getHeight()));\r\n            leftInput.value = '' + left;\r\n            topInput.value = '' + top;\r\n            rightInput.value = '' + right;\r\n            bottomInput.value = '' + bottom;\r\n\r\n            BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                previewWrapper.style.background = 'url(' + url + ')';\r\n                if (selectedRgbaObj.a !== 0) {\r\n                    tempCanvas.style.background = 'url(' + url + ')';\r\n                }\r\n            }, theme.isDark());\r\n            previewWrapper.style.backgroundPosition = (offset.x) + 'px ' + (offset.y) + 'px';\r\n\r\n            cropper.setScale(scale);\r\n        }\r\n\r\n        const previewHeight = 218; // two less because of border\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-edit-crop-preview',\r\n            css: {\r\n                width: '340px',\r\n                marginTop: '10px',\r\n                marginLeft: '-20px',\r\n                height: previewHeight + 'px',\r\n                backgroundColor: '#9e9e9e',\r\n                position: 'relative',\r\n                borderTop: '1px solid rgb(144,144,144)',\r\n                borderBottom: '1px solid rgb(144,144,144)',\r\n                overflow: 'hidden',\r\n                userSelect: 'none',\r\n                touchAction: 'none',\r\n            },\r\n        });\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        const bgColorOverlay = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0',\r\n            },\r\n        });\r\n        previewWrapper.append(bgColorOverlay);\r\n\r\n        const offsetWrapper = document.createElement('div');\r\n        offsetWrapper.style.position = 'absolute';\r\n        offsetWrapper.style.left = '0px';\r\n        offsetWrapper.style.top = '0px';\r\n        previewWrapper.append(offsetWrapper);\r\n\r\n        BB.el({\r\n            parent: offsetWrapper,\r\n            content: tempCanvas,\r\n            css: {\r\n                boxShadow: '0 0 0px 1px rgb(130,130,130)',\r\n                position: 'absolute',\r\n                left: '0px',\r\n                top: '0px',\r\n            },\r\n        });\r\n\r\n\r\n        div.append(previewWrapper);\r\n        const cropper = new Cropper({\r\n            x: 0,\r\n            y: 0,\r\n            width: klCanvas.getWidth(),\r\n            height: klCanvas.getHeight(),\r\n            scale: scale,\r\n            callback: update,\r\n            maxW: maxWidth,\r\n            maxH: maxHeight,\r\n        });\r\n        update(cropper.getTransform());\r\n        offsetWrapper.append(cropper.getElement());\r\n\r\n        function updateBg (): void {\r\n            if (selectedRgbaObj.a === 0) {\r\n                bgColorOverlay.style.background = '';\r\n                tempCanvas.style.background = '';\r\n            } else {\r\n                bgColorOverlay.style.background = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n\r\n                BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                    tempCanvas.style.background = 'url(' + url + ')';\r\n                }, theme.isDark());\r\n            }\r\n        }\r\n\r\n        function updateIsDark (): void {\r\n            updateInput();\r\n        }\r\n        theme.addIsDarkListener(updateIsDark);\r\n\r\n        result.destroy = (): void => {\r\n            cropper.destroy();\r\n            ruleOThirdsCheckbox.destroy();\r\n            theme.removeIsDarkListener(updateIsDark);\r\n            colorOptions.destroy();\r\n        };\r\n        result.getInput = function (): TFilterCropExtendInput {\r\n            result.destroy!();\r\n            return {\r\n                left: left,\r\n                right: right,\r\n                top: top,\r\n                bottom: bottom,\r\n                fillColor: selectedRgbaObj.a === 0 ? undefined : selectedRgbaObj,\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterCropExtendInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (\r\n            !klCanvas ||\r\n            !history ||\r\n            isNaN(params.input.left) ||\r\n            isNaN(params.input.right) ||\r\n            isNaN(params.input.top) ||\r\n            isNaN(params.input.bottom)\r\n        ) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.resizeCanvas(params.input);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'cropExtend'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: BB.copyObj(params.input),\r\n            }],\r\n        } as TFilterCropExtendHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {CurvesInput, getDefaultCurvesInput, TCurvesInput} from './filter-curves/curves-input';\r\nimport {Options} from '../ui/components/options';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterCurvesInput = {\r\n    curves: TCurvesInput;\r\n};\r\n\r\nexport type TFilterCurvesHistoryEntry = TFilterHistoryEntry<\r\n    'curves',\r\n    TFilterCurvesInput>;\r\n\r\nexport const filterCurves = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        const div = BB.el();\r\n        const result: IFilterGetDialogResult<TFilterCurvesInput> = {\r\n            element: div,\r\n        };\r\n        let klCanvasPreview: KlCanvasPreview;\r\n\r\n        function finishInit (): void {\r\n\r\n            div.innerHTML = LANG('filter-curves-description') + '<br/><br/>';\r\n\r\n            let curves: TCurvesInput = getDefaultCurvesInput();\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (fxCanvas === null) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            function update (): void {\r\n                try {\r\n                    fxCanvas!.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n                    if (klCanvasPreview) {\r\n                        klCanvasPreview.render();\r\n                    }\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            const input = new CurvesInput({\r\n                curves,\r\n                callback: function (val) {\r\n                    curves = val;\r\n                    update();\r\n                },\r\n            });\r\n            const modeButtons: Options<string> = input.getModeButtons();\r\n\r\n\r\n            div.append(input.getElement());\r\n\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        isVisible: layers[i].isVisible,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            result.destroy = (): void => {\r\n                input.destroy();\r\n                texture.destroy();\r\n                modeButtons.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterCurvesInput {\r\n                result.destroy!();\r\n                return {\r\n                    curves: curves,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterCurvesInput>): boolean {\r\n        const context = params.context;\r\n        const curves = params.input.curves;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'curves'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterCurvesHistoryEntry);\r\n\r\n        return true;\r\n    },\r\n\r\n\r\n};","import {Options} from '../../ui/components/options';\r\nimport {LANG} from '../../../language/language';\r\nimport {BB} from '../../../bb/bb';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\ntype TCurvePoint = {\r\n    el: HTMLElement;\r\n    pointerListener: PointerListener;\r\n    setPos: (newX: number, newY: number) => void;\r\n};\r\n\r\nexport type TCurvesInput = {\r\n    r: [number, number][];\r\n    g: [number, number][];\r\n    b: [number, number][];\r\n}\r\n\r\nexport function getDefaultCurvesInput (): TCurvesInput {\r\n    return BB.copyObj({\r\n        r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n        g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n        b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n    });\r\n}\r\n\r\nexport class CurvesInput {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly p0: TCurvePoint;\r\n    private readonly p1: TCurvePoint;\r\n    private readonly p2: TCurvePoint;\r\n    private readonly p3: TCurvePoint;\r\n    private readonly modeButtons: Options<string>;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            curves: TCurvesInput;\r\n            callback: (val: TCurvesInput) => void;\r\n        },\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = () => false;\r\n        let mode = 'All';\r\n        let curves = p.curves;\r\n        this.modeButtons = new Options( {\r\n            optionArr: [\r\n                {\r\n                    id: 'All',\r\n                    label: LANG('filter-curves-all'),\r\n                },\r\n                {\r\n                    id: 'Red',\r\n                    label: LANG('red'),\r\n                },\r\n                {\r\n                    id: 'Green',\r\n                    label: LANG('green'),\r\n                },\r\n                {\r\n                    id: 'Blue',\r\n                    label: LANG('blue'),\r\n                },\r\n            ],\r\n            initId: 'All',\r\n            onChange: (id) => {\r\n                mode = id;\r\n                if (mode === 'All') {\r\n                    curves = getDefaultCurvesInput();\r\n                }\r\n                let curve = curves.r;\r\n                if (mode === 'Green') {\r\n                    curve = curves.g;\r\n                }\r\n                if (mode === 'Blue') {\r\n                    curve = curves.b;\r\n                }\r\n                this.p0.setPos(0, areaH - curve[0][1] * areaH);\r\n                this.p1.setPos(curve[1][0] * areaW, areaH - curve[1][1] * areaH);\r\n                this.p2.setPos(curve[2][0] * areaW, areaH - curve[2][1] * areaH);\r\n                this.p3.setPos(areaW, areaH - curve[3][1] * areaH);\r\n\r\n                update();\r\n            },\r\n        });\r\n        this.rootEl.append(this.modeButtons.getElement());\r\n\r\n        const curveArea = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-curves-graph',\r\n            css: {\r\n                position: 'relative',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const areaW = 300, areaH = 100;\r\n        const canvas = BB.canvas(areaW, areaH);\r\n        let ctx = BB.ctx(canvas);\r\n        curveArea.append(canvas);\r\n\r\n        const fit = (v: number): number => {\r\n            return Math.max(0, Math.min(1, v));\r\n        };\r\n\r\n        const createPoint = (\r\n            x: number,\r\n            y: number,\r\n            callback: (p: IVector2D) => void,\r\n            lock?: boolean,\r\n        ): TCurvePoint => {\r\n            const gripSize = 14;\r\n            let internalY = y, internalX = x;\r\n            const pointEl = BB.el({\r\n                className: 'kl-curves-graph__grip',\r\n                css: {\r\n                    left: (x - gripSize / 2) + 'px',\r\n                    top: (y - gripSize / 2) + 'px',\r\n                    width: gripSize + 'px',\r\n                    height: gripSize + 'px',\r\n                    borderRadius: gripSize + 'px',\r\n                },\r\n            });\r\n\r\n            const update = () => {\r\n                BB.css(pointEl, {\r\n                    left: (x - gripSize / 2) + 'px',\r\n                    top: (y - gripSize / 2) + 'px',\r\n                });\r\n            };\r\n\r\n            const pointerListener = new BB.PointerListener({\r\n                target: pointEl,\r\n                onPointer: (event) => {\r\n                    event.eventPreventDefault();\r\n                    if (event.type === 'pointerdown') {\r\n                        internalX = x;\r\n                        internalY = y;\r\n                    }\r\n                    if (event.button === 'left' && event.type === 'pointermove') {\r\n                        if (!lock) {\r\n                            internalX += event.dX;\r\n                        }\r\n                        x = Math.max(0, Math.min(areaW, internalX));\r\n                        internalY += event.dY;\r\n                        y = Math.max(0, Math.min(areaH, internalY));\r\n                        update();\r\n                        callback({\r\n                            x: x,\r\n                            y: y,\r\n                        });\r\n                    }\r\n                },\r\n            });\r\n\r\n            curveArea.append(pointEl);\r\n\r\n            const setPos = (newX: number, newY: number): void => {\r\n                x = newX;\r\n                y = newY;\r\n                internalY = y;\r\n                internalX = x;\r\n                BB.css(pointEl, {\r\n                    left: (x - gripSize / 2) + 'px',\r\n                    top: (y - gripSize / 2) + 'px',\r\n                });\r\n            };\r\n\r\n            return {\r\n                el: pointEl,\r\n                setPos,\r\n                pointerListener,\r\n            };\r\n        };\r\n\r\n        const updateControl = (i: number, x: number, y: number) => {\r\n            if (mode === 'All') {\r\n                curves.r[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n                curves.g[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n                curves.b[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n            if (mode === 'Red') {\r\n                curves.r[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n            if (mode === 'Green') {\r\n                curves.g[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n            if (mode === 'Blue') {\r\n                curves.b[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n        };\r\n\r\n        this.p0 = createPoint(0, areaH, (val: IVector2D) => {\r\n            updateControl(0, val.x, val.y);\r\n            update();\r\n        }, true);\r\n        this.p1 = createPoint(areaW / 3, areaH / 3 * 2, (val: IVector2D) => {\r\n            updateControl(1, val.x, val.y);\r\n            update();\r\n        });\r\n        this.p2 = createPoint(areaW / 3 * 2, areaH / 3, (val: IVector2D) => {\r\n            updateControl(2, val.x, val.y);\r\n            update();\r\n        });\r\n        this.p3 = createPoint(areaW, 0, (val: IVector2D) => {\r\n            updateControl(3, val.x, val.y);\r\n            update();\r\n        }, true);\r\n\r\n\r\n        const update = () => {\r\n            ctx = BB.ctx(canvas);\r\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n            const outCurves: TCurvesInput = {\r\n                r: [],\r\n                g: [],\r\n                b: [],\r\n            };\r\n            for (let i = 0; i < curves.r.length; i++) {\r\n                outCurves.r.push(curves.r[i]);\r\n                outCurves.g.push(curves.g[i]);\r\n                outCurves.b.push(curves.b[i]);\r\n            }\r\n\r\n            const drawCurve = (curve: [number, number][]) => {\r\n                ctx.beginPath();\r\n                const spline = new BB.SplineInterpolator(curve);\r\n                for (let i = 0; i < 100; i++) {\r\n                    let y = spline.interpolate(i / 100);\r\n                    y = Math.max(0, Math.min(1, y));\r\n\r\n                    if (i === 0) {\r\n                        ctx.moveTo(i / 100 * areaW, areaH - y * areaH);\r\n                    } else {\r\n                        ctx.lineTo(i / 100 * areaW, areaH - y * areaH);\r\n                    }\r\n                }\r\n                ctx.stroke();\r\n            };\r\n\r\n            ctx.save();\r\n            if (mode === 'All') {\r\n                ctx.strokeStyle = 'black';\r\n                drawCurve(outCurves.r);\r\n            } else {\r\n                ctx.globalAlpha = 0.5;\r\n                ctx.strokeStyle = 'red';\r\n                drawCurve(outCurves.r);\r\n                ctx.strokeStyle = 'green';\r\n                drawCurve(outCurves.g);\r\n                ctx.strokeStyle = 'blue';\r\n                drawCurve(outCurves.b);\r\n            }\r\n            ctx.restore();\r\n            p.callback(outCurves);\r\n        };\r\n\r\n        update();\r\n    }\r\n\r\n    // ---- interface ----\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.p0.pointerListener.destroy();\r\n        this.p1.pointerListener.destroy();\r\n        this.p2.pointerListener.destroy();\r\n        this.p3.pointerListener.destroy();\r\n    }\r\n\r\n    getModeButtons (): Options<string> {\r\n        return this.modeButtons;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {throwIfNull} from '../../bb/base/base';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {Options} from '../ui/components/options';\r\n\r\nexport type TFilterFlipInput = {\r\n    horizontal: boolean;\r\n    vertical: boolean;\r\n    flipCanvas: boolean;\r\n};\r\n\r\nexport type TFilterFlipHistoryEntry = TFilterHistoryEntry<\r\n    'flip',\r\n    TFilterFlipInput>;\r\n\r\nexport const filterFlip = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterFlipInput> = {\r\n            element: div,\r\n        };\r\n        let isHorizontal = true;\r\n        let isVertical = false;\r\n        let doFlipCanvas = true;\r\n        div.innerHTML = LANG('filter-flip-description') + '<br/><br/>';\r\n\r\n\r\n        const horizontalCheckbox = new Checkbox({\r\n            init: isHorizontal,\r\n            label: LANG('filter-flip-horizontal') + ' ',\r\n            allowTab: true,\r\n            callback: function (v) {\r\n                isHorizontal = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        const verticalCheckbox = new Checkbox({\r\n            init: isVertical,\r\n            label: LANG('filter-flip-vertical') + ' ',\r\n            allowTab: true,\r\n            callback: function (v) {\r\n                isVertical = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        div.append(horizontalCheckbox.getElement());\r\n        div.append(verticalCheckbox.getElement());\r\n\r\n        const targetOptions = new Options<boolean>({\r\n            optionArr: [\r\n                {\r\n                    id: true,\r\n                    label: LANG('filter-flip-image'),\r\n                },\r\n                {\r\n                    id: false,\r\n                    label: LANG('filter-flip-layer'),\r\n                },\r\n            ],\r\n            onChange: (val) => {\r\n                doFlipCanvas = val;\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        div.append(targetOptions.getElement());\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(Math.round(w), Math.round(h)),\r\n            isVisible: true,\r\n            opacity: 1,\r\n            mixModeStr: 'source-over' as TMixMode,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: [previewLayer],\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\r\n\r\n            if (doFlipCanvas) {\r\n                if (isHorizontal) {\r\n                    ctx.translate(previewLayer.image.width, 0);\r\n                    ctx.scale(-1, 1);\r\n                }\r\n                if (isVertical) {\r\n                    ctx.translate(0, previewLayer.image.height);\r\n                    ctx.scale(1, -1);\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < layers.length; i++) {\r\n                if (!layers[i].isVisible) {\r\n                    continue;\r\n                }\r\n\r\n                ctx.save();\r\n                if (!doFlipCanvas && selectedLayerIndex === i) {\r\n                    if (isHorizontal) {\r\n                        ctx.translate(previewLayer.image.width, 0);\r\n                        ctx.scale(-1, 1);\r\n                    }\r\n                    if (isVertical) {\r\n                        ctx.translate(0, previewLayer.image.height);\r\n                        ctx.scale(1, -1);\r\n                    }\r\n                }\r\n                if (ctx.canvas.width > layers[i].context.canvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.globalAlpha = layers[i].opacity;\r\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\r\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\r\n                ctx.restore();\r\n            }\r\n            klCanvasPreview.render();\r\n            ctx.restore();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            horizontalCheckbox.destroy();\r\n            verticalCheckbox.destroy();\r\n            targetOptions.destroy();\r\n            klCanvasPreview.destroy();\r\n        };\r\n        result.getInput = function (): TFilterFlipInput {\r\n            result.destroy!();\r\n            return {\r\n                horizontal: isHorizontal,\r\n                vertical: isVertical,\r\n                flipCanvas: doFlipCanvas,\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterFlipInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        const horizontal = params.input.horizontal;\r\n        const vertical = params.input.vertical;\r\n        const flipCanvas = params.input.flipCanvas;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        klCanvas.flip(\r\n            horizontal,\r\n            vertical,\r\n            flipCanvas ? undefined : throwIfNull(klCanvas.getLayerIndex(context.canvas)),\r\n        );\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['filter', 'flip'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterFlipHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterHueSaturationInput = {\r\n    hue: number;\r\n    saturation: number;\r\n};\r\n\r\nexport type TFilterHueSaturationHistoryEntry = TFilterHistoryEntry<\r\n    'hueSaturation',\r\n    TFilterHueSaturationInput>;\r\n\r\nexport const filterHueSaturation = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height,280, 200,  1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterHueSaturationInput> = {\r\n            element: div,\r\n        };\r\n\r\n        function finishInit (): void {\r\n            let hue = 0, saturation = 0;\r\n            div.innerHTML = LANG('filter-hue-sat-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const hueSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-hue'),\r\n                width: 300,\r\n                height: 30,\r\n                min: -100,\r\n                max: 100,\r\n                value: hue * 100,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    hue = val / 100;\r\n                    fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            const saturationSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-saturation'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (saturation + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    saturation = val / 50 - 1;\r\n                    fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            hueSlider.getElement().style.marginBottom = '10px';\r\n            div.append(hueSlider.getElement(), saturationSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        isVisible: layers[i].isVisible,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = (): void => {\r\n                hueSlider.destroy();\r\n                saturationSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterHueSaturationInput {\r\n                result.destroy!();\r\n                return {\r\n                    hue: hue,\r\n                    saturation: saturation,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterHueSaturationInput>): boolean {\r\n        const context = params.context;\r\n        const hue = params.input.hue;\r\n        const history = params.history;\r\n        const saturation = params.input.saturation;\r\n        if (!context || hue === null || saturation === null || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'hueSaturation'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterHueSaturationHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply} from '../kl-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterInvertInput = null;\r\n\r\nexport type TFilterInvertHistoryEntry = TFilterHistoryEntry<\r\n    'invert',\r\n    TFilterInvertInput>;\r\n\r\nexport const filterInvert = {\r\n\r\n    apply (params: IFilterApply<TFilterInvertInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).invert().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'invert'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterInvertHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TwoTabs} from '../ui/components/two-tabs';\r\nimport {TRectanglePoints} from '../../fx-canvas/filters/perspective';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {PointerListener} from '../../bb/input/pointer-listener';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\nexport type TFilterPerspectiveInput = {\r\n    before: TRectanglePoints;\r\n    after: TRectanglePoints;\r\n};\r\n\r\nexport type TFilterPerspectiveHistoryEntry = TFilterHistoryEntry<\r\n    'perspective',\r\n    TFilterPerspectiveInput>;\r\n\r\ntype TDraggable = HTMLDivElement & {\r\n    x: number;\r\n    y: number;\r\n    copy: (p: IVector2D) => void;\r\n};\r\n\r\nexport const filterPerspective = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterPerspectiveInput> = {\r\n            element: div,\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 540;\r\n        }\r\n\r\n        const pointerListenerArr: PointerListener[] = [];\r\n\r\n        function finishInit (): void {\r\n            div.innerHTML = LANG('filter-perspective-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = throwIfNull(getSharedFx());\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n            function update (): void {\r\n                try {\r\n                    fxCanvas.draw(texture).multiplyAlpha().perspective(\r\n                        [ba.x, ba.y, bb.x, bb.y, bc.x, bc.y, bd.x, bd.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        }) as TRectanglePoints,\r\n                        [aa.x, aa.y, ab.x, ab.y, ac.x, ac.y, ad.x, ad.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        }) as TRectanglePoints\r\n                    ).unmultiplyAlpha().update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function createDraggable (x: number, y: number, callback?: () => void): TDraggable {\r\n                const size = 14;\r\n                const div = document.createElement('div') as TDraggable;\r\n                div.x = x;\r\n                div.y = y;\r\n                BB.css(div, {\r\n                    width: size + 'px',\r\n                    height: size + 'px',\r\n                    backgroundColor: '#fff',\r\n                    boxShadow: 'inset 0 0 0 2px #000',\r\n                    borderRadius: size + 'px',\r\n                    position: 'absolute',\r\n                    cursor: 'move',\r\n                    left: (div.x - size / 2) + 'px',\r\n                    top: (div.y - size / 2) + 'px',\r\n                    userSelect: 'none',\r\n                    touchAction: 'none',\r\n                });\r\n\r\n                const pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    onPointer: function (event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            div.x += event.dX;\r\n                            div.y += event.dY;\r\n                            div.style.left = (div.x - size / 2) + 'px';\r\n                            div.style.top = (div.y - size / 2) + 'px';\r\n                            if (callback) {\r\n                                callback();\r\n                            }\r\n                            update();\r\n                        }\r\n                    },\r\n                });\r\n                div.copy = function (p) {\r\n                    div.x = p.x;\r\n                    div.y = p.y;\r\n                    div.style.left = (div.x - size / 2) + 'px';\r\n                    div.style.top = (div.y - size / 2) + 'px';\r\n                };\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            function updateAfter () {\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            }\r\n\r\n            // b - before\r\n            const ba = createDraggable(0, 0, updateAfter);\r\n            const bb = createDraggable(displayW, 0, updateAfter);\r\n            const bc = createDraggable(displayW, displayH, updateAfter);\r\n            const bd = createDraggable(0, displayH, updateAfter);\r\n            // a - after\r\n            const aa = createDraggable(0, 0);\r\n            const ab = createDraggable(displayW, 0);\r\n            const ac = createDraggable(displayW, displayH);\r\n            const ad = createDraggable(0, displayH);\r\n\r\n            let before = false;\r\n\r\n            const beforeAfterTabs = new TwoTabs({\r\n                left: LANG('compare-before'),\r\n                right: LANG('compare-after'),\r\n                init: 1,\r\n                onChange: (val: number) => {\r\n                    before = val === 0;\r\n                    if (before) {\r\n                        aa.style.display = 'none';\r\n                        ab.style.display = 'none';\r\n                        ac.style.display = 'none';\r\n                        ad.style.display = 'none';\r\n\r\n                        ba.style.display = 'block';\r\n                        bb.style.display = 'block';\r\n                        bc.style.display = 'block';\r\n                        bd.style.display = 'block';\r\n                        ba.copy(aa);\r\n                        bb.copy(ab);\r\n                        bc.copy(ac);\r\n                        bd.copy(ad);\r\n                    } else {\r\n                        ba.style.display = 'none';\r\n                        bb.style.display = 'none';\r\n                        bc.style.display = 'none';\r\n                        bd.style.display = 'none';\r\n\r\n                        aa.style.display = 'block';\r\n                        ab.style.display = 'block';\r\n                        ac.style.display = 'block';\r\n                        ad.style.display = 'block';\r\n                        aa.copy(ba);\r\n                        ab.copy(bb);\r\n                        ac.copy(bc);\r\n                        ad.copy(bd);\r\n                    }\r\n                    update();\r\n                },\r\n            });\r\n            div.append(beforeAfterTabs.getElement());\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: isSmall ? '340px' : '540px',\r\n                    height: isSmall ? '260px' : '300px',\r\n                    marginTop: '0',\r\n                },\r\n            });\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    const canvas = i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas;\r\n                    previewLayerArr.push({\r\n                        image: canvas,\r\n                        isVisible: layers[i].isVisible,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.append(aa, ab, ac, ad);\r\n\r\n            ba.style.display = 'none';\r\n            bb.style.display = 'none';\r\n            bc.style.display = 'none';\r\n            bd.style.display = 'none';\r\n            previewInnerWrapper.append(ba, bb, bc, bd);\r\n\r\n\r\n            div.append(previewWrapper);\r\n            update();\r\n            result.destroy = (): void => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterPerspectiveInput {\r\n                result.destroy!();\r\n                return {\r\n                    before: [\r\n                        ba.x / displayPreviewFactor,\r\n                        ba.y / displayPreviewFactor,\r\n\r\n                        bb.x / displayPreviewFactor,\r\n                        bb.y / displayPreviewFactor,\r\n\r\n                        bc.x / displayPreviewFactor,\r\n                        bc.y / displayPreviewFactor,\r\n\r\n                        bd.x / displayPreviewFactor,\r\n                        bd.y / displayPreviewFactor,\r\n                    ],\r\n                    after: [\r\n                        aa.x / displayPreviewFactor,\r\n                        aa.y / displayPreviewFactor,\r\n\r\n                        ab.x / displayPreviewFactor,\r\n                        ab.y / displayPreviewFactor,\r\n\r\n                        ac.x / displayPreviewFactor,\r\n                        ac.y / displayPreviewFactor,\r\n\r\n                        ad.x / displayPreviewFactor,\r\n                        ad.y / displayPreviewFactor,\r\n                    ],\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterPerspectiveInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const before = params.input.before;\r\n        const after = params.input.after;\r\n        if (!context || !before || !after || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).multiplyAlpha().perspective(before, after).unmultiplyAlpha().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'perspective'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterPerspectiveHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Two buttons next to each other, each representing a tab. one at a time can be active.\r\n */\r\nexport class TwoTabs {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly leftTab: HTMLElement;\r\n    private readonly rightTab: HTMLElement;\r\n    private value: number;\r\n\r\n    private update (): void {\r\n        this.leftTab.classList.toggle('kl-2-tabs--active', this.value === 0);\r\n        this.rightTab.classList.toggle('kl-2-tabs--active', this.value === 1);\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (params: {\r\n        left: string;\r\n        right: string;\r\n        init: number; //0, 1\r\n        onChange: (val: number) => void;\r\n    }) {\r\n        this.value = params.init;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-2-tabs',\r\n        });\r\n\r\n        this.leftTab = BB.el({\r\n            parent: this.rootEl,\r\n            content: params.left,\r\n            className: 'kl-2-tabs__left',\r\n        });\r\n        this.leftTab.onpointerdown = () => false;\r\n\r\n        this.rightTab = BB.el({\r\n            parent: this.rootEl,\r\n            content: params.right,\r\n            className: 'kl-2-tabs__right',\r\n        });\r\n        this.rightTab.onpointerdown = () => false;\r\n\r\n        this.update();\r\n\r\n        this.leftTab.onclick = () => {\r\n            if (this.value === 0) {\r\n                return;\r\n            }\r\n            this.value = 0;\r\n            this.update();\r\n            params.onChange(this.value);\r\n        };\r\n\r\n        this.rightTab.onclick = () => {\r\n            if (this.value === 1) {\r\n                return;\r\n            }\r\n            this.value = 1;\r\n            this.update();\r\n            params.onChange(this.value);\r\n        };\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {Select} from '../ui/components/select';\r\nimport constrainImg from '/src/app/img/ui/constrain.svg';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {table} from '../ui/components/table';\r\nimport {theme} from '../../theme/theme';\r\n\r\nexport type TFilterResizeInput = {\r\n    width: number;\r\n    height: number;\r\n    algorithm: 'smooth' | 'pixelated';\r\n};\r\n\r\nexport type TFilterResizeHistoryEntry = TFilterHistoryEntry<\r\n    'resize',\r\n    TFilterResizeInput>;\r\n\r\nexport const filterResize = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        //BB.centerWithin\r\n        const klCanvas = params.klCanvas;\r\n        if (!klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const fit = BB.fitInto( klCanvas.getWidth(), klCanvas.getHeight(), 280, 200,1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let previewFactor = w / klCanvas.getWidth();\r\n        const tempCanvas = klCanvas.getCompleteCanvas(1);\r\n\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterResizeInput> = {\r\n            element: div,\r\n        };\r\n        let newWidth = klCanvas.getWidth(), newHeight = klCanvas.getHeight();\r\n\r\n        div.innerHTML = LANG('filter-resize-description') + '<br/><br/>';\r\n\r\n\r\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n\r\n        const widthWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            },\r\n        });\r\n        const heightWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            },\r\n        });\r\n        const widthInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxWidth,\r\n                value: '' + klCanvas.getWidth(),\r\n            },\r\n        });\r\n        const heightInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxHeight,\r\n                value: '' + klCanvas.getHeight(),\r\n            },\r\n        });\r\n        widthInput.onclick = function () {\r\n            (this as any).focus();\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onclick = function () {\r\n            (this as any).focus();\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthInput.onchange = function () {\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onchange = function () {\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthWrapper.append(LANG('width') + ': ', widthInput);\r\n        heightWrapper.append(LANG('height') + ': ', heightInput);\r\n        const inputWrapper = BB.el({\r\n            css: {\r\n                background: 'url(' + constrainImg + ') no-repeat 140px 5px',\r\n                backgroundSize: '50px 52px',\r\n            },\r\n        });\r\n        inputWrapper.append(widthWrapper, heightWrapper);\r\n        const constrainIm = new Image();\r\n        constrainIm.src = constrainImg;\r\n        constrainIm.height = 40;\r\n\r\n        const sizeTable = table([\r\n            [\r\n                LANG('width') + ':&nbsp;',\r\n                widthInput,\r\n                constrainIm,\r\n            ],\r\n            [\r\n                BB.el({css: {height: '5px'}}),\r\n                '',\r\n                '',\r\n            ],\r\n            [\r\n                LANG('height') + ':&nbsp;',\r\n                heightInput,\r\n            ],\r\n        ], {\r\n            '0.2': {rowspan: 3},\r\n        });\r\n        BB.css(sizeTable, {\r\n            marginBottom: '10px',\r\n        });\r\n\r\n        div.append(sizeTable);\r\n\r\n        //contrain checkbox\r\n        let heightChanged = false, widthChanged = false;\r\n        const ratio = klCanvas.getWidth() / klCanvas.getHeight();\r\n\r\n        function updateConstrain (): void {\r\n            constrainIm.style.display = isConstrained ? '' : 'none';\r\n            if (isConstrained) {\r\n                widthInput.value = '' + klCanvas.getWidth();\r\n                heightInput.value = '' + klCanvas.getHeight();\r\n                update();\r\n            }\r\n        }\r\n\r\n        let isConstrained = true;\r\n        const constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                isConstrained = b;\r\n                updateConstrain();\r\n            },\r\n        });\r\n        div.append(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n            },\r\n        }));\r\n\r\n\r\n        const algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')],\r\n            ],\r\n            title: LANG('scaling-algorithm'),\r\n            initValue: 'smooth',\r\n            onChange: (): void => {\r\n                update();\r\n            },\r\n        });\r\n\r\n        const secondRowElement = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                'alignItems': 'center',\r\n            },\r\n        });\r\n        secondRowElement.append(constrainCheckbox.getElement(), algorithmSelect.getElement());\r\n\r\n        const previewCanvas = BB.canvas(w, h);\r\n        previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n\r\n        const previewCtx = BB.ctx(previewCanvas);\r\n\r\n\r\n        function draw (): void {\r\n            if (algorithmSelect.getValue() === 'smooth') {\r\n                previewCanvas.style.imageRendering = previewFactor > 1 ? 'pixelated' : '';\r\n\r\n                previewCanvas.width = klCanvas.getWidth();\r\n                previewCanvas.height = klCanvas.getHeight();\r\n\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingQuality = 'high';\r\n                previewCtx.drawImage(tempCanvas, 0, 0);\r\n                BB.resizeCanvas(previewCanvas, newWidth, newHeight);\r\n                previewCtx.restore();\r\n\r\n            } else {\r\n                previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n                previewCanvas.width = newWidth;\r\n                previewCanvas.height = newHeight;\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingEnabled = false;\r\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\r\n                previewCtx.restore();\r\n            }\r\n\r\n        }\r\n\r\n        function update (): void {\r\n            if ((widthInput.value.length === 0 && widthChanged) || (heightInput.value.length === 0 && heightChanged)) {\r\n                heightChanged = false;\r\n                widthChanged = false;\r\n                return;\r\n            }\r\n            widthInput.value = '' + Math.max(1, parseInt(widthInput.value));\r\n            heightInput.value = '' + Math.max(1, parseInt(heightInput.value));\r\n            if (isConstrained) {\r\n                if (heightChanged) {\r\n                    widthInput.value = '' + parseInt('' + (parseInt(heightInput.value) * ratio));\r\n                }\r\n                if (widthChanged) {\r\n                    heightInput.value = '' + parseInt('' + (parseInt(widthInput.value) / ratio));\r\n                }\r\n\r\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\r\n                    const fit = BB.fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\r\n                    widthInput.value = '' + parseInt('' + fit.width);\r\n                    heightInput.value = '' + parseInt('' + fit.height);\r\n                }\r\n            }\r\n\r\n            if (parseInt(widthInput.value) > maxWidth) {\r\n                widthInput.value = '' + maxWidth;\r\n            }\r\n            if (parseInt(heightInput.value) > maxHeight) {\r\n                heightInput.value = '' + maxHeight;\r\n            }\r\n\r\n            heightChanged = false;\r\n            widthChanged = false;\r\n\r\n            newWidth = parseInt(widthInput.value);\r\n            newHeight = parseInt(heightInput.value);\r\n\r\n            const preview = BB.fitInto(newWidth, newHeight, 280, 200, 1);\r\n            const previewW = parseInt('' + preview.width), previewH = parseInt('' + preview.height);\r\n            previewFactor = previewW / newWidth;\r\n\r\n            const offset = BB.centerWithin(340, 220, previewW, previewH);\r\n\r\n            draw();\r\n\r\n            previewCanvas.style.width = Math.max(1, previewW) + 'px';\r\n            previewCanvas.style.height = Math.max(1, previewH) + 'px';\r\n            canvasWrapper.style.left = offset.x + 'px';\r\n            canvasWrapper.style.top = offset.y + 'px';\r\n            canvasWrapper.style.width = Math.max(1, previewW) + 'px';\r\n            canvasWrapper.style.height = Math.max(1, previewH) + 'px';\r\n        }\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-transparent-preview',\r\n            css: {\r\n                width: '340px',\r\n                marginLeft: '-20px',\r\n                height: '220px',\r\n                display: 'table',\r\n                marginTop: '10px',\r\n                position: 'relative',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n\r\n        const canvasWrapper = BB.el({\r\n            parent: previewWrapper,\r\n            content: previewCanvas,\r\n            className: 'kl-transparent-preview__canvas',\r\n            css: {\r\n                width: w + 'px',\r\n                height: h + 'px',\r\n                position: 'absolute',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n        function updateCheckerboard (): void {\r\n            BB.createCheckerDataUrl(8, function (url) {\r\n                previewWrapper.style.background = 'url(' + url + ')';\r\n            }, theme.isDark());\r\n        }\r\n        theme.addIsDarkListener(updateCheckerboard);\r\n        updateCheckerboard();\r\n\r\n\r\n        div.append(previewWrapper);\r\n        update();\r\n\r\n        result.destroy = (): void => {\r\n            constrainCheckbox.destroy();\r\n            theme.removeIsDarkListener(updateCheckerboard);\r\n        };\r\n        result.getInput = function (): TFilterResizeInput {\r\n            result.destroy!();\r\n            return {\r\n                width: newWidth,\r\n                height: newHeight,\r\n                algorithm: algorithmSelect.getValue(),\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterResizeInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        const width = params.input.width;\r\n        const height = params.input.height;\r\n        const algorithm = params.input.algorithm;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.resize(width, height, algorithm);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'resize'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterResizeHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"c92cL\");","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {theme} from '../../theme/theme';\r\n\r\nexport type TFilterRotateInput = {\r\n    deg: number;\r\n}\r\n\r\nexport type TFilterRotateHistoryEntry = TFilterHistoryEntry<\r\n    'rotate',\r\n    TFilterRotateInput>;\r\n\r\nexport const filterRotate = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const klCanvas = params.klCanvas;\r\n        if (!klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const previewFactor = w / klCanvas.getWidth();\r\n        const tempCanvas = BB.canvas(w, h);\r\n        tempCanvas.style.display = 'block';\r\n        BB.ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterRotateInput> = {\r\n            element: div,\r\n        };\r\n        let deg = 0;\r\n        div.innerHTML = LANG('filter-rotate-description') + '<br/><br/>';\r\n\r\n        function update (): void {\r\n            canvasWrapper.style.transform = 'rotate(' + deg + 'deg)';\r\n            if (Math.abs(deg % 180) === 90) {\r\n                //height has to fit width because of rotation\r\n                const fit = BB.fitInto(h, w, 280, 200, 1);\r\n                const scale = parseInt('' + fit.height) / w;\r\n                canvasWrapper.style.transform = 'rotate(' + deg + 'deg) scale(' + scale + ')';\r\n            }\r\n        }\r\n\r\n        const btnPlus = document.createElement('button');\r\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        const btnMinus = document.createElement('button');\r\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        btnMinus.style.marginRight = '5px';\r\n\r\n\r\n        btnPlus.onclick = function () {\r\n            deg += 90;\r\n            update();\r\n        };\r\n        btnMinus.onclick = function () {\r\n            deg -= 90;\r\n            update();\r\n        };\r\n\r\n        div.append(btnMinus, btnPlus);\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n                display: 'table',\r\n            },\r\n        });\r\n\r\n        const previewcell = BB.el({\r\n            parent: previewWrapper,\r\n            css: {\r\n                display: 'table-cell',\r\n                verticalAlign: 'middle',\r\n            },\r\n        });\r\n        const canvasWrapper = BB.el({\r\n            parent: previewcell,\r\n            content: tempCanvas,\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: w + 'px',\r\n                height: h + 'px',\r\n                marginLeft: 'auto',\r\n                marginRight: 'auto',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n\r\n        function updateCheckerboard (): void {\r\n            BB.createCheckerDataUrl(8, function (url) {\r\n                canvasWrapper.style.background = 'url(' + url + ')';\r\n            }, theme.isDark());\r\n        }\r\n        theme.addIsDarkListener(updateCheckerboard);\r\n        updateCheckerboard();\r\n\r\n        canvasWrapper.style.transition = 'all 0.2s ease-out';\r\n\r\n        div.append(previewWrapper);\r\n        update();\r\n\r\n        result.destroy = (): void => {\r\n            theme.removeIsDarkListener(updateCheckerboard);\r\n        };\r\n        result.getInput = function (): TFilterRotateInput {\r\n            result.destroy!();\r\n            return {\r\n                deg: deg,\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterRotateInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.rotate(params.input.deg);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'rotate'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterRotateHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {PointerListener} from '../../bb/input/pointer-listener';\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\nexport type TFilterTiltShiftInput = {\r\n    a: IVector2D;\r\n    b: IVector2D;\r\n    blur: number;\r\n    gradient: number;\r\n};\r\n\r\nexport type TFilterTiltShiftHistoryEntry = TFilterHistoryEntry<\r\n    'tiltShift',\r\n    TFilterTiltShiftInput>;\r\n\r\ntype TDraggable = HTMLDivElement & {\r\n    x: number;\r\n    y: number;\r\n    // copy: (p: IVector2D) => void;\r\n};\r\n\r\nexport const filterTiltShift = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const previewFactor = w / context.canvas.width;\r\n        const displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        const rootEl = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterTiltShiftInput> = {\r\n            element: rootEl,\r\n        };\r\n\r\n        const pointerListenerArr: PointerListener[] = [];\r\n\r\n        function finishInit () {\r\n            let blur = 20, gradient = 200;\r\n            rootEl.innerHTML = LANG('filter-tilt-shift-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = throwIfNull(getSharedFx());\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            function update () {\r\n                try {\r\n                    fxCanvas.draw(texture).tiltShift(\r\n                        fa.x / displayPreviewFactor * previewFactor,\r\n                        fa.y / displayPreviewFactor * previewFactor,\r\n                        fb.x / displayPreviewFactor * previewFactor,\r\n                        fb.y / displayPreviewFactor * previewFactor,\r\n                        blur * previewFactor,\r\n                        gradient * previewFactor\r\n                    ).update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (rootEl as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function createDraggable (x: number, y: number): TDraggable {\r\n                const size = 14;\r\n                const div = BB.el({\r\n                    css: {\r\n                        width: size + 'px',\r\n                        height: size + 'px',\r\n                        backgroundColor: '#fff',\r\n                        boxShadow: 'inset 0 0 0 2px #000',\r\n                        borderRadius: size + 'px',\r\n                        position: 'absolute',\r\n                        cursor: 'move',\r\n                        left: (x - size / 2) + 'px',\r\n                        top: (y - size / 2) + 'px',\r\n                        userSelect: 'none',\r\n                        touchAction: 'none',\r\n                    },\r\n                }) as TDraggable;\r\n                div.x = x;\r\n                div.y = y;\r\n                const pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    onPointer: function (event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            div.x += event.dX;\r\n                            div.y += event.dY;\r\n                            div.style.left = (div.x - size / 2) + 'px';\r\n                            div.style.top = (div.y - size / 2) + 'px';\r\n                            update();\r\n                        }\r\n                    },\r\n                });\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            // focus line control points\r\n            const fa = createDraggable(parseInt('' + (displayW / 6)), parseInt('' + (displayH / 2)));\r\n            const fb = createDraggable(parseInt('' + (displayW - displayW / 6)), parseInt('' + (displayH - displayH / 3)));\r\n\r\n            const blurSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-blur'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                value: blur,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    blur = val;\r\n                    update();\r\n                },\r\n            });\r\n            blurSlider.getElement().style.marginBottom = '10px';\r\n            rootEl.append(blurSlider.getElement());\r\n            const gradientSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-gradient'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1000,\r\n                value: gradient,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    gradient = val;\r\n                    update();\r\n                },\r\n            });\r\n            rootEl.append(gradientSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        isVisible: layers[i].isVisible,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.append(fa, fb);\r\n\r\n\r\n            rootEl.append(previewWrapper);\r\n            update();\r\n            result.destroy = (): void => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                blurSlider.destroy();\r\n                gradientSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterTiltShiftInput {\r\n                result.destroy!();\r\n                return {\r\n                    a: {x: fa.x / displayPreviewFactor, y: fa.y / displayPreviewFactor},\r\n                    b: {x: fb.x / displayPreviewFactor, y: fb.y / displayPreviewFactor},\r\n                    blur: blur,\r\n                    gradient: gradient,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterTiltShiftInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const a = params.input.a;\r\n        const b = params.input.b;\r\n        const blur = params.input.blur;\r\n        const gradient = params.input.gradient;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).tiltShift(a.x, a.y, b.x, b.y, blur, gradient).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'tiltShift'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterTiltShiftHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {FreeTransform} from '../ui/components/free-transform';\r\nimport {IFreeTransform} from '../ui/components/free-transform-utils';\r\nimport {Select} from '../ui/components/select';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\nexport type TFilterTransformInput = {\r\n    bounds: {x: number; y: number; width: number; height: number};\r\n    transform: IFreeTransform;\r\n    isPixelated: boolean;\r\n};\r\n\r\nexport type TFilterTransformHistoryEntry = TFilterHistoryEntry<\r\n    'transform',\r\n    TFilterTransformInput>;\r\n\r\nexport const filterTransform = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n        const displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        // determine bounds and initial transformation\r\n        const boundsObj = BB.canvasBounds(context);\r\n        if (!boundsObj) {\r\n            alert(LANG('filter-transform-empty'));\r\n            return false;\r\n        }\r\n        const initTransform = {\r\n            x: boundsObj.x + boundsObj.width / 2,\r\n            y: boundsObj.y + boundsObj.height / 2,\r\n            width: boundsObj.width,\r\n            height: boundsObj.height,\r\n            angleDeg: 0,\r\n        };\r\n\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterTransformInput> = {\r\n            element: div,\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 540;\r\n        }\r\n        div.innerHTML = LANG('filter-transform-description');\r\n\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: function (keyStr) {\r\n                if (BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n\r\n                if (keyStr === 'left') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'right') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'up') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'down') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n            },\r\n\r\n        });\r\n\r\n        const leftWrapper = document.createElement('div');\r\n        const rightWrapper = document.createElement('div');\r\n        const rotWrapper = document.createElement('div');\r\n        const inputY = document.createElement('input');\r\n        const inputX = document.createElement('input');\r\n        const inputR = document.createElement('input');\r\n        leftWrapper.style.width = '100px';\r\n        leftWrapper.style.height = '30px';\r\n        rightWrapper.style.width = '100px';\r\n        rightWrapper.style.height = '30px';\r\n        rightWrapper.style.display = 'inline-block';\r\n        leftWrapper.style.display = 'inline-block';\r\n        rotWrapper.style.display = 'inline-block';\r\n        rotWrapper.style.width = '150px';\r\n        rotWrapper.style.height = '30px';\r\n        inputY.type = 'number';\r\n        inputX.type = 'number';\r\n        inputR.type = 'number';\r\n        inputX.style.width = 70 + 'px';\r\n        inputY.style.width = 70 + 'px';\r\n        inputR.style.width = 70 + 'px';\r\n        inputY.value = '0';\r\n        inputX.value = '0';\r\n        inputR.value = '0';\r\n        inputY.onclick = function () {\r\n            inputY.focus();\r\n            onInputsChanged();\r\n        };\r\n        inputX.onclick = function () {\r\n            inputX.focus();\r\n            onInputsChanged();\r\n        };\r\n        inputR.onclick = function () {\r\n            inputR.focus();\r\n            onInputsChanged();\r\n        };\r\n        inputY.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputY.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        leftWrapper.append('X: ', inputX);\r\n        rightWrapper.append('Y: ', inputY);\r\n        rotWrapper.append(LANG('filter-transform-rotation') + ': ', inputR);\r\n        if (!isSmall) {\r\n            const inputRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\r\n        }\r\n\r\n        // buttons\r\n        const actionBtnCss = {\r\n            marginLeft: '10px',\r\n            marginTop: '10px',\r\n        };\r\n        const buttonRow = BB.el ({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginLeft: '-10px',\r\n            },\r\n        });\r\n        const flipXBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' X',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(-t.width, t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const flipYBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' Y',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(t.width, -t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotLeftBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '-90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg -= 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotRightBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '+90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg += 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleDoubleBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                if (constrainCheckbox.getValue()) {\r\n                    freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\r\n                } else {\r\n                    freeTransform.setSize(t.width * 2, t.height * 2);\r\n                }\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleHalfBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '1/2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const centerBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('center'),\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setPos({ x: context.canvas.width / 2, y: context.canvas.height / 2 });\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n\r\n\r\n\r\n\r\n\r\n        let isConstrained = true;\r\n        const constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-constrain'),\r\n            title: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                isConstrained = b;\r\n                freeTransform.setConstrained(isConstrained);\r\n            },\r\n            css: {\r\n                display: 'inline-block',\r\n            },\r\n        });\r\n        let isSnapping = false;\r\n        const snappingCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-snap'),\r\n            title: LANG('filter-transform-snap-title'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                isSnapping = b;\r\n                freeTransform.setSnapping(isSnapping);\r\n            },\r\n            css: {\r\n                display: 'inline-block',\r\n                marginLeft: '10px',\r\n            },\r\n        });\r\n        const checkboxWrapper = BB.el();\r\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\r\n\r\n        div.append(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n                height: '10px',\r\n            },\r\n        }));\r\n\r\n        const bottomRow = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n\r\n        const algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')],\r\n            ],\r\n            initValue: 'smooth',\r\n            title: LANG('scaling-algorithm'),\r\n            onChange: (): void => {\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                height: isSmall ? '260px' : '300px',\r\n            },\r\n        });\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n\r\n        const previewLayerArr: IKlBasicLayer[] = [];\r\n        {\r\n            for (let i = 0; i < layers.length; i++) {\r\n                let canvas;\r\n                if (i === selectedLayerIndex) {\r\n                    canvas = BB.canvas(parseInt('' + w), parseInt('' + h));\r\n                    const ctx = BB.ctx(canvas);\r\n                    ctx.drawImage(layers[i].context.canvas, 0, 0, canvas.width, canvas.height);\r\n                } else {\r\n                    canvas = layers[i].context.canvas;\r\n                }\r\n                previewLayerArr.push({\r\n                    image: canvas,\r\n                    isVisible: layers[i].isVisible,\r\n                    opacity: layers[i].opacity,\r\n                    mixModeStr: layers[i].mixModeStr,\r\n                });\r\n            }\r\n        }\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: parseInt('' + displayW),\r\n            height: parseInt('' + displayH),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + displayW) + 'px',\r\n                height: parseInt('' + displayH) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        let lastDrawnTransformStr = '';\r\n        function updatePreview (doForce: boolean = false) {\r\n            if (!freeTransform) {\r\n                return;\r\n            }\r\n            const transform = freeTransform.getTransform();\r\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) {\r\n                return;\r\n            }\r\n            lastDrawnTransformStr = JSON.stringify(transform);\r\n            if (displayPreviewFactor < 1) {\r\n                transform.x *= displayPreviewFactor;\r\n                transform.y *= displayPreviewFactor;\r\n                transform.width *= displayPreviewFactor;\r\n                transform.height *= displayPreviewFactor;\r\n            }\r\n            const transformLayerCanvas = previewLayerArr[selectedLayerIndex].image as HTMLCanvasElement;\r\n            const ctx = BB.ctx(transformLayerCanvas);\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, transformLayerCanvas.width, transformLayerCanvas.height);\r\n            BB.drawTransformedImageWithBounds(\r\n                ctx,\r\n                layers[selectedLayerIndex].context.canvas,\r\n                transform,\r\n                boundsObj,\r\n                algorithmSelect.getValue() === 'pixelated' ||\r\n                BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            );\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        const freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: initTransform.angleDeg,\r\n            isConstrained: true,\r\n            snapX: [0, context.canvas.width],\r\n            snapY: [0, context.canvas.height],\r\n            callback: function (t) {\r\n                inputX.value = '' + Math.round(t.x - initTransform.x);\r\n                inputY.value = '' + Math.round(t.y - initTransform.y);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            scale: displayPreviewFactor,\r\n        });\r\n        BB.css(freeTransform.getElement(), {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n        });\r\n        previewInnerWrapper.append(freeTransform.getElement());\r\n\r\n        function onInputsChanged () {\r\n            freeTransform.setPos({\r\n                x: parseInt(inputX.value) + initTransform.x,\r\n                y: parseInt(inputY.value) + initTransform.y}\r\n            );\r\n            freeTransform.setAngleDeg(parseInt(inputR.value));\r\n            updatePreview();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            keyListener.destroy();\r\n            freeTransform.destroy();\r\n            constrainCheckbox.destroy();\r\n            snappingCheckbox.destroy();\r\n            BB.destroyEl(flipXBtn);\r\n            BB.destroyEl(flipYBtn);\r\n            BB.destroyEl(scaleRotLeftBtn);\r\n            BB.destroyEl(scaleRotRightBtn);\r\n            BB.destroyEl(scaleDoubleBtn);\r\n            BB.destroyEl(scaleHalfBtn);\r\n            BB.destroyEl(centerBtn);\r\n            klCanvasPreview.destroy();\r\n        };\r\n        result.getInput = function (): TFilterTransformInput {\r\n            const transform = freeTransform.getTransform();\r\n            const input: TFilterTransformInput = {\r\n                transform,\r\n                bounds: boundsObj,\r\n                isPixelated: algorithmSelect.getValue() === 'pixelated' ||\r\n                    BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            };\r\n            result.destroy!();\r\n            return BB.copyObj(input);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterTransformInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const input = params.input;\r\n\r\n        const copyCanvas = BB.copyCanvas(context.canvas);\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            context,\r\n            copyCanvas,\r\n            input.transform,\r\n            input.bounds,\r\n            input.isPixelated,\r\n        );\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'transform'],\r\n            action: 'apply',\r\n            params: [{input}],\r\n        } as TFilterTransformHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterBlurInput = {\r\n    radius: number;\r\n}\r\n\r\nexport type TFilterBlurHistoryEntry = TFilterHistoryEntry<\r\n    'blur',\r\n    TFilterBlurInput>;\r\n\r\n\r\nexport const filterBlur = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const klCanvas = params.klCanvas;\r\n        const context = params.context;\r\n        if (!klCanvas || !context) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterBlurInput> = {\r\n            element: div,\r\n        };\r\n\r\n\r\n        function finishInit (): void {\r\n            let radius = 10;\r\n            div.innerHTML = LANG('filter-triangle-blur-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 1,\r\n                max: 200,\r\n                value: radius,\r\n                eventResMs: eventResMs,\r\n                onChange: (val): void => {\r\n                    radius = val;\r\n                    fxCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            div.append(radiusSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        isVisible: layers[i].isVisible,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = (): void => {\r\n                texture.destroy();\r\n                radiusSlider.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterBlurInput {\r\n                result.destroy!();\r\n                return {\r\n                    radius: radius,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterBlurInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const radius = params.input.radius;\r\n        if (!context || !radius || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).triangleBlur(radius).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'blur'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterBlurHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterUnsharpMaskInput = {\r\n    radius: number;\r\n    strength: number;\r\n};\r\n\r\nexport type TFilterUnsharpMaskHistoryEntry = TFilterHistoryEntry<\r\n    'unsharpMask',\r\n    TFilterUnsharpMaskInput>;\r\n\r\nexport const filterUnsharpMask = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterUnsharpMaskInput> = {\r\n            element: div,\r\n        };\r\n\r\n        function finishInit () {\r\n            let radius = 2, strength = 5.1 / 10;\r\n            div.innerHTML = LANG('filter-unsharp-mask-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                value: 2,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    radius = val;\r\n                    fxCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 50], [1, 200]],\r\n            });\r\n            const strengthSlider = new KlSlider({\r\n                label: LANG('filter-unsharp-mask-strength'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 50,\r\n                value: 5.1,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    strength = val / 10;\r\n                    fxCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 10], [1, 50]],\r\n            });\r\n            radiusSlider.getElement().style.marginBottom = '10px';\r\n            div.append(radiusSlider.getElement());\r\n            div.append(strengthSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        isVisible: layers[i].isVisible,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                klCanvasPreview.render();\r\n            } catch (e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = (): void => {\r\n                radiusSlider.destroy();\r\n                strengthSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterUnsharpMaskInput {\r\n                result.destroy!();\r\n                return {\r\n                    radius: radius,\r\n                    strength: strength,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply (params: IFilterApply<TFilterUnsharpMaskInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const radius = params.input.radius;\r\n        const strength = params.input.strength;\r\n        if (!context || radius === null || strength === null || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).unsharpMask(radius, strength).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'unsharpMask'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterUnsharpMaskHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Options} from '../ui/components/options';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, IRGBA} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\nexport type TFilterToAlphaInput = {\r\n    sourceId: string;\r\n    selectedRgbaObj: IRGBA | null;\r\n};\r\n\r\nexport type TFilterToAlphaHistoryEntry = TFilterHistoryEntry<\r\n    'toAlpha',\r\n    TFilterToAlphaInput>;\r\n\r\nexport const filterToAlpha = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterToAlphaInput> = {\r\n            element: div,\r\n        };\r\n\r\n        function finishInit () {\r\n            div.append(BB.el({\r\n                content: LANG('filter-to-alpha-description'),\r\n                css: {\r\n                    marginBottom: '5px',\r\n                },\r\n            }));\r\n\r\n            const fxCanvas = throwIfNull(getSharedFx());\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            function updatePreview () {\r\n                fxCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n                klCanvasPreview.render();\r\n            }\r\n\r\n            // source\r\n            let sourceId = 'inverted-luminance';\r\n            const sourceOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'inverted-luminance',\r\n                        label: LANG('filter-to-alpha-inverted-lum'),\r\n                    },\r\n                    {\r\n                        id: 'luminance',\r\n                        label: LANG('filter-to-alpha-lum'),\r\n                    },\r\n                ],\r\n                initId: sourceId,\r\n                onChange: function (id) {\r\n                    sourceId = id;\r\n                    updatePreview();\r\n                },\r\n            });\r\n            div.append(sourceOptions.getElement());\r\n\r\n            // color\r\n            let selectedRgbaObj: IRGBA | null = {r: 0, g: 0, b: 0, a: 1};\r\n            const colorOptionsArr = [\r\n                null,\r\n                {r: 0, g: 0, b: 0, a: 1},\r\n                {r: 255, g: 255, b: 255, a: 1},\r\n                {\r\n                    r: params.currentColorRgb.r,\r\n                    g: params.currentColorRgb.g,\r\n                    b: params.currentColorRgb.b,\r\n                    a: 1,\r\n                },\r\n                {\r\n                    r: params.secondaryColorRgb.r,\r\n                    g: params.secondaryColorRgb.g,\r\n                    b: params.secondaryColorRgb.b,\r\n                    a: 1,\r\n                },\r\n            ];\r\n\r\n            const colorOptions = new ColorOptions({\r\n                label: LANG('filter-to-alpha-replace'),\r\n                colorArr: colorOptionsArr,\r\n                initialIndex: 1,\r\n                onChange: function (rgbaObj) {\r\n                    selectedRgbaObj = rgbaObj;\r\n                    updatePreview();\r\n                },\r\n            });\r\n            colorOptions.getElement().style.marginTop = '10px';\r\n            div.append(colorOptions.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        isVisible: layers[i].isVisible,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            setTimeout(function () { //ie has a problem otherwise...\r\n                try {\r\n                    updatePreview();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }, 1);\r\n\r\n            result.destroy = (): void => {\r\n                texture.destroy();\r\n                sourceOptions.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterToAlphaInput {\r\n                result.destroy!();\r\n                return {\r\n                    sourceId: sourceId,\r\n                    selectedRgbaObj: selectedRgbaObj,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply (params: IFilterApply<TFilterToAlphaInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const sourceId = params.input.sourceId;\r\n        const selectedRgbaObj = params.input.selectedRgbaObj;\r\n        if (!context || !sourceId || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'toAlpha'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterToAlphaHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {input} from '../ui/components/input';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {drawGrid} from '../image-operations/draw-grid';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\nexport type TFilterGridInput = {\r\n    x: number;\r\n    y: number;\r\n    thickness: number;\r\n    color: string;\r\n    opacity: number;\r\n};\r\n\r\nexport type TFilterGridHistoryEntry = TFilterHistoryEntry<\r\n    'grid',\r\n    TFilterGridInput>;\r\n\r\nexport const filterGrid = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterGridInput> = {\r\n            element: div,\r\n        };\r\n        div.innerHTML = LANG('filter-grid-description') + '<br/><br/>';\r\n\r\n        const settingsObj: TFilterGridInput = {\r\n            x: 2,\r\n            y: 2,\r\n            thickness: 2,\r\n            color: '#000',\r\n            opacity: 1,\r\n        };\r\n\r\n        const line1 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        const line2 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n        const xInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.x = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const yInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.y = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const thicknessInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.thickness = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n        settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('shape-stroke'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function (rgbaObj) {\r\n                selectedRgbaObj = rgbaObj!;\r\n                settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            marginRight: '5px',\r\n        };\r\n        line1.append(\r\n            BB.el({content: 'X:', css: labelStyle}),\r\n            xInput,\r\n            BB.el({content: 'Y:', css: labelStyle}),\r\n            yInput,\r\n        );\r\n        line2.append(\r\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\r\n            thicknessInput,\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorOptions.getElement(),\r\n        );\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            isVisible: layers[selectedLayerIndex].isVisible,\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        isVisible: item.isVisible,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            }),\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n            drawGrid(ctx, settingsObj.x, settingsObj.y, Math.max(settingsObj.thickness * renderFactor, 1), settingsObj.color, settingsObj.opacity);\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            klCanvasPreview.destroy();\r\n            colorOptions.destroy();\r\n        };\r\n        result.getInput = function (): TFilterGridInput {\r\n            result.destroy!();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterGridInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        drawGrid(\r\n            context,\r\n            params.input.x,\r\n            params.input.y,\r\n            params.input.thickness,\r\n            params.input.color,\r\n            params.input.opacity,\r\n        );\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['filter', 'grid'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterGridHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","\r\n// ideas: padding, gutter, other shapes\r\n\r\nexport function drawGrid (\r\n    ctx: CanvasRenderingContext2D,\r\n    cellsX: number,\r\n    cellsY: number,\r\n    thickness: number, // px\r\n    color: string,\r\n    opacity: number, // 0 - 1\r\n): void {\r\n    ctx.save();\r\n    const w = ctx.canvas.width;\r\n    const h = ctx.canvas.height;\r\n    thickness = Math.round(thickness);\r\n    const thickIsRound = thickness % 2 === 0;\r\n\r\n    ctx.beginPath();\r\n    ctx.lineWidth = thickness;\r\n    ctx.strokeStyle = color;\r\n    ctx.globalAlpha = opacity;\r\n\r\n    for(let i = 0; i < cellsX - 1; i++) {\r\n        const cw = w / (cellsX);\r\n        let pos = cw * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n        ctx.moveTo(pos, 0);\r\n        ctx.lineTo(pos, h);\r\n\r\n    }\r\n    for(let i = 0; i < cellsY - 1; i++) {\r\n        const ch = h / (cellsY);\r\n        let pos = ch * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n\r\n        ctx.moveTo(0, pos);\r\n        ctx.lineTo(w, pos);\r\n    }\r\n\r\n    ctx.stroke();\r\n    ctx.restore();\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, IRGB, TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {Options} from '../ui/components/options';\r\nimport {eventResMs} from './filters-consts';\r\nimport {Select} from '../ui/components/select';\r\nimport {translateBlending} from '../canvas/translate-blending';\r\nimport {KL} from '../kl';\r\nimport {ColorConverter} from '../../bb/color/color';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {TFxCanvas, TWrappedTexture} from '../../fx-canvas/fx-canvas-types';\r\nimport {TKlCanvasHistoryEntry} from '../canvas/kl-canvas';\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\n// see noise(...) in fx-canvas\r\ninterface INoisePreset {\r\n    type: number;\r\n    scaleX: number;\r\n    scaleY: number;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    octaves: number;\r\n    samples: number;\r\n    peaks: number;\r\n    brightness: number;\r\n    contrast: number;\r\n    isReversed: boolean;\r\n}\r\n\r\ntype TNoiseChannels = 'rgb' | 'alpha';\r\n\r\ninterface INoiseSettings extends INoisePreset {\r\n    seed?: number;\r\n    colA?: IRGB;\r\n    colB?: IRGB;\r\n    channels?: TNoiseChannels; // default rgb\r\n}\r\n\r\nexport type TFilterNoiseInput = {\r\n    seed: number;\r\n    presetIndex: number; // which preset from presetArr\r\n    scale: number; // applies to both scaleX and scaleX\r\n    opacity: number; // aka strength\r\n    isReversed: boolean; // reverse direction of color gradient\r\n    channels: TNoiseChannels;\r\n\r\n    // only for channels = rgb\r\n    mixModeStr: GlobalCompositeOperation; // how mixed with image\r\n    colA: IRGB;\r\n    colB: IRGB;\r\n}\r\n\r\n/*export type TFilterNoiseHistoryEntry = TFilterHistoryEntry<\r\n    'replaceLayer',\r\n    TFilterNoiseInput>;*/\r\n\r\nconst presetArr: INoisePreset[] = [\r\n    // each pixel random value\r\n    {type: 0, scaleX: 1, scaleY: 1, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: true},\r\n\r\n    // cloud\r\n    {type: 1, scaleX: 166, scaleY: 164, offsetX: 105, offsetY: 30, octaves: 6, samples: 1, peaks: 0, brightness: 0.055, contrast: 0.23, isReversed: true},\r\n\r\n    // thin lines\r\n    {type: 1, scaleX: 235, scaleY: 190, offsetX: 3227, offsetY: 2156, octaves: 4, samples: 16, peaks: 22, brightness: -0.375, contrast: 1, isReversed: false},\r\n\r\n    // soft large simplex, only 1 octave\r\n    {type: 1, scaleX: 40, scaleY: 40, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: false},\r\n\r\n    // two value large pixels\r\n    {type: 0, scaleX: 26, scaleY: 26, offsetX: 557, offsetY: 365, octaves: 1, samples: 1, peaks: 0, brightness: 0.02, contrast: 1, isReversed: true},\r\n\r\n    // zebra\r\n    {type: 1, scaleX: 1500, scaleY: 1500, offsetX: 745, offsetY: 2871, octaves: 5, samples: 16, peaks: 156.02, brightness: 0.03, contrast: 1, isReversed: true},\r\n\r\n    // sparse dots / stars\r\n    {type: 1, scaleX: 11, scaleY: 11, offsetX: 2940, offsetY: 2045, octaves: 1, samples: 16, peaks: 1, brightness: -0.045, contrast: 1, isReversed: true},\r\n\r\n    // pseudo marble\r\n    {type: 2, scaleX: 74, scaleY: 74, offsetX: 4816, offsetY: 1304, octaves: 3, samples: 1, peaks: 2.78, brightness: 0, contrast: 0, isReversed: false},\r\n];\r\n\r\nfunction drawNoise (fxCanvas: TFxCanvas, settings: INoiseSettings): void {\r\n    fxCanvas.noise(\r\n        settings.seed,\r\n        settings.type,\r\n        [settings.scaleX, settings.scaleY],\r\n        [fxCanvas.width / 2, fxCanvas.height / 2],\r\n        settings.octaves,\r\n        settings.samples,\r\n        settings.peaks,\r\n        settings.brightness,\r\n        settings.contrast,\r\n        settings.isReversed,\r\n        settings.colA,\r\n        settings.colB,\r\n        settings.channels ? settings.channels : 'rgb',\r\n    ).update();\r\n}\r\n\r\n\r\nexport const filterNoise = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n\r\n\r\n        const fxCanvas = throwIfNull(getSharedFx());\r\n        let texture: TWrappedTexture;\r\n\r\n        const thumbImgArr: HTMLImageElement[] = [];\r\n        const thumbSize = 32;\r\n        {\r\n            const canvas = BB.canvas(thumbSize, thumbSize);\r\n            const ctx = BB.ctx(canvas);\r\n            texture = fxCanvas.texture(canvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n            texture.destroy();\r\n\r\n            presetArr.forEach((preset) => {\r\n                const thumbImg = new Image();\r\n                const presetCopy = BB.copyObj(preset) as INoiseSettings;\r\n                presetCopy.scaleX /= 10;\r\n                presetCopy.scaleY /= 10;\r\n                drawNoise(fxCanvas, presetCopy);\r\n                ctx.drawImage(fxCanvas, 0, 0);\r\n                thumbImg.src = canvas.toDataURL('image/png');\r\n                thumbImgArr.push(thumbImg);\r\n            });\r\n\r\n        }\r\n\r\n        {\r\n            const tempCanvas = BB.canvas(renderW, renderH);\r\n            texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n            BB.freeCanvas(tempCanvas);\r\n        }\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterNoiseInput> = {\r\n            element: div,\r\n        };\r\n\r\n        div.innerHTML = LANG('filter-noise-description') + '<br/><br/>';\r\n\r\n        const settingsObj: TFilterNoiseInput = {\r\n            seed: Math.random() * 300,\r\n            presetIndex: 0,\r\n            scale: 50,\r\n            opacity: 0.5,\r\n            isReversed: false,\r\n            channels: 'rgb',\r\n            mixModeStr: 'source-over' as GlobalCompositeOperation,\r\n            colA: {r: 0, g: 0, b: 0},\r\n            colB: {r: 255, g: 255, b: 255},\r\n        };\r\n\r\n\r\n        const presetOptions = new Options({\r\n            optionArr: thumbImgArr.map((img, index) => {\r\n                BB.css(img, {\r\n                    margin: '1px',\r\n                    borderRadius: '3px',\r\n                    transition: 'all 0.1s ease-in-out',\r\n                });\r\n                return {\r\n                    id: '' + index,\r\n                    label: img,\r\n                };\r\n            }),\r\n            initId: '0',\r\n            onChange: (id) => {\r\n                settingsObj.presetIndex = Number(id);\r\n                updatePreview();\r\n            },\r\n        });\r\n        presetOptions.getElement().style.marginBottom = '10px';\r\n        div.append(presetOptions.getElement());\r\n\r\n        const scaleSlider = new KlSlider({\r\n            label: LANG('filter-noise-scale'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1,\r\n            max: 1000,\r\n            value: settingsObj.scale,\r\n            eventResMs: eventResMs,\r\n            curve: BB.quadraticSplineInput(1, 1000, 0.1),\r\n            onChange: (value) => {\r\n                settingsObj.scale = value;\r\n                updatePreview();\r\n            },\r\n        });\r\n        scaleSlider.getElement().style.marginBottom = '10px';\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: settingsObj.opacity,\r\n            eventResMs: eventResMs,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n            onChange: (value) => {\r\n                settingsObj.opacity = value;\r\n                updatePreview();\r\n            },\r\n        });\r\n        opacitySlider.getElement().style.marginBottom = '10px';\r\n\r\n        const row1El = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        const row2El = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        const channelsOptions = new Options<TNoiseChannels>({\r\n            optionArr: [\r\n                {id: 'rgb', label: 'RGB'},\r\n                {id: 'alpha', label: LANG('filter-noise-alpha')},\r\n            ],\r\n            initId: 'rgb',\r\n            onChange: (id: TNoiseChannels) => {\r\n                settingsObj.channels = id;\r\n                if (id === 'rgb') {\r\n                    row2El.style.visibility = '';\r\n                } else {\r\n                    row2El.style.visibility = 'hidden';\r\n                }\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const reverseToggle = new Checkbox({\r\n            label: LANG('reverse'),\r\n            callback: (val) => {\r\n                settingsObj.isReversed = val;\r\n                updatePreview();\r\n            },\r\n            allowTab: true,\r\n        });\r\n\r\n        const mixModes: (TMixMode | undefined)[] = [\r\n            'source-over',\r\n            undefined,\r\n            'darken',\r\n            'multiply',\r\n            'color-burn',\r\n            undefined,\r\n            'lighten',\r\n            'screen',\r\n            'color-dodge',\r\n            undefined,\r\n            'overlay',\r\n            'soft-light',\r\n            'hard-light',\r\n            undefined,\r\n            'difference',\r\n            'exclusion',\r\n            undefined,\r\n            'hue',\r\n            'saturation',\r\n            'color',\r\n            'luminosity',\r\n        ];\r\n\r\n        const blendSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: mixModes.map(item => {\r\n                return item ? ([item, translateBlending(item)] as [TMixMode, string]) : undefined;\r\n            }),\r\n            initValue: settingsObj.mixModeStr,\r\n            onChange: (val: GlobalCompositeOperation) => {\r\n                settingsObj.mixModeStr = val;\r\n                updatePreview();\r\n            },\r\n        });\r\n        blendSelect.getElement().title = LANG('layers-blending');\r\n\r\n        const colorWrapper = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        const colInputStyle = {\r\n            width: '34px',\r\n            height: '34px',\r\n            marginRight: '5px',\r\n        };\r\n        const colAInput = KL.input({\r\n            type: 'color',\r\n            init: '#' + ColorConverter.toHexString(settingsObj.colA),\r\n            callback: (val) => {\r\n                const newColor = ColorConverter.hexToRGB(val);\r\n                if (newColor) {\r\n                    settingsObj.colA = newColor;\r\n                    updatePreview();\r\n                }\r\n            },\r\n            css: colInputStyle,\r\n        });\r\n\r\n        const colBInput = KL.input({\r\n            type: 'color',\r\n            init: '#' + ColorConverter.toHexString(settingsObj.colB),\r\n            callback: (val) => {\r\n                const newColor = ColorConverter.hexToRGB(val);\r\n                if (newColor) {\r\n                    settingsObj.colB = newColor;\r\n                    updatePreview();\r\n                }\r\n            },\r\n            css: colInputStyle,\r\n        });\r\n\r\n        colorWrapper.append(\r\n            colAInput,\r\n            colBInput,\r\n        );\r\n\r\n\r\n        row1El.append(\r\n            channelsOptions.getElement(),\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            reverseToggle.getElement(),\r\n        );\r\n\r\n        row2El.append(\r\n            blendSelect.getElement(),\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorWrapper,\r\n        );\r\n\r\n        div.append(\r\n            scaleSlider.getElement(),\r\n            opacitySlider.getElement(),\r\n            row1El,\r\n            row2El,\r\n        );\r\n\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            isVisible: layers[selectedLayerIndex].isVisible,\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        isVisible: item.isVisible,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            }),\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n\r\n            ctx.globalAlpha = settingsObj.opacity;\r\n\r\n            const presetCopy = BB.copyObj(presetArr[settingsObj.presetIndex]) as INoiseSettings;\r\n            presetCopy.seed = settingsObj.seed;\r\n            presetCopy.scaleX = presetCopy.scaleX  * settingsObj.scale / 50 * renderFactor;\r\n            presetCopy.scaleY = presetCopy.scaleY  * settingsObj.scale / 50 * renderFactor;\r\n            presetCopy.colA = settingsObj.colA;\r\n            presetCopy.colB = settingsObj.colB;\r\n            presetCopy.isReversed = settingsObj.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\r\n            presetCopy.channels  = settingsObj.channels;\r\n            drawNoise(fxCanvas, presetCopy);\r\n\r\n            if (settingsObj.channels === 'alpha') {\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n            } else {\r\n                ctx.globalCompositeOperation = settingsObj.mixModeStr;\r\n            }\r\n\r\n            ctx.drawImage(fxCanvas, 0, 0);\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            presetOptions.destroy();\r\n            scaleSlider.destroy();\r\n            opacitySlider.destroy();\r\n            reverseToggle.destroy();\r\n            channelsOptions.destroy();\r\n            texture.destroy();\r\n            blendSelect.destroy();\r\n            klCanvasPreview.destroy();\r\n        };\r\n        result.getInput = function (): TFilterNoiseInput {\r\n            result.destroy!();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterNoiseInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).update();\r\n        texture.destroy();\r\n\r\n        const input = params.input;\r\n\r\n        const presetCopy: INoiseSettings = BB.copyObj(presetArr[input.presetIndex]) as INoiseSettings;\r\n        presetCopy.seed = input.seed;\r\n        presetCopy.scaleX = presetCopy.scaleX  * input.scale / 50;\r\n        presetCopy.scaleY = presetCopy.scaleY  * input.scale / 50;\r\n        presetCopy.colA = input.colA;\r\n        presetCopy.colB = input.colB;\r\n        presetCopy.isReversed = input.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\r\n        presetCopy.channels  = input.channels;\r\n        drawNoise(fxCanvas, presetCopy);\r\n\r\n        context.save();\r\n        context.globalAlpha = input.opacity;\r\n        if (input.channels === 'alpha') {\r\n            context.globalCompositeOperation = 'destination-out';\r\n        } else {\r\n            context.globalCompositeOperation = input.mixModeStr;\r\n        }\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        context.restore();\r\n\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['canvas'],\r\n            action: 'replaceLayer',\r\n            params: [\r\n                klCanvas.getLayerIndex(context.canvas),\r\n                context.getImageData(0, 0, context.canvas.width, context.canvas.height),\r\n            ],\r\n        } as TKlCanvasHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {input} from '../ui/components/input';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {LANG} from '../../language/language';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {TwoTabs} from '../ui/components/two-tabs';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\n\r\nexport type TFilterPatternInput = {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n    blend: number; // [0, 1] - 1 will blend linearly across whole length\r\n    offsetX: number;\r\n    offsetY: number;\r\n};\r\n\r\nexport type TFilterPatternHistoryEntry = TFilterHistoryEntry<\r\n    'pattern',\r\n    TFilterPatternInput>;\r\n\r\n/**\r\n * Draws pattern onto context. Pattern generated from context.\r\n * Can use blending for smoother transition. Will use area outside of bounds for blending.\r\n *\r\n * @param context\r\n * @param settings\r\n */\r\nfunction drawPattern (context: CanvasRenderingContext2D, settings: TFilterPatternInput): void {\r\n\r\n    // keep bounds in center via offset\r\n    // because blending done towards bottom right\r\n    const blendOffsetX = settings.blend ? Math.round(settings.blend * settings.width / 2) : 0;\r\n    const blendOffsetY = settings.blend ? Math.round(settings.blend * settings.height / 2) : 0;\r\n\r\n    const finalPatternCanvas = BB.canvas(settings.width, settings.height);\r\n\r\n    if (settings.blend) {\r\n        // construct pattern via linear blending\r\n\r\n        const blendCanvas = BB.canvas(settings.width * 2, settings.height * 2);\r\n        const blendCtx = BB.ctx(blendCanvas);\r\n        const colTransparent = '#0000';\r\n        const colOpaque = '#000';\r\n\r\n        // transfer source to blendCanvas\r\n        blendCtx.drawImage(\r\n            context.canvas,\r\n            -settings.x + blendOffsetX,\r\n            -settings.y + blendOffsetY,\r\n        );\r\n\r\n        // --- 1 cross-fade vertical ------------------------\r\n\r\n        // erase vertical gradient bottom half\r\n        blendCtx.save();\r\n        let blendGradient = blendCtx.createLinearGradient(0, settings.height, 0, settings.height * 2);\r\n        blendGradient.addColorStop(0, colOpaque);\r\n        blendGradient.addColorStop(settings.blend, colTransparent);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\r\n        blendCtx.restore();\r\n\r\n        // erase vertical gradient top half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(0, 0, 0, settings.height);\r\n        blendGradient.addColorStop(0, colTransparent);\r\n        blendGradient.addColorStop(settings.blend, colOpaque);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\r\n        blendCtx.restore();\r\n\r\n        // draw bottom half over top half\r\n        blendCtx.save();\r\n        // lighter needed for accurate cross-fade\r\n        blendCtx.globalCompositeOperation = 'lighter';\r\n        blendCtx.drawImage(blendCanvas, 0, -settings.height);\r\n        blendCtx.restore();\r\n\r\n\r\n\r\n        // --- 2 cross-fade horizontal ------------------------\r\n\r\n        // erase horizontal gradient right half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(settings.width, 0, settings.width * 2, 0);\r\n        blendGradient.addColorStop(0, colOpaque);\r\n        blendGradient.addColorStop(settings.blend, colTransparent);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\r\n        blendCtx.restore();\r\n\r\n        // erase horizontal gradient left half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(0, 0, settings.width, 0);\r\n        blendGradient.addColorStop(0, colTransparent);\r\n        blendGradient.addColorStop(settings.blend, colOpaque);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\r\n        blendCtx.restore();\r\n\r\n        // draw right half over left half\r\n        blendCtx.save();\r\n        // lighter needed for accurate cross-fade\r\n        blendCtx.globalCompositeOperation = 'lighter';\r\n        blendCtx.drawImage(blendCanvas, -settings.width, 0);\r\n        blendCtx.restore();\r\n\r\n        // transfer to pattern canvas\r\n        BB.ctx(finalPatternCanvas).drawImage(blendCanvas, 0, 0);\r\n\r\n    } else {\r\n        BB.ctx(finalPatternCanvas).drawImage(\r\n            context.canvas,\r\n            -settings.x,\r\n            -settings.y,\r\n        );\r\n    }\r\n\r\n    context.save();\r\n\r\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n    context.translate(settings.offsetX - blendOffsetX, settings.offsetY - blendOffsetY);\r\n    context.fillStyle = throwIfNull(context.createPattern(finalPatternCanvas, 'repeat'));\r\n    context.fillRect(-settings.offsetX + blendOffsetX, -settings.offsetY + blendOffsetY, context.canvas.width, context.canvas.height);\r\n\r\n    context.restore();\r\n}\r\n\r\n\r\nexport const filterPattern = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const maxSize = 1024;\r\n        const rootEl = BB.el({\r\n            content: LANG('filter-pattern-description') + '<br><br>',\r\n        });\r\n        const context = params.context;\r\n        const width = context.canvas.width;\r\n        const height = context.canvas.height;\r\n\r\n        let settings: TFilterPatternInput = {\r\n            x: 0,\r\n            y: 0,\r\n            width: width <= 250 ? Math.round(width / 4) : 200,\r\n            height: height <= 250 ? Math.round(height / 4) : 200,\r\n            blend: 0,\r\n            offsetX: 0,\r\n            offsetY: 0,\r\n        };\r\n        let lastDrawnSettings: TFilterPatternInput | undefined;\r\n\r\n        // determine bounds\r\n        const bounds = BB.canvasBounds(context);\r\n        // adjust settings according to bounds\r\n        if ( // use layer bounds if:\r\n            bounds &&\r\n            (bounds.width <= maxSize && bounds.height <= maxSize) && // don't exceed max size\r\n            (bounds.width < width * 0.75 || bounds.height < height * 0.75) // aren't too large (heuristic)\r\n        ) {\r\n            settings.x = bounds.x;\r\n            settings.y = bounds.y;\r\n            settings.width = bounds.width;\r\n            settings.height = bounds.height;\r\n        } else { // otherwise use default size in center\r\n            settings.x = Math.round(width / 2 - settings.width / 2);\r\n            settings.y = Math.round(height / 2 - settings.height / 2);\r\n        }\r\n\r\n        // ---- controls ----\r\n\r\n        const xInput = input({\r\n            init: settings.x,\r\n            type: 'number',\r\n            min: 0,\r\n            max: width,\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.x = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const yInput = input({\r\n            init: settings.y,\r\n            type: 'number',\r\n            min: 0,\r\n            max: height,\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.y = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const widthInput = input({\r\n            init: settings.width,\r\n            type: 'number',\r\n            min: 1,\r\n            max: Math.min(maxSize, width),\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.width = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const heightInput = input({\r\n            init: settings.height,\r\n            type: 'number',\r\n            min: 1,\r\n            max: Math.min(maxSize, height),\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.height = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const inputStyle = {\r\n            marginLeft: '5px',\r\n            flex: '1',\r\n        };\r\n        rootEl.append(\r\n            BB.el({\r\n               content: [\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           'X:',\r\n                           xInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           'Y:',\r\n                           yInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           LANG('width') + ':',\r\n                           widthInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           LANG('height') + ':',\r\n                           heightInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n               ],\r\n               css: {\r\n                   display: 'flex',\r\n                   marginLeft: '-5px',\r\n               },\r\n            }),\r\n        );\r\n\r\n\r\n        const blendSlider = new KlSlider({\r\n            label: LANG('brush-blending'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 0,\r\n            max: 1,\r\n            value: settings.blend,\r\n            eventResMs: eventResMs,\r\n            onChange: function (val) {\r\n                settings.blend = val;\r\n                updatePreview();\r\n            },\r\n            formatFunc: (val) => {\r\n                return BB.round(val, 2);\r\n            },\r\n            manualInputRoundDigits: 2,\r\n        });\r\n        BB.css(blendSlider.getElement(), {\r\n            margin: '10px 0',\r\n        });\r\n\r\n        rootEl.append(\r\n            blendSlider.getElement(),\r\n        );\r\n\r\n        // ---- preview tabs ----\r\n        let previewMode = 1; // 0 before, 1 after\r\n        const beforeAfterTabs = new TwoTabs({\r\n            left: LANG('compare-before'),\r\n            right: LANG('compare-after'),\r\n            init: previewMode,\r\n            onChange: (val) => {\r\n                previewMode = val;\r\n                overlayCanvas.style.display = val === 0 ? 'block' : 'none';\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        rootEl.append(beforeAfterTabs.getElement());\r\n\r\n        // ---- previews ----\r\n\r\n        const klCanvas = params.klCanvas;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        // const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                height: isSmall ? '260px' : '300px',\r\n                marginTop: '0',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            isVisible: layers[selectedLayerIndex].isVisible,\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const previewLayerArr = layers.map((item, i) => {\r\n            if (i === selectedLayerIndex) {\r\n                return previewLayer;\r\n            } else {\r\n                return {\r\n                    image: item.context.canvas,\r\n                    isVisible: item.isVisible,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                };\r\n            }\r\n        });\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const overlayCanvas = BB.canvas(w, h);\r\n        BB.css(overlayCanvas, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            mixBlendMode: 'difference',\r\n            imageRendering: 'pixelated',\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(\r\n            klCanvasPreview.getElement(),\r\n            overlayCanvas\r\n        );\r\n        previewWrapper.append(previewInnerWrapper);\r\n        rootEl.append(previewWrapper);\r\n\r\n\r\n        // ---- preview input processing ----\r\n        const inputs = {} as {\r\n            start: IVector2D;\r\n            end: IVector2D | null;\r\n            oldSettings: TFilterPatternInput;\r\n            state: null | 'move' | 'select';\r\n        };\r\n\r\n        function syncInputs (): void {\r\n            xInput.value = '' + settings.x;\r\n            yInput.value = '' + settings.y;\r\n            widthInput.value = '' + settings.width;\r\n            heightInput.value = '' + settings.height;\r\n        }\r\n\r\n        const keyListener = new BB.KeyListener({\r\n        });\r\n\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        previewInnerWrapper.style.touchAction = 'none';\r\n        const pointerListener = new BB.PointerListener({\r\n            target: previewInnerWrapper,\r\n            onPointer: (event) => {\r\n                if (previewMode === 0) {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (!inputs.state) {\r\n                            inputs.oldSettings = BB.copyObj(settings);\r\n\r\n                            const x = event.relX / previewFactor;\r\n                            const y = event.relY / previewFactor;\r\n\r\n                            if (BB.isInsideRect(\r\n                                {x, y},\r\n                                {x: settings.x, y: settings.y, width: settings.width, height: settings.height},\r\n                            )) {\r\n                                inputs.state = 'move';\r\n                            } else {\r\n                                inputs.state = 'select';\r\n                            }\r\n                            inputs.start = {x, y};\r\n                        }\r\n                    } else if (event.type === 'pointermove') {\r\n\r\n                        const x = event.relX / previewFactor;\r\n                        const y = event.relY / previewFactor;\r\n\r\n                        if (inputs.state === 'select') {\r\n                            inputs.end = {x, y};\r\n\r\n                            const x1 = Math.max(0, Math.min(inputs.start.x, inputs.end.x));\r\n                            const y1 = Math.max(0, Math.min(inputs.start.y, inputs.end.y));\r\n                            const x2 = Math.min(width, Math.max(inputs.start.x, inputs.end.x));\r\n                            const y2 = Math.min(height, Math.max(inputs.start.y, inputs.end.y));\r\n\r\n                            settings.x = Math.floor(x1);\r\n                            settings.y = Math.floor(y1);\r\n                            settings.width = Math.min(maxSize, Math.ceil(x2 - settings.x));\r\n                            settings.height = Math.min(maxSize, Math.ceil(y2 - settings.y));\r\n\r\n                            if (keyListener.isPressed('shift')) {\r\n                                settings.width = Math.min(settings.width, settings.height);\r\n                                settings.height = Math.min(settings.width, settings.height);\r\n                            }\r\n\r\n                            if (settings.width === 0 || settings.height === 0) {\r\n                                settings = BB.copyObj(inputs.oldSettings);\r\n                            }\r\n\r\n                            syncInputs();\r\n                            updatePreview();\r\n                        } else if (inputs.state === 'move') {\r\n                            const dX = Math.round(x - inputs.start.x);\r\n                            const dY = Math.round(y - inputs.start.y);\r\n\r\n                            settings.x = BB.clamp(inputs.oldSettings.x + dX, 0, width - settings.width);\r\n                            settings.y = BB.clamp(inputs.oldSettings.y + dY, 0, height - settings.height);\r\n\r\n                            syncInputs();\r\n                            updatePreview();\r\n                        }\r\n                    } else if (event.type === 'pointerup') {\r\n                        if (inputs.state) {\r\n                            inputs.state = null;\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (!inputs.state) {\r\n                            inputs.state = 'move';\r\n                            inputs.oldSettings = BB.copyObj(settings);\r\n                            inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n                            inputs.end = null;\r\n                        }\r\n                    } else if (event.type === 'pointermove') {\r\n                        if (inputs.state) {\r\n                            inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n\r\n                            settings.offsetX = Math.round(inputs.end.x - inputs.start.x) + inputs.oldSettings.offsetX;\r\n                            settings.offsetY = Math.round(inputs.end.y - inputs.start.y) + inputs.oldSettings.offsetY;\r\n\r\n                            updatePreview();\r\n                        }\r\n                    } else if (event.type === 'pointerup') {\r\n                        if (inputs.state) {\r\n                            if (!inputs.end) {\r\n                                settings.offsetX = 0;\r\n                                settings.offsetY = 0;\r\n                                updatePreview();\r\n                            }\r\n                            inputs.state = null;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        // ---------- rendering ---------------------\r\n        const fullSizeCanvas = BB.canvas(width, height);\r\n        const fullSizeCtx = BB.ctx(fullSizeCanvas);\r\n\r\n        function sharpStrokeRect (\r\n            context: CanvasRenderingContext2D,\r\n            x: number,\r\n            y: number,\r\n            width: number,\r\n            height: number\r\n        ): void {\r\n            const drawX = Math.round(x + 0.5) - 0.5;\r\n            const drawY = Math.round(y + 0.5) - 0.5;\r\n            const drawWidth = Math.round(x + width - drawX);\r\n            const drawHeight = Math.round(y + height - drawY);\r\n            context.strokeRect(drawX, drawY, drawWidth, drawHeight);\r\n        }\r\n\r\n        function updatePreview (doForce?: boolean) {\r\n            if (!doForce && lastDrawnSettings && JSON.stringify(lastDrawnSettings) === JSON.stringify(settings)) {\r\n                return;\r\n            }\r\n\r\n            if (previewMode === 0) { // before\r\n                fullSizeCtx.clearRect(0, 0, width, height);\r\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\r\n\r\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\r\n                const previewCtx = BB.ctx(previewCanvas);\r\n                previewCtx.save();\r\n                previewCtx.clearRect(0, 0, renderW, renderH);\r\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\r\n                previewCtx.restore();\r\n\r\n                const pW = settings.width * previewFactor;\r\n                const pH = settings.height * previewFactor;\r\n\r\n                const overlayCtx = BB.ctx(overlayCanvas);\r\n                overlayCtx.save();\r\n                overlayCtx.clearRect(0, 0, w, h);\r\n                overlayCtx.strokeStyle = '#fff';\r\n                sharpStrokeRect(\r\n                    overlayCtx,\r\n                    settings.x * previewFactor,\r\n                    settings.y * previewFactor,\r\n                    pW,\r\n                    pH\r\n                );\r\n                if (settings.blend > 0.05) {\r\n                    overlayCtx.strokeStyle = '#f0f';\r\n                    sharpStrokeRect(\r\n                        overlayCtx,\r\n                        settings.x * previewFactor - pW / 2 * settings.blend,\r\n                        settings.y * previewFactor - pH / 2 * settings.blend,\r\n                        pW * (1 + settings.blend),\r\n                        pH * (1 + settings.blend),\r\n                    );\r\n                }\r\n                overlayCtx.restore();\r\n\r\n\r\n\r\n            } else { // after\r\n                fullSizeCtx.clearRect(0, 0, width, height);\r\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\r\n                drawPattern(fullSizeCtx, settings);\r\n\r\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\r\n                const previewCtx = BB.ctx(previewCanvas);\r\n                previewCtx.clearRect(0, 0, renderW, renderH);\r\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\r\n            }\r\n\r\n\r\n            klCanvasPreview.render();\r\n            lastDrawnSettings = BB.copyObj(settings);\r\n        }\r\n\r\n        updatePreview();\r\n\r\n\r\n        // ----- result -------------------\r\n        const destroy = () => {\r\n            blendSlider.destroy();\r\n            keyListener.destroy();\r\n            pointerListener.destroy();\r\n            klCanvasPreview.destroy();\r\n        };\r\n        const result: IFilterGetDialogResult<TFilterPatternInput> = {\r\n            element: rootEl,\r\n            destroy,\r\n            getInput: () => {\r\n                destroy();\r\n                return BB.copyObj(settings);\r\n            },\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 540;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterPatternInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const ctx = params.context;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        drawPattern(ctx, params.input);\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'pattern'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterPatternHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {LANG} from '../../language/language';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {Options} from '../ui/components/options';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {throwIfNull} from '../../bb/base/base';\r\nimport {TFilterDistortSettings} from '../../fx-canvas/filters/distort';\r\n\r\n\r\n// see fx-canvas distort\r\nexport type TFilterDistortInput = {\r\n    stepSize: number; // [0, inf]\r\n    distortType: 0 | 1 | 2;\r\n    scale: { x: number; y: number };\r\n    strength: { x: number; y: number };\r\n    phase: { x: number; y: number };\r\n};\r\n\r\nexport type TFilterDistortHistoryEntry = TFilterHistoryEntry<\r\n    'distort',\r\n    TFilterDistortInput>;\r\n\r\nexport const filterDistort = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const rootEl = BB.el({\r\n            content: LANG('filter-distort-description') + '<br><br>',\r\n        });\r\n        const context = params.context;\r\n\r\n        let isSynced = true;\r\n        const settings: TFilterDistortInput = {\r\n            distortType: 0,\r\n            scale: {x: 100, y: 100},\r\n            strength: {x: 20, y: 20},\r\n            phase: {x: 0, y: 0},\r\n            stepSize: 1,\r\n        };\r\n        // let lastDrawnSettings = null;\r\n\r\n        // ---- thumb -------\r\n        const thumbImgArr: HTMLImageElement[] = [];\r\n        const thumbSize = 32;\r\n        {\r\n            const canvas = BB.canvas(thumbSize, thumbSize);\r\n            const ctx = BB.ctx(canvas);\r\n\r\n            ctx.beginPath();\r\n            ctx.arc(thumbSize / 2, thumbSize / 2, thumbSize / 2.5, 0, Math.PI * 2);\r\n            ctx.fill();\r\n\r\n            let gradient = ctx.createLinearGradient(0, 0, thumbSize, thumbSize);\r\n            gradient.addColorStop(0, '#00f');\r\n            gradient.addColorStop(0.5, '#f00');\r\n            gradient.addColorStop(1, '#fff');\r\n            ctx.fillStyle = gradient;\r\n            ctx.globalCompositeOperation = 'source-atop';\r\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\r\n\r\n            gradient = ctx.createLinearGradient(thumbSize, 0, 0, thumbSize);\r\n            gradient.addColorStop(0, '#000');\r\n            gradient.addColorStop(1, '#000');\r\n            ctx.fillStyle = gradient;\r\n            ctx.globalCompositeOperation = 'destination-atop';\r\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\r\n\r\n            const fxCanvas = throwIfNull(getSharedFx());\r\n            const texture = fxCanvas.texture(canvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const scaleFactor = 20;\r\n\r\n            ([0, 1, 2] as const).forEach(item => {\r\n                const thumbImg = new Image();\r\n                const settingsCopy: TFilterDistortSettings = BB.copyObj(settings);\r\n                settingsCopy.distortType = item;\r\n                settingsCopy.scale.x /= scaleFactor;\r\n                settingsCopy.scale.y /= scaleFactor;\r\n                settingsCopy.strength.x /= scaleFactor;\r\n                settingsCopy.strength.y /= scaleFactor;\r\n                fxCanvas.draw(texture).multiplyAlpha().distort(settingsCopy).unmultiplyAlpha().update();\r\n                ctx.clearRect(0, 0, thumbSize, thumbSize);\r\n                ctx.drawImage(fxCanvas, 0, 0);\r\n                thumbImg.src = canvas.toDataURL('image/png');\r\n                thumbImgArr.push(thumbImg);\r\n            });\r\n\r\n            texture.destroy();\r\n        }\r\n\r\n\r\n        // ---- controls ----\r\n\r\n        const topRowEl = BB.el({\r\n            parent: rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n\r\n        const typeOptions = new Options({\r\n            optionArr: thumbImgArr.map((img, index) => {\r\n                BB.css(img, {\r\n                    margin: '1px',\r\n                    borderRadius: '3px',\r\n                    transition: 'all 0.1s ease-in-out',\r\n                });\r\n                return {\r\n                    id: '' + index,\r\n                    label: img,\r\n                };\r\n            }),\r\n            initId: '0',\r\n            onChange: (id) => {\r\n                settings.distortType = Number(id) as TFilterDistortSettings['distortType'];\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        function sync (from: 'x' | 'y') {\r\n            if (from === 'x') {\r\n                settings.scale.y = (settings.scale.x);\r\n                settings.strength.y = (settings.strength.x);\r\n                settings.phase.y = (settings.phase.x);\r\n\r\n                sliderArr[3].setValue(settings.scale.y);\r\n                sliderArr[4].setValue(settings.strength.y);\r\n                sliderArr[5].setValue(settings.phase.y);\r\n            } else {\r\n                settings.scale.x = (settings.scale.y);\r\n                settings.strength.x = (settings.strength.y);\r\n                settings.phase.x = (settings.phase.y);\r\n\r\n                sliderArr[0].setValue(settings.scale.x);\r\n                sliderArr[1].setValue(settings.strength.x);\r\n                sliderArr[2].setValue(settings.phase.x);\r\n            }\r\n            updatePreview();\r\n        }\r\n\r\n        const syncToggle = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-distort-sync-xy'),\r\n            callback: (val) => {\r\n                isSynced = val;\r\n                if (isSynced) {\r\n                    sync('x');\r\n                }\r\n            },\r\n        });\r\n\r\n        topRowEl.append(\r\n            typeOptions.getElement(),\r\n            BB.el({css: {flexGrow: '1'}}),\r\n            syncToggle.getElement(),\r\n        );\r\n\r\n        const xyRowEl = BB.el({\r\n            parent: rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n            },\r\n        });\r\n        const leftCol = BB.el({\r\n            parent: xyRowEl,\r\n            css: {\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n        const rightCol = BB.el({parent: xyRowEl});\r\n\r\n        const sliderWidth = isSmall ? 300 : 245;\r\n        const sliderArr: KlSlider[] = [];\r\n\r\n        (['x', 'y'] as const).forEach((item, index) => {\r\n            const targetEl = index === 0 ? leftCol : rightCol;\r\n\r\n            const scaleSlider = new KlSlider({\r\n                label: LANG('filter-noise-scale') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 1,\r\n                max: 1000,\r\n                curve: 'quadratic',\r\n                value: settings.scale[item],\r\n                eventResMs: eventResMs,\r\n                onChange: (val) => {\r\n                    settings.scale[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                },\r\n            });\r\n            scaleSlider.getElement().style.marginTop = '20px';\r\n            targetEl.append(scaleSlider.getElement());\r\n\r\n            const strengthSlider = new KlSlider({\r\n                label: LANG('filter-unsharp-mask-strength') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                curve: 'quadratic',\r\n                value: settings.strength[item],\r\n                eventResMs: eventResMs,\r\n                onChange: (val) => {\r\n                    settings.strength[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                },\r\n            });\r\n            strengthSlider.getElement().style.marginTop = '10px';\r\n            targetEl.append(strengthSlider.getElement());\r\n\r\n            const phaseSlider = new KlSlider({\r\n                label: LANG('filter-distort-phase') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: settings.phase[item],\r\n                manualInputRoundDigits: 2,\r\n                eventResMs: eventResMs,\r\n                formatFunc: (val) => BB.round(val, 2),\r\n                onChange: (val) => {\r\n                    settings.phase[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                },\r\n            });\r\n            phaseSlider.getElement().style.marginTop = '10px';\r\n            targetEl.append(phaseSlider.getElement());\r\n\r\n            sliderArr.push(scaleSlider);\r\n            sliderArr.push(strengthSlider);\r\n            sliderArr.push(phaseSlider);\r\n        });\r\n\r\n        const stepSlider = new KlSlider({\r\n            label: LANG('filter-distort-stepsize'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1,\r\n            max: 300,\r\n            curve: 'quadratic',\r\n            value: settings.stepSize,\r\n            eventResMs: eventResMs,\r\n            onChange: (val) => {\r\n                settings.stepSize = Math.round(val);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        stepSlider.getElement().style.marginTop = '20px';\r\n        rootEl.append(stepSlider.getElement());\r\n\r\n\r\n        // ---- preview ----\r\n\r\n        const klCanvas = params.klCanvas;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        // const renderW = Math.min(w, context.canvas.width);\r\n        // const renderH = Math.min(h, context.canvas.height);\r\n        // const renderFactor = renderW / context.canvas.width;\r\n        // const previewFactor = w / context.canvas.width;\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                height: isSmall ? '260px' : '300px',\r\n            },\r\n        });\r\n\r\n        const fxCanvas = throwIfNull(getSharedFx());\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: fxCanvas,\r\n            isVisible: layers[selectedLayerIndex].isVisible,\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const previewLayerArr = layers.map((item, i) => {\r\n            if (i === selectedLayerIndex) {\r\n                return previewLayer;\r\n            } else {\r\n                return {\r\n                    image: item.context.canvas,\r\n                    isVisible: item.isVisible,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                };\r\n            }\r\n        });\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n        rootEl.append(previewWrapper);\r\n\r\n        // ---------- rendering ---------------------\r\n\r\n        function updatePreview (): void {\r\n            fxCanvas.draw(texture).multiplyAlpha().distort(settings).unmultiplyAlpha().update();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n\r\n        const destroy = () => {\r\n            typeOptions.destroy();\r\n            sliderArr.forEach(item => item.destroy());\r\n            stepSlider.destroy();\r\n            syncToggle.destroy();\r\n            texture.destroy();\r\n            klCanvasPreview.destroy();\r\n        };\r\n\r\n        // ----- result -------------------\r\n        const result: IFilterGetDialogResult<TFilterDistortInput> = {\r\n            element: rootEl,\r\n            destroy,\r\n            getInput: () => {\r\n                destroy();\r\n                return BB.copyObj(settings);\r\n            },\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 540;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterDistortInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).multiplyAlpha().distort(params.input).unmultiplyAlpha().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'distort'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterDistortHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, IRGB} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {input} from '../ui/components/input';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {drawVanishPoint} from '../image-operations/draw-vanish-point';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\nexport type TFilterVanishPointInput = {\r\n    x: number;\r\n    y: number;\r\n    lines: number;\r\n    thickness: number;\r\n    color: IRGB;\r\n    opacity: number;\r\n};\r\n\r\nexport type TFilterVanishPointHistoryEntry = TFilterHistoryEntry<\r\n    'vanishPoint',\r\n    TFilterVanishPointInput>;\r\n\r\nexport const filterVanishPoint = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterVanishPointInput> = {\r\n            element: div,\r\n        };\r\n        div.innerHTML = LANG('filter-vanish-point-description') + '<br/><br/>';\r\n\r\n        const settingsObj: TFilterVanishPointInput = {\r\n            x: context.canvas.width / 2,\r\n            y: context.canvas.height / 2,\r\n            lines: 8,\r\n            thickness: 2,\r\n            color: {r: 0, g: 0, b: 0},\r\n            opacity: 1,\r\n        };\r\n\r\n        const linesSlider = new KlSlider({\r\n            label: LANG('filter-vanish-point-lines'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 2,\r\n            max: 20,\r\n            value: settingsObj.lines,\r\n            curve: 'quadratic',\r\n            eventResMs: eventResMs,\r\n            onChange: function (val) {\r\n                settingsObj.lines = Math.round(val);\r\n                updatePreview();\r\n            },\r\n        });\r\n        linesSlider.getElement().style.marginBottom = '10px';\r\n        div.append(linesSlider.getElement());\r\n\r\n        const line1 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        const line2 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n        const xInput = input({\r\n            init: settingsObj.x,\r\n            type: 'number',\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.x = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const yInput = input({\r\n            init: settingsObj.y,\r\n            type: 'number',\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.y = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const thicknessInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.thickness = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n        settingsObj.color = BB.copyObj(selectedRgbaObj);\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('shape-stroke'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function (rgbaObj) {\r\n                selectedRgbaObj = rgbaObj!;\r\n                settingsObj.color = BB.copyObj(selectedRgbaObj);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            marginRight: '5px',\r\n        };\r\n        line1.append(\r\n            BB.el({content: 'X:', css: labelStyle}),\r\n            xInput,\r\n            BB.el({content: 'Y:', css: labelStyle}),\r\n            yInput,\r\n        );\r\n        line2.append(\r\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\r\n            thicknessInput,\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorOptions.getElement(),\r\n        );\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            isVisible: layers[selectedLayerIndex].isVisible,\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        isVisible: item.isVisible,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            }),\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n                cursor: 'move',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n\r\n        // ---- preview input processing ----\r\n        const inputs = {} as {\r\n            start: IVector2D;\r\n            end: IVector2D | null;\r\n            state: null | 'move';\r\n            oldSettings: TFilterVanishPointInput;\r\n        };\r\n        function syncInputs (): void {\r\n            xInput.value = '' + settingsObj.x;\r\n            yInput.value = '' + settingsObj.y;\r\n        }\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        previewInnerWrapper.style.touchAction = 'none';\r\n        const pointerListener = new BB.PointerListener({\r\n            target: previewInnerWrapper,\r\n            onPointer: (event) => {\r\n                if (event.type === 'pointerdown') {\r\n                    if (!inputs.state) {\r\n                        inputs.state = 'move';\r\n                        inputs.oldSettings = BB.copyObj(settingsObj);\r\n                        inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n                        inputs.end = null;\r\n                    }\r\n                } else if (event.type === 'pointermove') {\r\n                    if (inputs.state) {\r\n                        inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n\r\n                        settingsObj.x = Math.round(inputs.end.x - inputs.start.x + inputs.oldSettings.x);\r\n                        settingsObj.y = Math.round(inputs.end.y - inputs.start.y + inputs.oldSettings.y);\r\n\r\n                        syncInputs();\r\n                        updatePreview();\r\n                    }\r\n                } else if (event.type === 'pointerup') {\r\n                    if (inputs.state) {\r\n                        inputs.state = null;\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n            drawVanishPoint(\r\n                ctx,\r\n                settingsObj.x * renderFactor,\r\n                settingsObj.y * renderFactor,\r\n                settingsObj.lines,\r\n                Math.max(settingsObj.thickness * renderFactor, 1),\r\n                settingsObj.color,\r\n                settingsObj.opacity,\r\n            );\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = () => {\r\n            linesSlider.destroy();\r\n            pointerListener.destroy();\r\n            klCanvasPreview.destroy();\r\n            colorOptions.destroy();\r\n        };\r\n        result.getInput = function (): TFilterVanishPointInput {\r\n            result.destroy!();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterVanishPointInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        drawVanishPoint(\r\n            context,\r\n            params.input.x,\r\n            params.input.y,\r\n            params.input.lines,\r\n            params.input.thickness,\r\n            params.input.color,\r\n            params.input.opacity,\r\n        );\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['filter', 'vanishPoint'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterVanishPointHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {drawShape} from './shape-tool';\r\nimport {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl-types';\r\n\r\nexport function drawVanishPoint (\r\n    ctx: CanvasRenderingContext2D,\r\n    x: number,\r\n    y: number,\r\n    lines: number, // int, [2, inf]\r\n    thickness: number, // px\r\n    color: IRGB,\r\n    opacity: number, // 0 - 1\r\n): void {\r\n    ctx.save();\r\n\r\n    const degIncrement = 180 / lines;\r\n    for (let deg = 0; deg < 180; deg += degIncrement) {\r\n        const p2 = BB.rotateAround({x, y}, {x: x + 9999, y}, deg);\r\n        drawShape(\r\n            ctx,\r\n            {\r\n                type: 'line',\r\n                x1: x,\r\n                y1: y,\r\n                x2: p2.x,\r\n                y2: p2.y,\r\n                //angleRad: 0,\r\n                isOutwards: true,\r\n                opacity,\r\n                //isEraser: false,\r\n                strokeRgb: color,\r\n                lineWidth: thickness,\r\n                //doLockAlpha: false,\r\n            }\r\n        );\r\n    }\r\n\r\n    ctx.restore();\r\n}","import {KL} from '../kl';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {Psd} from 'ag-psd/dist/psd';\r\nimport {loadAgPsd} from './load-ag-psd';\r\n\r\nexport async function klCanvasToPsdBlob (klCanvas: KlCanvas): Promise<Blob> {\r\n    const layerArr = klCanvas.getLayersFast();\r\n\r\n    const psdConfig: Psd = {\r\n        width: klCanvas.getWidth(),\r\n        height: klCanvas.getHeight(),\r\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\r\n        children: layerArr.map(item => {\r\n            // todo - can be optimized if layer mostly empty\r\n            return {\r\n                name: item.name,\r\n                hidden: !item.isVisible,\r\n                opacity: item.opacity,\r\n                canvas: item.canvas,\r\n                blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n                left: 0,\r\n                top: 0,\r\n            };\r\n        }),\r\n    };\r\n\r\n    const agPsd = await loadAgPsd();\r\n    const buffer = agPsd.writePsdBuffer(psdConfig);\r\n    return new Blob([buffer], { type: 'application/octet-stream' });\r\n}","import {BB} from '../../bb/bb';\r\nimport {IDrawMoveEvent, TDrawEvent} from '../kl-types';\r\n\r\n/**\r\n * Line smoothing. EventChain element. Smoothing via blending new position with old position.\r\n * for onDraw events from KlCanvasWorkspace.\r\n *\r\n * in some draw event\r\n * out some draw event\r\n *\r\n * type: 'line' Events are just passed through.\r\n */\r\nexport class LineSmoothing {\r\n\r\n    private chainOut: ((drawEvent: TDrawEvent) => void) | undefined;\r\n    private smoothing: number;\r\n    private lastMixedInput: {\r\n        x: number;\r\n        y: number;\r\n        pressure: number;\r\n    } | undefined;\r\n    private interval: ReturnType<typeof setInterval> | undefined;\r\n    private timeout: ReturnType<typeof setTimeout> | undefined;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            smoothing: number; // 0-1, 0: no smoothing, 1: 100% smoothing -> would never catch up\r\n        }\r\n    ) {\r\n        this.smoothing = BB.clamp(p.smoothing, 0, 1);\r\n    }\r\n\r\n    chainIn (event: TDrawEvent): TDrawEvent | null {\r\n        event = BB.copyObj(event);\r\n        this.timeout && clearTimeout(this.timeout);\r\n        this.interval && clearInterval(this.interval);\r\n\r\n        if (event.type === 'down') {\r\n            this.lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure,\r\n            };\r\n        }\r\n\r\n        if (event.type === 'move') {\r\n\r\n            const inputX = event.x;\r\n            const inputY = event.y;\r\n            const inputPressure = event.pressure;\r\n\r\n            event.x = BB.mix(event.x, this.lastMixedInput!.x, this.smoothing);\r\n            event.y = BB.mix(event.y, this.lastMixedInput!.y, this.smoothing);\r\n            event.pressure = BB.mix(event.pressure, this.lastMixedInput!.pressure, this.smoothing);\r\n            this.lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure,\r\n            };\r\n\r\n            if (this.smoothing > 0) {\r\n                this.timeout = setTimeout(() => {\r\n                    this.interval = setInterval(() => {\r\n                        event = JSON.parse(JSON.stringify(event)) as IDrawMoveEvent;\r\n\r\n                        event.x = BB.mix(inputX, this.lastMixedInput!.x, this.smoothing);\r\n                        event.y = BB.mix(inputY, this.lastMixedInput!.y, this.smoothing);\r\n                        event.pressure = BB.mix(inputPressure, this.lastMixedInput!.pressure, this.smoothing);\r\n                        this.lastMixedInput = {\r\n                            x: event.x,\r\n                            y: event.y,\r\n                            pressure: event.pressure,\r\n                        };\r\n\r\n                        this.chainOut && this.chainOut(event);\r\n                    }, 35);\r\n                }, 80);\r\n            }\r\n\r\n        }\r\n\r\n        return event;\r\n    }\r\n\r\n    setChainOut (func: (drawEvent: TDrawEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    setSmoothing (s: number): void {\r\n        this.smoothing = BB.clamp(s, 0, 1);\r\n    }\r\n}\r\n","import {TDrawEvent} from '../kl-types';\r\n\r\n/**\r\n * cleans up DrawEvents. More trustworthy events. EventChain element\r\n *\r\n * in some draw event?\r\n * out some draw event?\r\n *\r\n * that events can only go line this: down -> n x move -> up\r\n * so, sanitizes this: down, down, down. becomes only one down. the other downs are ignored/swallowed\r\n */\r\nexport class LineSanitizer {\r\n\r\n    private chainOut: ((drawEvent: TDrawEvent) => void) | undefined;\r\n    private isDrawing: boolean = false;\r\n\r\n    // --- public ---\r\n\r\n    chainIn (event: TDrawEvent): TDrawEvent | null {\r\n\r\n        if (event.type === 'down') {\r\n            if (this.isDrawing) {\r\n                //console.log('line sanitizer - down, but already drawing');\r\n                this.chainOut && this.chainOut({\r\n                    type: 'up',\r\n                    scale: event.scale,\r\n                    shiftIsPressed: event.shiftIsPressed,\r\n                    isCoalesced: false,\r\n                });\r\n            } else {\r\n                this.isDrawing = true;\r\n            }\r\n        }\r\n        if (!this.isDrawing && (event.type === 'move' || event.type === 'up')) {\r\n            //console.log('line sanitizer - ' + event.type + ' but not drawing');\r\n            return null;\r\n        }\r\n\r\n        if (event.type === 'up' && this.isDrawing) {\r\n            this.isDrawing = false;\r\n        }\r\n\r\n        return event;\r\n    }\r\n\r\n    setChainOut (func: (drawEvent: TDrawEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n}\r\n","/**\r\n * from stabilizer dropdown value to line-smoothing value\r\n * @param s\r\n */\r\nexport function translateSmoothing (s: number): number {\r\n    if (s == 1) {\r\n        return 1 - 0.5;\r\n    }\r\n    if (s == 2) {\r\n        return 1 - 0.16;\r\n    }\r\n    if (s == 3) {\r\n        return 1 - 0.035;\r\n    }\r\n    if (s == 4) {\r\n        return 1 - 0.0175;\r\n    }\r\n    if (s == 5) {\r\n        return 1 - 0.00875;\r\n    }\r\n    return s;\r\n}","import {IKlPsd, IRGB, TDropOption, TKlCanvasLayer} from '../klecks/kl-types';\r\nimport {KL} from '../klecks/kl';\r\nimport {LANG} from '../language/language';\r\nimport {BB} from '../bb/bb';\r\nimport {klHistory, TMiscImportImageHistoryEntry} from '../klecks/history/kl-history';\r\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\r\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\r\nimport {HandUi} from '../klecks/ui/tool-tabs/hand-ui';\r\nimport {LayerManager} from '../klecks/ui/tool-tabs/layer-manager/layer-manager';\r\nimport {IRect, ISize2D} from '../bb/bb-types';\r\nimport {throwIfNull, throwIfUndefined} from '../bb/base/base';\r\n\r\n// todo later:\r\n// onImage: (project: IKlProject) => void\r\n// onLayer: (index: number, canvas: HMTLCanvasElement,layerName: string) => void\r\n\r\nexport class ImportHandler {\r\n\r\n    private readonly klRootEl: HTMLElement;\r\n    private readonly klMaxCanvasSize: number;\r\n    private readonly layerManager: LayerManager;\r\n    private readonly setCurrentLayer: (layer: TKlCanvasLayer) => void;\r\n    private readonly klCanvas: KlCanvas;\r\n    private readonly klCanvasWorkspace: KlCanvasWorkspace;\r\n    private readonly handUi: HandUi;\r\n\r\n    private readonly onColor: (rgb: IRGB) => void;\r\n\r\n\r\n    /**\r\n     *\r\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\r\n     * @param filename - string e.g. 'drawing.psd'\r\n     * @param optionStr? - 'default' | 'layer' | 'image'\r\n     */\r\n    private importFinishedLoading (\r\n        importedImage: IKlPsd | {\r\n            type: 'image';\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLCanvasElement | HTMLImageElement;\r\n        },\r\n        filename: string | undefined,\r\n        optionStr: 'default' | 'layer' | 'image',\r\n    ): void {\r\n        if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: LANG('import-broken-file'),\r\n                buttons: ['Ok'],\r\n            });\r\n            return;\r\n        }\r\n\r\n        const getResizedDimensions = (width: number, height: number): ISize2D => {\r\n            let w = parseInt('' + width);\r\n            let h = parseInt('' + height);\r\n            if (w > this.klMaxCanvasSize) {\r\n                h = this.klMaxCanvasSize / w * h;\r\n                w = this.klMaxCanvasSize;\r\n            }\r\n            if (h > this.klMaxCanvasSize) {\r\n                w = this.klMaxCanvasSize / h * w;\r\n                h = this.klMaxCanvasSize;\r\n            }\r\n            w = parseInt('' + w);\r\n            h = parseInt('' + h);\r\n            return {\r\n                width: w,\r\n                height: h,\r\n            };\r\n        };\r\n\r\n        const importAsImage = (canvas: HTMLCanvasElement | HTMLImageElement) => {\r\n            const resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\r\n\r\n            //resize first\r\n            const tempCanvas = BB.canvas(canvas.width, canvas.height);\r\n            const tempCanvasCtx = BB.ctx(tempCanvas);\r\n            tempCanvasCtx.drawImage(canvas, 0, 0);\r\n\r\n            BB.resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\r\n\r\n            this.klCanvas.reset({\r\n                width: resizedDimensions.width,\r\n                height: resizedDimensions.height,\r\n                image: tempCanvas,\r\n                layerName: filename,\r\n            });\r\n\r\n            this.layerManager.update(0);\r\n            this.setCurrentLayer(this.klCanvas.getLayer(0)!);\r\n            this.klCanvasWorkspace.resetOrFitView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        };\r\n\r\n        /**\r\n         *\r\n         * @param convertedPsdObj - if flattened then without layers\r\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\r\n         */\r\n        const importAsImagePsd = (convertedPsdObj: IKlPsd, cropObj?: IRect) => {\r\n            // crop\r\n            const crop = (\r\n                targetCanvas: HTMLCanvasElement,\r\n                cropCanvas: HTMLCanvasElement,\r\n                cropObj: IRect,\r\n            ): void => {\r\n                // eslint-disable-next-line no-self-assign\r\n                cropCanvas.width = cropCanvas.width;\r\n                BB.ctx(cropCanvas).drawImage(targetCanvas, -cropObj.x, -cropObj.y);\r\n                targetCanvas.width = cropObj.width;\r\n                targetCanvas.height = cropObj.height;\r\n                BB.ctx(targetCanvas).drawImage(cropCanvas, 0, 0);\r\n            };\r\n            if (cropObj && (cropObj.width !== convertedPsdObj.width ||cropObj.height !== convertedPsdObj.height)) {\r\n                const cropCanvas = BB.canvas(cropObj.width, cropObj.height);\r\n                convertedPsdObj.width = cropObj.width;\r\n                convertedPsdObj.height = cropObj.height;\r\n\r\n                if (!convertedPsdObj.layers) {\r\n                    crop(convertedPsdObj.canvas, cropCanvas, cropObj);\r\n                }\r\n                if (convertedPsdObj.layers) {\r\n                    for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                        const item = convertedPsdObj.layers[i];\r\n                        crop(item.image, cropCanvas, cropObj);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // resize\r\n            const resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\r\n            convertedPsdObj.width = resizedDimensions.width;\r\n            convertedPsdObj.height = resizedDimensions.height;\r\n            if (!convertedPsdObj.layers) {\r\n                BB.resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\r\n            }\r\n            if (convertedPsdObj.layers) {\r\n                for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                    const item = convertedPsdObj.layers[i];\r\n                    BB.resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\r\n                }\r\n            }\r\n\r\n            let layerIndex;\r\n            if (convertedPsdObj.layers) {\r\n                layerIndex = this.klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    layers: convertedPsdObj.layers,\r\n                });\r\n            } else {\r\n                layerIndex = this.klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    image: convertedPsdObj.canvas,\r\n                });\r\n            }\r\n            this.layerManager.update(layerIndex);\r\n            this.setCurrentLayer(throwIfNull(this.klCanvas.getLayer(layerIndex)));\r\n            this.klCanvasWorkspace.resetOrFitView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        };\r\n\r\n        const importAsLayer = (canvas: HTMLCanvasElement | HTMLImageElement) => {\r\n            KL.showImportAsLayerDialog({\r\n                target: this.klRootEl,\r\n                klCanvas: this.klCanvas,\r\n                importImage: canvas,\r\n                callback: (transformObj, isPixelated?: boolean) => {\r\n                    if (!transformObj) {\r\n                        return;\r\n                    }\r\n\r\n                    klHistory.pause(true);\r\n                    this.klCanvas.addLayer();\r\n                    const layers = this.klCanvas.getLayers();\r\n                    const activeLayerIndex = layers.length - 1;\r\n                    if (filename) {\r\n                        this.klCanvas.renameLayer(activeLayerIndex, filename);\r\n                    }\r\n                    const activeLayerContext = throwIfNull(this.klCanvas.getLayerContext(activeLayerIndex));\r\n                    BB.drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, undefined, isPixelated);\r\n                    this.setCurrentLayer(throwIfNull(this.klCanvas.getLayer(activeLayerIndex)));\r\n                    this.layerManager.update(activeLayerIndex);\r\n\r\n                    klHistory.pause(false);\r\n\r\n                    klHistory.push({\r\n                        tool: ['misc'],\r\n                        action: 'importImage',\r\n                        params: [BB.copyCanvas(activeLayerContext.canvas), filename],\r\n                    } as TMiscImportImageHistoryEntry);\r\n                },\r\n            });\r\n        };\r\n\r\n\r\n        if (optionStr === 'default' || !optionStr) {\r\n            KL.showImportImageDialog({\r\n                image: importedImage,\r\n                target: this.klRootEl,\r\n                maxSize: this.klMaxCanvasSize,\r\n                callback: (res) => {\r\n                    if (res.type === 'as-image') {\r\n                        importAsImage(res.image);\r\n                    } else if (res.type === 'as-image-psd') {\r\n                        importAsImagePsd(res.image, res.cropObj);\r\n                    } else if (res.type === 'as-layer') {\r\n                        importAsLayer(res.image);\r\n                    } else if (res.type === 'cancel') {\r\n                        // nothing to do\r\n                    }\r\n                },\r\n            });\r\n        }\r\n\r\n        if (optionStr === 'layer') {\r\n            importAsLayer(importedImage.canvas);\r\n        }\r\n        if (optionStr === 'image') {\r\n            if (importedImage.type === 'psd') {\r\n                importAsImagePsd(importedImage);\r\n            } else {\r\n                importAsImage(importedImage.canvas);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        input: {\r\n            klRootEl: HTMLElement;\r\n            klMaxCanvasSize: number;\r\n            layerManager: LayerManager;\r\n            setCurrentLayer: (layer: TKlCanvasLayer) => void;\r\n            klCanvas: KlCanvas;\r\n            klCanvasWorkspace: KlCanvasWorkspace;\r\n            handUi: HandUi;\r\n        },\r\n        callback: {\r\n            onColor: (rgb: IRGB) => void;\r\n        }\r\n    ) {\r\n        this.klRootEl = input.klRootEl;\r\n        this.klMaxCanvasSize = input.klMaxCanvasSize;\r\n        this.layerManager = input.layerManager;\r\n        this.setCurrentLayer = input.setCurrentLayer;\r\n        this.klCanvas = input.klCanvas;\r\n        this.klCanvasWorkspace = input.klCanvasWorkspace;\r\n        this.handUi = input.handUi;\r\n\r\n        this.onColor = callback.onColor;\r\n    }\r\n\r\n\r\n\r\n    // ---- interface ----\r\n\r\n    onPaste (e: ClipboardEvent): void{\r\n        if (KL.dialogCounter.get() > 0) {\r\n            return;\r\n        }\r\n\r\n        const retrieveImageFromClipboardAsBlob = (\r\n            items: DataTransferItemList,\r\n            callback: (file: File) => void,\r\n        ) => {\r\n            if (!items) {\r\n                return;\r\n            }\r\n            for (let i = 0; i < items.length; i++) {\r\n                if (items[i].type.indexOf('image') == -1) {\r\n                    continue;\r\n                }\r\n                const file = items[i].getAsFile();\r\n                file && callback(file);\r\n            }\r\n        };\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (!e.clipboardData) {\r\n            return;\r\n        }\r\n\r\n        if (e.clipboardData.files[0]) {\r\n            retrieveImageFromClipboardAsBlob(e.clipboardData.items, (imageBlob) => {\r\n                // If there's an image, display it in the canvas\r\n                const img = new Image();\r\n                img.onload = () => {\r\n                    URL.revokeObjectURL(img.src);\r\n                    this.importFinishedLoading({\r\n                        type: 'image',\r\n                        width: img.width,\r\n                        height: img.height,\r\n                        canvas: img,\r\n                    }, undefined, 'default');\r\n                };\r\n                const URLObj = window.URL || window.webkitURL;\r\n                img.src = URLObj.createObjectURL(imageBlob);\r\n            });\r\n        } else if (e.clipboardData.items[0]) {\r\n            e.clipboardData.items[0].getAsString((pasteStr) => {\r\n                pasteStr = pasteStr.trim();\r\n                if (pasteStr.match(/^https?/)) {\r\n                    // url\r\n                    const img = new Image();\r\n                    img.onload = () => {\r\n                        this.importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img,\r\n                        }, undefined, 'default');\r\n                    };\r\n                    img.onerror = (e) => {\r\n                        console.log('error loading', e);\r\n                    };\r\n                    img.crossOrigin = 'Anonymous';\r\n                    img.src = pasteStr;\r\n\r\n                } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\r\n                    // url\r\n                    const rgbObj = BB.ColorConverter.hexToRGB(pasteStr.replace('#', ''));\r\n                    rgbObj && this.onColor(rgbObj);\r\n                }\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    handleFileSelect (files: FileList, optionStr: TDropOption): void {\r\n\r\n        const showWarningPsdFlattened = () => {\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'warning',\r\n                message: LANG('import-psd-unsupported') + '<br /><br />',\r\n                buttons: ['Ok'],\r\n            });\r\n        };\r\n\r\n        let hasUnsupportedFile = false;\r\n        // eslint-disable-next-line no-cond-assign\r\n        for (let i = 0, file; file = files[i]; i++) {\r\n            const nameSplit = file.name.split('.');\r\n            const extension = nameSplit[nameSplit.length - 1].toLowerCase();\r\n            if (extension === 'psd') {\r\n\r\n                ((f) => {\r\n                    const loaderSizeBytes = 1024 * 1024 * 25; // 25mb\r\n                    const maxSizeBytes = 1024 * 1024 * 1024; // 1gb\r\n                    const maxResolution = 4096;\r\n\r\n                    if (f.size >= maxSizeBytes) { // pretty likely to break stuff\r\n                        KL.popup({\r\n                            target: this.klRootEl,\r\n                            type: 'error',\r\n                            message: 'File too big. Unable to import.<br /><br />',\r\n                            buttons: ['Ok'],\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    const doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\r\n                    let loaderIsOpen = true;\r\n                    let closeLoader: (() => void) | null;\r\n\r\n                    if (doShowLoader) {\r\n                        KL.popup({\r\n                            target: this.klRootEl,\r\n                            message: LANG('import-opening'),\r\n                            callback: (result) => {\r\n                                loaderIsOpen = false;\r\n                                closeLoader = null;\r\n                            },\r\n                            closeFunc: (f) => {\r\n                                closeLoader = f;\r\n                            },\r\n                        });\r\n                    }\r\n\r\n\r\n                    const reader = new FileReader();\r\n                    reader.onload = (readerResult) => {\r\n                        const target = throwIfNull(readerResult.target);\r\n\r\n                        KL.loadAgPsd().then((agPsdLazy) => {\r\n\r\n                            if (doShowLoader && !loaderIsOpen) {\r\n                                return;\r\n                            }\r\n\r\n                            try {\r\n                                let psd;\r\n\r\n                                // first pass, only read metadata\r\n                                psd = agPsdLazy.readPsd(\r\n                                    (target.result as any),\r\n                                    {\r\n                                        skipLayerImageData: true,\r\n                                        skipThumbnail: true,\r\n                                        skipCompositeImageData: true,\r\n                                    });\r\n                                if (psd.width > maxResolution || psd.height > maxResolution) {\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    KL.popup({\r\n                                        target: this.klRootEl,\r\n                                        type: 'error',\r\n                                        message: LANG('import-psd-too-large').replace(/{x}/g, '' + maxResolution)\r\n                                            + '<br /><br />'\r\n                                            + LANG('import-psd-size') + ': ' + psd.width + ' x ' + psd.height + ' pixels'\r\n                                            + '<br /><br />'\r\n                                        ,\r\n                                        buttons: ['Ok'],\r\n                                    });\r\n                                    return;\r\n                                }\r\n\r\n\r\n                                // second pass, now load actual data.\r\n                                psd = null;\r\n\r\n                                try {\r\n                                    psd = agPsdLazy.readPsd((target.result as any));\r\n                                } catch (e) {\r\n                                    //console.log('failed regular psd import', e);\r\n                                }\r\n                                if (psd) {\r\n                                    //console.log('psd', psd);\r\n                                    const convertedPsd = KL.PSD.readPsd(psd);\r\n                                    //console.log('converted', convertedPsd);\r\n                                    if (optionStr === 'image' && convertedPsd.error) {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    this.importFinishedLoading(convertedPsd, f.name, optionStr);\r\n                                } else {\r\n                                    psd = agPsdLazy.readPsd((target.result as any), { skipLayerImageData: true, skipThumbnail: true });\r\n\r\n                                    if (optionStr === 'image') {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    this.importFinishedLoading({\r\n                                        type: 'psd',\r\n                                        width: psd.width,\r\n                                        height: psd.height,\r\n                                        canvas: throwIfUndefined(psd.canvas),\r\n                                        error: true,\r\n                                    }, f.name, optionStr);\r\n                                }\r\n\r\n                            } catch (e) {\r\n                                closeLoader && closeLoader();\r\n                                KL.popup({\r\n                                    target: this.klRootEl,\r\n                                    type: 'error',\r\n                                    message: 'Failed to load PSD.<br /><br />',\r\n                                    buttons: ['Ok'],\r\n                                });\r\n                                console.log(e);\r\n                                setTimeout(() => {\r\n                                    throw new Error('psd load error');\r\n                                });\r\n                            }\r\n                        }).catch((e) => {\r\n                            closeLoader && closeLoader();\r\n                            alert('Error: failed to load PSD library');\r\n                        });\r\n\r\n                    };\r\n                    reader.readAsArrayBuffer(f);\r\n                })(file);\r\n\r\n            } else if (file.type.match('image.*')) {\r\n                ((f) => {\r\n                    window.URL = window.URL || window.webkitURL;\r\n                    const url = window.URL.createObjectURL(f);\r\n                    const im = new Image();\r\n                    im.src = url;\r\n                    BB.loadImage(im, () => {\r\n                        this.importFinishedLoading({\r\n                            type: 'image',\r\n                            width: im.width,\r\n                            height: im.height,\r\n                            canvas: im,\r\n                        }, f.name, optionStr);\r\n                    });\r\n                })(file);\r\n            } else {\r\n                hasUnsupportedFile = true;\r\n            }\r\n        }\r\n        if (hasUnsupportedFile) {\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                message: LANG('import-unsupported-file'),\r\n                type: 'error',\r\n                buttons: ['OK'],\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\n\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kycpJ\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"TzbtI\");","import {IVector2D} from '../bb/bb-types';\r\n\r\n\r\n\r\nexport type TConsoleApi = {\r\n    readonly draw: (path: IVector2D[]) => void;\r\n    readonly help: () => void;\r\n};\r\n\r\nexport function createConsoleApi (\r\n    p: {\r\n        onDraw: (path: IVector2D[]) => void;\r\n    }\r\n): TConsoleApi {\r\n\r\n    const output = ['Draw via the console! Learn more: %cKL.help()', 'background: #000; color: #0f0;'];\r\n    'info' in (console as any) ? console.info(...output) : console.log(...output);\r\n\r\n    return Object.freeze({\r\n        draw: (path: IVector2D[]): void => {\r\n            p.onDraw(path);\r\n        },\r\n        help: (): void => {\r\n            console.log(`KL.draw({x: number; y: number}[]) // draw a line\r\nKL.help() // print help\r\n`);\r\n        },\r\n    });\r\n}"],"names":["$parcel$export","e","n","v","s","Object","defineProperty","get","set","enumerable","configurable","$parcel$interopDefault","a","__esModule","default","parcelRequire","$parcel$global","globalThis","self","window","global","register","module","exports","$d2fa9a947070c225$export$a84540bc8b694b2d","$1LaJZ","$cx0mh","$7h4XF","$2gUX3","$3C7jC","$5ngYX","$gWfkn","$941rU","$1mH1z","$iVf04","$hAS38","Embed","p","_this","_","isInitialized","psdQueue","openProject","project","onProjectReady","loadingScreenEl","document","getElementById","loadingScreenTextEl","textContent","LANG","disableAutoFit","klConfig","key","value","Error","saveReminder","SaveReminder","klHistory","klApp","isDrawing","KlApp","bottomBar","aboutEl","embed","url","embedUrl","onSubmit","init","remove","body","append","getEl","className","console","error","getPNG","__generator","_state","label","getPSD","sent","psds","length","readItem","item","psd","agPsd","readPsd","blob","klPsdToKlProject","callback","forEach","_this1","trys","push","loadAgPsd","shift","$8N5YG","Element","prototype","x","y","scrollLeft","scrollTop","Array","flat","_len","arguments","args","_key","depth","isNaN","Number","reduce","call","acc","cur","isArray","apply","slice","writable","String","replaceAll","searchValue","replaceValue","replace","RegExp","fromEntries","entries","Symbol","iterator","o","keys","_entries_key","k","localStorage","getItem","setItem","removeItem","t","createDocumentFragment","Node","appendChild","createTextNode","Document","DocumentFragment","hasOwnProperty","insertBefore","firstChild","padStart","repeat","findIndex","r","TypeError","i","$cf5d938ee512ebca$export$96f6458b62e4c2c","$cL71g","$4EWN2","$bX4ja","$hrnUX","$eWjiX","$h62LS","$jmL5A","$iUR3L","$2wCWz","$3WOmu","$6l0gQ","$iuTWx","$57YJz","$aId1u","$iG6pP","$8dsYZ","$4sBxW","$6iPxE","$fZtJh","$eOZOu","$haxur","$fX22P","$i7SrA","$qur3y","$fohxs","$7jh4K","importFilters","pProject","pOptions","initState","currentBrushUi","currentBrushId","lastNonEraserBrushId","overlayToolspace","toolspaceTopRow","collapseThreshold","toolWidth","klCanvasToPsdBlob","klCanvas","klMaxCanvasSize","Math","min","max","screen","width","height","uiState","LocalStorage","projectStore","klRootEl","BB","el","css","position","left","top","right","bottom","uiWidth","innerWidth","uiHeight","innerHeight","exportType","KL","KlCanvas","projectObj","setHistory","mainTabRow","undefined","reset","layers","layer","image","pause","addLayer","layerFill","ERASE_COLOR","g","b","canvas","copy","focus","getLayerCount","brushes","message","destroy","param","_param","Brush","setContext","getLayerContext","currentColor","RGB","currentLayerCtx","throwIfNull","getNextBrushId","keyArr","brushUiMap","filter","sizeWatcher","val","brushSettingService","emitSize","klCanvasWorkspace","setCursorSize","BrushSettingService","color","klColorSlider","setColor","copyObj","size","setSize","opacity","setOpacity","getColor","getSize","getOpacity","sizeSlider","brushesUI","opacitySlider","lineSmoothing","LineSmoothing","smoothing","translateSmoothing","lineSanitizer","LineSanitizer","drawEventChain","EventChain","chainArr","setChainOut","event","type","toolspace","style","pointerEvents","startLine","pressure","requestFrame","goLine","isCoalesced","setLastDrawEvent","endLine","getBrush","drawLineSegment","x0","y0","x1","y1","textToolSettings","align","isBold","isItalic","font","letterSpacing","lineHeight","fill","KlCanvasWorkspace","onDraw","chainIn","onPick","rgbObj","isDragDone","pickingDone","setMode","toolspaceToolRow","getActive","onFill","canvasX","canvasY","layerIndex","getLayerIndex","floodFill","fillUi","getIsEraser","getTolerance","getSample","getGrow","getContiguous","onGradient","typeStr","angleRad","gradientTool","onDown","onMove","onUp","onText","dialogCounter","textToolDialog","primaryColor","secondaryColor","getSecondaryRGB","text","stroke","onConfirm","onShape","shapeTool","onViewChange","viewChangeObj","changed","includes","statusOverlay","out","scale","angleDeg","angle","PI","setEnableZoomIn","getMaxScale","setEnableZoomOut","getMinScale","handUi","update","onUndo","canUndo","undoRedoCatchup","undo","onRedo","canRedo","redo","updateMainTabVisibility","activeStr","oldTabId","getOpenedTabId","keysArr","setIsVisible","open","keyListener","KeyListener","keyStr","comboStr","isInputFocused","getIsDrawing","zoomByStep","isPressed","fitView","resetView","preventDefault","sameKeys","saveToComputer","save","success","store","getProject","setTimeout","copyToClipboard","comboOnlyContains","translateView","setAngle","getScale","getAngleDeg","decreaseSize","increaseSize","eraserBrush","getIsTransparentBg","clearLayer","toggleEraser","setActive","brushTabRow","prevMode","getMode","newMode","swapColors","ui","brushUi","Ui","onSizeChange","onOpacityChange","emitOpacity","onConfigChange","emitSliderConfig","getElement","padding","StatusOverlay","overflow","userSelect","touchAction","toolspaceInner","parent","oncontextmenu","onclick","handleClick","toolspaceCollapser","ToolspaceCollapser","onChange","updateCollapse","OverlayToolspace","enabledTest","EmbedToolspaceTopRow","onHelp","showIframeModal","_ref","onFailure","closeFunc","saveBtn","tagName","display","saveAsPsd","popup","target","div","content","marginBottom","ignoreBackground","f","buttons","result","overlay","onLeftRight","updateUi","ToolspaceTopRow","logoImg","onLogo","onNew","showNewImageDialog","onImport","fileTab","triggerImport","onSave","onShare","shareImage","ToolspaceToolRow","onActivate","onZoomIn","onZoomOut","setIsSmall","addListener","setEnableUndo","setEnableRedo","KlColorSlider","svHeight","startValue","p_color","emitColor","setHeight","setPickCallback","doPick","setCurrentBrush","brushId","enable","setCurrentLayer","context","layerPreview","setLayer","brushDiv","colorDiv","margin","flexWrap","justifyContent","alignItems","toolspaceStabilizerRow","ToolspaceStabilizerRow","onSelect","setSmoothing","getOutputElement","TabRow","initialId","useAccent","tabArr","createTab","id","title","tooltip","onOpen","onClose","concat","map","HandUi","onReset","onFit","onAngleChange","isRelative","FillUi","colorSlider","gradientUi","GradientUi","textUi","TextUi","shapeUi","ShapeUi","GradientTool","isDone","x2","y2","settings","getSettings","gradientObj","color1","isReversed","doLockAlpha","isEraser","doSnap","setComposite","drawGradient","draw","ctx","ShapeTool","shapeObj","getShape","isOutwards","getIsOutwards","getDoLockAlpha","strokeRgb","lineWidth","getLineWidth","isAngleSnap","getIsSnap","isFixedRatio","getIsFixed","fillRgb","drawShape","layerManager","LayerManager","getLayer","tool","action","params","LayerPreview","onClick","filterTab","FilterTab","UndoRedoCatchup","catchup","newImageDialog","maxCanvasSize","canvasWidth","getWidth","canvasHeight","getHeight","workspaceWidth","workspaceHeight","resetOrFitView","onCancel","shareCanvas","getCompleteCanvas","fileName","getDate","filenameBase","SaveToComputer","showCrop","clipboardDialog","inputObj","filterLib","cropExtend","input","history","FileTab","files","optionsStr","importHandler","handleFileSelect","imgurUpload","app","imgurKey","settingsTab","SettingsTab","minWidth","isVisible","show","hide","bottomBarWrapper","observer","MutationObserver","updateBottomBar","observe","attributes","childList","subtree","toolspaceScroller","ToolspaceScroller","createConsoleApi","path","index","resize","ImportHandler","onColor","rgb","KlImageDropper","onDrop","optionStr","addEventListener","onPaste","windowResizeWatcher","zIndex","observer1","ResizeObserver","prevent","setDirection","isOpen","setWide","scrollHeight","classList","toggle","setUiState","updateUiState","w","h","scrollY","scrollTo","msg","base64ToBlob","toDataURL","$8b388beb029932dc$export$1b5e630bc3aea29f","$6KGpL","$5mm0I","$kD20o","$kWe4k","arr","_array_without_holes","_iterable_to_array","_unsupported_iterable_to_array","_non_iterable_spread","$4ea7f09e3565689e$export$7e0947b5ad3404e2","$gszWS","_array_like_to_array","$3e7014a700b6235f$export$1eb58a6e75231000","iter","from","$f049015e10c27370$export$e6f3c4780d19eb2b","$9cbe98d1fb398012$export$6e4a713ddcda1e5e","$2MaaK","$dLlkc","$i8UFO","$7bWhB","$dJPtW","$eEL9N","$1kyaA","$4nUqS","$lCF5N","$aP0jf","$11glk","$lfHl9","$fg9Sv","$gmji4","$j5jvd","$43qNf","$iFIyy","$bmB93","$hRdOL","$isYih","$jMW1P","$7bo3M","$lV6Vy","$i5nyl","$cNhNm","$kEeSq","$32CBv","$kqmpc","$8ebuX","$13r5y","$9p4Zp","$8jqzp","$84zxV","$9Kxky","$1Ax5m","$e4sAN","$khi8I","$dJXmR","$iS9xS","$9J17G","$76Qvv","$1uc3b","$h20yl","$dHnZA","$kDGzx","$30Cml","$3ujzu","$705qg","$9BlwZ","$kyVjY","$dAXbp","$3P46L","$fRGIf","$9pcu9","$aSJRf","$6mTnI","$eK8ID","$2umOB","$5ENro","$eyygR","$6rdi0","$7pyBK","$cmnov","$bIgqE","$iVHpg","$5Gc7M","$7EG77","drawProject","WorkspaceSvgOverlay","KlCanvasPreview","filterLibStatus","renderText","floodFillBits","PSD","setDbName","indexedDb","ProjectStore","calcSliderFalloffFactor","Checkbox","Select","ImageToggle","ImageRadioList","RadioList","createPenPressureToggle","KlSlider","HexColorDialog","KlColorSliderSmall","PointSlider","ColorOptions","Options","BoxToggle","CropCopy","FreeTransform","FreeTransformCanvas","Cropper","ToolDropdown","BrowserStorageUi","showModal","Popup","DynamicModal","showImportAsLayerDialog","showImportImageDialog","showIframePopup","DecoyKlHistory","$b60fce38973759d6$export$2a772a91f059c0f9","$b60fce38973759d6$export$28b6f4d98dde9845","$b60fce38973759d6$var$historyInstance","KlHistory","state","listeners","pauseStack","maxState","actionNumber","l","newEntry","pop","lastEntry","broadcast","maxBefore","bufferUpdate","$c902829f68f42bce$export$d7e8d4d4450c819c","$6ToP3","$d2FVM","autoFocus","clickOnEnterBtn","close","isClosed","clearSelection","unfocusAnyInput","rootRootEl","decrease","destroyEl","xButton","bgEl","rootEl","removeEventListener","wheelPrevent","btnElArr","splice","increase","scrollContent","minHeight","flexDirection","titleHeight","background","boxShadow","icon","ok","warning","upload","boxClasses","boxEl","marginRight","join","flex","stopPropagation","click","buttonRowEl","marginTop","marginLeft","buttonName","iconUrl","btnClasses","primaries","iconImg","custom","src","btn","clickOnEnter","setIgnoreBackground","$dd0d395ff14a3e11$export$17eb8275e0c4cab8","DialogCounter","count","emit","listener","$05ec456c8871d48f$export$921068d8846a1559","$6J2My","$idV3L","$04lDo","$eIcQa","$kVHNC","$4toIY","$af1iA","$dJ1E2","$72Jv0","$eg83P","$eelgW","$i0uIf","$jjWRi","$2pgVs","$joplQ","$c1lmK","$635F6","$gCzYB","eventUsesHighResTimeStamp","hasPointerEvents","isCssMinMaxSupported","canShareFiles","unsetEventHandler","insertAfter","loadImage","setAttributes","fitInto","centerWithin","gcd","decToFraction","imageBlobToUrl","dateDayDifference","createSvg","BbLog","nullToUndefined","isDark","mix","dist","distSquared","lenSquared","pointsToAngleRad","pointsToAngleDeg","isInsideRect","clamp","rotate","rotateAround","Matrix","Vec2","intDxy","roundEven","roundUneven","round","updateBounds","boundsInArea","projectPointOnLine","PointLine","BezierLine","SplineInterpolator","quadraticSplineInput","createCanvas","copyCanvas","testShouldPixelate","drawTransformedImageWithBounds","drawTransformedImageOnCanvas","createCheckerCanvas","createCheckerDataUrl","resizeCanvas","convertToAlphaChannelCanvas","freeCanvas","canvasBounds","HSV","CMYK","ColorConverter","testIsWhiteBestContrast","appendTextDiv","makeUnfocusable","PointerListener","DoubleTapper","NFingerTapper","PinchZoomer","CoalescedExploder","OnePointerLimiter","$878b1f179a521546$export$b7d78993b74f766d","$878b1f179a521546$export$4ec3bfbae69fbb50","$878b1f179a521546$export$b7b64c480b083ae0","$878b1f179a521546$export$fe0a7220ab4eecad","$878b1f179a521546$export$558f5e20caee48c2","$878b1f179a521546$export$4fb2cccfca937a8c","test","navigator","userAgent","toLowerCase","indexOf","Event","timeStamp","PointerEvent","createElement","offsetLeft","obj","handlers","handler","$74d1f29ad2137b2c$export$f17908c5de22d32e","$74d1f29ad2137b2c$export$e9f65b0175de4c03","keyDown","keyUp","blur","keyStrToKeyObj","keyStrArr","isDownObj","keyToKeyStrObj","comboArr","codeIsDownObj","listenerArr","emitDown","emitUp","emitBlur","$74d1f29ad2137b2c$var$globalKey","code","oldComboStr","eventArr","c","d","add","keyListenerRef","first","last","getIsDown","getCombo","onBlur","ref","comboAStr","comboBStr","split","sort","$893e90c2dcf687ac$export$9371bd96776f4e82","$93oLo","$eIAon","$893e90c2dcf687ac$var$pointerArr","$893e90c2dcf687ac$var$getButtonStr","$893e90c2dcf687ac$var$pressureNormalizer","PressureNormalizer","$893e90c2dcf687ac$var$timeStampOffset","performance","timing","navigationStart","$893e90c2dcf687ac$var$pointerDownEvt","$893e90c2dcf687ac$var$pointerMoveEvt","$893e90c2dcf687ac$var$pointerUpEvt","$893e90c2dcf687ac$var$pointerCancelEvt","$893e90c2dcf687ac$var$pointerLeaveEvt","$893e90c2dcf687ac$var$pointerEnterEvt","$893e90c2dcf687ac$var$correctPointerEvent","corrected","pointerObj","correctedObj","pointerId","pointerType","pageX","pageY","clientX","clientY","movementX","movementY","normalize","button","coalescedArr","eventPreventDefault","eventStopPropagation","customPressure","isFirefox","coalescedEventArr","getCoalescedEvents","$893e90c2dcf687ac$var$getPointer","lastPageX","lastPageY","totalLastX","totalLastY","eventItem","isDestroyed","isOverCounter","dragObjArr","dragPointerIdArr","lastPointerType","didSkip","targetElement","onPointerCallback","onPointer","onWheelCallback","onWheel","onEnterLeaveCallback","onEnterLeave","maxPointers","wheelCleaner","WheelCleaner","cleanerEvent","bounds","getBoundingClientRect","whlEvent","relX","relY","onPointerMove","correctedEvent","tempLastPointerType","outEvent","createPointerOutEvent","onPointerDown","onSkipGlobal","setupDocumentListeners","dragObj","downPageX","downPageY","lastTimeStamp","windowOnPointerMove","getDragObj","destroyDocumentListeners","removeDragObj","outEvent1","windowOnPointerUp","windowOnPointerLeave","touchToFakePointer","touch","touchEvent","isDown","identifier","handleTouch","changedTouches","fakePointer","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel","process","onPointerEnter","onPointerLeave","fixScribble","onTouchMoveScribbleFix","removedDragObj","coalescedItem","dX","dY","time","$42238a223231ec71$export$c734b8535f2f8e38","knownUnitArr","sequenceLength","sequenceUnit","toEmitDelta","delta","deltaY","endSequenceTimeout","clearTimeout","endSequence","deltaMode","absDelta","abs","$e14d50e39929aa54$export$61f95f4b79132931","avgPressure","normalizeIsComplete","normalizeFactor","pow","$9a5bdb07e7a7c42f$export$2c9e8a9632a706b2","$9a5bdb07e7a7c42f$export$6c4a311cc157c764","ax","ay","bx","by","sqrt","$9a5bdb07e7a7c42f$export$499eb56409f6cbc2","$9a5bdb07e7a7c42f$export$a4f99f99d3e99cfa","$9a5bdb07e7a7c42f$export$627023b405ba5028","p1","p2","atan2","$9a5bdb07e7a7c42f$export$c03a8450eabc2532","$9a5bdb07e7a7c42f$export$151bd845d70e2099","rect","$9a5bdb07e7a7c42f$export$7d15b64cf5a3a4c4","num","$9a5bdb07e7a7c42f$export$bb628a54ab399bc9","deg","theta","cs","cos","sn","sin","$9a5bdb07e7a7c42f$export$95ec0760d3d00713","center","point","rot","$9a5bdb07e7a7c42f$export$bbf9af158036c5e9","remainder","fDx","fDy","$9a5bdb07e7a7c42f$export$94cce7adf2ec2d08","above","ceil","floor","$9a5bdb07e7a7c42f$export$f373b6a7b0c159a","$9a5bdb07e7a7c42f$export$2077e0241d6afd3c","digits","digitMult","$9a5bdb07e7a7c42f$export$f4467a4f41373bc7","$9a5bdb07e7a7c42f$export$bbb91bbc54e7d9ac","$3f0e2f35371c9852$export$dd0873c0fb3ccff6","$3f0e2f35371c9852$export$39f92e86d1722f3a","$3f0e2f35371c9852$export$1555f643cc9a976","$3f0e2f35371c9852$export$ded2b43392504635","$3f0e2f35371c9852$export$425a419ef9fc761f","$3f0e2f35371c9852$export$754559b36e94ea2f","$3f0e2f35371c9852$export$42af33c76b681867","$3f0e2f35371c9852$export$59b33278b5b2fc8a","tmp1","tmp2","ew","eh","base2","oldWidthEx","log2","oldHeightEx","newWidthEx","newHeightEx","getContext","buffer1","buffer2","bufferCtx","imageSmoothingEnabled","imageSmoothingQuality","globalCompositeOperation","drawImage","currentWidth","currentHeight","newWidth","newHeight","tmp","canvasCtx","restore","tmp1Ctx","$3f0e2f35371c9852$export$5a7576952c826b4f","$3f0e2f35371c9852$export$2384aff49c9b73c2","$3f0e2f35371c9852$export$3db033c6ee0b8700","cache","resultCanvas","transform","scaleX","scaleY","whSwapped","destCtx","transformImage","pixelated","translate","baseCanvas","transformObj","angleDegree","fillStyle","fillRect","create","parseInt","modeStr","imdat","getImageData","data","putImageData","clearRect","boundsObj","tempBounds","$44dda2e48e48a872$export$cd3d1f114b139967","$e4df33b4b16105d5$var$multiplyMatrixAndPoint","matrix","$e4df33b4b16105d5$export$5b12bf1653c0dd85","freeze","getIdentity","multiplyMatrixAndPoint","multiplyMatrices","matrixA","matrixB","row0","row1","row2","row3","result0","result1","result2","result3","createTranslationMatrix","createRotationMatrix","createScaleMatrix","$531c9f41f98b7ec0$export$ac4bca90992eed1","sub","nor","len","mul","dot","aArr","bArr","m","$77ae015f37ebe4f1$export$b4c5b177db876445","$77ae015f37ebe4f1$export$8b36a4a83269a640","$77ae015f37ebe4f1$export$5379d955c16d4d43","$77ae015f37ebe4f1$export$80967b1eb9fd6eb4","$77ae015f37ebe4f1$export$4551d4af86c1eb08","lineStart","lineEnd","segmentArr","points","getLength","fac","lastDot","pointArr","p3","p4","resolution","curvePoints","spacing","controlsCallback","lastPoint","lastSpacing","dir","pointLine","pointM1","pointM2","pointM3","getBezierPoints","tempSpacing","getAtDist","lastCallbackPoint","dAngle","lastAngle","newP","xa","ya","u","wx","sig","ddydx","klo","khi","tempX","tempY","interpolate","tempDist","startVal","endVal","stepSize","dec","resultArr","$5e7aac2fa49b6b1f$export$d2edaecd208aed43","$5e7aac2fa49b6b1f$export$8f9ece5a47764b93","$5e7aac2fa49b6b1f$export$89d3f85304bf0767","$5e7aac2fa49b6b1f$export$fb7efcd2e153af6e","$5e7aac2fa49b6b1f$export$5cf396345d1238ae","_RGBtoHSV","maxVal","del_R","del_G","del_B","_HSVtoRGB","var_h","var_i","var_1","var_2","var_3","var_r","var_g","var_b","_CMYKtoRGB","_RGBtoCMYK","toRGB","toHSV","toCMYK","toHexString","ha","toString","hb","hc","toRgbStr","toRgbaStr","rgbaObj","hexToRGB","hexStr","trim","exec","$cfe3aa45a75894cc$export$7868464f598ba79d","$cfe3aa45a75894cc$export$906dfdb7df31ccfc","$cfe3aa45a75894cc$export$e05240ca9e0b8bd9","$cfe3aa45a75894cc$export$a3d02541b0ebf605","$cfe3aa45a75894cc$export$6bd63bfceaafae0c","$cfe3aa45a75894cc$export$c3da0dad1b44eea9","$cfe3aa45a75894cc$export$b1da1db524e22115","preventFocus","innerHTML","_document_activeElement","getAll","activeElement","getAttribute","focusEl","select","getSelection","sel","empty","removeAllRanges","didFocusRelated","relatedTarget","currentTarget","setAttribute","$cfe3aa45a75894cc$var$els","customKeyArr","$0d0e99c175410ac4$export$9860cd9e09e6f8ba","$9e5fd8359d8b22f2$export$19fffca37ef3e106","$d2c9f6aa6c7498f1$export$fe11e0afe623a677","func","chainOut","eventCopy","$cc27951506e6ad28$export$510622b8aed00381","minSilenceBeforeDurationMs","maxTapMs","maxFirstLastFingerDownMs","maxPressedDistancePx","fingerArr","eventQueueArr","firstDownTime","lastEventTime","nowTime","now","pointersDownIdArr","timeoutObj","firstLastDownTimeout","tapTimeout","fingers","onTap","timeoutStr","timeMS","diff","failGesture","tempLastEventTime","downTimeMs","setupTimeout","fingerObj","i1","distance","fingerObj1","i2","distance1","isUp","allAreUp","i3","processEvent","$670d2777518c365a$export$d62358ac2d82abb3","firstFingerMaxDistancePx","untilSecondFingerDurationMs","gestureObj","secondFingerTimeout","pincherArr","onPinch","doSwallow","end","fail","touchPointerArr","isInProgress","continuePinch","beginPinch","otherPointerIdArr","downRelX","downRelY","setupFailTimeout","touchPointerObj","endPinch","actionObj","startDist","startAngle","$f607ef98ce9eccdc$export$db3963a21c01d803","allowedPointerTypeArr","allowedButtonArr","maxPressedDurationMs","maxInbetweenDistancePx","maxUpToUpDurationMs","maxUntilSecondDownDurationMs","minSilenceAfterMs","sequenceArr","lastUpTime","maxUntilSecondDown","onDoubleTap","gestureFailed","lastSequenceItem","targetFunc","$956c5ff01a38849f$export$71ff2f51bf1f4062","downPointerId","ignorePointerIdArr","$4fb7927cde0b2f75$export$649a211db9812745","continueChain","onscroll","getBundleURL","resolve","$e59fbd08bcc1a36b$export$185108a9b725b68","animationName","animationDuration","animationTimingFunction","popupEl","borderRadius","updatePos","elW","offsetWidth","elH","offsetHeight","titleEl","paddingLeft","tabindex","contentEl","$365a915dfb503274$export$48513f6b9f8ce62d","doHighlight","element","innerEl","check","checked","allowTab","tabIndex","allowClick","onchange","$f18fe37a308c53fd$export$f5b8910cec6cf069","$f18fe37a308c53fd$export$b7e3ae3d7c15e42e","Input","_p_type","_p_step","gap","step","lastValidValue","handleChange","oldVal","newValue","doResetIfInvalid","didChange","parseFloat","doScrollWithoutFocus","onChange1","pointerListener","$7a3263857aacf58f$export$ef9b1a59e592288f","optionArr","selectEl","cursor","fontSize","isFocusable","setOptionArr","changeListener","getValue","initValue","option","option1","$8fa94d142febb502$export$b6d053cded550773","isActive","darkInvert","backgroundImage","isRadio","$8cb981a3c9e5b15b$export$7cc1012a658e6ad8","initialIndex","activeIndex","radioEl","setValue","createOption","initId","$a49c90053f8766a2$export$9da2e8821e6cbb57","$8IsQq","isChecked","changeCallback","toggleEl","backgroundSize","backgroundRepeat","$afe02cc26c765c2c$export$2358c75ad3c15b2d","$5c0625e6104e2c75$export$a1855b925e534de7","$869o9","virtualVal","isEnabled","manualInputRoundDigits","useSpline","curve","elementWidth","elementHeight","toValue","toDisplayValue","displayValueToValue","displayValue","valueToDisplayValue","isChangeOnFinal","formatFunc","eventResMs","unit","curveArr","splineInterpolator","sliderWrapperEl","labelFontSize","textEl","control","valueToSliderValue","controlInner","updateEnable","doubleTapper","showManualInput","setAllowedButtonArr","eventChain","sliderValue","sliderValueToValue","updateLabel","deltaX","sliderValue1","pointerListenerTimeout","findX","toLocaleString","languageStrings","getCode","isFinal","emitInterval","clearInterval","emitValue","setInterval","manualInput","setIsEnabled","KlSliderManualInput","config","isDisabled","$16ee6d1163eaf409$export$f8e41e222e32615d","isRightButton","$068903cd1342554f$export$db3d4fde05db9a5e","roundDigits","currentValue","onblur","privateOnClose","scrollBefore","scrollX","lastValue","$dada52d673c8c4ac$export$cc42e119007cb939","$bJupx","createRgbInputRow","labelStr","attributeStr","rowEl","labelEl","inputEl","lastValidRgb","previewEl","hexInput","hexRowEl","hexLabel","rgbArr","copyButton","execCommand","resultStr","$0ebf4eb3a9343b24$export$4e5102252876c5d7","$6fV2b","outputDiv","primaryColorRGB","primaryColorHSV","secondaryColorRGB","secondaryColorHSV","svWrapper","svSvg","DOMParser","parseFromString","documentElement","hueStop","querySelector","divH","divPreview","controlH","createHueBg","targetEl","im","Image","cv","gradH","createLinearGradient","col","addColorStop","alt","updateSVCanvas","SVContainer","pointerSV","updateSVPointer","borderLeft","virtualHSV","pickerButton","backgroundPosition","isPicking","pickCallback","isOver","hexButton","setColPreview","factor","secondaryColorBtn","updateSecondaryColor","hsv","backgroundColor","updatePrimaryHSV","$00f785a5ea9e210d$export$e4203cb02d5e5b28","$1C8RU","theme","$3ce0af1e789f1ab4$export$66306bf21a9ff39e","heightSV","canvasSV","updateSV","canvasH","heightH","cssFloat","pointerH","borderRight","updateHPointer","svPointerId","svPointerListener","hPointerId","hPointerListener","clear","gradient1","colleft","colright","$5e81242a941997c7$export$ac00cea56cec3037","sliderPos","isFirst","imaginaryPos","pointSize","sliderPoint","redrawPoint","$4db8cbbb01889095$export$24ba9b81662d4366","$amum4","_p_title","colorArr","selectedIndex","buttonArr","checkerUrl","onColorInputChange","newRawColor","colorInput","oninput","found","sItem","colorButton","buttonSize","showPicker","setIsSelected","updateCheckerboard","addIsDarkListener","removeIsDarkListener","$075b9fd415bad4ff$export$db3b6bfb95261072","inner","styleNames","operations","_result_classList","_decomp_tagName","decomp","$075b9fd415bad4ff$var$decomposeElString","classes","styles","bg","py","paddingTop","paddingBottom","grow","flexGrow","justify","items","hidden","minh","z","$7960d0c50ff12b0d$export$c019608e5b5bb4cb","wrapperEl","selectedId","classArr","isSmall","optionObj","changeOnInit","getIndex","$c1a93a3cd82636c9$export$5ee0af1d5c87e856","$gGQwz","isWide","angleIm","verticalAlign","innerInnerEl","removeProperty","doPulse","animation","timeout3","timeout","timeout2","$01fcd0ed15aa4018$export$40175a5948a88a57","startP","updateCropTimeout","crop","resetCrop","isInsideSelectionRect","thumbX","scaleW","thumbY","scaleH","croppedCanvas","eventTarget","isNotCopy","croppedImage","updateCroppedCanvas","previewWrapper","thumbSize","thumbCanvas","imageRendering","thumbCtx","selectionRect","updateSelectionRect","toOriginalSpace","genCrop","topLeftP","bottomRightP","origTopLeftP","origBottomRightP","startCrop","isDragging","didMove","isReset","doUpdate","shiftIsPressed","$ffd40240385bb9f9$export$32b89bc9bb92706a","$exh8t","fullCanvas","cropCallback","output","toClipboard","imgURL","cropCopy","getCroppedImage","err","fetch","clipboard","write","ClipboardItem","name","clipboardItemIsSupported","topWrapper","textAlign","KeyEvent","rectObj","getRect","$82406ffdc1235dbb$export$eff87c52915dd7fe","$bBcC4","$jneUH","$6NMo1","$hWVsV","$5Ycub","$jKBKm","$auzYC","$1Qqvs","parentEl","modeWrapper","lastpos","layerHeight","layerSpacing","layerElArr","largeThumbDiv","border","transition","largeThumbCanvas","largeThumbInDocument","klCanvasLayerArr","getLayers","selectedSpotIndex","listDiv","layerListEl","addBtn","duplicateBtn","mergeBtn","removeBtn","renameBtn","paddingRight","MAX_LAYERS","disabled","createLayerList","duplicateLayer","removeLayer","mergeLayerDialog","topCanvas","bottomCanvas","topOpacity","mixModeStr","mode","mergeLayers","renameLayer","modeSelect","translateBlending","setMixMode","historyState","getState","oldHistoryState","spot","thumb","oldSpotIndex","newSpotIndex","posy","posY","moveLayer","newspot","layerSpot","renameLayerDialog","newName","checkerImUrl","child","createLayerEntry","oldOpacity","klLayer","layerName","layercanvas","innerLayer","container1","container2","checkWrapper","setLayerIsVisible","preventFunc","onpointerdown","onmousedown","thumbDimensions","thc","whiteSpace","ondblclick","opacityLabel","textDecoration","isLast","layerOpacity","onpointerover","largeThumbInTimeout","largeThumbTimeout","onpointerout","dragstart","freshSelection","isSelected","activateLayer","updateLayersVerticalPosition","posToSpot","newSpot","oldSpot","move","updateHeight","activeLayerSpotIndex","spotIndex","stateStr","$0621fc8724f6bfac$export$9f4f73b1bd7c2f26","$0621fc8724f6bfac$export$4a819bde91671014","$0621fc8724f6bfac$var$allowedMixModes","layerNrOffset","layerCanvasArr","pickCanvas","changeListenerArr","inLayers","updateIndices","toCopyCanvas","origLayers","algorithm","layerCanvas","layerContext","newW","newH","offX","offY","ctemp","layerCtx","fillColor","selected","isLayerLimitReached","doReturnNull","emitChange","temp","targetIndex","layerBottomIndex","layerTopIndex","globalAlpha","isHorizontal","isVertical","tempCtx","colorObj","compositeOperation","tolerance","sampleStr","isContiguous","targetCtx","targetImageData","srcCanvas","srcData","srcImageData","srcCtx","srcIndex","srcCtx1","srcImageData1","srcData1","targetData","imageData","canvasObj","imData","compositeObj","$7069db2f5e23d00f$var$mx","$7069db2f5e23d00f$var$my","$7069db2f5e23d00f$var$moveIndex","$7069db2f5e23d00f$var$testAndFill","srcArr","targetArr","initRgba","$7069db2f5e23d00f$export$13d50f258a8034f","rgbaArr","Uint8Array","ArrayBuffer","$7069db2f5e23d00f$var$floodFill","px","tl","tr","br","bl","q","$7069db2f5e23d00f$var$fillRect","$01d7180c5d1d0fdf$export$27550cc14d7ae85a","$01d7180c5d1d0fdf$export$71b514a25c47df50","downX","downY","downAngleRad","colorRGB","strokeStyle","r1","r2","pAngleDeg","pAngleDegSnapped","rotated","r11","r21","rx","ry","rdX","rdY","x1r","y1r","x2r","y2r","x1f","y1f","x2f","y2f","beginPath","moveTo","lineTo","x1f1","y1f1","x2f1","y2f1","strokeRect","ellipse","$fdc12d72a3df9be9$export$482c90f94eb9717c","fontArr","unshift","lineJoin","lines","line","lineIndex","_metrics_fontBoundingBoxAscent","_metrics_fontBoundingBoxDescent","ascent","descent","_p_lineHeight","metrics","measureText","mRect","fontBoundingBoxAscent","actualBoundingBoxAscent","fontBoundingBoxDescent","actualBoundingBoxDescent","strokeText","fillText","$089586a542a12f27$export$5f63a7b18dc4503a","$5e45fa121ba5050f$export$74d12f09ff9f1956","$5e45fa121ba5050f$export$b1f70a113e3b5c1b","gradient","baseColor","color2","createRadialGradient","$2f1281ced73ab1dc$export$6e1bedb2a6cdff30","blendMode","codes","$f3c4df6b644f6a61$export$28debfc111084e87","currentName","row","clearBtn","suggestions","suggestionBtns","$c8f65770493ffd93$export$ee79aceabae6bb8a","preview","options","spacer","alphaCanvas","next","previous","$d256278b259ca979$export$6b9252711ea5997f","rootElement","elementType","brushCircleOuter","brushCircleInner","pickerPreviewBorder","pickerPreviewCol","compassSize","compass","compassInner","compassBaseCircle","cx","cy","compassLineCircle","compassUpperTriangle","compassLowerTriangle","radius","borderColor","$d492af58f4721011$export$6eaf6f7c0cc177fc","TMode","$d492af58f4721011$var$TMode","$eZ2aJ","$7QZIi","$bz6iQ","$kE5UF","$dpBaO","$d492af58f4721011$var$MIN_SCALE","renderTargetCanvas","renderTargetCtx","renderWidth","renderHeight","compositeCanvas","compositeCtx","doResizeCanvas","oldTransformObj","targetTransformObj","highResTransformObj","renderedTransformObj","cursorPos","usesCssCursor","bgVisible","transformIsDirty","doAnimateTranslate","svgOverlay","lastRenderedState","reqFrame","emptyCanvas","emptyLightCanvas","isRepeat","currentInputProcessor","onKeyDown","Draw","Pick","Fill","Gradient","Text","Shape","globalMode","inputProcessorObj","spaceHand","Hand","altPicker","zoom","onKeyUp","updateChangeListener","currentMode","renderTime","lastDrawEvent","linetoolProcessor","LinetoolProcessor","getMatrix","art","getRenderedTransform","coords","pressure1","matrix1","coords1","pressure0","coords2","pointer","updateCursor","getComboStr","resetInputProcessor","coord","workspaceToCanvasCoord","shape","hand","HandGrabbing","Zoom","offsetX","offsetY","internalZoomByStep","picker","pickedColor","getColorAt","updateColorPreview","Rotating","Rotate","centerObj","startAngleRad","dAngleRad","minimizeAngleRad","origin","angleIsExtraSticky","pinchZoomer","snapAngleRad","mainDoubleTapper","middleDoubleTapper","twoFingerTap","threeFingerTap","pointerEventChain","wheelEvent","brushRadius","animationFrameRequested","lastRenderTime","requestAnimationFrame","updateLoop","addChangeListener","modeInt","doForce","oldMode","oldIsHand","currentIsHand","setAllowedPointerTypeArr","stepNum","centerX","centerY","newStep","newScale","effectiveFactor","transformA","transformB","blendFactor","centerPosA","canvasToWorkspaceCoord","centerPosB","mixedPos","renderContext","workspacePointArr","borderSize","layerArr","getLayersFast","updateCompass","snapDegIncrement","maxDistDeg","modDeg","doRedrawCanvas","newState","doRender","elapsedFrames","checkChange","testBgVisible","mixTransformObj","$d492af58f4721011$var$ANIMATION_SPEED","start","render","klC","oldWidth","oldHeight","diameter","hideBrushCursorTimeout","doAnimate","newAngle","canvasPointsArr","boundsWidth","boundsHeight","fitWidth","_BB_fitInto","newTargetTransformObj","oldAngleRad","tx","ty","$7752bf3fb7f240e9$export$d429e21f52463d17","downEvent","eventQueue","direction","$da1a7600c10c1784$export$4d6077ff8d823dfb","$6faa9d948ec87f40$export$e258ade1648009b7","$0370167ee97a20d9$export$79a74567acf241b0","$5cYet","$lt7cS","isInverted","resetRemainder","pointerRemainder","scaled","corners","minSnapDist","cornerCursors","gripSize","edgeSize","edges","isConstrained","snapX","snapY","snappingEnabled","ratio","transEl","boundsEl","boundsStartP","boundsPointerListener","snap","distX","distY","iP","toImageSpace","j","projected","dist1","snapToPixel","updateCornerPositions","updateDOM","virtualPos","offsetArr","tinyOffset","constrainCorner","snapCorner","tP","toTransformSpace","indexes","updateTransformViaCorners","updateScaled","angleOffset","tfD","ti","dimension","restoreRatio","angleGrip","anglePointerListener","offset","snapDeg","iX","iY","_snap_x","_snap_y","e1","cornerIndex","flip","widthChanged","heightChanged","angle90","newHeight1","newWidth1","skipCallback","transformOrigin","copyTransform","$6c5cb3001c773523$export$958c2bfe8d7142a9","$6c5cb3001c773523$export$234b1c16dfa57d6a","$6c5cb3001c773523$export$6a4549ec4168874a","$6c5cb3001c773523$export$3fba3b383c654cc6","$48f5d87739d28bf9$export$205c2dd29f8a66b5","imageWidth","imageHeight","previewFit","transformIndex","innerWrapper","previewLayerArr","klCanvasPreview","transformSize","initTransform","freeTransform","updatePreview","getTransform","destCanvas","setPos","setAngleDeg","fit","$de496a1759b04ed9$export$71ed2b85d4ca43d3","maxW","maxH","gripCursors","outline","grips","outlinePointerListener","_BB_intDxy","commit","thirdsHorizontal","borderTop","borderBottom","thirdsVertical","transformTop","transformRight","transformBottom","transformLeft","gripOverlay","darken","edge0PointerListener","edge1PointerListener","edge2PointerListener","edge3PointerListener","cornerElArr","corner0PointerListener","corner1PointerListener","corner2PointerListener","corner3PointerListener","$18e69c7d4cb991e8$export$d25420b53e16716f","largeCanvasAnimationTimeout","animationCanvasCheckerPattern","largeCanvasCheckerPattern","canvasSize","largeCanvasSize","lastDrawnState","lastDrawnSize","animationCanvas","animationCanvasCtx","animationLength","animationCount","largeCanvasIsVisible","contentWrapperEl","checkEl","canvasWrapperEl","nameWrapper","nameLabelEl","clickableEl","opacityEl","largeCanvasWrapper","webkitTouchCallout","largeCanvas","largeCanvasCtx","updateCheckerPatterns","layerObj","currentState","removeLargeCanvas","showLargeCanvas","drawLargeCanvas","largeCanvasAnimationDurationMs","checker","createPattern","animate","canvasDimensions","isInstant","layerIsVisible","parentElement","klCanvasLayerObj","$e3dfa43019bc3f08$export$962af7e240721d88","freeTransformCanvas","noteEl","originalSizeBtn","fitSizeBtn","setTransformFit","centerBtn","setTransformCenter","importImage","buttonStr","getTransformation","getIsPixelated","$01cb8095758db224$export$e789742143ba5b1","textShadow","optionStyle","fontWeight","optionLayerEl","optionImageEl","rootCounter","optionLayerCounter","optionImageCounter","testAcceptType","dataTransfer","types","updateOptions","$d6fe881e8fc421ac$export$9f0da9b942594e99","sizeObj","hHeight","sliderHeight","queuedObj","colorEl","selectedColorEl","subscriptionFunc","initialColor","updateColor","subscribe","sliderConfig","getSliderConfig","updateUI","mousePos","$6003e73b8cbb69e2$export$665d2c76b1eb8459","$kX3t5","$frUlg","$7qUeg","$g2tQ8","$cmBTx","$8pc1M","createButton","extraPadding","contain","logoButton","newButton","importButton","saveButton","shareButton","helpButton","$18c597dee53260ff$export$a0a40f8a0b8fee15","$32WFC","openTimeout","startX","startY","smallMargin","imArr","titleArr","currentActiveIndex","showDropdown","elementFromPoint","dropdownBtnArr","wrapper","closeDropdown","updateButton","activeButton","boxSizing","activeButtonIm","arrowButton","dropdownWrapper","borderBottomLeftRadius","borderBottomRightRadius","createDropdownButton","onClickDropdownBtn","$a372d78c806cd0cc$export$c744a22bef9e0b97","$fORLP","$kRxRZ","$5ZTVn","currentActiveStr","doLighten","doMirror","createTriangleButton","svg","viewBox","preserveAspectRatio","defs","childrenArr","in","stdDeviation","dx","dy","in2","operator","k2","k3","svgTriangleLeft","class","onLeft","svgTriangleRight","onRight","leftPointerListener","rightPointerListener","leftIm","leftImage","rightIm","rightImage","setIsEnabledLeft","setIsEnabledRight","toolDropdown","handButton","zoomInNOutButton","zoomInButton","zoomOutButton","undoNRedoButton","undoButton","redoButton","doEmit","$90c04b5ac185bf3d$export$8162a66cd18867a7","strengthSelect","setDeltaValue","$d04d72b97d637d65$export$3c6d17ed0106bfb9","$fqSj0","_p_height","roundRight","roundSize","roundLeft","pTabObj","openedTabObj","activeTab","initTabObj","tab","tabId","$9934467c988b088a$export$cf20160367bae46c","$6Dvin","scaleEl","angleEl","resetButton","fitButton","leftRotateButton","resetAngleButton","rightRotateButton","pIsVisible","pScale","$51d47356d698ffec$export$1e63e3b0645421a2","toleranceSlider","selectRow","growWrapper","growSelect","contiguousToggle","eraserToggle","$d06987f550ff485e$export$32a22540e4b2f123","$45c003c723de07b5$export$a9387b1d4260d39c","rectStrokeSvgRect","rectStrokeSvg","rectFilledSvgRect","rectFilledSvg","ellipseStrokeSvgEllipse","ellipseStrokeSvg","ellipseFilledSvgEllipse","ellipseFilledSvg","lineSvgLine","lineSvg","updatePreviews","strokeWidth","lineWidthSlider","fixedToggle","snapToggle","shapeOptions","lockAlphaToggle","outwardsToggle","$4fb68589de8a8c9a$export$f77a89101d7d6586","$cNr8p","createRatioSize","ratioX","ratioY","updateRatio","widthInput","heightInput","commonRatios","reducedArr","closestRatio","closestDistance","ratioWrapper","innerText","realw","T","hcf","U","V","newImDiv","unitStyle","widthUnit","heightUnit","sizeTable","table","templateWrapper","presetFitBtn","presetCurrentBtn","presetSquareBtn","presetLandscapeBtn","presetPortraitBtn","presetOversizeBtn","sizeObj1","backgroundRGBA","colorOptionsArr","initColorIndex","colorOptions","onkeyup","secondRow","secondRowLeft","$96366ef7b36c82a7$export$9852986a3ec5f6a0","cellProps","rowIndex","colIndex","cellEl","rowSpan","rowspan","$3f73fb4b1b574d52$export$5b91f641162972fc","$9ecpQ","stateIsOpen","directionStr","dirStr","$7a7111f71abacc0a$export$e263e067d6140649","$2NQHg","$4aPno","$l2lnZ","$7xBn4","$MbxPB","$6Tfl8","$jXowp","onUpdate","viewportUI","setText","onScroll","viewportWrapper","TextToolViewportUI","onDragEnd","tabs","textUI","fontUI","TextToolFontUI","colorWrapper","fillUI","TextToolFillUI","strokeUI","TextToolStrokeUI","TextToolTextUI","modal","maxWidth","viewportInputsCss","tabWrapperCss","inputsCss","getInputsElement","onResize","getValues","$0c994c56e6434e84$export$5cdfb22682d2a5dd","$d84067eeb22a523d$export$2e7faedafda1fc85","$itzxn","$3RXBC","$dtB7M","$3qZsM","$68rzB","$gE7dS","$d84067eeb22a523d$var$importedFonts","fontFamily","fontName","fonts","$d84067eeb22a523d$var$didLoadBundledFonts","$d84067eeb22a523d$var$_loadBundledFonts","_loop","promises","buffer","response","arrayBuffer","FontFace","Promise","all","_p_letterSpacing","fontSelect","loadBundledFonts","onFocus","fontPointerListener","importFont","sizeLabel","sizeInput","lineHeightInput","letterSpacingInput","alignRadioList","italicToggle","boldToggle","$d84067eeb22a523d$var$loadBundledFonts","then","multiple","accept","toSelect","fontFamilies","file","_tmp","bind","$4830416abb0c56c9$export$f45fbea8fe20ca8a","$cr8hf","$5vm9m","$krgkA","$2ak4V","$7xb38","$ldVTx","$6EVai","$lRyM4","$9NBnh","$6rOLc","$dk8Is","$edjtV","$4do1t","$kH2iD","$acHch","$ayzR9","$1d4a3fd6cf6c0a9d$export$42bb0e3b48d549f6","$c85fd0de8751b6a0$export$c6656360602b35c2","onInput","lastEmittedText","textInput","placeholder","$5ffe4a6cd7b98bc8$export$1d311696e0fb2158","zoomFac","onDarkChange","checkerPattern","previewCtx","isSmallWidth","isSmallHeight","textCanvas","textCtx","targetCanvas","layersCanvas","layersCtx","previewCanvas","emptyCanvasLight","dragged","offsetDragged","previewPointerListener","eventCapture","interval","changeZoomFac","rotationSlider","rad","zoomInBtn","zoomOutBtn","inputsRootEl","canZoom","transformedOffset","rotatedXY","rotatedWH","fitBounds","$5043c756765ef749$export$e114d13b1a258938","$e8768c7f5a14aa4a$export$dbf350e5966cf602","$iVt4v","$e8768c7f5a14aa4a$var$_createEmotion","flush","hydrate","merge","getRegisteredStyles","injectGlobal","keyframes","sheet","$dc7419e907cef710$export$2e2bcd8739ae039","$8KHnw","$exBzs","$csvAs","$5zE8f","$dc7419e907cef710$var$insertWithoutScoping","serialized","inserted","insert","$dc7419e907cef710$var$merge","registered","registeredStyles","rawClassName","speedy","isSpeedy","compat","serializeStyles","insertStyles","_len4","_key4","$dc7419e907cef710$var$classnames","_len3","_key3","_len2","_key2","ids","classnames","cls","arg","toAdd","$a9614a8e19e44976$export$2e2bcd8739ae039","$hkMbk","$ikgWV","$a9614a8e19e44976$var$identifierWithPointTracking","begin","character","peek","token","$a9614a8e19e44976$var$toRules","parsed","delimit","$a9614a8e19e44976$var$fixedElements","WeakMap","$a9614a8e19e44976$var$compat","isImplicitRule","column","props","charCodeAt","rules","dealloc","alloc","parentRules","$a9614a8e19e44976$var$removeLabel","$a9614a8e19e44976$var$defaultStylisPlugins","children","DECLARATION","$a9614a8e19e44976$var$prefix","hash","WEBKIT","MOZ","MS","strlen","charat","indexof","KEYFRAMES","serialize","RULESET","combine","match","container","currentSheet","ssrStyles","querySelectorAll","node","dataEmotionAttribute","head","stylisPlugins","nodesToHydrate","attrib","finalizingPlugins","stringify","rulesheet","rule","serializer","middleware","omnipresentPlugins","StyleSheet","nonce","prepend","insertionPoint","selector","shouldCache","compile","$c9e9add3d695fc85$export$9d753cd7ae895cce","_proto","_insertTag","tag","before","tags","nextSibling","ctr","nodes","$c9e9add3d695fc85$var$sheetForTag","styleSheets","ownerNode","insertRule","cssRules","parentNode","removeChild","$ad3686905e666bc0$export$71ad59f2e432cfe8","$ad3686905e666bc0$export$2c0f367103c8d01c","$ad3686905e666bc0$export$39dfd62a25e0fe93","$ad3686905e666bc0$export$aa3a2e812ca8570d","$ad3686905e666bc0$export$527d108ccf083c2b","$ad3686905e666bc0$export$b44a8529a35fcb60","$ad3686905e666bc0$export$6788812c4e6611e6","$ad3686905e666bc0$export$d6af199866bfb566","$ad3686905e666bc0$export$a9db5e087081082d","$ad3686905e666bc0$export$4659b591c19bdf3d","$ad3686905e666bc0$export$77ad94ebf1c2b9ed","$ad3686905e666bc0$export$f8e21b1e77979a08","$ad3686905e666bc0$export$36776f635604f274","$ad3686905e666bc0$export$1be1fc439b849fdf","$ad3686905e666bc0$export$5880b8b5730aff45","$ad3686905e666bc0$export$784d13d8ee351f07","$ad3686905e666bc0$export$48cfd1e771a65c4f","$ad3686905e666bc0$export$4d3fb11e950abb9e","$ad3686905e666bc0$export$58adb3bec8346d0f","$ad3686905e666bc0$export$9e1725a4cfeada27","$ad3686905e666bc0$export$2de70f21292aac9e","$ad3686905e666bc0$export$45918ac1574455b1","$ad3686905e666bc0$export$410ac95b9ec204b8","$ad3686905e666bc0$export$ef7acd7185315e22","$ad3686905e666bc0$export$dfdc1655ccc5b9cb","$ad3686905e666bc0$export$fac44ee5b035f737","$ad3686905e666bc0$export$5a7767152ae0305f","$ad3686905e666bc0$export$38bcb760f1d4871c","$ad3686905e666bc0$export$a29989082612d0d9","$ad3686905e666bc0$export$2335f513bbd82c6d","fromCharCode","$ad3686905e666bc0$export$e6e34fd1f2686227","assign","$ad3686905e666bc0$export$2f35ab04d2335697","$ad3686905e666bc0$export$10d8903dec122b9d","$ad3686905e666bc0$export$53f1d5ea8de3d7c","$ad3686905e666bc0$export$4e0c71f277ca26b3","$ad3686905e666bc0$export$f24224f1c91d8156","$ad3686905e666bc0$export$c0306caf338ac095","$ad3686905e666bc0$export$30a86d91af8ff6e6","$ad3686905e666bc0$export$35059013cd4a06db","root","return","$ad3686905e666bc0$export$c889f2fcc19dbf12","$ad3686905e666bc0$export$98e6a39c04603d36","$","$ad3686905e666bc0$export$7af1228ff777d175","$ad3686905e666bc0$export$955ba06d119e085e","$ad3686905e666bc0$export$e88cb2efb12ae807","$ad3686905e666bc0$export$4254d4e2b3745c4c","$ad3686905e666bc0$export$f8483753829ec8f3","$ad3686905e666bc0$export$3307ffa7023ede1e","$ad3686905e666bc0$export$232faf9add678146","$ad3686905e666bc0$export$c2ab62c7bf24634","$6462bf2593a1e404$export$2e2bcd8739ae039","fn","$91209a116b87ff88$export$6321afa313b251b5","$91209a116b87ff88$var$cursor","$3worW","$1gYqP","$8ClKM","$91209a116b87ff88$var$hyphenateRegex","$91209a116b87ff88$var$animationRegex","$91209a116b87ff88$var$isCustomProperty","property","$91209a116b87ff88$var$isProcessableValue","$91209a116b87ff88$var$processStyleName","styleName","$91209a116b87ff88$var$processStyleValue","$91209a116b87ff88$var$handleInterpolation","mergedProps","interpolation","__emotion_styles","anim","$91209a116b87ff88$var$createStringFromObject","string","_i","interpolated","previousCursor","cached","$91209a116b87ff88$var$labelPattern","stringMode","strings","raw","lastIndex","identifierName","$2907536e1df79c58$export$2e2bcd8739ae039","str","$0ed62991c9c383b9$export$2e2bcd8739ae039","animationIterationCount","aspectRatio","borderImageOutset","borderImageSlice","borderImageWidth","boxFlex","boxFlexGroup","boxOrdinalGroup","columnCount","columns","flexPositive","flexShrink","flexNegative","flexOrder","gridRow","gridRowEnd","gridRowSpan","gridRowStart","gridColumn","gridColumnEnd","gridColumnSpan","gridColumnStart","msGridRow","msGridRowSpan","msGridColumn","msGridColumnSpan","order","orphans","tabSize","widows","WebkitLineClamp","fillOpacity","floodOpacity","stopOpacity","strokeDasharray","strokeDashoffset","strokeMiterlimit","strokeOpacity","$40ef5a08092b28a8$export$95d99596f328fd52","classNames","$40ef5a08092b28a8$export$6f077d94b33a01aa","$40ef5a08092b28a8$export$580009a5da2a8b4b","isStringTag","current","$c8d2eb7d799b314c$export$1bf16d9bd59fd8f9","flattenCheckbox","warningsEl","updateResolution","maxSize","resolutionEl","showWarnings","psdWarningArr","contentArr","warningMap","alert","doFlatten","warningArr","warnings","noteEl1","cropRect","isCropped","cropObj","$4c230b0de5e1a470$export$6df36f0c42d2440f","$4c230b0de5e1a470$export$4e3b1f7d3ad623b4","$4c230b0de5e1a470$export$3d649861c4b13fa2","$4c230b0de5e1a470$export$56493bf279c387b3","$4c230b0de5e1a470$var$kl2PsdMap","$4c230b0de5e1a470$var$psd2KlMap","$4c230b0de5e1a470$var$init","reverse","psdObj","addWarning","warningStr","getMixModeStr","prepareMask","maskCanvas","defaultColor","groupMaskCtx","bitsPerChannel","layerCount","maxLayers","countWithinGroup","groupObj","clipping","adjustment","convertGroup","psdGroupObj","groupCanvas","groupCtx","groupIsVisible","groupOpacity","throwIfUndefined","groupMixModeStr","mask","hasClipping","convertedChildGroupItems","innerItem","innerCtx","clippingCanvas","clippingCtx","clippingItem","effects","clippingCanvas1","clippingCtx1","clippingItem1","klPsd","$41164c8aeaf53227$export$1347f8be1f25c479","$41164c8aeaf53227$export$1448a0dd0d3fde8e","$41164c8aeaf53227$export$21ade4eb935254aa","$41164c8aeaf53227$export$42ffd38884aecdac","$41164c8aeaf53227$var$indexedDbIsSupported","indexedDB","$41164c8aeaf53227$var$dbNameStr","$41164c8aeaf53227$var$storageNameStr","$41164c8aeaf53227$var$execIndexedDBTransaction","actionFunction","successCallback","errorCallback","requestObj","onSuccess","hasFinished","onError","errorStr","onupgradeneeded","db","createObjectStore","keyPath","createIndex","unique","onerror","onsuccess","databaseObj","transactionObj","storeObj","objectStoreNames","contains","deleteDatabase","transaction","objectStore","oncomplete","query","storageProject","put","delete","$805be15a1e91c0ee$export$7a4e0b62a5d854bc","$805be15a1e91c0ee$export$395d33c8e06b92c9","$fsSyS","$bBJjx","$fb1QA","$5XYnt","$hK7d4","$bE89l","$anXZw","$gDMhw","$bNSoq","$dkVDV","$6aHfw","$kLbWO","$bgekB","$537C7","$kHVZD","$bphza","$tP4I2","$4w6gs","isLoaded","brightnessContrast","lang","getDialog","inEmbed","webGL","curves","distort","hueSaturation","darkNoInvert","invert","perspective","tiltShift","toAlpha","unsharpMask","grid","noise","pattern","vanishPoint","$42ac5b30ad65dabb$export$7d68cd8857639377","$68QTJ","$5PSXS","$ewgr9","$kic4a","$7cUpm","$ltaBP","$6Nq1H","PenBrush","BlendBrush","SketchyBrush","PixelBrush","ChemyBrush","SmudgeBrush","EraserBrush","$3f0923cd3c55ea92$export$6f96c8f9e6ae7341","$5CF7D","$3f0923cd3c55ea92$var$TWO_PI","settingHasOpacityPressure","settingHasSizePressure","settingSize","settingSpacing","settingOpacity","settingColor","settingColorStr","settingAlphaId","settingLockLayerAlpha","hasDrawnDot","lineToolLastDot","lastInput","lastInput2","inputArr","inputIsDrawing","bezierLine","alphaCanvas128","alphaCanvas64","alphaCanvas32","alphaOpacityArr","instructionArr","alphaImArr","arc","closePath","targetMipmap","drawArr","dotCallback","localPressure","localOpacity","calcOpacity","localSize","localSpacing","addFinal","drawDot","historyEntry","actions","continueLine","maxInput","loopDist","mouseDist","eX","eY","bdist","updateAlphaCanvas","$ff6c1f784f50f5d5$export$d116ae91f77f1f19","$74D3O","genBrushAlpha01","genBrushAlpha02","$f875015ce1aeb4d3$export$74a44bbc21d06a28","$f875015ce1aeb4d3$export$eaa218d5d17c8f1c","$gZSR2","scaleFac","createImageData","sFac2","simplex2","noisePattern","centerDist","centerSize","transitionSize","pDist","$f875015ce1aeb4d3$var$udSegment","ba","pa","$dfc47a34ad9bc378$export$d3022aad56692482","$dfc47a34ad9bc378$var$myModule","$dfc47a34ad9bc378$var$Grad","Grad","$dfc47a34ad9bc378$var$grad3","$dfc47a34ad9bc378$var$p","$dfc47a34ad9bc378$var$perm","$dfc47a34ad9bc378$var$gradP","seed","$dfc47a34ad9bc378$var$F2","$dfc47a34ad9bc378$var$G2","xin","yin","n0","n1","n2","j1","gi0","gi1","gi2","t0","dot2","t1","t2","$02d77b8dd5755328$export$9659db8d01dd5313","isTesting","blending","settingSizePressure","settingOpacityPressure","blendCol","blendMix","mixCol","localColOld","cells","drawBuffer","redrawBounds","touchedCells","getTouchedCells","isTouched","drawCells","cellsW","getCellsWidth","cell","cellOffsetX","cellOffsetY","cellWidth","cellHeight","inCellBounds","tmpCanvas","tmpCtx","alpha","ar","ag","ab","aa","slicedBounds","sliceBounds","e2","randI","randLen","randArr","random","samples","sampleArr","samplesSquared","sampleOffsets","sharpness","invSharpness","sizeSquared","distDivisor","alphaMinuend","ri","re","alphaO","invAlphaO","alphaU","underR","underG","underB","underR1","underG1","underB1","newAlpha","localColNew","average","bDist","calcSpacing","avgX","avgY","avgParams","prepDot","copyFromCanvas","getAverage","bezierCallback","updateRedrawBounds","totalCells","drawChangedCells","find","$c214fbe9e4fc15b0$export$566f9061f0f5ba33","$c214fbe9e4fc15b0$var$sampleCanvas","$c214fbe9e4fc15b0$var$sampleCtx","settingBlending","settingScale","lastX","lastY","sketchySeed","mixMode","c1","c2","p_x","p_y","preMixedColor","mixr","mixg","mixb","mixX","mixY","mixW","mixH","imDat","countMix","mixed","rand","$58b45953679baa4a$export$4de5ef8eecde6f12","settingIsEraser","settingUseDither","ditherArr","ditherPattern","ditherCanvas","ditherCtx","maxAngleRad","d2","d3","isOverThreshold","cubicCurveOverThreshold","plotLine","controlCallback","controlObj","plotCubicBezierLine","skipFirst","sX","sY","updateDither","$fc1a683099fb2d61$export$fe52c90afd1cf5ba","useSizePressure","useOpacityPressure","isTransparentBG","isBaseLayer","started","radgrad","oFac","_this_historyEntry_actions","$78ad817c60f81b7c$export$c9f800961903deab","copyImageData","copiedCells","completeRedrawBounds","_$i","e3","$78ad817c60f81b7c$var$prepSmudge","imWidth","imHeight","aP","bP","brush","alphaLock","$78ad817c60f81b7c$var$smudge","cSize","cX","cY","aIndex","bIndex","softnessPx","pixel","ai","bi","ix","iy","fac2","bx1","bx2","yStart","iy1","yStart1","x21","ix1","iy2","yStart2","x3","x22","ix2","y3","iy3","yStart3","x4","x23","ix3","ImageData","resetRedrawBounds","updateCompleteRedrawBounds","historyIm","$348fcce123898af9$export$38b08aa4ea8f61c6","settingMode","settingDistort","settingXSymmetry","settingYSymmetry","settingGradient","minY","maxY","Path2D","startAtTop","pos","historyCanvas","historyCtx","$7de2f0eab7a9ead7$export$f1561c72be54c6a7","$cVFne","$9mjXI","$iYbUv","$brjBD","$9rc5F","$dS2qM","$vCnsd","penBrush","penBrushUi","blendBrush","blendBrushUi","sketchyBrush","sketchyBrushUi","pixelBrush","pixelBrushUi","chemyBrush","chemyBrushUi","smudgeBrush","smudgeBrushUi","eraserBrushUi","$8b6ca25eb0830594$export$a0d4983f3b0b5c8e","brushInterface","alphaNames","$7NTKy","$iEKHy","pressureSizeToggle","pressureOpacityToggle","setSpacing","spacingSpline","alphaOptions","setAlpha","getLockAlpha","setLockAlpha","sizePressure","opacityPressure","changeSliderValue","$e8a5c017c49bb311$export$5ec472fd0ce20d84","$2e3c50106ba150d5$export$156bb4fe8f4bcb4b","$jxqXH","blendingSlider","getBlending","setBlending","setSizePressure","setOpacityPressure","$94537af75923b9e3$export$ffae56164d1bde68","$1SGPc","blendSlider","scaleSlider","setScale","getSeed","setSeed","$9519e739bc9666ee$export$d001f3406562d07","$1qfk4","setIsEraser","ditherToggle","getUseDither","setUseDither","toggleRow","$d6fc2ded7d9d56db$export$cf481ecf227135a8","$6kk87","transparencyToggle","isTransparentBg","setTransparentBG","$1045b9bae2ffbbb4$export$84831662ba707e7a","$1rnhH","bottomRow","$18456e8104a5a825$export$80819a93636ebb04","$5rmB7","modeOptions","mirrorXToggle","mirrorYToggle","gradientToggle","iconSize","brushSize","halfSize","actualIconSize","getXSymmetry","setXSymmetry","getYSymmetry","setYSymmetry","getGradient","setGradient","$2d47de6498e5a87c$export$35fa34e5af64bd4a","isEmbed","linkEl","iframe","href","onload","contentWindow","location","isMaxHeight","$de98bdc3369d2e4f$export$3dff5655255b5729","ignoreFocus","inputs","$0e681e75eb3cab30$export$9c72cf485ef46673","_this_options","infoEl","ageEl","storeButtonEl","clearButtonEl","storeListener","gridTemplateColumns","gridTemplateRows","gridTemplateAreas","gridArea","isBroken","textSize","btnCustom","hideClearButton","visibility","timestamp","thumbnail","updateThumb","updateAge","readResult","read","ageStr","age","Date","getTime","resetButtons","unsubscribe","$14b343f2c12ca9c5$export$93d91060b9af7e2a","$3hwQ7","$14b343f2c12ca9c5$var$makeAsync","nonAsyncFunc","reject","accessHasFailed","storeKlProjectObj","getKlProjectObj","lowLevelRead","ProjectConverter","readStorageProject","storageProject1","createStorageProject","lowLevelStore","lowLevelClear","updateTimestamp","$3ee249752703e788$export$f3c1ac6650038646","$3ee249752703e788$var$loadImage","URL","revokeObjectURL","onabort","createThumbnail","HTMLCanvasElement","storageLayer","$e3587a28373f51f9$export$b3fb17ae4345ac8f","base64Str","parts","binStr","atob","buf","view","Blob","$01ce2e23a2667e77$export$a2647fbf5f056b0a","$fEvzb","onExportTypeChange","onFileSelect","onSaveImageToComputer","onNewImage","onShareImage","onUpload","onCopyToClipboard","fileMenu","uploadImgurButton","clipboardButton","importWrapper","innerMask","importFakeButton","exportTypeSelect","saveNote","createSpacer","clearer","fileBrowserStorage","saveRow","refresh","$0d10046ca7f6fbd0$export$3f17d740ad471e50","$a5EFw","getCurrentColor","getKlMaxCanvasSize","getKlCanvas","getCurrentLayerCtx","isInit","getSharedFx","filters","hasWebGL","testHasWebGL","note","noteButton","filterKey","buttonLabel","filterName","finishedDialog","filterDialog","getInput","applyFilter","maxHeight","currentColorRgb","secondaryColorRgb","addGroup","groupArr","$02a74dc72797630f$export$8c4423af32b21158","$6N0h0","$02a74dc72797630f$var$failed","$02a74dc72797630f$var$fx","gl","isContextLost","fxCanvas","$eeae469bfe7893fd$export$a04cfca62fd2892f","wrapTexture","texture","getTextureType","initialize","contents","getPixelArray","wrap","getWebGlContext","$76shC","$fvBHO","$7dEWP","$8dg54","$1Vq1u","$h6IOH","$9uhWc","$e0olz","$2myDH","$44j8K","$kSoEy","$9WU1L","$bJIp5","$fkecp","$3u9Uu","$6lIef","$lwXVT","loadContentsOf","setGl","FxTexture","fromElement","textureType","UNSIGNED_BYTE","getExtension","testTexture","RGBA","FLOAT","drawTo","spareTexture","extraTexture","flippedShader","FxShader","use","getDefaultShader","drawRect","array","readPixels","contextNames","WebGLRenderingContext","premultipliedAlpha","triangleBlur","matrixWarp","multiplyAlpha","unmultiplyAlpha","$c50d7229cf0a789e$export$6408eeb1703e74b8","$jrAes","brightness","contrast","simpleShader","$8501a2e1e79821a9$export$d731e22ecd0c25d3","shader","uniforms","textureIn","textureOut","swapWith","$e0143068cd462268$export$7d9b0d118d0c4108","$e0143068cd462268$var$floatPrecision","vertexSource","fragmentSource","nameStr","vertexAttribute","texCoordAttribute","program","createProgram","testPrecisionSupport","HIGH_FLOAT","MEDIUM_FLOAT","attachShader","compileSource","VERTEX_SHADER","FRAGMENT_SHADER","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","source","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","precisionType","format","getShaderPrecisionFormat","precision","deleteProgram","useProgram","getUniformLocation","uniform1fv","Float32Array","uniform2fv","uniform3fv","uniform4fv","uniformMatrix3fv","uniformMatrix4fv","uniform1f","textures","uniform1i","viewport","getParameter","VIEWPORT","vertexBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","texCoordBuffer","getAttribLocation","enableVertexAttribArray","vertexAttribPointer","drawArrays","TRIANGLE_STRIP","defaultShader","$deb6b884ba4ae312$export$5822a9d0880a5d82","$deb6b884ba4ae312$export$b59c6427db8463f4","newGl","$80392da2a95619fd$export$7e6fd232cff50dd1","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","videoWidth","videoHeight","deleteTexture","activeTexture","TEXTURE0","ensureFormat","framebuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","other","$7480e3ce85bc65db$export$6894093bf294bea5","$fRyi0","red","green","blue","redRamp","splineInterpolate","greenRamp","blueRamp","initFromBytes","$d747444e26286abc$export$4f237735eca1f248","interpolator","$6dd7d8fac84d64b7$export$ef28bbbd731e79bf","hue","saturation","$dd5d88e299e80db3$export$d3022aad56692482","$3TO8L","octaves","peaks","colA","colB","channels","texSize","$b01b186720ebdc8e$export$6e852234f1597a14","$4urfK","randomShaderFunc","$904e6ba1142f7a16$export$af69f7ca07da04c9","$1ec92859a97056c3$export$4545acb2b6bb8f22","endX","endY","blurRadius","gradientRadius","$5b33fb39bf5722a9$export$a93b0222aeadc54b","$gDZ5A","$5taNf","inverse","useTextureSpace","warpShader","getInverse","$1d7339974b05a229$export$820b3a44cb7b2b21","uniformsStr","warpStr","$303d8d4ec53c4881$export$1c447127d27d7be4","dx1","dy1","dx2","dy2","dx3","dy3","det","$303d8d4ec53c4881$export$68b3343017e80691","$303d8d4ec53c4881$export$2060d2db72cce88f","$c6e0992c38eb55ab$export$915fb7313c578ba2","strength","ensureFormatViaTexture","originalTexture","unuse","$164716f3bce9dcdb$export$be1ee5ea42904fdc","replaceRGBA","$6fb892cfa80f1621$export$6897c284b6f9f4dc","$4d16a2f492bd5d16$export$541149539f3a4684","after","getSquareToQuad","multiply","$34a2490457ff8aab$export$b324c80262feb891","$55618926ab99fefa$export$7c9b924528782480","distortType","phase","$f157b4bc2111ecb8$export$57b05c961ff98d6a","$6349b006a6604e1b$export$b1dd62fa0b5f32f5","$2lMgk","$6349b006a6604e1b$var$_upload","description","img","gif","labelText","formData","FormData","method","headers","Authorization","json","link","inputTitle","inputDescription","rows","labelTitle","labelDescription","tos","typeRadio","outDiv","infoHint","$6349b006a6604e1b$var$upload","deletehash","$06e8423858d08972$export$befc6437ad34b28a","showReminder","changeTitle","onSaveAsPsd","lastSavedAt","lastReminderShownAt","psdWrapper","storageWrapper","psdBtn","storageUi","onBeforeUnload","returnValue","lastSavedActionNumber","getActionNumber","visibilityState","unsavedActions","showPopup","onbeforeunload","unsavedInterval","$956d06d740fc5053$export$75e7b60500bb415b","$6hBII","getExportType","filename","mimeType","saveAs","saveImage","fileBase","fnameArr","layerArr1","psdConfig","item1","blendKlToPsd","agPsdLazy","writePsdBuffer","catch","$e1c6fbc08bfda4eb$export$2bc2a80e311129ac","createElementNS","download","rel","createObjectURL","$48534f13b7192dff$export$5cebd3bb2d68229a","$48534f13b7192dff$var$execHistoryEntry","setCurrentLayerCtx","_KL_filterLib_historyEntry_tool_","ctx1","id1","ctx2","getInitState","getCurrentBrush","doIgnore","shouldIgnoreTest","oldSize","entry","currentLayerIndex","logParam","localCurrentLayerCtx","$53cc60fd413705d6$export$272bfd3ef9ef2f48","onSetColor","onSetSize","onSetOpacity","onGetColor","onGetSize","onGetOpacity","onGetSliderConfig","subscriberArr","instance","skipSubscriber","$5562b5b6c391a7ca$export$5d396b237bd33221","$fgfvl","$dd3r9","$741YV","$2H29m","customAbout","themeToLabel","makeLicenses","showLicensesDialog","autoLanguage","getAutoLanguage","langWrapper","languages","languageSelect","LS_LANGUAGE_KEY","languageHint","themeSelect","getMediaQueryTheme","getStoredTheme","setStoredTheme","minimalAbout","versionEl","$c57a53a21f44c053$export$d3fe39c7bff44f23","licensesCss","libraries","overflowY","licenses","full","fontLicenses","$951e508110f8a437$export$42a534af7eb650e8","upBtn","downBtn","upInterval","scrollBy","downInterval","wheelListener","$f244572c1923a3ac$export$7fa03d1ef9d3489e","iconArr","updateIcons","typeOptions","reverseToggle","doSnapToggle","col1","col2","$1eff19bee197987a$export$ce26cd3db18613a3","submitButton","leftRightButton","$4bb0d03ef02dc0c0$export$4283b00eae4a6956","$iiVKq","$lorQQ","$8Ri8I","$fADXF","$bIns5","$30jcG","$cCks8","$huXOx","$dsRff","$lhchB","$lXpcU","$1CjeM","$dNWKZ","$94Tq7","$d8Fqy","$gtdB1","$lQzx7","$10iZP","$dteOZ","$4bb0d03ef02dc0c0$var$importFilter","libObj","moduleObj","filterBrightnessContrast","filterCropExtend","filterCurves","filterFlip","filterHueSaturation","filterInvert","filterPerspective","filterResize","filterRotate","filterTiltShift","filterTransform","filterBlur","filterUnsharpMask","filterToAlpha","filterGrid","filterNoise","filterPattern","filterDistort","filterVanishPoint","$024aabab8b30bbfd$export$af433fb90aa90a38","$cH2YE","selectedLayerIndex","tempCanvas","brightnessSlider","contrastSlider","previewInnerWrapper","$fca35583bfaa35b6$export$5ec472fd0ce20d84","$2680b5781517cb67$export$e5937df51b9e1d86","updateInput","leftInput","rightInput","topInput","bottomInput","leftChanged","rightChanged","topChanged","bottomChanged","cropper","setTransform","previewHeight","offsetWrapper","selectedRgbaObj","updateBg","bgColorOverlay","updateIsDark","previewFactor","lrWrapper","tbWrapper","labelStyle","useRuleOfThirds","ruleOThirdsCheckbox","showThirds","flexRow","$4c948640eb8ef791$export$309483fcb6d5c7ca","$hRvnE","getDefaultCurvesInput","CurvesInput","modeButtons","getModeButtons","$81ac57466912ccc9$export$4300cf0a0df418a6","$81ac57466912ccc9$export$1c43bf66c2a2e4da","p0","areaH","areaW","curveArea","createPoint","lock","internalY","internalX","pointEl","newX","newY","updateControl","outCurves","drawCurve","spline","$6b01e1931d168e01$export$9b1b7b3985b9625a","previewLayer","doFlipCanvas","horizontalCheckbox","verticalCheckbox","targetOptions","horizontal","vertical","flipCanvas","$041c656037c77a96$export$2aa46bd5587f0eb","hueSlider","saturationSlider","$82b3d1ba61b3412f$export$b7ebcfbdc840ef76","$460859cbeb601dec$export$a76d798fa7d85e4e","$5vheV","displayW","displayH","displayPreviewFactor","pointerListenerArr","bb","bc","bd","ac","ad","createDraggable","updateAfter","beforeAfterTabs","TwoTabs","$8b4f5ae4fe73ff76$export$b1241e74876d9bbe","leftTab","rightTab","$63d62a20f3ba2c7d$export$5705240d31427a82","$bNBIp","updateConstrain","constrainIm","algorithmSelect","previewW","previewH","canvasWrapper","widthWrapper","heightWrapper","inputWrapper","constrainCheckbox","secondRowElement","$878715182dcd377b$export$ac7e9efc751d5791","btnPlus","btnMinus","previewcell","$aa97ed406a9700f0$export$1b8796b18b7c19ed","fa","fb","blurSlider","gradientSlider","$31a0dd41d7428d32$export$dc15474d94cdc2b3","JSON","lastDrawnTransformStr","transformLayerCanvas","onInputsChanged","inputX","inputY","inputR","leftWrapper","rightWrapper","rotWrapper","inputRow","actionBtnCss","buttonRow","flipXBtn","flipYBtn","scaleRotLeftBtn","scaleRotRightBtn","scaleDoubleBtn","getRatio","scaleHalfBtn","setConstrained","isSnapping","snappingCheckbox","setSnapping","checkboxWrapper","isPixelated","$95b95646154e8218$export$55e7eb2ebd0db869","radiusSlider","$82f12ab116cea855$export$62ac74a5ea43bd5c","strengthSlider","$a535e7a374deb8f5$export$6158ed2b22ebf4d9","sourceId","sourceOptions","$bad33651972f8d2c$export$50020de79e1bc23","$1xi6g","renderW","renderH","drawGrid","settingsObj","thickness","renderFactor","line1","line2","xInput","yInput","thicknessInput","$74df8e8cd35bce4e$export$20d2db9c68afeac","cellsX","cellsY","thickIsRound","cw","pos1","ch","$595c9469b8f94062$export$1dab0536099042f5","$595c9469b8f94062$var$presetArr","$595c9469b8f94062$var$drawNoise","presetCopy","presetIndex","thumbImgArr","preset","thumbImg","presetOptions","row1El","row2El","channelsOptions","blendSelect","mixModes","colInputStyle","colAInput","newColor","colBInput","$ebbf7e5d844153e5$export$5b48b77a483d9b33","$ebbf7e5d844153e5$var$drawPattern","blendOffsetX","blend","blendOffsetY","finalPatternCanvas","blendCanvas","blendCtx","colTransparent","colOpaque","blendGradient","lastDrawnSettings","syncInputs","sharpStrokeRect","drawX","drawY","drawWidth","drawHeight","previewMode","fullSizeCtx","fullSizeCanvas","pW","pH","overlayCtx","overlayCanvas","previewCanvas1","previewCtx1","inputStyle","mixBlendMode","oldSettings","x11","y11","$67bee9819cf9d9ba$export$77c344cc65ad0ed2","sync","sliderArr","fxCanvas1","texture1","isSynced","settingsCopy","topRowEl","syncToggle","xyRowEl","leftCol","rightCol","sliderWidth","toUpperCase","phaseSlider","stepSlider","$9939d5f20537fa4b$export$a77e8ecd2a7fa9a5","$jsIPR","drawVanishPoint","linesSlider","$cd59789add31bb97$export$8f57d6bdbceb36d0","degIncrement","$40b8cea12adf584e$export$92433b641be3f7a","$40b8cea12adf584e$var$_klCanvasToPsdBlob","$3adbeb1f050c09d3$export$c57e2ed65bcf4d6a","lastMixedInput","inputPressure","parse","$73298182992a8985$export$91dcf4209534d21f","$7aa12ecc06c22770$export$bcd109042a2e4bb5","$504c8450f977b764$export$4ccbb8938b9d5723","importedImage","getResizedDimensions","importAsImage","resizedDimensions","tempCanvasCtx","importAsImagePsd","convertedPsdObj","cropCanvas","importAsLayer","activeLayerIndex","activeLayerContext","res","clipboardData","retrieveImageFromClipboardAsBlob","getAsFile","imageBlob","importFinishedLoading","URLObj","webkitURL","getAsString","pasteStr","log","crossOrigin","showWarningPsdFlattened","hasUnsupportedFile","nameSplit","extension","closeLoader","doShowLoader","loaderIsOpen","reader","FileReader","readerResult","skipLayerImageData","skipThumbnail","skipCompositeImageData","convertedPsd","readAsArrayBuffer","$a8abbf3a9def9692$export$982e7602957287fa","_console","_console1","info","help","COMMENT","PAGE","MEDIA","IMPORT","CHARSET","SUPPORTS","DOCUMENT","NAMESPACE","FONT_FACE","COUNTER_STYLE","FONT_FEATURE_VALUES","LAYER","replacement","search","substr","sizeof","characters","char","prev","caret","delimiter","tokenize","tokenizer","whitespace","escaping","commenter","rulesets","pseudo","declarations","atrule","variable","scanning","ampersand","reference","comment","declaration","ruleset","post","prefix","some","collection","prefixer","namespace"],"version":3,"file":"main-embed.6a06ff2a.js.map"}