{"mappings":"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IAAI,GAAG,GAAG,GAAG,IAAI,IAAI,EAAE,IAAI,IAAI,GAAG,IAAI,GAAG,GAAG,IAAI,EAAE,GAAG,GAAG,IAAI,GAAG,GAAG,GACzE,IAAK,EAAE,IAAI,IAAI,IAAI,IAAI,GAAG,EAAE,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,GACzE,GAAG,IAAI,IAAI,GAAG,GAAG,IAAI,GAAG,IAAI,IAAI,IAAI,IAAK,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,IAAI,GAAG,GAAG,IACxE,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,IACxE,IAAI,IAAI,GAAI,GAAG,GAAG,GAAG,IAAK,EAAE,IAAI,GAAG,GAAG,IAAI,GAAG,IAAI,IAAI,IAAK,GAAG,GAAG,IAAI,IAAI,IACxE,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,IAAK,EAAE,GAAG,GAAG,IAAI,IAAI,IAAI,IAAI,IACxE,EAAE,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,IAAI,GAAG,GACzE,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAK,EAAE,GAAG,IAAI,IAAK,GAAG,IAAI,IAAI,IAAI,IAAI,IAAK,GAAG,IAAI,EAC1E,IAAI,GAAG,GAAG,IAAK,GAAG,GAAG,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,IAAK,IAAI,IAAI,IAAI,IAAI,GAAG,IACxE,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,IAAK,GAAG,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,IACxE,GAAG,IAAI,IAAK,GAAG,IAAI,IAAI,IAAI,IAAI,IAAK,GAAG,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,IAAK,EAAE,IAAI,IACxE,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG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","sources":["src/app/script/main-embed.ts","src/app/script/polyfills/polyfills.ts","src/app/script/polyfills/polyfills-nomodule.ts","node_modules/mdn-polyfills/Node.prototype.append.js","node_modules/mdn-polyfills/Node.prototype.prepend.js","node_modules/mdn-polyfills/String.prototype.padStart.js","node_modules/mdn-polyfills/Array.prototype.findIndex.js","src/app/script/app/kl-app.ts","<<jsx-config-pragma.js>>","node_modules/@swc/helpers/src/_to_consumable_array.mjs","node_modules/@swc/helpers/src/_array_without_holes.mjs","node_modules/@swc/helpers/src/_non_iterable_spread.mjs","src/app/script/klecks/kl.ts","src/app/script/klecks/history/kl-history.ts","src/app/script/klecks/ui/modals/base/showModal.ts","src/app/script/klecks/ui/modals/modal-count.ts","src/app/script/bb/bb.ts","src/app/script/bb/base/browser.ts","src/app/script/bb/input/key-listener.ts","src/app/script/bb/input/pointer-listener.ts","src/app/script/bb/input/wheel-cleaner.ts","src/app/script/bb/input/pressure-normalizer.ts","src/app/script/bb/math/math.ts","src/app/script/bb/base/canvas.ts","src/app/script/bb/base/create-canvas.ts","src/app/script/bb/math/matrix.ts","src/app/script/bb/math/vec2.ts","src/app/script/bb/math/line.ts","src/app/script/bb/color/color.ts","src/app/script/bb/base/ui.ts","src/app/script/bb/base/bb-log.ts","src/app/script/bb/base/local-storage.ts","src/app/script/bb/input/event-chain/coalesced-exploder.ts","src/app/script/bb/input/event-chain/n-finger-tapper.ts","src/app/script/bb/input/event-chain/pinch-zoomer.ts","src/app/script/bb/input/event-chain/double-tapper.ts","src/app/script/bb/input/event-chain/one-pointer-limiter.ts","src/app/script/bb/input/event-chain/event-chain.ts","src/app/script/klecks/ui/modals/base/scroll-fix.ts","node_modules/@parcel/runtime-js/lib/runtime-ac5a13e6ed7d1c32.js","node_modules/@parcel/runtime-js/lib/runtime-287f00094a316f99.js","src/app/script/klecks/ui/modals/base/dynamic-modal.ts","src/app/script/klecks/ui/components/checkbox.ts","src/app/script/klecks/ui/components/input.ts","src/app/script/klecks/ui/components/select.ts","src/app/script/klecks/ui/components/image-toggle.ts","src/app/script/klecks/ui/components/image-radio-list.ts","src/app/script/klecks/ui/components/create-pen-pressure-toggle.ts","node_modules/@parcel/runtime-js/lib/runtime-5d5af97961b0b866.js","src/app/script/klecks/ui/components/box-toggle.ts","src/app/script/klecks/ui/components/kl-slider.ts","src/app/script/klecks/ui/components/slider-falloff.ts","src/app/script/klecks/ui/components/kl-slider-manual-input.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-343023b05f023704.js","src/app/script/klecks/ui/components/kl-color-slider.ts","node_modules/@parcel/runtime-js/lib/runtime-e949988766af13d3.js","src/app/script/klecks/brushes/erase-color.ts","src/app/script/klecks/ui/components/kl-color-slider-small.ts","src/app/script/klecks/ui/components/point-slider.ts","src/app/script/klecks/ui/components/color-options.ts","src/app/script/klecks/ui/components/options.ts","src/app/script/klecks/ui/components/status-overlay.ts","node_modules/@parcel/runtime-js/lib/runtime-e99dce5763a53828.js","src/app/script/klecks/ui/components/crop-copy.ts","src/app/script/klecks/ui/modals/clipboard-dialog.ts","src/app/script/klecks/ui/tool-tabs/layer-manager/layer-manager.ts","src/app/script/klecks/canvas/kl-canvas.ts","src/app/script/klecks/image-operations/flood-fill.ts","src/app/script/klecks/image-operations/shape-tool.ts","src/app/script/klecks/image-operations/render-text.ts","src/app/script/klecks/canvas/draw-project.ts","src/app/script/klecks/image-operations/gradient-tool.ts","src/app/script/klecks/canvas/translate-blending.ts","src/app/script/klecks/ui/tool-tabs/layer-manager/rename-layer-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-b31ab580fe87ed91.js","src/app/script/klecks/ui/tool-tabs/layer-manager/merge-layer-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-9d4db9a16894fc5d.js","node_modules/@parcel/runtime-js/lib/runtime-8689d3bdc90716d5.js","node_modules/@parcel/runtime-js/lib/runtime-67c3e5d0b4ea898f.js","node_modules/@parcel/runtime-js/lib/runtime-6f5bf53dff43e557.js","src/app/script/klecks/canvas-ui/workspace-svg-overlay.ts","src/app/script/klecks/canvas-ui/kl-canvas-workspace.ts","node_modules/@parcel/runtime-js/lib/runtime-d3176d0a84b6cab2.js","node_modules/@parcel/runtime-js/lib/runtime-fae9a2679085aa34.js","node_modules/@parcel/runtime-js/lib/runtime-313dd5ffb9b9f520.js","node_modules/@parcel/runtime-js/lib/runtime-2a18e2880edd0998.js","src/app/script/klecks/events/linetool-processor.ts","src/app/script/klecks/canvas-ui/canvas-preview.ts","src/app/script/klecks/ui/components/free-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-719757e47171233d.js","src/app/script/klecks/ui/components/free-transform-utils.ts","src/app/script/klecks/ui/components/free-transform-canvas.ts","src/app/script/klecks/ui/components/cropper.ts","src/app/script/klecks/ui/components/layer-preview.ts","src/app/script/klecks/ui/modals/show-import-as-layer-dialog.ts","src/app/script/klecks/ui/components/kl-image-dropper.ts","src/app/script/klecks/ui/components/overlay-toolspace.ts","src/app/script/klecks/ui/components/toolspace-top-row.ts","node_modules/@parcel/runtime-js/lib/runtime-7df504581c8b86ae.js","node_modules/@parcel/runtime-js/lib/runtime-051039d7aa46660a.js","node_modules/@parcel/runtime-js/lib/runtime-c3ac4661b4a56a9b.js","node_modules/@parcel/runtime-js/lib/runtime-b17cc4a4601be3c4.js","node_modules/@parcel/runtime-js/lib/runtime-ba29718ea135d20f.js","node_modules/@parcel/runtime-js/lib/runtime-4ecaac3815a70635.js","src/app/script/klecks/ui/components/tool-dropdown.ts","node_modules/@parcel/runtime-js/lib/runtime-8bdb8bdd8828f06e.js","node_modules/@parcel/runtime-js/lib/runtime-0b39f3111ea9252b.js","node_modules/@parcel/runtime-js/lib/runtime-48932223f89234d1.js","node_modules/@parcel/runtime-js/lib/runtime-7d10910deba19d0d.js","node_modules/@parcel/runtime-js/lib/runtime-88790bdf968aa944.js","node_modules/@parcel/runtime-js/lib/runtime-19a2d39e17cbc785.js","src/app/script/klecks/ui/components/toolspace-tool-row.ts","node_modules/@parcel/runtime-js/lib/runtime-41c7a6bdeb9cc3fc.js","node_modules/@parcel/runtime-js/lib/runtime-c4a854cd9c2e49c9.js","node_modules/@parcel/runtime-js/lib/runtime-71bc2704037e4034.js","node_modules/@parcel/runtime-js/lib/runtime-1efd7f94627b6b51.js","src/app/script/klecks/ui/components/toolspace-stabilizer-row.ts","src/app/script/klecks/ui/components/tab-row.ts","node_modules/@parcel/runtime-js/lib/runtime-16dea92aa233c3d8.js","src/app/script/klecks/ui/tool-tabs/hand-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-144f3179c6c3fe3c.js","src/app/script/klecks/ui/tool-tabs/fill-ui.ts","src/app/script/klecks/ui/tool-tabs/text-ui.ts","src/app/script/klecks/ui/tool-tabs/shape-ui.ts","src/app/script/klecks/ui/modals/new-image-dialog.ts","src/app/script/klecks/ui/components/table.ts","src/app/script/klecks/ui/components/toolspace-collapser.ts","node_modules/@parcel/runtime-js/lib/runtime-61134bbd82dc83a9.js","src/app/script/klecks/ui/modals/text-tool-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-4b94518680a7ea9a.js","node_modules/@parcel/runtime-js/lib/runtime-27c12d26a5335a1c.js","node_modules/@parcel/runtime-js/lib/runtime-a2156221f02ea6ff.js","node_modules/@parcel/runtime-js/lib/runtime-095fd25bc9573bb4.js","node_modules/@parcel/runtime-js/lib/runtime-91916a44e9213781.js","src/app/script/klecks/ui/modals/show-import-image-dialog.ts","src/app/script/klecks/storage/psd.ts","src/app/script/klecks/storage/indexed-db.ts","src/app/script/klecks/filters/filters.ts","node_modules/@parcel/runtime-js/lib/runtime-acf4a19a71cb937a.js","node_modules/@parcel/runtime-js/lib/runtime-d67887a6c0fb147f.js","node_modules/@parcel/runtime-js/lib/runtime-1951d0f45b837ff9.js","node_modules/@parcel/runtime-js/lib/runtime-bb176b3b6425aaaa.js","node_modules/@parcel/runtime-js/lib/runtime-dbc18e2745ca65c5.js","node_modules/@parcel/runtime-js/lib/runtime-80911ed486f33545.js","node_modules/@parcel/runtime-js/lib/runtime-eead2608d2fa5bd2.js","node_modules/@parcel/runtime-js/lib/runtime-9a1e033a88e16096.js","node_modules/@parcel/runtime-js/lib/runtime-c9bd458795fed0ba.js","node_modules/@parcel/runtime-js/lib/runtime-5626aa10019711dd.js","node_modules/@parcel/runtime-js/lib/runtime-2044b7aa526106e6.js","node_modules/@parcel/runtime-js/lib/runtime-21795bc53efbcb17.js","node_modules/@parcel/runtime-js/lib/runtime-d5912d6d1ba72424.js","node_modules/@parcel/runtime-js/lib/runtime-d72562b990dee7d8.js","node_modules/@parcel/runtime-js/lib/runtime-0b2b4c30952b5c7d.js","node_modules/@parcel/runtime-js/lib/runtime-64c83be280987e8f.js","node_modules/@parcel/runtime-js/lib/runtime-ca97bf89fb66f180.js","node_modules/@parcel/runtime-js/lib/runtime-9fe1796050e673a2.js","src/app/script/klecks/brushes/brushes.ts","src/app/script/klecks/brushes/pen-brush.ts","src/app/script/klecks/brushes/brushes-common.ts","src/app/script/klecks/brushes/alphas/brush-alphas.ts","src/app/script/bb/math/perlin.ts","src/app/script/klecks/brushes/blend-brush.ts","src/app/script/klecks/brushes/sketchy-brush.ts","src/app/script/klecks/brushes/pixel-brush.ts","src/app/script/klecks/brushes/eraser-brush.ts","src/app/script/klecks/brushes/smudge-brush.ts","src/app/script/klecks/brushes/chemy-brush.ts","src/app/script/klecks/brushes-ui/brushes-ui.ts","src/app/script/klecks/brushes-ui/pen-brush-ui.ts","src/app/script/klecks/brushes-ui/brushes-consts.ts","node_modules/@parcel/runtime-js/lib/runtime-317d41dd30e22153.js","src/app/script/klecks/brushes-ui/blend-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-fb4dfe91dd51f3ab.js","src/app/script/klecks/brushes-ui/sketchy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-9c55c239f6725590.js","src/app/script/klecks/brushes-ui/pixel-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-7deb3a76132d4783.js","src/app/script/klecks/brushes-ui/eraser-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-64ee3a6e15622cad.js","src/app/script/klecks/brushes-ui/smudge-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-69a46bfcd4b52be6.js","src/app/script/klecks/brushes-ui/chemy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-67968a5afa6a1356.js","src/app/script/klecks/ui/modals/show-iframe-modal.ts","src/app/script/klecks/ui/components/radio-list.ts","src/app/script/klecks/ui/components/browser-storage-ui.ts","src/app/script/klecks/storage/project-store.ts","src/app/script/klecks/storage/project-converter.ts","src/app/script/klecks/storage/base-64-to-blob.ts","src/app/script/klecks/ui/tool-tabs/file-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-237dc2978439233a.js","src/app/script/klecks/ui/tool-tabs/filter-tab.ts","src/app/script/klecks/ui/modals/imgur-upload.ts","node_modules/@parcel/runtime-js/lib/runtime-5b3a6227e48c006a.js","src/app/script/klecks/ui/components/save-reminder.ts","src/app/script/klecks/storage/save-to-computer.ts","src/app/script/bb/base/save-as.ts","src/app/script/klecks/history/undo-redo-catchup.ts","src/app/script/klecks/brushes-ui/brush-setting-service.ts","src/app/script/klecks/ui/tool-tabs/settings-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-476b50212be070a0.js","node_modules/@parcel/runtime-js/lib/runtime-f5c56ad551a77e9a.js","node_modules/@parcel/runtime-js/lib/runtime-4135c6b241ed0f39.js","src/app/script/klecks/ui/components/toolspace-scroller.ts","src/app/script/klecks/ui/tool-tabs/gradient-ui.ts","src/app/script/embed/embed-toolspace-top-row.ts","src/app/script/klecks/filters/filters-lazy.ts","src/app/script/klecks/filters/filter-brightness-contrast.ts","src/app/script/klecks/filters/filters-consts.ts","src/app/script/fx-canvas/shared-fx.ts","src/app/script/fx-canvas/fx-canvas.ts","src/app/script/fx-canvas/filters/brightness-contrast.ts","src/app/script/fx-canvas/core/simple-shader.ts","src/app/script/fx-canvas/core/fx-shader.ts","src/app/script/fx-canvas/core/gl.ts","src/app/script/fx-canvas/core/fx-texture.ts","src/app/script/fx-canvas/filters/curves.ts","src/app/script/fx-canvas/math/spline-interpolate.ts","src/app/script/fx-canvas/filters/hue-saturation.ts","src/app/script/fx-canvas/filters/noise.ts","src/app/script/fx-canvas/shaders/shader-noise.glsl","src/app/script/fx-canvas/filters/triangle-blur.ts","src/app/script/fx-canvas/shaders/random-shader-func.ts","src/app/script/fx-canvas/filters/tilt-shift.ts","src/app/script/fx-canvas/filters/matrix-warp.ts","src/app/script/fx-canvas/shaders/warp-shader.ts","src/app/script/fx-canvas/math/matrix.ts","src/app/script/fx-canvas/filters/unsharp-mask.ts","src/app/script/fx-canvas/filters/to-alpha.ts","src/app/script/fx-canvas/filters/invert.ts","src/app/script/fx-canvas/filters/perspective.ts","src/app/script/fx-canvas/filters/unmultiply-alpha.ts","src/app/script/fx-canvas/filters/distort.ts","src/app/script/fx-canvas/filters/multiply-alpha.ts","src/app/script/klecks/filters/filter-crop-extend.ts","src/app/script/klecks/filters/filter-curves.ts","src/app/script/klecks/filters/filter-curves/curves-input.ts","src/app/script/klecks/filters/filter-flip.ts","src/app/script/klecks/filters/filter-hue-saturation.ts","src/app/script/klecks/filters/filter-invert.ts","src/app/script/klecks/filters/filter-perspective.ts","src/app/script/klecks/ui/components/two-tabs.ts","src/app/script/klecks/filters/filter-resize.ts","node_modules/@parcel/runtime-js/lib/runtime-cd2cbb52134a8268.js","src/app/script/klecks/filters/filter-rotate.ts","src/app/script/klecks/filters/filter-tilt-shift.ts","src/app/script/klecks/filters/filter-transform.ts","src/app/script/klecks/filters/filter-blur.ts","src/app/script/klecks/filters/filter-unsharp-mask.ts","src/app/script/klecks/filters/filter-to-alpha.ts","src/app/script/klecks/filters/filter-grid.ts","src/app/script/klecks/image-operations/draw-grid.ts","src/app/script/klecks/filters/filter-noise.ts","src/app/script/klecks/filters/filter-pattern.ts","src/app/script/klecks/filters/filter-distort.ts","src/app/script/klecks/filters/filter-vanish-point.ts","src/app/script/klecks/image-operations/draw-vanish-point.ts","src/app/script/klecks/storage/kl-canvas-to-psd-blob.ts","src/app/script/klecks/events/line-smoothing.ts","src/app/script/klecks/events/line-sanitizer.ts","src/app/script/klecks/utils/translate-smoothing.ts","src/app/script/app/import-handler.ts","node_modules/@parcel/runtime-js/lib/runtime-6ea03b887069337c.js","node_modules/@parcel/runtime-js/lib/runtime-a1a8750389ec178d.js","src/app/script/app/console-api.ts"],"sourcesContent":["import './polyfills/polyfills';\r\nimport {KlApp} from './app/kl-app';\r\nimport {IKlProject} from './klecks/kl-types';\r\nimport {SaveReminder} from './klecks/ui/components/save-reminder';\r\nimport {klHistory} from './klecks/history/kl-history';\r\nimport {klPsdToKlProject, readPsd} from './klecks/storage/psd';\r\nimport {LANG} from './language/language';\r\nimport {loadAgPsd} from './klecks/storage/load-ag-psd';\r\n\r\nexport interface IEmbedParams {\r\n    project?: IKlProject;\r\n    psdBlob?: Blob;\r\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n    embedUrl: string;\r\n    logoImg?: any;\r\n    bottomBar?: HTMLElement;\r\n    aboutEl?: HTMLElement;\r\n}\r\n\r\nexport interface IReadPSD {\r\n    blob: Blob;\r\n    callback: (k: IKlProject) => void;\r\n}\r\n\r\nexport function Embed (p: IEmbedParams) {\r\n\r\n    let isInitialized: boolean = false;\r\n    let klApp;\r\n    const psdQueue: IReadPSD[] = []; // queue of psds waiting while ag-psd is loading\r\n    let agPsd: any | 'error';\r\n\r\n    let loadingScreenEl = document.getElementById('loading-screen');\r\n    let loadingScreenTextEl = document.getElementById('loading-screen-text');\r\n    if (loadingScreenTextEl) {\r\n        loadingScreenTextEl.textContent = LANG('embed-init-waiting');\r\n    }\r\n\r\n    function onProjectReady (project: IKlProject) {\r\n        try {\r\n            if (isInitialized) {\r\n                throw new Error('Already called openProject');\r\n            }\r\n            isInitialized = true;\r\n\r\n            const saveReminder = new SaveReminder(\r\n                klHistory,\r\n                false,\r\n                false,\r\n                () => {},\r\n                () => klApp ? klApp.isDrawing() : false,\r\n                null,\r\n                null,\r\n            );\r\n            klApp = new KlApp(\r\n                project,\r\n                {\r\n                    saveReminder,\r\n                    bottomBar: p.bottomBar,\r\n                    aboutEl: p.aboutEl,\r\n                    embed: {\r\n                        url: p.embedUrl,\r\n                        onSubmit: p.onSubmit,\r\n                    },\r\n                }\r\n            );\r\n            saveReminder.init();\r\n\r\n            if (loadingScreenEl && loadingScreenEl.parentNode) {\r\n                loadingScreenEl.parentNode.removeChild(loadingScreenEl);\r\n            }\r\n            loadingScreenEl = null;\r\n            loadingScreenTextEl = null;\r\n\r\n            document.body.append(klApp.getEl());\r\n        } catch (e) {\r\n            if (loadingScreenTextEl) {\r\n                loadingScreenTextEl.textContent = ' ' + e;\r\n            }\r\n            if (loadingScreenEl) {\r\n                loadingScreenEl.className += 'loading-screen-error';\r\n            }\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    if (p.project) {\r\n        onProjectReady(p.project);\r\n    }\r\n    this.openProject = onProjectReady;\r\n    this.initError = (error: string) => {\r\n        if (loadingScreenTextEl) {\r\n            loadingScreenTextEl.textContent = ' ' + error;\r\n        }\r\n        if (loadingScreenEl) {\r\n            loadingScreenEl.className += 'loading-screen-error';\r\n        }\r\n    };\r\n    this.getPNG = (): Blob => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return klApp.getPNG();\r\n    };\r\n    this.getPSD = async (): Promise<Blob> => {\r\n        if (!klApp) {\r\n            throw new Error('App not initialized');\r\n        }\r\n        return await klApp.getPSD();\r\n    };\r\n    this.readPSDs = (psds: IReadPSD[]) => {\r\n        if (psds.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const readItem = (item: IReadPSD) => {\r\n            try {\r\n                const psd = agPsd.readPsd(item.blob);\r\n                const project = klPsdToKlProject(readPsd(psd));\r\n                item.callback(project);\r\n            } catch (e) {\r\n                console.error('failed to read psd', e);\r\n                item.callback(null);\r\n            }\r\n        };\r\n\r\n        if (!agPsd) {\r\n            if (psdQueue.length === 0) {\r\n                // load ag-psd\r\n                (async () => {\r\n                    try {\r\n                        agPsd = await loadAgPsd();\r\n                    } catch (e) {\r\n                        agPsd = 'error';\r\n                    }\r\n                    while (psdQueue.length) {\r\n                        readItem(psdQueue.shift());\r\n                    }\r\n                })();\r\n            }\r\n            psds.forEach(item => {\r\n                psdQueue.push(item);\r\n            });\r\n        } else {\r\n            psds.forEach(readItem);\r\n        }\r\n    };\r\n}","import './polyfills-nomodule';\r\n\r\n/*\r\n * ---- Below ----------------------\r\n * features that didn't have support until *after* browsers supported the modules script tag:\r\n * chrome 61\r\n * edge 16\r\n * safari 11\r\n * firefox 60\r\n * https://caniuse.com/es6-module\r\n */\r\n\r\n// chrome 61, edge 79, safari 16, firefox 107\r\nif (!('scrollTo' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollTo', {\r\n        value: function (x: number, y: number) {\r\n            this.scrollLeft = x;\r\n            this.scrollTop = y;\r\n        },\r\n    });\r\n}\r\n\r\n// chrome 61, edge 79, safari 16, firefox 107\r\nif (!('scrollBy' in Element.prototype)) {\r\n    Object.defineProperty(Element.prototype, 'scrollBy', {\r\n        value: function (x: number, y: number) {\r\n            this.scrollLeft += x;\r\n            this.scrollTop += y;\r\n        },\r\n    });\r\n}\r\n\r\n// chrome 69, edge 79, safari 12, firefox 62\r\nif (!Array.prototype.flat) {\r\n    Object.defineProperty(Array.prototype, 'flat', {\r\n        configurable: true,\r\n        value: function flat () {\r\n            const depth = isNaN(arguments[0]) ? 1 : Number(arguments[0]);\r\n\r\n            return depth ? Array.prototype.reduce.call(this, function (acc, cur) {\r\n                if (Array.isArray(cur)) {\r\n                    acc.push.apply(acc, flat.call(cur, depth - 1));\r\n                } else {\r\n                    acc.push(cur);\r\n                }\r\n\r\n                return acc;\r\n            }, []) : Array.prototype.slice.call(this);\r\n        },\r\n        writable: true,\r\n    });\r\n}\r\n\r\n// sometimes Android WebView has no localStorage\r\nif (!('localStorage' in window)) {\r\n    try {\r\n        window['localStorage'] = {\r\n            getItem: () => null,\r\n            setItem: () => {},\r\n            removeItem: () => {},\r\n        } as any;\r\n    } catch (e) {\r\n        // maybe it fails?\r\n    }\r\n}\r\n","/**\r\n * features that were available before module script tags:\r\n * chrome 61\r\n * edge 16\r\n * safari 11\r\n * firefox 60\r\n * https://caniuse.com/es6-module\r\n */\r\n\r\nimport 'mdn-polyfills/Node.prototype.append';\r\nimport 'mdn-polyfills/Node.prototype.prepend'; // edge 17 (one version after module)\r\nimport 'mdn-polyfills/String.prototype.padStart';\r\nimport 'mdn-polyfills/Array.prototype.findIndex';","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"append\")||Object.defineProperty(e,\"append\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(n,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"prepend\")||Object.defineProperty(e,\"prepend\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","String.prototype.padStart||(String.prototype.padStart=function(t,n){return t>>=0,n=String(n||\" \"),this.length>t?String(this):((t-=this.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(this))});\n","Array.prototype.findIndex||Object.defineProperty(Array.prototype,\"findIndex\",{value:function(r){if(null==this)throw new TypeError('\"this\" is null or not defined');var e=Object(this),t=e.length>>>0;if(\"function\"!=typeof r)throw new TypeError(\"predicate must be a function\");for(var n=arguments[1],o=0;o<t;){var i=e[o];if(r.call(n,i,o,e))return o;o++}return-1}});\n","import {KL} from '../klecks/kl';\r\nimport {klHistory, TMiscFocusLayerHistoryEntry} from '../klecks/history/kl-history';\r\nimport {BB} from '../bb/bb';\r\nimport {showIframeModal} from '../klecks/ui/modals/show-iframe-modal';\r\nimport {EmbedToolspaceTopRow} from '../embed/embed-toolspace-top-row';\r\nimport {\r\n    IGradient,\r\n    IInitState,\r\n    IKlProject,\r\n    TDrawEvent,\r\n    TExportType,\r\n    TKlCanvasLayer,\r\n    TUiLayout,\r\n} from '../klecks/kl-types';\r\nimport {importFilters} from '../klecks/filters/filters-lazy';\r\nimport {base64ToBlob} from '../klecks/storage/base-64-to-blob';\r\nimport {klCanvasToPsdBlob} from '../klecks/storage/kl-canvas-to-psd-blob';\r\nimport {ProjectStore} from '../klecks/storage/project-store';\r\nimport {SaveReminder} from '../klecks/ui/components/save-reminder';\r\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\r\nimport {LANG} from '../language/language';\r\nimport {LocalStorage} from '../bb/base/local-storage';\r\nimport {LineSmoothing} from '../klecks/events/line-smoothing';\r\nimport {LineSanitizer} from '../klecks/events/line-sanitizer';\r\nimport {TabRow} from '../klecks/ui/components/tab-row';\r\nimport {LayerPreview} from '../klecks/ui/components/layer-preview';\r\nimport {KlColorSlider} from '../klecks/ui/components/kl-color-slider';\r\nimport {ToolspaceToolRow} from '../klecks/ui/components/toolspace-tool-row';\r\nimport {StatusOverlay} from '../klecks/ui/components/status-overlay';\r\nimport {SaveToComputer} from '../klecks/storage/save-to-computer';\r\nimport {ToolspaceCollapser} from '../klecks/ui/components/toolspace-collapser';\r\nimport {ToolspaceScroller} from '../klecks/ui/components/toolspace-scroller';\r\nimport {translateSmoothing} from '../klecks/utils/translate-smoothing';\r\nimport {ImportHandler} from './import-handler';\r\n\r\nimport toolPaintImg from '/src/app/img/ui/tool-paint.svg';\r\nimport toolHandImg from '/src/app/img/ui/tool-hand.svg';\r\nimport toolFillImg from '/src/app/img/ui/tool-fill.svg';\r\nimport toolGradientImg from '/src/app/img/ui/tool-gradient.svg';\r\nimport toolTextImg from '/src/app/img/ui/tool-text.svg';\r\nimport toolShapeImg from '/src/app/img/ui/tool-shape.svg';\r\nimport tabSettingsImg from '/src/app/img/ui/tab-settings.svg';\r\nimport tabLayersImg from '/src/app/img/ui/tab-layers.svg';\r\nimport {LayerManager} from '../klecks/ui/tool-tabs/layer-manager/layer-manager';\r\nimport {IVector2D} from '../bb/bb-types';\r\nimport {createConsoleApi} from './console-api';\r\nimport {ERASE_COLOR} from '../klecks/brushes/erase-color';\r\n\r\ntype KlAppOptionsEmbed = {\r\n    url: string;\r\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\r\n};\r\n\r\ninterface IKlAppOptions {\r\n    saveReminder?: SaveReminder;\r\n    projectStore?: ProjectStore;\r\n    logoImg?: string; // app logo\r\n    bottomBar?: HTMLElement; // row at bottom of toolspace\r\n    embed?: KlAppOptionsEmbed;\r\n    app?: {\r\n        filenameBase?: string; // part of filename when downloading drawing\r\n        imgurKey?: string; // for imgur uploads\r\n    };\r\n    aboutEl?: HTMLElement; // replaces info about Klecks in settings tab\r\n}\r\n\r\nimportFilters();\r\n\r\nexport class KlApp {\r\n\r\n    private readonly klRootEl: HTMLElement;\r\n    private uiWidth: number;\r\n    private uiHeight: number;\r\n    private readonly layerPreview: LayerPreview;\r\n    private readonly klColorSlider: KlColorSlider;\r\n    private readonly toolspaceToolRow: ToolspaceToolRow;\r\n    private readonly statusOverlay: StatusOverlay;\r\n    private readonly klCanvas: KlCanvas;\r\n    private uiState: TUiLayout;\r\n    private readonly embed: undefined | KlAppOptionsEmbed;\r\n    private readonly saveToComputer: SaveToComputer;\r\n    private readonly lineSanitizer: LineSanitizer;\r\n    private readonly klCanvasWorkspace: KlCanvasWorkspace;\r\n    private readonly collapseThreshold: number = 820;\r\n    private readonly toolspaceCollapser: ToolspaceCollapser;\r\n    private readonly toolspace: HTMLElement;\r\n    private readonly toolspaceInner: HTMLElement;\r\n    private readonly toolWidth: number = 271;\r\n    private readonly bottomBar: HTMLElement | undefined;\r\n    private readonly layerManager: LayerManager;\r\n    private readonly toolspaceScroller: ToolspaceScroller;\r\n    private readonly bottomBarWrapper: HTMLElement;\r\n\r\n    private updateCollapse (): void {\r\n\r\n        //collapser\r\n        if (this.uiWidth < this.collapseThreshold) {\r\n            this.toolspaceCollapser.getElement().style.display = 'block';\r\n\r\n            this.toolspaceCollapser.setDirection(this.uiState);\r\n            if (this.toolspaceCollapser.isOpen()) {\r\n                if (this.uiState === 'left') {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '271px',\r\n                        right: '',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '271px',\r\n                    });\r\n                } else {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '271px',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '0',\r\n                    });\r\n                }\r\n                this.toolspace.style.display = 'block';\r\n                this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\r\n                this.statusOverlay.setWide(false);\r\n\r\n            } else {\r\n                if (this.uiState === 'left') {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '0',\r\n                        right: '',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '0',\r\n                    });\r\n                } else {\r\n                    BB.css(this.toolspaceCollapser.getElement(), {\r\n                        left: '',\r\n                        right: '0',\r\n                    });\r\n                    BB.css(this.klCanvasWorkspace.getElement(), {\r\n                        left: '0',\r\n                    });\r\n                }\r\n                this.toolspace.style.display = 'none';\r\n                this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth), this.uiHeight);\r\n                this.statusOverlay.setWide(true);\r\n\r\n            }\r\n\r\n        } else {\r\n            this.toolspaceCollapser.getElement().style.display = 'none';\r\n            if (this.uiState === 'left') {\r\n                BB.css(this.klCanvasWorkspace.getElement(), {\r\n                    left: '271px',\r\n                });\r\n            } else {\r\n                BB.css(this.klCanvasWorkspace.getElement(), {\r\n                    left: '0',\r\n                });\r\n            }\r\n            this.toolspace.style.display = 'block';\r\n            this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\r\n            this.statusOverlay.setWide(false);\r\n        }\r\n    }\r\n\r\n    private updateBottomBar (): void {\r\n        if (!this.bottomBar) {\r\n            return;\r\n        }\r\n        const isVisible = (this.toolspaceInner.scrollHeight + 40 < window.innerHeight);\r\n        this.bottomBarWrapper.style.display = isVisible ? '' : 'none';\r\n    }\r\n\r\n    private updateUi (): void {\r\n        this.toolspace.classList.toggle('kl-toolspace--left', this.uiState === 'left');\r\n        this.toolspace.classList.toggle('kl-toolspace--right', this.uiState === 'right');\r\n        if (this.uiState === 'left') {\r\n            BB.css(this.toolspace, {\r\n                left: '0',\r\n                right: '',\r\n            });\r\n            BB.css(this.klCanvasWorkspace.getElement(), {\r\n                left: '271px',\r\n            });\r\n        } else {\r\n            BB.css(this.toolspace, {\r\n                left: '',\r\n                right: '0',\r\n            });\r\n            BB.css(this.klCanvasWorkspace.getElement(), {\r\n                left: '0',\r\n            });\r\n        }\r\n        this.statusOverlay.setUiState(this.uiState);\r\n        this.layerPreview.setUiState(this.uiState);\r\n        this.layerManager.setUiState(this.uiState);\r\n        this.updateCollapse();\r\n        this.toolspaceScroller.updateUiState(this.uiState);\r\n    }\r\n\r\n    // -------- public --------\r\n    constructor (\r\n        pProject: IKlProject | null,\r\n        pOptions: IKlAppOptions,\r\n    ) {\r\n        this.embed = pOptions.embed;\r\n        // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\r\n        // but not larger than 4096 - a fairly arbitrary decision\r\n        const klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\r\n        this.uiState = (this.embed ? 'left' : (LocalStorage.getItem('uiState') ? LocalStorage.getItem('uiState') : 'right')) as TUiLayout;\r\n        const filenameBase = pOptions.app?.filenameBase ? pOptions.app.filenameBase : 'Klecks';\r\n        const projectStore = pOptions.projectStore;\r\n        this.klRootEl = BB.el({\r\n            className: 'g-root',\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n            },\r\n        });\r\n        this.uiWidth = Math.max(0, window.innerWidth);\r\n        this.uiHeight = Math.max(0, window.innerHeight);\r\n        let exportType: TExportType = 'png';\r\n        this.klCanvas = new KL.KlCanvas(\r\n            pProject ? {\r\n                projectObj: pProject,\r\n            } : {\r\n                width: Math.max(10, Math.min(klMaxCanvasSize, window.innerWidth < this.collapseThreshold ? this.uiWidth : this.uiWidth - this.toolWidth)),\r\n                height: Math.max(10, Math.min(klMaxCanvasSize, this.uiHeight)),\r\n            }, this.embed ? -1 : 0);\r\n        this.klCanvas.setHistory(klHistory);\r\n        let initState: IInitState | null = null;\r\n        let mainTabRow: TabRow | undefined;\r\n\r\n        if (!pOptions.saveReminder) {\r\n            pOptions.saveReminder = {init: () => {}, reset: () => {}} as SaveReminder;\r\n        }\r\n\r\n        if (pProject) {\r\n            pProject.layers.forEach(layer => {\r\n                layer.image = null;\r\n            });\r\n            pProject = null;\r\n        } else {\r\n            klHistory.pause(true);\r\n            this.klCanvas.addLayer();\r\n            this.klCanvas.layerFill(0, {r: ERASE_COLOR, g: ERASE_COLOR, b: ERASE_COLOR});\r\n            klHistory.pause(false);\r\n        }\r\n        try {\r\n            initState = {\r\n                canvas: new KL.KlCanvas({copy: this.klCanvas}, this.embed ? -1 : 0),\r\n                focus: this.klCanvas.getLayerCount() - 1,\r\n                brushes: {},\r\n            };\r\n        } catch (e) {\r\n            if (e.message === 'kl-create-canvas-error') {\r\n                this.klCanvas.destroy();\r\n            }\r\n            throw e;\r\n        }\r\n        Object.entries(KL.brushes).forEach(([b, Brush]) => {\r\n            initState.brushes[b] = new Brush();\r\n            if (initState.canvas) {\r\n                initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\r\n            }\r\n        });\r\n\r\n\r\n        let currentColor = new BB.RGB(0, 0, 0);\r\n        let currentBrushUi;\r\n        let currentBrushId: string;\r\n        let lastNonEraserBrushId: string;\r\n        let currentLayerCtx = this.klCanvas.getLayerContext(this.klCanvas.getLayerCount() - 1);\r\n\r\n        // when cycling through brushes you need to know the next non-eraser brush\r\n        const getNextBrushId = (): string => {\r\n            if (currentBrushId === 'eraserBrush') {\r\n                return lastNonEraserBrushId;\r\n            }\r\n            const keyArr = Object.keys(brushUiMap).filter(item => item !== 'eraserBrush');\r\n            const i = keyArr.findIndex(item => item === currentBrushId);\r\n            return keyArr[(i + 1) % keyArr.length];\r\n        };\r\n\r\n        const sizeWatcher = (val) => {\r\n            brushSettingService.emitSize(val);\r\n            if (this.klCanvasWorkspace) {\r\n                this.klCanvasWorkspace.setCursorSize(val * 2);\r\n            }\r\n        };\r\n\r\n        const brushSettingService = new KL.BrushSettingService(\r\n            (color) => {\r\n                this.klColorSlider.setColor(color);\r\n                currentBrushUi.setColor(color);\r\n                currentColor = BB.copyObj(color);\r\n            },\r\n            (size) => {\r\n                currentBrushUi.setSize(size);\r\n                this.klCanvasWorkspace.setCursorSize(size * 2);\r\n            },\r\n            (opacity) => {\r\n                currentBrushUi.setOpacity(opacity);\r\n            },\r\n            () => this.klColorSlider.getColor(),\r\n            () => brushUiMap[currentBrushId].getSize(),\r\n            () => brushUiMap[currentBrushId].getOpacity(),\r\n            () => {\r\n                return {\r\n                    sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                    opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\r\n                };\r\n            }\r\n        );\r\n\r\n        const lineSmoothing = new LineSmoothing({\r\n            smoothing: translateSmoothing(1),\r\n        });\r\n        this.lineSanitizer = new LineSanitizer();\r\n\r\n        const drawEventChain = new BB.EventChain({\r\n            chainArr: [\r\n                this.lineSanitizer,\r\n                lineSmoothing,\r\n            ],\r\n        });\r\n\r\n        drawEventChain.setChainOut((event: TDrawEvent) => {\r\n            if (event.type === 'down') {\r\n                this.toolspace.style.pointerEvents = 'none';\r\n                currentBrushUi.startLine(event.x, event.y, event.pressure);\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n            if (event.type === 'move') {\r\n                currentBrushUi.goLine(event.x, event.y, event.pressure, false, event.isCoalesced);\r\n                this.klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n            if (event.type === 'up') {\r\n                this.toolspace.style.pointerEvents = '';\r\n                currentBrushUi.endLine();\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n            if (event.type === 'line') {\r\n                currentBrushUi.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\r\n                this.klCanvasWorkspace.requestFrame();\r\n            }\r\n        });\r\n\r\n        const textToolSettings = {\r\n            size: 20,\r\n            align: 'left' as ('left' | 'center' | 'right'),\r\n            isBold: false,\r\n            isItalic: false,\r\n            font: 'sans-serif' as ('serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'),\r\n            opacity: 1,\r\n        };\r\n\r\n        this.klCanvasWorkspace = new KL.KlCanvasWorkspace({\r\n            klCanvas: this.klCanvas,\r\n            width: Math.max(0, this.uiWidth - this.toolWidth),\r\n            height: this.uiHeight,\r\n            onDraw: (e) => drawEventChain.chainIn(e),\r\n            onPick: (rgbObj, isDragDone) => {\r\n                brushSettingService.setColor(rgbObj);\r\n                if (isDragDone) {\r\n                    this.klColorSlider.pickingDone();\r\n                    this.klCanvasWorkspace.setMode(this.toolspaceToolRow.getActive());\r\n                }\r\n            },\r\n            onFill: (canvasX, canvasY) => {\r\n                const layerIndex = this.klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                this.klCanvas.floodFill(\r\n                    layerIndex,\r\n                    canvasX,\r\n                    canvasY,\r\n                    fillUi.getIsEraser() ? null : this.klColorSlider.getColor(),\r\n                    fillUi.getOpacity(),\r\n                    fillUi.getTolerance(),\r\n                    fillUi.getSample(),\r\n                    fillUi.getGrow(),\r\n                    fillUi.getContiguous()\r\n                );\r\n                this.klCanvasWorkspace.requestFrame();\r\n            },\r\n            onGradient: (typeStr, canvasX, canvasY, angleRad) => {\r\n                if (typeStr === 'down') {\r\n                    gradientTool.onDown(canvasX, canvasY, angleRad);\r\n                }\r\n                if (typeStr === 'move') {\r\n                    gradientTool.onMove(canvasX, canvasY);\r\n                }\r\n                if (typeStr === 'up') {\r\n                    gradientTool.onUp(canvasX, canvasY);\r\n                }\r\n            },\r\n            onText: (canvasX, canvasY, angleRad) => {\r\n                if (KL.dialogCounter.get() > 0) {\r\n                    return;\r\n                }\r\n\r\n                KL.textToolDialog({\r\n                    klCanvas: this.klCanvas,\r\n                    layerIndex: this.klCanvas.getLayerIndex(currentLayerCtx.canvas),\r\n                    x: canvasX,\r\n                    y: canvasY,\r\n                    angleRad: angleRad,\r\n                    color: this.klColorSlider.getColor(),\r\n                    secondaryColor: this.klColorSlider.getSecondaryRGB(),\r\n                    size: textToolSettings.size,\r\n                    align: textToolSettings.align,\r\n                    isBold: textToolSettings.isBold,\r\n                    isItalic: textToolSettings.isItalic,\r\n                    font: textToolSettings.font,\r\n                    opacity: textToolSettings.opacity,\r\n                    onConfirm: (val) => {\r\n\r\n                        const colorRGBA = val.color;\r\n                        colorRGBA.a = val.opacity;\r\n\r\n                        textToolSettings.size = val.size;\r\n                        textToolSettings.align = val.align;\r\n                        textToolSettings.isBold = val.isBold;\r\n                        textToolSettings.isItalic = val.isItalic;\r\n                        textToolSettings.font = val.font;\r\n                        textToolSettings.opacity = val.opacity;\r\n\r\n                        const layerIndex = this.klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                        this.klCanvas.text(layerIndex, {\r\n                            textStr: val.textStr,\r\n                            x: val.x,\r\n                            y: val.y,\r\n                            size: val.size,\r\n                            font: val.font,\r\n                            align: val.align,\r\n                            isBold: val.isBold,\r\n                            isItalic: val.isItalic,\r\n                            angleRad: angleRad,\r\n                            color: BB.ColorConverter.toRgbaStr(colorRGBA),\r\n                        });\r\n                        this.klCanvasWorkspace.requestFrame();\r\n                    },\r\n                });\r\n\r\n            },\r\n            onShape: (typeStr, canvasX, canvasY, angleRad) => {\r\n                if (typeStr === 'down') {\r\n                    shapeTool.onDown(canvasX, canvasY, angleRad);\r\n                }\r\n                if (typeStr === 'move') {\r\n                    shapeTool.onMove(canvasX, canvasY);\r\n                }\r\n                if (typeStr === 'up') {\r\n                    shapeTool.onUp(canvasX, canvasY);\r\n                }\r\n            },\r\n\r\n            onViewChange: (viewChangeObj) => {\r\n\r\n                if (viewChangeObj.changed.includes('scale')) {\r\n                    this.statusOverlay.out({\r\n                        type: 'transform',\r\n                        scale: viewChangeObj.scale,\r\n                        angleDeg: viewChangeObj.angle * 180 / Math.PI,\r\n                    });\r\n                }\r\n\r\n                this.toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== this.klCanvasWorkspace.getMaxScale());\r\n                this.toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== this.klCanvasWorkspace.getMinScale());\r\n\r\n                handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\r\n            },\r\n            onUndo: () => {\r\n                if (klHistory.canUndo()) {\r\n                    if (undoRedoCatchup.undo()) {\r\n                        this.statusOverlay.out(LANG('undo'), true);\r\n                    }\r\n                }\r\n            },\r\n            onRedo: () => {\r\n                if (klHistory.canRedo()) {\r\n                    if (undoRedoCatchup.redo()) {\r\n                        this.statusOverlay.out(LANG('redo'), true);\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        const updateMainTabVisibility = () => {\r\n            if (!mainTabRow) {\r\n                return;\r\n            }\r\n\r\n            const toolObj = {\r\n                'draw': {},\r\n                'hand': {},\r\n                'fill': {},\r\n                'gradient': {},\r\n                'text': {},\r\n                'shape': {},\r\n            };\r\n\r\n            const activeStr = this.toolspaceToolRow.getActive();\r\n            const oldTabId = mainTabRow.getOpenedTabId();\r\n\r\n            const keysArr = Object.keys(toolObj);\r\n            for (let i = 0; i < keysArr.length; i++) {\r\n                if (activeStr === keysArr[i]) {\r\n                    mainTabRow.setIsVisible(keysArr[i], true);\r\n                } else {\r\n                    mainTabRow.setIsVisible(keysArr[i], false);\r\n                    if (oldTabId === keysArr[i]) {\r\n                        mainTabRow.open(activeStr);\r\n                    }\r\n                }\r\n            }\r\n\r\n        };\r\n\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr) => {\r\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n\r\n                const isDrawing = this.lineSanitizer.getIsDrawing() || this.klCanvasWorkspace.getIsDrawing();\r\n                if (isDrawing) {\r\n                    return;\r\n                }\r\n\r\n                if (comboStr === 'plus') {\r\n                    this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n                }\r\n                if (comboStr === 'minus') {\r\n                    this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n                }\r\n                if (comboStr === 'home') {\r\n                    this.klCanvasWorkspace.fitView();\r\n                }\r\n                if (comboStr === 'end') {\r\n                    this.klCanvasWorkspace.resetView(true);\r\n                }\r\n                if (['ctrl+z', 'cmd+z'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    undoRedoCatchup.undo();\r\n                }\r\n                if (\r\n                    ['ctrl+y', 'cmd+y'].includes(comboStr) ||\r\n                    (\r\n                        (\r\n                            BB.sameKeys('ctrl+shift+z', comboStr) ||\r\n                            BB.sameKeys('cmd+shift+z', comboStr)\r\n                        ) && keyStr === 'z'\r\n                    )\r\n                ) {\r\n                    event.preventDefault();\r\n                    undoRedoCatchup.redo();\r\n                }\r\n                if (!this.embed) {\r\n                    if (['ctrl+s', 'cmd+s'].includes(comboStr)) {\r\n                        event.preventDefault();\r\n                        this.saveToComputer.save();\r\n                    }\r\n                    if (['ctrl+shift+s', 'cmd+shift+s'].includes(comboStr)) {\r\n                        event.preventDefault();\r\n\r\n                        (async () => {\r\n                            let success = true;\r\n                            try {\r\n                                await projectStore.store(this.klCanvas.getProject());\r\n                            } catch (e) {\r\n                                success = false;\r\n                                setTimeout(() => {\r\n                                    throw new Error('keyboard-shortcut: failed to store browser storage, ' + e);\r\n                                }, 0);\r\n                                this.statusOverlay.out(' ' + LANG('file-storage-failed'), true);\r\n                            }\r\n                            if (success) {\r\n                                pOptions.saveReminder.reset();\r\n                                this.statusOverlay.out(LANG('file-storage-stored'), true);\r\n                            }\r\n                        })();\r\n                    }\r\n                    if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\r\n                        event.preventDefault();\r\n                        copyToClipboard(true);\r\n                    }\r\n                }\r\n                if (['ctrl+a', 'cmd+a'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                }\r\n\r\n\r\n                if (keyListener.comboOnlyContains(['left', 'right', 'up', 'down'])) {\r\n                    if (keyStr === 'left') {\r\n                        this.klCanvasWorkspace.translateView(1, 0);\r\n                    }\r\n                    if (keyStr === 'right') {\r\n                        this.klCanvasWorkspace.translateView(-1, 0);\r\n                    }\r\n                    if (keyStr === 'up') {\r\n                        this.klCanvasWorkspace.translateView(0, 1);\r\n                    }\r\n                    if (keyStr === 'down') {\r\n                        this.klCanvasWorkspace.translateView(0, -1);\r\n                    }\r\n                }\r\n\r\n\r\n                if (['r+left','r+right'].includes(comboStr)) {\r\n                    if (keyStr === 'left') {\r\n                        this.klCanvasWorkspace.setAngle(-15, true);\r\n                        handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                    if (keyStr === 'right') {\r\n                        this.klCanvasWorkspace.setAngle(15, true);\r\n                        handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                }\r\n                if (['r+up'].includes(comboStr)) {\r\n                    this.klCanvasWorkspace.setAngle(0);\r\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                }\r\n\r\n\r\n                if (comboStr === 'sqbr_open') {\r\n                    currentBrushUi.decreaseSize(0.03 / this.klCanvasWorkspace.getScale());\r\n                }\r\n                if (comboStr === 'sqbr_close') {\r\n                    currentBrushUi.increaseSize(0.03 / this.klCanvasWorkspace.getScale());\r\n                }\r\n                if (comboStr === 'enter') {\r\n                    this.klCanvas.layerFill(this.klCanvas.getLayerIndex(currentLayerCtx.canvas), this.klColorSlider.getColor());\r\n                    this.statusOverlay.out(LANG('filled'), true);\r\n                }\r\n                if (['delete', 'backspace'].includes(comboStr)) {\r\n                    const layerIndex = this.klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                    if (layerIndex === 0 && !brushUiMap.eraserBrush.getIsTransparentBg()) {\r\n                        this.klCanvas.layerFill(layerIndex, {r: 255, g: 255, b: 255}, 'source-in');\r\n                    } else {\r\n                        this.klCanvas.clearLayer(layerIndex);\r\n                    }\r\n                    this.statusOverlay.out(LANG('cleared-layer'), true);\r\n                }\r\n                if (comboStr === 'e') {\r\n                    event.preventDefault();\r\n                    this.klCanvasWorkspace.setMode('draw');\r\n                    this.toolspaceToolRow.setActive('draw');\r\n                    mainTabRow && mainTabRow.open('draw');\r\n                    updateMainTabVisibility();\r\n                    brushTabRow.open('eraserBrush');\r\n                }\r\n                if (comboStr === 'b') {\r\n                    event.preventDefault();\r\n                    const prevMode = this.klCanvasWorkspace.getMode();\r\n                    this.klCanvasWorkspace.setMode('draw');\r\n                    this.toolspaceToolRow.setActive('draw');\r\n                    mainTabRow && mainTabRow.open('draw');\r\n                    updateMainTabVisibility();\r\n                    brushTabRow.open(prevMode === 'draw' ? getNextBrushId() : currentBrushId);\r\n                }\r\n                if (comboStr === 'g') {\r\n                    event.preventDefault();\r\n                    const newMode = this.klCanvasWorkspace.getMode() === 'fill' ? 'gradient' : 'fill';\r\n                    this.klCanvasWorkspace.setMode(newMode);\r\n                    this.toolspaceToolRow.setActive(newMode);\r\n                    mainTabRow && mainTabRow.open(newMode);\r\n                    updateMainTabVisibility();\r\n                }\r\n                if (comboStr === 't') {\r\n                    event.preventDefault();\r\n                    this.klCanvasWorkspace.setMode('text');\r\n                    this.toolspaceToolRow.setActive('text');\r\n                    mainTabRow && mainTabRow.open('text');\r\n                    updateMainTabVisibility();\r\n                }\r\n                if (comboStr === 'u') {\r\n                    event.preventDefault();\r\n                    this.klCanvasWorkspace.setMode('shape');\r\n                    this.toolspaceToolRow.setActive('shape');\r\n                    mainTabRow && mainTabRow.open('shape');\r\n                    updateMainTabVisibility();\r\n                }\r\n                if (comboStr === 'x') {\r\n                    event.preventDefault();\r\n                    this.klColorSlider.swapColors();\r\n                }\r\n\r\n\r\n            },\r\n            onUp: (keyStr, event) => {\r\n            },\r\n        });\r\n\r\n        const brushUiMap = {};\r\n        // create brush UIs\r\n        Object.entries(KL.brushesUI).forEach(([b, brushUi]) => {\r\n            const ui = new brushUi.Ui({\r\n                onSizeChange: sizeWatcher,\r\n                onOpacityChange: (opacity) => {\r\n                    brushSettingService.emitOpacity(opacity);\r\n                },\r\n                onConfigChange: () => {\r\n                    brushSettingService.emitSliderConfig({\r\n                        sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\r\n                        opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\r\n                    });\r\n                },\r\n            });\r\n            brushUiMap[b] = ui;\r\n            ui.getElement().style.padding = 10 + 'px';\r\n        });\r\n\r\n        this.statusOverlay = new KL.StatusOverlay();\r\n\r\n        this.toolspace = BB.el({\r\n            className: 'kl-toolspace',\r\n            css: {\r\n                position: 'absolute',\r\n                right: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                width: (this.toolWidth - 1) + 'px',\r\n                overflow: 'hidden',\r\n                userSelect: 'none',\r\n                touchAction: 'none',\r\n            },\r\n        });\r\n        this.toolspaceInner = BB.el({\r\n            parent: this.toolspace,\r\n        });\r\n        this.toolspace.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n        this.toolspace.onclick = BB.handleClick;\r\n\r\n\r\n        this.toolspaceCollapser = new KL.ToolspaceCollapser({\r\n            onChange: () => {\r\n                this.updateCollapse();\r\n            },\r\n        });\r\n\r\n        this.updateCollapse();\r\n\r\n\r\n\r\n\r\n\r\n        let overlayToolspace;\r\n        setTimeout(() => {\r\n            overlayToolspace = new KL.OverlayToolspace({\r\n                enabledTest: () => {\r\n                    return KL.dialogCounter.get() === 0 && !this.lineSanitizer.getIsDrawing();\r\n                },\r\n                brushSettingService,\r\n            });\r\n            this.klRootEl.append(overlayToolspace.getElement());\r\n        }, 0);\r\n\r\n        BB.append(\r\n            this.klRootEl,\r\n            [\r\n                this.klCanvasWorkspace.getElement(),\r\n                this.toolspace,\r\n                this.toolspaceCollapser.getElement(),\r\n            ]\r\n        );\r\n\r\n        let toolspaceTopRow;\r\n        if (this.embed) {\r\n            toolspaceTopRow = new EmbedToolspaceTopRow({\r\n                onHelp: () => {\r\n                    showIframeModal(this.embed.url + '/help.html', !!this.embed);\r\n                },\r\n                onSubmit: () => {\r\n                    KL.popup({\r\n                        target: this.klRootEl,\r\n                        message: LANG('submit-prompt'),\r\n                        buttons: [LANG('submit'), 'Cancel'],\r\n                        callback: async (result) => {\r\n                            if (result !== LANG('submit')) {\r\n                                return;\r\n                            }\r\n\r\n                            const overlay = BB.el({\r\n                                parent: this.klRootEl,\r\n                                className: 'upload-overlay',\r\n                                content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\r\n                            });\r\n\r\n                            this.embed.onSubmit(\r\n                                () => {\r\n                                    pOptions.saveReminder.reset();\r\n                                    this.klRootEl.removeChild(overlay);\r\n                                },\r\n                                () => {\r\n                                    this.klRootEl.removeChild(overlay);\r\n                                });\r\n                        },\r\n                    });\r\n                },\r\n                onLeftRight: () => {\r\n                    this.uiState = this.uiState === 'left' ? 'right' : 'left';\r\n                    this.updateUi();\r\n                },\r\n            });\r\n        } else {\r\n            toolspaceTopRow = new KL.ToolspaceTopRow({\r\n                logoImg: pOptions.logoImg,\r\n                onLogo: () => {\r\n                    showIframeModal('./home/', !!this.embed);\r\n                },\r\n                onNew: () => {\r\n                    showNewImageDialog();\r\n                },\r\n                onImport: () => {\r\n                    fileTab.triggerImport();\r\n                },\r\n                onSave: () => {\r\n                    this.saveToComputer.save();\r\n                },\r\n                onShare: () => {\r\n                    shareImage();\r\n                },\r\n                onHelp: () => {\r\n                    showIframeModal('./help/', !!this.embed);\r\n                },\r\n            });\r\n        }\r\n        toolspaceTopRow.getElement().style.marginBottom = '10px';\r\n        this.toolspaceInner.append(toolspaceTopRow.getElement());\r\n\r\n        this.toolspaceToolRow = new KL.ToolspaceToolRow({\r\n            onActivate: (activeStr) => {\r\n                if (activeStr === 'draw') {\r\n                    this.klCanvasWorkspace.setMode('draw');\r\n                } else if (activeStr === 'hand') {\r\n                    this.klCanvasWorkspace.setMode('hand');\r\n                } else if (activeStr === 'fill') {\r\n                    this.klCanvasWorkspace.setMode('fill');\r\n                } else if (activeStr === 'gradient') {\r\n                    this.klCanvasWorkspace.setMode('gradient');\r\n                } else if (activeStr === 'text') {\r\n                    this.klCanvasWorkspace.setMode('text');\r\n                } else if (activeStr === 'shape') {\r\n                    this.klCanvasWorkspace.setMode('shape');\r\n                } else {\r\n                    throw new Error('unknown activeStr');\r\n                }\r\n                mainTabRow && mainTabRow.open(activeStr);\r\n                updateMainTabVisibility();\r\n                this.klColorSlider.pickingDone();\r\n            },\r\n            onZoomIn: () => {\r\n                this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\r\n            },\r\n            onZoomOut: () => {\r\n                this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\r\n            },\r\n            onUndo: () => {\r\n                undoRedoCatchup.undo();\r\n            },\r\n            onRedo: () => {\r\n                undoRedoCatchup.redo();\r\n            },\r\n        });\r\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\r\n        klHistory.addListener(() => {\r\n            this.toolspaceToolRow.setEnableUndo(klHistory.canUndo());\r\n            this.toolspaceToolRow.setEnableRedo(klHistory.canRedo());\r\n        });\r\n        this.toolspaceInner.append(this.toolspaceToolRow.getElement());\r\n\r\n        const setBrushColor = (p_color) => {\r\n            currentColor = p_color;\r\n            currentBrushUi.setColor(p_color);\r\n            brushSettingService.emitColor(p_color);\r\n            this.klColorSlider.pickingDone();\r\n        };\r\n\r\n        this.klColorSlider = new KL.KlColorSlider({\r\n            width: 250,\r\n            height: 30,\r\n            svHeight: 100,\r\n            startValue: new BB.RGB(0, 0, 0),\r\n            onPick: setBrushColor,\r\n        });\r\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\r\n        this.klColorSlider.setPickCallback((doPick) => {\r\n\r\n            if (doPick) {\r\n                this.klCanvasWorkspace.setMode('pick');\r\n            } else {\r\n                this.klCanvasWorkspace.setMode(this.toolspaceToolRow.getActive());\r\n                updateMainTabVisibility();\r\n            }\r\n\r\n        });\r\n\r\n        const setCurrentBrush = (brushId) => {\r\n            if (brushId !== 'eraserBrush') {\r\n                lastNonEraserBrushId = brushId;\r\n            }\r\n\r\n            if (this.klColorSlider) {\r\n                if (brushId === 'eraserBrush') {\r\n                    this.klColorSlider.enable(false);\r\n                } else {\r\n                    this.klColorSlider.enable(true);\r\n                }\r\n            }\r\n\r\n            currentBrushId = brushId;\r\n            currentBrushUi = brushUiMap[brushId];\r\n            currentBrushUi.setColor(currentColor);\r\n            currentBrushUi.setContext(currentLayerCtx);\r\n            this.klCanvasWorkspace.setMode('draw');\r\n            this.toolspaceToolRow.setActive('draw');\r\n            updateMainTabVisibility();\r\n        };\r\n\r\n        const setCurrentLayer = (layer: TKlCanvasLayer) => { //BrushContext(p_context) {\r\n            currentLayerCtx = layer.context;\r\n            currentBrushUi.setContext(layer.context);\r\n            this.layerPreview.setLayer(layer);\r\n        };\r\n\r\n        const brushDiv = BB.el();\r\n        const colorDiv = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'flex-end',\r\n            },\r\n        });\r\n        const toolspaceStabilizerRow = new KL.ToolspaceStabilizerRow({\r\n            smoothing: 1,\r\n            onSelect: (v) => {\r\n                lineSmoothing.setSmoothing(translateSmoothing(v));\r\n            },\r\n        });\r\n\r\n\r\n        brushDiv.append(colorDiv);\r\n        BB.append(\r\n            colorDiv,\r\n            [this.klColorSlider.getElement(), this.klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n        );\r\n\r\n        const brushTabRow = new KL.TabRow({\r\n            initialId: 'penBrush',\r\n            useAccent: true,\r\n            tabArr: (() => {\r\n                const result = [];\r\n\r\n                const createTab = (keyStr) => {\r\n                    return {\r\n                        id: keyStr,\r\n                        image: KL.brushesUI[keyStr].image,\r\n                        title: KL.brushesUI[keyStr].tooltip,\r\n                        onOpen: () => {\r\n                            brushUiMap[keyStr].getElement().style.display = 'block';\r\n                            setCurrentBrush(keyStr);\r\n                            this.klColorSlider.pickingDone();\r\n                            brushSettingService.emitSliderConfig({\r\n                                sizeSlider: KL.brushesUI[keyStr].sizeSlider,\r\n                                opacitySlider: KL.brushesUI[keyStr].opacitySlider,\r\n                            });\r\n                            sizeWatcher(brushUiMap[keyStr].getSize());\r\n                            brushSettingService.emitOpacity(brushUiMap[keyStr].getOpacity());\r\n                        },\r\n                        onClose: () => {\r\n                            brushUiMap[keyStr].getElement().style.display = 'none';\r\n                        },\r\n                    };\r\n                };\r\n\r\n                const keyArr = Object.keys(brushUiMap);\r\n                for (let i = 0; i < keyArr.length; i++) {\r\n                    result.push(createTab(keyArr[i]));\r\n                }\r\n                return result;\r\n            })(),\r\n        });\r\n        BB.append(brushDiv, [\r\n            brushTabRow.getElement(),\r\n            ...Object.entries(KL.brushesUI).map(([b]) => brushUiMap[b].getElement()),\r\n        ]);\r\n\r\n        const handUi = new KL.HandUi({\r\n            scale: 1,\r\n            angleDeg: 0,\r\n            onReset: () => {\r\n                this.klCanvasWorkspace.resetView(true);\r\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n            },\r\n            onFit: () => {\r\n                this.klCanvasWorkspace.fitView();\r\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n            },\r\n            onAngleChange: (angleDeg, isRelative) => {\r\n                this.klCanvasWorkspace.setAngle(angleDeg, isRelative);\r\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n            },\r\n        });\r\n\r\n        const fillUi = new KL.FillUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const gradientUi = new KL.GradientUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const textUi = new KL.TextUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const shapeUi = new KL.ShapeUi({\r\n            colorSlider: this.klColorSlider,\r\n        });\r\n\r\n        const gradientTool = new KL.GradientTool({\r\n            onGradient: (isDone, x1, y1, x2, y2, angleRad) => {\r\n                const layerIndex = this.klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n                const settings = gradientUi.getSettings();\r\n                const gradientObj: IGradient = {\r\n                    type: settings.type,\r\n                    color1: this.klColorSlider.getColor(),\r\n                    isReversed: settings.isReversed,\r\n                    opacity: settings.opacity,\r\n                    doLockAlpha: settings.doLockAlpha,\r\n                    isEraser: settings.isEraser,\r\n                    doSnap: keyListener.isPressed('shift') || settings.doSnap,\r\n                    x1,\r\n                    y1,\r\n                    x2,\r\n                    y2,\r\n                    angleRad,\r\n                };\r\n\r\n                if (isDone) {\r\n                    this.klCanvas.setComposite(layerIndex, null);\r\n                    this.klCanvas.drawGradient(layerIndex, gradientObj);\r\n                } else {\r\n                    this.klCanvas.setComposite(layerIndex, {\r\n                        draw: (ctx) => {\r\n                            KL.drawGradient(ctx, gradientObj);\r\n                        },\r\n                    });\r\n                }\r\n                this.klCanvasWorkspace.requestFrame();\r\n            },\r\n        });\r\n\r\n        const shapeTool = new KL.ShapeTool({\r\n            onShape: (isDone, x1, y1, x2, y2, angleRad) => {\r\n\r\n                const layerIndex = this.klCanvas.getLayerIndex(currentLayerCtx.canvas);\r\n\r\n                const shapeObj: any = {\r\n                    type: shapeUi.getShape(),\r\n                    x1: x1,\r\n                    y1: y1,\r\n                    x2: x2,\r\n                    y2: y2,\r\n                    angleRad: angleRad,\r\n                    isOutwards: shapeUi.getIsOutwards(),\r\n                    opacity: shapeUi.getOpacity(),\r\n                    isEraser: shapeUi.getIsEraser(),\r\n                    doLockAlpha: shapeUi.getDoLockAlpha(),\r\n                };\r\n                if (shapeUi.getShape() === 'line') {\r\n                    shapeObj.strokeRgb = this.klColorSlider.getColor();\r\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                    shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed('shift');\r\n                } else {\r\n                    shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed('shift');\r\n                    if (shapeUi.getMode() === 'stroke') {\r\n                        shapeObj.strokeRgb = this.klColorSlider.getColor();\r\n                        shapeObj.lineWidth = shapeUi.getLineWidth();\r\n                    } else {\r\n                        shapeObj.fillRgb = this.klColorSlider.getColor();\r\n                    }\r\n                }\r\n\r\n                if (isDone) {\r\n                    this.klCanvas.setComposite(layerIndex, null);\r\n                    this.klCanvas.drawShape(layerIndex, shapeObj);\r\n                } else {\r\n                    this.klCanvas.setComposite(layerIndex, {\r\n                        draw: (ctx) => {\r\n                            KL.drawShape(ctx, shapeObj);\r\n                        },\r\n                    });\r\n                }\r\n                this.klCanvasWorkspace.requestFrame();\r\n\r\n            },\r\n        });\r\n\r\n        this.layerManager = new KL.LayerManager(\r\n            this.klCanvas,\r\n            (val) => {\r\n                setCurrentLayer(this.klCanvas.getLayer(val));\r\n                klHistory.push({\r\n                    tool: ['misc'],\r\n                    action: 'focusLayer',\r\n                    params: [val],\r\n                } as TMiscFocusLayerHistoryEntry);\r\n            },\r\n            this.klRootEl,\r\n            this.uiState,\r\n        );\r\n        this.layerPreview = new KL.LayerPreview({\r\n            klRootEl: this.klRootEl,\r\n            onClick: () => {\r\n                mainTabRow && mainTabRow.open('layers');\r\n            },\r\n            uiState: this.uiState,\r\n        });\r\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\r\n        this.layerPreview.setLayer(this.klCanvas.getLayer(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)));\r\n\r\n        const filterTab = new KL.FilterTab(\r\n            this.klRootEl,\r\n            this.klColorSlider,\r\n            this.layerManager,\r\n            this.klCanvasWorkspace,\r\n            handUi,\r\n            () => currentColor,\r\n            () => klMaxCanvasSize,\r\n            () => this.klCanvas,\r\n            () => currentLayerCtx,\r\n            !!this.embed,\r\n            this.statusOverlay,\r\n        );\r\n\r\n        const undoRedoCatchup = new KL.UndoRedoCatchup(\r\n            brushUiMap,\r\n            this.layerPreview,\r\n            this.layerManager,\r\n            handUi,\r\n            this.klCanvasWorkspace,\r\n            () => {\r\n                if (!initState) {\r\n                    throw new Error('initState not initialized');\r\n                }\r\n                return initState;\r\n            },\r\n            () => this.klCanvas,\r\n            () => currentLayerCtx,\r\n            (ctx) => {\r\n                currentLayerCtx = ctx;\r\n            },\r\n            () => currentBrushUi,\r\n        );\r\n        klHistory.addListener((p) => {\r\n            undoRedoCatchup.catchup(p);\r\n        });\r\n\r\n        const showNewImageDialog = () => {\r\n            KL.newImageDialog({\r\n                currentColor: currentColor,\r\n                secondaryColor: this.klColorSlider.getSecondaryRGB(),\r\n                maxCanvasSize: klMaxCanvasSize,\r\n                canvasWidth: this.klCanvas.getWidth(),\r\n                canvasHeight: this.klCanvas.getHeight(),\r\n                workspaceWidth: window.innerWidth < this.collapseThreshold ? this.uiWidth : this.uiWidth - this.toolWidth,\r\n                workspaceHeight: this.uiHeight,\r\n                onConfirm: (width, height, color) => {\r\n                    this.klCanvas.reset({\r\n                        width: width,\r\n                        height: height,\r\n                        color: color.a === 1 ? color : null,\r\n                    });\r\n\r\n                    this.layerManager.update(0);\r\n                    setCurrentLayer(this.klCanvas.getLayer(0));\r\n                    this.klCanvasWorkspace.resetView();\r\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                },\r\n                onCancel: () => {},\r\n            });\r\n        };\r\n\r\n        const shareImage = (callback?: () => void) => {\r\n            BB.shareCanvas({\r\n                canvas: this.klCanvas.getCompleteCanvas(1),\r\n                fileName: BB.getDate() + filenameBase + '.png',\r\n                title: BB.getDate() + filenameBase + '.png',\r\n                callback: callback ? callback : () => {},\r\n            });\r\n        };\r\n\r\n        this.saveToComputer = new KL.SaveToComputer(\r\n            pOptions.saveReminder,\r\n            this.klRootEl,\r\n            () => exportType,\r\n            () => this.klCanvas,\r\n            filenameBase,\r\n        );\r\n\r\n        const copyToClipboard = (showCrop?: boolean) => {\r\n            KL.clipboardDialog(\r\n                this.klRootEl,\r\n                this.klCanvas.getCompleteCanvas(1),\r\n                (inputObj) => {\r\n                    if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) {\r\n                        return;\r\n                    }\r\n                    //do a crop\r\n                    KL.filterLib.cropExtend.apply({\r\n                        context: currentLayerCtx,\r\n                        klCanvas: this.klCanvas,\r\n                        input: inputObj,\r\n                        history: klHistory,\r\n                    });\r\n                    this.layerManager.update();\r\n                    this.klCanvasWorkspace.resetView();\r\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                },\r\n                this.statusOverlay,\r\n                showCrop || false,\r\n            );\r\n        };\r\n\r\n        const fileTab = this.embed ? null : new KL.FileTab(\r\n            this.klRootEl,\r\n            projectStore,\r\n            () => this.klCanvas.getProject(),\r\n            exportType,\r\n            (type) => {\r\n                exportType = type;\r\n            },\r\n            (files, optionsStr) => importHandler.handleFileSelect(files, optionsStr),\r\n            () => this.saveToComputer.save(),\r\n            showNewImageDialog,\r\n            shareImage,\r\n            () => { // on upload\r\n                KL.imgurUpload(\r\n                    this.klCanvas,\r\n                    this.klRootEl,\r\n                    pOptions.saveReminder,\r\n                    pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : null,\r\n                );\r\n            },\r\n            copyToClipboard,\r\n            pOptions.saveReminder,\r\n        );\r\n\r\n        const settingsTab = new KL.SettingsTab(\r\n            () => {\r\n                this.uiState = this.uiState === 'left' ? 'right' : 'left';\r\n                this.updateUi();\r\n                if (!this.embed) {\r\n                    LocalStorage.setItem('uiState', this.uiState);\r\n                }\r\n            },\r\n            pOptions.aboutEl\r\n        );\r\n\r\n        mainTabRow = new KL.TabRow({\r\n            initialId: 'draw',\r\n            tabArr: [\r\n                {\r\n                    id: 'draw',\r\n                    title: LANG('tool-brush'),\r\n                    image: toolPaintImg,\r\n                    onOpen: () => {\r\n                        if (currentBrushId === 'eraserBrush') {\r\n                            this.klColorSlider.enable(false);\r\n                        }\r\n                        BB.append(\r\n                            colorDiv,\r\n                            [this.klColorSlider.getElement(), this.klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\r\n                        );\r\n                        brushDiv.style.display = 'block';\r\n                    },\r\n                    onClose: () => {\r\n                        brushDiv.style.display = 'none';\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'hand',\r\n                    title: LANG('tool-hand'),\r\n                    image: toolHandImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        handUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        handUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'fill',\r\n                    title: LANG('tool-paint-bucket'),\r\n                    image: toolFillImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        fillUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        fillUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'gradient',\r\n                    title: LANG('tool-gradient'),\r\n                    image: toolGradientImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        gradientUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        gradientUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'text',\r\n                    title: LANG('tool-text'),\r\n                    image: toolTextImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        textUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        textUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'shape',\r\n                    title: LANG('tool-shape'),\r\n                    image: toolShapeImg,\r\n                    isVisible: false,\r\n                    onOpen: () => {\r\n                        this.klColorSlider.enable(true);\r\n                        shapeUi.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        shapeUi.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'layers',\r\n                    title: LANG('layers'),\r\n                    image: tabLayersImg,\r\n                    onOpen: () => {\r\n                        this.layerManager.update();\r\n                        this.layerManager.getElement().style.display = 'block';\r\n                    },\r\n                    onClose: () => {\r\n                        this.layerManager.getElement().style.display = 'none';\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'edit',\r\n                    label: LANG('tab-edit'),\r\n                    onOpen: () => {\r\n                        filterTab.show();\r\n                    },\r\n                    onClose: () => {\r\n                        filterTab.hide();\r\n                    },\r\n                    css: {\r\n                        padding: '0 7px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'file',\r\n                    label: LANG('tab-file'),\r\n                    isVisible: !!fileTab,\r\n                    onOpen: () => {\r\n                        if (!fileTab) {\r\n                            return;\r\n                        }\r\n                        fileTab.getElement().style.display = 'block';\r\n                        fileTab.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        if (!fileTab) {\r\n                            return;\r\n                        }\r\n                        fileTab.getElement().style.display = 'none';\r\n                        fileTab.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        padding: '0 7px',\r\n                    },\r\n                },\r\n                {\r\n                    id: 'settings',\r\n                    title: LANG('tab-settings'),\r\n                    image: tabSettingsImg,\r\n                    onOpen: () => {\r\n                        settingsTab.getElement().style.display = 'block';\r\n                        // settingsTab.setIsVisible(true);\r\n                    },\r\n                    onClose: () => {\r\n                        settingsTab.getElement().style.display = 'none';\r\n                        // settingsTab.setIsVisible(false);\r\n                    },\r\n                    css: {\r\n                        minWidth: '45px',\r\n                    },\r\n                },\r\n            ],\r\n        });\r\n\r\n        this.bottomBarWrapper = BB.el({\r\n            css: {\r\n                width: '270px',\r\n                position: 'absolute',\r\n                bottom: '0',\r\n                left: '0',\r\n            },\r\n        });\r\n        if (pOptions.bottomBar) {\r\n            this.bottomBar = pOptions.bottomBar;\r\n            this.bottomBarWrapper.append(this.bottomBar);\r\n            const observer = new MutationObserver(() => this.updateBottomBar());\r\n            observer.observe(\r\n                this.toolspaceInner,\r\n                {\r\n                    attributes: true,\r\n                    childList: true,\r\n                    subtree: true,\r\n                }\r\n            );\r\n        }\r\n\r\n\r\n\r\n\r\n        BB.append(this.toolspaceInner, [\r\n            this.layerPreview.getElement(),\r\n            mainTabRow.getElement(),\r\n            brushDiv,\r\n            handUi.getElement(),\r\n            fillUi.getElement(),\r\n            gradientUi.getElement(),\r\n            textUi.getElement(),\r\n            shapeUi.getElement(),\r\n            this.layerManager.getElement(),\r\n            filterTab.getElement(),\r\n            fileTab ? fileTab.getElement() : undefined,\r\n            settingsTab.getElement(),\r\n            BB.el({\r\n                css: {\r\n                    height: '10px', // a bit of spacing at the bottom\r\n                },\r\n            }),\r\n            this.bottomBarWrapper ? this.bottomBarWrapper : undefined,\r\n        ]);\r\n\r\n        this.toolspaceScroller = new KL.ToolspaceScroller({\r\n            toolspace: this.toolspace,\r\n            uiState: this.uiState,\r\n        });\r\n\r\n        if (!this.embed) {\r\n            Object.defineProperty(window, 'KL', {\r\n                value: createConsoleApi({\r\n                    onDraw: (path: IVector2D[]): void => {\r\n                        if (!path || path.length === 0) {\r\n                            return;\r\n                        }\r\n                        path.forEach((p, index) => {\r\n                            if (index === 0) {\r\n                                currentBrushUi.startLine(p.x, p.y, 1);\r\n                            } else {\r\n                                currentBrushUi.goLine(p.x, p.y, 1);\r\n                            }\r\n                        });\r\n                        currentBrushUi.endLine();\r\n                        this.klCanvasWorkspace.requestFrame();\r\n                    },\r\n                }),\r\n                writable: false,\r\n            });\r\n        }\r\n\r\n        this.resize(this.uiWidth, this.uiHeight);\r\n        this.updateUi();\r\n\r\n        const importHandler = new ImportHandler({\r\n            klRootEl: this.klRootEl,\r\n            klMaxCanvasSize,\r\n            layerManager: this.layerManager,\r\n            setCurrentLayer,\r\n            klCanvas: this.klCanvas,\r\n            klCanvasWorkspace: this.klCanvasWorkspace,\r\n            handUi,\r\n        }, {\r\n            onColor: (rgb) => brushSettingService.setColor(rgb),\r\n        });\r\n\r\n        if (!this.embed) {\r\n            new KL.KlImageDropper({\r\n                target: document.body,\r\n                onDrop: (files, optionStr) => {\r\n                    if (KL.dialogCounter.get() > 0) {\r\n                        return;\r\n                    }\r\n                    importHandler.handleFileSelect(files, optionStr);\r\n                },\r\n                enabledTest: () => {\r\n                    return KL.dialogCounter.get() === 0;\r\n                },\r\n            });\r\n\r\n            window.addEventListener('paste', (e) => importHandler.onPaste(e), false);\r\n        }\r\n\r\n        {\r\n            window.addEventListener('resize', () => {\r\n                this.resize(window.innerWidth, window.innerHeight);\r\n            });\r\n            window.addEventListener('orientationchange', () => {\r\n                this.resize(window.innerWidth, window.innerHeight);\r\n            });\r\n\r\n            // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\r\n            // Workaround: place a div in the body that fills the window, and use a ResizeObserver\r\n            const windowResizeWatcher = BB.el({\r\n                parent: document.body,\r\n                css: {\r\n                    position: 'fixed',\r\n                    left: '0',\r\n                    top: '0',\r\n                    right: '0',\r\n                    bottom: '0',\r\n                    pointerEvents: 'none',\r\n                    zIndex: '-1',\r\n                    userSelect: 'none',\r\n                },\r\n            });\r\n            try {\r\n                // Not all browsers support ResizeObserver. Not critical though.\r\n                const observer = new ResizeObserver(() => this.resize(window.innerWidth, window.innerHeight));\r\n                observer.observe(windowResizeWatcher);\r\n            } catch (e) {\r\n                windowResizeWatcher.parentNode.removeChild(windowResizeWatcher);\r\n            }\r\n\r\n            // prevent ctrl scroll -> zooming page\r\n            this.klRootEl.addEventListener('wheel', (event) => {\r\n                if (keyListener.isPressed('ctrl')) {\r\n                    event.preventDefault();\r\n                }\r\n            });\r\n            //maybe prevent zooming on safari mac os - todo still needed?\r\n            const prevent = (e) => {\r\n                e.preventDefault();\r\n            };\r\n            window.addEventListener('gesturestart', prevent);\r\n            window.addEventListener('gesturechange', prevent);\r\n            window.addEventListener('gestureend', prevent);\r\n        }\r\n    }\r\n\r\n    // -------- interface --------\r\n\r\n    getEl (): HTMLElement {\r\n        return this.klRootEl;\r\n    }\r\n\r\n    resize (w: number, h: number): void {\r\n\r\n        // iPad scrolls down when increasing text zoom\r\n        if (window.scrollY > 0) {\r\n            window.scrollTo(0, 0);\r\n        }\r\n\r\n        if (this.uiWidth === Math.max(0, w) && this.uiHeight === Math.max(0, h)) {\r\n            return;\r\n        }\r\n\r\n        this.uiWidth = Math.max(0, w);\r\n        this.uiHeight = Math.max(0, h);\r\n\r\n        this.updateCollapse();\r\n        this.updateBottomBar();\r\n\r\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\r\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\r\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\r\n    }\r\n\r\n    out (msg: string): void {\r\n        this.statusOverlay.out(msg);\r\n    }\r\n\r\n    getPNG (): Blob {\r\n        return base64ToBlob(this.klCanvas.getCompleteCanvas(1).toDataURL('image/png'));\r\n    }\r\n\r\n    getPSD = async ():  Promise<Blob> => {\r\n        return await klCanvasToPsdBlob(this.klCanvas);\r\n    };\r\n\r\n    getProject (): IKlProject {\r\n        return this.klCanvas.getProject();\r\n    }\r\n\r\n    swapUiLeftRight (): void {\r\n        this.uiState = this.uiState === 'left' ? 'right' : 'left';\r\n        if (!this.embed) {\r\n            LocalStorage.setItem('uiState', this.uiState);\r\n        }\r\n        this.updateUi();\r\n    }\r\n\r\n    saveAsPsd (): void {\r\n        this.saveToComputer.save('psd');\r\n    }\r\n\r\n    isDrawing (): boolean {\r\n        return this.lineSanitizer.getIsDrawing() || this.klCanvasWorkspace.getIsDrawing();\r\n    }\r\n}\r\n",null,"import arrayWithoutHoles from './_array_without_holes.mjs';\nimport iterableToArray from './_iterable_to_array.mjs';\nimport nonIterableSpread from './_non_iterable_spread.mjs';\nimport unsupportedIterableToArray from './_unsupported_iterable_to_array.mjs';\n\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}\n","import _arrayLikeToArray from './_array_like_to_array.mjs';\n\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n","import {DecoyKlHistory, klHistory} from './history/kl-history';\r\nimport {showModal} from './ui/modals/base/showModal';\r\nimport {DynamicModal} from './ui/modals/base/dynamic-modal';\r\nimport {dialogCounter} from './ui/modals/modal-count';\r\nimport {Checkbox} from './ui/components/checkbox';\r\nimport {input} from './ui/components/input';\r\nimport {Select} from './ui/components/select';\r\nimport {ImageToggle} from './ui/components/image-toggle';\r\nimport {ImageRadioList} from './ui/components/image-radio-list';\r\nimport {createPenPressureToggle} from './ui/components/create-pen-pressure-toggle';\r\nimport {KlSlider} from './ui/components/kl-slider';\r\nimport {calcSliderFalloffFactor} from './ui/components/slider-falloff';\r\nimport {HexColorDialog} from './ui/modals/color-slider-hex-dialog';\r\nimport {KlColorSlider} from './ui/components/kl-color-slider';\r\nimport {KlColorSliderSmall} from './ui/components/kl-color-slider-small';\r\nimport {PointSlider} from './ui/components/point-slider';\r\nimport {ColorOptions} from './ui/components/color-options';\r\nimport {Options} from './ui/components/options';\r\nimport {StatusOverlay} from './ui/components/status-overlay';\r\nimport {CropCopy} from './ui/components/crop-copy';\r\nimport {clipboardDialog} from './ui/modals/clipboard-dialog';\r\nimport {LayerManager} from './ui/tool-tabs/layer-manager/layer-manager';\r\nimport {WorkspaceSvgOverlay} from './canvas-ui/workspace-svg-overlay';\r\nimport {KlCanvasWorkspace} from './canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvasPreview} from './canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './ui/components/free-transform';\r\nimport {FreeTransformCanvas} from './ui/components/free-transform-canvas';\r\nimport {Cropper} from './ui/components/cropper';\r\nimport {LayerPreview} from './ui/components/layer-preview';\r\nimport {showImportAsLayerDialog} from './ui/modals/show-import-as-layer-dialog';\r\nimport {KlImageDropper} from './ui/components/kl-image-dropper';\r\nimport {OverlayToolspace} from './ui/components/overlay-toolspace';\r\nimport {ToolspaceTopRow} from './ui/components/toolspace-top-row';\r\nimport {ToolDropdown} from './ui/components/tool-dropdown';\r\nimport {ToolspaceToolRow} from './ui/components/toolspace-tool-row';\r\nimport {ToolspaceStabilizerRow} from './ui/components/toolspace-stabilizer-row';\r\nimport {TabRow} from './ui/components/tab-row';\r\nimport {HandUi} from './ui/tool-tabs/hand-ui';\r\nimport {FillUi} from './ui/tool-tabs/fill-ui';\r\nimport {TextUi} from './ui/tool-tabs/text-ui';\r\nimport {ShapeUi} from './ui/tool-tabs/shape-ui';\r\nimport {newImageDialog} from './ui/modals/new-image-dialog';\r\nimport {ToolspaceCollapser} from './ui/components/toolspace-collapser';\r\nimport {renderText} from './image-operations/render-text';\r\nimport {textToolDialog} from './ui/modals/text-tool-dialog';\r\nimport {showImportImageDialog} from './ui/modals/show-import-image-dialog';\r\nimport {floodFillBits} from './image-operations/flood-fill';\r\nimport * as PSD from './storage/psd';\r\nimport {drawShape, ShapeTool} from './image-operations/shape-tool';\r\nimport {KlCanvas} from './canvas/kl-canvas';\r\nimport * as indexedDb from './storage/indexed-db';\r\nimport {setDbName} from './storage/indexed-db';\r\nimport {filterLib, filterLibStatus} from './filters/filters';\r\nimport {brushes} from './brushes/brushes';\r\nimport {brushesUI} from './brushes-ui/brushes-ui';\r\nimport {showIframeModal} from './ui/modals/show-iframe-modal';\r\nimport {RadioList} from './ui/components/radio-list';\r\nimport {BrowserStorageUi} from './ui/components/browser-storage-ui';\r\nimport {drawProject} from './canvas/draw-project';\r\nimport {ProjectStore} from './storage/project-store';\r\nimport {FileTab} from './ui/tool-tabs/file-tab';\r\nimport {FilterTab} from './ui/tool-tabs/filter-tab';\r\nimport {imgurUpload} from './ui/modals/imgur-upload';\r\nimport {loadAgPsd} from './storage/load-ag-psd';\r\nimport {SaveReminder} from './ui/components/save-reminder';\r\nimport {SaveToComputer} from './storage/save-to-computer';\r\nimport {UndoRedoCatchup} from './history/undo-redo-catchup';\r\nimport {BrushSettingService} from './brushes-ui/brush-setting-service';\r\nimport {BoxToggle} from './ui/components/box-toggle';\r\nimport {SettingsTab} from './ui/tool-tabs/settings-tab';\r\nimport {ToolspaceScroller} from './ui/components/toolspace-scroller';\r\nimport {GradientUi} from './ui/tool-tabs/gradient-ui';\r\nimport {drawGradient, GradientTool} from './image-operations/gradient-tool';\r\n\r\n/**\r\n * paint tool functionality\r\n */\r\nexport const KL = {\r\n\r\n    // --- brushes ---\r\n    brushes,\r\n    brushesUI,\r\n    BrushSettingService,\r\n\r\n    // --- canvas ---\r\n    KlCanvas,\r\n    drawProject,\r\n\r\n    // --- canvas ui ---\r\n    WorkspaceSvgOverlay,\r\n    KlCanvasWorkspace,\r\n    KlCanvasPreview,\r\n\r\n    // --- filters ---\r\n    filterLibStatus,\r\n    filterLib,\r\n\r\n    // --- history ---\r\n    UndoRedoCatchup,\r\n\r\n    // --- image operations ---\r\n    renderText,\r\n    floodFillBits,\r\n    ShapeTool,\r\n    drawShape,\r\n    GradientTool,\r\n    drawGradient,\r\n\r\n    // --- storage ---\r\n    PSD,\r\n    setDbName,\r\n    indexedDb,\r\n    ProjectStore,\r\n    loadAgPsd,\r\n    SaveToComputer,\r\n    \r\n    // --- ui - components ---\r\n    calcSliderFalloffFactor,\r\n    Checkbox,\r\n    input,\r\n    Select,\r\n    ImageToggle,\r\n    ImageRadioList,\r\n    RadioList,\r\n    createPenPressureToggle,\r\n    KlSlider,\r\n    HexColorDialog,\r\n    KlColorSlider,\r\n    KlColorSliderSmall,\r\n    PointSlider,\r\n    ColorOptions,\r\n    Options,\r\n    BoxToggle,\r\n    StatusOverlay,\r\n    CropCopy,\r\n    FreeTransform,\r\n    FreeTransformCanvas,\r\n    Cropper,\r\n    LayerPreview,\r\n    KlImageDropper,\r\n    OverlayToolspace,\r\n    ToolspaceTopRow,\r\n    ToolDropdown,\r\n    ToolspaceToolRow,\r\n    ToolspaceStabilizerRow,\r\n    TabRow,\r\n    ToolspaceCollapser,\r\n    BrowserStorageUi,\r\n    SaveReminder,\r\n    ToolspaceScroller,\r\n\r\n    // --- ui - modals ---\r\n    dialogCounter,\r\n    popup: showModal,\r\n    Popup: DynamicModal,\r\n    clipboardDialog,\r\n    showImportAsLayerDialog,\r\n    newImageDialog,\r\n    textToolDialog,\r\n    showImportImageDialog,\r\n    showIframePopup: showIframeModal,\r\n    imgurUpload,\r\n\r\n    // --- ui - tool tabs ---\r\n    HandUi,\r\n    FillUi,\r\n    GradientUi,\r\n    TextUi,\r\n    ShapeUi,\r\n    FileTab,\r\n    FilterTab,\r\n    SettingsTab,\r\n    LayerManager,\r\n\r\n    klHistory,\r\n    DecoyKlHistory,\r\n};","\r\n\r\n// --------- history entry types ------------------------------\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\nexport interface IHistoryAction {\r\n    action: string;\r\n    params: any[];\r\n}\r\n\r\nexport interface IHistoryEntry {\r\n    tool: string[];\r\n    action?: string;\r\n    params?: any[];\r\n    actions?: IHistoryAction[];\r\n}\r\n\r\ntype THistoryActionParams<T> = T extends (...args: infer A) => void ? A : never;\r\nexport type THistoryActions<ToolName, T> = {\r\n    [K in keyof T]: {\r\n        tool: [ToolName];\r\n        action: K;\r\n        params: THistoryActionParams<T[K]>;\r\n    }\r\n}[keyof T];\r\n\r\nexport type THistoryInnerActions<T> = {\r\n    [K in keyof T]: {\r\n        action: K;\r\n        params: THistoryActionParams<T[K]>;\r\n    }\r\n}[keyof T];\r\n\r\nexport type THistoryEntryG<Tool extends string[], Action extends string, Params extends unknown[]> = {\r\n    tool: Tool;\r\n    action: Action;\r\n    params: Params;\r\n}\r\n\r\nexport type TMiscImportImageHistoryEntry = THistoryEntryG<\r\n    ['misc'],\r\n    'importImage',\r\n    [HTMLCanvasElement, string | undefined]>;\r\n\r\nexport type TMiscFocusLayerHistoryEntry = THistoryEntryG<\r\n    ['misc'],\r\n    'focusLayer',\r\n    [number]>;\r\n\r\n// --------- classes etc ------------------------------\r\n\r\nexport interface IHistoryBroadcast {\r\n    bufferUpdate: IHistoryEntry;\r\n}\r\n\r\nlet historyInstance: boolean = false;\r\n\r\nexport type IHistoryListener = (p: IHistoryBroadcast | null) => void;\r\n\r\nexport interface KlHistoryInterface {\r\n    pause (b: boolean): void;\r\n    addListener (l: IHistoryListener): void;\r\n    push (e: IHistoryEntry): void;\r\n    undo (): IHistoryEntry[];\r\n    redo (): IHistoryEntry | undefined;\r\n    getAll (): (IHistoryEntry | null)[];\r\n    canRedo (): boolean;\r\n    canUndo (): boolean;\r\n    getState (): number;\r\n    getActionNumber (): number;\r\n}\r\n\r\nexport class DecoyKlHistory implements KlHistoryInterface {\r\n    pause (): void {}\r\n    addListener (): void {}\r\n    push (): void {}\r\n    undo (): IHistoryEntry[] { return []; }\r\n    redo (): (IHistoryEntry | undefined) { return undefined; }\r\n    getAll (): (IHistoryEntry | null)[] { return []; }\r\n    canRedo (): boolean { return false; }\r\n    canUndo (): boolean { return false; }\r\n    getState (): number { return 0; }\r\n    getActionNumber (): number { return 0; }\r\n}\r\n\r\nconst DO_DELETE_OLD = true;\r\n\r\nexport class KlHistory implements KlHistoryInterface {\r\n\r\n    private state: number; // on .push state increments by one\r\n    private readonly entries: (IHistoryEntry | null)[]; // null if beyond max undo to trigger garbage collection\r\n    private readonly listeners: IHistoryListener[];\r\n    private pauseStack: number; // how often paused without unpause\r\n    private readonly max: number = 20; // max number undo steps\r\n    private maxState: number; // can't go backwards -> max state is the buffer image(klCanvas)\r\n    private actionNumber: number; // current action the user is on. untouched document = -1 because dataArr.length is 0\r\n    \r\n    private broadcast (p: IHistoryBroadcast | null): void {\r\n        setTimeout(() => {\r\n            for (let i = 0; i < this.listeners.length; i++) {\r\n                this.listeners[i](p);\r\n            }\r\n            this.state++;\r\n        }, 1);\r\n    }\r\n    \r\n    // ---- public ----\r\n    \r\n    constructor () {\r\n        if (historyInstance) {\r\n            throw new Error('klHistory already instantiated');\r\n        }\r\n        historyInstance = true;\r\n        this.state = 0;\r\n        this.entries = [];\r\n        this.listeners = [];\r\n        this.pauseStack = 0;\r\n        this.maxState = -1;\r\n        this.actionNumber = -1;\r\n    }\r\n\r\n    /**\r\n     * Needed, because sometimes there are actions that would cause other undo steps.\r\n     * For example a filter that does something with two layers and then merges them.\r\n     * That should be a single undo step, and prevent merging from creating its own undo step.\r\n     * Pause prevents creation of unintended undo steps.\r\n     */\r\n    pause (b: boolean): void {\r\n        if (b) {\r\n            this.pauseStack++;\r\n        } else {\r\n            this.pauseStack = Math.max(0, this.pauseStack - 1);\r\n        }\r\n    }\r\n\r\n    addListener (l: IHistoryListener): void {\r\n        this.listeners.push(l);\r\n    }\r\n\r\n    push (newEntry: IHistoryEntry): void {\r\n        if (this.pauseStack > 0) {\r\n            return;\r\n        }\r\n        while (this.actionNumber < this.entries.length - 1) {\r\n            this.entries.pop();\r\n        }\r\n\r\n        //taking care of actions that shouldn't cause a new undo step\r\n        const lastEntry = this.entries[this.entries.length - 1];\r\n        if (\r\n            lastEntry && newEntry.tool[0] === 'canvas' && lastEntry.tool[0] === 'canvas' &&\r\n            newEntry.action === 'layerOpacity' && lastEntry.action === 'layerOpacity' &&\r\n            lastEntry.params[0] === newEntry.params[0]\r\n        ) {\r\n            this.entries[this.entries.length - 1] = newEntry;\r\n            this.state++; //still needs to increment because something changed\r\n            return;\r\n        }\r\n        if (newEntry.action === 'focusLayer' && lastEntry && lastEntry.action === 'focusLayer') {\r\n            this.entries[this.entries.length - 1] = newEntry;\r\n            this.state++;\r\n            return;\r\n        }\r\n\r\n        this.entries[this.entries.length] = newEntry;\r\n        this.actionNumber = this.entries.length - 1;\r\n        const maxBefore = this.maxState;\r\n        this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\r\n        if (maxBefore < this.maxState) {\r\n            const item = this.entries[this.maxState];\r\n            if (!item) {\r\n                throw new Error('this.dataArr[this.maxState] null');\r\n            }\r\n            this.broadcast({bufferUpdate: item});\r\n        } else {\r\n            this.broadcast(null);\r\n        }\r\n        if (DO_DELETE_OLD && this.maxState >= 0) {\r\n            this.entries[this.maxState] = null; //to free some memory...imported images take a lot of space\r\n        }\r\n    }\r\n\r\n    /**\r\n     * lowers action number, returns all entries that need to be executed\r\n     * on trailing snapshot to represent the canvas one undo step back.\r\n     * Empty array if can't undo\r\n     */\r\n    undo (): IHistoryEntry[] {\r\n        const result: IHistoryEntry[] = [];\r\n        if (!this.canUndo()) {\r\n            return result;\r\n        }\r\n        for (let i = this.maxState + 1; i < this.actionNumber; i++) {\r\n            result.push(throwIfNull(this.entries[i]));\r\n        }\r\n        this.actionNumber--;\r\n        this.broadcast(null);\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * raises action number, returns the action to be redone\r\n     */\r\n    redo (): (IHistoryEntry | undefined) {\r\n        if (!this.canRedo()) {\r\n            return undefined;\r\n        }\r\n        this.actionNumber++;\r\n        this.broadcast(null);\r\n        return throwIfNull(this.entries[this.actionNumber]);\r\n    }\r\n\r\n    getAll (): (IHistoryEntry | null)[] {\r\n        return [...this.entries];\r\n    }\r\n\r\n    canRedo (): boolean {\r\n        return this.actionNumber < this.entries.length - 1;\r\n    }\r\n\r\n    canUndo (): boolean {\r\n        return this.actionNumber > this.maxState;\r\n    }\r\n\r\n    getState (): number {\r\n        return this.state;\r\n    }\r\n\r\n    /**\r\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\r\n     */\r\n    getActionNumber (): number {\r\n        return (this.actionNumber + 1);\r\n    }\r\n    \r\n}\r\n\r\nexport const klHistory = new KlHistory();\r\n","import {IKeyString} from '../../../../bb/bb-types';\r\nimport {dialogCounter} from '../modal-count';\r\nimport {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport './scroll-fix';\r\nimport cancelImg from '/src/app/img/ui/cancel.svg';\r\nimport checkImg from '/src/app/img/ui/check.svg';\r\n\r\nexport function showModal (\r\n    p: {\r\n        target: HTMLElement;\r\n        div?: HTMLElement; // node with content\r\n        message: string; // can be html\r\n        callback?: (result: string) => void;\r\n        buttons?: string[]; // \"Ok\", and \"Cancel\" will be automatically translated\r\n        primaries?: string[];\r\n        type?: 'error' | 'warning' | 'upload' | 'ok'; // todo\r\n        closeFunc?: (f: () => void) => void; // returns a function you can call to close (Cancel) the dialog\r\n        style?: IKeyString;\r\n        clickOnEnter?: string; // name of button - will be clicked if enter key pressed\r\n        autoFocus?: false | string; // name of  to automatically focus - default 'Ok' - false -> none\r\n        ignoreBackground?: boolean; // deafult false; if true clicking on background doesn't close\r\n    }\r\n): void {\r\n    dialogCounter.increase();\r\n    let isClosed = false;\r\n\r\n\r\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\r\n    const rootRootEl = BB.el({\r\n        parent: document.body,\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            right: '0',\r\n            bottom: '0',\r\n            overflow: 'hidden',\r\n        },\r\n    });\r\n    const rootEl = BB.el({\r\n        parent: rootRootEl,\r\n        className: 'kl-popup',\r\n    });\r\n\r\n    const scrollContent = BB.el({\r\n        parent: rootEl,\r\n        css: {\r\n            width: '100%',\r\n            minHeight: '100%',\r\n            // padding: '10px 0',\r\n            position: 'relative',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            justifyContent: 'center',\r\n            alignItems: 'center',\r\n        },\r\n    });\r\n\r\n    const bgEl = BB.el({\r\n        parent: scrollContent,\r\n        onClick: () => {\r\n            if (p.ignoreBackground) {\r\n                return;\r\n            }\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            zIndex: '0',\r\n            width: '100%',\r\n            height: '100%',\r\n        },\r\n    });\r\n\r\n    const titleHeight = 40;\r\n    const xButton = BB.el({\r\n        tagName: 'button',\r\n        className: 'popup-x',\r\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n        title: LANG('modal-close'),\r\n        onClick: () => {\r\n            close('Cancel');\r\n        },\r\n        css: {\r\n            width: titleHeight + 'px',\r\n            height: titleHeight + 'px',\r\n            lineHeight: titleHeight + 'px',\r\n            position: 'absolute',\r\n            right: '0',\r\n            top: '0',\r\n            background: 'none',\r\n            boxShadow: 'none',\r\n        },\r\n    });\r\n\r\n    const boxClasses = ['kl-popup-box'];\r\n    boxClasses.push('kl-popup-box--sm');\r\n    const boxEl = BB.el({\r\n        content: [\r\n            xButton,\r\n            BB.el({\r\n                content:p.message,\r\n                css: {\r\n                    marginBottom: p.div ? '10px' : undefined,\r\n                    marginRight: '15px',\r\n                },\r\n            }),\r\n            p.div,\r\n        ],\r\n        className: boxClasses.join(' '),\r\n        css: p.style ? p.style : undefined,\r\n    });\r\n\r\n    scrollContent.append(\r\n        BB.el({\r\n            css: {\r\n                flex: '0.5',\r\n            },\r\n        }),\r\n        boxEl,\r\n        BB.el({\r\n            css: {\r\n                flex: '1',\r\n            },\r\n        })\r\n    );\r\n\r\n    if (p.type === 'error') {\r\n        boxEl.classList.add('poperror');\r\n    }\r\n    if (p.type === 'ok') {\r\n        boxEl.classList.add('popok');\r\n    }\r\n    if (p.type === 'warning') {\r\n        boxEl.classList.add('popwarning');\r\n    }\r\n    if (p.type === 'upload') {\r\n        boxEl.classList.add('popupload');\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, e, comboStr) {\r\n            if (isClosed) {\r\n                return;\r\n            }\r\n            if (clickOnEnterBtn && comboStr === 'enter' && !BB.isInputFocused()) {\r\n                e.stopPropagation();\r\n                setTimeout(() => {\r\n                    clickOnEnterBtn && clickOnEnterBtn.click();\r\n                }, 10);\r\n            }\r\n            if (comboStr === 'esc') {\r\n                e.stopPropagation();\r\n                close('Cancel');\r\n            }\r\n        },\r\n    });\r\n    // prevent ctrl scroll -> zooming page\r\n    const wheelPrevent = (event: WheelEvent): void => {\r\n        if (keyListener.isPressed('ctrl')) {\r\n            event.preventDefault();\r\n        }\r\n    };\r\n    rootEl.addEventListener('wheel', wheelPrevent);\r\n    rootEl.onclick = BB.handleClick;\r\n\r\n    let autoFocus: string | undefined;\r\n    if (p.autoFocus) {\r\n        autoFocus = p.autoFocus;\r\n    } else if (p.autoFocus === false) {\r\n        autoFocus = undefined;\r\n    } else {\r\n        autoFocus = 'Ok';\r\n    }\r\n\r\n    const buttonRowEl = p.buttons && p.buttons.length > 0 ? BB.el({\r\n        parent: boxEl,\r\n        css: {\r\n            display: 'flex',\r\n            flexWrap: 'wrap',\r\n            justifyContent: 'flex-end',\r\n            marginTop: '12px', // 8px already via buttons\r\n            marginLeft: '-8px',\r\n        },\r\n    }) : null;\r\n    let clickOnEnterBtn: HTMLButtonElement | undefined;\r\n    const btnElArr: HTMLButtonElement[] = [];\r\n    if (p.buttons) {\r\n        p.buttons.forEach(buttonName => {\r\n            const btnClasses = ['kl-popup__btn'];\r\n            if (buttonName === 'Ok' || (p.primaries && p.primaries.includes(buttonName))) {\r\n                btnClasses.push('kl-button-primary');\r\n            }\r\n            let iconUrl;\r\n            let label = buttonName;\r\n            if (buttonName === 'Ok') {\r\n                label = LANG('modal-ok');\r\n                iconUrl = checkImg;\r\n            }\r\n            if (buttonName === 'Cancel') {\r\n                label = LANG('modal-cancel');\r\n                iconUrl = cancelImg;\r\n                btnClasses.push('kl-button-cancel');\r\n            }\r\n            let iconImg = null;\r\n            if (iconUrl) {\r\n                iconImg = BB.el({\r\n                    tagName: 'img',\r\n                    custom: {\r\n                        src: iconUrl,\r\n                        height: '17',\r\n                    },\r\n                });\r\n            }\r\n            const btn = BB.el({\r\n                parent: buttonRowEl || undefined,\r\n                tagName: 'button',\r\n                className: btnClasses.join(' '),\r\n                content: [\r\n                    iconImg || undefined,\r\n                    BB.el({\r\n                        className: 'kl-popup__btn__text',\r\n                        content: label,\r\n                    }),\r\n                ],\r\n                onClick: () => {\r\n                    close(buttonName);\r\n                },\r\n            }) as HTMLButtonElement;\r\n            btnElArr.push(btn);\r\n            if (autoFocus === buttonName) {\r\n                setTimeout(() => {\r\n                    btn.focus();\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 10);\r\n                setTimeout(() => {\r\n                    // safari needs a separate timeout\r\n                    rootEl.scrollTo(0, 0);\r\n                }, 20);\r\n            }\r\n            if (buttonName === p.clickOnEnter) {\r\n                clickOnEnterBtn = btn;\r\n            }\r\n        });\r\n    }\r\n\r\n    function close (value: string) {\r\n        if (isClosed) {\r\n            return;\r\n        }\r\n\r\n        isClosed = true;\r\n        BB.clearSelection();\r\n        BB.unfocusAnyInput();\r\n        document.body.removeChild(rootRootEl);\r\n        dialogCounter.decrease();\r\n        BB.destroyEl(xButton);\r\n        BB.destroyEl(bgEl);\r\n        keyListener.destroy();\r\n        rootEl.removeEventListener('wheel', wheelPrevent);\r\n        rootEl.onclick = null;\r\n        btnElArr.forEach(item => BB.destroyEl(item));\r\n        btnElArr.splice(0, btnElArr.length);\r\n\r\n        if (p.callback) {\r\n            p.callback(value);\r\n        }\r\n    }\r\n\r\n    if (p.closeFunc) {\r\n        p.closeFunc(function () {\r\n            close('Cancel');\r\n        });\r\n    }\r\n\r\n}","\r\n// not the best\r\n\r\n/**\r\n * how many modals are open\r\n */\r\n\r\nexport class DialogCounter {\r\n    private listeners: ((v: number) => void)[] = [];\r\n    private count = 0;\r\n\r\n    private emit (): void {\r\n        this.listeners.forEach(item => {\r\n            item(this.count);\r\n        });\r\n    }\r\n\r\n    increase (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count += v;\r\n        } else {\r\n            this.count++;\r\n        }\r\n        this.emit();\r\n    }\r\n    decrease (v?: number): void {\r\n        if (v !== undefined) {\r\n            this.count -= v;\r\n        } else {\r\n            this.count--;\r\n        }\r\n        this.emit();\r\n    }\r\n    get (): number {\r\n        return this.count;\r\n    }\r\n    subscribe (listener: (v: number) => void): void {\r\n        this.listeners.push(listener);\r\n    }\r\n}\r\n\r\nexport const dialogCounter = new DialogCounter();\r\n","import {\r\n    append,\r\n    centerWithin,\r\n    copyObj,\r\n    createSvg,\r\n    css,\r\n    dateDayDifference,\r\n    decToFraction,\r\n    fitInto,\r\n    gcd,\r\n    getDate,\r\n    handleClick,\r\n    imageBlobToUrl,\r\n    insertAfter, isDark,\r\n    loadImage,\r\n    reduce,\r\n    setAttributes,\r\n    shareCanvas,\r\n    throwIfNull,\r\n} from './base/base';\r\nimport {\r\n    canShareFiles,\r\n    eventUsesHighResTimeStamp,\r\n    hasPointerEvents,\r\n    isCssMinMaxSupported,\r\n} from './base/browser';\r\nimport {KeyListener, sameKeys} from './input/key-listener';\r\nimport {PointerListener} from './input/pointer-listener';\r\nimport {\r\n    canvasBounds,\r\n    convertToAlphaChannelCanvas,\r\n    copyCanvas,\r\n    createCheckerCanvas,\r\n    createCheckerDataUrl,\r\n    ctx,\r\n    drawTransformedImageOnCanvas,\r\n    drawTransformedImageWithBounds,\r\n    freeCanvas,\r\n    resizeCanvas,\r\n    testShouldPixelate,\r\n} from './base/canvas';\r\nimport {Matrix} from './math/matrix';\r\nimport {Vec2} from './math/vec2';\r\nimport {BezierLine, PointLine, projectPointOnLine, quadraticSplineInput, SplineInterpolator} from './math/line';\r\nimport {CMYK, ColorConverter, HSV, RGB, testIsWhiteBestContrast} from './color/color';\r\nimport {\r\n    appendTextDiv,\r\n    clearSelection,\r\n    destroyEl,\r\n    el,\r\n    isInputFocused,\r\n    makeUnfocusable,\r\n    unfocusAnyInput,\r\n} from './base/ui';\r\nimport {\r\n    boundsInArea,\r\n    clamp,\r\n    dist,\r\n    distSquared,\r\n    intDxy,\r\n    isInsideRect,\r\n    lenSquared,\r\n    mix,\r\n    pointsToAngleDeg,\r\n    pointsToAngleRad,\r\n    rotate,\r\n    rotateAround,\r\n    round,\r\n    roundEven,\r\n    roundUneven,\r\n    updateBounds,\r\n} from './math/math';\r\nimport {createCanvas} from './base/create-canvas';\r\nimport {BbLog} from './base/bb-log';\r\nimport {LocalStorage} from './base/local-storage';\r\nimport {CoalescedExploder} from './input/event-chain/coalesced-exploder';\r\nimport {NFingerTapper} from './input/event-chain/n-finger-tapper';\r\nimport {PinchZoomer} from './input/event-chain/pinch-zoomer';\r\nimport {DoubleTapper} from './input/event-chain/double-tapper';\r\nimport {OnePointerLimiter} from './input/event-chain/one-pointer-limiter';\r\nimport {EventChain} from './input/event-chain/event-chain';\r\n\r\nexport const BB = {\r\n\r\n    // ---- browser ----\r\n    eventUsesHighResTimeStamp,\r\n    hasPointerEvents,\r\n    isCssMinMaxSupported,\r\n    canShareFiles,\r\n\r\n    // ---- base ----\r\n    insertAfter,\r\n    loadImage,\r\n    css,\r\n    setAttributes,\r\n    append,\r\n    fitInto,\r\n    centerWithin,\r\n    getDate,\r\n    gcd,\r\n    reduce,\r\n    decToFraction,\r\n    imageBlobToUrl,\r\n    dateDayDifference,\r\n    copyObj,\r\n    shareCanvas,\r\n    handleClick,\r\n    createSvg,\r\n    BbLog,\r\n    LocalStorage,\r\n    throwIfNull,\r\n    isDark,\r\n\r\n    // ---- math ----\r\n    mix,\r\n    dist,\r\n    distSquared,\r\n    lenSquared,\r\n    pointsToAngleRad,\r\n    pointsToAngleDeg,\r\n    isInsideRect,\r\n    clamp,\r\n    rotate,\r\n    rotateAround,\r\n    Matrix,\r\n    Vec2,\r\n    intDxy,\r\n    roundEven,\r\n    roundUneven,\r\n    round,\r\n    updateBounds,\r\n    boundsInArea,\r\n\r\n    // ---- line ----\r\n    projectPointOnLine,\r\n    PointLine,\r\n    BezierLine,\r\n    SplineInterpolator,\r\n    quadraticSplineInput,\r\n\r\n    // ---- canvas ----\r\n    canvas: createCanvas,\r\n    ctx,\r\n    copyCanvas,\r\n    testShouldPixelate,\r\n    drawTransformedImageWithBounds,\r\n    drawTransformedImageOnCanvas,\r\n    createCheckerCanvas,\r\n    createCheckerDataUrl,\r\n    resizeCanvas,\r\n    convertToAlphaChannelCanvas,\r\n    freeCanvas,\r\n    canvasBounds,\r\n\r\n    // ---- color ----\r\n    HSV,\r\n    RGB,\r\n    CMYK,\r\n    ColorConverter,\r\n    testIsWhiteBestContrast,\r\n\r\n    // ---- UI ----\r\n    appendTextDiv,\r\n    clearSelection,\r\n    makeUnfocusable,\r\n    el,\r\n    destroyEl,\r\n    isInputFocused,\r\n    unfocusAnyInput,\r\n\r\n\r\n    // ---- events / input ----\r\n\r\n    KeyListener,\r\n    PointerListener,\r\n    sameKeys,\r\n\r\n    EventChain,\r\n    DoubleTapper,\r\n    NFingerTapper,\r\n    PinchZoomer,\r\n    CoalescedExploder,\r\n    OnePointerLimiter,\r\n};\r\n","\r\nexport const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\r\n\r\nexport const eventUsesHighResTimeStamp = (function () {\r\n    const eventUsesHighResTimeStamp: boolean = new Event('').timeStamp < 1000 * 60 * 60;\r\n    return function (): boolean {\r\n        return eventUsesHighResTimeStamp;\r\n    };\r\n})();\r\n\r\nexport const hasPointerEvents = !!window.PointerEvent;\r\n\r\nexport const isCssMinMaxSupported = (function () {\r\n    let result: boolean | null = null;\r\n\r\n    function test () {\r\n        const div = document.createElement('div');\r\n        div.style.position = 'absolute';\r\n        div.style.top = '0';\r\n        div.style.left = 'max(0px, 25px)';\r\n        document.body.append(div);\r\n        setTimeout(function () {\r\n            result = div.offsetLeft === 25;\r\n            document.body.removeChild(div);\r\n        }, 25);\r\n    }\r\n\r\n    if (document.body) {\r\n        test();\r\n    } else {\r\n        window.addEventListener('DOMContentLoaded', function () {\r\n            test();\r\n        });\r\n    }\r\n\r\n    return function (): boolean {\r\n        if (result === null) {\r\n            throw new Error('isCssMinMaxSupported not initialized');\r\n        }\r\n        return result;\r\n    };\r\n})();\r\n\r\nexport const canShareFiles = function (): boolean {\r\n    return 'share' in navigator && 'canShare' in navigator;\r\n};","import {IKeyString} from '../bb-types';\r\n\r\ntype TGlobalKey = {\r\n    add: (keyListenerRef: TKeyListenerRef) => void;\r\n    remove: (keyListenerRef: TKeyListenerRef) => void;\r\n    getIsDown: () => TIsDown;\r\n    getCombo: () => string[];\r\n}\r\n\r\ntype TIsDown = {\r\n    [key: string]: boolean;\r\n};\r\n\r\ntype TOnDown = (keyStr: string, e: KeyboardEvent, comboStr: string, isRepeat?: boolean) => void;\r\ntype TOnUp = (keyStr: string, e: KeyboardEvent, oldComboStr: string) => void;\r\ntype TOnBlur = () => void;\r\ntype TKeyListenerRef = [\r\n    TOnDown | undefined,\r\n    TOnUp | undefined,\r\n    TOnBlur | undefined,\r\n];\r\n\r\n\r\nconst globalKey = ((): TGlobalKey => {\r\n\r\n    // keyStr - our key naming system\r\n    // key - KeyboardEvent.key\r\n    // code - KeyboardEvent.code\r\n\r\n    const keyStrToKeyObj = { // keyStr not to contain a '+', because that's used for the comboStr\r\n        'space': [' ', 'Spacebar'], // Spacebar in IE\r\n        'alt': ['Alt', 'AltGraph'],\r\n        'shift': 'Shift',\r\n        'ctrl': 'Control',\r\n        'cmd': ['Meta', 'MetaLeft', 'MetaRight'],\r\n        'enter': 'Enter',\r\n        'esc': 'Escape',\r\n        'backspace': 'Backspace',\r\n        'delete': 'Delete',\r\n        'sqbr_open': '[',\r\n        'sqbr_close': ']',\r\n        'a': ['a', 'A'],\r\n        'b': ['b', 'B'],\r\n        'c': ['c', 'C'],\r\n        'e': ['e', 'E'],\r\n        'f': ['f', 'F'],\r\n        'g': ['g', 'G'],\r\n        'r': ['r', 'R'], // when holding shift\r\n        's': ['s', 'S'],\r\n        't': ['t', 'T'],\r\n        'u': ['u', 'U'],\r\n        'x': ['x', 'X'],\r\n        'y': ['y', 'Y'],\r\n        'z': ['z', 'Z'],\r\n        'plus': '+',\r\n        'minus': '-',\r\n        'left': 'ArrowLeft',\r\n        'right': 'ArrowRight',\r\n        'up': 'ArrowUp',\r\n        'down': 'ArrowDown',\r\n        'home': 'Home',\r\n        'end': 'End',\r\n    };\r\n\r\n    // ['space', 'alt', ... ]\r\n    const keyStrArr = Object.keys(keyStrToKeyObj);\r\n\r\n    // { space: false, ... }\r\n    const isDownObj: TIsDown = Object.entries(keyStrToKeyObj).reduce((acc, [key]) => {\r\n        acc[key] = false;\r\n        return acc;\r\n    }, {} as TIsDown);\r\n\r\n    // event.key to keyStr\r\n    // { ArrowLeft: 'left', ... }\r\n    const keyToKeyStrObj = Object.entries(keyStrToKeyObj).reduce((acc, [key, code]) => {\r\n        if (typeof code === 'string') {\r\n            acc[code] = key;\r\n        } else {\r\n            code.forEach(item => {\r\n                acc[item] = key;\r\n            });\r\n        }\r\n        return acc;\r\n    }, {} as IKeyString);\r\n\r\n    let comboArr: string[] = [];\r\n\r\n    // a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\r\n    // { KeyE: 'e', KeyF: undefined } - undefined - not down, string - the associated keyStr\r\n    let codeIsDownObj: {\r\n        [key: string]: string | undefined;\r\n    } = {};\r\n    const listenerArr: TKeyListenerRef[] = [];\r\n\r\n\r\n    const emitDown: TOnDown = function (a, b, c, d?): void {\r\n        listenerArr.forEach(item => {\r\n            if (!item[0]) {\r\n                return;\r\n            }\r\n            item[0](a, b, c, d);\r\n        });\r\n    };\r\n\r\n    const emitUp: TOnUp = function (a, b, c): void {\r\n        listenerArr.forEach(item => {\r\n            if (!item[1]) {\r\n                return;\r\n            }\r\n            item[1](a, b, c);\r\n        });\r\n    };\r\n\r\n    const emitBlur: TOnBlur = function (): void {\r\n        listenerArr.forEach(item => {\r\n            if (!item[2]) {\r\n                return;\r\n            }\r\n            item[2]();\r\n        });\r\n    };\r\n\r\n    function keyDown (e: KeyboardEvent): void {\r\n        const key = e.key;\r\n        const code = e.code;\r\n\r\n        if (key in keyToKeyStrObj) {\r\n            const keyStr = keyToKeyStrObj[key];\r\n            if (isDownObj[keyStr]) {\r\n                emitDown(keyStr, e, comboArr.join('+'), true);\r\n                return;\r\n            }\r\n            isDownObj[keyStr] = true;\r\n            codeIsDownObj[code] = keyStr;\r\n\r\n            //add to combo\r\n            comboArr.push(keyStr);\r\n\r\n            emitDown(keyStr, e, comboArr.join('+'));\r\n        }\r\n    }\r\n\r\n\r\n    function keyUp (e: KeyboardEvent): void {\r\n        const code = e.code;\r\n        const oldComboStr = comboArr.join('+');\r\n\r\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\r\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\r\n        if ([\r\n            'Meta', 'MetaLeft', 'MetaRight',\r\n            'OSLeft', 'OSRight', // Firefox\r\n        ].includes(code)) {\r\n            blur();\r\n            return;\r\n        }\r\n\r\n        const keyStr = codeIsDownObj[code];\r\n        if (keyStr !== undefined) {\r\n            isDownObj[keyStr] = false;\r\n            codeIsDownObj[code] = undefined;\r\n\r\n            // remove from combo\r\n            for (let i = 0; i < comboArr.length; i++) {\r\n                if (comboArr[i] == keyStr) {\r\n                    comboArr.splice(i, 1);\r\n                    i--;\r\n                }\r\n            }\r\n\r\n            emitUp(keyStr, e, oldComboStr);\r\n        }\r\n    }\r\n\r\n    function blur (): void {\r\n        const oldComboStr = comboArr.join('+');\r\n        comboArr = [];\r\n        codeIsDownObj = {};\r\n\r\n        const eventArr: string[] = [];\r\n        keyStrArr.forEach(keyStr => {\r\n            if (isDownObj[keyStr]) {\r\n                isDownObj[keyStr] = false;\r\n                eventArr.push(keyStr);\r\n            }\r\n        });\r\n        for (let i = 0; i < eventArr.length; i++) {\r\n            emitUp(\r\n                eventArr[i],\r\n                {\r\n                    preventDefault: function () {},\r\n                    stopPropagation: function () {},\r\n                } as KeyboardEvent,\r\n                oldComboStr,\r\n            );\r\n        }\r\n        emitBlur();\r\n    }\r\n\r\n\r\n\r\n    return {\r\n        add: (keyListenerRef: TKeyListenerRef): void => {\r\n            if (listenerArr.includes(keyListenerRef)) {\r\n                return;\r\n            }\r\n            const first = listenerArr.length === 0;\r\n            listenerArr.push(keyListenerRef);\r\n\r\n            if (first) {\r\n                document.addEventListener('keydown', keyDown);\r\n                document.addEventListener('keyup', keyUp);\r\n                window.addEventListener('blur', blur);\r\n            }\r\n        },\r\n        remove: (keyListenerRef: TKeyListenerRef): void => {\r\n            if (!listenerArr.includes(keyListenerRef)) {\r\n                return;\r\n            }\r\n            const last = listenerArr.length === 1;\r\n            for (let i = 0; i < listenerArr.length; i++) {\r\n                if (listenerArr[i] === keyListenerRef) {\r\n                    listenerArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n            if (last) {\r\n                document.removeEventListener('keydown', keyDown);\r\n                document.removeEventListener('keyup', keyUp);\r\n                window.removeEventListener('blur', blur);\r\n            }\r\n        },\r\n        getIsDown: (): TIsDown => isDownObj,\r\n        getCombo: (): string[] => comboArr,\r\n    };\r\n})();\r\n\r\n\r\n\r\n/**\r\n * Listens to key events in window. Makes combos easier - e.g. ctrl + z\r\n *\r\n * keyStr - see in implementation - my representation of a key. e.g. 'r' can be 'r' and 'R'\r\n * comboStr - string joins currently pressed keyStr with a +\r\n *              e.g. 'ctrl+z'\r\n *\r\n */\r\nexport class KeyListener {\r\n\r\n    private readonly onDown: TOnDown | undefined;\r\n    private readonly onUp: TOnUp | undefined;\r\n    private readonly onBlur: TOnBlur | undefined;\r\n    private readonly ref: TKeyListenerRef;\r\n\r\n    constructor (\r\n        p: {\r\n            onDown?: TOnDown;\r\n            onUp?: TOnUp;\r\n            onBlur?: TOnBlur;\r\n        },\r\n    ) {\r\n        this.onDown = p.onDown;\r\n        this.onUp = p.onUp;\r\n        this.onBlur = p.onBlur;\r\n        this.ref = [this.onDown, this.onUp, this.onBlur];\r\n        globalKey.add(this.ref);\r\n    }\r\n\r\n    isPressed (keyStr: string): boolean {\r\n        if (!(keyStr in globalKey.getIsDown())) {\r\n            throw 'key \"' + keyStr + '\" not found';\r\n        }\r\n        return globalKey.getIsDown()[keyStr];\r\n    }\r\n\r\n    getComboStr (): string {\r\n        return globalKey.getCombo().join('+');\r\n    }\r\n\r\n    comboOnlyContains (keyStrArr: string[]): boolean {\r\n        for (let i = 0; i < globalKey.getCombo().length; i++) {\r\n            if (!keyStrArr.includes(globalKey.getCombo()[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    destroy (): void {\r\n        globalKey.remove(this.ref);\r\n    }\r\n}\r\n\r\n/**\r\n * Test, are the same keys pressed. Order does not matter.\r\n */\r\nexport function sameKeys (comboAStr: string, comboBStr: string): boolean {\r\n    return comboAStr.split('+').sort().join('+') === comboBStr.split('+').sort().join('+');\r\n}","import {eventUsesHighResTimeStamp, hasPointerEvents, isFirefox} from '../base/browser';\r\nimport {WheelCleaner} from './wheel-cleaner';\r\nimport {IPointerEvent, IWheelEvent, TPointerButton, TPointerEventType, TPointerType} from './event.types';\r\nimport {PressureNormalizer} from './pressure-normalizer';\r\n\r\nexport interface IPointerListenerParams {\r\n    target: HTMLElement | SVGElement;\r\n    onPointer?: (pointerEvent: IPointerEvent) => void;\r\n    onWheel?: (wheelEvent: IWheelEvent) => void;\r\n    onEnterLeave?: (isOver: boolean) => void; // optional\r\n    maxPointers?: number; // int [1,n] default is 1 - how many concurrent pointers to pay attention to\r\n    fixScribble?: boolean; // fix ipad scribble issue - TODO remove, fixed start of 2022 -> https://bugs.webkit.org/show_bug.cgi?id=217430#c2\r\n}\r\n\r\ninterface IPointer {\r\n    pointerId: number;\r\n    lastPageX: number | null;\r\n    lastPageY: number | null;\r\n}\r\n\r\ninterface IDragObj {\r\n    pointerId: number; // long\r\n    pointerType?: TPointerType;\r\n    downPageX: number; //where was pointer when down-event occurred\r\n    downPageY: number;\r\n    buttons: number; // long\r\n    lastPageX: number; //pageX in previous event - only for touch events, because they don't have movementX/Y\r\n    lastPageY: number;\r\n    lastTimeStamp?: number;\r\n}\r\n\r\ninterface ICoalescedPointerEvent {\r\n    pageX: number;\r\n    pageY: number;\r\n    clientX: number;\r\n    clientY: number;\r\n    movementX: number;\r\n    movementY: number;\r\n    timeStamp: number;\r\n    pressure: number;\r\n}\r\n\r\ninterface ICorrectedPointerEvent {\r\n    pointerId: number;\r\n    pointerType: string;\r\n    pageX: number;\r\n    pageY: number;\r\n    clientX: number;\r\n    clientY: number;\r\n    movementX: number;\r\n    movementY: number;\r\n    timeStamp: number;\r\n    pressure: number; // normalized\r\n    buttons: number;\r\n    button: number;\r\n    coalescedArr: ICoalescedPointerEvent[];\r\n    eventPreventDefault: () => void;\r\n    eventStopPropagation: () => void;\r\n}\r\n\r\ninterface TExtendedDOMPointerEvent extends PointerEvent {\r\n    corrected: ICorrectedPointerEvent;\r\n}\r\n\r\n\r\n// keeping track of pointers for movement fallback\r\nconst pointerArr: IPointer[] = [];\r\n\r\nfunction addPointer (event: ICorrectedPointerEvent): IPointer {\r\n    const pointerObj: IPointer = {\r\n        pointerId: event.pointerId,\r\n        lastPageX: null,\r\n        lastPageY: null,\r\n    };\r\n    pointerArr.push(pointerObj);\r\n\r\n    if (pointerArr.length > 15) {\r\n        pointerArr.shift();\r\n    }\r\n\r\n    return pointerObj;\r\n}\r\n\r\nfunction getPointer (event: ICorrectedPointerEvent): IPointer | null {\r\n    for (let i = pointerArr.length - 1; i >= 0; i--) {\r\n        if (event.pointerId === pointerArr[i].pointerId) {\r\n            return pointerArr[i];\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction getButtonStr (buttons: number): TPointerButton | undefined {\r\n    switch (buttons) {\r\n        case 1:\r\n            return 'left';\r\n        case 2:\r\n            return 'right';\r\n        case 4:\r\n            return 'middle';\r\n        default:\r\n            return undefined;\r\n    }\r\n}\r\n\r\nconst pressureNormalizer = new PressureNormalizer();\r\nconst timeStampOffset = eventUsesHighResTimeStamp() ? 0 : -performance.timing.navigationStart;\r\n\r\n\r\nconst pointerDownEvt = hasPointerEvents ? 'pointerdown' : 'mousedown';\r\nconst pointerMoveEvt = hasPointerEvents ? 'pointermove' : 'mousemove';\r\nconst pointerUpEvt = hasPointerEvents ? 'pointerup' : 'mouseup';\r\nconst pointerCancelEvt = hasPointerEvents ? 'pointercancel' : 'mousecancel';\r\nconst pointerLeaveEvt = hasPointerEvents ? 'pointerleave' : 'mouseleave';\r\nconst pointerEnterEvt = hasPointerEvents ? 'pointerenter' : 'mouseenter';\r\n\r\n\r\n/**\r\n * More trustworthy pointer attributes. that behave the same across browsers.\r\n * returns a new object. Also attaches itself to the orig event. -> event.corrected\r\n */\r\nfunction correctPointerEvent (event: PointerEvent | TExtendedDOMPointerEvent): ICorrectedPointerEvent {\r\n    if ('corrected' in event) {\r\n        return event.corrected;\r\n    }\r\n\r\n    function determineButtons (): number {\r\n        if (event.buttons !== undefined) {\r\n            return event.buttons;\r\n        }\r\n        /*\r\n                button -> buttons\r\n        none:\tundefined -> 0\r\n        left:\t0 -> 1\r\n        middle:\t1 -> 4\r\n        right:\t2 -> 2\r\n        fourth:\t3 -> 8\r\n        fifth:\t4 -> 16\r\n         */\r\n        if (event.button !== undefined) { // old safari on mac has no buttons. remove eventually.\r\n            return [1,4,2,8,16][event.button];\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    const correctedObj: ICorrectedPointerEvent = {\r\n        pointerId: event.pointerId,\r\n        pointerType: event.pointerType,\r\n        pageX: event.pageX,\r\n        pageY: event.pageY,\r\n        clientX: event.clientX,\r\n        clientY: event.clientY,\r\n        movementX: event.movementX,\r\n        movementY: event.movementY,\r\n        timeStamp: event.timeStamp + timeStampOffset,\r\n        pressure: pressureNormalizer.normalize(event.pressure),\r\n        buttons: determineButtons(),\r\n        button: event.button,\r\n        coalescedArr: [],\r\n        eventPreventDefault: () => event.preventDefault(),\r\n        eventStopPropagation: () => event.stopPropagation(),\r\n    };\r\n    (event as TExtendedDOMPointerEvent).corrected = correctedObj;\r\n\r\n    let customPressure = null;\r\n    if ('pointerId' in event) {\r\n        if ('pressure' in event && event.buttons !== 0 && (['mouse'].includes(event.pointerType) || (event.pointerType === 'touch' && event.pressure === 0))) {\r\n            correctedObj.pressure = 1;\r\n            customPressure = 1;\r\n        }\r\n    } else {\r\n        correctedObj.pointerId = 0;\r\n        correctedObj.pointerType = 'mouse';\r\n        correctedObj.pressure = (event as PointerEvent).buttons !== 0 ? 1 : 0;\r\n        customPressure = correctedObj.pressure;\r\n    }\r\n\r\n    if (isFirefox && event.pointerType != 'mouse' && event.type === 'pointermove' && event.buttons === 0) { // once again firefox\r\n        correctedObj.buttons = 1; // todo wrong if no buttons actually pressed\r\n    }\r\n\r\n    let coalescedEventArr: PointerEvent[] = [];\r\n    if ('getCoalescedEvents' in event) {\r\n        coalescedEventArr = event.getCoalescedEvents();\r\n    }\r\n\r\n    // chrome somehow movementX not same scale as pageX. todo: only chrome?\r\n    // so make my own\r\n\r\n    const pointerObj: IPointer = getPointer(correctedObj) || addPointer(correctedObj);\r\n\r\n    const totalLastX = pointerObj.lastPageX;\r\n    const totalLastY = pointerObj.lastPageY;\r\n\r\n    for (let i = 0; i < coalescedEventArr.length; i++) {\r\n        const eventItem = coalescedEventArr[i];\r\n\r\n        correctedObj.coalescedArr.push({\r\n            pageX: eventItem.pageX,\r\n            pageY: eventItem.pageY,\r\n            clientX: eventItem.clientX,\r\n            clientY: eventItem.clientY,\r\n            movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\r\n            movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\r\n            timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : (eventItem.timeStamp + timeStampOffset), // 0 in firefox\r\n            pressure: customPressure === null ? pressureNormalizer.normalize(eventItem.pressure) : customPressure,\r\n        });\r\n\r\n        pointerObj.lastPageX = eventItem.pageX;\r\n        pointerObj.lastPageY = eventItem.pageY;\r\n    }\r\n\r\n    pointerObj.lastPageX = correctedObj.pageX;\r\n    pointerObj.lastPageY = correctedObj.pageY;\r\n    correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\r\n    correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\r\n\r\n    return correctedObj;\r\n}\r\n\r\n/**\r\n * PointerListener - for pointer events, wheel events. uses fallbacks. ideally consistent behavior across browsers.\r\n * Has some workarounds for browser specific bugs. As browsers evolve this constructor should get smaller.\r\n */\r\nexport class PointerListener {\r\n\r\n    private isDestroyed: boolean = false;\r\n\r\n    private readonly targetElement: HTMLElement | SVGElement;\r\n    private readonly onPointerCallback: undefined | ((pointerEvent: IPointerEvent) => void);\r\n    private readonly onWheelCallback: undefined | ((wheelEvent: IWheelEvent) => void);\r\n    private readonly onEnterLeaveCallback: undefined | ((isOver: boolean) => void);\r\n    private readonly maxPointers: number;\r\n    private readonly wheelCleaner: WheelCleaner;\r\n    private isOverCounter: number = 0;\r\n\r\n    // pointers that are pressing a button\r\n    private dragObjArr: IDragObj[] = [];\r\n    private dragPointerIdArr: number[] = [];\r\n\r\n    // chrome input glitch workaround\r\n    private lastPointerType: TPointerType | null = null;\r\n    private didSkip: boolean = false;\r\n\r\n    // listeners\r\n    private readonly onPointerEnter: (() => void) | undefined;\r\n    private readonly onPointerLeave: (() => void) | undefined;\r\n    private readonly onPointerMove: ((event: PointerEvent) => void) | undefined;\r\n    private readonly onPointerDown: ((event: PointerEvent, skipGlobal?: boolean) => void) | undefined;\r\n    private readonly onWheel: ((e: WheelEvent) => void) | undefined;\r\n    private readonly onTouchMoveScribbleFix: ((e: TouchEvent) => void) | undefined;\r\n    private readonly windowOnPointerMove: ((event: PointerEvent) => void) | undefined;\r\n    private readonly windowOnPointerUp: ((event: PointerEvent) => void) | undefined;\r\n    private readonly windowOnPointerLeave: ((event: PointerEvent) => void) | undefined;\r\n    // fallback pre pointer events (iOS < 13, as of 2023-02, still 4.4% of iOS users)\r\n    private readonly onTouchStart: ((e: TouchEvent) => void) | undefined;\r\n    private readonly onTouchMove: ((e: TouchEvent) => void) | undefined;\r\n    private readonly onTouchEnd: ((e: TouchEvent) => void) | undefined;\r\n    private readonly onTouchCancel: ((e: TouchEvent) => void) | undefined;\r\n\r\n\r\n    private getDragObj (pointerId: number): IDragObj | null {\r\n        for (let i = 0; i < this.dragObjArr.length; i++) {\r\n            if (pointerId === this.dragObjArr[i].pointerId) {\r\n                return this.dragObjArr[i];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    private removeDragObj (pointerId: number): IDragObj | null {\r\n        let removedDragObj: IDragObj | null = null;\r\n        for (let i = 0; i < this.dragPointerIdArr.length; i++) {\r\n            if (this.dragPointerIdArr[i] === pointerId) {\r\n                removedDragObj = this.dragObjArr[i];\r\n                this.dragObjArr.splice(i, 1);\r\n                this.dragPointerIdArr.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n        return removedDragObj;\r\n    }\r\n\r\n    /**\r\n     * Creates a value for onPointer, from a pointer event handler.\r\n     */\r\n    private createPointerOutEvent (\r\n        typeStr: TPointerEventType,\r\n        correctedEvent: ICorrectedPointerEvent,\r\n        custom?: Partial<IPointerEvent>,\r\n    ): IPointerEvent {\r\n\r\n        const bounds: DOMRect = this.targetElement.getBoundingClientRect();\r\n        const result: IPointerEvent = {\r\n            type: typeStr,\r\n            pointerId: correctedEvent.pointerId,\r\n            pointerType: correctedEvent.pointerType as TPointerType,\r\n            pageX: correctedEvent.pageX,\r\n            pageY: correctedEvent.pageY,\r\n            clientX: correctedEvent.clientX,\r\n            clientY: correctedEvent.clientY,\r\n            relX: correctedEvent.clientX - bounds.left + this.targetElement.scrollLeft,\r\n            relY: correctedEvent.clientY - bounds.top + this.targetElement.scrollTop,\r\n            dX: correctedEvent.movementX,\r\n            dY: correctedEvent.movementY,\r\n            time: correctedEvent.timeStamp,\r\n            eventPreventDefault: correctedEvent.eventPreventDefault,\r\n            eventStopPropagation: correctedEvent.eventStopPropagation,\r\n            ...custom,\r\n        };\r\n\r\n        if (typeStr === 'pointermove') {\r\n            result.coalescedArr = [];\r\n            if (correctedEvent.coalescedArr.length > 1) {\r\n                let coalescedItem;\r\n                for (let i = 0; i < correctedEvent.coalescedArr.length; i++) {\r\n                    coalescedItem = correctedEvent.coalescedArr[i];\r\n                    result.coalescedArr.push({\r\n                        pageX: coalescedItem.pageX,\r\n                        pageY: coalescedItem.pageY,\r\n                        clientX: coalescedItem.clientX,\r\n                        clientY: coalescedItem.clientY,\r\n                        relX: coalescedItem.clientX - bounds.left + this.targetElement.scrollLeft,\r\n                        relY: coalescedItem.clientY - bounds.top + this.targetElement.scrollTop,\r\n                        dX: coalescedItem.movementX,\r\n                        dY: coalescedItem.movementY,\r\n                        time: coalescedItem.timeStamp,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private setupDocumentListeners () {\r\n        this.windowOnPointerMove && document.addEventListener(pointerMoveEvt, this.windowOnPointerMove);\r\n        this.windowOnPointerUp && document.addEventListener(pointerUpEvt, this.windowOnPointerUp);\r\n        this.windowOnPointerLeave && document.addEventListener(pointerCancelEvt, this.windowOnPointerLeave);\r\n        this.windowOnPointerLeave && document.addEventListener(pointerLeaveEvt, this.windowOnPointerLeave);\r\n    }\r\n\r\n    private destroyDocumentListeners () {\r\n        this.windowOnPointerMove && document.removeEventListener(pointerMoveEvt, this.windowOnPointerMove);\r\n        this.windowOnPointerUp && document.removeEventListener(pointerUpEvt, this.windowOnPointerUp);\r\n        this.windowOnPointerLeave && document.removeEventListener(pointerCancelEvt, this.windowOnPointerLeave);\r\n        this.windowOnPointerLeave && document.removeEventListener(pointerLeaveEvt, this.windowOnPointerLeave);\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (p: IPointerListenerParams) {\r\n        this.targetElement = p.target;\r\n        this.onPointerCallback = p.onPointer;\r\n        this.onWheelCallback = p.onWheel;\r\n        this.onEnterLeaveCallback = p.onEnterLeave;\r\n        this.maxPointers = Math.max(1, p.maxPointers || 1);\r\n\r\n\r\n        this.wheelCleaner = new WheelCleaner((cleanerEvent) => {\r\n            if (this.isDestroyed || !this.onWheelCallback) {\r\n                return;\r\n            }\r\n            const bounds = this.targetElement.getBoundingClientRect();\r\n            const whlEvent = {\r\n                ...cleanerEvent,\r\n                relX: cleanerEvent.clientX - bounds.left + this.targetElement.scrollLeft,\r\n                relY: cleanerEvent.clientY - bounds.top + this.targetElement.scrollTop,\r\n            };\r\n            this.onWheelCallback(whlEvent);\r\n        });\r\n\r\n        if (this.onPointerCallback) {\r\n            this.onPointerMove = (event: PointerEvent) => {\r\n                const correctedEvent = correctPointerEvent(event);\r\n\r\n                const tempLastPointerType = this.lastPointerType;\r\n                this.lastPointerType = correctedEvent.pointerType as TPointerType;\r\n\r\n                if (\r\n                    this.dragPointerIdArr.includes(correctedEvent.pointerId) ||\r\n                    this.dragPointerIdArr.length === this.maxPointers ||\r\n                    correctedEvent.pointerType === 'touch'\r\n                ) {\r\n                    this.didSkip = false;\r\n                    return;\r\n                }\r\n\r\n                // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\r\n                if (!this.didSkip && correctedEvent.pointerType === 'mouse' && tempLastPointerType === 'pen') {\r\n                    this.didSkip = true;\r\n                    return;\r\n                }\r\n                this.didSkip = false;\r\n\r\n                const outEvent = this.createPointerOutEvent('pointermove', correctedEvent);\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.onPointerDown = (event: PointerEvent, onSkipGlobal? : boolean) => {\r\n\r\n                //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' pointerdown');\r\n                if (this.dragPointerIdArr.includes(correctedEvent.pointerId) || this.dragPointerIdArr.length === this.maxPointers || ![1, 2, 4].includes(correctedEvent.buttons)) {\r\n                    //BB.throwOut('pointerdown ignored');\r\n                    return;\r\n                }\r\n\r\n                //set up global listeners\r\n                if (this.dragObjArr.length === 0 && !onSkipGlobal) {\r\n                    this.setupDocumentListeners();\r\n                }\r\n                const dragObj: IDragObj = {\r\n                    pointerId: correctedEvent.pointerId,\r\n                    pointerType: correctedEvent.pointerType as TPointerType,\r\n                    downPageX: correctedEvent.pageX,\r\n                    downPageY: correctedEvent.pageY,\r\n                    buttons: correctedEvent.buttons,\r\n                    lastPageX: correctedEvent.pageX,\r\n                    lastPageY: correctedEvent.pageY,\r\n                    lastTimeStamp: correctedEvent.timeStamp,\r\n                };\r\n                this.dragObjArr.push(dragObj);\r\n                this.dragPointerIdArr.push(correctedEvent.pointerId);\r\n\r\n                const outEvent: IPointerEvent = this.createPointerOutEvent('pointerdown', correctedEvent, {\r\n                    downPageX: correctedEvent.pageX,\r\n                    downPageY: correctedEvent.pageY,\r\n                    button: getButtonStr(correctedEvent.buttons),\r\n                    pressure: correctedEvent.pressure,\r\n                });\r\n\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.windowOnPointerMove = (event: PointerEvent) => {\r\n                //BB.throwOut('pointermove ' + event.pointerId);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\r\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) {\r\n                    return;\r\n                }\r\n\r\n                const dragObj = this.getDragObj(correctedEvent.pointerId);\r\n\r\n                if (!dragObj) {\r\n                    // todo need to handle this!\r\n                    return;\r\n                }\r\n\r\n                //if pointer changes button its pressing -> turn into pointerup\r\n                if (correctedEvent.buttons !== dragObj.buttons) {\r\n                    //pointer up\r\n\r\n                    //remove listener\r\n                    if (this.dragObjArr.length === 1) {\r\n                        this.destroyDocumentListeners();\r\n                    }\r\n                    this.removeDragObj(correctedEvent.pointerId);\r\n\r\n                    const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\r\n                        downPageX: dragObj.downPageX,\r\n                        downPageY: dragObj.downPageY,\r\n                    });\r\n                    this.onPointerCallback && this.onPointerCallback(outEvent);\r\n                    return;\r\n                }\r\n\r\n                // ipad likes to do this\r\n                if (\r\n                    correctedEvent.pointerType === 'pen' &&\r\n                    correctedEvent.pageX === dragObj.lastPageX &&\r\n                    correctedEvent.pageY === dragObj.lastPageY &&\r\n                    correctedEvent.timeStamp === dragObj.lastTimeStamp\r\n                ) {\r\n                    //ignore\r\n                    return;\r\n                }\r\n\r\n                const outEvent = this.createPointerOutEvent('pointermove', correctedEvent, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY,\r\n                    button: getButtonStr(correctedEvent.buttons),\r\n                    pressure: correctedEvent.pressure,\r\n                });\r\n\r\n                dragObj.lastPageX = correctedEvent.pageX;\r\n                dragObj.lastPageY = correctedEvent.pageY;\r\n                dragObj.lastTimeStamp = correctedEvent.timeStamp;\r\n\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.windowOnPointerUp = (event: PointerEvent) => {\r\n                //BB.throwOut('pointerup ' + event.pointerId);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\r\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) {\r\n                    return;\r\n                }\r\n\r\n                //remove listener\r\n                if (this.dragObjArr.length === 1) {\r\n                    this.destroyDocumentListeners();\r\n                }\r\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\r\n                if (!dragObj) {\r\n                    // todo need to handle this!\r\n                    return;\r\n                }\r\n\r\n                const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY,\r\n                });\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n\r\n            };\r\n\r\n            this.windowOnPointerLeave = (event: PointerEvent) => {\r\n                //BB.throwOut('pointerleave ' + event.pointerId);\r\n                const correctedEvent = correctPointerEvent(event);\r\n                ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\r\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) { //} || event.target !== document) {\r\n                    return;\r\n                }\r\n\r\n                //remove listener\r\n                if (this.dragObjArr.length === 1) {\r\n                    this.destroyDocumentListeners();\r\n                }\r\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\r\n                if (!dragObj) {\r\n                    // todo need to handle this!\r\n                    return;\r\n                }\r\n\r\n                const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\r\n                    downPageX: dragObj.downPageX,\r\n                    downPageY: dragObj.downPageY,\r\n                });\r\n                this.onPointerCallback && this.onPointerCallback(outEvent);\r\n            };\r\n\r\n            this.targetElement.addEventListener(pointerMoveEvt, this.onPointerMove);\r\n            this.targetElement.addEventListener(pointerDownEvt, this.onPointerDown);\r\n\r\n            if (!hasPointerEvents) {\r\n                const touchToFakePointer = (touch: Touch, touchEvent: TouchEvent, isDown: boolean) => {\r\n                    return {\r\n                        pointerId: touch.identifier,\r\n                        pointerType: 'touch',\r\n                        pageX: touch.pageX,\r\n                        pageY: touch.pageY,\r\n                        clientX: touch.clientX,\r\n                        clientY: touch.clientY,\r\n                        button: isDown ? 0 : undefined,\r\n                        buttons: isDown ? 1 : 0,\r\n                        timeStamp: touchEvent.timeStamp,\r\n                        target: touchEvent.target,\r\n                        pressure: isDown ? 1 : 0,\r\n                        preventDefault: () => touchEvent.preventDefault(),\r\n                        stopPropagation: () => touchEvent.stopPropagation(),\r\n                    };\r\n                };\r\n\r\n                const handleTouch = (e: TouchEvent, type: 'start' | 'move' | 'end' | 'cancel'): void => {\r\n                    for (let i = 0; i < e.changedTouches.length; i++) {\r\n                        const touch = e.changedTouches[i];\r\n                        const fakePointer = touchToFakePointer(touch, e, ['start', 'move'].includes(type));\r\n                        if (type === 'start') {\r\n                            this.onPointerDown(fakePointer, false);\r\n                        } else if (type === 'move') {\r\n                            this.windowOnPointerMove(fakePointer);\r\n                        } else if (type === 'end') {\r\n                            this.windowOnPointerUp(fakePointer);\r\n                        } else {\r\n                            this.windowOnPointerLeave(fakePointer);\r\n                        }\r\n                    }\r\n                };\r\n\r\n                this.onTouchStart = (e: TouchEvent): void => {\r\n                    e.preventDefault();\r\n                    handleTouch(e, 'start');\r\n                };\r\n                this.onTouchMove = (e: TouchEvent): void => {\r\n                    handleTouch(e, 'move');\r\n                };\r\n                this.onTouchEnd = (e: TouchEvent): void => {\r\n                    handleTouch(e, 'end');\r\n                };\r\n                this.onTouchCancel = (e: TouchEvent): void => {\r\n                    handleTouch(e, 'cancel');\r\n                };\r\n\r\n                this.targetElement.addEventListener('touchstart', this.onTouchStart);\r\n                this.targetElement.addEventListener('touchmove', this.onTouchMove);\r\n                this.targetElement.addEventListener('touchend', this.onTouchEnd);\r\n                this.targetElement.addEventListener('touchcancel', this.onTouchCancel);\r\n            }\r\n        }\r\n        if (this.onWheelCallback) {\r\n            this.onWheel = (e: WheelEvent) => {\r\n                this.wheelCleaner.process(e);\r\n            };\r\n            this.targetElement.addEventListener('wheel', this.onWheel);\r\n        }\r\n        if (this.onEnterLeaveCallback) {\r\n            this.onPointerEnter = () => {\r\n                this.isOverCounter++;\r\n                this.onEnterLeaveCallback && this.onEnterLeaveCallback(true);\r\n            };\r\n\r\n            this.onPointerLeave = () => {\r\n                this.isOverCounter--;\r\n                this.onEnterLeaveCallback && this.onEnterLeaveCallback(false);\r\n            };\r\n\r\n            this.targetElement.addEventListener(pointerEnterEvt, this.onPointerEnter);\r\n            this.targetElement.addEventListener(pointerLeaveEvt, this.onPointerLeave);\r\n        }\r\n\r\n        if (p.fixScribble) {\r\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\r\n            this.onTouchMoveScribbleFix = (e: TouchEvent) => e.preventDefault();\r\n            this.targetElement.addEventListener('touchmove', this.onTouchMoveScribbleFix);\r\n        }\r\n    }\r\n\r\n    destroy (): void {\r\n        if (this.isDestroyed) {\r\n            return;\r\n        }\r\n        this.isDestroyed = true;\r\n        this.onPointerEnter && this.targetElement.removeEventListener(pointerEnterEvt, this.onPointerEnter);\r\n        this.onPointerLeave && this.targetElement.removeEventListener(pointerLeaveEvt, this.onPointerLeave);\r\n        this.onPointerMove && this.targetElement.removeEventListener(pointerMoveEvt, this.onPointerMove);\r\n        this.onPointerDown && this.targetElement.removeEventListener(pointerDownEvt, this.onPointerDown);\r\n        this.onWheel && this.targetElement.removeEventListener('wheel', this.onWheel);\r\n        this.destroyDocumentListeners();\r\n        this.onTouchMoveScribbleFix && document.removeEventListener('touchmove', this.onTouchMoveScribbleFix);\r\n\r\n        this.onTouchStart && this.targetElement.removeEventListener('touchstart', this.onTouchStart);\r\n        this.onTouchMove && this.targetElement.removeEventListener('touchmove', this.onTouchMove);\r\n        this.onTouchEnd && this.targetElement.removeEventListener('touchend', this.onTouchEnd);\r\n        this.onTouchCancel && this.targetElement.removeEventListener('touchcancel', this.onTouchCancel);\r\n    }\r\n\r\n}\r\n\r\n","export interface IWheelCleanerEvent {\r\n    deltaY: number;\r\n    pageX: number;\r\n    pageY: number;\r\n    clientX: number;\r\n    clientY: number;\r\n}\r\n\r\nconst SEQUENCE_TIMEOUT_MS = 200;\r\n\r\n/**\r\n * Filters wheel events. removes swipe scrolling and pinch scrolling that trackpads do. (as best as it can)\r\n * Normalizes regular scrolls.\r\n *\r\n * Why:\r\n * - trackpad scrolling is different from old school mouse scrolling\r\n * - but there is no way to learn from the browser if it's trackpad scrolling\r\n * - browsers don't even give access to the raw swiping or pinching movement, but some abstraction on top, making the scrolling\r\n *      continue an arbitrary amount, at an arbitrary scale\r\n * - each browser does this differently. So you can't offer a consistent/controlled experience\r\n *\r\n * - also trackpads are painful to draw with. So supporting a trackpad-based workflow makes not much sense.\r\n */\r\nexport class WheelCleaner {\r\n\r\n    private readonly knownUnitArr: number[] = [100];\r\n    private sequenceLength: number = 0;\r\n    private sequenceUnit: null | number = null;\r\n    private endSequenceTimeout: undefined | ReturnType<typeof setTimeout>;\r\n    private toEmitDelta: null | number = null;\r\n    private position: null | {\r\n        pageX: number;\r\n        pageY: number;\r\n        clientX: number;\r\n        clientY: number;\r\n    } = null;\r\n\r\n\r\n    private emit (delta: number): void {\r\n        if (this.position === null || this.sequenceUnit === null) {\r\n            return;\r\n        }\r\n        this.callback({\r\n            deltaY: Math.round(delta / this.sequenceUnit),\r\n            pageX: this.position.pageX,\r\n            pageY: this.position.pageY,\r\n            clientX: this.position.clientX,\r\n            clientY: this.position.clientY,\r\n        });\r\n    }\r\n\r\n    private endSequence (): void {\r\n        if (this.toEmitDelta !== null) {\r\n            this.emit(this.toEmitDelta);\r\n            this.toEmitDelta = null;\r\n        }\r\n        if (this.sequenceUnit !== null && !(this.knownUnitArr.includes(this.sequenceUnit))) {\r\n            this.knownUnitArr.push(this.sequenceUnit);\r\n        }\r\n        this.sequenceLength = 0;\r\n        this.sequenceUnit = null;\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (private callback: (p: IWheelCleanerEvent) => void) {}\r\n\r\n    process (event: WheelEvent): void {\r\n        this.position = {\r\n            pageX: event.pageX,\r\n            pageY: event.pageY,\r\n            clientX: event.clientX,\r\n            clientY: event.clientY,\r\n        };\r\n\r\n        if (this.endSequenceTimeout) {\r\n            clearTimeout(this.endSequenceTimeout);\r\n        }\r\n        this.endSequenceTimeout = setTimeout(() => this.endSequence(), SEQUENCE_TIMEOUT_MS);\r\n\r\n        //prep delta\r\n        let delta = event.deltaY;\r\n        if ('deltaMode' in event && event.deltaMode === 1) {\r\n            delta *= 100 / 3;\r\n        }\r\n        const absDelta = Math.abs(delta);\r\n\r\n        //sequence begins\r\n        if (this.sequenceLength === 0) {\r\n            this.sequenceLength++;\r\n            if (absDelta < 50) {\r\n                //dirty - probably a swipe scroll or pinch scroll on trackpad\r\n                return;\r\n            }\r\n\r\n            this.sequenceUnit = absDelta;\r\n            if (this.knownUnitArr.includes(this.sequenceUnit)) {\r\n                //we know this unit - emit right away\r\n                this.emit(delta);\r\n            } else {\r\n                //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\r\n                this.toEmitDelta = delta;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (this.sequenceUnit === null) {\r\n            //previously determined dirty sequence\r\n            this.toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n        //sequence continues\r\n        if (absDelta === 0) {\r\n            //ignore zero scroll\r\n            return;\r\n        }\r\n        if (\r\n            absDelta === this.sequenceUnit ||\r\n            (absDelta / this.sequenceUnit) % 1 < 0.0001// a multiple\r\n        ) {\r\n            //fine\r\n        } else if ((this.sequenceUnit / absDelta) % 1 < 0.0001) {\r\n            //unit was actually a multiple - update it\r\n            this.sequenceUnit = absDelta;\r\n\r\n        } else if (absDelta !== this.sequenceUnit) {\r\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\r\n            this.sequenceUnit = null;\r\n            this.toEmitDelta = null;\r\n            return;\r\n        }\r\n\r\n\r\n        if (this.toEmitDelta !== null) {\r\n            this.emit(this.toEmitDelta);\r\n            this.toEmitDelta = null;\r\n        }\r\n        this.emit(delta);\r\n    }\r\n\r\n}\r\n","import {mix} from '../math/math';\r\n\r\n/**\r\n * different devices/browsers have different pressure curves\r\n * pressure normalize attempts to achieve similar mapping\r\n *\r\n * pressure range [0, 1]\r\n */\r\nexport class PressureNormalizer {\r\n    \r\n    private count: number = 0;\r\n    private avgPressure: number = 0; // float [0, 1]\r\n    private normalizeIsComplete: boolean = false;\r\n    private normalizeFactor: number = 1;\r\n    \r\n    // ---- public ----\r\n    normalize (pressure: number): number {\r\n        if (pressure === 0 || pressure === 1) {\r\n            return pressure;\r\n        }\r\n\r\n        if (this.count < 60) {\r\n            if (this.count === 0 || this.count === null) {\r\n                this.avgPressure = pressure;\r\n            } else {\r\n                this.avgPressure = mix(pressure, this.avgPressure, 0.95);\r\n            }\r\n            this.count++;\r\n        } else if (!this.normalizeIsComplete) {\r\n            this.normalizeIsComplete = true;\r\n            //BB.throwOut('avg pressure decision!' + this.avgPressure);\r\n            if (this.avgPressure < 0.13) { // absurd pressure needed\r\n                this.normalizeFactor = 2.3;\r\n            }\r\n        }\r\n\r\n        return Math.pow(pressure, 1 / this.normalizeFactor);\r\n    }\r\n    \r\n}","import {IBounds, IRect, IVector2D} from '../bb-types';\r\n\r\nexport function mix (a: number, b: number, f: number): number {\r\n    return a * (1 - f) + b * f;\r\n}\r\n\r\nexport function dist (ax: number, ay: number, bx: number, by: number): number {\r\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\r\n}\r\n\r\nexport function distSquared (ax: number, ay: number, bx: number, by: number): number {\r\n    // faster because no square-root\r\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\r\n}\r\n\r\nexport function lenSquared (x: number, y: number): number {\r\n    // faster because no square-root\r\n    return x * x + y * y;\r\n}\r\n\r\nexport function pointsToAngleRad (p1: IVector2D, p2: IVector2D): number {\r\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n}\r\n\r\nexport function pointsToAngleDeg (p1: IVector2D, p2: IVector2D): number {\r\n    return pointsToAngleRad(p1, p2) * 180 / Math.PI;\r\n}\r\n\r\nexport function isInsideRect (p: IVector2D, rect: IRect): boolean {\r\n    return rect.x <= p.x && p.x <= rect.x + rect.width &&\r\n        rect.y <= p.y && p.y <= rect.y + rect.height;\r\n}\r\n\r\nexport function clamp (num: number, min: number, max: number): number {\r\n    return num < min\r\n        ? min\r\n        : num > max\r\n            ? max\r\n            : num;\r\n}\r\n\r\nexport function rotate (x: number, y: number, deg: number): IVector2D {\r\n    const theta = deg * (Math.PI / 180);\r\n    const cs = Math.cos(theta);\r\n    const sn = Math.sin(theta);\r\n\r\n    return {\r\n        x: x * cs - y * sn,\r\n        y: x * sn + y * cs,\r\n    };\r\n}\r\n\r\nexport function rotateAround (center: IVector2D, point: IVector2D, deg: number): IVector2D {\r\n    const rot = rotate(point.x - center.x, point.y - center.y, deg);\r\n    rot.x += center.x;\r\n    rot.y += center.y;\r\n    return rot;\r\n}\r\n\r\nexport function intDxy (remainder: IVector2D, fDx: number, fDy: number) {\r\n    remainder.x += fDx;\r\n    remainder.y += fDy;\r\n    const dX = Math.round(remainder.x);\r\n    const dY = Math.round(remainder.y);\r\n    remainder.x -= dX;\r\n    remainder.y -= dY;\r\n    return {\r\n        dX,\r\n        dY,\r\n    };\r\n}\r\n\r\n/**\r\n * return closest even number\r\n * @param f\r\n */\r\nexport function roundEven (f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f;\r\n        }\r\n        return f + 1;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 0) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * return closest uneven number\r\n * @param f\r\n */\r\nexport function roundUneven (f: number) {\r\n    if (f % 1 === 0) {\r\n        if (f % 2 === 0) {\r\n            return f + 1;\r\n        }\r\n        return f;\r\n    }\r\n    const above = Math.ceil(f);\r\n    const below = Math.floor(f);\r\n    if (above % 2 === 1) {\r\n        return above;\r\n    } else {\r\n        return below;\r\n    }\r\n}\r\n\r\n/**\r\n * round number to certain precision.\r\n * round(1.2345, 2) = 1.23\r\n * round(1.2345, 0) = 0\r\n * round(123, -1) = 120\r\n *\r\n * @param f\r\n * @param digits\r\n */\r\nexport function round (f: number, digits: number): number {\r\n    const digitMult = Math.pow(10, digits);\r\n    return Math.round((f/* + Number.EPSILON*/) * digitMult) / digitMult;\r\n}\r\n\r\n/**\r\n * update target so it includes bounds\r\n * @param target\r\n * @param bounds\r\n */\r\nexport function updateBounds (target: IBounds, bounds: IBounds): IBounds {\r\n    if (!bounds) {\r\n        return target;\r\n    }\r\n    if (!target) {\r\n        target = { x1: bounds.x1, y1: bounds.y1, x2: bounds.x2, y2: bounds.y2 };\r\n    } else {\r\n        target.x1 = Math.min(target.x1, bounds.x1);\r\n        target.y1 = Math.min(target.y1, bounds.y1);\r\n        target.x2 = Math.max(target.x2, bounds.x2);\r\n        target.y2 = Math.max(target.y2, bounds.y2);\r\n    }\r\n    return target;\r\n}\r\n\r\n/**\r\n * determine overlap of bounds with width&height\r\n */\r\nexport function boundsInArea (bounds: IBounds, width: number, height: number): IBounds | null {\r\n    const x1 = Math.max(0, bounds.x1);\r\n    const y1 = Math.max(0, bounds.y1);\r\n    const x2 = Math.min(width - 1, bounds.x2);\r\n    const y2 = Math.min(height - 1, bounds.y2);\r\n    if (x1 > x2 || y1 > y2) {\r\n        return null;\r\n    }\r\n    return { x1, y1, x2, y2 };\r\n}","import {IBounds, IKeyString, IRect, TNullable} from '../bb-types';\r\nimport {createCanvas} from './create-canvas';\r\nimport {copyObj} from './base';\r\n\r\nexport function copyCanvas (canvas: HTMLCanvasElement): HTMLCanvasElement {\r\n    const resultCanvas = createCanvas(canvas.width, canvas.height);\r\n    const ctx = resultCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.drawImage(canvas, 0, 0);\r\n    return resultCanvas;\r\n}\r\n\r\nexport function ctx (canvas: HTMLCanvasElement): CanvasRenderingContext2D {\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error(\"couldn't get 2d context\");\r\n    }\r\n    return ctx;\r\n}\r\n\r\n/**\r\n * Determine if should disable imageSmoothing for transformation.\r\n * ImageSmoothing can make images blurry even when they're in the original scale and aligned with the pixelgrid.\r\n */\r\nexport function testShouldPixelate (\r\n    transform: {x: number; y: number; width:number; height: number; angleDeg: number},\r\n    scaleX: number,\r\n    scaleY: number,\r\n): boolean {\r\n    if (\r\n        ![1, -1].includes(scaleX) || ![1, -1].includes(scaleY) ||\r\n        transform.width % 1 !== 0 || transform.height % 1 !== 0 ||\r\n        Math.abs(transform.angleDeg) % 90 !== 0\r\n    ) {\r\n        return false;\r\n    }\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    const width = whSwapped ? transform.height : transform.width;\r\n    const height = whSwapped ? transform.width : transform.height;\r\n    return (\r\n            (Math.abs(width) % 2 === 0 && transform.x % 1 === 0) ||\r\n            (Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5)\r\n        ) &&\r\n        (\r\n            (Math.abs(height) % 2 === 0 && transform.y % 1 === 0) ||\r\n            (Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5)\r\n        );\r\n}\r\n\r\n\r\n/**\r\n * @param destCtx - the canvas that will be drawn on\r\n * @param transformImage - image that will be drawn on canvas\r\n * @param transform - {x, y, width, height, angle} - x and y are center of transformImage\r\n * @param bounds object - optional {x, y, width, height} - crop of transformImage in transformImage image space\r\n * @param pixelated\r\n */\r\nexport function drawTransformedImageWithBounds (\r\n    destCtx: CanvasRenderingContext2D,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transform: {x: number; y: number; width:number; height: number; angleDeg: number},\r\n    bounds?: {x: number; y: number; width: number; height: number},\r\n    pixelated?: boolean,\r\n): void {\r\n    if (!bounds) {\r\n        bounds = {\r\n            x: 0,\r\n            y: 0,\r\n            width: transformImage.width,\r\n            height: transformImage.height,\r\n        };\r\n    }\r\n\r\n    destCtx.save();\r\n    if (pixelated) {\r\n        destCtx.imageSmoothingEnabled = false;\r\n    } else {\r\n        destCtx.imageSmoothingEnabled = true;\r\n        destCtx.imageSmoothingQuality = 'high';\r\n    }\r\n\r\n    destCtx.translate(transform.x, transform.y);\r\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\r\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\r\n    destCtx.drawImage(\r\n        transformImage,\r\n        bounds.x, bounds.y, bounds.width, bounds.height,\r\n        -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\r\n\r\n    destCtx.restore();\r\n}\r\n\r\n/**\r\n * all transformations are optional\r\n * center is the point around which will be scaled and rotated\r\n *\r\n * @param baseCanvas canvas - the canvas that will be drawn on\r\n * @param transformImage image|canvas - image that will be drawn on canvas\r\n * @param transformObj {center: {x, y}, scale: {x, y}, translate: {x, y}, angleDegree}\r\n */\r\nexport function drawTransformedImageOnCanvas (\r\n    baseCanvas: HTMLCanvasElement,\r\n    transformImage: HTMLImageElement | HTMLCanvasElement,\r\n    transformObj: {\r\n        center: {x: number; y: number};\r\n        scale: {x: number; y: number};\r\n        translate: {x: number; y: number};\r\n        angleDegree: number;\r\n    },\r\n): void {\r\n    transformObj = copyObj(transformObj);\r\n    if (!transformObj.center) {\r\n        transformObj.center = {\r\n            x: transformImage.width / 2,\r\n            y: transformImage.height / 2,\r\n        };\r\n    }\r\n    if (!transformObj.scale) {\r\n        transformObj.scale = {\r\n            x: 1,\r\n            y: 1,\r\n        };\r\n    }\r\n    if (!transformObj.angleDegree) {\r\n        transformObj.angleDegree = 0;\r\n    }\r\n    if (!transformObj.translate) {\r\n        transformObj.translate = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n    }\r\n\r\n    const ctx = baseCanvas.getContext('2d');\r\n    if (!ctx) {\r\n        throw new Error('2d context not supported or canvas already initialized');\r\n    }\r\n    ctx.save();\r\n    if (\r\n        Math.abs(transformObj.scale.x - 1) >  0.000001 ||\r\n        Math.abs(transformObj.scale.y - 1) > 0.000001 ||\r\n        Math.abs(transformObj.angleDegree % 90) > 0.000001\r\n    ) {\r\n        ctx.imageSmoothingEnabled = true;\r\n        ctx.imageSmoothingQuality = 'high';\r\n    } else {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n\r\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\r\n    ctx.translate(transformObj.center.x, transformObj.center.y);\r\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\r\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\r\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\r\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\r\n\r\n    ctx.restore();\r\n}\r\n\r\nexport const createCheckerCanvas = function (size: number, isDark?: boolean): HTMLCanvasElement {\r\n    const canvas = createCanvas();\r\n    let ctx;\r\n    if (size < 1) {\r\n        canvas.width = 1;\r\n        canvas.height = 1;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = 'rgb(128, 128, 128)';\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    } else if (size > 200) {\r\n        canvas.width = 401;\r\n        canvas.height = 401;\r\n    } else {\r\n        canvas.width = size * 2;\r\n        canvas.height = size * 2;\r\n        ctx = canvas.getContext('2d');\r\n        if (!ctx) {\r\n            throw new Error('2d context not supported or canvas already initialized');\r\n        }\r\n        ctx.fillStyle = isDark ? 'rgb(90, 90, 90)' : 'rgb(255, 255, 255)';\r\n        ctx.fillRect(0, 0, size * 2, size * 2);\r\n        ctx.fillStyle = isDark ? 'rgb(63, 63, 63)': 'rgb(200, 200, 200)';\r\n        ctx.fillRect(0, 0, size, size);\r\n        ctx.fillRect(size, size, size * 2, size * 2);\r\n    }\r\n    return canvas;\r\n};\r\n\r\nexport const createCheckerDataUrl = (function () {\r\n    const cache: IKeyString = { // previously created dataUrls\r\n        '8l': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC',\r\n        '4l': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC',\r\n    };\r\n\r\n    return function (size: number, callback?: (s: string) => void, isDark?: boolean) {\r\n        const modeStr = isDark ? 'd' : 'l';\r\n\r\n        function create (size: number): string {\r\n            size = parseInt('' + size);\r\n            if (cache['' + size + modeStr]) {\r\n                return cache['' + size + modeStr];\r\n            }\r\n            const canvas = createCheckerCanvas(size, isDark);\r\n            const result = canvas.toDataURL('image/png');\r\n            cache['' + size + modeStr] = result;\r\n            return result;\r\n        }\r\n\r\n        if (callback) { //async\r\n            setTimeout(function () {\r\n                callback(create(size));\r\n            }, 1);\r\n        } else { //sync\r\n            return create(size);\r\n        }\r\n    };\r\n})();\r\n\r\n/**\r\n * smooth resize image\r\n * @param canvas canvas - will be resized (modified)\r\n * @param w\r\n * @param h\r\n * @param tmp1 canvas - optional, provide to save resources\r\n * @param tmp2 canvas - optional, provide to save resources\r\n */\r\nexport function resizeCanvas (\r\n    canvas: HTMLCanvasElement,\r\n    w: number,\r\n    h: number,\r\n    tmp1?: HTMLCanvasElement,\r\n    tmp2?: HTMLCanvasElement,\r\n): void {\r\n\r\n    //determine base 2 exponents of old and new size\r\n    function getBase2Obj (oldW: number, oldH: number, newW: number, newH: number) {\r\n        const result = {\r\n            oldWidthEx: Math.round(Math.log2(oldW)),\r\n            oldHeightEx: Math.round(Math.log2(oldH)),\r\n            newWidthEx: Math.ceil(Math.log2(newW)),\r\n            newHeightEx: Math.ceil(Math.log2(newH)),\r\n        };\r\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\r\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\r\n        return result;\r\n    }\r\n\r\n    if (!w || !h || (w === canvas.width && h === canvas.height)) {\r\n        return;\r\n    }\r\n    w = Math.max(w, 1);\r\n    h = Math.max(h, 1);\r\n    if (w <= canvas.width && h <= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp2 = !tmp2 ? createCanvas() : tmp2;\r\n\r\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\r\n\r\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\r\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\r\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\r\n        tmp1.getContext('2d')!.save();\r\n        tmp2.getContext('2d')!.save();\r\n\r\n        let ew, eh;\r\n        let buffer1 = tmp1, buffer2 = tmp2;\r\n\r\n        ew = base2.oldWidthEx;\r\n        eh = base2.oldHeightEx;\r\n\r\n        let bufferCtx = buffer2.getContext('2d')!;\r\n        bufferCtx.imageSmoothingEnabled = true;\r\n        bufferCtx.imageSmoothingQuality  = 'high';\r\n        bufferCtx.globalCompositeOperation  = 'copy';\r\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\r\n\r\n        let currentWidth = buffer2.width;\r\n        let currentHeight = buffer2.height;\r\n\r\n        //stepwise half the size\r\n        for (; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--) {\r\n            bufferCtx = buffer1.getContext('2d')!;\r\n            bufferCtx.imageSmoothingEnabled = true;\r\n            bufferCtx.imageSmoothingQuality  = 'high';\r\n            bufferCtx.globalCompositeOperation  = 'copy';\r\n\r\n            const newWidth = (ew > base2.newWidthEx) ? currentWidth / 2 : currentWidth;\r\n            const newHeight = (eh > base2.newHeightEx) ? currentHeight / 2 : currentHeight;\r\n\r\n            //buffer also needs to be properly sized, unfortunately\r\n            buffer1.width = newWidth;\r\n            buffer1.height = newHeight;\r\n\r\n            bufferCtx.drawImage(\r\n                buffer2,\r\n                0, 0,\r\n                currentWidth, currentHeight,\r\n                0, 0,\r\n                newWidth, newHeight\r\n            );\r\n            currentWidth = newWidth;\r\n            currentHeight = newHeight;\r\n\r\n            //swap\r\n            const tmp = buffer1;\r\n            buffer1 = buffer2;\r\n            buffer2 = tmp;\r\n        }\r\n\r\n        //when no longer can be halved, bring to target size\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        const canvasCtx = canvas.getContext('2d')!;\r\n        canvasCtx.save();\r\n        canvasCtx.imageSmoothingEnabled = true;\r\n        canvasCtx.imageSmoothingQuality  = 'high';\r\n        canvasCtx.drawImage(\r\n            buffer2,\r\n            0, 0,\r\n            currentWidth, currentHeight,\r\n            0, 0,\r\n            w, h\r\n        );\r\n        canvasCtx.restore();\r\n        tmp1.getContext('2d')!.restore();\r\n        tmp2.getContext('2d')!.restore();\r\n\r\n    } else if (w >= canvas.width && h >= canvas.height) {\r\n\r\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\r\n        tmp1.width = w;\r\n        tmp1.height = h;\r\n        const tmp1Ctx = tmp1.getContext('2d')!;\r\n        tmp1Ctx.save();\r\n        tmp1Ctx.imageSmoothingEnabled = true;\r\n        tmp1Ctx.imageSmoothingQuality  = 'high';\r\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\r\n        tmp1Ctx.restore();\r\n\r\n        canvas.width = w;\r\n        canvas.height = h;\r\n        canvas.getContext('2d')!.drawImage(tmp1, 0, 0);\r\n\r\n    } else {\r\n        resizeCanvas(canvas, w, canvas.height, tmp1, tmp2);\r\n        resizeCanvas(canvas, w, h, tmp1, tmp2);\r\n    }\r\n}\r\n\r\n/**\r\n * puts naive greyscale version of image into alpha channel.\r\n * only writes a, doesn't write rgb\r\n * @param canvas\r\n */\r\nexport function convertToAlphaChannelCanvas (canvas: HTMLCanvasElement): void {\r\n    const imdat = canvas.getContext('2d')!.getImageData(0, 0, canvas.width, canvas.height);\r\n    for (let i = 0; i < imdat.data.length; i += 4) {\r\n        if (imdat.data[i + 3] === 0) {\r\n            continue;\r\n        }\r\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\r\n    }\r\n    canvas.getContext('2d')!.putImageData(imdat, 0, 0);\r\n}\r\n\r\n/**\r\n * Sometimes garbage collection is too slow, and canvases use up too much memory,\r\n * or there is a hard to fix memory leak.\r\n * This function manually makes the canvas use as little memory as possible.\r\n */\r\nexport function freeCanvas (canvas: HTMLCanvasElement): void {\r\n    canvas.width = 1;\r\n    canvas.height = 1;\r\n    const ctx = canvas.getContext('2d');\r\n    ctx && ctx.clearRect(0, 0, 1, 1);\r\n}\r\n\r\n/**\r\n * Determine bounding box that describes all pixels which are not fully transparent.\r\n * Returns null if empty.\r\n *\r\n * @param context\r\n */\r\nexport function canvasBounds (context: CanvasRenderingContext2D): IRect | null {\r\n    const boundsObj: {\r\n        x: number;\r\n        y: number;\r\n        width: number;\r\n        height: number;\r\n    } = { x: 0, y: 0, width: 0, height: 0 };\r\n    {\r\n        const tempBounds: TNullable<IBounds> = {\r\n            x1: null,\r\n            y1: null,\r\n            x2: null,\r\n            y2: null,\r\n        };\r\n        const imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\r\n\r\n        if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\r\n            tempBounds.x1 = 0;\r\n            tempBounds.y1 = 0;\r\n            tempBounds.x2 = context.canvas.width - 1;\r\n            tempBounds.y2 = context.canvas.height - 1;\r\n        } else {\r\n            for (let i = 3; i < imdat.data.length; i += 4) {\r\n                if (imdat.data[i] > 0 ) {\r\n                    const x = ((i - 3) / 4) %  context.canvas.width;\r\n                    const y = Math.floor((i - 3) / 4 / context.canvas.width);\r\n                    if (tempBounds.x1 === null || tempBounds.x1 > x) {\r\n                        tempBounds.x1 = x;\r\n                    }\r\n                    if (tempBounds.y1 === null) {\r\n                        tempBounds.y1 = y;\r\n                    }\r\n                    if (tempBounds.x2 === null || tempBounds.x2 < x) {\r\n                        tempBounds.x2 = x;\r\n                    }\r\n                    if (tempBounds.y2 === null || tempBounds.y2 < y) {\r\n                        tempBounds.y2 = y;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (tempBounds.x1 === null || tempBounds.y1 === null || tempBounds.x2 === null || tempBounds.y2 === null) {\r\n            return null;\r\n        }\r\n        boundsObj.x = tempBounds.x1;\r\n        boundsObj.y = tempBounds.y1;\r\n        boundsObj.width = tempBounds.x2! - tempBounds.x1 + 1;\r\n        boundsObj.height = tempBounds.y2! - tempBounds.y1 + 1;\r\n    }\r\n    return boundsObj;\r\n}","/*window['canvases'] = [];\r\n\r\nwindow['printCanvases'] = () => {\r\n    let total = 0;\r\n\r\n    console.log(window['canvases'].map(item => {\r\n        total += item.width * item.height;\r\n        return {w: item.width, h: item.height};\r\n    }));\r\n\r\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\r\n};*/\r\n\r\nexport function createCanvas (w?: number, h?: number): HTMLCanvasElement {\r\n    const result = document.createElement('canvas');\r\n    if (w && h) {\r\n        result.width = w;\r\n        result.height = h;\r\n    }\r\n    // window['canvases'].push(result);\r\n    return result;\r\n}","\r\n// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\r\n// not optimized\r\n\r\ntype TMatrix4x4 = [\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n];\r\n\r\ntype TVec4 = [number, number, number, number];\r\n\r\nfunction getIdentity (): TMatrix4x4 {\r\n    return [\r\n        1, 0, 0, 0,\r\n        0, 1, 0, 0,\r\n        0, 0, 1, 0,\r\n        0, 0, 0, 1,\r\n    ];\r\n}\r\n\r\n// point  matrix\r\nfunction multiplyMatrixAndPoint (matrix: TMatrix4x4, point: TVec4): TVec4 {\r\n    return [\r\n        (point[0] * matrix[0]) + (point[1] * matrix[4]) + (point[2] * matrix[8]) + (point[3] * matrix[12]), // x\r\n        (point[0] * matrix[1]) + (point[1] * matrix[5]) + (point[2] * matrix[9]) + (point[3] * matrix[13]), // y\r\n        (point[0] * matrix[2]) + (point[1] * matrix[6]) + (point[2] * matrix[10]) + (point[3] * matrix[14]), // z\r\n        (point[0] * matrix[3]) + (point[1] * matrix[7]) + (point[2] * matrix[11]) + (point[3] * matrix[15]), // w\r\n    ];\r\n}\r\n\r\n//matrixB  matrixA\r\nfunction multiplyMatrices (matrixA: TMatrix4x4, matrixB: TMatrix4x4): TMatrix4x4 {\r\n\r\n    // Slice the second matrix up into rows\r\n    const row0: TVec4 = [matrixB[0], matrixB[1], matrixB[2], matrixB[3]];\r\n    const row1: TVec4 = [matrixB[4], matrixB[5], matrixB[6], matrixB[7]];\r\n    const row2: TVec4 = [matrixB[8], matrixB[9], matrixB[10], matrixB[11]];\r\n    const row3: TVec4 = [matrixB[12], matrixB[13], matrixB[14], matrixB[15]];\r\n\r\n    // Multiply each row by matrixA\r\n    const result0 = multiplyMatrixAndPoint(matrixA, row0);\r\n    const result1 = multiplyMatrixAndPoint(matrixA, row1);\r\n    const result2 = multiplyMatrixAndPoint(matrixA, row2);\r\n    const result3 = multiplyMatrixAndPoint(matrixA, row3);\r\n\r\n    // Turn the result rows back into a single matrix\r\n    return [\r\n        result0[0], result0[1], result0[2], result0[3],\r\n        result1[0], result1[1], result1[2], result1[3],\r\n        result2[0], result2[1], result2[2], result2[3],\r\n        result3[0], result3[1], result3[2], result3[3],\r\n    ];\r\n}\r\n\r\nfunction createTranslationMatrix (x: number, y: number): TMatrix4x4 {\r\n    return [\r\n        1, 0, 0, 0,\r\n        0, 1, 0, 0,\r\n        0, 0, 1, 0,\r\n        x, y, 0, 1,\r\n    ];\r\n}\r\n\r\nfunction createRotationMatrix (angleRad: number): TMatrix4x4 {\r\n    //let angleRad = angleDeg / 360 * 2 * Math.PI;\r\n    return [\r\n        Math.cos(-angleRad), -Math.sin(-angleRad), 0, 0,\r\n        Math.sin(-angleRad), Math.cos(-angleRad), 0, 0,\r\n        0, 0, 1, 0,\r\n        0, 0, 0, 1,\r\n    ];\r\n}\r\n\r\nfunction createScaleMatrix (f: number): TMatrix4x4 {\r\n    return [\r\n        f, 0, 0, 0,\r\n        0, f, 0, 0,\r\n        0, 0, 1, 0,\r\n        0, 0, 0, 1,\r\n    ];\r\n}\r\n\r\nexport const Matrix = Object.freeze({\r\n    getIdentity,\r\n    multiplyMatrixAndPoint,\r\n    multiplyMatrices,\r\n    createTranslationMatrix,\r\n    createRotationMatrix,\r\n    createScaleMatrix,\r\n});\r\n","import {IVector2D} from '../bb-types';\r\n\r\nexport const Vec2 = {\r\n    add: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x + p2.x, y: p1.y + p2.y};\r\n    },\r\n    sub: function (p1: IVector2D, p2: IVector2D): IVector2D {\r\n        return {x: p1.x - p2.x, y: p1.y - p2.y};\r\n    },\r\n    nor: function (p: IVector2D): IVector2D {\r\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n        return {x: p.x / len, y: p.y / len};\r\n    },\r\n    len: function (p: IVector2D): number {\r\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\r\n    },\r\n    dist: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Vec2.len(Vec2.sub(p1, p2));\r\n    },\r\n    mul: function (p: IVector2D, s: number): IVector2D {\r\n        return {x: p.x * s, y: p.y * s};\r\n    },\r\n    angle: function (p1: IVector2D, p2: IVector2D): number {\r\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\r\n    },\r\n    dot: function (a: IVector2D, b: IVector2D): number {\r\n        const aArr = [a.x, a.y];\r\n        const bArr = [b.x, b.y];\r\n        return aArr.map((x, i) => aArr[i] * bArr[i]).reduce((m, n) => m + n);\r\n    },\r\n};","import {Vec2} from './vec2';\r\nimport {clamp, dist, mix, pointsToAngleDeg} from './math';\r\nimport {IVector2D} from '../bb-types';\r\nimport {copyObj} from '../base/base';\r\n\r\n/**\r\n * project p onto line\r\n * @param lineStart\r\n * @param lineEnd\r\n * @param p\r\n */\r\nexport const projectPointOnLine = function (lineStart: IVector2D, lineEnd: IVector2D, p: IVector2D): IVector2D {\r\n    let x, y;\r\n    if (lineStart.x === lineEnd.x) {\r\n        x = lineStart.x;\r\n        y = p.y;\r\n\r\n        return {\r\n            x: x,\r\n            y: y,\r\n        };\r\n    }\r\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\r\n    const b = lineStart.y - (m * lineStart.x);\r\n\r\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\r\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\r\n\r\n    return {\r\n        x: x,\r\n        y: y,\r\n    };\r\n};\r\n\r\n\r\n/**\r\n * Operations on a line made up of points\r\n */\r\nexport class PointLine {\r\n\r\n    private readonly segmentArr: {\r\n        x: number;\r\n        y: number;\r\n        length: number; // last is 0\r\n    }[];\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            points: IVector2D[];\r\n        }\r\n    ) {\r\n        this.segmentArr = [];\r\n\r\n        for (let i = 0; i < p.points.length; i++) {\r\n            ((i) => {\r\n                let length = 0;\r\n                if (i < p.points.length - 1) {\r\n                    length = dist(p.points[i].x, p.points[i].y, p.points[i + 1].x, p.points[i + 1].y);\r\n                }\r\n                this.segmentArr[i] = {\r\n                    x: p.points[i].x,\r\n                    y: p.points[i].y,\r\n                    length: length,\r\n                };\r\n            })(i);\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    /**\r\n     * returns point when traveling *dist* along the line, > 0\r\n     * @param dist\r\n     */\r\n    getAtDist (dist: number): IVector2D {\r\n        let remainder = Math.min(this.getLength(), dist);\r\n        let i = 0;\r\n\r\n        for (; remainder > this.segmentArr[i].length && i < this.segmentArr.length - 2; i++) {\r\n            remainder -= this.segmentArr[i].length;\r\n        }\r\n\r\n        const fac = Math.min(1, Math.max(0, remainder / this.segmentArr[i].length));\r\n\r\n        return {\r\n            x: (this.segmentArr[i].x * (1 - fac) + this.segmentArr[i + 1].x * fac),\r\n            y: (this.segmentArr[i].y * (1 - fac) + this.segmentArr[i + 1].y * fac),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * total length of line\r\n     */\r\n    getLength (): number {\r\n        let result = 0;\r\n        for (let i = 0; i < this.segmentArr.length - 1; i++) {\r\n            result += this.segmentArr[i].length;\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\ntype TBezierLineCallback = (\r\n    v: {\r\n        x: number;\r\n        y: number;\r\n        t: number; // [0, 1] - how far along\r\n        angle?: number;\r\n        dAngle: number;\r\n    }\r\n) => void;\r\ntype TBezierLineControlsCallback = (\r\n    v: {\r\n        p1: IVector2D;\r\n        p2: IVector2D;\r\n        p3: IVector2D;\r\n        p4: IVector2D;\r\n    }\r\n) => void;\r\n\r\n/**\r\n * Each instance is one line made up of bezier interpolated segments.\r\n * You feed it points. It calculates control points on its own, and the resulting curve.\r\n */\r\nexport class BezierLine {\r\n\r\n    private readonly pointArr: {\r\n        x: number;\r\n        y: number;\r\n        spacing: number;\r\n        dir: IVector2D;\r\n    }[];\r\n    private lastDot: number = 0;\r\n    private lastPoint: IVector2D | undefined;\r\n    private lastCallbackPoint: IVector2D | undefined;\r\n    private lastAngle: number | undefined;\r\n    private lastSpacing: number | null = null;\r\n\r\n    /**\r\n     * creates bezier curve from control points\r\n     * @param p1 - control point 1 {x: float, y: float}\r\n     * @param p2 - control point 2 {x: float, y: float}\r\n     * @param p3 - control point 3 {x: float, y: float}\r\n     * @param p4 - control point 4 {x: float, y: float}\r\n     * @param resolution - int\r\n     * @returns bezier curve made up of points {x: float, y: float}\r\n     */\r\n    private getBezierPoints (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D, resolution: number): IVector2D[] {\r\n        const curvePoints = [];\r\n        let t;\r\n        for (let i = 0; i <= resolution; i++) {\r\n            t = i / resolution;\r\n            curvePoints[curvePoints.length] = {\r\n                x: Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x,\r\n                y: Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y,\r\n            };\r\n        }\r\n        return curvePoints;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor () {\r\n        this.pointArr = [];\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    /**\r\n     * Add new point to line. \"Drawn\" line will go until the previous point.\r\n     *\r\n     * @param x - coord of new point\r\n     * @param y\r\n     * @param spacing - space between each step\r\n     * @param callback - calls for each step\r\n     * @param controlsCallback - calls that callback with the bezier control points\r\n     */\r\n    add (\r\n        x: number,\r\n        y: number,\r\n        spacing: number,\r\n        callback?: TBezierLineCallback,\r\n        controlsCallback?: TBezierLineControlsCallback,\r\n    ): void {\r\n        if (this.lastPoint && x === this.lastPoint.x && y === this.lastPoint.y) {\r\n            return;\r\n        }\r\n        this.lastPoint = {x, y};\r\n        this.pointArr[this.pointArr.length] = {\r\n            x,\r\n            y,\r\n            spacing,\r\n        };\r\n\r\n        //calculate directions\r\n        if (this.pointArr.length === 1) {\r\n            this.lastSpacing = spacing;\r\n            return;\r\n        } else if (this.pointArr.length === 2) {\r\n            this.pointArr[0].dir = Vec2.nor(Vec2.sub(this.pointArr[1], this.pointArr[0]));\r\n            this.lastDot = spacing;\r\n            this.lastSpacing = spacing;\r\n            return;\r\n        } else {\r\n            const pointM1 = this.pointArr[this.pointArr.length - 1];\r\n            const pointM2 = this.pointArr[this.pointArr.length - 2];\r\n            const pointM3 = this.pointArr[this.pointArr.length - 3];\r\n            pointM2.dir = Vec2.nor(Vec2.sub(pointM1, pointM3));\r\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) {\r\n                //when xy -3 == -1\r\n                pointM2.dir = copyObj(pointM3.dir);\r\n            }\r\n        }\r\n\r\n        //get bezier curve\r\n        const a = this.pointArr[this.pointArr.length - 3];\r\n        const b = this.pointArr[this.pointArr.length - 2];\r\n        const p1 = a;\r\n        const p2 = Vec2.add(a, Vec2.mul(a.dir, Vec2.dist(a, b) / 4));\r\n        const p3 = Vec2.sub(b, Vec2.mul(b.dir, Vec2.dist(a, b) / 4));\r\n        const p4 = b;\r\n\r\n\r\n        let pointLine: PointLine;\r\n        if (callback) {\r\n            const curvePoints = this.getBezierPoints(p1, p2, p3, p4, 20);\r\n            pointLine = new PointLine({points: curvePoints});\r\n        } else {\r\n            pointLine = new PointLine({points: [p1, p4]});\r\n        }\r\n\r\n        //iterate over curve with spacing and callback\r\n        const len = pointLine.getLength();\r\n        let tempSpacing = mix(this.lastSpacing!, spacing, clamp(this.lastDot / len, 0, 1));\r\n        let d = this.lastDot;\r\n        for (; d <= len; d += tempSpacing) {\r\n            tempSpacing = mix(this.lastSpacing!, spacing, clamp(d / len, 0, 1));\r\n            const point = pointLine.getAtDist(d);\r\n            const angle = this.lastCallbackPoint ? pointsToAngleDeg(this.lastCallbackPoint, point) : undefined;\r\n            if (callback) {\r\n                callback({\r\n                    x: point.x,\r\n                    y: point.y,\r\n                    t: d / len,\r\n                    angle: angle,\r\n                    dAngle: this.lastCallbackPoint ? angle! - this.lastAngle! : 0,\r\n                });\r\n            }\r\n            this.lastCallbackPoint = point;\r\n            this.lastAngle = angle;\r\n        }\r\n\r\n        if (callback) {\r\n            this.lastDot = d - len;\r\n        } else {\r\n            this.lastDot = 0;\r\n            controlsCallback && controlsCallback({p1: p1, p2: p2, p3: p3, p4: p4});\r\n        }\r\n\r\n        this.lastSpacing = spacing;\r\n    }\r\n\r\n    addFinal (\r\n        spacing: number,\r\n        callback?: TBezierLineCallback,\r\n        controlsCallback?: TBezierLineControlsCallback,\r\n    ): void {\r\n        if (this.pointArr.length < 2) {\r\n            return;\r\n        }\r\n\r\n        const p1 = this.pointArr[this.pointArr.length - 2];\r\n        const p2 = this.pointArr[this.pointArr.length - 1];\r\n\r\n        const newP = Vec2.add(p2, Vec2.sub(p2, p1));\r\n\r\n        this.add(newP.x, newP.y, spacing, callback, controlsCallback);\r\n    }\r\n}\r\n\r\n/**\r\n * from SplineInterpolator.cs in the Paint.NET source code\r\n */\r\nexport class SplineInterpolator {\r\n\r\n    private readonly xa: number[];\r\n    private readonly ya: number[];\r\n    private readonly u: number[];\r\n    private readonly y2: number[];\r\n    private readonly first: number;\r\n    private readonly last: number;\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        points: [number, number][],\r\n    ) {\r\n        const n = points.length;\r\n        this.xa = [];\r\n        this.ya = [];\r\n        this.u = [];\r\n        this.y2 = [];\r\n        let i;\r\n\r\n        this.first = points[0][0];\r\n        this.last = points[points.length - 1][0];\r\n\r\n        points.sort(function (a, b) {\r\n            return a[0] - b[0];\r\n        });\r\n        for (i = 0; i < n; i++) {\r\n            this.xa.push(points[i][0]);\r\n            this.ya.push(points[i][1]);\r\n        }\r\n\r\n        this.u[0] = 0;\r\n        this.y2[0] = 0;\r\n\r\n        for (i = 1; i < n - 1; ++i) {\r\n            // This is the decomposition loop of the tridiagonal algorithm.\r\n            // y2 and u are used for temporary storage of the decomposed factors.\r\n            const wx = this.xa[i + 1] - this.xa[i - 1];\r\n            const sig = (this.xa[i] - this.xa[i - 1]) / wx;\r\n            const p = sig * this.y2[i - 1] + 2.0;\r\n\r\n            this.y2[i] = (sig - 1.0) / p;\r\n\r\n            const ddydx =\r\n                (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\r\n                (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\r\n\r\n            this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\r\n        }\r\n\r\n        this.y2[n - 1] = 0;\r\n\r\n        // This is the backsubstitution loop of the tridiagonal algorithm\r\n        for (i = n - 2; i >= 0; --i) {\r\n            this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getFirstX (): number {\r\n        return this.first;\r\n    }\r\n\r\n    getLastX (): number {\r\n        return this.last;\r\n    }\r\n\r\n    interpolate (x: number): number {\r\n        const n = this.ya.length;\r\n        let klo = 0;\r\n        let khi = n - 1;\r\n\r\n        // We will find the right place in the table by means of\r\n        // bisection. This is optimal if sequential calls to this\r\n        // routine are at random values of x. If sequential calls\r\n        // are in order, and closely spaced, one would do better\r\n        // to store previous values of klo and khi.\r\n        while (khi - klo > 1) {\r\n            const k = (khi + klo) >> 1;\r\n\r\n            if (this.xa[k] > x) {\r\n                khi = k;\r\n            } else {\r\n                klo = k;\r\n            }\r\n        }\r\n\r\n        const h = this.xa[khi] - this.xa[klo];\r\n        const a = (this.xa[khi] - x) / h;\r\n        const b = (x - this.xa[klo]) / h;\r\n\r\n        // Cubic spline polynomial is now evaluated.\r\n        return a * this.ya[klo] + b * this.ya[khi] +\r\n            ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\r\n    }\r\n\r\n    /**\r\n     * find x to y. simply by stepping through. suboptimal, so don't call often.\r\n     * searches in x 0-1 range\r\n     */\r\n    findX (y: number, resolution: number): number | null {\r\n        let x = null;\r\n        let dist = null;\r\n        for (let i = 0; i <= resolution; i++) {\r\n            const tempX = i / resolution;\r\n            const tempY = this.interpolate(tempX);\r\n            if (x === null) {\r\n                x = tempX;\r\n                dist = Math.abs(tempY - y);\r\n                continue;\r\n            }\r\n\r\n            const tempDist = Math.abs(tempY - y);\r\n\r\n            if (tempDist < dist) {\r\n                x = tempX;\r\n                dist = tempDist;\r\n            } else {\r\n                //distance increasing\r\n                break;\r\n            }\r\n        }\r\n        return x;\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * input for a spline, following curve of quadratic function x^2 [0 - 1]\r\n * returns [[0, startVal], ..., [1, endVal]]\r\n * @param startVal\r\n * @param endVal\r\n * @param stepSize\r\n */\r\nexport function quadraticSplineInput (\r\n    startVal: number,\r\n    endVal: number,\r\n    stepSize: number,\r\n): [number, number][] {\r\n    function round (v: number, dec: number): number {\r\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\r\n    }\r\n\r\n    const resultArr: [number, number][] = [];\r\n    for (let i = 0; i <= 1; i += stepSize) {\r\n        resultArr.push([round(i, 4), round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)]);\r\n    }\r\n    return resultArr;\r\n}","\r\n\r\n\r\n// based on js color conversion http://www.webtoolkit.info/\r\n\r\n\r\nexport class HSV {\r\n    h: number;\r\n    s: number;\r\n    v: number;\r\n    constructor (h: number, s: number, v: number) {\r\n        this.h = Math.max(0, Math.min(360, h));\r\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\r\n        this.v = Math.max(0, Math.min(100, v));\r\n    }\r\n}\r\n\r\nexport class RGB {\r\n    r : number;\r\n    g: number;\r\n    b: number;\r\n    constructor (r: number, g: number, b: number) {\r\n        this.r = Math.max(0, Math.min(255, r));\r\n        this.g = Math.max(0, Math.min(255, g));\r\n        this.b = Math.max(0, Math.min(255, b));\r\n    }\r\n}\r\n\r\nexport class CMYK {\r\n    c: number;\r\n    m: number;\r\n    y: number;\r\n    k: number;\r\n    constructor (c: number, m: number, y: number, k: number) {\r\n        this.c = Math.max(0, Math.min(100, c));\r\n        this.m = Math.max(0, Math.min(100, m));\r\n        this.y = Math.max(0, Math.min(100, y));\r\n        this.k = Math.max(0, Math.min(100, k));\r\n    }\r\n}\r\n\r\nexport const ColorConverter = {\r\n\r\n    _RGBtoHSV: function (RGB: RGB): HSV {\r\n        const result = new HSV(0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        const minVal = Math.min(r, g, b);\r\n        const maxVal = Math.max(r, g, b);\r\n        const delta = maxVal - minVal;\r\n\r\n        result.v = maxVal;\r\n\r\n        if (delta == 0) {\r\n            result.h = 0;\r\n            result.s = 0;\r\n        } else {\r\n            result.s = delta / maxVal;\r\n            const del_R = (((maxVal - r) / 6) + (delta / 2)) / delta;\r\n            const del_G = (((maxVal - g) / 6) + (delta / 2)) / delta;\r\n            const del_B = (((maxVal - b) / 6) + (delta / 2)) / delta;\r\n\r\n            if (r == maxVal) {\r\n                result.h = del_B - del_G;\r\n            } else if (g == maxVal) {\r\n                result.h = (1 / 3) + del_R - del_B;\r\n            } else if (b == maxVal) {\r\n                result.h = (2 / 3) + del_G - del_R;\r\n            }\r\n\r\n            if (result.h < 0) {\r\n                result.h += 1;\r\n            }\r\n            if (result.h > 1) {\r\n                result.h -= 1;\r\n            }\r\n        }\r\n\r\n        result.h = Math.round(result.h * 360);\r\n        result.s = Math.round(result.s * 100);\r\n        result.v = Math.round(result.v * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    _HSVtoRGB: function (HSV: HSV): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\r\n\r\n        const h = (HSV.h / 360) % 1;\r\n        const s = HSV.s / 100;\r\n        const v = HSV.v / 100;\r\n\r\n        if (s == 0) {\r\n            result.r = v * 255;\r\n            result.g = v * 255;\r\n            result.b = v * 255;\r\n        } else {\r\n            var_h = h * 6;\r\n            var_i = Math.floor(var_h);\r\n            var_1 = v * (1 - s);\r\n            var_2 = v * (1 - s * (var_h - var_i));\r\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\r\n\r\n            if (var_i == 0) {\r\n                var_r = v;\r\n                var_g = var_3;\r\n                var_b = var_1;\r\n            } else if (var_i == 1) {\r\n                var_r = var_2;\r\n                var_g = v;\r\n                var_b = var_1;\r\n            } else if (var_i == 2) {\r\n                var_r = var_1;\r\n                var_g = v;\r\n                var_b = var_3;\r\n            } else if (var_i == 3) {\r\n                var_r = var_1;\r\n                var_g = var_2;\r\n                var_b = v;\r\n            } else if (var_i == 4) {\r\n                var_r = var_3;\r\n                var_g = var_1;\r\n                var_b = v;\r\n            } else {\r\n                var_r = v;\r\n                var_g = var_1;\r\n                var_b = var_2;\r\n            }\r\n\r\n            result.r = var_r * 255;\r\n            result.g = var_g * 255;\r\n            result.b = var_b * 255;\r\n\r\n            result.r = Math.round(result.r);\r\n            result.g = Math.round(result.g);\r\n            result.b = Math.round(result.b);\r\n        }\r\n\r\n        return result;\r\n    },\r\n\r\n    _CMYKtoRGB: function (CMYK: CMYK): RGB {\r\n        const result = new RGB(0, 0, 0);\r\n\r\n        const c = CMYK.c / 100;\r\n        const m = CMYK.m / 100;\r\n        const y = CMYK.y / 100;\r\n        const k = CMYK.k / 100;\r\n\r\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\r\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\r\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\r\n\r\n        result.r = Math.round(result.r * 255);\r\n        result.g = Math.round(result.g * 255);\r\n        result.b = Math.round(result.b * 255);\r\n\r\n        return result;\r\n    },\r\n\r\n    _RGBtoCMYK: function (RGB: RGB): CMYK {\r\n        const result = new CMYK(0, 0, 0, 0);\r\n\r\n        const r = RGB.r / 255;\r\n        const g = RGB.g / 255;\r\n        const b = RGB.b / 255;\r\n\r\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\r\n        result.c = (1 - r - result.k) / (1 - result.k);\r\n        result.m = (1 - g - result.k) / (1 - result.k);\r\n        result.y = (1 - b - result.k) / (1 - result.k);\r\n\r\n        result.c = Math.round(result.c * 100);\r\n        result.m = Math.round(result.m * 100);\r\n        result.y = Math.round(result.y * 100);\r\n        result.k = Math.round(result.k * 100);\r\n\r\n        return result;\r\n    },\r\n\r\n    toRGB: function (o: RGB | HSV | CMYK): RGB {\r\n        if (o instanceof RGB) {\r\n            return o;\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._HSVtoRGB(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._CMYKtoRGB(o);\r\n        }\r\n    },\r\n\r\n    toHSV: function (o: RGB | HSV | CMYK): HSV {\r\n        if (o instanceof HSV) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoHSV(o);\r\n        }\r\n        if (o instanceof CMYK) {\r\n            return this._RGBtoHSV(this._CMYKtoRGB(o));\r\n        }\r\n    },\r\n\r\n    toCMYK: function (o: RGB | HSV | CMYK): CMYK {\r\n        if (o instanceof CMYK) {\r\n            return o;\r\n        }\r\n        if (o instanceof RGB) {\r\n            return this._RGBtoCMYK(o);\r\n        }\r\n        if (o instanceof HSV) {\r\n            return this._RGBtoCMYK(this._HSVtoRGB(o));\r\n        }\r\n    },\r\n    toHexString: function (o: RGB): string {\r\n        if (o instanceof RGB || ('r' in o && 'g' in o && 'b' in o)) {\r\n            let ha = (parseInt('' + o.r)).toString(16);\r\n            let hb = (parseInt('' + o.g)).toString(16);\r\n            let hc = (parseInt('' + o.b)).toString(16);\r\n            if (ha.length == 1) {\r\n                ha = '0' + ha;\r\n            }\r\n            if (hb.length == 1) {\r\n                hb = '0' + hb;\r\n            }\r\n            if (hc.length == 1) {\r\n                hc = '0' + hc;\r\n            }\r\n            return ha + hb + hc;\r\n        }\r\n    },\r\n    toRgbStr: function (rgbObj: {r: number; g: number; b: number}): string {\r\n        return 'rgb(' + Math.round(rgbObj.r) + ', ' + Math.round(rgbObj.g) + ', ' + Math.round(rgbObj.b) + ')';\r\n    },\r\n    toRgbaStr: function (rgbaObj: {r: number; g: number; b: number; a: number}): string {\r\n        return 'rgba(' + Math.round(rgbaObj.r) + ', ' + Math.round(rgbaObj.g) + ', ' + Math.round(rgbaObj.b) + ', ' + rgbaObj.a + ')';\r\n    },\r\n    hexToRGB: function (hexStr: string): RGB | null {\r\n        hexStr = hexStr.trim();\r\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\r\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n        hexStr = hexStr.replace(shorthandRegex, function (m, r, g, b) {\r\n            return r + r + g + g + b + b;\r\n        });\r\n\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\r\n        return result ? new RGB(\r\n            parseInt(result[1], 16),\r\n            parseInt(result[2], 16),\r\n            parseInt(result[3], 16)\r\n        ) : null;\r\n    },\r\n\r\n};\r\n\r\nexport function testIsWhiteBestContrast (rgbObj: {r: number; g: number; b: number}): boolean {\r\n    return (rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114) < 125;\r\n}","import {css} from './base';\r\nimport {BB} from '../bb';\r\nimport {IKeyStringOptional} from '../bb-types';\r\n\r\n\r\nexport function appendTextDiv (target: HTMLElement, text: string): HTMLDivElement {\r\n    const div = document.createElement('div');\r\n    div.innerHTML = text;\r\n    target.append(div);\r\n    return div;\r\n}\r\n\r\n/**\r\n * Is an input element focused.\r\n * Set attribute \"data-ignore-focus\" to \"true\" if its focus should be ignored.\r\n *\r\n * @param getAll - check all, even those with \"data-ignore-focus\" = \"true\"\r\n */\r\nexport function isInputFocused (getAll: boolean = false): boolean {\r\n    const result = !!(document.activeElement && ['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName));\r\n    if (getAll) {\r\n        return result;\r\n    } else {\r\n        return result && !document.activeElement?.getAttribute('data-ignore-focus');\r\n    }\r\n}\r\n\r\nexport function unfocusAnyInput (): void {\r\n    if (isInputFocused(true)) {\r\n        /*\r\n            Unfocus anything that is focused.\r\n\r\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\r\n            that isn't its direct parent, then Firefox will keep anything attached to this\r\n            Input in memory. It will not be garbage collected until a new Input is focused.\r\n\r\n            Workaround: Temporarily create an input, focus it, detach it.\r\n             */\r\n        const focusEl = BB.el({\r\n            parent: document.body,\r\n            tagName: 'input',\r\n            css: {\r\n                opacity: '0',\r\n                width: '0',\r\n                height: '0',\r\n            },\r\n        }) as HTMLInputElement;\r\n        setTimeout(() => {\r\n            focusEl.select();\r\n            focusEl.focus();\r\n            focusEl.parentNode.removeChild(focusEl);\r\n        }, 10);\r\n    }\r\n}\r\n\r\n/**\r\n * clears text selection in window\r\n */\r\nexport function clearSelection (): void {\r\n    if (window.getSelection) {\r\n        const sel = window.getSelection();\r\n        if (sel) {\r\n            if (sel.empty) {\r\n                sel.empty();\r\n            } else if (sel.removeAllRanges) {\r\n                sel.removeAllRanges();\r\n            }\r\n        }\r\n    } else if ('selection' in document) {\r\n        (document as any).selection.empty();\r\n    }\r\n}\r\n\r\n/**\r\n * prevents being able to focus element.\r\n * warning: it creates a listener\r\n *\r\n * @param el - dom element\r\n */\r\nexport const makeUnfocusable = (function () {\r\n\r\n    function preventFocus (event: MouseEvent) {\r\n        event.preventDefault();\r\n        let didFocusRelated = false;\r\n        if (event.relatedTarget) {\r\n            try {\r\n                (event.relatedTarget as HTMLElement).focus();\r\n                didFocusRelated = true;\r\n            } catch(e) {\r\n                console.error('failed to focus');\r\n            }\r\n        }\r\n        if (!didFocusRelated) {\r\n            (event.currentTarget as HTMLElement).blur();\r\n        }\r\n    }\r\n\r\n    return function (el) {\r\n        el.setAttribute('tabindex', '-1');\r\n        el.addEventListener('focus', preventFocus);\r\n    };\r\n})();\r\n\r\n\r\nconst els: {\r\n    el: HTMLElement;\r\n    listeners: [string, any][];\r\n}[] = [];\r\n// window['els'] = els;\r\n\r\n/**\r\n *\r\n * Create DOM element - div by default\r\n * params = {\r\n * \t    parent: someOtherDiv,\r\n * \t    css: {\r\n * \t\t    width: \"500px\",\r\n * \t\t    backgroundColor: \"#fff\"\r\n * \t    },\r\n * \t    content: \"test\", //or  content: [divA, divB, divC]   or content: someDiv\r\n * \t    className: \"bla\",\r\n *      id: \"bla\"\r\n * }\r\n *\r\n *  If onClick or onChange is used, then BB.destroyEl MUST be called\r\n *  to prevent a memory leak.\r\n *\r\n * @param params\r\n */\r\nexport function el (\r\n    params?: {\r\n        parent?: HTMLElement;\r\n        css?: IKeyStringOptional;\r\n        custom?: { [key: string]: any };\r\n        content?: string | (HTMLElement | string | undefined)[] | Element;\r\n        textContent?: string;\r\n        className?: string;\r\n        title?: string;\r\n        id?: string;\r\n        tagName?: string;\r\n        onClick?: (e: MouseEvent) => void;\r\n        onChange?: (e: Event) => void;\r\n    }\r\n): HTMLElement {\r\n    if (!params) {\r\n        return document.createElement('div');\r\n    }\r\n    const div = document.createElement(params.tagName ? params.tagName : 'div');\r\n    params.css && css(div, params.css);\r\n\r\n    if (params.content) {\r\n        if (typeof params.content === typeof 'aa') {\r\n            div.innerHTML = params.content as string;\r\n\r\n        } else if (Array.isArray(params.content)) {\r\n            BB.append(div, params.content);\r\n\r\n        } else {\r\n            div.append(params.content as HTMLElement);\r\n\r\n        }\r\n    }\r\n    if (params.textContent) {\r\n        div.textContent = params.textContent;\r\n    }\r\n    if (params.className) {\r\n        div.className = params.className;\r\n    }\r\n    if (params.id) {\r\n        div.id = params.id;\r\n    }\r\n    if (params.parent) {\r\n        params.parent.append(div);\r\n    }\r\n    if ('title' in params && params.title !== undefined) {\r\n        div.title = params.title;\r\n    }\r\n    const listeners = [];\r\n    if ('onClick' in params) {\r\n        div.addEventListener('click', params.onClick);\r\n        listeners.push(['click', params.onClick]);\r\n    }\r\n    if ('onChange' in params) {\r\n        div.addEventListener('change', params.onChange);\r\n        listeners.push(['change', params.onChange]);\r\n    }\r\n    if (listeners.length > 0) {\r\n        els.push({\r\n            el: div,\r\n            listeners,\r\n        });\r\n        /*div.style.backgroundColor = '#ff0';\r\n        div.style.border = '1px solid #ff0';*/\r\n    }\r\n    if ('custom' in params && params.custom) {\r\n        const customKeyArr = Object.keys(params.custom);\r\n        for (let i = 0; i < customKeyArr.length; i++) {\r\n            div.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\r\n        }\r\n    }\r\n    return div;\r\n}\r\n\r\n/**\r\n * removes event listeners for Elements created via el()\r\n * @param el\r\n */\r\nexport function destroyEl (el?: HTMLElement) {\r\n    if (!el) {\r\n        return;\r\n    }\r\n    for (let i = 0; i < els.length; i++) {\r\n        const item = els[i];\r\n        if (item.el === el) {\r\n            item.listeners.forEach(item => {\r\n                el.removeEventListener(item[0], item[1]);\r\n            });\r\n            els.splice(i, 1);\r\n            return;\r\n        }\r\n    }\r\n    // not found\r\n    return;\r\n}\r\n","\r\ntype TLogListener = (msg: any) => void;\r\n\r\nexport class BbLog {\r\n\r\n    private static listeners: TLogListener[] = [];\r\n\r\n    constructor () {\r\n    }\r\n\r\n    static subscribe (listener: TLogListener): void {\r\n        if (BbLog.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        BbLog.listeners.push(listener);\r\n    }\r\n\r\n    static unsubscribe (listener: TLogListener): void {\r\n        for (let i = 0; i < BbLog.listeners.length; i++) {\r\n            if (listener === BbLog.listeners[i]) {\r\n                BbLog.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    static emit (msg: any): void {\r\n        BbLog.listeners.forEach(item => {\r\n            item(msg);\r\n        });\r\n    }\r\n}","/**\r\n * LocalStorage wrapper that does not throw exceptions.\r\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\r\n */\r\nexport class LocalStorage {\r\n\r\n    private static error;\r\n\r\n    static getItem (key: string): string {\r\n        let result = null;\r\n        try {\r\n            result = localStorage.getItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    static setItem (key: string, value: string): void {\r\n        try {\r\n            localStorage.setItem(key, value);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static removeItem (key: string): void {\r\n        try {\r\n            localStorage.removeItem(key);\r\n        } catch (e) {\r\n            this.error = e;\r\n        }\r\n    }\r\n\r\n    static getError (): any {\r\n        return this.error;\r\n    }\r\n}","import {IPointerEvent} from '../event.types';\r\nimport {copyObj} from '../../base/base';\r\n\r\nexport interface ICoalescedPointerEvent extends IPointerEvent {\r\n    isCoalesced?: true;\r\n}\r\n\r\n/**\r\n * A ChainElement. Splits up coalesced events into their own pointermove events. Otherwise regular pass through.\r\n *\r\n * in: IPointerEvent\r\n * out: IPointerEvent with property isCoalesced: boolean\r\n *\r\n * todo: eventPreventDefault and eventStopPropagation are broken events w coalesced events. (because of json parse json stringify)\r\n * but how could that even work?\r\n */\r\nexport class CoalescedExploder {\r\n\r\n    private chainOut: ((e: ICoalescedPointerEvent) => void) | undefined;\r\n\r\n    // ---- public ----\r\n\r\n    setChainOut (func: (e: ICoalescedPointerEvent) => void) {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (event.coalescedArr && event.coalescedArr.length > 0) {\r\n                for (let i = 0; i < event.coalescedArr.length; i++) {\r\n                    const eventCopy: ICoalescedPointerEvent = copyObj(event);\r\n                    if (i === 0) {\r\n                        eventCopy.coalescedArr = [];\r\n                    }\r\n                    const coalescedItem = event.coalescedArr[i];\r\n\r\n                    eventCopy.pageX = coalescedItem.pageX;\r\n                    eventCopy.pageY = coalescedItem.pageY;\r\n                    eventCopy.relX = coalescedItem.relX;\r\n                    eventCopy.relY = coalescedItem.relY;\r\n                    eventCopy.dX = coalescedItem.dX;\r\n                    eventCopy.dY = coalescedItem.dY;\r\n                    eventCopy.time = coalescedItem.time;\r\n                    if (i < event.coalescedArr.length - 1) {\r\n                        eventCopy.isCoalesced = true;\r\n                    }\r\n\r\n                    this.chainOut && this.chainOut(eventCopy);\r\n                }\r\n\r\n            } else {\r\n                return event;\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n}\r\n","import {dist} from '../../math/math';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\n/**\r\n * A ChainElement. Detects a single tap with N 'touch' pointers\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class NFingerTapper {\r\n\r\n    private readonly minSilenceBeforeDurationMs = 50;\r\n    private readonly maxTapMs = 500;\r\n    private readonly maxFirstLastFingerDownMs = 250;\r\n    private readonly maxPressedDistancePx = 12; //5 + fingers * 5;\r\n\r\n    private chainOut: ((e: IPointerEvent) => void) | undefined;\r\n    private fingerArr: {\r\n        pointerId: number;\r\n        downTimeMs: number;\r\n        downPageX: number;\r\n        downPageY: number;\r\n        isUp?: boolean;\r\n    }[] = [];\r\n    private eventQueueArr: IPointerEvent[] = [];\r\n    private firstDownTime: number = 0;\r\n    private lastEventTime: number = 0;\r\n    private nowTime: number = performance.now();\r\n    private readonly pointersDownIdArr: number[] = [];\r\n    private readonly fingers: number;\r\n    private readonly onTap: () => void;\r\n    private readonly timeoutObj: {\r\n        firstLastDownTimeout: ReturnType<typeof setTimeout> | null;\r\n        tapTimeout: ReturnType<typeof setTimeout> | null;\r\n    } = {\r\n        firstLastDownTimeout: null,\r\n        tapTimeout: null,\r\n    };\r\n\r\n    private failGesture (): void {\r\n        if (this.eventQueueArr.length === 0) {\r\n            return;\r\n        }\r\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\r\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\r\n        for (let i = 0; i < this.eventQueueArr.length; i++) {\r\n            this.chainOut && this.chainOut(this.eventQueueArr[i]);\r\n        }\r\n        this.eventQueueArr = [];\r\n        this.fingerArr = [];\r\n    }\r\n\r\n    private success (): void {\r\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\r\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\r\n        this.eventQueueArr = []; // events get swallowed\r\n        this.fingerArr = [];\r\n        this.onTap();\r\n    }\r\n\r\n    private setupTimeout (timeoutStr: 'firstLastDownTimeout' | 'tapTimeout', timeMS: number): boolean {\r\n        const diff = timeMS - this.nowTime;\r\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        this.timeoutObj[timeoutStr] = setTimeout(() => this.failGesture(), diff);\r\n        return true;\r\n    }\r\n\r\n    private processEvent (event: IPointerEvent): true | void {\r\n\r\n        const tempLastEventTime = this.lastEventTime;\r\n        this.lastEventTime = event.time;\r\n\r\n        if (event.type === 'pointerdown') {\r\n            this.pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\r\n                if (this.pointersDownIdArr[i] === event.pointerId) {\r\n                    this.pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (event.pointerType !== 'touch') {\r\n            if (this.fingerArr.length > 0) { // already in gesture -> fail\r\n                this.failGesture();\r\n            }\r\n            return;\r\n        }\r\n\r\n        this.nowTime = performance.now();\r\n\r\n        if (event.type === 'pointerdown') {\r\n            //console.log('down');\r\n            if (this.fingerArr.length + 1 !== this.pointersDownIdArr.length) { // failed before, and some fingers are still down -> fail\r\n                this.failGesture();\r\n                return;\r\n            }\r\n            if (this.fingerArr.length === this.fingers) { // too many fingers down -> fail\r\n                //console.log(fingers + ': too many fingers down -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n            if (this.fingerArr.length > 0 && event.time - this.maxFirstLastFingerDownMs > this.fingerArr[0].downTimeMs) { // took too long to touch with all fingers -> fail\r\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n            if (this.fingerArr.length === 0 && event.time - this.minSilenceBeforeDurationMs < tempLastEventTime) { // not enough silence before -> fail\r\n                //console.log(fingers + ': not enough silence before -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            if (this.fingerArr.length === 0) {\r\n                this.firstDownTime = event.time;\r\n\r\n                if (!this.setupTimeout('firstLastDownTimeout', event.time + this.maxFirstLastFingerDownMs) || !this.setupTimeout('tapTimeout', event.time + this.maxTapMs)) { // timeouts already up -> fail\r\n                    this.failGesture();\r\n                    return;\r\n                }\r\n\r\n            }\r\n            this.fingerArr.push({\r\n                pointerId: event.pointerId,\r\n                downTimeMs: event.time,\r\n                downPageX: event.pageX,\r\n                downPageY: event.pageY,\r\n            });\r\n            return;\r\n\r\n        }\r\n\r\n        if (event.type === 'pointermove') {\r\n\r\n            if (this.fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            for (let i = 0; i < this.fingerArr.length; i++) {\r\n                if (this.fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = this.fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) { // finger not part of the tap is on screen -> fail\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            if (event.time - this.maxTapMs > this.firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > this.maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'pointerup') {\r\n\r\n            if (this.fingerArr.length === 0) {\r\n                //not in a gesture -> ignore\r\n                return;\r\n            }\r\n\r\n            //console.log('up', event.pageX, event.pageY);\r\n            if (this.fingerArr.length !== this.fingers) { // not enough fingers -> fail\r\n                //console.log(fingers + ': not enough fingers -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            let fingerObj = null;\r\n            let i = 0;\r\n            for (; i < this.fingerArr.length; i++) {\r\n                if (this.fingerArr[i].pointerId === event.pointerId) {\r\n                    fingerObj = this.fingerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n            if (fingerObj === null) {\r\n                //do nothing\r\n                return;\r\n            }\r\n\r\n            if (event.time - this.maxTapMs > this.firstDownTime) { // tap took too long -> fail\r\n                //console.log(fingers + ': tap took too long -> fail');\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\r\n            if (distance > this.maxPressedDistancePx) { // finger moved too much -> fail\r\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\r\n                //console.log(fingerArr);\r\n                this.failGesture();\r\n                return;\r\n            }\r\n\r\n            fingerObj.isUp = true;\r\n\r\n            let allAreUp = true;\r\n            for (let i = 0; i < this.fingerArr.length; i++) {\r\n                if (!this.fingerArr[i].isUp) {\r\n                    allAreUp = false;\r\n                    break;\r\n                }\r\n            }\r\n            //console.log('fingerArr', fingerArr);\r\n\r\n            if (allAreUp) { // success\r\n                this.success();\r\n                return true;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            fingers: number;\r\n            onTap: () => void;\r\n        }\r\n    ) {\r\n        this.fingers = p.fingers;\r\n        this.onTap = p.onTap;\r\n    }\r\n\r\n\r\n    chainIn (event: IPointerEvent): (IPointerEvent | null) {\r\n\r\n        const result = this.processEvent(event);\r\n\r\n        //console.log(fingerArr.length);\r\n\r\n        if (result === true) {\r\n            //tap success -> event gets swallowed\r\n            return null;\r\n        }\r\n        if (this.fingerArr.length === 0) {\r\n            return event;\r\n        } else {\r\n            this.eventQueueArr.push(event);\r\n        }\r\n\r\n        return null;\r\n\r\n    }\r\n\r\n    setChainOut (func: (e: IPointerEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n\r\n}\r\n","import {dist, pointsToAngleRad} from '../../math/math';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\nexport type TPinchZoomerEvent = { type: 'end' } | {\r\n    type: 'move';\r\n\r\n    downRelX: number;\r\n    downRelY: number;\r\n    relX: number;\r\n    relY: number;\r\n\r\n    angleRad: number;\r\n    scale: number;\r\n};\r\n\r\ntype TTouchPointer =  {\r\n    pointerId: number;\r\n    relX: number;\r\n    relY: number;\r\n    downRelX?: number; // only for first\r\n    downRelY?: number;\r\n};\r\n\r\ntype TPinchGesture = {\r\n    touchPointerArr: TTouchPointer[];\r\n    otherPointerIdArr: number[];\r\n    isInProgress: boolean;\r\n};\r\n\r\n/**\r\n * A ChainElement. Detects a pinch zooming (2 touch pointers). If one finger lifts, then will use the remaining.\r\n * Further pointers are ignored, but their events get swallowed during the pinching.\r\n * pinching ends when ALL pointers are lifted.\r\n * Events passed through if no pinching.\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class PinchZoomer {\r\n\r\n    private readonly firstFingerMaxDistancePx = 10;\r\n    private readonly untilSecondFingerDurationMs = 250;\r\n\r\n\r\n    private chainOut: ((e: IPointerEvent) => void) | undefined;\r\n    private readonly pointersDownIdArr: number[] = [];\r\n    private gestureObj: null | TPinchGesture = null;\r\n    private eventQueueArr: IPointerEvent[] = [];\r\n    private nowTime: number = performance.now();\r\n    private readonly timeoutObj: {\r\n        secondFingerTimeout: ReturnType<typeof setTimeout> | null;\r\n    } = {\r\n        secondFingerTimeout: null,\r\n    };\r\n    private pincherArr: {\r\n        pointerId: number;\r\n        relX: number;\r\n        relY: number;\r\n        downRelX: number;\r\n        downRelY: number;\r\n    }[] = [];\r\n    private readonly onPinch: (e: TPinchZoomerEvent) => void;\r\n\r\n\r\n    private end (): void {\r\n        this.gestureObj = null;\r\n        this.eventQueueArr = [];\r\n    }\r\n\r\n    private fail (doSwallow?: boolean): void {\r\n        if (!this.gestureObj) { // no gesture happening -> ignore\r\n            return;\r\n        }\r\n\r\n        this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\r\n        if (!doSwallow) {\r\n            for (let i = 0; i < this.eventQueueArr.length; i++) {\r\n                this.chainOut && this.chainOut(this.eventQueueArr[i]);\r\n            }\r\n        }\r\n        this.end();\r\n    }\r\n\r\n    private setupFailTimeout (timeMS: number): boolean {\r\n        const diff = timeMS - this.nowTime;\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        this.timeoutObj.secondFingerTimeout = setTimeout(() => this.fail(), diff);\r\n        return true;\r\n    }\r\n\r\n    private processEvent (event: IPointerEvent): void {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            this.pointersDownIdArr.push(event.pointerId);\r\n\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\r\n                if (this.pointersDownIdArr[i] === event.pointerId) {\r\n                    this.pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        //pass through scenarios\r\n        if (\r\n            !this.gestureObj && (\r\n                event.pointerType !== 'touch' || // wrong pointer type\r\n                (event.type === 'pointermove' && this.pointersDownIdArr.length > 0) || // failed before\r\n                this.pointersDownIdArr.length > 1 || // failed before\r\n                event.type === 'pointerup' // failed before\r\n            )\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        this.nowTime = performance.now();\r\n\r\n\r\n        //pointer down\r\n        if (event.type === 'pointerdown') {\r\n\r\n            if (this.gestureObj) {\r\n                if (event.pointerType === 'touch') { // touch finger down - as nth pointer\r\n\r\n                    this.gestureObj.touchPointerArr.push({\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY,\r\n                    });\r\n\r\n                    if (this.gestureObj.isInProgress) {\r\n                        this.continuePinch(this.gestureObj, {\r\n                            type: 'down',\r\n                            index: this.gestureObj.touchPointerArr.length - 1,\r\n                        });\r\n                    } else {\r\n                        this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\r\n                        this.gestureObj.isInProgress = true;\r\n                        this.beginPinch(this.gestureObj);\r\n                    }\r\n                    return;\r\n\r\n                } else { // non-touch finger down - as nth pointer\r\n\r\n                    if (this.gestureObj.isInProgress) {\r\n                        this.gestureObj.otherPointerIdArr.push(event.pointerId);\r\n                    } else { // second pointer wrong type -> fail\r\n                        this.fail();\r\n                    }\r\n                    return;\r\n                }\r\n\r\n\r\n            } else {\r\n                // first finger down - can only be touch if no gestureObj\r\n                this.gestureObj = {\r\n                    touchPointerArr: [{\r\n                        pointerId: event.pointerId,\r\n                        relX: event.relX,\r\n                        relY: event.relY,\r\n                        downRelX: event.relX,\r\n                        downRelY: event.relY,\r\n                    }],\r\n                    otherPointerIdArr: [],\r\n                    isInProgress: false,\r\n                };\r\n                if (!this.setupFailTimeout(event.time + this.untilSecondFingerDurationMs)) { // time ran out -> fail\r\n                    this.fail();\r\n                    return;\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        // should not happen. something went wrong\r\n        if (!this.gestureObj) {\r\n            // throw? would make it less robust\r\n            this.fail();\r\n            return;\r\n        }\r\n\r\n        //pointer move\r\n        if (event.type === 'pointermove' && event.pointerType === 'touch') {\r\n            //gesture object should always exist here\r\n\r\n            let touchPointerObj: TTouchPointer | null = null;\r\n            let i = 0;\r\n            for (; i < this.gestureObj.touchPointerArr.length; i++) {\r\n                if (event.pointerId === this.gestureObj.touchPointerArr[i].pointerId) {\r\n                    touchPointerObj = this.gestureObj.touchPointerArr[i];\r\n                    break;\r\n                }\r\n            }\r\n\r\n            //null should not be possible. something went wrong\r\n            if (!touchPointerObj) {\r\n                // throw? would make it less robust\r\n                this.fail();\r\n                return;\r\n            }\r\n\r\n            touchPointerObj.relX = event.relX;\r\n            touchPointerObj.relY = event.relY;\r\n\r\n            if (!this.gestureObj.isInProgress) { // only one finger down & pinching hasn't started\r\n\r\n                // should not happen. something went wrong\r\n                if (\r\n                    !('downRelX' in touchPointerObj && touchPointerObj.downRelX !== undefined) ||\r\n                    !('downRelY' in touchPointerObj && touchPointerObj.downRelY !== undefined)\r\n                ) {\r\n                    this.fail();\r\n                    return;\r\n                }\r\n\r\n                const distance = dist(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\r\n                if (distance > this.firstFingerMaxDistancePx) { // moved too much -> fail\r\n                    this.fail();\r\n                    return;\r\n                }\r\n\r\n            } else {\r\n                if (i < 2) { // only first two touches can affect pinching\r\n                    this.continuePinch(this.gestureObj, {\r\n                        type: 'move',\r\n                        index: i,\r\n                    });\r\n                }\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n\r\n        //pointer up\r\n        if (event.type === 'pointerup') {\r\n            //gesture object should always exist here\r\n\r\n            if (event.pointerType === 'touch') {\r\n                let i = 0;\r\n                for (; i < this.gestureObj.touchPointerArr.length; i++) {\r\n                    if (this.gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\r\n                        this.gestureObj.touchPointerArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n                if (this.gestureObj.touchPointerArr.length > 0) {\r\n                    this.continuePinch(this.gestureObj, {\r\n                        type: 'up',\r\n                        index: i,\r\n                    });\r\n                }\r\n\r\n            } else { // non-touch\r\n                for (let i = 0; i < this.gestureObj.otherPointerIdArr.length; i++) {\r\n                    if (this.gestureObj.otherPointerIdArr[i] === event.pointerId) {\r\n                        this.gestureObj.otherPointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            //all fingers lifted?\r\n            if (this.gestureObj.touchPointerArr.length === 0 && this.gestureObj.otherPointerIdArr.length === 0) {\r\n                if (this.gestureObj.isInProgress) { // lifted last finger -> end of pinching\r\n                    this.end();\r\n                    this.endPinch();\r\n                } else { // lifted finger again before pinching started -> fail\r\n                    this.fail();\r\n                }\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n\r\n    }\r\n\r\n    private beginPinch (gestureObj: TPinchGesture): void {\r\n\r\n        for (let i = 0; i < gestureObj.touchPointerArr.length; i++) {\r\n            const pointerObj = gestureObj.touchPointerArr[i];\r\n            this.pincherArr.push({\r\n                pointerId: pointerObj.pointerId,\r\n                relX: pointerObj.relX,\r\n                relY: pointerObj.relY,\r\n                downRelX: pointerObj.relX,\r\n                downRelY: pointerObj.relY,\r\n            });\r\n        }\r\n\r\n        const event: TPinchZoomerEvent = {\r\n            type: 'move',\r\n\r\n            // temp\r\n            downRelX: 0,\r\n            downRelY: 0,\r\n            relX: 0,\r\n            relY: 0,\r\n\r\n            angleRad: 0,\r\n            scale: 1,\r\n        };\r\n\r\n        if (this.pincherArr.length === 1) {\r\n            event.relX = this.pincherArr[0].downRelX;\r\n            event.relY = this.pincherArr[0].downRelY;\r\n        } else {\r\n            event.relX = 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX);\r\n            event.relY = 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY);\r\n        }\r\n        event.downRelX = event.relX;\r\n        event.downRelY = event.relY;\r\n\r\n        this.onPinch(event);\r\n\r\n    }\r\n\r\n    //actionObj = {type: 'down'|'move'|'up', index: number}\r\n    private continuePinch (\r\n        gestureObj: TPinchGesture,\r\n        actionObj: {\r\n            type: 'down' | 'move' | 'up';\r\n            index: number;\r\n        }\r\n    ): void {\r\n\r\n        if (actionObj.index > 1) { // only first two pointers matter\r\n            return;\r\n        }\r\n\r\n        if (actionObj.type === 'move') {\r\n\r\n            let event: TPinchZoomerEvent;\r\n            this.pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\r\n            this.pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\r\n\r\n            if (this.pincherArr.length === 1) {\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: this.pincherArr[0].downRelX,\r\n                    downRelY: this.pincherArr[0].downRelY,\r\n                    relX: this.pincherArr[0].relX,\r\n                    relY: this.pincherArr[0].relY,\r\n                    angleRad: 0,\r\n                    scale: 1,\r\n                };\r\n\r\n            } else {\r\n\r\n                const startDist = dist(this.pincherArr[0].downRelX, this.pincherArr[0].downRelY, this.pincherArr[1].downRelX, this.pincherArr[1].downRelY);\r\n                const distance = dist(this.pincherArr[0].relX, this.pincherArr[0].relY, this.pincherArr[1].relX, this.pincherArr[1].relY);\r\n\r\n                const startAngle = pointsToAngleRad({\r\n                    x: this.pincherArr[0].downRelX,\r\n                    y: this.pincherArr[0].downRelY,\r\n                }, {x: this.pincherArr[1].downRelX, y: this.pincherArr[1].downRelY});\r\n                const angle = pointsToAngleRad({\r\n                    x: this.pincherArr[0].relX,\r\n                    y: this.pincherArr[0].relY,\r\n                }, {x: this.pincherArr[1].relX, y: this.pincherArr[1].relY});\r\n\r\n                event = {\r\n                    type: 'move',\r\n                    downRelX: 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX),\r\n                    downRelY: 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY),\r\n                    relX: 0.5 * (this.pincherArr[0].relX + this.pincherArr[1].relX),\r\n                    relY: 0.5 * (this.pincherArr[0].relY + this.pincherArr[1].relY),\r\n                    angleRad: angle - startAngle,\r\n                    scale: distance / startDist,\r\n                };\r\n\r\n            }\r\n\r\n            this.onPinch(event);\r\n\r\n        } else if (actionObj.type === 'down' || actionObj.type === 'up') {\r\n            this.endPinch();\r\n            this.beginPinch(gestureObj);\r\n        }\r\n\r\n    }\r\n\r\n    private endPinch (): void {\r\n        this.pincherArr = [];\r\n        this.onPinch({\r\n            type: 'end',\r\n        });\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onPinch: (e: TPinchZoomerEvent) => void;\r\n        }\r\n    ) {\r\n        this.onPinch = p.onPinch;\r\n    }\r\n\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n        this.processEvent(event);\r\n        if (this.gestureObj) {\r\n            if (!this.gestureObj.isInProgress) { // might still fail -> into queue\r\n                this.eventQueueArr.push(event);\r\n            }\r\n        } else {\r\n            return event;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    setChainOut (func: (e: IPointerEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n}\r\n","import {TChainOutFunc} from './event-chain.types';\r\nimport {dist} from '../../math/math';\r\nimport {IPointerEvent, TPointerButton, TPointerType} from '../event.types';\r\n\r\n\r\ninterface IDoubleTapperEvent {\r\n    pageX: number;\r\n    pageY: number;\r\n    relX: number;\r\n    relY: number;\r\n}\r\n\r\ntype TDoubleTapperTimeoutType = 'fail' | 'maxUntilSecondDown' | 'success';\r\n\r\n/**\r\n * A ChainElement. Detects double taps.\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class DoubleTapper {\r\n\r\n    private readonly onDoubleTap: (e: IDoubleTapperEvent) => void;\r\n    private chainOut: TChainOutFunc | undefined;\r\n    private allowedPointerTypeArr: TPointerType[] = ['touch', 'mouse', 'pen'];\r\n    private allowedButtonArr: TPointerButton[] = ['left'];\r\n    private minSilenceBeforeDurationMs: number = 400;\r\n    private maxPressedDurationMs: number = 300;\r\n    private maxPressedDistancePx: number = 10;\r\n    private maxInbetweenDistancePx: number = 19;\r\n    private maxUpToUpDurationMs: number = 500;\r\n    private maxUntilSecondDownDurationMs: number = 300;\r\n    private minSilenceAfterMs: number = 250;\r\n    private sequenceArr: (\r\n        {\r\n            isDown: boolean;\r\n            time: number;\r\n            position: [number, number];\r\n            pointerId: number;\r\n        } |\r\n        {\r\n            isUp: boolean;\r\n            time: number;\r\n            position: [number, number];\r\n        } |\r\n        {\r\n            pageX: number;\r\n            pageY: number;\r\n            relX: number;\r\n            relY: number;\r\n        }\r\n        )[] = [];\r\n    private pointersDownIdArr: number[] = [];\r\n    private lastUpTime: number = 0;\r\n    private nowTime: number = 0;\r\n    private eventQueueArr: IPointerEvent[] = [];\r\n    private timeoutObj: {\r\n        [K in TDoubleTapperTimeoutType]: ReturnType<typeof setTimeout> | null;\r\n    } = {\r\n        fail: null,\r\n        maxUntilSecondDown: null,\r\n        success: null,\r\n    };\r\n    private readonly gestureFailed: () => void;\r\n\r\n    // double tap achieved\r\n    private success (): void {\r\n        this.timeoutObj.fail = null;\r\n        this.timeoutObj.success = null;\r\n        this.eventQueueArr = []; // events get swallowed\r\n        const lastSequenceItem = this.sequenceArr[this.sequenceArr.length - 1];\r\n        this.sequenceArr = [];\r\n        if ('pageX' in lastSequenceItem) {\r\n            this.onDoubleTap({\r\n                pageX: lastSequenceItem.pageX,\r\n                pageY: lastSequenceItem.pageY,\r\n                relX: lastSequenceItem.relX,\r\n                relY: lastSequenceItem.relY,\r\n            });\r\n        }\r\n    }\r\n\r\n    // returns false if time already up. otherwise sets up timeout\r\n    private setupTimeout (timeoutStr: TDoubleTapperTimeoutType, targetFunc: () => void, timeMS: number): boolean {\r\n        const diff = timeMS - this.nowTime;\r\n        // console.log(fingers + ': ' + timeoutStr + ' diff', diff);\r\n        if (diff <= 0) { // time already up\r\n            return false;\r\n        }\r\n        this.timeoutObj[timeoutStr] = setTimeout(targetFunc, diff);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @param event object - a pointer event from BB.PointerListener\r\n     */\r\n    private processEvent (event: IPointerEvent): void {\r\n\r\n        if (event.type === 'pointerdown') {\r\n            this.pointersDownIdArr.push(event.pointerId);\r\n        } else if (event.type === 'pointerup') {\r\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\r\n                if (this.pointersDownIdArr[i] === event.pointerId) {\r\n                    this.pointersDownIdArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!this.allowedPointerTypeArr.includes(event.pointerType)) { //wrong input type -> fail\r\n            //console.log('wrong input type -> fail');\r\n            this.gestureFailed();\r\n            return;\r\n        }\r\n\r\n        this.nowTime = performance.now();\r\n        const lastSequenceItem = this.sequenceArr.length > 0 ? this.sequenceArr[this.sequenceArr.length - 1] : null;\r\n        if (event.type === 'pointerup') {\r\n            this.lastUpTime = event.time;\r\n        }\r\n\r\n        if (event.type === 'pointerdown') {\r\n            if (this.pointersDownIdArr.length > 1) { // more than one pointer down -> fail\r\n                //console.log('more than one pointer down -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (this.timeoutObj.success !== null) { // silence-after not achieved -> fail\r\n                //console.log('silence-after not achieved -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (this.sequenceArr.length === 0 && this.nowTime - this.lastUpTime < this.minSilenceBeforeDurationMs) { // silence before not achieved -> fail\r\n                //console.log('silence before not achieved -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (event.button && !this.allowedButtonArr.includes(event.button)) { // wrong button -> fail\r\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if ((lastSequenceItem && 'isDown' in lastSequenceItem && lastSequenceItem.isDown) || this.sequenceArr.length > 2) { // jumbled -> fail\r\n                //console.log('jumbled -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if (lastSequenceItem && 'position' in lastSequenceItem) {\r\n                const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n                if (distance > this.maxInbetweenDistancePx) { //moved too much -> reset\r\n                    //console.log('maxInbetweenDistancePx -> reset');\r\n                    this.gestureFailed();\r\n\r\n\r\n                    if ('time' in lastSequenceItem && this.nowTime - lastSequenceItem.time < this.minSilenceBeforeDurationMs) { //silence before not achieved -> fail\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n            this.sequenceArr.push({\r\n                isDown: true,\r\n                time: this.nowTime,\r\n                position: [event.pageX, event.pageY],\r\n                pointerId: event.pointerId,\r\n            });\r\n            //maxUntilSecondDown\r\n\r\n            if (this.sequenceArr.length > 1) {\r\n                this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\r\n            } else if (!this.setupTimeout('maxUntilSecondDown', () => this.gestureFailed(), event.time + this.maxUntilSecondDownDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n\r\n\r\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\r\n            if (!this.setupTimeout('fail', () => this.gestureFailed(), event.time + this.maxPressedDurationMs)) {\r\n                //console.log('event.time + maxPressedDurationMs -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointermove' && 'pointerId' in lastSequenceItem && lastSequenceItem.pointerId === event.pointerId) {\r\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                console.log('another pointer mixing in -> fail');\r\n                this.fail();\r\n                return;\r\n            }*/\r\n            const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\r\n            if (distance > this.maxPressedDistancePx) { //moved too much -> fail\r\n                //console.log('maxPressedDistancePx -> fail');\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n        }\r\n        if (lastSequenceItem && event.type === 'pointerup') {\r\n            if ('pointerId' in lastSequenceItem && lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            if ('time' in lastSequenceItem && this.nowTime >= lastSequenceItem.time + this.maxPressedDurationMs) { //pressed too long -> fail\r\n                this.gestureFailed();\r\n                return;\r\n            }\r\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\r\n\r\n            if (this.sequenceArr.length < 3) {\r\n                if (!this.setupTimeout('fail', () => this.gestureFailed(), event.time + this.maxUpToUpDurationMs)) {\r\n                    this.gestureFailed();\r\n                    return;\r\n                }\r\n\r\n                this.sequenceArr = [\r\n                    lastSequenceItem,\r\n                    {\r\n                        isUp: true,\r\n                        time: this.nowTime,\r\n                        position: [event.pageX, event.pageY],\r\n                    },\r\n                ];\r\n                return;\r\n            }\r\n\r\n            if ('time' in this.sequenceArr[1] && this.nowTime < this.sequenceArr[1].time + this.maxUpToUpDurationMs) {\r\n                // double tap almost success\r\n                // only needs silence\r\n                this.sequenceArr.push({\r\n                    pageX: event.pageX,\r\n                    pageY: event.pageY,\r\n                    relX: event.relX,\r\n                    relY: event.relY,\r\n                });\r\n                if (!this.setupTimeout('success', () => this.success(), event.time + this.minSilenceAfterMs)) {\r\n                    this.gestureFailed();\r\n                }\r\n            } else { // time up -> fail\r\n                this.gestureFailed();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onDoubleTap: (e: IDoubleTapperEvent) => void; // fires when double tap occurs\r\n        }\r\n    ) {\r\n        this.onDoubleTap = p.onDoubleTap;\r\n        this.gestureFailed = () => {\r\n            if (this.sequenceArr.length === 0) { // no gesture started -> can be ignored\r\n                return;\r\n            }\r\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\r\n            this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\r\n            this.timeoutObj.success && clearTimeout(this.timeoutObj.success);\r\n            this.timeoutObj.fail = null;\r\n            this.timeoutObj.maxUntilSecondDown = null;\r\n            this.timeoutObj.success = null;\r\n\r\n            if (this.chainOut) {\r\n                for (let i = 0; i < this.eventQueueArr.length; i++) {\r\n                    this.chainOut(this.eventQueueArr[i]);\r\n                }\r\n            }\r\n\r\n            this.eventQueueArr = [];\r\n            this.sequenceArr = [];\r\n        };\r\n    }\r\n\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n\r\n        this.processEvent(event);\r\n\r\n        if (this.sequenceArr.length === 0) { //existing events can not become a double tap\r\n            this.gestureFailed();\r\n            return event;\r\n        }\r\n        // events might become a double tap -> queue\r\n        this.eventQueueArr.push(event);\r\n        return null;\r\n    }\r\n\r\n    setChainOut (func: TChainOutFunc): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    setAllowedPointerTypeArr (arr: TPointerType[]): void {\r\n        this.allowedPointerTypeArr = [...arr];\r\n    }\r\n\r\n    setAllowedButtonArr (arr: TPointerButton[]): void {\r\n        this.allowedButtonArr = [...arr];\r\n    }\r\n\r\n}\r\n","import {TChainOutFunc} from './event-chain.types';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\n/**\r\n * only lets through events from one pointer at a time.\r\n *\r\n * in IPointerEvent\r\n * out IPointerEvent\r\n */\r\nexport class OnePointerLimiter {\r\n\r\n    private chainOut: TChainOutFunc | undefined;\r\n    private downPointerId: number | null = null;\r\n    private readonly ignorePointerIdArr: number[] = [];\r\n\r\n    // ---- public ----\r\n    chainIn (event: IPointerEvent): IPointerEvent | null {\r\n\r\n        if (this.ignorePointerIdArr.includes(event.pointerId)) {\r\n            if (event.type === 'pointerup') {\r\n                for (let i = 0; i < this.ignorePointerIdArr.length; i++) {\r\n                    if (this.ignorePointerIdArr[i] === event.pointerId) {\r\n                        this.ignorePointerIdArr.splice(i, 1);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        if (this.downPointerId === null) {\r\n            if (event.type === 'pointerdown') {\r\n                this.downPointerId = event.pointerId;\r\n            }\r\n            return event;\r\n\r\n        } else {\r\n            if (event.pointerId !== this.downPointerId) {\r\n                if (event.type === 'pointerdown') {\r\n                    this.ignorePointerIdArr.push(event.pointerId);\r\n                }\r\n                return null;\r\n            }\r\n            if (event.type === 'pointerup') {\r\n                this.downPointerId = null;\r\n            }\r\n            return event;\r\n        }\r\n    }\r\n\r\n    setChainOut (func: TChainOutFunc): void {\r\n        this.chainOut = func;\r\n    }\r\n}","import {IChainElement, TChainOutFunc} from './event-chain.types';\r\nimport {IPointerEvent} from '../event.types';\r\n\r\n/**\r\n * for chaining event processing. useful for gestures (double tap, pinch zoom, max pointer filter).\r\n * each element in the chain might hold back the events, swallow them, transform them, or create new ones\r\n */\r\nexport class EventChain {\r\n    private readonly chainArr: IChainElement[];\r\n    private chainOut: TChainOutFunc | undefined;\r\n\r\n    private continueChain (i: number, event: IPointerEvent): null {\r\n        for (; i < this.chainArr.length; i++) {\r\n            event = this.chainArr[i].chainIn(event);\r\n            if (event === null) {\r\n                return null;\r\n            }\r\n        }\r\n        this.chainOut && this.chainOut(event);\r\n        return null;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            chainArr: IChainElement[];\r\n        }\r\n    ) {\r\n        this.chainArr = p.chainArr;\r\n\r\n        for (let i = 0; i < this.chainArr.length; i++) {\r\n            ( (i) => {\r\n                this.chainArr[i].setChainOut((event: IPointerEvent) => {\r\n                    this.continueChain(i + 1, event);\r\n                });\r\n            })(i);\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * feed an event into the chain\r\n     */\r\n    chainIn (event: IPointerEvent): null {\r\n        return this.continueChain(0, event);\r\n    }\r\n\r\n    /**\r\n     * func will be called when event has passed through the chain\r\n     */\r\n    setChainOut (func: TChainOutFunc): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n}\r\n","window.onscroll = (e) => {\r\n    e.preventDefault();\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hWwEP\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"83Fnk\");","import {KeyListener} from '../../../../bb/input/key-listener';\r\nimport {dialogCounter} from '../modal-count';\r\nimport {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport './scroll-fix';\r\nimport cancelImg from '/src/app/img/ui/cancel.svg';\r\n\r\n/**\r\n * popup that fill whole height, with some padding.\r\n * currently only used for iframe popups.\r\n */\r\nexport class DynamicModal {\r\n\r\n    private readonly parent: HTMLElement;\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly updatePos: () => void;\r\n    private readonly keyListener: KeyListener;\r\n    private readonly xButton: HTMLElement;\r\n    private readonly bgEl: HTMLElement;\r\n    private readonly onClose: ((result?: string) => void) | undefined;\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            title?: HTMLElement;\r\n            content?: HTMLElement;\r\n            buttonArr?: string[];\r\n            autoFocus?: string | false; // todo - not implemented\r\n            clickOnEnter?: string; // button name - todo not implemented\r\n            onClose?: (result?: string) => void;\r\n\r\n            //size and position\r\n            width: number;\r\n            isMaxHeight: boolean; // todo - not implemented\r\n        }\r\n    ) {\r\n        dialogCounter.increase();\r\n        this.onClose = p.onClose;\r\n        this.parent = document.body;\r\n        this.rootEl = BB.el({\r\n            parent: this.parent,\r\n            className: 'g-root kl-d-modal-root',\r\n            css: {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0',\r\n                overflow: 'auto',\r\n                animationName: 'consoleIn',\r\n                animationDuration: '0.3s',\r\n                animationTimingFunction: 'ease-out',\r\n            },\r\n            onClick: BB.handleClick,\r\n        });\r\n\r\n        //background element registering clicks\r\n        this.bgEl = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0',\r\n            },\r\n            onClick: () => this.close(),\r\n        });\r\n\r\n        //the actual popup box\r\n        const popupEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-d-modal',\r\n            css: {\r\n                position: 'absolute',\r\n                width: (BB.isCssMinMaxSupported() ?\r\n                    'min(calc(100% - 40px), ' + (p.width ? p.width : 400) + 'px)' :\r\n                    (p.width ? p.width : 400) + 'px'),\r\n                height: 'calc(100% - 40px)',\r\n                borderRadius: '10px',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n        //x and y position via script. flex not powerful enough imo\r\n        this.updatePos = () => {\r\n            const elW = popupEl.offsetWidth;\r\n            const elH = popupEl.offsetHeight;\r\n\r\n            BB.css(popupEl, {\r\n                left: Math.max(0, (window.innerWidth - elW) / 2) + 'px',\r\n                top: Math.max(20, (window.innerHeight - elH) / 2 - (elH * 0.20)) + 'px',\r\n            });\r\n        };\r\n\r\n        this.updatePos();\r\n        window.addEventListener('resize', this.updatePos);\r\n\r\n        //title row in popup\r\n        const titleHeight = 40;\r\n        const titleEl = BB.el({\r\n            parent: popupEl,\r\n            css: {\r\n                height: titleHeight + 'px',\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center',\r\n                paddingLeft: (titleHeight / 2) + 'px',\r\n            },\r\n        });\r\n        if (p.title) {\r\n            titleEl.append(p.title);\r\n        }\r\n        this.xButton = BB.el({\r\n            parent: titleEl,\r\n            tagName: 'button',\r\n            className: 'popup-x',\r\n            content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\r\n            title: LANG('modal-close'),\r\n            onClick: () => this.close(),\r\n            css: {\r\n                width: titleHeight + 'px',\r\n                height: titleHeight + 'px',\r\n                lineHeight: titleHeight + 'px',\r\n                background: 'none',\r\n                boxShadow: 'none',\r\n            },\r\n            custom: {\r\n                tabindex: '0',\r\n            },\r\n        });\r\n\r\n        const contentEl = BB.el({\r\n            parent: popupEl,\r\n            css: {\r\n                height: 'calc(100% - ' + titleHeight + 'px)',\r\n            },\r\n        });\r\n        if (p.content) {\r\n            contentEl.append(p.content);\r\n        }\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, e) => {\r\n                if (keyStr === 'esc') {\r\n                    e.stopPropagation();\r\n                    this.close();\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n    close (): void {\r\n        dialogCounter.decrease();\r\n        BB.destroyEl(this.rootEl);\r\n        this.parent.removeChild(this.rootEl);\r\n        window.removeEventListener('resize', this.updatePos);\r\n        this.keyListener.destroy();\r\n        BB.destroyEl(this.xButton);\r\n        BB.destroyEl(this.bgEl);\r\n        this.onClose && this.onClose();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IKeyStringOptional} from '../../../bb/bb-types';\r\n\r\n/**\r\n * Checkbox - with label\r\n */\r\nexport class Checkbox {\r\n\r\n    private readonly element: HTMLElement;\r\n    private check: HTMLInputElement;\r\n    private readonly doHighlight: boolean;\r\n\r\n    // --- public ---\r\n\r\n    constructor (params: {\r\n        init?: boolean; // default false\r\n        label: string;\r\n        callback?: (b: boolean) => void;\r\n        allowTab?: boolean; // default false\r\n        title?: string;\r\n        doHighlight?: boolean; // default false\r\n        css?: IKeyStringOptional;\r\n    }) {\r\n        this.doHighlight = !!params.doHighlight;\r\n\r\n        this.element = BB.el({\r\n            className: 'kl-checkbox',\r\n        });\r\n\r\n        const innerEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'label',\r\n            className: 'kl-checkbox__inner',\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        this.check = BB.el({\r\n            parent: innerEl,\r\n            tagName: 'input',\r\n            css: {\r\n                margin: '0 5px 0 0',\r\n            },\r\n            custom: {\r\n                type: 'checkbox',\r\n            },\r\n        }) as HTMLInputElement;\r\n\r\n        this.check.checked = !!params.init;\r\n        if (this.doHighlight && this.check.checked) {\r\n            this.element.classList.add('kl-checkbox--highlight');\r\n        }\r\n        if (!params.allowTab) {\r\n            this.check.tabIndex = -1;\r\n        }\r\n\r\n        if (params.title) {\r\n            innerEl.title = params.title;\r\n        }\r\n\r\n        const label = BB.el({\r\n            parent: innerEl,\r\n            content: params.label,\r\n            css: {},\r\n        });\r\n        (label as any).allowClick = true;\r\n\r\n        this.check.onchange = () => {\r\n            if (this.doHighlight) {\r\n                this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\r\n            }\r\n            params.callback && params.callback(this.check.checked);\r\n            setTimeout(() => {\r\n                this.check.blur();\r\n            }, 0);\r\n        };\r\n        if (params.css) {\r\n            BB.css(this.element, params.css);\r\n        }\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.check.checked;\r\n    }\r\n\r\n    setValue (b: boolean): void {\r\n        this.check.checked = !!b;\r\n        if (this.doHighlight) {\r\n            this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.element;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.check.onchange = null;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb-types';\r\n\r\nexport const input = function (params: {\r\n    type?: 'button' | 'checkbox' | 'number' | 'text' | 'color'; // default text\r\n    min?: number;\r\n    max?: number;\r\n    callback: (val: string) => void;\r\n    init: string | number;\r\n    css?: IKeyString;\r\n}) {\r\n    const result = document.createElement('input');\r\n    if (params.type) {\r\n        try {\r\n            result.type = params.type;\r\n        } catch(e) {} // ie can't deal with number\r\n    } else {\r\n        result.type = 'text';\r\n    }\r\n    if (params.min !== undefined) {\r\n        result.min = '' + params.min;\r\n    }\r\n    if (params.max !== undefined) {\r\n        result.max = '' + params.max;\r\n    }\r\n    result.value = '' + params.init;\r\n    if (params.callback) {\r\n        result.onchange = function () {\r\n            params.callback(result.value);\r\n        };\r\n    }\r\n    if (params.css) {\r\n        BB.css(result, params.css);\r\n    }\r\n\r\n    return result;\r\n};","import {BB} from '../../../bb/bb';\r\nimport {IKeyString} from '../../../bb/bb-types';\r\n\r\n/**\r\n * A select dropdown\r\n */\r\nexport class Select<ValueType extends string> {\r\n\r\n    private readonly selectEl: HTMLSelectElement;\r\n    private readonly optionArr: {\r\n        item: ([ValueType, string] | null); // [value, label]\r\n        el?: HTMLOptionElement;\r\n    }[];\r\n    private readonly changeListener: () => void;\r\n    private readonly onChange: ((val: ValueType) => void) | undefined;\r\n\r\n    \r\n    // --- public ---\r\n    constructor (p: {\r\n        isFocusable?: boolean; // default false\r\n        optionArr: ([ValueType, string] | null)[]; // [value, label]\r\n        initValue?: ValueType; // default null\r\n        onChange?: (val: ValueType) => void;\r\n        css?: IKeyString;\r\n        title?: string;\r\n    }) {\r\n        this.selectEl = BB.el({\r\n            tagName: 'select',\r\n            title: p.title,\r\n            className: 'kl-select',\r\n            css: {\r\n                cursor: 'pointer',\r\n                fontSize: '15px',\r\n                padding: '3px',\r\n            },\r\n        }) as HTMLSelectElement;\r\n        if (p.css) {\r\n            BB.css(this.selectEl, p.css);\r\n        }\r\n\r\n        const isFocusable = p.isFocusable;\r\n        if (!isFocusable) {\r\n            this.selectEl.tabIndex = -1;\r\n        }\r\n        this.optionArr = [];\r\n        for (let i = 0; i < p.optionArr.length; i++) {\r\n            const item = p.optionArr[i];\r\n            if (item === null) {\r\n                this.optionArr.push({item});\r\n                continue;\r\n            }\r\n            const el = document.createElement('option');\r\n            el.value = item[0];\r\n            el.textContent = item[1];\r\n            this.optionArr.push({\r\n                item,\r\n                el,\r\n            });\r\n            this.selectEl.append(el);\r\n        }\r\n        if (p.onChange) {\r\n            this.onChange = p.onChange;\r\n        }\r\n        this.changeListener = () => {\r\n            if (!isFocusable) {\r\n                this.selectEl.blur();\r\n            }\r\n            this.onChange && this.onChange(this.getValue());\r\n        };\r\n        this.selectEl.addEventListener('change', this.changeListener);\r\n        this.selectEl.value = ('initValue' in p && p.initValue !== undefined) ? p.initValue : '';\r\n    }\r\n\r\n    setValue (val: ValueType): void {\r\n        this.selectEl.value = val;\r\n    }\r\n\r\n    getValue (): ValueType {\r\n        return this.selectEl.value as ValueType;\r\n    }\r\n\r\n    setDeltaValue (delta: number): void {\r\n        let index = 0;\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            const option = this.optionArr[i];\r\n            if (option.item && '' + option.item[0] === this.selectEl.value) {\r\n                index = i;\r\n                break;\r\n            }\r\n        }\r\n        index = Math.max(0, Math.min(this.optionArr.length -1, index + delta));\r\n        const option = this.optionArr[index];\r\n        this.selectEl.value = option.item ? option.item[0] : '';\r\n        this.onChange && this.onChange(this.getValue());\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.selectEl;\r\n    }\r\n\r\n    updateLabel (id: ValueType, label: string): void {\r\n        this.optionArr.forEach(option => {\r\n            if (option.item && option.item[0] === id && option.el) {\r\n                option.item[1] = label;\r\n                option.el.textContent = option.item[1];\r\n            }\r\n        });\r\n    }\r\n\r\n    destroy (): void {\r\n        this.selectEl.removeEventListener('change', this.changeListener);\r\n    }\r\n    \r\n}\r\n","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Toggle button with an image\r\n */\r\nexport class ImageToggle {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private isActive: boolean;\r\n\r\n    private update (): void {\r\n        this.rootEl.classList.toggle('image-toggle-active', this.isActive);\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            initValue: boolean;\r\n            title: string;\r\n            isRadio?: boolean; // if true, can't click when active\r\n            onChange: (b: boolean) => void;\r\n            image: string;\r\n            darkInvert?: boolean;\r\n        }\r\n    ) {\r\n        this.isActive = !!p.initValue;\r\n        this.rootEl = BB.el({\r\n            className: 'image-toggle',\r\n            title: p.title,\r\n            content: BB.el({\r\n                className: 'image-toggle__im' + (p.darkInvert ? ' dark-invert' : ''),\r\n                css: {\r\n                    backgroundImage: \"url('\" + p.image + \"')\",\r\n                },\r\n            }),\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                if (p.isRadio && this.isActive) {\r\n                    return;\r\n                }\r\n                this.isActive = !this.isActive;\r\n                this.update();\r\n                p.onChange(this.isActive);\r\n            },\r\n        });\r\n\r\n\r\n        this.update();\r\n    }\r\n\r\n    // --- interface ---\r\n    setValue (b: boolean): void {\r\n        this.isActive = !!b;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.isActive;\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.rootEl);\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {ImageToggle} from './image-toggle';\r\n\r\ntype TOptionItem<IdType> = {\r\n    id: IdType;\r\n    title: string;\r\n    image: string;\r\n    darkInvert?: boolean;\r\n};\r\n\r\n/**\r\n * Radio input group. each one has an image\r\n */\r\nexport class ImageRadioList<IdType> {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private activeIndex: number;\r\n    private readonly optionArr: {\r\n        id: IdType;\r\n        radioEl: ImageToggle;\r\n    }[];\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            optionArr: TOptionItem<IdType>[];\r\n            initId: string;\r\n            onChange: (id: IdType) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'image-radio-wrapper',\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        this.optionArr = [];\r\n\r\n        const select = (index: number, id: IdType): void => {\r\n            this.activeIndex = index;\r\n            for (let i = 0; i < this.optionArr.length; i++) {\r\n                this.optionArr[i].radioEl.setValue(i === this.activeIndex);\r\n            }\r\n            p.onChange(id);\r\n        };\r\n\r\n        let initialIndex;\r\n        const createOption = (index: number, o: TOptionItem<IdType>): {\r\n            id: IdType;\r\n            radioEl: ImageToggle;\r\n        } => {\r\n            if (o.id === p.initId) {\r\n                initialIndex = index;\r\n            }\r\n            const radioEl = new ImageToggle({\r\n                image: o.image,\r\n                title: o.title,\r\n                initValue: o.id === p.initId,\r\n                isRadio: true,\r\n                onChange: () => {\r\n                    select(index, o.id);\r\n                },\r\n                darkInvert: o.darkInvert,\r\n            });\r\n            this.rootEl.append(radioEl.getElement());\r\n\r\n            return {\r\n                id: o.id,\r\n                radioEl,\r\n            };\r\n        };\r\n\r\n        for (let i = 0; i < p.optionArr.length; i++) {\r\n            this.optionArr.push(createOption(i, p.optionArr[i]));\r\n        }\r\n\r\n        if (initialIndex === undefined) {\r\n            throw new Error('initId not in optionArr');\r\n        }\r\n        this.activeIndex = initialIndex;\r\n    }\r\n\r\n    // --- interface ---\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValue (): IdType {\r\n        return this.optionArr[this.activeIndex].id;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.optionArr.forEach(item => {\r\n            item.radioEl.destroy();\r\n        });\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\nimport iconImg from '/src/app/img/ui/brush-pressure.svg';\r\nimport {BoxToggle} from './box-toggle';\r\n\r\n/**\r\n * small toggle button with a pen icon - representing toggling pressure sensitivity\r\n * @param isChecked initial value\r\n * @param changeCallback called on change\r\n */\r\nexport const createPenPressureToggle = function (\r\n    isChecked: boolean,\r\n    changeCallback: (b: boolean) => void,\r\n): HTMLElement {\r\n\r\n    const toggleEl = new BoxToggle({\r\n        label: BB.el({\r\n            className: 'dark-invert',\r\n            css: {\r\n                width: '17px',\r\n                height: '17px',\r\n                backgroundImage: 'url(\"' + iconImg + '\")',\r\n                backgroundSize: 'contain',\r\n                backgroundRepeat: 'no-repeat',\r\n                margin: '1px',\r\n                borderRadius: '3px',\r\n            },\r\n        }),\r\n        title: LANG('brush-toggle-pressure'),\r\n        init: isChecked,\r\n        onChange: (b) => {\r\n            changeCallback(b);\r\n        },\r\n    });\r\n\r\n\r\n    return toggleEl.getElement();\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"h8ubb\");","import {BB} from '../../../bb/bb';\r\n\r\nexport class BoxToggle {\r\n    el: HTMLElement;\r\n    value: boolean;\r\n\r\n    update (): void {\r\n        this.el.classList.toggle('kl-box-toggle--active', this.value);\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            label: string | HTMLElement | SVGElement;\r\n            title?: string;\r\n            init?: boolean;\r\n            onChange: (b: boolean) => void;\r\n        }\r\n    ) {\r\n        this.value = !!p.init;\r\n        this.el = BB.el({\r\n            content: p.label,\r\n            title: p.title,\r\n            className: (typeof p.label === 'string') ? 'kl-box-toggle' : 'kl-box-toggle kl-box-toggle--custom-el',\r\n            onClick: () => {\r\n                this.value = !this.value;\r\n                this.update();\r\n                p.onChange(this.value);\r\n            },\r\n            css: {\r\n                cursor: 'pointer',\r\n            },\r\n        });\r\n        if (typeof p.label !== 'string') {\r\n            BB.css(p.label, {\r\n                display: 'block',\r\n                pointerEvents: 'none',\r\n            });\r\n        }\r\n        this.update();\r\n    }\r\n\r\n    getValue (): boolean {\r\n        return this.value;\r\n    }\r\n\r\n    setValue (b: boolean): void {\r\n        this.value = !!b;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.el);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport {IKlSliderConfig} from '../../kl-types';\r\nimport {languageStrings} from '../../../language/language';\r\nimport {KlSliderManualInput} from './kl-slider-manual-input';\r\nimport {SplineInterpolator} from '../../../bb/math/line';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {IPointerEvent} from '../../../bb/input/event.types';\r\n\r\n/**\r\n * Horizontal slider, can be changed by dragging anywhere on it. Has a label & value.\r\n * e.g. used for brush size\r\n *\r\n * left mouse button - set absolute value\r\n * right mouse button - change relative value\r\n * drag mouse vertically away - precision mode\r\n * double-click/tap slider - manual input mode\r\n *\r\n * Values can be spline interpolated\r\n * On change callback can be debounced\r\n *\r\n */\r\nexport class KlSlider {\r\n\r\n    /*\r\n    Three types of values\r\n    - value - the actual value, when using setValue(), getValue(), and what is emitted\r\n    - displayValue - the number that the user sees on the slider and in the manual input field\r\n        - might be further formatted with formatFunc\r\n        - also might be the same as value, if no toDisplayValue function provided\r\n    - sliderValue - the draggable position of the slider, 0 - 1\r\n     */\r\n\r\n    private value: number;\r\n\r\n    private readonly elementWidth: number;\r\n    private readonly elementHeight: number;\r\n    private isEnabled: boolean;\r\n\r\n    private min: number; // min value\r\n    private max: number; // max value\r\n    private useSpline: boolean;\r\n    private splineInterpolator: undefined | SplineInterpolator;\r\n    private readonly resolution: number;\r\n\r\n    private readonly isChangeOnFinal: boolean;\r\n    private readonly formatFunc: undefined | ((val: number) => number);\r\n\r\n    private readonly onChange: (val: number) => void;\r\n    private readonly valueToDisplayValue: (value: number) => number;\r\n    private readonly displayValueToValue: (displayValue: number) => number;\r\n\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly sliderWrapperEl: HTMLElement;\r\n    private readonly textEl: HTMLElement; // displays label, displayValue\r\n    private readonly label: string;\r\n    private readonly control: HTMLElement;\r\n    private manualInput: undefined | KlSliderManualInput;\r\n    private readonly manualInputRoundDigits: number | undefined;\r\n\r\n    private pointerListener: PointerListener | undefined;\r\n    private readonly pointerListenerTimeout: ReturnType<typeof setTimeout>;\r\n\r\n    private readonly eventResMs: undefined | number;\r\n    private emitValue: undefined | number; // next value for interval\r\n    private emitInterval: (ReturnType<typeof setTimeout> | undefined); // interval of eventResMs which calls onChange()\r\n\r\n    private valueToSliderValue (value: number): number {\r\n        if (this.useSpline && this.splineInterpolator) {\r\n            return this.splineInterpolator.findX(value, Math.floor(this.resolution)) || 0;\r\n        }\r\n        return (value - this.min) / (this.max - this.min);\r\n    }\r\n\r\n    private sliderValueToValue (sliderValue: number): number {\r\n        let result = this.min + sliderValue * (this.max - this.min);\r\n        if (this.useSpline && this.splineInterpolator) {\r\n            result = this.splineInterpolator.interpolate(sliderValue) || 0;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private updateLabel (): void {\r\n        let displayValue: number | string = this.valueToDisplayValue(this.value);\r\n        displayValue = this.formatFunc ? this.formatFunc(displayValue) : Math.round(displayValue);\r\n        displayValue = displayValue.toLocaleString(languageStrings.getCode());\r\n        this.textEl.innerHTML = this.label + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + displayValue + '</span>';\r\n\r\n        const sliderValue = this.valueToSliderValue(this.value);\r\n        this.control.style.width = (sliderValue * this.elementWidth) + 'px';\r\n    }\r\n\r\n    private emit (isFinal: boolean): void {\r\n        if (!isFinal && this.isChangeOnFinal) {\r\n            return;\r\n        }\r\n\r\n        if (isFinal || !this.eventResMs) {\r\n            this.onChange(this.value);\r\n            if (this.emitInterval) {\r\n                clearInterval(this.emitInterval);\r\n                this.emitInterval = undefined;\r\n            }\r\n            return;\r\n        }\r\n\r\n        if (this.emitInterval) {\r\n            this.emitValue = this.value;\r\n\r\n        } else {\r\n            this.onChange(this.value);\r\n\r\n            this.emitInterval = setInterval(() => {\r\n                if (this.emitValue === undefined) {\r\n                    clearInterval(this.emitInterval);\r\n                    this.emitInterval = undefined;\r\n                } else {\r\n                    this.onChange(this.emitValue);\r\n                    this.emitValue = undefined;\r\n                }\r\n            }, this.eventResMs);\r\n        }\r\n    }\r\n\r\n    private updateEnable (): void {\r\n        this.sliderWrapperEl.classList.toggle('slider-wrapper--disabled', !this.isEnabled);\r\n        BB.css(this.sliderWrapperEl, {\r\n            opacity: this.isEnabled ? '' : '0.5',\r\n            pointerEvents: this.isEnabled ? '' : 'none',\r\n        });\r\n        if (this.manualInput) {\r\n            this.manualInput.setIsEnabled(this.isEnabled);\r\n        }\r\n    }\r\n\r\n    private showManualInput (): void {\r\n\r\n        this.manualInput = new KlSliderManualInput(\r\n            this.valueToDisplayValue(this.value),\r\n            this.valueToDisplayValue(this.min),\r\n            this.valueToDisplayValue(this.max),\r\n            this.sliderWrapperEl.getBoundingClientRect(),\r\n            (val) => {\r\n                val = this.displayValueToValue(val);\r\n                this.setValue(BB.clamp(val, this.min, this.max));\r\n                this.onChange(this.value);\r\n            },\r\n            () => {\r\n                BB.css(this.sliderWrapperEl, {\r\n                    display: '',\r\n                });\r\n                if (this.manualInput) {\r\n                    this.rootEl.removeChild(this.manualInput.getElement());\r\n                    this.manualInput.destroy();\r\n                }\r\n                this.manualInput = undefined;\r\n            },\r\n            (this.manualInputRoundDigits && this.manualInputRoundDigits > 0) ? this.manualInputRoundDigits : 0,\r\n        );\r\n        this.rootEl.append(this.manualInput.getElement());\r\n        setTimeout(() => {\r\n            this.manualInput && this.manualInput.focus();\r\n        });\r\n        BB.css(this.sliderWrapperEl, {\r\n            display: 'none',\r\n        });\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        p: {\r\n            label: string;\r\n            width: number; // px\r\n            height: number; // px\r\n            min: number; // min value\r\n            max: number;\r\n            value: number;\r\n            resolution?: number; // int, if you want spline.findX() to use a custom resolution\r\n            curve?: 'quadratic' | [number, number][]; // optional. array is BB.SplineInterpolator points. 0-1\r\n            formatFunc?: (val: number) => number; // function to display a different number than value\r\n            onChange?: (val: number) => void;\r\n            isChangeOnFinal?: boolean; // only fire onChange on pointerUp\r\n            eventResMs?: number; // frequency of change events\r\n            isEnabled?: boolean; // default = true\r\n            manualInputRoundDigits?: number; // default 0, how value should be rounded for manual input\r\n            toDisplayValue?: (value: number) => number;\r\n            toValue?: (displayValue: number) => number;\r\n        }\r\n    ) {\r\n        this.isEnabled = p.isEnabled !== false;\r\n        this.manualInputRoundDigits = p.manualInputRoundDigits;\r\n        this.useSpline = !!p.curve;\r\n\r\n        if (!p.label) {\r\n            throw new Error('KlSlider missing params');\r\n        }\r\n        if (p.min != 0 && p.max != 0 && p.value != 0) {\r\n            if (!p.min || !p.max || !p.value) {\r\n                throw new Error('KlSlider broken params');\r\n            }\r\n        }\r\n        if (p.min >= p.max) {\r\n            throw new Error('KlSlider broken params');\r\n        }\r\n\r\n        this.min = p.min;\r\n        this.max = p.max;\r\n        this.value = BB.clamp(p.value, this.min, this.max);\r\n        this.elementWidth = p.width;\r\n        this.elementHeight = p.height;\r\n        this.resolution = p.resolution ? p.resolution : this.elementWidth * 2;\r\n\r\n        this.onChange = p.onChange ? p.onChange : () => {};\r\n        if (!p.toValue !== !p.toDisplayValue) {\r\n            throw new Error('both or neither have to be set, toValue and toDisplayValue');\r\n        }\r\n        this.displayValueToValue = p.toValue ? p.toValue : (displayValue) => displayValue;\r\n        this.valueToDisplayValue = p.toDisplayValue ? p.toDisplayValue : (value) => value;\r\n        this.isChangeOnFinal = !!p.isChangeOnFinal;\r\n        this.formatFunc = p.formatFunc;\r\n        this.eventResMs = p.eventResMs;\r\n\r\n        if (this.useSpline) {\r\n            if (!p.curve) {\r\n                throw new Error('curve needs to be set if useSpline true');\r\n            }\r\n            const curveArr: [number, number][] = p.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : p.curve;\r\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        }\r\n\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n        this.sliderWrapperEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'slider-wrapper',\r\n            css: {\r\n                overflow: 'hidden',\r\n                position: 'relative',\r\n                width: this.elementWidth + 'px',\r\n                height: this.elementHeight + 'px',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        this.label = p.label;\r\n        const labelFontSize = this.elementHeight - 14;\r\n        this.textEl = BB.el({\r\n            content: this.label,\r\n            css: {\r\n                position: 'absolute',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginLeft: '7px',\r\n                height: '100%',\r\n                fontSize: labelFontSize + 'px',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        this.control = BB.el({\r\n            className: 'slider-inner',\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                width: (this.valueToSliderValue(this.value) * this.elementWidth) + 'px',\r\n                height: this.elementHeight + 'px',\r\n            },\r\n        });\r\n        const controlInner = document.createElement('div');\r\n\r\n        this.sliderWrapperEl.append(this.control, this.textEl);\r\n        this.control.append(controlInner);\r\n\r\n        this.updateEnable();\r\n\r\n\r\n        const doubleTapper = new BB.DoubleTapper({\r\n            onDoubleTap: () => {\r\n                this.showManualInput();\r\n            },\r\n        });\r\n        doubleTapper.setAllowedButtonArr(['left', 'right']);\r\n        const eventChain = new BB.EventChain({\r\n            chainArr: [\r\n                doubleTapper,\r\n            ],\r\n        });\r\n\r\n        let virtualVal: number;\r\n        const onPointer = (event: IPointerEvent) => {\r\n            event.eventPreventDefault();\r\n\r\n            if (!this.isEnabled) {\r\n                return;\r\n            }\r\n\r\n            if (event.type === 'pointerdown') {\r\n\r\n                // unfocus manual slider input\r\n                BB.unfocusAnyInput();\r\n\r\n                this.sliderWrapperEl.className = 'slider-wrapper slider-wrapper--active';\r\n\r\n                if (event.button === 'left') {\r\n                    let sliderValue = event.relX / this.elementWidth;\r\n                    sliderValue = Math.max(0, Math.min(1, sliderValue));\r\n                    this.value = this.sliderValueToValue(sliderValue);\r\n                    this.updateLabel();\r\n                    this.emit(false);\r\n                }\r\n                virtualVal = this.valueToSliderValue(this.value);\r\n            }\r\n\r\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button || '')) {\r\n\r\n                let deltaX = event.dX;\r\n                const deltaY = Math.abs(event.pageY - (event.downPageY || 0));\r\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n                deltaX *= factor;\r\n                deltaX /= this.elementWidth;\r\n\r\n                virtualVal += deltaX;\r\n\r\n                const sliderValue = Math.max(0, Math.min(1, virtualVal));\r\n                this.value = this.sliderValueToValue(sliderValue);\r\n                this.updateLabel();\r\n                this.emit(false);\r\n            }\r\n\r\n            if (event.type === 'pointerup') {\r\n                this.sliderWrapperEl.className = 'slider-wrapper';\r\n                this.emit(true);\r\n            }\r\n\r\n        };\r\n\r\n        this.pointerListenerTimeout = setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.sliderWrapperEl,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    onPointer(e);\r\n                    eventChain.chainIn(e);\r\n                },\r\n                onWheel: (event) => {\r\n                    let sliderValue = this.valueToSliderValue(this.value);\r\n                    sliderValue = BB.clamp(sliderValue - event.deltaY / 40, 0, 1);\r\n                    this.value = this.sliderValueToValue(sliderValue);\r\n                    this.updateLabel();\r\n                    this.onChange(this.value);\r\n                },\r\n            });\r\n            this.updateLabel();\r\n        }, 1);\r\n    }\r\n\r\n    changeSliderValue (f: number): void {\r\n        if (!this.isEnabled) {\r\n            return;\r\n        }\r\n        let sliderValue = this.valueToSliderValue(this.value);\r\n        sliderValue = BB.clamp(sliderValue + f, 0, 1);\r\n        this.value = this.sliderValueToValue(sliderValue);\r\n        this.updateLabel();\r\n        this.onChange(this.value);\r\n    }\r\n\r\n    setValue (v: number): void {\r\n        this.value = BB.clamp(v, this.min, this.max);\r\n        this.updateLabel();\r\n    }\r\n\r\n    getValue (): number {\r\n        return this.value;\r\n    }\r\n\r\n    update (config: IKlSliderConfig): void {\r\n        this.min = config.min;\r\n        this.max = config.max;\r\n        this.useSpline = !!config.curve;\r\n        if (this.useSpline) {\r\n            if (!config.curve) {\r\n                throw new Error('curve needs to be set if useSpline true');\r\n            }\r\n            const curveArr = config.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : config.curve;\r\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\r\n        } else {\r\n            this.splineInterpolator = undefined;\r\n        }\r\n        this.setIsEnabled(!config.isDisabled);\r\n    }\r\n\r\n    setIsEnabled (e: boolean): void {\r\n        this.isEnabled = !!e;\r\n        this.updateEnable();\r\n    }\r\n\r\n    destroy (): void {\r\n        clearTimeout(this.pointerListenerTimeout);\r\n        this.pointerListener && this.pointerListener.destroy();\r\n        if (this.manualInput) {\r\n            this.manualInput.destroy();\r\n        }\r\n        if (this.emitInterval) {\r\n            clearInterval(this.emitInterval);\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n}\r\n","/**\r\n * To make sliders more fine-grained. The falloff when moving cursor away from cursor.\r\n * Returns the factor [0,1]\r\n *  0 -> infinite movement required for change of 1\r\n *  1 -> 1px movement for change of 1\r\n *\r\n * @param deltaY vertical distance from pointerdown\r\n * @param isRightButton\r\n */\r\nexport function calcSliderFalloffFactor (deltaY: number, isRightButton: boolean): number {\r\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\r\n    if (isRightButton) {\r\n        result *= 2;\r\n    }\r\n    return 1 / result;\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {input} from './input';\r\n\r\n/**\r\n * Used by KlSlider. Allows user to type in value in input (type=number) field, instead of dragging with mouse.\r\n * Input goes away when losing focus, or when pressing Enter/Escape.\r\n */\r\nexport class KlSliderManualInput {\r\n\r\n    private readonly input: HTMLInputElement;\r\n    private isEnabled: boolean;\r\n    private scrollBefore: { x: number; y: number }; // window scroll position on creation\r\n    private lastValue: number; // last emitted value\r\n    private isClosed: boolean = false;\r\n\r\n    private emit (): void {\r\n        if (this.lastValue !== Number(this.input.value)) {\r\n            this.onChange(Number(this.input.value));\r\n            this.lastValue = Number(this.input.value);\r\n        }\r\n    }\r\n\r\n    private privateOnClose (): void {\r\n        if (this.isClosed) {\r\n            return;\r\n        }\r\n        this.isClosed = true;\r\n\r\n        this.emit();\r\n        this.onClose();\r\n        setTimeout(() => {\r\n            // because iPad keyboard changes the scroll position\r\n            window.scrollTo(this.scrollBefore.x, this.scrollBefore.y);\r\n            this.scrollBefore = null;\r\n        });\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        value: number, // initial value (displayValue)\r\n        min: number,\r\n        max: number,\r\n        rect: DOMRect, // size of input field\r\n        private onChange: (displayValue: number) => void,\r\n        private onClose: () => void,\r\n        roundDigits?: number,\r\n    ) {\r\n\r\n        this.input = input({\r\n            type: 'number',\r\n            init: value,\r\n            min,\r\n            max,\r\n            callback: (val) => {\r\n                this.emit();\r\n            },\r\n        });\r\n        if (roundDigits !== 0) {\r\n            this.input.setAttribute('step', 'any');\r\n        }\r\n        this.input.onblur = () => {\r\n            this.privateOnClose();\r\n        };\r\n        this.input.addEventListener('keyup', (e) => {\r\n            if (['Enter', 'Escape'].includes(e.key)) {\r\n                this.privateOnClose();\r\n            } else {\r\n                this.emit();\r\n            }\r\n        });\r\n        this.input.addEventListener('wheel', () => this.emit());\r\n\r\n        this.scrollBefore = {\r\n            x: window.scrollX,\r\n            y: window.scrollY,\r\n        };\r\n\r\n        let currentValue;\r\n        if (roundDigits || roundDigits === 0) {\r\n            currentValue = BB.round(value, roundDigits);\r\n        } else {\r\n            currentValue = value;\r\n        }\r\n        this.lastValue = currentValue;\r\n        this.input.value = '' + currentValue;\r\n\r\n        BB.css(this.input, {\r\n            width: rect.width + 'px',\r\n            height: rect.height + 'px',\r\n        });\r\n    }\r\n\r\n    getElement () {\r\n        return this.input;\r\n    }\r\n\r\n    setIsEnabled (b: boolean): void {\r\n        this.isEnabled = !!b;\r\n    }\r\n\r\n    focus (): void {\r\n        this.input.focus();\r\n        this.input.select();\r\n    }\r\n\r\n    destroy (): void {\r\n        BB.destroyEl(this.input);\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {input} from '../components/input';\r\nimport {showModal} from './base/showModal';\r\nimport {LANG} from '../../../language/language';\r\nimport copyImg from '/src/app/img/ui/copy.svg';\r\nimport {IRGB} from '../../kl-types';\r\nimport {RGB} from '../../../bb/color/color';\r\n\r\n\r\ntype TInputRow = {\r\n    update: () => void;\r\n    destroy: () => void;\r\n};\r\n\r\n/**\r\n * dialog for manually inputting the color\r\n */\r\nexport class HexColorDialog {\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            color: IRGB;\r\n            onClose: (rgb: IRGB | null) => void;\r\n        }\r\n    ) {\r\n        let lastValidRgb: RGB = new BB.RGB(p.color.r, p.color.g, p.color.b);\r\n\r\n        const div = BB.el();\r\n\r\n        const previewEl = BB.el({\r\n            css: {\r\n                width: '20px',\r\n                height: '20px',\r\n                marginBottom: '10px',\r\n                boxShadow: 'inset 0 0 0 1px #fff, 0 0 0 1px #000',\r\n                background: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n            },\r\n        });\r\n        div.append(previewEl);\r\n\r\n\r\n        // --- Hex ---\r\n        const hexRowEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginBottom: '15px',\r\n            },\r\n        });\r\n        const hexLabel = BB.el({\r\n            content: LANG('mci-hex'),\r\n            css: {\r\n                width: '60px',\r\n            },\r\n        });\r\n        const hexInput = input({\r\n            init: '#' + BB.ColorConverter.toHexString(lastValidRgb),\r\n            css: {\r\n                width: '80px',\r\n            },\r\n            callback: function () {\r\n                let rgbObj = BB.ColorConverter.hexToRGB(hexInput.value);\r\n                if (rgbObj === null) {\r\n                    rgbObj = lastValidRgb;\r\n                    hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                } else {\r\n                    lastValidRgb = rgbObj;\r\n                }\r\n                previewEl.style.background = '#' + BB.ColorConverter.toHexString(rgbObj);\r\n\r\n                for (let i = 0; i < rgbArr.length; i++) {\r\n                    rgbArr[i].update();\r\n                }\r\n            },\r\n        });\r\n        const copyButton = BB.el({\r\n            tagName: 'button',\r\n            content: '<img src=\"' + copyImg + '\" height=\"20\"/>',\r\n            title: LANG('mci-copy'),\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: function () {\r\n                hexInput.select();\r\n                document.execCommand('copy');\r\n            },\r\n        });\r\n        hexRowEl.append(hexLabel, hexInput, copyButton);\r\n        div.append(hexRowEl);\r\n        setTimeout(function () {\r\n            hexInput.focus();\r\n            hexInput.select();\r\n        }, 0);\r\n\r\n\r\n        // --- R G B ---\r\n        function createRgbInputRow (labelStr: string, attributeStr: 'r' | 'g' | 'b'): TInputRow {\r\n\r\n            const rowEl = BB.el({\r\n                css: {\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    marginTop: '5px',\r\n                },\r\n            });\r\n            const labelEl = BB.el({\r\n                content: labelStr,\r\n                css: {\r\n                    width: '60px',\r\n                },\r\n            });\r\n\r\n            const inputEl = input({\r\n                init: lastValidRgb[attributeStr],\r\n                min: 0,\r\n                max: 255,\r\n                type: 'number',\r\n                css: {\r\n                    width: '80px',\r\n                },\r\n                callback: function () {\r\n                    if (inputEl.value === '' || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\r\n                        result.update();\r\n                        return;\r\n                    }\r\n                    inputEl.value = '' + Math.round(parseFloat(inputEl.value));\r\n                    lastValidRgb[attributeStr] = Number(inputEl.value);\r\n                    previewEl.style.background = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                    hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\r\n                },\r\n            });\r\n\r\n            rowEl.append(labelEl, inputEl);\r\n            div.append(rowEl);\r\n\r\n            const result = {\r\n                update: () => {\r\n                    inputEl.value = '' + lastValidRgb[attributeStr];\r\n                },\r\n                destroy: () => {\r\n                    inputEl.onchange = null;\r\n                },\r\n            };\r\n            return result;\r\n        }\r\n        const rgbArr: TInputRow[] = [];\r\n        rgbArr.push(createRgbInputRow(LANG('red'), 'r'));\r\n        rgbArr.push(createRgbInputRow(LANG('green'), 'g'));\r\n        rgbArr.push(createRgbInputRow(LANG('blue'), 'b'));\r\n\r\n\r\n        showModal({\r\n            target: document.body,\r\n            message: `<b>${LANG('manual-color-input')}</b>`,\r\n            div: div,\r\n            autoFocus: false,\r\n            clickOnEnter: 'Ok',\r\n            buttons: ['Ok', 'Cancel'],\r\n            callback: function (resultStr) {\r\n                BB.destroyEl(copyButton);\r\n                rgbArr.forEach(item => item.destroy());\r\n                rgbArr.splice(0, rgbArr.length);\r\n\r\n                p.onClose(resultStr === 'Ok' ? BB.ColorConverter.hexToRGB(hexInput.value) : null);\r\n            },\r\n        });\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"htADd\");","import {BB} from '../../../bb/bb';\r\nimport {HexColorDialog} from '../modals/color-slider-hex-dialog';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport eyedropperImg from '/src/app/img/ui/tool-picker.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {IRGB} from '../../kl-types';\r\nimport {HSV, RGB} from '../../../bb/color/color';\r\nimport {ERASE_COLOR} from '../../brushes/erase-color';\r\n\r\n/**\r\n * big main HS+V color slider\r\n * 2 elements: slider, and colorpreview(output) + eyedropper\r\n */\r\nexport class KlColorSlider {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly outputDiv: HTMLElement;\r\n    private readonly divPreview: HTMLElement;\r\n    private readonly hexButton: HTMLElement;\r\n    private readonly secondaryColorBtn: HTMLElement;\r\n    private primaryColorRGB: RGB;\r\n    private primaryColorHSV: HSV;\r\n    private secondaryColorRGB: RGB;\r\n    private secondaryColorHSV: HSV;\r\n    private readonly controlH: HTMLElement;\r\n    private pickCallback: undefined | ((b: boolean) => void);\r\n    private isPicking: boolean;\r\n    private readonly pickerButton: HTMLElement;\r\n    private readonly width: number;\r\n    private readonly height: number; // hue slider and output height\r\n    private readonly hueStop: Element;\r\n\r\n    private readonly SVContainer: HTMLElement;\r\n    private readonly pointerSV: HTMLElement;\r\n    private svHeight: number;\r\n    private readonly svSvg: HTMLElement;\r\n\r\n    private readonly emitColor: (rgb: RGB) => void;\r\n\r\n\r\n\r\n    private updatePrimaryHSV (hsv: HSV): void {\r\n        if (hsv.s === 0) {\r\n            this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, hsv.s, hsv.v);\r\n        } else {\r\n            this.primaryColorHSV = new BB.HSV(hsv.h, hsv.s, hsv.v);\r\n        }\r\n    }\r\n\r\n    private updateSVCanvas (): void {\r\n        const rgb = BB.ColorConverter.toRGB(new BB.HSV(this.primaryColorHSV.h, 100, 100));\r\n        BB.setAttributes(this.hueStop, {\r\n            'stop-color': '#' + BB.ColorConverter.toHexString(rgb),\r\n        });\r\n    }\r\n\r\n    private updateSVPointer (): void {\r\n        const left = this.primaryColorHSV.s / 100 * this.width - 7;\r\n        const top = (1 - this.primaryColorHSV.v / 100) * this.svHeight - 6;\r\n        BB.css(this.pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px',\r\n        });\r\n    }\r\n\r\n    private setColPreview (): void {\r\n        this.divPreview.style.backgroundColor = 'rgb(' + this.primaryColorRGB.r + ',' + this.primaryColorRGB.g + ',' + this.primaryColorRGB.b + ')';\r\n\r\n        if (BB.testIsWhiteBestContrast(this.primaryColorRGB)) {\r\n            BB.css(this.pickerButton, {\r\n                filter: 'invert(1)',\r\n            });\r\n            BB.css(this.hexButton, {\r\n                filter: 'invert(1)',\r\n            });\r\n        } else{\r\n            BB.css(this.pickerButton, {\r\n                filter: '',\r\n            });\r\n            BB.css(this.hexButton, {\r\n                filter: '',\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    private updateSecondaryColor (): void {\r\n        this.secondaryColorBtn.style.backgroundColor = BB.ColorConverter.toRgbStr(this.secondaryColorRGB);\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number; // hue slider and output height\r\n            svHeight: number;\r\n            startValue: IRGB; // 0-255\r\n            onPick: (rgb: IRGB) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-color-picker',\r\n            css: {\r\n                position: 'relative',\r\n            },\r\n        });\r\n        this.outputDiv = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        this.width = p.width;\r\n        this.svHeight = p.svHeight;\r\n        this.height = p.height;\r\n        this.emitColor = p.onPick;\r\n\r\n        this.primaryColorRGB = {\r\n            r: parseInt('' + p.startValue.r),\r\n            g: parseInt('' + p.startValue.g),\r\n            b: parseInt('' + p.startValue.b),\r\n        };\r\n        this.primaryColorHSV = BB.ColorConverter.toHSV(p.startValue); // BB.HSV\r\n        this.secondaryColorRGB = {r: ERASE_COLOR, g: ERASE_COLOR, b: ERASE_COLOR};\r\n        this.secondaryColorHSV = BB.ColorConverter._RGBtoHSV(this.secondaryColorRGB); // BB.HSV\r\n\r\n        const svWrapper = BB.el();\r\n        this.svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"><defs><linearGradient id=\"value\" gradientTransform=\"rotate(90)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop offset=\"100%\" stop-color=\"#000\"/></linearGradient><linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/></linearGradient></defs><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\" style=\"mix-blend-mode: multiply\"/></svg>', 'image/svg+xml').documentElement;\r\n        {\r\n            const hueStop = this.svSvg.querySelector('#hue-stop');\r\n            if (!hueStop) {\r\n                throw Error('#hue-stop not found in svSvg');\r\n            }\r\n            this.hueStop = hueStop;\r\n        }\r\n        BB.setAttributes(this.hueStop, {\r\n            'stop-color': '#f0f',\r\n        });\r\n        BB.css(this.svSvg, {\r\n            width: this.width + 'px',\r\n            height: this.svHeight + 'px',\r\n        });\r\n        svWrapper.append(this.svSvg);\r\n\r\n        const divH = BB.el({\r\n            className: 'kl-color-picker__h',\r\n            css: {\r\n                overflow: 'hidden',\r\n                position: 'relative',\r\n                width: this.width + 'px',\r\n                height: this.height + 'px',\r\n                cursor: 'ew-resize',\r\n                marginTop: '1px',\r\n                marginBottom: '1px',\r\n            },\r\n        });\r\n        this.divPreview = BB.el({\r\n            className: 'kl-color-picker__preview',\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                width: (this.height * 2.5) + 'px',\r\n                height: this.height + 'px',\r\n            },\r\n        });\r\n        this.controlH = BB.el();\r\n\r\n\r\n\r\n        const createHueBg = (targetEl: HTMLElement) => {\r\n            const im = new Image();\r\n            BB.css(im, {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                display: 'none',\r\n                pointerEvents: 'none',\r\n            });\r\n            const cv = BB.canvas(this.width, this.height);\r\n            const ctx = BB.ctx(cv);\r\n            const gradH = ctx.createLinearGradient(0, 0, this.width, 0);\r\n            for (let i = 0; i < 1; i += 0.01) {\r\n                const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n                let ha = (parseInt('' + col.r)).toString(16);\r\n                let hb = (parseInt('' + col.g)).toString(16);\r\n                let hc = (parseInt('' + col.b)).toString(16);\r\n                if (ha.length === 1) {\r\n                    ha = '0' + ha;\r\n                }\r\n                if (hb.length === 1) {\r\n                    hb = '0' + hb;\r\n                }\r\n                if (hc.length === 1) {\r\n                    hc = '0' + hc;\r\n                }\r\n                gradH.addColorStop(i, '#' + ha + hb + hc);\r\n            }\r\n            ctx.fillStyle = gradH;\r\n            ctx.fillRect(0, 0, this.width, this.height);\r\n\r\n            targetEl.append(im);\r\n            im.alt = 'hue';\r\n            im.src = cv.toDataURL('image/png');\r\n            im.style.display = 'block';\r\n        };\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n        this.updateSVCanvas();\r\n        this.rootEl.style.width = this.width + 'px';\r\n        this.rootEl.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n\r\n        this.SVContainer = BB.el({\r\n            className: 'kl-color-picker__sv',\r\n            css: {\r\n                width: this.width + 'px',\r\n                height: this.svHeight + 'px',\r\n                overflow: 'hidden',\r\n                display: 'block',\r\n                position: 'relative',\r\n                cursor: 'crosshair',\r\n            },\r\n        });\r\n\r\n        this.pointerSV = BB.el({\r\n           css: {\r\n               width: '12px',\r\n               height: '12px',\r\n               borderRadius: '6px',\r\n               position: 'absolute',\r\n               pointerEvents: 'none',\r\n               boxShadow: '0px 0px 0 1px #000, inset 0px 0px 0 1px #fff',\r\n           },\r\n        });\r\n\r\n        this.SVContainer.append(svWrapper, this.pointerSV);\r\n        this.updateSVPointer();\r\n        this.rootEl.append(this.SVContainer, divH);\r\n        this.outputDiv.append(this.divPreview);\r\n\r\n        //divH.className = \"svSlider\";\r\n        BB.css(this.controlH, {\r\n            width: '1px',\r\n            height: this.height + 'px',\r\n            background: '#000',\r\n            borderLeft: '1px solid #fff',\r\n            position: 'absolute',\r\n            top: '0',\r\n            left: parseInt('' + (this.primaryColorHSV.h / 360 * this.width - 1)) + 'px',\r\n        });\r\n\r\n\r\n        const virtualHSV = {\r\n            h: 0,\r\n            s: 0,\r\n            v: 0,\r\n        };\r\n\r\n\r\n        this.pickerButton = BB.el({\r\n            title: LANG('eyedropper') + ' [Alt]',\r\n            className: 'color-picker-preview-button',\r\n            css: {\r\n                width: '30px',\r\n                height: '30px',\r\n                backgroundImage: 'url(' + eyedropperImg + ')',\r\n                backgroundRepeat:  'no-repeat',\r\n                backgroundSize: '70%',\r\n                backgroundPosition: 'center',\r\n            },\r\n            onClick: () => {\r\n                if (this.isPicking) {\r\n                    this.pickCallback && this.pickCallback(false);\r\n                    this.pickingDone();\r\n                } else {\r\n                    this.pickerButton.classList.remove('color-picker-preview-button-hover');\r\n                    this.pickerButton.classList.add('color-picker-preview-button-active');\r\n                    this.isPicking = true;\r\n                    this.pickCallback && this.pickCallback(true);\r\n                }\r\n            },\r\n        });\r\n        this.isPicking = false;\r\n\r\n        const pickerButtonPointerListener = new BB.PointerListener({\r\n            target: this.pickerButton,\r\n            onEnterLeave: (isOver) => {\r\n                if (this.isPicking) {\r\n                    return;\r\n                }\r\n                this.pickerButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n            },\r\n        });\r\n        this.divPreview.append(this.pickerButton);\r\n\r\n\r\n        this.hexButton = BB.el({\r\n            content: '#',\r\n            className: 'color-picker-preview-button',\r\n            title: LANG('manual-color-input'),\r\n            css: {\r\n                height: '100%',\r\n                width: this.height + 'px',\r\n                lineHeight: this.height + 'px',\r\n                fontSize: (this.height * 0.65) + 'px',\r\n            },\r\n            onClick: () => {\r\n                new HexColorDialog({\r\n                    color: new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b),\r\n                    onClose: (rgbObj) => {\r\n                        if (!rgbObj) {\r\n                            return;\r\n                        }\r\n                        this.setColor(rgbObj);\r\n                        this.emitColor(new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b));\r\n                    },\r\n                });\r\n            },\r\n        });\r\n        const hexButtonPointerListener = new BB.PointerListener({\r\n            target: this.hexButton,\r\n            onEnterLeave: (isOver) => {\r\n                this.hexButton.classList.toggle('color-picker-preview-button-hover', isOver);\r\n            },\r\n        });\r\n        this.divPreview.append(this.hexButton);\r\n\r\n        this.setColPreview();\r\n\r\n\r\n        setTimeout(() => {\r\n            createHueBg(divH);\r\n            divH.append(this.controlH);\r\n            const svPointerListener = new BB.PointerListener({\r\n                target: svWrapper,\r\n                fixScribble: true,\r\n                onPointer: (event) => {\r\n                    if (event.type === 'pointerdown') {\r\n\r\n                        // prevent manual slider input keeping focus on iPad\r\n                        BB.unfocusAnyInput();\r\n\r\n                        this.SVContainer.classList.toggle('kl-color-picker--active', true);\r\n\r\n                        if (event.button === 'left') {\r\n\r\n                            virtualHSV.s = event.relX / this.width * 100;\r\n                            virtualHSV.v = 100 - event.relY / this.svHeight * 100;\r\n\r\n                            this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                            this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n\r\n                            this.updateSVPointer();\r\n                            this.setColPreview();\r\n                            this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n                        } else {\r\n                            virtualHSV.s = this.primaryColorHSV.s;\r\n                            virtualHSV.v = this.primaryColorHSV.v;\r\n                        }\r\n                    }\r\n\r\n                    if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                        let factor = 1;\r\n                        if (event.button === 'right') {\r\n                            factor = 0.5;\r\n                        }\r\n\r\n                        virtualHSV.s += event.dX / this.width * 100 * factor;\r\n                        virtualHSV.v -= event.dY / this.svHeight * 100 * factor;\r\n\r\n                        this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\r\n                        this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n                        this.updateSVPointer();\r\n                        this.setColPreview();\r\n                        this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n\r\n                    }\r\n\r\n                    if (event.type === 'pointerup') {\r\n                        this.SVContainer.classList.toggle('kl-color-picker--active', false);\r\n                    }\r\n\r\n                },\r\n            });\r\n            const hPointerListener = new BB.PointerListener({\r\n                target: divH,\r\n                fixScribble: true,\r\n                onPointer: (event) => {\r\n\r\n                    if (event.type === 'pointerdown') {\r\n\r\n                        // prevent manual slider input keeping focus on iPad\r\n                        BB.unfocusAnyInput();\r\n\r\n                        divH.classList.toggle('kl-color-picker--active', true);\r\n\r\n                        if (event.button === 'left') {\r\n\r\n                            virtualHSV.h = event.relX / this.width * 359.99;\r\n\r\n                            this.primaryColorHSV = new BB.HSV(virtualHSV.h, this.primaryColorHSV.s, this.primaryColorHSV.v);\r\n                            this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n                            this.controlH.style.left = (Math.round(this.primaryColorHSV.h / 359.99 * this.width) - 1) + 'px';\r\n                            this.updateSVCanvas();\r\n                            this.setColPreview();\r\n                            this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n                        } else {\r\n                            virtualHSV.h = this.primaryColorHSV.h;\r\n                        }\r\n                    }\r\n\r\n                    if (event.type === 'pointermove' && ['left', 'right'].includes(event.button)) {\r\n\r\n                        const deltaY = Math.abs(event.pageY - event.downPageY);\r\n                        const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                        virtualHSV.h += event.dX / this.width * 359.99 * factor;\r\n\r\n                        if (event.button === 'right') {\r\n                            virtualHSV.h = virtualHSV.h % 359.99;\r\n                            if (virtualHSV.h < 0) {\r\n                                virtualHSV.h += 359.99;\r\n                            }\r\n                        }\r\n                        virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                        this.primaryColorHSV = new BB.HSV(virtualHSV.h, this.primaryColorHSV.s, this.primaryColorHSV.v);\r\n                        this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\r\n                        this.controlH.style.left = (Math.round(this.primaryColorHSV.h / 359.99 * this.width) - 1) + 'px';\r\n                        this.updateSVCanvas();\r\n                        this.setColPreview();\r\n                        this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\r\n\r\n                    }\r\n\r\n                    if (event.type === 'pointerup') {\r\n                        divH.classList.toggle('kl-color-picker--active', false);\r\n                    }\r\n                },\r\n            });\r\n        }, 1);\r\n\r\n\r\n        // --- secondary color ---\r\n\r\n        this.secondaryColorBtn = BB.el({\r\n            parent: this.outputDiv,\r\n            title: LANG('secondary-color') + ' [X]',\r\n            className: 'kl-color-picker__secondary',\r\n            css: {\r\n                cursor: 'pointer',\r\n                marginLeft: '5px',\r\n                width: '22px',\r\n                height: '22px',\r\n            },\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                this.swapColors();\r\n            },\r\n        });\r\n        this.updateSecondaryColor();\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.primaryColorRGB = {r: parseInt('' + c.r), g: parseInt('' + c.g), b: parseInt('' + c.b)};\r\n        this.updatePrimaryHSV(BB.ColorConverter.toHSV(c));\r\n        this.controlH.style.left = parseInt('' + (this.primaryColorHSV.h / 359 * this.width - 1)) + 'px';\r\n        this.updateSVCanvas();\r\n        this.updateSVPointer();\r\n        this.setColPreview();\r\n    }\r\n\r\n    getColor (): RGB {\r\n        return new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b);\r\n    }\r\n\r\n    getSecondaryRGB (): RGB {\r\n        return new BB.RGB(this.secondaryColorRGB.r, this.secondaryColorRGB.g, this.secondaryColorRGB.b);\r\n    }\r\n\r\n    setPickCallback (func: (b: boolean) => void): void {\r\n        this.pickCallback = func;\r\n    }\r\n\r\n    pickingDone (): void {\r\n        if (!this.isPicking) {\r\n            return;\r\n        }\r\n        this.isPicking = false;\r\n        this.pickerButton.classList.remove('color-picker-preview-button-active');\r\n    }\r\n\r\n    enable (e: boolean): void {\r\n        if (e) {\r\n            this.rootEl.style.pointerEvents = '';\r\n            this.rootEl.style.opacity = '1';\r\n            this.outputDiv.style.pointerEvents = '';\r\n            this.outputDiv.style.opacity = '1';\r\n        } else {\r\n            this.rootEl.style.pointerEvents = 'none';\r\n            this.rootEl.style.opacity = '0.5';\r\n            this.outputDiv.style.pointerEvents = 'none';\r\n            this.outputDiv.style.opacity = '0.5';\r\n        }\r\n    }\r\n\r\n    setHeight (h: number): void {\r\n        h = parseInt('' +(h - this.height * 2 - 3), 10);\r\n        if (h === this.svHeight) {\r\n            return;\r\n        }\r\n        this.svHeight = h;\r\n        BB.css(this.svSvg, {\r\n            width: this.width + 'px',\r\n            height: this.svHeight + 'px',\r\n        });\r\n        this.SVContainer.style.height = this.svHeight + 'px';\r\n        this.updateSVPointer();\r\n    }\r\n\r\n    swapColors (): void {\r\n        // swap hsv\r\n        let tmp: RGB | HSV = this.secondaryColorHSV;\r\n        this.secondaryColorHSV = this.primaryColorHSV;\r\n        this.updatePrimaryHSV(tmp);\r\n        // swap rgb\r\n        tmp = this.secondaryColorRGB;\r\n        this.secondaryColorRGB = this.primaryColorRGB;\r\n        this.primaryColorRGB = tmp;\r\n\r\n        this.controlH.style.left = parseInt('' + (this.primaryColorHSV.h / 359 * this.width - 1)) + 'px';\r\n        this.updateSVCanvas();\r\n        this.updateSVPointer();\r\n        this.setColPreview();\r\n        this.updateSecondaryColor();\r\n\r\n        this.emitColor(new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b));\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getOutputElement (): HTMLElement {\r\n        return this.outputDiv;\r\n    }\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ffKNP\");","import {theme} from '../../theme/theme';\r\n\r\nexport const ERASE_COLOR = theme.isDark() ? 255 : 255;","import {BB} from '../../../bb/bb';\r\nimport {calcSliderFalloffFactor} from './slider-falloff';\r\nimport {IRGB} from '../../kl-types';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {HSV} from '../../../bb/color/color';\r\n\r\n/**\r\n * a small color slider\r\n */\r\nexport class KlColorSliderSmall {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private color: HSV;\r\n    private readonly svPointerListener: PointerListener;\r\n    private readonly hPointerListener: PointerListener;\r\n    private svPointerId: number | null;\r\n    private hPointerId: number | null;\r\n    private readonly width: number;\r\n    private readonly heightSV: number;\r\n    private readonly pointerSV: HTMLElement;\r\n    private readonly pointerH: HTMLElement;\r\n    private readonly canvasSV: HTMLCanvasElement;\r\n\r\n\r\n    private updateSV (): void {\r\n        const ctx = BB.ctx(this.canvasSV);\r\n        if(!ctx) {\r\n            throw new Error('couldnt create canvas');\r\n        }\r\n        for (let i = 0; i < this.canvasSV.height; i += 1) {\r\n            const gradient1 = ctx.createLinearGradient(0, 0, this.canvasSV.width, 0);\r\n\r\n            const colleft = BB.ColorConverter.toRGB(new BB.HSV(this.color.h, 1, 100 - (i / this.canvasSV.height * 100.0)));\r\n            const colright = BB.ColorConverter.toRGB(new BB.HSV(this.color.h, 100, 100 - (i / this.canvasSV.height * 100.0)));\r\n            gradient1.addColorStop(0, '#' + BB.ColorConverter.toHexString(colleft));\r\n            gradient1.addColorStop(1, '#' + BB.ColorConverter.toHexString(colright));\r\n            ctx.fillStyle = '#ff0000'; //needed for chrome...otherwise alpha problem\r\n            ctx.fillStyle = gradient1;\r\n            ctx.fillRect(0, i, this.canvasSV.width, 1);\r\n        }\r\n    }\r\n\r\n    private updateSVPointer (): void {\r\n        const left = this.color.s / 100 * this.width - 4;\r\n        const top = (1 - this.color.v / 100) * this.heightSV - 4;\r\n        BB.css(this.pointerSV, {\r\n            left: left + 'px',\r\n            top: top + 'px',\r\n        });\r\n    }\r\n\r\n    private updateHPointer (): void {\r\n        this.pointerH.style.left = (this.color.h / 359.999 * this.width - 1) + 'px';\r\n    }\r\n\r\n\r\n\r\n\r\n    // ----- public ----\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            heightSV: number; // height of saturation/value\r\n            heightH: number; // height of hue\r\n            color: IRGB;\r\n            callback: (c: IRGB) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                width: p.width + 'px',\r\n                position: 'relative',\r\n                overflow: 'hidden',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = (e) => {\r\n            e.preventDefault();\r\n        };\r\n        this.color = BB.ColorConverter.toHSV(new BB.RGB(p.color.r, p.color.g, p.color.b));\r\n        this.width = p.width;\r\n        this.heightSV = p.heightSV;\r\n\r\n        this.canvasSV = BB.canvas(10, 10);\r\n        BB.css(this.canvasSV, {\r\n            width: this.width + 'px',\r\n            height: this.heightSV + 'px',\r\n            cursor: 'crosshair',\r\n        });\r\n\r\n\r\n        this.updateSV();\r\n\r\n        const canvasH = BB.canvas(p.width, p.heightH);\r\n        canvasH.style.cursor = 'ew-resize';\r\n        (() => {\r\n            const ctx = BB.ctx(canvasH);\r\n\r\n            const gradH = ctx.createLinearGradient(0, 0, p.width, 0);\r\n            for (let i = 0; i < 1; i += 0.01) {\r\n                const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\r\n                gradH.addColorStop(i, 'rgba(' + parseInt('' + col.r) + ', ' + parseInt('' + col.g) + ', ' + parseInt('' + col.b) + ', 1)');\r\n            }\r\n            ctx.fillStyle = gradH;\r\n            ctx.fillRect(0, 0, p.width, p.heightH);\r\n\r\n        })();\r\n        BB.css(this.canvasSV, {\r\n            width: p.width + 'px',\r\n            height: p.heightSV + 'px',\r\n            overflow: 'hidden',\r\n            position: 'relative',\r\n        });\r\n        this.canvasSV.style.cssFloat = 'left';\r\n        canvasH.style.cssFloat = 'left';\r\n\r\n        this.rootEl.append(this.canvasSV, canvasH);\r\n\r\n        this.pointerSV = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                width: '8px',\r\n                height: '8px',\r\n                borderRadius: '8px',\r\n                position: 'absolute',\r\n                pointerEvents: 'none',\r\n                boxShadow: '0 0 0 1px #000, inset 0 0 0 1px #fff',\r\n            },\r\n        });\r\n\r\n        this.pointerH = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                width: '0',\r\n                height: p.heightH + 'px',\r\n                borderLeft: '1px solid #fff',\r\n                borderRight: '1px solid #000',\r\n                position: 'absolute',\r\n                top: p.heightSV + 'px',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n\r\n        this.updateSVPointer();\r\n        this.updateHPointer();\r\n\r\n        const virtualHSV = {\r\n            h: 0,\r\n            s: 0,\r\n            v: 0,\r\n        };\r\n\r\n        this.svPointerId = null;\r\n        this.svPointerListener = new BB.PointerListener({\r\n            target: this.canvasSV,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n\r\n                if (event.type === 'pointerdown') {\r\n\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    BB.unfocusAnyInput();\r\n\r\n                    this.svPointerId = event.pointerId;\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.s = event.relX / p.width * 100;\r\n                        virtualHSV.v = 100 - event.relY / p.heightSV * 100;\r\n\r\n                        this.color = new BB.HSV(this.color.h, virtualHSV.s, virtualHSV.v);\r\n\r\n                        this.updateSVPointer();\r\n                        p.callback(BB.ColorConverter.toRGB(this.color));\r\n                    } else {\r\n                        virtualHSV.s = this.color.s;\r\n                        virtualHSV.v = this.color.v;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes('' + event.button) && this.svPointerId === event.pointerId) {\r\n\r\n                    let factor = 1;\r\n                    if (event.button === 'right') {\r\n                        factor = 0.5;\r\n                    }\r\n\r\n                    virtualHSV.s += event.dX / p.width * 100 * factor;\r\n                    virtualHSV.v -= event.dY / p.heightSV * 100 * factor;\r\n\r\n                    this.color = new BB.HSV(this.color.h, virtualHSV.s, virtualHSV.v);\r\n                    this.updateSVPointer();\r\n                    p.callback(BB.ColorConverter.toRGB(this.color));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.svPointerId = null;\r\n                }\r\n\r\n            },\r\n        });\r\n\r\n        this.hPointerId = null;\r\n        this.hPointerListener = new BB.PointerListener({\r\n            target: canvasH,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n\r\n                if (event.type === 'pointerdown') {\r\n                    this.hPointerId = event.pointerId;\r\n                    if (event.button === 'left') {\r\n\r\n                        virtualHSV.h = event.relX / p.width * 359.99;\r\n\r\n                        this.color = new BB.HSV(virtualHSV.h, this.color.s, this.color.v);\r\n                        this.updateSV();\r\n                        this.updateHPointer();\r\n                        p.callback(BB.ColorConverter.toRGB(this.color));\r\n                    } else {\r\n                        virtualHSV.h = this.color.h;\r\n                    }\r\n                }\r\n\r\n                if (event.type === 'pointermove' && ['left', 'right'].includes('' + event.button) && this.hPointerId === event.pointerId) {\r\n\r\n                    const deltaY = Math.abs(event.pageY - event.downPageY!);\r\n                    const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\r\n\r\n                    virtualHSV.h += event.dX / p.width * 359.99 * factor;\r\n\r\n                    if (event.button === 'right') {\r\n                        virtualHSV.h = virtualHSV.h % 359.99;\r\n                        if (virtualHSV.h < 0) {\r\n                            virtualHSV.h += 359.99;\r\n                        }\r\n                    }\r\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\r\n                    this.color = new BB.HSV(virtualHSV.h, this.color.s, this.color.v);\r\n                    this.updateSV();\r\n                    this.updateHPointer();\r\n                    p.callback(BB.ColorConverter.toRGB(this.color));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.hPointerId = null;\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n        const cleardiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                clear: 'both',\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n    setColor (c: IRGB): void {\r\n        this.color = BB.ColorConverter.toHSV(new BB.RGB(c.r, c.g, c.b));\r\n        this.updateSV();\r\n        this.updateSVPointer();\r\n        this.updateHPointer();\r\n    }\r\n\r\n    getColor (): IRGB {\r\n        return BB.ColorConverter.toRGB(this.color);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.svPointerListener.destroy();\r\n        this.hPointerListener.destroy();\r\n    }\r\n\r\n    end (): void {\r\n        this.svPointerId = null;\r\n        this.hPointerId = null;\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n/**\r\n * A slider that looks like this\r\n * ------O----\r\n */\r\nexport class PointSlider {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly sliderPoint: HTMLElement;\r\n    private readonly pointerListener: PointerListener;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            init: number;\r\n            width: number;\r\n            pointSize: number;\r\n            callback: (value: number, isFirst: boolean, isLast: boolean) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n            },\r\n        });\r\n        const sliderLine = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-point-slider__line',\r\n            css: {\r\n                marginTop: parseInt('' + (p.pointSize / 2 - 1)) + 'px',\r\n                width: p.width + 'px',\r\n            },\r\n        });\r\n        this.sliderPoint = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-point-slider__point',\r\n        });\r\n        let sliderPos: number;\r\n        let isDragging = false;\r\n\r\n        //sliderPoint\r\n        const touchAreaEl = BB.el({ // expand clickable area\r\n            parent: this.sliderPoint,\r\n            css: {\r\n                // background: 'rgba(255,0,0,0.4)',\r\n                margin: '-7px 0 0 -7px',\r\n                width: 'calc(100% + 14px)',\r\n                height: 'calc(100% + 7px)',\r\n            },\r\n        });\r\n\r\n        const redrawPoint = () => {\r\n            BB.css(this.sliderPoint, {\r\n                left: sliderPos + 'px',\r\n            });\r\n        };\r\n        const getValue = () => {\r\n            return sliderPos /  (p.width - p.pointSize);\r\n        };\r\n\r\n        {\r\n            let isFirst: boolean;\r\n            sliderPos = BB.clamp(p.init * (p.width - p.pointSize), 0, p.width - p.pointSize);\r\n            BB.css(this.sliderPoint, {\r\n                width: p.pointSize + 'px',\r\n                height: p.pointSize + 'px',\r\n                borderRadius: p.pointSize + 'px',\r\n            });\r\n            redrawPoint();\r\n            let imaginaryPos: number;\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.sliderPoint,\r\n                fixScribble: true,\r\n                onPointer: (event): void => {\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        isFirst = true;\r\n                        isDragging = true;\r\n                        imaginaryPos = sliderPos;\r\n                        redrawPoint();\r\n                        event.eventStopPropagation();\r\n                    } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                        event.eventStopPropagation();\r\n                        imaginaryPos = imaginaryPos + event.dX;\r\n                        sliderPos = parseInt('' + BB.clamp(imaginaryPos, 0, p.width - p.pointSize));\r\n                        redrawPoint();\r\n                        p.callback(getValue(), isFirst, false);\r\n                        isFirst = false;\r\n                    }\r\n                    if (event.type === 'pointerup') {\r\n                        event.eventStopPropagation();\r\n                        isDragging = false;\r\n                        redrawPoint();\r\n                        p.callback(getValue(), false, true);\r\n                    }\r\n                },\r\n            });\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getEl (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setActive (isActive: boolean): void {\r\n        this.sliderPoint.style.backgroundColor = isActive ? '#fff' : '#eaeaea';\r\n    }\r\n\r\n    destroy (): void {\r\n        this.pointerListener.destroy();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IRGBA} from '../../kl-types';\r\nimport {theme} from '../../../theme/theme';\r\n\r\n/**\r\n * UI to pick between colors in colorArr. can display full transparent (checkerboard).\r\n * Can't deal with 0.5 alpha.\r\n * Rectangular buttons.\r\n */\r\nexport class ColorOptions {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly buttonArr: {\r\n        el: HTMLElement;\r\n        setIsSelected: (b: boolean) => void;\r\n    }[];\r\n\r\n    private readonly updateCheckerboard: () => void;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            colorArr: IRGBA[]; // duplicates will be removed\r\n            onChange: (rgbaObj: IRGBA) => void;\r\n            label?: string;\r\n            initialIndex?: number; // index before duplicates were removed\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            content: p.label ? p.label : '',\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n\r\n        let selectedIndex = 0;\r\n        const colorArr: IRGBA[] = [];\r\n        this.buttonArr = [];\r\n        const buttonSize = 22;\r\n        const checkerUrl = BB.createCheckerDataUrl(5, undefined, theme.isDark());\r\n\r\n        // build colorArr while removing duplicates\r\n        for (let i = 0; i < p.colorArr.length; i++) {\r\n            const item = p.colorArr[i];\r\n            let found = false;\r\n            for (let e = 0; e < colorArr.length; e++) {\r\n                const sItem = colorArr[e];\r\n                if (sItem === null || item === null) {\r\n                    continue;\r\n                }\r\n                if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\r\n                    found = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (found) {\r\n                continue;\r\n            }\r\n            colorArr.push(item);\r\n            if ('initialIndex' in p && p.initialIndex === i) {\r\n                selectedIndex = colorArr.length - 1;\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < colorArr.length; i++) {\r\n            ((i) => {\r\n\r\n                const colorButton = BB.el({\r\n                    parent: this.rootEl,\r\n                    content: colorArr[i] ? '' : 'X',\r\n                    className: 'kl-color-option',\r\n                    css: {\r\n                        width: buttonSize + 'px',\r\n                        height: buttonSize + 'px',\r\n                        backgroundColor: colorArr[i] ? BB.ColorConverter.toRgbaStr(colorArr[i]) : 'transparent',\r\n                        lineHeight: (buttonSize + 1) + 'px',\r\n                    },\r\n                    onClick: (e) => {\r\n                        e.preventDefault();\r\n                        selectedIndex = i;\r\n                        update();\r\n                        p.onChange(colorArr[i]);\r\n                    },\r\n                });\r\n                if (colorArr[i] && colorArr[i].a === 0) {\r\n                    colorButton.style.backgroundImage = 'url(' + checkerUrl + ')';\r\n                }\r\n\r\n                const setIsSelected = (b: boolean): void => {\r\n                    colorButton.classList.toggle('kl-color-option--active', b);\r\n                };\r\n\r\n                this.buttonArr.push({\r\n                    el: colorButton,\r\n                    setIsSelected,\r\n                });\r\n            })(i);\r\n        }\r\n\r\n\r\n        const update = () => {\r\n            for (let i = 0; i < this.buttonArr.length; i++) {\r\n                this.buttonArr[i].setIsSelected(i === selectedIndex);\r\n            }\r\n        };\r\n        update();\r\n\r\n        this.updateCheckerboard = (): void => {\r\n            const checkerUrl = BB.createCheckerDataUrl(5, undefined, theme.isDark());\r\n            this.buttonArr.forEach((button, i) => {\r\n                if (colorArr[i] && colorArr[i].a === 0) {\r\n                    button.el.style.backgroundImage = 'url(' + checkerUrl + ')';\r\n                }\r\n            });\r\n        };\r\n        theme.addIsDarkListener(this.updateCheckerboard);\r\n    }\r\n\r\n    // ---- interface ----\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.buttonArr.forEach(item => {\r\n            BB.destroyEl(item.el);\r\n        });\r\n        this.buttonArr.splice(0, this.buttonArr.length);\r\n        theme.removeIsDarkListener(this.updateCheckerboard);\r\n    }\r\n\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * selectable options\r\n */\r\nexport class Options<IdType> {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private selectedId: IdType;\r\n    private readonly optionArr: {\r\n        id: IdType;\r\n        el: HTMLElement;\r\n    }[];\r\n    private readonly onChange: ((id: IdType) => void) | undefined;\r\n\r\n    private getIndex (): number {\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            if (this.optionArr[i].id === this.selectedId) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    private update (): void {\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            this.optionArr[i].el.classList.toggle(\r\n                'kl-option-selected',\r\n                this.optionArr[i].id === this.selectedId\r\n            );\r\n        }\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            optionArr: {\r\n                id: IdType;\r\n                label: string | HTMLElement | SVGElement;\r\n                title?: string;\r\n            }[];\r\n            initId?: IdType;\r\n            onChange?: (id: IdType) => void;\r\n            changeOnInit?: boolean; // trigger change on creation\r\n            isSmall? :boolean;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el();\r\n\r\n        const wrapperEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-option-wrapper',\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        if (p.onChange) {\r\n            this.onChange = p.onChange;\r\n        }\r\n        this.optionArr = [];\r\n        this.selectedId = ('initialId' in p && p.initId !== undefined) ? p.initId : p.optionArr[0].id;\r\n\r\n        const createOption = (o: {\r\n            id: IdType;\r\n            label: string | HTMLElement | SVGElement;\r\n            title?: string;\r\n        }) => {\r\n\r\n            const classArr = ['kl-option'];\r\n            if (p.isSmall) {\r\n                classArr.push('kl-option--small');\r\n            }\r\n            if (typeof o.label !== 'string') {\r\n                classArr.push('kl-option--custom-el');\r\n                BB.css(o.label, {\r\n                    display: 'block',\r\n                    pointerEvents: 'none',\r\n                });\r\n            }\r\n\r\n            const optionObj = {\r\n                id: o.id,\r\n                el: BB.el({\r\n                    parent: wrapperEl,\r\n                    content: o.label,\r\n                    className: classArr.join(' '),\r\n                    onClick: () => {\r\n                        if (this.selectedId !== optionObj.id) {\r\n                            this.selectedId = optionObj.id;\r\n                            this.update();\r\n                            this.onChange && this.onChange(this.selectedId);\r\n                        }\r\n                    },\r\n                }),\r\n            };\r\n\r\n            if (o.title) {\r\n                optionObj.el.title = o.title;\r\n            }\r\n\r\n            this.optionArr.push(optionObj);\r\n        };\r\n\r\n        for (let i = 0; i < p.optionArr.length; i++) {\r\n            createOption(p.optionArr[i]);\r\n        }\r\n\r\n        this.update();\r\n\r\n        if (p.changeOnInit) {\r\n            setTimeout(() => {\r\n                this.onChange && this.onChange(this.selectedId);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getValue (): IdType {\r\n        return this.selectedId;\r\n    }\r\n\r\n    next (): void {\r\n        this.selectedId = this.optionArr[(this.getIndex() + 1) % this.optionArr.length].id;\r\n        this.update();\r\n        this.onChange && this.onChange(this.selectedId);\r\n    }\r\n\r\n    previous (): void {\r\n        this.selectedId = this.optionArr[(this.optionArr.length + this.getIndex() - 1) % this.optionArr.length].id;\r\n        this.update();\r\n        this.onChange && this.onChange(this.selectedId);\r\n    }\r\n\r\n    destroy (): void {\r\n        this.optionArr.forEach(item => {\r\n            BB.destroyEl(item.el);\r\n        });\r\n        this.optionArr.splice(0, this.optionArr.length);\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport angleSvg from '/src/app/img/ui/angle.svg';\r\n\r\n\r\ntype TUiState = 'left' | 'right';\r\n\r\n/**\r\n * display little messages at the top of KlWorkspace\r\n */\r\nexport class StatusOverlay {\r\n\r\n    private el: HTMLDivElement;\r\n    private innerEl: HTMLDivElement;\r\n    private angleIm: HTMLImageElement;\r\n    private innerInnerEl: HTMLDivElement;\r\n    private isWide: boolean;\r\n    private uiState: TUiState;\r\n\r\n    private timeout: number;\r\n    private timeout2: number;\r\n    private timeout3: number;\r\n\r\n    private updateUiState () {\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n        setTimeout(()=>{}, 100);\r\n        if (this.uiState === 'left') {\r\n            this.el.style.left = '271px';\r\n        } else {\r\n            this.el.style.removeProperty('left');\r\n        }\r\n    }\r\n\r\n    private init () {\r\n        this.el = BB.el({\r\n            className: 'top-overlay g-root',\r\n            onClick: BB.handleClick,\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n        }\r\n\r\n        this.updateUiState();\r\n\r\n        this.innerEl = BB.el({\r\n            className: 'top-overlay--inner',\r\n        }) as HTMLDivElement;\r\n\r\n\r\n        this.angleIm = new Image();\r\n        this.angleIm.src = angleSvg;\r\n        BB.css(this.angleIm, {\r\n            verticalAlign: 'bottom',\r\n            width: '20px',\r\n            height: '20px',\r\n            marginLeft: '5px',\r\n            borderRadius: '10px',\r\n        });\r\n\r\n        this.innerInnerEl = document.createElement('div');\r\n        this.innerInnerEl.style.display = 'inline-block';\r\n\r\n        this.innerEl.append(this.innerInnerEl, this.angleIm);\r\n        this.el.append(this.innerEl);\r\n        document.body.append(this.el);\r\n        this.el.style.display = 'none';\r\n    }\r\n\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        this.init();\r\n    }\r\n\r\n    setWide (b: boolean) {\r\n        this.isWide = !!b;\r\n\r\n        if (!this.el) {\r\n            return;\r\n        }\r\n\r\n        if (this.isWide) {\r\n            this.el.style.width = '100%';\r\n            this.el.style.left = '';\r\n        } else {\r\n            this.el.style.removeProperty('width');\r\n            this.el.style.left = this.uiState === 'left' ? '271px' : '';\r\n        }\r\n    }\r\n\r\n    setUiState (state: TUiState) {\r\n        this.uiState = state;\r\n        this.updateUiState();\r\n    }\r\n\r\n    out (msg: string | {type: 'transform'; angleDeg: number; scale: number}, doPulse?: boolean) {\r\n\r\n        if (msg && typeof msg === 'object') {\r\n\r\n            if (msg.type === 'transform') {\r\n                this.angleIm.style.display = 'inline-block';\r\n                this.angleIm.style.transform = 'rotate(' + msg.angleDeg + 'deg)';\r\n\r\n                if (msg.angleDeg % 90 === 0) {\r\n                    this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255, 255, 255, 0.7)';\r\n                } else {\r\n                    this.angleIm.style.boxShadow = '';\r\n                }\r\n\r\n                this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + '%';\r\n\r\n\r\n            } else {\r\n                this.angleIm.style.display = 'none';\r\n            }\r\n\r\n\r\n\r\n        } else if (typeof msg === 'string') {\r\n            this.angleIm.style.display = 'none';\r\n            this.innerInnerEl.innerHTML = msg;\r\n        }\r\n\r\n        if (doPulse) {\r\n            this.innerEl.style.animation = '';\r\n            setTimeout(\r\n                () => this.innerEl.style.animation = 'topOverlayPulse 0.5s ease-out',\r\n                20\r\n            );\r\n            if (this.timeout3) {\r\n                clearTimeout(this.timeout3);\r\n            }\r\n            this.timeout3 = window.setTimeout(\r\n                () => this.innerEl.style.animation = '',\r\n                520\r\n            );\r\n        }\r\n\r\n\r\n\r\n        if (this.timeout) {\r\n            clearTimeout(this.timeout);\r\n        }\r\n        if (this.timeout2) {\r\n            clearTimeout(this.timeout2);\r\n        }\r\n        this.el.style.animationName = doPulse ? 'consoleInFast' : 'consoleIn';\r\n        this.el.style.opacity = '1';\r\n        this.timeout = window.setTimeout(() => {\r\n            this.el.style.opacity = '0';\r\n            this.el.style.animationName = 'consoleOut';\r\n            this.timeout2 = window.setTimeout(() => {\r\n                this.el.style.display = 'none';\r\n                this.timeout2 = 0;\r\n            }, 450);\r\n            this.timeout = 0;\r\n        }, 1200);\r\n        this.el.style.display = 'flex';\r\n    }\r\n\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"iqIgb\");","import {BB} from '../../../bb/bb';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {IRect, IVector2D} from '../../../bb/bb-types';\r\nimport {theme} from '../../../theme/theme';\r\n\r\n/**\r\n * element that lets you crop an image and copy it via right click\r\n */\r\nexport class CropCopy {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly eventTarget: HTMLElement;\r\n    private crop: IRect = {x: 0, y: 0, width: 0, height: 0};\r\n    private readonly croppedCanvas: HTMLCanvasElement;\r\n    private readonly keyListener: KeyListener;\r\n    private readonly pointerListener: PointerListener;\r\n    private readonly canvas: HTMLImageElement | HTMLCanvasElement;\r\n    private readonly onChange: undefined | ((width: number, height: number) => void);\r\n    private readonly selectionRect: HTMLElement;\r\n    private readonly thumbX: number;\r\n    private readonly thumbY: number;\r\n    private readonly scaleW: number;\r\n    private readonly scaleH: number;\r\n    private readonly croppedImage: undefined | HTMLImageElement;\r\n\r\n\r\n    private resetCrop (): void {\r\n        this.crop = {\r\n            x: 0,\r\n            y: 0,\r\n            width: this.canvas.width,\r\n            height: this.canvas.height,\r\n        };\r\n    }\r\n    private updateCroppedCanvas (): void {\r\n        this.croppedCanvas.width = Math.round(this.crop.width);\r\n        this.croppedCanvas.height = Math.round(this.crop.height);\r\n        const ctx = BB.ctx(this.croppedCanvas);\r\n        ctx.drawImage(this.canvas, Math.round(-this.crop.x), Math.round(-this.crop.y));\r\n        if (this.croppedImage) {\r\n            this.croppedImage.src = this.croppedCanvas.toDataURL('image/png');\r\n        }\r\n\r\n        this.onChange && this.onChange(this.croppedCanvas.width, this.croppedCanvas.height);\r\n    }\r\n    private updateSelectionRect (): void {\r\n        BB.css(this.selectionRect, {\r\n            left: (this.thumbX + this.crop.x * this.scaleW) + 'px',\r\n            top: (this.thumbY + this.crop.y * this.scaleH) + 'px',\r\n            width: (this.crop.width * this.scaleW) + 'px',\r\n            height: (this.crop.height * this.scaleH) + 'px',\r\n        });\r\n        this.onChange && this.onChange(Math.round(this.crop.width), Math.round(this.crop.height));\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        param: {\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLImageElement | HTMLCanvasElement;\r\n            isNotCopy: boolean;\r\n            onChange?: (width: number, height: number) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-edit-crop-preview',\r\n            css: {\r\n                position: 'relative',\r\n                height: param.height + 'px',\r\n                width: param.width + 'px',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n        if (param.onChange) {\r\n            this.onChange = param.onChange;\r\n        }\r\n        this.canvas = param.canvas;\r\n\r\n        this.resetCrop();\r\n\r\n\r\n\r\n\r\n        const isInsideSelectionRect = (p: IVector2D): boolean => {\r\n            const rect = {\r\n                x: Math.round(this.thumbX + this.crop.x * this.scaleW),\r\n                y: Math.round(this.thumbY + this.crop.y * this.scaleH),\r\n                width: Math.round(this.crop.width * this.scaleW),\r\n                height: Math.round(this.crop.height * this.scaleH),\r\n            };\r\n            return BB.isInsideRect(p, rect);\r\n        };\r\n\r\n        this.croppedCanvas = BB.canvas();\r\n        this.eventTarget = this.croppedCanvas;\r\n        if (!param.isNotCopy) {\r\n            this.croppedImage = new Image();\r\n            this.eventTarget = this.croppedImage;\r\n        }\r\n        BB.css(this.eventTarget, {\r\n            height: param.height + 'px',\r\n            width: param.width + 'px',\r\n        });\r\n        this.rootEl.append(this.eventTarget);\r\n        this.updateCroppedCanvas();\r\n\r\n        const padding = 20;\r\n        const previewWrapper = BB.el({\r\n            css: {\r\n                width: param.width + 'px',\r\n                height: param.height + 'px',\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        this.rootEl.append(previewWrapper);\r\n        BB.createCheckerDataUrl(4, (v) => {\r\n            previewWrapper.style.backgroundImage = 'url('+v+')';\r\n        }, theme.isDark());\r\n\r\n        const thumbSize = BB.fitInto(this.canvas.width, this.canvas.height, param.width - padding * 2, param.height - padding * 2, 1);\r\n        const thumbCanvas = BB.canvas(Math.round(thumbSize.width), Math.round(thumbSize.height));\r\n        thumbCanvas.style.imageRendering = 'pixelated';\r\n        this.scaleW = thumbCanvas.width / this.canvas.width;\r\n        this.scaleH = thumbCanvas.height / this.canvas.height;\r\n        const thumbCtx = BB.ctx(thumbCanvas);\r\n        thumbCtx.imageSmoothingEnabled = false;\r\n        thumbCtx.drawImage(this.canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);\r\n        previewWrapper.append(thumbCanvas);\r\n        this.thumbX = parseInt('' + ((param.width - thumbCanvas.width) / 2));\r\n        this.thumbY = parseInt('' + ((param.height - thumbCanvas.height) / 2));\r\n        BB.css(thumbCanvas, {\r\n            position: 'absolute',\r\n            left: this.thumbX + 'px',\r\n            top: this.thumbY + 'px',\r\n        });\r\n\r\n        this.selectionRect = BB.el({\r\n            parent: previewWrapper,\r\n            className: 'kl-edit-crop-preview__sel',\r\n        });\r\n        this.updateSelectionRect();\r\n\r\n\r\n        const toOriginalSpace = (p: IVector2D): IVector2D => {\r\n            return {\r\n                x: BB.clamp((p.x - this.thumbX) / this.scaleW, 0, this.canvas.width),\r\n                y: BB.clamp((p.y - this.thumbY) / this.scaleH, 0, this.canvas.height),\r\n            };\r\n        };\r\n        //gen crop from thumb-space points\r\n        const genCrop = (p1: IVector2D, p2: IVector2D): IRect => {\r\n            const topLeftP = {\r\n                x: Math.min(p1.x, p2.x),\r\n                y: Math.min(p1.y, p2.y),\r\n            };\r\n            const bottomRightP = {\r\n                x: Math.max(p1.x, p2.x),\r\n                y: Math.max(p1.y, p2.y),\r\n            };\r\n            const origTopLeftP = toOriginalSpace(topLeftP);\r\n            const origBottomRightP = toOriginalSpace(bottomRightP);\r\n            origTopLeftP.x = Math.floor(origTopLeftP.x);\r\n            origTopLeftP.y = Math.floor(origTopLeftP.y);\r\n            origBottomRightP.x = Math.ceil(origBottomRightP.x);\r\n            origBottomRightP.y = Math.ceil(origBottomRightP.y);\r\n            return {\r\n                x: origTopLeftP.x,\r\n                y: origTopLeftP.y,\r\n                width: origBottomRightP.x - origTopLeftP.x,\r\n                height: origBottomRightP.y - origTopLeftP.y,\r\n            };\r\n        };\r\n\r\n\r\n\r\n        let startP: IVector2D | null;\r\n        let startCrop: IRect | null = null;\r\n        let isDragging = false;\r\n        let didMove = false;\r\n        let updateCropTimeout: ReturnType<typeof setTimeout>;\r\n        this.pointerListener = new BB.PointerListener({\r\n            target: this.eventTarget,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    event.eventPreventDefault();\r\n                    isDragging = true;\r\n                    startP = {\r\n                        x: event.relX,\r\n                        y: event.relY,\r\n                    };\r\n                    if (!this.isReset() && isInsideSelectionRect(startP)) {\r\n                        startCrop = {\r\n                            x: this.crop.x,\r\n                            y: this.crop.y,\r\n                            width: this.crop.width,\r\n                            height: this.crop.height,\r\n                        };\r\n                    } else {\r\n                        this.crop = genCrop(startP, startP);\r\n                    }\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                    event.eventPreventDefault();\r\n                    didMove = true;\r\n                    if (startCrop) {\r\n                        this.crop.x = startCrop.x + Math.round((event.relX - startP!.x) / this.scaleW);\r\n                        this.crop.y = startCrop.y + Math.round((event.relY - startP!.y) / this.scaleH);\r\n                        this.crop.x = BB.clamp(this.crop.x, 0, this.canvas.width - this.crop.width);\r\n                        this.crop.y = BB.clamp(this.crop.y, 0, this.canvas.height - this.crop.height);\r\n                    } else {\r\n                        this.crop = genCrop(startP!, {x: event.relX, y: event.relY});\r\n                    }\r\n                    this.updateSelectionRect();\r\n                } else if (event.type === 'pointerup' && startP) {\r\n                    event.eventPreventDefault();\r\n                    isDragging = false;\r\n                    startCrop = null;\r\n                    startP = null;\r\n                    if (this.crop.width === 0 || this.crop.height === 0 || !didMove) {\r\n                        this.resetCrop();\r\n                        this.updateSelectionRect();\r\n                    }\r\n                    didMove = false;\r\n                    updateCropTimeout = setTimeout(() => this.updateCroppedCanvas(), 1);\r\n                }\r\n            },\r\n        });\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, e, comboStr) => {\r\n                if (isDragging) {\r\n                    return;\r\n                }\r\n                let doUpdate = false;\r\n\r\n                const stepSize = Math.max(1, 1 / this.scaleW);\r\n                const shiftIsPressed = this.keyListener.isPressed('shift');\r\n\r\n                if (keyStr === 'left') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.width = BB.clamp(this.crop.width - stepSize, 1, this.canvas.width - this.crop.x);\r\n                    } else {\r\n                        this.crop.x = BB.clamp(this.crop.x - stepSize, 0, this.canvas.width - this.crop.width);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n                if (keyStr === 'right') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.width = BB.clamp(this.crop.width + stepSize, 1, this.canvas.width - this.crop.x);\r\n                    } else {\r\n                        this.crop.x = BB.clamp(this.crop.x + stepSize, 0, this.canvas.width - this.crop.width);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n                if (keyStr === 'up') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.height = BB.clamp(this.crop.height - stepSize, 1, this.canvas.height - this.crop.y);\r\n                    } else {\r\n                        this.crop.y = BB.clamp(this.crop.y - stepSize, 0, this.canvas.height - this.crop.height);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n                if (keyStr === 'down') {\r\n                    if (shiftIsPressed) {\r\n                        this.crop.height = BB.clamp(this.crop.height + stepSize, 1, this.canvas.height - this.crop.y);\r\n                    } else {\r\n                        this.crop.y = BB.clamp(this.crop.y + stepSize, 0, this.canvas.height - this.crop.height);\r\n                    }\r\n                    doUpdate = true;\r\n                }\r\n\r\n                if (doUpdate) {\r\n                    e.preventDefault();\r\n                    this.updateSelectionRect();\r\n                    clearTimeout(updateCropTimeout);\r\n                    updateCropTimeout = setTimeout(() => this.updateCroppedCanvas(), 100);\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getEl (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n    reset (): void {\r\n        this.resetCrop();\r\n        this.updateCroppedCanvas();\r\n        this.updateSelectionRect();\r\n    }\r\n    destroy (): void {\r\n        this.eventTarget.style.removeProperty('width');\r\n        this.eventTarget.style.removeProperty('height');\r\n        this.keyListener.destroy();\r\n        this.pointerListener.destroy();\r\n    }\r\n    isReset (): boolean {\r\n        return this.crop.x === 0 && this.crop.y === 0 && this.crop.width === this.canvas.width && this.crop.height === this.canvas.height;\r\n    }\r\n    getRect (): IRect {\r\n        return BB.copyObj(this.crop);\r\n    }\r\n    getCroppedImage (): HTMLCanvasElement {\r\n        return this.croppedCanvas;\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {showModal} from './base/showModal';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {LANG} from '../../../language/language';\r\nimport {StatusOverlay} from '../components/status-overlay';\r\nimport {ICropRect} from '../../../bb/bb-types';\r\n\r\nexport function clipboardDialog (\r\n    parent: HTMLElement,\r\n    fullCanvas: HTMLCanvasElement,\r\n    cropCallback: (crop: ICropRect) => void,\r\n    output: StatusOverlay,\r\n    showCrop: boolean, // show crop button\r\n): void {\r\n\r\n    let clipboardItemIsSupported: boolean = false;\r\n    try {\r\n        clipboardItemIsSupported = !!ClipboardItem;\r\n    } catch (e) {}\r\n\r\n    const div = document.createElement('div');\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n\r\n    const topWrapper = BB.el({\r\n        content: LANG('crop-drag-to-crop') + (clipboardItemIsSupported ? '' : '<br>' + LANG('cropcopy-click-hold')),\r\n        css: {\r\n            textAlign: 'center',\r\n        },\r\n    });\r\n    div.append(topWrapper);\r\n\r\n\r\n    const cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 350,\r\n        canvas: fullCanvas,\r\n        isNotCopy: false,\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n    });\r\n    div.append(cropCopy.getEl());\r\n\r\n    function toClipboard () {\r\n        const imgURL = cropCopy.getCroppedImage().toDataURL('image/png');\r\n        setTimeout(async function () {\r\n            try {\r\n                const data = await fetch(imgURL);\r\n                const blob = await data.blob();\r\n                await (navigator.clipboard as any).write([\r\n                    new ClipboardItem({\r\n                        [blob.type]: blob,\r\n                    } as any), // todo check is possible?\r\n                ]);\r\n                setTimeout(function () {\r\n                    output.out(LANG('cropcopy-copied'), true);\r\n                }, 200);\r\n            } catch (err) {\r\n                console.error(err.name, err.message);\r\n            }\r\n        }, 0);\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr, KeyEvent, comboStr) {\r\n            if (comboStr === 'ctrl+c') {\r\n                toClipboard();\r\n                closeFunc && closeFunc();\r\n            }\r\n        },\r\n    });\r\n\r\n    let closeFunc: () => void;\r\n    function blur () {\r\n        closeFunc && closeFunc();\r\n    }\r\n    window.addEventListener('blur', blur);\r\n\r\n    const buttonArr = [];\r\n    if (clipboardItemIsSupported) {\r\n        buttonArr.push(LANG('cropcopy-btn-copy'));\r\n    }\r\n    if (showCrop) {\r\n        buttonArr.push(LANG('cropcopy-btn-crop'));\r\n    }\r\n    buttonArr.push('Cancel');\r\n\r\n    showModal({\r\n        target: parent,\r\n        message: '<b>' + (showCrop ? `${LANG('cropcopy-title-copy')} / ${LANG('cropcopy-title-crop')}` : `${LANG('cropcopy-title-copy')}`) + '</b>',\r\n        div: div,\r\n        style: isSmall ? {} : {\r\n            width: '500px',\r\n        },\r\n        buttons: buttonArr,\r\n        primaries: [LANG('cropcopy-btn-copy')],\r\n        callback: function (result) {\r\n            if (result === LANG('cropcopy-btn-copy')) {\r\n                toClipboard();\r\n            } else if (result === LANG('cropcopy-btn-crop')) {\r\n                const rectObj = cropCopy.getRect();\r\n                cropCallback({\r\n                    left: Math.round(-rectObj.x),\r\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\r\n                    top: Math.round(-rectObj.y),\r\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height),\r\n                });\r\n            }\r\n            window.removeEventListener('blur', blur);\r\n            cropCopy.destroy();\r\n            keyListener.destroy();\r\n        },\r\n        clickOnEnter: LANG('cropcopy-btn-copy'),\r\n        closeFunc: function (func) {\r\n            closeFunc = func;\r\n        },\r\n    });\r\n}","import {BB} from '../../../../bb/bb';\r\nimport {klHistory} from '../../../history/kl-history';\r\nimport {Select} from '../../components/select';\r\nimport {PointSlider} from '../../components/point-slider';\r\nimport {KlCanvas, MAX_LAYERS} from '../../../canvas/kl-canvas';\r\nimport {TMixMode, TUiLayout} from '../../../kl-types';\r\nimport {LANG} from '../../../../language/language';\r\nimport {translateBlending} from '../../../canvas/translate-blending';\r\nimport {PointerListener} from '../../../../bb/input/pointer-listener';\r\nimport {IPointerEvent} from '../../../../bb/input/event.types';\r\nimport {renameLayerDialog} from './rename-layer-dialog';\r\nimport {mergeLayerDialog} from './merge-layer-dialog';\r\nimport addLayerImg from '/src/app/img/ui/add-layer.svg';\r\nimport duplicateLayerImg from '/src/app/img/ui/duplicate-layer.svg';\r\nimport mergeLayerImg from '/src/app/img/ui/merge-layers.svg';\r\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\r\nimport renameLayerImg from '/src/app/img/ui/rename-layer.svg';\r\nimport {theme} from '../../../../theme/theme';\r\n\r\ntype TLayerEl = HTMLElement & {\r\n    label: HTMLElement;\r\n    opacityLabel: HTMLElement;\r\n    thumb: HTMLCanvasElement;\r\n\r\n    spot: number;\r\n    posY: number;\r\n    layerName: string;\r\n    opacity: number;\r\n    pointerListener: PointerListener;\r\n    opacitySlider: PointSlider;\r\n    isSelected: boolean;\r\n};\r\n\r\nexport class LayerManager {\r\n\r\n    private readonly parentEl: HTMLElement;\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly klCanvas: KlCanvas;\r\n    private klCanvasLayerArr: {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: TMixMode;\r\n    }[];\r\n    private readonly layerListEl: HTMLElement;\r\n    private layerElArr: TLayerEl[];\r\n    private selectedSpotIndex: number;\r\n    private readonly removeBtn: HTMLButtonElement;\r\n    private readonly addBtn: HTMLButtonElement;\r\n    private readonly duplicateBtn: HTMLButtonElement;\r\n    private readonly mergeBtn: HTMLButtonElement;\r\n    private readonly modeSelect: Select;\r\n    private uiState: TUiLayout;\r\n    private readonly largeThumbDiv: HTMLElement;\r\n    private oldHistoryState: number | undefined;\r\n\r\n    private readonly largeThumbCanvas: HTMLCanvasElement;\r\n    private largeThumbInDocument: boolean;\r\n    private largeThumbInTimeout: undefined | ReturnType<typeof setTimeout>;\r\n    private largeThumbTimeout: undefined | ReturnType<typeof setTimeout>;\r\n    private lastpos: number = 0;\r\n\r\n    private readonly onSelect: (layerIndex: number) => void;\r\n    private readonly layerHeight: number = 35;\r\n    private readonly layerSpacing: number = 0;\r\n\r\n    private move (oldSpotIndex: number, newSpotIndex: number): void {\r\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) {\r\n            throw 'layermanager - invalid move';\r\n        }\r\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\r\n            ((i) => {\r\n                let posy = this.layerElArr[i].spot; // <- here\r\n                if (this.layerElArr[i].spot === oldSpotIndex) {\r\n                    posy = newSpotIndex;\r\n                } else {\r\n                    if (this.layerElArr[i].spot > oldSpotIndex) {\r\n                        posy--;\r\n                    }\r\n                    if (posy >= newSpotIndex) {\r\n                        posy++;\r\n                    }\r\n                }\r\n                this.layerElArr[i].spot = posy;\r\n                this.layerElArr[i].posY = (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\r\n                this.layerElArr[i].style.top = this.layerElArr[i].posY + 'px';\r\n            })(i);\r\n        }\r\n        if (oldSpotIndex === newSpotIndex) {\r\n            return;\r\n        }\r\n        this.klCanvas.moveLayer(this.selectedSpotIndex, newSpotIndex - oldSpotIndex);\r\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n        this.selectedSpotIndex = newSpotIndex;\r\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\r\n    }\r\n\r\n    private posToSpot (p: number): number {\r\n        let result = parseInt('' + (p / (this.layerHeight + this.layerSpacing) + 0.5));\r\n        result = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, result));\r\n        result = this.klCanvasLayerArr.length - result - 1;\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * update css position of all layers that are not being dragged, while dragging\r\n     */\r\n    private updateLayersVerticalPosition (id: number, newspot: number): void {\r\n        newspot = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, newspot));\r\n        if (newspot === this.lastpos) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\r\n            if (this.layerElArr[i].spot === id) { // <- here\r\n                continue;\r\n            }\r\n            let posy = this.layerElArr[i].spot;\r\n            if (this.layerElArr[i].spot > id) {\r\n                posy--;\r\n            }\r\n            if (posy >= newspot) {\r\n                posy++;\r\n            }\r\n            this.layerElArr[i].posY = (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\r\n            this.layerElArr[i].style.top = this.layerElArr[i].posY + 'px';\r\n        }\r\n        this.lastpos = newspot;\r\n    }\r\n\r\n    private renameLayer (layerSpot: number): void {\r\n\r\n        renameLayerDialog(\r\n            this.parentEl,\r\n            this.klCanvas.getLayer(layerSpot).name,\r\n            (newName) => {\r\n                if (newName === undefined || newName === this.klCanvas.getLayer(layerSpot).name) {\r\n                    return;\r\n                }\r\n                this.klCanvas.renameLayer(layerSpot, newName);\r\n                this.createLayerList();\r\n                klHistory.pause(true);\r\n                this.onSelect(layerSpot);\r\n                klHistory.pause(false);\r\n            }\r\n        );\r\n    }\r\n\r\n    private updateHeight (): void {\r\n        this.layerListEl.style.height = (this.layerElArr.length * 35) + 'px';\r\n    }\r\n\r\n    private createLayerList (): void {\r\n        this.oldHistoryState = klHistory.getState();\r\n        const createLayerEntry = (index: number): void => {\r\n            const layerName = this.klCanvas.getLayer(index).name;\r\n            const opacity = this.klCanvasLayerArr[index].opacity;\r\n            const layercanvas = this.klCanvasLayerArr[index].context.canvas;\r\n\r\n            const layer: TLayerEl = BB.el() as TLayerEl;\r\n            layer.className = 'kl-layer';\r\n            this.layerElArr[index] = layer;\r\n            layer.posY = ((this.klCanvasLayerArr.length - 1) * 35 - index * 35);\r\n            BB.css(layer, {\r\n                top: layer.posY + 'px',\r\n            });\r\n            const innerLayer = BB.el();\r\n            BB.css(innerLayer, {\r\n                position: 'relative',\r\n            });\r\n\r\n            const container1 = BB.el();\r\n            BB.css(container1, {\r\n                width: '250px',\r\n                height: '34px',\r\n            });\r\n            const container2 = BB.el();\r\n            layer.append(innerLayer);\r\n            innerLayer.append(container1, container2);\r\n\r\n            layer.spot = index;\r\n\r\n            //thumb\r\n            {\r\n                const thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\r\n                const thumb = layer.thumb = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n\r\n                const thc = BB.ctx(thumb);\r\n                thc.save();\r\n                if (thumb.width > layercanvas.width) {\r\n                    thc.imageSmoothingEnabled = false;\r\n                }\r\n                thc.drawImage(layercanvas, 0, 0, thumb.width, thumb.height);\r\n                thc.restore();\r\n                BB.css(layer.thumb, {\r\n                    position: 'absolute',\r\n                    left: ((32 - layer.thumb.width) / 2) + 'px',\r\n                    top: ((32 - layer.thumb.height) / 2) + 'px',\r\n                });\r\n                BB.createCheckerDataUrl(4, (url) => {\r\n                    thumb.style.backgroundImage = 'url(' + url + ')';\r\n                }, theme.isDark());\r\n            }\r\n\r\n            //layerlabel\r\n            {\r\n                layer.label = BB.el({\r\n                    className: 'kl-layer__label',\r\n                });\r\n                layer.layerName = layerName;\r\n                layer.label.append(layer.layerName);\r\n\r\n                BB.css(layer.label, {\r\n                    position: 'absolute',\r\n                    left: (1 + 32 + 5) + 'px',\r\n                    top: 1 + 'px',\r\n                    fontSize: '13px',\r\n                    width: '170px',\r\n                    height: '20px',\r\n                    overflow: 'hidden',\r\n                    whiteSpace: 'nowrap',\r\n                });\r\n\r\n                layer.label.ondblclick = () => {\r\n                    this.renameLayer(layer.spot);\r\n                };\r\n            }\r\n            //layerlabel\r\n            {\r\n                layer.opacityLabel = BB.el({\r\n                    className: 'kl-layer__opacity-label',\r\n                });\r\n                layer.opacity = opacity;\r\n                layer.opacityLabel.append(parseInt('' + (layer.opacity * 100)) + '%');\r\n\r\n                BB.css(layer.opacityLabel, {\r\n                    position: 'absolute',\r\n                    left: (250 - 1 - 5 - 50) + 'px',\r\n                    top: 1 + 'px',\r\n                    fontSize: '13px',\r\n                    textAlign: 'right',\r\n                    width: '50px',\r\n                    transition: 'color 0.2s ease-in-out',\r\n                });\r\n            }\r\n\r\n            let oldOpacity: number;\r\n            const opacitySlider = new PointSlider({\r\n                init: layer.opacity,\r\n                width: 204,\r\n                pointSize: 14,\r\n                callback: (sliderValue, isFirst, isLast) => {\r\n                    if (isFirst) {\r\n                        oldOpacity = this.klCanvas.getLayer(layer.spot).opacity;\r\n                        klHistory.pause(true);\r\n                        return;\r\n                    }\r\n                    if (isLast) {\r\n                        klHistory.pause(false);\r\n                        if (oldOpacity !== sliderValue) {\r\n                            this.klCanvas.layerOpacity(layer.spot, sliderValue);\r\n                        }\r\n                        return;\r\n                    }\r\n                    layer.opacityLabel.innerHTML = Math.round(sliderValue * 100) + '%';\r\n                    this.klCanvas.layerOpacity(layer.spot, sliderValue);\r\n                },\r\n            });\r\n            BB.css(opacitySlider.getEl(), {\r\n                position: 'absolute',\r\n                left: '39px',\r\n                top: '17px',\r\n            });\r\n            layer.opacitySlider = opacitySlider;\r\n\r\n            //larger layer preview - hover\r\n            layer.thumb.onpointerover = (e) => {\r\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== 'touch')) { //shouldn't show while dragging\r\n                    return;\r\n                }\r\n\r\n                const thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\r\n\r\n                if (this.largeThumbCanvas.width !== thumbDimensions.width || this.largeThumbCanvas.height !== thumbDimensions.height) {\r\n                    this.largeThumbCanvas.width = thumbDimensions.width;\r\n                    this.largeThumbCanvas.height = thumbDimensions.height;\r\n                }\r\n                const ctx = BB.ctx(this.largeThumbCanvas);\r\n                ctx.save();\r\n                if (this.largeThumbCanvas.width > layercanvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.imageSmoothingQuality = 'high';\r\n                ctx.clearRect(0, 0, this.largeThumbCanvas.width, this.largeThumbCanvas.height);\r\n                ctx.drawImage(layercanvas, 0, 0, this.largeThumbCanvas.width, this.largeThumbCanvas.height);\r\n                ctx.restore();\r\n                BB.css(this.largeThumbDiv, {\r\n                    top: (e.clientY - this.largeThumbCanvas.height / 2) + 'px',\r\n                    opacity: '0',\r\n                });\r\n                if (!this.largeThumbInDocument) {\r\n                    document.body.append(this.largeThumbDiv);\r\n                    this.largeThumbInDocument = true;\r\n                }\r\n                clearTimeout(this.largeThumbInTimeout);\r\n                this.largeThumbInTimeout = setTimeout(() => {\r\n                    BB.css(this.largeThumbDiv, {\r\n                        opacity: '1',\r\n                    });\r\n                }, 20);\r\n                clearTimeout(this.largeThumbTimeout);\r\n            };\r\n            layer.thumb.onpointerout = () => {\r\n                clearTimeout(this.largeThumbInTimeout);\r\n                BB.css(this.largeThumbDiv, {\r\n                    opacity: '0',\r\n                });\r\n                clearTimeout(this.largeThumbTimeout);\r\n                this.largeThumbTimeout = setTimeout(() => {\r\n                    if (!this.largeThumbInDocument) {\r\n                        return;\r\n                    }\r\n                    document.body.removeChild(this.largeThumbDiv);\r\n                    this.largeThumbInDocument = false;\r\n                }, 300);\r\n            };\r\n\r\n            container1.append(layer.thumb, layer.label, layer.opacityLabel, opacitySlider.getEl());\r\n            let dragstart = false;\r\n            let freshSelection = false;\r\n\r\n            //events for moving layers up and down\r\n            const dragEventHandler = (event: IPointerEvent) => {\r\n                if (event.type === 'pointerdown' && event.button === 'left') {\r\n                    BB.css(layer, {\r\n                        transition: 'box-shadow 0.3s ease-in-out',\r\n                    });\r\n                    layer.style.zIndex = '1';\r\n                    this.lastpos = layer.spot;\r\n                    freshSelection = false;\r\n                    if (!layer.isSelected) {\r\n                        freshSelection = true;\r\n                        this.activateLayer(layer.spot);\r\n                    }\r\n                    dragstart = true;\r\n\r\n                } else if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    if (dragstart) {\r\n                        dragstart = false;\r\n                        BB.css(layer, {\r\n                            boxShadow: '1px 3px 5px rgba(0,0,0,0.4)',\r\n                        });\r\n                    }\r\n                    layer.posY += event.dY;\r\n                    const corrected = Math.max(0, Math.min((this.klCanvasLayerArr.length - 1) * (35), layer.posY));\r\n                    layer.style.top = corrected + 'px';\r\n                    this.updateLayersVerticalPosition(layer.spot, this.posToSpot(layer.posY));\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    BB.css(layer, {\r\n                        transition: 'all 0.1s linear',\r\n                    });\r\n                    setTimeout(() => {\r\n                        BB.css(layer, {\r\n                            boxShadow: '',\r\n                        });\r\n                    }, 20);\r\n                    layer.posY = Math.max(0, Math.min((this.klCanvasLayerArr.length - 1) * (35), layer.posY));\r\n                    layer.style.zIndex = '';\r\n                    const newSpot = this.posToSpot(layer.posY);\r\n                    const oldSpot = layer.spot;\r\n                    this.move(layer.spot, newSpot);\r\n                    if (oldSpot != newSpot) {\r\n                        klHistory.pause(true);\r\n                        this.onSelect(this.selectedSpotIndex);\r\n                        klHistory.pause(false);\r\n                    }\r\n                    if (oldSpot === newSpot && freshSelection) {\r\n                        this.onSelect(this.selectedSpotIndex);\r\n                    }\r\n                    freshSelection = false;\r\n                }\r\n            };\r\n\r\n            layer.pointerListener = new BB.PointerListener({\r\n                target: container1,\r\n                onPointer: dragEventHandler,\r\n            });\r\n\r\n            this.layerListEl.append(layer);\r\n        };\r\n        this.layerElArr = [];\r\n        while (this.layerListEl.firstChild) {\r\n            const child = this.layerListEl.firstChild as TLayerEl;\r\n            child.pointerListener.destroy();\r\n            child.opacitySlider.destroy();\r\n            this.layerListEl.removeChild(child);\r\n        }\r\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\r\n            createLayerEntry(i);\r\n        }\r\n        this.activateLayer(this.selectedSpotIndex);\r\n        this.updateHeight();\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        klCanvas: KlCanvas,\r\n        onSelect: (layerIndex: number) => void,\r\n        parentEl: HTMLElement,\r\n        uiState: TUiLayout,\r\n    ) {\r\n        this.parentEl = parentEl;\r\n        this.klCanvas = klCanvas;\r\n        this.layerElArr = [];\r\n        this.layerHeight = 35;\r\n        this.layerSpacing = 0;\r\n        const width = 250;\r\n        this.onSelect = onSelect;\r\n        this.uiState = uiState;\r\n\r\n        this.largeThumbDiv = BB.el({\r\n            onClick: BB.handleClick,\r\n            css: {\r\n                position: 'absolute',\r\n                top: '500px',\r\n                background: '#aaa',\r\n                boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\r\n                pointerEvents: 'none',\r\n                padding: '0',\r\n                border: '1px solid #aaa',\r\n                transition: 'opacity 0.3s ease-out',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.setUiState(uiState);\r\n        BB.createCheckerDataUrl(4, (url) => {\r\n            this.largeThumbDiv.style.backgroundImage = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n        this.largeThumbCanvas = BB.canvas(200, 200);\r\n        this.largeThumbCanvas.style.display = 'block';\r\n        this.largeThumbDiv.append(this.largeThumbCanvas);\r\n        this.largeThumbInDocument = false;\r\n\r\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n        this.selectedSpotIndex = this.klCanvasLayerArr.length - 1;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                marginRight: '10px',\r\n                marginBottom: '10px',\r\n                marginLeft: '10px',\r\n                marginTop: '10px',\r\n                cursor: 'default',\r\n            },\r\n        });\r\n\r\n        const listDiv = BB.el({\r\n            css: {\r\n                width: width + 'px',\r\n                position: 'relative',\r\n            },\r\n        });\r\n\r\n        this.layerListEl = BB.el();\r\n\r\n        this.addBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n        this.duplicateBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n        this.mergeBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n        this.removeBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n        const renameBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n\r\n        const createButtons = () => {\r\n            const div = BB.el();\r\n            const async = () => {\r\n                BB.makeUnfocusable(this.addBtn);\r\n                BB.makeUnfocusable(this.duplicateBtn);\r\n                BB.makeUnfocusable(this.mergeBtn);\r\n                BB.makeUnfocusable(this.removeBtn);\r\n                BB.makeUnfocusable(renameBtn);\r\n\r\n                this.addBtn.style.cssFloat = 'left';\r\n                this.duplicateBtn.style.cssFloat = 'left';\r\n                this.mergeBtn.style.cssFloat = 'left';\r\n                this.removeBtn.style.cssFloat = 'left';\r\n                renameBtn.style.cssFloat = 'left';\r\n\r\n                this.addBtn.title = LANG('layers-new');\r\n                this.duplicateBtn.title = LANG('layers-duplicate');\r\n                this.removeBtn.title = LANG('layers-remove');\r\n                this.mergeBtn.title = LANG('layers-merge');\r\n                renameBtn.title = LANG('layers-rename-title');\r\n\r\n                this.addBtn.style.paddingLeft = '5px';\r\n                this.addBtn.style.paddingRight = '3px';\r\n\r\n                this.removeBtn.style.paddingLeft = '5px';\r\n                this.removeBtn.style.paddingRight = '3px';\r\n\r\n                this.duplicateBtn.style.paddingLeft = '5px';\r\n                this.duplicateBtn.style.paddingRight = '3px';\r\n\r\n                this.mergeBtn.style.paddingLeft = '5px';\r\n                this.mergeBtn.style.paddingRight = '3px';\r\n\r\n                renameBtn.style.height = '30px';\r\n                renameBtn.style.lineHeight = '20px';\r\n\r\n                this.addBtn.innerHTML = \"<img src='\" + addLayerImg + \"' height='20'/>\";\r\n                this.duplicateBtn.innerHTML = \"<img src='\" + duplicateLayerImg + \"' height='20'/>\";\r\n                this.mergeBtn.innerHTML = \"<img src='\" + mergeLayerImg + \"' height='20'/>\";\r\n                this.removeBtn.innerHTML = \"<img src='\" + removeLayerImg + \"' height='20'/>\";\r\n                renameBtn.innerHTML = \"<img src='\" + renameLayerImg + \"' height='20'/>\";\r\n                this.addBtn.style.marginRight = '5px';\r\n                this.removeBtn.style.marginRight = '5px';\r\n                this.duplicateBtn.style.marginRight = '5px';\r\n                this.mergeBtn.style.marginRight = '5px';\r\n                div.append(\r\n                    this.addBtn,\r\n                    this.removeBtn,\r\n                    this.duplicateBtn,\r\n                    this.mergeBtn,\r\n                    renameBtn,\r\n                    BB.el({\r\n                        css: {\r\n                            clear: 'both',\r\n                            height: '10px',\r\n                        },\r\n                    }),\r\n                );\r\n\r\n                this.addBtn.onclick = () => {\r\n                    if (this.klCanvas.addLayer(this.selectedSpotIndex) === false) {\r\n                        return;\r\n                    }\r\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n\r\n                    if (this.klCanvasLayerArr.length === MAX_LAYERS) {\r\n                        this.addBtn.disabled = true;\r\n                        this.duplicateBtn.disabled = true;\r\n                    }\r\n                    this.removeBtn.disabled = false;\r\n                    this.selectedSpotIndex = this.selectedSpotIndex + 1;\r\n                    this.createLayerList();\r\n                    klHistory.pause(true);\r\n                    this.onSelect(this.selectedSpotIndex);\r\n                    klHistory.pause(false);\r\n                };\r\n                this.duplicateBtn.onclick = () => {\r\n                    if (this.klCanvas.duplicateLayer(this.selectedSpotIndex) === false) {\r\n                        return;\r\n                    }\r\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n                    if (this.klCanvasLayerArr.length === MAX_LAYERS) {\r\n                        this.addBtn.disabled = true;\r\n                        this.duplicateBtn.disabled = true;\r\n                    }\r\n                    this.removeBtn.disabled = false;\r\n                    this.selectedSpotIndex++;\r\n                    this.createLayerList();\r\n                    klHistory.pause(true);\r\n                    this.onSelect(this.selectedSpotIndex);\r\n                    klHistory.pause(false);\r\n                };\r\n                this.removeBtn.onclick = () => {\r\n                    if (this.layerElArr.length <= 1) {\r\n                        return;\r\n                    }\r\n\r\n                    this.klCanvas.removeLayer(this.selectedSpotIndex);\r\n                    if (this.selectedSpotIndex > 0) {\r\n                        this.selectedSpotIndex--;\r\n                    }\r\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n                    this.createLayerList();\r\n                    klHistory.pause(true);\r\n                    this.onSelect(this.selectedSpotIndex);\r\n                    klHistory.pause(false);\r\n                    if (this.klCanvasLayerArr.length === 1) {\r\n                        this.removeBtn.disabled = true;\r\n                    }\r\n                    if (this.klCanvasLayerArr.length < MAX_LAYERS) {\r\n                        this.addBtn.disabled = false;\r\n                        this.duplicateBtn.disabled = false;\r\n                    }\r\n                };\r\n                this.mergeBtn.onclick = () => {\r\n                    if (this.selectedSpotIndex <= 0) {\r\n                        return;\r\n                    }\r\n                    mergeLayerDialog(this.parentEl, {\r\n                        topCanvas: this.klCanvasLayerArr[this.selectedSpotIndex].context.canvas,\r\n                        bottomCanvas: this.klCanvasLayerArr[this.selectedSpotIndex - 1].context.canvas,\r\n                        topOpacity: this.klCanvas.getLayer(this.selectedSpotIndex).opacity,\r\n                        mixModeStr: this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr,\r\n                        callback: (mode) => {\r\n                            this.klCanvas.mergeLayers(this.selectedSpotIndex, this.selectedSpotIndex - 1, mode);\r\n                            this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n                            this.selectedSpotIndex--;\r\n                            if (this.klCanvasLayerArr.length === 1) {\r\n                                this.removeBtn.disabled = true;\r\n                            }\r\n                            if (this.klCanvasLayerArr.length < MAX_LAYERS) {\r\n                                this.addBtn.disabled = false;\r\n                                this.duplicateBtn.disabled = false;\r\n                            }\r\n                            this.createLayerList();\r\n                            klHistory.pause(true);\r\n                            this.onSelect(this.selectedSpotIndex);\r\n                            klHistory.pause(false);\r\n                        },\r\n                    });\r\n                };\r\n\r\n                renameBtn.onclick = () => {\r\n                    this.renameLayer(this.selectedSpotIndex);\r\n                };\r\n            };\r\n            setTimeout(async, 1);\r\n            return div;\r\n        };\r\n        this.rootEl.append(createButtons());\r\n\r\n        let modeWrapper;\r\n        {\r\n            modeWrapper = BB.el({\r\n                content: LANG('layers-blending') + '&nbsp;',\r\n                css: {\r\n                    fontSize: '15px',\r\n                },\r\n            });\r\n\r\n            this.modeSelect = new Select({\r\n                optionArr: [\r\n                    'source-over',\r\n                    null,\r\n                    'darken',\r\n                    'multiply',\r\n                    'color-burn',\r\n                    null,\r\n                    'lighten',\r\n                    'screen',\r\n                    'color-dodge',\r\n                    null,\r\n                    'overlay',\r\n                    'soft-light',\r\n                    'hard-light',\r\n                    null,\r\n                    'difference',\r\n                    'exclusion',\r\n                    null,\r\n                    'hue',\r\n                    'saturation',\r\n                    'color',\r\n                    'luminosity',\r\n                ].map((item: TMixMode) => {\r\n                    return item ? [item, translateBlending(item)] : null;\r\n                }),\r\n                onChange: (val) => {\r\n                    this.klCanvas.setMixMode(this.selectedSpotIndex, val as TMixMode);\r\n                    this.update(this.selectedSpotIndex);\r\n                },\r\n                css: {\r\n                    marginBottom: '10px',\r\n                },\r\n            });\r\n\r\n            modeWrapper.append(this.modeSelect.getElement());\r\n            this.rootEl.append(modeWrapper);\r\n\r\n        }\r\n\r\n\r\n        listDiv.append(this.layerListEl);\r\n        this.rootEl.append(listDiv);\r\n\r\n        //updating the thumbs in interval\r\n        //don't update when: manager not visible || layer didn't change || is drawing\r\n        setInterval(() => {\r\n            if (this.rootEl.style.display !== 'block') {\r\n                return;\r\n            }\r\n\r\n            const historyState = klHistory.getState();\r\n            if (historyState === this.oldHistoryState) {\r\n                return;\r\n            }\r\n            this.oldHistoryState = historyState;\r\n\r\n            for (let i = 0; i < this.layerElArr.length; i++) {\r\n                if (this.selectedSpotIndex === this.layerElArr[i].spot && this.klCanvasLayerArr[this.layerElArr[i].spot]) { // second check, because might be out of date\r\n                    const ctx = BB.ctx(this.layerElArr[i].thumb);\r\n                    ctx.save();\r\n                    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n                    if (this.klCanvasLayerArr[this.layerElArr[i].spot].context.canvas.width < this.layerElArr[i].thumb.width) {\r\n                        ctx.imageSmoothingEnabled = false;\r\n                    }\r\n                    ctx.drawImage(this.klCanvasLayerArr[this.layerElArr[i].spot].context.canvas, 0, 0, this.layerElArr[i].thumb.width, this.layerElArr[i].thumb.height);\r\n                    ctx.restore();\r\n                }\r\n            }\r\n\r\n        }, 1);\r\n\r\n        theme.addIsDarkListener(() => {\r\n            this.createLayerList();\r\n        });\r\n\r\n        this.createLayerList();\r\n    }\r\n\r\n    // ---- interface ----\r\n    update (activeLayerSpotIndex?: number): void {\r\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\r\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) {\r\n            this.selectedSpotIndex = activeLayerSpotIndex;\r\n        }\r\n        this.removeBtn.disabled = this.klCanvasLayerArr.length === 1;\r\n        if (this.klCanvasLayerArr.length === MAX_LAYERS) {\r\n            this.addBtn.disabled = true;\r\n            this.duplicateBtn.disabled = true;\r\n        } else {\r\n            this.addBtn.disabled = false;\r\n            this.duplicateBtn.disabled = false;\r\n        }\r\n        setTimeout(() => this.createLayerList(), 1);\r\n    }\r\n\r\n    getSelected (): number {\r\n        return this.selectedSpotIndex;\r\n    }\r\n\r\n    activateLayer (spotIndex: number): void {\r\n        if (spotIndex < 0 || spotIndex > this.layerElArr.length - 1) {\r\n            throw 'invalid spotIndex ' + spotIndex + ', layerElArr.length ' + this.layerElArr.length;\r\n        }\r\n        this.selectedSpotIndex = spotIndex;\r\n        this.modeSelect.setValue(this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr);\r\n        for (let i = 0; i < this.layerElArr.length; i++) {\r\n            const layer = this.layerElArr[i];\r\n            const isSelected = this.selectedSpotIndex === layer.spot;\r\n\r\n            BB.css(layer, {\r\n                boxShadow: '',\r\n            });\r\n            layer.classList.toggle('kl-layer--selected', isSelected);\r\n            layer.opacitySlider.setActive(isSelected);\r\n            layer.isSelected = isSelected;\r\n        }\r\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\r\n    }\r\n\r\n    setUiState (stateStr: TUiLayout): void {\r\n        this.uiState = stateStr;\r\n\r\n        if (this.uiState === 'left') {\r\n            BB.css(this.largeThumbDiv, {\r\n                left: '280px',\r\n                right: '',\r\n            });\r\n        } else {\r\n            BB.css(this.largeThumbDiv, {\r\n                left: '',\r\n                right: '280px',\r\n            });\r\n        }\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {floodFillBits} from '../image-operations/flood-fill';\r\nimport {drawShape} from '../image-operations/shape-tool';\r\nimport {IRenderTextParam, renderText} from '../image-operations/render-text';\r\nimport {IGradient, IKlProject, IRGB, IShapeToolObject, TFillSampling, TKlCanvasLayer, TMixMode} from '../kl-types';\r\nimport {DecoyKlHistory, KlHistoryInterface, THistoryActions} from '../history/kl-history';\r\nimport {drawProject} from './draw-project';\r\nimport {LANG} from '../../language/language';\r\nimport {drawGradient} from '../image-operations/gradient-tool';\r\n\r\nexport type TKlCanvasHistoryEntry = THistoryActions<'canvas', KlCanvas>;\r\n\r\nconst allowedMixModes = [\r\n    'source-over',\r\n    'darken',\r\n    'multiply',\r\n    'color-burn',\r\n    'lighten',\r\n    'screen',\r\n    'color-dodge',\r\n    'overlay',\r\n    'soft-light',\r\n    'hard-light',\r\n    'difference',\r\n    'exclusion',\r\n    'hue',\r\n    'saturation',\r\n    'color',\r\n    'luminosity',\r\n];\r\n\r\nexport const MAX_LAYERS = 16;\r\n\r\ninterface KlCanvasLayer extends HTMLCanvasElement {\r\n    name: string;\r\n    mixModeStr: TMixMode;\r\n    opacity: number;\r\n    compositeObj?: {\r\n        draw: (ctx: CanvasRenderingContext2D) => void;\r\n    };\r\n    index: number; // certain brushes need to know\r\n}\r\n\r\n/**\r\n * The image/canvas that the user paints on\r\n * Has layers. layers have names and opacity.\r\n *\r\n * Interacts with the history you specify (for undo/redo)\r\n */\r\nexport class KlCanvas {\r\n\r\n    // todo changeListener consistent concept\r\n    // todo history interaction, consistent concept - currently have to look at code to know if something pushes on history\r\n\r\n    private width: number;\r\n    private height: number;\r\n    private layerCanvasArr: KlCanvasLayer[];\r\n    private pickCanvas: HTMLCanvasElement; // canvas to draw into for color picker\r\n    private history: KlHistoryInterface;\r\n    private changeListenerArr:  (() => void)[]; // subscribers get notified when opacity changes\r\n\r\n\r\n    private init (w: number, h: number): void {\r\n        if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            throw new Error('init - invalid canvas size: ' + w + ', ' + h);\r\n        }\r\n        this.width = w;\r\n        this.height = h;\r\n    }\r\n\r\n    private emitChange (): void {\r\n        // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\r\n        this.changeListenerArr.forEach(item => item());\r\n    }\r\n\r\n    private updateIndices (): void {\r\n        this.layerCanvasArr.forEach((item, index) => {\r\n            item.index = index;\r\n        });\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        params: {\r\n            projectObj: {\r\n                width: number;\r\n                height: number;\r\n                layers: {\r\n                    name: string;\r\n                    opacity: number;\r\n                    image: HTMLImageElement | HTMLCanvasElement; // already loaded!\r\n                }[];\r\n            };\r\n        } | {\r\n            // creates blank KlCanvas, 0 layers\r\n            width: number;\r\n            height: number;\r\n        } | {\r\n            copy: KlCanvas;\r\n        },\r\n        private layerNrOffset: number = 0,\r\n    ) {\r\n        this.layerCanvasArr = [];\r\n        this.pickCanvas = BB.canvas(1, 1);\r\n        this.history = new DecoyKlHistory();\r\n        if ('copy' in params) {\r\n            this.width = 1;\r\n            this.height = 1;\r\n        } else {\r\n            if ('width' in params && 'height' in params) {\r\n                this.width = params.width;\r\n                this.height = params.height;\r\n            } else {\r\n                this.width = 1;\r\n                this.height = 1;\r\n            }\r\n        }\r\n        this.init(this.width, this.height);\r\n\r\n        this.changeListenerArr = [];\r\n\r\n        if ('copy' in params) {\r\n            try {\r\n                this.copy(params.copy);\r\n            } catch (e) {\r\n                this.destroy();\r\n                throw e;\r\n            }\r\n        } else if ('projectObj' in params) {\r\n            const origLayers = [...params.projectObj.layers];\r\n            this.init(params.projectObj.width, params.projectObj.height);\r\n\r\n            if (!origLayers.length) {\r\n                throw new Error('project.layers needs at least 1 layer');\r\n            }\r\n\r\n            for (let i = 0; i < origLayers.length; i++) {\r\n                if (origLayers[i].mixModeStr && !allowedMixModes.includes(origLayers[i].mixModeStr)) {\r\n                    throw new Error('unknown mixModeStr ' + origLayers[i].mixModeStr);\r\n                }\r\n\r\n                this.addLayer();\r\n                this.layerOpacity(i, origLayers[i].opacity);\r\n                this.layerCanvasArr[i].name = origLayers[i].name;\r\n                this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr ? origLayers[i].mixModeStr : 'source-over';\r\n                BB.ctx(this.layerCanvasArr[i]).drawImage(origLayers[i].image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    /**\r\n     * Resets canvas -> 1 layer, 100% opacity,\r\n     * unless layers provided.\r\n     * @param p\r\n     */\r\n    reset (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n            color?: IRGB; // optional - fill color\r\n            image?: HTMLImageElement | HTMLCanvasElement; // image drawn on layer\r\n            layerName?: string; // if via image\r\n            layers?: {\r\n                name: string;\r\n                opacity: number;\r\n                mixModeStr: TMixMode;\r\n                image: HTMLCanvasElement;\r\n            }[];\r\n        }\r\n    ): void | number {\r\n        if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height) ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        this.history.pause(true);\r\n\r\n        this.width = p.width;\r\n        this.height = p.height;\r\n\r\n        this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\r\n\r\n        if (p.layers) {\r\n            for (let i = 0; i < p.layers.length; i++) {\r\n                const item = p.layers[i];\r\n                if (!this.layerCanvasArr[i]) {\r\n                    this.addLayer();\r\n                }\r\n                this.layerCanvasArr[i].name = item.name;\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n                this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : 'source-over';\r\n                BB.ctx(this.layerCanvasArr[i]).drawImage(item.image, 0, 0);\r\n                this.layerOpacity(i, item.opacity);\r\n            }\r\n        } else {\r\n            this.layerCanvasArr[0].name = p.layerName ? p.layerName : LANG('layers-layer') + ' 1';\r\n            this.layerCanvasArr[0].width = this.width;\r\n            this.layerCanvasArr[0].height = this.height;\r\n            this.layerCanvasArr[0].mixModeStr = 'source-over';\r\n            this.layerOpacity(0, 1);\r\n            if (p.color) {\r\n                this.layerFill(0, p.color);\r\n            } else if (p.image) {\r\n                BB.ctx(this.layerCanvasArr[0]).drawImage(p.image, 0, 0);\r\n            }\r\n        }\r\n        this.updateIndices();\r\n\r\n        this.history.pause(false);\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'reset',\r\n            params: [p], // don't modify with p\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return this.layerCanvasArr.length - 1;\r\n    }\r\n\r\n    isLayerLimitReached (): boolean {\r\n        return this.layerCanvasArr.length >= MAX_LAYERS;\r\n    }\r\n\r\n    getWidth (): number {\r\n        return this.width;\r\n    }\r\n\r\n    getHeight (): number {\r\n        return this.height;\r\n    }\r\n\r\n    copy (toCopyCanvas: KlCanvas): void {\r\n        if (\r\n            toCopyCanvas.getWidth() < 1 ||\r\n            toCopyCanvas.getHeight() < 1 ||\r\n            isNaN(toCopyCanvas.getWidth()) ||\r\n            isNaN(toCopyCanvas.getHeight())\r\n        ) {\r\n            throw new Error('invalid canvas size');\r\n        }\r\n\r\n        // keep existing canvases\r\n\r\n        const origLayers = toCopyCanvas.getLayers();\r\n\r\n        while (this.layerCanvasArr.length > origLayers.length) {\r\n            this.removeLayer(this.layerCanvasArr.length - 1);\r\n        }\r\n\r\n        if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) {\r\n            this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\r\n        }\r\n        for (let i = 0; i < origLayers.length; i++) {\r\n            if (i >= this.layerCanvasArr.length) {\r\n                this.addLayer();\r\n            } else {\r\n                this.layerCanvasArr[i].width = this.width;\r\n                this.layerCanvasArr[i].height = this.height;\r\n            }\r\n            this.layerOpacity(i, origLayers[i].opacity);\r\n            this.layerCanvasArr[i].name = origLayers[i].name;\r\n            this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\r\n            BB.ctx(this.layerCanvasArr[i]).drawImage(origLayers[i].context.canvas, 0, 0);\r\n        }\r\n        this.updateIndices();\r\n    }\r\n\r\n    getLayerCount (): number {\r\n        return this.layerCanvasArr.length;\r\n    }\r\n\r\n    resize (w: number, h: number, algorithm: 'smooth' | 'pixelated' = 'smooth'): boolean {\r\n        if (!w || !h || (w === this.width && h === this.height) || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\r\n            return false;\r\n        }\r\n        w = Math.max(w, 1);\r\n        h = Math.max(h, 1);\r\n\r\n        let tmp1, tmp2;\r\n\r\n        if (algorithm === 'pixelated') {\r\n            tmp1 = BB.canvas(w, h);\r\n            const tmp1Ctx = BB.ctx(tmp1);\r\n            tmp1Ctx.imageSmoothingEnabled = false;\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                if (i > 0) {\r\n                    tmp1Ctx.clearRect(0, 0, w, h);\r\n                }\r\n                const layerCanvas = this.layerCanvasArr[i];\r\n                tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\r\n                layerCanvas.width = w;\r\n                layerCanvas.height = h;\r\n                const layerContext = BB.ctx(layerCanvas);\r\n                layerContext.drawImage(tmp1, 0, 0);\r\n            }\r\n\r\n        } else if (algorithm === 'smooth') {\r\n            tmp1 = BB.canvas();\r\n            tmp2 = BB.canvas();\r\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n                BB.resizeCanvas(this.layerCanvasArr[i], w, h, tmp1, tmp2);\r\n            }\r\n        } else {\r\n            throw new Error('unknown resize algorithm');\r\n        }\r\n\r\n        this.width = w;\r\n        this.height = h;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * crop / extend\r\n     * @param p\r\n     */\r\n    resizeCanvas (p: {\r\n        left: number;\r\n        top: number;\r\n        right: number;\r\n        bottom: number;\r\n        fillColor?: IRGB;\r\n    }): void {\r\n\r\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\r\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\r\n        const offX = Math.round(p.left);\r\n        const offY = Math.round(p.top);\r\n\r\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) {\r\n            throw new Error('KlCanvas.resizeCanvas - invalid canvas size');\r\n        }\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            const ctemp = BB.canvas(this.width, this.height);\r\n            const layerCanvas = this.layerCanvasArr[i];\r\n            const layerCtx = BB.ctx(this.layerCanvasArr[i]);\r\n            BB.ctx(ctemp).drawImage(layerCanvas, 0, 0);\r\n\r\n            this.layerCanvasArr[i].width = newW;\r\n            this.layerCanvasArr[i].height = newH;\r\n\r\n            layerCtx.save();\r\n            if (i === 0 && p.fillColor) {\r\n                layerCtx.fillStyle = BB.ColorConverter.toRgbStr(p.fillColor);\r\n                layerCtx.fillRect(0, 0, newW, newH);\r\n                layerCtx.clearRect(offX, offY, this.width, this.height);\r\n            }\r\n            layerCtx.drawImage(ctemp, offX, offY);\r\n            layerCtx.restore();\r\n        }\r\n        this.width = newW;\r\n        this.height = newH;\r\n    }\r\n\r\n    /**\r\n     * will be inserted on top of selected\r\n     * @param selected\r\n     */\r\n    addLayer (selected?: number): false | number {\r\n        if (this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        const canvas = BB.canvas(this.width, this.height);\r\n        if (!canvas.getContext('2d')) {\r\n            throw new Error('kl-create-canvas-error');\r\n        }\r\n\r\n        (canvas as any).mixModeStr = 'source-over';\r\n\r\n        if (selected === undefined) {\r\n            this.layerCanvasArr[this.layerCanvasArr.length] = canvas as any;\r\n            selected = Math.max(0, this.layerCanvasArr.length - 1);\r\n        } else {\r\n            this.layerCanvasArr.splice(selected + 1, 0, canvas as any);\r\n            selected++;\r\n        }\r\n\r\n        (canvas as any).name = LANG('layers-layer') + ' ' + (this.layerCanvasArr.length + this.layerNrOffset);\r\n        this.history.pause(true);\r\n        this.layerOpacity(selected, 1);\r\n        this.history.pause(false);\r\n        this.updateIndices();\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'addLayer',\r\n            params: [selected - 1],\r\n        } as TKlCanvasHistoryEntry);\r\n        return selected;\r\n    }\r\n\r\n    duplicateLayer (i: number): false | number {\r\n        if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) {\r\n            return false;\r\n        }\r\n        const canvas = BB.canvas(this.width, this.height);\r\n        this.layerCanvasArr.splice(i + 1, 0, canvas as any);\r\n\r\n        (canvas as any).name = this.layerCanvasArr[i].name + ' ' + LANG('layers-copy');\r\n        (canvas as any).mixModeStr = this.layerCanvasArr[i].mixModeStr;\r\n        // 2023-04-30 workaround for https://bugs.webkit.org/show_bug.cgi?id=256151\r\n        // todo replace with simple drawImage eventually when fixed\r\n        BB.ctx(canvas).putImageData(BB.ctx(this.layerCanvasArr[i]).getImageData(0, 0, this.width, this.height), 0, 0);\r\n        this.history.pause(true);\r\n        this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\r\n        this.history.pause(false);\r\n\r\n        this.updateIndices();\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'duplicateLayer',\r\n            params: [i],\r\n        } as TKlCanvasHistoryEntry);\r\n        return i + 1;\r\n    }\r\n\r\n    getLayerContext (i: number, doReturnNull?: boolean): CanvasRenderingContext2D | null {\r\n        if (this.layerCanvasArr[i]) {\r\n            return BB.ctx(this.layerCanvasArr[i]);\r\n        }\r\n        if (doReturnNull) {\r\n            return null;\r\n        }\r\n        throw new Error('layer of index ' + i + ' not found (in ' + this.layerCanvasArr.length + ' layers)');\r\n    }\r\n\r\n    removeLayer (i: number): false | number {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr.splice(i, 1);\r\n            this.updateIndices();\r\n        } else {\r\n            return false;\r\n        }\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'removeLayer',\r\n            params: [i],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return Math.max(0, i - 1);\r\n    }\r\n\r\n    renameLayer (i: number, name: string): boolean {\r\n        if (this.layerCanvasArr[i]) {\r\n            this.layerCanvasArr[i].name = name;\r\n        } else {\r\n            return false;\r\n        }\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'renameLayer',\r\n            params: [i, name],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return true;\r\n    }\r\n\r\n    layerOpacity (i: number, o: number): void {\r\n        if (!this.layerCanvasArr[i]) {\r\n            return;\r\n        }\r\n        o = Math.max(0, Math.min(1, o));\r\n        this.layerCanvasArr[i].opacity = o;\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'layerOpacity',\r\n            params: [i, o],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        this.emitChange();\r\n    }\r\n\r\n    moveLayer (i: number, d: number): void | number {\r\n        if (d === 0) {\r\n            return;\r\n        }\r\n        if (this.layerCanvasArr[i]) {\r\n            const temp = this.layerCanvasArr[i];\r\n            this.layerCanvasArr.splice(i, 1);\r\n            const targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\r\n            this.layerCanvasArr.splice(targetIndex, 0, temp);\r\n            this.updateIndices();\r\n            this.history.push({\r\n                tool: ['canvas'],\r\n                action: 'moveLayer',\r\n                params: [i, d],\r\n            } as TKlCanvasHistoryEntry);\r\n            return targetIndex;\r\n        }\r\n    }\r\n\r\n    mergeLayers (layerBottomIndex: number, layerTopIndex: number, mixModeStr: TMixMode | 'as-alpha'): void | number {\r\n        if (\r\n            !this.layerCanvasArr[layerBottomIndex] ||\r\n            !this.layerCanvasArr[layerTopIndex] ||\r\n            layerBottomIndex === layerTopIndex\r\n        ) {\r\n            return;\r\n        }\r\n        //order messed up\r\n        if (layerBottomIndex > layerTopIndex) {\r\n            const temp = layerBottomIndex;\r\n            layerBottomIndex = layerTopIndex;\r\n            layerTopIndex = temp;\r\n        }\r\n\r\n        const topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\r\n        if (topOpacity !== 0 && topOpacity) {\r\n            const ctx = BB.ctx(this.layerCanvasArr[layerBottomIndex]);\r\n            ctx.save();\r\n\r\n            if (mixModeStr === 'as-alpha') { // todo remove this?\r\n\r\n                BB.convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\r\n                ctx.globalCompositeOperation = 'destination-in';\r\n                ctx.globalAlpha = topOpacity;\r\n                BB.ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            } else {\r\n\r\n                if (mixModeStr) {\r\n                    ctx.globalCompositeOperation = mixModeStr;\r\n                }\r\n                ctx.globalAlpha = topOpacity;\r\n                BB.ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\r\n\r\n            }\r\n\r\n            ctx.restore();\r\n\r\n            // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n            // TODO remove if chrome updated\r\n            if (mixModeStr) {\r\n                ctx.save();\r\n                ctx.fillStyle = 'rgba(0,0,0,0.01)';\r\n                ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n                ctx.restore();\r\n            }\r\n        }\r\n        this.updateIndices();\r\n        this.history.pause(true);\r\n        this.removeLayer(layerTopIndex);\r\n        this.history.pause(false);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'mergeLayers',\r\n            params: [layerBottomIndex, layerTopIndex, mixModeStr],\r\n        } as TKlCanvasHistoryEntry);\r\n\r\n        return layerBottomIndex;\r\n    }\r\n\r\n    rotate (deg: number): void {\r\n        while (deg < 0) {\r\n            deg += 360;\r\n        }\r\n        deg %= 360;\r\n        if (deg % 90 != 0 || deg === 0) {\r\n            return;\r\n        }\r\n        const temp = BB.canvas();\r\n        if (deg === 0 || deg === 180) {\r\n            temp.width = this.width;\r\n            temp.height = this.height;\r\n        } else if (deg === 90 || deg === 270) {\r\n            temp.width = this.height;\r\n            temp.height = this.width;\r\n        }\r\n        const ctx = BB.ctx(temp);\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.clearRect(0, 0, temp.width, temp.height);\r\n            ctx.save();\r\n            ctx.translate(temp.width / 2, temp.height / 2);\r\n            ctx.rotate(deg * Math.PI / 180);\r\n            if (deg === 180) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            } else if (deg === 90 || deg === 270) {\r\n                ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\r\n            }\r\n            this.layerCanvasArr[i].width = temp.width;\r\n            this.layerCanvasArr[i].height = temp.height;\r\n            BB.ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            BB.ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\r\n            ctx.restore();\r\n        }\r\n        this.width = temp.width;\r\n        this.height = temp.height;\r\n    }\r\n\r\n    flip (isHorizontal: boolean, isVertical: boolean, layerIndex?: number): void {\r\n        if (!isHorizontal && !isVertical) {\r\n            return;\r\n        }\r\n\r\n        const temp = BB.canvas(this.width, this.height);\r\n        temp.width = this.width;\r\n        temp.height = this.height;\r\n        const tempCtx = BB.ctx(temp);\r\n\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n\r\n            if ( (layerIndex || layerIndex === 0) && i !== layerIndex) {\r\n                continue;\r\n            }\r\n\r\n            tempCtx.save();\r\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\r\n            tempCtx.translate(temp.width / 2, temp.height / 2);\r\n            tempCtx.scale((isHorizontal ? -1 : 1), (isVertical ? -1 : 1));\r\n            tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\r\n            tempCtx.restore();\r\n\r\n            BB.ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\r\n            BB.ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\r\n        }\r\n    }\r\n\r\n    layerFill (layerIndex: number, colorObj: IRGB, compositeOperation?: string): void {\r\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n        ctx.save();\r\n        if (compositeOperation) {\r\n            ctx.globalCompositeOperation = compositeOperation as GlobalCompositeOperation;\r\n        }\r\n        ctx.fillStyle = 'rgba(' + colorObj.r + ',' + colorObj.g + ',' + colorObj.b + ',1)';\r\n        ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\r\n        // TODO remove if chrome updated\r\n        ctx.save();\r\n        ctx.fillStyle = 'rgba(0,0,0,0.01)';\r\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\r\n        ctx.restore();\r\n\r\n        /*if (!document.getElementById('testocanvas')) {\r\n            layerCanvasArr[layerIndex].id = 'testocanvas';\r\n            document.body.append(layerCanvasArr[layerIndex]);\r\n            BB.css(layerCanvasArr[layerIndex], {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }\r\n        if (!document.getElementById('testocanvas')) {\r\n            let c = document.createElement('canvas');\r\n            c.width = 1000;\r\n            c.height = 1000;\r\n            let ctx2 = c.getContext('2d');\r\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\r\n            c.id = 'testocanvas';\r\n            document.body.append(c);\r\n            BB.css(c, {\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                zIndex: '1111111',\r\n                transform: 'scale(0.2)',\r\n                border: '10px solid red',\r\n            });\r\n        }*/\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'layerFill',\r\n            params: [layerIndex, colorObj, compositeOperation],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    floodFill (\r\n        layerIndex: number, // index of layer to be filled\r\n        x: number, // starting point\r\n        y: number,\r\n        rgb: IRGB | null, // fill color, if null -> erase\r\n        opacity: number,\r\n        tolerance: number,\r\n        sampleStr: TFillSampling,\r\n        grow: number, // int >= 0 - radius around filled area that is to be filled too\r\n        isContiguous: boolean,\r\n    ): void {\r\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) {\r\n            return;\r\n        }\r\n        tolerance = Math.round(tolerance);\r\n\r\n        if (!(['above', 'current', 'all'].includes(sampleStr))) {\r\n            throw new Error('invalid sampleStr');\r\n        }\r\n\r\n        let result;\r\n\r\n        let srcCtx;\r\n        let srcImageData;\r\n        let srcData;\r\n\r\n        let targetCtx;\r\n        let targetImageData;\r\n        let targetData;\r\n\r\n\r\n        if (sampleStr === 'all') {\r\n\r\n            let srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\r\n            srcCtx = BB.ctx(srcCanvas);\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            srcCanvas = null;\r\n            srcCtx = null;\r\n            srcImageData = null;\r\n            srcData = null;\r\n\r\n            targetCtx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        } else {\r\n            const srcIndex = sampleStr === 'above' ? layerIndex + 1 : layerIndex;\r\n\r\n            if (srcIndex >= this.layerCanvasArr.length) {\r\n                return;\r\n            }\r\n\r\n            srcCtx = BB.ctx(this.layerCanvasArr[srcIndex]);\r\n            srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\r\n            srcData = srcImageData.data;\r\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\r\n\r\n            if (layerIndex !== srcIndex) {\r\n                srcCtx = null;\r\n                srcImageData = null;\r\n                srcData = null;\r\n            }\r\n\r\n            targetCtx = layerIndex === srcIndex ? srcCtx : BB.ctx(this.layerCanvasArr[layerIndex]);\r\n            targetImageData = layerIndex === srcIndex ? srcImageData : targetCtx.getImageData(0, 0, this.width, this.height);\r\n\r\n        }\r\n\r\n        targetData = targetImageData.data;\r\n        if (rgb) {\r\n            if (opacity === 1) {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4] = rgb.r;\r\n                        targetData[i * 4 + 1] = rgb.g;\r\n                        targetData[i * 4 + 2] = rgb.b;\r\n                        targetData[i * 4 + 3] = 255;\r\n                    }\r\n                }\r\n            } else {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4] = BB.mix(targetData[i * 4], rgb.r, opacity);\r\n                        targetData[i * 4 + 1] = BB.mix(targetData[i * 4 + 1], rgb.g, opacity);\r\n                        targetData[i * 4 + 2] = BB.mix(targetData[i * 4 + 2], rgb.b, opacity);\r\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 255, opacity);\r\n                    }\r\n                }\r\n            }\r\n        } else { // erase\r\n            if (opacity === 1) {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4 + 3] = 0;\r\n                    }\r\n                }\r\n            } else {\r\n                for (let i = 0; i < this.width * this.height; i++) {\r\n                    if (result.data[i] === 255) {\r\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 0, opacity);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        targetCtx.putImageData(targetImageData, 0, 0);\r\n\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'replaceLayer',\r\n            params: [layerIndex, targetImageData],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    /**\r\n     * draw shape via BB.drawShape\r\n     * @param layerIndex\r\n     * @param shapeObj\r\n     */\r\n    drawShape (layerIndex: number, shapeObj: IShapeToolObject): void {\r\n        if (shapeObj.x1 === shapeObj.x2 && shapeObj.y1 === shapeObj.y2) {\r\n            return;\r\n        }\r\n        drawShape(BB.ctx(this.layerCanvasArr[layerIndex]), shapeObj);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'drawShape',\r\n            params: [layerIndex, BB.copyObj(shapeObj)],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    drawGradient (layerIndex: number, gradientObj: IGradient): void {\r\n        drawGradient(BB.ctx(this.layerCanvasArr[layerIndex]), gradientObj);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'drawGradient',\r\n            params: [layerIndex, BB.copyObj(gradientObj)],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    text (layerIndex: number, p: IRenderTextParam): void {\r\n        renderText(this.layerCanvasArr[layerIndex], BB.copyObj(p));\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'text',\r\n            params: [layerIndex, BB.copyObj(p)],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    replaceLayer (layerIndex: number, imageData: ImageData): void {\r\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n        ctx.putImageData(imageData, 0, 0);\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'replaceLayer',\r\n            params: [layerIndex, imageData],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    clearLayer (layerIndex: number): void {\r\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\r\n        ctx.restore();\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'clearLayer',\r\n            params: [layerIndex],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    getLayers (): {\r\n        context: CanvasRenderingContext2D;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: TMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                context: BB.ctx(item),\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayersFast (): {\r\n        canvas: KlCanvasLayer;\r\n        opacity: number;\r\n        name: string;\r\n        mixModeStr: TMixMode;\r\n    }[] {\r\n        return this.layerCanvasArr.map(item => {\r\n            return {\r\n                canvas: item,\r\n                opacity: item.opacity,\r\n                name: item.name,\r\n                mixModeStr: item.mixModeStr,\r\n            };\r\n        });\r\n    }\r\n\r\n    getLayerIndex (canvasObj: HTMLCanvasElement, doReturnNull?: boolean): null | number {\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            if (this.layerCanvasArr[i] === canvasObj) {\r\n                return i;\r\n            }\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error('layer not found (in ' + this.layerCanvasArr.length + ' layers)');\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getLayer (index: number, doReturnNull?: boolean): null | TKlCanvasLayer {\r\n        if (this.layerCanvasArr[index]) {\r\n            return {\r\n                context: BB.ctx(this.layerCanvasArr[index]),\r\n                opacity: this.layerCanvasArr[index].opacity,\r\n                name: this.layerCanvasArr[index].name,\r\n                id: index,\r\n            };\r\n        }\r\n        if (!doReturnNull) {\r\n            throw new Error('layer of index ' + index + ' not found (in ' + this.layerCanvasArr.length + ' layers)');\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getColorAt (x: number, y: number): IRGB {\r\n        x = Math.floor(x);\r\n        y = Math.floor(y);\r\n        const ctx = BB.ctx(this.pickCanvas);\r\n        ctx.save();\r\n        ctx.imageSmoothingEnabled = false;\r\n        ctx.clearRect(0, 0, 1, 1);\r\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\r\n            ctx.globalAlpha = this.layerCanvasArr[i].opacity;\r\n            ctx.globalCompositeOperation = this.layerCanvasArr[i].mixModeStr;\r\n            ctx.drawImage(this.layerCanvasArr[i], -x, -y);\r\n        }\r\n        ctx.restore();\r\n        const imData = ctx.getImageData(0, 0, 1, 1);\r\n        return new BB.RGB(imData.data[0], imData.data[1], imData.data[2]);\r\n    }\r\n\r\n    getCompleteCanvas (factor: number): HTMLCanvasElement {\r\n        return drawProject(this.getProject(), factor);\r\n    }\r\n\r\n    getProject (): IKlProject {\r\n        return {\r\n            width: this.width,\r\n            height: this.height,\r\n            layers: this.layerCanvasArr.map(layer => {\r\n                return {\r\n                    name: layer.name,\r\n                    opacity: layer.opacity,\r\n                    mixModeStr: layer.mixModeStr,\r\n                    image: layer,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    addChangeListener (func: () => void): void {\r\n        if (this.changeListenerArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.changeListenerArr.push(func);\r\n    }\r\n\r\n    removeChangeListener (func: () => void): void {\r\n        for (let i = 0; i < this.changeListenerArr.length; i++) {\r\n            if (this.changeListenerArr[i] === func) {\r\n                this.changeListenerArr.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    setMixMode (layerIndex: number, mixModeStr: TMixMode): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\r\n\r\n        this.history.push({\r\n            tool: ['canvas'],\r\n            action: 'setMixMode',\r\n            params: [layerIndex, '' + mixModeStr],\r\n        } as TKlCanvasHistoryEntry);\r\n    }\r\n\r\n    /**\r\n     * Set composite drawing step for KlCanvasWorkspace.\r\n     * To apply temporary manipulations to a layer.\r\n     *\r\n     * @param layerIndex\r\n     * @param compositeObj\r\n     */\r\n    setComposite (\r\n        layerIndex: number,\r\n        compositeObj: null | {\r\n            draw: (ctx: CanvasRenderingContext2D) => void;\r\n        }\r\n    ): void {\r\n        if (!this.layerCanvasArr[layerIndex]) {\r\n            throw new Error('invalid layer');\r\n        }\r\n        this.layerCanvasArr[layerIndex].compositeObj = compositeObj;\r\n    }\r\n\r\n    destroy (): void {\r\n        if (this.layerCanvasArr === null) {\r\n            return;\r\n        }\r\n        this.layerCanvasArr.forEach(canvas => {\r\n            BB.freeCanvas(canvas);\r\n        });\r\n        this.layerCanvasArr = null;\r\n    }\r\n\r\n}\r\n","\r\n/**\r\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/, but it implemented tolerance wrong, and had bugs.\r\n * So, my own implementation. can handle tolerance, grow, opacity.\r\n * Needs to be optimized.\r\n */\r\n\r\n/**\r\n * Set values in data within rect to 254, unless they're 255\r\n *\r\n * @param data Uint8Array\r\n * @param width int\r\n * @param x0 int\r\n * @param y0 int\r\n * @param x1 int >x0\r\n * @param y1 int >y0\r\n */\r\nfunction fillRect (data: Uint8Array, width: number, x0: number, y0: number, x1: number, y1: number): void {\r\n    for (let x = x0; x <= x1; x++) {\r\n        for (let y = y0; y <= y1; y++) {\r\n            if (data[y * width + x] === 255) {\r\n                continue;\r\n            }\r\n            data[y * width + x] = 254;\r\n        }\r\n    }\r\n}\r\n\r\nlet mx, my;\r\n\r\n/**\r\n * Get index i moved by dX, dY. in array with dimensions width height.\r\n * Returns null if outside bounds.\r\n *\r\n * @param width int\r\n * @param height int\r\n * @param i int\r\n * @param dX int\r\n * @param dY int\r\n */\r\nfunction moveIndex (width: number, height: number, i: number, dX: number, dY: number): (undefined | number) {\r\n    mx = i % width + dX;\r\n    my = Math.floor(i / width) + dY;\r\n\r\n    if (mx < 0 || my < 0 || mx >= width || my >= height) {\r\n        return undefined;\r\n    }\r\n\r\n    return my * width + mx;\r\n}\r\n\r\n/**\r\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\r\n * returns false if already filled, or i is null\r\n *\r\n * @param srcArr Uint8ClampedArray rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param initRgba rgba\r\n * @param tolerance int 0 - 255\r\n * @param i int - srcArr index\r\n * @returns {boolean}\r\n */\r\nfunction testAndFill (\r\n    srcArr: Uint8ClampedArray,\r\n    targetArr: Uint8Array,\r\n    width: number,\r\n    height: number,\r\n    initRgba: [number, number, number, number],\r\n    tolerance: number,\r\n    i: number | undefined,\r\n): boolean {\r\n    if (i === undefined || targetArr[i] === 255) {\r\n        return false;\r\n    }\r\n\r\n    if (\r\n        srcArr[i * 4] === initRgba[0] &&\r\n        srcArr[i * 4 + 1] === initRgba[1] &&\r\n        srcArr[i * 4 + 2] === initRgba[2] &&\r\n        srcArr[i * 4 + 3] === initRgba[3]\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    if (\r\n        tolerance > 0 &&\r\n        Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance &&\r\n        Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance\r\n    ) {\r\n        targetArr[i] = 255;\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\n\r\n/**\r\n *\r\n * @param srcArr Uint8ClampedArray rgba\r\n * @param targetArr Uint8Array\r\n * @param width int\r\n * @param height int\r\n * @param px int\r\n * @param py int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n */\r\nfunction floodFill (\r\n    srcArr: Uint8ClampedArray,\r\n    targetArr: Uint8Array,\r\n    width: number,\r\n    height: number,\r\n    px: number,\r\n    py: number,\r\n    tolerance: number,\r\n    grow: number,\r\n    isContiguous: boolean,\r\n): void {\r\n\r\n    const initRgba: [number, number, number, number] = [\r\n        srcArr[(py * width + px) * 4],\r\n        srcArr[(py * width + px) * 4 + 1],\r\n        srcArr[(py * width + px) * 4 + 2],\r\n        srcArr[(py * width + px) * 4 + 3],\r\n    ];\r\n\r\n    if (isContiguous) {\r\n        const q: number[] = [];\r\n        q.push(py * width + px);\r\n        targetArr[py * width + px] = 255;\r\n\r\n        let i: number, e: number | undefined;\r\n        while (q.length) {\r\n            i = q.pop() as number; // a test would slow down the code\r\n\r\n            // queue up unfilled neighbors\r\n            e = moveIndex(width, height, i, -1, 0); // left\r\n            // test will return false if e is undefined -> only numbers will be pushed to q\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n\r\n            e = moveIndex(width, height, i, 1, 0); // right\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n\r\n            e = moveIndex(width, height, i, 0, -1); // up\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n\r\n            e = moveIndex(width, height, i, 0, 1); // bottom\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\r\n        }\r\n    } else {\r\n        for (let i = 0; i < width * height; i++) {\r\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i);\r\n        }\r\n    }\r\n\r\n    // grow\r\n    if (grow === 0) {\r\n        return;\r\n    }\r\n\r\n    // how does it grow? it finds all pixel at the edge.\r\n    // then depending on what kind of edge it is, it draws a rectangle into target\r\n    // the rectangle has the value 254, or else it will mess it all up.\r\n    // after it's all done, replaces it with 255\r\n    let x0, x1, y0, y1;\r\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\r\n    for (let x = 0; x < width; x++) {\r\n        for (let y = 0; y < height; y++) {\r\n            if (targetArr[y * width + x] !== 255) {\r\n                continue;\r\n            }\r\n\r\n            // bounds of rectangle\r\n            x0 = x;\r\n            x1 = x;\r\n            y0 = y;\r\n            y1 = y;\r\n\r\n            l = targetArr[(y) * width + x - 1] !== 255;\r\n            tl = targetArr[(y - 1) * width + x - 1] !== 255;\r\n            t = targetArr[(y - 1) * width + x] !== 255;\r\n            tr = targetArr[(y - 1) * width + x + 1] !== 255;\r\n            r = targetArr[(y) * width + x + 1] !== 255;\r\n            br = targetArr[(y + 1) * width + x + 1] !== 255;\r\n            b = targetArr[(y + 1) * width + x] !== 255;\r\n            bl = targetArr[(y + 1) * width + x - 1] !== 255;\r\n\r\n            if (l) { // left\r\n                x0 = x - grow;\r\n            }\r\n            if (l && tl && t) { // top left\r\n                x0 = x - grow;\r\n                y0 = y - grow;\r\n            }\r\n            if (t) { // top\r\n                y0 = Math.min(y0, y - grow);\r\n            }\r\n            if (t && tr && r) { // top right\r\n                y0 = Math.min(y0, y - grow);\r\n                x1 = x + grow;\r\n            }\r\n            if (r) { // right\r\n                x1 = Math.max(x1, x + grow);\r\n            }\r\n            if (r && br && b) { // bottom right\r\n                x1 = Math.max(x1, x + grow);\r\n                y1 = Math.max(y1, y + grow);\r\n            }\r\n            if (b) { // bottom\r\n                y1 = Math.max(y1, y + grow);\r\n            }\r\n            if (b && bl && l) { // bottom left\r\n                x0 = Math.min(x0, x - grow);\r\n                y1 = Math.max(y1, y + grow);\r\n            }\r\n\r\n            if (!l && !tl && !t && !tr && !r && !br && !b && !bl) {\r\n                continue;\r\n            }\r\n\r\n            fillRect(\r\n                targetArr,\r\n                width,\r\n                Math.max(0, x0),\r\n                Math.max(0, y0),\r\n                Math.min(width - 1, x1),\r\n                Math.min(height - 1, y1)\r\n            );\r\n        }\r\n    }\r\n    for (let i = 0; i < width * height; i++) {\r\n        if (targetArr[i] === 254) {\r\n            targetArr[i] = 255;\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n/**\r\n * Does flood fill, and returns that. an array - 0 not filled. 255 filled\r\n\r\n * @param rgbaArr Uint8ClampedArray rgba\r\n * @param width int\r\n * @param height int\r\n * @param x int\r\n * @param y int\r\n * @param tolerance int 0 - 255\r\n * @param grow int >= 0\r\n * @param isContiguous boolean\r\n */\r\nexport function floodFillBits (\r\n    rgbaArr: Uint8ClampedArray,\r\n    width: number,\r\n    height: number,\r\n    x: number,\r\n    y: number,\r\n    tolerance: number,\r\n    grow: number,\r\n    isContiguous: boolean,\r\n): {\r\n    data: Uint8Array;\r\n} {\r\n    x = Math.round(x);\r\n    y = Math.round(y);\r\n\r\n    const resultArr = new Uint8Array(new ArrayBuffer(width * height));\r\n\r\n    floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\r\n\r\n    return {\r\n        data: resultArr,\r\n    };\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB, IShapeToolObject} from '../kl-types';\r\n\r\n/**\r\n * Input processor for shape tool.\r\n * Coordinates are in canvas space.\r\n * angleRad is the angle of the canvas.\r\n */\r\nexport class ShapeTool {\r\n\r\n    private readonly onShape: (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\r\n    private downX: number = 0;\r\n    private downY: number = 0;\r\n    private downAngleRad: number = 0;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onShape: (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\r\n        }\r\n    ) {\r\n        this.onShape = p.onShape;\r\n    }\r\n\r\n    onDown (x: number, y: number, angleRad: number): void {\r\n        this.downX = x;\r\n        this.downY = y;\r\n        this.downAngleRad = angleRad;\r\n    }\r\n\r\n    onMove (x: number, y: number): void {\r\n        this.onShape(false, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n\r\n    onUp (x: number, y: number): void {\r\n        this.onShape(true, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n}\r\n\r\n/**\r\n * Draw a shape (rectangle, ellipse, line)\r\n */\r\nexport function drawShape (\r\n    ctx: CanvasRenderingContext2D,\r\n    shapeObj: IShapeToolObject,\r\n): void {\r\n    shapeObj = {\r\n        // defaults\r\n        angleRad: 0,\r\n        isOutwards: false,\r\n        opacity: 1,\r\n        isEraser: false,\r\n        doLockAlpha: false,\r\n\r\n        ...BB.copyObj(shapeObj),\r\n    };\r\n\r\n    if (['rect', 'ellipse', 'line'].includes(shapeObj.type)) {\r\n        if (shapeObj.angleRad === undefined) {\r\n            throw new Error('angleRad undefined');\r\n        }\r\n\r\n        const lineWidth = shapeObj.lineWidth === undefined ? -1 : Math.round(shapeObj.lineWidth);\r\n        const angleDeg = shapeObj.angleRad * 180 / Math.PI;\r\n\r\n        // --- prep color ---\r\n        if (!shapeObj.isEraser && shapeObj.fillRgb === undefined && shapeObj.strokeRgb === undefined) {\r\n            throw new Error('fillRgb and strokeRgb undefined');\r\n        }\r\n        const colorRGB: IRGB = shapeObj.isEraser ? {r: 255, g: 255, b: 255} : (shapeObj.fillRgb ? shapeObj.fillRgb : shapeObj.strokeRgb!);\r\n\r\n\r\n        // --- prep canvas ---\r\n        ctx.save();\r\n        if (shapeObj.opacity) {\r\n            ctx.globalAlpha = shapeObj.opacity;\r\n        }\r\n        if (shapeObj.isEraser) {\r\n            ctx.globalCompositeOperation = 'destination-out';\r\n        }\r\n        if (shapeObj.doLockAlpha) {\r\n            ctx.globalCompositeOperation = 'source-atop';\r\n        }\r\n        ctx.rotate(-shapeObj.angleRad);\r\n        if (shapeObj.fillRgb) {\r\n            ctx.fillStyle = BB.ColorConverter.toRgbStr(colorRGB);\r\n        } else if (shapeObj.strokeRgb) {\r\n            ctx.strokeStyle = BB.ColorConverter.toRgbStr(colorRGB);\r\n            ctx.lineWidth = lineWidth;\r\n        }\r\n\r\n        let x1 = shapeObj.x1;\r\n        let y1 = shapeObj.y1;\r\n        let x2 = shapeObj.x2;\r\n        let y2 = shapeObj.y2;\r\n\r\n        // --- angle snapping ---\r\n        if (shapeObj.isAngleSnap) {\r\n            const r1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            const r2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            const pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\r\n            const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\r\n            const rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\r\n            x2 = rotated.x;\r\n            y2 = rotated.y;\r\n\r\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\r\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\r\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\r\n                    x2 = x1;\r\n                } else { // left or right\r\n                    y2 = y1;\r\n                }\r\n            }\r\n        }\r\n\r\n        let x = x1;\r\n        let y = y1;\r\n        let dX = x2 - x1;\r\n        let dY = y2 - y1;\r\n\r\n        // --- 1:1 ratio ---\r\n        if (shapeObj.type !== 'line' && shapeObj.isFixedRatio) {\r\n            let r1 = BB.rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\r\n            let r2 = BB.rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            const rx = r1.x;\r\n            const ry = r1.y;\r\n            let rdX = r2.x - r1.x;\r\n            let rdY = r2.y - r1.y;\r\n\r\n            if (Math.abs(rdX) < Math.abs(rdY)) {\r\n                rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\r\n            } else {\r\n                rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\r\n            }\r\n            r2.x = rx + rdX;\r\n            r2.y = ry + rdY;\r\n\r\n            r1 = BB.rotate(r1.x, r1.y, -shapeObj.angleRad / Math.PI * 180);\r\n            r2 = BB.rotate(r2.x, r2.y, -shapeObj.angleRad / Math.PI * 180);\r\n\r\n            x1 = r1.x;\r\n            y1 = r1.y;\r\n            x2 = r2.x;\r\n            y2 = r2.y;\r\n\r\n            x = x1;\r\n            y = y1;\r\n            dX = x2 - x1;\r\n            dY = y2 - y1;\r\n        }\r\n\r\n        // outwards modifier\r\n        if (shapeObj.isOutwards) {\r\n            x -= dX;\r\n            y -= dY;\r\n            dX *= 2;\r\n            dY *= 2;\r\n\r\n            x1 = x;\r\n            y1 = y;\r\n            x2 = x + dX;\r\n            y2 = y + dY;\r\n        }\r\n\r\n        let p1;\r\n        let p2;\r\n        if (shapeObj.type === 'line') { // --- line ---\r\n\r\n            // rounded\r\n            const x1r = Math.round(x1);\r\n            const y1r = Math.round(y1);\r\n            const x2r = Math.round(x2);\r\n            const y2r = Math.round(y2);\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (lineWidth % 2 === 0) {\r\n\r\n                if (y1r === y2r) {\r\n                    p1 = {\r\n                        x: x1f,\r\n                        y: y1r,\r\n                    };\r\n                    p2 = {\r\n                        x: x2f,\r\n                        y: y2r,\r\n                    };\r\n\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                } else if (x1r === x2r) {\r\n                    p1 = {\r\n                        x: x1r,\r\n                        y: y1f,\r\n                    };\r\n                    p2 = {\r\n                        x: x2r,\r\n                        y: y2f,\r\n                    };\r\n\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                } else {\r\n                    p1 = {\r\n                        x: x1,\r\n                        y: y1,\r\n                    };\r\n                    p2 = {\r\n                        x: x2,\r\n                        y: y2,\r\n                    };\r\n                }\r\n\r\n            } else {\r\n                p1 = {\r\n                    x: x1f,\r\n                    y: y1f,\r\n                };\r\n                p2 = {\r\n                    x: x2f,\r\n                    y: y2f,\r\n                };\r\n                if (y1f === y2f) {\r\n                    if (x1f < x2f) {\r\n                        p2.x += 1;\r\n                    } else {\r\n                        p1.x += 1;\r\n                    }\r\n                    p1.y += 0.5;\r\n                    p2.y += 0.5;\r\n                } else if (x1f === x2f) {\r\n                    if (y1f < y2f) {\r\n                        p2.y += 1;\r\n                    } else {\r\n                        p1.y += 1;\r\n                    }\r\n                    p1.x += 0.5;\r\n                    p2.x += 0.5;\r\n                } else {\r\n                    p1.x = x1;\r\n                    p1.y = y1;\r\n                    p2.x = x2;\r\n                    p2.y = y2;\r\n                }\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n\r\n            ctx.beginPath();\r\n            ctx.moveTo(p1.x, p1.y);\r\n            ctx.lineTo(p2.x, p2.y);\r\n            ctx.stroke();\r\n\r\n        } else if (shapeObj.type === 'rect') { // --- rect ---\r\n\r\n            // floored\r\n            const x1f = Math.floor(x1);\r\n            const y1f = Math.floor(y1);\r\n            const x2f = Math.floor(x2);\r\n            const y2f = Math.floor(y2);\r\n\r\n            if (angleDeg % 90 === 0) {\r\n                if (shapeObj.fillRgb) {\r\n                    if (x1 % 1 === 0) {\r\n                        x1 += 1;\r\n                    }\r\n                    if (y1 % 1 === 0) {\r\n                        y1 += 1;\r\n                    }\r\n                    if (x2 % 1 === 0) {\r\n                        x2 += 1;\r\n                    }\r\n                    if (y2 % 1 === 0) {\r\n                        y2 += 1;\r\n                    }\r\n\r\n                    p1 = {\r\n                        x: x1 < x2 ? x1f : x2f,\r\n                        y: y1 < y2 ? y1f : y2f,\r\n                    };\r\n                    p2 = {\r\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\r\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y),\r\n                    };\r\n                    p2.x = p1.x + p2.x;\r\n                    p2.y = p1.y + p2.y;\r\n\r\n                } else {\r\n                    if (lineWidth % 2 === 0) {\r\n                        p1 = {\r\n                            x: x1f,\r\n                            y: y1f,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f,\r\n                            y: y2f,\r\n                        };\r\n                    } else {\r\n                        p1 = {\r\n                            x: x1f + 0.5,\r\n                            y: y1f + 0.5,\r\n                        };\r\n                        p2 = {\r\n                            x: x2f + 0.5,\r\n                            y: y2f + 0.5,\r\n                        };\r\n                    }\r\n                }\r\n            } else {\r\n                p1 = {\r\n                    x: x1,\r\n                    y: y1,\r\n                };\r\n                p2 = {\r\n                    x: x2,\r\n                    y: y2,\r\n                };\r\n            }\r\n\r\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\r\n            p2.x = p2.x - p1.x;\r\n            p2.y = p2.y - p1.y;\r\n\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\r\n            } else {\r\n                ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\r\n            }\r\n\r\n        } else {  // --- circle ---\r\n            p1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\r\n            p2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\r\n            x = p1.x;\r\n            y = p1.y;\r\n            dX = p2.x - p1.x;\r\n            dY = p2.y - p1.y;\r\n\r\n            ctx.beginPath();\r\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\r\n            if (shapeObj.fillRgb) {\r\n                ctx.fill();\r\n            } else {\r\n                ctx.stroke();\r\n            }\r\n        }\r\n\r\n\r\n        ctx.restore();\r\n\r\n    } else {\r\n        throw new Error('unknown shape');\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {IRect} from '../../bb/bb-types';\r\n\r\nexport interface IRenderTextParam {\r\n    textStr: string; // text to be drawn. can contain newlines\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    font: 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy'; // default sans-serif\r\n    align: 'left' | 'center' | 'right'; // default 'left'\r\n    isBold: boolean; // default false\r\n    isItalic: boolean; // default false\r\n    angleRad: number; // default 0 - rotates around x y\r\n    lineHeight?: number; // pixels\r\n    color: string;\r\n    isDebug?: boolean;\r\n}\r\n\r\n\r\n/**\r\n * Draw text on a canvas.\r\n *\r\n * @param canvas\r\n * @param p\r\n * @returns - bounds. coords relative to p.x p.y\r\n */\r\nexport function renderText (canvas: HTMLCanvasElement, p: IRenderTextParam): IRect {\r\n\r\n    // always at least a space. so bounds aren't just a dot\r\n    const textStr = p.textStr === '' ? ' ' : p.textStr;\r\n\r\n    // --- create el ---\r\n    // create an actual dom element. figure out where exactly each letter is positioned.\r\n    // that way multiline is feasible. canvas can't do multiline or text-align\r\n    const outer = BB.el({\r\n        css: {\r\n            position: 'fixed',\r\n            left: '0',\r\n            top: '0',\r\n            width: '100000px',\r\n            fontSize: p.size + 'px',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n        },\r\n    });\r\n    const div = BB.el({\r\n        parent: outer,\r\n        css: {\r\n            display: 'inline-block',\r\n            textAlign: p.align ? p.align : 'left',\r\n            fontFamily: p.font ? p.font : 'sans-serif',\r\n            fontSize: p.size + 'px',\r\n            fontWeight: p.isBold ? 'bold' : 'normal',\r\n            fontStyle: p.isItalic ? 'italic' : 'normal',\r\n            lineHeight: p.lineHeight ? p.lineHeight + 'px' : 'default',\r\n\r\n\r\n            opacity: '0',\r\n            pointerEvents: 'none',\r\n        },\r\n    });\r\n    let spanStr = '';\r\n    const replaceObj = {\r\n        '\\n': '<br>',\r\n        ' ': '&nbsp;',\r\n        '\t': '&nbsp;&nbsp;&nbsp;&nbsp;',\r\n    };\r\n    for (let i = 0; i < textStr.length; i++) {\r\n        if (textStr[i] === '\\n') {\r\n            BB.el({\r\n                parent: div,\r\n                tagName: 'span',\r\n                textContent: spanStr,\r\n                css: {\r\n                    whiteSpace: 'pre',\r\n                },\r\n            });\r\n            spanStr = '';\r\n            div.append(BB.el({\r\n                tagName: 'br',\r\n            }));\r\n            continue;\r\n        }\r\n        spanStr += textStr[i].replace('\\t', '    ');\r\n    }\r\n    BB.el({\r\n        parent: div,\r\n        tagName: 'span',\r\n        textContent: spanStr,\r\n        css: {\r\n            whiteSpace: 'pre',\r\n        },\r\n    });\r\n    document.body.append(outer);\r\n\r\n\r\n    // --- determine bounds ---\r\n    const bounds = {\r\n        x0: 99999999,\r\n        y0: 99999999,\r\n        x1: 0,\r\n        y1: 0,\r\n    };\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        const el = div.children[i] as HTMLElement;\r\n        bounds.x0 = Math.min(bounds.x0, el.offsetLeft);\r\n        bounds.y0 = Math.min(bounds.y0, el.offsetTop);\r\n        bounds.x1 = Math.max(bounds.x1, el.offsetLeft + el.offsetWidth);\r\n        bounds.y1 = Math.max(bounds.y1, el.offsetTop + el.offsetHeight);\r\n    }\r\n\r\n    // --- draw ---\r\n    const ctx = BB.ctx(canvas);\r\n    ctx.save();\r\n\r\n    const font = [];\r\n    if (p.isItalic) {\r\n        font.push('italic');\r\n    }\r\n    if (p.isBold) {\r\n        font.push('bold');\r\n    }\r\n    font.push(p.size + 'px ' + (p.font ? p.font : 'sans-serif'));\r\n    ctx.font = font.join(' ');\r\n    ctx.fillStyle = p.color ? p.color : '#000';\r\n\r\n    let x = p.x;\r\n    const y = p.y;\r\n    if (p.align === 'right') {\r\n        x += -bounds.x1 + bounds.x0;\r\n    }\r\n    if (p.align === 'center') {\r\n        x += (-bounds.x1 + bounds.x0) / 2;\r\n    }\r\n    ctx.translate(p.x, p.y);\r\n    ctx.rotate(p.angleRad ? -p.angleRad : 0);\r\n    ctx.translate(-p.x, -p.y);\r\n    ctx.translate(x, y);\r\n\r\n    // fill\r\n    for (let i = 0; i < div.children.length; i++) {\r\n        const el = div.children[i] as HTMLElement;\r\n\r\n        //ctx.fillText(el.innerText, 0, 0);\r\n        ctx.fillText(el.innerText, el.offsetLeft, el.offsetTop);\r\n    }\r\n\r\n    if (p.isDebug) {\r\n        ctx.lineWidth = 1;\r\n        ctx.strokeRect(0, -p.size * 0.85, bounds.x1, bounds.y1);\r\n        ctx.restore();\r\n        ctx.fillRect(p.x - 1, p.y - 1, 2, 2);\r\n    } else {\r\n        ctx.restore();\r\n    }\r\n\r\n    document.body.removeChild(outer);\r\n\r\n    return {\r\n        x: x - p.x,\r\n        y: y - p.y -p.size * 0.85,\r\n        width: bounds.x1 - bounds.x0,\r\n        height: bounds.y1 - bounds.y0,\r\n    };\r\n}","import {BB} from '../../bb/bb';\r\nimport {IKlProject} from '../kl-types';\r\n\r\nexport function drawProject (project: IKlProject, factor: number): HTMLCanvasElement {\r\n    const resultCanvas = BB.canvas(\r\n        Math.max(1, Math.round(project.width * factor)),\r\n        Math.max(1, Math.round(project.height * factor))\r\n    );\r\n    const ctx = BB.ctx(resultCanvas);\r\n    ctx.save();\r\n    if (factor > 1) {\r\n        ctx.imageSmoothingEnabled = false;\r\n    }\r\n    for (let i = 0; i < project.layers.length; i++) {\r\n        if (project.layers[i].opacity === 0) {\r\n            continue;\r\n        }\r\n        ctx.globalAlpha = project.layers[i].opacity;\r\n        const mixModeStr = project.layers[i].mixModeStr;\r\n        ctx.globalCompositeOperation = mixModeStr !== undefined ? mixModeStr : 'source-over';\r\n        ctx.drawImage(project.layers[i].image, 0, 0, resultCanvas.width, resultCanvas.height);\r\n    }\r\n    ctx.restore();\r\n    return resultCanvas;\r\n}","import {IGradient} from '../kl-types';\r\nimport {BB} from '../../bb/bb';\r\n\r\n\r\ntype TOnGradient = (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\r\n\r\n/**\r\n * Input processor for gradient tool.\r\n * Coordinates are in canvas space.\r\n * angleRad is the angle of the canvas.\r\n */\r\nexport class GradientTool {\r\n    private downX: number;\r\n    private downY: number;\r\n    private downAngleRad: number;\r\n    private readonly onGradient: TOnGradient;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onGradient: TOnGradient;\r\n        }\r\n    ) {\r\n        this.onGradient = p.onGradient;\r\n    }\r\n\r\n    onDown (x: number, y: number, angleRad: number): void {\r\n        this.downX = x;\r\n        this.downY = y;\r\n        this.downAngleRad = angleRad;\r\n    }\r\n\r\n    onMove (x: number, y: number): void {\r\n        this.onGradient(false, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n\r\n    onUp (x: number, y: number): void {\r\n        this.onGradient(true, this.downX, this.downY, x, y, this.downAngleRad);\r\n    }\r\n}\r\n\r\nexport function drawGradient (\r\n    ctx: CanvasRenderingContext2D,\r\n    gradientObj: IGradient,\r\n): void {\r\n    ctx.save();\r\n\r\n    const x1 = gradientObj.x1;\r\n    const y1 = gradientObj.y1;\r\n    let x2 = gradientObj.x2;\r\n    let y2 = gradientObj.y2;\r\n\r\n    if (gradientObj.doSnap) {\r\n        const angleDeg = gradientObj.angleRad * 180 / Math.PI;\r\n\r\n        const r1 = BB.rotate(x1, y1, gradientObj.angleRad / Math.PI * 180);\r\n        const r2 = BB.rotate(x2, y2, gradientObj.angleRad / Math.PI * 180);\r\n\r\n        const pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\r\n        const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\r\n        const rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\r\n        x2 = rotated.x;\r\n        y2 = rotated.y;\r\n\r\n        // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\r\n        if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\r\n            if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\r\n                x2 = x1;\r\n            } else { // left or right\r\n                y2 = y1;\r\n            }\r\n        }\r\n    }\r\n\r\n    let baseColor = gradientObj.color1;\r\n    if (gradientObj.isEraser && gradientObj.doLockAlpha) {\r\n        baseColor = {r: 255, g: 255, b: 255};\r\n    }\r\n    let color1 = BB.copyObj(baseColor);\r\n    color1.a = gradientObj.opacity;\r\n    let color2 = BB.copyObj(baseColor);\r\n    color2.a = 0;\r\n    if (gradientObj.isReversed) {\r\n        const temp = color1;\r\n        color1 = color2;\r\n        color2 = temp;\r\n    }\r\n\r\n    let gradient: CanvasGradient;\r\n    if (gradientObj.type === 'linear') {\r\n        gradient = ctx.createLinearGradient(x1, y1, x2, y2);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n\r\n    } else if (gradientObj.type === 'linear-mirror') {\r\n        const d = {\r\n            x: x2 - x1,\r\n            y: y2 - y1,\r\n        };\r\n        gradient = ctx.createLinearGradient(x1 - d.x,y1 - d.y, x2, y2);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color2));\r\n        gradient.addColorStop(0.5, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n\r\n    } else if (gradientObj.type === 'radial') {\r\n        const r = BB.Vec2.dist(\r\n            {x: x1, y: y1},\r\n            {x: x2, y: y2},\r\n        );\r\n        gradient = ctx.createRadialGradient(x1, y1, 0, x1, y1, r);\r\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\r\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\r\n    }\r\n\r\n    ctx.fillStyle = gradient!;\r\n    if (gradientObj.isEraser) {\r\n        ctx.globalCompositeOperation = 'destination-out';\r\n    }\r\n    if (gradientObj.doLockAlpha) {\r\n        ctx.globalCompositeOperation = 'source-atop';\r\n    }\r\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\r\n\r\n    ctx.restore();\r\n}","import {TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TTranslationCode} from '../../../languages/languages';\r\n\r\nexport function translateBlending (blendMode?: TMixMode): string {\r\n    if (!blendMode) {\r\n        return LANG('layers-blend-normal');\r\n    }\r\n\r\n    const codes: {\r\n        [key: string]: TTranslationCode;\r\n    } = {\r\n        'source-over': 'layers-blend-normal',\r\n        'darken': 'layers-blend-darken',\r\n        'multiply': 'layers-blend-multiply',\r\n        'color-burn': 'layers-blend-color-burn',\r\n        'lighten': 'layers-blend-lighten',\r\n        'screen': 'layers-blend-screen',\r\n        'color-dodge': 'layers-blend-color-dodge',\r\n        'overlay': 'layers-blend-overlay',\r\n        'soft-light': 'layers-blend-soft-light',\r\n        'hard-light': 'layers-blend-hard-light',\r\n        'difference': 'layers-blend-difference',\r\n        'exclusion': 'layers-blend-exclusion',\r\n        'hue': 'layers-blend-hue',\r\n        'saturation': 'layers-blend-saturation',\r\n        'color': 'layers-blend-color',\r\n        'luminosity': 'layers-blend-luminosity',\r\n    };\r\n\r\n    if (!(blendMode in codes)) {\r\n        throw new Error('unknown blend mode');\r\n    }\r\n    return LANG(codes[blendMode]);\r\n}","import {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport {showModal} from '../../modals/base/showModal';\r\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\r\n\r\n\r\nexport function renameLayerDialog (\r\n    parentEl: HTMLElement,\r\n    currentName: string,\r\n    callback: (newName: string | undefined) => void\r\n): void {\r\n    const div = BB.el();\r\n\r\n    const label = BB.el({\r\n        content: LANG('layers-rename-name') + ':',\r\n        css: {\r\n            marginRight: '5px',\r\n        },\r\n    });\r\n\r\n    const row = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n        },\r\n    });\r\n    const input = BB.el({tagName: 'input'}) as HTMLInputElement;\r\n    input.value = currentName;\r\n    input.setAttribute('data-ignore-focus', 'true');\r\n    const clearBtn = BB.el({\r\n        tagName: 'Button',\r\n        content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/>',\r\n        title: LANG('layers-rename-clear'),\r\n        css: {\r\n            marginLeft: '10px',\r\n        },\r\n        onClick: () => {\r\n            input.value = '';\r\n            input.focus();\r\n        },\r\n    });\r\n    const suggestions = [\r\n        LANG('layers-rename-sketch'),\r\n        LANG('layers-rename-colors'),\r\n        LANG('layers-rename-shading'),\r\n        LANG('layers-rename-lines'),\r\n        LANG('layers-rename-effects'),\r\n        LANG('background'),\r\n        LANG('layers-rename-foreground'),\r\n    ];\r\n    const suggestionBtns: HTMLButtonElement[] = [];\r\n    const row2 = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n            flexWrap: 'wrap',\r\n            marginTop: '5px',\r\n            marginLeft: '-5px',\r\n        },\r\n    }) as HTMLDivElement;\r\n    suggestions.forEach(item => {\r\n        const btn = BB.el({\r\n            parent: row2,\r\n            tagName: 'Button',\r\n            content: item,\r\n            onClick: () => {\r\n                input.value = '' + btn.textContent;\r\n            },\r\n            css: {\r\n                margin: '5px 0 0 5px',\r\n            },\r\n        }) as HTMLButtonElement;\r\n        suggestionBtns.push(btn);\r\n    });\r\n\r\n    div.append(label);\r\n    label.append(row, row2);\r\n    row.append(input, clearBtn);\r\n\r\n    setTimeout(() => {\r\n        input.focus();\r\n        input.select();\r\n    }, 10);\r\n\r\n    showModal({\r\n        target: parentEl,\r\n        message: `<b>${LANG('layers-rename-title')}</b>`,\r\n        div: div,\r\n        buttons: [LANG('layers-rename'), 'Cancel'],\r\n        primaries: [LANG('layers-rename')],\r\n        callback: (val) => {\r\n            BB.destroyEl(clearBtn);\r\n            suggestionBtns.forEach(item => {\r\n                BB.destroyEl(item);\r\n            });\r\n            suggestionBtns.splice(0, suggestionBtns.length);\r\n            if (val === LANG('layers-rename')) {\r\n                callback(input.value);\r\n            } else {\r\n                callback(undefined);\r\n            }\r\n        },\r\n        clickOnEnter: LANG('layers-rename'),\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1twgF\");","import {BB} from '../../../../bb/bb';\r\nimport {LANG} from '../../../../language/language';\r\nimport {Options} from '../../components/options';\r\nimport {translateBlending} from '../../../canvas/translate-blending';\r\nimport {showModal} from '../../modals/base/showModal';\r\nimport {TMixMode} from '../../../kl-types';\r\nimport {theme} from '../../../../theme/theme';\r\n\r\nexport function mergeLayerDialog (\r\n    parentEl: HTMLElement,\r\n    p: {\r\n        topCanvas: HTMLCanvasElement;\r\n        bottomCanvas: HTMLCanvasElement;\r\n        topOpacity: number;\r\n        mixModeStr: TMixMode;\r\n        callback: (mode?: string) => void;\r\n    }\r\n): void {\r\n    const div = BB.el();\r\n    div.innerHTML = LANG('layers-merge-description');\r\n\r\n    const options = new Options({\r\n        optionArr: [\r\n            {id: p.mixModeStr, label: translateBlending(p.mixModeStr)},\r\n            {id: 'source-in', label: 'source-in'},\r\n            {id: 'source-out', label: 'source-out'},\r\n            {id: 'source-atop', label: 'source-atop'},\r\n            {id: 'destination-in', label: 'destination-in'},\r\n            {id: 'destination-out', label: 'destination-out'},\r\n            {id: 'destination-atop', label: 'destination-atop'},\r\n            {id: 'xor', label: 'xor'},\r\n        ],\r\n        initId: p.mixModeStr,\r\n        onChange: () => {\r\n            update();\r\n        },\r\n        isSmall: true,\r\n    });\r\n    options.getElement().style.marginTop = '5px';\r\n    div.append(options.getElement());\r\n\r\n    const thumbDimensions = BB.fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\r\n    const preview = BB.canvas(thumbDimensions.width, thumbDimensions.height);\r\n    preview.title = LANG('preview');\r\n    preview.className = 'kl-merge-preview';\r\n    const spacer = BB.el({\r\n        content: '<br/>',\r\n        css: {\r\n            clear: 'both',\r\n        },\r\n    });\r\n    div.append(spacer, preview);\r\n\r\n    function updateCheckerboard (): void {\r\n        BB.createCheckerDataUrl(4, (url) => {\r\n            preview.style.backgroundImage = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n    }\r\n    updateCheckerboard();\r\n    theme.addIsDarkListener(updateCheckerboard);\r\n\r\n    const alphaCanvas = BB.copyCanvas(preview);\r\n    BB.ctx(alphaCanvas).drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\r\n    BB.convertToAlphaChannelCanvas(alphaCanvas);\r\n\r\n    const update = () => {\r\n        const ctx = BB.ctx(preview);\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, preview.width, preview.height);\r\n        if (preview.width > p.topCanvas.width) {\r\n            ctx.imageSmoothingEnabled = false;\r\n        }\r\n        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\r\n\r\n        if (options.getValue() === 'as-alpha') {\r\n            ctx.globalCompositeOperation = 'destination-in';\r\n            ctx.globalAlpha = p.topOpacity;\r\n            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\r\n        } else {\r\n            ctx.globalCompositeOperation = options.getValue();\r\n            ctx.globalAlpha = p.topOpacity;\r\n            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\r\n        }\r\n        ctx.restore();\r\n    };\r\n\r\n    update();\r\n\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: (keyStr: string) => {\r\n            if (keyStr === 'right') {\r\n                options.next();\r\n            }\r\n            if (keyStr === 'left') {\r\n                options.previous();\r\n            }\r\n        },\r\n    });\r\n\r\n    showModal({\r\n        target: parentEl,\r\n        message: `<b>${LANG('layers-merge-modal-title')}</b>`,\r\n        div: div,\r\n        buttons: ['Ok', 'Cancel'],\r\n        clickOnEnter: 'Ok',\r\n        callback: (val) => {\r\n            keyListener.destroy();\r\n            options.destroy();\r\n            theme.removeIsDarkListener(updateCheckerboard);\r\n            if (val === 'Ok') {\r\n                p.callback(options.getValue());\r\n            }\r\n        },\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"70WHw\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3huo1\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1AvFX\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ftA1L\");","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl-types';\r\n\r\n/**\r\n * Overlay for KlCanvasWorkspace.\r\n * - brush circle\r\n * - eyedropper circle\r\n * - compass needle (rotation hud)\r\n */\r\nexport class WorkspaceSvgOverlay {\r\n    private readonly rootElement: SVGElement;\r\n    private readonly brushCircleOuter: SVGElement;\r\n    private readonly brushCircleInner: SVGElement;\r\n    private readonly pickerPreviewBorder: SVGElement;\r\n    private readonly pickerPreviewCol: SVGElement;\r\n    private readonly compassSize: number;\r\n    private readonly compass: SVGElement;\r\n    private readonly compassInner: SVGElement;\r\n    private readonly compassBaseCircle: SVGElement;\r\n    private readonly compassLineCircle: SVGElement;\r\n    private readonly compassUpperTriangle: SVGElement;\r\n    private readonly compassLowerTriangle: SVGElement;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n        }\r\n    ) {\r\n        this.rootElement = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + p.width,\r\n            height: '' + p.height,\r\n        });\r\n        BB.css(this.rootElement, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            pointerEvents: 'none',\r\n            userSelect: 'none',\r\n        });\r\n\r\n        //brush circles\r\n        this.brushCircleOuter = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '10',\r\n            stroke: 'rgba(0,0,0,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.brushCircleInner = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '9',\r\n            stroke: 'rgba(255,255,255,0.7)',\r\n            'stroke-width': '1',\r\n            fill: 'none',\r\n        });\r\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\r\n\r\n        //color picker preview circle\r\n        this.pickerPreviewBorder = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '22',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewBorder.style.opacity = '0';\r\n        this.pickerPreviewCol = BB.createSvg({\r\n            elementType: 'circle',\r\n            r: '47',\r\n            stroke: 'black',\r\n            'stroke-width': '20',\r\n            fill: 'none',\r\n        });\r\n        this.pickerPreviewCol.style.opacity = '0';\r\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\r\n\r\n\r\n        //rotation compass\r\n        this.compassSize = 30;\r\n        this.compass = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'translate(' + (p.width/2) + ', ' + (p.height/2) + ')',\r\n        });\r\n        BB.css(this.compass, {\r\n            transition: 'opacity 0.25s ease-in-out',\r\n            opacity: '0',\r\n        });\r\n        this.compassInner = BB.createSvg({\r\n            elementType: 'g',\r\n            transform: 'rotate(45)',\r\n        });\r\n        this.compassBaseCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'rgba(0,0,0,0.9)',\r\n            stroke: 'none',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + this.compassSize,\r\n        });\r\n        this.compassLineCircle = BB.createSvg({\r\n            elementType: 'circle',\r\n            fill: 'none',\r\n            stroke: 'rgba(255,255,255,0.75)',\r\n            'stroke-width': '1',\r\n            cx: '0',\r\n            cy: '0',\r\n            r: '' + (this.compassSize * 0.9),\r\n        });\r\n        this.compassUpperTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#f00',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,-'+(this.compassSize * 0.9)+' z',\r\n        });\r\n        this.compassLowerTriangle = BB.createSvg({\r\n            elementType: 'path',\r\n            fill: '#fff',\r\n            stroke: 'none',\r\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,'+(this.compassSize * 0.9)+' z',\r\n        });\r\n\r\n        this.compassInner.append(\r\n            this.compassBaseCircle,\r\n            this.compassLineCircle,\r\n            this.compassUpperTriangle,\r\n            this.compassLowerTriangle\r\n        );\r\n        this.compass.append(this.compassInner);\r\n        this.rootElement.append(this.compass);\r\n    }\r\n\r\n    getElement (): SVGElement {\r\n        return this.rootElement;\r\n    }\r\n\r\n    setSize (width: number, height: number): void {\r\n        this.rootElement.setAttribute('width', '' + width);\r\n        this.rootElement.setAttribute('height', '' + height);\r\n        this.compass.setAttribute('transform', 'translate(' + (width/2) + ', ' + (height/2) + ')');\r\n    }\r\n\r\n    updateCursor (p: {\r\n        x?: number;\r\n        y?: number;\r\n        radius?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if (p.x !== undefined) {\r\n            this.brushCircleOuter.setAttribute('cx', '' + p.x);\r\n            this.brushCircleInner.setAttribute('cx', '' + p.x);\r\n        }\r\n        if (p.y !== undefined) {\r\n            this.brushCircleOuter.setAttribute('cy', '' + p.y);\r\n            this.brushCircleInner.setAttribute('cy', '' + p.y);\r\n        }\r\n        if (p.radius !== undefined) {\r\n            this.brushCircleOuter.setAttribute('r', '' + Math.max(0, p.radius));\r\n            this.brushCircleInner.setAttribute('r', '' + Math.max(0, p.radius - 1));\r\n        }\r\n        if (p.isVisible !== undefined) {\r\n            this.brushCircleOuter.style.opacity = p.isVisible ? '1' : '0';\r\n            this.brushCircleInner.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateColorPreview (p: {\r\n        x?: number;\r\n        y?: number;\r\n        color?: IRGB;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if (p.x !== undefined) {\r\n            this.pickerPreviewCol.setAttribute('cx', '' + p.x);\r\n            this.pickerPreviewBorder.setAttribute('cx', '' + p.x);\r\n        }\r\n        if (p.y !== undefined) {\r\n            this.pickerPreviewCol.setAttribute('cy', '' + p.y);\r\n            this.pickerPreviewBorder.setAttribute('cy', '' + p.y);\r\n        }\r\n        if (p.color) {\r\n            this.pickerPreviewCol.setAttribute('stroke', BB.ColorConverter.toRgbStr(p.color));\r\n            const borderColor = BB.testIsWhiteBestContrast(p.color) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)';\r\n            this.pickerPreviewBorder.setAttribute('stroke', borderColor);\r\n        }\r\n        if (p.isVisible !== undefined) {\r\n            this.pickerPreviewCol.style.opacity = p.isVisible ? '1' : '0';\r\n            this.pickerPreviewBorder.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n    updateCompass (p: {\r\n        angleDeg?: number;\r\n        isVisible?: boolean;\r\n    }): void {\r\n        if (p.angleDeg !== undefined) {\r\n            this.compassInner.setAttribute('transform', 'rotate(' + p.angleDeg + ')');\r\n            this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? '1' : '0';\r\n        }\r\n        if (p.isVisible !== undefined) {\r\n            this.compass.style.opacity = p.isVisible ? '1' : '0';\r\n        }\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB, ITransform, TDrawEvent} from '../kl-types';\r\nimport {WorkspaceSvgOverlay} from './workspace-svg-overlay';\r\nimport {klHistory} from '../history/kl-history';\r\nimport pickerImg from '/src/app/img/ui/cursor-picker.png';\r\nimport zoomEwImg from '/src/app/img/ui/cursor-zoom-ew.png';\r\nimport fillImg from '/src/app/img/ui/cursor-fill.png';\r\nimport textImg from '/src/app/img/ui/cursor-text.png';\r\nimport {IPressureInput, IVector2D} from '../../bb/bb-types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {KeyListener} from '../../bb/input/key-listener';\r\nimport {KL} from '../kl';\r\nimport {IPointerEvent} from '../../bb/input/event.types';\r\nimport {LinetoolProcessor} from '../events/linetool-processor';\r\nimport {PinchZoomer} from '../../bb/input/event-chain/pinch-zoomer';\r\nimport {DoubleTapper} from '../../bb/input/event-chain/double-tapper';\r\nimport {NFingerTapper} from '../../bb/input/event-chain/n-finger-tapper';\r\nimport {EventChain} from '../../bb/input/event-chain/event-chain';\r\nimport {PointerListener} from '../../bb/input/pointer-listener';\r\nimport {theme} from '../../theme/theme';\r\n\r\nexport interface IViewChangeEvent {\r\n    changed: ('scale' | 'angle')[];\r\n    angle: number;\r\n    scale: number;\r\n}\r\n\r\ntype TModeStr = 'draw' | 'pick' | 'hand' | 'shape' | 'fill' | 'gradient' | 'text'; // | 'transform' | 'select'\r\n\r\nconst MIN_SCALE = 1 / 16;\r\nconst MAX_SCALE = 64;\r\nenum TMode {\r\n    Draw,\r\n    Hand,\r\n    HandGrabbing,\r\n    Pick,\r\n    Zoom,\r\n    Rotate,\r\n    Rotating,\r\n    Fill,\r\n    Gradient,\r\n    Text,\r\n    Shape,\r\n}\r\nconst ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\r\n\r\n/**\r\n * Work area that displays the KlCanvas.\r\n * - pan, zoom, rotate (also via multi-touch)\r\n * - input modes: drawing, hand, pick, fill, text // transform, select\r\n * - drawing input events\r\n * - view change events\r\n * - eyedropper input events (pick)\r\n * - draws cursor, eyedropper overlay\r\n *\r\n * subscribes to klCanvas changes\r\n * listens to kl history for changes\r\n * and you can manually trigger redraw\r\n */\r\nexport class KlCanvasWorkspace {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private klCanvas: KlCanvas;\r\n    private readonly renderTargetCanvas: HTMLCanvasElement;\r\n    private readonly renderTargetCtx: CanvasRenderingContext2D;\r\n    private renderWidth: number;\r\n    private renderHeight: number;\r\n    private readonly compositeCanvas: HTMLCanvasElement; // for drawing klcanvas layer composite\r\n    private readonly compositeCtx: CanvasRenderingContext2D;\r\n    private doResizeCanvas: boolean;\r\n    private oldTransformObj: ITransform;\r\n    private targetTransformObj: ITransform; // animation target\r\n    private highResTransformObj: ITransform; // animated, internal high res\r\n    private readonly renderedTransformObj: ITransform; // same as highRes, but rounded - what's actually displayed\r\n    private cursorPos: IVector2D;\r\n    private readonly usesCssCursor: boolean;\r\n    private bgVisible: boolean;\r\n    private transformIsDirty: boolean;\r\n    private doAnimateTranslate: boolean;\r\n    private svgOverlay: WorkspaceSvgOverlay;\r\n    private readonly emptyCanvas: HTMLCanvasElement;\r\n    private readonly emptyLightCanvas: HTMLCanvasElement;\r\n    private keyListener: KeyListener;\r\n    private currentMode: TMode;\r\n    private globalMode: TMode;\r\n    private renderTime: number; // for debugging - average ms per render()\r\n    private lastDrawEvent: IPressureInput | null; // previous drawing input\r\n    private linetoolProcessor: LinetoolProcessor;\r\n    private pointer: IVector2D | null; // position of cursor\r\n    private isDrawing: boolean;\r\n    private inputProcessorObj: any; // todo type\r\n    private currentInputProcessor: any; // todo type\r\n    private angleIsExtraSticky: boolean;\r\n    private readonly pinchZoomer: PinchZoomer;\r\n    private readonly mainDoubleTapper: DoubleTapper;\r\n    private readonly middleDoubleTapper: DoubleTapper;\r\n    private readonly twoFingerTap: NFingerTapper;\r\n    private readonly threeFingerTap: NFingerTapper;\r\n    private pointerEventChain: EventChain;\r\n    private pointerListener: PointerListener | undefined;\r\n    private brushRadius: number;\r\n    private animationFrameRequested: boolean;\r\n    private lastRenderedState: number; // KlHistory state - to detect if there are changes to draw\r\n    private lastRenderTime: number; // ms from performance.now()\r\n    private hideBrushCursorTimeout: (ReturnType<typeof setTimeout>) | undefined;\r\n    private readonly onViewChange: (e:  IViewChangeEvent) => void;\r\n\r\n    private getRenderedTransform (): ITransform {\r\n        // rounded x & y so canvas is less blurry.\r\n        const result = this.renderedTransformObj;\r\n        result.x = this.highResTransformObj.x;\r\n        result.y = this.highResTransformObj.y;\r\n        result.scale = this.highResTransformObj.scale;\r\n        result.angle = this.highResTransformObj.angle;\r\n\r\n        if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\r\n            result.x = Math.round(result.x);\r\n            result.y = Math.round(result.y);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private updateChangeListener (): void {\r\n        this.klCanvas.addChangeListener(() => {\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n        });\r\n    }\r\n\r\n    private updateCursor (modeInt: TMode, doForce?: boolean): void {\r\n        if (modeInt === this.currentMode && !doForce) {\r\n            return;\r\n        }\r\n        const oldMode = this.currentMode;\r\n        this.currentMode = modeInt;\r\n        this.lastRenderedState = -1;\r\n        if (this.currentMode === TMode.Draw) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        } else if (this.currentMode === TMode.Hand) {\r\n            this.rootEl.style.cursor = 'grab';\r\n        } else if (this.currentMode === TMode.HandGrabbing) {\r\n            this.rootEl.style.cursor = 'grabbing';\r\n        } else if (this.currentMode === TMode.Pick) {\r\n            this.rootEl.style.cursor = \"url('\" + pickerImg + \"') 0 15, crosshair\";\r\n        } else if (this.currentMode === TMode.Zoom) {\r\n            this.rootEl.style.cursor = \"url('\" + zoomEwImg + \"') 7 7, zoom-in\";\r\n        } else if (this.currentMode === TMode.Rotate) {\r\n            this.rootEl.style.cursor = 'grab';\r\n        } else if (this.currentMode === TMode.Rotating) {\r\n            this.rootEl.style.cursor = 'grabbing';\r\n        } else if (this.currentMode === TMode.Fill) {\r\n            this.rootEl.style.cursor = \"url('\" + fillImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Gradient) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        } else if (this.currentMode === TMode.Text) {\r\n            this.rootEl.style.cursor = \"url('\" + textImg + \"') 1 12, crosshair\";\r\n        } else if (this.currentMode === TMode.Shape) {\r\n            this.rootEl.style.cursor = 'crosshair';\r\n        }\r\n\r\n        if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode)) {\r\n            const oldIsHand = [TMode.Hand, TMode.HandGrabbing].includes(oldMode);\r\n            const currentIsHand = [TMode.Hand, TMode.HandGrabbing].includes(this.currentMode);\r\n            if (!oldIsHand && currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n            }\r\n            if (oldIsHand && !currentIsHand) {\r\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n            }\r\n        }\r\n\r\n        if (this.currentMode !== TMode.Pick) {\r\n            this.svgOverlay.updateColorPreview({isVisible: false});\r\n        }\r\n    }\r\n\r\n    /**\r\n     * returns false if no change of zoom\r\n     * @param stepNum\r\n     * @param centerX\r\n     * @param centerY\r\n     * @private\r\n     */\r\n    private internalZoomByStep (stepNum: number, centerX: number, centerY: number): boolean {\r\n        const step = Math.log2(this.targetTransformObj.scale);\r\n\r\n        let newStep = step / Math.abs(stepNum);\r\n        newStep += stepNum > 0 ? 1 : -1;\r\n        newStep = Math.round(newStep);\r\n        newStep *= Math.abs(stepNum);\r\n        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, Math.pow(2, newStep)));\r\n\r\n        //has zoomed?\r\n        if (newScale === this.targetTransformObj.scale) {\r\n            return false;\r\n        }\r\n\r\n\r\n        const effectiveFactor = newScale / this.targetTransformObj.scale;\r\n        this.targetTransformObj.scale = newScale;\r\n\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerX, centerY));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerX, -centerY));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.transformIsDirty = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * mixes two transform objects. modifies A\r\n     * @param transformA\r\n     * @param transformB\r\n     * @param blendFactor 0 -> A, 1 -> B\r\n     * @private\r\n     */\r\n    private mixTransformObj (transformA: ITransform, transformB: ITransform, blendFactor: number): void {\r\n        if (transformA.angle === transformB.angle) {\r\n            transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n            transformA.x = BB.mix(transformA.x, transformB.x, blendFactor);\r\n            transformA.y = BB.mix(transformA.y, transformB.y, blendFactor);\r\n            transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n            return;\r\n        }\r\n\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        // --- determine centerPosA, centerPosB ---\r\n        const centerPosA = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2,\r\n        }, transformA);\r\n        const centerPosB = this.canvasToWorkspaceCoord({\r\n            x: w / 2,\r\n            y: h / 2,\r\n        }, transformB);\r\n\r\n        // --- centerPosMixed ---\r\n        transformA.x = BB.mix(centerPosA.x , centerPosB.x, blendFactor);\r\n        transformA.y = BB.mix(centerPosA.y , centerPosB.y, blendFactor);\r\n\r\n        // --- scale and angle ---\r\n        transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\r\n        transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\r\n\r\n        // --- x and y ---\r\n        const mixedPos = this.canvasToWorkspaceCoord({\r\n            x: -w / 2,\r\n            y: -h / 2,\r\n        }, transformA);\r\n        transformA.x = mixedPos.x;\r\n        transformA.y = mixedPos.y;\r\n    }\r\n\r\n    private render (): void {\r\n        if (this.doResizeCanvas) {\r\n            this.doResizeCanvas = false;\r\n            this.renderTargetCanvas.width = this.renderWidth;\r\n            this.renderTargetCanvas.height = this.renderHeight;\r\n        }\r\n        this.renderContext(this.renderTargetCtx);\r\n    }\r\n\r\n    /**\r\n     * is the gray background that surrounds canvas visible?\r\n     * @private\r\n     */\r\n    private testBgVisible (): boolean {\r\n        //bring workspace points (corners of workspace) into canvas coordinate system\r\n        //then check if any corner point is outside of the canvas -> that means the bg is visible\r\n\r\n        const workspacePointArr = [\r\n            [0, 0], // top left\r\n            [this.renderWidth, 0], // top right\r\n            [this.renderWidth, this.renderHeight], // bottom right\r\n            [0, this.renderHeight], // bottom left\r\n        ];\r\n\r\n        const art = this.getRenderedTransform();\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        //transform points, then test if outside of canvas\r\n        for (let i = 0; i < workspacePointArr.length; i++) {\r\n            let coords = [workspacePointArr[i][0], workspacePointArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n            if (\r\n                !(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() &&\r\n                    0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())\r\n            ){\r\n                //if not inside -> bg visible\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private renderContext (ctx: CanvasRenderingContext2D): void {\r\n        const w = this.klCanvas.getWidth();\r\n        const h = this.klCanvas.getHeight();\r\n\r\n        const art = this.getRenderedTransform();\r\n        const isDark = theme.isDark();\r\n\r\n        if (art.scale >= 4 || (art.scale === 1 && art.angle === 0)) {\r\n            ctx.imageSmoothingEnabled = false;\r\n        } else {\r\n            ctx.imageSmoothingEnabled = true;\r\n            ctx.imageSmoothingQuality  = 'low'; // art.scale >= 1 ? 'low' : 'medium';\r\n        }\r\n        //ctx.imageSmoothingEnabled = false;\r\n        //renderTargetCtx.globalCompositeOperation  = 'multiply';\r\n\r\n\r\n\r\n        ctx.save();\r\n        {\r\n            if (this.bgVisible) {\r\n                ctx.fillStyle = isDark ? 'rgb(33, 33, 33)' : 'rgb(158,158,158)'; // 'rgb(185,185,185)';\r\n                ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\r\n            } else {\r\n                ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\r\n            }\r\n\r\n\r\n\r\n            if (this.bgVisible) {\r\n                ctx.save();\r\n\r\n                ctx.translate(art.x, art.y);\r\n                ctx.scale(art.scale, art.scale);\r\n                ctx.rotate(art.angle);\r\n\r\n                ctx.imageSmoothingEnabled = false;\r\n\r\n                //outline\r\n                const borderSize = 1;\r\n                ctx.globalAlpha = isDark ? 0.25 : 0.2;\r\n                ctx.drawImage(\r\n                    isDark ? this.emptyLightCanvas : this.emptyCanvas,\r\n                    -borderSize / art.scale,\r\n                    -borderSize / art.scale,\r\n                    w + borderSize * 2 / art.scale,\r\n                    h + borderSize * 2 / art.scale\r\n                );\r\n                ctx.globalAlpha = 1;\r\n\r\n                //erase\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n                ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\r\n\r\n                ctx.restore();\r\n            }\r\n\r\n            /*const region = new Path2D();\r\n            region.rect(80, 10, 20, 130);\r\n            ctx.clip(region);*/\r\n\r\n            ctx.translate(art.x, art.y);\r\n            ctx.scale(art.scale, art.scale);\r\n            ctx.rotate(art.angle);\r\n\r\n            const layerArr = this.klCanvas.getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    ctx.globalAlpha = layerArr[i].opacity;\r\n                    ctx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n\r\n                    if (layerArr[i].canvas.compositeObj) {\r\n                        if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\r\n                            this.compositeCanvas.width = layerArr[i].canvas.width;\r\n                            this.compositeCanvas.height = layerArr[i].canvas.height;\r\n                        } else {\r\n                            this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\r\n                        }\r\n                        this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\r\n                        layerArr[i].canvas.compositeObj.draw(this.compositeCtx);\r\n                        ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\r\n                    } else {\r\n                        ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\r\n                    }\r\n                }\r\n            }\r\n            ctx.globalAlpha = 1;\r\n\r\n\r\n\r\n        }\r\n        ctx.restore();\r\n\r\n        // rotation hud\r\n        if (TMode.Rotate === this.currentMode || TMode.Rotating === this.currentMode) {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: true,\r\n                angleDeg: art.angle / Math.PI * 180,\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCompass({\r\n                isVisible: false,\r\n            });\r\n        }\r\n    }\r\n\r\n    private workspaceToCanvasCoord (p: IVector2D): IVector2D {\r\n        const art = this.getRenderedTransform();\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private canvasToWorkspaceCoord (p: IVector2D, transformObj: ITransform): IVector2D {\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(transformObj.angle));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(transformObj.scale));\r\n\r\n        let coords = [p.x, p.y, 0, 1];\r\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n\r\n        return {\r\n            x: coords[0],\r\n            y: coords[1],\r\n        };\r\n    }\r\n\r\n    private snapAngleRad (angleRad: number, snapDegIncrement: number, maxDistDeg: number): number {\r\n        let angleDeg = angleRad * 180 / Math.PI;\r\n        const modDeg = Math.abs(angleDeg % snapDegIncrement);\r\n        const dist = Math.min(modDeg, snapDegIncrement - modDeg);\r\n\r\n        if (dist <= maxDistDeg) {\r\n            angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\r\n        }\r\n\r\n        return angleDeg / 180 * Math.PI;\r\n    }\r\n\r\n    /**\r\n     * angle always in range [-PI, PI]\r\n     * @param angleRad\r\n     * @private\r\n     */\r\n    private minimizeAngleRad (angleRad: number): number {\r\n        angleRad = angleRad % (2 * Math.PI);\r\n        if (angleRad > Math.PI) {\r\n            angleRad -= 2 * Math.PI;\r\n        } else if (angleRad < -Math.PI) {\r\n            angleRad += 2 * Math.PI;\r\n        }\r\n        return angleRad;\r\n    }\r\n\r\n    private resetInputProcessor (): void {\r\n        this.currentInputProcessor = null;\r\n        this.updateCursor(this.globalMode);\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    private reqFrame (doRedrawCanvas?: boolean): void {\r\n        this.animationFrameRequested = true;\r\n        if (doRedrawCanvas) {\r\n            this.lastRenderedState = -1;\r\n        }\r\n    }\r\n\r\n    private updateLoop (): void {\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState;\r\n\r\n        //handle variable framerate\r\n        const nowTime = performance.now();\r\n        const elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\r\n        this.lastRenderTime = nowTime;\r\n\r\n        if (this.animationFrameRequested || doRender) {\r\n            this.animationFrameRequested = false;\r\n            this.checkChange(elapsedFrames);\r\n        }\r\n    }\r\n\r\n    private checkChange (elapsedFrames: number): void {\r\n\r\n        const newState = klHistory.getState();\r\n        const doRender = this.lastRenderedState < newState ||\r\n            this.highResTransformObj.scale !== this.targetTransformObj.scale ||\r\n            this.highResTransformObj.x !== this.targetTransformObj.x ||\r\n            this.highResTransformObj.y !== this.targetTransformObj.y;\r\n\r\n        //update transform\r\n        if (\r\n            !this.doAnimateTranslate &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else if (\r\n            (this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) &&\r\n            (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) &&\r\n            (\r\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\r\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\r\n            )\r\n        ) {\r\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\r\n            this.highResTransformObj.x = this.targetTransformObj.x;\r\n            this.highResTransformObj.y = this.targetTransformObj.y;\r\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\r\n            this. doAnimateTranslate = false;\r\n            if (this.transformIsDirty) {\r\n                this.transformIsDirty = false;\r\n                this.bgVisible = this.testBgVisible();\r\n            }\r\n\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        } else {\r\n            this.reqFrame(); //probably needs another frame\r\n            const blendFactor = Math.min(1, ANIMATION_SPEED * elapsedFrames);\r\n            this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\r\n            this.bgVisible = true; // spare yourself the calculation\r\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n        }\r\n\r\n        if (this.pointer && this.currentMode == TMode.Draw && !this.usesCssCursor) {\r\n            this.svgOverlay.updateCursor({\r\n                x: this.pointer.x,\r\n                y: this.pointer.y,\r\n                isVisible: true,\r\n            });\r\n        } else {\r\n            this.svgOverlay.updateCursor({isVisible: false});\r\n        }\r\n\r\n\r\n        if (doRender) {\r\n            //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\r\n            this.lastRenderedState = newState;\r\n            const start = performance.now();\r\n            this.render();\r\n            this.renderTime = BB.mix(this.renderTime, performance.now() - start, 0.05);\r\n        }\r\n        //setTimeout(this.checkChange, 100);\r\n\r\n\r\n\r\n        if (doRender) {\r\n\r\n            //console.log('rendertime ms: ', this.renderTime);\r\n        }\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            klCanvas: any; // todo\r\n            width: number;\r\n            height: number;\r\n            onDraw: (val: TDrawEvent) => void; // todo\r\n            onPick: (rgb: IRGB, isPointerup: boolean) => void;\r\n            onFill: (canvasX: number, canvasY: number) => void;\r\n            onGradient: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onText: (canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onShape: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\r\n            onViewChange: (e:  IViewChangeEvent) => void;\r\n            onUndo: () => void;\r\n            onRedo: () => void;\r\n        }\r\n    ) {\r\n        const _this = this;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                right: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                cursor: 'crosshair',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.klCanvas = p.klCanvas;\r\n        this.onViewChange = p.onViewChange;\r\n        this.renderTargetCanvas = BB.canvas(p.width, p.height);\r\n        this.renderTargetCtx = BB.ctx(this.renderTargetCanvas);\r\n        this.renderWidth = p.width;\r\n        this.renderHeight = p.height;\r\n        this.compositeCanvas = BB.canvas(1, 1); // for drawing klcanvas layer composite\r\n        this.compositeCtx = BB.ctx(this.compositeCanvas);\r\n        this.doResizeCanvas = false;\r\n        this.oldTransformObj = null;\r\n        this.targetTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0,\r\n        };\r\n        this.highResTransformObj = {\r\n            x: 0,\r\n            y: 0,\r\n            scale: 1,\r\n            angle: 0,\r\n        };\r\n        this.renderedTransformObj = {\r\n            x: null,\r\n            y: null,\r\n            scale: null,\r\n            angle: null,\r\n        };\r\n        this.cursorPos = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        this.usesCssCursor = false;\r\n        this.bgVisible = true;\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n\r\n        this.svgOverlay = new WorkspaceSvgOverlay({\r\n            width: p.width,\r\n            height: p.height,\r\n        });\r\n\r\n        BB.css(this.renderTargetCanvas, {\r\n            userSelect: 'none',\r\n            pointerEvents: 'none',\r\n        });\r\n        BB.createCheckerDataUrl(8, (url) => {\r\n            this.renderTargetCanvas.style.background = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n\r\n        theme.addIsDarkListener(() => {\r\n            this.renderTargetCanvas.style.background = 'url(' + BB.createCheckerDataUrl(8, undefined, theme.isDark()) + ')';\r\n            this.lastRenderedState = -1;\r\n            this.reqFrame();\r\n        });\r\n\r\n        this.rootEl.append(this.renderTargetCanvas, this.svgOverlay.getElement());\r\n        this.rootEl.addEventListener( 'touchend', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        this.rootEl.addEventListener('contextmenu', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n        this.rootEl.addEventListener('dragstart', (e) => {\r\n            e.preventDefault();\r\n            return false;\r\n        });\r\n\r\n        this.emptyCanvas = BB.canvas(1, 1);\r\n        this.emptyLightCanvas = BB.canvas(1, 1);\r\n        {\r\n            let ctx = BB.ctx(this.emptyCanvas);\r\n            ctx.fillRect(0, 0, 1, 1);\r\n            ctx = BB.ctx(this.emptyLightCanvas);\r\n            ctx.fillStyle = '#fff';\r\n            ctx.fillRect(0, 0, 1, 1);\r\n        }\r\n\r\n        this.keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n                if (isRepeat) {\r\n                    return;\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n\r\n                } else {\r\n\r\n                    if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'space') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.spaceHand;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ([TMode.Draw, TMode.Hand, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'alt') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.altPicker;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if (['r', 'shift+r'].includes(comboStr)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.rotate;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                    if ('z' === comboStr) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.zoom;\r\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\r\n                        return;\r\n                    }\r\n\r\n                }\r\n\r\n            },\r\n            onUp: (keyStr, event, oldComboStr) => {\r\n                // prevent menu bar in Firefox\r\n                if (keyStr === 'alt') {\r\n                    event.preventDefault();\r\n                }\r\n\r\n                if (this.currentInputProcessor) {\r\n                    this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\r\n                }\r\n            },\r\n        });\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.currentMode = TMode.Draw;\r\n        this.globalMode = TMode.Draw;\r\n\r\n        this.renderTime = 0;\r\n\r\n        this.lastDrawEvent = null;\r\n\r\n        this.linetoolProcessor = new LinetoolProcessor({\r\n            onDraw: (event) => {\r\n                const getMatrix = () => {\r\n                    const art = this.getRenderedTransform();\r\n                    let matrix = BB.Matrix.getIdentity();\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\r\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\r\n                    return matrix;\r\n                };\r\n\r\n                if (event.type === 'line' && !this.lastDrawEvent) {\r\n                    const matrix = getMatrix();\r\n                    let coords = [event.x1, event.y1, 0, 1];\r\n                    coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                    this.lastDrawEvent = {\r\n                        x: coords[0],\r\n                        y: coords[1],\r\n                        pressure: event.pressure1,\r\n                    };\r\n                    return;\r\n                }\r\n\r\n                if ('x' in event || 'x0' in event) {\r\n\r\n                    const matrix = getMatrix();\r\n\r\n                    if ('x' in event) { //down or move\r\n                        let coords = [event.x, event.y, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x = coords[0];\r\n                        event.y = coords[1];\r\n                    }\r\n                    if ('x0' in event) { //line\r\n                        event.x0 = this.lastDrawEvent.x;\r\n                        event.y0 = this.lastDrawEvent.y;\r\n                        event.pressure0 = this.lastDrawEvent.pressure;\r\n                        let coords = [event.x1, event.y1, 0, 1];\r\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n                        event.x1 = coords[0];\r\n                        event.y1 = coords[1];\r\n\r\n                        this.lastDrawEvent = {\r\n                            x: event.x1,\r\n                            y: event.y1,\r\n                            pressure: event.pressure1,\r\n                        };\r\n                    }\r\n                }\r\n\r\n\r\n                if (event.type === 'down' || event.type === 'move') {\r\n                    this.lastDrawEvent = {\r\n                        x: event.x,\r\n                        y: event.y,\r\n                        pressure: event.pressure,\r\n                    };\r\n                }\r\n                p.onDraw(event);\r\n            },\r\n        });\r\n\r\n        this.pointer = null;\r\n        this.isDrawing = false;\r\n\r\n\r\n        this.inputProcessorObj = {\r\n            draw: {\r\n                onPointer: (val) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Draw);\r\n\r\n                    const comboStr = this.keyListener.getComboStr();\r\n\r\n                    const event: any = {\r\n                        scale: this.highResTransformObj.scale,\r\n                    };\r\n                    event.shiftIsPressed = comboStr === 'shift';\r\n                    event.pressure = val.pressure;\r\n                    event.isCoalesced = !!val.isCoalesced;\r\n\r\n                    if (val.type === 'pointerdown') {\r\n\r\n                        this.isDrawing = true;\r\n                        event.type = 'down';\r\n\r\n                    } else if (val.button) {\r\n                        event.type = 'move';\r\n\r\n                    } else if (val.type === 'pointerup') {\r\n\r\n                        this.isDrawing = false;\r\n                        event.type = 'up';\r\n\r\n                        this.linetoolProcessor.process(event);\r\n                        this.resetInputProcessor();\r\n                        return;\r\n                    } else {\r\n                        return;\r\n                    }\r\n\r\n                    event.x = val.relX;\r\n                    event.y = val.relY;\r\n\r\n                    this.linetoolProcessor.process(event);\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            fill: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Fill);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            gradient: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Gradient);\r\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        this.isDrawing = true;\r\n                        p.onGradient('down', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        p.onGradient('move', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.isDrawing = false;\r\n                        p.onGradient('up', coord.x, coord.y, this.renderedTransformObj.angle);\r\n                        this.resetInputProcessor();\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            text: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Text);\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                        return;\r\n\r\n                    }\r\n\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            shape: {\r\n                onPointer: (event) => {\r\n\r\n                    this.reqFrame();\r\n                    this.updateCursor(TMode.Shape);\r\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n\r\n                    if (event.type === 'pointerdown') {\r\n                        this.isDrawing = true;\r\n                        p.onShape('down', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        p.onShape('move', coord.x, coord.y, this.renderedTransformObj.angle);\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.isDrawing = false;\r\n                        p.onShape('up', coord.x, coord.y, this.renderedTransformObj.angle);\r\n                        this.resetInputProcessor();\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            hand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    } else if (event.type === 'pointerup') {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            spaceHand: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Hand);\r\n                    if (['left', 'middle'].includes(event.button)) {\r\n                        this.updateCursor(TMode.HandGrabbing);\r\n                        this.targetTransformObj.x += event.dX;\r\n                        this.targetTransformObj.y += event.dY;\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.doAnimateTranslate = false;\r\n                        this.transformIsDirty = true;\r\n                        this.reqFrame(true);\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'space') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                },\r\n            },\r\n            zoom: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Zoom);\r\n\r\n                    if (event.button === 'left' && !event.isCoalesced && event.dX != 0) {\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n\r\n                        this.internalZoomByStep(event.dX / 175, event.downPageX - offsetX, event.downPageY - offsetY);\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale,\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'z') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Zoom);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                },\r\n            },\r\n            picker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup',\r\n                        });\r\n\r\n                        if (event.type === 'pointerup') {\r\n                            this.resetInputProcessor();\r\n                        }\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n\r\n                },\r\n            },\r\n            altPicker: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(TMode.Pick);\r\n                    if (\r\n                        (['left', 'right'].includes(event.button) && !event.isCoalesced) ||\r\n                        event.type === 'pointerup'\r\n                    ) {\r\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\r\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\r\n                        p.onPick(pickedColor, event.type === 'pointerup');\r\n                        this.svgOverlay.updateColorPreview({\r\n                            x: event.relX,\r\n                            y: event.relY,\r\n                            color: pickedColor,\r\n                            isVisible: event.type !== 'pointerup',\r\n                        });\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (comboStr !== 'alt') {\r\n                        this.resetInputProcessor();\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    this.resetInputProcessor();\r\n                },\r\n            },\r\n            rotate: {\r\n                onPointer: (event) => {\r\n                    this.updateCursor(event.button === 'left' ? TMode.Rotating : TMode.Rotate);\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.oldTransformObj = BB.copyObj(this.targetTransformObj);\r\n                    } else if (event.button === 'left' && !event.isCoalesced && this.oldTransformObj) {\r\n\r\n\r\n                        const offsetX = event.pageX - event.relX;\r\n                        const offsetY = event.pageY - event.relY;\r\n                        //rotation done around center\r\n                        const centerObj = {\r\n                            x: this.renderWidth / 2,\r\n                            y: this.renderHeight / 2,\r\n                        };\r\n\r\n                        const startAngleRad = BB.Vec2.angle(centerObj, {x: event.downPageX - offsetX, y: event.downPageY - offsetY});\r\n                        const angleRad = BB.Vec2.angle(centerObj, {x: event.pageX - offsetX, y: event.pageY - offsetY});\r\n                        let dAngleRad = angleRad - startAngleRad;\r\n\r\n                        //apply angle\r\n                        this.targetTransformObj = BB.copyObj(this.oldTransformObj);\r\n                        this.targetTransformObj.angle += dAngleRad;\r\n\r\n                        if (this.keyListener.isPressed('shift')) {\r\n                            this.targetTransformObj.angle = Math.round(this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\r\n                            dAngleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n                        }\r\n\r\n                        this.targetTransformObj.angle = this.minimizeAngleRad(this.targetTransformObj.angle);\r\n\r\n                        //rotate transform.xy\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(dAngleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n\r\n                        this.transformIsDirty = true;\r\n                        this.lastRenderedState = -1;\r\n                        this.reqFrame();\r\n\r\n                        this.onViewChange({\r\n                            changed: ['angle'],\r\n                            scale: this.targetTransformObj.scale,\r\n                            angle: this.targetTransformObj.angle,\r\n                        });\r\n\r\n                    }\r\n                },\r\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n                onKeyUp: (keyStr, event, oldComboStr) => {\r\n                    const comboStr = this.keyListener.getComboStr();\r\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\r\n                        this.updateCursor(TMode.Rotate);\r\n                    } else {\r\n                        this.resetInputProcessor();\r\n                    }\r\n                },\r\n            },\r\n        };\r\n        this.currentInputProcessor = null;\r\n\r\n\r\n        this.angleIsExtraSticky = false;\r\n        this.pinchZoomer = new BB.PinchZoomer({\r\n            onPinch: (event) => {\r\n\r\n                if (event.type === 'move') {\r\n\r\n                    if (!this.oldTransformObj) {\r\n                        this.oldTransformObj = BB.copyObj(this.targetTransformObj);\r\n                        this.angleIsExtraSticky = this.targetTransformObj.angle % (Math.PI / 2) === 0;\r\n                    }\r\n\r\n                    this.targetTransformObj = BB.copyObj(this.oldTransformObj);\r\n\r\n                    event.scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, this.targetTransformObj.scale * event.scale)) / this.targetTransformObj.scale;\r\n\r\n                    this.targetTransformObj.scale *= event.scale;\r\n                    this.targetTransformObj.angle += event.angleRad;\r\n                    this.targetTransformObj.angle = this.minimizeAngleRad(\r\n                        this.snapAngleRad(\r\n                            this.targetTransformObj.angle,\r\n                            90,\r\n                            this.angleIsExtraSticky ? 12 : 4\r\n                        )\r\n                    );\r\n                    if (this.targetTransformObj.angle % (Math.PI / 2) !== 0) {\r\n                        this.angleIsExtraSticky = false;\r\n                    }\r\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\r\n                    event.angleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\r\n\r\n                    //calc translation\r\n                    {\r\n                        let matrix = BB.Matrix.getIdentity();\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX, event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(event.scale));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(event.angleRad));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-event.relX, -event.relY));\r\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\r\n\r\n\r\n                        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n\r\n                        this.targetTransformObj.x = origin[0];\r\n                        this.targetTransformObj.y = origin[1];\r\n\r\n                    }\r\n\r\n                    this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n\r\n                    //if (event.scale !== 1) {\r\n                    this.onViewChange({\r\n                        changed: ['scale', 'angle'],\r\n                        scale: this.targetTransformObj.scale,\r\n                        angle: this.targetTransformObj.angle,\r\n                    });\r\n                    //}\r\n                    this.reqFrame();\r\n                    this.transformIsDirty = true;\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                } else if (event.type === 'end') {\r\n                    this.oldTransformObj = null;\r\n                }\r\n\r\n\r\n            },\r\n        });\r\n\r\n        const onDoubleTap = (event) => {\r\n            if (_this.fitView()) {\r\n                this.lastRenderedState = -1;\r\n                this.reqFrame();\r\n            } else {\r\n                // zoom 2 steps further\r\n\r\n                const didZoom = this.internalZoomByStep(\r\n                    2,\r\n                    event.relX,\r\n                    event.relY,\r\n                );\r\n                if (didZoom) {\r\n                    this.onViewChange({\r\n                        changed: ['scale'],\r\n                        angle: this.targetTransformObj.angle,\r\n                        scale: this.targetTransformObj.scale,\r\n                    });\r\n                }\r\n\r\n                //updateCursor(TMode.Draw, true);\r\n                this.lastRenderedState = -1;\r\n            }\r\n        };\r\n\r\n        this.mainDoubleTapper = new BB.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper = new BB.DoubleTapper({ onDoubleTap });\r\n        this.middleDoubleTapper.setAllowedButtonArr(['middle']);\r\n\r\n\r\n        this.twoFingerTap = new BB.NFingerTapper({\r\n            fingers: 2,\r\n            onTap: () => {\r\n                p.onUndo();\r\n            },\r\n        });\r\n        this.threeFingerTap = new BB.NFingerTapper({\r\n            fingers: 3,\r\n            onTap: () => {\r\n                p.onRedo();\r\n            },\r\n        });\r\n\r\n\r\n        this.pointerEventChain = new BB.EventChain({\r\n            chainArr: [\r\n                this.twoFingerTap,\r\n                this.threeFingerTap,\r\n                this.mainDoubleTapper,\r\n                this.middleDoubleTapper,\r\n                this.pinchZoomer,\r\n                new BB.OnePointerLimiter(),\r\n                new BB.CoalescedExploder(),\r\n            ],\r\n        });\r\n        this.pointerEventChain.setChainOut((event: IPointerEvent) => {\r\n\r\n            this.cursorPos.x = event.relX;\r\n            this.cursorPos.y = event.relY;\r\n            if (event.type === 'pointerup' && event.pointerType === 'touch') {\r\n                this.pointer = null;\r\n                this.lastRenderedState = -1;\r\n                this.reqFrame();\r\n            } else {\r\n                if (!this.pointer) {\r\n                    this.pointer = { x: 0, y: 0 };\r\n                }\r\n                this.pointer.x = event.relX;\r\n                this.pointer.y = event.relY;\r\n            }\r\n\r\n            if (this.currentInputProcessor) {\r\n                this.currentInputProcessor.onPointer(event);\r\n\r\n            } else {\r\n\r\n                const comboStr = this.keyListener.getComboStr();\r\n\r\n                if (this.globalMode === TMode.Draw) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.draw;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Draw);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Hand) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'middle'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Hand);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Pick) {\r\n\r\n                    if (event.type === 'pointerdown' && ['left', 'right'].includes(event.button)) {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Pick);\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Fill) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.fill;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Fill);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Gradient) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.gradient;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Gradient);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Text) {\r\n\r\n                    if (event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.text;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Text);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                } else if (this.globalMode === TMode.Shape) {\r\n\r\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.shape;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\r\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\r\n                        this.currentInputProcessor.onPointer(event);\r\n                    } else {\r\n                        this.updateCursor(TMode.Shape);\r\n                        this.reqFrame();\r\n                    }\r\n\r\n                }\r\n\r\n\r\n            }\r\n\r\n        });\r\n\r\n        //prevent ctrl scroll -> zooming page\r\n        this.rootEl.addEventListener('wheel', (event) => {\r\n            event.preventDefault();\r\n        });\r\n\r\n\r\n        setTimeout(() => {\r\n            this.pointerListener = new BB.PointerListener({\r\n                target: this.rootEl,\r\n                fixScribble: true,\r\n                onPointer: (e) => {\r\n                    if (e.type === 'pointerdown' && e.button === 'middle') {\r\n                        try {\r\n                            e.eventPreventDefault();\r\n                        } catch (e) {}\r\n                    }\r\n                    // prevent manual slider input keeping focus on iPad\r\n                    if (e.type === 'pointerdown') {\r\n                        BB.unfocusAnyInput();\r\n                    }\r\n                    /*if (e.type === 'pointermove') {\r\n                        BB.throwOut(JSON.stringify(e));\r\n                    }*/\r\n\r\n                    this.pointerEventChain.chainIn(e);\r\n                },\r\n                onWheel: (wheelEvent) => {\r\n\r\n                    if (this.isDrawing) {\r\n                        return;\r\n                    }\r\n\r\n                    this.reqFrame();\r\n                    const didZoom = this.internalZoomByStep(\r\n                        -wheelEvent.deltaY / (this.keyListener.isPressed('shift') ? 8 : 2),\r\n                        wheelEvent.relX,\r\n                        wheelEvent.relY\r\n                    );\r\n                    if (didZoom) {\r\n                        this.onViewChange({\r\n                            changed: ['scale'],\r\n                            angle: this.targetTransformObj.angle,\r\n                            scale: this.targetTransformObj.scale,\r\n                        });\r\n                    }\r\n\r\n                    //updateCursor(TMode.Draw, true);\r\n                    this.lastRenderedState = -1;\r\n\r\n\r\n                },\r\n                onEnterLeave: (isOver) => {\r\n                    if (!isOver) {\r\n                        if (!this.isDrawing) {\r\n                            this.pointer = null;\r\n                            this.lastRenderedState = -1;\r\n                        }\r\n                    }\r\n                },\r\n                maxPointers: 4,\r\n            });\r\n        }, 1);\r\n\r\n        this.brushRadius = 1;\r\n\r\n        this.animationFrameRequested = false;\r\n\r\n\r\n\r\n\r\n        //setup rendering\r\n        this.lastRenderedState = -2;\r\n        this.lastRenderTime = performance.now();\r\n\r\n        window.requestAnimationFrame(() => this.updateLoop());\r\n\r\n        this.resetView();\r\n    }\r\n\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setCanvas (klC: KlCanvas): void {\r\n        this.klCanvas = klC;\r\n        this.lastDrawEvent = null;\r\n        this.resetView();\r\n\r\n        this.updateChangeListener();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    /**\r\n     * set size of workspace area in pixels\r\n     * @param width\r\n     * @param height\r\n     */\r\n    setSize (width: number, height: number): void {\r\n        const oldWidth = this.renderWidth;\r\n        const oldHeight = this.renderHeight;\r\n\r\n        if (width === oldWidth && height === oldHeight) {\r\n            return;\r\n        }\r\n\r\n        this.doResizeCanvas = true;\r\n        this.renderWidth = width;\r\n        this.renderHeight = height;\r\n\r\n        this.svgOverlay.setSize(width, height);\r\n\r\n        this.targetTransformObj.x += (width - oldWidth) / 2;\r\n        this.targetTransformObj.y += (height - oldHeight) / 2;\r\n\r\n        this.highResTransformObj.x = this.targetTransformObj.x;\r\n        this.highResTransformObj.y = this.targetTransformObj.y;\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setMode (modeStr: TModeStr): void {\r\n        //only sets the base mode\r\n        if (modeStr === 'draw') {\r\n            this.globalMode = TMode.Draw;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'fill') {\r\n            this.globalMode = TMode.Fill;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'gradient') {\r\n            this.globalMode = TMode.Gradient;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'text') {\r\n            this.globalMode = TMode.Text;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'shape') {\r\n            this.globalMode = TMode.Shape;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n        if (modeStr === 'hand') {\r\n            this.globalMode = TMode.Hand;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\r\n        }\r\n        if (modeStr === 'pick') {\r\n            this.globalMode = TMode.Pick;\r\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\r\n        }\r\n    }\r\n\r\n    getMode (): TModeStr {\r\n        if (this.globalMode === TMode.Draw) {\r\n            return 'draw';\r\n        }\r\n        if (this.globalMode === TMode.Fill) {\r\n            return 'fill';\r\n        }\r\n        if (this.globalMode === TMode.Gradient) {\r\n            return 'gradient';\r\n        }\r\n        if (this.globalMode === TMode.Text) {\r\n            return 'text';\r\n        }\r\n        if (this.globalMode === TMode.Shape) {\r\n            return 'shape';\r\n        }\r\n        if (this.globalMode === TMode.Hand) {\r\n            return 'hand';\r\n        }\r\n        if (this.globalMode === TMode.Pick) {\r\n            return 'pick';\r\n        }\r\n    }\r\n\r\n    setEnabled (b: boolean): void {\r\n        // todo\r\n    }\r\n\r\n    setCursorSize (diameter: number): void {\r\n        this.brushRadius = diameter / 2;\r\n\r\n        this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\r\n\r\n        if (this.pointer === null) {\r\n            this.hideBrushCursorTimeout && clearTimeout(this.hideBrushCursorTimeout);\r\n\r\n            this.svgOverlay.updateCursor({\r\n                x: this.renderWidth / 2,\r\n                y: this.renderHeight / 2,\r\n                isVisible: true,\r\n            });\r\n\r\n            this.hideBrushCursorTimeout = setTimeout(() => {\r\n                if (this.pointer !== null) {\r\n                    return;\r\n                }\r\n                this.svgOverlay.updateCursor({isVisible: false});\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n    zoomByStep (stepNum: number): void {\r\n        if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) {\r\n            return;\r\n        }\r\n\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale'],\r\n            angle: this.targetTransformObj.angle,\r\n            scale: this.targetTransformObj.scale,\r\n        });\r\n    }\r\n\r\n    resetView (doAnimate?: boolean): void {\r\n        this.targetTransformObj.scale = 1;\r\n        this.targetTransformObj.angle = 0;\r\n\r\n        this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\r\n        this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\r\n\r\n        if (!doAnimate) {\r\n            this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n        } else {\r\n            this.doAnimateTranslate = true;\r\n            this.transformIsDirty = true;\r\n        }\r\n\r\n        this.bgVisible = this.testBgVisible();\r\n        this.reqFrame();\r\n\r\n        if (doAnimate) {\r\n            this.onViewChange({\r\n                changed: ['scale', 'angle'],\r\n                scale: this.targetTransformObj.scale,\r\n                angle: this.targetTransformObj.angle,\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * fit into view. center. snap angle. padding\r\n     * returns true if transform changes\r\n     */\r\n    fitView (): boolean {\r\n        // determine new transform\r\n        const newAngle = this.snapAngleRad(this.targetTransformObj.angle, 90, 90);\r\n\r\n        //calc width and height of bounds\r\n        const canvasPointsArr = [\r\n            [0, 0], // top left\r\n            [this.klCanvas.getWidth(), 0], // top right\r\n            [this.klCanvas.getWidth(), this.klCanvas.getHeight()], // bottom right\r\n            [0, this.klCanvas.getHeight()], // bottom left\r\n            [this.klCanvas.getWidth() / 2, this.klCanvas.getHeight() / 2], // center\r\n        ];\r\n\r\n        //setup transformation matrix\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(newAngle));\r\n\r\n        //rotate points\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            let coords = [canvasPointsArr[i][0], canvasPointsArr[i][1], 0, 1];\r\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\r\n            canvasPointsArr[i][0] = coords[0];\r\n            canvasPointsArr[i][1] = coords[1];\r\n        }\r\n\r\n        const boundsObj = {\r\n            x0: null,\r\n            y0: null,\r\n            x1: null,\r\n            y1: null,\r\n        };\r\n        for (let i = 0; i < canvasPointsArr.length; i++) {\r\n            if (boundsObj.x0 === null || canvasPointsArr[i][0] < boundsObj.x0) {\r\n                boundsObj.x0 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y0 === null || canvasPointsArr[i][1] < boundsObj.y0) {\r\n                boundsObj.y0 = canvasPointsArr[i][1];\r\n            }\r\n            if (boundsObj.x1 === null || canvasPointsArr[i][0] > boundsObj.x1) {\r\n                boundsObj.x1 = canvasPointsArr[i][0];\r\n            }\r\n            if (boundsObj.y1 === null || canvasPointsArr[i][1] > boundsObj.y1) {\r\n                boundsObj.y1 = canvasPointsArr[i][1];\r\n            }\r\n        }\r\n        const boundsWidth = boundsObj.x1 - boundsObj.x0;\r\n        const boundsHeight = boundsObj.y1 - boundsObj.y0;\r\n\r\n        //fit bounds\r\n        const padding = 0;\r\n        const { width: fitWidth } = BB.fitInto(\r\n            boundsWidth,\r\n            boundsHeight, \r\n            this.renderWidth - padding, \r\n            this.renderHeight - padding, \r\n            1\r\n        );\r\n\r\n        //determine scale\r\n        const factor = fitWidth / boundsWidth;\r\n\r\n        const newTargetTransformObj = {\r\n            angle: newAngle,\r\n            x: (this.renderWidth / 2) - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor,\r\n            y: (this.renderHeight / 2) - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor,\r\n            scale: factor,\r\n        };\r\n\r\n        if (\r\n            newTargetTransformObj.angle === this.targetTransformObj.angle &&\r\n            Math.abs(newTargetTransformObj.x - this.targetTransformObj.x) < 0.0000000001 &&\r\n            Math.abs(newTargetTransformObj.y - this.targetTransformObj.y) < 0.0000000001 &&\r\n            newTargetTransformObj.scale === this.targetTransformObj.scale\r\n        ) {\r\n            return false;\r\n        }\r\n        this.targetTransformObj = newTargetTransformObj;\r\n\r\n        this.doAnimateTranslate = true;\r\n        this.transformIsDirty = true;\r\n        this.reqFrame();\r\n\r\n        this.onViewChange({\r\n            changed: ['scale', 'angle'],\r\n            scale: this.targetTransformObj.scale,\r\n            angle: this.targetTransformObj.angle,\r\n        });\r\n        return true;\r\n    }\r\n\r\n    setAngle (angleDeg: number, isRelative?: boolean): void {\r\n        //rotation done around center\r\n        const centerObj = {\r\n            x: this.renderWidth / 2,\r\n            y: this.renderHeight / 2,\r\n        };\r\n\r\n        const oldAngleRad = this.targetTransformObj.angle;\r\n        const angleRad = angleDeg / 180 * Math.PI;\r\n\r\n        if (isRelative) {\r\n            this.targetTransformObj.angle += angleRad;\r\n        } else {\r\n            this.targetTransformObj.angle = angleRad;\r\n        }\r\n\r\n        this.targetTransformObj.angle = this.minimizeAngleRad(\r\n            this.snapAngleRad(\r\n                this.targetTransformObj.angle,\r\n                90,\r\n                4\r\n            )\r\n        );\r\n\r\n        //rotate transform.xy\r\n        let matrix = BB.Matrix.getIdentity();\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\r\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\r\n\r\n        let origin = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\r\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\r\n        this.targetTransformObj.x = origin[0];\r\n        this.targetTransformObj.y = origin[1];\r\n\r\n        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\r\n        this.transformIsDirty = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    /**\r\n     * translate canvas by viewport pixels\r\n     * @param tx\r\n     * @param ty\r\n     */\r\n    translateView (tx: number, ty: number): void {\r\n        const scale = 40;\r\n\r\n        this.targetTransformObj.x += tx * scale;\r\n        this.targetTransformObj.y += ty * scale;\r\n\r\n        this.transformIsDirty = true;\r\n        this.doAnimateTranslate = true;\r\n        this.reqFrame(true);\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    getScale (): number {\r\n        return this.targetTransformObj.scale;\r\n    }\r\n\r\n    getAngleDeg (): number {\r\n        return this.targetTransformObj.angle * 180 / Math.PI;\r\n    }\r\n\r\n    getMaxScale (): number {\r\n        return MAX_SCALE;\r\n    }\r\n\r\n    getMinScale (): number {\r\n        return MIN_SCALE;\r\n    }\r\n\r\n    requestFrame (): void {\r\n        this.lastRenderedState = -1;\r\n        this.reqFrame();\r\n    }\r\n\r\n    setLastDrawEvent (x: number | null, y?: number, pressure?: number): void {\r\n        if (x === null) {\r\n            this.lastDrawEvent = null;\r\n            return;\r\n        }\r\n\r\n        if (!this.lastDrawEvent) {\r\n            this.lastDrawEvent = {x: 0, y: 0, pressure: 0};\r\n        }\r\n        this.lastDrawEvent.x = x;\r\n        this.lastDrawEvent.y = y;\r\n        this.lastDrawEvent.pressure = pressure;\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ayl5b\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"8Sx0P\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ixtEz\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3iHbP\");","import {IDrawDownEvent, IDrawMoveEvent, IDrawUpEvent, TDrawEvent} from '../kl-types';\r\nimport {BB} from '../../bb/bb';\r\n\r\nconst DIR_X = 0;\r\nconst DIR_Y = 1;\r\n\r\n/**\r\n * Not really and event chain element. but pretty similar.\r\n *\r\n * Processes draw input events. When shift held -> linetool\r\n * line events - what KlCanvasWorkspace passes onDraw(e)\r\n *\r\n * pass input in with process(drawEvent)\r\n *\r\n * modifies draw event to include such events:\r\n * {\r\n *     type: 'line',\r\n *     x0: null, // you have to fill that in\r\n *     y0: null, // you have to fill that in\r\n *     pressure0: null, // you have to fill that in\r\n *     x1: number,\r\n *     y1: number,\r\n *     pressure1: number\r\n * }\r\n */\r\nexport class LinetoolProcessor {\r\n\r\n    private readonly onDraw: (drawEvent: TDrawEvent) => void;\r\n    private downEvent: IDrawDownEvent | null = null;\r\n    private eventQueue: (IDrawDownEvent | IDrawMoveEvent | IDrawUpEvent)[] = [];\r\n    private direction: 0 | 1 | null = null;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p : {\r\n            onDraw: (drawEvent: TDrawEvent) => void;\r\n        }\r\n    ) {\r\n        this.onDraw = p.onDraw;\r\n    }\r\n\r\n    process (event: IDrawDownEvent | IDrawMoveEvent | IDrawUpEvent): void {\r\n        if (event.type === 'down') {\r\n            this.downEvent = event;\r\n            this.direction = null;\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                this.onDraw({\r\n                    type: 'line',\r\n                    x0: null,\r\n                    y0: null,\r\n                    pressure0: null,\r\n                    x1: event.x,\r\n                    y1: event.y,\r\n                    pressure1: event.pressure,\r\n                });\r\n\r\n                this.eventQueue.push(event);\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'move' && this.downEvent) {\r\n\r\n            if (event.shiftIsPressed) {\r\n\r\n                if (this.direction === null) {\r\n                    const dX = Math.abs(event.x - this.downEvent.x);\r\n                    const dY = Math.abs(event.y - this.downEvent.y);\r\n\r\n                    if (dX > 5 || dY > 5) {\r\n                        this.direction = dX > dY ? DIR_X : DIR_Y;\r\n\r\n                        for (let i = 0; i < this.eventQueue.length; i++) {\r\n                            const e = this.eventQueue[i];\r\n                            if (e.type !== 'up') {\r\n                                if (this.direction === DIR_X) {\r\n                                    e.y = this.downEvent.y;\r\n                                } else {\r\n                                    e.x = this.downEvent.x;\r\n                                }\r\n                            }\r\n                            this.onDraw(BB.copyObj(e));\r\n                        }\r\n                        this.eventQueue = [];\r\n                    }\r\n                }\r\n\r\n                if (this.direction === null) {\r\n                    this.eventQueue.push(event);\r\n                    return;\r\n                }\r\n\r\n                if (this.direction === DIR_X) {\r\n                    event.y = this.downEvent.y;\r\n                } else {\r\n                    event.x = this.downEvent.x;\r\n                }\r\n\r\n            } else {\r\n                if (this.eventQueue.length > 0) {\r\n                    for (let i = 0; i < this.eventQueue.length; i++) {\r\n                        this.onDraw(BB.copyObj(this.eventQueue[i]));\r\n                    }\r\n                    this.eventQueue = [];\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        if (event.type === 'up') {\r\n            this.eventQueue = [];\r\n            this.downEvent = null;\r\n        }\r\n\r\n        this.onDraw(BB.copyObj(event));\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IKlBasicLayer} from '../kl-types';\r\nimport {theme} from '../../theme/theme';\r\n\r\n/**\r\n * preview of image with layers. can do mix modes and opacity.\r\n * creates a canvas.\r\n */\r\nexport class KlCanvasPreview {\r\n\r\n    private readonly canvas: HTMLCanvasElement;\r\n    private readonly ctx: CanvasRenderingContext2D | null;\r\n    private readonly layers: IKlBasicLayer[];\r\n    private readonly updateCheckerboard: () => void;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            width: number;\r\n            height: number;\r\n            layers: IKlBasicLayer[]; // items can be changed after the fact - but not the object\r\n        }\r\n    ) {\r\n        this.layers = p.layers;\r\n\r\n        const scale = p.width / p.layers[0].image.width;\r\n        const width = scale > 1 ? p.layers[0].image.width : p.width;\r\n        const height = scale > 1 ? p.layers[0].image.height : p.height;\r\n\r\n        this.canvas = BB.canvas(width, height);\r\n        this.updateCheckerboard = () => {\r\n            this.canvas.style.backgroundImage = 'url(' + BB.createCheckerDataUrl(8, undefined, theme.isDark()) + ')';\r\n        };\r\n        this.updateCheckerboard();\r\n        this.ctx = BB.ctx(this.canvas);\r\n\r\n        BB.css(this.canvas, {\r\n            width: '100%',\r\n            height: '100%',\r\n            imageRendering: scale > 1 ? 'pixelated' : undefined,\r\n        });\r\n\r\n        setTimeout(() => this.render(), 0);\r\n        theme.addIsDarkListener(this.updateCheckerboard);\r\n    }\r\n\r\n    getElement (): HTMLCanvasElement {\r\n        return this.canvas;\r\n    }\r\n\r\n    render (): void {\r\n        if (!this.ctx) {\r\n            return;\r\n        }\r\n\r\n        this.ctx.save();\r\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        for (let i = 0; i < this.layers.length; i++) {\r\n            this.ctx.globalAlpha = this.layers[i].opacity;\r\n            this.ctx.globalCompositeOperation = this.layers[i].mixModeStr as GlobalCompositeOperation;\r\n            if (this.canvas.width > this.layers[i].image.width) {\r\n                this.ctx.imageSmoothingEnabled = false;\r\n            }\r\n            this.ctx.drawImage(this.layers[i].image, 0, 0, this.canvas.width, this.canvas.height);\r\n        }\r\n        this.ctx.restore();\r\n    }\r\n\r\n    destroy (): void {\r\n        theme.removeIsDarkListener(this.updateCheckerboard);\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport rotateImg from '/src/app/img/ui/cursor-rotate.png';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {\r\n    copyTransform,\r\n    IFreeTransform,\r\n    snapToPixel,\r\n    TFreeTransformCorner,\r\n    TFreeTransformEdge,\r\n    toImageSpace,\r\n    toTransformSpace,\r\n} from './free-transform-utils';\r\n\r\n/**\r\n * Free Transform UI\r\n * rotate, scale, translate\r\n *\r\n * - if rotation is multiple of 90 it will snap to pixels, to be more useful for pixel art\r\n * - when rotation goes from non-multiple of 90 to a multiple, it will snap position and width height to pixels\r\n * - transform.x, transform.y can sit between pixels (by 0.5) if width or height is odd number.\r\n *      - this is what complicates things\r\n * - if transform region small, corner grips move out of the way\r\n *\r\n * iX iY, iP.x, iP.y - i indicates image space\r\n * tX tY, tP.x, tP.y - t indicates transform space\r\n *\r\n * Not sure if it can be used for navigable canvas. (especially if canvas rotates view)\r\n * Probably can't be extended for distort. Needs a different approach.\r\n *\r\n * --- DOM structure ---\r\n * rootEl {\r\n * \ttransEl [\r\n * \t\tboundsEl\r\n * \t\tedges[]\r\n * \t\tcorners[] - round grips in the corner of transform region\r\n * \t\tangleGrip\r\n * \t]\r\n * }\r\n *\r\n */\r\nexport class FreeTransform {\r\n\r\n    // --- private ---\r\n    private readonly transform: IFreeTransform; // coordinates and dimensions of transformation\r\n    private isConstrained: boolean;\r\n    private ratio: number; // aspect ratio of transform\r\n    private readonly scale: number;\r\n    private readonly scaled = { // scaled coordinates and dimensions for screenspace\r\n        x: 0,\r\n        y: 0,\r\n        width: 0,\r\n        height: 0,\r\n        corners: [{x: 0, y: 0}], // in transform space\r\n    };\r\n    private readonly minSnapDist = 7; // minimal snapping distance in px screenspace\r\n    private snappingEnabled: boolean;\r\n    private readonly snapX: number[];\r\n    private readonly snapY: number[];\r\n    private readonly callback: (transform: IFreeTransform) => void;\r\n\r\n\r\n    private readonly cornerCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n    private readonly gripSize = 14;\r\n    private readonly edgeSize = 10;\r\n\r\n    private readonly rootEl: HTMLElement; // sits at origin of image\r\n    private readonly transEl: HTMLElement; // at middle of transform. rotates\r\n    private readonly boundsEl: HTMLElement; // draggable bounds rectangle with outline\r\n    private readonly corners: TFreeTransformCorner[] = [];\r\n    private keyListener: KeyListener;\r\n    private boundsPointerListener: PointerListener; // BB.PointerListener\r\n    private anglePointerListener: PointerListener; // BB.PointerListener\r\n    private readonly edges: TFreeTransformEdge[] = [];\r\n    private readonly angleGrip: {\r\n        el: HTMLElement;\r\n        x: number; // transform space\r\n        y: number;\r\n        snap: boolean;\r\n        updateDOM: () => void;\r\n    };\r\n\r\n    private updateScaled (): void {\r\n        this.scaled.x = this.transform.x * this.scale;\r\n        this.scaled.y = this.transform.y * this.scale;\r\n        this.scaled.width = this.transform.width * this.scale;\r\n        this.scaled.height = this.transform.height * this.scale;\r\n        this.scaled.corners = this.corners.map((item) => {\r\n            return {x: item.x * this.scale, y: item.y * this.scale};\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\r\n     * both in image space\r\n     *\r\n     * @param iX - image space\r\n     * @param iY - image space\r\n     * @private\r\n     */\r\n    private snapCorner (iX: number, iY: number): IVector2D {\r\n        if (!this.snappingEnabled) {\r\n            return {x: iX, y: iY};\r\n        }\r\n        let dist: number;\r\n        const snap: {\r\n            x?: number;\r\n            y?: number;\r\n            dist: {\r\n                x?: number;\r\n                y?: number;\r\n            };\r\n        } = {\r\n            x: undefined,\r\n            y: undefined,\r\n            dist: {\r\n                x: undefined,\r\n                y: undefined,\r\n            },\r\n        };\r\n        for (let e = 0; e < this.snapX.length; e++) {\r\n            dist = Math.abs(iX - this.snapX[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.x === undefined || dist < snap.dist.x) {\r\n                    snap.x = this.snapX[e];\r\n                    snap.dist.x = dist;\r\n                }\r\n            }\r\n        }\r\n        for (let e = 0; e < this.snapY.length; e++) {\r\n            dist = Math.abs(iY - this.snapY[e]);\r\n            if (dist < this.minSnapDist / this.scale) {\r\n                if (snap.y === undefined || dist < snap.dist.y) {\r\n                    snap.y = this.snapY[e];\r\n                    snap.dist.y = dist;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (snap.x === undefined && snap.y === undefined) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        return {\r\n            x: snap.x ?? iX,\r\n            y: snap.y ?? iY,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * If constrained return nearest corner pos that fits aspect ratio\r\n     *\r\n     * @param cornerIndex\r\n     * @param iX\r\n     * @param iY\r\n     * @private\r\n     */\r\n    private constrainCorner (cornerIndex: number, iX: number, iY: number): IVector2D {\r\n        if (!this.isConstrained) {\r\n            return {\r\n                x: iX,\r\n                y: iY,\r\n            };\r\n        }\r\n        const flip = this.transform.width * this.transform.height < 0 ? -1 : 1;\r\n        return BB.projectPointOnLine(\r\n            {x: this.transform.x, y: this.transform.y},\r\n            toImageSpace(this.ratio, flip * ([0, 2].includes(cornerIndex) ? 1 : -1), this.transform),\r\n            {x: iX, y: iY}\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Update corners according to width height.\r\n     * Not their DOM.\r\n     */\r\n    private updateCornerPositions (): void {\r\n        this.corners[0].x = (-this.transform.width / 2); // top left\r\n        this.corners[0].y = (-this.transform.height / 2);\r\n\r\n        this.corners[1].x = (this.transform.width / 2); // top right\r\n        this.corners[1].y = (-this.transform.height / 2);\r\n\r\n        this.corners[2].x = (this.transform.width / 2); // bottom right\r\n        this.corners[2].y = (this.transform.height / 2);\r\n\r\n        this.corners[3].x = (-this.transform.width / 2); // bottom left\r\n        this.corners[3].y = (this.transform.height / 2);\r\n    }\r\n\r\n    /**\r\n     * If constrained and dragging an edge, restore aspect ratio\r\n     * Updates corner positions.\r\n     *\r\n     * @param widthChanged\r\n     * @param heightChanged\r\n     * @private\r\n     */\r\n    private restoreRatio (widthChanged: boolean, heightChanged: boolean): void {\r\n        if (!this.isConstrained) {\r\n            return;\r\n        }\r\n        const angle90 = Math.abs(this.transform.angleDeg) % 90 === 0;\r\n        const whSwapped = Math.abs(this.transform.angleDeg - 90) % 180 === 0;\r\n        if (heightChanged && !widthChanged) {\r\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\r\n            let newWidth = this.ratio * newHeight;\r\n            if (angle90) {\r\n                newWidth = (whSwapped ? this.transform.y % 1 : this.transform.x % 1) === 0 ?\r\n                    BB.roundEven(newWidth) : BB.roundUneven(newWidth);\r\n            }\r\n            if (this.corners[1].x - this.corners[0].x < 0) {\r\n                newWidth *= -1;\r\n            }\r\n            this.corners[0].x = -newWidth / 2;\r\n            this.corners[3].x = -newWidth / 2;\r\n            this.corners[1].x = newWidth / 2;\r\n            this.corners[2].x = newWidth / 2;\r\n        }\r\n        if (!heightChanged && widthChanged) {\r\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\r\n            let newHeight = newWidth / this.ratio;\r\n            if (angle90) {\r\n                newHeight = (whSwapped ? this.transform.x % 1 : this.transform.y % 1) === 0  ?\r\n                    BB.roundEven(newHeight) : BB.roundUneven(newHeight);\r\n            }\r\n            if (this.corners[3].y - this.corners[0].y < 0) {\r\n                newHeight *= -1;\r\n            }\r\n            this.corners[0].y = -newHeight / 2;\r\n            this.corners[1].y = -newHeight / 2;\r\n            this.corners[2].y = newHeight / 2;\r\n            this.corners[3].y = newHeight / 2;\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * update transform based on corners\r\n     * @private\r\n     */\r\n    private updateTransformViaCorners (): void {\r\n\r\n        // calc transform center in image space\r\n        const rot = BB.rotateAround(\r\n            {x: 0, y: 0},\r\n            {\r\n                x: (this.corners[0].x + this.corners[1].x) / 2,\r\n                y: (this.corners[0].y + this.corners[3].y) / 2,\r\n            },\r\n            this.transform.angleDeg\r\n        );\r\n        this.transform.x = rot.x + this.transform.x;\r\n        this.transform.y = rot.y + this.transform.y;\r\n\r\n        // update size\r\n        this.transform.width = this.corners[1].x - this.corners[0].x;\r\n        this.transform.height = this.corners[3].y - this.corners[0].y;\r\n\r\n        // new center means corners changed their position\r\n        this.updateCornerPositions();\r\n\r\n        this.updateDOM();\r\n    }\r\n\r\n    /**\r\n     * updates DOM according to transform\r\n     * @param skipCallback\r\n     */\r\n    private updateDOM (skipCallback?: boolean): void {\r\n        this.updateScaled();\r\n\r\n        BB.css(this.transEl, {\r\n            left: this.scaled.x + 'px',\r\n            top: this.scaled.y + 'px',\r\n            transformOrigin: '0 0',\r\n            transform: 'rotate(' + this.transform.angleDeg + 'deg)',\r\n        });\r\n\r\n        BB.css(this.boundsEl, {\r\n            width: Math.abs(this.scaled.width) + 'px',\r\n            height: Math.abs(this.scaled.height) + 'px',\r\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\r\n        });\r\n\r\n        this.corners[0].updateDOM();\r\n        this.corners[1].updateDOM();\r\n        this.corners[2].updateDOM();\r\n        this.corners[3].updateDOM();\r\n\r\n        this.edges[0].updateDOM();\r\n        this.edges[1].updateDOM();\r\n        this.edges[2].updateDOM();\r\n        this.edges[3].updateDOM();\r\n\r\n\r\n        this.angleGrip.x = 0;\r\n        this.angleGrip.y = (-Math.abs(this.transform.height * this.scale) / 2) - 20;\r\n        this.angleGrip.updateDOM();\r\n        if (!skipCallback) {\r\n            if (this.callback) { // why should updateDOM trigger the callback?\r\n                this.callback(copyTransform(this.transform));\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // --- public ---\r\n    constructor (\r\n        params: {\r\n            x: number; // center of transform region. image space\r\n            y: number;\r\n            width: number; // size of transform region. image space\r\n            height: number;\r\n            angleDeg: number; // angle of transform region. degrees\r\n\r\n            isConstrained: boolean; // proportions constrained\r\n            snapX: number[]; // where snapping along X axis. image space\r\n            snapY: number[]; // where snapping along X axis. image space\r\n            scale: number; // ratio of screen-space / image-space\r\n            callback: (transform: IFreeTransform) => void;\r\n        }\r\n    ) {\r\n        this.transform = { // coordinates and dimensions of transformation\r\n            x: params.x,\r\n            y: params.y,\r\n            width: params.width,\r\n            height: params.height,\r\n            angleDeg: params.angleDeg,\r\n        };\r\n\r\n        this.isConstrained = params.isConstrained;\r\n\r\n        this.snapX = params.snapX;\r\n        this.snapY = params.snapY;\r\n        this.callback = params.callback;\r\n        this.scale = params.scale;\r\n        this.snappingEnabled = true;\r\n        this.ratio = this.transform.width / this.transform.height;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-free-transform',\r\n            css: {\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.transEl = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                position: 'absolute',\r\n            },\r\n        });\r\n\r\n        this.boundsEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                cursor: 'move',\r\n                boxShadow: 'rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px',\r\n            },\r\n        });\r\n\r\n        const pointerRemainder = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        function resetRemainder (): void {\r\n            pointerRemainder.x = 0;\r\n            pointerRemainder.y = 0;\r\n        }\r\n        this.keyListener = new BB.KeyListener({});\r\n\r\n        let boundsStartP = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        this.boundsPointerListener = new BB.PointerListener({\r\n            target: this.boundsEl,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointerdown') {\r\n                    boundsStartP = {x: this.transform.x, y: this.transform.y};\r\n                }\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    this.transform.x = boundsStartP.x + (event.pageX - event.downPageX) / this.scale;\r\n                    this.transform.y = boundsStartP.y + (event.pageY - event.downPageY) / this.scale;\r\n\r\n\r\n                    let dist: number;\r\n                    let snap: {\r\n                        x?: number;\r\n                        y?: number;\r\n                        distX?: number;\r\n                        distY?: number;\r\n                    } = {};\r\n                    if (this.snappingEnabled) {\r\n                        let i;\r\n                        for (i = 0; i < this.snapX.length; i++) {\r\n                            dist = Math.abs(this.transform.x - this.snapX[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.x || dist < snap.distX) {\r\n                                    snap.x = this.snapX[i];\r\n                                    snap.distX = dist;\r\n                                }\r\n                            }\r\n                        }\r\n                        for (i = 0; i < this.snapY.length; i++) {\r\n                            dist = Math.abs(this.transform.y - this.snapY[i]);\r\n                            if (dist < this.minSnapDist / this.scale) {\r\n                                if (!snap.y || dist < snap.distY) {\r\n                                    snap.y = this.snapY[i];\r\n                                    snap.distY = dist;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        let iP;\r\n                        for (i = 0; i < 4; i++) {\r\n                            iP = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n                            let j;\r\n                            for (j = 0; j < this.snapX.length; j++) {\r\n                                dist = Math.abs(iP.x - this.snapX[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.x || dist < snap.distX) {\r\n                                        snap.x = this.snapX[j] - (iP.x - this.transform.x);\r\n                                        snap.distX = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                            for (j = 0; j < this.snapY.length; j++) {\r\n                                dist = Math.abs(iP.y - this.snapY[j]);\r\n                                if (dist < this.minSnapDist / this.scale) {\r\n                                    if (!snap.y || dist < snap.distY) {\r\n                                        snap.y = this.snapY[j] - (iP.y - this.transform.y);\r\n                                        snap.distY = dist;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        let projected = BB.projectPointOnLine(\r\n                            {x: 0, y: boundsStartP.y},\r\n                            {x: 10, y: boundsStartP.y},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        let dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        snap = {\r\n                            x: projected.x,\r\n                            y: projected.y,\r\n                            distX: dist,\r\n                            distY: dist,\r\n                        };\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: 0},\r\n                            {x: boundsStartP.x, y: 10},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap = {\r\n                                x: projected.x,\r\n                                y: projected.y,\r\n                                distX: dist,\r\n                                distY: dist,\r\n                            };\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y + 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap = {\r\n                                x: projected.x,\r\n                                y: projected.y,\r\n                                distX: dist,\r\n                                distY: dist,\r\n                            };\r\n                        }\r\n\r\n                        projected = BB.projectPointOnLine(\r\n                            {x: boundsStartP.x, y: boundsStartP.y},\r\n                            {x: boundsStartP.x + 1, y: boundsStartP.y - 1},\r\n                            {x: this.transform.x, y: this.transform.y});\r\n                        dist = BB.dist(projected.x, projected.y, this.transform.x, this.transform.y);\r\n                        if (dist < snap.distX) {\r\n                            snap = {\r\n                                x: projected.x,\r\n                                y: projected.y,\r\n                                distX: dist,\r\n                                distY: dist,\r\n                            };\r\n                        }\r\n                    }\r\n                    if (snap.x != undefined) {\r\n                        this.transform.x = snap.x;\r\n                    }\r\n                    if (snap.y != undefined) {\r\n                        this.transform.y = snap.y;\r\n                    }\r\n\r\n                    // snap to pixels\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                    }\r\n\r\n                    this.updateDOM();\r\n                }\r\n            },\r\n        });\r\n\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                const g = this.corners[i] = {\r\n                    i: i,\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.gripSize + 'px',\r\n                            height: this.gripSize + 'px',\r\n                            background: '#fff',\r\n                            /*background: [\r\n                                '#ff0000',\r\n                                '#00ff00',\r\n                                '#0000ff',\r\n                                '#ff00ff',\r\n                            ][i],*/\r\n                            borderRadius: this.gripSize + 'px',\r\n                            position: 'absolute',\r\n                            boxShadow: 'inset 0 0 0 2px #000',\r\n                        },\r\n                    }),\r\n                    x: 0,\r\n                    y: 0,\r\n                    virtualPos: {\r\n                        x: 0,\r\n                        y: 0,\r\n                    },\r\n                } as TFreeTransformCorner;\r\n                g.updateDOM = (): void => {\r\n\r\n                    // grip position\r\n                    // if gets small, offset grips, so easier to handle\r\n                    const offsetArr = [[-1, -1], [1, -1], [1, 1], [-1, 1]].map(item => {\r\n                        item[0] *= this.transform.width > 0 ? 1 : -1;\r\n                        item[1] *= this.transform.height > 0 ? 1 : -1;\r\n                        return item;\r\n                    });\r\n                    const tinyOffset = Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20 ? 10 : 0;\r\n\r\n                    BB.css(g.el, {\r\n                        left: (this.scaled.corners[g.i].x - this.gripSize / 2 + offsetArr[i][0] * tinyOffset) + 'px',\r\n                        top: (this.scaled.corners[g.i].y - this.gripSize / 2 + offsetArr[i][1] * tinyOffset) + 'px',\r\n                    });\r\n\r\n\r\n                    // cursor\r\n                    let angle = BB.pointsToAngleDeg(\r\n                        {\r\n                            x: this.transform.x,\r\n                            y: this.transform.y,\r\n                        },\r\n                        toImageSpace(g.x, g.y, this.transform),\r\n                    ) + 135; // offset so nw is 0\r\n                    while (angle < 0) {\r\n                        angle += 360;\r\n                    }\r\n                    const index = Math.round(angle / 45) % this.cornerCursors.length;\r\n                    BB.css(g.el, {\r\n                        cursor: this.cornerCursors[index] + '-resize',\r\n                    });\r\n                };\r\n\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.corners[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            this.corners[i].virtualPos = toImageSpace(this.corners[i].x, this.corners[i].y, this.transform);\r\n\r\n                        } else if (event.type === 'pointermove' && event.button === 'left') {\r\n                            this.corners[i].virtualPos.x += event.dX / this.scale;\r\n                            this.corners[i].virtualPos.y += event.dY / this.scale;\r\n\r\n                            let iP = {\r\n                                x: this.corners[i].virtualPos.x,\r\n                                y: this.corners[i].virtualPos.y,\r\n                            };\r\n                            iP = this.constrainCorner(i, iP.x, iP.y);\r\n                            if (!this.isConstrained) {\r\n                                iP = this.snapCorner(iP.x, iP.y);\r\n                            }\r\n\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                iP.x = Math.round(iP.x);\r\n                                iP.y = Math.round(iP.y);\r\n                            }\r\n\r\n                            const tP = toTransformSpace(iP.x, iP.y, this.transform);\r\n\r\n                            const dX = tP.x - this.corners[i].x;\r\n                            const dY = tP.y - this.corners[i].y;\r\n                            this.corners[i].x = tP.x;\r\n                            this.corners[i].y = tP.y;\r\n\r\n                            let indexes: number[] = [];\r\n                            if (i === 0) { // top left\r\n                                indexes = [3, 1, 2];\r\n                            } else if (i === 1) { // top right\r\n                                indexes = [2, 0, 3];\r\n                            } else if (i === 2) { // bottom right\r\n                                indexes = [1, 3, 0];\r\n                            } else if (i === 3) { // bottom left\r\n                                indexes = [0, 2, 1];\r\n                            }\r\n\r\n                            this.corners[indexes[0]].x = this.corners[i].x;\r\n                            this.corners[indexes[1]].y = this.corners[i].y;\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                this.corners[indexes[2]].x -= dX;\r\n                                this.corners[indexes[2]].y -= dY;\r\n                                this.corners[indexes[1]].x = this.corners[indexes[2]].x;\r\n                                this.corners[indexes[0]].y = this.corners[indexes[2]].y;\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    },\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.updateCornerPositions();\r\n        this.updateScaled();\r\n\r\n        let isInverted: boolean;\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i): void => {\r\n                this.edges[i] = {\r\n                    el: BB.el({\r\n                        css: {\r\n                            width: this.edgeSize + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                            /*background: [\r\n                                '#ff000044',\r\n                                '#00ff0044',\r\n                                '#0000ff44',\r\n                                '#ff00ff44',\r\n                            ][i],*/\r\n                            position: 'absolute',\r\n                        },\r\n                    }),\r\n                } as TFreeTransformEdge;\r\n                const g = this.edges[i];\r\n                g.updateDOM = () => {\r\n                    if (i === 0) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: (Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) - this.edgeSize) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 1) {\r\n                        BB.css(g.el, {\r\n                            left: Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\r\n                            top: Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    } else if (i === 2) {\r\n                        BB.css(g.el, {\r\n                            left: Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + 'px',\r\n                            top: Math.max(this.scaled.corners[0].y,this.scaled.corners[3].y) + 'px',\r\n                            width: Math.abs(this.scaled.width) + 'px',\r\n                            height: this.edgeSize + 'px',\r\n                        });\r\n                    } else if (i === 3) {\r\n                        BB.css(g.el, {\r\n                            left: (Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) - this.edgeSize) + 'px',\r\n                            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\r\n                            width: this.edgeSize + 'px',\r\n                            height: Math.abs(this.scaled.height) + 'px',\r\n                        });\r\n                    }\r\n                    let angleOffset = Math.round(this.transform.angleDeg / 45);\r\n                    while (angleOffset < 0) {\r\n                        angleOffset += 8;\r\n                    }\r\n                    angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\r\n                    g.el.style.cursor = this.cornerCursors[angleOffset] + '-resize';\r\n\r\n                };\r\n\r\n                const isVertical = [0, 2].includes(i);\r\n                g.pointerListener = new BB.PointerListener({\r\n                    target: this.edges[i].el,\r\n                    fixScribble: true,\r\n                    onPointer: (event) => {\r\n                        event.eventPreventDefault();\r\n                        if (event.type === 'pointerdown' && event.button === 'left') {\r\n                            if (isVertical) { // top bottom\r\n                                isInverted = this.corners[0].y >= this.corners[3].y;\r\n                            } else { // left right\r\n                                isInverted = this.corners[0].x >= this.corners[1].x;\r\n                            }\r\n                            resetRemainder();\r\n                        }\r\n                        if (event.type === 'pointermove' && event.button === 'left') {\r\n                            const tfD = BB.rotateAround({x: 0, y: 0},\r\n                                {x: event.dX / this.scale, y: event.dY / this.scale},\r\n                                -this.transform.angleDeg);\r\n                            let ti = {\r\n                                dX: tfD.x,\r\n                                dY: tfD.y,\r\n                            };\r\n                            if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                                ti = BB.intDxy(pointerRemainder, tfD.x, tfD.y);\r\n                            }\r\n\r\n                            let indexes: number[] = [];\r\n                            if (i === 0) { // top\r\n                                indexes = [2, 3, 0, 1];\r\n                            } else if (i === 1) { // right\r\n                                indexes = [0, 3, 1, 2];\r\n                            } else if (i === 2) { // bottom\r\n                                indexes = [0, 1, 2, 3];\r\n                            } else if (i === 3) { // left\r\n                                indexes = [1, 2, 0, 3];\r\n                            }\r\n\r\n                            const dimension = isVertical ? 'y' : 'x';\r\n                            const d = isVertical ? ti.dY : ti.dX;\r\n\r\n                            if (isInverted) {\r\n                                this.corners[indexes[0]][dimension] += d;\r\n                                this.corners[indexes[1]][dimension] += d;\r\n                            } else {\r\n                                this.corners[indexes[2]][dimension] += d;\r\n                                this.corners[indexes[3]][dimension] += d;\r\n                            }\r\n                            if (this.keyListener.isPressed('shift')) {\r\n                                if (isInverted) {\r\n                                    this.corners[indexes[2]][dimension] -= d;\r\n                                    this.corners[indexes[3]][dimension] -= d;\r\n                                } else {\r\n                                    this.corners[indexes[0]][dimension] -= d;\r\n                                    this.corners[indexes[1]][dimension] -= d;\r\n                                }\r\n                            }\r\n\r\n                            if (isVertical) { // top bottom\r\n                                this.restoreRatio(false, true);\r\n                            } else { // left right\r\n                                this.restoreRatio(true, false);\r\n                            }\r\n\r\n                            this.updateTransformViaCorners();\r\n\r\n                        }\r\n                    },\r\n                });\r\n\r\n            })(i);\r\n        }\r\n\r\n        this.angleGrip = {\r\n            el: BB.el({\r\n                css: {\r\n                    cursor: 'url(' + rotateImg + ') 10 10, move',\r\n                    width: this.gripSize + 'px',\r\n                    height: this.gripSize + 'px',\r\n                    background: '#0ff',\r\n                    borderRadius: this.gripSize + 'px',\r\n                    position: 'absolute',\r\n                    boxShadow: 'inset 0 0 0 2px #000',\r\n                },\r\n            }),\r\n            x: 0,\r\n            y: 0,\r\n            snap: false,\r\n            updateDOM: () => {\r\n                BB.css(this.angleGrip.el, {\r\n                    left: (this.angleGrip.x - this.gripSize / 2) + 'px',\r\n                    top: (this.angleGrip.y - this.gripSize / 2) + 'px',\r\n                });\r\n            },\r\n        };\r\n        BB.el({\r\n            parent: this.angleGrip.el,\r\n            css: {\r\n                width: '2px',\r\n                height: '13px',\r\n                left: (this.gripSize / 2 - 1) + 'px',\r\n                top: this.gripSize + 'px',\r\n                background: '#0ff',\r\n                position: 'absolute',\r\n            },\r\n        });\r\n\r\n        this.anglePointerListener = new BB.PointerListener({\r\n            target: this.angleGrip.el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    const bounds = this.rootEl.getBoundingClientRect();\r\n                    const offset = {\r\n                        x: bounds.left - this.rootEl.scrollLeft,\r\n                        y: bounds.top - this.rootEl.scrollTop,\r\n                    };\r\n                    const iP = {x: (event.clientX - offset.x) / this.scale, y: (event.clientY - offset.y) / this.scale};\r\n\r\n                    const a = BB.pointsToAngleDeg({x: this.transform.x, y: this.transform.y}, iP) + 90;\r\n                    this.transform.angleDeg = a;\r\n                    const snapDeg = Math.round(a / 360 * 8) * 45;\r\n                    if (this.keyListener.getComboStr() === 'shift') {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    } else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) {\r\n                        this.transform.angleDeg = snapDeg;\r\n                    }\r\n                    this.updateDOM();\r\n\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n                        snapToPixel(this.transform);\r\n                        this.updateCornerPositions();\r\n                        this.updateDOM();\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        snapToPixel(this.transform);\r\n        this.updateDOM(true);\r\n        BB.append(this.transEl, [\r\n            this.boundsEl,\r\n            this.edges[0].el,\r\n            this.edges[1].el,\r\n            this.edges[2].el,\r\n            this.edges[3].el,\r\n            this.corners[0].el,\r\n            this.corners[1].el,\r\n            this.corners[2].el,\r\n            this.corners[3].el,\r\n            this.angleGrip.el,\r\n        ]);\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    getTransform (): IFreeTransform {\r\n        return copyTransform(this.transform);\r\n    }\r\n\r\n    setConstrained (b: boolean): void {\r\n        this.isConstrained = b;\r\n        if (b && this.transform.width !== 0 && this.transform.height !== 0) {\r\n            this.ratio = Math.abs(this.transform.width / this.transform.height);\r\n        }\r\n    }\r\n\r\n    setSnapping (s: boolean): void {\r\n        this.snappingEnabled = s;\r\n    }\r\n\r\n    setPos (p: IVector2D): void {\r\n        this.transform.x = p.x;\r\n        this.transform.y = p.y;\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    move (dX: number, dY: number): void {\r\n        this.transform.x += dX;\r\n        this.transform.y += dY;\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setSize (w: number, h: number): void {\r\n        this.transform.width = w;\r\n        this.transform.height = h;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n        }\r\n        this.updateCornerPositions();\r\n        this.updateDOM(false);\r\n    }\r\n\r\n    setAngleDeg (a: number): void {\r\n        this.transform.angleDeg = a;\r\n        if (Math.abs(this.transform.angleDeg) % 90 === 0) {\r\n            snapToPixel(this.transform);\r\n            this.updateCornerPositions();\r\n        }\r\n        this.updateDOM(true);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    getRatio (): number {\r\n        return this.ratio;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.keyListener.destroy();\r\n        this.boundsPointerListener.destroy();\r\n        this.corners[0].pointerListener.destroy();\r\n        this.corners[1].pointerListener.destroy();\r\n        this.corners[2].pointerListener.destroy();\r\n        this.corners[3].pointerListener.destroy();\r\n        this.edges[0].pointerListener.destroy();\r\n        this.edges[1].pointerListener.destroy();\r\n        this.edges[2].pointerListener.destroy();\r\n        this.edges[3].pointerListener.destroy();\r\n        this.anglePointerListener.destroy();\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fcdZI\");","import {IVector2D} from '../../../bb/bb-types';\r\nimport {BB} from '../../../bb/bb';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\nexport interface IFreeTransform {\r\n    x: number; // center of transform region. image space\r\n    y: number;\r\n    width: number; // size of transform region. image space\r\n    height: number;\r\n    angleDeg: number; // angle of transform region. degrees\r\n}\r\n\r\n\r\nexport type TFreeTransformCorner = {\r\n    i: number; // index in corners array\r\n    el: HTMLElement; // draggable corner circle in DOM\r\n    x: number; // unscaled position (transform space)\r\n    y: number;\r\n    virtualPos: IVector2D; // unscaled temporary position (image space)\r\n    updateDOM: () => void; // update styling in DOM\r\n    pointerListener: PointerListener;\r\n};\r\n\r\nexport type TFreeTransformEdge = { // derive position from corners\r\n    el: HTMLElement;\r\n    updateDOM: () => void;\r\n    pointerListener: PointerListener;\r\n};\r\n\r\n/**\r\n * snap entire transform to pixel grid. changes transform\r\n *\r\n * for x y:\r\n * If a dimension has an even size, it be an integer.\r\n * If it's uneven, it's sits exactly half way between two pixels.\r\n *\r\n * @param transform\r\n */\r\nexport function snapToPixel (transform: IFreeTransform): void {\r\n    if (Math.abs(transform.angleDeg) % 90 !== 0) {\r\n        return;\r\n    }\r\n\r\n    transform.width = Math.round(transform.width);\r\n    transform.height = Math.round(transform.height);\r\n    // 0 is original orientation.\r\n    // At 90 and 270 width and height become swapped due to different orientation.\r\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\r\n    transform.x = ((whSwapped ? transform.height : transform.width) % 2 === 0) ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\r\n    transform.y = ((whSwapped ? transform.width : transform.height) % 2 === 0)  ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\r\n}\r\n\r\nexport function copyTransform (transform: IFreeTransform): IFreeTransform {\r\n    return {\r\n        x: transform.x,\r\n        y: transform.y,\r\n        width: transform.width,\r\n        height: transform.height,\r\n        angleDeg: transform.angleDeg,\r\n    };\r\n}\r\n\r\n/**\r\n * image space to transform space\r\n * - origin of transform space is at center of transform bounds.\r\n * - same scale as image space. -> one unit is x: 1/width, y: 1/height\r\n * - up is where transform points up\r\n * - x goes right\r\n * - y goes down\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nexport function toTransformSpace (x: number, y: number, transform: IFreeTransform): IVector2D {\r\n    let px, py;\r\n    px = x - transform.x;\r\n    py = y - transform.y;\r\n\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: px, y: py},\r\n        -transform.angleDeg);\r\n    px = rot.x;\r\n    py = rot.y;\r\n\r\n    return {\r\n        x: px,\r\n        y: py,\r\n    };\r\n}\r\n\r\n/**\r\n * transform space to image space\r\n * @param x\r\n * @param y\r\n * @param transform\r\n */\r\nexport function toImageSpace (x: number, y: number, transform: IFreeTransform): IVector2D {\r\n    const rot = BB.rotateAround({x: 0, y: 0},\r\n        {x: x, y: y},\r\n        transform.angleDeg);\r\n    return {\r\n        x: rot.x + transform.x,\r\n        y: rot.y + transform.y,\r\n    };\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {KlCanvasPreview} from '../../canvas-ui/canvas-preview';\r\nimport {FreeTransform} from './free-transform';\r\nimport {IKlBasicLayer} from '../../kl-types';\r\nimport {IRect} from '../../../bb/bb-types';\r\n\r\n/**\r\n * a basic canvas where you can transform one layer(move around, rotate, scale)\r\n *\r\n * DOM Structure:\r\n * div\r\n *      innerWrapper\r\n *          klCanvasPreview\r\n *          transform.div\r\n *\r\n */\r\nexport class FreeTransformCanvas {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly freeTransform: FreeTransform;\r\n    private readonly layers: IKlBasicLayer[];\r\n    private readonly transformIndex: number;\r\n    private readonly imageWidth: number;\r\n    private readonly imageHeight: number;\r\n    private readonly initTransform: IRect;\r\n    private readonly scale: number;\r\n    private readonly previewLayerArr: IKlBasicLayer[];\r\n    private readonly klCanvasPreview: KlCanvasPreview;\r\n\r\n    private updatePreview (): void {\r\n        if (!this.freeTransform) {\r\n            return;\r\n        }\r\n\r\n        const transform = this.freeTransform.getTransform();\r\n        if (this.scale < 1) {\r\n            transform.x *= this.scale;\r\n            transform.y *= this.scale;\r\n            transform.width *= this.scale;\r\n            transform.height *= this.scale;\r\n        }\r\n\r\n        const destCanvas = this.previewLayerArr[this.transformIndex].image;\r\n        const ctx = BB.ctx((destCanvas as HTMLCanvasElement));\r\n        ctx.save();\r\n        ctx.clearRect(0, 0, destCanvas.width, destCanvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            ctx,\r\n            this.layers[this.transformIndex].image,\r\n            transform,\r\n            undefined,\r\n            BB.testShouldPixelate(\r\n                transform,\r\n                transform.width / this.initTransform.width,\r\n                transform.height / this.initTransform.height\r\n            ),\r\n        );\r\n        ctx.restore();\r\n        this.klCanvasPreview.render();\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            elementWidth: number;\r\n            elementHeight: number;\r\n            imageWidth: number;\r\n            imageHeight: number;\r\n            layers: IKlBasicLayer[];\r\n            transformIndex: number;\r\n        }\r\n    ) {\r\n        this.imageWidth = p.imageWidth;\r\n        this.imageHeight = p.imageHeight;\r\n        const previewFit = BB.fitInto(\r\n            p.imageWidth,\r\n            this.imageHeight,\r\n            p.elementWidth - 20,\r\n            p.elementHeight - 60,\r\n            1\r\n        );\r\n        this.scale = previewFit.width / p.imageWidth;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: p.elementWidth + 'px',\r\n                height: p.elementHeight + 'px',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n        this.layers = p.layers;\r\n        this.transformIndex = p.transformIndex;\r\n\r\n\r\n        const innerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: previewFit.width + 'px',\r\n                height: previewFit.height + 'px',\r\n            },\r\n        });\r\n        this.rootEl.append(innerWrapper);\r\n\r\n        this.previewLayerArr = this.layers.map(item => {\r\n            return {\r\n                image: item.image,\r\n                mixModeStr: item.mixModeStr,\r\n                opacity: item.opacity,\r\n            };\r\n        });\r\n        this.previewLayerArr[this.previewLayerArr.length - 1].image = BB.canvas(\r\n            this.scale > 1 ? this.imageWidth : previewFit.width,\r\n            this.scale > 1 ? this.imageHeight : previewFit.height,\r\n        );\r\n        this.klCanvasPreview = new KlCanvasPreview({\r\n            width: previewFit.width,\r\n            height: previewFit.height,\r\n            layers: this.previewLayerArr,\r\n        });\r\n        innerWrapper.append(this.klCanvasPreview.getElement());\r\n\r\n        {\r\n            let transformSize = {\r\n                width: this.layers[this.transformIndex].image.width * this.scale,\r\n                height: this.layers[this.transformIndex].image.height * this.scale,\r\n            };\r\n            if (transformSize.width > previewFit.width || transformSize.height > previewFit.height) {\r\n                transformSize = BB.fitInto(\r\n                    this.layers[this.transformIndex].image.width,\r\n                    this.layers[this.transformIndex].image.height,\r\n                    previewFit.width,\r\n                    previewFit.height,\r\n                    1\r\n                );\r\n            }\r\n            this.initTransform = {\r\n                x: this.imageWidth / 2,\r\n                y: this.imageHeight / 2,\r\n                width: this.layers[this.transformIndex].image.width,\r\n                height: this.layers[this.transformIndex].image.height,\r\n            };\r\n            this.freeTransform = new FreeTransform({\r\n                x: this.initTransform.x,\r\n                y: this.initTransform.y,\r\n                width: this.initTransform.width,\r\n                height: this.initTransform.height,\r\n                angleDeg: 0,\r\n                isConstrained: true,\r\n                snapX: [0, this.imageWidth],\r\n                snapY: [0, this.imageHeight],\r\n                scale: this.scale,\r\n                callback: (transform) => {\r\n                    this.updatePreview();\r\n                },\r\n            });\r\n        }\r\n        BB.css(this.freeTransform.getElement(), {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n        });\r\n        innerWrapper.append(this.freeTransform.getElement());\r\n        setTimeout(() => this.updatePreview(), 0);\r\n    }\r\n\r\n\r\n    // ---- interface ----\r\n    move (dX: number, dY: number): void {\r\n        this.freeTransform.move(dX, dY);\r\n    }\r\n\r\n    reset (): void {\r\n        const w = this.layers[this.transformIndex].image.width;\r\n        const h = this.layers[this.transformIndex].image.height;\r\n\r\n        this.freeTransform.setSize(w, h);\r\n        this.freeTransform.setPos({x: w / 2, y: h / 2});\r\n        this.freeTransform.setAngleDeg(0);\r\n        this.updatePreview();\r\n    }\r\n\r\n    setTransformFit (): void {\r\n\r\n        const fit = BB.fitInto(\r\n            this.layers[this.transformIndex].image.width,\r\n            this.layers[this.transformIndex].image.height,\r\n            this.imageWidth,\r\n            this.imageHeight,\r\n            1\r\n        );\r\n\r\n        this.freeTransform.setSize(fit.width, fit.height);\r\n        this.freeTransform.setPos({x: fit.width / 2, y: fit.height / 2});\r\n        this.freeTransform.setAngleDeg(0);\r\n        this.updatePreview();\r\n    }\r\n\r\n    setTransformCenter (): void {\r\n        this.freeTransform.setPos({x: this.imageWidth / 2, y: this.imageHeight / 2});\r\n        this.freeTransform.setAngleDeg(0);\r\n        this.updatePreview();\r\n    }\r\n\r\n    /**\r\n     * gives you the transformation in the original scale\r\n     */\r\n    getTransformation (): any { // todo\r\n        if (!this.freeTransform) {\r\n            return false;\r\n        }\r\n        return this.freeTransform.getTransform();\r\n    }\r\n\r\n    getIsPixelated (): boolean {\r\n        const transform = this.freeTransform.getTransform();\r\n        return BB.testShouldPixelate(\r\n            transform,\r\n            transform.width / this.initTransform.width,\r\n            transform.height / this.initTransform.height\r\n        );\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.freeTransform.destroy();\r\n        this.klCanvasPreview.destroy();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {IRect, IVector2D} from '../../../bb/bb-types';\r\nimport {KeyListener} from '../../../bb/input/key-listener';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n\r\ntype TUpdateElement = {\r\n    el: HTMLElement;\r\n    update: () => void;\r\n};\r\n\r\n/**\r\n * Interactive preview for crop filter. Corners and edges can be dragged.\r\n * the div that you append this to must be relative\r\n */\r\nexport class Cropper {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private x: number;\r\n    private y: number;\r\n    private width: number;\r\n    private height: number;\r\n    private scale: number;\r\n    private readonly grips: IVector2D[]; // aka corner coordinates\r\n    private readonly edges: TUpdateElement[];\r\n    private readonly cornerElArr: TUpdateElement[];\r\n    private readonly darken: TUpdateElement[];\r\n    private readonly outline: TUpdateElement;\r\n    private readonly thirdsHorizontal: TUpdateElement;\r\n    private readonly thirdsVertical: TUpdateElement;\r\n    private readonly keyListener: KeyListener;\r\n    private readonly pointerRemainder: IVector2D;\r\n\r\n    private readonly outlinePointerListener: PointerListener;\r\n\r\n    private readonly corner0PointerListener: PointerListener;\r\n    private readonly corner1PointerListener: PointerListener;\r\n    private readonly corner2PointerListener: PointerListener;\r\n    private readonly corner3PointerListener: PointerListener;\r\n\r\n    private readonly edge0PointerListener: PointerListener;\r\n    private readonly edge1PointerListener: PointerListener;\r\n    private readonly edge2PointerListener: PointerListener;\r\n    private readonly edge3PointerListener: PointerListener;\r\n\r\n    private readonly callback: (val: IRect) => void;\r\n\r\n    private update (): void {\r\n        this.edges[0].update();\r\n        this.edges[1].update();\r\n        this.edges[2].update();\r\n        this.edges[3].update();\r\n        this.cornerElArr[0].update();\r\n        this.cornerElArr[1].update();\r\n        this.cornerElArr[2].update();\r\n        this.cornerElArr[3].update();\r\n        this.darken[0].update();\r\n        this.darken[1].update();\r\n        this.darken[2].update();\r\n        this.darken[3].update();\r\n        this.outline.update();\r\n        this.thirdsHorizontal.update();\r\n        this.thirdsVertical.update();\r\n    }\r\n\r\n    private commit (): void {\r\n        this.pointerRemainder.x = 0;\r\n        this.pointerRemainder.y = 0;\r\n        this.callback(this.getTransform());\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        params: {\r\n            x: number; // int, pos in relation to image\r\n            y: number; // int\r\n            width: number; // int\r\n            height: number; // int\r\n            maxW: number;\r\n            maxH: number;\r\n            scale: number; // float, zoom\r\n            callback: (val: IRect) => void;\r\n        }\r\n    ) {\r\n\r\n        this.x = params.x;\r\n        this.y = params.y;\r\n        this.width = params.width;\r\n        this.height = params.height;\r\n        this.scale = params.scale;\r\n        this.callback = params.callback;\r\n\r\n        const maxW = params.maxW;\r\n        const maxH = params.maxW;\r\n        this.rootEl = BB.el();\r\n        const gripCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\r\n\r\n        this.keyListener = new BB.KeyListener({});\r\n\r\n        BB.css(this.rootEl, {\r\n            position: 'absolute',\r\n            left: (this.x * this.scale) + 'px',\r\n            top: (this.y * this.scale) + 'px',\r\n        });\r\n\r\n        this.outline = {\r\n            el: BB.el({\r\n                css: {\r\n                    position: 'absolute',\r\n                    border: '1px dashed #fff',\r\n                    cursor: 'move',\r\n                },\r\n            }),\r\n            update: () => {\r\n                BB.css(this.outline.el, {\r\n                    left: (this.grips[0].x * this.scale - 1) + 'px',\r\n                    top: (this.grips[0].y * this.scale - 1) + 'px',\r\n                    width: ((this.grips[2].x - this.grips[0].x) * this.scale) + 'px',\r\n                    height: ((this.grips[2].y - this.grips[0].y) * this.scale) + 'px',\r\n                });\r\n            },\r\n        };\r\n\r\n        this.pointerRemainder = { // needs to be reset after dragging complete\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        this.outlinePointerListener = new BB.PointerListener({\r\n            target: this.outline.el,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n\r\n                    this.grips[0].x += dX;\r\n                    this.grips[0].y += dY;\r\n                    this.grips[1].x += dX;\r\n                    this.grips[1].y += dY;\r\n                    this.grips[2].x += dX;\r\n                    this.grips[2].y += dY;\r\n                    this.grips[3].x += dX;\r\n                    this.grips[3].y += dY;\r\n\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n\r\n        this.thirdsHorizontal = {\r\n            el: BB.el({\r\n                css: {\r\n                    position: 'absolute',\r\n                    borderTop: '1px solid #0ff',\r\n                    borderBottom: '1px solid #0ff',\r\n                },\r\n            }),\r\n            update: () => {\r\n                BB.css(this.thirdsHorizontal.el, {\r\n                    left: (this.grips[0].x * this.scale) + 'px',\r\n                    top: ((this.grips[0].y + (this.grips[2].y - this.grips[0].y) / 3) * this.scale) + 'px',\r\n                    width: ((this.grips[2].x - this.grips[0].x) * this.scale) + 'px',\r\n                    height: ((this.grips[2].y - this.grips[0].y) / 3 * this.scale) + 'px',\r\n                });\r\n            },\r\n        };\r\n\r\n        this.thirdsVertical = {\r\n            el: BB.el({\r\n                css: {\r\n                    position: 'absolute',\r\n                    borderLeft: '1px solid #0ff',\r\n                    borderRight: '1px solid #0ff',\r\n                },\r\n            }),\r\n            update: () => {\r\n                BB.css(this.thirdsVertical.el, {\r\n                    left: ((this.grips[0].x + (this.grips[2].x - this.grips[0].x) / 3) * this.scale) + 'px',\r\n                    top: (this.grips[0].y * this.scale) + 'px',\r\n                    width: ((this.grips[2].x - this.grips[0].x) / 3 * this.scale) + 'px',\r\n                    height: ((this.grips[2].y - this.grips[0].y) * this.scale) + 'px',\r\n                });\r\n            },\r\n        };\r\n\r\n        const gripSize = 40;\r\n        const gripOverlay = 10;\r\n\r\n        this.grips = [\r\n            {x: 0, y: 0}, // top left\r\n            {x: this.width, y: 0}, // top right\r\n            {x: this.width, y: this.height}, // bottom right\r\n            {x: 0, y: this.height}, //bottom left\r\n        ];\r\n\r\n        const transformTop = (dY: number) => {\r\n            this.grips[0].y += dY;\r\n            this.grips[0].y = BB.clamp(this.grips[0].y, this.grips[3].y - maxH, this.grips[3].y - 1);\r\n            this.grips[1].y = this.grips[0].y;\r\n        };\r\n        const transformRight = (dX: number) => {\r\n            this.grips[1].x += dX;\r\n            this.grips[1].x = BB.clamp(this.grips[1].x, this.grips[0].x + 1, this.grips[0].x + maxW);\r\n            this.grips[2].x = this.grips[1].x;\r\n        };\r\n        const transformBottom = (dY: number) => {\r\n            this.grips[2].y += dY;\r\n            this.grips[2].y = BB.clamp(this.grips[2].y, this.grips[1].y + 1, this.grips[1].y + maxH);\r\n            this.grips[3].y = this.grips[2].y;\r\n        };\r\n        const transformLeft = (dX: number) => {\r\n            this.grips[0].x += dX;\r\n            this.grips[0].x = BB.clamp(this.grips[0].x, this.grips[1].x - maxW, this.grips[1].x - 1);\r\n            this.grips[3].x = this.grips[0].x;\r\n        };\r\n\r\n\r\n\r\n\r\n        this.edges = [];\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n\r\n                const el = BB.el({\r\n                    css: {\r\n                        width: gripSize + 'px',\r\n                        height: gripSize + 'px',\r\n                        //background: '#0f0',\r\n                        position: 'absolute',\r\n                    },\r\n                });\r\n\r\n                const update = () => {\r\n                    if (i === 0) { //top\r\n                        BB.css(el, {\r\n                            left: (this.grips[0].x * this.scale + gripOverlay) + 'px',\r\n                            top: (this.grips[0].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            width: ((this.grips[1].x - this.grips[0].x) * this.scale - gripOverlay * 2) + 'px',\r\n                            height: (gripSize * 2) + 'px',\r\n                        });\r\n                    } else if (i === 1) { //right\r\n                        BB.css(el, {\r\n                            left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\r\n                            top: (this.grips[1].y * this.scale + gripOverlay) + 'px',\r\n                            width: (gripSize * 2) + 'px',\r\n                            height: ((this.grips[2].y - this.grips[1].y) * this.scale - gripOverlay * 2) + 'px',\r\n                        });\r\n                    } else if (i === 2) { //bottom\r\n                        BB.css(el, {\r\n                            left: (this.grips[3].x * this.scale + gripOverlay) + 'px',\r\n                            top: (this.grips[3].y * this.scale - gripOverlay) + 'px',\r\n                            width: ((this.grips[2].x - this.grips[3].x) * this.scale - gripOverlay * 2) + 'px',\r\n                            height: (gripSize * 2) + 'px',\r\n                        });\r\n                    } else if (i === 3) { //left\r\n                        BB.css(el, {\r\n                            left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            top: (this.grips[0].y * this.scale + gripOverlay) + 'px',\r\n                            width: (gripSize * 2) + 'px',\r\n                            height: ((this.grips[3].y - this.grips[0].y) * this.scale - gripOverlay * 2) + 'px',\r\n                        });\r\n                    }\r\n                    const angleOffset = i * 2 + 1;\r\n                    el.style.cursor = gripCursors[angleOffset] + '-resize';\r\n\r\n                };\r\n\r\n                this.edges[i] = {\r\n                    el,\r\n                    update,\r\n                };\r\n            })(i);\r\n        }\r\n\r\n        this.darken = [];\r\n        for (let i = 0; i < 4; i++) {\r\n            ((i) => {\r\n                const g = BB.el({\r\n                    css: {\r\n                        position: 'absolute',\r\n                        background: '#000',\r\n                        opacity: '0.5',\r\n                    },\r\n                });\r\n                const update = () => {\r\n                    if (i === 0) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[0].x * this.scale) + 'px',\r\n                            top: (this.grips[0].y * this.scale - 8000) + 'px',\r\n                            width: ((this.grips[1].x - this.grips[0].x) * this.scale) + 'px',\r\n                            height: '8000px',\r\n                        });\r\n                    } else if (i === 1) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[1].x * this.scale) + 'px',\r\n                            top: (this.grips[1].y * this.scale - 8000) + 'px',\r\n                            width: '8000px',\r\n                            height: 16000 + 'px',\r\n                        });\r\n                    } else if (i === 2) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[3].x * this.scale) + 'px',\r\n                            top: (this.grips[3].y * this.scale) + 'px',\r\n                            width: ((this.grips[2].x - this.grips[3].x) * this.scale) + 'px',\r\n                            height: '8000px',\r\n                        });\r\n                    } else if (i === 3) {\r\n                        BB.css(g, {\r\n                            left: (this.grips[0].x * this.scale - 8000) + 'px',\r\n                            top: (this.grips[0].y * this.scale - 8000) + 'px',\r\n                            width: '8000px',\r\n                            height: 16000 + 'px',\r\n                        });\r\n                    }\r\n\r\n                };\r\n\r\n                this.darken[i] = {\r\n                    el: g,\r\n                    update,\r\n                };\r\n            })(i);\r\n        }\r\n\r\n        this.edge0PointerListener = new BB.PointerListener({\r\n            target: this.edges[0].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformTop(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformBottom(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        this.edge1PointerListener = new BB.PointerListener({\r\n            target: this.edges[1].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformRight(dX);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformLeft(-dX);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        this.edge2PointerListener = new BB.PointerListener({\r\n            target: this.edges[2].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformBottom(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformTop(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        this.edge3PointerListener = new BB.PointerListener({\r\n            target: this.edges[3].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformLeft(dX);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformRight(-dX);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n        this.cornerElArr = [];\r\n        (() => {\r\n            for (let i = 0; i < 4; i++) {\r\n                ((i) => {\r\n                    const g = BB.el({\r\n                        css: {\r\n                            //background: '#f00',\r\n                            width: (gripSize * 2) + 'px',\r\n                            height: (gripSize * 2) + 'px',\r\n                            position: 'absolute',\r\n                            cursor: ['nwse-resize', 'nesw-resize'][i % 2],\r\n                        },\r\n                    });\r\n\r\n                    const update = () => {\r\n                        if (i === 0) { //top left\r\n                            BB.css(g, {\r\n                                left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                                top: (this.grips[0].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            });\r\n                        } else if (i === 1) { //top right\r\n                            BB.css(g, {\r\n                                left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\r\n                                top: (this.grips[1].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                            });\r\n                        } else if (i === 2) { //bottom right\r\n                            BB.css(g, {\r\n                                left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\r\n                                top: (this.grips[2].y * this.scale - gripOverlay) + 'px',\r\n                            });\r\n                        } else if (i === 3) { //bottom left\r\n                            BB.css(g, {\r\n                                left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\r\n                                top: (this.grips[2].y * this.scale - gripOverlay) + 'px',\r\n                            });\r\n                        }\r\n                    };\r\n\r\n                    this.cornerElArr[i] = {\r\n                        el: g,\r\n                        update,\r\n                    };\r\n                })(i);\r\n            }\r\n        })();\r\n        //top left\r\n        this.corner0PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[0].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformLeft(dX);\r\n                    transformTop(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformRight(-dX);\r\n                        transformBottom(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        //top right\r\n        this.corner1PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[1].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformRight(dX);\r\n                    transformTop(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformLeft(-dX);\r\n                        transformBottom(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        //bottom right\r\n        this.corner2PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[2].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformRight(dX);\r\n                    transformBottom(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformLeft(-dX);\r\n                        transformTop(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n        //bottom left\r\n        this.corner3PointerListener = new BB.PointerListener({\r\n            target: this.cornerElArr[3].el,\r\n            fixScribble: true,\r\n            onPointer: (event) => {\r\n                event.eventPreventDefault();\r\n                if (event.type === 'pointermove' && event.button === 'left') {\r\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\r\n                    transformLeft(dX);\r\n                    transformBottom(dY);\r\n                    if (this.keyListener.isPressed('shift')) {\r\n                        transformRight(-dX);\r\n                        transformTop(-dY);\r\n                    }\r\n                    this.update();\r\n                }\r\n                if (event.type === 'pointerup') {\r\n                    this.commit();\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n        this.rootEl.append(\r\n            this.darken[1].el,\r\n            this.darken[0].el,\r\n            this.darken[2].el,\r\n            this.darken[3].el,\r\n            this.thirdsHorizontal.el,\r\n            this.thirdsVertical.el,\r\n            this.outline.el,\r\n\r\n            this.edges[1].el,\r\n            this.edges[0].el,\r\n            this.edges[2].el,\r\n            this.edges[3].el,\r\n\r\n            this.cornerElArr[0].el,\r\n            this.cornerElArr[1].el,\r\n            this.cornerElArr[2].el,\r\n            this.cornerElArr[3].el,\r\n        );\r\n\r\n        this.update();\r\n\r\n    }\r\n\r\n    // ---- interface ----\r\n    getTransform (): IRect {\r\n        this.grips[1].x -= this.grips[0].x;\r\n        this.grips[1].y -= this.grips[0].y;\r\n        this.grips[2].x -= this.grips[0].x;\r\n        this.grips[2].y -= this.grips[0].y;\r\n        this.grips[3].x -= this.grips[0].x;\r\n        this.grips[3].y -= this.grips[0].y;\r\n        this.x += this.grips[0].x;\r\n        this.y += this.grips[0].y;\r\n        this.grips[0].x = 0;\r\n        this.grips[0].y = 0;\r\n        return {\r\n            x: this.x,\r\n            y: this.y,\r\n            width: this.grips[1].x,\r\n            height: this.grips[2].y,\r\n        };\r\n    }\r\n\r\n    setTransform (p: IRect): void {\r\n        this.x = p.x;\r\n        this.y = p.y;\r\n        this.width = p.width;\r\n        this.height = p.height;\r\n\r\n        BB.css(this.rootEl, {\r\n            left: (this.x * this.scale) + 'px',\r\n            top: (this.y * this.scale) + 'px',\r\n        });\r\n\r\n        this.grips[0].x = 0;\r\n        this.grips[0].y = 0;\r\n        this.grips[1].x = this.width;\r\n        this.grips[1].y = 0;\r\n        this.grips[2].x = this.width;\r\n        this.grips[2].y = this.height;\r\n        this.grips[3].x = 0;\r\n        this.grips[3].y = this.height;\r\n\r\n        this.update();\r\n        this.commit();\r\n    }\r\n\r\n    setScale (s: number): void {\r\n        this.scale = s;\r\n        BB.css(this.rootEl, {\r\n            left: (this.x * this.scale) + 'px',\r\n            top: (this.y * this.scale) + 'px',\r\n        });\r\n        this.update();\r\n    }\r\n\r\n    showThirds (b: boolean): void {\r\n\r\n        this.thirdsHorizontal.el.style.display = b ? 'block' : 'none';\r\n        this.thirdsVertical.el.style.display = b ? 'block' : 'none';\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.keyListener.destroy();\r\n        this.outlinePointerListener.destroy();\r\n        this.corner0PointerListener.destroy();\r\n        this.corner1PointerListener.destroy();\r\n        this.corner2PointerListener.destroy();\r\n        this.corner3PointerListener.destroy();\r\n        this.edge0PointerListener.destroy();\r\n        this.edge1PointerListener.destroy();\r\n        this.edge2PointerListener.destroy();\r\n        this.edge3PointerListener.destroy();\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\nimport {TKlCanvasLayer, TUiLayout} from '../../kl-types';\r\nimport {ISize2D} from '../../../bb/bb-types';\r\nimport {theme} from '../../../theme/theme';\r\n\r\n\r\n/**\r\n * Previews currently active layer\r\n * thumbnail (hover shows bigger preview), layername, opacity\r\n *\r\n * internally listens to kl history. updates when there's a change.\r\n * but you need to update it when the active layer changed. (different canvas object)\r\n *\r\n * update visibility for performance\r\n */\r\nexport class LayerPreview {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly contentWrapperEl: HTMLElement;\r\n    private readonly height: number;\r\n    private layerObj: TKlCanvasLayer;\r\n    private isVisible: boolean;\r\n    private uiState: TUiLayout;\r\n\r\n    private readonly nameLabelEl: HTMLElement;\r\n    private readonly opacityEl: HTMLElement;\r\n    private lastDrawnSize: ISize2D;\r\n    private lastDrawnState: number; // from KlHistory\r\n\r\n    private readonly canvasSize: number;\r\n    private readonly canvas: HTMLCanvasElement;\r\n    private readonly canvasCtx: CanvasRenderingContext2D;\r\n\r\n    private animationCount: number; // >0 means it's animating\r\n    private readonly animationLength: number;\r\n\r\n    private readonly animationCanvas: HTMLCanvasElement;\r\n    private readonly animationCanvasCtx: CanvasRenderingContext2D;\r\n    private animationCanvasCheckerPattern: CanvasPattern;\r\n\r\n    private largeCanvasIsVisible: boolean;\r\n    private readonly largeCanvasWrapper: HTMLElement;\r\n    private readonly largeCanvasSize: number;\r\n    private readonly largeCanvas: HTMLCanvasElement;\r\n    private readonly largeCanvasCtx: CanvasRenderingContext2D;\r\n    private largeCanvasCheckerPattern: CanvasPattern;\r\n\r\n\r\n    private updateCheckerPatterns (): void {\r\n        const checker = BB.createCheckerCanvas(4, theme.isDark());\r\n        this.animationCanvasCheckerPattern = this.animationCanvasCtx.createPattern(checker, 'repeat');\r\n        this.largeCanvasCheckerPattern = this.canvasCtx.createPattern(checker, 'repeat');\r\n    }\r\n    \r\n    private animate (): void {\r\n        if (this.animationCount === 0) {\r\n            return;\r\n        }\r\n\r\n        this.animationCount--;\r\n\r\n        this.canvasCtx.save();\r\n        this.canvasCtx.globalAlpha = Math.pow((this.animationLength - this.animationCount) / this.animationLength, 2);\r\n        this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\r\n        this.canvasCtx.restore();\r\n\r\n        if (this.animationCount > 0) {\r\n            requestAnimationFrame(() => this.animate());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * is always instant\r\n     */\r\n    private drawLargeCanvas (): void {\r\n\r\n        if (!this.largeCanvasIsVisible || !this.layerObj) {\r\n            return;\r\n        }\r\n\r\n        const layerCanvas = this.layerObj.context.canvas;\r\n\r\n        const canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, this.largeCanvasSize, this.largeCanvasSize, 1);\r\n        this.largeCanvas.width = Math.round(canvasDimensions.width);\r\n        this.largeCanvas.height = Math.round(canvasDimensions.height);\r\n        this.largeCanvasCtx.save();\r\n        if (this.largeCanvas.width > layerCanvas.width) {\r\n            this.largeCanvasCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            this.largeCanvasCtx.imageSmoothingEnabled = true;\r\n            this.largeCanvasCtx.imageSmoothingQuality = 'high';\r\n        }\r\n        this.largeCanvasCtx.fillStyle = this.largeCanvasCheckerPattern;\r\n        this.largeCanvasCtx.fillRect(0, 0, this.largeCanvas.width, this.largeCanvas.height);\r\n        this.largeCanvasCtx.drawImage(layerCanvas, 0, 0, this.largeCanvas.width, this.largeCanvas.height);\r\n        this.largeCanvasCtx.restore();\r\n\r\n        const bounds = this.rootEl.getBoundingClientRect();\r\n        BB.css(this.largeCanvasWrapper, {\r\n            top: Math.max(10, (bounds.top + this.height / 2 - this.largeCanvas.height / 2)) + 'px',\r\n        });\r\n\r\n    }\r\n\r\n    private draw (isInstant: boolean): void {\r\n        if (!this.isVisible) {\r\n            return;\r\n        }\r\n\r\n        this.nameLabelEl.textContent = this.layerObj.name;\r\n        this.opacityEl.innerHTML = LANG('opacity') + '<br>' + Math.round(this.layerObj.opacity * 100) + '%';\r\n\r\n        const layerCanvas = this.layerObj.context.canvas;\r\n\r\n        if (layerCanvas.width !== this.lastDrawnSize.width || layerCanvas.height !== this.lastDrawnSize.height) {\r\n            const canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, this.canvasSize, this.canvasSize, 1);\r\n            this.canvas.width = Math.round(canvasDimensions.width);\r\n            this.canvas.height = Math.round(canvasDimensions.height);\r\n\r\n            isInstant = true;\r\n        }\r\n\r\n        this.animationCanvas.width = this.canvas.width;\r\n        this.animationCanvas.height = this.canvas.height;\r\n\r\n        this.animationCanvasCtx.save();\r\n        this.animationCanvasCtx.imageSmoothingEnabled = false;\r\n        this.animationCanvasCtx.fillStyle = this.animationCanvasCheckerPattern;\r\n        this.animationCanvasCtx.fillRect(0, 0, this.animationCanvas.width, this.animationCanvas.height);\r\n        this.animationCanvasCtx.drawImage(layerCanvas, 0, 0, this.animationCanvas.width, this.animationCanvas.height);\r\n        this.animationCanvasCtx.restore();\r\n\r\n        if (isInstant) {\r\n            this.animationCount = 0;\r\n            this.canvasCtx.save();\r\n            this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\r\n            this.canvasCtx.restore();\r\n\r\n        } else {\r\n            this.animationCount = this.animationLength;\r\n            this.animate();\r\n\r\n        }\r\n\r\n        this.drawLargeCanvas();\r\n\r\n        this.lastDrawnState = klHistory.getState();\r\n        this.lastDrawnSize.width = layerCanvas.width;\r\n        this.lastDrawnSize.height = layerCanvas.height;\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onClick: () => void; // when clicking on layer name\r\n            klRootEl: HTMLElement;\r\n            uiState: TUiLayout;\r\n        }\r\n    ) {\r\n        // internally redraws with in an interval. checks history is something changed\r\n        // this update will be animated\r\n        // it will not be animated if the resolution changed\r\n        // also redraws when you call updateLayer - not animated\r\n\r\n        // syncs via updateLayer, and internally updates layer opacity via a hack\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-layer-preview',\r\n        });\r\n        this.isVisible = true;\r\n        this.height = 40;\r\n        this.canvasSize = this.height - 10;\r\n        this.largeCanvasSize = 300;\r\n        this.lastDrawnState = -2;\r\n        this.lastDrawnSize = {\r\n            width: 0,\r\n            height: 0,\r\n        };\r\n        this.animationCanvas = BB.canvas(); // to help animate the transition\r\n        this.animationCanvasCtx = BB.ctx(this.animationCanvas);\r\n        this.animationLength = 30;\r\n        this.animationCount = 0;\r\n        this.largeCanvasIsVisible = false;\r\n        let largeCanvasAnimationTimeout: ReturnType<typeof setTimeout>;\r\n        const largeCanvasAnimationDurationMs = 300;\r\n        this.uiState = p.uiState;\r\n\r\n\r\n        // --- setup dom ---\r\n        this.contentWrapperEl = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                height: this.height + 'px',\r\n            },\r\n        });\r\n        const canvasWrapperEl = BB.el({\r\n            css: {\r\n                //background: '#f00',\r\n                minWidth: this.height + 'px',\r\n                height: this.height + 'px',\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        this.canvas = BB.canvas(this.canvasSize, this.canvasSize);\r\n        this.canvasCtx = BB.ctx(this.canvas);\r\n        this.canvas.title = LANG('layers-active-layer');\r\n        const nameWrapper = BB.el({\r\n            css: {\r\n                //background: '#ff0',\r\n                flexGrow: '1',\r\n                paddingLeft: '10px',\r\n                fontSize: '13px',\r\n                overflow: 'hidden',\r\n                position: 'relative',\r\n            },\r\n        });\r\n        this.nameLabelEl = BB.el({\r\n            content: '',\r\n            css: {\r\n                cssFloat: 'left',\r\n                whiteSpace: 'nowrap',\r\n            },\r\n        });\r\n        const clickableEl = BB.el({\r\n            css: {\r\n                //background: 'rgba(0,255,0,0.6)',\r\n                position: 'absolute',\r\n                left: '10px',\r\n                top: '0',\r\n                width: '90px',\r\n                height: '100%',\r\n            },\r\n        });\r\n        if (p.onClick) {\r\n            clickableEl.addEventListener('click', () => {\r\n                p.onClick();\r\n            });\r\n            this.canvas.addEventListener('click', () => {\r\n                p.onClick();\r\n            });\r\n        }\r\n        this.opacityEl = BB.el({\r\n            content: LANG('opacity') + '<br>100%',\r\n            css: {\r\n                minWidth: '60px',\r\n                fontSize: '12px',\r\n                textAlign: 'center',\r\n            },\r\n        });\r\n\r\n        this.largeCanvasWrapper = BB.el({\r\n            onClick: BB.handleClick,\r\n            css: {\r\n                pointerEvents: 'none',\r\n                background: '#fff',\r\n                position: 'absolute',\r\n                right: '280px',\r\n                top: '10px',\r\n                border: '1px solid #aaa',\r\n                boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\r\n                transition: 'opacity '+largeCanvasAnimationDurationMs+'ms ease-in-out',\r\n                userSelect: 'none',\r\n                display: 'block',\r\n                webkitTouchCallout: 'none',\r\n            },\r\n        });\r\n        this.largeCanvas = BB.canvas(this.largeCanvasSize, this.largeCanvasSize);\r\n        this.largeCanvasWrapper.append(this.largeCanvas);\r\n        this.largeCanvasCtx = BB.ctx(this.largeCanvas);\r\n        BB.css(this.largeCanvas, {\r\n            display: 'block',\r\n        });\r\n\r\n\r\n        canvasWrapperEl.append(this.canvas);\r\n        nameWrapper.append(this.nameLabelEl, clickableEl);\r\n        this.contentWrapperEl.append(canvasWrapperEl, nameWrapper, this.opacityEl);\r\n        this.rootEl.append(this.contentWrapperEl);\r\n\r\n\r\n        this.updateCheckerPatterns();\r\n        theme.addIsDarkListener(() => {\r\n            this.updateCheckerPatterns();\r\n            this.draw(true);\r\n        });\r\n\r\n\r\n\r\n        // --- update logic ---\r\n\r\n        // cross-fade done via 2 canvases (old and new state)\r\n        // both have checkerboard background drawn on them, both fully opaque\r\n        // -> no \"lighter\" is needed for accurate cross-fading\r\n\r\n        setInterval(() => {\r\n\r\n            if (!this.layerObj) {\r\n                return;\r\n            }\r\n\r\n            const currentState = klHistory.getState();\r\n            if (currentState === this.lastDrawnState) {\r\n                return;\r\n            }\r\n\r\n            //update opacity w hack\r\n            this.layerObj.opacity = this.layerObj.context.canvas.opacity;\r\n\r\n            this.draw(false);\r\n\r\n        }, 2000);\r\n        \r\n\r\n        const removeLargeCanvas = () => {\r\n            try {\r\n                p.klRootEl.removeChild(this.largeCanvasWrapper);\r\n            } catch(e) {\r\n\r\n            }\r\n        };\r\n\r\n        const showLargeCanvas = (b) => {\r\n            if (this.largeCanvasIsVisible === b) {\r\n                return;\r\n            }\r\n\r\n            clearTimeout(largeCanvasAnimationTimeout);\r\n            this.largeCanvasIsVisible = b;\r\n\r\n            if (b) {\r\n                largeCanvasAnimationTimeout = setTimeout(() => {\r\n                    this.drawLargeCanvas();\r\n                    this.largeCanvasWrapper.style.opacity = '0';\r\n                    p.klRootEl.append(this.largeCanvasWrapper);\r\n                    setTimeout(() => {\r\n                        this.largeCanvasWrapper.style.opacity = '1';\r\n                    }, 20);\r\n                }, 250);\r\n\r\n            } else {\r\n                this.largeCanvasWrapper.style.opacity = '0';\r\n                largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\r\n            }\r\n\r\n        };\r\n\r\n        const pointerListener = new BB.PointerListener({\r\n            target: this.canvas,\r\n            onEnterLeave: (b) => {\r\n                showLargeCanvas(b);\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (b: boolean): void {\r\n        if (this.isVisible === b) {\r\n            return;\r\n        }\r\n        this.isVisible = b;\r\n        this.contentWrapperEl.style.display = this.isVisible ? 'flex' : 'none';\r\n        this.rootEl.style.marginBottom = this.isVisible ? '' : '10px';\r\n\r\n        const currentState = klHistory.getState();\r\n        if (b && this.lastDrawnState !== currentState) {\r\n            this.draw(true);\r\n        }\r\n    }\r\n\r\n    //when the layer might have changed\r\n         setLayer (klCanvasLayerObj: TKlCanvasLayer): void {\r\n        this.layerObj = klCanvasLayerObj;\r\n        this.draw(true);\r\n    }\r\n\r\n    setUiState (stateStr: TUiLayout): void {\r\n        this.uiState = stateStr;\r\n\r\n        if (this.uiState === 'left') {\r\n            BB.css(this.largeCanvasWrapper, {\r\n                left: '280px',\r\n                right: '',\r\n            });\r\n        } else {\r\n            BB.css(this.largeCanvasWrapper, {\r\n                left: '',\r\n                right: '280px',\r\n            });\r\n        }\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {FreeTransformCanvas} from '../components/free-transform-canvas';\r\nimport {showModal} from './base/showModal';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {IKlBasicLayer} from '../../kl-types';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showImportAsLayerDialog (\r\n    params: {\r\n        target: HTMLElement;\r\n        klCanvas: KlCanvas;\r\n        importImage: HTMLImageElement | HTMLCanvasElement;\r\n        callback: (\r\n            p?: {x: number; y: number; width:number; height: number; angleDeg: number},\r\n            isPixelated?: boolean\r\n        ) => void;\r\n    }\r\n): void {\r\n\r\n    const div = document.createElement('div');\r\n    BB.appendTextDiv(div, LANG('import-as-layer-description'));\r\n    if (params.klCanvas.isLayerLimitReached()) {\r\n        const noteEl = BB.el({\r\n            content: LANG('import-as-layer-limit-reached'),\r\n            css: {\r\n                background: '#ff0',\r\n                padding: '10px',\r\n                marginTop: '5px',\r\n                marginBottom: '5px',\r\n                border: '1px solid #e7d321',\r\n                borderRadius: '5px',\r\n            },\r\n        });\r\n        div.append(noteEl);\r\n    }\r\n    const isSmall = window.innerWidth < 550;\r\n\r\n    const buttonRowEl = BB.el({\r\n        css: {\r\n            display: 'flex',\r\n        },\r\n    });\r\n    const originalSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: '1:1',\r\n        css: {\r\n            marginRight: '10px',\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.reset();\r\n        },\r\n    });\r\n    const fitSizeBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('import-as-layer-fit'),\r\n        css: {\r\n            marginRight: '10px',\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.setTransformFit();\r\n        },\r\n    });\r\n    const centerBtn = BB.el({\r\n        tagName: 'button',\r\n        content: LANG('center'),\r\n        css: {\r\n            marginRight: '10px',\r\n        },\r\n        onClick: function () {\r\n            freeTransformCanvas.setTransformCenter();\r\n        },\r\n    });\r\n    buttonRowEl.append(originalSizeBtn, fitSizeBtn, centerBtn);\r\n    div.append(buttonRowEl);\r\n\r\n\r\n\r\n    const layers: IKlBasicLayer[] = [];\r\n    {\r\n        const klCanvasLayerArr = params.klCanvas.getLayers();\r\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\r\n            layers.push({\r\n                image: klCanvasLayerArr[i].context.canvas,\r\n                opacity: klCanvasLayerArr[i].opacity,\r\n                mixModeStr: klCanvasLayerArr[i].mixModeStr,\r\n            });\r\n        }\r\n    }\r\n    layers.push({\r\n        image: params.importImage,\r\n        opacity: 1,\r\n        mixModeStr: 'source-over',\r\n    });\r\n\r\n\r\n    const freeTransformCanvas = new FreeTransformCanvas({\r\n        elementWidth: isSmall ? 340 : 540,\r\n        elementHeight: isSmall ? 280 : 350,\r\n        imageWidth: params.klCanvas.getLayerContext(0).canvas.width,\r\n        imageHeight: params.klCanvas.getLayerContext(0).canvas.height,\r\n        layers: layers,\r\n        transformIndex: layers.length - 1,\r\n    });\r\n    BB.css(freeTransformCanvas.getElement(), {\r\n        marginTop: '10px',\r\n        marginLeft: '-20px',\r\n    });\r\n    div.append(freeTransformCanvas.getElement());\r\n\r\n    function move (x: number, y: number): void {\r\n        freeTransformCanvas.move(x, y);\r\n    }\r\n\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: function (keyStr) {\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        },\r\n    });\r\n\r\n    showModal({\r\n        target: params.target,\r\n        message: `<b>${LANG('import-as-layer-title')}</b>`,\r\n        div: div,\r\n        style: isSmall ? undefined : {\r\n            width: '500px',\r\n        },\r\n        buttons: ['Ok', 'Cancel'],\r\n        clickOnEnter: 'Ok',\r\n        callback: function (buttonStr) {\r\n            keyListener.destroy();\r\n            freeTransformCanvas.destroy();\r\n            BB.destroyEl(originalSizeBtn);\r\n            BB.destroyEl(fitSizeBtn);\r\n            BB.destroyEl(centerBtn);\r\n            if (buttonStr === 'Ok') {\r\n                params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\r\n            } else {\r\n                params.callback();\r\n            }\r\n        },\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\ntype TDropOption = 'default' | 'layer' | 'image';\r\n\r\n/**\r\n * Not really generalized. UI when you drag/drop an image into window.\r\n * The moment you create it, it will listen.\r\n * */\r\nexport class KlImageDropper {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onDrop: (files: FileList, optionStr: TDropOption) => void;\r\n            target: HTMLElement;\r\n            enabledTest: () => boolean;\r\n        }\r\n    ) {\r\n        //set up DOM\r\n        this.rootEl = BB.el({\r\n            content: 'Drop to import',\r\n            css: {\r\n                paddingTop: '100px',\r\n                position: 'fixed',\r\n                left: '0',\r\n                top: '0',\r\n                width: '100%',\r\n                height: '100%',\r\n                background: 'rgba(50, 50, 50, 0.7)',\r\n                color: '#fff',\r\n                textShadow: '2px 2px #000',\r\n                textAlign: 'center',\r\n                fontSize: '25px',\r\n            },\r\n        });\r\n        const wrapperEl = BB.el({\r\n            css: {\r\n                'marginTop': '50px',\r\n                'display': 'flex',\r\n                'justifyContent': 'center',\r\n            },\r\n        });\r\n        const optionStyle = {\r\n            width: '200px',\r\n            padding: '50px',\r\n            margin: '10px',\r\n            //opacity: 0.5,\r\n            borderRadius: '20px',\r\n            border: '1px dashed #fff',\r\n            background: '#00aefe',\r\n            fontWeight: 'bold',\r\n        };\r\n        const optionLayerEl = BB.el({\r\n            content: 'As Layer',\r\n            css: optionStyle,\r\n        });\r\n        const optionImageEl = BB.el({\r\n            content: 'As New Image',\r\n            css: optionStyle,\r\n        });\r\n\r\n        this.rootEl.append(wrapperEl);\r\n        wrapperEl.append(optionLayerEl, optionImageEl);\r\n\r\n\r\n        let rootCounter = 0;\r\n        let optionLayerCounter = 0;\r\n        let optionImageCounter = 0;\r\n\r\n        const destroy = () => {\r\n            rootCounter = 0;\r\n            optionLayerCounter = 0;\r\n            optionImageCounter = 0;\r\n            try {\r\n                p.target.removeChild(this.rootEl);\r\n            } catch (e) { }\r\n        };\r\n\r\n        /**\r\n         * check, can drop content be imported\r\n         */\r\n        const testAcceptType = (event: DragEvent): boolean => {\r\n            return !!event.dataTransfer && !event.dataTransfer.types.includes('text/plain');\r\n        };\r\n\r\n        const updateOptions = () => {\r\n            const boxShadow = '0 0 20px 4px #fff';\r\n            if (optionLayerCounter > 0) {\r\n                optionLayerEl.style.boxShadow = boxShadow;\r\n                optionImageEl.style.boxShadow = '';\r\n            } else if (optionImageCounter > 0) {\r\n                optionLayerEl.style.boxShadow = '';\r\n                optionImageEl.style.boxShadow = boxShadow;\r\n            } else {\r\n                optionLayerEl.style.boxShadow = '';\r\n                optionImageEl.style.boxShadow = '';\r\n            }\r\n        };\r\n\r\n        optionLayerEl.addEventListener('dragenter', () => {\r\n            optionLayerCounter++;\r\n            updateOptions();\r\n        });\r\n        optionLayerEl.addEventListener('dragleave', () => {\r\n            optionLayerCounter--;\r\n            updateOptions();\r\n        });\r\n        optionImageEl.addEventListener('dragenter', () => {\r\n            optionImageCounter++;\r\n            updateOptions();\r\n        });\r\n        optionImageEl.addEventListener('dragleave', () => {\r\n            optionImageCounter--;\r\n            updateOptions();\r\n        });\r\n\r\n\r\n        const rootDragOver = (event: DragEvent): void => {\r\n            if (!testAcceptType(event)) {\r\n                return;\r\n            }\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n        };\r\n\r\n        const rootDragEnter = (event: DragEvent): void => {\r\n            if (!p.enabledTest() || !testAcceptType(event)) {\r\n                return;\r\n            }\r\n            if (rootCounter === 0) {\r\n                p.target.append(this.rootEl);\r\n            }\r\n            rootCounter++;\r\n        };\r\n\r\n        const rootDragLeave = (event: DragEvent): void => {\r\n            if (!testAcceptType(event) || rootCounter === 0) {\r\n                return;\r\n            }\r\n            rootCounter = Math.max(0, rootCounter - 1);\r\n            if (rootCounter === 0) {\r\n                p.target.removeChild(this.rootEl);\r\n            }\r\n        };\r\n\r\n        const rootDrop = (event: DragEvent): void => {\r\n            if (!testAcceptType(event) || !event.dataTransfer || event.dataTransfer.files.length === 0) {\r\n                destroy();\r\n                return;\r\n            }\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n\r\n            let optionStr: TDropOption = 'default';\r\n            if (optionLayerCounter > 0) {\r\n                optionStr = 'layer';\r\n            } else if (optionImageCounter > 0) {\r\n                optionStr = 'image';\r\n            }\r\n\r\n            p.onDrop(event.dataTransfer.files, optionStr);\r\n\r\n\r\n            if (rootCounter > 0) {\r\n                p.target.removeChild(this.rootEl);\r\n            }\r\n            rootCounter = 0;\r\n            optionLayerCounter = 0;\r\n            optionImageCounter = 0;\r\n            updateOptions();\r\n        };\r\n\r\n        window.addEventListener('dragover', rootDragOver, false);\r\n        window.addEventListener('dragenter', rootDragEnter, false);\r\n        window.addEventListener('dragleave', rootDragLeave, false);\r\n        window.addEventListener('drop', rootDrop, false);\r\n\r\n        // if something goes wrong and you're stuck with overlay\r\n        this.rootEl.addEventListener('pointerdown', () => {\r\n            destroy();\r\n        });\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: (keyStr) => {\r\n                if (rootCounter > 0 && keyStr === 'esc') {\r\n                    destroy();\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {KlColorSliderSmall} from './kl-color-slider-small';\r\nimport {KlSlider} from './kl-slider';\r\nimport {BrushSettingService, TBrushSettingEmit} from '../../brushes-ui/brush-setting-service';\r\nimport {LANG} from '../../../language/language';\r\nimport {IRGB} from '../../kl-types';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\n\r\n/**\r\n * Compressed HUD toolspace. When you hold ctrl+alt.\r\n * small color picker, brush settings\r\n */\r\nexport class OverlayToolspace {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            brushSettingService: BrushSettingService; // to sync with outside\r\n            enabledTest: () => boolean; // calls to see if it's allowed to show\r\n        }\r\n    ) {\r\n        const sizeObj = {\r\n            width: 150,\r\n            svHeight: 90,\r\n            hHeight: 20,\r\n            sliderHeight: 25,\r\n        };\r\n\r\n        let isVisible = false;\r\n        this.rootEl = BB.el({\r\n            className: 'kl-overlay-toolspace',\r\n        });\r\n        const queuedObj: {\r\n            color: IRGB | null;\r\n            size: number | null;\r\n            opacity: number | null;\r\n        } = {\r\n            color: null,\r\n            size: null,\r\n            opacity: null,\r\n        };\r\n\r\n\r\n        // --- inputs ---\r\n\r\n        //color selection\r\n        const colorEl = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-overlay-toolspace__color',\r\n        });\r\n        const colorSlider = new KlColorSliderSmall({\r\n            width: sizeObj.width,\r\n            heightSV: sizeObj.svHeight,\r\n            heightH: sizeObj.hHeight,\r\n            color: p.brushSettingService.getColor(),\r\n            callback: (rgbObj: IRGB) => {\r\n                selectedColorEl.style.backgroundColor = 'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')';\r\n                p.brushSettingService.setColor(rgbObj, subscriptionFunc);\r\n            },\r\n        });\r\n        const selectedColorEl = BB.el({\r\n            css: {\r\n                width: sizeObj.width + 'px',\r\n                height: sizeObj.hHeight + 'px',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        {\r\n            const initialColor = p.brushSettingService.getColor();\r\n            selectedColorEl.style.backgroundColor = 'rgb(' + initialColor.r + ',' + initialColor.g + ',' + initialColor.b + ')';\r\n        }\r\n\r\n        colorEl.append(selectedColorEl, colorSlider.getElement());\r\n\r\n\r\n        const updateColor = (rgbObj: IRGB) => {\r\n            colorSlider.setColor(rgbObj);\r\n            selectedColorEl.style.backgroundColor = 'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')';\r\n        };\r\n\r\n\r\n\r\n        //brushsize slider\r\n\r\n        const sizeSlider = new KlSlider({\r\n            label: LANG('brush-size'),\r\n            width: sizeObj.width,\r\n            height: sizeObj.sliderHeight,\r\n            min: 0,\r\n            max: 500,\r\n            value: 50,\r\n            resolution: 225,\r\n            eventResMs: 1000 / 30,\r\n            toDisplayValue: (val) => val * 2,\r\n            toValue: (displayValue) => displayValue / 2,\r\n            onChange: (v) => {\r\n                p.brushSettingService.setSize(v);\r\n            },\r\n            formatFunc: (displayValue) => {\r\n                if (displayValue < 10) {\r\n                    return BB.round(displayValue, 1);\r\n                } else {\r\n                    return Math.round(displayValue);\r\n                }\r\n            },\r\n        });\r\n        BB.css(sizeSlider.getElement(), {\r\n            marginTop: '2px',\r\n        });\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: sizeObj.width,\r\n            height: sizeObj.sliderHeight,\r\n            min: 0,\r\n            max: 1,\r\n            value: 1,\r\n            resolution: 225,\r\n            eventResMs: 1000 / 30,\r\n            toDisplayValue: (val) => val * 100,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            onChange: (v) => {\r\n                p.brushSettingService.setOpacity(v);\r\n            },\r\n        });\r\n        BB.css(opacitySlider.getElement(), {\r\n            margin: '2px 0',\r\n        });\r\n        this.rootEl.append(sizeSlider.getElement(), opacitySlider.getElement());\r\n\r\n\r\n\r\n        // --- general setup ---\r\n\r\n        const subscriptionFunc = (event: TBrushSettingEmit) => {\r\n            if (event.type === 'color') {\r\n                if (!isVisible) {\r\n                    queuedObj.color = event.value;\r\n                } else {\r\n                    updateColor(event.value);\r\n                }\r\n            }\r\n            if (event.type === 'size') {\r\n                if (!isVisible) {\r\n                    queuedObj.size = event.value;\r\n                } else {\r\n                    sizeSlider.setValue(event.value);\r\n                }\r\n            }\r\n            if (event.type === 'opacity') {\r\n                if (!isVisible) {\r\n                    queuedObj.opacity = event.value;\r\n                } else {\r\n                    opacitySlider.setValue(event.value);\r\n                }\r\n            }\r\n            if (event.type === 'sliderConfig') {\r\n                sizeSlider.update(event.value.sizeSlider);\r\n                opacitySlider.update(event.value.opacitySlider);\r\n            }\r\n        };\r\n        p.brushSettingService.subscribe(subscriptionFunc);\r\n        {\r\n            const sliderConfig = p.brushSettingService.getSliderConfig();\r\n            sizeSlider.update(sliderConfig.sizeSlider);\r\n            opacitySlider.update(sliderConfig.opacitySlider);\r\n            sizeSlider.setValue(p.brushSettingService.getSize());\r\n            opacitySlider.setValue(p.brushSettingService.getOpacity());\r\n        }\r\n\r\n        const updateUI = () => {\r\n\r\n            // unfocus manual slider input\r\n            BB.unfocusAnyInput();\r\n\r\n            this.rootEl.style.display = isVisible ? 'block' : 'none';\r\n            if (isVisible && mousePos) {\r\n                BB.css(this.rootEl, {\r\n                    left: (mousePos.x - Math.round(sizeObj.width / 2)) + 'px',\r\n                    top: (mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2)) + 'px',\r\n                });\r\n            }\r\n        };\r\n\r\n        let mousePos: IVector2D | null = null;\r\n        document.addEventListener('pointermove', (event) => {\r\n            mousePos = {\r\n                x: event.pageX,\r\n                y: event.pageY,\r\n            };\r\n        });\r\n\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: (keyStr, event, comboStr, isRepeat) => {\r\n                if (isRepeat) {\r\n                    return;\r\n                }\r\n                if (isVisible) {\r\n                    isVisible = false;\r\n                    updateUI();\r\n                    return;\r\n                }\r\n\r\n                if (!p.enabledTest() || !mousePos) {\r\n                    return;\r\n                }\r\n\r\n                if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(comboStr)) {\r\n                    event.preventDefault();\r\n                    isVisible = true;\r\n\r\n                    if (queuedObj.color !== null) {\r\n                        updateColor(queuedObj.color);\r\n                        queuedObj.color = null;\r\n                    }\r\n                    if (queuedObj.size !== null) {\r\n                        sizeSlider.setValue(queuedObj.size);\r\n                        queuedObj.size = null;\r\n                    }\r\n                    if (queuedObj.opacity !== null) {\r\n                        opacitySlider.setValue(queuedObj.opacity);\r\n                        queuedObj.opacity = null;\r\n                    }\r\n\r\n                    updateUI();\r\n                }\r\n\r\n            },\r\n            onUp: (keyStr, event, oldComboStr) => {\r\n                if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(oldComboStr) && isVisible) {\r\n                    isVisible = false;\r\n                    colorSlider.end();\r\n                    updateUI();\r\n                }\r\n            },\r\n            onBlur: () => {\r\n                if (isVisible) {\r\n                    isVisible = false;\r\n                    colorSlider.end();\r\n                    updateUI();\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    // ---- interface ----\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport klecksLogoImg from '/src/app/img/klecks-logo.png';\r\nimport newImageImg from '/src/app/img/ui/new-image.svg';\r\nimport importImg from '/src/app/img/ui/import.svg';\r\nimport exportImg from '/src/app/img/ui/export.svg';\r\nimport shareImg from '/src/app/img/ui/share.svg';\r\nimport helpImg from '/src/app/img/ui/help.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n\r\n/**\r\n * Topmost row of buttons in toolspace (with the app logo)\r\n */\r\nexport class ToolspaceTopRow {\r\n    \r\n    private readonly rootEl: HTMLElement;\r\n    \r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            logoImg: string;\r\n            onLogo: () => void;\r\n            onNew: () => void;\r\n            onImport: () => void;\r\n            onSave: () => void;\r\n            onShare: () => void;\r\n            onHelp: () => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-toolspace-row',\r\n            css: {\r\n                height: '36px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        function createButton (\r\n            p: {\r\n                onClick: () => void;\r\n                title: string;\r\n                image: string;\r\n                contain: boolean;\r\n                extraPadding?: number;\r\n                darkInvert?: boolean;\r\n            }\r\n        ): {\r\n            el: HTMLElement;\r\n            pointerListener: PointerListener;\r\n        } {\r\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n            const el = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.contain ? padding + 'px 0' : '',\r\n                },\r\n            });\r\n            const im = BB.el({\r\n                className: p.darkInvert ? 'dark-invert' : undefined,\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundPosition: 'center',\r\n                    backgroundSize: p.contain ? 'contain' : '',\r\n                    //filter: 'grayscale(1)',\r\n                    height: '100%',\r\n                },\r\n            });\r\n            im.style.pointerEvents = 'none';\r\n            el.append(im);\r\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: el,\r\n                onEnterLeave: function (isOver) {\r\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\r\n                },\r\n            });\r\n            return {\r\n                el,\r\n                pointerListener,\r\n            };\r\n        }\r\n\r\n        const logoButton = createButton({\r\n            onClick: p.onLogo,\r\n            title: LANG('home'),\r\n            image: p.logoImg ? p.logoImg : klecksLogoImg,\r\n            contain: true,\r\n            darkInvert: true,\r\n        });\r\n        logoButton.el.classList.add('kl-tool-row-border-right');\r\n        BB.css(logoButton.el, {\r\n            width: '45px',\r\n        });\r\n        const newButton = createButton({\r\n            onClick: p.onNew,\r\n            title: LANG('file-new'),\r\n            image: newImageImg,\r\n            extraPadding: 1,\r\n            contain: true,\r\n        });\r\n        const importButton = createButton({\r\n            onClick: p.onImport,\r\n            title: LANG('file-import'),\r\n            image: importImg,\r\n            extraPadding: 1,\r\n            contain: true,\r\n        });\r\n        const saveButton = createButton({\r\n            onClick: p.onSave,\r\n            title: LANG('file-save'),\r\n            image: exportImg,\r\n            extraPadding: 1,\r\n            contain: true,\r\n        });\r\n\r\n        let shareButton = null;\r\n        if (BB.canShareFiles()) {\r\n            shareButton = createButton({\r\n                onClick: p.onShare,\r\n                title: LANG('file-share'),\r\n                image: shareImg,\r\n                contain: true,\r\n                darkInvert: true,\r\n            });\r\n        }\r\n        const helpButton = createButton({\r\n            onClick: p.onHelp,\r\n            title: LANG('help'),\r\n            image: helpImg,\r\n            contain: true,\r\n            darkInvert: true,\r\n        });\r\n\r\n        BB.append(this.rootEl, [\r\n            logoButton.el,\r\n            newButton.el,\r\n            importButton.el,\r\n            saveButton.el,\r\n            shareButton ? shareButton.el : undefined,\r\n            helpButton.el,\r\n        ]);\r\n    }\r\n    \r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6Sfz2\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eaJmh\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kV8IH\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"SROeX\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"lFrok\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"cvYlU\");","import {BB} from '../../../bb/bb';\r\nimport {dialogCounter} from '../modals/modal-count';\r\nimport toolPaintImg from '/src/app/img/ui/tool-paint.svg';\r\nimport toolFillImg from '/src/app/img/ui/tool-fill.svg';\r\nimport toolGradientImg from '/src/app/img/ui/tool-gradient.svg';\r\nimport toolTextImg from '/src/app/img/ui/tool-text.svg';\r\nimport toolShapeImg from '/src/app/img/ui/tool-shape.svg';\r\nimport caretDownImg from '/src/app/img/ui/caret-down.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {TToolType} from '../../kl-types';\r\n\r\n\r\ntype TDropdownButton = {\r\n    wrapper: HTMLElement;\r\n    show: (b: boolean) => void;\r\n    setIsSmall: (b: boolean) => void;\r\n};\r\n\r\n/**\r\n * Toolrow Dropdown. The button where you select: brush, fill, select, transform, etc.\r\n */\r\nexport class ToolDropdown {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly activeButton: HTMLElement;\r\n    private readonly smallMargin: string = '6px 0';\r\n    private readonly optionArr: TToolType[] = ['draw', 'fill', 'gradient', 'text', 'shape'];\r\n    private readonly dropdownBtnArr: TDropdownButton[];\r\n    private readonly arrowButton: HTMLElement;\r\n    private isActive: boolean;\r\n    private currentActiveIndex: number;\r\n    private readonly titleArr: string[];\r\n    private activeButtonIm: HTMLElement;\r\n    private readonly imArr;\r\n\r\n    private updateButton () {\r\n        this.activeButton.title = this.titleArr[this.currentActiveIndex];\r\n        this.activeButtonIm.style.backgroundImage = 'url(\\'' + this.imArr[this.currentActiveIndex] + '\\')';\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onChange: (activeStr: TToolType) => void;\r\n        }\r\n    ) {\r\n        this.imArr = [\r\n            toolPaintImg,\r\n            toolFillImg,\r\n            toolGradientImg,\r\n            toolTextImg,\r\n            toolShapeImg,\r\n        ];\r\n        this.titleArr = [\r\n            `${LANG('tool-brush')} [B]`,\r\n            `${LANG('tool-paint-bucket')} [G]`,\r\n            `${LANG('tool-gradient')} [G]`,\r\n            `${LANG('tool-text')} [T]`,\r\n            `${LANG('tool-shape')} [U]`,\r\n        ];\r\n        this.currentActiveIndex = 0;\r\n        this.isActive = true;\r\n        let isOpen = false;\r\n\r\n        //preload images\r\n        setTimeout(() => {\r\n            for (let i = 1; i < this.imArr.length; i++) {\r\n                const im = new Image();\r\n                im.src = this.imArr[i];\r\n            }\r\n        }, 100);\r\n\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n\r\n        let openTimeout: ReturnType<typeof setTimeout>;\r\n        let isDragging = false;\r\n        let startX: number;\r\n        let startY: number;\r\n        let pointerListener;\r\n        if (BB.hasPointerEvents) {\r\n            pointerListener = new BB.PointerListener({\r\n                target: this.rootEl,\r\n                onPointer: (event) => {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (isOpen) {\r\n                            return;\r\n                        }\r\n\r\n                        openTimeout = setTimeout(() => {\r\n                            showDropdown();\r\n                        }, 400);\r\n                        isDragging = true;\r\n                        startX = event.pageX;\r\n                        startY = event.pageY;\r\n\r\n                    } else if (event.type === 'pointermove') {\r\n                        if (isDragging && !isOpen && BB.dist(startX, startY, event.pageX, event.pageY) > 5) {\r\n                            clearTimeout(openTimeout);\r\n                            showDropdown();\r\n                        }\r\n\r\n                    } else if (event.type === 'pointerup') {\r\n                        clearTimeout(openTimeout);\r\n                        if (isOpen && isDragging) {\r\n                            const target = document.elementFromPoint(event.pageX, event.pageY);\r\n                            for (let i = 0; i < this.dropdownBtnArr.length; i++) {\r\n                                if (target === this.dropdownBtnArr[i].wrapper) {\r\n                                    closeDropdown();\r\n                                    this.isActive = true;\r\n                                    this.currentActiveIndex = i;\r\n                                    this.updateButton();\r\n                                    p.onChange(this.optionArr[this.currentActiveIndex]);\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                        isDragging = false;\r\n                    }\r\n                },\r\n            });\r\n        }\r\n\r\n        this.activeButton = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'toolspace-row-button nohighlight toolspace-row-button-activated',\r\n            title: this.titleArr[this.currentActiveIndex],\r\n            onClick: (e) => {\r\n                if (this.isActive && !isOpen) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    showDropdown();\r\n                    return;\r\n                }\r\n\r\n                this.isActive = true;\r\n                p.onChange(this.optionArr[this.currentActiveIndex]);\r\n                if (isOpen) {\r\n                    closeDropdown();\r\n                }\r\n            },\r\n            css: {\r\n                padding: '10px 0',\r\n                pointerEvents: 'auto',\r\n                height: '100%',\r\n                boxSizing: 'border-box',\r\n            },\r\n        });\r\n\r\n        this.activeButtonIm = BB.el({\r\n            parent: this.activeButton,\r\n            className: 'dark-invert',\r\n            css: {\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: 'contain',\r\n                width: 'calc(100% - 7px)',\r\n                height: '100%',\r\n                pointerEvents: 'none',\r\n                opacity: '0.75',\r\n            },\r\n        });\r\n\r\n        this.arrowButton = BB.el({\r\n            parent: this.activeButton,\r\n            className: 'dark-invert',\r\n            css: {\r\n                position: 'absolute',\r\n                right: '1px',\r\n                bottom: '1px',\r\n                width: '18px',\r\n                height: '18px',\r\n                //background: '#aaa',\r\n                //borderRadius: '2px',\r\n                cursor: 'pointer',\r\n\r\n                backgroundImage: 'url(\\'' + caretDownImg + '\\')',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                backgroundSize: '60%',\r\n            },\r\n            title: 'More Tools',\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                showDropdown();\r\n            },\r\n        });\r\n\r\n\r\n        const overlay = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                //background: 'rgba(255,0,0,0.5)',\r\n                left: '0',\r\n                top: '0',\r\n                right: '0',\r\n                bottom: '0',\r\n            },\r\n        });\r\n        const overlayPointerListener = new BB.PointerListener({\r\n            target: overlay,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    e.eventPreventDefault();\r\n                    closeDropdown();\r\n                }\r\n            },\r\n        });\r\n\r\n        const dropdownWrapper = BB.el({\r\n            className: 'tool-dropdown-wrapper',\r\n            css: {\r\n                position: 'absolute',\r\n                width: '100%',\r\n                height: (100 * (this.optionArr.length - 1)) + '%',\r\n                top: '100%',\r\n                left: '0',\r\n                zIndex: '1',\r\n                boxSizing: 'border-box',\r\n                cursor: 'pointer',\r\n                transition: 'height 0.1s ease-in-out, opacity 0.1s ease-in-out',\r\n                borderBottomLeftRadius: '5px',\r\n                borderBottomRightRadius: '5px',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n        this.dropdownBtnArr = [];\r\n\r\n        const createDropdownButton = (\r\n            p: {\r\n                index: number;\r\n                id: TToolType;\r\n                image: string;\r\n                title: string;\r\n                onClick: (index: number) => void;\r\n            }\r\n        ): TDropdownButton => {\r\n            const wrapper = BB.el({\r\n                parent: dropdownWrapper,\r\n                className: 'tool-dropdown-button',\r\n                title: p.title,\r\n                css: {\r\n                    padding: '10px 0',\r\n                    height: (100 / (this.optionArr.length - 1)) + '%',\r\n                    boxSizing: 'border-box',\r\n                },\r\n                onClick: (e) => {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    p.onClick(p.index);\r\n                },\r\n            });\r\n\r\n            BB.el({\r\n                parent: wrapper,\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundPosition: 'center',\r\n                    backgroundSize: 'contain',\r\n                    height: '100%',\r\n                    pointerEvents: 'none',\r\n                    opacity: '0.75',\r\n                },\r\n            });\r\n\r\n            // --- interface ---\r\n            const show = (b: boolean) => {\r\n                wrapper.style.display = b ? 'block' : 'none';\r\n            };\r\n\r\n            const setIsSmall = (b: boolean) => {\r\n                wrapper.style.padding = b ? this.smallMargin : '10px 0';\r\n            };\r\n\r\n            return {\r\n                wrapper,\r\n                show,\r\n                setIsSmall,\r\n            };\r\n        };\r\n\r\n        const onClickDropdownBtn = (index: number) => {\r\n            closeDropdown();\r\n\r\n            this.isActive = true;\r\n            this.currentActiveIndex = index;\r\n\r\n            this.updateButton();\r\n\r\n            p.onChange(this.optionArr[this.currentActiveIndex]);\r\n        };\r\n\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            this.dropdownBtnArr.push(createDropdownButton({\r\n                index: i,\r\n                id: this.optionArr[i],\r\n                image: this.imArr[i],\r\n                title: this.titleArr[i],\r\n                onClick: onClickDropdownBtn,\r\n            }));\r\n        }\r\n\r\n        const showDropdown = () => {\r\n            dialogCounter.increase(0.5);\r\n            isOpen = true;\r\n\r\n            for (let i = 0; i < this.optionArr.length; i++) {\r\n                this.dropdownBtnArr[i].show(this.currentActiveIndex !== i);\r\n            }\r\n\r\n            this.arrowButton.style.display = 'none';\r\n            this.rootEl.style.zIndex = '1';\r\n            document.body.append(overlay);\r\n            this.rootEl.append(dropdownWrapper);\r\n        };\r\n\r\n        const closeDropdown = () => {\r\n            dialogCounter.decrease(0.5);\r\n            isOpen = false;\r\n            this.arrowButton.style.removeProperty('display');\r\n            this.rootEl.style.removeProperty('z-index');\r\n            document.body.removeChild(overlay);\r\n\r\n            this.rootEl.removeChild(dropdownWrapper);\r\n        };\r\n\r\n        this.updateButton();\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    setIsSmall (b: boolean): void {\r\n        this.activeButton.style.padding = b ? this.smallMargin : '10px 0';\r\n        for (let i = 0; i < this.optionArr.length; i++) {\r\n            this.dropdownBtnArr[i].setIsSmall(b);\r\n        }\r\n        if (b) {\r\n            this.arrowButton.style.width = '14px';\r\n            this.arrowButton.style.height = '14px';\r\n        } else {\r\n            this.arrowButton.style.width = '18px';\r\n            this.arrowButton.style.height = '18px';\r\n        }\r\n    }\r\n\r\n    setActive (activeStr: TToolType): void {\r\n        if (this.optionArr.includes(activeStr)) {\r\n            this.isActive = true;\r\n            for (let i = 0; i < this.optionArr.length; i++) {\r\n                if (this.optionArr[i] === activeStr) {\r\n                    this.currentActiveIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n            this.activeButton.classList.add('toolspace-row-button-activated');\r\n            this.updateButton();\r\n        } else {\r\n            this.isActive = false;\r\n            this.activeButton.classList.remove('toolspace-row-button-activated');\r\n        }\r\n    }\r\n\r\n    getActive (): TToolType {\r\n        return this.optionArr[this.currentActiveIndex];\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dW3eU\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fnumN\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6J8A8\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"da34V\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eStsa\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"eW5wL\");","import {BB} from '../../../bb/bb';\r\nimport {ToolDropdown} from './tool-dropdown';\r\nimport toolHandImg from '/src/app/img/ui/tool-hand.svg';\r\nimport toolZoomInImg from '/src/app/img/ui/tool-zoom-in.svg';\r\nimport toolZoomOutImg from '/src/app/img/ui/tool-zoom-out.svg';\r\nimport toolUndoImg from '/src/app/img/ui/tool-undo.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\nimport {TToolType} from '../../kl-types';\r\n\r\n\r\ntype TBaseToolRowButton = {\r\n    el: HTMLElement;\r\n};\r\n\r\ntype TToolRowButton = TBaseToolRowButton & {\r\n    pointerListener: PointerListener;\r\n    setIsSmall: (b: boolean) => void;\r\n};\r\n\r\ntype TToolRowTriangleButton = TBaseToolRowButton & {\r\n    setIsEnabledLeft: (b: boolean) => void;\r\n    setIsEnabledRight: (b: boolean) => void;\r\n    leftPointerListener: PointerListener;\r\n    rightPointerListener: PointerListener;\r\n};\r\n\r\n/**\r\n * Row of buttons in toolspace. image-operations (draw, hand), zoom, undo/redo\r\n * Need to do syncing. So tool is correct, and zoom/undo/redo buttons are properly enabled/disabled\r\n * heights: 54px tall, 36px small -> via setIsSmall\r\n */\r\nexport class ToolspaceToolRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly toolDropdown: ToolDropdown;\r\n    private readonly handButton: TToolRowButton;\r\n    private readonly zoomInButton: TToolRowButton;\r\n    private readonly zoomOutButton: TToolRowButton;\r\n    private readonly undoButton: TToolRowButton;\r\n    private readonly redoButton: TToolRowButton;\r\n    private readonly zoomInNOutButton: TToolRowTriangleButton;\r\n    private readonly undoNRedoButton: TToolRowTriangleButton;\r\n    private currentActiveStr: TToolType;\r\n    private readonly onActivate: (activeStr: TToolType) => void;\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            onActivate: (activeStr: TToolType) => void; // clicking on tool button - activating it\r\n            onZoomIn: () => void;\r\n            onZoomOut: () => void;\r\n            onUndo: () => void;\r\n            onRedo: () => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el( {\r\n            className: 'kl-toolspace-row',\r\n            css: {\r\n                height: '54px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        this.onActivate = p.onActivate;\r\n        this.currentActiveStr = 'draw'; // 'draw' | 'hand' | 'fill'\r\n\r\n\r\n        const createButton = (p: {\r\n            onClick: () => void;\r\n            image: string;\r\n            contain: boolean;\r\n            doLighten?: boolean;\r\n            doMirror?: boolean;\r\n        }): TToolRowButton => {\r\n\r\n            const smallMargin = p.doLighten ? '6px 0' : '8px 0';\r\n\r\n            const el = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                //title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.contain ? '10px 0' : '',\r\n                },\r\n            });\r\n            const im = BB.el({\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundPosition: 'center',\r\n                    backgroundSize: p.contain ? 'contain' : '',\r\n                    //filter: 'grayscale(1)',\r\n                    height: '100%',\r\n                    transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                    pointerEvents: 'none',\r\n                    opacity: p.doLighten ? '0.75' : '1',\r\n                },\r\n            });\r\n            el.append(im);\r\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: el,\r\n                onEnterLeave: (isOver) => {\r\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\r\n                },\r\n            });\r\n            const setIsSmall = (b: boolean) => {\r\n                el.style.padding = p.contain ? (b ? smallMargin : '10px 0') : '';\r\n            };\r\n            return {\r\n                el,\r\n                pointerListener,\r\n                setIsSmall,\r\n            };\r\n        };\r\n\r\n\r\n        const createTriangleButton = (p: {\r\n            onLeft: () => void;\r\n            onRight: () => void;\r\n            leftImage: string;\r\n            rightImage: string | null;\r\n        }): TToolRowTriangleButton => { // because IE and Edge don't support clip path\r\n\r\n            const result = BB.el({\r\n                css: {\r\n                    flexGrow: '1',\r\n                    position: 'relative',\r\n                },\r\n            });\r\n\r\n            const svg = BB.createSvg({\r\n                elementType: 'svg',\r\n                width: '67px', // can't think of a way doing with percentage\r\n                height: '54px',\r\n                viewBox: '0 0 100 100',\r\n                preserveAspectRatio: 'none',\r\n            });\r\n            BB.css(svg, {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n            });\r\n\r\n            const blurRadius = 10;\r\n            const blurOffsetX = 2;\r\n            const blurOffsetY = 2;\r\n\r\n            const defs = BB.createSvg( { // inset shadow via svg\r\n                elementType: 'defs',\r\n                childrenArr: [\r\n                    {\r\n                        elementType: 'filter',\r\n                        id: 'innershadow',\r\n                        x0: '-50%',\r\n                        y0: '-50%',\r\n                        width: '200%',\r\n                        height: '200%',\r\n                        childrenArr: [\r\n                            {\r\n                                elementType: 'feGaussianBlur',\r\n                                in: 'SourceAlpha',\r\n                                stdDeviation: '' + blurRadius,\r\n                                result: 'blur',\r\n                            }, {\r\n                                elementType: 'feOffset',\r\n                                dx: '' + blurOffsetX,\r\n                                dy: '' + blurOffsetY,\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'SourceAlpha',\r\n                                operator: 'arithmetic',\r\n                                k2: '-1',\r\n                                k3: '1',\r\n                                result: 'shadowDiff',\r\n                            },\r\n\r\n                            {\r\n                                elementType: 'feFlood',\r\n                                'flood-color': '#000',\r\n                                'flood-opacity': '0.2',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'shadowDiff',\r\n                                operator: 'in',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'SourceGraphic',\r\n                                operator: 'over',\r\n                                result: 'firstfilter',\r\n                            },\r\n\r\n                            {\r\n                                elementType: 'feGaussianBlur',\r\n                                in: 'firstfilter',\r\n                                stdDeviation: '' + blurRadius,\r\n                                result: 'blur2',\r\n                            }, {\r\n                                elementType: 'feOffset',\r\n                                dx: '' + blurOffsetX,\r\n                                dy: '' + blurOffsetY,\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'firstfilter',\r\n                                operator: 'arithmetic',\r\n                                k2: '-1',\r\n                                k3: '1',\r\n                                result: 'shadowDiff',\r\n                            },\r\n\r\n                            {\r\n                                elementType: 'feFlood',\r\n                                'flood-color': '#000',\r\n                                'flood-opacity': '0.2',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'shadowDiff',\r\n                                operator: 'in',\r\n                            }, {\r\n                                elementType: 'feComposite',\r\n                                in2: 'firstfilter',\r\n                                operator: 'over',\r\n                            },\r\n                        ],\r\n                    },\r\n                ],\r\n            });\r\n\r\n\r\n            const svgTriangleLeft = BB.createSvg({\r\n                elementType: 'path',\r\n                'vector-effect': 'non-scaling-stroke',\r\n                d: 'M0,0 L 100,0 0,100 z',\r\n                fill: 'rgba(0,0,0,0)',\r\n                class: 'toolspace-svg-triangle-button',\r\n            });\r\n            svgTriangleLeft.onclick = () => {\r\n                p.onLeft();\r\n                svgTriangleLeft.classList.remove('toolspace-svg-triangle-button-hover');\r\n            };\r\n\r\n            const svgTriangleRight = BB.createSvg({\r\n                elementType: 'path',\r\n                'vector-effect': 'non-scaling-stroke',\r\n                d: 'M100,100 L 100,0 0,100 z',\r\n                fill: 'rgba(0,0,0,0)',\r\n                class: 'toolspace-svg-triangle-button',\r\n            });\r\n            svgTriangleRight.onclick = () => {\r\n                p.onRight();\r\n                svgTriangleRight.classList.remove('toolspace-svg-triangle-button-hover');\r\n            };\r\n\r\n            // because :hover causes problems w touch\r\n            const leftPointerListener = new BB.PointerListener({\r\n                target: svgTriangleLeft,\r\n                onEnterLeave: (isOver) => {\r\n                    svgTriangleLeft.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n                },\r\n            });\r\n            const rightPointerListener = new BB.PointerListener({\r\n                target: svgTriangleRight,\r\n                onEnterLeave: (isOver) => {\r\n                    svgTriangleRight.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\r\n                },\r\n            });\r\n\r\n\r\n            svg.append(defs, svgTriangleLeft, svgTriangleRight);\r\n            result.append(svg);\r\n\r\n\r\n            const leftIm = BB.el({\r\n                parent: result,\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + p.leftImage + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundSize: 'contain',\r\n                    width: '20px',\r\n                    height: '20px',\r\n                    position: 'absolute',\r\n                    left: '10px',\r\n                    top: '8px',\r\n                    //transform: p.doMirror ? 'scale(-1, 1)' : '',\r\n                    pointerEvents: 'none',\r\n                },\r\n            });\r\n            result.append(leftIm);\r\n\r\n\r\n            const rightIm = BB.el({\r\n                parent: result,\r\n                className: 'dark-invert',\r\n                css: {\r\n                    backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundSize: 'contain',\r\n                    width: '20px',\r\n                    height: '20px',\r\n                    position: 'absolute',\r\n                    right: '10px',\r\n                    bottom: '8px',\r\n                    transform: p.rightImage ? '' : 'scale(-1, 1)',\r\n                    pointerEvents: 'none',\r\n                },\r\n            });\r\n\r\n\r\n\r\n\r\n\r\n            const setIsEnabledLeft = (b: boolean) => {\r\n                svgTriangleLeft.classList.toggle('toolspace-row-button-disabled', !b);\r\n                leftIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n            };\r\n\r\n            const setIsEnabledRight = (b: boolean) => {\r\n                svgTriangleRight.classList.toggle('toolspace-row-button-disabled', !b);\r\n                rightIm.classList.toggle('toolspace-row-button-disabled', !b);\r\n            };\r\n\r\n            return {\r\n                el: result,\r\n                setIsEnabledLeft,\r\n                setIsEnabledRight,\r\n                leftPointerListener,\r\n                rightPointerListener,\r\n            };\r\n        };\r\n\r\n        this.toolDropdown = new ToolDropdown({\r\n            onChange: (activeStr) => {\r\n                this.setActive(activeStr, true);\r\n            },\r\n        });\r\n        this.rootEl.append(this.toolDropdown.getElement());\r\n\r\n        this.handButton = createButton({\r\n            onClick: () => {\r\n                this.setActive('hand', true);\r\n            },\r\n            image: toolHandImg,\r\n            contain: true,\r\n            doLighten: true,\r\n        });\r\n        this.handButton.el.classList.add('kl-tool-row-border-right');\r\n        this.handButton.el.title = LANG('tool-hand');\r\n        this.rootEl.append(this.handButton.el);\r\n\r\n        this.zoomInNOutButton = createTriangleButton({\r\n            onLeft: p.onZoomIn,\r\n            onRight: p.onZoomOut,\r\n            leftImage: toolZoomInImg,\r\n            rightImage: toolZoomOutImg,\r\n        });\r\n        this.zoomInNOutButton.el.title = LANG('tool-zoom');\r\n        this.rootEl.append(this.zoomInNOutButton.el);\r\n\r\n        this.zoomInButton = createButton({\r\n            onClick: p.onZoomIn,\r\n            image: toolZoomInImg,\r\n            contain: true,\r\n        });\r\n        this.zoomInButton.el.title = LANG('zoom-in');\r\n        this.rootEl.append(this.zoomInButton.el);\r\n\r\n        this.zoomOutButton = createButton({\r\n            onClick: p.onZoomOut,\r\n            image: toolZoomOutImg,\r\n            contain: true,\r\n        });\r\n        this.zoomOutButton.el.title = LANG('zoom-out');\r\n        this.rootEl.append(this.zoomOutButton.el);\r\n\r\n        this.undoNRedoButton = createTriangleButton({\r\n            onLeft: p.onUndo,\r\n            onRight: p.onRedo,\r\n            leftImage: toolUndoImg,\r\n            rightImage: null,\r\n        });\r\n        this.undoNRedoButton.el.title = LANG('undo') + '/' + LANG('redo');\r\n        this.undoNRedoButton.setIsEnabledLeft(false);\r\n        this.undoNRedoButton.setIsEnabledRight(false);\r\n        this.rootEl.append(this.undoNRedoButton.el);\r\n\r\n        this.undoButton = createButton({\r\n            onClick: p.onUndo,\r\n            image: toolUndoImg,\r\n            contain: true,\r\n        });\r\n        this.undoButton.el.title = LANG('undo');\r\n        this.undoButton.el.classList.add('toolspace-row-button-disabled');\r\n        this.rootEl.append(this.undoButton.el);\r\n\r\n        this.redoButton = createButton({\r\n            onClick: p.onRedo,\r\n            image: toolUndoImg,\r\n            contain: true,\r\n            doMirror: true,\r\n        });\r\n        this.redoButton.el.title = LANG('redo');\r\n        this.redoButton.el.classList.add('toolspace-row-button-disabled');\r\n        this.rootEl.append(this.redoButton.el);\r\n\r\n        this.zoomInButton.el.style.display = 'none';\r\n        this.zoomOutButton.el.style.display = 'none';\r\n        this.undoButton.el.style.display = 'none';\r\n        this.redoButton.el.style.display = 'none';\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsSmall (b: boolean): void {\r\n        BB.css(this.rootEl, {\r\n            height: b ? '36px' : '54px',\r\n        });\r\n\r\n        this.toolDropdown.setIsSmall(b);\r\n        this.handButton.setIsSmall(b);\r\n        this.zoomInButton.setIsSmall(b);\r\n        this.zoomOutButton.setIsSmall(b);\r\n        this.undoButton.setIsSmall(b);\r\n        this.redoButton.setIsSmall(b);\r\n\r\n        if (b) {\r\n            this.zoomInNOutButton.el.style.display = 'none';\r\n            this.undoNRedoButton.el.style.display = 'none';\r\n            this.zoomInButton.el.style.display = 'block';\r\n            this.zoomOutButton.el.style.display = 'block';\r\n            this.undoButton.el.style.display = 'block';\r\n            this.redoButton.el.style.display = 'block';\r\n        } else {\r\n            this.zoomInNOutButton.el.style.display = 'block';\r\n            this.undoNRedoButton.el.style.display = 'block';\r\n            this.zoomInButton.el.style.display = 'none';\r\n            this.zoomOutButton.el.style.display = 'none';\r\n            this.undoButton.el.style.display = 'none';\r\n            this.redoButton.el.style.display = 'none';\r\n        }\r\n\r\n    }\r\n\r\n    setEnableZoomIn (b: boolean): void {\r\n        this.zoomInButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.zoomInNOutButton.setIsEnabledLeft(b);\r\n    }\r\n\r\n    setEnableZoomOut (b: boolean): void {\r\n        this.zoomOutButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.zoomInNOutButton.setIsEnabledRight(b);\r\n    }\r\n\r\n    setEnableUndo (b: boolean): void {\r\n        this.undoButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.undoNRedoButton.setIsEnabledLeft(b);\r\n    }\r\n\r\n    setEnableRedo (b: boolean): void {\r\n        this.redoButton.el.classList.toggle('toolspace-row-button-disabled', !b);\r\n        this.undoNRedoButton.setIsEnabledRight(b);\r\n    }\r\n\r\n    setActive (activeStr: TToolType, doEmit?: boolean): void {\r\n        if (this.currentActiveStr === activeStr) {\r\n            return;\r\n        }\r\n\r\n        this.currentActiveStr = activeStr;\r\n\r\n        this.toolDropdown.setActive(this.currentActiveStr);\r\n        this.handButton.el.classList.toggle('toolspace-row-button-activated', this.currentActiveStr === 'hand');\r\n\r\n        if (doEmit) {\r\n            this.onActivate(this.currentActiveStr);\r\n        }\r\n    }\r\n\r\n    getActive (): TToolType {\r\n        return this.currentActiveStr;\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"b30IN\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"jYhj7\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"44EC1\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"1YnIA\");","import {BB} from '../../../bb/bb';\r\nimport {Select} from './select';\r\nimport {LANG} from '../../../language/language';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\n/**\r\n * Ui to select stabilizer level. 4 options. returned as 0-3\r\n */\r\nexport class ToolspaceStabilizerRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly pointerListener: PointerListener;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            smoothing: number; // initial level [0,3]\r\n            onSelect: (level: number) => void; // [0-3], when level changes\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            tagName: 'label',\r\n            className: 'kl-stabilizer',\r\n            content: LANG('stabilizer') + '&nbsp;',\r\n            title: LANG('stabilizer-title'),\r\n        });\r\n\r\n        const strengthSelect = new Select({\r\n            optionArr: [\r\n                ['0', '0'],\r\n                ['1', '1'],\r\n                ['2', '2'],\r\n                ['3', '3'],\r\n                ['4', '4'],\r\n                ['5', '5'],\r\n            ],\r\n            initValue: '' + p.smoothing,\r\n            onChange: function (val) {\r\n                p.onSelect(parseInt(val));\r\n            },\r\n        });\r\n        this.rootEl.append(strengthSelect.getElement());\r\n\r\n        this.pointerListener = new BB.PointerListener({\r\n            target: this.rootEl,\r\n            onWheel: function (e) {\r\n                strengthSelect.setDeltaValue(e.deltaY);\r\n            },\r\n        });\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport invertedBorderImg from '/src/app/img/ui/inverted-border.svg';\r\nimport {IKeyStringOptional} from '../../../bb/bb-types';\r\n\r\n\r\n// type all functions\r\n\r\n\r\ntype TTabInit = {\r\n    id: string; // e.g. 'draw',\r\n    label?: string;\r\n    image?: string; // background image\r\n    title?: string;\r\n    isVisible?: boolean; // default is true\r\n    onOpen: () => void;\r\n    onClose: () => void;\r\n    css?: IKeyStringOptional;\r\n};\r\n\r\ntype TTab = {\r\n    id: string;\r\n    isVisible: boolean;\r\n    onOpen: () => void;\r\n    onClose: () => void;\r\n    update: (activeTab: TTab) => void;\r\n    el: HTMLElement;\r\n};\r\n\r\n\r\n/**\r\n * row of tabs. uses css class .tabrow__tab\r\n */\r\nexport class TabRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly tabArr: TTab[];\r\n    private activeTab: TTab;\r\n    private readonly roundRight: HTMLElement;\r\n    private readonly roundLeft: HTMLElement;\r\n    \r\n    \r\n    // update\r\n    update (): void {\r\n        for (let i = 0; i < this.tabArr.length; i++) {\r\n            this.tabArr[i].update(this.activeTab);\r\n        }\r\n    }\r\n    \r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            initialId: string; // e.g. 'draw'\r\n            useAccent?: boolean;\r\n            tabArr: TTabInit[];\r\n        }\r\n    ) {\r\n        const height = 35;\r\n        this.rootEl = BB.el({\r\n            className: 'tabrow',\r\n            css: {\r\n                height: height + 'px',\r\n            },\r\n        });\r\n\r\n        this.tabArr = []; //creates its own internal arr\r\n\r\n        const roundSize = 10;\r\n        this.roundRight = BB.el({\r\n            css: {\r\n                width: roundSize + 'px',\r\n                height: roundSize + 'px',\r\n                backgroundImage: `url('${invertedBorderImg}')`,\r\n                backgroundSize: 'cover',\r\n                position: 'absolute',\r\n                right: -roundSize + 'px',\r\n                bottom: '0',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n        this.roundLeft = BB.el({\r\n            css: {\r\n                width: roundSize + 'px',\r\n                height: roundSize + 'px',\r\n                backgroundImage: `url('${invertedBorderImg}')`,\r\n                backgroundSize: 'cover',\r\n                position: 'absolute',\r\n                left: -roundSize + 'px',\r\n                bottom: '0',\r\n                transform: 'scale(-1,1)',\r\n                pointerEvents: 'none',\r\n            },\r\n        });\r\n\r\n        const createTab = (pTabObj: TTabInit, initialId: string, useAccent: boolean): TTab => {\r\n            const isVisible = ('isVisible' in pTabObj && pTabObj.isVisible !== undefined) ? pTabObj.isVisible : true;\r\n            const result: TTab = {\r\n                id: pTabObj.id,\r\n                isVisible: isVisible,\r\n                onOpen: pTabObj.onOpen,\r\n                onClose: pTabObj.onClose,\r\n                update: (openedTabObj: TTab) => {\r\n                    result.el.className = openedTabObj === result ? (useAccent ? 'tabrow__tab tabrow__tab--opened-accented' : 'tabrow__tab tabrow__tab--opened') : 'tabrow__tab';\r\n                    result.el.style.display = result.isVisible ? 'block' : 'none';\r\n                },\r\n                el: BB.el({\r\n                    parent: this.rootEl,\r\n                    content: 'label' in pTabObj ? pTabObj.label : '',\r\n                    title: 'title' in pTabObj ? pTabObj.title : undefined,\r\n                    className: initialId === pTabObj.id ? (useAccent ? 'tabrow__tab tabrow__tab--opened-accented' : 'tabrow__tab tabrow__tab--opened') : 'tabrow__tab',\r\n                    css: {\r\n                        lineHeight: height + 'px',\r\n                        display: isVisible ? 'block' : 'none',\r\n                        zIndex: '0',\r\n                    },\r\n                    onClick: () => {\r\n                        if (this.activeTab === result) {\r\n                            return;\r\n                        }\r\n                        this.open(result.id);\r\n                    },\r\n                }),\r\n            };\r\n            if ('image' in pTabObj) {\r\n\r\n                BB.el({\r\n                    tagName: 'span',\r\n                    parent: result.el,\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        backgroundImage: `url(\"${pTabObj.image}\")`,\r\n                        backgroundSize: 'contain',\r\n                        backgroundPosition: 'center',\r\n                        backgroundRepeat: 'no-repeat',\r\n                        display: 'flex',\r\n                        height: (height - 7) + 'px',\r\n                        justifyContent: 'center',\r\n                        margin: '4px auto',\r\n                    },\r\n                });\r\n            }\r\n            if ('css' in pTabObj && pTabObj.css !== undefined) {\r\n                BB.css(result.el, pTabObj.css);\r\n            }\r\n\r\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: result.el,\r\n                onEnterLeave: (isOver) => {\r\n                    result.el.classList.toggle('tabrow__tab-hover', isOver);\r\n                },\r\n            });\r\n\r\n            if (initialId === result.id) {\r\n                result.onOpen();\r\n                result.el.append(this.roundRight, this.roundLeft);\r\n            } else {\r\n                result.onClose();\r\n            }\r\n\r\n            return result;\r\n        };\r\n\r\n        let initTabObj = null;\r\n        for (let i = 0; i < p.tabArr.length; i++) {\r\n            const tab = createTab(p.tabArr[i], p.initialId, p.useAccent || false);\r\n            if (tab.id === p.initialId) {\r\n                initTabObj = tab;\r\n            }\r\n            this.tabArr.push(tab);\r\n        }\r\n        if (!initTabObj) {\r\n            throw 'invalid initialId';\r\n        }\r\n        this.activeTab = initTabObj;\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    open (tabId: string): void {\r\n        for (let i = 0; i < this.tabArr.length; i++) {\r\n            if (this.tabArr[i].id === tabId) {\r\n                if (this.activeTab === this.tabArr[i]) { // already open\r\n                    return;\r\n                }\r\n                this.activeTab.onClose();\r\n                this.activeTab = this.tabArr[i];\r\n                this.activeTab.onOpen();\r\n                this.activeTab.el.append(this.roundRight, this.roundLeft);\r\n                this.update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.open - invalid tabId';\r\n    }\r\n\r\n    getOpenedTabId (): string {\r\n        return '' + this.activeTab.id;\r\n    }\r\n\r\n    setIsVisible (tabId: string, isVisible: string): void {\r\n        for (let i = 0; i < this.tabArr.length; i++) {\r\n            if (this.tabArr[i].id === tabId) {\r\n                this.tabArr[i].isVisible = !!isVisible;\r\n                this.update();\r\n                return;\r\n            }\r\n        }\r\n        throw 'TabRow.setIsVisible - invalid tabId';\r\n    }\r\n}\r\n\r\n\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6ae9h\");","import {BB} from '../../../bb/bb';\r\nimport angleImg from '/src/app/img/ui/angle.svg';\r\nimport rotateImg from '/src/app/img/ui/edit-rotate.svg';\r\nimport {LANG} from '../../../language/language';\r\n\r\n/**\r\n * Ui, when hand tool tab is open.\r\n */\r\nexport class HandUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly onAngleChange: (angleDeg: number, isRelative?: boolean) => void;\r\n    private isVisible: boolean = true;\r\n    private scale: number;\r\n    private angleDeg: number;\r\n    private readonly scaleEl: HTMLElement;\r\n    private readonly angleEl: HTMLElement;\r\n    private readonly angleIm: HTMLImageElement;\r\n\r\n\r\n    private updateUi (): void {\r\n        this.scaleEl.innerHTML = Math.round(this.scale * 100) + '%';\r\n        this.angleEl.innerHTML =  Math.round(this.angleDeg) + '';\r\n\r\n        this.angleIm.style.transform = 'rotate(' + this.angleDeg + 'deg)';\r\n        if (this.angleDeg % 90 === 0) {\r\n            this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)';\r\n        } else {\r\n            this.angleIm.style.boxShadow = '';\r\n        }\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            scale: number; // initial value\r\n            angleDeg: number; // initial value\r\n            onReset: () => void;\r\n            onFit: () => void;\r\n            onAngleChange: (angleDeg: number, isRelative?: boolean) => void;\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.scale = p.scale;\r\n        this.angleDeg = p.angleDeg;\r\n        this.onAngleChange = p.onAngleChange;\r\n\r\n        const row1 = BB.el({\r\n            css: {\r\n                marginBottom: '10px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n        const row2 = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        const row3 = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n        this.rootEl.append(row1, row2, row3);\r\n\r\n\r\n        this.scaleEl = BB.el({\r\n            css: {\r\n                width: '55px',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        row1.append(this.scaleEl);\r\n\r\n        this.angleIm = new Image();\r\n        this.angleIm.src = angleImg;\r\n        BB.css(this.angleIm, {\r\n            verticalAlign: 'bottom',\r\n            width: '20px',\r\n            height: '20px',\r\n            marginRight: '5px',\r\n            borderRadius: '10px',\r\n            background: 'rgba(0,0,0,0.2)',\r\n            userSelect: 'none',\r\n        });\r\n        row1.append(this.angleIm);\r\n\r\n        this.angleEl = BB.el({\r\n            parent: row1,\r\n            css: {\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n\r\n        this.updateUi();\r\n\r\n\r\n        const resetButton = BB.el({\r\n            tagName: 'button',\r\n            content: LANG('hand-reset'),\r\n            onClick: p.onReset,\r\n        });\r\n        BB.makeUnfocusable(resetButton);\r\n\r\n        const fitButton = BB.el({\r\n            tagName: 'button',\r\n            content: LANG('hand-fit'),\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: p.onFit,\r\n        });\r\n        BB.makeUnfocusable(fitButton);\r\n        row2.append(resetButton, fitButton);\r\n\r\n        const leftRotateButton = BB.el({\r\n            tagName: 'button',\r\n            content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\r\n            onClick: function () {\r\n                p.onAngleChange(-15, true);\r\n            },\r\n        });\r\n        BB.makeUnfocusable(leftRotateButton);\r\n\r\n        const resetAngleButton = BB.el({\r\n            tagName: 'button',\r\n            content: '0',\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: function () {\r\n                p.onAngleChange(0);\r\n            },\r\n        });\r\n        BB.makeUnfocusable(resetAngleButton);\r\n\r\n        const rightRotateButton = BB.el({\r\n            tagName: 'button',\r\n            content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\"/>',\r\n            css: {\r\n                marginLeft: '10px',\r\n            },\r\n            onClick: function () {\r\n                p.onAngleChange(15, true);\r\n            },\r\n        });\r\n        BB.makeUnfocusable(rightRotateButton);\r\n        row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.updateUi();\r\n        }\r\n    }\r\n\r\n    update (pScale: number, pAngleDeg: number): void {\r\n        this.scale = pScale;\r\n        this.angleDeg = pAngleDeg;\r\n        if (this.isVisible) {\r\n            this.updateUi();\r\n        }\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"8l03e\");","import {BB} from '../../../bb/bb';\r\nimport {KlSlider} from '../components/kl-slider';\r\nimport {Select} from '../components/select';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {LANG} from '../../../language/language';\r\nimport {TFillSampling} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n/**\r\n * Paint Bucket tab contents (color slider, opacity slider, etc)\r\n */\r\nexport class FillUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private isVisible: boolean;\r\n    private readonly colorDiv: HTMLElement;\r\n    private readonly colorSlider: KlColorSlider;\r\n    private readonly toleranceSlider: KlSlider;\r\n    private readonly opacitySlider: KlSlider;\r\n    private readonly modeSelect: Select;\r\n    private readonly growSelect: Select;\r\n    private isContiguous: boolean;\r\n    private readonly eraserToggle: Checkbox;\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.isVisible = true;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        this.colorSlider = p.colorSlider;\r\n\r\n        this.opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: 1,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n        });\r\n        this.rootEl.append(this.opacitySlider.getElement());\r\n\r\n        this.toleranceSlider = new KlSlider({\r\n            label: LANG('bucket-tolerance'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 0,\r\n            max: 255,\r\n            value: 20 * (255 / 100),\r\n            toValue: (displayValue) => displayValue * (255 / 100),\r\n            toDisplayValue: (value) => value / (255 / 100),\r\n        });\r\n        BB.css(this.toleranceSlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(this.toleranceSlider.getElement());\r\n\r\n        const selectRow = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const modeWrapper = BB.el({\r\n            content: LANG('bucket-sample') + '&nbsp;',\r\n            title: LANG('bucket-sample-title'),\r\n            css: {\r\n                fontSize: '15px',\r\n            },\r\n        });\r\n        this.modeSelect = new Select({\r\n            optionArr: [\r\n                ['all', LANG('bucket-sample-all')],\r\n                ['current', LANG('bucket-sample-active')],\r\n                ['above', LANG('bucket-sample-above')],\r\n            ],\r\n            initValue: 'all',\r\n        });\r\n        const modePointerListener = new BB.PointerListener({\r\n            target: this.modeSelect.getElement(),\r\n            onWheel: (e) => {\r\n                this.modeSelect.setDeltaValue(e.deltaY);\r\n            },\r\n        });\r\n        modeWrapper.append(this.modeSelect.getElement());\r\n        selectRow.append(modeWrapper);\r\n\r\n        const growWrapper = BB.el({\r\n            content: LANG('bucket-grow') + '&nbsp;',\r\n            title: LANG('bucket-grow-title'),\r\n            css: {\r\n                fontSize: '15px',\r\n                marginLeft: '10px',\r\n            },\r\n        });\r\n        this.growSelect = new Select({\r\n            optionArr: [\r\n                ['0', '0'],\r\n                ['1', '1'],\r\n                ['2', '2'],\r\n                ['3', '3'],\r\n                ['4', '4'],\r\n                ['5', '5'],\r\n                ['6', '6'],\r\n                ['7', '7'],\r\n            ],\r\n            initValue: '0',\r\n        });\r\n        const growPointerListener = new BB.PointerListener({\r\n            target: this.growSelect.getElement(),\r\n            onWheel: (e) => {\r\n                this.growSelect.setDeltaValue(e.deltaY);\r\n            },\r\n        });\r\n        growWrapper.append(this.growSelect.getElement());\r\n        selectRow.append(growWrapper);\r\n\r\n\r\n        this.isContiguous = true;\r\n        const contiguousToggle = new Checkbox({\r\n            init: true,\r\n            label: LANG('bucket-contiguous'),\r\n            title: LANG('bucket-contiguous-title'),\r\n            callback: (b) => {\r\n                this.isContiguous = b;\r\n            },\r\n            css: {\r\n                paddingRight: '5px',\r\n                display: 'inline-block',\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        this.eraserToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('eraser'),\r\n            css: {\r\n\r\n                paddingRight: '5px',\r\n                display: 'inline-block',\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        this.rootEl.append(BB.el({\r\n            content: [\r\n                contiguousToggle.getElement(),\r\n                this.eraserToggle.getElement(),\r\n            ],\r\n            css: {\r\n                display: 'flex',\r\n                marginTop: '10px',\r\n            },\r\n        }));\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * [0, 1]\r\n     */\r\n    getTolerance (): number {\r\n        return this.toleranceSlider.getValue();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacitySlider.getValue();\r\n    }\r\n\r\n    getSample (): TFillSampling {\r\n        return this.modeSelect.getValue() as TFillSampling;\r\n    }\r\n\r\n    getGrow (): number {\r\n        return parseInt(this.growSelect.getValue(), 10);\r\n    }\r\n\r\n    getContiguous (): boolean {\r\n        return this.isContiguous;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.eraserToggle.getValue();\r\n    }\r\n\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n/**\r\n * Text Tool tab contents (color slider)\r\n */\r\nexport class TextUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly colorDiv: HTMLElement;\r\n    private isVisible: boolean = true;\r\n    private readonly colorSlider: KlColorSlider;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.colorSlider = p.colorSlider;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        const hint = BB.el({\r\n            parent: this.rootEl,\r\n            content: LANG('text-instruction'),\r\n        });\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\r\n        }\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {Options} from '../components/options';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {KlSlider} from '../components/kl-slider';\r\nimport {LANG} from '../../../language/language';\r\nimport {TShapeToolMode, TShapeToolType} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n/**\r\n * Shape Tool tab contents\r\n */\r\nexport class ShapeUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private isVisible: boolean;\r\n    private readonly colorDiv: HTMLElement;\r\n    private readonly colorSlider: KlColorSlider;\r\n    private shape: TShapeToolType = 'rect';\r\n    private mode: TShapeToolMode = 'stroke';\r\n    private readonly eraserToggle: Checkbox;\r\n    private readonly opacitySlider: KlSlider;\r\n    private readonly lineWidthSlider: KlSlider;\r\n    private readonly outwardsToggle: Checkbox;\r\n    private readonly fixedToggle: Checkbox;\r\n    private readonly snapToggle:Checkbox;\r\n    private readonly lockAlphaToggle: Checkbox;\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.isVisible = true;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        this.colorSlider = p.colorSlider;\r\n\r\n        const previewSize = 35;\r\n        const previewPadding = 8;\r\n\r\n\r\n        const rectStrokeSvgRect = BB.createSvg({\r\n            elementType: 'rect',\r\n            x: '' + previewPadding,\r\n            width: '' + (previewSize - previewPadding * 2),\r\n        });\r\n        const rectStrokeSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        rectStrokeSvg.classList.add('dark-invert');\r\n        rectStrokeSvg.append(rectStrokeSvgRect);\r\n        BB.css(rectStrokeSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n        const rectFilledSvgRect = BB.createSvg({\r\n            elementType: 'rect',\r\n            x: '' + previewPadding,\r\n            width: '' + (previewSize - previewPadding * 2),\r\n        });\r\n        const rectFilledSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        rectFilledSvg.classList.add('dark-invert');\r\n        rectFilledSvg.append(rectFilledSvgRect);\r\n        BB.css(rectFilledSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n\r\n        const ellipseStrokeSvgEllipse = BB.createSvg({\r\n            elementType: 'ellipse',\r\n            cx: '' + (previewSize / 2),\r\n            cy: '' + (previewSize / 2),\r\n            rx: '' + (previewSize / 2 - previewPadding),\r\n        });\r\n        const ellipseStrokeSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        ellipseStrokeSvg.classList.add('dark-invert');\r\n        ellipseStrokeSvg.append(ellipseStrokeSvgEllipse);\r\n        BB.css(ellipseStrokeSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n        const ellipseFilledSvgEllipse = BB.createSvg({\r\n            elementType: 'ellipse',\r\n            cx: '' + (previewSize / 2),\r\n            cy: '' + (previewSize / 2),\r\n            rx: '' + (previewSize / 2 - previewPadding),\r\n        });\r\n        const ellipseFilledSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        ellipseFilledSvg.classList.add('dark-invert');\r\n        ellipseFilledSvg.append(ellipseFilledSvgEllipse);\r\n        BB.css(ellipseFilledSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n\r\n        const lineSvgLine = BB.createSvg({\r\n            elementType: 'line',\r\n            x1: '' + previewPadding,\r\n            x2: '' + (previewSize - previewPadding),\r\n        });\r\n        const lineSvg = BB.createSvg({\r\n            elementType: 'svg',\r\n            width: '' + previewSize,\r\n            height: '' + previewSize,\r\n        });\r\n        lineSvg.classList.add('dark-invert');\r\n        lineSvg.append(lineSvgLine);\r\n        BB.css(lineSvg, {\r\n            display: 'block',\r\n        });\r\n\r\n        const updatePreviews = () => {\r\n            const strokeWidth = BB.clamp(Math.round(this.lineWidthSlider.getValue() / 10), 1, 10) + 'px';\r\n\r\n            const squish = 1.35;\r\n\r\n            BB.css(rectStrokeSvgRect, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n            BB.css(rectFilledSvgRect, { fill: 'black', stroke: 'none' });\r\n\r\n            BB.css(ellipseStrokeSvgEllipse, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\r\n            BB.css(ellipseFilledSvgEllipse, { fill: 'black', stroke: 'none' });\r\n\r\n            BB.css(\r\n                lineSvgLine,\r\n                { fill: 'none', stroke: 'black', strokeWidth: strokeWidth }\r\n            );\r\n\r\n            if (this.fixedToggle.getValue()) {\r\n                rectStrokeSvgRect.setAttribute('y', '' + previewPadding);\r\n                rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n                rectFilledSvgRect.setAttribute('y', '' + previewPadding);\r\n                rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\r\n\r\n                ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n                ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\r\n            } else {\r\n                rectStrokeSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n                rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n                rectFilledSvgRect.setAttribute('y', '' + (previewPadding * squish));\r\n                rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\r\n\r\n                ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n                ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\r\n            }\r\n\r\n            if (this.snapToggle.getValue()) {\r\n                lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding));\r\n                lineSvgLine.setAttribute('y2', '' + previewPadding);\r\n            } else {\r\n                lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding * squish));\r\n                lineSvgLine.setAttribute('y2', '' + (previewPadding * squish));\r\n            }\r\n        };\r\n\r\n        const row1 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'start',\r\n            },\r\n        });\r\n\r\n        const shapeOptions = new Options({\r\n            optionArr: [\r\n                {\r\n                    id: 'rect-stroke',\r\n                    label: rectStrokeSvg,\r\n                    title: LANG('shape-rect') + ' ' + LANG('shape-stroke'),\r\n                },\r\n                {\r\n                    id: 'ellipse-stroke',\r\n                    label: ellipseStrokeSvg,\r\n                    title: LANG('shape-ellipse') + ' ' + LANG('shape-stroke'),\r\n                },\r\n                {\r\n                    id: 'line',\r\n                    label: lineSvg,\r\n                    title: LANG('shape-line'),\r\n                },\r\n                {\r\n                    id: 'rect-fill',\r\n                    label: rectFilledSvg,\r\n                    title: LANG('shape-rect') + ' ' + LANG('shape-fill'),\r\n                },\r\n                {\r\n                    id: 'ellipse-fill',\r\n                    label: ellipseFilledSvg,\r\n                    title: LANG('shape-ellipse') + ' ' + LANG('shape-fill'),\r\n                },\r\n            ],\r\n            initId: this.shape + ' ' + this.mode,\r\n            onChange: (id) => {\r\n                const split = id.split('-');\r\n                this.shape = split[0] as TShapeToolType;\r\n                this.mode = split[1] as TShapeToolMode;\r\n\r\n                BB.css(this.fixedToggle.getElement(), {\r\n                    display: this.shape === 'line' ? 'none' : '',\r\n                });\r\n                BB.css(this.snapToggle.getElement(), {\r\n                    display: this.shape === 'line' ? '' : 'none',\r\n                });\r\n                BB.css(this.lineWidthSlider.getElement(), {\r\n                    display: (this.shape !== 'line' && this.mode === 'fill') ? 'none' : '',\r\n                });\r\n            },\r\n            changeOnInit: true,\r\n        });\r\n        shapeOptions.getElement().style.width = '120px';\r\n        row1.append(shapeOptions.getElement());\r\n\r\n        this.eraserToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('eraser'),\r\n            callback: () => {\r\n                updatePreviews();\r\n            },\r\n        });\r\n\r\n        this.lockAlphaToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('lock-alpha'),\r\n            title: LANG('lock-alpha-title'),\r\n            doHighlight: true,\r\n        });\r\n        this.lockAlphaToggle.getElement().style.marginTop = '10px';\r\n\r\n        row1.append(BB.el({\r\n            content: [\r\n                this.eraserToggle.getElement(),\r\n                this.lockAlphaToggle.getElement(),\r\n            ],\r\n        }));\r\n\r\n        this.lineWidthSlider = new KlSlider({\r\n            label: LANG('shape-line-width'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1,\r\n            max: 200,\r\n            value: 4,\r\n            curve: 'quadratic',\r\n            onChange: () => {\r\n                updatePreviews();\r\n            },\r\n        });\r\n        BB.css(this.lineWidthSlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(this.lineWidthSlider.getElement());\r\n\r\n        this.opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: 1,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n        });\r\n        BB.css(this.opacitySlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(this.opacitySlider.getElement());\r\n\r\n        const row2 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        this.outwardsToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('shape-outwards'),\r\n            css: {\r\n                width: '50%',\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n        row2.append(this.outwardsToggle.getElement());\r\n\r\n        this.fixedToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('shape-fixed'),\r\n            callback: () => {\r\n                updatePreviews();\r\n            },\r\n            css: {\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n        row2.append(this.fixedToggle.getElement());\r\n\r\n        this.snapToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('angle-snap'),\r\n            title: LANG('angle-snap-title'),\r\n            callback: () => {\r\n                updatePreviews();\r\n            },\r\n            css: {\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n        row2.append(this.snapToggle.getElement());\r\n\r\n\r\n        updatePreviews();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (pIsVisible: boolean): void {\r\n        this.isVisible = !!pIsVisible;\r\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\r\n        if (this.isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement());\r\n            this.colorDiv.append(this.colorSlider.getOutputElement());\r\n            //update();\r\n        }\r\n    }\r\n\r\n    getShape (): TShapeToolType {\r\n        return this.shape;\r\n    }\r\n\r\n    getMode (): TShapeToolMode {\r\n        return this.mode;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.eraserToggle.getValue();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacitySlider.getValue();\r\n    }\r\n\r\n    getLineWidth (): number {\r\n        return this.lineWidthSlider.getValue();\r\n    }\r\n\r\n    getIsOutwards (): boolean {\r\n        return this.outwardsToggle.getValue();\r\n    }\r\n\r\n    getIsFixed (): boolean {\r\n        return this.fixedToggle.getValue();\r\n    }\r\n\r\n    getIsSnap (): boolean {\r\n        return this.snapToggle.getValue();\r\n    }\r\n\r\n    getDoLockAlpha (): boolean {\r\n        return this.lockAlphaToggle.getValue();\r\n    }\r\n}\r\n","import {BB} from '../../../bb/bb';\r\nimport {Select} from '../components/select';\r\nimport {ColorOptions} from '../components/color-options';\r\nimport {showModal} from './base/showModal';\r\nimport {LANG} from '../../../language/language';\r\nimport {IRGB, IRGBA} from '../../kl-types';\r\nimport {ISize2D} from '../../../bb/bb-types';\r\nimport {table} from '../components/table';\r\nimport {ERASE_COLOR} from '../../brushes/erase-color';\r\nimport {theme} from '../../../theme/theme';\r\n\r\nexport function newImageDialog (\r\n    p: {\r\n        currentColor: IRGB; // current color\r\n        secondaryColor: IRGB;\r\n        maxCanvasSize: number;\r\n        canvasWidth: number; // current canvas size\r\n        canvasHeight: number; // current canvas size\r\n        workspaceWidth: number;\r\n        workspaceHeight: number;\r\n        onConfirm: (width: number, height: number, color: IRGBA) => void;\r\n        onCancel: () => void;\r\n    }\r\n): void {\r\n\r\n    const currentColor = p.currentColor;\r\n    const secondaryColor = p.secondaryColor;\r\n    const maxCanvasSize = p.maxCanvasSize;\r\n    const canvasWidth = p.canvasWidth;\r\n    const canvasHeight = p.canvasHeight;\r\n    const workspaceWidth = p.workspaceWidth;\r\n    const workspaceHeight = p.workspaceHeight;\r\n    const onConfirm = p.onConfirm;\r\n    const onCancel = p.onCancel;\r\n\r\n    function createRatioSize (ratioX: number, ratioY: number, width: number, height: number, padding: number): ISize2D {\r\n        return BB.fitInto(\r\n            ratioX,\r\n            ratioY,\r\n            Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding),\r\n            1\r\n        );\r\n    }\r\n\r\n    const newImDiv = BB.el();\r\n    const widthInput = BB.el({tagName: 'input'}) as HTMLInputElement;\r\n    const unitStyle = {\r\n        color: '#888',\r\n        fontSize: '12px',\r\n        marginLeft: '5px',\r\n    };\r\n    const widthUnit = BB.el({\r\n        textContent: LANG('new-px'),\r\n        css: unitStyle,\r\n    });\r\n    const heightInput = BB.el({tagName: 'input'}) as HTMLInputElement;\r\n    const heightUnit = BB.el({\r\n        textContent: LANG('new-px'),\r\n        css: unitStyle,\r\n    });\r\n\r\n    widthInput.setAttribute('data-ignore-focus', 'true');\r\n    heightInput.setAttribute('data-ignore-focus', 'true');\r\n\r\n    widthInput.type = 'number';\r\n    widthInput.min = '1';\r\n    widthInput.max = '' + maxCanvasSize;\r\n    BB.css(widthInput, {\r\n        width: '70px',\r\n    });\r\n\r\n    heightInput.type = 'number';\r\n    heightInput.min = '1';\r\n    heightInput.max = '' + maxCanvasSize;\r\n    heightInput.style.width = '70px';\r\n    widthInput.value = '' + canvasWidth;\r\n    heightInput.value = '' + canvasHeight;\r\n    widthInput.onclick = () => {\r\n        widthInput.focus();\r\n        updateRatio();\r\n    };\r\n    heightInput.onclick = () => {\r\n        heightInput.focus();\r\n        updateRatio();\r\n    };\r\n\r\n\r\n    const sizeTable = table([\r\n        [\r\n            LANG('width') + ':&nbsp;',\r\n            widthInput,\r\n            widthUnit,\r\n        ],\r\n        [\r\n            BB.el({css: {height: '5px'}}),\r\n            '',\r\n            '',\r\n        ],\r\n        [\r\n            LANG('height') + ':&nbsp;',\r\n            heightInput,\r\n            heightUnit,\r\n        ],\r\n    ]);\r\n    BB.css(sizeTable, {\r\n        marginBottom: '10px',\r\n    });\r\n\r\n\r\n    const ratioWrapper = BB.el({\r\n        css: {\r\n            marginTop: '5px',\r\n            color: '#888',\r\n        },\r\n    });\r\n\r\n    const templateWrapper = BB.el();\r\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\r\n    const presetFitBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n    templateWrapper.style.marginBottom = '10px';\r\n    const presetCurrentBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n    const presetSquareBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n    const presetLandscapeBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n    const presetPortraitBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n    const presetOversizeBtn = BB.el({tagName: 'button'}) as HTMLButtonElement;\r\n\r\n    presetCurrentBtn.textContent = LANG('new-current');\r\n    presetFitBtn.textContent = LANG('new-fit');\r\n    presetOversizeBtn.textContent = LANG('new-oversize');\r\n    presetLandscapeBtn.textContent = LANG('new-landscape');\r\n    presetPortraitBtn.textContent = LANG('new-portrait');\r\n    presetSquareBtn.textContent = LANG('new-square');\r\n\r\n    presetCurrentBtn.style.marginRight = '5px';\r\n    presetFitBtn.style.marginRight = '5px';\r\n    presetOversizeBtn.style.marginRight = '5px';\r\n    presetLandscapeBtn.style.marginTop = '5px';\r\n    presetLandscapeBtn.style.marginRight = '5px';\r\n    presetPortraitBtn.style.marginTop = '5px';\r\n    presetPortraitBtn.style.marginRight = '5px';\r\n\r\n    templateWrapper.append(\r\n        presetCurrentBtn,\r\n        presetFitBtn,\r\n        presetOversizeBtn,\r\n        presetSquareBtn,\r\n        presetLandscapeBtn,\r\n        presetPortraitBtn\r\n    );\r\n\r\n    const templatePadding = 0;\r\n\r\n    presetCurrentBtn.onclick = function () {\r\n        widthInput.value = '' + canvasWidth;\r\n        heightInput.value = '' + canvasHeight;\r\n        updateRatio();\r\n    };\r\n    presetFitBtn.onclick = function () {\r\n        widthInput.value = '' + workspaceWidth;\r\n        heightInput.value = '' + workspaceHeight;\r\n        updateRatio();\r\n    };\r\n    presetOversizeBtn.onclick = function () {\r\n        widthInput.value = '' + (workspaceWidth + 500);\r\n        heightInput.value = '' + (workspaceHeight + 500);\r\n        updateRatio();\r\n    };\r\n    presetSquareBtn.onclick = function () {\r\n        const sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetLandscapeBtn.onclick = function () {\r\n        const sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n    presetPortraitBtn.onclick = function () {\r\n        const sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\r\n        widthInput.value = '' + Math.round(sizeObj.width);\r\n        heightInput.value = '' + Math.round(sizeObj.height);\r\n        updateRatio();\r\n    };\r\n\r\n    const select = new Select({\r\n        isFocusable: true,\r\n        optionArr: [\r\n            ['screen', LANG('new-screen')],\r\n            ['16 9', LANG('new-video') + ' 16:9'],\r\n            ['3 2', '3:2'],\r\n            ['5 3', '5:3'],\r\n            ['2 1', '2:1'],\r\n            ['paper', LANG('new-din-paper') + ' 2:1'],\r\n            ['9 16', '9:16'],\r\n            ['2 3', '2:3'],\r\n            ['3 5', '3:5'],\r\n            ['1 2', '1:2'],\r\n            ['1 1.4142135623730951', '1:2'],\r\n        ],\r\n        onChange: function (val) {\r\n            if (val === 'screen') {\r\n                widthInput.value = '' + window.screen.width;\r\n                heightInput.value = '' + window.screen.height;\r\n            } else if (val === 'paper') {\r\n                const sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            } else {\r\n                const split = val.split(' ');\r\n                const sizeObj = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\r\n                widthInput.value = '' + Math.round(sizeObj.width);\r\n                heightInput.value = '' + Math.round(sizeObj.height);\r\n            }\r\n            updateRatio();\r\n            select.setValue(null);\r\n        },\r\n    });\r\n    setTimeout(() => {\r\n        // safari: not empty without also setting it to null via timeout\r\n        select.setValue(null);\r\n    }, 0);\r\n    BB.css(select.getElement(), {\r\n        width: '80px',\r\n    });\r\n    templateWrapper.append(select.getElement());\r\n\r\n\r\n\r\n    let backgroundRGBA = {r: 255, g: 255, b: 255, a: 1};\r\n\r\n    const colorOptionsArr = [\r\n        {r: 255, g: 255, b: 255, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 0, g: 0, b: 0, a: 0},\r\n        {\r\n            r: currentColor.r,\r\n            g: currentColor.g,\r\n            b: currentColor.b,\r\n            a: 1,\r\n        },\r\n        {\r\n            r: secondaryColor.r,\r\n            g: secondaryColor.g,\r\n            b: secondaryColor.b,\r\n            a: 1,\r\n        },\r\n    ];\r\n    let initColorIndex = 0;\r\n    if (theme.isDark()) {\r\n        colorOptionsArr.forEach((item, index) => {\r\n            if (item.r === ERASE_COLOR && item.g === ERASE_COLOR && item.b === ERASE_COLOR) {\r\n                initColorIndex = index;\r\n                backgroundRGBA = item;\r\n            }\r\n        });\r\n    }\r\n\r\n    const colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        initialIndex: initColorIndex,\r\n        onChange: function (rgbaObj) {\r\n            backgroundRGBA = rgbaObj;\r\n            preview.style.backgroundColor = 'rgba(' + rgbaObj.r + ',' + rgbaObj.g + ',' + rgbaObj.b + ', ' + rgbaObj.a + ')';\r\n        },\r\n    });\r\n\r\n    const previewWrapper = BB.el({\r\n        className: 'kl-transparent-preview',\r\n        css: {\r\n            boxSizing: 'border-box',\r\n            width: '340px',\r\n            height: '140px',\r\n            display: 'table',\r\n            padding: '10px',\r\n            marginTop: '10px',\r\n            marginLeft: '-20px',\r\n        },\r\n    });\r\n    const preview = BB.el({\r\n        className: 'kl-transparent-preview__canvas',\r\n        css: {\r\n            width: 200 + 'px',\r\n            height: 100 + 'px',\r\n            backgroundColor: 'rgba(' + backgroundRGBA.r + ',' + backgroundRGBA.g + ',' + backgroundRGBA.b + ', ' + backgroundRGBA.a + ')',\r\n            marginLeft: 'auto',\r\n            marginRight: 'auto',\r\n            color: '#aaa',\r\n            fontSize: '16px',\r\n            fontWeight: 'bold',\r\n            textAlign: 'center',\r\n            verticalAlign: 'center',\r\n            display: 'table',\r\n            overflow: 'hidden',\r\n        },\r\n    });\r\n    const previewcell = BB.el({\r\n        parent: previewWrapper,\r\n        content: preview,\r\n        css: {\r\n            display: 'table-cell',\r\n            verticalAlign: 'middle',\r\n        },\r\n    });\r\n    const cell = BB.el({\r\n        parent: preview,\r\n        css: {\r\n            display: 'table-cell',\r\n            verticalAlign: 'middle',\r\n        },\r\n    });\r\n\r\n    function updateRatio () {\r\n        widthInput.value = '' + Math.min(maxCanvasSize, parseInt(widthInput.value));\r\n        heightInput.value = '' + Math.min(maxCanvasSize, parseInt(heightInput.value));\r\n\r\n        function hcf (u: number, v: number): number {\r\n            let U = u, V = v;\r\n            while (true) {\r\n                if (!(U %= V)) {\r\n                    return V;\r\n                }\r\n                if (!(V %= U)) {\r\n                    return U;\r\n                }\r\n            }\r\n        }\r\n\r\n        let w = parseInt(widthInput.value);\r\n        let h = parseInt(heightInput.value);\r\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\r\n            if (w > maxCanvasSize) {\r\n                w = maxCanvasSize;\r\n            } else if (h > maxCanvasSize) {\r\n                h = maxCanvasSize;\r\n            }\r\n\r\n            widthInput.value = '' + w;\r\n            heightInput.value = '' + h;\r\n        }\r\n\r\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\r\n        const commonRatios = [\r\n            [1, 2], [2, 1],\r\n            [2, 3], [3, 2],\r\n            [3, 4], [4, 3],\r\n            [4, 5], [5, 4],\r\n            [16, 9], [9, 16],\r\n            [3, 2], [2, 3],\r\n            [5, 3], [3, 5],\r\n            [2, 1], [1, 2],\r\n            [1.414, 1], [1, 1.414],\r\n        ];\r\n        const reducedArr = BB.reduce(w, h);\r\n        let closestRatio = null;\r\n        let closestDistance = null;\r\n        for (let i = 0; i < commonRatios.length; i++) {\r\n            if (i === 0 || Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\r\n                closestRatio = commonRatios[i];\r\n                closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\r\n            }\r\n        }\r\n        //display ratio\r\n        if (closestDistance > 0 && closestDistance < 0.005) {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ~' + closestRatio[0] + ':' + closestRatio[1];\r\n        } else {\r\n            ratioWrapper.innerText = LANG('new-ratio') + ': ' + reducedArr[0] + ':' + reducedArr[1];\r\n        }\r\n\r\n        const realw = w;\r\n        const T = hcf(w, h);\r\n        w /= T;\r\n        h /= T;\r\n        w *= 260;\r\n        h *= 260;\r\n        if (w > 260) {\r\n            h = 260 / w * h;\r\n            w = 260;\r\n        }\r\n        if (h > 100) {\r\n            w = 100 / h * w;\r\n            h = 100;\r\n\r\n        }\r\n\r\n        preview.style.width = w + 'px';\r\n        preview.style.height = h + 'px';\r\n        BB.createCheckerDataUrl(parseInt('' + (30 * (w / realw))), function (url) {\r\n            previewWrapper.style.background = 'url(' + url + ')';\r\n        }, theme.isDark());\r\n    }\r\n    theme.addIsDarkListener(updateRatio);\r\n\r\n    widthInput.onchange = function () {\r\n        if (widthInput.value === '' || parseInt(widthInput.value) < 0) {\r\n            widthInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    widthInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    heightInput.onchange = function () {\r\n        if (heightInput.value === '' || parseFloat(heightInput.value) < 0) {\r\n            heightInput.value = '1';\r\n        }\r\n        updateRatio();\r\n    };\r\n    heightInput.onkeyup = function () {\r\n        updateRatio();\r\n    };\r\n    updateRatio();\r\n\r\n    newImDiv.append(templateWrapper);\r\n    const secondRow = BB.el({\r\n        parent: newImDiv,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'flex-end',\r\n        },\r\n    });\r\n    const secondRowLeft = BB.el({\r\n        parent: secondRow,\r\n    });\r\n    secondRowLeft.append(sizeTable, ratioWrapper);\r\n    secondRow.append(colorOptions.getElement());\r\n\r\n    newImDiv.append(previewWrapper);\r\n\r\n    showModal({\r\n        target: document.body,\r\n        message: `<b>${LANG('new-title')}</b>`,\r\n        div: newImDiv,\r\n        buttons: ['Ok', 'Cancel'],\r\n        callback: function (result) {\r\n            widthInput.onclick = null;\r\n            heightInput.onclick = null;\r\n            presetCurrentBtn.onclick = null;\r\n            presetFitBtn.onclick = null;\r\n            presetOversizeBtn.onclick = null;\r\n            presetSquareBtn.onclick = null;\r\n            presetLandscapeBtn.onclick = null;\r\n            presetPortraitBtn.onclick = null;\r\n            widthInput.onchange = null;\r\n            widthInput.onkeyup = null;\r\n            heightInput.onchange = null;\r\n            heightInput.onkeyup = null;\r\n            select.destroy();\r\n            colorOptions.destroy();\r\n            theme.removeIsDarkListener(updateRatio);\r\n\r\n            if (\r\n                result === 'Cancel'\r\n                || parseInt(widthInput.value) <= 0\r\n                || parseInt(heightInput.value) <= 0\r\n                || isNaN(parseInt(widthInput.value))\r\n                || isNaN(parseInt(heightInput.value))\r\n            ) {\r\n                onCancel();\r\n                return;\r\n            }\r\n            onConfirm(\r\n                parseInt(widthInput.value),\r\n                parseInt(heightInput.value),\r\n                backgroundRGBA\r\n            );\r\n        },\r\n        clickOnEnter: 'Ok',\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nexport function table (\r\n    data: (HTMLElement | string)[][],\r\n    cellProps?: Record<string, {rowspan: number}>, // {'0.2': {...}} -> row 1, col 3\r\n): HTMLElement {\r\n    const result = BB.el({\r\n        tagName: 'table',\r\n        className: 'kl-table',\r\n    });\r\n    data.forEach((row, rowIndex) => {\r\n        const rowEl = BB.el({\r\n            tagName: 'tr',\r\n        });\r\n        rowEl.append(...row.map((el, colIndex) => {\r\n            const cellEl = BB.el({\r\n                tagName: 'td',\r\n                content: el,\r\n            }) as HTMLTableCellElement;\r\n\r\n            const key = rowIndex + '.' + colIndex;\r\n            if (cellProps !== undefined && key in cellProps) {\r\n                cellEl.rowSpan = cellProps[key].rowspan;\r\n            }\r\n\r\n            return cellEl;\r\n        }));\r\n        result.append(rowEl);\r\n    });\r\n    return result;\r\n}","import {BB} from '../../../bb/bb';\r\nimport collapseImg from '/src/app/img/ui/ui-collapse.svg';\r\nimport {LANG} from '../../../language/language';\r\nimport {TUiLayout} from '../../kl-types';\r\n\r\n/**\r\n * button that allows to collapse toolspace (for mobile)\r\n */\r\nexport class ToolspaceCollapser {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private directionStr: TUiLayout;\r\n    private readonly icon: HTMLElement;\r\n    private stateIsOpen: boolean;\r\n\r\n\r\n    private update (): void {\r\n        if (this.directionStr === 'left') {\r\n            this.icon.style.transform = this.stateIsOpen ? 'rotate(180deg)' : '';\r\n        } else {\r\n            this.icon.style.transform = this.stateIsOpen ? '' : 'rotate(180deg)';\r\n        }\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            onChange: () => void;\r\n        }\r\n    ) {\r\n        this.stateIsOpen = true;\r\n        this.directionStr = 'right';\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-toolspace-toggle',\r\n            css: {\r\n                width: '36px',\r\n                height: '36px',\r\n                background: 'rgba(100, 100, 100, 0.9)',\r\n                color: '#fff',\r\n                position: 'absolute',\r\n                top: '0',\r\n                textAlign: 'center',\r\n                lineHeight: '36px',\r\n                cursor: 'pointer',\r\n                userSelect: 'none',\r\n                padding: '6px',\r\n                boxSizing: 'border-box',\r\n            },\r\n            title: LANG('toggle-show-tools'),\r\n            onClick: (e) => {\r\n                e.preventDefault();\r\n                this.stateIsOpen = !this.stateIsOpen;\r\n                this.update();\r\n                p.onChange();\r\n            },\r\n        });\r\n\r\n        this.icon = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                backgroundImage: `url(${collapseImg})`,\r\n                width: '100%',\r\n                height: '100%',\r\n                backgroundSize: 'contain',\r\n                backgroundRepeat: 'no-repeat',\r\n                backgroundPosition: 'center',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = () => {\r\n            return false;\r\n        };\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    isOpen (): boolean {\r\n        return this.stateIsOpen;\r\n    }\r\n\r\n    setDirection (dirStr: TUiLayout): void {\r\n        this.directionStr = dirStr;\r\n        this.update();\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"8K12o\");","import {BB} from '../../../bb/bb';\r\nimport {renderText} from '../../image-operations/render-text';\r\nimport {ColorOptions} from '../components/color-options';\r\nimport {Select} from '../components/select';\r\nimport {ImageRadioList} from '../components/image-radio-list';\r\nimport {ImageToggle} from '../components/image-toggle';\r\nimport {KlSlider} from '../components/kl-slider';\r\nimport {showModal} from './base/showModal';\r\nimport alignLeftImg from '/src/app/img/ui/align-left.svg';\r\nimport alignCenterImg from '/src/app/img/ui/align-center.svg';\r\nimport alignRightImg from '/src/app/img/ui/align-right.svg';\r\nimport typoItalicImg from '/src/app/img/ui/typo-italic.svg';\r\nimport typoBoldImg from '/src/app/img/ui/typo-bold.svg';\r\nimport toolZoomInImg from '/src/app/img/ui/tool-zoom-in.svg';\r\nimport toolZoomOutImg from '/src/app/img/ui/tool-zoom-out.svg';\r\nimport {IRGB} from '../../kl-types';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\nimport { throwIfNull} from '../../../bb/base/base';\r\nimport {theme} from '../../../theme/theme';\r\n\r\n\r\ntype TTextFormat = 'left' | 'center' | 'right';\r\ntype TTextFont = 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy';\r\n\r\nexport type TTextToolResult = {\r\n    x: number;\r\n    y: number;\r\n    textStr: string;\r\n    align: TTextFormat;\r\n    isItalic: boolean;\r\n    isBold: boolean;\r\n    color: IRGB;\r\n    size: number; // px\r\n    font: TTextFont;\r\n    opacity: number;\r\n};\r\n\r\n/**\r\n * Text Tool dialog\r\n */\r\nexport function textToolDialog (\r\n    p: {\r\n        klCanvas: KlCanvas;\r\n        layerIndex: number;\r\n        x: number;\r\n        y: number;\r\n        angleRad: number;\r\n        color: IRGB;\r\n        secondaryColor: IRGB;\r\n        size: number; // px\r\n        align: TTextFormat; // default 'left'\r\n        isBold: boolean; // default false\r\n        isItalic: boolean; // default false\r\n        font: TTextFont; // default sans-serif\r\n        opacity: number; // [0, 1] default 1\r\n        onConfirm: (confirmP: TTextToolResult) => void;\r\n    }\r\n): void {\r\n\r\n    const div = BB.el();\r\n\r\n    const isSmallWidth = window.innerWidth < 550;\r\n    const isSmallHeight = window.innerHeight < 630;\r\n\r\n    // --- preview ---\r\n    // Text drawn on klCanvas-sized canvas: textCanvas\r\n    // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\r\n    //      they are transformed. canvas size of final preview\r\n    // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\r\n    // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\r\n\r\n    const width = isSmallWidth ? 340 : 540;\r\n    const height = isSmallWidth ? (isSmallHeight ? 210 : 260) : (isSmallHeight ? 230 : 350);\r\n    let scale = 1;\r\n\r\n    const layerArr = p.klCanvas.getLayersFast();\r\n    const textCanvas = BB.canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\r\n    const textCtx = BB.ctx(textCanvas);\r\n    const targetCanvas = BB.canvas(width, height);\r\n    const targetCtx = BB.ctx(targetCanvas);\r\n    const layersCanvas = BB.canvas(width, height);\r\n    const layersCtx = BB.ctx(layersCanvas);\r\n    const previewCanvas = BB.canvas(width, height); // the one that is visible\r\n    const previewCtx = BB.ctx(previewCanvas);\r\n    BB.css(previewCanvas, {\r\n        display: 'block',\r\n    });\r\n    const previewWrapper = BB.el({\r\n        parent: div,\r\n        css: {\r\n            position: 'relative',\r\n            width: width + 'px',\r\n            marginLeft: '-20px',\r\n            cursor: 'move',\r\n            touchAction: 'none',\r\n        },\r\n        onClick: () => textInput.focus(),\r\n    });\r\n    BB.el({ // inset shadow on preview\r\n        parent: previewWrapper,\r\n        className: 'kl-text-preview-wrapper',\r\n    });\r\n    previewWrapper.append(previewCanvas);\r\n    let checkerPattern = throwIfNull(previewCtx.createPattern(BB.createCheckerCanvas(8, theme.isDark()), 'repeat'));\r\n    const emptyCanvas = BB.canvas(1, 1);\r\n    const emptyCanvasLight = BB.canvas(1, 1);\r\n    {\r\n        let ctx = BB.ctx(emptyCanvas);\r\n        ctx.fillRect(0, 0, 1, 1);\r\n\r\n        ctx = BB.ctx(emptyCanvasLight);\r\n        ctx.fillStyle = '#fff';\r\n        ctx.fillRect(0, 0, 1, 1);\r\n    }\r\n\r\n    function updateCheckerboard (): void {\r\n        checkerPattern = throwIfNull(previewCtx.createPattern(BB.createCheckerCanvas(8, theme.isDark()), 'repeat'));\r\n        updatePreview();\r\n    }\r\n    theme.addIsDarkListener(updateCheckerboard);\r\n\r\n    function updatePreview (): void {\r\n\r\n        // try to draw very much like klCanvasWorkspace\r\n\r\n        // --- draw text ---\r\n        textCtx.clearRect(0, 0, textCanvas.width, textCanvas.height);\r\n        const colorRGBA = {\r\n            ...p.color,\r\n            a: opacitySlider.getValue(),\r\n        };\r\n        const bounds = renderText(textCanvas, {\r\n            x: p.x,\r\n            y: p.y,\r\n            textStr: textInput.value,\r\n            align: alignRadioList.getValue(),\r\n            isItalic: italicToggle.getValue(),\r\n            isBold: boldToggle.getValue(),\r\n            size: parseFloat(sizeInput.value),\r\n            font: fontSelect.getValue(),\r\n            color: BB.ColorConverter.toRgbaStr(colorRGBA),\r\n            angleRad: p.angleRad,\r\n        });\r\n\r\n\r\n        // --- determine transformation of viewport ---\r\n        // text should always be visible\r\n        bounds.width = Math.max(bounds.width, 1);\r\n        bounds.height = Math.max(bounds.height, 1);\r\n        const rotatedXY = BB.rotate(bounds.x, bounds.y, -p.angleRad / Math.PI * 180);\r\n        const rotatedWH = BB.rotate(bounds.width, bounds.height, -p.angleRad / Math.PI * 180);\r\n        const centerX = p.x + rotatedXY.x + rotatedWH.x / 2;\r\n        const centerY = p.y + rotatedXY.y + rotatedWH.y / 2;\r\n\r\n        const padding = 100;\r\n        const fitBounds = BB.fitInto(bounds.width, bounds.height, width - padding, height - padding);\r\n        scale = Math.min(1, fitBounds.width / bounds.width);\r\n        scale = Math.min(4, scale * Math.pow(2, zoomFac));\r\n\r\n\r\n        // --- compose text and target layer ---\r\n        targetCtx.save();\r\n\r\n        if (scale >= 4) {\r\n            targetCtx.imageSmoothingEnabled = false;\r\n        } else {\r\n            targetCtx.imageSmoothingEnabled = true;\r\n            targetCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n        }\r\n\r\n        targetCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        targetCtx.translate(width / 2, height / 2);\r\n        targetCtx.scale(scale, scale);\r\n        targetCtx.rotate(p.angleRad);\r\n        targetCtx.drawImage(layerArr[p.layerIndex].canvas, -centerX, -centerY);\r\n        targetCtx.drawImage(textCanvas, -centerX, -centerY);\r\n        targetCtx.restore();\r\n\r\n        const isDark = theme.isDark();\r\n\r\n        // --- layers ---\r\n        layersCtx.save();\r\n\r\n        layersCtx.fillStyle = isDark ? 'rgb(33,33,33)' : 'rgb(158,158,158)';\r\n        layersCtx.fillRect(0, 0, width, height);\r\n\r\n        { // bg\r\n            layersCtx.save();\r\n\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n\r\n            layersCtx.imageSmoothingEnabled = false;\r\n\r\n            //outline\r\n            const borderSize = 1 / scale;\r\n            layersCtx.globalAlpha = isDark ? 0.25 : 0.2;\r\n            layersCtx.drawImage(isDark ? emptyCanvasLight : emptyCanvas, -centerX - borderSize, -centerY - borderSize, textCanvas.width + borderSize * 2, textCanvas.height + borderSize * 2);\r\n            layersCtx.globalAlpha = 1;\r\n\r\n            //erase\r\n            layersCtx.globalCompositeOperation = 'destination-out';\r\n            layersCtx.drawImage(emptyCanvas, -centerX, -centerY, textCanvas.width, textCanvas.height);\r\n\r\n            layersCtx.restore();\r\n        }\r\n\r\n        { // individual layers\r\n\r\n            if (scale >= 4) {\r\n                layersCtx.imageSmoothingEnabled = false;\r\n            } else {\r\n                layersCtx.imageSmoothingEnabled = true;\r\n                layersCtx.imageSmoothingQuality  = scale >= 1 ? 'low' : 'medium';\r\n            }\r\n\r\n            // layers below\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (let i = 0; i < p.layerIndex; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n            // target layer\r\n            layersCtx.globalAlpha = layerArr[p.layerIndex].opacity;\r\n            layersCtx.globalCompositeOperation = layerArr[p.layerIndex].mixModeStr;\r\n            layersCtx.drawImage(targetCanvas, 0, 0);\r\n\r\n            // layers above\r\n            layersCtx.save();\r\n            layersCtx.translate(width / 2, height / 2);\r\n            layersCtx.scale(scale, scale);\r\n            layersCtx.rotate(p.angleRad);\r\n            for (let i = p.layerIndex + 1; i < layerArr.length; i++) {\r\n                if (layerArr[i].opacity > 0) {\r\n                    layersCtx.globalAlpha = layerArr[i].opacity;\r\n                    layersCtx.globalCompositeOperation = layerArr[i].mixModeStr;\r\n                    layersCtx.drawImage(layerArr[i].canvas, -centerX, -centerY);\r\n                }\r\n            }\r\n            layersCtx.restore();\r\n\r\n        }\r\n\r\n        layersCtx.restore();\r\n\r\n\r\n\r\n        // --- final composite ---\r\n        previewCtx.save();\r\n        previewCtx.fillStyle = checkerPattern;\r\n        previewCtx.fillRect(0, 0, previewCanvas.width, previewCanvas.height);\r\n        previewCtx.drawImage(layersCanvas, 0, 0);\r\n        previewCtx.restore();\r\n\r\n        // bounds\r\n        previewCtx.save();\r\n        previewCtx.globalCompositeOperation = 'difference';\r\n        previewCtx.strokeStyle = '#fff';\r\n        previewCtx.lineWidth = 1;\r\n        // centerX = p.x + bounds.x + bounds.width / 2;\r\n        // centerY = p.y + bounds.y + bounds.height / 2;\r\n        previewCtx.strokeRect(\r\n            Math.round(width / 2 - (bounds.width / 2) * scale),\r\n            Math.round(height / 2 - (bounds.height / 2) * scale),\r\n            Math.round(bounds.width * scale),\r\n            Math.round(bounds.height * scale)\r\n        );\r\n        previewCtx.restore();\r\n\r\n    }\r\n\r\n    theme.addIsDarkListener(updatePreview);\r\n\r\n    /**\r\n     * Move text by x y\r\n     */\r\n    function move (x: number, y: number): void {\r\n        const rotated = BB.rotate(x, y, -p.angleRad / Math.PI * 180);\r\n        p.x += rotated.x / scale;\r\n        p.y += rotated.y / scale;\r\n        updatePreview();\r\n    }\r\n\r\n    const previewPointerListener = new BB.PointerListener({\r\n        target: previewCanvas,\r\n        onPointer: (e) => {\r\n            if (e.type === 'pointermove' && e.button) {\r\n                e.eventPreventDefault();\r\n                move(-e.dX, -e.dY);\r\n            }\r\n        },\r\n        onWheel: (e) => {\r\n            changeZoomFac(-e.deltaY);\r\n        },\r\n    });\r\n\r\n    const wheelPrevent = (event: WheelEvent): void => event.preventDefault();\r\n    previewCanvas.addEventListener('wheel', wheelPrevent);\r\n\r\n\r\n\r\n    const row1 = BB.el({\r\n        parent: div,\r\n        css: {\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            marginTop: '10px',\r\n        },\r\n    });\r\n    const row2n3Wrapper = BB.el({\r\n        parent: div,\r\n        css: isSmallWidth ? {} : {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n        },\r\n    });\r\n    const row2 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            marginTop: '5px',\r\n        },\r\n    });\r\n    const row3 = BB.el({\r\n        parent: row2n3Wrapper,\r\n        css: {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n            marginTop: '5px',\r\n            width: isSmallWidth ? '' : '300px',\r\n        },\r\n    });\r\n\r\n    // --- row 1 ---\r\n\r\n    // color\r\n    const colorOptionsArr = [\r\n        {r: 0, g: 0, b: 0, a: 1},\r\n        {r: 255, g: 255, b: 255, a: 1},\r\n    ];\r\n    colorOptionsArr.unshift({\r\n        r: p.secondaryColor.r,\r\n        g: p.secondaryColor.g,\r\n        b: p.secondaryColor.b,\r\n        a: 1,\r\n    });\r\n    colorOptionsArr.unshift({\r\n        r: p.color.r,\r\n        g: p.color.g,\r\n        b: p.color.b,\r\n        a: 1,\r\n    });\r\n\r\n    const colorOptions = new ColorOptions({\r\n        colorArr: colorOptionsArr,\r\n        initialIndex: 0,\r\n        onChange: (rgbaObj) => {\r\n            p.color = rgbaObj;\r\n            updatePreview();\r\n        },\r\n    });\r\n    colorOptions.getElement().title = LANG('text-color');\r\n    colorOptions.getElement().style.marginLeft = '-5px';\r\n    row1.append(colorOptions.getElement());\r\n\r\n\r\n    let zoomFac = 0;\r\n\r\n    function changeZoomFac (d: number): void {\r\n        zoomFac = Math.min(2, Math.max(-2, zoomFac + d));\r\n        updatePreview();\r\n        zoomInBtn.disabled = !canZoom(1);\r\n        zoomOutBtn.disabled = !canZoom(-1);\r\n    }\r\n\r\n    function canZoom (d: number): boolean {\r\n        return zoomFac !== Math.min(2, Math.max(-2, zoomFac + d));\r\n    }\r\n\r\n    const zoomWrapper = BB.el({\r\n        parent: row1,\r\n    });\r\n\r\n    const zoomInBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomInImg}\">`,\r\n        title: LANG('zoom-in'),\r\n        tagName: 'button',\r\n        onClick: () => changeZoomFac(1),\r\n        css: {\r\n            fontWeight: 'bold',\r\n        },\r\n    }) as HTMLButtonElement;\r\n    const zoomOutBtn = BB.el({\r\n        parent: zoomWrapper,\r\n        content: `<img height=\"20\" src=\"${toolZoomOutImg}\">`,\r\n        title: LANG('zoom-out'),\r\n        tagName: 'button',\r\n        onClick: () => changeZoomFac(-1),\r\n        css: {\r\n            fontWeight: 'bold',\r\n            marginLeft: '5px',\r\n        },\r\n    }) as HTMLButtonElement;\r\n\r\n\r\n\r\n    // --- row 2 ---\r\n    const sizeInput = BB.el({\r\n        parent: row2,\r\n        tagName: 'input',\r\n        title: LANG('text-size'),\r\n        custom: {\r\n            type: 'number',\r\n            min: 1,\r\n            max: 10000,\r\n            value: p.size,\r\n        },\r\n        css: {\r\n            width: '60px',\r\n        },\r\n        onChange: () => {\r\n            sizeInput.value = '' + Math.max(1, Math.min(10000, parseInt(sizeInput.value)));\r\n            updatePreview();\r\n        },\r\n    }) as HTMLInputElement;\r\n    const sizePointerListener = new BB.PointerListener({\r\n        target: sizeInput,\r\n        onWheel: (e) => {\r\n            sizeInput.value = '' + Math.max(1, Math.min(1000, parseInt(sizeInput.value) - e.deltaY));\r\n            updatePreview();\r\n        },\r\n    });\r\n\r\n\r\n    const modeWrapper = BB.el({\r\n        css: {\r\n            fontSize: '15px',\r\n            marginLeft: '10px',\r\n        },\r\n    });\r\n\r\n    const fontSelect = new Select<TTextFont>({\r\n        isFocusable: true,\r\n        optionArr: [\r\n            ['sans-serif', 'Sans-serif'],\r\n            ['serif', 'Serif'],\r\n            ['monospace', 'Monospace'],\r\n            ['cursive', 'Cursive'],\r\n            ['fantasy', 'Fantasy'],\r\n        ],\r\n        initValue: p.font,\r\n        onChange: () => updatePreview(),\r\n    });\r\n\r\n    modeWrapper.append(fontSelect.getElement());\r\n    row2.append(modeWrapper);\r\n\r\n    const fontPointerListener = new BB.PointerListener({\r\n        target: fontSelect.getElement(),\r\n        onWheel: (e) => fontSelect.setDeltaValue(e.deltaY),\r\n    });\r\n\r\n\r\n    // --- row 3 ---\r\n\r\n    const alignRadioList = new ImageRadioList<TTextFormat>({\r\n        optionArr: [\r\n            {\r\n                id: 'left',\r\n                title: LANG('text-left'),\r\n                image: alignLeftImg,\r\n                darkInvert: true,\r\n            },\r\n            {\r\n                id: 'center',\r\n                title: LANG('text-center'),\r\n                image: alignCenterImg,\r\n                darkInvert: true,\r\n            },\r\n            {\r\n                id: 'right',\r\n                title: LANG('text-right'),\r\n                image: alignRightImg,\r\n                darkInvert: true,\r\n            },\r\n        ],\r\n        initId: p.align,\r\n        onChange: () => updatePreview(),\r\n    });\r\n    row3.append(alignRadioList.getElement());\r\n\r\n    const italicToggle = new ImageToggle({\r\n        image: typoItalicImg,\r\n        title: LANG('text-italic'),\r\n        initValue: p.isItalic,\r\n        onChange: () => updatePreview(),\r\n        darkInvert: true,\r\n    });\r\n    row3.append(italicToggle.getElement());\r\n\r\n    const boldToggle = new ImageToggle({\r\n        image: typoBoldImg,\r\n        title: LANG('text-bold'),\r\n        initValue: p.isBold,\r\n        onChange: () => updatePreview(),\r\n        darkInvert: true,\r\n    });\r\n    row3.append(boldToggle.getElement());\r\n\r\n\r\n\r\n    const opacitySlider = new KlSlider({\r\n        label: LANG('opacity'),\r\n        width: 150,\r\n        height: 30,\r\n        min: 1 / 100,\r\n        max: 1,\r\n        value: p.opacity,\r\n        resolution: 225,\r\n        eventResMs: 1000 / 30,\r\n        toValue: (displayValue) => displayValue / 100,\r\n        toDisplayValue: (value) => value * 100,\r\n        onChange: () => updatePreview(),\r\n    });\r\n    row3.append(opacitySlider.getElement());\r\n\r\n\r\n\r\n    const textInput = BB.el({\r\n        parent: div,\r\n        tagName: 'textarea',\r\n        custom: {\r\n            placeholder: LANG('text-placeholder'),\r\n            'data-ignore-focus': 'true',\r\n        },\r\n        css: {\r\n            whiteSpace: 'pre',\r\n            overflow: 'auto',\r\n            width: '100%',\r\n            height: '70px',\r\n            resize: 'vertical',\r\n            marginTop: '10px',\r\n        },\r\n        onChange: () => updatePreview(),\r\n    }) as HTMLTextAreaElement;\r\n    textInput.addEventListener('input', updatePreview);\r\n    setTimeout(() => {\r\n        textInput.focus();\r\n        textInput.select();\r\n    });\r\n    const keyListener = new BB.KeyListener({\r\n        onDown: (keyStr) => {\r\n            if (BB.isInputFocused(true)) {\r\n                return;\r\n            }\r\n            if (keyStr === 'left') {\r\n                move(-1, 0);\r\n            }\r\n            if (keyStr === 'right') {\r\n                move(1, 0);\r\n            }\r\n            if (keyStr === 'up') {\r\n                move(0, -1);\r\n            }\r\n            if (keyStr === 'down') {\r\n                move(0, 1);\r\n            }\r\n        },\r\n    });\r\n\r\n    // prevent mobile keyboards scrolling page\r\n    function onScroll (): void {\r\n        window.scrollTo(0, 0);\r\n    }\r\n    window.addEventListener('scroll', onScroll);\r\n\r\n\r\n    showModal({\r\n        target: document.body,\r\n        message: `<b>${LANG('text-title')}</b>`,\r\n        div: div,\r\n        buttons: ['Ok', 'Cancel'],\r\n        style: isSmallWidth ? {} : {\r\n            width: '500px',\r\n        },\r\n        callback: (val) => {\r\n            const result: TTextToolResult = {\r\n                x: p.x,\r\n                y: p.y,\r\n                textStr: textInput.value,\r\n                align: alignRadioList.getValue(),\r\n                isItalic: italicToggle.getValue(),\r\n                isBold: boldToggle.getValue(),\r\n                color: p.color,\r\n                size: Number(sizeInput.value),\r\n                font: fontSelect.getValue(),\r\n                opacity: opacitySlider.getValue(),\r\n            };\r\n\r\n            theme.removeIsDarkListener(updatePreview);\r\n            window.removeEventListener('scroll', onScroll);\r\n            textInput.removeEventListener('input', updatePreview);\r\n            BB.destroyEl(textInput);\r\n            previewPointerListener.destroy();\r\n            sizePointerListener.destroy();\r\n            fontPointerListener.destroy();\r\n            previewCanvas.removeEventListener('wheel', wheelPrevent);\r\n            BB.destroyEl(previewWrapper);\r\n            BB.destroyEl(zoomInBtn);\r\n            BB.destroyEl(zoomOutBtn);\r\n            BB.destroyEl(sizeInput);\r\n            colorOptions.destroy();\r\n            fontSelect.destroy();\r\n            keyListener.destroy();\r\n            alignRadioList.destroy();\r\n            italicToggle.destroy();\r\n            boldToggle.destroy();\r\n            opacitySlider.destroy();\r\n            theme.removeIsDarkListener(updateCheckerboard);\r\n            if (val === 'Ok') {\r\n                p.onConfirm(result);\r\n            }\r\n        },\r\n        autoFocus: false,\r\n        clickOnEnter: 'Ok',\r\n        ignoreBackground: true,\r\n    });\r\n\r\n    updatePreview();\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"2WSh2\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"lHK8L\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3kjmQ\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"g8nvA\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"axEKL\");","import {BB} from '../../../bb/bb';\r\nimport {CropCopy} from '../components/crop-copy';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {showModal} from './base/showModal';\r\nimport {LANG} from '../../../language/language';\r\nimport {IKeyString, IRect} from '../../../bb/bb-types';\r\nimport {IKlPsd, TKlPsdError} from '../../kl-types';\r\n\r\n/**\r\n * Shows first dialog when importing an image.\r\n * Where you can crop, and select import as layer or as image.\r\n */\r\nexport function showImportImageDialog (\r\n    p: {\r\n        image: IKlPsd | {\r\n            type: 'image';\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLImageElement | HTMLCanvasElement;\r\n        };\r\n        maxSize: number;\r\n        target: HTMLElement;\r\n        callback: (\r\n            val: {\r\n                type: 'as-image' | 'as-layer';\r\n                image: HTMLImageElement | HTMLCanvasElement;\r\n            } | {\r\n                type: 'as-image-psd';\r\n                image: IKlPsd;\r\n                cropObj: IRect;\r\n            } | {\r\n                type: 'cancel';\r\n            }\r\n        ) => void;\r\n    }\r\n): void {\r\n    const rootEl = BB.el();\r\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\r\n    const style: IKeyString = isSmall ? {} : { width: '500px' };\r\n\r\n    const resolutionEl = BB.el({\r\n        css: {\r\n            marginTop: '10px',\r\n            textAlign: 'center',\r\n            color: '#888',\r\n            lineHeight: '20px',\r\n        },\r\n    });\r\n\r\n    const cropCopy = new CropCopy({\r\n        width: isSmall ? 340 : 540,\r\n        height: isSmall ? 300 : 400,\r\n        canvas: p.image.canvas,\r\n        isNotCopy: true,\r\n        onChange: (width, height): void => {\r\n            if (!resolutionEl) {\r\n                return;\r\n            }\r\n            updateResolution(width, height);\r\n        },\r\n    });\r\n    BB.css(cropCopy.getEl(), {\r\n        marginLeft: '-20px',\r\n    });\r\n    cropCopy.getEl().title = LANG('crop-drag-to-crop');\r\n\r\n    rootEl.append(cropCopy.getEl(), resolutionEl);\r\n\r\n    function updateResolution (w: number, h: number): void {\r\n        const fit = BB.fitInto(w, h, p.maxSize, p.maxSize);\r\n\r\n        if (fit.width < w) {\r\n            resolutionEl.innerHTML = `<span class=\"kl-text-error\">${w} X ${h}</span>  ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\r\n            resolutionEl.title = LANG('import-too-large');\r\n        } else {\r\n            resolutionEl.innerHTML = `${w} X ${h}`;\r\n            resolutionEl.title = '';\r\n        }\r\n    }\r\n    updateResolution(p.image.width, p.image.height);\r\n\r\n\r\n    let doFlatten = false;\r\n    function showWarnings (psdWarningArr: TKlPsdError[]): void {\r\n        const contentArr = [];\r\n        const warningMap = {\r\n            'mask': 'Masks not supported. Mask was applied.',\r\n            'clipping': 'Clipping not supported. Clipping layers were merged.',\r\n            'group': 'Groups not supported. Layers were ungrouped.',\r\n            'adjustment': 'Adjustment layers not supported.',\r\n            'layer-effect': 'Layer effects not supported.',\r\n            'smart-object': 'Smart objects not supported.',\r\n            'blend-mode': 'Unsupported layer blend mode.',\r\n            'bits-per-channel': 'Unsupported color depth. Only 8bit per channel supported.',\r\n        };\r\n        for (let i = 0; i < psdWarningArr.length; i++) {\r\n            contentArr.push('- ' + warningMap[psdWarningArr[i]]);\r\n        }\r\n        alert(contentArr.join('\\n'));\r\n    }\r\n\r\n    let flattenCheckbox: Checkbox;\r\n    let warningsEl: HTMLElement | undefined;\r\n    if (p.image.type === 'psd') {\r\n        if (p.image.layers) {\r\n            flattenCheckbox = new Checkbox({\r\n                init: doFlatten,\r\n                label: LANG('import-flatten'),\r\n                callback: (b): void => {\r\n                    doFlatten = b;\r\n                },\r\n            });\r\n            rootEl.append(flattenCheckbox.getElement());\r\n\r\n            if (p.image.warningArr) {\r\n                const noteEl = BB.el({\r\n                    className: 'kl-import-note',\r\n                    content: LANG('import-psd-limited-support'),\r\n                });\r\n                const warnings = p.image.warningArr;\r\n                warningsEl = BB.el({\r\n                    parent: noteEl,\r\n                    tagName: 'a',\r\n                    content: 'Details',\r\n                    css: { marginLeft: '5px'},\r\n                    onClick: () => showWarnings(warnings),\r\n                });\r\n                rootEl.append(noteEl);\r\n            }\r\n        } else {\r\n            const noteEl = BB.el({\r\n                className: 'kl-import-note',\r\n                content: LANG('import-psd-unsupported'),\r\n            });\r\n            rootEl.append(noteEl);\r\n        }\r\n    }\r\n\r\n    function callback (result: string): void {\r\n        const croppedImage = cropCopy.getCroppedImage();\r\n        const cropRect = cropCopy.getRect();\r\n        const isCropped = p.image.width !== cropRect.width && p.image.height !== cropRect.height;\r\n        cropCopy.destroy();\r\n        BB.destroyEl(warningsEl);\r\n        if (flattenCheckbox) {\r\n            flattenCheckbox.destroy();\r\n        }\r\n\r\n        if (result === LANG('import-btn-as-layer')) {\r\n            p.callback({\r\n                type: 'as-layer',\r\n                image: isCropped ? croppedImage : p.image.canvas,\r\n            });\r\n\r\n        } else if (result === LANG('import-btn-as-image')) {\r\n            if (p.image.type === 'psd') {\r\n                if (doFlatten) {\r\n                    delete p.image.layers;\r\n                }\r\n                p.callback({\r\n                    type: 'as-image-psd',\r\n                    image: p.image,\r\n                    cropObj: cropRect,\r\n                });\r\n            } else if (p.image.type === 'image') {\r\n                p.callback({\r\n                    type: 'as-image',\r\n                    image: croppedImage,\r\n                });\r\n            }\r\n        } else {\r\n            p.callback({\r\n                type: 'cancel',\r\n            });\r\n        }\r\n    }\r\n    showModal({\r\n        target: p.target,\r\n        message: `<b>${LANG('import-title')}</b>`,\r\n        div: rootEl,\r\n        style,\r\n        buttons: [LANG('import-btn-as-layer'), LANG('import-btn-as-image'), 'Cancel'],\r\n        primaries: [LANG('import-btn-as-layer'), LANG('import-btn-as-image')],\r\n        callback,\r\n        autoFocus: 'As Image',\r\n    });\r\n}","import {createCanvas} from '../../bb/base/create-canvas';\r\nimport {BlendMode, Layer, Psd} from 'ag-psd/dist/psd';\r\nimport {IKlProject, IKlPsd, TKlPsdError, TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {MAX_LAYERS} from '../canvas/kl-canvas';\r\nimport {BB} from '../../bb/bb';\r\n\r\nlet kl2PsdMap: Record<TMixMode, BlendMode>;\r\nlet psd2KlMap: Record<BlendMode, TMixMode>;\r\n\r\nfunction init (): void {\r\n    if (kl2PsdMap) {\r\n        return;\r\n    }\r\n    kl2PsdMap = {\r\n        'source-over': 'normal',\r\n\r\n        'darken': 'darken',\r\n        'multiply': 'multiply',\r\n        'color-burn': 'color burn',\r\n\r\n        'lighten': 'lighten',\r\n        'screen': 'screen',\r\n        'color-dodge': 'color dodge',\r\n\r\n        'overlay': 'overlay',\r\n        'soft-light': 'soft light',\r\n        'hard-light': 'hard light',\r\n\r\n        'difference': 'difference',\r\n        'exclusion': 'exclusion',\r\n\r\n        'hue': 'hue',\r\n        'saturation': 'saturation',\r\n        'color': 'color',\r\n        'luminosity': 'luminosity',\r\n    };\r\n    psd2KlMap = Object.fromEntries(Object.entries(kl2PsdMap).map(a => a.reverse()));\r\n}\r\n\r\nexport function blendPsdToKl (str: BlendMode): TMixMode {\r\n    init();\r\n    return psd2KlMap[str];\r\n}\r\n\r\nexport function blendKlToPsd (str: TMixMode): BlendMode {\r\n    init();\r\n    return kl2PsdMap[str];\r\n}\r\n\r\n\r\n/**\r\n * Converts ag-psd object into something that KlCanvas can represent\r\n * @param psdObj\r\n */\r\nexport function readPsd (psdObj: Psd): IKlPsd {\r\n    if (!psdObj.canvas) {\r\n        throw new Error('psdObj.canvas undefined');\r\n    }\r\n    const result: IKlPsd = {\r\n        type: 'psd',\r\n        canvas: psdObj.canvas,\r\n        width: psdObj.width,\r\n        height: psdObj.height,\r\n    };\r\n\r\n    function addWarning (warningStr: TKlPsdError): void {\r\n        if (!result.warningArr) {\r\n            result.warningArr = [];\r\n        }\r\n        if (result.warningArr.includes(warningStr)) {\r\n            return;\r\n        }\r\n        result.warningArr.push(warningStr);\r\n    }\r\n\r\n    function getMixModeStr (blendMode: BlendMode): TMixMode {\r\n        let mixModeStr: TMixMode = blendPsdToKl(blendMode);\r\n        if (!mixModeStr) {\r\n            addWarning('blend-mode');\r\n            mixModeStr = 'source-over';\r\n        }\r\n        return mixModeStr;\r\n    }\r\n\r\n    if (psdObj.bitsPerChannel !== 8) {\r\n        addWarning('bits-per-channel');\r\n    }\r\n\r\n    if (!psdObj.children) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    // count resulting layers\r\n    const maxLayers = MAX_LAYERS;\r\n    let layerCount = 0;\r\n    function countWithinGroup (groupObj: Layer): number {\r\n        let result = 0;\r\n        if (groupObj.blendMode) {\r\n            const mixModeStr = blendPsdToKl(groupObj.blendMode);\r\n            if (mixModeStr && mixModeStr !== 'source-over') {\r\n                return 1;\r\n            }\r\n        }\r\n        if (groupObj.children) {\r\n            for (let i = 0; i < groupObj.children.length; i++) {\r\n                const item = groupObj.children[i];\r\n                if (item.clipping || item.adjustment) {\r\n                    continue;\r\n                }\r\n\r\n                if (item.children) {\r\n                    addWarning('group');\r\n                    result += countWithinGroup(item);\r\n                } else {\r\n                    result++;\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    layerCount += countWithinGroup(psdObj);\r\n    if (layerCount > maxLayers) {\r\n        result.error = true;\r\n        return result;\r\n    }\r\n\r\n    result.layers = [];\r\n\r\n    function prepareMask (maskCanvas: HTMLCanvasElement, defaultColor: number): void {\r\n        const groupMaskCtx = BB.ctx(maskCanvas);\r\n        const imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\r\n        if (defaultColor === 0) {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = imData.data[i];\r\n            }\r\n        } else {\r\n            for (let i = 0; i < imData.data.length; i += 4) {\r\n                imData.data[i + 3] = 255 - imData.data[i];\r\n            }\r\n        }\r\n        groupMaskCtx.putImageData(imData, 0, 0);\r\n    }\r\n\r\n    function convertGroup (psdGroupObj: Layer): {\r\n        name: string;\r\n        mixModeStr: TMixMode;\r\n        opacity: number;\r\n        image: HTMLCanvasElement;\r\n    }[] {\r\n\r\n        let resultArr: {\r\n            name: string;\r\n            mixModeStr: TMixMode;\r\n            opacity: number;\r\n            image: HTMLCanvasElement;\r\n        }[] = [];\r\n        const groupOpacity = psdGroupObj.hidden ? 0 : psdGroupObj.opacity;\r\n        const groupMixModeStr = getMixModeStr(psdGroupObj.blendMode!);\r\n        let groupCanvas;\r\n        let groupCtx;\r\n        if (groupMixModeStr !== 'source-over') {\r\n            groupCanvas = createCanvas(result.width, result.height);\r\n            groupCtx = BB.ctx(groupCanvas);\r\n        }\r\n\r\n        // prepare group mask\r\n        if (psdGroupObj.mask) {\r\n            addWarning('mask');\r\n            prepareMask(psdGroupObj.mask.canvas!, psdGroupObj.mask.defaultColor!);\r\n        }\r\n\r\n        if (psdGroupObj.children) {\r\n            for (let i = 0; i < psdGroupObj.children.length; i++) {\r\n                const item = psdGroupObj.children[i];\r\n                if (item.clipping) {\r\n                    continue;\r\n                }\r\n                if (item.adjustment) {\r\n                    addWarning('adjustment');\r\n                    continue;\r\n                }\r\n\r\n                const hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\r\n                if (hasClipping) {\r\n                    addWarning('clipping');\r\n                }\r\n\r\n                if (item.children) {\r\n                    const innerArr = convertGroup(item);\r\n\r\n                    for (let e = 0; e < innerArr.length; e++) {\r\n                        const innerItem = innerArr[e];\r\n                        const innerCtx = BB.ctx(innerItem.image);\r\n\r\n                        // clipping\r\n                        if (hasClipping) {\r\n                            const clippingCanvas = createCanvas(result.width, result.height);\r\n                            const clippingCtx = BB.ctx(clippingCanvas);\r\n                            clippingCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                            for (let f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++) {\r\n                                const clippingItem = psdGroupObj.children[f];\r\n                                if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                                    continue;\r\n                                }\r\n                                if (clippingItem.blendMode === undefined) {\r\n                                    throw new Error('clippingItem.blendMode undefined');\r\n                                }\r\n                                if (clippingItem.opacity === undefined) {\r\n                                    throw new Error('clippingItem.opacity undefined');\r\n                                }\r\n                                if (clippingItem.canvas === undefined) {\r\n                                    throw new Error('clippingItem.canvas undefined');\r\n                                }\r\n                                if (clippingItem.left === undefined) {\r\n                                    throw new Error('clippingItem.left undefined');\r\n                                }\r\n                                if (clippingItem.top === undefined) {\r\n                                    throw new Error('clippingItem.top undefined');\r\n                                }\r\n                                clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                                clippingCtx.globalAlpha = clippingItem.opacity;\r\n                                clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\r\n                            }\r\n\r\n                            innerCtx.globalCompositeOperation = 'source-atop';\r\n                            innerCtx.drawImage(clippingCanvas, 0, 0);\r\n                        }\r\n\r\n\r\n\r\n                        // group mask\r\n                        if (psdGroupObj.mask) {\r\n                            innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                            if (psdGroupObj.mask.canvas === undefined) {\r\n                                throw new Error('psdGroupObj.mask.canvas undefined');\r\n                            }\r\n                            if (psdGroupObj.mask.left === undefined) {\r\n                                throw new Error('psdGroupObj.mask.left undefined');\r\n                            }\r\n                            if (psdGroupObj.mask.top === undefined) {\r\n                                throw new Error('psdGroupObj.mask.top undefined');\r\n                            }\r\n                            innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n                        }\r\n\r\n                        if (groupCanvas) {\r\n                            if (groupCtx === undefined) {\r\n                                throw new Error('groupCtx undefined');\r\n                            }\r\n                            groupCtx.globalCompositeOperation = innerItem.mixModeStr;\r\n                            groupCtx.globalAlpha = innerItem.opacity;\r\n                            groupCtx.drawImage(innerItem.image, 0, 0);\r\n\r\n                        } else {\r\n                            if (groupOpacity === undefined) {\r\n                                throw new Error('groupOpacity undefined');\r\n                            }\r\n                            innerItem.opacity = innerItem.opacity * groupOpacity;\r\n                            resultArr.push(innerItem);\r\n                        }\r\n                    }\r\n\r\n                    continue;\r\n                }\r\n\r\n                const canvas = createCanvas(result.width, result.height);\r\n                const ctx = BB.ctx(canvas);\r\n                if (item.canvas) { // if a layer is empty it has no canvas\r\n                    if (item.top === undefined) {\r\n                        throw new Error('item.top undefined');\r\n                    }\r\n                    if (item.left === undefined) {\r\n                        throw new Error('item.left undefined');\r\n                    }\r\n                    ctx.drawImage(item.canvas, item.left, item.top);\r\n                }\r\n\r\n                // effects\r\n                if (item.effects) {\r\n                    addWarning('layer-effect');\r\n                }\r\n\r\n                // mask\r\n                if (item.mask) {\r\n                    addWarning('mask');\r\n                    if (item.mask.canvas === undefined) {\r\n                        throw new Error('item.mask.canvas undefined');\r\n                    }\r\n                    if (item.mask.defaultColor === undefined) {\r\n                        throw new Error('item.mask.defaultColor undefined');\r\n                    }\r\n                    if (item.mask.left === undefined) {\r\n                        throw new Error('item.mask.left undefined');\r\n                    }\r\n                    if (item.mask.top === undefined) {\r\n                        throw new Error('item.mask.top undefined');\r\n                    }\r\n                    prepareMask(item.mask.canvas, item.mask.defaultColor);\r\n\r\n                    ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                    ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\r\n                }\r\n\r\n                // clipping\r\n                if (hasClipping) {\r\n                    if (item.right === undefined) {\r\n                        throw new Error('item.right undefined');\r\n                    }\r\n                    if (item.left === undefined) {\r\n                        throw new Error('item.left undefined');\r\n                    }\r\n                    if (item.bottom === undefined) {\r\n                        throw new Error('item.bottom undefined');\r\n                    }\r\n                    if (item.top === undefined) {\r\n                        throw new Error('item.top undefined');\r\n                    }\r\n                    if (item.canvas === undefined) {\r\n                        throw new Error('item.canvas undefined');\r\n                    }\r\n                    const clippingCanvas = createCanvas(item.right - item.left, item.bottom - item.top);\r\n                    const clippingCtx = BB.ctx(clippingCanvas);\r\n                    clippingCtx.drawImage(item.canvas, 0, 0);\r\n\r\n                    for (let e = i + 1; e < psdGroupObj.children.length && psdGroupObj.children[e].clipping; e++) {\r\n                        const clippingItem = psdGroupObj.children[e];\r\n                        if (clippingItem.opacity === 0 || clippingItem.hidden) {\r\n                            continue;\r\n                        }\r\n                        if (clippingItem.blendMode === undefined) {\r\n                            throw new Error('clippingItem.blendMode undefined');\r\n                        }\r\n                        if (clippingItem.opacity === undefined) {\r\n                            throw new Error('clippingItem.opacity undefined');\r\n                        }\r\n                        if (clippingItem.canvas === undefined) {\r\n                            throw new Error('clippingItem.canvas undefined');\r\n                        }\r\n                        if (clippingItem.left === undefined) {\r\n                            throw new Error('clippingItem.left undefined');\r\n                        }\r\n                        if (clippingItem.top === undefined) {\r\n                            throw new Error('clippingItem.top undefined');\r\n                        }\r\n                        clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\r\n                        clippingCtx.globalAlpha = clippingItem.opacity;\r\n                        clippingCtx.drawImage(clippingItem.canvas, clippingItem.left - item.left, clippingItem.top - item.top);\r\n                    }\r\n\r\n                    ctx.globalCompositeOperation = 'source-atop';\r\n                    ctx.drawImage(clippingCanvas, item.left, item.top);\r\n                }\r\n\r\n                // group mask\r\n                if (psdGroupObj.mask) {\r\n                    ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\r\n                    if (psdGroupObj.mask.canvas === undefined) {\r\n                        throw new Error('psdGroupObj.mask.canvas undefined');\r\n                    }\r\n                    if (psdGroupObj.mask.left === undefined) {\r\n                        throw new Error('psdGroupObj.mask.left undefined');\r\n                    }\r\n                    if (psdGroupObj.mask.top === undefined) {\r\n                        throw new Error('psdGroupObj.mask.top undefined');\r\n                    }\r\n                    ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\r\n                }\r\n\r\n                if (groupOpacity === undefined) {\r\n                    throw new Error('groupOpacity undefined');\r\n                }\r\n                if (item.blendMode === undefined) {\r\n                    throw new Error('item.blendMode undefined');\r\n                }\r\n                if (item.hidden  === undefined) {\r\n                    throw new Error('item.hidden  undefined');\r\n                }\r\n                if (item.opacity === undefined) {\r\n                    throw new Error('item.opacity undefined');\r\n                }\r\n\r\n                if (groupCanvas && groupCtx) {\r\n                    if (groupOpacity > 0) {\r\n                        groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\r\n                        groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\r\n                        groupCtx.drawImage(canvas, 0, 0);\r\n                    }\r\n\r\n                } else {\r\n                    if (item.name === undefined) {\r\n                        throw new Error('item.name undefined');\r\n                    }\r\n                    resultArr.push({\r\n                        name: item.name,\r\n                        opacity: (item.hidden ? 0 : item.opacity) * groupOpacity,\r\n                        mixModeStr: getMixModeStr(item.blendMode),\r\n                        image: canvas,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        if (groupCanvas) {\r\n            if (psdGroupObj.name === undefined) {\r\n                throw new Error('psdGroupObj.name undefined');\r\n            }\r\n            if (groupOpacity === undefined) {\r\n                throw new Error('groupOpacity undefined');\r\n            }\r\n            resultArr = [\r\n                {\r\n                    name: psdGroupObj.name,\r\n                    opacity: groupOpacity,\r\n                    mixModeStr: groupMixModeStr,\r\n                    image: groupCanvas,\r\n                },\r\n            ];\r\n        }\r\n\r\n        return resultArr;\r\n    }\r\n\r\n    result.layers = convertGroup({\r\n        name: 'root',\r\n        opacity: 1,\r\n        blendMode: 'normal',\r\n        children: psdObj.children,\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\nexport function klPsdToKlProject (klPsd: IKlPsd): IKlProject {\r\n    // only share references to Canvas elements\r\n    const result: IKlProject = {\r\n        width: klPsd.width,\r\n        height: klPsd.height,\r\n        layers: [],\r\n    };\r\n    if (klPsd.layers) {\r\n        result.layers = klPsd.layers.map(item => {\r\n            return {\r\n                name: item.name,\r\n                opacity: item.opacity,\r\n                mixModeStr: item.mixModeStr,\r\n                image: item.image,\r\n            };\r\n        });\r\n    } else {\r\n        // flattened\r\n        result.layers = [{\r\n            name: LANG('background'),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over',\r\n            image: klPsd.canvas,\r\n        }];\r\n    }\r\n    return result;\r\n}","import {IKlStorageProject} from '../kl-types';\r\n\r\nconst indexedDbIsSupported = !!window.indexedDB;\r\nlet dbNameStr = 'Klecks';\r\nconst storageNameStr = 'ProjectStore';\r\n\r\nexport function setDbName (name: string): void {\r\n    dbNameStr = '' + name;\r\n}\r\n\r\n/**\r\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\r\n * with index 'id'\r\n *\r\n * @param actionFunction what to execute during transaction\r\n * @param successCallback on successful transaction\r\n * @param errorCallback on error\r\n */\r\nfunction execIndexedDBTransaction (\r\n    actionFunction: (storeObj: IDBObjectStore) => void,\r\n    successCallback: () => void,\r\n    errorCallback: (errorStr: string) => void,\r\n): void {\r\n\r\n    let hasFinished = false;\r\n\r\n    function onSuccess (): void {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        successCallback();\r\n    }\r\n\r\n    function onError (errorStr: string): void {\r\n        if (hasFinished) {\r\n            return;\r\n        }\r\n        hasFinished = true;\r\n        errorCallback(errorStr);\r\n    }\r\n\r\n    if (!indexedDbIsSupported) {\r\n        setTimeout(function () {\r\n            onError('no indexed db available');\r\n        }, 0);\r\n        return;\r\n    }\r\n    let requestObj: IDBOpenDBRequest;\r\n\r\n    try {\r\n        requestObj = window.indexedDB.open(dbNameStr, 1);\r\n    } catch (e) {\r\n        onError(e.message);\r\n        return;\r\n    }\r\n\r\n    requestObj.onupgradeneeded = function (): void {\r\n        try {\r\n            const db: IDBDatabase = requestObj.result;\r\n            const store = db.createObjectStore(storageNameStr, {keyPath: 'id'});\r\n            store.createIndex('id', 'id', {unique: true});\r\n        } catch (e) {\r\n            onError(e.message);\r\n        }\r\n    };\r\n    requestObj.onerror = function (): void {\r\n        onError('indexedDB.open failed, ' + requestObj.error);\r\n    };\r\n    requestObj.onsuccess = function (): void {\r\n        let databaseObj: IDBDatabase;\r\n        let transactionObj: IDBTransaction;\r\n        let storeObj: IDBObjectStore;\r\n\r\n        try {\r\n            databaseObj = requestObj.result;\r\n            if (!databaseObj.objectStoreNames.contains(storageNameStr)) {\r\n                //someone maybe messed with the db, or creation failed earlier\r\n                //it's broken -> destroy\r\n                window.indexedDB.deleteDatabase(dbNameStr);\r\n                onError('object store ' + storageNameStr + ' missing. destroying db');\r\n                return;\r\n            }\r\n            transactionObj = databaseObj.transaction(storageNameStr, 'readwrite');\r\n            storeObj = transactionObj.objectStore(storageNameStr);\r\n            storeObj.index('id');\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        databaseObj.onerror = function (e): void {\r\n            onError('database error, ' + databaseObj.error);\r\n        };\r\n\r\n        try {\r\n            actionFunction(storeObj);\r\n        } catch (e) {\r\n            onError(e.message);\r\n            return;\r\n        }\r\n\r\n        transactionObj.oncomplete = function (): void {\r\n            onSuccess();\r\n            databaseObj.close();\r\n        };\r\n        transactionObj.onerror = function (): void {\r\n            onError('transaction error, ' + transactionObj.error);\r\n        };\r\n    };\r\n}\r\n\r\nexport function getKlProjectObj (\r\n    successCallback: (result: undefined | IKlStorageProject) => void,\r\n    errorCallback: (error: string) => void,\r\n): void {\r\n    if (indexedDbIsSupported) {\r\n        let query: IDBRequest<undefined | IKlStorageProject>;\r\n        execIndexedDBTransaction(function (storeObj) {\r\n            query = storeObj.get(1);\r\n        }, function () {\r\n            successCallback(query.result);\r\n        }, function (errorStr) {\r\n            errorCallback('execIndexedDBTransaction error, ' + errorStr);\r\n        });\r\n    } else {\r\n        successCallback(undefined);\r\n    }\r\n}\r\n\r\n/**\r\n * stores a project into id = 1 in database:dbNameStr > storage: storageNameStr\r\n */\r\nexport function storeKlProjectObj (\r\n    storageProject: IKlStorageProject,\r\n    successCallback: () => void,\r\n    errorCallback: (error: string) => void,\r\n): void {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.put(storageProject);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (errorStr) {\r\n        errorCallback(errorStr);\r\n    });\r\n\r\n}\r\n\r\n/**\r\n * deletes stored project, by removing id = 1 from database:dbNameStr > storage: storageNameStr\r\n */\r\nexport function clear (\r\n    successCallback: () => void,\r\n    errorCallback: (error: string) => void,\r\n): void {\r\n    execIndexedDBTransaction(function (storeObj) {\r\n        storeObj.delete(1);\r\n    }, function () {\r\n        successCallback();\r\n    }, function (error) {\r\n        errorCallback(error);\r\n    });\r\n\r\n}\r\n","import {IFilter} from '../kl-types';\r\nimport glBrightnessContrastImg from '/src/app/img/ui/edit-brightness-contrast.svg';\r\nimport cropExtendImg from '/src/app/img/ui/edit-crop.svg';\r\nimport glCurvesImg from '/src/app/img/ui/edit-curves.svg';\r\nimport flipImg from '/src/app/img/ui/edit-flip.svg';\r\nimport glHueSaturationImg from '/src/app/img/ui/edit-hue-saturation.svg';\r\nimport invertImg from '/src/app/img/ui/edit-invert.png';\r\nimport glPerspectiveImg from '/src/app/img/ui/edit-perspective.svg';\r\nimport resizeImg from '/src/app/img/ui/edit-resize.svg';\r\nimport rotateImg from '/src/app/img/ui/edit-rotate.svg';\r\nimport glTiltShiftImg from '/src/app/img/ui/edit-tilt-shift.png';\r\nimport toAlphaImg from '/src/app/img/ui/edit-to-alpha.svg';\r\nimport transformImg from '/src/app/img/ui/edit-transform.svg';\r\nimport glBlurImg from '/src/app/img/ui/edit-triangle-blur.png';\r\nimport glUnsharpMaskImg from '/src/app/img/ui/edit-unsharp-mask.png';\r\nimport gridImg from '/src/app/img/ui/edit-grid.svg';\r\nimport noiseImg from '/src/app/img/ui/edit-noise.svg';\r\nimport patternImg from '/src/app/img/ui/edit-pattern.svg';\r\nimport vanishPointImg from '/src/app/img/ui/edit-vanish-point.svg';\r\nimport distortImg from '/src/app/img/ui/edit-distort.svg';\r\nimport {THistoryEntryG} from '../history/kl-history';\r\n\r\nexport type TFilterHistoryEntry<Filter extends string, Input> = THistoryEntryG<['filter', Filter], 'apply', [{ input: Input }]>;\r\n\r\nexport const filterLibStatus = {\r\n    isLoaded: false,\r\n};\r\nexport const filterLib: {\r\n    [key:string]: IFilter;\r\n} = {\r\n    brightnessContrast: {\r\n        lang: {name: 'filter-bright-contrast-title', button: 'filter-bright-contrast'},\r\n        icon: glBrightnessContrastImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    cropExtend: {\r\n        lang: {name: 'filter-crop-title', button: 'filter-crop-extend'},\r\n        icon: cropExtendImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    curves: {\r\n        lang: {name: 'filter-curves-title', button: 'filter-curves'},\r\n        icon: glCurvesImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    distort: {\r\n        lang: {name: 'filter-distort', button: 'filter-distort'},\r\n        icon: distortImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    flip: {\r\n        lang: {name: 'filter-flip-title', button: 'filter-flip'},\r\n        icon: flipImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    hueSaturation: {\r\n        lang: {name: 'filter-hue-sat-title', button: 'filter-hue-sat'},\r\n        icon: glHueSaturationImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n    },\r\n    invert: {\r\n        lang: {name: 'filter-invert', button: 'filter-invert'},\r\n        icon: invertImg,\r\n        updatePos: false,\r\n        isInstant: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n    },\r\n    perspective: {\r\n        lang: {name: 'filter-perspective-title', button: 'filter-perspective'},\r\n        icon: glPerspectiveImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    resize: {\r\n        lang: {name: 'filter-resize-title', button: 'filter-resize'},\r\n        icon: resizeImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    rotate: {\r\n        lang: {name: 'filter-rotate-title', button: 'filter-rotate'},\r\n        icon: rotateImg,\r\n        updatePos: true,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: false,\r\n    },\r\n    tiltShift: {\r\n        lang: {name: 'filter-tilt-shift-title', button: 'filter-tilt-shift'},\r\n        icon: glTiltShiftImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    toAlpha: {\r\n        lang: {name: 'filter-to-alpha-title', button: 'filter-to-alpha'},\r\n        icon: toAlphaImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n    },\r\n    transform: {\r\n        lang: {name: 'filter-transform-title', button: 'filter-transform'},\r\n        icon: transformImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    blur: {\r\n        lang: {name: 'filter-triangle-blur-title', button: 'filter-triangle-blur'},\r\n        icon: glBlurImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n    },\r\n    unsharpMask: {\r\n        lang: {name: 'filter-unsharp-mask-title', button: 'filter-unsharp-mask'},\r\n        icon: glUnsharpMaskImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n        darkNoInvert: true,\r\n    },\r\n    grid: {\r\n        lang: {name: 'filter-grid', button: 'filter-grid'},\r\n        icon: gridImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    noise: {\r\n        lang: {name: 'filter-noise', button: 'filter-noise'},\r\n        icon: noiseImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    pattern: {\r\n        lang: {name: 'filter-pattern', button: 'filter-pattern'},\r\n        icon: patternImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n    vanishPoint: {\r\n        lang: {name: 'filter-vanish-point-title', button: 'filter-vanish-point'},\r\n        icon: vanishPointImg,\r\n        updatePos: false,\r\n        getDialog: null,\r\n        apply: null,\r\n        inEmbed: true,\r\n    },\r\n};\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7tOPd\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fduLu\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ijSd4\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3lCpH\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hhylW\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kV0ed\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"dNk9L\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"aj5Gc\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6D2tK\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7nesm\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"leHUT\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"3lP2j\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7G4sY\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"7n1Rt\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"ijwf0\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"18gIG\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"786LQ\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kcnOE\");","import {PenBrush} from './pen-brush';\r\nimport {BlendBrush} from './blend-brush';\r\nimport {SketchyBrush} from './sketchy-brush';\r\nimport {PixelBrush} from './pixel-brush';\r\nimport {EraserBrush} from './eraser-brush';\r\nimport {SmudgeBrush} from './smudge-brush';\r\nimport {ChemyBrush} from './chemy-brush';\r\n\r\nexport const brushes = {\r\n    PenBrush,\r\n    BlendBrush,\r\n    SketchyBrush,\r\n    PixelBrush,\r\n    ChemyBrush,\r\n    SmudgeBrush,\r\n    EraserBrush,\r\n};","import {BB} from '../../bb/bb';\r\nimport {alphaImArr} from './brushes-common';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB, TPressureInput} from '../kl-types';\r\nimport {BezierLine} from '../../bb/math/line';\r\n\r\nexport interface IPenBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'PenBrush'];\r\n    actions: THistoryInnerActions<PenBrush>[];\r\n}\r\n\r\nconst ALPHA_CIRCLE = 0;\r\nconst ALPHA_CHALK = 1;\r\nconst ALPHA_CAL = 2; // calligraphy\r\nconst ALPHA_SQUARE = 3;\r\n\r\nconst TWO_PI = 2 * Math.PI;\r\n\r\nexport class PenBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IPenBrushHistoryEntry | undefined;\r\n\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingHasSizePressure: boolean = true;\r\n    private settingSize: number = 2;\r\n    private settingSpacing: number = 0.8489;\r\n    private settingOpacity: number = 1;\r\n    private settingColor: IRGB;\r\n    private settingColorStr: string;\r\n    private settingAlphaId: number = ALPHA_CIRCLE;\r\n    private settingLockLayerAlpha: boolean = false;\r\n\r\n    private hasDrawnDot: boolean = false;\r\n    private lineToolLastDot: number;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private inputArr: TPressureInput[];\r\n    private inputIsDrawing: boolean = false;\r\n    private bezierLine: BezierLine | null = null;\r\n\r\n    // mipmapping\r\n    private readonly alphaCanvas128: HTMLCanvasElement = BB.canvas(128, 128);\r\n    private readonly alphaCanvas64: HTMLCanvasElement = BB.canvas(64, 64);\r\n    private readonly alphaCanvas32: HTMLCanvasElement = BB.canvas(32, 32);\r\n    private readonly alphaOpacityArr: number[] = [1, 0.9, 1, 1];\r\n\r\n\r\n    private updateAlphaCanvas () {\r\n        if (this.settingAlphaId === ALPHA_CIRCLE || this.settingAlphaId === ALPHA_SQUARE) {\r\n            return;\r\n        }\r\n\r\n        const instructionArr: [HTMLCanvasElement, number][] = [\r\n            [this.alphaCanvas128, 128],\r\n            [this.alphaCanvas64, 64],\r\n            [this.alphaCanvas32, 32],\r\n        ];\r\n\r\n        let ctx;\r\n\r\n        for (let i = 0; i < instructionArr.length; i++) {\r\n            ctx = BB.ctx((instructionArr[i][0] as any));\r\n\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.fillStyle = 'rgba(' + this.settingColor.r\r\n                + ', ' + this.settingColor.g\r\n                + ', ' + this.settingColor.b\r\n                + ', ' + this.alphaOpacityArr[this.settingAlphaId] + ')';\r\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.globalCompositeOperation = 'destination-in';\r\n            ctx.imageSmoothingQuality = 'high';\r\n            ctx.drawImage(alphaImArr[this.settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\r\n\r\n            ctx.restore();\r\n        }\r\n    }\r\n\r\n    private calcOpacity (pressure: number): number {\r\n        return this.settingOpacity * (this.settingHasOpacityPressure ? pressure * pressure : 1);\r\n    }\r\n\r\n    /**\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     * @param angle\r\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\r\n     */\r\n    private drawDot (\r\n        x: number,\r\n        y:number,\r\n        size: number,\r\n        opacity: number,\r\n        angle?: number,\r\n        before?: [number, number, number, number, (number | undefined)]\r\n    ): void {\r\n        if (size <= 0) {\r\n            return;\r\n        }\r\n\r\n        if (this.settingLockLayerAlpha) {\r\n            this.context.globalCompositeOperation = 'source-atop';\r\n        }\r\n\r\n        if (!before || before[3] !== opacity) {\r\n            this.context.globalAlpha = opacity;\r\n        }\r\n\r\n        if (!before && (this.settingAlphaId === ALPHA_CIRCLE || this.settingAlphaId === ALPHA_SQUARE)) {\r\n            this.context.fillStyle = this.settingColorStr;\r\n        }\r\n\r\n        if (this.settingAlphaId === ALPHA_CIRCLE) {\r\n            this.context.beginPath();\r\n            this.context.arc(x, y, size, 0, TWO_PI);\r\n            this.context.closePath();\r\n            this.context.fill();\r\n            this.hasDrawnDot = true;\r\n\r\n        } else if (this.settingAlphaId === ALPHA_SQUARE) {\r\n            if (angle !== undefined) {\r\n                this.context.save();\r\n                this.context.translate(x, y);\r\n                this.context.rotate(angle / 180 * Math.PI);\r\n                this.context.fillRect(-size, -size, size * 2, size * 2);\r\n                this.context.restore();\r\n                this.hasDrawnDot = true;\r\n            }\r\n\r\n        } else { // other brush alphas\r\n            this.context.save();\r\n            this.context.translate(x, y);\r\n            let targetMipmap = this.alphaCanvas128;\r\n            if (size <= 32 && size > 16) {\r\n                targetMipmap = this.alphaCanvas64;\r\n            } else if (size <= 16) {\r\n                targetMipmap = this.alphaCanvas32;\r\n            }\r\n            this.context.scale(size, size);\r\n            if (this.settingAlphaId === ALPHA_CHALK) {\r\n                this.context.rotate(((x + y) * 53123) % TWO_PI); // without mod it sometimes looks different\r\n            }\r\n            this.context.drawImage(targetMipmap, -1, -1, 2, 2);\r\n\r\n            this.context.restore();\r\n            this.hasDrawnDot = true;\r\n        }\r\n    }\r\n\r\n    // continueLine\r\n    private continueLine (\r\n        x: number | null,\r\n        y: number | null,\r\n        size: number,\r\n        pressure: number,\r\n    ): void {\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, () => {});\r\n        }\r\n\r\n        const drawArr: [number, number, number, number, (number | undefined)][] = []; //draw instructions. will be all drawn at once\r\n\r\n        const dotCallback = (val: {\r\n            x: number;\r\n            y: number;\r\n            t: number;\r\n            angle?: number;\r\n            dAngle: number;\r\n        }): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.calcOpacity(localPressure);\r\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        };\r\n\r\n        const localSpacing = size * this.settingSpacing;\r\n        if (x === null || y === null) {\r\n            this.bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        this.context.save();\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            const item = drawArr[i];\r\n            this.drawDot(item[0], item[1], item[2], item[3], item[4], before);\r\n            before = item;\r\n        }\r\n        this.context.restore();\r\n    }\r\n\r\n\r\n    // ---- public ----\r\n    constructor () {}\r\n\r\n    // ---- interface ----\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'PenBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setAlpha',\r\n                    params: [this.settingAlphaId],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n            ],\r\n        };\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        const localOpacity = this.calcOpacity(p);\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.hasDrawnDot = false;\r\n\r\n        this.inputIsDrawing = true;\r\n        this.context.save();\r\n        this.drawDot(x, y, localSize, localOpacity);\r\n        this.context.restore();\r\n\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2.pressure = p;\r\n\r\n        this.inputArr = [{\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        }];\r\n\r\n        this.historyEntry.actions!.push({\r\n            action: 'startLine',\r\n            params: [x, y, p],\r\n        });\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.inputIsDrawing) {\r\n            return;\r\n        }\r\n        this.historyEntry!.actions!.push({\r\n            action: 'goLine',\r\n            params: [x, y, p],\r\n        });\r\n\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.context.save();\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n        /*context.fillStyle = 'red';\r\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\r\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/\r\n\r\n        this.context.restore();\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput2.pressure = this.lastInput.pressure;\r\n        this.lastInput.pressure = pressure;\r\n\r\n        this.inputArr.push({\r\n            x,\r\n            y,\r\n            pressure: p,\r\n        });\r\n    }\r\n\r\n    endLine (x: number, y: number): void {\r\n\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.context.save();\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n        this.context.restore();\r\n\r\n        this.inputIsDrawing = false;\r\n\r\n        if (this.settingAlphaId === ALPHA_SQUARE && !this.hasDrawnDot) {\r\n            // find max pressure input, use that one\r\n            let maxInput = this.inputArr[0];\r\n            this.inputArr.forEach(item => {\r\n                if (item.pressure > maxInput.pressure) {\r\n                    maxInput = item;\r\n                }\r\n            });\r\n\r\n            this.context.save();\r\n            const p = BB.clamp(maxInput.pressure, 0, 1);\r\n            const localOpacity = this.calcOpacity(p);\r\n            this.drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\r\n            this.context.restore();\r\n        }\r\n\r\n        this.bezierLine = null;\r\n\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions!.push({\r\n                action: 'endLine',\r\n                params: [x, y],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n\r\n        this.hasDrawnDot = false;\r\n        this.inputArr = [];\r\n    }\r\n\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n        this.lastInput.pressure = 1;\r\n\r\n        if (this.inputIsDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        const bdist = this.settingSize * this.settingSpacing;\r\n        this.lineToolLastDot = this.settingSize * this.settingSpacing;\r\n        this.context.save();\r\n        for (loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity, angle);\r\n        }\r\n        this.context.restore();\r\n\r\n\r\n        const historyEntry: IPenBrushHistoryEntry = {\r\n            tool: ['brush', 'PenBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setAlpha',\r\n                    params: [this.settingAlphaId],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n    //IS\r\n    isDrawing (): boolean {\r\n        return this.inputIsDrawing;\r\n    }\r\n\r\n    //SET\r\n    setAlpha (a: number): void {\r\n        if (this.settingAlphaId === a) {\r\n            return;\r\n        }\r\n        this.settingAlphaId = a;\r\n        this.updateAlphaCanvas();\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor === c) {\r\n            return;\r\n        }\r\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\r\n        this.settingColorStr = 'rgb(' + this.settingColor.r + ',' + this.settingColor.g + ',' + this.settingColor.b + ')';\r\n        this.updateAlphaCanvas();\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSize (s: number, b?: string): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = b;\r\n    }\r\n\r\n    //GET\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n}\r\n\r\n","import {genBrushAlpha01, genBrushAlpha02} from './alphas/brush-alphas';\r\n\r\nexport const alphaImArr = []; //used by default brush\r\nalphaImArr[1] = genBrushAlpha01(128);\r\nalphaImArr[2] = genBrushAlpha02(128);","import {BB} from '../../../bb/bb';\r\nimport {noise} from '../../../bb/math/perlin';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\n\r\n// chalk\r\nexport function genBrushAlpha01 (w: number): HTMLCanvasElement {\r\n\r\n    const scaleFac = w / 500;\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    const ctx = BB.ctx(canvas);\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            const i = (y * w + x) * 4;\r\n\r\n            // base noise\r\n            const sFac2 = scaleFac + noise.simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\r\n            let noisePattern = 100 + (noise.simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\r\n            noisePattern -= (noise.simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\r\n\r\n            // fade out in circular shape\r\n            const centerDist = BB.dist(w / 2, h / 2, x, y);\r\n            const falloff = BB.clamp(\r\n                1 - ((centerDist - (w / 2.5)) / (w / 14) + noise.simplex2(x / 22 / sFac2, y / 22 / sFac2)),\r\n                0,\r\n                1);\r\n            noisePattern = noisePattern * falloff;\r\n\r\n            // make the middle darker\r\n            const falloff2 = BB.clamp(1 - centerDist / w, 0, 1) * 2;\r\n            noisePattern = noisePattern * falloff2;\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = BB.clamp(noisePattern, 0, 255);\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}\r\n\r\n// https://www.shadertoy.com/view/3tdSDj\r\nfunction udSegment ( p: IVector2D, a: IVector2D, b: IVector2D ) {\r\n    const ba = BB.Vec2.sub(b, a);\r\n    const pa = BB.Vec2.sub(p, a);\r\n    const h = BB.clamp( BB.Vec2.dot(pa,ba) / BB.Vec2.dot(ba,ba), 0.0, 1.0 );\r\n    return BB.Vec2.len(BB.Vec2.sub(pa, BB.Vec2.mul(ba, h)));\r\n}\r\n\r\n// calligraphy\r\nexport function genBrushAlpha02 (w: number): HTMLCanvasElement {\r\n\r\n    const pDist = 1 / 4;\r\n    let centerSize = 2 / 3;\r\n    let transitionSize = 1 / 3;\r\n    centerSize *= pDist;\r\n    transitionSize *= pDist;\r\n    const p1 = {x: pDist * w, y: w - (w * pDist)};\r\n    const p2 = {x: w - (w * pDist), y: pDist * w};\r\n\r\n    const h = w;\r\n    const canvas = BB.canvas(w, h);\r\n    const ctx = BB.ctx(canvas);\r\n    const imData = ctx.createImageData(w, h);\r\n    for (let x = 0; x < w; x++) {\r\n        for (let y = 0; y < h; y++) {\r\n            const i = (y * w + x) * 4;\r\n\r\n            let col = udSegment({x: x, y: y}, p1, p2);\r\n\r\n            col = BB.clamp(\r\n                255 - ((col - (w * centerSize)) / (w * transitionSize) * 255),\r\n                0,\r\n                255\r\n            );\r\n\r\n            imData.data[i] = 0;\r\n            imData.data[i + 1] = 0;\r\n            imData.data[i + 2] = 0;\r\n            imData.data[i + 3] = col;\r\n        }\r\n    }\r\n\r\n    ctx.putImageData(imData, 0, 0);\r\n    return canvas;\r\n}","/*\r\n * A speed-improved perlin and simplex noise algorithms for 2D.\r\n *\r\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\r\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\r\n * Better rank ordering method by Stefan Gustavson in 2012.\r\n * Converted to Javascript by Joseph Gentle.\r\n *\r\n * Version 2012-03-09\r\n *\r\n * This code was placed in the public domain by its original author,\r\n * Stefan Gustavson. You may use it as you see fit, but\r\n * attribution is appreciated.\r\n *\r\n */\r\n\r\nconst myModule = {} as any;\r\n\r\nclass Grad {\r\n    constructor (public x: number, public y: number, public z:number) {}\r\n\r\n    dot2 (x: number, y: number): number {\r\n        return this.x*x + this.y*y;\r\n    }\r\n}\r\n/*\r\nGrad.prototype.dot3 = function(x, y, z) {\r\n    return this.x*x + this.y*y + this.z*z;\r\n};*/\r\n\r\nconst grad3 = [new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),\r\n    new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),\r\n    new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];\r\n\r\nconst p = [151,160,137,91,90,15,\r\n    131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,\r\n    190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,\r\n    88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,\r\n    77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,\r\n    102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,\r\n    135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,\r\n    5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,\r\n    223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,\r\n    129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,\r\n    251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,\r\n    49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,\r\n    138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\r\n// To remove the need for index wrapping, double the permutation table length\r\nconst perm = new Array(512);\r\nconst gradP = new Array(512);\r\n\r\n// This isn't a very good seeding function, but it works ok. It supports 2^16\r\n// different seed values. Write something better if you need more seeds.\r\nmyModule.seed = function (seed: number): void {\r\n    if (seed > 0 && seed < 1) {\r\n        // Scale the seed out\r\n        seed *= 65536;\r\n    }\r\n\r\n    seed = Math.floor(seed);\r\n    if (seed < 256) {\r\n        seed |= seed << 8;\r\n    }\r\n\r\n    for (let i = 0; i < 256; i++) {\r\n        let v;\r\n        if (i & 1) {\r\n            v = p[i] ^ (seed & 255);\r\n        } else {\r\n            v = p[i] ^ ((seed>>8) & 255);\r\n        }\r\n\r\n        perm[i] = perm[i + 256] = v;\r\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\r\n    }\r\n};\r\n\r\nmyModule.seed(0);\r\n\r\n/*\r\nfor (let i=0; i<256; i++) {\r\n  perm[i] = perm[i + 256] = p[i];\r\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\r\n}*/\r\n\r\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\r\nconst F2 = 0.5*(Math.sqrt(3)-1);\r\nconst G2 = (3-Math.sqrt(3))/6;\r\n\r\n/*let F3 = 1/3;\r\nlet G3 = 1/6;*/\r\n\r\n// 2D simplex noise\r\nmyModule.simplex2 = function (xin: number, yin: number): number {\r\n    let n0, n1, n2; // Noise contributions from the three corners\r\n    // Skew the input space to determine which simplex cell we're in\r\n    const s = (xin+yin)*F2; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    const t = (i+j)*G2;\r\n    const x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    const y0 = yin-j+t;\r\n    // For the 2D case, the simplex shape is an equilateral triangle.\r\n    // Determine which simplex we are in.\r\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\r\n    if (x0>y0) { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\r\n        i1=1; j1=0;\r\n    } else {    // upper triangle, YX order: (0,0)->(0,1)->(1,1)\r\n        i1=0; j1=1;\r\n    }\r\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\r\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\r\n    // c = (3-sqrt(3))/6\r\n    const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\r\n    const y1 = y0 - j1 + G2;\r\n    const x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\r\n    const y2 = y0 - 1 + 2 * G2;\r\n    // Work out the hashed gradient indices of the three simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    const gi0 = gradP[i+perm[j]];\r\n    const gi1 = gradP[i+i1+perm[j+j1]];\r\n    const gi2 = gradP[i+1+perm[j+1]];\r\n    // Calculate the contribution from the three corners\r\n    let t0 = 0.5 - x0*x0-y0*y0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot2(x0, y0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.5 - x1*x1-y1*y1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\r\n    }\r\n    let t2 = 0.5 - x2*x2-y2*y2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 70 * (n0 + n1 + n2);\r\n};\r\n/*\r\n// 3D simplex noise\r\nmyModule.simplex3 = function(xin, yin, zin) {\r\n    let n0, n1, n2, n3; // Noise contributions from the four corners\r\n\r\n    // Skew the input space to determine which simplex cell we're in\r\n    let s = (xin+yin+zin)*F3; // Hairy factor for 2D\r\n    let i = Math.floor(xin+s);\r\n    let j = Math.floor(yin+s);\r\n    let k = Math.floor(zin+s);\r\n\r\n    let t = (i+j+k)*G3;\r\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\r\n    let y0 = yin-j+t;\r\n    let z0 = zin-k+t;\r\n\r\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\r\n    // Determine which simplex we are in.\r\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\r\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\r\n    if (x0 >= y0) {\r\n        if (y0 >= z0)      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; }\r\n        else if (x0 >= z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; }\r\n        else              { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; }\r\n    } else {\r\n        if (y0 < z0)      { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; }\r\n        else if (x0 < z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; }\r\n        else             { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; }\r\n    }\r\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\r\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\r\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\r\n    // c = 1/6.\r\n    let x1 = x0 - i1 + G3; // Offsets for second corner\r\n    let y1 = y0 - j1 + G3;\r\n    let z1 = z0 - k1 + G3;\r\n\r\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\r\n    let y2 = y0 - j2 + 2 * G3;\r\n    let z2 = z0 - k2 + 2 * G3;\r\n\r\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\r\n    let y3 = y0 - 1 + 3 * G3;\r\n    let z3 = z0 - 1 + 3 * G3;\r\n\r\n    // Work out the hashed gradient indices of the four simplex corners\r\n    i &= 255;\r\n    j &= 255;\r\n    k &= 255;\r\n    let gi0 = gradP[i+   perm[j+   perm[k   ]]];\r\n    let gi1 = gradP[i+i1+perm[j+j1+perm[k+k1]]];\r\n    let gi2 = gradP[i+i2+perm[j+j2+perm[k+k2]]];\r\n    let gi3 = gradP[i+ 1+perm[j+ 1+perm[k+ 1]]];\r\n\r\n    // Calculate the contribution from the four corners\r\n    let t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\r\n    if (t0<0) {\r\n        n0 = 0;\r\n    } else {\r\n        t0 *= t0;\r\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0);  // (x,y) of grad3 used for 2D gradient\r\n    }\r\n    let t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\r\n    if (t1<0) {\r\n        n1 = 0;\r\n    } else {\r\n        t1 *= t1;\r\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\r\n    }\r\n    let t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\r\n    if (t2<0) {\r\n        n2 = 0;\r\n    } else {\r\n        t2 *= t2;\r\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\r\n    }\r\n    let t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\r\n    if (t3<0) {\r\n        n3 = 0;\r\n    } else {\r\n        t3 *= t3;\r\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\r\n    }\r\n    // Add contributions from each corner to get the final noise value.\r\n    // The result is scaled to return values in the interval [-1,1].\r\n    return 32 * (n0 + n1 + n2 + n3);\r\n\r\n};\r\n*/\r\n// ##### Perlin noise stuff\r\n/*\r\nfunction fade(t) {\r\n    return t*t*t*(t*(t*6-15)+10);\r\n}\r\n\r\nfunction lerp(a, b, t) {\r\n    return (1-t)*a + t*b;\r\n}\r\n\r\n// 2D Perlin Noise\r\nmyModule.perlin2 = function(x, y) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y);\r\n    // Get relative xy coordinates of point within that cell\r\n    x = x - X; y = y - Y;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255;\r\n\r\n    // Calculate noise contributions from each of the four corners\r\n    let n00 = gradP[X+perm[Y]].dot2(x, y);\r\n    let n01 = gradP[X+perm[Y+1]].dot2(x, y-1);\r\n    let n10 = gradP[X+1+perm[Y]].dot2(x-1, y);\r\n    let n11 = gradP[X+1+perm[Y+1]].dot2(x-1, y-1);\r\n\r\n    // Compute the fade curve value for x\r\n    let u = fade(x);\r\n\r\n    // Interpolate the four results\r\n    return lerp(\r\n        lerp(n00, n10, u),\r\n        lerp(n01, n11, u),\r\n        fade(y));\r\n};*/\r\n/*\r\n// 3D Perlin Noise\r\nmyModule.perlin3 = function(x, y, z) {\r\n    // Find unit grid cell containing point\r\n    let X = Math.floor(x), Y = Math.floor(y), Z = Math.floor(z);\r\n    // Get relative xyz coordinates of point within that cell\r\n    x = x - X; y = y - Y; z = z - Z;\r\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\r\n    X = X & 255; Y = Y & 255; Z = Z & 255;\r\n\r\n    // Calculate noise contributions from each of the eight corners\r\n    let n000 = gradP[X+  perm[Y+  perm[Z  ]]].dot3(x,   y,     z);\r\n    let n001 = gradP[X+  perm[Y+  perm[Z+1]]].dot3(x,   y,   z-1);\r\n    let n010 = gradP[X+  perm[Y+1+perm[Z  ]]].dot3(x,   y-1,   z);\r\n    let n011 = gradP[X+  perm[Y+1+perm[Z+1]]].dot3(x,   y-1, z-1);\r\n    let n100 = gradP[X+1+perm[Y+  perm[Z  ]]].dot3(x-1,   y,   z);\r\n    let n101 = gradP[X+1+perm[Y+  perm[Z+1]]].dot3(x-1,   y, z-1);\r\n    let n110 = gradP[X+1+perm[Y+1+perm[Z  ]]].dot3(x-1, y-1,   z);\r\n    let n111 = gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1, y-1, z-1);\r\n\r\n    // Compute the fade curve value for x, y, z\r\n    let u = fade(x);\r\n    let v = fade(y);\r\n    let w = fade(z);\r\n\r\n    // Interpolate\r\n    return lerp(\r\n        lerp(\r\n            lerp(n000, n100, u),\r\n            lerp(n001, n101, u), w),\r\n        lerp(\r\n            lerp(n010, n110, u),\r\n            lerp(n011, n111, u), w),\r\n        v);\r\n};*/\r\n\r\nexport const noise = myModule;","import {BB} from '../../bb/bb';\r\nimport {IRGB, IRGBA} from '../kl-types';\r\nimport {IBounds, IPressureInput} from '../../bb/bb-types';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {clamp} from '../../bb/math/math';\r\n\r\nexport interface IBlendBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'BlendBrush'];\r\n    actions: THistoryInnerActions<BlendBrush>[];\r\n}\r\n\r\nconst cellSize = 256;\r\n\r\ninterface IDrawBufferItem {\r\n    x: number;\r\n    y: number;\r\n    size: number;\r\n    opacity: number;\r\n    x1: number;\r\n    y1: number;\r\n    x2: number;\r\n    y2: number;\r\n    r: number;\r\n    g: number;\r\n    b: number;\r\n}\r\n\r\nexport class BlendBrush {\r\n\r\n    private isTesting: boolean = false; // testing mode - context only gets updated when line is finished\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private color: IRGB;\r\n    private size: number = 29; // radius - 0.5 - 99999\r\n    private opacity: number = 0.6; // 0-1\r\n    private blending: number = 0.65; // 0-1\r\n\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingSizePressure: boolean = true;\r\n    private settingOpacityPressure: boolean = false;\r\n\r\n    private blendCol: IRGBA = {r: 0, g: 0, b: 0, a: 1}; // todo docs\r\n    private blendMix: number = 0.45; // todo docs\r\n    private mixr: number; // todo docs\r\n    private mixg: number; // todo docs\r\n    private mixb: number; // todo docs\r\n    private localColOld: IRGBA; // todo docs\r\n\r\n    private isDrawing: boolean = false;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\r\n    private bezierLine: any; // todo type\r\n\r\n    private history: KlHistoryInterface | null;\r\n    private historyEntry: IBlendBrushHistoryEntry;\r\n    private redrawBounds: IBounds;\r\n    private cells: (ImageData | null)[];\r\n    private drawBuffer: IDrawBufferItem[];\r\n\r\n    private updateRedrawBounds (bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    private getCellsWidth (): number {\r\n        return Math.ceil(this.context.canvas.width / cellSize);\r\n    }\r\n\r\n    /**\r\n     * draw changed cells (changed by brushstroke) onto context\r\n     * @private\r\n     */\r\n    private drawChangedCells (): void {\r\n        const cells = this.cells.map(item => null);\r\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\r\n        touchedCells.forEach((isTouched, index) => {\r\n            if (isTouched) {\r\n                cells[index] = this.cells[index];\r\n            }\r\n        });\r\n        this.drawCells(cells);\r\n        this.redrawBounds = null;\r\n    }\r\n\r\n    private getTouchedCells (bounds: IBounds): boolean[] {\r\n        const touchedCells = this.cells.map(item => false);\r\n        const cellsW = this.getCellsWidth();\r\n        bounds = {\r\n            x1: Math.floor(bounds.x1 / cellSize),\r\n            y1: Math.floor(bounds.y1 / cellSize),\r\n            x2: Math.floor(bounds.x2 / cellSize),\r\n            y2: Math.floor(bounds.y2 / cellSize),\r\n        };\r\n        for (let i = bounds.x1; i <= bounds.x2; i++) {\r\n            for (let e = bounds.y1; e <= bounds.y2; e++) {\r\n                touchedCells[e * cellsW + i] = true;\r\n            }\r\n        }\r\n        return touchedCells;\r\n    }\r\n\r\n    /**\r\n     * Slice up bounds accordings to cells\r\n     * @param bounds\r\n     * @private\r\n     */\r\n    private sliceBounds (bounds: IBounds): {index: number; bounds: IBounds}[] {\r\n        const cellsW = this.getCellsWidth();\r\n        const result: {index: number; bounds: IBounds}[] = [];\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n\r\n        touchedCells.forEach((cell, i) => {\r\n            if (!cell) {\r\n                return;\r\n            }\r\n\r\n            const cellOffsetX = (i % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(i / cellsW) * cellSize;\r\n            const cellWidth = this.cells[i].width;\r\n            const cellHeight = this.cells[i].height;\r\n\r\n            const inCellBounds = {\r\n                x1: Math.max(0, bounds.x1 - cellOffsetX),\r\n                y1: Math.max(0, bounds.y1 - cellOffsetY),\r\n                x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\r\n                y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY),\r\n            };\r\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) {\r\n                return;\r\n            }\r\n            result.push({\r\n                index: i,\r\n                bounds: inCellBounds,\r\n            });\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    private copyFromCanvas (bounds: IBounds) {\r\n        if (!bounds) {\r\n            return;\r\n        }\r\n\r\n        const touchedCells = this.getTouchedCells(bounds);\r\n        const cellsW = this.getCellsWidth();\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.cells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * cellSize + cellSize, this.context.canvas.width) - 1) % cellSize + 1;\r\n            const h = (Math.min(y * cellSize + cellSize, this.context.canvas.height) - 1) % cellSize + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = BB.ctx(tmpCanvas);\r\n            tmpCtx.drawImage(this.context.canvas, -x * cellSize, -y * cellSize);\r\n\r\n            this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\r\n        });\r\n    }\r\n\r\n    private getAverage (x, y, size): IRGBA {\r\n\r\n        size = Math.max(0.5, size * 0.75);\r\n        const x1 = Math.max(0, Math.floor(x - size));\r\n        const y1 = Math.max(0, Math.floor(y - size));\r\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return {\r\n                r: 0,\r\n                g: 0,\r\n                b: 0,\r\n                a: 0,\r\n            };\r\n        }\r\n\r\n        let ar = 0, ag = 0, ab = 0, aa = 0, alpha;\r\n\r\n        const slicedBounds = this.sliceBounds({ x1, y1, x2, y2 });\r\n        slicedBounds.forEach(slice => {\r\n            const width = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n            const bounds = slice.bounds;\r\n\r\n            for (let i = bounds.y1; i <= bounds.y2; i += 4) {\r\n                for (let e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 4 * 4) {\r\n                    alpha = data[e2 + 3];\r\n                    ar += data[e2] * alpha;\r\n                    ag += data[e2 + 1] * alpha;\r\n                    ab += data[e2 + 2] * alpha;\r\n                    aa += alpha;\r\n                }\r\n            }\r\n        });\r\n\r\n        if (aa !== 0) {\r\n            ar /= aa;\r\n            ag /= aa;\r\n            ab /= aa;\r\n            aa = Math.min(1, aa);\r\n        }\r\n        return {\r\n            r: ar,\r\n            g: ag,\r\n            b: ab,\r\n            a: aa,\r\n        };\r\n    }\r\n\r\n    private prepDot (x: number, y: number, size: number): IBounds {\r\n        size = Math.max(0.5, size);\r\n        const x1 = Math.max(0, Math.floor(x - size));\r\n        const y1 = Math.max(0, Math.floor(y - size));\r\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\r\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\r\n        if (x1 > x2 || y1 > y2) {\r\n            return null;\r\n        }\r\n        return { x1, y1, x2, y2 };\r\n    }\r\n\r\n    private drawDot (params: IDrawBufferItem): void {\r\n        // array with random numbers. faster than Math.random()\r\n        let randI = 0;\r\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n        const randArr = [];\r\n        for (let i = 0; i < randLen; i++) {\r\n            randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n        }\r\n\r\n        // thin lines take more than just 1 sample\r\n        const sampleArr = [8,4,4,4,2,2,2,2,2,2]; // <0.5, 0.5, 1, 1.5, etc.\r\n        const samples = sampleArr[Math.floor(params.size * 2)];\r\n        const samplesSquared: number = samples ? samples * samples : 0;\r\n        const sampleOffsets = [];\r\n        if (samples) {\r\n            let i = 0;\r\n            for (let n = 0; n < samples; n++) {\r\n                for (let m = 0; m < samples; m++, i += 2) {\r\n                    sampleOffsets[i] = (n + 1) / samples; // x offset\r\n                    sampleOffsets[i + 1] = (m + 1) / samples; // y offset\r\n                }\r\n            }\r\n        }\r\n\r\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\r\n        // to optimize calculations\r\n        const invSharpness = 1 - sharpness;\r\n        const sharpnessSubtrahend = sharpness / invSharpness;\r\n        const sizeSquared = params.size * params.size;\r\n        const distDivisor = sizeSquared * invSharpness / params.opacity;\r\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\r\n\r\n\r\n        const slicedBounds = this.sliceBounds({\r\n            x1: params.x1,\r\n            y1: params.y1,\r\n            x2: params.x2,\r\n            y2: params.y2,\r\n        });\r\n\r\n        const cellsW = this.getCellsWidth();\r\n        slicedBounds.forEach(slice => {\r\n            const cellOffsetX = (slice.index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(slice.index / cellsW) * cellSize;\r\n            const cellWidth = this.cells[slice.index].width;\r\n            const data = this.cells[slice.index].data;\r\n\r\n            // i - y index within cell\r\n            // e - x index within cell\r\n\r\n            // e2 - index in image data\r\n\r\n            // ri - y index within image relative to dot-center\r\n            // re - x index within image relative to dot-center\r\n\r\n            for (let i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++) {\r\n                for (\r\n                    let e = slice.bounds.x1,\r\n                        e2 = i * cellWidth * 4 + slice.bounds.x1 * 4,\r\n                        re = e + cellOffsetX - params.x;\r\n                    e <= slice.bounds.x2;\r\n                    e++,\r\n                        e2 += 4,\r\n                        re++\r\n                ) {\r\n                    // O = over -> brush-dot\r\n                    // U = under -> image\r\n\r\n                    let alphaO = 0;\r\n                    if (samplesSquared) {\r\n                        for (let f = 0; f < sampleOffsets.length; f += 2) {\r\n                            const dist = BB.lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\r\n                            if (dist >= sizeSquared) {\r\n                                continue;\r\n                            }\r\n                            alphaO += clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                        }\r\n                        if (!alphaO) {\r\n                            continue;\r\n                        }\r\n                        alphaO /= samplesSquared;\r\n                    } else {\r\n                        // technically needs + 0.5 offset, but not noticeable with large brush\r\n                        const dist = Math.pow(re, 2) + Math.pow(ri, 2);\r\n                        if (dist >= sizeSquared) {\r\n                            continue;\r\n                        }\r\n                        alphaO = clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\r\n                    }\r\n\r\n                    const invAlphaO = 1 - alphaO;\r\n                    const alphaU =data[e2 + 3] / 255;\r\n\r\n                    if (this.settingLockLayerAlpha) {\r\n                        const underR = (params.r * alphaO) + ((data[e2]) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1]) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2]) * invAlphaO);\r\n                        if (alphaU) {\r\n                            data[e2] = Math.floor(underR + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB + randArr[randI]);\r\n                        }\r\n                    } else {\r\n                        const underR = (params.r * alphaO) + ((data[e2] * alphaU) * invAlphaO);\r\n                        const underG = (params.g * alphaO) + ((data[e2 + 1] * alphaU) * invAlphaO);\r\n                        const underB = (params.b * alphaO) + ((data[e2 + 2] * alphaU) * invAlphaO);\r\n\r\n                        const newAlpha = 1 - invAlphaO * (1 - alphaU);\r\n                        data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\r\n                        if (newAlpha) {\r\n                            data[e2] = Math.floor(underR / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 1] = Math.floor(underG / (newAlpha) + randArr[randI]);\r\n                            data[e2 + 2] = Math.floor(underB / (newAlpha) + randArr[randI]);\r\n                        }\r\n                    }\r\n                    randI = (randI + 1) % randLen;\r\n\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    private calcSpacing (size: number): number {\r\n        return BB.mix(\r\n            (size * 2) / 2, // until size 5.3\r\n            (size * 2) / 9, // at size 24\r\n            clamp((size - 2.7) / (12 - 2.7), 0, 1)\r\n        );\r\n    }\r\n\r\n    private continueLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n\r\n        this.drawBuffer = [];\r\n\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (this.settingSizePressure) ? Math.max(1, p * this.size) : Math.max(1, this.size);\r\n\r\n        const bdist = this.calcSpacing(localSize);\r\n\r\n        let avgX = x;\r\n        let avgY = y;\r\n        if (x === null) {\r\n            avgX = this.lastInput.x;\r\n            avgY = this.lastInput.y;\r\n        }\r\n\r\n        let localColNew;\r\n\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            let average;\r\n            if (isCoalesced) {\r\n                average = {r: this.localColOld.r, g: this.localColOld.g, b: this.localColOld.b, a: 0};\r\n            } else {\r\n                const avgParams = [avgX, avgY, ((this.settingSizePressure) ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size))];\r\n                const bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\r\n                this.copyFromCanvas(bounds);\r\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\r\n            }\r\n            localColNew = {r: 0, g: 0, b: 0, a: 0};\r\n\r\n            if (average.a > 0 && this.blendCol.a === 0) {\r\n                this.blendCol.r = average.r;\r\n                this.blendCol.g = average.g;\r\n                this.blendCol.b = average.b;\r\n                this.blendCol.a = average.a;\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n\r\n            } else {\r\n                if (average.a === 0) {\r\n                    average.r = this.color.r;\r\n                    average.g = this.color.g;\r\n                    average.b = this.color.b;\r\n                    average.a = 1 - this.blending;\r\n                }\r\n\r\n                this.blendCol.r = BB.mix(this.blendCol.r, BB.mix(this.blendCol.r, average.r, this.blendMix), average.a);\r\n                this.blendCol.g = BB.mix(this.blendCol.g, BB.mix(this.blendCol.g, average.g, this.blendMix), average.a);\r\n                this.blendCol.b = BB.mix(this.blendCol.b, BB.mix(this.blendCol.b, average.b, this.blendMix), average.a);\r\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\r\n                localColNew.r = this.blendCol.r;\r\n                localColNew.g = this.blendCol.g;\r\n                localColNew.b = this.blendCol.b;\r\n                localColNew.a = this.blendCol.a;\r\n            }\r\n\r\n        }\r\n\r\n\r\n        const bezierCallback = (val) => {\r\n            if (this.blending >= 1 && this.blendCol.a <= 0) {\r\n                return;\r\n            }\r\n            const factor = val.t;\r\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (this.settingOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\r\n            localSize = (this.settingSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\r\n            if (this.blending != 0) {\r\n                this.mixr = BB.mix(this.localColOld.r, localColNew.r, factor);\r\n                this.mixg = BB.mix(this.localColOld.g, localColNew.g, factor);\r\n                this.mixb = BB.mix(this.localColOld.b, localColNew.b, factor);\r\n            }\r\n            if (this.blending === 1 && this.localColOld.a === 0) {\r\n                this.mixr = localColNew.r;\r\n                this.mixg = localColNew.g;\r\n                this.mixb = localColNew.b;\r\n            }\r\n            const bounds = this.prepDot(val.x, val.y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: val.x,\r\n                    y: val.y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                });\r\n            }\r\n        };\r\n\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.localColOld = localColNew;\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.size;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.size = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.opacity = o;\r\n    }\r\n\r\n    getBlending (): number {\r\n        return this.blending;\r\n    }\r\n\r\n    setBlending (b: number) {\r\n        this.blending = b;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.color = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setSizePressure (b: boolean): void {\r\n        this.settingSizePressure = !!b;\r\n    }\r\n\r\n    setOpacityPressure (b: boolean): void {\r\n        this.settingOpacityPressure = !!b;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setIsTesting (b: boolean): void {\r\n        this.isTesting = !!b;\r\n    }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'BlendBrush'],\r\n            actions: [],\r\n        };\r\n\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n\r\n        this.isDrawing = true;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n        if (this.blending === 0) {\r\n            this.mixr = this.color.r;\r\n            this.mixg = this.color.g;\r\n            this.mixb = this.color.b;\r\n        } else {\r\n            this.copyFromCanvas(this.prepDot(x, y, localSize));\r\n\r\n            const average = this.getAverage(\r\n                x,\r\n                y,\r\n                ((this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size))\r\n            );\r\n            if (average.a === 0) {\r\n                this.blendCol = {\r\n                    r: this.color.r,\r\n                    g: this.color.g,\r\n                    b: this.color.b,\r\n                    a: 1 - this.blending,\r\n                };\r\n            } else {\r\n                this.blendCol = {\r\n                    r: average.r,\r\n                    g: average.g,\r\n                    b: average.b,\r\n                    a: average.a,\r\n                };\r\n            }\r\n\r\n            this.mixr = this.blendCol.r;\r\n            this.mixg = this.blendCol.g;\r\n            this.mixb = this.blendCol.b;\r\n        }\r\n\r\n        this.localColOld = {r: this.mixr, g: this.mixg, b: this.mixb, a: this.blendCol.a};\r\n\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        if (this.blending < 1 || this.blendCol.a > 0) {\r\n            const bounds = this.prepDot(x, y, localSize);\r\n            if (bounds) {\r\n                this.updateRedrawBounds(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x,\r\n                    y: y,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                });\r\n            }\r\n        }\r\n\r\n        this.copyFromCanvas(this.redrawBounds);\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        this.bezierLine = new BB.BezierLine();\r\n        this.bezierLine.add(x, y, 0, function () {\r\n        });\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number, isCoalesced: boolean): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n\r\n        if (this.redrawBounds && !this.isTesting) {\r\n            this.drawChangedCells();\r\n        }\r\n    }\r\n\r\n    endLine (): void {\r\n        if (this.bezierLine) {\r\n            this.continueLine(null, null, this.lastInput.pressure, false);\r\n        }\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.drawChangedCells();\r\n        }\r\n\r\n        if (this.historyEntry && this.history && this.cells.find(item => !!item)) {\r\n            this.historyEntry.actions.push({\r\n                action: 'drawCells',\r\n                params: [this.cells],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n\r\n    /**\r\n     * draw cells onto context\r\n     * @param cells\r\n     */\r\n    drawCells (cells: (ImageData | null)[]): void {\r\n        const cellsW = this.getCellsWidth();\r\n        cells.forEach((imageData, index) => {\r\n            if (!imageData) {\r\n                return;\r\n            }\r\n            const cellOffsetX = (index % cellsW) * cellSize;\r\n            const cellOffsetY = Math.floor(index / cellsW) * cellSize;\r\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\r\n        });\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\r\n        this.cells = '0'.repeat(totalCells).split('').map(item => null);\r\n        this.redrawBounds = null;\r\n        this.drawBuffer = [];\r\n\r\n        this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\r\n        const average = this.getAverage(x1, y1, Math.max(0.1, this.size));\r\n\r\n        if (average.a === 0) {\r\n            this.blendCol = {\r\n                r: this.color.r,\r\n                g: this.color.g,\r\n                b: this.color.b,\r\n                a: 1 - this.blending,\r\n            };\r\n        } else {\r\n            this.blendCol = {\r\n                r: average.r,\r\n                g: average.g,\r\n                b: average.b,\r\n                a: average.a,\r\n            };\r\n        }\r\n\r\n        this.mixr = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixg = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\r\n        this.mixb = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\r\n\r\n\r\n        const p = 1;\r\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        const bdist = this.calcSpacing(localSize);\r\n        for (let loopDist = 0; loopDist <= mouseDist; loopDist += bdist) {\r\n            const bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\r\n            if (bounds) {\r\n                this.copyFromCanvas(bounds);\r\n                this.drawBuffer.push({\r\n                    x: x1 + eX * loopDist,\r\n                    y: y1 + eY * loopDist,\r\n                    size: localSize,\r\n                    opacity: localOpacity,\r\n                    x1: bounds.x1,\r\n                    y1: bounds.y1,\r\n                    x2: bounds.x2,\r\n                    y2: bounds.y2,\r\n                    r: BB.mix(this.color.r, this.mixr, this.blending),\r\n                    g: BB.mix(this.color.g, this.mixg, this.blending),\r\n                    b: BB.mix(this.color.b, this.mixb, this.blending),\r\n                });\r\n            }\r\n        }\r\n        this.drawBuffer.forEach(item => {\r\n            this.drawDot(item);\r\n        });\r\n        this.drawBuffer = [];\r\n\r\n        if (this.history && this.cells.find(item => !!item)) {\r\n            this.drawCells(this.cells);\r\n            this.historyEntry = {\r\n                tool: ['brush', 'BlendBrush'],\r\n                actions: [{\r\n                    action: 'drawCells',\r\n                    params: [this.cells],\r\n                }],\r\n            };\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = null;\r\n        }\r\n        this.cells = null;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB, TPressureInput} from '../kl-types';\r\n\r\nexport interface ISketchyBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'SketchyBrush'];\r\n    actions: THistoryInnerActions<SketchyBrush>[];\r\n}\r\n\r\nconst sampleCanvas = BB.canvas(32, 32);\r\nconst sampleCtx = BB.ctx(sampleCanvas);\r\n\r\nexport class SketchyBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private settingColor: IRGB;\r\n    private settingSize: number = 1;\r\n    private settingOpacity: number = 0.2;\r\n    private settingBlending: number = 0.5;\r\n    private settingScale: number = 1;\r\n    private lastX: number = 0;\r\n    private lastY: number = 0;\r\n    private inputIsDrawing: boolean = false;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: ISketchyBrushHistoryEntry | undefined;\r\n    private sketchySeed: number = 0;\r\n    private points: [number, number][] = []; // x y\r\n    private count: number = 0;\r\n    private readonly mixmode = [\r\n        (c1: IRGB, c2: IRGB) => {\r\n            return c1;\r\n        },\r\n        (c1: IRGB, c2: IRGB) => { // why\r\n            const result = new BB.RGB(c1.r, c1.g, c1.b);\r\n            result.r *= c2.r / 255;\r\n            result.g *= c2.g / 255;\r\n            result.b *= c2.b / 255;\r\n            return result;\r\n        },\r\n    ];\r\n\r\n\r\n    private rand (): number {\r\n        this.sketchySeed++;\r\n        return Math.sin(6324634.2345 * Math.cos(this.sketchySeed * 5342.3423)) * 0.5 + 0.5;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor () {}\r\n\r\n    // ---- interface ----\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSeed (s: number): void {\r\n        this.sketchySeed = parseInt('' + s);\r\n    }\r\n\r\n    getSeed (): number {\r\n        return parseInt('' + this.sketchySeed);\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize / 2;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.settingColor = c;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    getBlending (): number {\r\n        return this.settingBlending;\r\n    }\r\n\r\n    setBlending (b: number): void {\r\n        this.settingBlending = b;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s * 2;\r\n    }\r\n\r\n    getScale (): number {\r\n        return this.settingScale;\r\n    }\r\n\r\n    setScale (s: number): void {\r\n        this.settingScale = s;\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    startLine (x: number, y: number, pressure: number, shift?: boolean): void {\r\n        if (shift && this.lastInput.x) {\r\n            this.inputIsDrawing = true;\r\n            this.endLine();\r\n        } else {\r\n            this.inputIsDrawing = true;\r\n            this.lastX = x;\r\n            this.lastY = y;\r\n            this.lastInput.x = x;\r\n            this.lastInput.y = y;\r\n            this.historyEntry = {\r\n                tool: ['brush', 'SketchyBrush'],\r\n                actions: [\r\n                    {\r\n                        action: 'setScale',\r\n                        params: [this.settingScale],\r\n                    },\r\n                    {\r\n                        action: 'setSize',\r\n                        params: [this.settingSize / 2],\r\n                    },\r\n                    {\r\n                        action: 'setOpacity',\r\n                        params: [this.settingOpacity],\r\n                    },\r\n                    {\r\n                        action: 'setColor',\r\n                        params: [this.settingColor],\r\n                    },\r\n                    {\r\n                        action: 'setBlending',\r\n                        params: [this.settingBlending],\r\n                    },\r\n                    {\r\n                        action: 'startLine',\r\n                        params: [x, y, pressure],\r\n                    },\r\n                ],\r\n            };\r\n        }\r\n\r\n    }\r\n\r\n    goLine (p_x: number, p_y: number, pressure: number, preMixedColor: IRGB): void {\r\n        if (!this.inputIsDrawing || (p_x === this.lastInput.x && p_y === this.lastInput.y)) {\r\n            return;\r\n        }\r\n\r\n        let e, b, a, g;\r\n        const x = parseInt('' + p_x);\r\n        const y = parseInt('' + p_y);\r\n        this.points.push([x, y]);\r\n\r\n        let mixr = this.settingColor.r;\r\n        let mixg = this.settingColor.g;\r\n        let mixb = this.settingColor.b;\r\n\r\n        if (preMixedColor !== null) {\r\n            mixr = preMixedColor.r;\r\n            mixg = preMixedColor.g;\r\n            mixb = preMixedColor.b;\r\n        } else {\r\n            if (this.settingBlending !== 0) {\r\n                if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < this.context.canvas.width - 1 && y - 5 < this.context.canvas.height - 1) {\r\n                    mixr = 0;\r\n                    mixg = 0;\r\n                    mixb = 0;\r\n                    const mixx = Math.min(this.context.canvas.width - 1, Math.max(0, x - 5));\r\n                    const mixy = Math.min(this.context.canvas.height - 1, Math.max(0, y - 5));\r\n                    let mixw = Math.min(this.context.canvas.width - 1, Math.max(0, x + 5));\r\n                    let mixh = Math.min(this.context.canvas.height - 1, Math.max(0, y + 5));\r\n                    mixw -= mixx;\r\n                    mixh -= mixy;\r\n\r\n                    if (mixw > 0 && mixh > 0) {\r\n                        const imdat = this.context.getImageData(mixx, mixy, mixw, mixh);\r\n                        let countmix = 0;\r\n                        for (let i = 0; i < imdat.data.length; i += 4) {\r\n                            mixr += imdat.data[i + 0];\r\n                            mixg += imdat.data[i + 1];\r\n                            mixb += imdat.data[i + 2];\r\n                            countmix++;\r\n                        }\r\n                        mixr /= countmix;\r\n                        mixg /= countmix;\r\n                        mixb /= countmix;\r\n                    }\r\n\r\n                    const mixed = this.mixmode[0](new BB.RGB(mixr, mixg, mixb), this.settingColor);\r\n                    mixr = parseInt('' + BB.mix(this.settingColor.r, mixed.r, this.settingBlending));\r\n                    mixg = parseInt('' + BB.mix(this.settingColor.g, mixed.g, this.settingBlending));\r\n                    mixb = parseInt('' + BB.mix(this.settingColor.b, mixed.b, this.settingBlending));\r\n                }\r\n            }\r\n        }\r\n\r\n        this.context.save();\r\n        this.context.strokeStyle = 'rgba(' + mixr + ', ' + mixg + ', ' + mixb + ', ' + this.settingOpacity + ')';\r\n        this.context.lineWidth = this.settingSize;\r\n\r\n        this.context.beginPath();\r\n        this.context.moveTo(this.lastX, this.lastY);\r\n        this.context.lineTo(x, y);\r\n\r\n        for (e = 0; e < this.points.length; e++) {\r\n            b = this.points[e][0] - this.points[this.count][0];\r\n            a = this.points[e][1] - this.points[this.count][1];\r\n            g = b * b + a * a;\r\n            if (g < 4000 * this.settingScale * this.settingScale && this.rand() > g / 2000 / this.settingScale / this.settingScale) {\r\n                this.context.moveTo(this.points[this.count][0] + (b * 0.3), this.points[this.count][1] + (a * 0.3));\r\n                this.context.lineTo(this.points[e][0] - (b * 0.3), this.points[e][1] - (a * 0.3));\r\n            }\r\n        }\r\n\r\n        this.context.stroke();\r\n        this.context.restore();\r\n\r\n\r\n        this.count++;\r\n        this.lastX = x;\r\n        this.lastY = y;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.historyEntry!.actions!.push({\r\n            action: 'goLine',\r\n            params: [p_x, p_y, pressure, {r: mixr, g: mixg, b: mixb}],\r\n        });\r\n    }\r\n\r\n    endLine (): void {\r\n        this.inputIsDrawing = false;\r\n        this.count = 0;\r\n        this.points = [];\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions!.push({\r\n                action: 'endLine',\r\n                params: [],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n    }\r\n    //cheap n' ugly\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.inputIsDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n\r\n        this.context.save();\r\n        this.context.lineWidth = this.settingSize;\r\n\r\n        let mixr = this.settingColor.r, mixg = this.settingColor.g, mixb = this.settingColor.b;\r\n        if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < this.context.canvas.width - 1 && y1 - 5 < this.context.canvas.height - 1) {\r\n            mixr = 0;\r\n            mixg = 0;\r\n            mixb = 0;\r\n            const mixx = Math.min(this.context.canvas.width - 1, Math.max(0, x1 - 5));\r\n            const mixy = Math.min(this.context.canvas.height - 1, Math.max(0, y1 - 5));\r\n            let mixw = Math.min(this.context.canvas.width - 1, Math.max(0, x1 + 5));\r\n            let mixh = Math.min(this.context.canvas.height - 1, Math.max(0, y1 + 5));\r\n            mixw -= mixx;\r\n            mixh -= mixy;\r\n            if (mixw > 0 && mixh > 0) {\r\n                const w = Math.min(sampleCanvas.width, mixw);\r\n                const h = Math.min(sampleCanvas.height, mixh);\r\n                sampleCtx.save();\r\n                sampleCtx.globalCompositeOperation = 'copy';\r\n                sampleCtx.drawImage(this.context.canvas, mixx, mixy, mixw, mixh, 0, 0, w, h);\r\n                sampleCtx.restore();\r\n\r\n                const imdat = sampleCtx.getImageData(mixx, mixy, mixw, mixh);\r\n                let countmix = 0;\r\n                for (let i = 0; i < imdat.data.length; i += 4) {\r\n                    mixr += imdat.data[i + 0];\r\n                    mixg += imdat.data[i + 1];\r\n                    mixb += imdat.data[i + 2];\r\n                    countmix++;\r\n                }\r\n                mixr /= countmix;\r\n                mixg /= countmix;\r\n                mixb /= countmix;\r\n            }\r\n        }\r\n        const mixed = this.mixmode[0](new BB.RGB(mixr, mixg, mixb), this.settingColor);\r\n        mixr = parseInt('' + (this.settingBlending * mixed.r + this.settingColor.r * (1 - this.settingBlending)));\r\n        mixg = parseInt('' + (this.settingBlending * mixed.g + this.settingColor.g * (1 - this.settingBlending)));\r\n        mixb = parseInt('' + (this.settingBlending * mixed.b + this.settingColor.b * (1 - this.settingBlending)));\r\n        this.context.strokeStyle = 'rgba(' + mixr + ', ' + mixg + ', ' + mixb + ', ' + this.settingOpacity + ')';\r\n        this.context.beginPath();\r\n        this.context.moveTo(x1, y1);\r\n        this.context.lineTo(x2, y2);\r\n        this.context.stroke();\r\n        this.context.strokeStyle = 'rgba(' + mixr + ', ' + mixg + ', ' + mixb + ', ' + this.settingOpacity + ')';\r\n        this.context.restore();\r\n\r\n        const historyEntry: ISketchyBrushHistoryEntry = {\r\n            tool: ['brush', 'SketchyBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'setScale',\r\n                    params: [this.settingScale],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize / 2],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setBlending',\r\n                    params: [this.settingBlending],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n\r\n    isDrawing (): boolean {\r\n        return this.inputIsDrawing;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB, TPressureInput} from '../kl-types';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {BezierLine} from '../../bb/math/line';\r\nimport {ERASE_COLOR} from './erase-color';\r\n\r\nexport interface IPixelBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'PixelBrush'];\r\n    actions: THistoryInnerActions<PixelBrush>[];\r\n}\r\n\r\n\r\nexport class PixelBrush {\r\n\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IPixelBrushHistoryEntry | undefined;\r\n    private context: CanvasRenderingContext2D;\r\n    private settingHasSizePressure: boolean = true;\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingSize: number = 0.5;\r\n    private settingSpacing: number = 0.9;\r\n    private settingOpacity: number = 1;\r\n    private settingColor: IRGB;\r\n    private settingColorStr: string;\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingIsEraser: boolean = false;\r\n    private settingUseDither: boolean = true;\r\n    private inputIsDrawing: boolean = false;\r\n    private lineToolLastDot: number;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private bezierLine: BezierLine | null = null;\r\n    private readonly ditherArr: [number, number][] = [\r\n        [3, 2],\r\n        [1, 0],\r\n        [3, 0],\r\n        [1, 2],\r\n        [2, 1],\r\n        [0, 3],\r\n        [0, 1],\r\n        [2, 3],\r\n\r\n        [2, 0],\r\n        [0, 2],\r\n        [0, 0],\r\n        [2, 2],\r\n        [1, 1],\r\n        [3, 3],\r\n        [3, 1],\r\n        [1, 3],\r\n    ];\r\n    private readonly ditherCanvas: HTMLCanvasElement;\r\n    private readonly ditherCtx: CanvasRenderingContext2D;\r\n    private ditherPattern: CanvasPattern;\r\n\r\n\r\n    private updateDither (): void {\r\n        this.ditherCtx.clearRect(0, 0, 4, 4);\r\n        this.ditherCtx.fillStyle = this.settingIsEraser ? `rgb(${ERASE_COLOR},${ERASE_COLOR},${ERASE_COLOR})` : this.settingColorStr;\r\n        for (let i = 0; i < Math.max(1, Math.round(this.settingOpacity * this.ditherArr.length)); i++) {\r\n            this.ditherCtx.fillRect(this.ditherArr[i][0], this.ditherArr[i][1], 1, 1);\r\n        }\r\n        this.ditherPattern = this.context.createPattern(this.ditherCanvas, 'repeat');\r\n    }\r\n\r\n    /**\r\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\r\n     */\r\n    private cubicCurveOverThreshold (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D, maxAngleRad: number): boolean {\r\n        const d = BB.Vec2.nor({\r\n            x: p4.x - p1.x,\r\n            y: p4.y - p1.y,\r\n        });\r\n        const d2 = BB.Vec2.nor({\r\n            x: p2.x - p1.x,\r\n            y: p2.y - p1.y,\r\n        });\r\n        const d3 = BB.Vec2.nor({\r\n            x: p4.x - p3.x,\r\n            y: p4.y - p3.y,\r\n        });\r\n        // const a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\r\n        // const a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\r\n\r\n        return Math.max(BB.Vec2.dist(d, d2), BB.Vec2.dist(d, d3)) > maxAngleRad;\r\n    }\r\n\r\n    private plotCubicBezierLine (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D): void {\r\n\r\n        const isOverThreshold = this.cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\r\n\r\n        p1.x = Math.floor(p1.x);\r\n        p1.y = Math.floor(p1.y);\r\n        p4.x = Math.floor(p4.x);\r\n        p4.y = Math.floor(p4.y);\r\n\r\n        const dist = BB.dist(p1.x, p1.y, p4.x, p4.y);\r\n        if (!isOverThreshold || dist < 7) {\r\n            this.plotLine(p1.x, p1.y, p4.x, p4.y, true);\r\n            return;\r\n        }\r\n\r\n        const n = Math.max(2, Math.round(dist / 4));\r\n        const pointArr = [];\r\n        for (let i = 0; i <= n; i++) {\r\n            const t = i / n;\r\n            const a = Math.pow(1 - t, 3);\r\n            const b = 3 * t * Math.pow(1 - t, 2);\r\n            const c = 3 * Math.pow(t, 2) * (1 - t);\r\n            const d = Math.pow(t, 3);\r\n            pointArr.push({\r\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\r\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y,\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            this.plotLine(\r\n                Math.round(pointArr[i].x),\r\n                Math.round(pointArr[i].y),\r\n                Math.round(pointArr[i + 1].x),\r\n                Math.round(pointArr[i + 1].y),\r\n                true\r\n            );\r\n        }\r\n    }\r\n\r\n    private drawDot (x: number, y: number, size: number, opacity: number): void {\r\n        this.context.save();\r\n        if (this.settingIsEraser) {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : '#fff';\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            }\r\n        } else {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        }\r\n        this.context.globalAlpha = this.settingUseDither ? 1 : opacity;\r\n        this.context.fillRect(\r\n            Math.round(x + -size),\r\n            Math.round(y + -size),\r\n            Math.round(size * 2),\r\n            Math.round(size * 2)\r\n        );\r\n        this.context.restore();\r\n    }\r\n\r\n    private continueLine (\r\n        x: number | null,\r\n        y: number | null,\r\n        size: number,\r\n        pressure: number\r\n    ): void {\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, () => {});\r\n        }\r\n\r\n        this.context.save();\r\n\r\n        const dotCallback = (\r\n            val: {\r\n                x: number;\r\n                y: number;\r\n                t: number;\r\n                angle?: number;\r\n                dAngle: number;\r\n            }\r\n        ): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            const localSize = Math.max(0.5, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            this.drawDot(val.x, val.y, localSize, localOpacity);\r\n        };\r\n\r\n        const controlCallback = (\r\n            controlObj: {\r\n                p1: IVector2D;\r\n                p2: IVector2D;\r\n                p3: IVector2D;\r\n                p4: IVector2D;\r\n            }\r\n        ): void => {\r\n            this.plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\r\n        };\r\n\r\n        if (Math.round(this.settingSize * 2) === 1) {\r\n            if (x === null || y === null) {\r\n                this.bezierLine.addFinal(4, undefined, controlCallback);\r\n            } else {\r\n                this.bezierLine.add(x, y, 4, undefined, controlCallback);\r\n            }\r\n\r\n        } else {\r\n            const localSpacing = size * this.settingSpacing;\r\n\r\n            if (x === null || y === null) {\r\n                this.bezierLine.addFinal(localSpacing, dotCallback);\r\n            } else {\r\n                this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n\r\n    /**\r\n     * bresenheim line drawing\r\n     */\r\n    private plotLine (x0: number, y0: number, x1: number, y1: number, skipFirst: boolean): void {\r\n        this.context.save();\r\n\r\n        if (this.settingIsEraser) {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : '#fff';\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            }\r\n        } else {\r\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        }\r\n        this.context.globalAlpha = this.settingUseDither ? 1 : this.settingOpacity;\r\n\r\n        x0 = Math.floor(x0);\r\n        y0 = Math.floor(y0);\r\n        x1 = Math.floor(x1);\r\n        y1 = Math.floor(y1);\r\n\r\n        const dX = Math.abs(x1 - x0);\r\n        const sX = x0 < x1 ? 1 : -1;\r\n        const dY = -Math.abs(y1 - y0);\r\n        const sY = y0 < y1 ? 1 : -1;\r\n        let err = dX + dY;\r\n        while (true) {\r\n            if (skipFirst) {\r\n                skipFirst = false;\r\n            } else {\r\n                this.context.fillRect(x0, y0, 1, 1);\r\n            }\r\n            if (x0 === x1 && y0 === y1) {\r\n                break;\r\n            }\r\n            const e2 = 2 * err;\r\n            if (e2 >= dY) {\r\n                err += dY;\r\n                x0 += sX;\r\n            }\r\n            if (e2 <= dX) {\r\n                err += dX;\r\n                y0 += sY;\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n    constructor () {\r\n        this.ditherCanvas = BB.canvas(4, 4);\r\n        this.ditherCtx = BB.ctx(this.ditherCanvas);\r\n    }\r\n\r\n    // ---- interface ----\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'PixelBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n                {\r\n                    action: 'setIsEraser',\r\n                    params: [this.settingIsEraser],\r\n                },\r\n                {\r\n                    action: 'setUseDither',\r\n                    params: [this.settingUseDither],\r\n                },\r\n            ],\r\n        };\r\n\r\n        if (this.settingUseDither) {\r\n            this.updateDither();\r\n        }\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.5, p * this.settingSize) : Math.max(0.5, this.settingSize);\r\n\r\n        this.inputIsDrawing = true;\r\n        this.drawDot(x, y, localSize, localOpacity);\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        this.historyEntry.actions!.push({\r\n            action: 'startLine',\r\n            params: [x, y, p],\r\n        });\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.inputIsDrawing) {\r\n            return;\r\n        }\r\n        this.historyEntry!.actions!.push({\r\n            action: 'goLine',\r\n            params: [x, y, p],\r\n        });\r\n\r\n        //debug\r\n        //drawDot(x, y, 1, 0.5);\r\n\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = pressure;\r\n    }\r\n\r\n    endLine (x: number, y: number): void {\r\n\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n\r\n        //debug\r\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\r\n        //drawDot(x, y, 10, 0.1);\r\n\r\n        this.inputIsDrawing = false;\r\n\r\n        this.bezierLine = null;\r\n\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions!.push({\r\n                action: 'endLine',\r\n                params: [x, y],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n    }\r\n\r\n    //cheap n' ugly\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n        this.lastInput.pressure = 1;\r\n\r\n        if (this.inputIsDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (this.settingUseDither) {\r\n            this.updateDither();\r\n        }\r\n\r\n        if (Math.round(this.settingSize * 2) === 1) {\r\n            this.plotLine(x1, y1, x2, y2, true);\r\n        } else {\r\n            // const angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\r\n            const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n            const eX = (x2 - x1) / mouseDist;\r\n            const eY = (y2 - y1) / mouseDist;\r\n            let loopDist;\r\n            const bdist = this.settingSize * this.settingSpacing;\r\n            this.lineToolLastDot = this.settingSize * this.settingSpacing;\r\n            for (loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n                this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity);\r\n            }\r\n        }\r\n\r\n        const historyEntry: IPixelBrushHistoryEntry = {\r\n            tool: ['brush', 'PixelBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.settingHasSizePressure],\r\n                },\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.settingHasOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.settingSize],\r\n                },\r\n                {\r\n                    action: 'setSpacing',\r\n                    params: [this.settingSpacing],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.settingOpacity],\r\n                },\r\n                {\r\n                    action: 'setColor',\r\n                    params: [this.settingColor],\r\n                },\r\n                {\r\n                    action: 'setLockAlpha',\r\n                    params: [this.settingLockLayerAlpha],\r\n                },\r\n                {\r\n                    action: 'setIsEraser',\r\n                    params: [this.settingIsEraser],\r\n                },\r\n                {\r\n                    action: 'setUseDither',\r\n                    params: [this.settingUseDither],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n    //IS\r\n    isDrawing (): boolean {\r\n        return this.inputIsDrawing;\r\n    }\r\n\r\n    //SET\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor === c) {\r\n            return;\r\n        }\r\n        this.settingColor = c;\r\n        this.settingColorStr = 'rgb(' + this.settingColor.r + ',' + this.settingColor.g + ',' + this.settingColor.b + ')';\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = Math.round(s * 2) / 2;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = b;\r\n    }\r\n\r\n    setIsEraser (b: boolean): void {\r\n        this.settingIsEraser = !!b;\r\n    }\r\n\r\n    setUseDither (b: boolean): void {\r\n        this.settingUseDither = !!b;\r\n    }\r\n\r\n    //GET\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.settingIsEraser;\r\n    }\r\n\r\n    getUseDither (): boolean {\r\n        return this.settingUseDither;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {TPressureInput} from '../kl-types';\r\nimport {BezierLine} from '../../bb/math/line';\r\nimport {ERASE_COLOR} from './erase-color';\r\n\r\nexport interface IEraserBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'EraserBrush'];\r\n    actions: THistoryInnerActions<EraserBrush>[];\r\n}\r\n\r\ntype TIndexExtended2DContext = CanvasRenderingContext2D & { canvas: { index: number } };\r\n\r\nexport class EraserBrush {\r\n\r\n    private size: number = 30;\r\n    private spacing: number = 0.4;\r\n    private opacity: number = 1;\r\n    private useSizePressure: boolean = true;\r\n    private useOpacityPressure: boolean = false;\r\n    private isTransparentBG: boolean = false;\r\n\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: IEraserBrushHistoryEntry | undefined;\r\n    private isBaseLayer: boolean = false;\r\n    private context: TIndexExtended2DContext;\r\n\r\n    private started: boolean = false;\r\n    private lastDot: number | undefined;\r\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private bezierLine: BezierLine | undefined;\r\n\r\n\r\n    private drawDot (x: number, y: number, size: number, opacity: number): void {\r\n        this.context.save();\r\n        if (this.isBaseLayer) {\r\n            if (this.isTransparentBG) {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        } else {\r\n            this.context.globalCompositeOperation = 'destination-out';\r\n        }\r\n        const radgrad = this.context.createRadialGradient(size, size, 0, size, size, size);\r\n        let sharpness = Math.pow(opacity, 2);\r\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\r\n        const oFac = Math.max(0, Math.min(1, opacity));\r\n        const localOpacity = 2 * oFac - oFac * oFac;\r\n        radgrad.addColorStop(sharpness, `rgba(${ERASE_COLOR}, ${ERASE_COLOR}, ${ERASE_COLOR}, ` + localOpacity + ')');\r\n        radgrad.addColorStop(1, `rgba(${ERASE_COLOR}, ${ERASE_COLOR}, ${ERASE_COLOR}, 0)`);\r\n        this.context.fillStyle = radgrad;\r\n        this.context.translate(x - size, y - size);\r\n        this.context.fillRect(0, 0, size * 2, size * 2);\r\n        this.context.restore();\r\n    }\r\n\r\n    private continueLine (x: number | null, y: number | null, p: number): void {\r\n        p = Math.max(0, Math.min(1, p));\r\n        let localPressure;\r\n        let localOpacity;\r\n        let localSize = (this.useSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * localSize * this.spacing);\r\n\r\n        const bezierCallback = (val: {\r\n            x: number;\r\n            y: number;\r\n            t: number;\r\n            angle?: number;\r\n            dAngle: number;\r\n        }): void => {\r\n            const factor = val.t;\r\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\r\n            localOpacity = (this.useOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\r\n            localSize = (this.useSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\r\n\r\n            this.drawDot(val.x, val.y, localSize, localOpacity);\r\n        };\r\n\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(bdist, bezierCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, bdist, bezierCallback);\r\n        }\r\n    }\r\n\r\n    // ---- public -----\r\n    constructor () {}\r\n\r\n    // ---- interface ----\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'EraserBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.useOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.useSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.size],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.opacity],\r\n                },\r\n                {\r\n                    action: 'setTransparentBG',\r\n                    params: [this.isTransparentBG],\r\n                },\r\n                {\r\n                    action: 'startLine',\r\n                    params: [x, y, p],\r\n                },\r\n            ],\r\n        };\r\n\r\n        this.isBaseLayer = 0 === this.context.canvas.index;\r\n\r\n        p = Math.max(0, Math.min(1, p));\r\n        const localOpacity = (this.useOpacityPressure) ? (this.opacity * p * p) : this.opacity;\r\n        const localSize = (this.useSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\r\n\r\n        this.started = true;\r\n        if (localSize > 1) {\r\n            this.drawDot(x, y, localSize, localOpacity);\r\n        }\r\n        this.lastDot = localSize * this.spacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n\r\n        this.bezierLine = new BB.BezierLine();\r\n        this.bezierLine.add(x, y, 0, () => undefined);\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.started || !this.historyEntry) {\r\n            return;\r\n        }\r\n        this.historyEntry.actions?.push({\r\n            action: 'goLine',\r\n            params: [x, y, p],\r\n        });\r\n\r\n        this.continueLine(x, y, this.lastInput.pressure);\r\n\r\n        this.lastInput2 = BB.copyObj(this.lastInput);\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n    }\r\n\r\n    endLine (): void {\r\n\r\n        if (this.bezierLine) {\r\n            this.continueLine(null, null, this.lastInput.pressure);\r\n        }\r\n\r\n        this.started = false;\r\n        this.bezierLine = undefined;\r\n\r\n        if (this.historyEntry) {\r\n            this.historyEntry.actions?.push({\r\n                action: 'endLine',\r\n                params: [],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n\r\n        this.isBaseLayer = 0 === this.context.canvas.index;\r\n\r\n        this.lastInput.x = x2;\r\n        this.lastInput.y = y2;\r\n\r\n        if (this.started || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        const eX = (x2 - x1) / mouseDist;\r\n        const eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * this.size * this.spacing);\r\n        this.lastDot = 0;\r\n        for (loopDist = this.lastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.size, this.opacity);\r\n        }\r\n\r\n\r\n        const historyEntry: IEraserBrushHistoryEntry = {\r\n            tool: ['brush', 'EraserBrush'],\r\n            actions: [\r\n                {\r\n                    action: 'opacityPressure',\r\n                    params: [this.useOpacityPressure],\r\n                },\r\n                {\r\n                    action: 'sizePressure',\r\n                    params: [this.useSizePressure],\r\n                },\r\n                {\r\n                    action: 'setSize',\r\n                    params: [this.size],\r\n                },\r\n                {\r\n                    action: 'setOpacity',\r\n                    params: [this.opacity],\r\n                },\r\n                {\r\n                    action: 'setTransparentBG',\r\n                    params: [this.isTransparentBG],\r\n                },\r\n                {\r\n                    action: 'drawLineSegment',\r\n                    params: [x1, y1, x2, y2],\r\n                },\r\n            ],\r\n        };\r\n        this.history.push(historyEntry);\r\n    }\r\n\r\n    //IS\r\n    isDrawing (): boolean {\r\n        return this.started;\r\n    }\r\n\r\n    //SET\r\n    setContext (c: TIndexExtended2DContext): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (l: KlHistoryInterface): void {\r\n        this.history = l;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.size = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.opacity = o;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.useSizePressure = b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.useOpacityPressure = b;\r\n    }\r\n\r\n    setTransparentBG (b: boolean): void {\r\n        this.isTransparentBG = !!b;\r\n    }\r\n\r\n    //GET\r\n    getSize (): number {\r\n        return this.size;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.opacity;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb-types';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {KL} from '../kl';\r\nimport {IRGB} from '../kl-types';\r\nimport {clamp} from '../../bb/math/math';\r\n\r\nexport interface ISmudgeBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'SmudgeBrush'];\r\n    actions: THistoryInnerActions<SmudgeBrush>[];\r\n}\r\n\r\n// let statCount = 1;\r\n// let statAcc = 0;\r\n// stats on win10, chrome, size 100, opacity 80, smudge()\r\n// unoptimized: 1 ms\r\n// minimal: 0.09 ms\r\n// minimal + circle: 0.5ms\r\n// minimal + circle + ix, iy: 0.23ms\r\n// unoptimized + ix, iy: 0.64 ms\r\n// unoptimized + ix, iy + sans rounding: 0.61 ms\r\n// ix, iy + sans rounding + sans random: 0.32ms\r\n// ix, iy + sans rounding + fast random: 0.46 ms\r\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\r\n\r\nconst CELL_SIZE = 256;\r\n\r\ninterface ISmudgeParams {\r\n    aP: IVector2D;\r\n    bP: IVector2D;\r\n    size: {\r\n        w: number;\r\n        h: number;\r\n    };\r\n    brush: {\r\n        center: IVector2D;\r\n        size: number;\r\n        opacity: number;\r\n        alphaLock: boolean;\r\n    };\r\n}\r\n\r\n\r\n/**\r\n * determine bounds of smudge\r\n * @param imWidth\r\n * @param imHeight\r\n * @param aP\r\n * @param bP\r\n * @param size\r\n */\r\nfunction prepSmudge (\r\n    imWidth: number,\r\n    imHeight: number,\r\n    aP: IVector2D, // top left of source, integers\r\n    bP: IVector2D, // top left of dest, integers\r\n    size: {w: number; h: number}, // size of both rectangles, integers\r\n): ({\r\n    aP: IVector2D;\r\n    bP: IVector2D;\r\n    size: {w: number; h: number};\r\n} | null) {\r\n\r\n    if (aP.x === bP.x && aP.y === bP.y) {\r\n        return null;\r\n    }\r\n\r\n    aP = BB.copyObj(aP);\r\n    bP = BB.copyObj(bP);\r\n    size = BB.copyObj(size);\r\n\r\n    // corner behavior\r\n    // cut down rectangles, if a or b go outside\r\n    // i.e. if user drags partially or fully outside the canvas\r\n    {\r\n        let top = 0;\r\n        let right = 0;\r\n        let bottom = 0;\r\n        let left = 0;\r\n\r\n        if (aP.x < 0) {\r\n            left = -aP.x;\r\n        }\r\n        if (aP.y < 0) {\r\n            top = -aP.y;\r\n        }\r\n        if (bP.x < 0) {\r\n            left = Math.max(left, -bP.x);\r\n        }\r\n        if (bP.y < 0) {\r\n            top = Math.max(top, -bP.y);\r\n        }\r\n        if (aP.x + size.w > imWidth) {\r\n            right = aP.x + size.w - imWidth;\r\n        }\r\n        if (aP.y + size.h > imHeight) {\r\n            bottom = aP.y + size.h - imHeight;\r\n        }\r\n        if (bP.x + size.w > imWidth) {\r\n            right = Math.max(right, bP.x + size.w - imWidth);\r\n        }\r\n        if (bP.y + size.h > imHeight) {\r\n            bottom = Math.max(bottom, bP.y + size.h - imHeight);\r\n        }\r\n\r\n        aP.x += left;\r\n        bP.x += left;\r\n        aP.y += top;\r\n        bP.y += top;\r\n\r\n        size.w = size.w - left - right;\r\n        size.h = size.h - top - bottom;\r\n        if (size.w <= 0 || size.h <= 0) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    return {\r\n        aP: {\r\n            x: aP.x,\r\n            y: aP.y,\r\n        },\r\n        bP: {\r\n            x: bP.x,\r\n            y: bP.y,\r\n        },\r\n        size: {\r\n            w: size.w,\r\n            h: size.h,\r\n        },\r\n    };\r\n}\r\n\r\n/**\r\n * Pixel operations that do the smudging via ImageData\r\n * @param imageData\r\n * @param p\r\n */\r\nfunction smudge (imageData: ImageData, p : ISmudgeParams): void {\r\n\r\n    p = BB.copyObj(p);\r\n\r\n    const cSize = p.brush.size;\r\n    const cX = p.brush.center.x;\r\n    const cY = p.brush.center.y;\r\n\r\n    /*if (statCount % 1000 === 0) {\r\n        console.log(statAcc / 1000);\r\n        statAcc = 0;\r\n    }\r\n    let start = performance.now();*/\r\n\r\n\r\n    // determine offset\r\n    const aIndex = p.aP.y * imageData.width + p.aP.x;\r\n    const bIndex = p.bP.y * imageData.width + p.bP.x;\r\n    const offset = (bIndex - aIndex) * 4;\r\n\r\n    // array with random numbers. faster than Math.random()\r\n    let randI = 0;\r\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\r\n    const randArr: number[] = [];\r\n    for (let i = 0; i < randLen; i++) {\r\n        randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\r\n    }\r\n\r\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\r\n\r\n    const pixel = (ai: number, bi: number, ix: number, iy: number): void => {\r\n\r\n        const dist = BB.dist(cX, cY, ix, iy);\r\n        const fac = 1 - p.brush.opacity * (1 - clamp((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\r\n\r\n        if (fac === 1) {\r\n            return;\r\n        }\r\n\r\n        if (!imageData.data[ai + 3]) {\r\n\r\n        } else if (!imageData.data[bi + 3]) { // don't mix if target fully transparent. pixel might have a strange color.\r\n            imageData.data[bi] = imageData.data[ai + 0];\r\n            imageData.data[bi + 1] = imageData.data[ai + 1];\r\n            imageData.data[bi + 2] = imageData.data[ai + 2];\r\n        } else {\r\n\r\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\r\n            // not totally accurate. TODO same compositing as blend brush\r\n            let fac2;\r\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) {\r\n                fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\r\n            } else {\r\n                fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\r\n            }\r\n\r\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\r\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\r\n            // No +0.5, because it cancels out with rand.\r\n            imageData.data[bi] = Math.floor(BB.mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\r\n            imageData.data[bi + 1] = Math.floor(BB.mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\r\n            imageData.data[bi + 2] = Math.floor(BB.mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\r\n\r\n            randI = (randI + 1) % randLen;\r\n        }\r\n        // Always mix alpha. unless alpha lock\r\n        if (!p.brush.alphaLock) {\r\n            imageData.data[bi + 3] = Math.floor(BB.mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\r\n        }\r\n\r\n    };\r\n\r\n    const bx1 = p.bP.x * 4;\r\n    const bx2 = bx1 + (p.size.w - 1) * 4;\r\n\r\n    // transfer of pixels depends on direction of smudging if there is overlap\r\n    if (p.aP.y < p.bP.y) {\r\n        for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else if (p.aP.y > p.bP.y) {\r\n        for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n            const yStart = (y + p.bP.y) * imageData.width * 4;\r\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                pixel(x2, x, ix, iy);\r\n            }\r\n        }\r\n    } else {\r\n        if (p.aP.x < p.bP.x) {\r\n            for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        } else {\r\n            for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\r\n                const yStart = (y + p.bP.y) * imageData.width * 4;\r\n                for (let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x; x < bx2 + yStart; x += 4, x2 += 4, ix++) {\r\n                    pixel(x2, x, ix, iy);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    //statCount++;\r\n    //statAcc += performance.now() - start;\r\n}\r\n\r\nexport class SmudgeBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\r\n    private historyEntry: ISmudgeBrushHistoryEntry;\r\n\r\n    private settingColor: IRGB = {r: 0, g: 0, b: 0};\r\n    private settingSize: number = 35;\r\n    private settingSpacing: number = 0.20446882736951905;\r\n    private settingOpacity: number = 0.8;\r\n    private settingColorStr: string;\r\n    private settingHasSizePressure: boolean = false;\r\n    private settingHasOpacityPressure: boolean = false;\r\n    private settingLockLayerAlpha: boolean = false;\r\n\r\n    private lineToolLastDot: number;\r\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0};\r\n    private lastDot: IVector2D;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private bezierLine: any = null; // todo type BezierLine\r\n\r\n    private redrawBounds: IBounds;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    private copyImageData: ImageData;\r\n\r\n    private drawBuffer: ISmudgeParams[] = [];\r\n\r\n    private copiedCells: boolean[];\r\n\r\n    private updateRedrawBounds (bounds: IBounds): void {\r\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\r\n    }\r\n\r\n    private updateCompleteRedrawBounds (x1: number, y1: number, x2: number, y2: number): void {\r\n        this.completeRedrawBounds = BB.updateBounds(\r\n            this.completeRedrawBounds,\r\n            { x1, y1, x2, y2 }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * update copyImageData. copy over new regions if needed\r\n     */\r\n    copyFromCanvas (): void {\r\n\r\n        const touchedCells = this.copiedCells.map(item => false);\r\n\r\n        const bounds: IBounds[] = [];\r\n        const cellsW = Math.ceil(this.copyImageData.width / CELL_SIZE);\r\n\r\n        if (!this.redrawBounds) {\r\n            return;\r\n        }\r\n        bounds.push({\r\n            x1: Math.floor(this.redrawBounds.x1 / CELL_SIZE),\r\n            y1: Math.floor(this.redrawBounds.y1 / CELL_SIZE),\r\n            x2: Math.floor(this.redrawBounds.x2 / CELL_SIZE),\r\n            y2: Math.floor(this.redrawBounds.y2 / CELL_SIZE),\r\n        });\r\n        bounds.forEach(item => {\r\n            for (let i = item.x1; i <= item.x2; i++) {\r\n                for (let e = item.y1; e <= item.y2; e++) {\r\n                    touchedCells[e * cellsW + i] = true;\r\n                }\r\n            }\r\n        });\r\n\r\n        touchedCells.forEach((item, i) => {\r\n            if (!item || this.copiedCells[i]) {\r\n                // not touched, or already copied\r\n                return;\r\n            }\r\n            this.copiedCells[i] = true;\r\n            const x = i % cellsW;\r\n            const y = Math.floor(i / cellsW);\r\n            const w = (Math.min(x * CELL_SIZE + CELL_SIZE, this.copyImageData.width) - 1) % CELL_SIZE + 1;\r\n            const h = (Math.min(y * CELL_SIZE + CELL_SIZE, this.copyImageData.height) - 1) % CELL_SIZE + 1;\r\n\r\n            // temp canvas to prevent main canvas from getting slowed down in chrome\r\n            const tmpCanvas = BB.canvas(w, h);\r\n            const tmpCtx = BB.ctx(tmpCanvas);\r\n            tmpCtx.drawImage(this.context.canvas, -x * CELL_SIZE, -y * CELL_SIZE);\r\n\r\n            const data = tmpCtx.getImageData(0, 0, w, h);\r\n\r\n            for (let i = 0; i < h; i++) {\r\n                for (let e = 0, e2 = i * w * 4, e3 = ((y * CELL_SIZE + i) * this.copyImageData.width + x * CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4) {\r\n                    this.copyImageData.data[e3] = data.data[e2];\r\n                    this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\r\n                    this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\r\n                    this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    /**\r\n     * fill drawBuffer with params about to be drawn\r\n     * @param x\r\n     * @param y\r\n     * @param size\r\n     * @param opacity\r\n     */\r\n    prepDot (x: number, y: number, size: number, opacity: number): void {\r\n        if (!this.lastDot) {\r\n            this.lastDot = {\r\n                x: x,\r\n                y: y,\r\n            };\r\n            return;\r\n        }\r\n\r\n        size = Math.round(size);\r\n\r\n\r\n        const w = Math.round(size * 2);\r\n        const h = Math.round(size * 2);\r\n\r\n        const bounds = prepSmudge(\r\n            this.copyImageData.width,\r\n            this.copyImageData.height,\r\n            {\r\n                x: Math.round(this.lastDot.x - size),\r\n                y: Math.round(this.lastDot.y - size),\r\n            },\r\n            {\r\n                x: Math.round(x - size),\r\n                y: Math.round(y - size),\r\n            },\r\n            {\r\n                w,\r\n                h,\r\n            },\r\n        );\r\n\r\n        if (bounds) {\r\n            const params: ISmudgeParams = {\r\n                aP: bounds.aP,\r\n                bP: bounds.bP,\r\n                size: bounds.size,\r\n                brush: {\r\n                    center: { x, y },\r\n                    size,\r\n                    opacity,\r\n                    alphaLock: this.settingLockLayerAlpha,\r\n                },\r\n            };\r\n            this.updateRedrawBounds({\r\n                x1: params.bP.x,\r\n                y1: params.bP.y,\r\n                x2: params.bP.x + params.brush.size * 2,\r\n                y2: params.bP.y + params.brush.size * 2,\r\n            });\r\n            this.drawBuffer.push(params);\r\n        }\r\n\r\n        this.lastDot = {\r\n            x: x,\r\n            y: y,\r\n        };\r\n    }\r\n\r\n    continueLine (x: number, y: number, size: number, pressure: number): void {\r\n        this.drawBuffer = [];\r\n\r\n        if (this.bezierLine === null) {\r\n            this.bezierLine = new BB.BezierLine();\r\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function (){});\r\n        }\r\n\r\n        const drawArr = []; //draw instructions. will be all drawn at once\r\n\r\n        const dotCallback = (val): void => {\r\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\r\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\r\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\r\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\r\n        };\r\n\r\n        const localSpacing = size * this.settingSpacing / 3;\r\n        if (x === null) {\r\n            this.bezierLine.addFinal(localSpacing, dotCallback);\r\n        } else {\r\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\r\n        }\r\n\r\n        // execute draw instructions\r\n        let before;\r\n        for (let i = 0; i < drawArr.length; i++) {\r\n            const item = drawArr[i];\r\n            this.prepDot(item[0], item[1], item[2], item[3]);\r\n            before = item;\r\n        }\r\n\r\n        this.copyFromCanvas();\r\n\r\n        for (let i = 0; i < this.drawBuffer.length; i++) {\r\n            smudge(this.copyImageData, this.drawBuffer[i]);\r\n        }\r\n    }\r\n\r\n\r\n\r\n    // ---- public ----\r\n\r\n    constructor () { }\r\n\r\n    startLine (x: number, y: number, p: number): void {\r\n        this.historyEntry = {\r\n            tool: ['brush', 'SmudgeBrush'],\r\n            actions: [],\r\n        };\r\n\r\n        p = BB.clamp(p, 0, 1);\r\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\r\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.lastDot = null;\r\n        this.isDrawing = true;\r\n\r\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\r\n        const totalCells = Math.ceil(this.context.canvas.width / CELL_SIZE) * Math.ceil(this.context.canvas.height / CELL_SIZE);\r\n        this.copiedCells = '0'.repeat(totalCells).split('').map(item => false);\r\n\r\n        this.prepDot(x, y, localSize, localOpacity);\r\n\r\n        this.lineToolLastDot = localSize * this.settingSpacing;\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput.pressure = p;\r\n        this.lastInput2.pressure = p;\r\n\r\n        this.completeRedrawBounds = null;\r\n    }\r\n\r\n    goLine (x: number, y: number, p: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        this.redrawBounds = null;\r\n        const pressure = BB.clamp(p, 0, 1);\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n\r\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\r\n\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        this.lastInput.x = x;\r\n        this.lastInput.y = y;\r\n        this.lastInput2.pressure = this.lastInput.pressure;\r\n        this.lastInput.pressure = pressure;\r\n    }\r\n\r\n    endLine (): void {\r\n        this.redrawBounds = null;\r\n        const localSize = this.settingHasSizePressure ?\r\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\r\n        this.context.save();\r\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\r\n        this.context.restore();\r\n\r\n        this.isDrawing = false;\r\n        this.bezierLine = null;\r\n\r\n        if (this.redrawBounds) {\r\n            this.context.putImageData(\r\n                this.copyImageData,\r\n                0,\r\n                0,\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\r\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\r\n            );\r\n            this.updateCompleteRedrawBounds(\r\n                this.redrawBounds.x1,\r\n                this.redrawBounds.y1,\r\n                this.redrawBounds.x2,\r\n                this.redrawBounds.y2\r\n            );\r\n        }\r\n\r\n        if (this.historyEntry && this.completeRedrawBounds) {\r\n            let historyIm: ImageData | HTMLCanvasElement = this.copyImageData;\r\n            if (!(\r\n                this.completeRedrawBounds.x1 === 0 &&\r\n                this.completeRedrawBounds.y1 === 0 &&\r\n                this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 &&\r\n                this.completeRedrawBounds.y2 >= this.context.canvas.height - 1\r\n            )) {\r\n\r\n                // temp canvas to prevent main canvas from getting slowed down in chrome\r\n                const tmpCanvas = BB.canvas(\r\n                    this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                    this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n                );\r\n                const tmpCtx = BB.ctx(tmpCanvas);\r\n                tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n                historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\r\n            }\r\n            this.historyEntry.actions.push({\r\n                action: 'drawImage',\r\n                params: [\r\n                    historyIm,\r\n                    this.completeRedrawBounds.x1,\r\n                    this.completeRedrawBounds.y1,\r\n                ],\r\n            });\r\n            this.history.push(this.historyEntry);\r\n            this.historyEntry = undefined;\r\n        }\r\n        this.copyImageData = null;\r\n    }\r\n\r\n    drawImage (im: ImageData | HTMLCanvasElement, x: number, y: number): void {\r\n        if (im instanceof ImageData) {\r\n            this.context.putImageData(im, x, y);\r\n        } else {\r\n            this.context.clearRect(x, y, im.width, im.height);\r\n            this.context.drawImage(im, x, y);\r\n        }\r\n    }\r\n\r\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\r\n        return;\r\n        /*\r\n        // todo\r\n        lastInput.x = x2;\r\n        lastInput.y = y2;\r\n        lastInput.pressure = 1;\r\n\r\n        if (isDrawing || x1 === undefined) {\r\n            return;\r\n        }\r\n\r\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\r\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\r\n        let eX = (x2 - x1) / mouseDist;\r\n        let eY = (y2 - y1) / mouseDist;\r\n        let loopDist;\r\n        let bdist = settingSize * settingSpacing;\r\n        lineToolLastDot = settingSize * settingSpacing;\r\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\r\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\r\n        }\r\n\r\n\r\n        let historyEntry = {\r\n            tool: [\"brush\", \"SmudgeBrush\"],\r\n            actions: []\r\n        };\r\n        // todo\r\n        history.add(historyEntry);*/\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) {\r\n            return;\r\n        }\r\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\r\n        this.settingColorStr = BB.ColorConverter.toRgbStr(this.settingColor);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D): void {\r\n        this.context = c;\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setSpacing (s: number): void {\r\n        this.settingSpacing = s;\r\n    }\r\n\r\n    sizePressure (b: boolean): void {\r\n        this.settingHasSizePressure = !!b;\r\n    }\r\n\r\n    opacityPressure (b: boolean): void {\r\n        this.settingHasOpacityPressure = !!b;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getSpacing (): number {\r\n        return this.settingSpacing;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingSize;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl-types';\r\nimport {IBounds} from '../../bb/bb-types';\r\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\r\nimport {ERASE_COLOR} from './erase-color';\r\n\r\nexport interface IChemyBrushHistoryEntry extends IHistoryEntry {\r\n    tool: ['brush', 'ChemyBrush'];\r\n    actions: THistoryInnerActions<ChemyBrush>[];\r\n}\r\n\r\ntype TChemyMode = 'fill' | 'stroke';\r\n\r\nexport class ChemyBrush {\r\n\r\n    private context: CanvasRenderingContext2D;\r\n    private settingColor: IRGB;\r\n    private settingSize: number = 0.25; // radius - 0.5 - 99999\r\n    private settingOpacity: number = 1; // 0-1\r\n    private settingLockLayerAlpha: boolean = false;\r\n    private settingIsEraser: boolean = false;\r\n    private settingMode: TChemyMode = 'fill';\r\n    private settingDistort: number = 0; // 0 - 1\r\n    private settingXSymmetry: boolean = false;\r\n    private settingYSymmetry: boolean = false;\r\n    private settingGradient: boolean = false;\r\n\r\n    private isDrawing: boolean = false;\r\n\r\n    private history: KlHistoryInterface;\r\n\r\n    private copyCanvas: HTMLCanvasElement;\r\n    private path: {x: number; y: number}[];\r\n    private minY: number;\r\n    private maxY: number;\r\n    private completeRedrawBounds: IBounds;\r\n\r\n    private updateCompleteRedrawBounds (x: number, y: number): void {\r\n        let bounds = { x1: x, y1: y, x2: x, y2: y};\r\n        if (this.settingXSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: -x + this.copyCanvas.width,\r\n                    y1: y,\r\n                    x2: -x + this.copyCanvas.width,\r\n                    y2: y,\r\n                }\r\n                );\r\n        }\r\n        if (this.settingYSymmetry) {\r\n            bounds = BB.updateBounds(\r\n                bounds,\r\n                {\r\n                    x1: x,\r\n                    y1: -y + this.copyCanvas.height,\r\n                    x2: x,\r\n                    y2: -y + this.copyCanvas.height,\r\n                }\r\n            );\r\n        }\r\n        const buffer = this.settingMode === 'stroke' ? this.settingSize + 1 : 1;\r\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\r\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\r\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\r\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\r\n\r\n        this.completeRedrawBounds = BB.updateBounds(this.completeRedrawBounds, bounds);\r\n    }\r\n\r\n    private drawShape (): void {\r\n        this.context.save();\r\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\r\n        this.context.drawImage(this.copyCanvas, 0, 0);\r\n\r\n        const color = {...this.settingColor};\r\n        if (this.settingIsEraser) {\r\n            color.r = ERASE_COLOR;\r\n            color.g = ERASE_COLOR;\r\n            color.b = ERASE_COLOR;\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            } else {\r\n                this.context.globalCompositeOperation = 'destination-out';\r\n            }\r\n        } else {\r\n            if (this.settingLockLayerAlpha) {\r\n                this.context.globalCompositeOperation = 'source-atop';\r\n            }\r\n        }\r\n\r\n        if (this.path) {\r\n\r\n            // path\r\n            const path = new Path2D();\r\n            this.path.forEach((item, index) => {\r\n                if (index === 0) {\r\n                    path.moveTo(item.x, item.y);\r\n                } else {\r\n                    path.lineTo(item.x, item.y);\r\n                }\r\n            });\r\n\r\n            let style: string | CanvasGradient = BB.ColorConverter.toRgbaStr({\r\n                r: color.r,\r\n                g: color.g,\r\n                b: color.b,\r\n                a: this.settingOpacity,\r\n            });\r\n            if (this.settingGradient) {\r\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\r\n                const gradient = this.context.createLinearGradient(\r\n                    0, startAtTop ? this.minY : this.maxY,\r\n                    0, startAtTop ? this.maxY : this.minY,\r\n                );\r\n                gradient.addColorStop(\r\n                    0,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: this.settingOpacity,\r\n                    })\r\n                );\r\n                gradient.addColorStop(\r\n                    1,\r\n                    BB.ColorConverter.toRgbaStr({\r\n                        r: color.r,\r\n                        g: color.g,\r\n                        b: color.b,\r\n                        a: 0,\r\n                    })\r\n                );\r\n                style = gradient;\r\n            }\r\n\r\n            // setup params\r\n            if (this.settingMode === 'fill') {\r\n                this.context.fillStyle = style;\r\n\r\n            } else {\r\n                this.context.lineWidth = this.settingSize * 2;\r\n                this.context.lineJoin = 'bevel';\r\n                this.context.strokeStyle = style;\r\n            }\r\n\r\n            // draw\r\n            const draw = () => {\r\n                if (this.settingMode === 'fill') {\r\n                    this.context.fill(path);\r\n                } else {\r\n                    this.context.stroke(path);\r\n                }\r\n            };\r\n\r\n            draw();\r\n            if (this.settingXSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(this.context.canvas.width / 2, 0);\r\n                this.context.scale(-1, 1);\r\n                this.context.translate(-this.context.canvas.width / 2, 0);\r\n                draw();\r\n                this.context.restore();\r\n            }\r\n            if (this.settingYSymmetry) {\r\n                this.context.save();\r\n                this.context.translate(0, this.context.canvas.height / 2);\r\n                this.context.scale(1, -1);\r\n                this.context.translate(0, -this.context.canvas.height / 2);\r\n                draw();\r\n                this.context.restore();\r\n                if (this.settingXSymmetry) {\r\n                    this.context.save();\r\n                    this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\r\n                    this.context.scale(-1, -1);\r\n                    this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\r\n                    draw();\r\n                    this.context.restore();\r\n                }\r\n            }\r\n        }\r\n\r\n        this.context.restore();\r\n    }\r\n\r\n    // --- public ----\r\n    constructor () {\r\n    }\r\n\r\n    setHistory (h: KlHistoryInterface): void {\r\n        this.history = h;\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.settingMode === 'stroke' ? this.settingSize : 0;\r\n    }\r\n\r\n    setSize (s: number): void {\r\n        this.settingSize = s;\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.settingOpacity;\r\n    }\r\n\r\n    setOpacity (o: number): void {\r\n        this.settingOpacity = o;\r\n    }\r\n\r\n    setColor (c: IRGB): void {\r\n        this.settingColor = BB.copyObj(c);\r\n    }\r\n\r\n    setContext (c: CanvasRenderingContext2D) {\r\n        this.context = c;\r\n    }\r\n\r\n    setMode (mode: TChemyMode): void {\r\n        this.settingMode = mode;\r\n    }\r\n\r\n    getMode (): TChemyMode {\r\n        return this.settingMode;\r\n    }\r\n\r\n    setDistort (distort: number): void {\r\n        this.settingDistort = BB.clamp(distort, 0, 1);\r\n    }\r\n\r\n    getDistort (): number {\r\n        return this.settingDistort;\r\n    }\r\n\r\n    setXSymmetry (b: boolean): void {\r\n        this.settingXSymmetry = !!b;\r\n    }\r\n\r\n    getXSymmetry (): boolean {\r\n        return this.settingXSymmetry;\r\n    }\r\n\r\n    setYSymmetry (b: boolean): void {\r\n        this.settingYSymmetry = !!b;\r\n    }\r\n\r\n    getYSymmetry (): boolean {\r\n        return this.settingYSymmetry;\r\n    }\r\n\r\n    setGradient (b: boolean): void {\r\n        this.settingGradient = !!b;\r\n    }\r\n\r\n    getGradient (): boolean {\r\n        return this.settingGradient;\r\n    }\r\n\r\n    getLockAlpha (): boolean {\r\n        return this.settingLockLayerAlpha;\r\n    }\r\n\r\n    setLockAlpha (b: boolean): void {\r\n        this.settingLockLayerAlpha = !!b;\r\n    }\r\n\r\n    getIsEraser (): boolean {\r\n        return this.settingIsEraser;\r\n    }\r\n\r\n    setIsEraser (b: boolean): void {\r\n        this.settingIsEraser = !!b;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n\r\n    startLine (x: number, y: number): void {\r\n        this.isDrawing = true;\r\n        this.path = [{x, y}];\r\n        this.minY = y;\r\n        this.maxY = y;\r\n        this.copyCanvas = BB.canvas(this.context.canvas.width, this.context.canvas.height);\r\n        BB.ctx(this.copyCanvas).drawImage(this.context.canvas, 0, 0);\r\n        this.completeRedrawBounds = null;\r\n        this.updateCompleteRedrawBounds(x, y);\r\n    }\r\n\r\n    goLine (x: number, y: number): void {\r\n        if (!this.isDrawing) {\r\n            return;\r\n        }\r\n\r\n        const pos = { x, y };\r\n        if (this.settingDistort > 0) {\r\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\r\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\r\n        }\r\n\r\n        this.minY = Math.min(this.minY, pos.y);\r\n        this.maxY = Math.max(this.maxY, pos.y);\r\n        this.path.push(pos);\r\n        this.updateCompleteRedrawBounds(x, y);\r\n        this.drawShape();\r\n    }\r\n\r\n    endLine (): void {\r\n        this.isDrawing = false;\r\n        this.completeRedrawBounds = BB.boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\r\n        if (this.path.length > 1 && this.completeRedrawBounds) {\r\n            const historyCanvas = BB.canvas(\r\n                this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\r\n                this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\r\n            );\r\n            const historyCtx = BB.ctx(historyCanvas);\r\n            historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\r\n\r\n            this.history.push({\r\n                tool: ['brush', 'ChemyBrush'],\r\n                actions: [\r\n                    {\r\n                        action: 'drawImage',\r\n                        params: [\r\n                            historyCanvas, // faster than getting image data (measured on 2018 lenovo chromebook)\r\n                            this.completeRedrawBounds.x1,\r\n                            this.completeRedrawBounds.y1,\r\n                        ],\r\n                    },\r\n                ],\r\n            } as IChemyBrushHistoryEntry);\r\n        }\r\n        this.path = null;\r\n        this.copyCanvas = null;\r\n    }\r\n\r\n    drawImage (im: HTMLCanvasElement, x: number, y: number): void {\r\n        this.context.save();\r\n        this.context.clearRect(x, y, im.width, im.height);\r\n        this.context.drawImage(im, x, y);\r\n        this.context.restore();\r\n    }\r\n\r\n    drawLineSegment (x1, y1, x2, y2): void {\r\n        // might make sense for stroke\r\n    }\r\n}\r\n","import {penBrushUi} from './pen-brush-ui';\r\nimport {blendBrushUi} from './blend-brush-ui';\r\nimport {sketchyBrushUi} from './sketchy-brush-ui';\r\nimport {pixelBrushUi} from './pixel-brush-ui';\r\nimport {eraserBrushUi} from './eraser-brush-ui';\r\nimport {smudgeBrushUi} from './smudge-brush-ui';\r\nimport {chemyBrushUi} from './chemy-brush-ui';\r\nimport {IBrushUi} from '../kl-types';\r\n\r\n/**\r\n * UI for brushes.\r\n * Each brush ui carries the brush with it.\r\n * So if you want to draw, you do it through the UI. should be changed sometime.\r\n */\r\n\r\nexport const brushesUI: {\r\n    [key: string]: IBrushUi;\r\n} = {\r\n    penBrush: penBrushUi,\r\n    blendBrush: blendBrushUi,\r\n    sketchyBrush: sketchyBrushUi,\r\n    pixelBrush: pixelBrushUi,\r\n    chemyBrush: chemyBrushUi,\r\n    smudgeBrush: smudgeBrushUi,\r\n    eraserBrush: eraserBrushUi,\r\n};\r\n","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport brushIconImg from '/src/app/img/ui/brush-pen.svg';\r\nimport {genBrushAlpha01, genBrushAlpha02} from '../brushes/alphas/brush-alphas';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {Options} from '../ui/components/options';\r\n\r\n\r\nexport const penBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pen'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1/100,\r\n            max: 1,\r\n            curve: [[0, 1/100], [0.5, 30/100], [1, 1]],\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    let alphaNames = [\r\n        LANG('brush-pen-circle'),\r\n        LANG('brush-pen-chalk'),\r\n        LANG('brush-pen-calligraphy'),\r\n        LANG('brush-pen-square'),\r\n    ];\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pen');\r\n        alphaNames = [\r\n            LANG('brush-pen-circle'),\r\n            LANG('brush-pen-chalk'),\r\n            LANG('brush-pen-calligraphy'),\r\n            LANG('brush-pen-square'),\r\n        ];\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.PenBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        const alphaOptions = new Options({\r\n            optionArr: [0, 1, 2, 3].map(id => {\r\n\r\n                const alpha = BB.el({\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        width: '31px',\r\n                        height: '31px',\r\n                        backgroundSize: 'contain',\r\n                        margin: '2px',\r\n                    },\r\n                });\r\n                const canvas = BB.canvas(70, 70);\r\n                const ctx = BB.ctx(canvas);\r\n                if (id === 0 || id === 3) {\r\n                    if (id === 0) {\r\n                        ctx.beginPath();\r\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\r\n                        ctx.closePath();\r\n                        ctx.fill();\r\n                    } else {\r\n                        ctx.fillRect(5, 5, 60, 60);\r\n                    }\r\n                } else if (id === 1) {\r\n                    ctx.drawImage(genBrushAlpha01(60), 5, 5);\r\n                } else if (id === 2) {\r\n                    ctx.drawImage(genBrushAlpha02(60), 5, 5);\r\n                }\r\n                alpha.style.backgroundImage = 'url(' + canvas.toDataURL('image/png') + ')';\r\n\r\n                return {\r\n                    id: id,\r\n                    label: alpha,\r\n                    title: alphaNames[id],\r\n                };\r\n            }),\r\n            initId: 0,\r\n            onChange: (id) => {\r\n                brush.setAlpha(id);\r\n            },\r\n        });\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n            css: {\r\n                display: 'inline-block',\r\n            },\r\n        });\r\n\r\n        const spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: alphaOptions.getElement(),\r\n                    css: {\r\n                        marginTop: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: lockAlphaToggle.getElement(),\r\n                    css: {\r\n                        marginTop: '10px',\r\n                    },\r\n                }),\r\n            );\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","\r\nexport const eventResMs = 20;","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"6218s\");","import {BB} from '../../bb/bb';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport brushIconImg from '/src/app/img/ui/brush-blend.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const blendBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-blend'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-blend');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.BlendBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: 58,\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n            const blendingSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 225,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: brush.getBlending(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val);\r\n                },\r\n            });\r\n            blendingSlider.getElement().style.marginTop = '10px';\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.setSizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.setOpacityPressure(b);\r\n            });\r\n\r\n            const lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                    display: 'inline-block',\r\n                },\r\n            });\r\n\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                }),\r\n                blendingSlider.getElement(),\r\n                lockAlphaToggle.getElement()\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y, p, isCoalesced);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"50oCU\");","import {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport brushIconImg from '/src/app/img/ui/brush-sketchy.png';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\nimport {BB} from '../../bb/bb';\r\n\r\nexport const sketchyBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-sketchy'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 10,\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-sketchy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.SketchyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize() * 2,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: function (val) {\r\n                    brush.setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n            const blendSlider = new KlSlider({\r\n                label: LANG('brush-blending'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: brush.getBlending(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: function (val) {\r\n                    brush.setBlending(val);\r\n                },\r\n            });\r\n            const scaleSlider = new KlSlider({\r\n                label: LANG('brush-sketchy-scale'),\r\n                width: 250,\r\n                height: 30,\r\n                min: 1,\r\n                max: 20,\r\n                value: brush.getScale(),\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brush.setScale(val);\r\n                },\r\n            });\r\n            opacitySlider.getElement().style.marginTop = '10px';\r\n            blendSlider.getElement().style.marginTop = '10px';\r\n            scaleSlider.getElement().style.marginTop = '10px';\r\n            div.append(\r\n                sizeSlider.getElement(),\r\n                opacitySlider.getElement(),\r\n                blendSlider.getElement(),\r\n                scaleSlider.getElement(),\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, pressure) {\r\n            brush.startLine(x, y, pressure);\r\n        };\r\n        this.goLine = function (x, y, pressure) {\r\n            brush.goLine(x, y, pressure, null);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getSeed = function () {\r\n            return parseInt(brush.getSeed());\r\n        };\r\n        this.setSeed = function (s) {\r\n            brush.setSeed(parseInt(s));\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"jDYzC\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport brushIconImg from '/src/app/img/ui/brush-pixel.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const pixelBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-pixel'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]],\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-pixel');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.PixelBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n            css: {\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n\r\n        const eraserToggle = new Checkbox({\r\n            init: brush.getIsEraser(),\r\n            label: LANG('eraser'),\r\n            callback: function (b) {\r\n                brush.setIsEraser(b);\r\n            },\r\n            css: {\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n\r\n        const ditherToggle = new Checkbox({\r\n            init: brush.getUseDither(),\r\n            label: LANG('brush-pixel-dither'),\r\n            callback: function (b) {\r\n                brush.setUseDither(b);\r\n            },\r\n        });\r\n\r\n        const spacingSpline = new BB.SplineInterpolator([[0.5, 0.45], [100, 4]]);\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                opacitySlider.getElement()\r\n            );\r\n\r\n            const toggleRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n\r\n            toggleRow.append(\r\n                lockAlphaToggle.getElement(),\r\n                eraserToggle.getElement(),\r\n                ditherToggle.getElement(),\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size * 2);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity * 100);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine(x, y);\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"j07R3\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport brushIconImg from '/src/app/img/ui/brush-eraser.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const eraserBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('eraser') + ' [E]',\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 200,\r\n            curve: BB.quadraticSplineInput(0.5, 200, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('eraser') + ' [E]';\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.EraserBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n        let isTransparentBg = false;\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: 30,\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brushInterface.opacitySlider.max,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                })\r\n            );\r\n\r\n            const transparencyToggle = new Checkbox({\r\n                init: false,\r\n                label: LANG('brush-eraser-transparent-bg'),\r\n                callback: function (b) {\r\n                    isTransparentBg = b;\r\n                    brush.setTransparentBG(b);\r\n                },\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            div.append(transparencyToggle.getElement());\r\n        }\r\n\r\n        init();\r\n\r\n        function drawDot (x, y) {\r\n            brush.drawDot(x, y);\r\n        }\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.isDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n        this.setColor = function (c) {\r\n            //brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.getIsTransparentBg = function () {\r\n            return isTransparentBg;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.isDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"fvqmo\");","import {BB} from '../../bb/bb';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\r\nimport brushIconImg from '/src/app/img/ui/brush-smudge.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const smudgeBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-smudge'),\r\n        sizeSlider: {\r\n            min: 0.5,\r\n            max: 100,\r\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]],\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-smudge');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.SmudgeBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n        let sizeSlider;\r\n        let opacitySlider;\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: brush.getLockAlpha(),\r\n            label: LANG('lock-alpha'),\r\n            callback: function (b) {\r\n                brush.setLockAlpha(b);\r\n            },\r\n            doHighlight: true,\r\n            title: LANG('lock-alpha-title'),\r\n        });\r\n\r\n        const spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 10) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 225,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                curve: brushInterface.opacitySlider.curve,\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            const pressureSizeToggle = createPenPressureToggle(false, function (b) {\r\n                brush.sizePressure(b);\r\n            });\r\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\r\n                brush.opacityPressure(b);\r\n            });\r\n\r\n            div.append(\r\n                BB.el({\r\n                    content: [\r\n                        sizeSlider.getElement(),\r\n                        pressureSizeToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                        marginBottom: '10px',\r\n                    },\r\n                }),\r\n                BB.el({\r\n                    content: [\r\n                        opacitySlider.getElement(),\r\n                        pressureOpacityToggle,\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'center',\r\n                    },\r\n                })\r\n            );\r\n\r\n            const bottomRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            bottomRow.append(lockAlphaToggle.getElement());\r\n\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing()) {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y, p);\r\n        };\r\n        this.goLine = function (x, y, p) {\r\n            brush.goLine(x, y, p);\r\n        };\r\n        this.endLine = function (x, y) {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"gNPk4\");","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './brushes-consts';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {brushes} from '../brushes/brushes';\r\nimport {klHistory} from '../history/kl-history';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport brushIconImg from '/src/app/img/ui/brush-chemy.svg';\r\nimport {IBrushUi} from '../kl-types';\r\nimport {Options} from '../ui/components/options';\r\nimport {BoxToggle} from '../ui/components/box-toggle';\r\nimport {LANG, languageStrings} from '../../language/language';\r\n\r\nexport const chemyBrushUi = (function () {\r\n    const brushInterface: IBrushUi = {\r\n        image: brushIconImg,\r\n        tooltip: LANG('brush-chemy'),\r\n        sizeSlider: {\r\n            min: 0.25,\r\n            max: 25,\r\n            curve: BB.quadraticSplineInput(0.25, 25, 0.1),\r\n            isDisabled: true,\r\n        },\r\n        opacitySlider: {\r\n            min: 1 / 100,\r\n            max: 1,\r\n        },\r\n        Ui: null,\r\n    };\r\n\r\n    languageStrings.subscribe(() => {\r\n        brushInterface.tooltip = LANG('brush-chemy');\r\n    });\r\n\r\n    brushInterface.Ui = function (p) {\r\n        const div = document.createElement('div'); // the gui\r\n        const brush = new brushes.ChemyBrush();\r\n        brush.setHistory(klHistory);\r\n        p.onSizeChange(brush.getSize());\r\n\r\n        let sizeSlider: KlSlider;\r\n        let opacitySlider: KlSlider;\r\n\r\n        function setSize (size) {\r\n            brush.setSize(size);\r\n        }\r\n\r\n        function init () {\r\n            sizeSlider = new KlSlider({\r\n                label: LANG('brush-size'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.sizeSlider.min,\r\n                max: brushInterface.sizeSlider.max,\r\n                value: brush.getSize(),\r\n                curve: brushInterface.sizeSlider.curve,\r\n                eventResMs: eventResMs,\r\n                isEnabled: brush.getMode() === 'stroke',\r\n                toDisplayValue: (val) => val * 2,\r\n                toValue: (displayValue) => displayValue / 2,\r\n                onChange: (val) => {\r\n                    setSize(val);\r\n                    p.onSizeChange(val);\r\n                },\r\n                formatFunc: (displayValue) => {\r\n                    if (displayValue < 5) {\r\n                        return BB.round(displayValue, 1);\r\n                    } else {\r\n                        return Math.round(displayValue);\r\n                    }\r\n                },\r\n                manualInputRoundDigits: 1,\r\n            });\r\n            opacitySlider = new KlSlider({\r\n                label: LANG('opacity'),\r\n                width: 250,\r\n                height: 30,\r\n                min: brushInterface.opacitySlider.min,\r\n                max: brushInterface.opacitySlider.max,\r\n                value: brush.getOpacity(),\r\n                eventResMs: eventResMs,\r\n                toDisplayValue: (val) => val * 100,\r\n                toValue: (displayValue) => displayValue / 100,\r\n                onChange: (val) => {\r\n                    brush.setOpacity(val);\r\n                    p.onOpacityChange(val);\r\n                },\r\n            });\r\n\r\n            BB.css(opacitySlider.getElement(), {\r\n                marginTop: '10px',\r\n            });\r\n\r\n            const eraserToggle = new Checkbox({\r\n                init: brush.getIsEraser(),\r\n                label: LANG('eraser'),\r\n                callback: function (b) {\r\n                    brush.setIsEraser(b);\r\n                },\r\n                css: {\r\n                    marginTop: '10px',\r\n                    marginLeft: '10px',\r\n                },\r\n            });\r\n\r\n            const lockAlphaToggle = new Checkbox({\r\n                init: brush.getLockAlpha(),\r\n                label: LANG('lock-alpha'),\r\n                callback: function (b) {\r\n                    brush.setLockAlpha(b);\r\n                },\r\n                doHighlight: true,\r\n                title: LANG('lock-alpha-title'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n\r\n            const toggleRow = BB.el({\r\n                css: {\r\n                    display: 'flex',\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n\r\n            const iconSize = 35;\r\n            const padding = 8;\r\n            const actualIconSize = iconSize - padding * 2;\r\n            const halfSize = actualIconSize / 2;\r\n\r\n            const modeOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'fill',\r\n                        label: BB.createSvg({\r\n                            class: 'dark-invert',\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: '#000',\r\n                                    style: `transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-fill'),\r\n                    },\r\n                    {\r\n                        id: 'stroke',\r\n                        label: BB.createSvg({\r\n                            class: 'dark-invert',\r\n                            elementType: 'svg',\r\n                            width: iconSize + '',\r\n                            height: iconSize + '',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'path',\r\n                                    fill: 'none',\r\n                                    stroke: '#000',\r\n                                    style: `stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\r\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\r\n                                },\r\n                            ],\r\n                        }),\r\n                        title: LANG('brush-chemy-stroke'),\r\n                    },\r\n                ],\r\n                initId: brush.getMode(),\r\n                onChange: (id: string): void => {\r\n                    brush.setMode(id as 'stroke' | 'fill');\r\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === 'fill';\r\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\r\n\r\n                    const brushSize = brush.getSize();\r\n                    sizeSlider.setValue(brushSize);\r\n                    p.onSizeChange(brushSize);\r\n                    p.onConfigChange();\r\n                },\r\n            });\r\n\r\n            const mirrorXToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    class: 'dark-invert',\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`,\r\n                        },\r\n                    ],\r\n                }),\r\n                title: LANG('brush-chemy-mirror-x'),\r\n                init: brush.getXSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setXSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const mirrorYToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    class: 'dark-invert',\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'path',\r\n                            fill: 'none',\r\n                            stroke: '#000',\r\n                            style: 'stroke-width: 1px',\r\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`,\r\n                        },\r\n                    ],\r\n                }),\r\n                title: LANG('brush-chemy-mirror-y'),\r\n                init: brush.getYSymmetry(),\r\n                onChange: (b) => {\r\n                    brush.setYSymmetry(b);\r\n                },\r\n            });\r\n\r\n            const gradientToggle = new BoxToggle({\r\n                label: BB.createSvg({\r\n                    class: 'dark-invert',\r\n                    elementType: 'svg',\r\n                    width: iconSize + '',\r\n                    height: iconSize + '',\r\n                    childrenArr: [\r\n                        {\r\n                            elementType: 'defs',\r\n                            childrenArr: [\r\n                                {\r\n                                    elementType: 'linearGradient',\r\n                                    id: 'gradient',\r\n                                    x1: '0',\r\n                                    y1: '0',\r\n                                    x2: '0',\r\n                                    y2: '1',\r\n                                    childrenArr: [\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '0%',\r\n                                            'stop-color': 'rgba(0,0,0,0)',\r\n                                        },\r\n                                        {\r\n                                            elementType: 'stop',\r\n                                            offset: '100%',\r\n                                            'stop-color': 'rgba(0,0,0,1)',\r\n                                        },\r\n                                    ],\r\n                                },\r\n                            ],\r\n                        },\r\n                        {\r\n                            elementType: 'rect',\r\n                            fill: \"url('#gradient')\",\r\n                            x: '' + padding,\r\n                            y: '' + padding,\r\n                            width: '' + actualIconSize,\r\n                            height: '' + actualIconSize,\r\n                        },\r\n                    ],\r\n                }),\r\n                title: LANG('brush-chemy-gradient'),\r\n                init: brush.getGradient(),\r\n                onChange: (b) => {\r\n                    brush.setGradient(b);\r\n                },\r\n            });\r\n\r\n            BB.css(mirrorXToggle.getElement(), {\r\n                marginLeft: '10px',\r\n            });\r\n            {\r\n                const margin = {\r\n                    marginLeft: '4px',\r\n                };\r\n                BB.css(mirrorYToggle.getElement(), margin);\r\n                BB.css(gradientToggle.getElement(), margin);\r\n            }\r\n\r\n            toggleRow.append(\r\n                modeOptions.getElement(),\r\n                mirrorXToggle.getElement(),\r\n                mirrorYToggle.getElement(),\r\n                gradientToggle.getElement(),\r\n            );\r\n\r\n            div.append(\r\n                sizeSlider.getElement(),\r\n                opacitySlider.getElement(),\r\n                toggleRow,\r\n                BB.el({\r\n                    content: [\r\n                        lockAlphaToggle.getElement(),\r\n                        eraserToggle.getElement(),\r\n                    ],\r\n                    css: {\r\n                        display: 'flex',\r\n                    },\r\n                })\r\n            );\r\n        }\r\n\r\n        init();\r\n\r\n        this.increaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.changeSliderValue(f);\r\n            }\r\n        };\r\n        this.decreaseSize = function (f) {\r\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\r\n                sizeSlider.changeSliderValue(-f);\r\n            }\r\n        };\r\n\r\n        this.getSize = function () {\r\n            return brush.getSize();\r\n        };\r\n        this.setSize = function (size) {\r\n            setSize(size);\r\n            sizeSlider.setValue(size);\r\n        };\r\n        this.getOpacity = function () {\r\n            return brush.getOpacity();\r\n        };\r\n        this.setOpacity = function (opacity) {\r\n            brush.setOpacity(opacity);\r\n            opacitySlider.setValue(opacity);\r\n        };\r\n\r\n        this.setColor = function (c) {\r\n            brush.setColor(c);\r\n        };\r\n        this.setContext = function (c) {\r\n            brush.setContext(c);\r\n        };\r\n        this.startLine = function (x, y, p) {\r\n            brush.startLine(x, y);\r\n        };\r\n        this.goLine = function (x, y, p, isCoalesced) {\r\n            brush.goLine(x, y);\r\n        };\r\n        this.endLine = function () {\r\n            brush.endLine();\r\n        };\r\n        this.getBrush = function () {\r\n            return brush;\r\n        };\r\n        this.isDrawing = function () {\r\n            return brush.getIsDrawing();\r\n        };\r\n        this.getElement = function () {\r\n            return div;\r\n        };\r\n    };\r\n\r\n    return brushInterface;\r\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"371uF\");","import {BB} from '../../../bb/bb';\r\nimport {DynamicModal} from './base/dynamic-modal';\r\nimport {LANG} from '../../../language/language';\r\n\r\nexport function showIframeModal (\r\n    url: string,\r\n    isEmbed: boolean,\r\n) {\r\n\r\n    // window very small, modal might look bad\r\n    if (!isEmbed && (window.innerHeight < 500 || window.innerWidth < 700)) {\r\n        window.open(url);\r\n        return;\r\n    }\r\n\r\n    const iframe = BB.el({\r\n        tagName: 'iframe',\r\n        custom: {\r\n            src: url,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            height: '100%',\r\n            opacity: '0',\r\n        },\r\n    }) as HTMLIFrameElement;\r\n    setTimeout(() => {\r\n        iframe.style.opacity = ''; // fallback\r\n    }, 500);\r\n\r\n    const titleEl = BB.el();\r\n\r\n    let linkEl: HTMLElement | undefined;\r\n    if (!isEmbed) {\r\n        linkEl = BB.el({\r\n            tagName: 'a',\r\n            parent: titleEl,\r\n            content: LANG('modal-new-tab'),\r\n            custom: {\r\n                href: 'help',\r\n                target: '_blank',\r\n            },\r\n            onClick: function () {\r\n                popup.close();\r\n            },\r\n        }) as HTMLAnchorElement;\r\n        iframe.onload = () => {\r\n            if (linkEl && iframe.contentWindow) {\r\n                BB.setAttributes(linkEl, {\r\n                    href: '' + iframe.contentWindow.location,\r\n                });\r\n            }\r\n            iframe.style.opacity = '';\r\n        };\r\n    }\r\n\r\n\r\n    const popup = new DynamicModal({\r\n        title: titleEl,\r\n        content: iframe,\r\n        width: 880,\r\n        isMaxHeight: true,\r\n        onClose: () => {\r\n            if (linkEl) {\r\n                iframe.src = 'about:blank';\r\n                BB.destroyEl(linkEl);\r\n                linkEl = undefined;\r\n            }\r\n        },\r\n    });\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nexport class RadioList {\r\n\r\n    el: HTMLDivElement;\r\n    inputs: HTMLInputElement[] = [];\r\n\r\n    constructor ({name, init, items, ignoreFocus}: {\r\n        name: string;\r\n        init?: string;\r\n        items: {\r\n            label: string;\r\n            value: string;\r\n        }[];\r\n        ignoreFocus?: boolean; // default false\r\n    }) {\r\n        this.el = BB.el({\r\n            className: 'kl-radio',\r\n        }) as HTMLDivElement;\r\n\r\n        items.forEach(item => {\r\n            const label = BB.el({\r\n                tagName: 'label',\r\n            });\r\n            const input = BB.el({\r\n                tagName: 'input',\r\n                parent: label,\r\n                custom: {\r\n                    name: name,\r\n                    value: item.value,\r\n                    type: 'radio',\r\n                },\r\n            }) as HTMLInputElement;\r\n            if (ignoreFocus) {\r\n                input.setAttribute('data-ignore-focus', 'true');\r\n            }\r\n            if (init === item.value) {\r\n                input.checked = true;\r\n            }\r\n            label.append(item.label);\r\n            this.el.append(label);\r\n            this.inputs.push(input);\r\n        });\r\n    }\r\n\r\n\r\n    getValue (): string | null {\r\n        for (let i = 0; i < this.inputs.length; i++) {\r\n            if (this.inputs[i].checked) {\r\n                return this.inputs[i].value;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    getElement () {\r\n        return this.el;\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\n\r\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\r\nimport {IKlProject} from '../../kl-types';\r\nimport {showIframeModal} from '../modals/show-iframe-modal';\r\nimport {SaveReminder} from './save-reminder';\r\nimport {IProjectStoreListener, ProjectStore} from '../../storage/project-store';\r\nimport {KL} from '../../kl';\r\nimport {LANG} from '../../../language/language';\r\nimport {theme} from '../../../theme/theme';\r\n\r\nexport class BrowserStorageUi {\r\n\r\n    private previewEl: HTMLDivElement;\r\n    private readonly infoEl: HTMLElement;\r\n    private readonly ageEl: HTMLElement;\r\n    private readonly storeButtonEl: HTMLButtonElement;\r\n    private readonly clearButtonEl: HTMLButtonElement;\r\n    private readonly storeListener: IProjectStoreListener;\r\n    private readonly updateCheckerboard: () => void;\r\n\r\n    private timestamp: number;\r\n    private thumbnail: HTMLImageElement | HTMLCanvasElement | undefined;\r\n\r\n    private updateAge () {\r\n        if (!this.timestamp) {\r\n            return;\r\n        }\r\n        let age = new Date().getTime() - this.timestamp;\r\n        let ageStr;\r\n        age = Math.floor(age / 1000 / 60);\r\n        ageStr = LANG('file-storage-min-ago').replace('{x}', '' + age);\r\n        if (age > 60) {\r\n            age = Math.floor(age / 60);\r\n            ageStr = LANG('file-storage-hours-ago').replace('{x}', '' + age);\r\n            if (age > 24) {\r\n                age = Math.floor(age / 24);\r\n                ageStr = LANG('file-storage-days-ago').replace('{x}', '' + age);\r\n                if (age > 31) {\r\n                    ageStr = LANG('file-storage-month-ago');\r\n                }\r\n            }\r\n        }\r\n        this.ageEl.textContent = ageStr;\r\n    }\r\n\r\n    private resetButtons () {\r\n        if (this.timestamp) {\r\n            this.storeButtonEl.textContent = LANG('file-storage-overwrite');\r\n            this.storeButtonEl.disabled = false;\r\n            this.clearButtonEl.disabled = false;\r\n        } else {\r\n            this.storeButtonEl.textContent = LANG('file-storage-store');\r\n            this.storeButtonEl.disabled = false;\r\n            this.clearButtonEl.disabled = true;\r\n        }\r\n    }\r\n\r\n    private updateThumb (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\r\n        this.timestamp = timestamp;\r\n        this.thumbnail = thumbnail;\r\n        if (this.timestamp && thumbnail) {\r\n            thumbnail.classList.add('kl-storage-preview__im');\r\n            this.previewEl.innerHTML = '';\r\n            this.updateAge();\r\n            this.previewEl.append(thumbnail, this.ageEl);\r\n        } else {\r\n            this.previewEl.innerHTML = LANG('file-storage-empty');\r\n        }\r\n        this.resetButtons();\r\n    }\r\n\r\n    private async store () {\r\n        this.storeButtonEl.textContent = LANG('file-storage-storing');\r\n        this.storeButtonEl.disabled = true;\r\n        this.clearButtonEl.disabled = true;\r\n        await new Promise((resolve) => {\r\n            setTimeout(() => resolve(null), 20);\r\n        });\r\n        try {\r\n            await this.projectStore.store(this.getProject());\r\n            this.saveReminder.reset();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: [\r\n                    `${LANG('file-storage-failed-1')}<ul>`,\r\n                    `<li>${LANG('file-storage-failed-2')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-3')}</li>`,\r\n                    `<li>${LANG('file-storage-failed-4')}</li>`,\r\n                    '</ul>',\r\n                ].join(''),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to store browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    private async clear () {\r\n        this.storeButtonEl.disabled = true;\r\n        this.clearButtonEl.disabled = true;\r\n        try {\r\n            await this.projectStore.clear();\r\n        } catch (e) {\r\n            this.resetButtons();\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: LANG('file-storage-failed-clear'),\r\n                buttons: ['Ok'],\r\n            });\r\n            setTimeout(() => {\r\n                throw new Error('storage-ui: failed to clear browser storage, ' + e);\r\n            }, 0);\r\n        }\r\n    }\r\n\r\n    element: HTMLDivElement;\r\n\r\n    constructor (\r\n        private projectStore: ProjectStore,\r\n        private getProject: () => IKlProject,\r\n        private saveReminder: SaveReminder,\r\n        private klRootEl: HTMLElement,\r\n        private options?: { hideClearButton?: boolean; isFocusable?: boolean }, // isFocusable default = false\r\n    ) {\r\n        this.element = BB.el({\r\n            css: {\r\n                display: 'grid',\r\n                gridTemplateColumns: '1fr 0fr',\r\n                gridTemplateRows: '0fr 0fr 0fr',\r\n                gap: '0 0',\r\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"',\r\n            },\r\n        }) as HTMLDivElement;\r\n\r\n\r\n        const title = BB.el({\r\n            parent: this.element,\r\n            content: LANG('file-storage'),\r\n            css: {\r\n                gridArea: 'title',\r\n                display: 'flex',\r\n                margin: '-5px 0',\r\n                //background: '#f00',\r\n            },\r\n        });\r\n\r\n        this.infoEl = BB.el({\r\n            parent: title,\r\n            content: '?',\r\n            className: 'kl-storage-about',\r\n            title: LANG('file-storage-about'),\r\n            onClick: () => {\r\n                showIframeModal('./help/#help-browser-storage', false);\r\n            },\r\n        }) as HTMLDivElement;\r\n\r\n        if (this.projectStore.isBroken()) {\r\n            BB.el({\r\n                parent: this.element,\r\n                content: ' ' + LANG('file-storage-cant-access'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            return;\r\n        }\r\n\r\n        this.previewEl = BB.el({\r\n            parent: this.element,\r\n            title: LANG('file-storage-thumb-title'),\r\n            className: 'kl-storage-preview',\r\n        }) as HTMLDivElement;\r\n        this.ageEl = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                right: '1px',\r\n                bottom: '1px',\r\n                width: 'calc(100% - 2px)',\r\n                textAlign: 'center',\r\n                background: 'rgba(0,0,0,0.7)',\r\n                color: '#fff',\r\n                textSize: '13px',\r\n            },\r\n        }) as HTMLDivElement;\r\n        const btnCustom = options?.isFocusable ?  {} : {\r\n            tabIndex: -1,\r\n        };\r\n        this.storeButtonEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'grid-button',\r\n            content: LANG('file-storage-store'),\r\n            css: {\r\n                gridArea: 'store',\r\n                //background: '#00f',\r\n            },\r\n            custom: btnCustom,\r\n            onClick: () => this.store(),\r\n        }) as HTMLButtonElement;\r\n        this.clearButtonEl = BB.el({\r\n            parent: this.element,\r\n            tagName: 'button',\r\n            className: 'grid-button',\r\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/> ' + LANG('file-storage-clear'),\r\n            css: {\r\n                gridArea: 'clear',\r\n                //background: '#ff0',\r\n            },\r\n            custom: btnCustom,\r\n            onClick: () => this.clear(),\r\n        }) as HTMLButtonElement;\r\n\r\n        if (this.options?.hideClearButton) {\r\n            this.clearButtonEl.style.visibility = 'hidden';\r\n        }\r\n\r\n        this.storeListener = {\r\n            onUpdate: (timestamp, thumbnail) => {\r\n                this.updateThumb(timestamp, thumbnail);\r\n            },\r\n        };\r\n        this.projectStore.subscribe(this.storeListener);\r\n\r\n        this.updateCheckerboard = (): void => {\r\n            if (!this.thumbnail) {\r\n                return;\r\n            }\r\n            BB.css(this.thumbnail, {\r\n                background: \"url('\" + BB.createCheckerCanvas(4, theme.isDark()).toDataURL('image/png') + \"')\",\r\n            });\r\n        };\r\n        theme.addIsDarkListener(this.updateCheckerboard);\r\n\r\n        setInterval(() => this.updateAge(), 1000 * 60);\r\n\r\n        (async () => {\r\n            try {\r\n                const readResult = await this.projectStore.read();\r\n                if (readResult) {\r\n                    this.updateThumb(readResult.timestamp, readResult.thumbnail);\r\n                } else {\r\n                    this.updateThumb();\r\n                }\r\n            } catch (e) {\r\n                setTimeout(() => {\r\n                    throw new Error('storage-ui: failed initial read browser storage, ' + e);\r\n                }, 0);\r\n            }\r\n        })();\r\n    }\r\n\r\n\r\n    getElement () {\r\n        return this.element;\r\n    }\r\n\r\n    show () {\r\n        // todo\r\n    }\r\n\r\n    hide () {\r\n        // todo\r\n    }\r\n\r\n    destroy () {\r\n        BB.destroyEl(this.infoEl);\r\n        BB.destroyEl(this.storeButtonEl);\r\n        BB.destroyEl(this.clearButtonEl);\r\n        theme.removeIsDarkListener(this.updateCheckerboard);\r\n        this.projectStore.unsubscribe(this.storeListener);\r\n    }\r\n}","import {IKlProject, IKlStorageProject} from '../kl-types';\r\nimport {ProjectConverter, TReadStorageProjectResult} from './project-converter';\r\nimport {clear, getKlProjectObj, storeKlProjectObj} from './indexed-db';\r\nimport {LocalStorage} from '../../bb/base/local-storage';\r\n\r\n\r\nexport interface IProjectStoreListener {\r\n    onUpdate: (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) => void;\r\n}\r\n\r\nfunction makeAsync<T> (\r\n    nonAsyncFunc: (\r\n        resolveCallback: (value: T) => void,\r\n        rejectCallback: (reason?: any) => void\r\n    ) => void,\r\n): Promise<T> {\r\n    return new Promise<T>((resolve, reject) => {\r\n        nonAsyncFunc(resolve, reject);\r\n    });\r\n}\r\n\r\n/**\r\n * simplified interface for storing projects into browser storage\r\n */\r\nexport class ProjectStore {\r\n\r\n    private listeners: IProjectStoreListener[] = [];\r\n    private accessHasFailed: boolean = false;\r\n\r\n    async lowLevelStore (project: IKlStorageProject): Promise<void> {\r\n        await new Promise<void>((resolve, reject) => {\r\n            storeKlProjectObj(project, resolve, reject);\r\n        });\r\n    }\r\n\r\n    async lowLevelRead (): Promise<IKlStorageProject> {\r\n        return await makeAsync(getKlProjectObj) as IKlStorageProject;\r\n    }\r\n\r\n    async lowLevelClear (): Promise<void> {\r\n        await makeAsync<void>(clear);\r\n    }\r\n\r\n\r\n\r\n    private emit (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement): void {\r\n        this.listeners.forEach(item => {\r\n            item.onUpdate(timestamp, thumbnail);\r\n        });\r\n    }\r\n\r\n    private updateTimestamp (): void {\r\n        LocalStorage.setItem('indexedDbUpdatedAt', '' + new Date().getTime());\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor () {\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== 'indexedDbUpdatedAt' || this.listeners.length === 0) {\r\n                return;\r\n            }\r\n            try {\r\n                ( async (): Promise<void> => {\r\n                    const readResult = await this.read();\r\n                    if (readResult) {\r\n                        this.emit(readResult.timestamp, readResult.thumbnail);\r\n                    } else {\r\n                        this.emit();\r\n                    }\r\n                })();\r\n            } catch (e) {\r\n                if (e.message.indexOf('db-error') === 0) {\r\n                    this.accessHasFailed = true;\r\n                }\r\n            }\r\n\r\n        });\r\n    }\r\n\r\n    async read (): Promise<{\r\n        project: IKlProject;\r\n        timestamp: number;\r\n        thumbnail: HTMLImageElement | HTMLCanvasElement;\r\n    } | undefined> {\r\n        let storageProject;\r\n        try {\r\n            storageProject = await this.lowLevelRead();\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        if (!storageProject) {\r\n            return undefined;\r\n        }\r\n        let result;\r\n        try {\r\n            result = await ProjectConverter.readStorageProject(storageProject);\r\n        } catch (e) {\r\n            throw new Error('format-error: ' + e);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    async store (project: IKlProject): Promise<void> {\r\n        try {\r\n            const storageProject = ProjectConverter.createStorageProject(project);\r\n            await this.lowLevelStore(storageProject);\r\n        } catch (e) {\r\n            this.accessHasFailed = true;\r\n            throw new Error('db-error: ' + e);\r\n        }\r\n        {\r\n            // immediately test if it can be read\r\n            const storageProject = await this.lowLevelRead();\r\n            let readResult: TReadStorageProjectResult;\r\n            try {\r\n                readResult = await ProjectConverter.readStorageProject(storageProject);\r\n            } catch (e) {\r\n                await this.lowLevelClear();\r\n                this.updateTimestamp();\r\n                setTimeout(() => this.emit(), 0);\r\n                throw new Error('format-error: ' + e);\r\n            }\r\n            this.updateTimestamp();\r\n            setTimeout(() => this.emit(readResult.timestamp, readResult.thumbnail), 0);\r\n        }\r\n    }\r\n\r\n    async clear (): Promise<void> {\r\n        await this.lowLevelClear();\r\n        this.updateTimestamp();\r\n        setTimeout(() => this.emit(), 0);\r\n    }\r\n\r\n    subscribe (listener: IProjectStoreListener): void {\r\n        if (this.listeners.includes(listener)) {\r\n            return;\r\n        }\r\n        this.listeners.push(listener);\r\n    }\r\n\r\n    unsubscribe (listener: IProjectStoreListener): void {\r\n        for (let i = 0; i < this.listeners.length; i++) {\r\n            if (listener === this.listeners[i]) {\r\n                this.listeners.splice(i, 1);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    isBroken (): boolean {\r\n        return this.accessHasFailed;\r\n    }\r\n\r\n}","import {IKlProject, IKlStorageProject} from '../kl-types';\r\nimport {BB} from '../../bb/bb';\r\nimport {drawProject} from '../canvas/draw-project';\r\nimport {base64ToBlob} from './base-64-to-blob';\r\n\r\nexport type TReadStorageProjectResult = {\r\n    project: IKlProject;\r\n    timestamp: number;\r\n    thumbnail: HTMLImageElement | HTMLCanvasElement;\r\n};\r\n\r\nconst thumbSize = 240;\r\n\r\nfunction loadImage (blob: Blob): Promise<HTMLImageElement> {\r\n    return new Promise<HTMLImageElement>((resolve, reject) => {\r\n        const im = new Image();\r\n        try {\r\n            im.src = BB.imageBlobToUrl(blob);\r\n        } catch (e) {\r\n            reject('imageBlobToUrl, ' + e.message);\r\n            return;\r\n        }\r\n        im.onload = (): void => {\r\n            URL.revokeObjectURL(im.src);\r\n            resolve(im);\r\n        };\r\n        im.onabort = (): void => {\r\n            reject('layer image failed loading');\r\n        };\r\n        im.onerror = (): void => {\r\n            reject('layer image failed loading');\r\n        };\r\n    });\r\n}\r\n\r\n/**\r\n * for:\r\n * - preparing project to be stored in ProjectStore\r\n * - reading a project that came out of the ProjectStore\r\n */\r\nexport class ProjectConverter {\r\n\r\n    private static createThumbnail (project: IKlProject): HTMLCanvasElement {\r\n        const size = BB.fitInto(project.width, project.height, thumbSize, thumbSize);\r\n        const factor = size.width / project.width;\r\n        return drawProject(project, factor);\r\n    }\r\n\r\n    static createStorageProject (project: IKlProject): IKlStorageProject {\r\n        return {\r\n            id: 1,\r\n            timestamp: new Date().getTime(),\r\n            thumbnail: base64ToBlob(ProjectConverter.createThumbnail(project).toDataURL('image/png')),\r\n            width: project.width,\r\n            height: project.height,\r\n            layers: project.layers.map(item => {\r\n                let blob;\r\n                if (item.image instanceof HTMLCanvasElement) {\r\n                    blob = base64ToBlob((item.image as HTMLCanvasElement).toDataURL('image/png'));\r\n                } else {\r\n                    // todo image\r\n                    throw new Error('Not implemented');\r\n                }\r\n                return {\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                    blob,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n\r\n    static async readStorageProject (storageProject: IKlStorageProject): Promise<TReadStorageProjectResult> {\r\n        if (\r\n            !storageProject.width || !storageProject.height ||\r\n            isNaN(storageProject.width) || isNaN(storageProject.height) ||\r\n            storageProject.width < 1 || storageProject.height < 1\r\n        ) {\r\n            throw new Error('readStorageProject invalid canvas size: ' + storageProject.width + ', ' + storageProject.height);\r\n        }\r\n        const project: IKlProject = {\r\n            width: storageProject.width,\r\n            height: storageProject.height,\r\n            layers: (await Promise.all(storageProject.layers.map(layer => loadImage(layer.blob))))\r\n                .map((image, i) => {\r\n                    return {\r\n                        name: storageProject.layers[i].name,\r\n                        opacity: storageProject.layers[i].opacity,\r\n                        mixModeStr: storageProject.layers[i].mixModeStr,\r\n                        image,\r\n                    };\r\n                }),\r\n        };\r\n\r\n        let thumbnail;\r\n        if (storageProject.thumbnail) {\r\n            thumbnail = await loadImage(storageProject.thumbnail);\r\n        } else {\r\n            thumbnail = ProjectConverter.createThumbnail(project);\r\n        }\r\n\r\n        return {\r\n            project: project,\r\n            timestamp: storageProject.timestamp,\r\n            thumbnail: thumbnail,\r\n        };\r\n    }\r\n\r\n}","\r\nexport function base64ToBlob (base64Str: string): Blob {\r\n    const parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n    const binStr = atob(parts[3]);\r\n    const buf = new ArrayBuffer(binStr.length);\r\n    const view = new Uint8Array(buf);\r\n    for (let i = 0; i < view.length; i++) {\r\n        view[i] = binStr.charCodeAt(i);\r\n    }\r\n    return new Blob([view], {'type': parts[1]});\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {BrowserStorageUi} from '../components/browser-storage-ui';\r\nimport {IKlProject, TDropOption, TExportType} from '../../kl-types';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {LANG} from '../../../language/language';\r\nimport newImageImg from '/src/app/img/ui/new-image.svg';\r\nimport exportImg from '/src/app/img/ui/export.svg';\r\nimport shareImg from '/src/app/img/ui/share.svg';\r\nimport uploadImg from '/src/app/img/ui/upload.svg';\r\nimport importImg from '/src/app/img/ui/import.svg';\r\nimport copyImg from '/src/app/img/ui/copy.svg';\r\n\r\nexport class FileTab {\r\n\r\n    private readonly rootEl: HTMLDivElement;\r\n    private importButton: undefined | HTMLInputElement;\r\n    private fileBrowserStorage: undefined | BrowserStorageUi;\r\n\r\n    constructor (\r\n        klRootEl: HTMLElement,\r\n        projectStore: ProjectStore,\r\n        getProject: () => IKlProject,\r\n        private exportType: TExportType,\r\n        onExportTypeChange: (type: TExportType) => void,\r\n        onFileSelect: (fileList: FileList, optionStr: TDropOption) => void,\r\n        onSaveImageToComputer: () => void,\r\n        onNewImage: () => void,\r\n        onShareImage: (callback: () => void) => void,\r\n        onUpload: () => void,\r\n        onCopyToClipboard: () => void,\r\n        saveReminder: SaveReminder,\r\n    ) {\r\n        this.rootEl = document.createElement('div');\r\n\r\n        const asyncCreation = (): void => {\r\n            const fileMenu = document.createElement('div');\r\n            const newButton = document.createElement('button');\r\n            const saveButton = document.createElement('button');\r\n            const shareButton = document.createElement('button');\r\n            const uploadImgurButton = document.createElement('button');\r\n            const clipboardButton = document.createElement('button');\r\n\r\n            newButton.style.cssFloat = 'left';\r\n            BB.css(saveButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n                flexGrow: '1',\r\n            });\r\n            BB.css(clipboardButton, {\r\n                cssFloat: 'left',\r\n                clear: 'both',\r\n            });\r\n\r\n            newButton.tabIndex = -1;\r\n            saveButton.tabIndex = -1;\r\n            shareButton.tabIndex = -1;\r\n            uploadImgurButton.tabIndex = -1;\r\n            clipboardButton.tabIndex = -1;\r\n\r\n            newButton.innerHTML = `<img class=\"dark-no-invert\" src='${newImageImg}' alt='icon' height='20'/>${LANG('file-new')}`;\r\n            saveButton.innerHTML = `<img src='${exportImg}' alt='icon' height='20'/>${LANG('file-save')}`;\r\n            shareButton.innerHTML = `<img src='${shareImg}' alt='icon' height='20'/>${LANG('file-share')}`;\r\n            uploadImgurButton.innerHTML = `<img style='float:left' src='${uploadImg}' height='20' alt='icon'/>${LANG('file-upload')}`;\r\n            clipboardButton.innerHTML = `<img src='${copyImg}' alt='icon' height='20'/>${LANG('file-copy')}`;\r\n            clipboardButton.title = LANG('file-copy-title');\r\n            newButton.className = 'grid-button';\r\n            saveButton.className = 'grid-button';\r\n            shareButton.className = 'grid-button';\r\n            uploadImgurButton.className = 'grid-button';\r\n            clipboardButton.className = 'grid-button';\r\n\r\n            const importWrapper = BB.el({\r\n                className: 'grid-button',\r\n                css: {\r\n                    position: 'relative',\r\n                    cursor: 'pointer',\r\n                    cssFloat: 'left',\r\n                },\r\n            });\r\n            const innerMask = BB.el({\r\n                parent: importWrapper,\r\n                css: {\r\n                    width: '120px',\r\n                    height: '28px',\r\n                    overflow: 'hidden',\r\n                    cursor: 'pointer',\r\n                    position: 'relative',\r\n                },\r\n            });\r\n            this.importButton = BB.el({\r\n                tagName: 'input',\r\n                parent: innerMask,\r\n                css: {\r\n                    display: 'none',\r\n                },\r\n            }) as HTMLInputElement;\r\n            this.importButton.tabIndex = -1;\r\n            this.importButton.type = 'file';\r\n            this.importButton.multiple = true;\r\n            this.importButton.accept = 'image';\r\n            this.importButton.size = 71;\r\n            this.importButton.onchange = () => {\r\n                if (!this.importButton) {\r\n                    return;\r\n                }\r\n                this.importButton.files && onFileSelect(this.importButton.files, 'default');\r\n                this.importButton.value = '';\r\n            };\r\n\r\n            const importFakeButton = BB.el({\r\n                tagName: 'button',\r\n                parent: importWrapper,\r\n                content: \"<img class=\\\"dark-no-invert\\\" style='float:left' height='20' src='\" + importImg + \"' alt='icon'/>\" + LANG('file-import'),\r\n                css: {\r\n                    width: '120px',\r\n                    display: 'box',\r\n                    position: 'absolute',\r\n                    left: '0',\r\n                    top: '0',\r\n                    cursor: 'pointer',\r\n                },\r\n            }) as HTMLButtonElement;\r\n            importFakeButton.tabIndex = -1;\r\n            importFakeButton.onclick = () => this.importButton && this.importButton.click();\r\n\r\n            // --- export filetype dropdown ---\r\n            const exportTypeSelect = new KL.Select({\r\n                optionArr: [\r\n                    ['png', 'PNG'],\r\n                    ['psd', 'PSD'],\r\n                    ['layers', LANG('layers') + ' (PNG)'],\r\n                ],\r\n                initValue: this.exportType,\r\n                onChange: (val) => {\r\n                    this.exportType = val as TExportType;\r\n                    onExportTypeChange(this.exportType);\r\n                    onSaveImageToComputer();\r\n                },\r\n                title: LANG('file-format'),\r\n            });\r\n            BB.css(exportTypeSelect.getElement(), {\r\n                width: '50%',\r\n                height: '30px',\r\n                marginTop: '10px',\r\n                marginLeft: '10px',\r\n            });\r\n\r\n\r\n\r\n            newButton.onclick = onNewImage;\r\n            saveButton.onclick = () => {\r\n                onSaveImageToComputer();\r\n            };\r\n            shareButton.onclick = () => {\r\n                shareButton.disabled = true;\r\n                onShareImage(() => {\r\n                    shareButton.disabled = false;\r\n                });\r\n            };\r\n            uploadImgurButton.onclick = () => onUpload();\r\n\r\n            clipboardButton.onclick = () => {\r\n                clipboardButton.blur();\r\n                onCopyToClipboard();\r\n            };\r\n\r\n            const saveNote = BB.el({\r\n                className: 'kl-toolspace-note',\r\n                textContent: LANG('file-no-autosave'),\r\n                css: {\r\n                    margin: '10px 10px 0 10px',\r\n                },\r\n            });\r\n\r\n            const createSpacer = () => {\r\n                const el = document.createElement('div');\r\n                const clearer = document.createElement('div');\r\n                const line = BB.el({\r\n                    className: 'grid-hr',\r\n                });\r\n                el.append(clearer, line);\r\n                BB.css(clearer, {\r\n                    clear: 'both',\r\n                });\r\n                return el;\r\n            };\r\n\r\n            this.fileBrowserStorage = new BrowserStorageUi(projectStore, getProject, saveReminder, klRootEl);\r\n            BB.css(this.fileBrowserStorage.getElement(), {\r\n                //background: 'red',\r\n                margin: '10px',\r\n            });\r\n\r\n            const saveRow = BB.el({\r\n                content: [saveButton, exportTypeSelect.getElement()],\r\n                className: 'kl-file-save-row',\r\n            });\r\n\r\n            //actual structure\r\n            BB.append(fileMenu, [\r\n                saveNote,\r\n                newButton,\r\n                importWrapper,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                saveRow,\r\n\r\n                clipboardButton,\r\n                BB.canShareFiles() ? shareButton : undefined,\r\n                BB.el({css: {clear: 'both'}}),\r\n\r\n                createSpacer(),\r\n                this.fileBrowserStorage.getElement(),\r\n                createSpacer(),\r\n                uploadImgurButton,\r\n            ]);\r\n\r\n            this.rootEl.append(fileMenu);\r\n        };\r\n\r\n        setTimeout(asyncCreation, 1);\r\n    }\r\n\r\n    refresh (): void {\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (isVisible: boolean): void {\r\n        if (isVisible) {\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    triggerImport (): void {\r\n        this.importButton && this.importButton.click();\r\n    }\r\n}\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"gJzzT\");","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {klHistory} from '../../history/kl-history';\r\nimport {IKeyString} from '../../../bb/bb-types';\r\nimport {StatusOverlay} from '../components/status-overlay';\r\nimport {KlCanvasWorkspace} from '../../canvas-ui/kl-canvas-workspace';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\nimport {LayerManager} from './layer-manager/layer-manager';\r\nimport {HandUi} from './hand-ui';\r\nimport {RGB} from '../../../bb/color/color';\r\n\r\n\r\nexport class FilterTab {\r\n\r\n    private readonly rootEl: HTMLDivElement;\r\n    private isInit = false;\r\n\r\n    constructor (\r\n        private klRootEl: HTMLElement,\r\n        private klColorSlider: KlColorSlider,\r\n        private layerManager: LayerManager,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private handUi: HandUi,\r\n        private getCurrentColor: () => RGB,\r\n        private getKlMaxCanvasSize: () => number,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx: () => CanvasRenderingContext2D | null,\r\n        private isEmbed: boolean,\r\n        private statusOverlay: StatusOverlay,\r\n    ) {\r\n        this.rootEl = document.createElement('div');\r\n    }\r\n\r\n    private init (): void {\r\n        const filters = KL.filterLib;\r\n        const buttons = [];\r\n\r\n        if (!KL.filterLibStatus.isLoaded) {\r\n            throw new Error('filters not loaded');\r\n        }\r\n\r\n        const createButton = (filterKey: string): HTMLElement => {\r\n            const button = document.createElement('button');\r\n            const buttonLabel = LANG(filters[filterKey].lang.button);\r\n            const imClass = filters[filterKey].darkNoInvert ? 'class=\"dark-no-invert\"' : '';\r\n            const im = '<img ' + imClass + ' height=\"20\" width=\"18\" src=\"' + filters[filterKey].icon + '\" alt=\"icon\" />';\r\n            button.innerHTML = im + buttonLabel;\r\n            button.className = 'grid-button';\r\n            BB.css(button, {\r\n                lineHeight: '20px',\r\n                fontSize: '12px',\r\n            });\r\n            button.tabIndex = -1;\r\n\r\n            const filterName = LANG(filters[filterKey].lang.name);\r\n\r\n            button.onclick = () => {\r\n\r\n                const finishedDialog = (result, filterDialog): void => {\r\n                    if (result == 'Cancel') {\r\n                        if (filterDialog.destroy) {\r\n                            filterDialog.destroy();\r\n                        }\r\n                        return;\r\n                    }\r\n                    let input;\r\n                    try {\r\n                        input = filterDialog.getInput(); // also destroys\r\n                    } catch (e) {\r\n                        if (e.message.indexOf('.getInput is not a function') !== -1) {\r\n                            throw 'filterDialog.getInput is not a function, filter: ' + filterName;\r\n                        } else {\r\n                            throw e;\r\n                        }\r\n                    }\r\n                    applyFilter(input);\r\n                };\r\n\r\n                if (!('apply' in filters[filterKey])) {\r\n                    alert('Application not fully loaded');\r\n                    return;\r\n                }\r\n\r\n                const applyFilter = (input: any) => {\r\n                    const filterResult = filters[filterKey].apply({\r\n                        context: this.getCurrentLayerCtx(),\r\n                        klCanvas: this.getKlCanvas(),\r\n                        history: klHistory,\r\n                        input: input,\r\n                    } as IFilterApply);\r\n                    if (filterResult === false) {\r\n                        alert(\"Couldn't apply the edit action\");\r\n                    }\r\n                    if (filters[filterKey].updatePos === true) {\r\n                        this.klCanvasWorkspace.resetView();\r\n                        this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n                    }\r\n                    this.layerManager.update();\r\n                };\r\n\r\n                if (filters[filterKey].isInstant){\r\n                    button.blur();\r\n                    applyFilter(null);\r\n                    this.statusOverlay.out('\"' + filterName + '\" ' + LANG('filter-applied'), true);\r\n                } else {\r\n                    const secondaryColorRGB = this.klColorSlider.getSecondaryRGB();\r\n                    const filterDialog = filters[filterKey].getDialog({\r\n                        context: this.getCurrentLayerCtx(),\r\n                        klCanvas: this.getKlCanvas(),\r\n                        maxWidth: this.getKlMaxCanvasSize(),\r\n                        maxHeight: this.getKlMaxCanvasSize(),\r\n                        currentColorRgb: {r: this.getCurrentColor().r, g: this.getCurrentColor().g, b: this.getCurrentColor().b},\r\n                        secondaryColorRgb: {r: secondaryColorRGB.r, g: secondaryColorRGB.g, b: secondaryColorRGB.b},\r\n                    } as IFilterGetDialogParam) as IFilterGetDialogResult;\r\n\r\n                    if (!filterDialog) {\r\n                        return;\r\n                        //alert('Error: could not perform action');\r\n                        //throw('filter['+filterKey+'].getDialog returned '+filterDialog+'. ctx:' + currentLayerCtx + ' klCanvas:' + klCanvas);\r\n                    }\r\n\r\n                    let closeFunc: () => void;\r\n                    // Todo should move into getDialogParams\r\n                    filterDialog.errorCallback = (e) => {\r\n                        setTimeout(() => {\r\n                            alert('Error: could not perform action');\r\n                            throw e;\r\n                        }, 0);\r\n                        closeFunc();\r\n                    };\r\n\r\n\r\n                    const style: IKeyString = {};\r\n                    if ('width' in filterDialog) {\r\n                        style.width = filterDialog.width + 'px';\r\n                    }\r\n\r\n                    KL.popup({\r\n                        target: this.klRootEl,\r\n                        message: '<b>' + filterName + '</b>',\r\n                        div: filterDialog.element,\r\n                        style: style,\r\n                        buttons: ['Ok', 'Cancel'],\r\n                        clickOnEnter: 'Ok',\r\n                        callback: (result) => {\r\n                            finishedDialog(result, filterDialog);\r\n                        },\r\n                        closeFunc: (func) => {\r\n                            closeFunc = func;\r\n                        },\r\n                    });\r\n                }\r\n            };\r\n            buttons[buttons.length] = button;\r\n            return button;\r\n        };\r\n\r\n        const addGroup = (groupArr: string[]): void => {\r\n            Object.entries(filters).forEach(([filterKey, filter]) => {\r\n                if (!groupArr.includes(filterKey)) {\r\n                    return;\r\n                }\r\n                if (this.isEmbed && !filter.inEmbed) {\r\n                    return;\r\n                }\r\n                this.rootEl.append(createButton(filterKey));\r\n            });\r\n        };\r\n\r\n        const groupA = [\r\n            'cropExtend',\r\n            'flip',\r\n            'perspective',\r\n            'resize',\r\n            'rotate',\r\n            'transform',\r\n        ];\r\n        const groupB = [\r\n            'brightnessContrast',\r\n            'curves',\r\n            'distort',\r\n            'hueSaturation',\r\n            'invert',\r\n            'tiltShift',\r\n            'toAlpha',\r\n            'blur',\r\n            'unsharpMask',\r\n        ];\r\n        const groupC = [\r\n            'grid',\r\n            'noise',\r\n            'pattern',\r\n            'vanishPoint',\r\n        ];\r\n\r\n        addGroup(groupA);\r\n        this.rootEl.append(BB.el({className: 'grid-hr'}));\r\n        addGroup(groupB);\r\n        this.rootEl.append(BB.el({className: 'grid-hr'}));\r\n        addGroup(groupC);\r\n\r\n        this.isInit = true;\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    show (): void {\r\n        if (!this.isInit) {\r\n            this.init();\r\n        }\r\n        this.rootEl.style.display = 'block';\r\n    }\r\n\r\n    hide (): void {\r\n        this.rootEl.style.display = 'none';\r\n    }\r\n\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KL} from '../../kl';\r\nimport {SaveReminder} from '../components/save-reminder';\r\nimport {base64ToBlob} from '../../storage/base-64-to-blob';\r\nimport {KlCanvas} from '../../canvas/kl-canvas';\r\nimport {LANG} from '../../../language/language';\r\nimport loadingImg from '/src/app/img/ui/loading.gif';\r\n\r\ntype TImgurUploadResponse = {\r\n    // just a subset\r\n    id: string;\r\n    datetime: number;\r\n    type: string;\r\n    width: number;\r\n    height: number;\r\n    deletehash: string;\r\n    name: string;\r\n    link: string;\r\n};\r\n\r\n/**\r\n * uploads canvas, opens new tab with the upload progress & then opens the image page.\r\n */\r\nasync function upload (\r\n    canvas: HTMLCanvasElement,\r\n    title: string,\r\n    description: string,\r\n    type: 'png' | 'jpeg',\r\n    imgurKey: string,\r\n): Promise<TImgurUploadResponse> {\r\n    const img = base64ToBlob(canvas.toDataURL('image/' + type));\r\n\r\n    const w = window.open();\r\n\r\n    if (!w) {\r\n        throw new Error('could not create new tab');\r\n    }\r\n\r\n    const label = w.document.createElement('div');\r\n    const gif = w.document.createElement('img');\r\n    gif.src = loadingImg;\r\n    label.append(gif);\r\n    BB.css(gif, {\r\n        filter: 'invert(1)',\r\n    });\r\n    BB.css(w.document.body, {\r\n        backgroundColor: '#121211',\r\n        backgroundImage: 'linear-gradient(#2b2b2b 0%, #121211 50%)',\r\n        backgroundRepeat: 'no-repeat',\r\n    });\r\n    \r\n    const labelText = w.document.createElement('div');\r\n    labelText.style.marginTop = '10px';\r\n    label.append(labelText);\r\n    labelText.textContent = LANG('upload-uploading');\r\n\r\n    w.document.body.append(label);\r\n    BB.css(label, {\r\n        marginLeft: 'auto',\r\n        marginRight: 'auto',\r\n        marginTop: '100px',\r\n        fontFamily: 'Arial, sans-serif',\r\n        fontSize: '20px',\r\n        textAlign: 'center',\r\n        transition: 'opacity 0.3s ease-in-out',\r\n        opacity: '0',\r\n        color: '#ccc',\r\n    });\r\n    setTimeout(function () {\r\n        label.style.opacity = '1';\r\n    }, 20);\r\n\r\n    let response;\r\n    try {\r\n        const formData = new FormData();\r\n        formData.append('title', title);\r\n        formData.append('description', description);\r\n        formData.append('image', img);\r\n        response = await fetch('https://api.imgur.com/3/image',  {\r\n            method: 'POST',\r\n            headers: {\r\n                Authorization: 'Client-ID ' + imgurKey,\r\n            },\r\n            body: formData,\r\n        });\r\n\r\n    } catch (e) {\r\n        w.close();\r\n        throw new Error(e);\r\n    }\r\n    if (!response.ok) {\r\n        w.close();\r\n        throw new Error();\r\n    }\r\n    const data: TImgurUploadResponse = (await response.json()).data;\r\n\r\n    w.location.href = data.link.replace(/\\.(jpg|png)/, '');\r\n\r\n    return data;\r\n}\r\n\r\n\r\nexport function imgurUpload (\r\n    klCanvas: KlCanvas,\r\n    klRootEl: HTMLElement,\r\n    saveReminder: SaveReminder,\r\n    imgurKey: string, // API key\r\n): void {\r\n    if (!imgurKey) {\r\n        throw new Error('imgur key missing');\r\n    }\r\n\r\n    const inputTitle = BB.el({tagName: 'input'}) as HTMLInputElement;\r\n    inputTitle.type = 'text';\r\n    inputTitle.value = LANG('upload-title-untitled');\r\n    const inputDescription = BB.el({\r\n        tagName: 'textarea',\r\n        custom: {\r\n            rows: 2,\r\n        },\r\n        css: {\r\n            width: '100%',\r\n            maxWidth: '100%',\r\n        },\r\n    }) as HTMLTextAreaElement;\r\n\r\n    const labelTitle =  BB.el({\r\n        textContent: LANG('upload-name') + ':',\r\n    });\r\n    const labelDescription = BB.el({\r\n        textContent: LANG('upload-caption') + ':',\r\n        css: {\r\n            marginTop: '10px',\r\n        },\r\n    });\r\n\r\n    const tos = BB.el({\r\n        content: `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${LANG('terms-of-service')}</a>`,\r\n    });\r\n\r\n    const typeRadio = new KL.RadioList({\r\n        name: 'filetype',\r\n        init: 'jpeg',\r\n        items: [\r\n            { label: 'JPG', value: 'jpeg' },\r\n            { label: 'PNG', value: 'png' },\r\n        ],\r\n        ignoreFocus: true,\r\n    });\r\n    BB.css(typeRadio.getElement(), {\r\n        marginBottom: '10px',\r\n    });\r\n\r\n\r\n    const outDiv = BB.el();\r\n    const infoHint = BB.el({\r\n        className: 'info-hint',\r\n        textContent: LANG('upload-link-notice'),\r\n    });\r\n    outDiv.append(\r\n        infoHint,\r\n        typeRadio.getElement(),\r\n        labelTitle,\r\n        inputTitle,\r\n        labelDescription,\r\n        inputDescription,\r\n        tos\r\n    );\r\n    KL.popup({\r\n        target: klRootEl,\r\n        message: `<b>${LANG('upload-title')}</b>`,\r\n        type: 'upload',\r\n        div: outDiv,\r\n        buttons: [LANG('upload-submit'), 'Cancel'],\r\n        clickOnEnter: LANG('upload-submit'),\r\n        primaries: [LANG('upload-submit')],\r\n        autoFocus: LANG('upload-submit'),\r\n        callback: async function (val) {\r\n            if (val === LANG('upload-submit') || val === 'Yes' || val === 'Ok') {\r\n                try {\r\n                    const result = await upload(\r\n                        klCanvas.getCompleteCanvas(1),\r\n                        inputTitle.value,\r\n                        inputDescription.value,\r\n                        typeRadio.getValue() as 'png' | 'jpeg',\r\n                        imgurKey,\r\n                    );\r\n\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: 'ok',\r\n                        message: `<h3>${LANG('upload-success')}</h3><br>${LANG('upload-delete')}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/delete/${result.deletehash}</a><br><br>`,\r\n                        buttons: ['Ok'],\r\n                    });\r\n                    saveReminder.reset();\r\n\r\n                } catch(e) {\r\n                    KL.popup({\r\n                        target: klRootEl,\r\n                        type: 'error',\r\n                        message: LANG('upload-failed'),\r\n                        buttons: ['Ok'],\r\n                    });\r\n                }\r\n            }\r\n        },\r\n    });\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"c3ZSC\");","import {KL} from '../../kl';\r\nimport {BB} from '../../../bb/bb';\r\nimport {KlHistoryInterface} from '../../history/kl-history';\r\nimport {LANG} from '../../../language/language';\r\nimport {BrowserStorageUi} from './browser-storage-ui';\r\nimport {ProjectStore} from '../../storage/project-store';\r\nimport {IKlProject} from '../../kl-types';\r\n\r\n\r\nconst reminderTimelimitMs = 1000 * 60 * 20; // 20 minutes\r\nconst unsavedActionsLimit = 100; // number of actions user did since last save\r\n\r\n\r\n/**\r\n * remind user of saving, keep user aware of save state\r\n */\r\nexport class SaveReminder {\r\n    private lastSavedActionNumber: number = null;\r\n    private lastSavedAt: number;\r\n\r\n    private lastReminderShownAt: number;\r\n    private unsavedInterval;\r\n    private closeFunc: () => void;\r\n\r\n    showPopup (): void {\r\n        if (!this.projectStore || !this.getProject) {\r\n            throw new Error('projectStore and getProject need to be set');\r\n        }\r\n\r\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\r\n\r\n        const contentEl = BB.el();\r\n\r\n        contentEl.append(\r\n            BB.el({\r\n                content: LANG(\r\n                    'save-reminder-text',\r\n                    {\r\n                        a: '<strong>' + min,\r\n                        b: '</strong>',\r\n                    }\r\n                ),\r\n                css: {\r\n                    marginBottom: '20px',\r\n                },\r\n            }),\r\n        );\r\n\r\n        const psdWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n            },\r\n        });\r\n        const storageWrapper = BB.el({\r\n            css: {\r\n                borderTop: '1px solid #aaa',\r\n                margin: '0 -20px',\r\n                padding: '20px',\r\n                paddingBottom: '0',\r\n            },\r\n        });\r\n        contentEl.append(psdWrapper, storageWrapper);\r\n\r\n\r\n        const psdBtn = BB.el({\r\n            tagName: 'button',\r\n            className: 'kl-button',\r\n            content: LANG('save-reminder-save-psd'),\r\n            onClick: () => this.onSaveAsPsd(),\r\n        });\r\n        psdWrapper.append(\r\n            psdBtn,\r\n            BB.el({\r\n                content: LANG('save-reminder-psd-layers'),\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            }),\r\n        );\r\n\r\n\r\n        const storageUi = new BrowserStorageUi(\r\n            this.projectStore,\r\n            this.getProject,\r\n            this,\r\n            document.body as any,\r\n            {\r\n                hideClearButton: true,\r\n                isFocusable: true,\r\n            }\r\n        );\r\n        storageWrapper.append(storageUi.getElement());\r\n\r\n\r\n        KL.popup({\r\n            target: document.body,\r\n            message: `<b>${LANG('save-reminder-title')}</b>`,\r\n            div: contentEl,\r\n            ignoreBackground: true,\r\n            callback: () => {\r\n                storageUi.destroy();\r\n                BB.destroyEl(psdBtn);\r\n                this.closeFunc = null;\r\n                this.lastReminderShownAt = performance.now();\r\n            },\r\n            closeFunc: (f) => {\r\n                this.closeFunc = f;\r\n            },\r\n        });\r\n        setTimeout(() => {\r\n            psdBtn.focus();\r\n        }, 40);\r\n    }\r\n\r\n    constructor (\r\n        private history: KlHistoryInterface,\r\n        private showReminder: boolean,\r\n        private changeTitle: boolean,\r\n        private onSaveAsPsd: () => void,\r\n        private isDrawing: () => boolean,\r\n        private projectStore: ProjectStore | null, // needed if showReminder\r\n        private getProject: (() => IKlProject) | null, // needed if showReminder\r\n        private title: string = 'Klecks',\r\n    ) { }\r\n\r\n    init (): void {\r\n        if (this.lastSavedActionNumber !== null) { // already initialized\r\n            return;\r\n        }\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n\r\n        if (this.showReminder) {\r\n            setInterval(() => {\r\n                if (document.visibilityState !== 'visible') {\r\n                    return;\r\n                }\r\n\r\n                const unsavedActions = Math.abs(this.history.getActionNumber() - this.lastSavedActionNumber);\r\n\r\n                if (\r\n                    KL.dialogCounter.get() === 0 &&\r\n                    !this.isDrawing() &&\r\n                    this.lastReminderShownAt + reminderTimelimitMs < performance.now() &&\r\n                    unsavedActions >= unsavedActionsLimit\r\n                ) {\r\n                    this.showPopup();\r\n                }\r\n            }, 1000 * 5);\r\n        }\r\n\r\n        // confirmation dialog when closing tab\r\n        function onBeforeUnload (e) {\r\n            e.preventDefault();\r\n            e.returnValue = '';\r\n        }\r\n\r\n        this.history.addListener(() => {\r\n            const actionNumber = this.history.getActionNumber();\r\n            if (this.lastSavedActionNumber !== actionNumber) {\r\n                window.onbeforeunload =  onBeforeUnload;\r\n            } else {\r\n                window.onbeforeunload = null;\r\n            }\r\n        });\r\n\r\n        if (this.changeTitle) {\r\n            document.addEventListener('visibilitychange', () => {\r\n                if (document.visibilityState === 'visible') {\r\n                    document.title = this.title;\r\n                    clearInterval(this.unsavedInterval);\r\n                } else {\r\n                    const actionNumber = this.history.getActionNumber();\r\n                    if (this.lastSavedActionNumber !== actionNumber) {\r\n                        document.title = LANG('unsaved') + ' - ' + this.title;\r\n                        let state = 0;\r\n                        this.unsavedInterval = setInterval(() => {\r\n                            state = (state + 1) % 2;\r\n                            if (state === 1) {\r\n                                document.title = LANG('unsaved') + '  ' + this.title;\r\n                            } else {\r\n                                document.title = LANG('unsaved') + ' - ' + this.title;\r\n                            }\r\n                        }, 1000 * 60 * 3);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    reset (): void {\r\n        if (this.lastSavedActionNumber === null) { // not initialized\r\n            return;\r\n        }\r\n\r\n        this.lastSavedActionNumber = this.history.getActionNumber();\r\n        this.lastReminderShownAt = performance.now();\r\n        this.lastSavedAt = performance.now();\r\n        window.onbeforeunload = null;\r\n\r\n        if (this.closeFunc) {\r\n            this.closeFunc();\r\n        }\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {KL} from '../kl';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {TExportType} from '../kl-types';\r\nimport {SaveReminder} from '../ui/components/save-reminder';\r\nimport {saveAs} from '../../bb/base/save-as';\r\n\r\nexport class SaveToComputer {\r\n\r\n    /**\r\n     * Using old code, because saving somehow doesn't work for ipad before ios 13,\r\n     * and it doesn't even throw an exception.\r\n     */\r\n    private saveImage (canvas: HTMLCanvasElement, filename: string, mimeType: string): void {\r\n        const parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\r\n\r\n        if (!parts) {\r\n            throw new Error('saveImage: empty parts');\r\n        }\r\n\r\n        //assume base64 encoding\r\n        const binStr = atob(parts[3]);\r\n        //convert to binary in ArrayBuffer\r\n        const buf = new ArrayBuffer(binStr.length);\r\n        const view = new Uint8Array(buf);\r\n        for (let i = 0; i < view.length; i++) {\r\n            view[i] = binStr.charCodeAt(i);\r\n        }\r\n        const blob = new Blob([view], {'type': parts[1]});\r\n        saveAs(blob, filename);\r\n    }\r\n\r\n    constructor (\r\n        private saveReminder: SaveReminder,\r\n        private klRootEl: HTMLElement,\r\n        private getExportType: () => TExportType,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private filenameBase: string,\r\n    ) {}\r\n\r\n    save (format?: 'psd' | 'layers' | 'png') {\r\n        this.saveReminder.reset();\r\n\r\n        if (!format) {\r\n            format = this.getExportType();\r\n        }\r\n\r\n        if (format === 'png') {\r\n            const extension = 'png';\r\n            const mimeType = 'image/png';\r\n            const filename = BB.getDate() + this.filenameBase + '.' + extension;\r\n            const fullCanvas = this.getKlCanvas().getCompleteCanvas(1);\r\n            try {\r\n                this.saveImage(fullCanvas, filename, mimeType);\r\n            } catch (error) { //fallback for old browsers\r\n                alert('could not save');\r\n                throw new Error('failed png export');\r\n            }\r\n        } else if (format === 'layers') {\r\n            const extension = 'png';\r\n            const mimeType = 'image/png';\r\n            const fileBase = BB.getDate() + this.filenameBase;\r\n            const layerArr = this.getKlCanvas().getLayersFast();\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                const item = layerArr[i];\r\n                const fnameArr = [\r\n                    fileBase,\r\n                    '_',\r\n                    ('' + (i + 1)).padStart(2, '0'),\r\n                    '_',\r\n                    item.name,\r\n                    '.',\r\n                    extension,\r\n                ];\r\n                this.saveImage(item.canvas, fnameArr.join(''), mimeType);\r\n            }\r\n        } else if (format === 'psd') {\r\n\r\n            const layerArr = this.getKlCanvas().getLayersFast();\r\n\r\n            const psdConfig: {\r\n                width: number;\r\n                height: number;\r\n                children: {\r\n                    name: string;\r\n                    opacity: number;\r\n                    canvas: HTMLCanvasElement;\r\n                    blendMode: string;\r\n                    left: number;\r\n                    top: number;\r\n                }[];\r\n                canvas: HTMLCanvasElement;\r\n            } = {\r\n                width: this.getKlCanvas().getWidth(),\r\n                height: this.getKlCanvas().getHeight(),\r\n                children: [],\r\n                canvas: this.getKlCanvas().getCompleteCanvas(1),\r\n            };\r\n            for (let i = 0; i < layerArr.length; i++) {\r\n                const item = layerArr[i];\r\n                psdConfig.children.push({\r\n                    name: item.name,\r\n                    opacity: item.opacity,\r\n                    canvas: item.canvas,\r\n                    blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n                    left: 0,\r\n                    top: 0,\r\n                });\r\n            }\r\n\r\n            KL.loadAgPsd().then((agPsdLazy) => {\r\n                const buffer = agPsdLazy.writePsdBuffer(psdConfig);\r\n                const blob = new Blob([buffer], { type: 'application/octet-stream' });\r\n                saveAs(blob, BB.getDate() + this.filenameBase + '.psd');\r\n            }).catch(() => {\r\n                alert('Error: failed to load PSD library');\r\n            });\r\n\r\n        }\r\n\r\n    }\r\n\r\n}","// https://github.com/eligrey/FileSaver.js/issues/774\r\n// stripped down version of https://github.com/eligrey/FileSaver.js/blob/master/src/FileSaver.js#L81-L108\r\n\r\nexport function saveAs (blob: Blob, name: string): void {\r\n    // Namespace is used to prevent conflict w/ Chrome Poper Blocker extension (Issue https://github.com/eligrey/FileSaver.js/issues/561)\r\n    const a = document.createElementNS('http://www.w3.org/1999/xhtml', 'a') as HTMLAnchorElement;\r\n    a.download = name;\r\n    a.rel = 'noopener';\r\n    a.href = URL.createObjectURL(blob);\r\n\r\n    setTimeout(() => URL.revokeObjectURL(a.href), 40 /* sec */ * 1000);\r\n    setTimeout(() => a.click(), 0);\r\n}\r\n","import {KL} from '../kl';\r\nimport {IHistoryBroadcast, IHistoryEntry, klHistory} from './kl-history';\r\nimport {KlCanvasWorkspace} from '../canvas-ui/kl-canvas-workspace';\r\nimport {IFilterApply, IInitState} from '../kl-types';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {LayerManager} from '../ui/tool-tabs/layer-manager/layer-manager';\r\nimport {LayerPreview} from '../ui/components/layer-preview';\r\nimport {HandUi} from '../ui/tool-tabs/hand-ui';\r\nimport {throwIfNull} from '../../bb/base/base';\r\n\r\nfunction execHistoryEntry (\r\n    historyEntry: IHistoryEntry,\r\n    layerIndex: number,\r\n    klCanvas: KlCanvas,\r\n    brushes: any, // todo\r\n    setCurrentLayerCtx: (ctx: CanvasRenderingContext2D) => void,\r\n    getCurrentLayerCtx: () => CanvasRenderingContext2D,\r\n): number {\r\n    if (historyEntry.tool[0] === 'brush') {\r\n        const b = brushes[historyEntry.tool[1]];\r\n        historyEntry.actions.forEach(action => {\r\n            b[action.action].apply(b, action.params);\r\n        });\r\n\r\n    } else if (historyEntry.tool[0] === 'canvas') {\r\n        const p = historyEntry.params;\r\n        const id = klCanvas[historyEntry.action].apply(klCanvas, p);\r\n        if (typeof id === 'number') {\r\n            layerIndex = id;\r\n            const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex));\r\n            setCurrentLayerCtx(ctx);\r\n            Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\r\n        }\r\n\r\n    } else if (historyEntry.tool[0] === 'filter') {\r\n        const p = [{\r\n            context: getCurrentLayerCtx(),\r\n            klCanvas,\r\n            input: historyEntry.params[0].input,\r\n            history: new KL.DecoyKlHistory(),\r\n        } as IFilterApply];\r\n        KL.filterLib[historyEntry.tool[1]][historyEntry.action].apply(null, p);\r\n\r\n    } else if (historyEntry.tool[0] === 'misc' && historyEntry.action === 'focusLayer') {\r\n        layerIndex = historyEntry.params[0];\r\n        const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex));\r\n        setCurrentLayerCtx(ctx);\r\n        Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\r\n\r\n    } else if (historyEntry.tool[0] === 'misc' && historyEntry.action === 'importImage') {\r\n        const id = klCanvas.addLayer();\r\n        if (typeof id === 'number') {\r\n            layerIndex = id;\r\n            if (historyEntry.params[1]) {\r\n                klCanvas.renameLayer(layerIndex, historyEntry.params[1]);\r\n            }\r\n            const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex));\r\n            setCurrentLayerCtx(ctx);\r\n            Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\r\n        }\r\n        getCurrentLayerCtx().drawImage(historyEntry.params[0], 0, 0);\r\n    }\r\n    return layerIndex;\r\n}\r\n\r\nexport class UndoRedoCatchup {\r\n\r\n    private doIgnore = false;\r\n\r\n    /**\r\n     * Prevent multiple undo / redo getting triggered at once if UI is frozen.\r\n     * true -> ignore, don't undo / redo\r\n     */\r\n    private shouldIgnoreTest (): boolean {\r\n        if (this.doIgnore) {\r\n            return true;\r\n        }\r\n        this.doIgnore = true;\r\n        setTimeout(() => {\r\n            this.doIgnore = false;\r\n        }, 0);\r\n        return false;\r\n    }\r\n    \r\n\r\n    // ---- public ----\r\n\r\n    constructor (\r\n        private brushUiMap: any, // todo\r\n        private layerPreview: LayerPreview,\r\n        private layerManager: LayerManager,\r\n        private handUi: HandUi,\r\n        private klCanvasWorkspace: KlCanvasWorkspace,\r\n        private getInitState: () => IInitState,\r\n        private getKlCanvas: () => KlCanvas,\r\n        private getCurrentLayerCtx: () => CanvasRenderingContext2D | null,\r\n        private setCurrentLayerCtx: (ctx: CanvasRenderingContext2D) => void,\r\n        private getCurrentBrush: () => any, // todo\r\n    ) { }\r\n\r\n    undo (): boolean {\r\n        if (this.shouldIgnoreTest() || !klHistory.canUndo()) {\r\n            return false;\r\n        }\r\n        const entries: IHistoryEntry[] = klHistory.undo();\r\n        const klCanvas = this.getKlCanvas();\r\n        klHistory.pause(true);\r\n        const initState: IInitState = this.getInitState();\r\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\r\n        klCanvas.copy(initState.canvas);\r\n        let layerIndex = initState.focus;\r\n        this.setCurrentLayerCtx(klCanvas.getLayerContext(layerIndex));\r\n        const brushes: any = {};\r\n        for (const b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\r\n        entries.forEach(entry => {\r\n            layerIndex = execHistoryEntry(\r\n                entry,\r\n                layerIndex,\r\n                klCanvas,\r\n                brushes,\r\n                (ctx) => this.setCurrentLayerCtx(ctx),\r\n                () => throwIfNull(this.getCurrentLayerCtx()),\r\n            );\r\n        });\r\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        this.layerManager.update(layerIndex);\r\n        this.layerPreview.setLayer(klCanvas.getLayer(layerIndex));\r\n        this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n\r\n        klHistory.pause(false);\r\n        return true;\r\n    }\r\n\r\n    redo (): boolean {\r\n        if (this.shouldIgnoreTest() || !klHistory.canRedo()) {\r\n            return false;\r\n        }\r\n        const entry = klHistory.redo();\r\n        if (!entry) {\r\n            setTimeout(() => {\r\n                throw new Error('redo failed. redo entry undefined');\r\n            });\r\n            return false;\r\n        }\r\n        const klCanvas = this.getKlCanvas();\r\n        klHistory.pause(true);\r\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\r\n        const brushes: any = {};\r\n        for (const b in KL.brushes) {\r\n            if (KL.brushes.hasOwnProperty(b)) {\r\n                brushes[b] = new KL.brushes[b]();\r\n                brushes[b].setContext(this.getCurrentLayerCtx());\r\n            }\r\n        }\r\n        brushes.SketchyBrush.setSeed(this.brushUiMap.sketchyBrush.getSeed());\r\n        execHistoryEntry(\r\n            entry,\r\n            0, // doesn't matter, because result not used\r\n            klCanvas,\r\n            brushes,\r\n            (ctx) => this.setCurrentLayerCtx(ctx),\r\n            () => throwIfNull(this.getCurrentLayerCtx()),\r\n        );\r\n\r\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        }\r\n        const currentLayerIndex = klCanvas.getLayerIndex(this.getCurrentLayerCtx().canvas);\r\n        this.layerManager.update(currentLayerIndex);\r\n        this.layerPreview.setLayer(klCanvas.getLayer(currentLayerIndex));\r\n        this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\r\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\r\n        this.klCanvasWorkspace.setLastDrawEvent(null);\r\n        klHistory.pause(false);\r\n\r\n        return true;\r\n    }\r\n\r\n    catchup (logParam: IHistoryBroadcast | null): void {\r\n        // const start = performance.now();\r\n        //play catch up (the version that is a few steps behind)\r\n\r\n        if (!logParam || !logParam.bufferUpdate) {\r\n            return;\r\n        }\r\n\r\n        const initState: IInitState = this.getInitState();\r\n        let localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\r\n\r\n        initState.focus = execHistoryEntry(\r\n            logParam.bufferUpdate,\r\n            initState.focus,\r\n            initState.canvas,\r\n            initState.brushes,\r\n            (ctx) => {\r\n                localCurrentLayerCtx = ctx;\r\n            },\r\n            () => throwIfNull(localCurrentLayerCtx),\r\n        );\r\n\r\n        // console.log('catchup', performance.now() - start);\r\n    }\r\n\r\n\r\n}","import {IRGB, ISliderConfig} from '../kl-types';\r\n\r\nexport type TBrushSettingEmit = { type: 'color'; value: IRGB } |\r\n    { type: 'opacity'; value: number } |\r\n    { type: 'size'; value: number } |\r\n    { type: 'sliderConfig'; value: ISliderConfig };\r\n\r\nexport type TBrushSettingSubscriber = (p : TBrushSettingEmit) => void;\r\n\r\n/**\r\n * Central place to update brush settings, and to subscribe to changes.\r\n */\r\nexport class BrushSettingService {\r\n\r\n    private static instance: BrushSettingService;\r\n    subscriberArr: TBrushSettingSubscriber[] = [];\r\n\r\n    private emit (obj: TBrushSettingEmit, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (this.subscriberArr[i] === skipSubscriber) {\r\n                continue;\r\n            }\r\n            this.subscriberArr[i](obj);\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n\r\n    constructor (\r\n        private onSetColor: (rgb: IRGB) => void,\r\n        private onSetSize: (size: number) => void,\r\n        private onSetOpacity: (opacity: number) => void,\r\n        private onGetColor: () => IRGB,\r\n        private onGetSize: () => number,\r\n        private onGetOpacity: () => number,\r\n        private onGetSliderConfig: () => ISliderConfig,\r\n    ) {\r\n        if (BrushSettingService.instance) {\r\n            throw new Error('BrushSettingService already instantiated');\r\n        }\r\n        BrushSettingService.instance = this;\r\n    }\r\n\r\n    emitColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'color',\r\n                value: color,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSize (size: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'size',\r\n                value: size,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber): void {\r\n        this.emit(\r\n            {\r\n                type: 'opacity',\r\n                value: opacity,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    emitSliderConfig (sliderConfig: ISliderConfig, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.emit(\r\n            {\r\n                type: 'sliderConfig',\r\n                value: sliderConfig,\r\n            },\r\n            skipSubscriber\r\n        );\r\n    }\r\n\r\n    /**\r\n     * set current brush color\r\n     * @param color\r\n     * @param skipSubscriber\r\n     */\r\n    setColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetColor(color);\r\n        this.emitColor(color, skipSubscriber);\r\n    }\r\n\r\n    /**\r\n     * set current brush size\r\n     * @param size\r\n     * @param skipSubscriber\r\n     */\r\n    setSize (size: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetSize(size);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * set current opacity\r\n     * @param opacity\r\n     * @param skipSubscriber\r\n     */\r\n    setOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber) {\r\n        this.onSetOpacity(opacity);\r\n        // why not emitting?\r\n    }\r\n\r\n    /**\r\n     * get current brush color\r\n     */\r\n    getColor (): IRGB {\r\n        return this.onGetColor();\r\n    }\r\n\r\n    getSize (): number {\r\n        return this.onGetSize();\r\n    }\r\n\r\n    getOpacity (): number {\r\n        return this.onGetOpacity();\r\n    }\r\n\r\n    getSliderConfig (): ISliderConfig {\r\n        return this.onGetSliderConfig();\r\n    }\r\n\r\n    /**\r\n     * subscribe to changes\r\n     * @param func\r\n     */\r\n    subscribe (func: TBrushSettingSubscriber): void {\r\n        if (this.subscriberArr.includes(func)) {\r\n            return;\r\n        }\r\n        this.subscriberArr.push(func);\r\n    }\r\n\r\n    unsubscribe (func: TBrushSettingSubscriber): void {\r\n        for (let i = 0; i < this.subscriberArr.length; i++) {\r\n            if (func === this.subscriberArr[i]) {\r\n                this.subscriberArr.splice(i, 1);\r\n                i--;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n","import {BB} from '../../../bb/bb';\r\nimport {LANG, languageStrings, LS_LANGUAGE_KEY} from '../../../language/language';\r\nimport {KL} from '../../kl';\r\nimport {languages} from '../../../../languages/languages';\r\nimport {DynamicModal} from '../modals/base/dynamic-modal';\r\nimport bitbofLogoImg from '/src/app/img/bitbof-logo.svg';\r\nimport klecksLogoImg from '/src/app/img/klecks-logo.png';\r\nimport uiSwapImg from '/src/app/img/ui/ui-swap-lr.svg';\r\nimport {LocalStorage} from '../../../bb/base/local-storage';\r\nimport {theme, TTheme} from '../../../theme/theme';\r\nimport {addIsDarkListener} from '../../../bb/base/base';\r\n\r\nexport class SettingsTab {\r\n\r\n    private el: HTMLElement;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        onLeftRight: () => void,\r\n        customAbout?: HTMLElement,\r\n    ) {\r\n        this.el = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n\r\n        // ---- language ----\r\n        const autoLanguage = languageStrings.getAutoLanguage();\r\n\r\n        const langWrapper = BB.el({\r\n            parent: this.el,\r\n            content: BB.el({\r\n                content: LANG('settings-language') + ':',\r\n                css: {\r\n                    marginRight: '5px',\r\n                    marginBottom: '2px',\r\n                },\r\n            }),\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                flexWrap: 'wrap',\r\n            },\r\n        });\r\n\r\n        const options: [string, string][] = [\r\n            ['auto', LANG('auto') + `  ${autoLanguage.name} (${autoLanguage.code})`] as [string, string],\r\n            ...languages.map(item => {\r\n                return [item.code, item.name + ` (${item.code})`] as [string, string];\r\n            }),\r\n        ];\r\n        const languageSelect = new KL.Select({\r\n            initValue: LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto',\r\n            optionArr: options,\r\n            onChange: (val) => {\r\n                if (val === 'auto') {\r\n                    LocalStorage.removeItem(LS_LANGUAGE_KEY);\r\n                } else {\r\n                    LocalStorage.setItem(LS_LANGUAGE_KEY, val);\r\n                }\r\n                languageHint.style.display = 'block';\r\n            },\r\n        });\r\n        BB.css(languageSelect.getElement(), {\r\n            flexGrow: '1',\r\n        });\r\n        const languageHint = BB.el({\r\n            className: 'kl-toolspace-note',\r\n            content: LANG('settings-language-reload'),\r\n            css: {\r\n                display: 'none',\r\n                marginTop: '5px',\r\n                flexGrow: '1',\r\n            },\r\n        });\r\n\r\n        langWrapper.append(\r\n            languageSelect.getElement(),\r\n            languageHint,\r\n        );\r\n\r\n\r\n        // ---- theme ----\r\n        function themeToLabel (theme: TTheme): string {\r\n            return theme === 'dark' ? ' ' + LANG('theme-dark') : ' ' + LANG('theme-light');\r\n        }\r\n        const themeSelect = new KL.Select({\r\n            optionArr: [\r\n                ['auto', LANG('auto') + '  ' + themeToLabel(theme.getMediaQueryTheme())],\r\n                ['light', themeToLabel('light')],\r\n                ['dark', themeToLabel('dark')],\r\n            ],\r\n            initValue: theme.getStoredTheme() || 'auto',\r\n            onChange: (val): void => {\r\n                theme.setStoredTheme(val === 'auto' ? undefined : val);\r\n            },\r\n        });\r\n        BB.css(themeSelect.getElement(), {\r\n            flexGrow: '1',\r\n        });\r\n        addIsDarkListener(() => {\r\n            themeSelect.updateLabel('auto', LANG('auto') + '  ' + themeToLabel(theme.getMediaQueryTheme()));\r\n        });\r\n        BB.el({\r\n            parent: this.el,\r\n            content: [\r\n                BB.el({\r\n                    content: LANG('settings-theme') + ':',\r\n                    css: {\r\n                        marginRight: '5px',\r\n                        marginBottom: '2px',\r\n                    },\r\n                }),\r\n                themeSelect.getElement(),\r\n            ],\r\n            css: {\r\n                marginTop: '15px',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                flexWrap: 'wrap',\r\n            },\r\n        });\r\n\r\n        // ---- flip ui ----\r\n        BB.el({\r\n            tagName: 'button',\r\n            parent: this.el,\r\n            content: '<img height=\"20\" width=\"18\" src=\"' + uiSwapImg + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + LANG('switch-ui-left-right'),\r\n            onClick: () => onLeftRight(),\r\n            css: {\r\n                marginTop: '15px',\r\n            },\r\n            custom: {\r\n                tabIndex: '-1',\r\n            },\r\n        });\r\n\r\n\r\n        // ---- about ----\r\n        this.el.append(BB.el({className: 'grid-hr', css: {margin: '10px 0'}}));\r\n\r\n        function makeLicenses () {\r\n            return BB.el({\r\n                tagName: 'a',\r\n                content: LANG('licenses'),\r\n                onClick: () => {\r\n                    import('./licenses').then(result => {\r\n                        new DynamicModal({\r\n                            title: BB.el({\r\n                                content: LANG('licenses'),\r\n                            }),\r\n                            content: BB.el({\r\n                                content: BB.el({\r\n                                    content: result.licenses.replace(/\\n/g, '<br>'),\r\n                                    css: {\r\n                                        padding: '20px',\r\n                                    },\r\n                                }),\r\n                                css: {\r\n                                    height: '100%',\r\n                                    overflowY: 'scroll',\r\n                                },\r\n                            }),\r\n                            width: 800,\r\n                            isMaxHeight: true,\r\n                        });\r\n                    });\r\n                },\r\n            });\r\n        }\r\n\r\n        if (customAbout) {\r\n            this.el.append(customAbout);\r\n            if (!customAbout.innerHTML) {\r\n                const minimalAbout = BB.el({\r\n                    parent: customAbout,\r\n                    css: {\r\n                       textAlign: 'center',\r\n                   },\r\n                });\r\n                minimalAbout.append(\r\n                    BB.el({\r\n                        content: `<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2023<br>`,\r\n                    }),\r\n                    makeLicenses(),\r\n                );\r\n            }\r\n        } else {\r\n            const versionEl = BB.el({\r\n                parent: this.el,\r\n                css: {\r\n                    textAlign: 'center',\r\n                },\r\n                content: `\r\n<img alt=\"Klecks\" class=\"dark-invert\" height=\"25\" src=\"${klecksLogoImg}\"><br>\r\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2023<br>`,\r\n            });\r\n\r\n            versionEl.append(\r\n                makeLicenses(),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('donate'),\r\n                    custom: {\r\n                        href: 'https://kleki.com/donate/',\r\n                        target: '_blank',\r\n                    },\r\n                }),\r\n                document.createTextNode(' | '),\r\n                BB.el({\r\n                    tagName: 'a',\r\n                    content: LANG('source-code'),\r\n                    custom: {\r\n                        href: 'https://klecks.org',\r\n                        target: '_blank',\r\n                    },\r\n                }),\r\n            );\r\n\r\n\r\n        }\r\n\r\n        window.addEventListener('storage', (e) => {\r\n            if (e.key !== LS_LANGUAGE_KEY) {\r\n                return;\r\n            }\r\n            languageSelect.setValue(\r\n                LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'\r\n            );\r\n        });\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.el;\r\n    }\r\n\r\n}","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hTlU7\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"hxlHN\");","module.exports = (require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"79hnx\"))).then(() => parcelRequire('jNQF2'));","import {BB} from '../../../bb/bb';\r\nimport {LANG} from '../../../language/language';\r\nimport {dialogCounter} from '../modals/modal-count';\r\n\r\n/**\r\n * Scroll buttons at the top and bottom of toolspace\r\n * Show up when window is very small.\r\n * Allow user to scroll up and down toolspace.\r\n */\r\nexport class ToolspaceScroller {\r\n\r\n    private readonly toolspace: HTMLElement;\r\n    private readonly upBtn: HTMLElement;\r\n    private readonly downBtn: HTMLElement;\r\n    private downInterval: any;\r\n    private upInterval: any;\r\n\r\n    private update (): void {\r\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) { // small buffer where it's not worth it\r\n            if (!this.upInterval) {\r\n                this.upBtn.style.display = this.toolspace.scrollTop === 0 ? 'none' : 'block';\r\n            }\r\n            if (!this.downInterval) {\r\n                this.downBtn.style.display = (\r\n                    this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ?\r\n                        'none' : 'block'\r\n                );\r\n            }\r\n        } else {\r\n            this.upBtn.style.display = 'none';\r\n            this.downBtn.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    // --- public ---\r\n    constructor (p: {toolspace: HTMLElement; uiState: 'left' | 'right'}) {\r\n        this.toolspace = p.toolspace;\r\n        this.upBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                top: '0',\r\n                transform: 'rotate(180deg)',\r\n            },\r\n        });\r\n        this.downBtn = BB.el({\r\n            parent: this.toolspace,\r\n            title: LANG('scroll'),\r\n            className: 'kl-scroller',\r\n            css: {\r\n                bottom: '0',\r\n            },\r\n        });\r\n        this.updateUiState(p.uiState);\r\n\r\n        const upListener = new BB.PointerListener({\r\n            target: this.upBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.upInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, -13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.upInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.upInterval = null;\r\n                        this.update();\r\n                    }, 50);\r\n                }\r\n            },\r\n        });\r\n        const downListener = new BB.PointerListener({\r\n            target: this.downBtn,\r\n            onPointer: (e) => {\r\n                if (e.type === 'pointerdown') {\r\n                    this.downInterval = setInterval(() => {\r\n                        this.toolspace.scrollBy(0, 13);\r\n                        this.update();\r\n                    }, 20);\r\n                }\r\n                if (e.type === 'pointerup') {\r\n                    clearInterval(this.downInterval);\r\n                    setTimeout(() => { // prevent ff pressing anything underneath\r\n                        this.downInterval = null;\r\n                        this.update();\r\n                    }, 50);\r\n                }\r\n            },\r\n        });\r\n\r\n        const wheelListener = (e: WheelEvent) => {\r\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\r\n            this.update();\r\n        };\r\n        this.upBtn.addEventListener('wheel', wheelListener);\r\n        this.downBtn.addEventListener('wheel', wheelListener);\r\n\r\n        this.update();\r\n\r\n        const observer = new MutationObserver(() => this.update());\r\n        observer.observe(\r\n            this.toolspace,\r\n            {\r\n                attributes: true,\r\n                childList: true,\r\n                subtree: true,\r\n            }\r\n        );\r\n        window.addEventListener('resize', () => this.update());\r\n\r\n        // hide if in dialog because that can have its own scrollbar\r\n        dialogCounter.subscribe((v) => {\r\n            // ignores the 0.5 by tool dropdown\r\n            this.upBtn.style.opacity = v >= 1 ? '0' : '';\r\n            this.downBtn.style.opacity = v >= 1 ? '0' : '';\r\n        });\r\n    }\r\n\r\n    updateUiState (uiState: 'left' | 'right'): void {\r\n        BB.css(this.upBtn, {\r\n            left: uiState === 'left' ? '0' : '',\r\n            right: uiState === 'right' ? '0' : '',\r\n        });\r\n        BB.css(this.downBtn, {\r\n            left: uiState === 'left' ? '0' : '',\r\n            right: uiState === 'right' ? '0' : '',\r\n        });\r\n    }\r\n}","import {BB} from '../../../bb/bb';\r\nimport {KlSlider} from '../components/kl-slider';\r\nimport {LANG} from '../../../language/language';\r\nimport {Checkbox} from '../components/checkbox';\r\nimport {Options} from '../components/options';\r\nimport {TGradientType} from '../../kl-types';\r\nimport {KlColorSlider} from '../components/kl-color-slider';\r\n\r\n\r\ninterface IGradientUiSettings {\r\n    opacity: number;\r\n    type: TGradientType;\r\n    doLockAlpha: boolean;\r\n    doSnap: boolean;\r\n    isReversed: boolean;\r\n    isEraser: boolean;\r\n}\r\n\r\n/**\r\n * Gradient Tool tab contents\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport class GradientUi {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private colorDiv: HTMLElement;\r\n    private colorSlider: KlColorSlider;\r\n    private isVisible: boolean;\r\n    private readonly iconArr: HTMLElement[];\r\n\r\n    private settings: IGradientUiSettings = {\r\n        opacity: 1,\r\n        type: 'linear',\r\n        doLockAlpha: false,\r\n        doSnap: false,\r\n        isReversed: false,\r\n        isEraser: false,\r\n    };\r\n\r\n    private updateIcons (): void {\r\n        const col1 = this.settings.isReversed ? '#0000' : '#000';\r\n        const col2 = this.settings.isReversed ? '#000' : '#0000';\r\n        this.iconArr[0].style.background = `linear-gradient(${col1}, ${col2})`;\r\n        this.iconArr[1].style.background = `linear-gradient(${col2}, ${col1}, ${col2})`;\r\n        this.iconArr[2].style.background = `radial-gradient(${col1}, ${col2})`;\r\n    }\r\n\r\n    // ----- public -------\r\n\r\n    constructor (\r\n        p: {\r\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\r\n        }\r\n    ) {\r\n        this.colorSlider = p.colorSlider;\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                margin: '10px',\r\n            },\r\n        });\r\n        this.isVisible = true;\r\n\r\n        this.colorDiv = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        this.iconArr = [];\r\n        {\r\n            const size = 33;\r\n            [0, 1, 2].forEach(() => {\r\n                const el = BB.el({\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        width: size + 'px',\r\n                        height: size + 'px',\r\n                        borderRadius: '3px',\r\n                        margin: '1px',\r\n                    },\r\n                });\r\n                this.iconArr.push(el);\r\n            });\r\n        }\r\n        this.updateIcons();\r\n\r\n        const typeOptions = new Options<TGradientType>({\r\n            optionArr: [\r\n                {\r\n                    id: 'linear',\r\n                    label: this.iconArr[0],\r\n                    title: LANG('gradient-linear'),\r\n                },\r\n                {\r\n                    id: 'linear-mirror',\r\n                    label: this.iconArr[1],\r\n                    title: LANG('gradient-linear-mirror'),\r\n                },\r\n                {\r\n                    id: 'radial',\r\n                    label: this.iconArr[2],\r\n                    title: LANG('gradient-radial'),\r\n                },\r\n            ],\r\n            initId: 'linear',\r\n            onChange: (id) => {\r\n                this.settings.type = id;\r\n            },\r\n        });\r\n        this.rootEl.append(typeOptions.getElement());\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 250,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: this.settings.opacity,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n            onChange: (val) => {\r\n                this.settings.opacity = val;\r\n            },\r\n        });\r\n        BB.css(opacitySlider.getElement(), {\r\n            marginTop: '10px',\r\n        });\r\n        this.rootEl.append(opacitySlider.getElement());\r\n\r\n\r\n\r\n        const row1 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const reverseToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('reverse'),\r\n            callback: (b) => {\r\n                this.settings.isReversed = b;\r\n                this.updateIcons();\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        const doSnapToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('angle-snap'),\r\n            title: LANG('angle-snap-title'),\r\n            callback: (b) => {\r\n                this.settings.doSnap = b;\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        row1.append(\r\n            reverseToggle.getElement(),\r\n            doSnapToggle.getElement(),\r\n        );\r\n\r\n\r\n        const row2 = BB.el({\r\n            parent: this.rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const eraserToggle = new Checkbox({\r\n            init: this.settings.isEraser,\r\n            label: LANG('eraser'),\r\n            callback: (b) => {\r\n                this.settings.isEraser = b;\r\n            },\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        const lockAlphaToggle = new Checkbox({\r\n            init: false,\r\n            label: LANG('lock-alpha'),\r\n            title: LANG('lock-alpha-title'),\r\n            callback: (b) => {\r\n                this.settings.doLockAlpha = b;\r\n            },\r\n            doHighlight: true,\r\n            css: {\r\n                width: '50%',\r\n            },\r\n        });\r\n\r\n        row2.append(\r\n            eraserToggle.getElement(),\r\n            lockAlphaToggle.getElement(),\r\n        );\r\n\r\n\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    setIsVisible (isVisible: boolean): void {\r\n        this.isVisible = !!isVisible;\r\n        this.rootEl.style.display = isVisible ? 'block' : 'none';\r\n        if (isVisible) {\r\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\r\n        }\r\n    }\r\n\r\n    getSettings (): IGradientUiSettings {\r\n        return BB.copyObj(this.settings);\r\n    }\r\n\r\n}","import {BB} from '../bb/bb';\r\nimport uiSwapImg from '/src/app/img/ui/ui-swap-lr.svg';\r\nimport helpImg from '/src/app/img/ui/help.svg';\r\nimport {LANG} from '../language/language';\r\nimport {PointerListener} from '../bb/input/pointer-listener';\r\n\r\n/**\r\n * Topmost row of buttons in toolspace. (embed)\r\n *\r\n * @param p\r\n * @constructor\r\n */\r\nexport class EmbedToolspaceTopRow {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n\r\n    // ---- public ----\r\n\r\n    constructor (p: {onSubmit: () => void; onLeftRight: () => void; onHelp: () => void}) {\r\n        this.rootEl = BB.el({\r\n            className: 'kl-toolspace-row',\r\n            css: {\r\n                height: '36px',\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        function createButton (p): {\r\n            el: HTMLElement;\r\n            pointerListener: PointerListener;\r\n        } {\r\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\r\n            const el = BB.el({\r\n                className: 'toolspace-row-button nohighlight',\r\n                title: p.title,\r\n                onClick: p.onClick,\r\n                css: {\r\n                    padding: p.content ? '' : (p.contain ? padding + 'px 0' : ''),\r\n                },\r\n            });\r\n            if (p.content) {\r\n                el.append(p.content);\r\n            } else {\r\n                const im = BB.el({\r\n                    className: 'dark-invert',\r\n                    css: {\r\n                        backgroundImage: 'url(\\'' + p.image + '\\')',\r\n                        backgroundRepeat: 'no-repeat',\r\n                        backgroundPosition: 'center',\r\n                        backgroundSize: p.contain ? 'contain' : '',\r\n                        //filter: 'grayscale(1)',\r\n                        height: '100%',\r\n                    },\r\n                });\r\n                im.style.pointerEvents = 'none';\r\n                el.append(im);\r\n            }\r\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\r\n                target: el,\r\n                onEnterLeave: function (isOver) {\r\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\r\n                },\r\n            });\r\n\r\n            return {\r\n                el,\r\n                pointerListener,\r\n            };\r\n        }\r\n\r\n        const submitButton = createButton({\r\n            onClick: p.onSubmit,\r\n            title: LANG('submit-title'),\r\n            content: BB.el({\r\n                content: LANG('submit'),\r\n                className: 'toolspace-row-button__submit',\r\n                css: {\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    width: '100%',\r\n                    height: '100%',\r\n                },\r\n            }),\r\n            contain: true,\r\n        });\r\n        submitButton.el.style.width = '45px';\r\n\r\n        const helpButton = createButton({\r\n            onClick: p.onHelp,\r\n            title: LANG('help'),\r\n            image: helpImg,\r\n            contain: true,\r\n        });\r\n\r\n        const leftRightButton = createButton({\r\n            onClick: p.onLeftRight,\r\n            title: LANG('switch-ui-left-right'),\r\n            image: uiSwapImg,\r\n            contain: true,\r\n        });\r\n\r\n        this.rootEl.append(submitButton.el, leftRightButton.el, helpButton.el);\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}\r\n","import {filterLib, filterLibStatus} from './filters';\r\nimport {filterBrightnessContrast} from './filter-brightness-contrast';\r\nimport {filterCropExtend} from './filter-crop-extend';\r\nimport {filterCurves} from './filter-curves';\r\nimport {filterFlip} from './filter-flip';\r\nimport {filterHueSaturation} from './filter-hue-saturation';\r\nimport {filterInvert} from './filter-invert';\r\nimport {filterPerspective} from './filter-perspective';\r\nimport {filterResize} from './filter-resize';\r\nimport {filterRotate} from './filter-rotate';\r\nimport {filterTiltShift} from './filter-tilt-shift';\r\nimport {filterTransform} from './filter-transform';\r\nimport {filterBlur} from './filter-blur';\r\nimport {filterUnsharpMask} from './filter-unsharp-mask';\r\nimport {filterToAlpha} from './filter-to-alpha';\r\nimport {filterGrid} from './filter-grid';\r\nimport {filterNoise} from './filter-noise';\r\nimport {filterPattern} from './filter-pattern';\r\nimport {filterDistort} from './filter-distort';\r\nimport {filterVanishPoint} from './filter-vanish-point';\r\n\r\nfunction importFilter (libObj, moduleObj): void {\r\n    if (moduleObj.getDialog) {\r\n        libObj.getDialog = moduleObj.getDialog;\r\n    }\r\n    libObj.apply = moduleObj.apply;\r\n}\r\n\r\n\r\nexport function importFilters (): void {\r\n    if (filterLibStatus.isLoaded) {\r\n        return;\r\n    }\r\n    importFilter(filterLib.brightnessContrast, filterBrightnessContrast);\r\n    importFilter(filterLib.cropExtend, filterCropExtend);\r\n    importFilter(filterLib.curves, filterCurves);\r\n    importFilter(filterLib.flip, filterFlip);\r\n    importFilter(filterLib.hueSaturation, filterHueSaturation);\r\n    importFilter(filterLib.invert, filterInvert);\r\n    importFilter(filterLib.perspective, filterPerspective);\r\n    importFilter(filterLib.resize, filterResize);\r\n    importFilter(filterLib.rotate, filterRotate);\r\n    importFilter(filterLib.tiltShift, filterTiltShift);\r\n    importFilter(filterLib.transform, filterTransform);\r\n    importFilter(filterLib.blur, filterBlur);\r\n    importFilter(filterLib.unsharpMask, filterUnsharpMask);\r\n    importFilter(filterLib.toAlpha, filterToAlpha);\r\n    importFilter(filterLib.grid, filterGrid);\r\n    importFilter(filterLib.noise, filterNoise);\r\n    importFilter(filterLib.pattern, filterPattern);\r\n    importFilter(filterLib.distort, filterDistort);\r\n    importFilter(filterLib.vanishPoint, filterVanishPoint);\r\n\r\n    filterLibStatus.isLoaded = true;\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterBrightnessContrastInput = {\r\n    brightness: number;\r\n    contrast: number;\r\n}\r\n\r\nexport type TFilterBrightnessContrastHistoryEntry = TFilterHistoryEntry<\r\n    'brightnessContrast',\r\n    TFilterBrightnessContrastInput>;\r\n\r\nexport const filterBrightnessContrast = {\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterBrightnessContrastInput> = {\r\n            element: div,\r\n        };\r\n\r\n\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n\r\n        function finishInit (): void {\r\n\r\n            let brightness = 0, contrast = 0;\r\n            div.innerHTML = LANG('filter-bright-contrast-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const brightnessSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-brightness'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (brightness + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    brightness = val / 50 - 1;\r\n                    fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            const contrastSlider = new KlSlider({\r\n                label: LANG('filter-bright-contrast-contrast'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (contrast + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    contrast = val / 50 - 1;\r\n                    fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            brightnessSlider.getElement().style.marginBottom = '10px';\r\n            div.append(brightnessSlider.getElement(), contrastSlider.getElement());\r\n\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = () => {\r\n                brightnessSlider.destroy();\r\n                contrastSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterBrightnessContrastInput {\r\n                result.destroy();\r\n                return {\r\n                    brightness: brightness,\r\n                    contrast: contrast,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterBrightnessContrastInput>): boolean {\r\n        const context = params.context;\r\n        const brightness = params.input.brightness;\r\n        const contrast = params.input.contrast;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'brightnessContrast'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterBrightnessContrastHistoryEntry);\r\n\r\n        return true;\r\n    },\r\n};","\r\nexport const eventResMs = 60;","import {fxCanvas} from './fx-canvas';\r\nimport {TFxCanvas} from './fx-canvas-types';\r\n\r\nlet fx: TFxCanvas | null = null;\r\ntry {\r\n    fx = fxCanvas();\r\n} catch (e) {\r\n    setTimeout(() => {\r\n        throw e;\r\n    });\r\n}\r\n\r\nexport function getSharedFx (): TFxCanvas | null {\r\n    if (!fx || fx._.gl.isContextLost()) {\r\n        try {\r\n            fx = fxCanvas();\r\n        } catch (e) {\r\n            setTimeout(() => {\r\n                throw e;\r\n            });\r\n        }\r\n    }\r\n    return fx;\r\n}","import {brightnessContrast} from './filters/brightness-contrast';\r\nimport {FxShader} from './core/fx-shader';\r\nimport {gl, setGl} from './core/gl';\r\nimport {FxTexture} from './core/fx-texture';\r\nimport {curves} from './filters/curves';\r\nimport {hueSaturation} from './filters/hue-saturation';\r\nimport {noise} from './filters/noise';\r\nimport {triangleBlur} from './filters/triangle-blur';\r\nimport {tiltShift} from './filters/tilt-shift';\r\nimport {matrixWarp} from './filters/matrix-warp';\r\nimport {unsharpMask} from './filters/unsharp-mask';\r\nimport {toAlpha} from './filters/to-alpha';\r\nimport {invert} from './filters/invert';\r\nimport {perspective} from './filters/perspective';\r\nimport {unmultiplyAlpha} from './filters/unmultiply-alpha';\r\nimport {distort} from './filters/distort';\r\nimport {multiplyAlpha} from './filters/multiply-alpha';\r\nimport {TFxCanvas, TFxGl, TFxSupportedElements, TWrappedTexture} from './fx-canvas-types';\r\nimport {BB} from '../bb/bb';\r\n\r\n/*\r\n * based on glfx.js\r\n * https://github.com/evanw/glfx.js/\r\n * Copyright 2011 Evan Wallace\r\n * Released under the MIT license\r\n */\r\n\r\n/**\r\n * Before you can apply any filters you will need a canvas, which stores the result of the filters you apply.\r\n * Canvas creation is done through fxCanvas(), which creates and returns a new WebGL <canvas> tag with additional\r\n * methods specific to fxCanvas. This call will throw an error message if the browser doesn't support WebGL.\r\n *\r\n * This library provides realtime image effects using WebGL. There are three parts to it:\r\n * - texture - a raw source of image data (created from <img> <canvas> or <video>)\r\n * - filter - an image effect (represents one or more WebGL shaders)\r\n * - canvas - an image buffer that stores the results (a WebGL <canvas> tag)\r\n */\r\nexport const fxCanvas: (() => TFxCanvas) = (function () {\r\n\r\n    function wrapTexture (texture: FxTexture): TWrappedTexture {\r\n        return {\r\n            _: texture,\r\n            loadContentsOf: function (element) {\r\n                // Make sure that we're using the correct global WebGL context\r\n                setGl(this._.gl);\r\n                this._.loadContentsOf(element);\r\n            },\r\n            destroy: function () {\r\n                // Make sure that we're using the correct global WebGL context\r\n                setGl(this._.gl);\r\n                this._.destroy();\r\n            },\r\n        };\r\n    }\r\n\r\n    function texture (element: TFxSupportedElements) {\r\n        return wrapTexture(FxTexture.fromElement(element));\r\n    }\r\n\r\n    function getTextureType (): GLenum {\r\n        let textureType: GLenum = gl.UNSIGNED_BYTE;\r\n\r\n        // Go for floating point buffer textures if we can, it'll make the bokeh\r\n        // filter look a lot better. Note that on Windows, ANGLE does not let you\r\n        // render to a floating-point texture when linear filtering is enabled.\r\n        // See http://crbug.com/172278 for more information.\r\n        if (\r\n            gl.getExtension('WEBGL_color_buffer_float') && // firefox shows warning without this line\r\n            gl.getExtension('OES_texture_float') &&\r\n            gl.getExtension('OES_texture_float_linear')\r\n        ) {\r\n            const testTexture = new FxTexture(100, 100, gl.RGBA, gl.FLOAT);\r\n            try {\r\n                // Only use gl.FLOAT if we can render to it\r\n                testTexture.drawTo(function () {\r\n                    textureType = gl.FLOAT;\r\n                });\r\n            } catch (e) {\r\n            }\r\n            testTexture.destroy();\r\n        }\r\n        return textureType;\r\n    }\r\n\r\n    function initialize (this: TFxCanvas, width: number, height: number): void {\r\n        const textureType = getTextureType();\r\n        if (this._.texture) {\r\n            this._.texture.destroy();\r\n        }\r\n        if (this._.spareTexture) {\r\n            this._.spareTexture.destroy();\r\n        }\r\n        this.width = width;\r\n        this.height = height;\r\n        this._.texture = new FxTexture(width, height, gl.RGBA, textureType);\r\n        this._.spareTexture = new FxTexture(width, height, gl.RGBA, textureType);\r\n        this._.extraTexture = this._.extraTexture || new FxTexture(0, 0, gl.RGBA, textureType);\r\n        this._.flippedShader = this._.flippedShader || new FxShader(null, `\r\nuniform sampler2D texture;\r\nvarying vec2 texCoord;\r\nvoid main() {\r\n    gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\r\n}\r\n        `, 'flippedShader');\r\n        this._.isInitialized = true;\r\n    }\r\n\r\n    function draw (this: TFxCanvas, texture: TWrappedTexture, width?: number, height?: number): TFxCanvas {\r\n        if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\r\n            initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\r\n        }\r\n\r\n        texture._.use();\r\n        this._.texture.drawTo(function () {\r\n            FxShader.getDefaultShader().drawRect();\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    function update (this: TFxCanvas): TFxCanvas {\r\n        this._.texture.use();\r\n        this._.flippedShader.drawRect();\r\n        return this;\r\n    }\r\n\r\n    function contents (this: TFxCanvas): TWrappedTexture {\r\n        const texture = new FxTexture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\r\n        this._.texture.use();\r\n        texture.drawTo(function () {\r\n            FxShader.getDefaultShader().drawRect();\r\n        });\r\n        return wrapTexture(texture);\r\n    }\r\n\r\n    /*\r\n       Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\r\n       Length of the array will be width * height * 4.\r\n    */\r\n    function getPixelArray (this: TFxCanvas): Uint8Array {\r\n        const w = this._.texture.width;\r\n        const h = this._.texture.height;\r\n        const array = new Uint8Array(w * h * 4);\r\n        this._.texture.drawTo(function () {\r\n            gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\r\n        });\r\n        return array;\r\n    }\r\n\r\n    function wrap<F extends (...args: any[]) => unknown>(fn: F): F {\r\n        return <F>function (this: TFxCanvas, ...args: any[]) {\r\n            // Make sure that we're using the correct global WebGL context\r\n            setGl(this._.gl);\r\n            // Now that the context has been switched, we can call the wrapped function\r\n            return fn.apply(this, args);\r\n        };\r\n    }\r\n\r\n    const fxCanvas = function () {\r\n        const canvas: TFxCanvas = BB.canvas() as TFxCanvas;\r\n        let context: TFxGl | null = null;\r\n        ['webgl', 'experimental-webgl'].forEach(item => {\r\n            if (context) {\r\n                return;\r\n            }\r\n            // get.webgl.org does a try-catch\r\n            try {\r\n                context = canvas.getContext(item, {premultipliedAlpha: false}) as (TFxGl | null);\r\n            } catch (e) {}\r\n        });\r\n        setGl(context);\r\n        if (!gl) {\r\n            throw 'This browser does not support WebGL';\r\n        }\r\n\r\n        canvas._ = {\r\n            gl: gl,\r\n            isInitialized: false,\r\n            texture: null,\r\n            spareTexture: null,\r\n            flippedShader: null,\r\n        };\r\n\r\n        // Core methods\r\n        canvas.texture = wrap(texture);\r\n        canvas.draw = wrap(draw);\r\n        canvas.update = wrap(update);\r\n        canvas.contents = wrap(contents);\r\n        canvas.getPixelArray = wrap(getPixelArray);\r\n\r\n        // Filter methods\r\n        canvas.brightnessContrast = wrap(brightnessContrast);\r\n        canvas.hueSaturation = wrap(hueSaturation);\r\n        canvas.triangleBlur = wrap(triangleBlur);\r\n        canvas.unsharpMask = wrap(unsharpMask);\r\n        canvas.perspective = wrap(perspective);\r\n        canvas.matrixWarp = wrap(matrixWarp);\r\n        canvas.tiltShift = wrap(tiltShift);\r\n        canvas.noise = wrap(noise);\r\n        canvas.curves = wrap(curves);\r\n        canvas.invert = wrap(invert);\r\n        canvas.multiplyAlpha = wrap(multiplyAlpha);\r\n        canvas.unmultiplyAlpha = wrap(unmultiplyAlpha);\r\n        canvas.toAlpha = wrap(toAlpha);\r\n        canvas.distort = wrap(distort);\r\n\r\n        return canvas as TFxCanvas;\r\n    };\r\n\r\n    return fxCanvas;\r\n})();","import {BB} from '../../bb/bb';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {gl} from '../core/gl';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * @type Brightness / Contrast\r\n * Provides additive brightness and multiplicative contrast control.\r\n * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\r\n * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n */\r\nexport type TFilterBrightnessContrast = (\r\n    this: TFxCanvas,\r\n    brightness: number,\r\n    contrast: number\r\n) => TFxCanvas;\r\n\r\nexport const brightnessContrast: TFilterBrightnessContrast = function (brightness, contrast) {\r\n    gl.brightnessContrast = gl.brightnessContrast || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float brightness;\\\r\n        uniform float contrast;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.rgb += brightness;\\\r\n            if (contrast > 0.0) {\\\r\n                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\r\n            } else {\\\r\n                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\r\n            }\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'brightnessContrast');\r\n\r\n    simpleShader.call(this, gl.brightnessContrast, {\r\n        brightness: BB.clamp(brightness, -1, 1),\r\n        contrast: BB.clamp(contrast, -1, 1),\r\n    });\r\n\r\n    return this;\r\n};","import {TFxCanvas, TUniforms} from '../fx-canvas-types';\r\nimport {FxTexture} from './fx-texture';\r\nimport {FxShader} from './fx-shader';\r\n\r\nexport function simpleShader (this: TFxCanvas, shader: FxShader, uniforms: TUniforms, textureIn?: FxTexture, textureOut?: FxTexture): void {\r\n    (textureIn || this._.texture).use();\r\n    this._.spareTexture.drawTo(function () {\r\n        shader.uniforms(uniforms).drawRect();\r\n    });\r\n    this._.spareTexture.swapWith(textureOut || this._.texture);\r\n}","import {gl} from './gl';\r\nimport {TUniforms} from '../fx-canvas-types';\r\nimport {BB} from '../../bb/bb';\r\n\r\n// VERTEX_SHADER | FRAGMENT_SHADER\r\ntype TShaderType = GLenum;\r\n\r\nconst defaultVertexSource = '\\\r\n    attribute vec2 vertex;\\\r\n    attribute vec2 _texCoord;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        texCoord = _texCoord;\\\r\n        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\r\n    }';\r\n\r\nconst defaultFragmentSource = '\\\r\n    uniform sampler2D texture;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        gl_FragColor = texture2D(texture, texCoord);\\\r\n    }';\r\n\r\nfunction isArray (obj: unknown): obj is unknown[] {\r\n    return Object.prototype.toString.call(obj) == '[object Array]';\r\n}\r\n\r\nfunction isNumber (obj: unknown): obj is number {\r\n    return Object.prototype.toString.call(obj) == '[object Number]';\r\n}\r\n\r\nlet floatPrecision: 'lowp' | 'mediump' | 'highp' | undefined;\r\n\r\nexport class FxShader {\r\n\r\n    // ---- static ----\r\n    static getDefaultShader (): FxShader {\r\n        gl.defaultShader = gl.defaultShader || new FxShader();\r\n        return gl.defaultShader;\r\n    }\r\n\r\n\r\n    // ---- private ----\r\n\r\n    private compileSource (type: TShaderType, source: string, nameStr: string): WebGLShader {\r\n        const shader = BB.throwIfNull(gl.createShader(type));\r\n        gl.shaderSource(shader, source.replace(/#define.*/, '')); // glslify adds a line add the beginning that breaks it\r\n        gl.compileShader(shader);\r\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n            throw 'compile error: ' + nameStr + ' - ' + gl.getShaderInfoLog(shader);\r\n        }\r\n        return shader;\r\n    }\r\n\r\n    /**\r\n     * HIGH_FLOAT | MEDIUM_FLOAT\r\n     */\r\n    private testPrecisionSupport (precisionType: GLenum): boolean {\r\n        const format = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, precisionType);\r\n        return format !== null && format.precision !== 0;\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        vertexSource?: string | null,\r\n        fragmentSource?: string | null,\r\n        nameStr?: string,\r\n    ) {\r\n        this.vertexAttribute = null;\r\n        this.texCoordAttribute = null;\r\n        this.program = BB.throwIfNull(gl.createProgram());\r\n        vertexSource = vertexSource || defaultVertexSource;\r\n        fragmentSource = fragmentSource || defaultFragmentSource;\r\n        if (!floatPrecision) {\r\n            floatPrecision = this.testPrecisionSupport(gl.HIGH_FLOAT) ? 'highp' : (this.testPrecisionSupport(gl.MEDIUM_FLOAT) ? 'mediump' : 'lowp');\r\n        }\r\n        fragmentSource = 'precision ' + floatPrecision + ' float;' + fragmentSource; // annoying requirement is annoying\r\n        gl.attachShader(this.program, this.compileSource(gl.VERTEX_SHADER, vertexSource, nameStr + '(vertex)'));\r\n        gl.attachShader(this.program, this.compileSource(gl.FRAGMENT_SHADER, fragmentSource, nameStr + '(fragment)'));\r\n        gl.linkProgram(this.program);\r\n        if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\r\n            throw 'link error: ' + gl.getProgramInfoLog(this.program);\r\n        }\r\n    }\r\n\r\n    // ---- interface ----\r\n    \r\n    vertexAttribute: null | number;\r\n    texCoordAttribute: null | number;\r\n    program: WebGLProgram; // null = destroyed\r\n\r\n    destroy (): void {\r\n        gl.deleteProgram(this.program);\r\n        this.program = null;\r\n    }\r\n\r\n    uniforms (uniforms: TUniforms): FxShader {\r\n        gl.useProgram(this.program);\r\n        Object.entries(uniforms).forEach(([name, value]) => {\r\n\r\n            const location = gl.getUniformLocation(this.program, name);\r\n            if (location === null) {\r\n                // will be null if the uniform isn't used in the shader\r\n                return;\r\n            }\r\n\r\n            if (isArray(value)) {\r\n                switch (value.length) {\r\n                    case 1:\r\n                        gl.uniform1fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 2:\r\n                        gl.uniform2fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 3:\r\n                        gl.uniform3fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 4:\r\n                        gl.uniform4fv(location, new Float32Array(value));\r\n                        break;\r\n                    case 9:\r\n                        gl.uniformMatrix3fv(location, false, new Float32Array(value));\r\n                        break;\r\n                    case 16:\r\n                        gl.uniformMatrix4fv(location, false, new Float32Array(value));\r\n                        break;\r\n                    default:\r\n                        throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\r\n                }\r\n            } else if (isNumber(value)) {\r\n                gl.uniform1f(location, value);\r\n            } else {\r\n                throw 'attempted to set uniform \"' + name + '\" to invalid value ' + (value || 'undefined').toString();\r\n            }\r\n        });\r\n        // allow chaining\r\n        return this;\r\n    }\r\n\r\n    //\r\n    /**\r\n     * textures are uniforms too but for some reason can't be specified by gl.uniform1f,\r\n     * even though floating point numbers represent the integers 0 through 7 exactly\r\n     */\r\n    textures (textures: Record<string, GLint>): FxShader {\r\n        gl.useProgram(this.program);\r\n\r\n        Object.entries(textures).forEach(([name, value]) => {\r\n            gl.uniform1i(gl.getUniformLocation(this.program, name), value);\r\n        });\r\n\r\n        // allow chaining\r\n        return this;\r\n    }\r\n\r\n   drawRect (left?: number, top?: number, right?: number, bottom?: number): void {\r\n        let undefined;\r\n        const viewport = gl.getParameter(gl.VIEWPORT);\r\n        top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\r\n        left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\r\n        right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\r\n        bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\r\n        if (gl.vertexBuffer === undefined || gl.vertexBuffer === null) {\r\n            gl.vertexBuffer = BB.throwIfNull(gl.createBuffer());\r\n        }\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([left, top, left, bottom, right, top, right, bottom]), gl.STATIC_DRAW);\r\n        if (gl.texCoordBuffer == null) {\r\n            gl.texCoordBuffer = BB.throwIfNull(gl.createBuffer());\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\r\n        }\r\n        if (this.vertexAttribute == null) {\r\n            this.vertexAttribute = gl.getAttribLocation(this.program, 'vertex');\r\n            gl.enableVertexAttribArray(this.vertexAttribute);\r\n        }\r\n        if (this.texCoordAttribute == null) {\r\n            this.texCoordAttribute = gl.getAttribLocation(this.program, '_texCoord');\r\n            gl.enableVertexAttribArray(this.texCoordAttribute);\r\n        }\r\n        gl.useProgram(this.program);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\r\n        gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\r\n        gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    }\r\n\r\n}","import {TFxGl} from '../fx-canvas-types';\r\n\r\nexport let gl: TFxGl;\r\n\r\nexport function setGl (newGl: TFxGl | null): void {\r\n    gl = newGl;\r\n}","import {gl} from './gl';\r\nimport {BB} from '../../bb/bb';\r\nimport {TFxGl, TFxSupportedElements} from '../fx-canvas-types';\r\n\r\n/**\r\n * Format           Type                    Channels    Bytes per pixel\r\n * RGBA             UNSIGNED_BYTE           4           4\r\n * RGB              UNSIGNED_BYTE           3           3\r\n * RGBA             UNSIGNED_SHORT_4_4_4_4  4           2\r\n * RGBA             UNSIGNED_SHORT_5_5_5_1  4           2\r\n * RGB              UNSIGNED_SHORT_5_6_5    3           2\r\n * LUMINANCE_ALPHA  UNSIGNED_BYTE           2           2\r\n * LUMINANCE        UNSIGNED_BYTE           1           1\r\n * ALPHA            UNSIGNED_BYTE           1           1\r\n *\r\n * https://webglfundamentals.org/webgl/lessons/webgl-data-textures.html\r\n */\r\nexport type TTextureFormat = GLenum;\r\nexport type TTextureType = GLenum;\r\n\r\n\r\nexport class FxTexture {\r\n    \r\n    // ---- static ----\r\n    static fromElement (element: TFxSupportedElements): FxTexture {\r\n        const texture = new FxTexture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\r\n        texture.loadContentsOf(element);\r\n        return texture;\r\n    }\r\n    \r\n    \r\n    // ---- private ----\r\n    private canvas: HTMLCanvasElement;\r\n    private type: TTextureType;\r\n\r\n    /*\r\n    // never seen this being used\r\n    private getCanvas(texture: Texture): CanvasRenderingContext2D {\r\n        if (this.canvas == null) {\r\n            this.canvas = BB.canvas(texture.width, texture.height);\r\n        }\r\n        this.canvas.width = texture.width;\r\n        this.canvas.height = texture.height;\r\n        const c = BB.ctx(this.canvas);\r\n        c.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        return c;\r\n    }*/\r\n\r\n    \r\n    // ---- public ----\r\n    constructor (\r\n        width: number,\r\n        height: number,\r\n        format: TTextureFormat,\r\n        type: TTextureType,\r\n    ) {\r\n        this.gl = gl;\r\n        this.id = BB.throwIfNull(gl.createTexture());\r\n        this.width = width;\r\n        this.height = height;\r\n        this.format = format;\r\n        this.type = type;\r\n        this.canvas = null;\r\n\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        if (width && height) {\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n        }\r\n    }\r\n    \r\n    // ---- interface ----\r\n\r\n    gl: TFxGl;\r\n    width: number;\r\n    height: number;\r\n    id: WebGLTexture; // null -> destroyed\r\n    format: TTextureFormat;\r\n    \r\n    loadContentsOf (element: TFxSupportedElements): void {\r\n        this.width = element.width || element.videoWidth;\r\n        this.height = element.height || element.videoHeight;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\r\n    }\r\n\r\n    initFromBytes (width: number, height: number, data: number[]): void {\r\n        this.width = width;\r\n        this.height = height;\r\n        this.format = gl.RGBA;\r\n        this.type = gl.UNSIGNED_BYTE;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\r\n    }\r\n\r\n    destroy (): void {\r\n        gl.deleteTexture(this.id);\r\n        this.id = null;\r\n    }\r\n\r\n    use (unit?: number): void {\r\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n    }\r\n\r\n    unuse (unit: number): void {\r\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\r\n        gl.bindTexture(gl.TEXTURE_2D, null);\r\n    }\r\n\r\n    ensureFormat (width: number, height: number, format: TTextureFormat, type: TTextureType): void {\r\n        // change the format only if required\r\n        if (width != this.width || height != this.height || format != this.format || type != this.type) {\r\n            this.width = width;\r\n            this.height = height;\r\n            this.format = format;\r\n            this.type = type;\r\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\r\n        }\r\n    }\r\n\r\n    ensureFormatViaTexture (texture: FxTexture): void {\r\n        this.ensureFormat(texture.width, texture.height, texture.format, texture.type);\r\n    }\r\n\r\n    drawTo (callback: () => void): void {\r\n        // start rendering to this texture\r\n        gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\r\n        if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\r\n            throw new Error('incomplete framebuffer');\r\n        }\r\n        gl.viewport(0, 0, this.width, this.height);\r\n\r\n        // do the drawing\r\n        callback();\r\n\r\n        // stop rendering to this texture\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    }\r\n\r\n\r\n    /*\r\n    // never seen this being used\r\n    fillUsingCanvas (callback: (canvas: CanvasRenderingContext2D) => void): Texture {\r\n        callback(this.getCanvas(this));\r\n        this.format = gl.RGBA;\r\n        this.type = gl.UNSIGNED_BYTE;\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.canvas);\r\n        return this;\r\n    }\r\n\r\n    // never seen this being used\r\n    toImage (image: HTMLImageElement): void {\r\n        this.use();\r\n        Shader.getDefaultShader().drawRect();\r\n        const size = this.width * this.height * 4;\r\n        const pixels = new Uint8Array(size);\r\n        const c = this.getCanvas(this);\r\n        const data = c.createImageData(this.width, this.height);\r\n        gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\r\n        for (let i = 0; i < size; i++) {\r\n            data.data[i] = pixels[i];\r\n        }\r\n        c.putImageData(data, 0, 0);\r\n        image.src = this.canvas.toDataURL();\r\n    }\r\n     */\r\n\r\n    swapWith (other: FxTexture): void {\r\n        let temp;\r\n\r\n        temp = other.id;\r\n        other.id = this.id;\r\n        this.id = temp;\r\n\r\n        temp = other.width;\r\n        other.width = this.width;\r\n        this.width = temp;\r\n\r\n        temp = other.height;\r\n        other.height = this.height;\r\n        this.height = temp;\r\n\r\n        temp = other.format;\r\n        other.format = this.format;\r\n        this.format = temp;\r\n\r\n        // type?\r\n    }\r\n}\r\n","import {splineInterpolate} from '../math/spline-interpolate';\r\nimport {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Curves\r\n * @description A powerful mapping tool that transforms the colors in the image\r\n *              by an arbitrary function. The function is interpolated between\r\n *              a set of 2D points using splines. The curves filter can take\r\n *              either one or three arguments which will apply the mapping to\r\n *              either luminance or RGB values, respectively.\r\n * @param red   A list of points that define the function for the red channel.\r\n *              Each point is a list of two values: the value before the mapping\r\n *              and the value after the mapping, both in the range 0 to 1. For\r\n *              example, [[0,1], [1,0]] would invert the red channel while\r\n *              [[0,0], [1,1]] would leave the red channel unchanged.\r\n * @param green A list of points that define the function for the green\r\n *              channel (just like for red).\r\n * @param blue  list of points that define the function for the blue\r\n *              channel (just like for red).\r\n */\r\nexport type TFilterCurves = (\r\n    this: TFxCanvas,\r\n    red: [number, number][],\r\n    green: [number, number][],\r\n    blue: [number, number][],\r\n) => TFxCanvas;\r\n\r\nexport const curves: TFilterCurves = function (red, green, blue) {\r\n    // Create the ramp texture\r\n    const redRamp = splineInterpolate(red);\r\n    const greenRamp = splineInterpolate(green);\r\n    const blueRamp = splineInterpolate(blue);\r\n    const array: number[] = [];\r\n    for (let i = 0; i < 256; i++) {\r\n        array.splice(array.length, 0, redRamp[i], greenRamp[i], blueRamp[i], 255);\r\n    }\r\n    this._.extraTexture.initFromBytes(256, 1, array);\r\n    this._.extraTexture.use(1);\r\n\r\n    gl.curves = gl.curves || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform sampler2D map;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            color.r = texture2D(map, vec2(color.r)).r;\\\r\n            color.g = texture2D(map, vec2(color.g)).g;\\\r\n            color.b = texture2D(map, vec2(color.b)).b;\\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'curves');\r\n\r\n    gl.curves.textures({\r\n        map: 1,\r\n    });\r\n    simpleShader.call(this, gl.curves, {});\r\n\r\n    return this;\r\n};","import {BB} from '../../bb/bb';\r\n\r\nexport function splineInterpolate (points: [number, number][]): number[] {\r\n    const interpolator = new BB.SplineInterpolator(points);\r\n    const array = [];\r\n    for (let i = 0; i < 256; i++) {\r\n        array.push(\r\n            BB.clamp(\r\n                Math.floor(interpolator.interpolate(i / 255) * 256),\r\n                0,\r\n                255\r\n            )\r\n        );\r\n    }\r\n    return array;\r\n}","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {BB} from '../../bb/bb';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Hue / Saturation\r\n * @description      Provides rotational hue and multiplicative saturation control. RGB color space\r\n *                   can be imagined as a cube where the axes are the red, green, and blue color\r\n *                   values. Hue changing works by rotating the color vector around the grayscale\r\n *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\r\n *                   Saturation is implemented by scaling all color channel values either toward\r\n *                   or away from the average color channel value.\r\n * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\r\n *                   and 1 is 180 degree rotation in the positive direction)\r\n * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\r\n */\r\nexport type TFilterHueSaturation = (\r\n    this: TFxCanvas,\r\n    hue: number,\r\n    saturation: number,\r\n) => TFxCanvas;\r\n\r\nexport const hueSaturation: TFilterHueSaturation = function (hue, saturation) {\r\n    gl.hueSaturation = gl.hueSaturation || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float hue;\\\r\n        uniform float saturation;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 color = texture2D(texture, texCoord);\\\r\n            \\\r\n            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\r\n            float angle = hue * 3.14159265;\\\r\n            float s = sin(angle), c = cos(angle);\\\r\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\r\n            float len = length(color.rgb);\\\r\n            color.rgb = vec3(\\\r\n                dot(color.rgb, weights.xyz),\\\r\n                dot(color.rgb, weights.zxy),\\\r\n                dot(color.rgb, weights.yzx)\\\r\n            );\\\r\n            \\\r\n            /* saturation adjustment */\\\r\n            float average = (color.r + color.g + color.b) / 3.0;\\\r\n            if (saturation > 0.0) {\\\r\n                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\r\n            } else {\\\r\n                color.rgb += (average - color.rgb) * (-saturation);\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color;\\\r\n        }\\\r\n    ', 'hueSaturation');\r\n\r\n    simpleShader.call(this, gl.hueSaturation, {\r\n        hue: BB.clamp(hue, -1, 1),\r\n        saturation: BB.clamp(saturation, -1, 1),\r\n    });\r\n\r\n    return this;\r\n};\r\n","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport shaderNoise from '../shaders/shader-noise.glsl';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Noise\r\n * draws noise, completely replaces original image\r\n */\r\nexport type TFilterNoise = (\r\n    this: TFxCanvas,\r\n    seed: number, // float, any value okay\r\n    type: number, // 1 value, 2 simplex, 3 cellular\r\n    scale: [number, number], // float, small scale will show repeating patterns\r\n    offset: [number, number], // offset x, y - large offsets will show repeating patterns\r\n    octaves: number, // int 0 - 4\r\n    samples: number, // 1 | 4 | 8 -> super-sampling\r\n    peaks: number, // how often it will ramp *additionally* from 0 to 1\r\n    brightness: number, // range [-1, 1]\r\n    contrast: number, // range [-1, 1]\r\n    isReversed: boolean, // reverse 0-1 range\r\n    colA: {r: number; g: number; b: number}, // which color at 0, if rgb\r\n    colB: {r: number; g: number; b: number}, // which color at 1, if rgb\r\n    channels: 'rgb' | 'alpha', // which channel to target\r\n) => TFxCanvas;\r\n\r\nexport const noise: TFilterNoise = function (\r\n    seed,\r\n    type,\r\n    scale,\r\n    offset,\r\n    octaves,\r\n    samples,\r\n    peaks,\r\n    brightness,\r\n    contrast,\r\n    isReversed,\r\n    colA,\r\n    colB,\r\n    channels,\r\n) {\r\n    gl.noise = gl.noise || new FxShader(null, shaderNoise.replace(/#define.*/, ''), 'noise');\r\n    simpleShader.call(this, gl.noise, {\r\n        seed,\r\n        type,\r\n        scale: [scale[0], scale[1]],\r\n        offset,\r\n        octaves,\r\n        samples,\r\n        texSize: [this.width, this.height],\r\n        peaks,\r\n        brightness,\r\n        contrast,\r\n        isReversed: isReversed ? 1.0 : 0.0,\r\n        colA: colA ? [colA.r / 255, colA.g / 255, colA.b / 255] : [0, 0, 0],\r\n        colB: colB ? [colB.r / 255, colB.g / 255, colB.b / 255] : [1, 1, 1],\r\n        channels: channels === 'rgb' ? 0 : 1,\r\n    });\r\n\r\n    return this;\r\n};","uniform sampler2D texture;\r\nvarying vec2 texCoord;\r\nuniform vec2 texSize;\r\n\r\nuniform float seed;\r\nuniform float type;\r\nuniform vec2 scale;\r\nuniform vec2 offset;\r\nuniform float octaves;\r\nuniform float samples;\r\n\r\nuniform float peaks;\r\nuniform float contrast;\r\nuniform float brightness;\r\nuniform float isReversed;\r\n\r\nuniform vec3 colA;\r\nuniform vec3 colB;\r\n\r\nuniform float channels; // 0 - rgb, 1 - alpha\r\n\r\n// fbm, cellular_noise based on\r\n// https://github.com/Gonkee/Gonkees-Shaders\r\n// MIT, Copyright  Gonkee\r\n\r\n// hash & simplex based on\r\n// https://www.shadertoy.com/view/Msf3WH\r\n// MIT, Copyright  2013 Inigo Quilez\r\n// https://www.youtube.com/c/InigoQuilez\r\n// https://iquilezles.org\r\n\r\n\r\n\r\nfloat rand(vec2 co) {\r\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\r\n}\r\n\r\nfloat value_noise(vec2 coord){\r\n    return rand(floor(coord) / 100.0);\r\n}\r\n\r\nfloat cellular_noise(vec2 coord) {\r\n    vec2 i = floor(coord);\r\n    vec2 f = fract(coord);\r\n\r\n    float min_dist = 99999.0;\r\n    for (float x = -1.0; x <= 1.0; x++) {\r\n        for (float y = -1.0; y <= 1.0; y++) {\r\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\r\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\r\n            min_dist = min(min_dist, dist);\r\n        }\r\n    }\r\n    return min_dist;\r\n}\r\n\r\n// ---------- Simplex Alternative ---------------------\r\n\r\nvec3 hash(vec3 p)\r\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\r\n, dot(p, vec3(269.5, 183.3, 246.1))\r\n, dot(p, vec3(113.5, 271.9, 124.6)))\r\n;return fract(sin(p)*43758.5453123)*2.-1.; }\r\n\r\nmat3 hash(mat3 p)\r\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\r\n\r\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\r\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\r\n\r\n//return noiseGra13dx as .x, and its derivatives as .yzw\r\n// https://www.shadertoy.com/view/llByD1\r\nvec3 noiseGra13dx(in vec3 x) {\r\n    vec3 p=floor(x), w=fract(x)\r\n    #if 1\r\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\r\n    #else\r\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\r\n    #endif\r\n    //gradients\r\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\r\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\r\n    //projections\r\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\r\n    //interpolations\r\n    float g=dot(G, w), f=dot(F, w-vec3(1));\r\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\r\n    mat3 S=D-mat3(G, G, G), W=D-E;\r\n    a.x=(a.x+a.y+a.z)+f-g;\r\n    ;float b=u.x*u.y*u.z;\r\n\r\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\r\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\r\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\r\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\r\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\r\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\r\n    return 0.5 + 0.5 * result.xxx;\r\n}\r\n\r\nfloat fbm(vec2 coord) {\r\n    float normalize_factor = 0.0;\r\n    float value = 0.0;\r\n    float scale = 0.5;\r\n\r\n    for (float i = 0.0; i < 7.0; i++){\r\n        if (i < octaves) {\r\n            if (type == 0.0) {\r\n                value += value_noise(coord) * scale;\r\n            } else if (type == 1.0) {\r\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\r\n            } else if (type == 2.0) {\r\n                value += cellular_noise(coord) * scale;\r\n            }\r\n            normalize_factor += scale;\r\n            coord *= 2.0;\r\n            scale *= 0.5;\r\n        }\r\n    }\r\n    return value / normalize_factor;\r\n}\r\n\r\nfloat render (vec2 pos) {\r\n    float result = fbm(pos);\r\n    //\r\n\r\n    if (peaks > 0.0) {\r\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\r\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\r\n    }\r\n\r\n    result += brightness;\r\n    if (contrast > 0.0) {\r\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\r\n    } else if (contrast < 0.0) {\r\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\r\n    }\r\n\r\n    if (isReversed == 1.0) {\r\n        result = 1.0 - result;\r\n    }\r\n    return result;\r\n}\r\n\r\n\r\nvoid main() {\r\n    vec4 color;\r\n\r\n    vec2 seedOffset;\r\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\r\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\r\n\r\n    float val = 0.0;\r\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\r\n\r\n    if (samples == 1.0) {\r\n        val = render(basePos);\r\n\r\n    }/* else if (samples == 4.0) {\r\n        for (float i = 0.0; i < 2.0; i++) {\r\n            for (float e = 0.0; e < 2.0; e++) {\r\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\r\n            }\r\n        }\r\n        val /= 4.0;\r\n\r\n    }*/ else if (samples == 16.0) {\r\n        for (float i = 0.0; i < 4.0; i++) {\r\n            for (float e = 0.0; e < 4.0; e++) {\r\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\r\n            }\r\n        }\r\n        val /= 16.0;\r\n    }\r\n\r\n    if (channels == 0.0) {\r\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\r\n    } else {\r\n        gl_FragColor = vec4(vec3(1.0), val);\r\n    }\r\n}","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {randomShaderFunc} from '../shaders/random-shader-func';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Triangle Blur\r\n * @description  This is the most basic blur filter, which convolves the image with a\r\n *               pyramid filter. The pyramid filter is separable and is applied as two\r\n *               perpendicular triangle filters.\r\n * @param radius The radius of the pyramid convolved with the image.\r\n */\r\nexport type TFilterTriangleBlur = (\r\n    this: TFxCanvas,\r\n    radius: number,\r\n) => TFxCanvas;\r\n\r\n\r\nexport const triangleBlur: TFilterTriangleBlur = function (radius) {\r\n    gl.triangleBlur = gl.triangleBlur || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform vec2 delta;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta * percent);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'triangleBlur');\r\n\r\n    simpleShader.call(this, gl.triangleBlur, {\r\n        delta: [radius / this.width, 0],\r\n    });\r\n    simpleShader.call(this, gl.triangleBlur, {\r\n        delta: [0, radius / this.height],\r\n    });\r\n\r\n    return this;\r\n};","// returns a random number between 0 and 1\r\nexport const randomShaderFunc = '\\\r\n    float random(vec3 scale, float seed) {\\\r\n        /* use the fragment position for a different seed per-pixel */\\\r\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\r\n    }\\\r\n';","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {randomShaderFunc} from '../shaders/random-shader-func';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Tilt Shift\r\n * @description          Simulates the shallow depth of field normally encountered in close-up\r\n *                       photography, which makes the scene seem much smaller than it actually\r\n *                       is. This filter assumes the scene is relatively planar, in which case\r\n *                       the part of the scene that is completely in focus can be described by\r\n *                       a line (the intersection of the focal plane and the scene). An example\r\n *                       of a planar scene might be looking at a road from above at a downward\r\n *                       angle. The image is then blurred with a blur radius that starts at zero\r\n *                       on the line and increases further from the line.\r\n * @param startX         The x coordinate of the start of the line segment.\r\n * @param startY         The y coordinate of the start of the line segment.\r\n * @param endX           The x coordinate of the end of the line segment.\r\n * @param endY           The y coordinate of the end of the line segment.\r\n * @param blurRadius     The maximum radius of the pyramid blur.\r\n * @param gradientRadius The distance from the line at which the maximum blur radius is reached.\r\n */\r\nexport type TFilterTiltShift = (\r\n    this: TFxCanvas,\r\n    startX: number,\r\n    startY: number,\r\n    endX: number,\r\n    endY: number,\r\n    blurRadius: number,\r\n    gradientRadius: number,\r\n) => TFxCanvas;\r\n\r\nexport const tiltShift: TFilterTiltShift = function (\r\n    startX,\r\n    startY,\r\n    endX,\r\n    endY,\r\n    blurRadius,\r\n    gradientRadius,\r\n) {\r\n    gl.tiltShift = gl.tiltShift || new FxShader(null, '\\\r\n        uniform sampler2D texture;\\\r\n        uniform float blurRadius;\\\r\n        uniform float gradientRadius;\\\r\n        uniform vec2 start;\\\r\n        uniform vec2 end;\\\r\n        uniform vec2 delta;\\\r\n        uniform vec2 texSize;\\\r\n        varying vec2 texCoord;\\\r\n        ' + randomShaderFunc + '\\\r\n        void main() {\\\r\n            vec4 color = vec4(0.0);\\\r\n            float total = 0.0;\\\r\n            \\\r\n            /* randomize the lookup values to hide the fixed number of samples */\\\r\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\r\n            \\\r\n            vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\\\r\n            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\\\r\n            for (float t = -30.0; t <= 30.0; t++) {\\\r\n                float percent = (t + offset - 0.5) / 30.0;\\\r\n                float weight = 1.0 - abs(percent);\\\r\n                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);\\\r\n                \\\r\n                /* switch to pre-multiplied alpha to correctly blur transparent images */\\\r\n                sample.rgb *= sample.a;\\\r\n                \\\r\n                color += sample * weight;\\\r\n                total += weight;\\\r\n            }\\\r\n            \\\r\n            gl_FragColor = color / total;\\\r\n            \\\r\n            /* switch back from pre-multiplied alpha */\\\r\n            gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\\\r\n        }\\\r\n    ', 'tiltShift');\r\n\r\n    const dx = endX - startX;\r\n    const dy = endY - startY;\r\n    const d = Math.sqrt(dx * dx + dy * dy);\r\n    simpleShader.call(this, gl.tiltShift, {\r\n        blurRadius: blurRadius,\r\n        gradientRadius: gradientRadius,\r\n        start: [startX, startY],\r\n        end: [endX, endY],\r\n        delta: [dx / d, dy / d],\r\n        texSize: [this.width, this.height],\r\n    });\r\n    simpleShader.call(this, gl.tiltShift, {\r\n        blurRadius: blurRadius,\r\n        gradientRadius: gradientRadius,\r\n        start: [startX, startY],\r\n        end: [endX, endY],\r\n        delta: [-dy / d, dx / d],\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {warpShader} from '../shaders/warp-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {getInverse} from '../math/matrix';\r\nimport {TFxCanvas, TMat2x2, TMat3x3, TMatDeep3x3} from '../fx-canvas-types';\r\n\r\n/**\r\n * Matrix Warp\r\n * @description           Transforms an image by a 2x2 or 3x3 matrix. The coordinates used in\r\n *                        the transformation are (x, y) for a 2x2 matrix or (x, y, 1) for a\r\n *                        3x3 matrix, where x and y are in units of pixels.\r\n * @param matrix          A 2x2 or 3x3 matrix represented as either a list or a list of lists.\r\n *                        For example, the 3x3 matrix [[2,0,0],[0,3,0],[0,0,1]] can also be\r\n *                        represented as [2,0,0,0,3,0,0,0,1] or just [2,0,0,3].\r\n * @param inverse         A boolean value that, when true, applies the inverse transformation\r\n *                        instead. (optional, defaults to false)\r\n * @param useTextureSpace A boolean value that, when true, uses texture-space coordinates\r\n *                        instead of screen-space coordinates. Texture-space coordinates range\r\n *                        from -1 to 1 instead of 0 to width - 1 or height - 1, and are easier\r\n *                        to use for simple operations like flipping and rotating.\r\n */\r\nexport type TFilterMatrixWarp = (\r\n    this: TFxCanvas,\r\n    matrix: TMat2x2 | TMat3x3 | TMatDeep3x3,\r\n    inverse?: boolean,\r\n    useTextureSpace?: boolean,\r\n) => TFxCanvas;\r\n\r\n\r\nexport const matrixWarp: TFilterMatrixWarp = function (matrix, inverse, useTextureSpace) {\r\n    gl.matrixWarp = gl.matrixWarp || warpShader('\\\r\n        uniform mat3 matrix;\\\r\n        uniform bool useTextureSpace;\\\r\n    ', '\\\r\n        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;\\\r\n        vec3 warp = matrix * vec3(coord, 1.0);\\\r\n        coord = warp.xy / warp.z;\\\r\n        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;\\\r\n    ');\r\n\r\n    // Flatten all members of matrix into one big list\r\n    matrix = matrix.flat() as (TMat2x2 | TMat3x3);\r\n\r\n    // Extract a 3x3 matrix out of the arguments\r\n    if (matrix.length == 4) {\r\n        matrix = [\r\n            matrix[0], matrix[1], 0,\r\n            matrix[2], matrix[3], 0,\r\n            0, 0, 1,\r\n        ];\r\n    } else if (matrix.length != 9) {\r\n        throw 'can only warp with 2x2 or 3x3 matrix';\r\n    }\r\n\r\n    simpleShader.call(this, gl.matrixWarp, {\r\n        matrix: inverse ? getInverse(matrix) : matrix,\r\n        texSize: [this.width, this.height],\r\n        useTextureSpace: useTextureSpace ? 1 : 0,\r\n    });\r\n\r\n    return this;\r\n};","import {FxShader} from '../core/fx-shader';\r\n\r\nexport function warpShader (uniformsStr: string, warpStr: string): FxShader {\r\n    return new FxShader(null, uniformsStr + '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    void main() {\\\r\n        vec2 coord = texCoord * texSize;\\\r\n        ' + warpStr + '\\\r\n        gl_FragColor = texture2D(texture, coord / texSize);\\\r\n        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\r\n        if (coord != clampedCoord) {\\\r\n            /* fade to transparent if we are outside the image */\\\r\n            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\r\n        }\\\r\n    }', 'warp');\r\n}","import {TMat3x3} from '../fx-canvas-types';\r\n\r\n// from javax.media.jai.PerspectiveTransform\r\n\r\n/**\r\n * Creates a PerspectiveTransform that maps the unit square onto an arbitrary quadrilateral.\r\n */\r\nexport function getSquareToQuad (\r\n    x0: number,\r\n    y0: number,\r\n    x1: number,\r\n    y1: number,\r\n    x2: number,\r\n    y2: number,\r\n    x3: number,\r\n    y3: number\r\n): TMat3x3 {\r\n    const dx1 = x1 - x2;\r\n    const dy1 = y1 - y2;\r\n    const dx2 = x3 - x2;\r\n    const dy2 = y3 - y2;\r\n    const dx3 = x0 - x1 + x2 - x3;\r\n    const dy3 = y0 - y1 + y2 - y3;\r\n    const det = dx1 * dy2 - dx2 * dy1;\r\n    const a = (dx3 * dy2 - dx2 * dy3) / det;\r\n    const b = (dx1 * dy3 - dx3 * dy1) / det;\r\n    return [\r\n        x1 - x0 + a * x1, y1 - y0 + a * y1, a,\r\n        x3 - x0 + b * x3, y3 - y0 + b * y3, b,\r\n        x0, y0, 1,\r\n    ];\r\n}\r\n\r\nexport function getInverse (m: TMat3x3): TMat3x3 {\r\n    const a = m[0], b = m[1], c = m[2];\r\n    const d = m[3], e = m[4], f = m[5];\r\n    const g = m[6], h = m[7], i = m[8];\r\n    const det = a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\r\n    return [\r\n        (e * i - f * h) / det, (c * h - b * i) / det, (b * f - c * e) / det,\r\n        (f * g - d * i) / det, (a * i - c * g) / det, (c * d - a * f) / det,\r\n        (d * h - e * g) / det, (b * g - a * h) / det, (a * e - b * d) / det,\r\n    ];\r\n}\r\n\r\nexport function multiply (a: TMat3x3, b: TMat3x3): TMat3x3 {\r\n    return [\r\n        a[0] * b[0] + a[1] * b[3] + a[2] * b[6],\r\n        a[0] * b[1] + a[1] * b[4] + a[2] * b[7],\r\n        a[0] * b[2] + a[1] * b[5] + a[2] * b[8],\r\n        a[3] * b[0] + a[4] * b[3] + a[5] * b[6],\r\n        a[3] * b[1] + a[4] * b[4] + a[5] * b[7],\r\n        a[3] * b[2] + a[4] * b[5] + a[5] * b[8],\r\n        a[6] * b[0] + a[7] * b[3] + a[8] * b[6],\r\n        a[6] * b[1] + a[7] * b[4] + a[8] * b[7],\r\n        a[6] * b[2] + a[7] * b[5] + a[8] * b[8],\r\n    ];\r\n}","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Unsharp Mask\r\n * @description    A form of image sharpening that amplifies high-frequencies in the image. It\r\n *                 is implemented by scaling pixels away from the average of their neighbors.\r\n * @param radius   The blur radius that calculates the average of the neighboring pixels.\r\n * @param strength A scale factor where 0 is no effect and higher values cause a stronger effect.\r\n */\r\nexport type TFilterUnsharpMask = (\r\n    this: TFxCanvas,\r\n    radius: number,\r\n    strength: number,\r\n) => TFxCanvas;\r\n\r\nexport const unsharpMask: TFilterUnsharpMask = function (radius, strength) {\r\n    gl.unsharpMask = gl.unsharpMask || new FxShader(null, '\\\r\n        uniform sampler2D blurredTexture;\\\r\n        uniform sampler2D originalTexture;\\\r\n        uniform float strength;\\\r\n        uniform float threshold;\\\r\n        varying vec2 texCoord;\\\r\n        void main() {\\\r\n            vec4 blurred = texture2D(blurredTexture, texCoord);\\\r\n            vec4 original = texture2D(originalTexture, texCoord);\\\r\n            gl_FragColor = mix(blurred, original, 1.0 + strength);\\\r\n        }\\\r\n    ', 'unsharpMask');\r\n\r\n    // Store a copy of the current texture in the second texture unit\r\n    this._.extraTexture.ensureFormatViaTexture(this._.texture);\r\n    this._.texture.use();\r\n    this._.extraTexture.drawTo(function () {\r\n        FxShader.getDefaultShader().drawRect();\r\n    });\r\n\r\n    // Blur the current texture, then use the stored texture to detect edges\r\n    this._.extraTexture.use(1);\r\n    this.triangleBlur(radius);\r\n    gl.unsharpMask.textures({\r\n        originalTexture: 1,\r\n    });\r\n    simpleShader.call(this, gl.unsharpMask, {\r\n        strength: strength,\r\n    });\r\n    this._.extraTexture.unuse(1);\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\nimport {IRGBA} from '../../klecks/kl-types';\r\n\r\n/**\r\n * To Alpha\r\n * @description   Generates alpha channel from luminance (r+g+b)\r\n * @param isInverted    boolean - invert luminance\r\n * @param replaceRGBA    rgba - color to replace rgb with. if a = 0 -> keep orig color\r\n */\r\nexport type TFilterToAlpha = (\r\n    this: TFxCanvas,\r\n    isInverted: boolean,\r\n    replaceRGBA: IRGBA,\r\n) => TFxCanvas;\r\n\r\nexport const toAlpha: TFilterToAlpha = function (isInverted, replaceRGBA) {\r\n    gl.toAlpha = gl.toAlpha || new FxShader(null, '\\\r\n    uniform bool isInverted;\\\r\n    uniform vec4 replace;\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        float alpha = (color.r + color.g + color.b) / 3.0;\\\r\n        if (isInverted) alpha = 1.0 - alpha;\\\r\n        alpha = min(color.a, alpha);\\\r\n        if (replace.a > 0.0) color = replace;\\\r\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha);\\\r\n    }\\\r\n', 'toAlpha');\r\n\r\n    simpleShader.call(this, gl.toAlpha, {\r\n        isInverted: isInverted ? 1 : 0,\r\n        replace: replaceRGBA ? [replaceRGBA.r / 255, replaceRGBA.g / 255, replaceRGBA.b / 255, replaceRGBA.a] : [0, 0, 0, 0],\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * Invert\r\n * @description   Inverts color of each pixel\r\n */\r\nexport type TFilterInvert = (\r\n    this: TFxCanvas,\r\n) => TFxCanvas;\r\n\r\nexport const invert: TFilterInvert = function () {\r\n    gl.invert = gl.invert || new FxShader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        color.rgb = 1.0 - color.rgb;\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'invert');\r\n\r\n    simpleShader.call(this, gl.invert, {\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {getInverse, getSquareToQuad, multiply} from '../math/matrix';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\nexport type TRectanglePoints = [\r\n    number, number, // point a\r\n    number, number, // point b\r\n    number, number, // point c\r\n    number, number, // point d\r\n];\r\n\r\n/**\r\n * Perspective\r\n * @description  Warps one quadrangle to another with a perspective transform. This can be used to\r\n *               make a 2D image look 3D or to recover a 2D image captured in a 3D environment.\r\n * @param before The x and y coordinates of four points before the transform in a flat list. This\r\n *               would look like [ax, ay, bx, by, cx, cy, dx, dy] for four points (ax, ay), (bx, by),\r\n *               (cx, cy), and (dx, dy).\r\n * @param after  The x and y coordinates of four points after the transform in a flat list, just\r\n *               like the other argument.\r\n */\r\nexport type TFilterPerspective = (\r\n    this: TFxCanvas,\r\n    before: TRectanglePoints,\r\n    after: TRectanglePoints,\r\n) => TFxCanvas;\r\n\r\nexport const perspective: TFilterPerspective = function (before, after) {\r\n    const a = getSquareToQuad(...after);\r\n    const b = getSquareToQuad(...before);\r\n    const c = multiply(getInverse(a), b);\r\n    return this.matrixWarp(c);\r\n};\r\n","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * unmultiplyAlpha\r\n * reverses alpha multiply\r\n */\r\nexport type TFilterUnmultiplyAlpha = (\r\n    this: TFxCanvas,\r\n) => TFxCanvas;\r\n\r\nexport const unmultiplyAlpha: TFilterUnmultiplyAlpha = function () {\r\n    gl.unmultiplyAlpha = gl.unmultiplyAlpha || new FxShader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        if(color.a > 0.0) {\\\r\n            color.rgb /= color.a;\\\r\n        }\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'unmultiplyAlpha');\r\n\r\n    simpleShader.call(this, gl.unmultiplyAlpha, {\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {gl} from '../core/gl';\r\nimport {warpShader} from '../shaders/warp-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n\r\nexport type TFilterDistortSettings = {\r\n    stepSize: number; // [1, inf]\r\n    distortType: 0 | 1 | 2;\r\n    scale: { x: number; y: number };\r\n    strength: { x: number; y: number };\r\n    phase: { x: number; y: number };\r\n};\r\n\r\n/**\r\n * Distort\r\n * Distorts image (moves pixels around)\r\n */\r\nexport type TFilterDistort = (\r\n    this: TFxCanvas,\r\n    settings: TFilterDistortSettings,\r\n) => TFxCanvas;\r\n\r\n/**\r\n * @filter        Distort\r\n * @description   Distorts image (moves pixels around)\r\n */\r\nexport const distort: TFilterDistort = function (settings) {\r\n    gl.distort = gl.distort || warpShader('\\\r\n        uniform float stepSize;\\\r\n        uniform vec2 scale;\\\r\n        uniform vec2 strength;\\\r\n        uniform vec2 phase;\\\r\n        uniform float type;\\\r\n        ', '\\\r\n        const float PI = 3.14159265;\\\r\n        float x = coord.x;\\\r\n        float y = coord.y;\\\r\n        if (stepSize > 1.0) {\\\r\n            x = floor(x / stepSize) * stepSize;\\\r\n            y = floor(y / stepSize) * stepSize;\\\r\n        }\\\r\n        float distortX = sin((x/scale.x + phase.x) * PI * 2.0) * strength.x;\\\r\n        float distortY = sin((y/scale.y + phase.y) * PI * 2.0) * strength.y;\\\r\n        if (type == 0.0) {\\\r\n            coord.y += distortX;\\\r\n            coord.x += distortY;\\\r\n        } else if (type == 1.0) {\\\r\n            coord.x += distortX;\\\r\n            coord.y += distortY;\\\r\n        } else if (type == 2.0) {\\\r\n            gl_FragColor = texture2D(texture, vec2(x, y) / texSize);\\\r\n            coord.y += sin(gl_FragColor.r/scale.x*200.0 + phase.x * PI * 2.0) * strength.x;\\\r\n            coord.x += cos(gl_FragColor.g/scale.y*200.0 + phase.y * PI * 2.0) * strength.y;\\\r\n        }\\\r\n        coord.x = mod(coord.x, texSize.x);\\\r\n        coord.y = mod(coord.y, texSize.y);\\\r\n        \\\r\n        ');\r\n\r\n    simpleShader.call(this, gl.distort, {\r\n        stepSize: settings.stepSize,\r\n        type: settings.distortType,\r\n        scale: [settings.scale.x, settings.scale.y],\r\n        strength: [settings.strength.x, settings.strength.y],\r\n        phase: [settings.phase.x, settings.phase.y],\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};\r\n\r\n","import {gl} from '../core/gl';\r\nimport {FxShader} from '../core/fx-shader';\r\nimport {simpleShader} from '../core/simple-shader';\r\nimport {TFxCanvas} from '../fx-canvas-types';\r\n\r\n/**\r\n * multiplyAlpha\r\n * applies alpha multiply\r\n */\r\nexport type TFilterMultiplyAlpha = (\r\n    this: TFxCanvas,\r\n) => TFxCanvas;\r\n\r\nexport const multiplyAlpha: TFilterMultiplyAlpha = function () {\r\n    gl.multiplyAlpha = gl.multiplyAlpha || new FxShader(null, '\\\r\n    uniform sampler2D texture;\\\r\n    uniform vec2 texSize;\\\r\n    varying vec2 texCoord;\\\r\n    \\\r\n    void main() {\\\r\n        vec4 color = texture2D(texture, texCoord);\\\r\n        color.rgb *= color.a;\\\r\n        gl_FragColor = color;\\\r\n    }\\\r\n', 'multiplyAlpha');\r\n\r\n    simpleShader.call(this, gl.multiplyAlpha, {\r\n        texSize: [this.width, this.height],\r\n    });\r\n\r\n    return this;\r\n};","import {BB} from '../../bb/bb';\r\nimport {input} from '../ui/components/input';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {Cropper} from '../ui/components/cropper';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IRGBA} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {theme} from '../../theme/theme';\r\n\r\nexport type TFilterCropExtendInput = {\r\n    left: number;\r\n    right: number;\r\n    top: number;\r\n    bottom: number;\r\n    fillColor?: IRGBA;\r\n};\r\n\r\nexport type TFilterCropExtendHistoryEntry = TFilterHistoryEntry<\r\n    'cropExtend',\r\n    TFilterCropExtendInput>;\r\n\r\nexport const filterCropExtend = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const klCanvas = params.klCanvas;\r\n        if (!klCanvas) {\r\n            return false;\r\n        }\r\n        const tempCanvas = BB.canvas();\r\n        {\r\n            const fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 560, 400, 1);\r\n            const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n            const previewFactor = w / klCanvas.getWidth();\r\n            tempCanvas.width = w;\r\n            tempCanvas.height = h;\r\n            tempCanvas.style.display = 'block';\r\n            BB.ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n        }\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterCropExtendInput> = {\r\n            element: div,\r\n        };\r\n        div.innerHTML = LANG('filter-crop-description') + '<br/><br/>';\r\n        let left = 0, right = 0, top = 0, bottom = 0;\r\n        let leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\r\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n        let scale;\r\n\r\n\r\n\r\n        // --- input elements ---\r\n\r\n        const lrWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'},\r\n        });\r\n        const tbWrapper = BB.el({\r\n            css: {lineHeight: '30px', height: '35px'},\r\n        });\r\n        div.append(lrWrapper, tbWrapper);\r\n\r\n        const leftInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                leftChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n        const rightInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getWidth(),\r\n            max: maxWidth,\r\n            css: {width: '75px'},\r\n            callback: function (v) {\r\n                rightChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n        const topInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                topChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n        const bottomInput = input({\r\n            init: 0,\r\n            type: 'number',\r\n            min: -klCanvas.getHeight(),\r\n            max: maxHeight,\r\n            css: {width: '75px'},\r\n            callback: function (v) {\r\n                bottomChanged = true;\r\n                updateInput();\r\n            },\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            width: '60px',\r\n        };\r\n        lrWrapper.append(\r\n            BB.el({content: LANG('filter-crop-left') + ':', css: labelStyle}),\r\n            leftInput,\r\n            BB.el({content: LANG('filter-crop-right') + ':', css: labelStyle}),\r\n            rightInput\r\n        );\r\n        tbWrapper.append(\r\n            BB.el({content: LANG('filter-crop-top') + ':', css: labelStyle}),\r\n            topInput,\r\n            BB.el({content: LANG('filter-crop-bottom') + ':', css: labelStyle}),\r\n            bottomInput\r\n        );\r\n\r\n        function updateInput (): void {\r\n            left = parseInt(leftInput.value);\r\n            right = parseInt(rightInput.value);\r\n            top = parseInt(topInput.value);\r\n            bottom = parseInt(bottomInput.value);\r\n            let newWidth = klCanvas.getWidth() + left + right;\r\n            let newHeight = klCanvas.getHeight() + top + bottom;\r\n\r\n            if (newWidth <= 0) {\r\n                if (leftChanged) {\r\n                    left = -klCanvas.getWidth() - right + 1;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -klCanvas.getWidth() - left + 1;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = 1;\r\n            }\r\n            if (newWidth > maxWidth) {\r\n                if (leftChanged) {\r\n                    left = -klCanvas.getWidth() - right + maxWidth;\r\n                    leftInput.value = '' + left;\r\n                }\r\n                if (rightChanged) {\r\n                    right = -klCanvas.getWidth() - left + maxWidth;\r\n                    rightInput.value = '' + right;\r\n                }\r\n                newWidth = maxWidth;\r\n            }\r\n            if (newHeight <= 0) {\r\n                if (topChanged) {\r\n                    top = -klCanvas.getHeight() - bottom + 1;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -klCanvas.getHeight() - top + 1;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = 1;\r\n            }\r\n            if (newHeight > maxHeight) {\r\n                if (topChanged) {\r\n                    top = -klCanvas.getHeight() - bottom + maxHeight;\r\n                    topInput.value = '' + top;\r\n                }\r\n                if (bottomChanged) {\r\n                    bottom = -klCanvas.getHeight() - top + maxHeight;\r\n                    bottomInput.value = '' + bottom;\r\n                }\r\n                newHeight = maxHeight;\r\n            }\r\n            cropper.setTransform({\r\n                x: -left,\r\n                y: -top,\r\n                width: newWidth,\r\n                height: newHeight,\r\n            });\r\n\r\n\r\n            leftChanged = false;\r\n            rightChanged = false;\r\n            topChanged = false;\r\n            bottomChanged = false;\r\n        }\r\n\r\n        let useRuleOfThirds = true;\r\n        const ruleOThirdsCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-crop-rule-thirds'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                useRuleOfThirds = b;\r\n                cropper.showThirds(useRuleOfThirds);\r\n            },\r\n        });\r\n        div.append(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n            },\r\n        }));\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 0};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 0},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('filter-crop-fill'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function (rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                updateBg();\r\n            },\r\n        });\r\n\r\n\r\n        const flexRow = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n        div.append(flexRow);\r\n        flexRow.append(ruleOThirdsCheckbox.getElement(), colorOptions.getElement());\r\n\r\n\r\n        // when input field changed, or dragging in preview finished\r\n        // adjusts the zoom\r\n        function update (transform): void {\r\n            const fit = BB.fitInto(transform.width, transform.height, 260, 180, 1);\r\n            scale = fit.width / transform.width;\r\n\r\n            const offset = BB.centerWithin(340, previewHeight, fit.width, fit.height);\r\n\r\n            tempCanvas.style.width = klCanvas.getWidth() * scale + 'px';\r\n            tempCanvas.style.height = klCanvas.getHeight() * scale + 'px';\r\n\r\n            offsetWrapper.style.left = (offset.x - transform.x * scale) + 'px';\r\n            offsetWrapper.style.top = (offset.y - transform.y * scale) + 'px';\r\n\r\n            left = parseInt('' + -transform.x);\r\n            top = parseInt('' + -transform.y);\r\n            right = parseInt('' + (transform.x + transform.width - klCanvas.getWidth()));\r\n            bottom = parseInt('' + (transform.y + transform.height - klCanvas.getHeight()));\r\n            leftInput.value = '' + left;\r\n            topInput.value = '' + top;\r\n            rightInput.value = '' + right;\r\n            bottomInput.value = '' + bottom;\r\n\r\n            BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                previewWrapper.style.background = 'url(' + url + ')';\r\n                if (selectedRgbaObj.a !== 0) {\r\n                    tempCanvas.style.background = 'url(' + url + ')';\r\n                }\r\n            }, theme.isDark());\r\n            previewWrapper.style.backgroundPosition = (offset.x) + 'px ' + (offset.y) + 'px';\r\n\r\n            cropper.setScale(scale);\r\n        }\r\n\r\n        const previewHeight = 218; // two less because of border\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-edit-crop-preview',\r\n            css: {\r\n                width: '340px',\r\n                marginTop: '10px',\r\n                marginLeft: '-20px',\r\n                height: previewHeight + 'px',\r\n                backgroundColor: '#9e9e9e',\r\n                position: 'relative',\r\n                borderTop: '1px solid rgb(144,144,144)',\r\n                borderBottom: '1px solid rgb(144,144,144)',\r\n                overflow: 'hidden',\r\n                userSelect: 'none',\r\n                touchAction: 'none',\r\n            },\r\n        });\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        const bgColorOverlay = BB.el({\r\n            css: {\r\n                position: 'absolute',\r\n                left: '0',\r\n                top: '0',\r\n                bottom: '0',\r\n                right: '0',\r\n            },\r\n        });\r\n        previewWrapper.append(bgColorOverlay);\r\n\r\n        const offsetWrapper = document.createElement('div');\r\n        offsetWrapper.style.position = 'absolute';\r\n        offsetWrapper.style.left = '0px';\r\n        offsetWrapper.style.top = '0px';\r\n        previewWrapper.append(offsetWrapper);\r\n\r\n        const canvasWrapper = BB.el({\r\n            parent: offsetWrapper,\r\n            content: tempCanvas,\r\n            css: {\r\n                boxShadow: '0 0 0px 1px rgb(130,130,130)',\r\n                position: 'absolute',\r\n                left: '0px',\r\n                top: '0px',\r\n            },\r\n        });\r\n\r\n\r\n        div.append(previewWrapper);\r\n        const cropper = new Cropper({\r\n            x: 0,\r\n            y: 0,\r\n            width: klCanvas.getWidth(),\r\n            height: klCanvas.getHeight(),\r\n            scale: scale,\r\n            callback: update,\r\n            maxW: maxWidth,\r\n            maxH: maxHeight,\r\n        });\r\n        update(cropper.getTransform());\r\n        offsetWrapper.append(cropper.getElement());\r\n\r\n        function updateBg (): void {\r\n            if (selectedRgbaObj.a === 0) {\r\n                bgColorOverlay.style.background = '';\r\n                tempCanvas.style.background = '';\r\n            } else {\r\n                bgColorOverlay.style.background = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n\r\n                BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\r\n                    tempCanvas.style.background = 'url(' + url + ')';\r\n                }, theme.isDark());\r\n            }\r\n        }\r\n\r\n        function updateIsDark (): void {\r\n            updateInput();\r\n        }\r\n        theme.addIsDarkListener(updateIsDark);\r\n\r\n        result.destroy = (): void => {\r\n            cropper.destroy();\r\n            ruleOThirdsCheckbox.destroy();\r\n            theme.removeIsDarkListener(updateIsDark);\r\n            colorOptions.destroy();\r\n        };\r\n        result.getInput = function (): TFilterCropExtendInput {\r\n            result.destroy();\r\n            return {\r\n                left: left,\r\n                right: right,\r\n                top: top,\r\n                bottom: bottom,\r\n                fillColor: selectedRgbaObj.a === 0 ? undefined : selectedRgbaObj,\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterCropExtendInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (\r\n            !klCanvas ||\r\n            !history ||\r\n            isNaN(params.input.left) ||\r\n            isNaN(params.input.right) ||\r\n            isNaN(params.input.top) ||\r\n            isNaN(params.input.bottom)\r\n        ) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.resizeCanvas(params.input);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'cropExtend'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: BB.copyObj(params.input),\r\n            }],\r\n        } as TFilterCropExtendHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {CurvesInput, getDefaultCurvesInput, TCurvesInput} from './filter-curves/curves-input';\r\nimport {Options} from '../ui/components/options';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterCurvesInput = {\r\n    curves: TCurvesInput;\r\n};\r\n\r\nexport type TFilterCurvesHistoryEntry = TFilterHistoryEntry<\r\n    'curves',\r\n    TFilterCurvesInput>;\r\n\r\nexport const filterCurves = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        const div = BB.el();\r\n        const result: IFilterGetDialogResult<TFilterCurvesInput> = {\r\n            element: div,\r\n        };\r\n        let klCanvasPreview: KlCanvasPreview;\r\n\r\n        function finishInit (): void {\r\n\r\n            div.innerHTML = LANG('filter-curves-description') + '<br/><br/>';\r\n\r\n            let curves: TCurvesInput = getDefaultCurvesInput();\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            function update (): void {\r\n                try {\r\n                    fxCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n                    if (klCanvasPreview) {\r\n                        klCanvasPreview.render();\r\n                    }\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            const input = new CurvesInput({\r\n                curves,\r\n                callback: function (val) {\r\n                    curves = val;\r\n                    update();\r\n                },\r\n            });\r\n            const modeButtons: Options<string> = input.getModeButtons();\r\n\r\n\r\n            div.append(input.getElement());\r\n\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            result.destroy = (): void => {\r\n                input.destroy();\r\n                texture.destroy();\r\n                modeButtons.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterCurvesInput {\r\n                result.destroy();\r\n                return {\r\n                    curves: curves,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterCurvesInput>): boolean {\r\n        const context = params.context;\r\n        const curves = params.input.curves;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'curves'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterCurvesHistoryEntry);\r\n\r\n        return true;\r\n    },\r\n\r\n\r\n};","import {Options} from '../../ui/components/options';\r\nimport {LANG} from '../../../language/language';\r\nimport {BB} from '../../../bb/bb';\r\nimport {IVector2D} from '../../../bb/bb-types';\r\nimport {PointerListener} from '../../../bb/input/pointer-listener';\r\n\r\ntype TCurvePoint = {\r\n    el: HTMLElement;\r\n    pointerListener: PointerListener;\r\n    setPos: (newX: number, newY: number) => void;\r\n};\r\n\r\nexport type TCurvesInput = {\r\n    r: [number, number][];\r\n    g: [number, number][];\r\n    b: [number, number][];\r\n}\r\n\r\nexport function getDefaultCurvesInput (): TCurvesInput {\r\n    return BB.copyObj({\r\n        r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n        g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n        b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\r\n    });\r\n}\r\n\r\nexport class CurvesInput {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly p0: TCurvePoint;\r\n    private readonly p1: TCurvePoint;\r\n    private readonly p2: TCurvePoint;\r\n    private readonly p3: TCurvePoint;\r\n    private readonly modeButtons: Options<string>;\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        p: {\r\n            curves: TCurvesInput;\r\n            callback: (val: TCurvesInput) => void;\r\n        },\r\n    ) {\r\n        this.rootEl = BB.el({\r\n            css: {\r\n                position: 'relative',\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        this.rootEl.oncontextmenu = () => false;\r\n        let mode = 'All';\r\n        let curves = p.curves;\r\n        this.modeButtons = new Options( {\r\n            optionArr: [\r\n                {\r\n                    id: 'All',\r\n                    label: LANG('filter-curves-all'),\r\n                },\r\n                {\r\n                    id: 'Red',\r\n                    label: LANG('red'),\r\n                },\r\n                {\r\n                    id: 'Green',\r\n                    label: LANG('green'),\r\n                },\r\n                {\r\n                    id: 'Blue',\r\n                    label: LANG('blue'),\r\n                },\r\n            ],\r\n            initId: 'All',\r\n            onChange: (id) => {\r\n                mode = id;\r\n                if (mode === 'All') {\r\n                    curves = getDefaultCurvesInput();\r\n                }\r\n                let curve = curves.r;\r\n                if (mode === 'Green') {\r\n                    curve = curves.g;\r\n                }\r\n                if (mode === 'Blue') {\r\n                    curve = curves.b;\r\n                }\r\n                this.p0.setPos(0, areaH - curve[0][1] * areaH);\r\n                this.p1.setPos(curve[1][0] * areaW, areaH - curve[1][1] * areaH);\r\n                this.p2.setPos(curve[2][0] * areaW, areaH - curve[2][1] * areaH);\r\n                this.p3.setPos(areaW, areaH - curve[3][1] * areaH);\r\n\r\n                update();\r\n            },\r\n        });\r\n        this.rootEl.append(this.modeButtons.getElement());\r\n\r\n        const curveArea = BB.el({\r\n            parent: this.rootEl,\r\n            className: 'kl-curves-graph',\r\n            css: {\r\n                position: 'relative',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n\r\n        const areaW = 300, areaH = 100;\r\n        const canvas = BB.canvas(areaW, areaH);\r\n        let ctx = BB.ctx(canvas);\r\n        curveArea.append(canvas);\r\n\r\n        const fit = (v: number): number => {\r\n            return Math.max(0, Math.min(1, v));\r\n        };\r\n\r\n        const createPoint = (\r\n            x: number,\r\n            y: number,\r\n            callback: (p: IVector2D) => void,\r\n            lock?: boolean,\r\n        ): TCurvePoint => {\r\n            const gripSize = 14;\r\n            let internalY = y, internalX = x;\r\n            const pointEl = BB.el({\r\n                className: 'kl-curves-graph__grip',\r\n                css: {\r\n                    left: (x - gripSize / 2) + 'px',\r\n                    top: (y - gripSize / 2) + 'px',\r\n                    width: gripSize + 'px',\r\n                    height: gripSize + 'px',\r\n                    borderRadius: gripSize + 'px',\r\n                },\r\n            });\r\n\r\n            const update = () => {\r\n                BB.css(pointEl, {\r\n                    left: (x - gripSize / 2) + 'px',\r\n                    top: (y - gripSize / 2) + 'px',\r\n                });\r\n            };\r\n\r\n            const pointerListener = new BB.PointerListener({\r\n                target: pointEl,\r\n                onPointer: (event) => {\r\n                    event.eventPreventDefault();\r\n                    if (event.type === 'pointerdown') {\r\n                        internalX = x;\r\n                        internalY = y;\r\n                    }\r\n                    if (event.button === 'left' && event.type === 'pointermove') {\r\n                        if (!lock) {\r\n                            internalX += event.dX;\r\n                        }\r\n                        x = Math.max(0, Math.min(areaW, internalX));\r\n                        internalY += event.dY;\r\n                        y = Math.max(0, Math.min(areaH, internalY));\r\n                        update();\r\n                        callback({\r\n                            x: x,\r\n                            y: y,\r\n                        });\r\n                    }\r\n                },\r\n            });\r\n\r\n            curveArea.append(pointEl);\r\n\r\n            const setPos = (newX: number, newY: number): void => {\r\n                x = newX;\r\n                y = newY;\r\n                internalY = y;\r\n                internalX = x;\r\n                BB.css(pointEl, {\r\n                    left: (x - gripSize / 2) + 'px',\r\n                    top: (y - gripSize / 2) + 'px',\r\n                });\r\n            };\r\n\r\n            return {\r\n                el: pointEl,\r\n                setPos,\r\n                pointerListener,\r\n            };\r\n        };\r\n\r\n        const updateControl = (i: number, x: number, y: number) => {\r\n            if (mode === 'All') {\r\n                curves.r[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n                curves.g[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n                curves.b[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n            if (mode === 'Red') {\r\n                curves.r[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n            if (mode === 'Green') {\r\n                curves.g[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n            if (mode === 'Blue') {\r\n                curves.b[i] = [fit(x / areaW), fit(1 - y / areaH)];\r\n            }\r\n        };\r\n\r\n        this.p0 = createPoint(0, areaH, (val: IVector2D) => {\r\n            updateControl(0, val.x, val.y);\r\n            update();\r\n        }, true);\r\n        this.p1 = createPoint(areaW / 3, areaH / 3 * 2, (val: IVector2D) => {\r\n            updateControl(1, val.x, val.y);\r\n            update();\r\n        });\r\n        this.p2 = createPoint(areaW / 3 * 2, areaH / 3, (val: IVector2D) => {\r\n            updateControl(2, val.x, val.y);\r\n            update();\r\n        });\r\n        this.p3 = createPoint(areaW, 0, (val: IVector2D) => {\r\n            updateControl(3, val.x, val.y);\r\n            update();\r\n        }, true);\r\n\r\n\r\n        const update = () => {\r\n            ctx = BB.ctx(canvas);\r\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n            const outCurves: TCurvesInput = {\r\n                r: [],\r\n                g: [],\r\n                b: [],\r\n            };\r\n            for (let i = 0; i < curves.r.length; i++) {\r\n                outCurves.r.push(curves.r[i]);\r\n                outCurves.g.push(curves.g[i]);\r\n                outCurves.b.push(curves.b[i]);\r\n            }\r\n\r\n            const drawCurve = (curve: [number, number][]) => {\r\n                ctx.beginPath();\r\n                const spline = new BB.SplineInterpolator(curve);\r\n                for (let i = 0; i < 100; i++) {\r\n                    let y = spline.interpolate(i / 100);\r\n                    y = Math.max(0, Math.min(1, y));\r\n\r\n                    if (i === 0) {\r\n                        ctx.moveTo(i / 100 * areaW, areaH - y * areaH);\r\n                    } else {\r\n                        ctx.lineTo(i / 100 * areaW, areaH - y * areaH);\r\n                    }\r\n                }\r\n                ctx.stroke();\r\n            };\r\n\r\n            ctx.save();\r\n            if (mode === 'All') {\r\n                ctx.strokeStyle = 'black';\r\n                drawCurve(outCurves.r);\r\n            } else {\r\n                ctx.globalAlpha = 0.5;\r\n                ctx.strokeStyle = 'red';\r\n                drawCurve(outCurves.r);\r\n                ctx.strokeStyle = 'green';\r\n                drawCurve(outCurves.g);\r\n                ctx.strokeStyle = 'blue';\r\n                drawCurve(outCurves.b);\r\n            }\r\n            ctx.restore();\r\n            p.callback(outCurves);\r\n        };\r\n\r\n        update();\r\n    }\r\n\r\n    // ---- interface ----\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n\r\n    destroy (): void {\r\n        this.p0.pointerListener.destroy();\r\n        this.p1.pointerListener.destroy();\r\n        this.p2.pointerListener.destroy();\r\n        this.p3.pointerListener.destroy();\r\n    }\r\n\r\n    getModeButtons (): Options<string> {\r\n        return this.modeButtons;\r\n    }\r\n}\r\n","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {throwIfNull} from '../../bb/base/base';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {Options} from '../ui/components/options';\r\n\r\nexport type TFilterFlipInput = {\r\n    horizontal: boolean;\r\n    vertical: boolean;\r\n    flipCanvas: boolean;\r\n};\r\n\r\nexport type TFilterFlipHistoryEntry = TFilterHistoryEntry<\r\n    'flip',\r\n    TFilterFlipInput>;\r\n\r\nexport const filterFlip = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterFlipInput> = {\r\n            element: div,\r\n        };\r\n        let isHorizontal = true;\r\n        let isVertical = false;\r\n        let doFlipCanvas = true;\r\n        div.innerHTML = LANG('filter-flip-description') + '<br/><br/>';\r\n\r\n\r\n        const horizontalCheckbox = new Checkbox({\r\n            init: isHorizontal,\r\n            label: LANG('filter-flip-horizontal') + ' ',\r\n            allowTab: true,\r\n            callback: function (v) {\r\n                isHorizontal = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        const verticalCheckbox = new Checkbox({\r\n            init: isVertical,\r\n            label: LANG('filter-flip-vertical') + ' ',\r\n            allowTab: true,\r\n            callback: function (v) {\r\n                isVertical = v;\r\n                updatePreview();\r\n            },\r\n            css: {\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n        div.append(horizontalCheckbox.getElement());\r\n        div.append(verticalCheckbox.getElement());\r\n\r\n        const targetOptions = new Options<boolean>({\r\n            optionArr: [\r\n                {\r\n                    id: true,\r\n                    label: LANG('filter-flip-image'),\r\n                },\r\n                {\r\n                    id: false,\r\n                    label: LANG('filter-flip-layer'),\r\n                },\r\n            ],\r\n            onChange: (val) => {\r\n                doFlipCanvas = val;\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        div.append(targetOptions.getElement());\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(Math.round(w), Math.round(h)),\r\n            opacity: 1,\r\n            mixModeStr: 'source-over' as TMixMode,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: [previewLayer],\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\r\n\r\n            if (doFlipCanvas) {\r\n                if (isHorizontal) {\r\n                    ctx.translate(previewLayer.image.width, 0);\r\n                    ctx.scale(-1, 1);\r\n                }\r\n                if (isVertical) {\r\n                    ctx.translate(0, previewLayer.image.height);\r\n                    ctx.scale(1, -1);\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < layers.length; i++) {\r\n                ctx.save();\r\n                if (!doFlipCanvas && selectedLayerIndex === i) {\r\n                    if (isHorizontal) {\r\n                        ctx.translate(previewLayer.image.width, 0);\r\n                        ctx.scale(-1, 1);\r\n                    }\r\n                    if (isVertical) {\r\n                        ctx.translate(0, previewLayer.image.height);\r\n                        ctx.scale(1, -1);\r\n                    }\r\n                }\r\n                if (ctx.canvas.width > layers[i].context.canvas.width) {\r\n                    ctx.imageSmoothingEnabled = false;\r\n                }\r\n                ctx.globalAlpha = layers[i].opacity;\r\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\r\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\r\n                ctx.restore();\r\n            }\r\n            klCanvasPreview.render();\r\n            ctx.restore();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            horizontalCheckbox.destroy();\r\n            verticalCheckbox.destroy();\r\n            targetOptions.destroy();\r\n            klCanvasPreview.destroy();\r\n        };\r\n        result.getInput = function (): TFilterFlipInput {\r\n            result.destroy();\r\n            return {\r\n                horizontal: isHorizontal,\r\n                vertical: isVertical,\r\n                flipCanvas: doFlipCanvas,\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterFlipInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        const horizontal = params.input.horizontal;\r\n        const vertical = params.input.vertical;\r\n        const flipCanvas = params.input.flipCanvas;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        klCanvas.flip(\r\n            horizontal,\r\n            vertical,\r\n            flipCanvas ? undefined : throwIfNull(klCanvas.getLayerIndex(context.canvas)),\r\n        );\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['filter', 'flip'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterFlipHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterHueSaturationInput = {\r\n    hue: number;\r\n    saturation: number;\r\n};\r\n\r\nexport type TFilterHueSaturationHistoryEntry = TFilterHistoryEntry<\r\n    'hueSaturation',\r\n    TFilterHueSaturationInput>;\r\n\r\nexport const filterHueSaturation = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height,280, 200,  1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterHueSaturationInput> = {\r\n            element: div,\r\n        };\r\n\r\n        function finishInit (): void {\r\n            let hue = 0, saturation = 0;\r\n            div.innerHTML = LANG('filter-hue-sat-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const hueSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-hue'),\r\n                width: 300,\r\n                height: 30,\r\n                min: -100,\r\n                max: 100,\r\n                value: hue * 100,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    hue = val / 100;\r\n                    fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            const saturationSlider = new KlSlider({\r\n                label: LANG('filter-hue-sat-saturation'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 100,\r\n                value: (saturation + 1) * 50,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    saturation = val / 50 - 1;\r\n                    fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            hueSlider.getElement().style.marginBottom = '10px';\r\n            div.append(hueSlider.getElement(), saturationSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = (): void => {\r\n                hueSlider.destroy();\r\n                saturationSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterHueSaturationInput {\r\n                result.destroy();\r\n                return {\r\n                    hue: hue,\r\n                    saturation: saturation,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterHueSaturationInput>): boolean {\r\n        const context = params.context;\r\n        const hue = params.input.hue;\r\n        const history = params.history;\r\n        const saturation = params.input.saturation;\r\n        if (!context || hue === null || saturation === null || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'hueSaturation'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterHueSaturationHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply} from '../kl-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterInvertInput = null;\r\n\r\nexport type TFilterInvertHistoryEntry = TFilterHistoryEntry<\r\n    'invert',\r\n    TFilterInvertInput>;\r\n\r\nexport const filterInvert = {\r\n\r\n    apply (params: IFilterApply<TFilterInvertInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false;\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).invert().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'invert'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterInvertHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TwoTabs} from '../ui/components/two-tabs';\r\nimport {TRectanglePoints} from '../../fx-canvas/filters/perspective';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterPerspectiveInput = {\r\n    before: TRectanglePoints;\r\n    after: TRectanglePoints;\r\n};\r\n\r\nexport type TFilterPerspectiveHistoryEntry = TFilterHistoryEntry<\r\n    'perspective',\r\n    TFilterPerspectiveInput>;\r\n\r\nexport const filterPerspective = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterPerspectiveInput> = {\r\n            element: div,\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n\r\n        const pointerListenerArr = [];\r\n\r\n        function finishInit (): void {\r\n            div.innerHTML = LANG('filter-perspective-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n            let ba, bb, bc, bd; //before\r\n            let aa, ab, ac, ad; //after\r\n            function update (): void {\r\n                try {\r\n                    fxCanvas.draw(texture).multiplyAlpha().perspective(\r\n                        [ba.x, ba.y, bb.x, bb.y, bc.x, bc.y, bd.x, bd.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        }),\r\n                        [aa.x, aa.y, ab.x, ab.y, ac.x, ac.y, ad.x, ad.y].map((item, i) => {\r\n                            if (i % 2 === 0) {\r\n                                return item / displayW * w;\r\n                            } else {\r\n                                return item / displayH * h;\r\n                            }\r\n                        })\r\n                    ).unmultiplyAlpha().update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob (x, y, callback?) {\r\n                const nobSize = 14;\r\n                const div = document.createElement('div');\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                BB.css(div, {\r\n                    width: nobSize + 'px',\r\n                    height: nobSize + 'px',\r\n                    backgroundColor: '#fff',\r\n                    boxShadow: 'inset 0 0 0 2px #000',\r\n                    borderRadius: nobSize + 'px',\r\n                    position: 'absolute',\r\n                    cursor: 'move',\r\n                    left: ((div as any).x - nobSize / 2) + 'px',\r\n                    top: ((div as any).y - nobSize / 2) + 'px',\r\n                    userSelect: 'none',\r\n                    touchAction: 'none',\r\n                });\r\n\r\n                const pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    onPointer: function (event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + 'px';\r\n                            div.style.top = ((div as any).y - nobSize / 2) + 'px';\r\n                            if (callback) {\r\n                                callback();\r\n                            }\r\n                            update();\r\n                        }\r\n                    },\r\n                });\r\n                (div as any).copy = function (p) {\r\n                    (div as any).x = p.x;\r\n                    (div as any).y = p.y;\r\n                    div.style.left = ((div as any).x - nobSize / 2) + 'px';\r\n                    div.style.top = ((div as any).y - nobSize / 2) + 'px';\r\n                };\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            function updateAfter () {\r\n                aa.copy(ba);\r\n                ab.copy(bb);\r\n                ac.copy(bc);\r\n                ad.copy(bd);\r\n            }\r\n\r\n            ba = nob(0, 0, updateAfter);\r\n            bb = nob(displayW, 0, updateAfter);\r\n            bc = nob(displayW, displayH, updateAfter);\r\n            bd = nob(0, displayH, updateAfter);\r\n            aa = nob(0, 0);\r\n            ab = nob(displayW, 0);\r\n            ac = nob(displayW, displayH);\r\n            ad = nob(0, displayH);\r\n\r\n            let before = false;\r\n\r\n            const beforeAfterTabs = new TwoTabs({\r\n                left: LANG('compare-before'),\r\n                right: LANG('compare-after'),\r\n                init: 1,\r\n                onChange: (val: number) => {\r\n                    before = val === 0;\r\n                    if (before) {\r\n                        aa.style.display = 'none';\r\n                        ab.style.display = 'none';\r\n                        ac.style.display = 'none';\r\n                        ad.style.display = 'none';\r\n\r\n                        ba.style.display = 'block';\r\n                        bb.style.display = 'block';\r\n                        bc.style.display = 'block';\r\n                        bd.style.display = 'block';\r\n                        ba.copy(aa);\r\n                        bb.copy(ab);\r\n                        bc.copy(ac);\r\n                        bd.copy(ad);\r\n                    } else {\r\n                        ba.style.display = 'none';\r\n                        bb.style.display = 'none';\r\n                        bc.style.display = 'none';\r\n                        bd.style.display = 'none';\r\n\r\n                        aa.style.display = 'block';\r\n                        ab.style.display = 'block';\r\n                        ac.style.display = 'block';\r\n                        ad.style.display = 'block';\r\n                        aa.copy(ba);\r\n                        ab.copy(bb);\r\n                        ac.copy(bc);\r\n                        ad.copy(bd);\r\n                    }\r\n                    update();\r\n                },\r\n            });\r\n            div.append(beforeAfterTabs.getElement());\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: isSmall ? '340px' : '540px',\r\n                    height: isSmall ? '260px' : '300px',\r\n                    marginTop: '0',\r\n                },\r\n            });\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    const canvas = i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas;\r\n                    previewLayerArr.push({\r\n                        image: canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.append(aa, ab, ac, ad);\r\n\r\n            ba.style.display = 'none';\r\n            bb.style.display = 'none';\r\n            bc.style.display = 'none';\r\n            bd.style.display = 'none';\r\n            previewInnerWrapper.append(ba, bb, bc, bd);\r\n\r\n\r\n            div.append(previewWrapper);\r\n            update();\r\n            result.destroy = (): void => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterPerspectiveInput {\r\n                result.destroy();\r\n                return {\r\n                    before: [\r\n                        ba.x / displayPreviewFactor,\r\n                        ba.y / displayPreviewFactor,\r\n\r\n                        bb.x / displayPreviewFactor,\r\n                        bb.y / displayPreviewFactor,\r\n\r\n                        bc.x / displayPreviewFactor,\r\n                        bc.y / displayPreviewFactor,\r\n\r\n                        bd.x / displayPreviewFactor,\r\n                        bd.y / displayPreviewFactor,\r\n                    ],\r\n                    after: [\r\n                        aa.x / displayPreviewFactor,\r\n                        aa.y / displayPreviewFactor,\r\n\r\n                        ab.x / displayPreviewFactor,\r\n                        ab.y / displayPreviewFactor,\r\n\r\n                        ac.x / displayPreviewFactor,\r\n                        ac.y / displayPreviewFactor,\r\n\r\n                        ad.x / displayPreviewFactor,\r\n                        ad.y / displayPreviewFactor,\r\n                    ],\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterPerspectiveInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const before = params.input.before;\r\n        const after = params.input.after;\r\n        if (!context || !before || !after || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).multiplyAlpha().perspective(before, after).unmultiplyAlpha().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'perspective'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterPerspectiveHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../../bb/bb';\r\n\r\n/**\r\n * Two buttons next to each other, each representing a tab. one at a time can be active.\r\n */\r\nexport class TwoTabs {\r\n\r\n    private readonly rootEl: HTMLElement;\r\n    private readonly leftTab: HTMLElement;\r\n    private readonly rightTab: HTMLElement;\r\n    private value: number;\r\n\r\n    private update (): void {\r\n        this.leftTab.classList.toggle('kl-2-tabs--active', this.value === 0);\r\n        this.rightTab.classList.toggle('kl-2-tabs--active', this.value === 1);\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (params: {\r\n        left: string;\r\n        right: string;\r\n        init: number; //0, 1\r\n        onChange: (val: number) => void;\r\n    }) {\r\n        this.value = params.init;\r\n\r\n        this.rootEl = BB.el({\r\n            className: 'kl-2-tabs',\r\n        });\r\n\r\n        this.leftTab = BB.el({\r\n            parent: this.rootEl,\r\n            content: params.left,\r\n            className: 'kl-2-tabs__left',\r\n        });\r\n        this.leftTab.onpointerdown = () => false;\r\n\r\n        this.rightTab = BB.el({\r\n            parent: this.rootEl,\r\n            content: params.right,\r\n            className: 'kl-2-tabs__right',\r\n        });\r\n        this.rightTab.onpointerdown = () => false;\r\n\r\n        this.update();\r\n\r\n        this.leftTab.onclick = () => {\r\n            if (this.value === 0) {\r\n                return;\r\n            }\r\n            this.value = 0;\r\n            this.update();\r\n            params.onChange(this.value);\r\n        };\r\n\r\n        this.rightTab.onclick = () => {\r\n            if (this.value === 1) {\r\n                return;\r\n            }\r\n            this.value = 1;\r\n            this.update();\r\n            params.onChange(this.value);\r\n        };\r\n    }\r\n\r\n    getElement (): HTMLElement {\r\n        return this.rootEl;\r\n    }\r\n}","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {Select} from '../ui/components/select';\r\nimport constrainImg from '/src/app/img/ui/constrain.svg';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {table} from '../ui/components/table';\r\nimport {theme} from '../../theme/theme';\r\n\r\nexport type TFilterResizeInput = {\r\n    width: number;\r\n    height: number;\r\n    algorithm: 'smooth' | 'pixelated';\r\n};\r\n\r\nexport type TFilterResizeHistoryEntry = TFilterHistoryEntry<\r\n    'resize',\r\n    TFilterResizeInput>;\r\n\r\nexport const filterResize = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        //BB.centerWithin\r\n        const klCanvas = params.klCanvas;\r\n        if (!klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const fit = BB.fitInto( klCanvas.getWidth(), klCanvas.getHeight(), 280, 200,1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        let previewFactor = w / klCanvas.getWidth();\r\n        const tempCanvas = klCanvas.getCompleteCanvas(1);\r\n\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterResizeInput> = {\r\n            element: div,\r\n        };\r\n        let newWidth = klCanvas.getWidth(), newHeight = klCanvas.getHeight();\r\n\r\n        div.innerHTML = LANG('filter-resize-description') + '<br/><br/>';\r\n\r\n\r\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\r\n\r\n        const widthWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            },\r\n        });\r\n        const heightWrapper = BB.el({\r\n            css: {\r\n                width: '150px',\r\n                height: '35px',\r\n                lineHeight: '30px',\r\n            },\r\n        });\r\n        const widthInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxWidth,\r\n                value: '' + klCanvas.getWidth(),\r\n            },\r\n        }) as HTMLInputElement;\r\n        const heightInput = BB.el({\r\n            tagName: 'input',\r\n            css: {\r\n                cssFloat: 'right',\r\n                width: '90px',\r\n            },\r\n            custom: {\r\n                type: 'number',\r\n                min: '1',\r\n                max: '' + maxHeight,\r\n                value: '' + klCanvas.getHeight(),\r\n            },\r\n        }) as HTMLInputElement;\r\n        widthInput.onclick = function () {\r\n            (this as any).focus();\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onclick = function () {\r\n            (this as any).focus();\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthInput.onchange = function () {\r\n            widthChanged = true;\r\n            update();\r\n        };\r\n        heightInput.onchange = function () {\r\n            heightChanged = true;\r\n            update();\r\n        };\r\n        widthWrapper.append(LANG('width') + ': ', widthInput);\r\n        heightWrapper.append(LANG('height') + ': ', heightInput);\r\n        const inputWrapper = BB.el({\r\n            css: {\r\n                background: 'url(' + constrainImg + ') no-repeat 140px 5px',\r\n                backgroundSize: '50px 52px',\r\n            },\r\n        });\r\n        inputWrapper.append(widthWrapper, heightWrapper);\r\n        const constrainIm = new Image();\r\n        constrainIm.src = constrainImg;\r\n        constrainIm.height = 40;\r\n\r\n        const sizeTable = table([\r\n            [\r\n                LANG('width') + ':&nbsp;',\r\n                widthInput,\r\n                constrainIm,\r\n            ],\r\n            [\r\n                BB.el({css: {height: '5px'}}),\r\n                '',\r\n                '',\r\n            ],\r\n            [\r\n                LANG('height') + ':&nbsp;',\r\n                heightInput,\r\n            ],\r\n        ], {\r\n            '0.2': {rowspan: 3},\r\n        });\r\n        BB.css(sizeTable, {\r\n            marginBottom: '10px',\r\n        });\r\n\r\n        div.append(sizeTable);\r\n\r\n        //contrain checkbox\r\n        let heightChanged = false, widthChanged = false;\r\n        const ratio = klCanvas.getWidth() / klCanvas.getHeight();\r\n\r\n        function updateConstrain (): void {\r\n            constrainIm.style.display = isConstrained ? '' : 'none';\r\n            if (isConstrained) {\r\n                widthInput.value = '' + klCanvas.getWidth();\r\n                heightInput.value = '' + klCanvas.getHeight();\r\n                update();\r\n            }\r\n        }\r\n\r\n        let isConstrained = true;\r\n        const constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                isConstrained = b;\r\n                updateConstrain();\r\n            },\r\n        });\r\n        div.append(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n            },\r\n        }));\r\n\r\n\r\n        const algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')],\r\n            ],\r\n            title: LANG('scaling-algorithm'),\r\n            initValue: 'smooth',\r\n            onChange: function () {\r\n                update();\r\n            },\r\n        });\r\n\r\n        const secondRowElement = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                'alignItems': 'center',\r\n            },\r\n        });\r\n        secondRowElement.append(constrainCheckbox.getElement(), algorithmSelect.getElement());\r\n\r\n        const previewCanvas = BB.canvas(w, h);\r\n        previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n\r\n        const previewCtx = BB.ctx(previewCanvas);\r\n\r\n\r\n        function draw (): void {\r\n            if (algorithmSelect.getValue() === 'smooth') {\r\n                previewCanvas.style.imageRendering = previewFactor > 1 ? 'pixelated' : '';\r\n\r\n                previewCanvas.width = klCanvas.getWidth();\r\n                previewCanvas.height = klCanvas.getHeight();\r\n\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingQuality = 'high';\r\n                previewCtx.drawImage(tempCanvas, 0, 0);\r\n                BB.resizeCanvas(previewCanvas, newWidth, newHeight);\r\n                previewCtx.restore();\r\n\r\n            } else {\r\n                previewCanvas.style.imageRendering = 'pixelated';\r\n\r\n                previewCanvas.width = newWidth;\r\n                previewCanvas.height = newHeight;\r\n                previewCtx.save();\r\n                previewCtx.imageSmoothingEnabled = false;\r\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\r\n                previewCtx.restore();\r\n            }\r\n\r\n        }\r\n\r\n        function update (): void {\r\n            if ((widthInput.value.length === 0 && widthChanged) || (heightInput.value.length === 0 && heightChanged)) {\r\n                heightChanged = false;\r\n                widthChanged = false;\r\n                return;\r\n            }\r\n            widthInput.value = '' + Math.max(1, parseInt(widthInput.value));\r\n            heightInput.value = '' + Math.max(1, parseInt(heightInput.value));\r\n            if (isConstrained) {\r\n                if (heightChanged) {\r\n                    widthInput.value = '' + parseInt('' + (parseInt(heightInput.value) * ratio));\r\n                }\r\n                if (widthChanged) {\r\n                    heightInput.value = '' + parseInt('' + (parseInt(widthInput.value) / ratio));\r\n                }\r\n\r\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\r\n                    const fit = BB.fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\r\n                    widthInput.value = '' + parseInt('' + fit.width);\r\n                    heightInput.value = '' + parseInt('' + fit.height);\r\n                }\r\n            }\r\n\r\n            if (parseInt(widthInput.value) > maxWidth) {\r\n                widthInput.value = '' + maxWidth;\r\n            }\r\n            if (parseInt(heightInput.value) > maxHeight) {\r\n                heightInput.value = '' + maxHeight;\r\n            }\r\n\r\n            heightChanged = false;\r\n            widthChanged = false;\r\n\r\n            newWidth = parseInt(widthInput.value);\r\n            newHeight = parseInt(heightInput.value);\r\n\r\n            const preview = BB.fitInto(newWidth, newHeight, 280, 200, 1);\r\n            const previewW = parseInt('' + preview.width), previewH = parseInt('' + preview.height);\r\n            previewFactor = previewW / newWidth;\r\n\r\n            const offset = BB.centerWithin(340, 220, previewW, previewH);\r\n\r\n            draw();\r\n\r\n            previewCanvas.style.width = Math.max(1, previewW) + 'px';\r\n            previewCanvas.style.height = Math.max(1, previewH) + 'px';\r\n            canvasWrapper.style.left = offset.x + 'px';\r\n            canvasWrapper.style.top = offset.y + 'px';\r\n            canvasWrapper.style.width = Math.max(1, previewW) + 'px';\r\n            canvasWrapper.style.height = Math.max(1, previewH) + 'px';\r\n        }\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-transparent-preview',\r\n            css: {\r\n                width: '340px',\r\n                marginLeft: '-20px',\r\n                height: '220px',\r\n                display: 'table',\r\n                marginTop: '10px',\r\n                position: 'relative',\r\n                userSelect: 'none',\r\n            },\r\n        });\r\n\r\n        const canvasWrapper = BB.el({\r\n            parent: previewWrapper,\r\n            content: previewCanvas,\r\n            className: 'kl-transparent-preview__canvas',\r\n            css: {\r\n                width: w + 'px',\r\n                height: h + 'px',\r\n                position: 'absolute',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n        function updateCheckerboard (): void {\r\n            BB.createCheckerDataUrl(8, function (url) {\r\n                previewWrapper.style.background = 'url(' + url + ')';\r\n            }, theme.isDark());\r\n        }\r\n        theme.addIsDarkListener(updateCheckerboard);\r\n        updateCheckerboard();\r\n\r\n\r\n        div.append(previewWrapper);\r\n        update();\r\n\r\n        result.destroy = (): void => {\r\n            constrainCheckbox.destroy();\r\n            theme.removeIsDarkListener(updateCheckerboard);\r\n        };\r\n        result.getInput = function (): TFilterResizeInput {\r\n            result.destroy();\r\n            return {\r\n                width: newWidth,\r\n                height: newHeight,\r\n                algorithm: algorithmSelect.getValue(),\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterResizeInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        const width = params.input.width;\r\n        const height = params.input.height;\r\n        const algorithm = params.input.algorithm;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.resize(width, height, algorithm);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'resize'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterResizeHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"c92cL\");","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\nimport {theme} from '../../theme/theme';\r\n\r\nexport type TFilterRotateInput = {\r\n    deg: number;\r\n}\r\n\r\nexport type TFilterRotateHistoryEntry = TFilterHistoryEntry<\r\n    'rotate',\r\n    TFilterRotateInput>;\r\n\r\nexport const filterRotate = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const klCanvas = params.klCanvas;\r\n        if (!klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const previewFactor = w / klCanvas.getWidth();\r\n        const tempCanvas = BB.canvas(w, h);\r\n        tempCanvas.style.display = 'block';\r\n        BB.ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\r\n\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterRotateInput> = {\r\n            element: div,\r\n        };\r\n        let deg = 0;\r\n        div.innerHTML = LANG('filter-rotate-description') + '<br/><br/>';\r\n\r\n        function update (): void {\r\n            canvasWrapper.style.transform = 'rotate(' + deg + 'deg)';\r\n            if (Math.abs(deg % 180) === 90) {\r\n                //height has to fit width because of rotation\r\n                const fit = BB.fitInto(h, w, 280, 200, 1);\r\n                const scale = parseInt('' + fit.height) / w;\r\n                canvasWrapper.style.transform = 'rotate(' + deg + 'deg) scale(' + scale + ')';\r\n            }\r\n        }\r\n\r\n        const btnPlus = document.createElement('button');\r\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        const btnMinus = document.createElement('button');\r\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\r\n        btnMinus.style.marginRight = '5px';\r\n\r\n\r\n        btnPlus.onclick = function () {\r\n            deg += 90;\r\n            update();\r\n        };\r\n        btnMinus.onclick = function () {\r\n            deg -= 90;\r\n            update();\r\n        };\r\n\r\n        div.append(btnMinus, btnPlus);\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n                display: 'table',\r\n            },\r\n        });\r\n\r\n        const previewcell = BB.el({\r\n            parent: previewWrapper,\r\n            css: {\r\n                display: 'table-cell',\r\n                verticalAlign: 'middle',\r\n            },\r\n        });\r\n        const canvasWrapper = BB.el({\r\n            parent: previewcell,\r\n            content: tempCanvas,\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: w + 'px',\r\n                height: h + 'px',\r\n                marginLeft: 'auto',\r\n                marginRight: 'auto',\r\n                overflow: 'hidden',\r\n            },\r\n        });\r\n\r\n\r\n        function updateCheckerboard (): void {\r\n            BB.createCheckerDataUrl(8, function (url) {\r\n                canvasWrapper.style.background = 'url(' + url + ')';\r\n            }, theme.isDark());\r\n        }\r\n        theme.addIsDarkListener(updateCheckerboard);\r\n        updateCheckerboard();\r\n\r\n        canvasWrapper.style.transition = 'all 0.2s ease-out';\r\n\r\n        div.append(previewWrapper);\r\n        update();\r\n\r\n        result.destroy = (): void => {\r\n            theme.removeIsDarkListener(updateCheckerboard);\r\n        };\r\n        result.getInput = function (): TFilterRotateInput {\r\n            result.destroy();\r\n            return {\r\n                deg: deg,\r\n            };\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterRotateInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        klCanvas.rotate(params.input.deg);\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'rotate'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterRotateHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterTiltShiftInput = {\r\n    a: IVector2D;\r\n    b: IVector2D;\r\n    blur: number;\r\n    gradient: number;\r\n};\r\n\r\nexport type TFilterTiltShiftHistoryEntry = TFilterHistoryEntry<\r\n    'tiltShift',\r\n    TFilterTiltShiftInput>;\r\n\r\nexport const filterTiltShift = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const previewFactor = w / context.canvas.width;\r\n        const displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterTiltShiftInput> = {\r\n            element: div,\r\n        };\r\n\r\n        const pointerListenerArr = [];\r\n\r\n        function finishInit () {\r\n            let blur = 20, gradient = 200;\r\n            div.innerHTML = LANG('filter-tilt-shift-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n            let fa, fb; // focus line\r\n            function update () {\r\n                try {\r\n                    fxCanvas.draw(texture).tiltShift(\r\n                        fa.x / displayPreviewFactor * previewFactor,\r\n                        fa.y / displayPreviewFactor * previewFactor,\r\n                        fb.x / displayPreviewFactor * previewFactor,\r\n                        fb.y / displayPreviewFactor * previewFactor,\r\n                        blur * previewFactor,\r\n                        gradient * previewFactor\r\n                    ).update();\r\n                    klCanvasPreview.render();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }\r\n\r\n            function nob (x, y) {\r\n                const nobSize = 14;\r\n                const div = BB.el({\r\n                    css: {\r\n                        width: nobSize + 'px',\r\n                        height: nobSize + 'px',\r\n                        backgroundColor: '#fff',\r\n                        boxShadow: 'inset 0 0 0 2px #000',\r\n                        borderRadius: nobSize + 'px',\r\n                        position: 'absolute',\r\n                        cursor: 'move',\r\n                        left: (x - nobSize / 2) + 'px',\r\n                        top: (y - nobSize / 2) + 'px',\r\n                        userSelect: 'none',\r\n                        touchAction: 'none',\r\n                    },\r\n                });\r\n                (div as any).x = x;\r\n                (div as any).y = y;\r\n                const pointerListener = new BB.PointerListener({\r\n                    target: div,\r\n                    onPointer: function (event) {\r\n                        event.eventPreventDefault();\r\n                        if (event.button === 'left' && event.type === 'pointermove') {\r\n                            (div as any).x += event.dX;\r\n                            (div as any).y += event.dY;\r\n                            div.style.left = ((div as any).x - nobSize / 2) + 'px';\r\n                            div.style.top = ((div as any).y - nobSize / 2) + 'px';\r\n                            update();\r\n                        }\r\n                    },\r\n                });\r\n                pointerListenerArr.push(pointerListener);\r\n                return div;\r\n            }\r\n\r\n            fa = nob(parseInt('' + (displayW / 6)), parseInt('' + (displayH / 2)));\r\n            fb = nob(parseInt('' + (displayW - displayW / 6)), parseInt('' + (displayH - displayH / 3)));\r\n\r\n            const blurSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-blur'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                value: blur,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    blur = val;\r\n                    update();\r\n                },\r\n            });\r\n            blurSlider.getElement().style.marginBottom = '10px';\r\n            div.append(blurSlider.getElement());\r\n            const gradientSlider = new KlSlider({\r\n                label: LANG('filter-tilt-shift-gradient'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1000,\r\n                value: gradient,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    gradient = val;\r\n                    update();\r\n                },\r\n            });\r\n            div.append(gradientSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n            previewWrapper.oncontextmenu = function () {\r\n                return false;\r\n            };\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            previewInnerWrapper.append(fa, fb);\r\n\r\n\r\n            div.append(previewWrapper);\r\n            update();\r\n            result.destroy = (): void => {\r\n                for (let i = 0; i < pointerListenerArr.length; i++) {\r\n                    pointerListenerArr[i].destroy();\r\n                }\r\n                blurSlider.destroy();\r\n                gradientSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterTiltShiftInput {\r\n                result.destroy();\r\n                return {\r\n                    a: {x: fa.x / displayPreviewFactor, y: fa.y / displayPreviewFactor},\r\n                    b: {x: fb.x / displayPreviewFactor, y: fb.y / displayPreviewFactor},\r\n                    blur: blur,\r\n                    gradient: gradient,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterTiltShiftInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const a = params.input.a;\r\n        const b = params.input.b;\r\n        const blur = params.input.blur;\r\n        const gradient = params.input.gradient;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).tiltShift(a.x, a.y, b.x, b.y, blur, gradient).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'tiltShift'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterTiltShiftHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {FreeTransform} from '../ui/components/free-transform';\r\nimport {IFreeTransform} from '../ui/components/free-transform-utils';\r\nimport {Select} from '../ui/components/select';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {IRect} from '../../bb/bb-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterTransformInput = {\r\n    bounds: {x: number; y: number; width: number; height: number};\r\n    transform: IFreeTransform;\r\n    isPixelated: boolean;\r\n};\r\n\r\nexport type TFilterTransformHistoryEntry = TFilterHistoryEntry<\r\n    'transform',\r\n    TFilterTransformInput>;\r\n\r\nexport const filterTransform = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n        let freeTransform: FreeTransform;\r\n        const displayPreviewFactor = displayW / context.canvas.width;\r\n\r\n        // determine bounds and initial transformation\r\n        const boundsObj: IRect = BB.canvasBounds(context);\r\n        if (boundsObj === null) {\r\n            alert(LANG('filter-transform-empty'));\r\n            return false;\r\n        }\r\n        const initTransform = {\r\n            x: boundsObj.x + boundsObj.width / 2,\r\n            y: boundsObj.y + boundsObj.height / 2,\r\n            width: boundsObj.width,\r\n            height: boundsObj.height,\r\n            angleDeg: 0,\r\n        };\r\n\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterTransformInput> = {\r\n            element: div,\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        div.innerHTML = LANG('filter-transform-description');\r\n\r\n        const keyListener = new BB.KeyListener({\r\n            onDown: function (keyStr) {\r\n                if (BB.isInputFocused(true)) {\r\n                    return;\r\n                }\r\n\r\n                if (keyStr === 'left') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'right') {\r\n                    inputX.value = '' + (parseFloat(inputX.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'up') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) - 1);\r\n                    onInputsChanged();\r\n                }\r\n                if (keyStr === 'down') {\r\n                    inputY.value = '' + (parseFloat(inputY.value) + 1);\r\n                    onInputsChanged();\r\n                }\r\n            },\r\n\r\n        });\r\n\r\n        const leftWrapper = document.createElement('div');\r\n        const rightWrapper = document.createElement('div');\r\n        const rotWrapper = document.createElement('div');\r\n        const inputY = document.createElement('input');\r\n        const inputX = document.createElement('input');\r\n        const inputR = document.createElement('input');\r\n        leftWrapper.style.width = '100px';\r\n        leftWrapper.style.height = '30px';\r\n        rightWrapper.style.width = '100px';\r\n        rightWrapper.style.height = '30px';\r\n        rightWrapper.style.display = 'inline-block';\r\n        leftWrapper.style.display = 'inline-block';\r\n        rotWrapper.style.display = 'inline-block';\r\n        rotWrapper.style.width = '150px';\r\n        rotWrapper.style.height = '30px';\r\n        inputY.type = 'number';\r\n        inputX.type = 'number';\r\n        inputR.type = 'number';\r\n        inputX.style.width = 70 + 'px';\r\n        inputY.style.width = 70 + 'px';\r\n        inputR.style.width = 70 + 'px';\r\n        inputY.value = '0';\r\n        inputX.value = '0';\r\n        inputR.value = '0';\r\n        inputY.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputX.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputR.onclick = function () {\r\n            (this as any).focus();\r\n            onInputsChanged();\r\n        };\r\n        inputY.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onchange = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputY.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputX.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        inputR.onkeyup = function () {\r\n            onInputsChanged();\r\n        };\r\n        leftWrapper.append('X: ', inputX);\r\n        rightWrapper.append('Y: ', inputY);\r\n        rotWrapper.append(LANG('filter-transform-rotation') + ': ', inputR);\r\n        if (!isSmall) {\r\n            const inputRow = BB.el({\r\n                parent: div,\r\n                css: {\r\n                    marginTop: '10px',\r\n                },\r\n            });\r\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\r\n        }\r\n\r\n        // buttons\r\n        const actionBtnCss = {\r\n            marginLeft: '10px',\r\n            marginTop: '10px',\r\n        };\r\n        const buttonRow = BB.el ({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n                marginLeft: '-10px',\r\n            },\r\n        });\r\n        const flipXBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' X',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(-t.width, t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const flipYBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('filter-transform-flip') + ' Y',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(t.width, -t.height);\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotLeftBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '-90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg -= 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleRotRightBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '+90',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                t.angleDeg += 90;\r\n                t.angleDeg %= 360;\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleDoubleBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                if (constrainCheckbox.getValue()) {\r\n                    freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\r\n                } else {\r\n                    freeTransform.setSize(t.width * 2, t.height * 2);\r\n                }\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const scaleHalfBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: '1/2x',\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n        const centerBtn = BB.el ({\r\n            parent: buttonRow,\r\n            tagName: 'button',\r\n            content: LANG('center'),\r\n            onClick: () => {\r\n                const t = freeTransform.getTransform();\r\n                freeTransform.setPos({ x: context.canvas.width / 2, y: context.canvas.height / 2 });\r\n                freeTransform.setAngleDeg(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            css: actionBtnCss,\r\n        });\r\n\r\n\r\n\r\n\r\n\r\n        let isConstrained = true;\r\n        const constrainCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-constrain'),\r\n            title: LANG('constrain-proportions'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                isConstrained = b;\r\n                freeTransform.setConstrained(isConstrained);\r\n            },\r\n            css: {\r\n                display: 'inline-block',\r\n            },\r\n        });\r\n        let isSnapping = false;\r\n        const snappingCheckbox = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-transform-snap'),\r\n            title: LANG('filter-transform-snap-title'),\r\n            allowTab: true,\r\n            callback: function (b) {\r\n                isSnapping = b;\r\n                freeTransform.setSnapping(isSnapping);\r\n            },\r\n            css: {\r\n                display: 'inline-block',\r\n                marginLeft: '10px',\r\n            },\r\n        });\r\n        const checkboxWrapper = BB.el();\r\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\r\n\r\n        div.append(BB.el({\r\n            css: {\r\n                clear: 'both',\r\n                height: '10px',\r\n            },\r\n        }));\r\n\r\n        const bottomRow = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n\r\n        const algorithmSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                ['smooth', LANG('algorithm-smooth')],\r\n                ['pixelated', LANG('algorithm-pixelated')],\r\n            ],\r\n            initValue: 'smooth',\r\n            title: LANG('scaling-algorithm'),\r\n            onChange: function () {\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                height: isSmall ? '260px' : '300px',\r\n            },\r\n        });\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n\r\n        const previewLayerArr: IKlBasicLayer[] = [];\r\n        {\r\n            for (let i = 0; i < layers.length; i++) {\r\n                let canvas;\r\n                if (i === selectedLayerIndex) {\r\n                    canvas = BB.canvas(parseInt('' + w), parseInt('' + h));\r\n                    const ctx = BB.ctx(canvas);\r\n                    ctx.drawImage(layers[i].context.canvas, 0, 0, canvas.width, canvas.height);\r\n                } else {\r\n                    canvas = layers[i].context.canvas;\r\n                }\r\n                previewLayerArr.push({\r\n                    image: canvas,\r\n                    opacity: layers[i].opacity,\r\n                    mixModeStr: layers[i].mixModeStr,\r\n                });\r\n            }\r\n        }\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: parseInt('' + displayW),\r\n            height: parseInt('' + displayH),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + displayW) + 'px',\r\n                height: parseInt('' + displayH) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        let lastDrawnTransformStr;\r\n        function updatePreview (doForce: boolean = false) {\r\n            if (!freeTransform) {\r\n                return;\r\n            }\r\n            const transform = freeTransform.getTransform();\r\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) {\r\n                return;\r\n            }\r\n            lastDrawnTransformStr = JSON.stringify(transform);\r\n            if (displayPreviewFactor < 1) {\r\n                transform.x *= displayPreviewFactor;\r\n                transform.y *= displayPreviewFactor;\r\n                transform.width *= displayPreviewFactor;\r\n                transform.height *= displayPreviewFactor;\r\n            }\r\n            const transformLayerCanvas = previewLayerArr[selectedLayerIndex].image as HTMLCanvasElement;\r\n            const ctx = BB.ctx(transformLayerCanvas);\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, transformLayerCanvas.width, transformLayerCanvas.height);\r\n            BB.drawTransformedImageWithBounds(\r\n                ctx,\r\n                layers[selectedLayerIndex].context.canvas,\r\n                transform,\r\n                boundsObj,\r\n                algorithmSelect.getValue() === 'pixelated' ||\r\n                BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            );\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        freeTransform = new FreeTransform({\r\n            x: initTransform.x,\r\n            y: initTransform.y,\r\n            width: initTransform.width,\r\n            height: initTransform.height,\r\n            angleDeg: initTransform.angleDeg,\r\n            isConstrained: true,\r\n            snapX: [0, context.canvas.width],\r\n            snapY: [0, context.canvas.height],\r\n            callback: function (t) {\r\n                inputX.value = '' + Math.round(t.x - initTransform.x);\r\n                inputY.value = '' + Math.round(t.y - initTransform.y);\r\n                inputR.value = '' + Math.round(t.angleDeg);\r\n                updatePreview();\r\n            },\r\n            scale: displayPreviewFactor,\r\n        });\r\n        BB.css(freeTransform.getElement(), {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n        });\r\n        previewInnerWrapper.append(freeTransform.getElement());\r\n\r\n        function onInputsChanged () {\r\n            freeTransform.setPos({\r\n                x: parseInt(inputX.value) + initTransform.x,\r\n                y: parseInt(inputY.value) + initTransform.y}\r\n            );\r\n            freeTransform.setAngleDeg(parseInt(inputR.value));\r\n            updatePreview();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            keyListener.destroy();\r\n            freeTransform.destroy();\r\n            constrainCheckbox.destroy();\r\n            snappingCheckbox.destroy();\r\n            BB.destroyEl(flipXBtn);\r\n            BB.destroyEl(flipYBtn);\r\n            BB.destroyEl(scaleRotLeftBtn);\r\n            BB.destroyEl(scaleRotRightBtn);\r\n            BB.destroyEl(scaleDoubleBtn);\r\n            BB.destroyEl(scaleHalfBtn);\r\n            BB.destroyEl(centerBtn);\r\n            klCanvasPreview.destroy();\r\n        };\r\n        result.getInput = function (): TFilterTransformInput {\r\n            const transform = freeTransform.getTransform();\r\n            const input: TFilterTransformInput = {\r\n                transform,\r\n                bounds: boundsObj,\r\n                isPixelated: algorithmSelect.getValue() === 'pixelated' ||\r\n                    BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\r\n            };\r\n            result.destroy();\r\n            return BB.copyObj(input);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterTransformInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!context || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const input = params.input;\r\n\r\n        const copyCanvas = BB.copyCanvas(context.canvas);\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        BB.drawTransformedImageWithBounds(\r\n            context,\r\n            copyCanvas,\r\n            input.transform,\r\n            input.bounds,\r\n            input.isPixelated,\r\n        );\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'transform'],\r\n            action: 'apply',\r\n            params: [{input}],\r\n        } as TFilterTransformHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterBlurInput = {\r\n    radius: number;\r\n}\r\n\r\nexport type TFilterBlurHistoryEntry = TFilterHistoryEntry<\r\n    'blur',\r\n    TFilterBlurInput>;\r\n\r\n\r\nexport const filterBlur = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const klCanvas = params.klCanvas;\r\n        const context = params.context;\r\n        if (!klCanvas || !context) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterBlurInput> = {\r\n            element: div,\r\n        };\r\n\r\n\r\n        function finishInit (): void {\r\n            let radius = 10;\r\n            div.innerHTML = LANG('filter-triangle-blur-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 1,\r\n                max: 200,\r\n                value: radius,\r\n                eventResMs: eventResMs,\r\n                onChange: (val): void => {\r\n                    radius = val;\r\n                    fxCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n            });\r\n            div.append(radiusSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).triangleBlur(radius * previewFactor).update();\r\n                klCanvasPreview.render();\r\n            } catch(e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = (): void => {\r\n                texture.destroy();\r\n                radiusSlider.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterBlurInput {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterBlurInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const radius = params.input.radius;\r\n        if (!context || !radius || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).triangleBlur(radius).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'blur'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterBlurHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterUnsharpMaskInput = {\r\n    radius: number;\r\n    strength: number;\r\n};\r\n\r\nexport type TFilterUnsharpMaskHistoryEntry = TFilterHistoryEntry<\r\n    'unsharpMask',\r\n    TFilterUnsharpMaskInput>;\r\n\r\nexport const filterUnsharpMask = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const displayW = parseInt('' + fit.width), displayH = parseInt('' + fit.height);\r\n        const w = Math.min(displayW, context.canvas.width);\r\n        const h = Math.min(displayH, context.canvas.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (w > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterUnsharpMaskInput> = {\r\n            element: div,\r\n        };\r\n\r\n        function finishInit () {\r\n            let radius = 2, strength = 5.1 / 10;\r\n            div.innerHTML = LANG('filter-unsharp-mask-description') + '<br/><br/>';\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const radiusSlider = new KlSlider({\r\n                label: LANG('radius'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                value: 2,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    radius = val;\r\n                    fxCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 50], [1, 200]],\r\n            });\r\n            const strengthSlider = new KlSlider({\r\n                label: LANG('filter-unsharp-mask-strength'),\r\n                width: 300,\r\n                height: 30,\r\n                min: 0,\r\n                max: 50,\r\n                value: 5.1,\r\n                eventResMs: eventResMs,\r\n                onChange: function (val) {\r\n                    strength = val / 10;\r\n                    fxCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                    klCanvasPreview.render();\r\n                },\r\n                curve: [[0, 0], [0.1, 2], [0.5, 10], [1, 50]],\r\n            });\r\n            radiusSlider.getElement().style.marginBottom = '10px';\r\n            div.append(radiusSlider.getElement());\r\n            div.append(strengthSlider.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + displayW),\r\n                height: parseInt('' + displayH),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + displayW) + 'px',\r\n                    height: parseInt('' + displayH) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            try {\r\n                fxCanvas.draw(texture).unsharpMask(radius * previewFactor, strength).update();\r\n                klCanvasPreview.render();\r\n            } catch (e) {\r\n                (div as any).errorCallback(e);\r\n            }\r\n\r\n            result.destroy = (): void => {\r\n                radiusSlider.destroy();\r\n                strengthSlider.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterUnsharpMaskInput {\r\n                result.destroy();\r\n                return {\r\n                    radius: radius,\r\n                    strength: strength,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply (params: IFilterApply<TFilterUnsharpMaskInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const radius = params.input.radius;\r\n        const strength = params.input.strength;\r\n        if (!context || radius === null || strength === null || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).unsharpMask(radius, strength).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'unsharpMask'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterUnsharpMaskHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {Options} from '../ui/components/options';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, IRGBA} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterToAlphaInput = {\r\n    sourceId: string;\r\n    selectedRgbaObj: IRGBA;\r\n};\r\n\r\nexport type TFilterToAlphaHistoryEntry = TFilterHistoryEntry<\r\n    'toAlpha',\r\n    TFilterToAlphaInput>;\r\n\r\nexport const filterToAlpha = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n\r\n        const tempCanvas = BB.canvas(w, h);\r\n        {\r\n            const ctx = BB.ctx(tempCanvas);\r\n            ctx.save();\r\n            if (tempCanvas.width > context.canvas.width) {\r\n                ctx.imageSmoothingEnabled = false;\r\n            }\r\n            ctx.drawImage(context.canvas, 0, 0, w, h);\r\n            ctx.restore();\r\n        }\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterToAlphaInput> = {\r\n            element: div,\r\n        };\r\n\r\n        function finishInit () {\r\n            const radius = 2, strength = 5.1 / 10;\r\n            div.append(BB.el({\r\n                content: LANG('filter-to-alpha-description'),\r\n                css: {\r\n                    marginBottom: '5px',\r\n                },\r\n            }));\r\n\r\n            const fxCanvas = getSharedFx();\r\n            if (!fxCanvas) {\r\n                return; // todo throw?\r\n            }\r\n            const texture = fxCanvas.texture(tempCanvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            function updatePreview () {\r\n                fxCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n                klCanvasPreview.render();\r\n            }\r\n\r\n            // source\r\n            let sourceId = 'inverted-luminance';\r\n            const sourceOptions = new Options({\r\n                optionArr: [\r\n                    {\r\n                        id: 'inverted-luminance',\r\n                        label: LANG('filter-to-alpha-inverted-lum'),\r\n                    },\r\n                    {\r\n                        id: 'luminance',\r\n                        label: LANG('filter-to-alpha-lum'),\r\n                    },\r\n                ],\r\n                initId: sourceId,\r\n                onChange: function (id) {\r\n                    sourceId = id;\r\n                    updatePreview();\r\n                },\r\n            });\r\n            div.append(sourceOptions.getElement());\r\n\r\n            // color\r\n            let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n            const colorOptionsArr = [\r\n                null,\r\n                {r: 0, g: 0, b: 0, a: 1},\r\n                {r: 255, g: 255, b: 255, a: 1},\r\n            ];\r\n            colorOptionsArr.push({\r\n                r: params.currentColorRgb.r,\r\n                g: params.currentColorRgb.g,\r\n                b: params.currentColorRgb.b,\r\n                a: 1,\r\n            });\r\n            colorOptionsArr.push({\r\n                r: params.secondaryColorRgb.r,\r\n                g: params.secondaryColorRgb.g,\r\n                b: params.secondaryColorRgb.b,\r\n                a: 1,\r\n            });\r\n\r\n            const colorOptions = new ColorOptions({\r\n                label: LANG('filter-to-alpha-replace'),\r\n                colorArr: colorOptionsArr,\r\n                initialIndex: 1,\r\n                onChange: function (rgbaObj) {\r\n                    selectedRgbaObj = rgbaObj;\r\n                    updatePreview();\r\n                },\r\n            });\r\n            colorOptions.getElement().style.marginTop = '10px';\r\n            div.append(colorOptions.getElement());\r\n\r\n\r\n            const previewWrapper = BB.el({\r\n                className: 'kl-preview-wrapper',\r\n                css: {\r\n                    width: '340px',\r\n                    height: '220px',\r\n                },\r\n            });\r\n\r\n            const previewLayerArr: IKlBasicLayer[] = [];\r\n            {\r\n                for (let i = 0; i < layers.length; i++) {\r\n                    previewLayerArr.push({\r\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\r\n                        opacity: layers[i].opacity,\r\n                        mixModeStr: layers[i].mixModeStr,\r\n                    });\r\n                }\r\n            }\r\n            const klCanvasPreview = new KlCanvasPreview({\r\n                width: parseInt('' + w),\r\n                height: parseInt('' + h),\r\n                layers: previewLayerArr,\r\n            });\r\n\r\n            const previewInnerWrapper = BB.el({\r\n                className: 'kl-preview-wrapper__canvas',\r\n                css: {\r\n                    width: parseInt('' + w) + 'px',\r\n                    height: parseInt('' + h) + 'px',\r\n                },\r\n            });\r\n            previewInnerWrapper.append(klCanvasPreview.getElement());\r\n            previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n            div.append(previewWrapper);\r\n\r\n            setTimeout(function () { //ie has a problem otherwise...\r\n                try {\r\n                    updatePreview();\r\n                } catch(e) {\r\n                    (div as any).errorCallback(e);\r\n                }\r\n            }, 1);\r\n\r\n            result.destroy = (): void => {\r\n                texture.destroy();\r\n                sourceOptions.destroy();\r\n                klCanvasPreview.destroy();\r\n            };\r\n            result.getInput = function (): TFilterToAlphaInput {\r\n                result.destroy();\r\n                return {\r\n                    sourceId: sourceId,\r\n                    selectedRgbaObj: selectedRgbaObj,\r\n                };\r\n            };\r\n        }\r\n\r\n        setTimeout(finishInit, 1);\r\n\r\n        return result;\r\n    },\r\n\r\n\r\n    apply (params: IFilterApply<TFilterToAlphaInput>): boolean {\r\n        const context = params.context;\r\n        const history = params.history;\r\n        const sourceId = params.input.sourceId;\r\n        const selectedRgbaObj = params.input.selectedRgbaObj;\r\n        if (!context || !sourceId || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'toAlpha'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterToAlphaHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {input} from '../ui/components/input';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {drawGrid} from '../image-operations/draw-grid';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterGridInput = {\r\n    x: number;\r\n    y: number;\r\n    thickness: number;\r\n    color: string;\r\n    opacity: number;\r\n};\r\n\r\nexport type TFilterGridHistoryEntry = TFilterHistoryEntry<\r\n    'grid',\r\n    TFilterGridInput>;\r\n\r\nexport const filterGrid = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterGridInput> = {\r\n            element: div,\r\n        };\r\n        div.innerHTML = LANG('filter-grid-description') + '<br/><br/>';\r\n\r\n        const settingsObj: TFilterGridInput = {\r\n            x: 2,\r\n            y: 2,\r\n            thickness: 2,\r\n            color: '#000',\r\n            opacity: 1,\r\n        };\r\n\r\n        const line1 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        const line2 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n        const xInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.x = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const yInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.y = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const thicknessInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.thickness = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n        settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('shape-stroke'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function (rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            marginRight: '5px',\r\n        };\r\n        line1.append(\r\n            BB.el({content: 'X:', css: labelStyle}),\r\n            xInput,\r\n            BB.el({content: 'Y:', css: labelStyle}),\r\n            yInput,\r\n        );\r\n        line2.append(\r\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\r\n            thicknessInput,\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorOptions.getElement(),\r\n        );\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            }),\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n            drawGrid(ctx, settingsObj.x, settingsObj.y, Math.max(settingsObj.thickness * renderFactor, 1), settingsObj.color, settingsObj.opacity);\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            klCanvasPreview.destroy();\r\n            colorOptions.destroy();\r\n        };\r\n        result.getInput = function (): TFilterGridInput {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterGridInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        drawGrid(\r\n            context,\r\n            params.input.x,\r\n            params.input.y,\r\n            params.input.thickness,\r\n            params.input.color,\r\n            params.input.opacity,\r\n        );\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['filter', 'grid'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterGridHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","\r\n// ideas: padding, gutter, other shapes\r\n\r\nexport function drawGrid (\r\n    ctx: CanvasRenderingContext2D,\r\n    cellsX: number,\r\n    cellsY: number,\r\n    thickness: number, // px\r\n    color: string,\r\n    opacity: number, // 0 - 1\r\n) {\r\n    ctx.save();\r\n    const w = ctx.canvas.width;\r\n    const h = ctx.canvas.height;\r\n    thickness = Math.round(thickness);\r\n    const thickIsRound = thickness % 2 === 0;\r\n\r\n    ctx.beginPath();\r\n    ctx.lineWidth = thickness;\r\n    ctx.strokeStyle = color;\r\n    ctx.globalAlpha = opacity;\r\n\r\n    for(let i = 0; i < cellsX - 1; i++) {\r\n        const cw = w / (cellsX);\r\n        let pos = cw * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n        ctx.moveTo(pos, 0);\r\n        ctx.lineTo(pos, h);\r\n\r\n    }\r\n    for(let i = 0; i < cellsY - 1; i++) {\r\n        const ch = h / (cellsY);\r\n        let pos = ch * (i + 1);\r\n        if (thickIsRound) {\r\n            pos = Math.round(pos);\r\n        } else {\r\n            pos = Math.round(pos + 0.5) - 0.5;\r\n        }\r\n\r\n        ctx.moveTo(0, pos);\r\n        ctx.lineTo(w, pos);\r\n    }\r\n\r\n    ctx.stroke();\r\n    ctx.restore();\r\n}","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, IRGB, TMixMode} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {Options} from '../ui/components/options';\r\nimport {eventResMs} from './filters-consts';\r\nimport {Select} from '../ui/components/select';\r\nimport {translateBlending} from '../canvas/translate-blending';\r\nimport {KL} from '../kl';\r\nimport {ColorConverter} from '../../bb/color/color';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {TFxCanvas} from '../../fx-canvas/fx-canvas-types';\r\nimport {TKlCanvasHistoryEntry} from '../canvas/kl-canvas';\r\n\r\n// see noise(...) in fx-canvas\r\ninterface INoisePreset {\r\n    type: number;\r\n    scaleX: number;\r\n    scaleY: number;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    octaves: number;\r\n    samples: number;\r\n    peaks: number;\r\n    brightness: number;\r\n    contrast: number;\r\n    isReversed: boolean;\r\n}\r\n\r\ntype TNoiseChannels = 'rgb' | 'alpha';\r\n\r\ninterface INoiseSettings extends INoisePreset {\r\n    seed: number;\r\n    colA: IRGB;\r\n    colB: IRGB;\r\n    channels: TNoiseChannels;\r\n}\r\n\r\nexport type TFilterNoiseInput = {\r\n    seed: number;\r\n    presetIndex: number; // which preset from presetArr\r\n    scale: number; // applies to both scaleX and scaleX\r\n    opacity: number; // aka strength\r\n    isReversed: boolean; // reverse direction of color gradient\r\n    channels: TNoiseChannels;\r\n\r\n    // only for channels = rgb\r\n    mixModeStr: GlobalCompositeOperation; // how mixed with image\r\n    colA: IRGB;\r\n    colB: IRGB;\r\n}\r\n\r\n/*export type TFilterNoiseHistoryEntry = TFilterHistoryEntry<\r\n    'replaceLayer',\r\n    TFilterNoiseInput>;*/\r\n\r\nconst presetArr: INoisePreset[] = [\r\n    // each pixel random value\r\n    {type: 0, scaleX: 1, scaleY: 1, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: true},\r\n\r\n    // cloud\r\n    {type: 1, scaleX: 166, scaleY: 164, offsetX: 105, offsetY: 30, octaves: 6, samples: 1, peaks: 0, brightness: 0.055, contrast: 0.23, isReversed: true},\r\n\r\n    // thin lines\r\n    {type: 1, scaleX: 235, scaleY: 190, offsetX: 3227, offsetY: 2156, octaves: 4, samples: 16, peaks: 22, brightness: -0.375, contrast: 1, isReversed: false},\r\n\r\n    // soft large simplex, only 1 octave\r\n    {type: 1, scaleX: 40, scaleY: 40, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: false},\r\n\r\n    // two value large pixels\r\n    {type: 0, scaleX: 26, scaleY: 26, offsetX: 557, offsetY: 365, octaves: 1, samples: 1, peaks: 0, brightness: 0.02, contrast: 1, isReversed: true},\r\n\r\n    // zebra\r\n    {type: 1, scaleX: 1500, scaleY: 1500, offsetX: 745, offsetY: 2871, octaves: 5, samples: 16, peaks: 156.02, brightness: 0.03, contrast: 1, isReversed: true},\r\n\r\n    // sparse dots / stars\r\n    {type: 1, scaleX: 11, scaleY: 11, offsetX: 2940, offsetY: 2045, octaves: 1, samples: 16, peaks: 1, brightness: -0.045, contrast: 1, isReversed: true},\r\n\r\n    // pseudo marble\r\n    {type: 2, scaleX: 74, scaleY: 74, offsetX: 4816, offsetY: 1304, octaves: 3, samples: 1, peaks: 2.78, brightness: 0, contrast: 0, isReversed: false},\r\n];\r\n\r\nfunction drawNoise (fxCanvas: TFxCanvas, settings: INoiseSettings): void {\r\n    fxCanvas.noise(\r\n        settings.seed  ? settings.seed : 0,\r\n        settings.type,\r\n        [settings.scaleX, settings.scaleY],\r\n        [fxCanvas.width / 2, fxCanvas.height / 2],\r\n        settings.octaves,\r\n        settings.samples,\r\n        settings.peaks,\r\n        settings.brightness,\r\n        settings.contrast,\r\n        settings.isReversed,\r\n        settings.colA,\r\n        settings.colB,\r\n        settings.channels ? settings.channels : 'rgb',\r\n    ).update();\r\n}\r\n\r\n\r\nexport const filterNoise = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return; // todo throw?\r\n        }\r\n        let texture;\r\n\r\n        const thumbImgArr = [];\r\n        const thumbSize = 32;\r\n        {\r\n            const canvas = BB.canvas(thumbSize, thumbSize);\r\n            const ctx = BB.ctx(canvas);\r\n            texture = fxCanvas.texture(canvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n            texture.destroy();\r\n\r\n            presetArr.forEach((preset, index) => {\r\n                const thumbImg = new Image();\r\n                const presetCopy = BB.copyObj(preset);\r\n                presetCopy.scaleX /= 10;\r\n                presetCopy.scaleY /= 10;\r\n                drawNoise(fxCanvas, presetCopy);\r\n                ctx.drawImage(fxCanvas, 0, 0);\r\n                thumbImg.src = canvas.toDataURL('image/png');\r\n                thumbImgArr.push(thumbImg);\r\n            });\r\n\r\n        }\r\n\r\n        let tempCanvas = BB.canvas(renderW, renderH);\r\n        texture = fxCanvas.texture(tempCanvas);\r\n        fxCanvas.draw(texture).update(); // update fxCanvas size\r\n        tempCanvas = null;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterNoiseInput> = {\r\n            element: div,\r\n        };\r\n\r\n        div.innerHTML = LANG('filter-noise-description') + '<br/><br/>';\r\n\r\n        const settingsObj: TFilterNoiseInput = {\r\n            seed: Math.random() * 300,\r\n            presetIndex: 0,\r\n            scale: 50,\r\n            opacity: 0.5,\r\n            isReversed: false,\r\n            channels: 'rgb',\r\n            mixModeStr: 'source-over' as GlobalCompositeOperation,\r\n            colA: {r: 0, g: 0, b: 0},\r\n            colB: {r: 255, g: 255, b: 255},\r\n        };\r\n\r\n\r\n        const presetOptions = new Options({\r\n            optionArr: thumbImgArr.map((img, index) => {\r\n                BB.css(img, {\r\n                    margin: '1px',\r\n                    borderRadius: '3px',\r\n                    transition: 'all 0.1s ease-in-out',\r\n                });\r\n                return {\r\n                    id: '' + index,\r\n                    label: img,\r\n                };\r\n            }),\r\n            initId: '0',\r\n            onChange: (id) => {\r\n                settingsObj.presetIndex = Number(id);\r\n                updatePreview();\r\n            },\r\n        });\r\n        presetOptions.getElement().style.marginBottom = '10px';\r\n        div.append(presetOptions.getElement());\r\n\r\n        const scaleSlider = new KlSlider({\r\n            label: LANG('filter-noise-scale'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1,\r\n            max: 1000,\r\n            value: settingsObj.scale,\r\n            eventResMs: eventResMs,\r\n            curve: BB.quadraticSplineInput(1, 1000, 0.1),\r\n            onChange: (value) => {\r\n                settingsObj.scale = value;\r\n                updatePreview();\r\n            },\r\n        });\r\n        scaleSlider.getElement().style.marginBottom = '10px';\r\n\r\n        const opacitySlider = new KlSlider({\r\n            label: LANG('opacity'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1 / 100,\r\n            max: 1,\r\n            value: settingsObj.opacity,\r\n            eventResMs: eventResMs,\r\n            toValue: (displayValue) => displayValue / 100,\r\n            toDisplayValue: (value) => value * 100,\r\n            onChange: (value) => {\r\n                settingsObj.opacity = value;\r\n                updatePreview();\r\n            },\r\n        });\r\n        opacitySlider.getElement().style.marginBottom = '10px';\r\n\r\n        const row1El = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginBottom: '10px',\r\n            },\r\n        });\r\n\r\n        const row2El = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        const channelsOptions = new Options<TNoiseChannels>({\r\n            optionArr: [\r\n                {id: 'rgb', label: 'RGB'},\r\n                {id: 'alpha', label: LANG('filter-noise-alpha')},\r\n            ],\r\n            initId: 'rgb',\r\n            onChange: (id: TNoiseChannels) => {\r\n                settingsObj.channels = id;\r\n                if (id === 'rgb') {\r\n                    row2El.style.visibility = '';\r\n                } else {\r\n                    row2El.style.visibility = 'hidden';\r\n                }\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const reverseToggle = new Checkbox({\r\n            label: LANG('reverse'),\r\n            callback: (val) => {\r\n                settingsObj.isReversed = val;\r\n                updatePreview();\r\n            },\r\n            allowTab: true,\r\n        });\r\n\r\n        const blendSelect = new Select({\r\n            isFocusable: true,\r\n            optionArr: [\r\n                'source-over',\r\n                null,\r\n                'darken',\r\n                'multiply',\r\n                'color-burn',\r\n                null,\r\n                'lighten',\r\n                'screen',\r\n                'color-dodge',\r\n                null,\r\n                'overlay',\r\n                'soft-light',\r\n                'hard-light',\r\n                null,\r\n                'difference',\r\n                'exclusion',\r\n                null,\r\n                'hue',\r\n                'saturation',\r\n                'color',\r\n                'luminosity',\r\n            ].map((item: TMixMode) => {\r\n                return item ? [item, translateBlending(item)] : null;\r\n            }),\r\n            initValue: settingsObj.mixModeStr,\r\n            onChange: (val: GlobalCompositeOperation) => {\r\n                settingsObj.mixModeStr = val;\r\n                updatePreview();\r\n            },\r\n        });\r\n        blendSelect.getElement().title = LANG('layers-blending');\r\n\r\n        const colorWrapper = BB.el({\r\n            css: {\r\n                display: 'flex',\r\n            },\r\n        });\r\n\r\n        const colInputStyle = {\r\n            width: '34px',\r\n            height: '34px',\r\n            marginRight: '5px',\r\n        };\r\n        const colAInput = KL.input({\r\n            type: 'color',\r\n            init: '#' + ColorConverter.toHexString(settingsObj.colA),\r\n            callback: (val) => {\r\n                settingsObj.colA = ColorConverter.hexToRGB(val);\r\n                updatePreview();\r\n            },\r\n            css: colInputStyle,\r\n        });\r\n\r\n        const colBInput = KL.input({\r\n            type: 'color',\r\n            init: '#' + ColorConverter.toHexString(settingsObj.colB),\r\n            callback: (val) => {\r\n                settingsObj.colB = ColorConverter.hexToRGB(val);\r\n                updatePreview();\r\n            },\r\n            css: colInputStyle,\r\n        });\r\n\r\n        colorWrapper.append(\r\n            colAInput,\r\n            colBInput,\r\n        );\r\n\r\n\r\n        row1El.append(\r\n            channelsOptions.getElement(),\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            reverseToggle.getElement(),\r\n        );\r\n\r\n        row2El.append(\r\n            blendSelect.getElement(),\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorWrapper,\r\n        );\r\n\r\n        div.append(\r\n            scaleSlider.getElement(),\r\n            opacitySlider.getElement(),\r\n            row1El,\r\n            row2El,\r\n        );\r\n\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            }),\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n\r\n            ctx.globalAlpha = settingsObj.opacity;\r\n\r\n            const presetCopy = BB.copyObj(presetArr[settingsObj.presetIndex]);\r\n            presetCopy.seed = settingsObj.seed;\r\n            presetCopy.scaleX = presetCopy.scaleX  * settingsObj.scale / 50 * renderFactor;\r\n            presetCopy.scaleY = presetCopy.scaleY  * settingsObj.scale / 50 * renderFactor;\r\n            presetCopy.colA = settingsObj.colA;\r\n            presetCopy.colB = settingsObj.colB;\r\n            presetCopy.isReversed = settingsObj.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\r\n            presetCopy.channels  = settingsObj.channels;\r\n            drawNoise(fxCanvas, presetCopy);\r\n\r\n            if (settingsObj.channels === 'alpha') {\r\n                ctx.globalCompositeOperation = 'destination-out';\r\n            } else {\r\n                ctx.globalCompositeOperation = settingsObj.mixModeStr;\r\n            }\r\n\r\n            ctx.drawImage(fxCanvas, 0, 0);\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = (): void => {\r\n            presetOptions.destroy();\r\n            scaleSlider.destroy();\r\n            opacitySlider.destroy();\r\n            reverseToggle.destroy();\r\n            channelsOptions.destroy();\r\n            texture.destroy();\r\n            blendSelect.destroy();\r\n            klCanvasPreview.destroy();\r\n        };\r\n        result.getInput = function (): TFilterNoiseInput {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterNoiseInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).update();\r\n        texture.destroy();\r\n\r\n        const input = params.input;\r\n\r\n        const presetCopy: INoiseSettings = BB.copyObj(presetArr[input.presetIndex]) as INoiseSettings;\r\n        presetCopy.seed = input.seed;\r\n        presetCopy.scaleX = presetCopy.scaleX  * input.scale / 50;\r\n        presetCopy.scaleY = presetCopy.scaleY  * input.scale / 50;\r\n        presetCopy.colA = input.colA;\r\n        presetCopy.colB = input.colB;\r\n        presetCopy.isReversed = input.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\r\n        presetCopy.channels  = input.channels;\r\n        drawNoise(fxCanvas, presetCopy);\r\n\r\n        context.save();\r\n        context.globalAlpha = input.opacity;\r\n        if (input.channels === 'alpha') {\r\n            context.globalCompositeOperation = 'destination-out';\r\n        } else {\r\n            context.globalCompositeOperation = input.mixModeStr;\r\n        }\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        context.restore();\r\n\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['canvas'],\r\n            action: 'replaceLayer',\r\n            params: [\r\n                klCanvas.getLayerIndex(context.canvas),\r\n                context.getImageData(0, 0, context.canvas.width, context.canvas.height),\r\n            ],\r\n        } as TKlCanvasHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {input} from '../ui/components/input';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {LANG} from '../../language/language';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {TwoTabs} from '../ui/components/two-tabs';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\n\r\nexport type TFilterPatternInput = {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n    blend?: number; // [0, 1] - 1 will blend linearly across whole length\r\n    offsetX: number;\r\n    offsetY: number;\r\n};\r\n\r\nexport type TFilterPatternHistoryEntry = TFilterHistoryEntry<\r\n    'pattern',\r\n    TFilterPatternInput>;\r\n\r\n/**\r\n * Draws pattern onto context. Pattern generated from context.\r\n * Can use blending for smoother transition. Will use area outside of bounds for blending.\r\n *\r\n * @param context\r\n * @param settings\r\n */\r\nfunction drawPattern (context: CanvasRenderingContext2D, settings: TFilterPatternInput): void {\r\n\r\n    // keep bounds in center via offset\r\n    // because blending done towards bottom right\r\n    const blendOffsetX = settings.blend ? Math.round(settings.blend * settings.width / 2) : 0;\r\n    const blendOffsetY = settings.blend ? Math.round(settings.blend * settings.height / 2) : 0;\r\n\r\n    const finalPatternCanvas = BB.canvas(settings.width, settings.height);\r\n\r\n    if (settings.blend) {\r\n        // construct pattern via linear blending\r\n\r\n        const blendCanvas = BB.canvas(settings.width * 2, settings.height * 2);\r\n        const blendCtx = BB.ctx(blendCanvas);\r\n        const colTransparent = '#0000';\r\n        const colOpaque = '#000';\r\n\r\n        // transfer source to blendCanvas\r\n        blendCtx.drawImage(\r\n            context.canvas,\r\n            -settings.x + blendOffsetX,\r\n            -settings.y + blendOffsetY,\r\n        );\r\n\r\n        // --- 1 cross-fade vertical ------------------------\r\n\r\n        // erase vertical gradient bottom half\r\n        blendCtx.save();\r\n        let blendGradient = blendCtx.createLinearGradient(0, settings.height, 0, settings.height * 2);\r\n        blendGradient.addColorStop(0, colOpaque);\r\n        blendGradient.addColorStop(settings.blend, colTransparent);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\r\n        blendCtx.restore();\r\n\r\n        // erase vertical gradient top half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(0, 0, 0, settings.height);\r\n        blendGradient.addColorStop(0, colTransparent);\r\n        blendGradient.addColorStop(settings.blend, colOpaque);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\r\n        blendCtx.restore();\r\n\r\n        // draw bottom half over top half\r\n        blendCtx.save();\r\n        // lighter needed for accurate cross-fade\r\n        blendCtx.globalCompositeOperation = 'lighter';\r\n        blendCtx.drawImage(blendCanvas, 0, -settings.height);\r\n        blendCtx.restore();\r\n\r\n\r\n\r\n        // --- 2 cross-fade horizontal ------------------------\r\n\r\n        // erase horizontal gradient right half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(settings.width, 0, settings.width * 2, 0);\r\n        blendGradient.addColorStop(0, colOpaque);\r\n        blendGradient.addColorStop(settings.blend, colTransparent);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\r\n        blendCtx.restore();\r\n\r\n        // erase horizontal gradient left half\r\n        blendCtx.save();\r\n        blendGradient = blendCtx.createLinearGradient(0, 0, settings.width, 0);\r\n        blendGradient.addColorStop(0, colTransparent);\r\n        blendGradient.addColorStop(settings.blend, colOpaque);\r\n        blendCtx.globalCompositeOperation = 'destination-in';\r\n        blendCtx.fillStyle = blendGradient;\r\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\r\n        blendCtx.restore();\r\n\r\n        // draw right half over left half\r\n        blendCtx.save();\r\n        // lighter needed for accurate cross-fade\r\n        blendCtx.globalCompositeOperation = 'lighter';\r\n        blendCtx.drawImage(blendCanvas, -settings.width, 0);\r\n        blendCtx.restore();\r\n\r\n        // transfer to pattern canvas\r\n        BB.ctx(finalPatternCanvas).drawImage(blendCanvas, 0, 0);\r\n\r\n    } else {\r\n        BB.ctx(finalPatternCanvas).drawImage(\r\n            context.canvas,\r\n            -settings.x,\r\n            -settings.y,\r\n        );\r\n    }\r\n\r\n    context.save();\r\n\r\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n    context.translate(settings.offsetX - blendOffsetX, settings.offsetY - blendOffsetY);\r\n    context.fillStyle = context.createPattern(finalPatternCanvas, 'repeat');\r\n    context.fillRect(-settings.offsetX + blendOffsetX, -settings.offsetY + blendOffsetY, context.canvas.width, context.canvas.height);\r\n\r\n    context.restore();\r\n}\r\n\r\n\r\nexport const filterPattern = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const maxSize = 1024;\r\n        const rootEl = BB.el({\r\n            content: LANG('filter-pattern-description') + '<br><br>',\r\n        });\r\n        const context = params.context;\r\n        const width = context.canvas.width;\r\n        const height = context.canvas.height;\r\n\r\n        let settings: TFilterPatternInput = {\r\n            x: 0,\r\n            y: 0,\r\n            width: width <= 250 ? Math.round(width / 4) : 200,\r\n            height: height <= 250 ? Math.round(height / 4) : 200,\r\n            blend: 0,\r\n            offsetX: 0,\r\n            offsetY: 0,\r\n        };\r\n        let lastDrawnSettings = null;\r\n\r\n        // determine bounds\r\n        const bounds = BB.canvasBounds(context);\r\n        // adjust settings according to bounds\r\n        if ( // use layer bounds if:\r\n            bounds &&\r\n            (bounds.width <= maxSize && bounds.height <= maxSize) && // don't exceed max size\r\n            (bounds.width < width * 0.75 || bounds.height < height * 0.75) // aren't too large (heuristic)\r\n        ) {\r\n            settings.x = bounds.x;\r\n            settings.y = bounds.y;\r\n            settings.width = bounds.width;\r\n            settings.height = bounds.height;\r\n        } else { // otherwise use default size in center\r\n            settings.x = Math.round(width / 2 - settings.width / 2);\r\n            settings.y = Math.round(height / 2 - settings.height / 2);\r\n        }\r\n\r\n        // ---- controls ----\r\n\r\n        const xInput = input({\r\n            init: settings.x,\r\n            type: 'number',\r\n            min: 0,\r\n            max: width,\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.x = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const yInput = input({\r\n            init: settings.y,\r\n            type: 'number',\r\n            min: 0,\r\n            max: height,\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.y = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const widthInput = input({\r\n            init: settings.width,\r\n            type: 'number',\r\n            min: 1,\r\n            max: Math.min(maxSize, width),\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.width = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const heightInput = input({\r\n            init: settings.height,\r\n            type: 'number',\r\n            min: 1,\r\n            max: Math.min(maxSize, height),\r\n            css: {width: '100%'},\r\n            callback: function (v) {\r\n                settings.height = Number(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const inputStyle = {\r\n            marginLeft: '5px',\r\n            flex: '1',\r\n        };\r\n        rootEl.append(\r\n            BB.el({\r\n               content: [\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           'X:',\r\n                           xInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           'Y:',\r\n                           yInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           LANG('width') + ':',\r\n                           widthInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n\r\n                   BB.el({\r\n                       tagName: 'label',\r\n                       content: [\r\n                           LANG('height') + ':',\r\n                           heightInput,\r\n                       ],\r\n                       css: inputStyle,\r\n                   }),\r\n               ],\r\n               css: {\r\n                   display: 'flex',\r\n                   marginLeft: '-5px',\r\n               },\r\n            }),\r\n        );\r\n\r\n\r\n        const blendSlider = new KlSlider({\r\n            label: LANG('brush-blending'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 0,\r\n            max: 1,\r\n            value: settings.blend,\r\n            eventResMs: eventResMs,\r\n            onChange: function (val) {\r\n                settings.blend = val;\r\n                updatePreview();\r\n            },\r\n            formatFunc: (val) => {\r\n                return BB.round(val, 2);\r\n            },\r\n            manualInputRoundDigits: 2,\r\n        });\r\n        BB.css(blendSlider.getElement(), {\r\n            margin: '10px 0',\r\n        });\r\n\r\n        rootEl.append(\r\n            blendSlider.getElement(),\r\n        );\r\n\r\n        // ---- preview tabs ----\r\n        let previewMode = 1; // 0 before, 1 after\r\n        const beforeAfterTabs = new TwoTabs({\r\n            left: LANG('compare-before'),\r\n            right: LANG('compare-after'),\r\n            init: previewMode,\r\n            onChange: (val) => {\r\n                previewMode = val;\r\n                overlayCanvas.style.display = val === 0 ? 'block' : 'none';\r\n                updatePreview(true);\r\n            },\r\n        });\r\n        rootEl.append(beforeAfterTabs.getElement());\r\n\r\n        // ---- previews ----\r\n\r\n        const klCanvas = params.klCanvas;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                height: isSmall ? '260px' : '300px',\r\n                marginTop: '0',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const previewLayerArr = layers.map((item, i) => {\r\n            if (i === selectedLayerIndex) {\r\n                return previewLayer;\r\n            } else {\r\n                return {\r\n                    image: item.context.canvas,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                };\r\n            }\r\n        });\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const overlayCanvas = BB.canvas(w, h);\r\n        BB.css(overlayCanvas, {\r\n            position: 'absolute',\r\n            left: '0',\r\n            top: '0',\r\n            mixBlendMode: 'difference',\r\n            imageRendering: 'pixelated',\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(\r\n            klCanvasPreview.getElement(),\r\n            overlayCanvas\r\n        );\r\n        previewWrapper.append(previewInnerWrapper);\r\n        rootEl.append(previewWrapper);\r\n\r\n\r\n        // ---- preview input processing ----\r\n        const inputs: {\r\n            start: IVector2D;\r\n            end: IVector2D;\r\n            oldSettings: TFilterPatternInput;\r\n            state: null | 'move' | 'select';\r\n        } = {\r\n            start: null,\r\n            end: null,\r\n            oldSettings: null,\r\n            state: null,\r\n        };\r\n\r\n        function syncInputs (): void {\r\n            xInput.value = '' + settings.x;\r\n            yInput.value = '' + settings.y;\r\n            widthInput.value = '' + settings.width;\r\n            heightInput.value = '' + settings.height;\r\n        }\r\n\r\n        const keyListener = new BB.KeyListener({\r\n        });\r\n\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        previewInnerWrapper.style.touchAction = 'none';\r\n        const pointerListener = new BB.PointerListener({\r\n            target: previewInnerWrapper,\r\n            onPointer: (event) => {\r\n                if (previewMode === 0) {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (!inputs.state) {\r\n                            inputs.oldSettings = BB.copyObj(settings);\r\n\r\n                            const x = event.relX / previewFactor;\r\n                            const y = event.relY / previewFactor;\r\n\r\n                            if (BB.isInsideRect(\r\n                                {x, y},\r\n                                {x: settings.x, y: settings.y, width: settings.width, height: settings.height},\r\n                            )) {\r\n                                inputs.state = 'move';\r\n                            } else {\r\n                                inputs.state = 'select';\r\n                            }\r\n                            inputs.start = {x, y};\r\n                        }\r\n                    } else if (event.type === 'pointermove') {\r\n\r\n                        const x = event.relX / previewFactor;\r\n                        const y = event.relY / previewFactor;\r\n\r\n                        if (inputs.state === 'select') {\r\n                            inputs.end = {x, y};\r\n\r\n                            const x1 = Math.max(0, Math.min(inputs.start.x, inputs.end.x));\r\n                            const y1 = Math.max(0, Math.min(inputs.start.y, inputs.end.y));\r\n                            const x2 = Math.min(width, Math.max(inputs.start.x, inputs.end.x));\r\n                            const y2 = Math.min(height, Math.max(inputs.start.y, inputs.end.y));\r\n\r\n                            settings.x = Math.floor(x1);\r\n                            settings.y = Math.floor(y1);\r\n                            settings.width = Math.min(maxSize, Math.ceil(x2 - settings.x));\r\n                            settings.height = Math.min(maxSize, Math.ceil(y2 - settings.y));\r\n\r\n                            if (keyListener.isPressed('shift')) {\r\n                                settings.width = Math.min(settings.width, settings.height);\r\n                                settings.height = Math.min(settings.width, settings.height);\r\n                            }\r\n\r\n                            if (settings.width === 0 || settings.height === 0) {\r\n                                settings = BB.copyObj(inputs.oldSettings);\r\n                            }\r\n\r\n                            syncInputs();\r\n                            updatePreview();\r\n                        } else if (inputs.state === 'move') {\r\n                            const dX = Math.round(x - inputs.start.x);\r\n                            const dY = Math.round(y - inputs.start.y);\r\n\r\n                            settings.x = BB.clamp(inputs.oldSettings.x + dX, 0, width - settings.width);\r\n                            settings.y = BB.clamp(inputs.oldSettings.y + dY, 0, height - settings.height);\r\n\r\n                            syncInputs();\r\n                            updatePreview();\r\n                        }\r\n                    } else if (event.type === 'pointerup') {\r\n                        if (inputs.state) {\r\n                            inputs.state = null;\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (event.type === 'pointerdown') {\r\n                        if (!inputs.state) {\r\n                            inputs.state = 'move';\r\n                            inputs.oldSettings = BB.copyObj(settings);\r\n                            inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n                            inputs.end = null;\r\n                        }\r\n                    } else if (event.type === 'pointermove') {\r\n                        if (inputs.state) {\r\n                            inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n\r\n                            settings.offsetX = Math.round(inputs.end.x - inputs.start.x) + inputs.oldSettings.offsetX;\r\n                            settings.offsetY = Math.round(inputs.end.y - inputs.start.y) + inputs.oldSettings.offsetY;\r\n\r\n                            updatePreview();\r\n                        }\r\n                    } else if (event.type === 'pointerup') {\r\n                        if (inputs.state) {\r\n                            if (!inputs.end) {\r\n                                settings.offsetX = 0;\r\n                                settings.offsetY = 0;\r\n                                updatePreview();\r\n                            }\r\n                            inputs.state = null;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n        // ---------- rendering ---------------------\r\n        const fullSizeCanvas = BB.canvas(width, height);\r\n        const fullSizeCtx = BB.ctx(fullSizeCanvas);\r\n\r\n        function sharpStrokeRect (\r\n            context: CanvasRenderingContext2D,\r\n            x: number,\r\n            y: number,\r\n            width: number,\r\n            height: number\r\n        ): void {\r\n            const drawX = Math.round(x + 0.5) - 0.5;\r\n            const drawY = Math.round(y + 0.5) - 0.5;\r\n            const drawWidth = Math.round(x + width - drawX);\r\n            const drawHeight = Math.round(y + height - drawY);\r\n            context.strokeRect(drawX, drawY, drawWidth, drawHeight);\r\n        }\r\n\r\n        function updatePreview (doForce?: boolean) {\r\n            if (!doForce && lastDrawnSettings && JSON.stringify(lastDrawnSettings) === JSON.stringify(settings)) {\r\n                return;\r\n            }\r\n\r\n            if (previewMode === 0) { // before\r\n                fullSizeCtx.clearRect(0, 0, width, height);\r\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\r\n\r\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\r\n                const previewCtx = BB.ctx(previewCanvas);\r\n                previewCtx.save();\r\n                previewCtx.clearRect(0, 0, renderW, renderH);\r\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\r\n                previewCtx.restore();\r\n\r\n                const pW = settings.width * previewFactor;\r\n                const pH = settings.height * previewFactor;\r\n\r\n                const overlayCtx = BB.ctx(overlayCanvas);\r\n                overlayCtx.save();\r\n                overlayCtx.clearRect(0, 0, w, h);\r\n                overlayCtx.strokeStyle = '#fff';\r\n                sharpStrokeRect(\r\n                    overlayCtx,\r\n                    settings.x * previewFactor,\r\n                    settings.y * previewFactor,\r\n                    pW,\r\n                    pH\r\n                );\r\n                if (settings.blend > 0.05) {\r\n                    overlayCtx.strokeStyle = '#f0f';\r\n                    sharpStrokeRect(\r\n                        overlayCtx,\r\n                        settings.x * previewFactor - pW / 2 * settings.blend,\r\n                        settings.y * previewFactor - pH / 2 * settings.blend,\r\n                        pW * (1 + settings.blend),\r\n                        pH * (1 + settings.blend),\r\n                    );\r\n                }\r\n                overlayCtx.restore();\r\n\r\n\r\n\r\n            } else { // after\r\n                fullSizeCtx.clearRect(0, 0, width, height);\r\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\r\n                drawPattern(fullSizeCtx, settings);\r\n\r\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\r\n                const previewCtx = BB.ctx(previewCanvas);\r\n                previewCtx.clearRect(0, 0, renderW, renderH);\r\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\r\n            }\r\n\r\n\r\n            klCanvasPreview.render();\r\n            lastDrawnSettings = BB.copyObj(settings);\r\n        }\r\n\r\n        updatePreview();\r\n\r\n\r\n        // ----- result -------------------\r\n        const result: IFilterGetDialogResult<TFilterPatternInput> = {\r\n            element: rootEl,\r\n            destroy: (): void => {\r\n                blendSlider.destroy();\r\n                keyListener.destroy();\r\n                pointerListener.destroy();\r\n                klCanvasPreview.destroy();\r\n            },\r\n            getInput: () => BB.copyObj(settings),\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterPatternInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const ctx = params.context;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        drawPattern(ctx, params.input);\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'pattern'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterPatternHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {LANG} from '../../language/language';\r\nimport {eventResMs} from './filters-consts';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\r\nimport {Options} from '../ui/components/options';\r\nimport {Checkbox} from '../ui/components/checkbox';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\n\r\n// see fx-canvas distort\r\nexport type TFilterDistortInput = {\r\n    stepSize: number; // [0, inf]\r\n    distortType: 0 | 1 | 2;\r\n    scale: { x: number; y: number };\r\n    strength: { x: number; y: number };\r\n    phase: { x: number; y: number };\r\n};\r\n\r\nexport type TFilterDistortHistoryEntry = TFilterHistoryEntry<\r\n    'distort',\r\n    TFilterDistortInput>;\r\n\r\nexport const filterDistort = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n\r\n        const isSmall = window.innerWidth < 550;\r\n        const rootEl = BB.el({\r\n            content: LANG('filter-distort-description') + '<br><br>',\r\n        });\r\n        const context = params.context;\r\n\r\n        let isSynced = true;\r\n        const settings: TFilterDistortInput = {\r\n            distortType: 0,\r\n            scale: {x: 100, y: 100},\r\n            strength: {x: 20, y: 20},\r\n            phase: {x: 0, y: 0},\r\n            stepSize: 1,\r\n        };\r\n        // let lastDrawnSettings = null;\r\n\r\n        // ---- thumb -------\r\n        const thumbImgArr = [];\r\n        const thumbSize = 32;\r\n        {\r\n            const canvas = BB.canvas(thumbSize, thumbSize);\r\n            const ctx = BB.ctx(canvas);\r\n\r\n            ctx.beginPath();\r\n            ctx.arc(thumbSize / 2, thumbSize / 2, thumbSize / 2.5, 0, Math.PI * 2);\r\n            ctx.fill();\r\n\r\n            let gradient = ctx.createLinearGradient(0, 0, thumbSize, thumbSize);\r\n            gradient.addColorStop(0, '#00f');\r\n            gradient.addColorStop(0.5, '#f00');\r\n            gradient.addColorStop(1, '#fff');\r\n            ctx.fillStyle = gradient;\r\n            ctx.globalCompositeOperation = 'source-atop';\r\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\r\n\r\n            gradient = ctx.createLinearGradient(thumbSize, 0, 0, thumbSize);\r\n            gradient.addColorStop(0, '#000');\r\n            gradient.addColorStop(1, '#000');\r\n            ctx.fillStyle = gradient;\r\n            ctx.globalCompositeOperation = 'destination-atop';\r\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\r\n\r\n            const fxCanvas = getSharedFx();\r\n            const texture = fxCanvas.texture(canvas);\r\n            fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n            const scaleFactor = 20;\r\n\r\n            [0, 1, 2].forEach(item => {\r\n                const thumbImg = new Image();\r\n                const settingsCopy: TFilterDistortSettings = BB.copyObj(settings);\r\n                settingsCopy.distortType = item;\r\n                settingsCopy.scale.x /= scaleFactor;\r\n                settingsCopy.scale.y /= scaleFactor;\r\n                settingsCopy.strength.x /= scaleFactor;\r\n                settingsCopy.strength.y /= scaleFactor;\r\n                fxCanvas.draw(texture).multiplyAlpha().distort(settingsCopy).unmultiplyAlpha().update();\r\n                ctx.clearRect(0, 0, thumbSize, thumbSize);\r\n                ctx.drawImage(fxCanvas, 0, 0);\r\n                thumbImg.src = canvas.toDataURL('image/png');\r\n                thumbImgArr.push(thumbImg);\r\n            });\r\n\r\n            texture.destroy();\r\n        }\r\n\r\n\r\n        // ---- controls ----\r\n\r\n        const topRowEl = BB.el({\r\n            parent: rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n\r\n        const typeOptions = new Options({\r\n            optionArr: thumbImgArr.map((img, index) => {\r\n                BB.css(img, {\r\n                    margin: '1px',\r\n                    borderRadius: '3px',\r\n                    transition: 'all 0.1s ease-in-out',\r\n                });\r\n                return {\r\n                    id: '' + index,\r\n                    label: img,\r\n                };\r\n            }),\r\n            initId: '0',\r\n            onChange: (id) => {\r\n                settings.distortType = Number(id) as any;\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        function sync (from: 'x' | 'y') {\r\n            if (from === 'x') {\r\n                settings.scale.y = settings.scale.x;\r\n                settings.strength.y = settings.strength.x;\r\n                settings.phase.y = settings.phase.x;\r\n\r\n                sliderArr[3].setValue(settings.scale.y);\r\n                sliderArr[4].setValue(settings.strength.y);\r\n                sliderArr[5].setValue(settings.phase.y);\r\n            } else {\r\n                settings.scale.x = settings.scale.y;\r\n                settings.strength.x = settings.strength.y;\r\n                settings.phase.x = settings.phase.y;\r\n\r\n                sliderArr[0].setValue(settings.scale.x);\r\n                sliderArr[1].setValue(settings.strength.x);\r\n                sliderArr[2].setValue(settings.phase.x);\r\n            }\r\n            updatePreview();\r\n        }\r\n\r\n        const syncToggle = new Checkbox({\r\n            init: true,\r\n            label: LANG('filter-distort-sync-xy'),\r\n            callback: (val) => {\r\n                isSynced = val;\r\n                if (isSynced) {\r\n                    sync('x');\r\n                }\r\n            },\r\n        });\r\n\r\n        topRowEl.append(\r\n            typeOptions.getElement(),\r\n            BB.el({css: {flexGrow: '1'}}),\r\n            syncToggle.getElement(),\r\n        );\r\n\r\n        const xyRowEl = BB.el({\r\n            parent: rootEl,\r\n            css: {\r\n                display: 'flex',\r\n                flexWrap: 'wrap',\r\n            },\r\n        });\r\n        const leftCol = BB.el({\r\n            parent: xyRowEl,\r\n            css: {\r\n                marginRight: '10px',\r\n            },\r\n        });\r\n        const rightCol = BB.el({parent: xyRowEl});\r\n\r\n        const sliderWidth = isSmall ? 300 : 245;\r\n        const sliderArr: KlSlider[] = [];\r\n\r\n        ['x', 'y'].forEach((item, index) => {\r\n            const targetEl = index === 0 ? leftCol : rightCol;\r\n\r\n            const scaleSlider = new KlSlider({\r\n                label: LANG('filter-noise-scale') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 1,\r\n                max: 1000,\r\n                curve: 'quadratic',\r\n                value: settings.scale[item],\r\n                eventResMs: eventResMs,\r\n                onChange: (val) => {\r\n                    settings.scale[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item as any);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                },\r\n            });\r\n            scaleSlider.getElement().style.marginTop = '20px';\r\n            targetEl.append(scaleSlider.getElement());\r\n\r\n            const strengthSlider = new KlSlider({\r\n                label: LANG('filter-unsharp-mask-strength') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 0,\r\n                max: 200,\r\n                curve: 'quadratic',\r\n                value: settings.strength[item],\r\n                eventResMs: eventResMs,\r\n                onChange: (val) => {\r\n                    settings.strength[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item as any);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                },\r\n            });\r\n            strengthSlider.getElement().style.marginTop = '10px';\r\n            targetEl.append(strengthSlider.getElement());\r\n\r\n            const phaseSlider = new KlSlider({\r\n                label: LANG('filter-distort-phase') + ' ' + item.toUpperCase(),\r\n                width: sliderWidth,\r\n                height: 30,\r\n                min: 0,\r\n                max: 1,\r\n                value: settings.phase[item],\r\n                manualInputRoundDigits: 2,\r\n                eventResMs: eventResMs,\r\n                formatFunc: (val) => BB.round(val, 2),\r\n                onChange: (val) => {\r\n                    settings.phase[item] = val;\r\n                    if (isSynced) {\r\n                        sync(item as any);\r\n                    } else {\r\n                        updatePreview();\r\n                    }\r\n                },\r\n            });\r\n            phaseSlider.getElement().style.marginTop = '10px';\r\n            targetEl.append(phaseSlider.getElement());\r\n\r\n            sliderArr.push(scaleSlider);\r\n            sliderArr.push(strengthSlider);\r\n            sliderArr.push(phaseSlider);\r\n        });\r\n\r\n        const stepSlider = new KlSlider({\r\n            label: LANG('filter-distort-stepsize'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 1,\r\n            max: 300,\r\n            curve: 'quadratic',\r\n            value: settings.stepSize,\r\n            eventResMs: eventResMs,\r\n            onChange: (val) => {\r\n                settings.stepSize = Math.round(val);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        stepSlider.getElement().style.marginTop = '20px';\r\n        rootEl.append(stepSlider.getElement());\r\n\r\n\r\n        // ---- preview ----\r\n\r\n        const klCanvas = params.klCanvas;\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: isSmall ? '340px' : '540px',\r\n                height: isSmall ? '260px' : '300px',\r\n            },\r\n        });\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return; // todo throw?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).update(); // update fxCanvas size\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: fxCanvas,\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const previewLayerArr = layers.map((item, i) => {\r\n            if (i === selectedLayerIndex) {\r\n                return previewLayer;\r\n            } else {\r\n                return {\r\n                    image: item.context.canvas,\r\n                    opacity: item.opacity,\r\n                    mixModeStr: item.mixModeStr,\r\n                };\r\n            }\r\n        });\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: previewLayerArr,\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n        rootEl.append(previewWrapper);\r\n\r\n        // ---------- rendering ---------------------\r\n\r\n        function updatePreview (): void {\r\n            fxCanvas.draw(texture).multiplyAlpha().distort(settings).unmultiplyAlpha().update();\r\n            klCanvasPreview.render();\r\n        }\r\n\r\n        updatePreview();\r\n\r\n\r\n        // ----- result -------------------\r\n        const result: IFilterGetDialogResult<TFilterDistortInput> = {\r\n            element: rootEl,\r\n            destroy: () => {\r\n                typeOptions.destroy();\r\n                sliderArr.forEach(item => item.destroy());\r\n                stepSlider.destroy();\r\n                syncToggle.destroy();\r\n                texture.destroy();\r\n                klCanvasPreview.destroy();\r\n            },\r\n            getInput: () => BB.copyObj(settings),\r\n        };\r\n        if (!isSmall) {\r\n            result.width = 500;\r\n        }\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterDistortInput>): boolean {\r\n        const klCanvas = params.klCanvas;\r\n        const context = params.context;\r\n        const history = params.history;\r\n        if (!klCanvas || !history) {\r\n            return false;\r\n        }\r\n        history.pause(true);\r\n\r\n        const fxCanvas = getSharedFx();\r\n        if (!fxCanvas) {\r\n            return false; // todo more specific error?\r\n        }\r\n        const texture = fxCanvas.texture(context.canvas);\r\n        fxCanvas.draw(texture).multiplyAlpha().distort(params.input).unmultiplyAlpha().update();\r\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.drawImage(fxCanvas, 0, 0);\r\n        texture.destroy();\r\n\r\n        history.pause(false);\r\n        history.push({\r\n            tool: ['filter', 'distort'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterDistortHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {BB} from '../../bb/bb';\r\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\r\nimport {IFilterApply, IFilterGetDialogParam, IFilterGetDialogResult, IKlBasicLayer, IRGB} from '../kl-types';\r\nimport {LANG} from '../../language/language';\r\nimport {input} from '../ui/components/input';\r\nimport {ColorOptions} from '../ui/components/color-options';\r\nimport {drawVanishPoint} from '../image-operations/draw-vanish-point';\r\nimport {KlSlider} from '../ui/components/kl-slider';\r\nimport {eventResMs} from './filters-consts';\r\nimport {IVector2D} from '../../bb/bb-types';\r\nimport {TFilterHistoryEntry} from './filters';\r\n\r\nexport type TFilterVanishPointInput = {\r\n    x: number;\r\n    y: number;\r\n    lines: number;\r\n    thickness: number;\r\n    color: IRGB;\r\n    opacity: number;\r\n};\r\n\r\nexport type TFilterVanishPointHistoryEntry = TFilterHistoryEntry<\r\n    'vanishPoint',\r\n    TFilterVanishPointInput>;\r\n\r\nexport const filterVanishPoint = {\r\n\r\n    getDialog (params: IFilterGetDialogParam) {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        if (!context || !klCanvas) {\r\n            return false;\r\n        }\r\n\r\n        const layers = klCanvas.getLayers();\r\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\r\n\r\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\r\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\r\n        const renderW = Math.min(w, context.canvas.width);\r\n        const renderH = Math.min(h, context.canvas.height);\r\n        const renderFactor = renderW / context.canvas.width;\r\n        const previewFactor = w / context.canvas.width;\r\n\r\n        const div = document.createElement('div');\r\n        const result: IFilterGetDialogResult<TFilterVanishPointInput> = {\r\n            element: div,\r\n        };\r\n        div.innerHTML = LANG('filter-vanish-point-description') + '<br/><br/>';\r\n\r\n        const settingsObj: TFilterVanishPointInput = {\r\n            x: context.canvas.width / 2,\r\n            y: context.canvas.height / 2,\r\n            lines: 8,\r\n            thickness: 2,\r\n            color: {r: 0, g: 0, b: 0},\r\n            opacity: 1,\r\n        };\r\n\r\n        const linesSlider = new KlSlider({\r\n            label: LANG('filter-vanish-point-lines'),\r\n            width: 300,\r\n            height: 30,\r\n            min: 2,\r\n            max: 20,\r\n            value: settingsObj.lines,\r\n            curve: 'quadratic',\r\n            eventResMs: eventResMs,\r\n            onChange: function (val) {\r\n                settingsObj.lines = Math.round(val);\r\n                updatePreview();\r\n            },\r\n        });\r\n        linesSlider.getElement().style.marginBottom = '10px';\r\n        div.append(linesSlider.getElement());\r\n\r\n        const line1 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n            },\r\n        });\r\n        const line2 = BB.el({\r\n            parent: div,\r\n            css: {\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                marginTop: '10px',\r\n            },\r\n        });\r\n        const xInput = input({\r\n            init: settingsObj.x,\r\n            type: 'number',\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.x = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const yInput = input({\r\n            init: settingsObj.y,\r\n            type: 'number',\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.y = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n        const thicknessInput = input({\r\n            init: 2,\r\n            type: 'number',\r\n            min: 1,\r\n            css: {width: '75px', marginRight: '20px'},\r\n            callback: function (v) {\r\n                settingsObj.thickness = parseFloat(v);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\r\n        const colorOptionsArr = [\r\n            {r: 0, g: 0, b: 0, a: 1},\r\n            {r: 255, g: 255, b: 255, a: 1},\r\n        ];\r\n        colorOptionsArr.push({\r\n            r: params.currentColorRgb.r,\r\n            g: params.currentColorRgb.g,\r\n            b: params.currentColorRgb.b,\r\n            a: 1,\r\n        });\r\n        colorOptionsArr.push({\r\n            r: params.secondaryColorRgb.r,\r\n            g: params.secondaryColorRgb.g,\r\n            b: params.secondaryColorRgb.b,\r\n            a: 1,\r\n        });\r\n        settingsObj.color = BB.copyObj(selectedRgbaObj);\r\n\r\n        const colorOptions = new ColorOptions({\r\n            label: LANG('shape-stroke'),\r\n            colorArr: colorOptionsArr,\r\n            onChange: function (rgbaObj) {\r\n                selectedRgbaObj = rgbaObj;\r\n                settingsObj.color = BB.copyObj(selectedRgbaObj);\r\n                updatePreview();\r\n            },\r\n        });\r\n\r\n        const labelStyle = {\r\n            display: 'inline-block',\r\n            marginRight: '5px',\r\n        };\r\n        line1.append(\r\n            BB.el({content: 'X:', css: labelStyle}),\r\n            xInput,\r\n            BB.el({content: 'Y:', css: labelStyle}),\r\n            yInput,\r\n        );\r\n        line2.append(\r\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\r\n            thicknessInput,\r\n            BB.el({css:{flexGrow: '1'}}),\r\n            colorOptions.getElement(),\r\n        );\r\n\r\n\r\n        const previewWrapper = BB.el({\r\n            className: 'kl-preview-wrapper',\r\n            css: {\r\n                width: '340px',\r\n                height: '220px',\r\n            },\r\n        });\r\n\r\n        const previewLayer: IKlBasicLayer = {\r\n            image: BB.canvas(renderW, renderH),\r\n            opacity: layers[selectedLayerIndex].opacity,\r\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\r\n        };\r\n        const klCanvasPreview = new KlCanvasPreview({\r\n            width: Math.round(w),\r\n            height: Math.round(h),\r\n            layers: layers.map((item, i) => {\r\n                if (i === selectedLayerIndex) {\r\n                    return previewLayer;\r\n                } else {\r\n                    return {\r\n                        image: item.context.canvas,\r\n                        opacity: item.opacity,\r\n                        mixModeStr: item.mixModeStr,\r\n                    };\r\n                }\r\n            }),\r\n        });\r\n\r\n        const previewInnerWrapper = BB.el({\r\n            className: 'kl-preview-wrapper__canvas',\r\n            css: {\r\n                width: parseInt('' + w) + 'px',\r\n                height: parseInt('' + h) + 'px',\r\n                cursor: 'move',\r\n            },\r\n        });\r\n        previewInnerWrapper.append(klCanvasPreview.getElement());\r\n        previewWrapper.append(previewInnerWrapper);\r\n\r\n\r\n\r\n        // ---- preview input processing ----\r\n        const inputs: {\r\n            start: IVector2D;\r\n            end: IVector2D;\r\n            state: null | 'move';\r\n            oldSettings: any;\r\n        } = {\r\n            start: null,\r\n            end: null,\r\n            state: null,\r\n            oldSettings: null,\r\n        };\r\n        function syncInputs (): void {\r\n            xInput.value = '' + settingsObj.x;\r\n            yInput.value = '' + settingsObj.y;\r\n        }\r\n        previewWrapper.oncontextmenu = function () {\r\n            return false;\r\n        };\r\n        previewInnerWrapper.style.touchAction = 'none';\r\n        const pointerListener = new BB.PointerListener({\r\n            target: previewInnerWrapper,\r\n            onPointer: (event) => {\r\n                if (event.type === 'pointerdown') {\r\n                    if (!inputs.state) {\r\n                        inputs.state = 'move';\r\n                        inputs.oldSettings = BB.copyObj(settingsObj);\r\n                        inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n                        inputs.end = null;\r\n                    }\r\n                } else if (event.type === 'pointermove') {\r\n                    if (inputs.state) {\r\n                        inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\r\n\r\n                        settingsObj.x = Math.round(inputs.end.x - inputs.start.x + inputs.oldSettings.x);\r\n                        settingsObj.y = Math.round(inputs.end.y - inputs.start.y + inputs.oldSettings.y);\r\n\r\n                        syncInputs();\r\n                        updatePreview();\r\n                    }\r\n                } else if (event.type === 'pointerup') {\r\n                    if (inputs.state) {\r\n                        inputs.state = null;\r\n                    }\r\n                }\r\n            },\r\n        });\r\n\r\n\r\n\r\n        function updatePreview (): void {\r\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\r\n            ctx.save();\r\n            ctx.clearRect(0, 0, renderW, renderH);\r\n            ctx.drawImage(context.canvas, 0, 0, renderW, renderH);\r\n            drawVanishPoint(\r\n                ctx,\r\n                settingsObj.x * renderFactor,\r\n                settingsObj.y * renderFactor,\r\n                settingsObj.lines,\r\n                Math.max(settingsObj.thickness * renderFactor, 1),\r\n                settingsObj.color,\r\n                settingsObj.opacity,\r\n            );\r\n\r\n            ctx.restore();\r\n            klCanvasPreview.render();\r\n        }\r\n        setTimeout(updatePreview, 0);\r\n\r\n\r\n        div.append(previewWrapper);\r\n        result.destroy = () => {\r\n            linesSlider.destroy();\r\n            pointerListener.destroy();\r\n            klCanvasPreview.destroy();\r\n            colorOptions.destroy();\r\n        };\r\n        result.getInput = function (): TFilterVanishPointInput {\r\n            result.destroy();\r\n            return BB.copyObj(settingsObj);\r\n        };\r\n        return result;\r\n    },\r\n\r\n    apply (params: IFilterApply<TFilterVanishPointInput>): boolean {\r\n        const context = params.context;\r\n        const klCanvas = params.klCanvas;\r\n        const history = params.history;\r\n        if (!context || !klCanvas || !history) {\r\n            return false;\r\n        }\r\n\r\n        history.pause(true);\r\n        drawVanishPoint(\r\n            context,\r\n            params.input.x,\r\n            params.input.y,\r\n            params.input.lines,\r\n            params.input.thickness,\r\n            params.input.color,\r\n            params.input.opacity,\r\n        );\r\n        history.pause(false);\r\n\r\n        history.push({\r\n            tool: ['filter', 'vanishPoint'],\r\n            action: 'apply',\r\n            params: [{\r\n                input: params.input,\r\n            }],\r\n        } as TFilterVanishPointHistoryEntry);\r\n        return true;\r\n    },\r\n\r\n};","import {drawShape} from './shape-tool';\r\nimport {BB} from '../../bb/bb';\r\nimport {IRGB} from '../kl-types';\r\n\r\nexport function drawVanishPoint (\r\n    ctx: CanvasRenderingContext2D,\r\n    x: number,\r\n    y: number,\r\n    lines: number, // int, [2, inf]\r\n    thickness: number, // px\r\n    color: IRGB,\r\n    opacity: number, // 0 - 1\r\n): void {\r\n    ctx.save();\r\n\r\n    const degIncrement = 180 / lines;\r\n    for (let deg = 0; deg < 180; deg += degIncrement) {\r\n        const p2 = BB.rotateAround({x, y}, {x: x + 9999, y}, deg);\r\n        drawShape(\r\n            ctx,\r\n            {\r\n                type: 'line',\r\n                x1: x,\r\n                y1: y,\r\n                x2: p2.x,\r\n                y2: p2.y,\r\n                //angleRad: 0,\r\n                isOutwards: true,\r\n                opacity,\r\n                //isEraser: false,\r\n                strokeRgb: color,\r\n                lineWidth: thickness,\r\n                //doLockAlpha: false,\r\n            }\r\n        );\r\n    }\r\n\r\n    ctx.restore();\r\n}","import {KL} from '../kl';\r\nimport {KlCanvas} from '../canvas/kl-canvas';\r\nimport {Psd} from 'ag-psd/dist/psd';\r\nimport {loadAgPsd} from './load-ag-psd';\r\n\r\nexport async function klCanvasToPsdBlob (klCanvas: KlCanvas): Promise<Blob> {\r\n    const layerArr = klCanvas.getLayersFast();\r\n\r\n    const psdConfig: Psd = {\r\n        width: klCanvas.getWidth(),\r\n        height: klCanvas.getHeight(),\r\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\r\n        children: layerArr.map(item => {\r\n            // todo - can be optimized if layer mostly empty\r\n            return {\r\n                name: item.name,\r\n                opacity: item.opacity,\r\n                canvas: item.canvas,\r\n                blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\r\n                left: 0,\r\n                top: 0,\r\n            };\r\n        }),\r\n    };\r\n\r\n    const agPsd = await loadAgPsd();\r\n    const buffer = agPsd.writePsdBuffer(psdConfig);\r\n    return new Blob([buffer], { type: 'application/octet-stream' });\r\n}","import {BB} from '../../bb/bb';\r\nimport {IDrawMoveEvent, TDrawEvent} from '../kl-types';\r\n\r\n/**\r\n * Line smoothing. EventChain element. Smoothing via blending new position with old position.\r\n * for onDraw events from KlCanvasWorkspace.\r\n *\r\n * in some draw event\r\n * out some draw event\r\n *\r\n * type: 'line' Events are just passed through.\r\n */\r\nexport class LineSmoothing {\r\n\r\n    private chainOut: ((drawEvent: TDrawEvent) => void) | undefined;\r\n    private smoothing: number;\r\n    private lastMixedInput: {\r\n        x: number;\r\n        y: number;\r\n        pressure: number;\r\n    } | undefined;\r\n    private interval: ReturnType<typeof setInterval> | undefined;\r\n    private timeout: ReturnType<typeof setTimeout> | undefined;\r\n\r\n    // --- public ---\r\n    constructor (\r\n        p: {\r\n            smoothing: number; // 0-1, 0: no smoothing, 1: 100% smoothing -> would never catch up\r\n        }\r\n    ) {\r\n        this.smoothing = BB.clamp(p.smoothing, 0, 1);\r\n    }\r\n\r\n    chainIn (event: TDrawEvent): TDrawEvent | null {\r\n        event = BB.copyObj(event);\r\n        this.timeout && clearTimeout(this.timeout);\r\n        this.interval && clearInterval(this.interval);\r\n\r\n        if (event.type === 'down') {\r\n            this.lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure,\r\n            };\r\n        }\r\n\r\n        if (event.type === 'move') {\r\n\r\n            const inputX = event.x;\r\n            const inputY = event.y;\r\n            const inputPressure = event.pressure;\r\n\r\n            event.x = BB.mix(event.x, this.lastMixedInput!.x, this.smoothing);\r\n            event.y = BB.mix(event.y, this.lastMixedInput!.y, this.smoothing);\r\n            event.pressure = BB.mix(event.pressure, this.lastMixedInput!.pressure, this.smoothing);\r\n            this.lastMixedInput = {\r\n                x: event.x,\r\n                y: event.y,\r\n                pressure: event.pressure,\r\n            };\r\n\r\n            if (this.smoothing > 0) {\r\n                this.timeout = setTimeout(() => {\r\n                    this.interval = setInterval(() => {\r\n                        event = JSON.parse(JSON.stringify(event)) as IDrawMoveEvent;\r\n\r\n                        event.x = BB.mix(inputX, this.lastMixedInput!.x, this.smoothing);\r\n                        event.y = BB.mix(inputY, this.lastMixedInput!.y, this.smoothing);\r\n                        event.pressure = BB.mix(inputPressure, this.lastMixedInput!.pressure, this.smoothing);\r\n                        this.lastMixedInput = {\r\n                            x: event.x,\r\n                            y: event.y,\r\n                            pressure: event.pressure,\r\n                        };\r\n\r\n                        this.chainOut && this.chainOut(event);\r\n                    }, 35);\r\n                }, 80);\r\n            }\r\n\r\n        }\r\n\r\n        return event;\r\n    }\r\n\r\n    setChainOut (func: (drawEvent: TDrawEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    setSmoothing (s: number): void {\r\n        this.smoothing = BB.clamp(s, 0, 1);\r\n    }\r\n}\r\n","import {TDrawEvent} from '../kl-types';\r\n\r\n/**\r\n * cleans up DrawEvents. More trustworthy events. EventChain element\r\n *\r\n * in some draw event?\r\n * out some draw event?\r\n *\r\n * that events can only go line this: down -> n x move -> up\r\n * so, sanitizes this: down, down, down. becomes only one down. the other downs are ignored/swallowed\r\n */\r\nexport class LineSanitizer {\r\n\r\n    private chainOut: ((drawEvent: TDrawEvent) => void) | undefined;\r\n    private isDrawing: boolean = false;\r\n\r\n    // --- public ---\r\n\r\n    chainIn (event: TDrawEvent): TDrawEvent | null {\r\n\r\n        if (event.type === 'down') {\r\n            if (this.isDrawing) {\r\n                //console.log('line sanitizer - down, but already drawing');\r\n                this.chainOut && this.chainOut({\r\n                    type: 'up',\r\n                    scale: event.scale,\r\n                    shiftIsPressed: event.shiftIsPressed,\r\n                    isCoalesced: false,\r\n                });\r\n            } else {\r\n                this.isDrawing = true;\r\n            }\r\n        }\r\n        if (!this.isDrawing && (event.type === 'move' || event.type === 'up')) {\r\n            //console.log('line sanitizer - ' + event.type + ' but not drawing');\r\n            return null;\r\n        }\r\n\r\n        if (event.type === 'up' && this.isDrawing) {\r\n            this.isDrawing = false;\r\n        }\r\n\r\n        return event;\r\n    }\r\n\r\n    setChainOut (func: (drawEvent: TDrawEvent) => void): void {\r\n        this.chainOut = func;\r\n    }\r\n\r\n    getIsDrawing (): boolean {\r\n        return this.isDrawing;\r\n    }\r\n}\r\n","/**\r\n * from stabilizer dropdown value to linesmoothing value\r\n * @param s\r\n */\r\nexport function translateSmoothing (s: number): number {\r\n    if (s == 1) {\r\n        return 1 - 0.5;\r\n    }\r\n    if (s == 2) {\r\n        return 1 - 0.16;\r\n    }\r\n    if (s == 3) {\r\n        return 1 - 0.035;\r\n    }\r\n    if (s == 4) {\r\n        return 1 - 0.0175;\r\n    }\r\n    if (s == 5) {\r\n        return 1 - 0.00875;\r\n    }\r\n    return s;\r\n}","import {IKlPsd, IRGB, TDropOption, TKlCanvasLayer} from '../klecks/kl-types';\r\nimport {KL} from '../klecks/kl';\r\nimport {LANG} from '../language/language';\r\nimport {BB} from '../bb/bb';\r\nimport {klHistory, TMiscImportImageHistoryEntry} from '../klecks/history/kl-history';\r\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\r\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\r\nimport {HandUi} from '../klecks/ui/tool-tabs/hand-ui';\r\nimport {LayerManager} from '../klecks/ui/tool-tabs/layer-manager/layer-manager';\r\nimport {IRect, ISize2D} from '../bb/bb-types';\r\n\r\n// todo later:\r\n// onImage: (project: IKlProject) => void\r\n// onLayer: (index: number, canvas: HMTLCanvasElement,layerName: string) => void\r\n\r\nexport class ImportHandler {\r\n\r\n    private readonly klRootEl: HTMLElement;\r\n    private readonly klMaxCanvasSize: number;\r\n    private readonly layerManager: LayerManager;\r\n    private readonly setCurrentLayer: (layer: TKlCanvasLayer) => void;\r\n    private readonly klCanvas: KlCanvas;\r\n    private readonly klCanvasWorkspace: KlCanvasWorkspace;\r\n    private readonly handUi: HandUi;\r\n\r\n    private readonly onColor: (rgb: IRGB) => void;\r\n\r\n\r\n    /**\r\n     *\r\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\r\n     * @param filename - string e.g. 'drawing.psd'\r\n     * @param optionStr? - 'default' | 'layer' | 'image'\r\n     */\r\n    private importFinishedLoading (\r\n        importedImage: IKlPsd | {\r\n            type: 'image';\r\n            width: number;\r\n            height: number;\r\n            canvas: HTMLCanvasElement | HTMLImageElement;\r\n        },\r\n        filename: string | undefined,\r\n        optionStr: 'default' | 'layer' | 'image',\r\n    ): void {\r\n        if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'error',\r\n                message: LANG('import-broken-file'),\r\n                buttons: ['Ok'],\r\n            });\r\n            return;\r\n        }\r\n\r\n        const getResizedDimensions = (width: number, height: number): ISize2D => {\r\n            let w = parseInt('' + width);\r\n            let h = parseInt('' + height);\r\n            if (w > this.klMaxCanvasSize) {\r\n                h = this.klMaxCanvasSize / w * h;\r\n                w = this.klMaxCanvasSize;\r\n            }\r\n            if (h > this.klMaxCanvasSize) {\r\n                w = this.klMaxCanvasSize / h * w;\r\n                h = this.klMaxCanvasSize;\r\n            }\r\n            w = parseInt('' + w);\r\n            h = parseInt('' + h);\r\n            return {\r\n                width: w,\r\n                height: h,\r\n            };\r\n        };\r\n\r\n        const importAsImage = (canvas: HTMLCanvasElement | HTMLImageElement) => {\r\n            const resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\r\n\r\n            //resize first\r\n            const tempCanvas = BB.canvas(canvas.width, canvas.height);\r\n            const tempCanvasCtx = BB.ctx(tempCanvas);\r\n            tempCanvasCtx.drawImage(canvas, 0, 0);\r\n\r\n            BB.resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\r\n\r\n            this.klCanvas.reset({\r\n                width: resizedDimensions.width,\r\n                height: resizedDimensions.height,\r\n                image: tempCanvas,\r\n                layerName: filename,\r\n            });\r\n\r\n            this.layerManager.update(0);\r\n            this.setCurrentLayer(this.klCanvas.getLayer(0));\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        };\r\n\r\n        /**\r\n         *\r\n         * @param convertedPsdObj - if flattened then without layers\r\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\r\n         */\r\n        const importAsImagePsd = (convertedPsdObj: IKlPsd, cropObj?: IRect) => {\r\n\r\n            // crop\r\n            const crop = (\r\n                targetCanvas: HTMLCanvasElement,\r\n                cropCanvas: HTMLCanvasElement,\r\n                cropObj: IRect,\r\n            ): void => {\r\n                cropCanvas.width = cropCanvas.width;\r\n                BB.ctx(cropCanvas).drawImage(targetCanvas, -cropObj.x, -cropObj.y);\r\n                targetCanvas.width = cropObj.width;\r\n                targetCanvas.height = cropObj.height;\r\n                BB.ctx(targetCanvas).drawImage(cropCanvas, 0, 0);\r\n            };\r\n            if (cropObj && (cropObj.width !== convertedPsdObj.width ||cropObj.height !== convertedPsdObj.height)) {\r\n                const cropCanvas = BB.canvas(cropObj.width, cropObj.height);\r\n                convertedPsdObj.width = cropObj.width;\r\n                convertedPsdObj.height = cropObj.height;\r\n\r\n                if (!convertedPsdObj.layers) {\r\n                    crop(convertedPsdObj.canvas, cropCanvas, cropObj);\r\n                }\r\n                if (convertedPsdObj.layers) {\r\n                    for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                        const item = convertedPsdObj.layers[i];\r\n                        crop(item.image, cropCanvas, cropObj);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // resize\r\n            const resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\r\n            convertedPsdObj.width = resizedDimensions.width;\r\n            convertedPsdObj.height = resizedDimensions.height;\r\n            if (!convertedPsdObj.layers) {\r\n                BB.resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\r\n            }\r\n            if (convertedPsdObj.layers) {\r\n                for (let i = 0; i < convertedPsdObj.layers.length; i++) {\r\n                    const item = convertedPsdObj.layers[i];\r\n                    BB.resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\r\n                }\r\n            }\r\n\r\n            let layerIndex;\r\n            if (convertedPsdObj.layers) {\r\n                layerIndex = this.klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    layers: convertedPsdObj.layers,\r\n                });\r\n            } else {\r\n                layerIndex = this.klCanvas.reset({\r\n                    width: convertedPsdObj.width,\r\n                    height: convertedPsdObj.height,\r\n                    image: convertedPsdObj.canvas,\r\n                });\r\n            }\r\n            this.layerManager.update(layerIndex);\r\n            this.setCurrentLayer(this.klCanvas.getLayer(layerIndex));\r\n            this.klCanvasWorkspace.resetView();\r\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\r\n        };\r\n\r\n        const importAsLayer = (canvas: HTMLCanvasElement | HTMLImageElement) => {\r\n            KL.showImportAsLayerDialog({\r\n                target: this.klRootEl,\r\n                klCanvas: this.klCanvas,\r\n                importImage: canvas,\r\n                callback: (transformObj, isPixelated: boolean) => {\r\n                    if (!transformObj) {\r\n                        return;\r\n                    }\r\n\r\n                    klHistory.pause(true);\r\n                    this.klCanvas.addLayer();\r\n                    const layers = this.klCanvas.getLayers();\r\n                    const activeLayerIndex = layers.length - 1;\r\n                    if (filename) {\r\n                        this.klCanvas.renameLayer(activeLayerIndex, filename);\r\n                    }\r\n                    const activeLayerContext = this.klCanvas.getLayerContext(activeLayerIndex);\r\n                    BB.drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, null, isPixelated);\r\n                    this.setCurrentLayer(this.klCanvas.getLayer(activeLayerIndex));\r\n                    this.layerManager.update(activeLayerIndex);\r\n\r\n                    klHistory.pause(false);\r\n\r\n                    klHistory.push({\r\n                        tool: ['misc'],\r\n                        action: 'importImage',\r\n                        params: [BB.copyCanvas(activeLayerContext.canvas), filename],\r\n                    } as TMiscImportImageHistoryEntry);\r\n                },\r\n            });\r\n        };\r\n\r\n\r\n        if (optionStr === 'default' || !optionStr) {\r\n            KL.showImportImageDialog({\r\n                image: importedImage,\r\n                target: this.klRootEl,\r\n                maxSize: this.klMaxCanvasSize,\r\n                callback: (res) => {\r\n                    if (res.type === 'as-image') {\r\n                        importAsImage(res.image);\r\n                    } else if (res.type === 'as-image-psd') {\r\n                        importAsImagePsd(res.image, res.cropObj);\r\n                    } else if (res.type === 'as-layer') {\r\n                        importAsLayer(res.image);\r\n                    } else if (res.type === 'cancel') {\r\n                        // nothing to do\r\n                    }\r\n                },\r\n            });\r\n        }\r\n\r\n        if (optionStr === 'layer') {\r\n            importAsLayer(importedImage.canvas);\r\n        }\r\n        if (optionStr === 'image') {\r\n            if (importedImage.type === 'psd') {\r\n                importAsImagePsd(importedImage);\r\n            } else {\r\n                importAsImage(importedImage.canvas);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    // ---- public ----\r\n    constructor (\r\n        input: {\r\n            klRootEl: HTMLElement;\r\n            klMaxCanvasSize: number;\r\n            layerManager: LayerManager;\r\n            setCurrentLayer: (layer: TKlCanvasLayer) => void;\r\n            klCanvas: KlCanvas;\r\n            klCanvasWorkspace: KlCanvasWorkspace;\r\n            handUi: HandUi;\r\n        },\r\n        callback: {\r\n            onColor: (rgb: IRGB) => void;\r\n        }\r\n    ) {\r\n        this.klRootEl = input.klRootEl;\r\n        this.klMaxCanvasSize = input.klMaxCanvasSize;\r\n        this.layerManager = input.layerManager;\r\n        this.setCurrentLayer = input.setCurrentLayer;\r\n        this.klCanvas = input.klCanvas;\r\n        this.klCanvasWorkspace = input.klCanvasWorkspace;\r\n        this.handUi = input.handUi;\r\n\r\n        this.onColor = callback.onColor;\r\n    }\r\n\r\n\r\n\r\n    // ---- interface ----\r\n\r\n    onPaste (e: ClipboardEvent): void{\r\n        if (KL.dialogCounter.get() > 0) {\r\n            return;\r\n        }\r\n\r\n        const retrieveImageFromClipboardAsBlob = (\r\n            items: DataTransferItemList,\r\n            callback: (file: File) => void,\r\n        ) => {\r\n            if (!items) {\r\n                return;\r\n            }\r\n            for (let i = 0; i < items.length; i++) {\r\n                if (items[i].type.indexOf('image') == -1) {\r\n                    continue;\r\n                }\r\n                const file = items[i].getAsFile();\r\n                file && callback(file);\r\n            }\r\n        };\r\n\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (!e.clipboardData) {\r\n            return;\r\n        }\r\n\r\n        if (e.clipboardData.files[0]) {\r\n            retrieveImageFromClipboardAsBlob(e.clipboardData.items, (imageBlob) => {\r\n                // If there's an image, display it in the canvas\r\n                const img = new Image();\r\n                img.onload = () => {\r\n                    URL.revokeObjectURL(img.src);\r\n                    this.importFinishedLoading({\r\n                        type: 'image',\r\n                        width: img.width,\r\n                        height: img.height,\r\n                        canvas: img,\r\n                    }, undefined, 'default');\r\n                };\r\n                const URLObj = window.URL || window.webkitURL;\r\n                img.src = URLObj.createObjectURL(imageBlob);\r\n            });\r\n        } else if (e.clipboardData.items[0]) {\r\n            e.clipboardData.items[0].getAsString((pasteStr) => {\r\n                pasteStr = pasteStr.trim();\r\n                if (pasteStr.match(/^https?/)) {\r\n                    // url\r\n                    const img = new Image();\r\n                    img.onload = () => {\r\n                        this.importFinishedLoading({\r\n                            type: 'image',\r\n                            width: img.width,\r\n                            height: img.height,\r\n                            canvas: img,\r\n                        }, undefined, 'default');\r\n                    };\r\n                    img.onerror = (e) => {\r\n                        console.log('error loading', e);\r\n                    };\r\n                    img.crossOrigin = 'Anonymous';\r\n                    img.src = pasteStr;\r\n\r\n                } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\r\n                    // url\r\n                    const rgbObj = BB.ColorConverter.hexToRGB(pasteStr.replace('#', ''));\r\n                    rgbObj && this.onColor(rgbObj);\r\n                }\r\n            });\r\n\r\n        }\r\n    }\r\n\r\n    handleFileSelect (files: FileList, optionStr: TDropOption): void {\r\n\r\n        const showWarningPsdFlattened = () => {\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                type: 'warning',\r\n                message: LANG('import-psd-unsupported') + '<br /><br />',\r\n                buttons: ['Ok'],\r\n            });\r\n        };\r\n\r\n        let hasUnsupportedFile = false;\r\n        for (let i = 0, file; file = files[i]; i++) {\r\n            const nameSplit = file.name.split('.');\r\n            const extension = nameSplit[nameSplit.length - 1].toLowerCase();\r\n            if (extension === 'psd') {\r\n\r\n                ((f) => {\r\n                    const loaderSizeBytes = 1024 * 1024 * 25; // 25mb\r\n                    const maxSizeBytes = 1024 * 1024 * 1024; // 1gb\r\n                    const maxResolution = 4096;\r\n\r\n                    if (f.size >= maxSizeBytes) { // pretty likely to break stuff\r\n                        KL.popup({\r\n                            target: this.klRootEl,\r\n                            type: 'error',\r\n                            message: 'File too big. Unable to import.<br /><br />',\r\n                            buttons: ['Ok'],\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    const doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\r\n                    let loaderIsOpen = true;\r\n                    let closeLoader: (() => void) | null;\r\n\r\n                    if (doShowLoader) {\r\n                        KL.popup({\r\n                            target: this.klRootEl,\r\n                            message: LANG('import-opening'),\r\n                            callback: (result) => {\r\n                                loaderIsOpen = false;\r\n                                closeLoader = null;\r\n                            },\r\n                            closeFunc: (f) => {\r\n                                closeLoader = f;\r\n                            },\r\n                        });\r\n                    }\r\n\r\n\r\n                    const reader = new FileReader();\r\n                    reader.onload = (readerResult) => {\r\n\r\n                        KL.loadAgPsd().then((agPsdLazy) => {\r\n\r\n                            if (doShowLoader && !loaderIsOpen) {\r\n                                return;\r\n                            }\r\n\r\n                            try {\r\n                                let psd;\r\n\r\n                                // first pass, only read metadata\r\n                                psd = agPsdLazy.readPsd(\r\n                                    (readerResult.target.result as any),\r\n                                    {\r\n                                        skipLayerImageData: true,\r\n                                        skipThumbnail: true,\r\n                                        skipCompositeImageData: true,\r\n                                    });\r\n                                if (psd.width > maxResolution || psd.height > maxResolution) {\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    KL.popup({\r\n                                        target: this.klRootEl,\r\n                                        type: 'error',\r\n                                        message: LANG('import-psd-too-large').replace(/{x}/g, '' + maxResolution)\r\n                                            + '<br /><br />'\r\n                                            + LANG('import-psd-size') + ': ' + psd.width + ' x ' + psd.height + ' pixels'\r\n                                            + '<br /><br />'\r\n                                        ,\r\n                                        buttons: ['Ok'],\r\n                                    });\r\n                                    return;\r\n                                }\r\n\r\n\r\n                                // second pass, now load actual data.\r\n                                psd = null;\r\n\r\n                                try {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any));\r\n                                } catch (e) {\r\n                                    //console.log('failed regular psd import', e);\r\n                                }\r\n                                if (psd) {\r\n                                    //console.log('psd', psd);\r\n                                    const convertedPsd = KL.PSD.readPsd(psd);\r\n                                    //console.log('converted', convertedPsd);\r\n                                    if (optionStr === 'image' && convertedPsd.error) {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    this.importFinishedLoading(convertedPsd, f.name, optionStr);\r\n                                } else {\r\n                                    psd = agPsdLazy.readPsd((readerResult.target.result as any), { skipLayerImageData: true, skipThumbnail: true });\r\n                                    if (optionStr === 'image') {\r\n                                        showWarningPsdFlattened();\r\n                                    }\r\n\r\n                                    if (closeLoader) {\r\n                                        closeLoader();\r\n                                    }\r\n                                    this.importFinishedLoading({\r\n                                        type: 'psd',\r\n                                        width: psd.width,\r\n                                        height: psd.height,\r\n                                        canvas: psd.canvas,\r\n                                        error: true,\r\n                                    }, f.name, optionStr);\r\n                                }\r\n\r\n                            } catch (e) {\r\n                                closeLoader && closeLoader();\r\n                                KL.popup({\r\n                                    target: this.klRootEl,\r\n                                    type: 'error',\r\n                                    message: 'Failed to load PSD.<br /><br />',\r\n                                    buttons: ['Ok'],\r\n                                });\r\n                                console.log(e);\r\n                                setTimeout(() => {\r\n                                    throw new Error('psd load error');\r\n                                });\r\n                            }\r\n                        }).catch((e) => {\r\n                            closeLoader && closeLoader();\r\n                            alert('Error: failed to load PSD library');\r\n                        });\r\n\r\n                    };\r\n                    reader.readAsArrayBuffer(f);\r\n                })(file);\r\n\r\n            } else if (file.type.match('image.*')) {\r\n                ((f) => {\r\n                    window.URL = window.URL || window.webkitURL;\r\n                    const url = window.URL.createObjectURL(f);\r\n                    const im = new Image();\r\n                    im.src = url;\r\n                    BB.loadImage(im, () => {\r\n                        this.importFinishedLoading({\r\n                            type: 'image',\r\n                            width: im.width,\r\n                            height: im.height,\r\n                            canvas: im,\r\n                        }, f.name, optionStr);\r\n                    });\r\n                })(file);\r\n            } else {\r\n                hasUnsupportedFile = true;\r\n            }\r\n        }\r\n        if (hasUnsupportedFile) {\r\n            KL.popup({\r\n                target: this.klRootEl,\r\n                message: LANG('import-unsupported-file'),\r\n                type: 'error',\r\n                buttons: ['OK'],\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\n\r\n","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"kycpJ\");","module.exports = require('./helpers/bundle-url').getBundleURL('dafOa') + require('./helpers/bundle-manifest').resolve(\"TzbtI\");","import {IVector2D} from '../bb/bb-types';\r\n\r\n\r\n\r\nexport type TConsoleApi = {\r\n    readonly draw: (path: IVector2D[]) => void;\r\n    readonly help: () => void;\r\n};\r\n\r\nexport function createConsoleApi (\r\n    p: {\r\n        onDraw: (path: IVector2D[]) => void;\r\n    }\r\n): TConsoleApi {\r\n\r\n    const output = ['Draw via the console! Learn more: %cKL.help()', 'background: #000; color: #0f0;'];\r\n    'info' in console ? console.info(...output) : console.log(...output);\r\n\r\n    return Object.freeze({\r\n        draw: (path: IVector2D[]): void => {\r\n            p.onDraw(path);\r\n        },\r\n        help: (): void => {\r\n            console.log(`KL.draw({x: number; y: number}[]) // draw a line\r\nKL.help() // print help\r\n`);\r\n        },\r\n    });\r\n}"],"names":["$3kC7t","parcelRequire","$d2fa9a947070c225$export$a84540bc8b694b2d","p","klApp","agPsd","onProjectReady","project","isInitialized","Error","saveReminder","$5ngYX","SaveReminder","$gWfkn","klHistory","isDrawing","$3C7jC","KlApp","bottomBar","aboutEl","embed","url","embedUrl","onSubmit","init","loadingScreenEl","parentNode","removeChild","loadingScreenTextEl","document","body","append","getEl","e","textContent","className","console","error","psdQueue","getElementById","$1mH1z","LANG","this","openProject","initError","getPNG","getPSD","default","_state","sent","readPSDs","psds","length","readItem","item","psd","readPsd","blob","$941rU","klPsdToKlProject","callback","forEach","$iVf04","loadAgPsd","shift","push","Element","prototype","Object","defineProperty","value","x","y","scrollLeft","scrollTop","Array","flat","configurable","depth","isNaN","arguments","Number","reduce","call","acc","cur","isArray","apply","slice","writable","window","getItem","setItem","removeItem","t","n","createDocumentFragment","Node","appendChild","createTextNode","String","Document","DocumentFragment","hasOwnProperty","enumerable","insertBefore","firstChild","padStart","repeat","findIndex","r","TypeError","o","i","$iUR3L","importFilters","$cf5d938ee512ebca$export$96f6458b62e4c2c","pProject","pOptions","_pOptions_app","$7U0Ew","$3WOmu","klCanvasToPsdBlob","_this1","klCanvas","klMaxCanvasSize","Math","min","max","screen","width","height","uiState","$6l0gQ","LocalStorage","filenameBase","app","projectStore","klRootEl","$eWjiX","BB","el","css","position","left","top","right","bottom","uiWidth","innerWidth","uiHeight","innerHeight","exportType","$hrnUX","KL","KlCanvas","projectObj","collapseThreshold","toolWidth","setHistory","mainTabRow","initState","reset","layers","layer","image","pause","addLayer","layerFill","$fohxs","ERASE_COLOR","g","b","canvas","copy","focus","getLayerCount","brushes","message","destroy","entries","param","_param","Brush","setContext","getLayerContext","currentBrushUi","currentBrushId","lastNonEraserBrushId","currentColor","RGB","currentLayerCtx","sizeWatcher","val","brushSettingService","emitSize","_this","klCanvasWorkspace","setCursorSize","BrushSettingService","color","klColorSlider","setColor","copyObj","size","setSize","opacity","setOpacity","getColor","brushUiMap","getSize","getOpacity","sizeSlider","brushesUI","opacitySlider","lineSmoothing","$iuTWx","LineSmoothing","smoothing","$aId1u","translateSmoothing","lineSanitizer","$57YJz","LineSanitizer","drawEventChain","EventChain","chainArr","setChainOut","event","type","toolspace","style","pointerEvents","startLine","pressure","requestFrame","goLine","isCoalesced","setLastDrawEvent","endLine","getBrush","drawLineSegment","x0","y0","x1","y1","textToolSettings","align","isBold","isItalic","font","KlCanvasWorkspace","onDraw","chainIn","onPick","rgbObj","isDragDone","pickingDone","setMode","toolspaceToolRow","getActive","onFill","canvasX","canvasY","layerIndex","getLayerIndex","floodFill","fillUi","getIsEraser","getTolerance","getSample","getGrow","getContiguous","onGradient","typeStr","angleRad","gradientTool","onDown","onMove","onUp","onText","dialogCounter","get","textToolDialog","secondaryColor","getSecondaryRGB","onConfirm","colorRGBA","a","text","textStr","ColorConverter","toRgbaStr","onShape","shapeTool","onViewChange","viewChangeObj","changed","includes","statusOverlay","out","scale","angleDeg","angle","PI","setEnableZoomIn","getMaxScale","setEnableZoomOut","getMinScale","handUi","update","onUndo","canUndo","undoRedoCatchup","undo","onRedo","canRedo","redo","overlayToolspace","toolspaceTopRow","updateMainTabVisibility","activeStr","oldTabId","getOpenedTabId","keysArr","keys","draw","hand","fill","gradient","shape","setIsVisible","open","keyListener","KeyListener","keyStr","comboStr","isInputFocused","getIsDrawing","zoomByStep","isPressed","fitView","resetView","preventDefault","sameKeys","saveToComputer","save","success","_$e","store","getProject","setTimeout","copyToClipboard","comboOnlyContains","translateView","setAngle","getScale","getAngleDeg","decreaseSize","increaseSize","eraserBrush","getIsTransparentBg","clearLayer","setActive","brushTabRow","prevMode","getMode","keyArr","filter","getNextBrushId","newMode","swapColors","ui","Ui","onSizeChange","onOpacityChange","emitOpacity","onConfigChange","emitSliderConfig","getElement","padding","StatusOverlay","overflow","userSelect","touchAction","toolspaceInner","parent","oncontextmenu","onclick","handleClick","toolspaceCollapser","ToolspaceCollapser","onChange","updateCollapse","OverlayToolspace","enabledTest","$jmL5A","EmbedToolspaceTopRow","onHelp","$h62LS","showIframeModal","popup","target","buttons","result","overlay","content","onLeftRight","updateUi","ToolspaceTopRow","logoImg","onLogo","onNew","showNewImageDialog","onImport","fileTab","triggerImport","onSave","onShare","shareImage","marginBottom","ToolspaceToolRow","onActivate","onZoomIn","onZoomOut","setIsSmall","addListener","setEnableUndo","setEnableRedo","KlColorSlider","svHeight","startValue","p_color","emitColor","setHeight","setPickCallback","doPick","setCurrentLayer","context","layerPreview","setLayer","brushDiv","colorDiv","margin","display","flexWrap","justifyContent","alignItems","toolspaceStabilizerRow","ToolspaceStabilizerRow","onSelect","v","setSmoothing","getOutputElement","TabRow","initialId","useAccent","tabArr","createTab","id","title","tooltip","onOpen","brushId","enable","onClose","concat","$4Ea8f","map","HandUi","onReset","onFit","onAngleChange","isRelative","FillUi","colorSlider","gradientUi","GradientUi","textUi","TextUi","shapeUi","ShapeUi","GradientTool","isDone","x2","y2","settings","getSettings","gradientObj","color1","isReversed","doLockAlpha","isEraser","doSnap","setComposite","drawGradient","ctx","ShapeTool","shapeObj","getShape","isOutwards","getIsOutwards","getDoLockAlpha","strokeRgb","lineWidth","getLineWidth","isAngleSnap","getIsSnap","isFixedRatio","getIsFixed","fillRgb","drawShape","layerManager","LayerManager","getLayer","tool","action","params","LayerPreview","onClick","filterTab","FilterTab","UndoRedoCatchup","catchup","newImageDialog","maxCanvasSize","canvasWidth","getWidth","canvasHeight","getHeight","workspaceWidth","workspaceHeight","onCancel","shareCanvas","getCompleteCanvas","fileName","getDate","SaveToComputer","showCrop","clipboardDialog","inputObj","filterLib","cropExtend","input","history","FileTab","files","optionsStr","importHandler","handleFileSelect","imgurUpload","imgurKey","settingsTab","SettingsTab","$parcel$interopDefault","$8dsYZ","minWidth","$4sBxW","isVisible","$6iPxE","$fZtJh","$eOZOu","$haxur","$i7SrA","label","show","hide","$fX22P","bottomBarWrapper","MutationObserver","updateBottomBar","observe","attributes","childList","subtree","undefined","toolspaceScroller","ToolspaceScroller","$qur3y","createConsoleApi","path","index","resize","$iG6pP","ImportHandler","onColor","rgb","KlImageDropper","onDrop","optionStr","addEventListener","onPaste","windowResizeWatcher","zIndex","ResizeObserver","prevent","key","setDirection","isOpen","setWide","scrollHeight","classList","toggle","setUiState","updateUiState","w","h","scrollY","scrollTo","msg","$2wCWz","base64ToBlob","toDataURL","$3wEFn","$1ac26b9c3b886816$export$2e2bcd8739ae039","arr","$8XIsj","$jBmMa","$hhqk6","$apgdg","$46241077d0115b39$export$2e2bcd8739ae039","$4deb7017c774789d$export$2e2bcd8739ae039","$9cbe98d1fb398012$export$6e4a713ddcda1e5e","$dAXbp","$3P46L","$7pyBK","$705qg","drawProject","$aSJRf","WorkspaceSvgOverlay","$7bo3M","$lV6Vy","KlCanvasPreview","$i5nyl","filterLibStatus","$kyVjY","$6rdi0","renderText","$h20yl","floodFillBits","$30Cml","$3ujzu","$7EG77","PSD","setDbName","$9BlwZ","indexedDb","ProjectStore","$6mTnI","$eyygR","calcSliderFalloffFactor","$11glk","Checkbox","$7bWhB","$dJPtW","Select","$eEL9N","ImageToggle","$1kyaA","ImageRadioList","$4nUqS","RadioList","$fRGIf","createPenPressureToggle","$lCF5N","KlSlider","$aP0jf","HexColorDialog","$lfHl9","$fg9Sv","KlColorSliderSmall","$gmji4","PointSlider","$j5jvd","ColorOptions","$43qNf","Options","$iFIyy","BoxToggle","$cmnov","$bmB93","CropCopy","$hRdOL","FreeTransform","$cNhNm","FreeTransformCanvas","$kEeSq","Cropper","$32CBv","$kqmpc","$13r5y","$9p4Zp","$8jqzp","ToolDropdown","$84zxV","$9Kxky","$1Ax5m","$e4sAN","$1uc3b","BrowserStorageUi","$9pcu9","$iVHpg","$i8UFO","$2MaaK","showModal","Popup","$dLlkc","DynamicModal","$isYih","showImportAsLayerDialog","$8ebuX","$76Qvv","$keKW3","showImportImageDialog","$kDGzx","showIframePopup","$5ENro","$khi8I","$dJXmR","$5Gc7M","$iS9xS","$9J17G","$eK8ID","$2umOB","$bIgqE","$jMW1P","DecoyKlHistory","$gFgFC","$b60fce38973759d6$var$historyInstance","$b60fce38973759d6$export$2a772a91f059c0f9","$b60fce38973759d6$export$28b6f4d98dde9845","KlHistory","state","listeners","pauseStack","maxState","actionNumber","l","newEntry","pop","lastEntry","maxBefore","broadcast","bufferUpdate","$7jh4K","throwIfNull","$c902829f68f42bce$export$d7e8d4d4450c819c","close","isClosed","clearSelection","unfocusAnyInput","rootRootEl","decrease","destroyEl","xButton","bgEl","rootEl","removeEventListener","wheelPrevent","btnElArr","splice","increase","scrollContent","minHeight","flexDirection","ignoreBackground","tagName","$6ToP3","titleHeight","lineHeight","background","boxShadow","boxClasses","boxEl","div","marginRight","join","flex","add","autoFocus","clickOnEnterBtn","stopPropagation","click","buttonRowEl","marginTop","marginLeft","buttonName","iconUrl","btnClasses","primaries","$d2FVM","iconImg","custom","src","btn","clickOnEnter","closeFunc","$dd0d395ff14a3e11$export$17eb8275e0c4cab8","DialogCounter","count","emit","listener","$05ec456c8871d48f$export$921068d8846a1559","eventUsesHighResTimeStamp","$6J2My","hasPointerEvents","isCssMinMaxSupported","canShareFiles","insertAfter","loadImage","setAttributes","fitInto","centerWithin","gcd","decToFraction","imageBlobToUrl","dateDayDifference","createSvg","BbLog","$i0uIf","isDark","mix","$eg83P","dist","distSquared","lenSquared","pointsToAngleRad","pointsToAngleDeg","isInsideRect","clamp","rotate","rotateAround","Matrix","$kVHNC","Vec2","$4toIY","intDxy","roundEven","roundUneven","round","updateBounds","boundsInArea","projectPointOnLine","$af1iA","PointLine","BezierLine","SplineInterpolator","quadraticSplineInput","$eelgW","createCanvas","$eIcQa","copyCanvas","testShouldPixelate","drawTransformedImageWithBounds","drawTransformedImageOnCanvas","createCheckerCanvas","createCheckerDataUrl","resizeCanvas","convertToAlphaChannelCanvas","freeCanvas","canvasBounds","HSV","$dJ1E2","CMYK","testIsWhiteBestContrast","appendTextDiv","$72Jv0","makeUnfocusable","$idV3L","PointerListener","$04lDo","$gCzYB","DoubleTapper","$c1lmK","NFingerTapper","$2pgVs","PinchZoomer","$joplQ","CoalescedExploder","$jjWRi","OnePointerLimiter","$635F6","test","$878b1f179a521546$export$b7d78993b74f766d","navigator","userAgent","toLowerCase","indexOf","$878b1f179a521546$export$4ec3bfbae69fbb50","Event","timeStamp","$878b1f179a521546$export$b7b64c480b083ae0","PointerEvent","$878b1f179a521546$export$fe0a7220ab4eecad","createElement","offsetLeft","$878b1f179a521546$export$558f5e20caee48c2","keyDown","keyUp","blur","keyStrToKeyObj","keyStrArr","isDownObj","keyToKeyStrObj","comboArr","codeIsDownObj","listenerArr","emitDown","emitUp","emitBlur","$74d1f29ad2137b2c$var$globalKey","code","oldComboStr","eventArr","space","alt","ctrl","cmd","enter","esc","backspace","delete","sqbr_open","sqbr_close","c","f","s","u","z","plus","minus","up","down","home","end","d","keyListenerRef","first","remove","last","getIsDown","getCombo","$74d1f29ad2137b2c$export$f17908c5de22d32e","onBlur","ref","$74d1f29ad2137b2c$export$e9f65b0175de4c03","comboAStr","comboBStr","split","sort","$893e90c2dcf687ac$var$pointerArr","$893e90c2dcf687ac$var$getButtonStr","$893e90c2dcf687ac$var$pressureNormalizer","$eIAon","PressureNormalizer","$893e90c2dcf687ac$var$timeStampOffset","performance","timing","navigationStart","$893e90c2dcf687ac$var$pointerDownEvt","$893e90c2dcf687ac$var$pointerMoveEvt","$893e90c2dcf687ac$var$pointerUpEvt","$893e90c2dcf687ac$var$pointerCancelEvt","$893e90c2dcf687ac$var$pointerLeaveEvt","$893e90c2dcf687ac$var$pointerEnterEvt","$893e90c2dcf687ac$var$correctPointerEvent","corrected","correctedObj","pointerId","pointerType","pageX","pageY","clientX","clientY","movementX","movementY","normalize","button","coalescedArr","eventPreventDefault","eventStopPropagation","customPressure","isFirefox","coalescedEventArr","getCoalescedEvents","pointerObj","$893e90c2dcf687ac$var$getPointer","lastPageX","lastPageY","$893e90c2dcf687ac$var$addPointer","totalLastX","totalLastY","eventItem","$893e90c2dcf687ac$export$9371bd96776f4e82","targetElement","onPointerCallback","onPointer","onWheelCallback","onWheel","onEnterLeaveCallback","onEnterLeave","maxPointers","wheelCleaner","$93oLo","WheelCleaner","cleanerEvent","isDestroyed","bounds","getBoundingClientRect","whlEvent","$a7ch7","$3Rl3W","relX","relY","onPointerMove","correctedEvent","tempLastPointerType","lastPointerType","dragPointerIdArr","didSkip","outEvent","createPointerOutEvent","onPointerDown","onSkipGlobal","dragObjArr","setupDocumentListeners","dragObj","downPageX","downPageY","lastTimeStamp","windowOnPointerMove","getDragObj","outEvent1","destroyDocumentListeners","removeDragObj","windowOnPointerUp","windowOnPointerLeave","touchToFakePointer","touch","touchEvent","isDown","identifier","handleTouch","changedTouches","fakePointer","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel","process","onPointerEnter","isOverCounter","onPointerLeave","fixScribble","onTouchMoveScribbleFix","removedDragObj","dX","dY","time","coalescedItem","$42238a223231ec71$export$c734b8535f2f8e38","knownUnitArr","sequenceLength","sequenceUnit","toEmitDelta","delta","deltaY","endSequenceTimeout","clearTimeout","endSequence","deltaMode","absDelta","abs","$e14d50e39929aa54$export$61f95f4b79132931","avgPressure","normalizeIsComplete","normalizeFactor","pow","$9a5bdb07e7a7c42f$export$2c9e8a9632a706b2","$9a5bdb07e7a7c42f$export$6c4a311cc157c764","ax","ay","bx","by","sqrt","$9a5bdb07e7a7c42f$export$499eb56409f6cbc2","$9a5bdb07e7a7c42f$export$a4f99f99d3e99cfa","$9a5bdb07e7a7c42f$export$627023b405ba5028","p1","p2","atan2","$9a5bdb07e7a7c42f$export$c03a8450eabc2532","$9a5bdb07e7a7c42f$export$151bd845d70e2099","rect","$9a5bdb07e7a7c42f$export$7d15b64cf5a3a4c4","num","$9a5bdb07e7a7c42f$export$bb628a54ab399bc9","deg","theta","cs","cos","sn","sin","$9a5bdb07e7a7c42f$export$95ec0760d3d00713","center","point","rot","$9a5bdb07e7a7c42f$export$bbf9af158036c5e9","remainder","fDx","fDy","$9a5bdb07e7a7c42f$export$94cce7adf2ec2d08","above","ceil","below","floor","$9a5bdb07e7a7c42f$export$f373b6a7b0c159a","$9a5bdb07e7a7c42f$export$2077e0241d6afd3c","digits","digitMult","$9a5bdb07e7a7c42f$export$f4467a4f41373bc7","$9a5bdb07e7a7c42f$export$bbb91bbc54e7d9ac","$3f0e2f35371c9852$export$dd0873c0fb3ccff6","resultCanvas","getContext","drawImage","$3f0e2f35371c9852$export$39f92e86d1722f3a","$3f0e2f35371c9852$export$1555f643cc9a976","transform","scaleX","scaleY","whSwapped","$3f0e2f35371c9852$export$ded2b43392504635","destCtx","transformImage","pixelated","imageSmoothingEnabled","imageSmoothingQuality","translate","restore","$3f0e2f35371c9852$export$425a419ef9fc761f","baseCanvas","transformObj","angleDegree","cache","$3f0e2f35371c9852$export$754559b36e94ea2f","fillStyle","fillRect","$3f0e2f35371c9852$export$42af33c76b681867","create","parseInt","modeStr","$3f0e2f35371c9852$export$59b33278b5b2fc8a","tmp1","tmp2","oldW","oldH","newW","newH","ew","eh","base2","oldWidthEx","log2","oldHeightEx","newWidthEx","newHeightEx","buffer1","buffer2","bufferCtx","globalCompositeOperation","currentWidth","currentHeight","newWidth","newHeight","tmp","canvasCtx","tmp1Ctx","$3f0e2f35371c9852$export$5a7576952c826b4f","imdat","getImageData","data","putImageData","$3f0e2f35371c9852$export$2384aff49c9b73c2","clearRect","$3f0e2f35371c9852$export$3db033c6ee0b8700","boundsObj","tempBounds","$44dda2e48e48a872$export$cd3d1f114b139967","$e4df33b4b16105d5$var$multiplyMatrixAndPoint","matrix","$e4df33b4b16105d5$export$5b12bf1653c0dd85","freeze","getIdentity","multiplyMatrixAndPoint","multiplyMatrices","matrixA","matrixB","row0","row1","row2","row3","result0","result1","result2","result3","createTranslationMatrix","createRotationMatrix","createScaleMatrix","$531c9f41f98b7ec0$export$ac4bca90992eed1","sub","nor","len","mul","dot","aArr","bArr","m","$77ae015f37ebe4f1$export$b4c5b177db876445","lineStart","lineEnd","$77ae015f37ebe4f1$export$8b36a4a83269a640","segmentArr","points","getLength","fac","$77ae015f37ebe4f1$export$5379d955c16d4d43","pointArr","p3","p4","resolution","curvePoints","spacing","controlsCallback","lastPoint","dir","lastDot","lastSpacing","pointM1","pointM2","pointM3","pointLine","getBezierPoints","tempSpacing","getAtDist","lastCallbackPoint","dAngle","lastAngle","newP","$77ae015f37ebe4f1$export$80967b1eb9fd6eb4","xa","ya","wx","sig","ddydx","klo","khi","k","tempX","tempY","interpolate","tempDist","$77ae015f37ebe4f1$export$4551d4af86c1eb08","startVal","endVal","stepSize","dec","resultArr","$5e7aac2fa49b6b1f$export$d2edaecd208aed43","$5e7aac2fa49b6b1f$export$8f9ece5a47764b93","$5e7aac2fa49b6b1f$export$89d3f85304bf0767","$5e7aac2fa49b6b1f$export$fb7efcd2e153af6e","_RGBtoHSV","minVal","maxVal","del_R","del_G","del_B","_HSVtoRGB","var_h","var_i","var_1","var_2","var_3","var_r","var_g","var_b","_CMYKtoRGB","_RGBtoCMYK","toRGB","toHSV","toCMYK","toHexString","ha","toString","hb","hc","toRgbStr","rgbaObj","hexToRGB","hexStr","trim","replace","exec","$5e7aac2fa49b6b1f$export$5cf396345d1238ae","$cfe3aa45a75894cc$export$7868464f598ba79d","innerHTML","$cfe3aa45a75894cc$export$906dfdb7df31ccfc","_document_activeElement","getAll","activeElement","getAttribute","$cfe3aa45a75894cc$export$e05240ca9e0b8bd9","focusEl","select","$cfe3aa45a75894cc$export$a3d02541b0ebf605","getSelection","sel","empty","removeAllRanges","selection","preventFocus","$cfe3aa45a75894cc$export$6bd63bfceaafae0c","didFocusRelated","relatedTarget","currentTarget","setAttribute","$cfe3aa45a75894cc$var$els","$cfe3aa45a75894cc$export$c3da0dad1b44eea9","customKeyArr","$cfe3aa45a75894cc$export$b1da1db524e22115","$0d0e99c175410ac4$export$9860cd9e09e6f8ba","$9e5fd8359d8b22f2$export$19fffca37ef3e106","localStorage","$d2c9f6aa6c7498f1$export$fe11e0afe623a677","func","chainOut","eventCopy","$cc27951506e6ad28$export$510622b8aed00381","now","firstLastDownTimeout","tapTimeout","fingers","onTap","eventQueueArr","timeoutObj","fingerArr","timeoutStr","timeMS","diff","nowTime","failGesture","tempLastEventTime","lastEventTime","pointersDownIdArr","maxFirstLastFingerDownMs","downTimeMs","minSilenceBeforeDurationMs","firstDownTime","setupTimeout","maxTapMs","fingerObj","i1","maxPressedDistancePx","fingerObj1","i2","isUp","allAreUp","i3","processEvent","$670d2777518c365a$export$d62358ac2d82abb3","secondFingerTimeout","onPinch","gestureObj","doSwallow","fail","touchPointerArr","isInProgress","continuePinch","beginPinch","otherPointerIdArr","downRelX","downRelY","setupFailTimeout","untilSecondFingerDurationMs","endPinch","touchPointerObj","firstFingerMaxDistancePx","pincherArr","actionObj","startDist","distance","startAngle","$f607ef98ce9eccdc$export$db3963a21c01d803","maxUntilSecondDown","onDoubleTap","gestureFailed","sequenceArr","lastSequenceItem","targetFunc","allowedPointerTypeArr","lastUpTime","allowedButtonArr","maxInbetweenDistancePx","maxUntilSecondDownDurationMs","maxPressedDurationMs","maxUpToUpDurationMs","minSilenceAfterMs","$956c5ff01a38849f$export$71ff2f51bf1f4062","ignorePointerIdArr","downPointerId","$4fb7927cde0b2f75$export$649a211db9812745","continueChain","onscroll","module","exports","getBundleURL","resolve","$e59fbd08bcc1a36b$export$185108a9b725b68","animationName","animationDuration","animationTimingFunction","popupEl","borderRadius","updatePos","elW","offsetWidth","elH","offsetHeight","titleEl","paddingLeft","tabindex","contentEl","$365a915dfb503274$export$48513f6b9f8ce62d","doHighlight","element","innerEl","check","checked","allowTab","tabIndex","allowClick","onchange","$f18fe37a308c53fd$export$b7e3ae3d7c15e42e","$7a3263857aacf58f$export$ef9b1a59e592288f","selectEl","cursor","fontSize","isFocusable","optionArr","changeListener","getValue","initValue","option","option1","$8fa94d142febb502$export$b6d053cded550773","isActive","darkInvert","backgroundImage","isRadio","$8cb981a3c9e5b15b$export$7cc1012a658e6ad8","initialIndex","createOption","initId","radioEl","activeIndex","setValue","$a49c90053f8766a2$export$9da2e8821e6cbb57","isChecked","changeCallback","$8IsQq","backgroundSize","backgroundRepeat","$afe02cc26c765c2c$export$2358c75ad3c15b2d","$5c0625e6104e2c75$export$a1855b925e534de7","isEnabled","manualInputRoundDigits","useSpline","curve","elementWidth","elementHeight","toValue","toDisplayValue","displayValueToValue","displayValue","valueToDisplayValue","isChangeOnFinal","formatFunc","eventResMs","curveArr","splineInterpolator","sliderWrapperEl","labelFontSize","textEl","control","valueToSliderValue","controlInner","updateEnable","doubleTapper","showManualInput","setAllowedButtonArr","virtualVal","eventChain","pointerListenerTimeout","pointerListener","sliderValue","sliderValueToValue","updateLabel","deltaX","sliderValue1","findX","toLocaleString","languageStrings","getCode","isFinal","emitInterval","clearInterval","emitValue","setInterval","manualInput","setIsEnabled","$869o9","KlSliderManualInput","config","isDisabled","$16ee6d1163eaf409$export$f8e41e222e32615d","isRightButton","$068903cd1342554f$export$db3d4fde05db9a5e","roundDigits","currentValue","onblur","privateOnClose","scrollBefore","scrollX","lastValue","$dada52d673c8c4ac$export$cc42e119007cb939","createRgbInputRow","labelStr","attributeStr","rowEl","labelEl","inputEl","lastValidRgb","parseFloat","previewEl","hexInput","hexRowEl","hexLabel","rgbArr","copyButton","$bJupx","execCommand","resultStr","$0ebf4eb3a9343b24$export$4e5102252876c5d7","outputDiv","primaryColorRGB","primaryColorHSV","secondaryColorRGB","secondaryColorHSV","svWrapper","svSvg","DOMParser","parseFromString","documentElement","hueStop","querySelector","divH","divPreview","controlH","updateSVCanvas","SVContainer","pointerSV","updateSVPointer","borderLeft","virtualHSV","pickerButton","$6fV2b","backgroundPosition","isPicking","pickCallback","isOver","hexButton","setColPreview","targetEl","im","Image","cv","gradH","createLinearGradient","col","addColorStop","createHueBg","factor","secondaryColorBtn","updateSecondaryColor","hsv","backgroundColor","updatePrimaryHSV","$00f785a5ea9e210d$export$e4203cb02d5e5b28","theme","$3ce0af1e789f1ab4$export$66306bf21a9ff39e","heightSV","canvasSV","updateSV","canvasH","heightH","cssFloat","pointerH","borderRight","updateHPointer","svPointerId","svPointerListener","hPointerId","hPointerListener","clear","gradient1","colleft","colright","$5e81242a941997c7$export$ac00cea56cec3037","sliderPos","pointSize","sliderPoint","isFirst","imaginaryPos","redrawPoint","$4db8cbbb01889095$export$24ba9b81662d4366","selectedIndex","colorArr","buttonArr","checkerUrl","$1C8RU","found","sItem","colorButton","buttonSize","setIsSelected","updateCheckerboard","addIsDarkListener","removeIsDarkListener","$7960d0c50ff12b0d$export$c019608e5b5bb4cb","wrapperEl","selectedId","classArr","isSmall","optionObj","changeOnInit","getIndex","$c1a93a3cd82636c9$export$5ee0af1d5c87e856","removeProperty","isWide","angleIm","$gGQwz","verticalAlign","innerInnerEl","doPulse","animation","timeout3","timeout","timeout2","$01fcd0ed15aa4018$export$40175a5948a88a57","resetCrop","croppedCanvas","eventTarget","isNotCopy","croppedImage","updateCroppedCanvas","previewWrapper","thumbSize","thumbCanvas","imageRendering","scaleW","scaleH","thumbCtx","thumbX","thumbY","selectionRect","updateSelectionRect","startP","updateCropTimeout","toOriginalSpace","genCrop","topLeftP","bottomRightP","origTopLeftP","origBottomRightP","startCrop","isDragging","didMove","isReset","crop","doUpdate","shiftIsPressed","$ffd40240385bb9f9$export$32b89bc9bb92706a","fullCanvas","cropCallback","output","toClipboard","imgURL","cropCopy","getCroppedImage","err","fetch","clipboard","write","ClipboardItem","name","clipboardItemIsSupported","topWrapper","textAlign","KeyEvent","rectObj","getRect","$82406ffdc1235dbb$export$eff87c52915dd7fe","parentEl","layerElArr","layerHeight","layerSpacing","largeThumbDiv","border","transition","largeThumbCanvas","largeThumbInDocument","klCanvasLayerArr","getLayers","selectedSpotIndex","listDiv","layerListEl","addBtn","duplicateBtn","mergeBtn","removeBtn","modeWrapper","renameBtn","paddingRight","$hWVsV","$5Ycub","$jKBKm","$auzYC","$1Qqvs","MAX_LAYERS","disabled","createLayerList","duplicateLayer","removeLayer","$6NMo1","mergeLayerDialog","topCanvas","bottomCanvas","topOpacity","mixModeStr","mode","mergeLayers","renameLayer","modeSelect","$bBcC4","translateBlending","setMixMode","historyState","getState","oldHistoryState","spot","thumb","oldSpotIndex","newSpotIndex","posy","posY","moveLayer","newspot","lastpos","layerSpot","$jneUH","renameLayerDialog","newName","createLayerEntry","layerName","layercanvas","innerLayer","container1","container2","oldOpacity","thumbDimensions","thc","whiteSpace","ondblclick","opacityLabel","isLast","layerOpacity","onpointerover","largeThumbInTimeout","largeThumbTimeout","onpointerout","dragstart","freshSelection","isSelected","activateLayer","updateLayersVerticalPosition","posToSpot","newSpot","oldSpot","move","child","updateHeight","activeLayerSpotIndex","spotIndex","stateStr","$0621fc8724f6bfac$var$allowedMixModes","$0621fc8724f6bfac$export$9f4f73b1bd7c2f26","$0621fc8724f6bfac$export$4a819bde91671014","layerNrOffset","layerCanvasArr","pickCanvas","changeListenerArr","origLayers","updateIndices","toCopyCanvas","algorithm","layerCanvas","offX","offY","ctemp","layerCtx","fillColor","selected","isLayerLimitReached","doReturnNull","emitChange","temp","targetIndex","layerBottomIndex","layerTopIndex","globalAlpha","isHorizontal","isVertical","tempCtx","colorObj","compositeOperation","tolerance","sampleStr","grow","isContiguous","srcCtx","srcImageData","srcData","targetCtx","targetImageData","targetData","srcCanvas","srcIndex","imageData","canvasObj","imData","compositeObj","$7069db2f5e23d00f$var$fillRect","$7069db2f5e23d00f$var$mx","$7069db2f5e23d00f$var$my","$7069db2f5e23d00f$var$moveIndex","$7069db2f5e23d00f$var$testAndFill","srcArr","targetArr","initRgba","$7069db2f5e23d00f$export$13d50f258a8034f","rgbaArr","Uint8Array","ArrayBuffer","px","py","q","tl","tr","br","bl","$7069db2f5e23d00f$var$floodFill","$01d7180c5d1d0fdf$export$27550cc14d7ae85a","downX","downY","downAngleRad","$01d7180c5d1d0fdf$export$71b514a25c47df50","colorRGB","strokeStyle","r1","r2","pAngleDeg","pAngleDegSnapped","rotated","r11","r21","rx","ry","rdX","rdY","x1r","y1r","x2r","y2r","x1f","y1f","x2f","y2f","beginPath","moveTo","lineTo","stroke","x1f1","y1f1","x2f1","y2f1","strokeRect","ellipse","$fdc12d72a3df9be9$export$482c90f94eb9717c","outer","fontFamily","fontWeight","fontStyle","spanStr","children","offsetTop","el1","fillText","innerText","isDebug","$089586a542a12f27$export$5f63a7b18dc4503a","$5e45fa121ba5050f$export$74d12f09ff9f1956","$5e45fa121ba5050f$export$b1f70a113e3b5c1b","baseColor","color2","createRadialGradient","$2f1281ced73ab1dc$export$6e1bedb2a6cdff30","blendMode","codes","darken","multiply","lighten","difference","exclusion","hue","saturation","luminosity","$f3c4df6b644f6a61$export$28debfc111084e87","currentName","row","clearBtn","suggestions","suggestionBtns","$c8f65770493ffd93$export$ee79aceabae6bb8a","preview","options","spacer","alphaCanvas","next","previous","$d256278b259ca979$export$6b9252711ea5997f","rootElement","elementType","brushCircleOuter","brushCircleInner","pickerPreviewBorder","pickerPreviewCol","compassSize","compass","compassInner","compassBaseCircle","cx","cy","compassLineCircle","compassUpperTriangle","compassLowerTriangle","radius","borderColor","$d492af58f4721011$var$TMode","TMode","$d492af58f4721011$var$MIN_SCALE","$d492af58f4721011$var$MAX_SCALE","$d492af58f4721011$export$6eaf6f7c0cc177fc","renderTargetCanvas","renderTargetCtx","renderWidth","renderHeight","compositeCanvas","compositeCtx","doResizeCanvas","oldTransformObj","targetTransformObj","highResTransformObj","renderedTransformObj","cursorPos","usesCssCursor","bgVisible","transformIsDirty","doAnimateTranslate","svgOverlay","lastRenderedState","reqFrame","emptyCanvas","emptyLightCanvas","isRepeat","currentInputProcessor","onKeyDown","Draw","Pick","Fill","Gradient","Text","Shape","globalMode","inputProcessorObj","spaceHand","Hand","altPicker","zoom","onKeyUp","updateChangeListener","currentMode","renderTime","lastDrawEvent","linetoolProcessor","$dpBaO","LinetoolProcessor","getMatrix","art","getRenderedTransform","coords","pressure1","matrix1","coords1","pressure0","coords2","pointer","updateCursor","getComboStr","resetInputProcessor","coord","workspaceToCanvasCoord","HandGrabbing","Zoom","offsetX","offsetY","internalZoomByStep","picker","pickedColor","getColorAt","updateColorPreview","Rotating","Rotate","centerObj","startAngleRad","dAngleRad","minimizeAngleRad","origin","angleIsExtraSticky","pinchZoomer","snapAngleRad","mainDoubleTapper","middleDoubleTapper","twoFingerTap","threeFingerTap","pointerEventChain","wheelEvent","brushRadius","animationFrameRequested","lastRenderTime","requestAnimationFrame","updateLoop","addChangeListener","modeInt","doForce","oldMode","$eZ2aJ","$7QZIi","$bz6iQ","$kE5UF","oldIsHand","currentIsHand","setAllowedPointerTypeArr","stepNum","centerX","centerY","newStep","newScale","effectiveFactor","transformA","transformB","blendFactor","centerPosA","canvasToWorkspaceCoord","centerPosB","mixedPos","renderContext","workspacePointArr","borderSize","layerArr","getLayersFast","updateCompass","snapDegIncrement","maxDistDeg","modDeg","doRedrawCanvas","newState","doRender","elapsedFrames","checkChange","testBgVisible","mixTransformObj","start","render","klC","oldWidth","oldHeight","diameter","hideBrushCursorTimeout","doAnimate","newAngle","canvasPointsArr","boundsWidth","boundsHeight","newTargetTransformObj","oldAngleRad","tx","ty","$7752bf3fb7f240e9$export$d429e21f52463d17","downEvent","direction","eventQueue","$6faa9d948ec87f40$export$e258ade1648009b7","$0370167ee97a20d9$export$79a74567acf241b0","corners","isConstrained","snapX","snapY","snappingEnabled","ratio","transEl","boundsEl","pointerRemainder","isInverted","boundsStartP","boundsPointerListener","snap","iP","minSnapDist","distX","distY","$lt7cS","toImageSpace","j","projected","dist1","snapToPixel","updateCornerPositions","updateDOM","gripSize","virtualPos","offsetArr","tinyOffset","scaled","cornerCursors","constrainCorner","snapCorner","tP","toTransformSpace","indexes","updateTransformViaCorners","updateScaled","edges","edgeSize","angleOffset","tfD","ti","dimension","restoreRatio","angleGrip","$5cYet","anglePointerListener","offset","snapDeg","iX","iY","_snap_x","_snap_y","e1","cornerIndex","flip","widthChanged","heightChanged","angle90","newHeight1","skipCallback","transformOrigin","copyTransform","$6c5cb3001c773523$export$958c2bfe8d7142a9","$6c5cb3001c773523$export$234b1c16dfa57d6a","$6c5cb3001c773523$export$6a4549ec4168874a","$6c5cb3001c773523$export$3fba3b383c654cc6","$48f5d87739d28bf9$export$205c2dd29f8a66b5","imageWidth","imageHeight","previewFit","transformIndex","innerWrapper","previewLayerArr","klCanvasPreview","transformSize","initTransform","freeTransform","updatePreview","getTransform","destCanvas","setPos","setAngleDeg","fit","$de496a1759b04ed9$export$71ed2b85d4ca43d3","maxW","maxH","gripCursors","outline","grips","outlinePointerListener","_BB_intDxy","commit","thirdsHorizontal","borderTop","borderBottom","thirdsVertical","gripOverlay","transformTop","transformRight","transformBottom","transformLeft","edge0PointerListener","edge1PointerListener","edge2PointerListener","edge3PointerListener","cornerElArr","corner0PointerListener","corner1PointerListener","corner2PointerListener","corner3PointerListener","$18e69c7d4cb991e8$export$d25420b53e16716f","largeCanvasAnimationTimeout","canvasSize","largeCanvasSize","lastDrawnState","lastDrawnSize","animationCanvas","animationCanvasCtx","animationLength","animationCount","largeCanvasIsVisible","contentWrapperEl","canvasWrapperEl","nameWrapper","flexGrow","nameLabelEl","clickableEl","opacityEl","largeCanvasWrapper","webkitTouchCallout","largeCanvas","largeCanvasCtx","updateCheckerPatterns","layerObj","removeLargeCanvas","drawLargeCanvas","largeCanvasAnimationDurationMs","showLargeCanvas","checker","animationCanvasCheckerPattern","createPattern","largeCanvasCheckerPattern","animate","canvasDimensions","isInstant","currentState","klCanvasLayerObj","$e3dfa43019bc3f08$export$962af7e240721d88","freeTransformCanvas","noteEl","originalSizeBtn","fitSizeBtn","setTransformFit","centerBtn","setTransformCenter","importImage","buttonStr","getTransformation","getIsPixelated","$01cb8095758db224$export$e789742143ba5b1","paddingTop","textShadow","optionStyle","optionLayerEl","optionImageEl","rootCounter","optionLayerCounter","optionImageCounter","testAcceptType","dataTransfer","types","updateOptions","$d6fe881e8fc421ac$export$9f0da9b942594e99","sizeObj","queuedObj","colorEl","selectedColorEl","subscriptionFunc","initialColor","updateColor","subscribe","sliderConfig","getSliderConfig","updateUI","mousePos","$6003e73b8cbb69e2$export$665d2c76b1eb8459","createButton","extraPadding","contain","logoButton","$kX3t5","newButton","$frUlg","importButton","$7qUeg","saveButton","$g2tQ8","shareButton","$cmBTx","helpButton","$8pc1M","$18c597dee53260ff$export$a0a40f8a0b8fee15","imArr","titleArr","currentActiveIndex","openTimeout","startX","startY","showDropdown","elementFromPoint","dropdownBtnArr","wrapper","closeDropdown","updateButton","activeButton","boxSizing","activeButtonIm","arrowButton","$32WFC","dropdownWrapper","borderBottomLeftRadius","borderBottomRightRadius","createDropdownButton","smallMargin","onClickDropdownBtn","$a372d78c806cd0cc$export$c744a22bef9e0b97","currentActiveStr","doLighten","doMirror","createTriangleButton","svg","viewBox","preserveAspectRatio","defs","childrenArr","in","stdDeviation","dx","dy","in2","operator","k2","k3","svgTriangleLeft","class","onLeft","svgTriangleRight","onRight","leftPointerListener","rightPointerListener","leftIm","leftImage","rightIm","rightImage","setIsEnabledLeft","setIsEnabledRight","toolDropdown","handButton","zoomInNOutButton","$fORLP","$kRxRZ","zoomInButton","zoomOutButton","undoNRedoButton","$5ZTVn","undoButton","redoButton","doEmit","$90c04b5ac185bf3d$export$8162a66cd18867a7","strengthSelect","setDeltaValue","$d04d72b97d637d65$export$3c6d17ed0106bfb9","roundRight","roundSize","$fqSj0","roundLeft","pTabObj","openedTabObj","activeTab","initTabObj","tab","tabId","$9934467c988b088a$export$cf20160367bae46c","scaleEl","angleEl","resetButton","fitButton","leftRotateButton","$6Dvin","resetAngleButton","rightRotateButton","pIsVisible","pScale","$51d47356d698ffec$export$1e63e3b0645421a2","toleranceSlider","selectRow","growWrapper","growSelect","contiguousToggle","eraserToggle","$d06987f550ff485e$export$32a22540e4b2f123","$45c003c723de07b5$export$a9387b1d4260d39c","previewSize","rectStrokeSvgRect","rectStrokeSvg","rectFilledSvgRect","rectFilledSvg","ellipseStrokeSvgEllipse","ellipseStrokeSvg","ellipseFilledSvgEllipse","ellipseFilledSvg","lineSvgLine","lineSvg","updatePreviews","strokeWidth","lineWidthSlider","fixedToggle","previewPadding","snapToggle","shapeOptions","lockAlphaToggle","outwardsToggle","$4fb68589de8a8c9a$export$f77a89101d7d6586","createRatioSize","ratioX","ratioY","updateRatio","widthInput","heightInput","commonRatios","reducedArr","closestRatio","closestDistance","ratioWrapper","realw","T","U","V","hcf","newImDiv","unitStyle","widthUnit","heightUnit","sizeTable","$cNr8p","table","templateWrapper","presetFitBtn","presetCurrentBtn","presetSquareBtn","presetLandscapeBtn","presetPortraitBtn","presetOversizeBtn","sizeObj1","backgroundRGBA","colorOptionsArr","initColorIndex","colorOptions","onkeyup","secondRow","$96366ef7b36c82a7$export$9852986a3ec5f6a0","cellProps","rowIndex","_rowEl","colIndex","cellEl","rowSpan","rowspan","$3f73fb4b1b574d52$export$5b91f641162972fc","stateIsOpen","directionStr","icon","$9ecpQ","dirStr","$cd9e7df6e228ea45$export$e263e067d6140649","checkerPattern","previewCtx","textCtx","textCanvas","textInput","alignRadioList","italicToggle","boldToggle","sizeInput","fontSelect","rotatedXY","rotatedWH","fitBounds","zoomFac","previewCanvas","layersCtx","emptyCanvasLight","targetCanvas","layersCanvas","changeZoomFac","zoomInBtn","canZoom","zoomOutBtn","onScroll","isSmallWidth","isSmallHeight","previewPointerListener","row2n3Wrapper","unshift","zoomWrapper","sizePointerListener","fontPointerListener","$itzxn","$3RXBC","$dtB7M","$3qZsM","$68rzB","placeholder","$c8d2eb7d799b314c$export$1bf16d9bd59fd8f9","updateResolution","maxSize","resolutionEl","flattenCheckbox","warningsEl","doFlatten","warningArr","warnings","psdWarningArr","contentArr","warningMap","mask","clipping","group","adjustment","alert","showWarnings","noteEl1","cropRect","isCropped","cropObj","$4c230b0de5e1a470$var$kl2PsdMap","$4c230b0de5e1a470$var$psd2KlMap","$4c230b0de5e1a470$var$init","fromEntries","reverse","$4c230b0de5e1a470$export$6df36f0c42d2440f","str","$4c230b0de5e1a470$export$4e3b1f7d3ad623b4","$4c230b0de5e1a470$export$3d649861c4b13fa2","psdObj","addWarning","warningStr","getMixModeStr","prepareMask","maskCanvas","defaultColor","groupMaskCtx","bitsPerChannel","maxLayers","layerCount","countWithinGroup","groupObj","convertGroup","psdGroupObj","groupCanvas","groupCtx","groupOpacity","hidden","groupMixModeStr","hasClipping","innerArr","innerItem","innerCtx","clippingCanvas","clippingCtx","clippingItem","effects","clippingCanvas1","clippingCtx1","clippingItem1","$4c230b0de5e1a470$export$56493bf279c387b3","klPsd","$41164c8aeaf53227$var$indexedDbIsSupported","indexedDB","$41164c8aeaf53227$var$dbNameStr","$41164c8aeaf53227$var$storageNameStr","$41164c8aeaf53227$export$1347f8be1f25c479","$41164c8aeaf53227$var$execIndexedDBTransaction","actionFunction","successCallback","errorCallback","onError","errorStr","hasFinished","requestObj","onupgradeneeded","createObjectStore","keyPath","createIndex","unique","onerror","onsuccess","databaseObj","transactionObj","storeObj","objectStoreNames","contains","deleteDatabase","transaction","objectStore","oncomplete","$41164c8aeaf53227$export$1448a0dd0d3fde8e","query","$41164c8aeaf53227$export$21ade4eb935254aa","storageProject","put","$41164c8aeaf53227$export$42ffd38884aecdac","$fsSyS","$805be15a1e91c0ee$export$7a4e0b62a5d854bc","isLoaded","$805be15a1e91c0ee$export$395d33c8e06b92c9","brightnessContrast","lang","getDialog","inEmbed","$bBJjx","curves","$fb1QA","distort","$4w6gs","$5XYnt","hueSaturation","$hK7d4","darkNoInvert","invert","$bE89l","perspective","$anXZw","$gDMhw","tiltShift","$bNSoq","toAlpha","$dkVDV","$6aHfw","$kLbWO","unsharpMask","$bgekB","grid","$537C7","noise","$kHVZD","pattern","$bphza","vanishPoint","$tP4I2","$68QTJ","$42ac5b30ad65dabb$export$7d68cd8857639377","PenBrush","BlendBrush","$5PSXS","SketchyBrush","$ewgr9","PixelBrush","$kic4a","ChemyBrush","$6Nq1H","SmudgeBrush","$ltaBP","EraserBrush","$7cUpm","$3f0923cd3c55ea92$var$ALPHA_CIRCLE","$3f0923cd3c55ea92$var$TWO_PI","$3f0923cd3c55ea92$export$6f96c8f9e6ae7341","settingAlphaId","instructionArr","alphaCanvas128","alphaCanvas64","alphaCanvas32","settingColor","alphaOpacityArr","$5CF7D","alphaImArr","settingOpacity","settingHasOpacityPressure","before","settingLockLayerAlpha","settingColorStr","arc","closePath","hasDrawnDot","targetMipmap","bezierLine","lastInput","drawArr","dotCallback","localPressure","lastInput2","localOpacity","calcOpacity","localSize","settingSize","settingHasSizePressure","localSpacing","settingSpacing","addFinal","drawDot","historyEntry","actions","inputIsDrawing","lineToolLastDot","inputArr","continueLine","maxInput","loopDist","mouseDist","eX","eY","bdist","updateAlphaCanvas","$74D3O","$ff6c1f784f50f5d5$export$d116ae91f77f1f19","genBrushAlpha01","genBrushAlpha02","$f875015ce1aeb4d3$export$74a44bbc21d06a28","scaleFac","createImageData","sFac2","$gZSR2","simplex2","noisePattern","centerDist","$f875015ce1aeb4d3$var$udSegment","ba","pa","$f875015ce1aeb4d3$export$eaa218d5d17c8f1c","pDist","centerSize","transitionSize","$dfc47a34ad9bc378$var$myModule","$dfc47a34ad9bc378$var$Grad","Grad","$dfc47a34ad9bc378$var$grad3","$dfc47a34ad9bc378$var$p","$dfc47a34ad9bc378$var$perm","$dfc47a34ad9bc378$var$gradP","seed","$dfc47a34ad9bc378$var$F2","$dfc47a34ad9bc378$var$G2","xin","yin","j1","gi0","gi1","gi2","t0","t1","t2","dot2","$dfc47a34ad9bc378$export$d3022aad56692482","$02d77b8dd5755328$var$cellSize","$02d77b8dd5755328$export$9659db8d01dd5313","redrawBounds","cells","getTouchedCells","isTouched","drawCells","touchedCells","cellsW","getCellsWidth","cell","cellOffsetX","cellOffsetY","cellWidth","cellHeight","inCellBounds","tmpCanvas","tmpCtx","alpha","ar","ag","ab","aa","sliceBounds","e2","randI","randLen","randArr","random","samples","samplesSquared","sampleOffsets","sharpness","invSharpness","sharpnessSubtrahend","sizeSquared","distDivisor","alphaMinuend","slicedBounds","ri","re","alphaO","invAlphaO","alphaU","underR","underG","underB","underR1","underG1","underB1","newAlpha","drawBuffer","localColNew","settingSizePressure","calcSpacing","avgX","avgY","blending","mixr","mixg","mixb","average","localColOld","avgParams","prepDot","copyFromCanvas","getAverage","blendCol","blendMix","bezierCallback","settingOpacityPressure","updateRedrawBounds","isTesting","totalCells","drawChangedCells","find","$c214fbe9e4fc15b0$var$sampleCanvas","$c214fbe9e4fc15b0$var$sampleCtx","$c214fbe9e4fc15b0$export$566f9061f0f5ba33","c1","c2","sketchySeed","settingBlending","settingScale","lastX","lastY","p_x","p_y","preMixedColor","mixx","mixy","mixw","mixh","countmix","mixed","mixmode","rand","$58b45953679baa4a$export$4de5ef8eecde6f12","ditherCanvas","ditherCtx","settingIsEraser","ditherArr","ditherPattern","maxAngleRad","d2","d3","isOverThreshold","cubicCurveOverThreshold","plotLine","settingUseDither","controlCallback","controlObj","plotCubicBezierLine","skipFirst","sX","sY","updateDither","$fc1a683099fb2d61$export$fe52c90afd1cf5ba","isBaseLayer","isTransparentBG","radgrad","oFac","useSizePressure","useOpacityPressure","started","_this_historyEntry_actions","$78ad817c60f81b7c$var$CELL_SIZE","$78ad817c60f81b7c$var$smudge","cSize","brush","cX","cY","aIndex","aP","bP","softnessPx","pixel","ai","bi","ix","iy","fac2","alphaLock","bx1","bx2","yStart","iy1","yStart1","x21","ix1","iy2","yStart2","x3","x22","ix2","y3","iy3","yStart3","x4","x23","ix3","$78ad817c60f81b7c$export$c9f800961903deab","completeRedrawBounds","copiedCells","copyImageData","_$i","e3","imWidth","imHeight","$78ad817c60f81b7c$var$prepSmudge","ImageData","updateCompleteRedrawBounds","historyIm","$348fcce123898af9$export$38b08aa4ea8f61c6","settingXSymmetry","settingYSymmetry","buffer","settingMode","Path2D","settingGradient","startAtTop","minY","maxY","lineJoin","settingDistort","pos","historyCanvas","$cVFne","$7de2f0eab7a9ead7$export$f1561c72be54c6a7","penBrush","penBrushUi","blendBrush","$9mjXI","blendBrushUi","sketchyBrush","$iYbUv","sketchyBrushUi","pixelBrush","$brjBD","pixelBrushUi","chemyBrush","$vCnsd","chemyBrushUi","smudgeBrush","$dS2qM","smudgeBrushUi","$9rc5F","eraserBrushUi","brushInterface","alphaNames","$8b6ca25eb0830594$export$a0d4983f3b0b5c8e","$iEKHy","setSpacing","spacingSpline","alphaOptions","setAlpha","getLockAlpha","setLockAlpha","$7NTKy","pressureSizeToggle","sizePressure","pressureOpacityToggle","opacityPressure","changeSliderValue","$e8a5c017c49bb311$export$5ec472fd0ce20d84","$2e3c50106ba150d5$export$156bb4fe8f4bcb4b","$jxqXH","blendingSlider","getBlending","setBlending","setSizePressure","setOpacityPressure","$94537af75923b9e3$export$ffae56164d1bde68","$1SGPc","blendSlider","scaleSlider","setScale","getSeed","setSeed","$9519e739bc9666ee$export$d001f3406562d07","$1qfk4","setIsEraser","ditherToggle","getUseDither","setUseDither","$d6fc2ded7d9d56db$export$cf481ecf227135a8","$6kk87","isTransparentBg","transparencyToggle","setTransparentBG","$1045b9bae2ffbbb4$export$84831662ba707e7a","$1rnhH","$18456e8104a5a825$export$80819a93636ebb04","$5rmB7","toggleRow","actualIconSize","iconSize","modeOptions","brushSize","mirrorXToggle","halfSize","getXSymmetry","setXSymmetry","mirrorYToggle","getYSymmetry","setYSymmetry","gradientToggle","getGradient","setGradient","$2d47de6498e5a87c$export$35fa34e5af64bd4a","isEmbed","iframe","linkEl","href","onload","contentWindow","location","isMaxHeight","$de98bdc3369d2e4f$export$3dff5655255b5729","items","ignoreFocus","inputs","$0e681e75eb3cab30$export$9c72cf485ef46673","_this_options","gridTemplateColumns","gridTemplateRows","gap","gridTemplateAreas","gridArea","infoEl","isBroken","ageEl","textSize","btnCustom","storeButtonEl","clearButtonEl","hideClearButton","visibility","storeListener","onUpdate","timestamp","thumbnail","updateThumb","updateAge","readResult","read","ageStr","age","Date","getTime","resetButtons","Promise","unsubscribe","$14b343f2c12ca9c5$var$makeAsync","nonAsyncFunc","reject","$14b343f2c12ca9c5$export$93d91060b9af7e2a","accessHasFailed","storeKlProjectObj","getKlProjectObj","lowLevelRead","$3hwQ7","ProjectConverter","readStorageProject","storageProject1","createStorageProject","lowLevelStore","lowLevelClear","updateTimestamp","$3ee249752703e788$var$loadImage","URL","revokeObjectURL","onabort","$3ee249752703e788$export$f3c1ac6650038646","createThumbnail","HTMLCanvasElement","_tmp","all","$e3587a28373f51f9$export$b3fb17ae4345ac8f","base64Str","parts","match","binStr","atob","buf","view","charCodeAt","Blob","$01ce2e23a2667e77$export$a2647fbf5f056b0a","onExportTypeChange","onFileSelect","onSaveImageToComputer","onNewImage","onShareImage","onUpload","onCopyToClipboard","fileMenu","uploadImgurButton","clipboardButton","$fEvzb","importWrapper","innerMask","multiple","accept","importFakeButton","exportTypeSelect","saveNote","createSpacer","clearer","line","fileBrowserStorage","saveRow","refresh","$0d10046ca7f6fbd0$export$3f17d740ad471e50","getCurrentColor","getKlMaxCanvasSize","getKlCanvas","getCurrentLayerCtx","isInit","filters","filterKey","buttonLabel","filterName","applyFilter","filterDialog","maxWidth","maxHeight","currentColorRgb","secondaryColorRgb","getInput","finishedDialog","addGroup","groupArr","$6349b006a6604e1b$var$upload","description","$6349b006a6604e1b$var$_upload","img","gif","labelText","response","formData","$2lMgk","FormData","method","headers","Authorization","ok","json","link","$6349b006a6604e1b$export$b1dd62fa0b5f32f5","inputTitle","inputDescription","rows","labelTitle","labelDescription","tos","typeRadio","outDiv","infoHint","deletehash","$06e8423858d08972$export$befc6437ad34b28a","showReminder","changeTitle","onSaveAsPsd","lastSavedActionNumber","lastSavedAt","psdWrapper","storageWrapper","paddingBottom","psdBtn","storageUi","lastReminderShownAt","onBeforeUnload","returnValue","getActionNumber","visibilityState","unsavedActions","showPopup","onbeforeunload","unsavedInterval","$956d06d740fc5053$export$75e7b60500bb415b","getExportType","filename","mimeType","$6hBII","saveAs","format","saveImage","fileBase","fnameArr","layerArr1","psdConfig","item1","blendKlToPsd","then","agPsdLazy","writePsdBuffer","catch","$e1c6fbc08bfda4eb$export$2bc2a80e311129ac","createElementNS","download","rel","createObjectURL","$48534f13b7192dff$var$execHistoryEntry","setCurrentLayerCtx","ctx1","id1","ctx2","$48534f13b7192dff$export$5cebd3bb2d68229a","getInitState","getCurrentBrush","doIgnore","shouldIgnoreTest","oldSize","entry","currentLayerIndex","logParam","localCurrentLayerCtx","$53cc60fd413705d6$export$272bfd3ef9ef2f48","onSetColor","onSetSize","onSetOpacity","onGetColor","onGetSize","onGetOpacity","onGetSliderConfig","subscriberArr","instance","obj","skipSubscriber","$5562b5b6c391a7ca$export$5d396b237bd33221","customAbout","themeToLabel","makeLicenses","licenses","overflowY","autoLanguage","getAutoLanguage","langWrapper","$fgfvl","languages","languageSelect","LS_LANGUAGE_KEY","languageHint","themeSelect","getMediaQueryTheme","getStoredTheme","setStoredTheme","$741YV","$dd3r9","$951e508110f8a437$export$42a534af7eb650e8","upBtn","downBtn","upInterval","scrollBy","downInterval","wheelListener","$f244572c1923a3ac$export$7fa03d1ef9d3489e","iconArr","updateIcons","typeOptions","reverseToggle","doSnapToggle","col1","col2","$1eff19bee197987a$export$ce26cd3db18613a3","submitButton","leftRightButton","$4bb0d03ef02dc0c0$var$importFilter","libObj","moduleObj","$4bb0d03ef02dc0c0$export$4283b00eae4a6956","$iiVKq","filterBrightnessContrast","$lorQQ","filterCropExtend","$8Ri8I","filterCurves","$fADXF","filterFlip","$bIns5","filterHueSaturation","$30jcG","filterInvert","$cCks8","filterPerspective","$huXOx","filterResize","$dsRff","filterRotate","$lhchB","filterTiltShift","$lXpcU","filterTransform","$1CjeM","filterBlur","$dNWKZ","filterUnsharpMask","$94Tq7","filterToAlpha","$d8Fqy","filterGrid","$gtdB1","filterNoise","$lQzx7","filterPattern","$10iZP","filterDistort","$dteOZ","filterVanishPoint","$024aabab8b30bbfd$export$af433fb90aa90a38","selectedLayerIndex","tempCanvas","brightness","contrast","fxCanvas","$a5EFw","getSharedFx","texture","brightnessSlider","$cH2YE","contrastSlider","previewInnerWrapper","$fca35583bfaa35b6$export$5ec472fd0ce20d84","$6N0h0","$02a74dc72797630f$var$fx","$02a74dc72797630f$export$8c4423af32b21158","_","gl","isContextLost","wrapTexture","initialize","contents","getPixelArray","wrap","$76shC","$eeae469bfe7893fd$export$a04cfca62fd2892f","loadContentsOf","$7dEWP","setGl","$8dg54","FxTexture","fromElement","textureType","UNSIGNED_BYTE","getExtension","testTexture","RGBA","FLOAT","drawTo","getTextureType","spareTexture","extraTexture","flippedShader","$fvBHO","FxShader","use","getDefaultShader","drawRect","array","readPixels","fn","_len","args","_key","premultipliedAlpha","$h6IOH","triangleBlur","$e0olz","$kSoEy","$fkecp","matrixWarp","$44j8K","$2myDH","$9uhWc","$1Vq1u","$bJIp5","multiplyAlpha","$lwXVT","unmultiplyAlpha","$3u9Uu","$9WU1L","$6lIef","$c50d7229cf0a789e$export$6408eeb1703e74b8","$jrAes","simpleShader","$8501a2e1e79821a9$export$d731e22ecd0c25d3","shader","uniforms","textureIn","textureOut","swapWith","$e0143068cd462268$var$floatPrecision","$e0143068cd462268$var$defaultVertexSource","$e0143068cd462268$var$defaultFragmentSource","$e0143068cd462268$export$7d9b0d118d0c4108","vertexSource","fragmentSource","nameStr","vertexAttribute","texCoordAttribute","program","createProgram","testPrecisionSupport","HIGH_FLOAT","MEDIUM_FLOAT","attachShader","compileSource","VERTEX_SHADER","FRAGMENT_SHADER","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","source","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","precisionType","getShaderPrecisionFormat","precision","deleteProgram","useProgram","getUniformLocation","uniform1fv","Float32Array","uniform2fv","uniform3fv","uniform4fv","uniformMatrix3fv","uniformMatrix4fv","$e0143068cd462268$var$isNumber","uniform1f","textures","uniform1i","viewport","getParameter","VIEWPORT","vertexBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","texCoordBuffer","getAttribLocation","enableVertexAttribArray","vertexAttribPointer","drawArrays","TRIANGLE_STRIP","defaultShader","$deb6b884ba4ae312$export$5822a9d0880a5d82","$deb6b884ba4ae312$export$b59c6427db8463f4","newGl","$80392da2a95619fd$export$7e6fd232cff50dd1","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","videoWidth","videoHeight","deleteTexture","unit","activeTexture","TEXTURE0","ensureFormat","framebuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","other","$fRyi0","$7480e3ce85bc65db$export$6894093bf294bea5","red","green","blue","redRamp","splineInterpolate","greenRamp","blueRamp","initFromBytes","$d747444e26286abc$export$4f237735eca1f248","interpolator","$6dd7d8fac84d64b7$export$ef28bbbd731e79bf","$dd5d88e299e80db3$export$d3022aad56692482","octaves","peaks","colA","colB","channels","$3TO8L","texSize","$b01b186720ebdc8e$export$6e852234f1597a14","$4urfK","randomShaderFunc","$904e6ba1142f7a16$export$af69f7ca07da04c9","$1ec92859a97056c3$export$4545acb2b6bb8f22","endX","endY","blurRadius","gradientRadius","$5b33fb39bf5722a9$export$a93b0222aeadc54b","inverse","useTextureSpace","$gDZ5A","warpShader","$5taNf","getInverse","$1d7339974b05a229$export$820b3a44cb7b2b21","uniformsStr","warpStr","$303d8d4ec53c4881$export$1c447127d27d7be4","dx1","dy1","dx2","dy2","dx3","dy3","det","$303d8d4ec53c4881$export$68b3343017e80691","$303d8d4ec53c4881$export$2060d2db72cce88f","$c6e0992c38eb55ab$export$915fb7313c578ba2","strength","ensureFormatViaTexture","originalTexture","unuse","$164716f3bce9dcdb$export$be1ee5ea42904fdc","replaceRGBA","$6fb892cfa80f1621$export$6897c284b6f9f4dc","$4d16a2f492bd5d16$export$541149539f3a4684","after","getSquareToQuad","$34a2490457ff8aab$export$b324c80262feb891","$55618926ab99fefa$export$7c9b924528782480","distortType","phase","$f157b4bc2111ecb8$export$57b05c961ff98d6a","$2680b5781517cb67$export$e5937df51b9e1d86","updateInput","leftInput","rightInput","topInput","bottomInput","leftChanged","rightChanged","topChanged","bottomChanged","cropper","setTransform","previewHeight","offsetWrapper","selectedRgbaObj","updateIsDark","previewFactor","lrWrapper","tbWrapper","labelStyle","useRuleOfThirds","ruleOThirdsCheckbox","showThirds","bgColorOverlay","flexRow","$4c948640eb8ef791$export$309483fcb6d5c7ca","$hRvnE","getDefaultCurvesInput","CurvesInput","modeButtons","getModeButtons","$81ac57466912ccc9$export$4300cf0a0df418a6","$81ac57466912ccc9$export$1c43bf66c2a2e4da","p0","areaH","areaW","curveArea","createPoint","lock","internalY","internalX","pointEl","newX","newY","updateControl","outCurves","drawCurve","spline","$6b01e1931d168e01$export$9b1b7b3985b9625a","previewLayer","doFlipCanvas","horizontalCheckbox","verticalCheckbox","targetOptions","horizontal","vertical","flipCanvas","$041c656037c77a96$export$2aa46bd5587f0eb","hueSlider","saturationSlider","$82b3d1ba61b3412f$export$b7ebcfbdc840ef76","$460859cbeb601dec$export$a76d798fa7d85e4e","displayW","displayH","displayPreviewFactor","pointerListenerArr","bb","bc","bd","ac","ad","nob","updateAfter","beforeAfterTabs","$5vheV","TwoTabs","nobSize","$8b4f5ae4fe73ff76$export$b1241e74876d9bbe","leftTab","onpointerdown","rightTab","$63d62a20f3ba2c7d$export$5705240d31427a82","previewW","previewH","algorithmSelect","canvasWrapper","widthWrapper","heightWrapper","$bNBIp","constrainIm","constrainCheckbox","$878715182dcd377b$export$ac7e9efc751d5791","btnPlus","btnMinus","previewcell","$aa97ed406a9700f0$export$1b8796b18b7c19ed","fa","fb","blurSlider","gradientSlider","$31a0dd41d7428d32$export$dc15474d94cdc2b3","JSON","stringify","lastDrawnTransformStr","transformLayerCanvas","onInputsChanged","inputX","inputY","inputR","leftWrapper","rightWrapper","rotWrapper","actionBtnCss","buttonRow","flipXBtn","flipYBtn","scaleRotLeftBtn","scaleRotRightBtn","scaleDoubleBtn","getRatio","scaleHalfBtn","setConstrained","isSnapping","snappingCheckbox","setSnapping","checkboxWrapper","bottomRow","isPixelated","$95b95646154e8218$export$55e7eb2ebd0db869","radiusSlider","$82f12ab116cea855$export$62ac74a5ea43bd5c","strengthSlider","$a535e7a374deb8f5$export$6158ed2b22ebf4d9","sourceId","sourceOptions","$bad33651972f8d2c$export$50020de79e1bc23","renderW","renderH","$1xi6g","drawGrid","settingsObj","thickness","renderFactor","line1","line2","xInput","yInput","thicknessInput","$74df8e8cd35bce4e$export$20d2db9c68afeac","cellsX","cellsY","thickIsRound","pos1","$595c9469b8f94062$var$presetArr","$595c9469b8f94062$var$drawNoise","$595c9469b8f94062$export$1dab0536099042f5","presetCopy","presetIndex","thumbImgArr","preset","thumbImg","presetOptions","row1El","row2El","channelsOptions","blendSelect","colorWrapper","colInputStyle","colAInput","colBInput","$ebbf7e5d844153e5$var$drawPattern","blendOffsetX","blend","blendOffsetY","finalPatternCanvas","blendCanvas","blendCtx","colTransparent","colOpaque","blendGradient","$ebbf7e5d844153e5$export$5b48b77a483d9b33","syncInputs","sharpStrokeRect","drawX","drawY","drawWidth","drawHeight","lastDrawnSettings","previewMode","fullSizeCtx","fullSizeCanvas","pW","pH","overlayCtx","overlayCanvas","previewCanvas1","previewCtx1","inputStyle","mixBlendMode","oldSettings","x11","y11","$67bee9819cf9d9ba$export$77c344cc65ad0ed2","sync","from","sliderArr","fxCanvas1","texture1","isSynced","settingsCopy","topRowEl","syncToggle","xyRowEl","leftCol","rightCol","sliderWidth","toUpperCase","phaseSlider","stepSlider","$9939d5f20537fa4b$export$a77e8ecd2a7fa9a5","$jsIPR","drawVanishPoint","lines","linesSlider","$cd59789add31bb97$export$8f57d6bdbceb36d0","degIncrement","$40b8cea12adf584e$export$92433b641be3f7a","$40b8cea12adf584e$var$_klCanvasToPsdBlob","$3adbeb1f050c09d3$export$c57e2ed65bcf4d6a","interval","lastMixedInput","inputPressure","parse","$73298182992a8985$export$91dcf4209534d21f","$7aa12ecc06c22770$export$bcd109042a2e4bb5","$504c8450f977b764$export$4ccbb8938b9d5723","importedImage","getResizedDimensions","importAsImage","resizedDimensions","importAsImagePsd","convertedPsdObj","cropCanvas","importAsLayer","activeLayerIndex","activeLayerContext","res","clipboardData","file","getAsFile","retrieveImageFromClipboardAsBlob","imageBlob","importFinishedLoading","URLObj","webkitURL","getAsString","pasteStr","log","crossOrigin","showWarningPsdFlattened","hasUnsupportedFile","nameSplit","maxResolution","closeLoader","doShowLoader","loaderIsOpen","reader","FileReader","readerResult","skipLayerImageData","skipThumbnail","skipCompositeImageData","convertedPsd","readAsArrayBuffer","$a8abbf3a9def9692$export$982e7602957287fa","_console","_console1","info","help"],"version":3,"file":"main-embed.6e321982.js.map"}