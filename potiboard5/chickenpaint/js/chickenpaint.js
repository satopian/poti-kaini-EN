/*
    ChickenPaint Be
    https://github.com/satopian/ChickenPaint_Be
    by satopian
    Customized from ChickenPaint by Nicholas Sherlock.
    GNU GENERAL PUBLIC LICENSE
    Version 3, 29 June 2007
    <http://www.gnu.org/licenses/>
*/
/*
    ChickenPaint

    ChickenPaint is a translation of ChibiPaint from Java to JavaScript
    by Nicholas Sherlock / Chicken Smoothie.

    ChibiPaint is Copyright (c) 2006-2008 Marc Schefer

    ChickenPaint is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    ChickenPaint is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with ChickenPaint. If not, see <http://www.gnu.org/licenses/>.
*/
/*
    Bootstrap (https://getbootstrap.com/)
    Copyright The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
    Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)

    EventEmitter v5.2.9 - git.io/ee
    Unlicense - http://unlicense.org/
    Oliver Caldwell - https://oli.me.uk/
*/
/*
    jQuery throttle / debounce - v1.1 - 3/7/2010
    http://benalman.com/projects/jquery-throttle-debounce-plugin/

    Copyright (c) 2010 "Cowboy" Ben Alman
    Dual licensed under the MIT and GPL licenses.
    http://benalman.com/about/license/
*/
!function(){function wa(a){return a&&a.__esModule?a.default:a}function uc(a,c,d,b){Object.defineProperty(a,c,{get:d,set:b,enumerable:!0,configurable:!0})}function la(a){for(var c in la.DEFAULTS)la.DEFAULTS.hasOwnProperty(c)&&(this[c]=la.DEFAULTS[c]);for(c in a)a.hasOwnProperty(c)&&(this[c]=a[c])}function oa(a,c,d,b){this.left=a;this.top=c;this.right=d;this.bottom=b}function Gc(a,c){this.width=0|a;this.height=0|c}function pc(a,c){var d=document.createElement("canvas");return d.width=a,d.height=c,d}
function Pd(a,c){return document.createElement("canvas").getContext("2d").createImageData(a,c)}function z(a,c){"number"==typeof a?(Gc.call(this,a,c),this.imageData=Pd(this.width,this.height)):(Gc.call(this,a.width,a.height),this.imageData=a);this.data=this.imageData.data}function ue(a,c,d,b){var k,n=0,g=[0,0,0,0];var e=0;for(k=0;k<b&&k<d;k++){for(var h=0;h<z.BYTES_PER_PIXEL;h++)g[h]+=a[e++];n++}k=0;for(h=0;h<d;h++){if(h+b<d){e=(h+b)*z.BYTES_PER_PIXEL;for(var l=0;l<z.BYTES_PER_PIXEL;l++)g[l]+=a[e++];
n++}for(e=0;e<z.BYTES_PER_PIXEL;e++)c[k++]=Math.round(g[e]/n);if(0<=h-b){e=(h-b)*z.BYTES_PER_PIXEL;for(l=0;l<z.BYTES_PER_PIXEL;l++)g[l]-=a[e++];n--}}}function ve(a,c){if(0==(c%=4))return a;let d=pc(0,0),b=d.getContext("2d");switch(0==c%2?(d.width=a.width,d.height=a.height):(d.width=a.height,d.height=a.width),c){case 1:b.rotate(Math.PI/2);b.drawImage(a,0,-a.height);break;case 2:b.rotate(Math.PI);b.drawImage(a,-a.width,-a.height);break;case 3:b.rotate(-Math.PI/2);b.drawImage(a,-a.width,0);break;default:return a}return d}
function Ua(a,c){Ya.call(this,a);this.layers=[];this.expanded=!0;this.blendMode=c}function Mf(a,c){return a+c}function Ea(a,c,d){Gc.call(this,a,c);this.createBitmap(a,c,d)}function we(a,c,d,b){var k,n=0,g=0;for(k=0;k<b&&k<d;k++)g+=a[k],n++;k=0;for(let e=0;e<d;e++)e+b<d&&(g+=a[e+b],n++),c[k++]=Math.round(g/n),0<=e-b&&(g-=a[e-b],n--)}function G(){}function Ya(a){this.name=a||"";this.parent=null;this.lockAlpha=!1;this.alpha=100;this.visible=!0;this.blendMode=G.LM_NORMAL;this.mask=null;this.maskVisible=
this.maskLinked=!0;this.maskThumbnail=null;this.useLegacyMultiply=!1}function sa(a,c,d){Ya.call(this,d);0<a&&0<c?this.image=new z(a,c):this.image=null;this.clip=!1;this.imageThumbnail=null}function $c(a,c,d){d?(this.isGroup=d instanceof Ua,this.image=d.image,this.mask=d.getEffectiveMask(),this.layer=d,this.blendMode=d.blendMode,this.alpha=d.alpha,this.visible=d.visible):(this.isGroup=!0,this.image=null,this.mask=null,this.layer=null,this.blendMode=G.LM_PASSTHROUGH,this.alpha=100,this.visible=!0);
this.dirtyRect=new oa(0,0,a,c);this.layers=[];this.parent=null;this.clip=!1}function Qd(a,c,d,b){function k(){return 0<l.length?l.pop():new z(c,d)}function n(m){if(0==m.layers.length)return null;if(1==m.layers.length&&(null==m.mask||null==m.layers[0].mask)){let q=m.layers[0];return q.alpha=Math.round(m.alpha*q.alpha/100),m.blendMode!=G.LM_PASSTHROUGH&&(q.blendMode=m.blendMode),q.mask=m.mask||q.mask,m.layer&&f.set(m.layer,q),q}return m.blendMode==G.LM_PASSTHROUGH&&100==m.alpha&&null==m.mask?m.layers:
(m.image=k(),m)}function g(m){let q=new $c(c,d,m);return f.set(m,q),q}function e(m,q){m&&(m.dirtyRect.union(q),e(m.parent,q))}let h,l=[],f=new Map;this.invalidateLayerRect=function(m,q){e(f.get(m),q)};this.buildTree=function(){if(!h){if(h=function r(q){if(0==q.getEffectiveAlpha())return null;let t=g(q);for(var u=0;u<q.layers.length;u++){let C=q.layers[u];var w=q.layers[u+1];if(C instanceof sa&&w&&w.clip){w=new $c(c,d,null);w.blendMode=C.blendMode;w.alpha=100;w.clip=!0;w.addChildren(g(C));for(u+=1;u<
q.layers.length;u++)if(q.layers[u].clip)0<q.layers[u].getEffectiveAlpha()&&w.addChildren(g(q.layers[u]));else break;0<C.getEffectiveAlpha()&&t.addChildren(n(w));--u}else C instanceof Ua?t.addChildren(r(C)):0<C.getEffectiveAlpha()&&t.addChildren(g(C))}return n(t)}(a)){if(Array.isArray(h)||b&&(100>h.alpha||h.mask)){let q=h;(h=new $c(c,d)).blendMode=Array.isArray(q)?G.LM_NORMAL:q.blendMode;h.alpha=100;h.image=k();h.addChildren(q)}}else(h=new $c(c,d,{image:k(),blendMode:G.LM_NORMAL,alpha:100,getEffectiveMask:()=>
null,visible:!0})).image.clearAll(0);l=[]}};this.resetTree=function(){h&&(!function r(q){if(q.isGroup)for(let t of(q.image&&l.push(q.image),q.layers))r(t)}(h),h=null,f.clear())};this.layerPropertyChanged=function(m,q){let r=f.get(m);r&&r.visible==m.visible&&r.alpha==m.alpha&&null==r.mask==(null==m.getEffectiveMask())&&r.blendMode==G.LM_PASSTHROUGH==(m.blendMode==G.LM_PASSTHROUGH)&&"clip"!==q?(r.blendMode=m.blendMode,e(r,new oa(0,0,c,d))):this.resetTree()};this.blendTree=function(){return function r(q){if(!q||
!q.isGroup)return q;let t=q.dirtyRect;var u=!0,w=!0;if(q.blendMode==G.LM_PASSTHROUGH&&q.parent&&t.union(q.parent.dirtyRect),t.isEmpty())return q;if(q.blendMode==G.LM_PASSTHROUGH&&q.parent){u=!1;var C=q.image;var D=q.parent.image;t.getWidth()==C.width&&t.getHeight()==C.height?C.copyPixelsFrom(D):G.replaceOntoFusionWithOpaqueLayer(C,D,100,t)}for(C=0;C<q.layers.length;C++){var A=r(q.layers[C]);if(u){u=q.image;D=A.image;var F=A.alpha,J=t;A=A.mask;if(100!=F||A||J.getWidth()!=u.width||J.getHeight()!=u.height){let N=
"replaceOntoFusionWith";100==F?N+="OpaqueLayer":N+="TransparentLayer";A&&(N+="Masked");G[N](u,D,F,J,A)}else u.copyPixelsFrom(D);!0;u=!1}else w=w&&q.image.hasAlphaInRect(t),G.fuseImageOntoImage(q.image,w,A.image,A.alpha,A.blendMode,t,A.mask)}q.clip&&(w=q.layers[0],100>w.alpha?w.mask?G.replaceAlphaOntoFusionWithTransparentLayerMasked(q.image,w.image,w.alpha,t,w.mask):G.replaceAlphaOntoFusionWithTransparentLayer(q.image,w.image,w.alpha,t):w.mask?G.replaceAlphaOntoFusionWithOpaqueLayerMasked(q.image,
w.image,100,t,w.mask):G.replaceAlphaOntoFusionWithOpaqueLayer(q.image,w.image,100,t));return q.dirtyRect.makeEmpty(),q}(h)}}function Nf(){function a(f){if(null!=k&&f.curSize==n&&f.curSqueeze==g&&f.curAngle==e&&f.tip==h)return k;switch(f.tip){case la.TIP_ROUND_AIRBRUSH:!function(m,q){let r=Math.ceil(q.curSize),t=r/2,u=q.curSize/2*(q.curSize/2),w=1+10*q.curSqueeze,C=Math.cos(q.curAngle);q=Math.sin(q.curAngle);let D=0;for(let J=0;J<r;J++)for(let N=0;N<r;N++){var A=N+.5-t;let L=J+.5-t;var F=(A*C-L*q)*
w;A=L*C+A*q;F=F*F+A*A;F<=u?m[D++]=~~(255*(1-F/u)):m[D++]=0}}(c,f);break;case la.TIP_ROUND_AA:!function(m,q){let r=Math.ceil(q.curSize),t=r/2,u=q.curSize/2*(q.curSize/2),w=(q.curSize-2)/2*((q.curSize-2)/2),C=(q.curSize+2)/2*((q.curSize+2)/2),D=1+10*q.curSqueeze,A=Math.cos(q.curAngle);q=Math.sin(q.curAngle);let F=0;for(let N=0;N<r;N++)for(let L=0;L<r;L++){let M=L+.5-t,X=N+.5-t,fa=(M*A-X*q)*D,pa=X*A+M*q;var J=fa*fa+pa*pa;if(J<=w)m[F++]=255;else if(J>C)m[F++]=0;else{J=0;for(let H=0;4>H;H++)for(let ja=
0;4>ja;ja++)(fa=((M=L+.25*ja-t)*A-(X=N+.25*H-t)*q)*D)*fa+(pa=X*A+M*q)*pa<=u&&(J+=1);m[F++]=Math.min(16*J,255)}}}(c,f);break;case la.TIP_ROUND_PIXEL:!function(m,q){let r=Math.ceil(q.curSize),t=r/2,u=q.curSize/2*(q.curSize/2),w=1+10*q.curSqueeze,C=Math.cos(q.curAngle);q=Math.sin(q.curAngle);let D=0;for(let F=0;F<r;F++)for(let J=0;J<r;J++){var A=J+.5-t;let N=F+.5-t,L=(A*C-N*q)*w;A=N*C+A*q;L*L+A*A<=u?m[D++]=255:m[D++]=0}}(c,f);break;case la.TIP_SQUARE_AA:!function(m,q){let r=Math.ceil(q.curSize),t=r/
2;var u=q.curSize*Math.sin(Math.PI/4);let w=u/2/(1+10*q.curSqueeze);u/=2;let C=w-1,D=u-1,A=w+1,F=u+1,J=Math.cos(q.curAngle);q=Math.sin(q.curAngle);let N=0;for(let M=0;M<r;M++)for(let X=0;X<r;X++){var L=X+.5-t;let fa=M+.5-t,pa=Math.abs(L*J-fa*q);L=Math.abs(fa*J+L*q);if(pa<=C&&L<=D)m[N++]=255;else if(pa>A||L>F)m[N++]=0;else{let H=0;for(let ja=0;4>ja;ja++)for(let U=0;4>U;U++)pa=Math.abs((L=X+.25*U-t)*J-(fa=M+.25*ja-t)*q),L=Math.abs(fa*J+L*q),pa<=w&&L<=u&&H++;m[N++]=Math.min(16*H,255)}}}(c,f);break;case la.TIP_SQUARE_PIXEL:!function(m,
q){let r=Math.ceil(q.curSize),t=r/2;var u=q.curSize*Math.sin(Math.PI/4);let w=u/2/(1+10*q.curSqueeze);u/=2;let C=Math.cos(q.curAngle);q=Math.sin(q.curAngle);let D=0;for(let A=0;A<r;A++)for(let F=0;F<r;F++){let J=F+.5-t,N=A+.5-t,L=Math.abs(N*C+J*q);Math.abs(J*C-N*q)<=w&&L<=u?m[D++]=255:m[D++]=0}}(c,f)}return k=c,n=f.curSize,h=f.tip,g=f.curSqueeze,e=f.curAngle,c}let c=new Uint8Array(160801),d=new Uint8Array(161604),b=[new Float32Array(402),new Float32Array(402)],k=null,n,g,e,h,l=this;this.getDab=function(f,
m,q){let r={alpha:q.curAlpha,width:Math.ceil(q.curSize),height:Math.ceil(q.curSize)},t=q.isAA&&q.tip!=la.TIP_ROUND_PIXEL;t&&(r.width++,r.height++);f=f-r.width/2+.5;m=m-r.height/2+.5;let u=Math.floor(f),w=Math.floor(m);return t?r.brush=function(C,D,A){var F=a(C);let J=Math.ceil(C.curSize);C=Math.ceil(C.curSize)+1;let N=(1-D)*(1-A),L=D*(1-A),M=D*A,X=(1-D)*A,fa=0;D=0;A=b[0];let pa=b[1];A.fill(0);for(let ja=0;ja<J;ja++){var H=0;for(pa[0]=0;H<J;H++,fa++,D++){let U=F[fa];d[D]=A[H]+U*N+.5|0;A[H+1]+=U*L;
pa[H]+=U*X;pa[H+1]=U*M}d[D++]=A[H]+.5|0;H=A;A=pa;pa=H}for(F=0;F<C;F++,D++)d[D]=A[F]+.5|0;return d}(q,f-u,m-w):r.brush=a(q),r.x=u,r.y=w,0<q.texture&&null!=this.texture&&(r.brush==c&&(d.set(c),r.brush=d),!function(C,D){D=Math.floor(255*D);let A=l.texture,F=C.x%A.width,J=C.y%A.height,N=0,L,M;0>F&&(F+=A.width);0>J&&(J+=A.height);for(let X=0;X<C.height;X++){L=J*A.width+F;M=J*A.width+A.width;for(let fa=0;fa<C.width;fa++)C.brush[N]=~~(C.brush[N]*(A.data[L]*D/255^255)/255),N++,++L==M&&(L-=A.width);++J==A.height&&
(J=0)}}(r,q.texture)),r};this.setTexture=function(f){this.texture=f}}function Rd(a,c,d){this.bmp=a;this.x=c;this.y=d}function qd(a){if(0==a.saturation)return a.value<<16|a.value<<8|a.value;var c=a.hue/60;c-=Math.floor(c);var d=a.saturation/255,b=~~(a.value*(1-d)),k=~~(a.value*(1-d*c));c=~~(a.value*(1-d*(1-c)));switch(~~(a.hue/60)){case 0:return a.value<<16|c<<8|b;case 1:return k<<16|a.value<<8|b;case 2:return b<<16|a.value<<8|c;case 3:return b<<16|k<<8|a.value;case 4:return c<<16|b<<8|a.value;case 5:return a.value<<
16|b<<8|k;default:return 0}}function fb(a){this.value=this.saturation=this.hue=this.rgb=0;this.setRgb(a||0)}function Of(){var a,c=!1;this.nextGaussian=function(){if(c)return c=!1,a;do var d=(b=2*Math.random()-1)*b+(k=2*Math.random()-1)*k;while(1<=d||0==d);var b,k;d=Math.sqrt(-2*Math.log(d)/d);return a=k*d,c=!0,b*d}}function lb(){this.setToIdentity()}function Sd(a){for(var c=["imageSmoothingEnabled","mozImageSmoothingEnabled","webkitImageSmoothingEnabled","msImageSmoothingEnabled"],d=0;d<c.length;d++)if(c[d]in
a)return c[d];return null}function Td(a,c){var d=Sd(a);d&&(a[d]=c)}function qc(a,c,d){this.r=a;this.g=c;this.b=d}function xe(a){let c=0;for(let d=0;d<a.length;d++)c+=a[d];return c/a.length}function ye(a){let c=new qc(0,0,0);for(let d=0;d<a.length;d++){let b=a[d];c.r+=b.r;c.g+=b.g;c.b+=b.b}return c.r/=a.length,c.g/=a.length,c.b/=a.length,c}function ze(a,c){let d=a.data;if(0<c.left)for(var b=c.top;b<c.bottom;b++){var k=b*a.width,n=k;k=d[k+c.left];for(var g=0;g<c.left;g++,n++)d[n]=k}if(c.right<a.width)for(b=
c.top;b<c.bottom;b++)for(n=b*a.width+c.right,k=d[n-1],g=c.right;g<a.width;g++,n++)d[n]=k;b=0;for(n=0;n<c.top;n++)for(k=c.top*a.width,g=0;g<a.width;g++,k++,b++)d[b]=d[k];b=c.bottom*a.width;for(n=c.bottom;n<a.width;n++)for(k=(c.bottom-1)*a.width,g=0;g<a.width;g++,k++,b++)d[b]=d[k]}function rd(a,c){return a+c}function Ae(a){return a?a.width*a.height*4:0}function Yb(a,c){function d(x){ib=!1;(0<jc.size||0<ec.size)&&(x?e():Zb||setTimeout(e,1E3))}function b(){ca.emitEvent("changeSelection",[])}function k(x){ca.emitEvent("updateRegion",
[x])}function n(){ca.emitEvent("changeStructure");Ia.resetTree();u();k(ca.getBounds())}function g(x,E,P){ca.emitEvent("changeLayer",[x]);P||(Ia.layerPropertyChanged(x,E),k(ca.getBounds()))}function e(){for(let x of jc)x.rebuildImageThumbnail(),ca.emitEvent("changeLayerImageThumb",[x]);for(let x of ec)x.rebuildMaskThumbnail(),ca.emitEvent("changeLayerMaskThumb",[x]);jc.clear();Zb&&(clearTimeout(Zb),Zb=null)}function h(x,E,P,R){Array.isArray(x)||(x=[x]);x.forEach(ba=>Ia.invalidateLayerRect(ba,E));let V=
!1;if(P)for(let ba of(Cb.union(E),x))ba instanceof sa&&(jc.add(ba),V=!0);R&&(ya.union(E),x.forEach(ba=>{ec.add(ba);Ka&&Ka.layer==ba&&Ka.invalidateRect(E)}),V=!0);V&&(Zb&&(clearTimeout(Zb),Zb=null),ib||(Zb=setTimeout(e,1E3)));k(E)}function l(x,E){h(x,E,!da,da)}function f(){return da?O.mask:O.image}function m(){if(!Z.isEmpty()){if(da){var x=O.mask;rb.brushMode==la.BRUSH_MODE_ERASE?Pa[la.BRUSH_MODE_PAINT].mergeOntoMask(x,db,4278190080):Pa[rb.brushMode].mergeOntoMask(x,db,255&lc)}else{x=O.image;let E=
O.getLockAlpha();rb.brushMode==la.BRUSH_MODE_ERASE&&E?Pa[la.BRUSH_MODE_PAINT].mergeOntoImage(x,zb,16777215):Pa[rb.brushMode].mergeOntoImage(x,zb,lc);E&&x.copyAlphaFrom(zb,Z)}Z.makeEmpty()}}function q(){O instanceof sa&&!Cb.isEmpty()&&(zb.copyBitmapRect(O.image,Cb.left,Cb.top,Cb),Cb.makeEmpty())}function r(){O.mask&&!ya.isEmpty()&&(db.copyBitmapRect(O.mask,ya.left,ya.top,ya),ya.makeEmpty())}function t(){da?r():q()}function u(){let x=ca.getBounds();Cb.set(x);ya.set(x)}function w(x){ca.setHasUnsavedChanges(!0);
0<Ob.length&&(Ob=[]);0!==Qa.length&&Qa[Qa.length-1].merge(x)?Qa[Qa.length-1].noChange()&&Qa.pop():(30<=Qa.length&&Qa.shift(),ca.compactUndo(),Qa.push(x))}function C(x,E){x||E||(x=!da,E=da);let P=bb.clone(),R=x?zb.copyRectXOR(O.image,P):null,V=E?db.copyRectXOR(O.mask,P):null;this.layer=O;bb.makeEmpty();this.redo=this.undo=function(){R&&this.layer.image.setRectXOR(R,P);V&&this.layer.mask.setRectXOR(V,P);h(this.layer,P,null!=R,null!=V)};this.getMemoryUsed=function(ba,ta){return(R?R.length:0)+(V?V.length:
0)}}function D(x){let E=x.maskLinked,P=x.maskVisible;this.undo=function(){x.setMask(null);x.maskLinked=E;x.maskVisible=P;n();ca.setActiveLayer(x,!1)};this.redo=function(){let R=new Ea(ca.width,ca.height,8);R.clearAll(255);x.maskLinked=!0;x.maskVisible=!0;x.setMask(R);n();ca.setActiveLayer(x,!0)};this.redo()}function A(x,E){let P=x.mask,R,V=!1;R=E&&x instanceof sa?x.image.clone():null;V=O==x&&da;this.undo=function(){x.setMask(P);R&&(x.image.copyPixelsFrom(R),h(x,x.image.getBounds(),!0,!1));V&&ca.setActiveLayer(x,
!0);n()};this.redo=function(){R&&(G.multiplyAlphaByMask(x.image,100,x.mask),h(x,ca.getBounds(),!0,!1));V&&ca.setActiveLayer(x,!1);x.setMask(null);n()};this.redo()}function F(x,E,P){let R=P instanceof sa&&P.clip,V=x.layers[E],ba=V instanceof sa&&V.clip,ta=da;this.undo=function(){x.removeLayer(P);let Ba=x.layers[E-1]||x.layers[0]||x;V instanceof sa&&(V.clip=ba);P instanceof sa&&(P.clip=R);n();ca.setActiveLayer(Ba,ta)};this.redo=function(){x.insertLayer(E,P);ba&&(P instanceof sa?P.clip=!0:V.clip=!1);
n();ca.setActiveLayer(P,!1)};this.redo()}function J(x){let E=x.clone(),P=da;this.undo=function(){E.parent.removeLayer(E);n();ca.setActiveLayer(x,P)};this.redo=function(){let R=x.name;R.endsWith(" Copy")||(R+=" Copy");E.name=R;x.parent.insertLayer(x.parent.indexOf(x)+1,E);n();ca.setActiveLayer(E,!1)};this.redo()}function N(x){let E=x.parent,P=E.indexOf(x),R=da,V=0;if(x instanceof sa&&!x.clip)for(let ba=P+1;ba<E.layers.length;ba++)if(E.layers[ba]instanceof sa&&E.layers[ba].clip)V++;else break;this.undo=
function(){E.insertLayer(P,x);for(let ba=0;ba<V;ba++)E.layers[ba+P+1].clip=!0;n();ca.setActiveLayer(x,R)};this.redo=function(){var ba;for(ba=0;ba<V;ba++)E.layers[ba+P+1].clip=!1;E.removeLayerAtIndex(P);ba=0==E.layers.length?x.parent:E.layers[Math.max(P-1,0)];n();ca.setActiveLayer(ba,!1)};this.getMemoryUsed=function(ba,ta){return ba?0:x.getMemoryUsed()};this.redo()}function L(x){let E=x.parent.indexOf(x),P=da,R=new sa(ca.width,ca.height,"");this.undo=function(){x.parent.setLayerAtIndex(E,x);n();ca.setActiveLayer(x,
P)};this.redo=function(){x.parent.setLayerAtIndex(E,R);n();ca.setActiveLayer(R,!1)};this.getMemoryUsed=function(ba,ta){return ba?0:x.getMemoryUsed()};var V=new Qd(x,ca.width,ca.height,!1);V.buildTree();V=V.blendTree();R.name=x.name;R.alpha=V.alpha;R.image=V.image;R.blendMode=V.blendMode;R.mask=V.mask;R.blendMode==G.LM_PASSTHROUGH&&(R.blendMode=G.LM_NORMAL);this.redo()}function M(x){let E=x.parent,P=E.layers[E.indexOf(x)-1],R=new sa(ca.width,ca.height,""),V=da;this.undo=function(){let ba=E.indexOf(R);
E.removeLayerAtIndex(ba);E.insertLayer(ba,x);E.insertLayer(ba,P);n();ca.setActiveLayer(x,V)};this.redo=function(){if(P.clip||!x.clip)R.copyFrom(P),0<x.getEffectiveAlpha()&&(R.mask?G.multiplyAlphaByMask(R.image,R.alpha,R.mask):G.multiplyAlphaBy(R.image,R.alpha),G.fuseImageOntoImage(R.image,!0,x.image,x.alpha,x.blendMode,x.getBounds(),x.mask));else{var ba=new Ua;ba.layers=[P,x];ba.parent=null;ba.name="Temporary Group";ba=new Qd(ba,ca.width,ca.height,!1);ba.buildTree();R.image=ba.blendTree().image}R.name=
P.name;R.alpha=100;R.blendMode=P.blendMode;R.mask=null;ba=E.indexOf(P);E.removeLayerAtIndex(ba);E.removeLayerAtIndex(ba);E.insertLayer(ba,R);n();ca.setActiveLayer(R,!1)};this.getMemoryUsed=function(ba,ta){return ba?0:x.getMemoryUsed()+R.getMemoryUsed()};this.redo()}function X(x=!1){let E=ca.getActiveLayer(),P=Za.layers.slice(0),R=new sa(ca.width,ca.height,"");this.undo=function(){Za.layers=P.slice(0);n();ca.setActiveLayer(E,!1)};this.redo=function(){let V=ca.fusionLayers();R.copyImageFrom(V);R.setName(ca.getDefaultLayerName(!1));
x?Za.layers=P.slice(0):Za.clearLayers();Za.addLayer(R);n();ca.setActiveLayer(R,!1)};this.getMemoryUsed=function(V,ba){return P.map(ta=>ta.getMemoryUsed()).reduce(rd,0)};this.redo()}function fa(x,E,P){let R=x.parent,V=x.parent.indexOf(x),ba=da,ta=R.layers[R.indexOf(x)+1],Ba=E.layers[P],hb=x instanceof sa&&x.clip,fc=!!hb&&x.getClippingBase(),gc=0,$b=0;if(x instanceof sa&&!x.clip)for(var Eb=V+1;Eb<R.layers.length;Eb++)if(R.layers[Eb]instanceof sa&&R.layers[Eb].clip)gc++;else break;else if(x instanceof
Ua)for(Eb=P;Eb<E.layers.length;Eb++)if(E.layers[Eb]instanceof sa&&E.layers[Eb].clip)$b++;else break;this.undo=function(){x.parent.removeLayer(x);var pb=ta?R.indexOf(ta):R.layers.length;R.insertLayer(pb,x);x instanceof sa&&(x.clip=hb);for(pb=0;pb<gc;pb++)R.layers[pb+V+1].clip=!0;for(pb=0;pb<$b;pb++)E.layers[pb+P].clip=!0;n();ca.setActiveLayer(x,ba)};this.redo=function(){for(var pb=0;pb<gc;pb++)R.layers[pb+V+1].clip=!1;x.parent.removeLayer(x);pb=Ba?E.indexOf(Ba):E.layers.length;E.insertLayer(pb,x);
for(var y=0;y<$b;y++)E.layers[y+pb+1].clip=!1;x instanceof sa&&(x.clip&&x.getClippingBase()!=fc&&(x.clip=!1),Ba instanceof sa&&Ba.clip&&(x.clip=!0));for(y=0;y<$b;y++)E.layers[y+pb+1].clip=!1;n();ca.setActiveLayer(x,!1)};this.redo()}function pa(x,E){let P=x.substring(0,1).toUpperCase()+x.substring(1),R=function(V,ba){Array.isArray(V)||(V=[V]);this.layers=V;this.from=this.layers.map(ta=>ta["get"+P]());this.to=ba;this.redo()};return R.prototype=Object.create(Ub.prototype),R.prototype.constructor=R,R.prototype.undo=
function(){this.layers.forEach((V,ba)=>V["set"+P](this.from[ba]));this.layers.forEach(V=>g(V,x,!E))},R.prototype.redo=function(){this.layers.forEach(V=>V["set"+P](this.to));this.layers.forEach(V=>g(V,x,!E))},R.prototype.merge=function(V){var ba;if(ba=V instanceof R)a:{ba=this.layers;var ta=V.layers;if(ba.length!=ta.length)ba=!1;else{for(let Ba=0;Ba<ba.length;Ba++)if(ba[Ba]!=ta[Ba]){ba=!1;break a}ba=!0}}return!!ba&&(this.to=V.to,!0)},R.prototype.noChange=function(){for(let V=0;V<this.from.length;V++)if(this.from[V]!=
this.to)return!1;return!0},R}function H(x,E){x=x.clone();E=E.clone();this.undo=function(){ca.setSelection(x);k(ca.getBounds())};this.redo=function(){ca.setSelection(E);k(ca.getBounds())};this.noChange=function(){return x.equals(E)}}function ja(x,E,P){let R=E?x.mask:x.image,V=R.cloneRect(P);P=P.clone();this.undo=function(){R.copyBitmapRect(V,P.left,P.top,V.getBounds());ca.setActiveLayer(x,E);ca.setSelection(P);h(x,P,!E,E)};this.redo=function(){E?R.clearRect(P,0):R.clearRect(P,16777215);wb=new Rd(V,
P.left,P.top);ca.setActiveLayer(x,E);ca.emptySelection();h(x,P,!E,E)};this.getMemoryUsed=function(ba,ta){return V==ta?0:V.getMemorySize()};this.redo()}function U(x){let E=ca.getSelection(),P=da,R=new sa(ca.width,ca.height,ca.getDefaultLayerName(!1)),V=O,ba=V.parent;this.undo=function(){ba.removeLayer(R);ca.setSelection(E);n();ca.setActiveLayer(V,P)};this.redo=function(){var ta=ba.indexOf(V);let Ba=x.bmp.getBounds(),hb,fc;(ba.insertLayer(ta+1,R),Ba.isInside(ca.getBounds())?(hb=x.x,fc=x.y):(hb=(ca.width-
x.bmp.width)/2|0,fc=(ca.height-x.bmp.height)/2|0),x.bmp instanceof Ea)?(ta=new z(x.bmp.width,x.bmp.height),ta.copyPixelsFromGreyscale(x.bmp),R.image.copyBitmapRect(ta,hb,fc,Ba)):R.image.copyBitmapRect(x.bmp,hb,fc,Ba);ca.emptySelection();n();ca.setActiveLayer(R,!1)};this.getMemoryUsed=function(ta,Ba){return x.bmp==Ba?0:x.bmp.getMemorySize()};this.redo()}a|=0;c|=0;let Za=new Ua("Root",G.LM_NORMAL),Ia=new Qd(Za,a,c,!0),zb=new z(a,c),Cb=new oa(0,0,a,c),db=new Ea(a,c,8),ya=new oa(0,0,a,c),T=new Ea(a,c,
32),Z=new oa(0,0,0,0),va=new Nf,ca=this,Pa=[],O=Za,da=!1,Ka=null,bb=new oa(0,0,0,0),Jb=!1,Ja=new oa(0,0,0,0),sb=null,Gb=new Of,jb=null,wb=null,Qa=[],Ob=[],rb=null,Kb=0,eb=0,Wa=0,Bb=!1,ib=!1,ec=new Set,jc=new Set,Zb=null,lc=0,Pb="smooth";this.getLayersRoot=function(){return Za};this.getSelectionAutoSelect=function(){return Ja.isEmpty()?this.getBounds():this.getSelection()};this.getSelection=function(){return Ja.clone()};this.setHasUnsavedChanges=function(x){x!=Jb&&(Jb=x,this.emitEvent("unsavedChanges",
[x]))};this.getHasUnsavedChanges=function(){return Jb};this.isAddLayerMaskAllowed=function(){return!O.mask};this.addLayerMask=function(){this.isAddLayerMaskAllowed()&&w(new D(O))};this.isRemoveLayerMaskAllowed=function(){return null!==O.mask};this.removeLayerMask=function(){this.isRemoveLayerMaskAllowed()&&w(new A(O,!1))};this.isApplyLayerMaskAllowed=function(){return null!==O.mask&&O instanceof sa};this.applyLayerMask=function(x){this.isApplyLayerMaskAllowed()&&w(new A(O,!0))};this.addLayer=function(x){let E,
P;if(O instanceof Ua&&O.expanded?(E=O,P=O.layers.length):P=(E=O.parent).layers.indexOf(O)+1,"group"===x){for(;E.layers[P]instanceof sa&&E.layers[P].clip;)P++;x=new Ua(this.getDefaultLayerName(!0),G.LM_PASSTHROUGH)}else(x=new sa(this.width,this.height,this.getDefaultLayerName(!1))).image.clearAll(16777215);return w(new F(E,P,x)),x};this.addLayerObject=function(x,E){x.addLayer(E);x==Za&&1==Za.layers.length&&(O=E);n()};this.addLayerGroupObject=function(x,E,P){let R=[];for(let V=0;V<P;V++)R.unshift(x.layers.pop());
R.forEach(V=>E.addLayer(V));this.addLayerObject(x,E)};this.isRemoveLayerAllowed=function(){return O instanceof sa?Za.getLinearizedLayerList(!1).some(x=>x instanceof sa&&x!=O):O instanceof Ua&&Za.getLinearizedLayerList(!1).some(x=>x instanceof sa&&!x.hasAncestor(O))};this.removeLayer=function(){return!!this.isRemoveLayerAllowed()&&(w(new N(O)),!0)};this.duplicateLayer=function(){w(new J(O))};this.isMergeDownAllowed=function(){let x=O.parent.indexOf(O);return 0<x&&O instanceof sa&&O.parent.layers[x-
1]instanceof sa};this.mergeDown=function(){this.isMergeDownAllowed()&&w(new M(O))};this.isMergeGroupAllowed=function(){return O instanceof Ua&&0<O.getEffectiveAlpha()};this.mergeGroup=function(){this.isMergeGroupAllowed()&&w(new L(O))};this.isMergeAllLayersAllowed=function(){return 1<Za.getLinearizedLayerList(!1).length};this.mergeAllLayers=function(x=!1){this.isMergeAllLayersAllowed()&&w(new X(x))};this.relocateLayer=function(x,E,P){x&&E&&x!=E&&!E.hasAncestor(x)&&w(new fa(x,E,P))};this.setLayerVisibility=
function(x,E){let P=[];if(x.ancestorsAreVisible())x.visible!=E&&w(new kc(x,E));else{for(;null!=x;x=x.parent)x.visible||P.push(x);w(new kc(P,!0))}};this.expandLayerGroup=function(x,E){x.expanded!=E&&(x.expanded=E,!E&&O.hasAncestor(x)&&this.setActiveLayer(x,!1),g(x,"expanded",!0))};this.setLayerAlpha=function(x){O.getAlpha()!=x&&w(new Fb(O,x))};this.setLayerMaskLinked=function(x){O.maskLinked!=x&&w(new vc(O,x))};this.setLayerMaskVisible=function(x,E){x.maskVisible!=E&&w(new Lb(x,E))};this.setLayerBlendMode=
function(x){O.getBlendMode()!=x&&(x!=G.LM_PASSTHROUGH||O instanceof Ua)&&w(new wc(O,x))};this.setLayerName=function(x,E){x.getName()!=E&&w(new dc(x,E))};this.paintDab=function(x,E,P){rb.applyPressure(P);0<rb.scattering&&(x+=Gb.nextGaussian()*rb.curScattering/4,E+=Gb.nextGaussian()*rb.curScattering/4);P=Pa[rb.brushMode];x=va.getDab(x,E,rb);E=new oa(0,0,x.width,x.height);let R=new oa(0,0,x.width,x.height);if(R.translate(x.x,x.y),ca.getBounds().clipSourceDest(E,R),!R.isEmpty()){bb.union(R);var V=da?
O.mask:O.image;P.paintDab(V,R,Bb&&!da?sb:V,rb,E,x,lc);!da&&P.noMergePhase&&O.getLockAlpha()&&V.copyAlphaFrom(zb,R);P.wantsOutputAsInput&&(m(),Bb&&!da&&ca.fusionLayers());l(O,R)}};this.getDefaultLayerName=function(x){let E=x?"Group ":"Layer ";x=x?/^Group [0-9]+$/:/^Layer [0-9]+$/;let P=0,R=Za.getLinearizedLayerList(!1);for(let V=0;V<R.length;V++){let ba=R[V];x.test(ba.name)&&(P=Math.max(P,parseInt(ba.name.substring(E.length),10)))}return E+(P+1)};this.addBackgroundLayer=function(){let x=new sa(ca.width,
ca.height,this.getDefaultLayerName(!1));x.image.clearAll(4294967295);this.addLayerObject(this.getLayersRoot(),x)};this.addDefaultLayer=function(){let x=new sa(ca.width,ca.height,this.getDefaultLayerName(!1));x.image.clearAll(16777215);this.addLayerObject(this.getLayersRoot(),x);this.setActiveLayer(x,!1)};this.fusionLayers=function(){m();Ia.buildTree();return sb=Ia.blendTree().image};this.upgradeMultiplyLayers=function(x){let E=this.getLayersRoot().getLinearizedLayerList(!1,[]),P=-1;for(var R=0;R<
E.length;R++){var V=E[R];if(!(V instanceof sa)||V.mask||V.blendMode>G.LM_LAST_CHIBIPAINT)throw Error("Bad layer type during multiply upgrade");V.blendMode===G.LM_MULTIPLY&&(P=R)}if(-1!==P){R=new z(this.width,this.height);let ba=V=!0,ta=this.getBounds();R.clearAll(ta,16777215);for(let Ba=0;Ba<=P;Ba++){let hb=E[Ba];ba||(V=V&&R.hasAlphaInRect(ta));hb.blendMode===G.LM_MULTIPLY&&("bake"===x?!V&&0<hb.getEffectiveAlpha()&&(100===hb.alpha?G.upgradeMultiplyOfOpaqueLayer(R,hb.image,100,ta):G.upgradeMultiplyOfTransparentLayer(R,
hb.image,hb.alpha,ta),hb.setBlendMode(G.LM_MULTIPLY2)):V&&hb.setBlendMode(G.LM_MULTIPLY2));0<hb.getEffectiveAlpha()&&(ba=!1,G.fuseImageOntoImage(R,V,hb.image,hb.alpha,hb.blendMode,ta,null))}}};this.isCreateClippingMaskAllowed=function(){var x=O.parent.indexOf(O);x=O.parent.layers[x-1];return O instanceof sa&&!O.clip&&x instanceof sa};this.createClippingMask=function(){this.isCreateClippingMaskAllowed()&&w(new ha(O,!0))};this.isReleaseClippingMaskAllowed=function(){return O instanceof sa&&O.clip};
this.releaseClippingMask=function(){this.isReleaseClippingMaskAllowed()&&w(new ha(O,!1))};this.setActiveLayer=function(x,E){if(x){let P=(E=x.mask&&E)!=da;if(O!=x||P){let R=O;O=x;da=E;u();this.emitEvent("changeActiveLayer",[R,x,da]);P&&this.emitEvent("editModeChanged",[da?Yb.EDITING_MODE_MASK:Yb.EDITING_MODE_IMAGE]);Ka&&Ka.layer==R&&(E?Ka.setLayer(x):this.closeMaskView())}}};this.closeMaskView=function(){Ka.close();Ka=null};this.toggleMaskView=function(){return null!=Ka&&Ka.isOpen()?this.closeMaskView():
Ka=O.mask?new Pf(O,m):null,Ka};this.selectTopmostVisibleLayer=function(){let x=Za.getLinearizedLayerList(!1);for(var E=x.length-1;0<=E;E--)if(x[E]instanceof sa&&0<x[E].getEffectiveAlpha())return void this.setActiveLayer(x[E],!1);for(E=x.length-1;0<=E;E--)if(x[E]instanceof sa)return void this.setActiveLayer(x[E],!1);this.setActiveLayer(x[x.length-1],!1)};this.getActiveLayer=function(){return O};this.isEditingMask=function(){return da};this.isActiveLayerDrawable=function(){return da&&O.mask||!da&&O instanceof
sa};this.getUndoMemoryUsed=function(){let x=0;for(let E of Ob)x+=E.getMemoryUsed(!0,null);for(let E of Qa)x+=E.getMemoryUsed(!1,null);return x};this.isUndoAllowed=function(){return 0<Qa.length};this.isRedoAllowed=function(){return 0<Ob.length};this.undo=function(){if(this.isUndoAllowed()){this.setHasUnsavedChanges(!0);var x=Qa.pop();x.undo();Ob.push(x)}};this.redo=function(){if(this.isRedoAllowed()){this.setHasUnsavedChanges(!0);var x=Ob.pop();x.redo();Qa.push(x)}};this.performIdleTasks=function(){t();
m();Ia.buildTree()};this.compactUndo=function(){0<Qa.length&&Qa[Qa.length-1].compact()};this.clearHistory=function(){Qa=[];Ob=[]};this.colorPicker=function(x,E){return da&&O.mask?fb.greyToRGB(O.mask.getPixel(~~x,~~E)):16777215&sb.getPixel(~~x,~~E)};this.setSelection=function(x){Ja.set(x);Ja.roundNearest();Ja.clipTo(this.getBounds())};this.emptySelection=function(){Ja.makeEmpty()};this.floodFill=function(x,E){let P=f();P&&(t(),bb=this.getBounds(),P.floodFill(~~x,~~E,4278190080|lc),w(new C),l(O,this.getBounds()))};
this.gradientFill=function(x,E,P,R,V){let ba=this.getSelectionAutoSelect(),ta=f();ta&&(t(),bb=ba.clone(),ta.gradient(ba,x,E,P,R,V,!1),this.getLayerLockAlpha()&&ta instanceof z&&ta.copyAlphaFrom(zb,ba),w(new C),l(O,ba))};this.fill=function(x){let E=this.getSelectionAutoSelect(),P=f();P&&(t(),bb=E.clone(),P.clearRect(E,x),w(new C),l(O,E))};this.clear=function(){da?this.fill(0):this.fill(16777215)};this.flip=function(x){let E=this.getSelection(),P=E.isEmpty();var R=P&&O instanceof sa&&O.mask&&O.maskLinked;
let V=(!da||R)&&O instanceof sa;R=(da||R)&&O.mask;x=x?"copyRegionHFlip":"copyRegionVFlip";(V||R)&&(P&&(E=this.getBounds()),bb=E.clone(),V&&(q(),O.image[x](E,zb)),R&&(r(),O.mask[x](E,db)),w(new C(V,R)),h(O,E,V,R))};this.hFlip=function(){this.flip(!0)};this.vFlip=function(){this.flip(!1)};this.monochromaticNoise=function(){let x=this.getSelectionAutoSelect(),E=f();E&&(t(),bb=x.clone(),E.fillWithNoise(x),w(new C),l(O,x))};this.isColorNoiseAllowed=function(){return!this.isEditingMask()&&this.isActiveLayerDrawable()};
this.colorNoise=function(){if(this.isColorNoiseAllowed()){let x=this.getSelectionAutoSelect();t();bb=x.clone();O.image.fillWithColorNoise(x);w(new C(!0,!1));h(O,x,!0,!1)}};this.invert=function(){let x=this.getSelectionAutoSelect(),E=f();E&&(t(),bb=x.clone(),E.invert(x),w(new C),l(O,x))};this.brightnessToOpacity=function(){let x=this.getSelectionAutoSelect(),E=f();E&&(t(),bb=x.clone(),E.brightnessToOpacity(x),w(new C),l(O,x))};this.boxBlur=function(x,E,P){let R=this.getSelectionAutoSelect(),V=f();
if(V){t();bb=R.clone();for(let ba=0;ba<P;ba++)V.boxBlur(R,x,E);w(new C);l(O,R)}};this.rectangleSelection=function(x){x=x.clone();x.clipTo(this.getBounds());w(new H(this.getSelection(),x));this.setSelection(x)};this.move=function(x,E,P){if(E|=0,0!=(x|=0)||0!=E){var R=0<Qa.length?Qa[Qa.length-1]:null;!P&&R instanceof hc&&R.layer==this.getActiveLayer()?(R.amend(x,E),Ob=[],this.setHasUnsavedChanges(!0)):(x=new hc(x,E,P),w(x),x.redo())}};this.setTransformInterpolation=function(x){Pb=x;jb instanceof Qb&&
jb.setInterpolation(x)};this.transformAffineAbort=function(){jb instanceof Qb&&(jb.undo(),jb=null,d(!0))};this.transformAffineBegin=function(){if(jb instanceof Qb)return{transform:jb.getTransform(),rect:jb.getInitialTransformRect(),selection:jb.getInitialSelectionRect()};let x=new lb,E;return(E=new Qb(x,Pb)).getInitialTransformRect().isEmpty()?null:(jb=E,ib=!0,{transform:x,rect:E.getInitialTransformRect(),selection:E.getInitialSelectionRect()})};this.transformAffineFinish=function(){jb instanceof
Qb&&(w(jb),jb=null,d(!0))};this.transformAffineAmend=function(x){jb instanceof Qb&&jb.amend(x)};this.isCopySelectionAllowed=this.isCutSelectionAllowed=function(){return!this.getSelection().isEmpty()&&null!==f()};this.cutSelection=function(){this.isCutSelectionAllowed()&&w(new ja(O,da,this.getSelection()))};this.copySelection=function(){if(this.isCopySelectionAllowed()){let x=ca.getSelection();wb=new Rd(f().cloneRect(x),x.left,x.top)}};this.isCopySelectionMergedAllowed=function(){return!this.getSelection().isEmpty()};
this.copySelectionMerged=function(){if(this.isCopySelectionMergedAllowed()){let x=ca.getSelection();wb=new Rd(this.fusionLayers().cloneRect(x),x.left,x.top)}};this.isPasteClipboardAllowed=function(){return!this.isClipboardEmpty()};this.pasteClipboard=function(){this.isPasteClipboardAllowed()&&w(new U(wb))};this.getClipboard=function(){return wb};this.setClipboard=function(x){wb=x};this.isClipboardEmpty=function(){return null==wb};this.setSampleAllLayers=function(x){Bb=x};this.getLayerLockAlpha=function(){return this.getActiveLayer().getLockAlpha()};
this.setLayerLockAlpha=function(x){O.getLockAlpha()!=x&&w(new Rb(O,x))};this.setForegroundColor=function(x){lc=x};this.setBrush=function(x){rb=x};this.setBrushTexture=function(x){va.setTexture(x)};this.beginStroke=function(x,E,P){return null!==rb&&!!this.isActiveLayerDrawable()&&(t(),bb.makeEmpty(),T.clearAll(0),Z.makeEmpty(),Kb=x,eb=E,Wa=P,ib=!0,Pa[rb.brushMode].beginStroke(),this.paintDab(x,E,P),!0)};this.continueStroke=function(x,E,P){if(null!=rb){var R=Math.sqrt((Kb-x)*(Kb-x)+(eb-E)*(eb-E)),V=
Math.max(rb.minSpacing,rb.curSize*rb.spacing);if(R>V){let ba=Kb,ta=eb,Ba=Wa;R=(V-.001)/R;for(V=R;1>=V;V+=R)ba=V*x+(1-V)*Kb,ta=V*E+(1-V)*eb,Ba=V*P+(1-V)*Wa,this.paintDab(ba,ta,Ba);Kb=ba;eb=ta;Wa=Ba}}};this.endStroke=function(){null!=rb&&(m(),Pa[rb.brushMode].endStroke(),bb.clipTo(this.getBounds()),bb.isEmpty()||(w(new C),t()),d(!1))};this.hasAlpha=function(){return sb.hasAlpha()};this.getFlatPNG=function(x){return this.fusionLayers(),sb.getAsPNG(x)};this.getFlatPNGBuffer=function(x){return this.fusionLayers(),
sb.getAsPNGBuffer(x)};this.isSimpleDrawing=function(){return 1==Za.layers.length&&Za.layers[0]instanceof sa&&!Za.layers[0].mask&&100==Za.layers[0].getEffectiveAlpha()};C.prototype=Object.create(Ub.prototype);C.prototype.constructor=C;D.prototype=Object.create(Ub.prototype);D.prototype.constructor=D;A.prototype=Object.create(Ub.prototype);A.prototype.constructor=A;F.prototype=Object.create(Ub.prototype);F.prototype.constructor=F;J.prototype=Object.create(Ub.prototype);J.prototype.constructor=J;N.prototype=
Object.create(Ub.prototype);N.prototype.constructor=N;L.prototype=Object.create(Ub.prototype);L.prototype.constructor=L;M.prototype=Object.create(Ub.prototype);M.prototype.constructor=M;X.prototype=Object.create(Ub.prototype);X.prototype.constructor=X;fa.prototype=Object.create(Ub.prototype);fa.prototype.constructor=fa;let Fb=pa("alpha",!0),wc=pa("blendMode",!0),kc=pa("visible",!0),ha=pa("clip",!0),Lb=pa("maskVisible",!0),dc=pa("name",!1),Rb=pa("lockAlpha",!1),vc=pa("maskLinked",!1);H.prototype=Object.create(Ub.prototype);
H.prototype.constructor=H;class Da extends Ub{undo(){let x=[];this.dstRect.isEmpty()||x.push(this.dstRect);this.erasesSourceRect&&(x.push(this.srcRect),x=oa.union(x));this.movingLayers.forEach(E=>{this.hasFullUndo?x.forEach(P=>{E.moveImage&&E.layer.image.copyBitmapRect(E.imageUndo,P.left,P.top,P);E.moveMask&&E.layer.mask.copyBitmapRect(E.maskUndo,P.left,P.top,P)}):(E.moveImage&&E.imageRect.forEach((P,R)=>{E.layer.image.copyBitmapRect(P,R.left,R.top,P.getBounds())}),E.moveMask&&E.maskRect.forEach((P,
R)=>{E.layer.mask.copyBitmapRect(P,R.left,R.top,P.getBounds())}))});h(this.movingLayers.map(E=>E.layer),x.reduce((E,P)=>E.getUnion(P),new oa(0,0,0,0)),!0,!0);this.dstRect.makeEmpty();ca.setSelection(this.fromSelection);ca.setActiveLayer(this.layer,this.fromMaskMode);b()}getMemoryUsed(x,E){return this.movingLayers.map(function(P){return[P.imageUndo,P.maskUndo,P.imageRect,P.maskRect].map(R=>R?R.getMemorySize():0).reduce(rd,0)}).reduce(rd,0)}buildFullUndo(){this.hasFullUndo||(this.movingLayers.forEach(function(x){x.moveImage&&
(x.imageUndo=x.layer.image.clone());x.moveMask&&(x.maskUndo=x.layer.mask.clone());x.imageRect.clear();x.maskRect.clear()}),this.hasFullUndo=!0)}compact(){if(this.hasFullUndo){let x=[];this.dstRect.isEmpty()||x.push(this.dstRect);this.erasesSourceRect&&(x.push(this.srcRect),x=oa.union(x));this.movingLayers.forEach(E=>{E.imageRect.clear();E.maskRect.clear();x.forEach(P=>{E.moveImage&&E.imageRect.set(P,E.imageUndo.cloneRect(P));E.moveMask&&E.maskRect.set(P,E.maskUndo.cloneRect(P))});E.imageUndo=null;
E.maskUndo=null});this.hasFullUndo=!1}}constructor(){super();this.layer=O;this.fromSelection=ca.getSelection();this.fromMaskMode=da;this.movingWholeLayer=this.fromSelection.isEmpty();this.movingImage=!da||this.movingWholeLayer&&this.layer.maskLinked;this.movingMask=da||this.movingWholeLayer&&this.layer.maskLinked;this.erasesSourceRect=this.hasFullUndo=!1;this.dstRect=new oa(0,0,0,0);this.movingLayers=[{layer:this.layer,moveImage:this.layer instanceof sa&&this.movingImage,moveMask:null!==this.layer.mask&&
this.movingMask,imageRect:new Map,maskRect:new Map}];this.layer instanceof Ua&&this.movingImage&&this.movingWholeLayer&&(this.movingLayers=this.movingLayers.concat(this.layer.getLinearizedLayerList(!1).map(R=>({layer:R,moveImage:R instanceof sa,moveMask:null!==R.mask&&R.maskLinked,imageRect:new Map,maskRect:new Map}))));let x=new oa(0,0,0,0);if(this.movingWholeLayer){this.srcRect=ca.getBounds();for(var E=0;E<this.movingLayers.length&&!x.equals(this.srcRect);E++){var P=this.movingLayers[E];P.moveMask&&
x.union(P.layer.mask.getValueBounds(this.srcRect,255));P.moveImage&&x.union(P.layer.image.getNonTransparentBounds(this.srcRect))}}else for(this.srcRect=this.fromSelection.clone(),E=0;E<this.movingLayers.length&&!x.equals(this.srcRect);E++)P=this.movingLayers[E],P.moveMask&&x.union(P.layer.mask.getValueBounds(this.srcRect,0)),P.moveImage&&x.union(P.layer.image.getNonTransparentBounds(this.srcRect));this.srcRect=x}}class Qb extends Da{buildFullUndo(){this.hasFullUndo||(super.buildFullUndo(),this.movingLayers.forEach(x=>
{if(x.moveImage){var E=pc(this.srcRect.getWidth(),this.srcRect.getHeight());E.getContext("2d").putImageData(x.layer.image.getImageData(),-this.srcRect.left,-this.srcRect.top,this.srcRect.left,this.srcRect.top,this.srcRect.getWidth(),this.srcRect.getHeight());x.imageSourceCanvas=E}x.moveMask&&(E=pc(this.srcRect.getWidth(),this.srcRect.getHeight()),E.getContext("2d").putImageData(x.layer.mask.getImageData(this.srcRect.left,this.srcRect.top,this.srcRect.getWidth(),this.srcRect.getHeight()),0,0),x.maskSourceCanvas=
E)}),this.composeCanvas=pc(ca.width,ca.height),this.composeCanvasContext=this.composeCanvas.getContext("2d",{willReadFrequently:!0}),Td(this.composeCanvasContext,"smooth"==this.interpolation),this.junk=this.composeCanvasContext.getImageData(0,0,1,1))}redo(){this.buildFullUndo();var x=this.dstRect.clone();let E=this.srcRect.toPoints();this.affineTransform.transformPoints(E);this.dstRect.set(oa.createBoundingBox(E).roundContain().clipTo(ca.getBounds()));let P=oa.subtract(this.dstRect,this.srcRect),
R=oa.subtract(x.isEmpty()?this.srcRect:this.srcRect.getIntersection(x),this.dstRect),V=this.srcRect.getIntersection(this.dstRect),ba=oa.subtract(x,[this.dstRect,this.srcRect]);x=this.srcRect.getUnion(this.dstRect).getUnion(x);(this.movingLayers.forEach(ta=>{if(R.forEach(Ba=>{ta.moveImage&&ta.layer.image.clearRect(Ba,16777215);ta.moveMask&&(this.movingWholeLayer?ta.layer.mask.clearRect(Ba,255):ta.layer.mask.clearRect(Ba,0))}),!this.dstRect.isEmpty()){if(ta.moveImage){let Ba=ta.imageUndo.getImageData();
P.forEach(hb=>{this.composeCanvasContext.putImageData(Ba,0,0,hb.left,hb.top,hb.getWidth(),hb.getHeight())});this.composeCanvasContext.clearRect(V.left,V.top,V.getWidth(),V.getHeight());this.composeCanvasContext.save();this.composeCanvasContext.setTransform(this.affineTransform.m[0],this.affineTransform.m[1],this.affineTransform.m[2],this.affineTransform.m[3],this.affineTransform.m[4],this.affineTransform.m[5]);this.composeCanvasContext.drawImage(ta.imageSourceCanvas,this.srcRect.left,this.srcRect.top);
this.composeCanvasContext.restore();ta.layer.image.copyBitmapRect(new z(this.composeCanvasContext.getImageData(this.dstRect.left,this.dstRect.top,this.dstRect.getWidth(),this.dstRect.getHeight())),this.dstRect.left,this.dstRect.top,new oa(0,0,this.dstRect.getWidth(),this.dstRect.getHeight()))}ta.moveMask&&(P.forEach(Ba=>{this.composeCanvasContext.putImageData(ta.layer.mask.getImageData(Ba.left,Ba.top,Ba.getWidth(),Ba.getHeight()),Ba.left,Ba.top)}),this.movingWholeLayer?this.composeCanvasContext.fillStyle=
"#FFF":this.composeCanvasContext.fillStyle="#000",this.composeCanvasContext.fillRect(V.left,V.top,V.getWidth(),V.getHeight()),this.composeCanvasContext.save(),this.composeCanvasContext.setTransform(this.affineTransform.m[0],this.affineTransform.m[1],this.affineTransform.m[2],this.affineTransform.m[3],this.affineTransform.m[4],this.affineTransform.m[5]),this.composeCanvasContext.drawImage(ta.maskSourceCanvas,this.srcRect.left,this.srcRect.top),this.composeCanvasContext.restore(),ta.layer.mask.pasteImageData(this.composeCanvasContext.getImageData(this.dstRect.left,
this.dstRect.top,this.dstRect.getWidth(),this.dstRect.getHeight()),this.dstRect.left,this.dstRect.top))}ba.forEach(Ba=>{ta.moveImage&&ta.layer.image.copyBitmapRect(ta.imageUndo,Ba.left,Ba.top,Ba);ta.moveMask&&ta.layer.mask.copyBitmapRect(ta.maskUndo,Ba.left,Ba.top,Ba)})}),h(this.movingLayers.map(ta=>ta.layer),x,!0,!0),this.fromSelection.isEmpty())||(x=this.fromSelection.toPoints(),this.affineTransform.transformPoints(x),(x=oa.createBoundingBox(x)).roundNearest(),ca.setSelection(x),b());ca.setActiveLayer(this.layer,
this.fromMaskMode)}amend(x){this.hasFullUndo||this.undo();this.affineTransform=x.clone();this.redo()}setInterpolation(x){x!=this.interpolation&&(this.interpolation=x,this.composeCanvasContext&&Td(this.composeCanvasContext,"smooth"==this.interpolation),this.undo(),this.redo())}compact(){super.compact();this.composeCanvasContext=this.composeCanvas=null;this.movingLayers.forEach(x=>x.imageSourceCanvas=null)}getMemoryUsed(x,E){x=super.getMemoryUsed(x,E);return x+=Ae(this.composeCanvas),x+=this.movingLayers.map(P=>
Ae(P.imageSourceCanvas)).reduce(rd,0)}getTransform(){return this.affineTransform.clone()}getInitialTransformRect(){return this.srcRect.clone()}getInitialSelectionRect(){return this.fromSelection.clone()}constructor(x,E){super();this.erasesSourceRect=!0;this.affineTransform=x.clone();this.interpolation=E||"smooth";this.composeCanvasContext=this.composeCanvas=null}}class hc extends Da{redo(){var x=this.dstRect.clone();let E,P,R=x.clone(),V=null;(this.buildFullUndo(),this.dstRect.set(this.srcRect),this.dstRect.translate(this.offsetX,
this.offsetY),E=this.dstRect.clone(),this.dstRect.clipTo(ca.getBounds()),this.erasesSourceRect?(V=x.isEmpty()?this.srcRect:this.srcRect.getIntersection(x),R.union(V),P=x.subtract(this.srcRect)):P=[x],this.movingLayers.forEach(ba=>{V&&(ba.moveImage&&ba.layer.image.clearRect(V,16777215),ba.moveMask&&ba.layer.mask.clearRect(V,255*!!this.movingWholeLayer));P.forEach(function(ta){ba.moveImage&&ba.layer.image.copyBitmapRect(ba.imageUndo,ta.left,ta.top,ta);ba.moveMask&&ba.layer.mask.copyBitmapRect(ba.maskUndo,
ta.left,ta.top,ta)});ba.moveImage&&G.normalFuseImageOntoImageAtPosition(ba.layer.image,ba.imageUndo,E.left,E.top,this.srcRect);ba.moveMask&&ba.layer.mask.copyBitmapRect(ba.maskUndo,E.left,E.top,this.srcRect)}),R.union(this.dstRect),h(this.movingLayers.map(ba=>ba.layer),R,!0,!0),this.fromSelection.isEmpty())||(x=this.fromSelection.clone(),x.translate(this.offsetX,this.offsetY),ca.setSelection(x),b())}amend(x,E){this.hasFullUndo||this.undo();this.offsetX+=x;this.offsetY+=E;this.redo()}constructor(x,
E,P){super();this.offsetX=x;this.offsetY=E;this.erasesSourceRect=!P}}ja.prototype=Object.create(Ub.prototype);ja.prototype.constructor=ja;U.prototype=Object.create(Ub.prototype);U.prototype.constructor=U;Pa=[Pc,Qf,Rf,Sf,ad,Tf,Uf,Vf].map(x=>new x(T,Z));this.width=a;this.height=c}function ab(a,c,d){this.data=a;this.eof=!1;this.start=void 0===c?0:c;this.end=void 0===d?a.length:d;this.pos=this.start}function Qc(a){for(var c=a.length;0<=--c;)a[c]=0}function Ud(a,c,d,b,k){this.static_tree=a;this.extra_bits=
c;this.extra_base=d;this.elems=b;this.max_length=k;this.has_stree=a&&a.length}function Vd(a,c){this.dyn_tree=a;this.max_code=0;this.stat_desc=c}function Be(a){return 256>a?bd[a]:bd[256+(a>>>7)]}function cd(a,c){a.pending_buf[a.pending++]=255&c;a.pending_buf[a.pending++]=c>>>8&255}function ac(a,c,d){a.bi_valid>16-d?(a.bi_buf|=c<<a.bi_valid&65535,cd(a,a.bi_buf),a.bi_buf=c>>16-a.bi_valid,a.bi_valid+=d-16):(a.bi_buf|=c<<a.bi_valid&65535,a.bi_valid+=d)}function mc(a,c,d){ac(a,d[2*c],d[2*c+1])}function Ce(a,
c){var d=0;do d|=1&a,a>>>=1,d<<=1;while(0<--c);return d>>>1}function De(a,c,d){var b,k=Array(16),n=0;for(b=1;15>=b;b++)k[b]=n=n+d[b-1]<<1;for(d=0;d<=c;d++)b=a[2*d+1],0!==b&&(a[2*d]=Ce(k[b]++,b))}function Ee(a){var c;for(c=0;286>c;c++)a.dyn_ltree[2*c]=0;for(c=0;30>c;c++)a.dyn_dtree[2*c]=0;for(c=0;19>c;c++)a.bl_tree[2*c]=0;a.dyn_ltree[512]=1;a.opt_len=a.static_len=0;a.last_lit=a.matches=0}function Fe(a){8<a.bi_valid?cd(a,a.bi_buf):0<a.bi_valid&&(a.pending_buf[a.pending++]=a.bi_buf);a.bi_buf=0;a.bi_valid=
0}function Ge(a,c,d,b){var k=2*c,n=2*d;return a[k]<a[n]||a[k]===a[n]&&b[c]<=b[d]}function Wd(a,c,d){for(var b=a.heap[d],k=d<<1;k<=a.heap_len&&(k<a.heap_len&&Ge(c,a.heap[k+1],a.heap[k],a.depth)&&k++,!Ge(c,b,a.heap[k],a.depth));)a.heap[d]=a.heap[k],d=k,k<<=1;a.heap[d]=b}function He(a,c,d){var b,k,n=0;if(0!==a.last_lit){do{var g=a.pending_buf[a.d_buf+2*n]<<8|a.pending_buf[a.d_buf+2*n+1];var e=a.pending_buf[a.l_buf+n];n++;0===g?mc(a,e,c):(mc(a,(b=dd[e])+256+1,c),0!==(k=Xd[b])&&ac(a,e-Yd[b],k),mc(a,b=
Be(--g),d),0!==(k=sd[b])&&ac(a,g-td[b],k))}while(n<a.last_lit)}mc(a,256,c)}function Zd(a,c){var d,b=c.dyn_tree;var k=c.stat_desc.static_tree;var n=c.stat_desc.has_stree,g=c.stat_desc.elems,e=-1;var h=0;a.heap_len=0;for(a.heap_max=573;h<g;h++)0!==b[2*h]?(a.heap[++a.heap_len]=e=h,a.depth[h]=0):b[2*h+1]=0;for(;2>a.heap_len;)b[2*(d=a.heap[++a.heap_len]=2>e?++e:0)]=1,a.depth[d]=0,a.opt_len--,n&&(a.static_len-=k[2*d+1]);c.max_code=e;for(h=a.heap_len>>1;1<=h;h--)Wd(a,b,h);d=g;do h=a.heap[1],a.heap[1]=a.heap[a.heap_len--],
Wd(a,b,1),k=a.heap[1],a.heap[--a.heap_max]=h,a.heap[--a.heap_max]=k,b[2*d]=b[2*h]+b[2*k],a.depth[d]=(a.depth[h]>=a.depth[k]?a.depth[h]:a.depth[k])+1,b[2*h+1]=b[2*k+1]=d,a.heap[1]=d++,Wd(a,b,1);while(2<=a.heap_len);a.heap[--a.heap_max]=a.heap[1];var l,f,m,q,r;h=c.dyn_tree;d=c.max_code;k=c.stat_desc.static_tree;n=c.stat_desc.has_stree;g=c.stat_desc.extra_bits;var t=c.stat_desc.extra_base,u=c.stat_desc.max_length,w=0;for(m=0;15>=m;m++)a.bl_count[m]=0;h[2*a.heap[a.heap_max]+1]=0;for(c=a.heap_max+1;573>
c;c++)(m=h[2*h[2*(l=a.heap[c])+1]+1]+1)>u&&(m=u,w++),h[2*l+1]=m,l>d||(a.bl_count[m]++,q=0,l>=t&&(q=g[l-t]),r=h[2*l],a.opt_len+=r*(m+q),!n||(a.static_len+=r*(k[2*l+1]+q)));if(0!==w){do{for(m=u-1;0===a.bl_count[m];)m--;a.bl_count[m]--;a.bl_count[m+1]+=2;a.bl_count[u]--;w-=2}while(0<w);for(m=u;0!==m;m--)for(l=a.bl_count[m];0!==l;)(f=a.heap[--c])>d||(h[2*f+1]!==m&&(a.opt_len+=(m-h[2*f+1])*h[2*f],h[2*f+1]=m),l--)}De(b,e,a.bl_count)}function Ie(a,c,d){var b,k=-1,n=c[1],g=0,e=7,h=4;0===n&&(e=138,h=3);c[2*
(d+1)+1]=65535;for(b=0;b<=d;b++){var l=n;n=c[2*(b+1)+1];++g<e&&l===n||(g<h?a.bl_tree[2*l]+=g:0!==l?(l!==k&&a.bl_tree[2*l]++,a.bl_tree[32]++):10>=g?a.bl_tree[34]++:a.bl_tree[36]++,g=0,k=l,0===n?(e=138,h=3):l===n?(e=6,h=3):(e=7,h=4))}}function Je(a,c,d){var b,k,n=-1,g=c[1],e=0,h=7,l=4;0===g&&(h=138,l=3);for(b=0;b<=d;b++)if(k=g,g=c[2*(b+1)+1],!(++e<h)||k!==g){if(e<l){do mc(a,k,a.bl_tree);while(0!=--e)}else 0!==k?(k!==n&&(mc(a,k,a.bl_tree),e--),mc(a,16,a.bl_tree),ac(a,e-3,2)):10>=e?(mc(a,17,a.bl_tree),
ac(a,e-3,3)):(mc(a,18,a.bl_tree),ac(a,e-11,7));e=0;n=k;0===g?(h=138,l=3):k===g?(h=6,l=3):(h=7,l=4)}}function Ke(a,c,d,b){ac(a,+!!b,3);Fe(a);cd(a,d);cd(a,~d);Fa.arraySet(a.pending_buf,a.window,c,d,a.pending);a.pending+=d}function xc(a,c){return a.msg=Hc[c],c}function yc(a){for(var c=a.length;0<=--c;)a[c]=0}function zc(a){var c=a.state,d=c.pending;d>a.avail_out&&(d=a.avail_out);0!==d&&(Fa.arraySet(a.output,c.pending_buf,c.pending_out,d,a.next_out),a.next_out+=d,c.pending_out+=d,a.total_out+=d,a.avail_out-=
d,c.pending-=d,0===c.pending&&(c.pending_out=0))}function Mb(a,c){Wf(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,c);a.block_start=a.strstart;zc(a.strm)}function gb(a,c){a.pending_buf[a.pending++]=c}function ed(a,c){a.pending_buf[a.pending++]=c>>>8&255;a.pending_buf[a.pending++]=255&c}function Le(a,c){var d,b,k=a.max_chain_length,n=a.strstart,g=a.prev_length,e=a.nice_match,h=a.strstart>a.w_size-262?a.strstart-(a.w_size-262):0,l=a.window,f=a.w_mask,m=a.prev,q=a.strstart+258,r=l[n+g-
1],t=l[n+g];a.prev_length>=a.good_match&&(k>>=2);e>a.lookahead&&(e=a.lookahead);do if(l[(d=c)+g]===t&&l[d+g-1]===r&&l[d]===l[n]&&l[++d]===l[n+1]){n+=2;for(d++;l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&n<q;);if(b=258-(q-n),n=q-258,b>g){if(a.match_start=c,g=b,b>=e)break;r=l[n+g-1];t=l[n+g]}}while((c=m[c&f])>h&&0!=--k);return g<=a.lookahead?g:a.lookahead}function Ic(a){var c,d,b=a.w_size;do{if(d=a.window_size-
a.lookahead-a.strstart,a.strstart>=b+(b-262)){Fa.arraySet(a.window,a.window,b,b,0);a.match_start-=b;a.strstart-=b;a.block_start-=b;var k=c=a.hash_size;do{var n=a.head[--k];a.head[k]=n>=b?n-b:0}while(--c);k=c=b;do n=a.prev[--k],a.prev[k]=n>=b?n-b:0;while(--c);d+=b}if(0===a.strm.avail_in)break;k=a.strm;n=a.window;var g=a.strstart+a.lookahead,e=k.avail_in;if(c=(e>d&&(e=d),0===e)?0:(k.avail_in-=e,Fa.arraySet(n,k.input,k.next_in,e,g),1===k.state.wrap?k.adler=Rc(k.adler,n,e,g):2===k.state.wrap&&(k.adler=
Hb(k.adler,n,e,g)),k.next_in+=e,k.total_in+=e,e),a.lookahead+=c,3<=a.lookahead+a.insert)for(d=a.strstart-a.insert,a.ins_h=a.window[d],a.ins_h=(a.ins_h<<a.hash_shift^a.window[d+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[d+3-1])&a.hash_mask,a.prev[d&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=d,d++,a.insert--,!(3>a.lookahead+a.insert)););}while(262>a.lookahead&&0!==a.strm.avail_in)}function $d(a,c){for(var d,b;;){if(262>a.lookahead){if(Ic(a),262>a.lookahead&&0===c)return 1;if(0===
a.lookahead)break}if(d=0,3<=a.lookahead&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==d&&a.strstart-d<=a.w_size-262&&(a.match_length=Le(a,d)),3<=a.match_length)if(b=Ac(a,a.strstart-a.match_start,a.match_length-3),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&3<=a.lookahead){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,d=a.prev[a.strstart&
a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!=--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else b=Ac(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(b&&(Mb(a,!1),0===a.strm.avail_out))return 1}return(a.insert=2>a.strstart?a.strstart:2,4===c)?(Mb(a,!0),0===a.strm.avail_out)?3:4:a.last_lit&&(Mb(a,!1),0===a.strm.avail_out)?1:2}function Sc(a,c){for(var d,
b,k;;){if(262>a.lookahead){if(Ic(a),262>a.lookahead&&0===c)return 1;if(0===a.lookahead)break}if(d=0,3<=a.lookahead&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=2,0!==d&&a.prev_length<a.max_lazy_match&&a.strstart-d<=a.w_size-262&&(a.match_length=Le(a,d),5>=a.match_length&&(1===a.strategy||3===a.match_length&&4096<a.strstart-a.match_start)&&
(a.match_length=2)),3<=a.prev_length&&a.match_length<=a.prev_length){k=a.strstart+a.lookahead-3;b=Ac(a,a.strstart-1-a.prev_match,a.prev_length-3);a.lookahead-=a.prev_length-1;a.prev_length-=2;do++a.strstart<=k&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!=--a.prev_length);if(a.match_available=0,a.match_length=2,a.strstart++,b&&(Mb(a,!1),0===a.strm.avail_out))return 1}else if(a.match_available){if(Ac(a,
0,a.window[a.strstart-1])&&Mb(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return 1}else a.match_available=1,a.strstart++,a.lookahead--}return(a.match_available&&(Ac(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=2>a.strstart?a.strstart:2,4===c)?(Mb(a,!0),0===a.strm.avail_out)?3:4:a.last_lit&&(Mb(a,!1),0===a.strm.avail_out)?1:2}function nc(a,c,d,b,k){this.good_length=a;this.max_lazy=c;this.nice_length=d;this.max_chain=b;this.func=k}function Xf(){this.strm=null;this.status=0;this.pending_buf=
null;this.wrap=this.pending=this.pending_out=this.pending_buf_size=0;this.gzhead=null;this.gzindex=0;this.method=8;this.last_flush=-1;this.w_mask=this.w_bits=this.w_size=0;this.window=null;this.window_size=0;this.head=this.prev=null;this.nice_match=this.good_match=this.strategy=this.level=this.max_lazy_match=this.max_chain_length=this.prev_length=this.lookahead=this.match_start=this.strstart=this.match_available=this.prev_match=this.match_length=this.block_start=this.hash_shift=this.hash_mask=this.hash_bits=
this.hash_size=this.ins_h=0;this.dyn_ltree=new Fa.Buf16(1146);this.dyn_dtree=new Fa.Buf16(122);this.bl_tree=new Fa.Buf16(78);yc(this.dyn_ltree);yc(this.dyn_dtree);yc(this.bl_tree);this.bl_desc=this.d_desc=this.l_desc=null;this.bl_count=new Fa.Buf16(16);this.heap=new Fa.Buf16(573);yc(this.heap);this.heap_max=this.heap_len=0;this.depth=new Fa.Buf16(573);yc(this.depth);this.bi_valid=this.bi_buf=this.insert=this.matches=this.static_len=this.opt_len=this.d_buf=this.last_lit=this.lit_bufsize=this.l_buf=
0}function Me(a,c){if(65534>c&&(a.subarray&&Ne||!a.subarray&&Oe))return String.fromCharCode.apply(null,Fa.shrinkBuf(a,c));for(var d="",b=0;b<c;b++)d+=String.fromCharCode(a[b]);return d}function Jc(a){if(!(this instanceof Jc))return new Jc(a);this.options=Fa.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},a||{});var c,d,b;a=this.options;a.raw&&0<a.windowBits?a.windowBits=-a.windowBits:a.gzip&&0<a.windowBits&&16>a.windowBits&&(a.windowBits+=16);this.err=0;this.msg=
"";this.ended=!1;this.chunks=[];this.strm=new ae;this.strm.avail_out=0;var k=this.strm;var n=a.level;var g=a.method,e=a.windowBits,h=a.memLevel,l=a.strategy;if(k){var f,m,q,r=1;if(-1===n&&(n=6),0>e?(r=0,e=-e):15<e&&(r=2,e-=16),1>h||9<h||8!==g||8>e||15<e||0>n||9<n||0>l||4<l)n=xc(k,-2);else{8===e&&(e=9);var t=new Xf;n=(k.state=t,t.strm=k,t.wrap=r,t.gzhead=null,t.w_bits=e,t.w_size=1<<t.w_bits,t.w_mask=t.w_size-1,t.hash_bits=h+7,t.hash_size=1<<t.hash_bits,t.hash_mask=t.hash_size-1,t.hash_shift=~~((t.hash_bits+
3-1)/3),t.window=new Fa.Buf8(2*t.w_size),t.head=new Fa.Buf16(t.hash_size),t.prev=new Fa.Buf16(t.w_size),t.lit_bufsize=1<<h+6,t.pending_buf_size=4*t.lit_bufsize,t.pending_buf=new Fa.Buf8(t.pending_buf_size),t.d_buf=+t.lit_bufsize,t.l_buf=3*t.lit_bufsize,t.level=n,t.strategy=l,t.method=g,0===(q=k&&k.state?(k.total_in=k.total_out=0,k.data_type=2,(f=k.state).pending=0,f.pending_out=0,0>f.wrap&&(f.wrap=-f.wrap),f.status=f.wrap?42:113,k.adler=+(2!==f.wrap),f.last_flush=0,Yf(f),0):xc(k,-2))&&((m=k.state).window_size=
2*m.w_size,yc(m.head),m.max_lazy_match=fd[m.level].max_lazy,m.good_match=fd[m.level].good_length,m.nice_match=fd[m.level].nice_length,m.max_chain_length=fd[m.level].max_chain,m.strstart=0,m.block_start=0,m.lookahead=0,m.insert=0,m.match_length=m.prev_length=2,m.match_available=0,m.ins_h=0),q)}}else n=-2;if(0!==n)throw Error(Hc[n]);if(a.header&&(c=this.strm,d=a.header,c&&c.state&&2===c.state.wrap&&(c.state.gzhead=d)),a.dictionary){if(b="string"==typeof a.dictionary?be(a.dictionary):"[object ArrayBuffer]"===
Pe.call(a.dictionary)?new Uint8Array(a.dictionary):a.dictionary,0!==(n=Zf(this.strm,b)))throw Error(Hc[n]);this._dict_set=!0}}function ce(a,c){c=new Jc(c);if(c.push(a,!0),c.err)throw c.msg||Hc[c.err];return c.result}function Qe(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function $f(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.total=this.check=this.dmax=this.flags=0;this.head=null;this.wnext=this.whave=this.wsize=this.wbits=0;this.window=null;this.extra=this.offset=
this.length=this.bits=this.hold=0;this.distcode=this.lencode=null;this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0;this.next=null;this.lens=new Fa.Buf16(320);this.work=new Fa.Buf16(288);this.distdyn=this.lendyn=null;this.was=this.back=this.sane=0}function Re(a,c,d,b){var k;a=a.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Fa.Buf8(a.wsize)),b>=a.wsize?(Fa.arraySet(a.window,c,d-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((k=a.wsize-a.wnext)>
b&&(k=b),Fa.arraySet(a.window,c,d-b,k,a.wnext),(b-=k)?(Fa.arraySet(a.window,c,d-b,b,0),a.wnext=b,a.whave=a.wsize):(a.wnext+=k,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=k))),0}function Kc(a){if(!(this instanceof Kc))return new Kc(a);this.options=Fa.assign({chunkSize:16384,windowBits:0,to:""},a||{});var c,d,b,k,n,g,e,h,l,f=this.options;f.raw&&0<=f.windowBits&&16>f.windowBits&&(f.windowBits=-f.windowBits,0===f.windowBits&&(f.windowBits=-15));0<=f.windowBits&&16>f.windowBits&&(!a||!a.windowBits)&&
(f.windowBits+=32);15<f.windowBits&&48>f.windowBits&&0==(15&f.windowBits)&&(f.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new ae;this.strm.avail_out=0;a=(c=this.strm,d=f.windowBits,c?(c.state=k=new $f,k.window=null,0!==(n=d,b=c&&c.state?(e=c.state,0>n?(g=0,n=-n):(g=(n>>4)+1,48>n&&(n&=15)),n&&(8>n||15<n))?-2:(null!==e.window&&e.wbits!==n&&(e.window=null),e.wrap=g,e.wbits=n,c&&c.state?((h=c.state).wsize=0,h.whave=0,h.wnext=0,c&&c.state?(l=c.state,c.total_in=c.total_out=
l.total=0,c.msg="",l.wrap&&(c.adler=1&l.wrap),l.mode=1,l.last=0,l.havedict=0,l.dmax=32768,l.head=null,l.hold=0,l.bits=0,l.lencode=l.lendyn=new Fa.Buf32(852),l.distcode=l.distdyn=new Fa.Buf32(592),l.sane=1,l.back=-1,0):-2):-2):-2)&&(c.state=null),b):-2);if(a!==Ab.Z_OK||(this.header=new Se,ag(this.strm,this.header),f.dictionary&&("string"==typeof f.dictionary?f.dictionary=be(f.dictionary):"[object ArrayBuffer]"===Te.call(f.dictionary)&&(f.dictionary=new Uint8Array(f.dictionary)),f.raw)&&(a=Ue(this.strm,
f.dictionary))!==Ab.Z_OK))throw Error(Hc[a]);}function de(a,c){c=new Kc(c);if(c.push(a,!0),c.err)throw c.msg||Hc[c.err];return c.result}function ee(a){this.version=a.readU32BE();this.width=a.readU32BE();this.height=a.readU32BE();this.layersNb=a.readU32BE()}function ud(a){let c=[,,,,];for(let d=0;d<c.length;d++)c[d]=String.fromCharCode(a.readByte());if(this.chunkType=c.join(""),this.chunkSize=a.readU32BE(),a.eof)throw"Truncated chunk";}function Ve(a){return{major:a>>16&65535,minor:65535&a}}function fe(a,
c){let d=new ab(new Uint8Array(ud.HEADER_LENGTH+c));return d.writeString(a),d.writeU32BE(c),d}function Tc(){}function vd(a){function c(n,g){null===g?k.emitEvent("loadingProgress",[1,"Loading your "+n.friendly+"..."]):k.emitEvent("loadingProgress",[g,"Loading your "+n.friendly+" ("+Math.round(100*g)+"%)..."])}var d=[],b={},k=this;a.loadChibiFileUrl&&0<(""+a.loadChibiFileUrl).length?d.push({url:a.loadChibiFileUrl,friendly:"drawing layers",name:"layers",required:!0}):a.loadImageUrl&&0<(""+a.loadImageUrl).length&&
d.push({url:a.loadImageUrl,friendly:"drawing",name:"flat",required:!0});a.loadSwatchesUrl&&d.push({url:a.loadSwatchesUrl,friendly:"color swatches",name:"swatches",required:!1,noProgress:!0});this.load=function(){function n(){g.required?k.emitEvent("loadingFailure",["Failed to load your "+g.friendly+", please try again later."]):k.load()}if(0==d.length)return void k.emitEvent("loadingComplete",[b]);var g=d.shift(),e=new XMLHttpRequest;e.addEventListener("progress",function(h){c(g,h.lengthComputable&&
!g.noProgress?h.loaded/h.total:null)},!1);e.addEventListener("load",function(h){if(200==this.status){let l=this.response;k.emitEvent("loadingProgress",[1,"Starting ChickenPaint..."]);setTimeout(function(){(function(f,m){switch(f.name){case "flat":return new Promise(function(q,r){let t=new Blob([m],{type:"image/png"}),u=window.URL.createObjectURL(t);if(u){let w=new Image;w.onload=function(){let C=new Yb(this.width,this.height),D=new sa(0,0,"Layer 1");D.image=z.createFromImage(w);C.addLayerObject(C.getLayersRoot(),
D);w=null;window.URL.revokeObjectURL(u);q(C)};w.src=u}else r(null)});case "swatches":return(f=(new Tc).read(m))?Promise.resolve(f):Promise.reject(null);case "layers":return function(q,r){function t(M){let X;var fa=L;if(null!==fa&&0!==fa.length)if(null===M||0===M.length)M=fa;else{var pa=new Uint8Array(fa.length+M.length);M=(pa.set(fa,0),pa.set(M,fa.length),pa)}for(L=M;L;){if(F<L.length)L=L.subarray(F),F=0;else{F-=L.length;L=null;break}switch(w){case 0:if(L.length<ud.HEADER_LENGTH)break;if(N=new ud(X=
new ab(L)),L=L.subarray(X.pos),J)if("ZEND"==N.chunkType)w=45;else{"LAYR"==N.chunkType?(w=2,A=new bg(N,J.width,J.height)):"GRUP"==N.chunkType?(w=3,A=new cg(N,J.width,J.height)):(console.log("Unknown chunk type '"+N.chunkType+"', attempting to skip..."),F=N.chunkSize);continue}else if("HEAD"==N.chunkType){w=1;continue}else w=5;break;case 1:if(L.length<N.chunkSize)break;if(0<Ve((J=new ee(X=new ab(L))).version).major){w=5;break}D=(C=new Yb(J.width,J.height)).getLayersRoot();F=N.chunkSize;w=0;continue;
case 2:if(L=A.decode(L),A.done){C.addLayerObject(D,A.layer);w=0;continue}break;case 3:if(L=A.decode(L),A.done){C.addLayerGroupObject(D,A.layer,A.childLayers);w=0;continue}}break}}r=r||{};let u=new (wa(ge).Inflate)({}),w=0,C=null,D=null,A,F=0,J=null,N=null,L=null;return(new Promise(function(M){if(q instanceof ArrayBuffer)M(q);else{let X=new FileReader;X.onload=function(){M(this.result)};X.readAsArrayBuffer(q)}})).then(M=>new Promise(function(X,fa){let pa=new Uint8Array(M);if(!function(H){for(let ja=
0;8>ja;ja++)if(H[ja]!="CHIBIOEK".charCodeAt(ja))return!1;return!0}(pa))return void fa("This doesn't appear to be a ChibiPaint layers file, is it damaged?");pa=pa.subarray(8);u.onData=t;u.onEnd=function(H){0===H&&45==w?(!1!==r.upgradeMultiplyLayers&&10>J.version&&C.upgradeMultiplyLayers(r.upgradeMultiplyLayers),C.selectTopmostVisibleLayer(),X(C)):fa("Fatal error decoding ChibiFile: "+H)};u.push(pa,!0)}))}(m);default:return Promise.reject("Unexpected resource type '"+f.name+"'")}})(g,l).then(function(f){b[g.name]=
f;k.load()},function(){k.emitEvent("loadingFailure",["Failed to read your "+g.friendly])})},0)}else n()},!1);e.addEventListener("error",n);c(g,g.noProgress?null:0);e.open("GET",g.url,!0);e.responseType="arraybuffer";e.send()}}function he(a){(a=a.split(/[-_]/,1)[0].toLowerCase())in ie?(wd=ie[a],je=a):(wd=xd,je="en")}function Q(a){return a in wd?wd[a]:a}function gd(a){function c(e){null===e?n.emitEvent("savingProgress",[1,Q("Saving drawing...")]):n.emitEvent("savingProgress",[e,Q("Saving drawing...")+
" ("+Math.round(100*e)+"%)"])}function d(e){n.emitEvent("savingFailure",[e])}async function b(e){try{let h=await k(e),l=`${(h/1024/1024).toFixed(3)}MB`,f=`${a.post_max_size}MB`;if(console.log("Total size of FormData:",l),console.log("post_max_size:",f),a&&a.post_max_size&&h&&!isNaN(h)&&h>1048576*a.post_max_size)return void d(`${Q("The file size exceeds the server limit.")}
${Q("Limit size")}:${f}
${Q("Current size")}:${l}`);console.log(Q("The total size of FormData is within the acceptable range."))}catch(h){console.error("Error details:",h);d("An error occurred in the getFormDataSize function.");return}c(.5);fetch(a.url,{method:"POST",mode:"same-origin",headers:{"X-Requested-With":"chickenpaint"},body:e}).then(h=>{if(!h.ok){let l;switch(h.status){case 400:l="Bad Request";break;case 401:l="Unauthorized";break;case 403:l="Forbidden";break;case 404:l="Not Found";break;case 500:l="Internal Server Error";
break;case 502:l="Bad Gateway";break;case 503:l="Service Unavailable";break;default:l="Unknown Error"}throw Error(`${Q("Network response was not OK")} ( ${Q("HTTP status code")} ${h.status} : ${l} )`);}return h.text()}).then(h=>{/^CHIBIOK/.test(h)?(c(1),n.emitEvent("savingComplete")):d(h)}).catch(h=>{d(h.message)})}async function k(e){if(a.post_max_size)return e=Array.from(e.entries()).map(([h,l])=>"string"==typeof l?new Blob([`${h}=${l}`]):l),(new Blob(e)).size}var n=this,g=!1;a.rotation=a.rotation||
0;this.save=function(){var e,h,l,f,m;(e=new Blob([function(q){for(var r=new Uint8Array(q.length),t=0;t<q.length;t++)r[t]=q.charCodeAt(t);return r}(a.artwork.getFlatPNG(a.rotation))],{type:"image/png"}),a.artwork.isSimpleDrawing())?l=Promise.resolve(null):(f=a.artwork,m=m||{},l=Promise.resolve().then(()=>{var q,r;let t,u=new (wa(ge).Deflate)({level:7}),w=[],C=new Uint8Array(8),D=f.getLayersRoot().getLinearizedLayerList(!1),A=m.forceOldVersion?0:function(J){for(let N of J.getLayersRoot().getLinearizedLayerList(!1))if(N instanceof
Ua||N.mask||N.clip||N.blendMode>G.LM_LAST_CHIBIPAINT||N.blendMode===G.LM_MULTIPLY)return 10;return 0}(f),F=0===(r=Ve(A)).major&&0===r.minor?"ChibiPaint v0.0":"ChickenPaint v"+r.major+"."+r.minor;r=Promise.resolve();u.onData=function(J){w.push(J)};for(let J=0;8>J;J++)C[J]="CHIBIOEK".charCodeAt(J);for(let J of(w.push(C),u.push((q=D.length,(t=fe("HEAD",ee.FIXED_HEADER_LENGTH)).writeU32BE(A),t.writeU32BE(f.width),t.writeU32BE(f.height),t.writeU32BE(q),t.getAsDataArray()),!1),D))r=r.then(()=>new Promise(function(N){var L=
u.push;var M=J;var X,fa=M instanceof sa,pa=4*(fa?5:6),H=M.name.length;let ja=fe(fa?"LAYR":"GRUP",pa+H+((fa?M.image.data.length:0)+(M.mask?M.mask.data.length:0)));var U=0;let Za;M.visible&&(U|=1);fa&&M.clip&&(U|=2);M.mask&&(U|=4);M.maskLinked&&(U|=8);M.maskVisible&&(U|=16);M.lockAlpha&&(U|=64);!fa&&M.expanded&&(U|=32);M.blendMode===G.LM_MULTIPLY2?(Za=G.LM_MULTIPLY,U|=128):Za=M.blendMode;ja.writeU32BE(pa+H);ja.writeU32BE(Za);ja.writeU32BE(M.alpha);ja.writeU32BE(U);ja.writeU32BE(M.name.length);fa||ja.writeU32BE(M.layers.length);
ja.writeString(M.name);if(fa){fa=ja.pos;pa=ja.data;H=M.image.data;for(U=0;U<H.length;U+=z.BYTES_PER_PIXEL)pa[fa++]=H[U+z.ALPHA_BYTE_OFFSET],pa[fa++]=H[U+z.RED_BYTE_OFFSET],pa[fa++]=H[U+z.GREEN_BYTE_OFFSET],pa[fa++]=H[U+z.BLUE_BYTE_OFFSET];ja.pos=fa}M=(M.mask&&(X=M.mask,ja.data.set(X.data,ja.pos),ja.pos+=X.data.length),ja.getAsDataArray());L.call(u,M,!1);setTimeout(N,10)}));return r.then(()=>new Promise((J,N)=>{u.onEnd=function(L){if(0===L)if("undefined"!=typeof Blob)J({bytes:new Blob(w,{type:"application/octet-stream"}),
version:F});else{L=new Uint8Array(w.map(X=>X.byteLength).reduce((X,fa)=>X+fa,0));let M=0;for(let X of w)L.set(X,M),M+=X.byteLength;J({bytes:L,version:F})}else N(L)};u.push(fe("ZEND",0).getAsDataArray(),!0)}))}));l.then(function(q){if(g)return void n.emitEvent("savingFailure");if(h=a.swatches?new Blob([(new Tc).write(a.swatches)],{type:"application/octet-stream"}):null,a.url){var r=new FormData;r.append("beginMarker","This marker ensures the upload wasn't truncated");r.append("painter","ChickenPaint v2.0");
r.append("picture",e);e=null;q?(r.append("chibifileFormat",q.version),r.append("chibifile",q.bytes),r.append("rotation",""+a.rotation)):r.append("rotation","0");h&&(r.append("swatches",h),h=null);r.append("endMarker","This marker ensures the upload wasn't truncated");b(r)}else r="oekaki_"+(new Date).toISOString().split(".")[0].replace(/[^0-9]/g,"_"),wa(hd).saveAs(e,r+".png"),q&&wa(hd).saveAs(q.bytes,r+".chi"),h&&wa(hd).saveAs(h,r+".aco")}).catch(function(q){n.emitEvent("savingFailure")})};this.cancel=
function(){g=!0}}function dg(a,c,d){function b(){var L=l.width/2,M=l.height/2;if(f.fillStyle="white",f.fillRect(0,0,l.width,l.height),A==D.length){var X=t.width,fa=t.height,pa=Math.round(L-X/2),H=Math.round(M-fa/2);f.drawImage(t,pa,H);var ja=F;n||((n=document.createElement("canvas")).width=X,n.height=fa,e=n.getContext("2d"));e.globalCompositeOperation="copy";e.drawImage(m,0,0);g||((g=document.createElement("canvas")).width=X,g.height=fa,h=g.getContext("2d"));h.globalCompositeOperation="copy";h.drawImage(C,
0,0);h.globalCompositeOperation="source-in";h.drawImage(C,0,Math.round(170*ja));e.globalCompositeOperation="source-over";e.drawImage(g,0,0);e.drawImage(q,0,0);e.globalCompositeOperation="screen";e.drawImage(w,0,0);e.globalCompositeOperation="multiply";e.drawImage(u,0,0);f.globalAlpha=.88;f.drawImage(n,pa,H);f.globalAlpha=1;f.drawImage(r,pa,H);M=Math.round(M+fa/2+2)}if(""!=J)for(f.fillStyle="black",ja=J.split("\n"),X=0;X<ja.length;X++)fa=ja[X],pa=f.measureText(fa).width,M+=28,f.fillText(fa,L-pa/2,
M)}function k(){l.width=l.clientWidth;l.height=l.clientHeight;f.font="14pt sans-serif";b()}var n,g,e,h,l=document.createElement("canvas"),f=l.getContext("2d"),m=new Image,q=new Image,r=new Image,t=new Image,u=new Image,w=new Image,C=new Image,D=[m,q,r,t,u,w,C],A=0,F=0,J="";d+="splash/";for(var N=0;N<D.length;N++)D[N].onload=function(){++A==D.length&&b()};m.src=d+"cup.png";w.src=d+"highlights.png";q.src=d+"lid.png";r.src=d+"lines.png";u.src=d+"shading.png";C.src=d+"smoothie.png";t.src=d+"text.png";
c.on("loadingProgress",function(L,M){F=L;J=M;b()});c.on("loadingFailure",function(L){F=0;J=L;b()});c.on("loadingComplete",function(){window.removeEventListener("resize",k);a.removeChild(l)});window.addEventListener("resize",k);l.className="chickenpaint-splash-screen";a.appendChild(l);k()}function We(a){for(var c={DELETE:46,BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27," ":32,ARROWLEFT:37,ARROWUP:38,ARROWRIGHT:39,ARROWDOWN:40,SHIFT:16,"[":219,"]":221,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,0:48,"-":189,
"=":187,"+":187,";":187,META:91,LEFTMETA:91,RIGHTMETA:91,ALT:18,ALTGRAPH:18,OPTION:18,CONTROL:17},d=65;90>=d;d++)c[String.fromCharCode(d)]=d;if((a=a.toUpperCase())in c)return c[a]}function Xe(){let a,c,d,b,k,n,g,e;this.x0=this.y0=this.x1=this.y1=this.x2=this.y2=this.x3=this.y3=0;let h=l=>{let f=3*l,m=f*l;l*=l*l;let q=2*m,r=6*l,t=this.x0-2*this.x1+this.x2,u=this.y0-2*this.y1+this.y2,w=3*(this.x1-this.x2)-this.x0+this.x3,C=3*(this.y1-this.y2)-this.y0+this.y3;a=this.x0;k=this.y0;c=(this.x1-this.x0)*
f+t*m+w*l;n=(this.y1-this.y0)*f+u*m+C*l;d=t*q+w*r;g=u*q+C*r;b=w*r;e=C*r};this.compute=(l,f,m)=>{h(1/m);l[0]=a;f[0]=k;for(let q=1;q<m;q++)a+=c,k+=n,c+=d,n+=g,d+=b,g+=e,l[q]=a,f[q]=k}}function Ye(a,c,d,b){var k,n=0;return"boolean"!=typeof c&&(b=d,d=c,c=void 0),function(){function g(){n=+new Date;d.apply(e,l)}var e=this,h=new Date-n,l=arguments;b&&!k&&g();k&&clearTimeout(k);void 0===b&&h>a?g():!0!==c&&(k=setTimeout(b?function(){k=void 0}:g,void 0===b?a-h:a))}}function Lc(a){this.points=a||[]}function qb(a,
c){this.x=a;this.y=c}function Ze(a){for(var c=document.createElement("canvas"),d=c.getContext("2d"),b=d.createImageData(64,64),k=b.data,n=0,g=0;64>g;g++)for(var e=0;64>e;e++)0!=(8&e)!=(0!=(8&g))?(k[n++]=255,k[n++]=255,k[n++]=255):(k[n++]=204,k[n++]=204,k[n++]=204),k[n++]=255;return c.width=64,c.height=64,d.putImageData(b,0,0),a.createPattern(c,"repeat")}function yd(a,c){c+="Style";a.globalCompositeOperation="exclusion";"exclusion"==a.globalCompositeOperation?a[c]="white":(a.globalCompositeOperation=
"difference",a[c]="#888","difference"!=a.globalCompositeOperation&&(a[c]="black"))}function id(a){function c(){var u=a?d.clientHeight:d.clientWidth;m=h/(g-n)*u;u=(e-n)/(g-n)*(u-m);k.style[a?"height":"width"]=m+"px";b.style[a?"height":"width"]=m+"px";b.style[a?"top":"left"]=u+"px"}let d=document.createElement("div"),b=document.createElement("div"),k=document.createElement("div"),n=0,g=1,e=0,h=1,l=10,f=!1,m=1,q=!1,r,t=this;this.setValues=function(u,w,C,D){e=u;h=w;n=C;g=D;c()};this.setBlockIncrement=
function(u){l=u};this.setUnitIncrement=function(u){};this.getElement=function(){return d};this.getValueIsAdjusting=function(){return f};d.className="chickenpaint-scrollbar "+(a?"chickenpaint-scrollbar-vertical":"chickenpaint-scrollbar-horizontal");b.className="chickenpaint-scrollbar-handle";b.setAttribute("touch-action","none");k.className="chickenpaint-scrollbar-handle-inner";b.appendChild(k);d.appendChild(b);b.addEventListener("pointerdown",function(u){u.stopPropagation();r=a?u.pageY-d.offsetTop-
window.scrollY:u.pageX-d.offsetLeft-window.scrollX;b.setPointerCapture(u.pointerId);b.classList.add("dragging");q=!0});b.addEventListener("pointermove",function(u){q&&(f=!0,u=a?u.pageY-d.offsetTop-window.scrollY:u.pageX-d.offsetLeft-window.scrollX,e+=(u-r)*(g-n)/((a?d.clientHeight:d.clientWidth)-m),e=Math.min(Math.max(e,n),g),r=u,t.emitEvent("valueChanged",[e]),c(),f=!1)});b.addEventListener("pointerup",function(u){if(u.stopPropagation(),q){try{b.releasePointerCapture(u.pointerId)}catch(w){}b.classList.remove("dragging");
q=!1}});b.addEventListener("click",function(u){u.stopPropagation()});d.addEventListener("click",function(u){this==d&&((a?u.pageY-d.offsetTop-window.scrollY:u.pageX-d.offsetLeft-window.scrollX)<parseInt(b.style[a?"top":"left"],10)?e-=l:e+=l,t.emitEvent("valueChanged",[e]),c())})}function Nb(){this.modes=[]}function zd(a){function c(){}function d(){}function b(){this.shouldPaintBrushPreview=!1;this.oldPreviewRect=null}function k(){b.call(this);this.smoothMouse={x:0,y:0}}function n(){var y,K;this.mouseDown=
function(Y,ia,ua){if(!this.capture&&0==ia&&!Y.altKey&&!wa(Na).isPressed("space")&&C())return this.capture=!0,y=K={x:eb+.5,y:Wa+.5},this.eraseBrushPreview(),!0};this.mouseDrag=function(Y){if(this.capture){var ia=new oa(Math.min(y.x,K.x)-1-1,Math.min(y.y,K.y)-1-1,Math.max(y.x,K.x)+1+1+1,Math.max(y.y,K.y)+1+1+1);if(K={x:eb+.5,y:Wa+.5},Y.shiftKey){var ua=Math.PI/4;Y=Math.round(Math.atan2(K.y-y.y,K.x-y.x)/ua);switch(Y){case 0:case 4:K.y=y.y;break;case 2:case 6:K.x=y.x;break;default:Y*=ua,ua=Math.sqrt((K.y-
y.y)*(K.y-y.y)+(K.x-y.x)*(K.x-y.x)),K.x=y.x+ua*Math.cos(Y),K.y=y.y+ua*Math.sin(Y)}}return ia.union(new oa(Math.min(y.x,K.x)-1-1,Math.min(y.y,K.y)-1-1,Math.max(y.x,K.x)+1+1+1,Math.max(y.y,K.y)+1+1+1)),db(ia),!0}this.mouseMove.call(this,Y)};this.mouseUp=function(Y,ia,ua){if(this.capture&&0==ia)return Y=F(y),ia=F(K),this.capture=!1,this.drawLine(Y,ia),db(new oa(Math.min(y.x,K.x)-1-1,Math.min(y.y,K.y)-1-1,Math.max(y.x,K.x)+1+1+1,Math.max(y.y,K.y)+1+1+1)),!0};this.paint=function(){this.capture?(da.lineWidth=
1,da.beginPath(),da.moveTo(y.x,y.y),da.lineTo(K.x,K.y),da.stroke()):b.prototype.paint.call(this)};b.call(this)}function g(){let y=0,K,Y,ia,ua;this.mouseDown=function(ea,za,Va){if(!this.capture&&0==za&&!ea.altKey&&!wa(Na).isPressed("space")&&C())return ea=F({x:eb,y:Wa}),y=0,K=Y=ia=ua=ea,this.capture=!0,this.eraseBrushPreview(),!0};this.mouseDrag=function(ea){if(this.capture&&0===y)return ia=ua=F({x:eb,y:Wa}),Z.repaintAll(),!0;this.mouseMove.call(this,ea)};this.mouseUp=function(ea,za,Va){if(this.capture&&
0==za){switch(y){case 0:y=1;break;case 1:y=2;break;case 2:this.capture=!1;za=K;Va=Y;let xb=ia,Vb=ua;ea=new Xe;ea.x0=za.x;ea.y0=za.y;ea.x1=Va.x;ea.y1=Va.y;ea.x2=xb.x;ea.y2=xb.y;ea.x3=Vb.x;ea.y3=Vb.y;za=Array(500);Va=Array(500);ea.compute(za,Va,500);Ja.beginStroke(za[0],Va[0],1);for(ea=1;500>ea;ea++)Ja.continueStroke(za[ea],Va[ea],1);Ja.endStroke();Z.repaintAll()}return!0}};this.mouseMove=function(ea,za){if(this.capture)return ea=F({x:eb,y:Wa}),1==y?Y=ea:2==y&&(ia=ea),Z.repaintAll(),!0;b.prototype.mouseMove.call(this,
ea,za)};this.paint=function(){if(this.capture){var ea=new Xe;let za=L(K),Va=L(Y),xb=L(ia),Vb=L(ua);ea.x0=za.x;ea.y0=za.y;ea.x1=Va.x;ea.y1=Va.y;ea.x2=xb.x;ea.y2=xb.y;ea.x3=Vb.x;ea.y3=Vb.y;let rc=Array(100),bc=Array(100);ea.compute(rc,bc,100);da.beginPath();da.moveTo(rc[0],bc[0]);for(ea=1;100>ea;ea++)da.lineTo(rc[ea],bc[ea]);da.moveTo(~~za.x,~~za.y);da.lineTo(~~Va.x,~~Va.y);da.moveTo(~~xb.x,~~xb.y);da.lineTo(~~Vb.x,~~Vb.y);da.stroke()}else b.prototype.paint.call(this)};b.call(this)}function e(){var y;
this.mouseDown=function(K,Y,ia){return!!this.capture||(wa(Na).isPressed("space")||(0!=Y||this.transient&&!K.altKey)&&2!=Y?void(this.transient&&E.pop()):(y=Y,this.capture=!0,u("crosshair"),this.mouseDrag(K),!0))};this.mouseDrag=function(K){if(this.capture)return K=F({x:eb,y:Wa}),Ja.isPointWithin(K.x,K.y)&&a.setCurColor(new fb(Ja.colorPicker(K.x,K.y))),!0};this.mouseUp=function(K,Y,ia){if(this.capture&&Y==y)return y=-1,this.capture=!1,u("default"),this.transient&&E.pop(),!0};this.enter=function(){c.prototype.enter.call(this);
y=-1}}function h(){var y,K,Y,ia;this.keyDown=function(ua){if(!ua.ctrlKey&&" "===ua.key)return this.capture||u("grab"),!0};this.keyUp=function(ua){if(this.transient&&1!=ia&&" "===ua.key)return u("default"),E.pop(),!0};this.mouseDown=function(ua,ea,za){return!!this.capture||(1==ea||wa(Na).isPressed("space")&&!ua.ctrlKey&&0==ea||!this.transient&&0==ea?(this.capture=!0,ia=ea,y=ua.pageX,K=ua.pageY,Y=Z.getOffset(),u("grabbing"),!0):void(this.transient&&E.pop()))};this.mouseDrag=function(ua){if(this.capture)return Z.setOffset(Y.x+
ua.pageX-y,Y.y+ua.pageY-K),!0};this.mouseUp=function(ua,ea,za){if(this.capture&&ea==ia)return ia=-1,this.capture=!1,E.peek()!==this||(this.transient&&!wa(Na).isPressed("space")?(u("default"),E.pop()):u("grab"),!0)};this.enter=function(){u("grab")}}function l(){}function f(){var y,K=new oa(0,0,0,0),Y=-1;let ia=!1;this.mouseDown=function(ua,ea,za){za=document.getElementById("chickenpaint-s-maintainAspectCheckbox");if(za&&za instanceof HTMLInputElement&&(ia=za.checked),!this.capture&&0==ea&&!ua.altKey&&
!wa(Na).isPressed("space"))return ua=J({x:eb,y:Wa}),Y=ea,K.makeEmpty(),y=ua,Z.repaintAll(),this.capture=!0,!0};this.mouseDrag=function(ua){if(!this.capture)return!1;let ea=J({x:eb,y:Wa});ua=ua.shiftKey||ia;let za=~~Math.max(Math.abs(ea.x-y.x),Math.abs(ea.y-y.y));return ea.x>=y.x?(K.left=y.x,K.right=(ua?y.x+za:ea.x)+1):(K.left=ua?y.x-za:ea.x,K.right=y.x+1),ea.y>=y.y?(K.top=y.y,K.bottom=(ua?y.y+za:ea.y)+1):(K.top=ua?y.y-za:ea.y,K.bottom=y.y+1),Z.repaintAll(),!0};this.mouseUp=function(ua,ea,za){if(this.capture&&
ea==Y)return Ja.rectangleSelection(K),K.makeEmpty(),Z.repaintAll(),this.capture=!1,Y=-1,!0};this.paint=function(){K.isEmpty()||(da.lineWidth=1,fa(da,K))}}function m(){var y,K,Y=!1;this.mouseDown=function(ia,ua,ea){if(!this.capture&&0==ua&&!wa(Na).isPressed("space")&&w())return y=F({x:eb,y:Wa}),K=ia.altKey,Y=!0,this.capture=!0,!0};this.mouseDrag=Ye(25,function(ia){if(this.capture){ia=F({x:eb,y:Wa});var ua=ia.x-y.x,ea=ia.y-y.y,za=~~ua,Va=~~ea;return(0!=za||0!=Va)&&(Ja.move(za,Va,K&&Y),Y=!1),y.x=ia.x-
(ua-za),y.y=ia.y-(ea-Va),!0}});this.mouseUp=function(ia,ua,ea){if(this.capture&&0==ua)return this.capture=!1,this.transient&&E.pop(),!0}}function q(){function y(na,xa){return{x:(na.x+xa.x)/2,y:(na.y+xa.y)/2}}function K(na){return{x:Math.round(na.x),y:Math.round(na.y)}}function Y(na,xa){for(var Aa=0;Aa<na.points.length;Aa++)if(49>=(xa.x-na.points[Aa].x)*(xa.x-na.points[Aa].x)+(xa.y-na.points[Aa].y)*(xa.y-na.points[Aa].y))return 2*Aa;for(Aa=0;Aa<na.points.length;Aa++){var $a=na.points[Aa],cb=na.points[(Aa+
1)%na.points.length];cb=new qb(cb.x-$a.x,cb.y-$a.y);$a=new qb(xa.x-$a.x,xa.y-$a.y);var ic=cb.getLength(),Mc=cb.getScaled(1/ic);ic=$a.getScaled(1/ic);Mc=Mc.getDotProduct(ic);if(0<=Mc&&1>=Mc&&(cb.scale(Mc),49>=(cb.x-$a.x)*(cb.x-$a.x)+(cb.y-$a.y)*(cb.y-$a.y)))return 2*Aa+1}return na.containsPoint(xa)?-3:-2}function ia(){var na=Va.getTransformed(Qa),xa=Y(na,{x:eb,y:Wa});switch(xa){case 0:case 2:case 4:case 6:xa=~~(xa/2);let Aa=na.points[xa],$a=na.points[(xa+1)%4];ua(qb.subtractPoints(na.points[(xa+3)%
4],Aa).normalize().add(qb.subtractPoints($a,Aa).normalize()));break;case 1:case 3:case 5:case 7:ua(qb.subtractPoints(na.points[(~~(xa/2)+1)%4],na.points[~~(xa/2)]).getPerpendicular());break;case -3:wa(Na).isPressed("r")||wa(Na).isPressed("space")||u("move");break;case -2:wa(Na).isPressed("r")||wa(Na).isPressed("space")||u("default");break;default:u("default")}}function ua(na){na=Math.floor(Math.atan2(-na.y,na.x)/(Math.PI/4)+.5);switch(0>na&&(na+=4),na){default:na="ew-resize";break;case 1:na="nesw-resize";
break;case 2:na="ns-resize";break;case 3:na="nwse-resize"}u(na)}var ea,za,Va,xb,Vb,rc,bc=-1;let jd=!1;this.mouseDown=function(na,xa,Aa){Aa=document.getElementById("chickenpaint-t-maintainAspectCheckbox");if(Aa&&Aa instanceof HTMLInputElement&&(jd=Aa.checked),!this.capture&&0==xa&&!na.altKey&&!wa(Na).isPressed("space"))return bc=Y(Va.getTransformed(Qa),{x:eb,y:Wa}),Vb=F(xb={x:eb,y:Wa}),this.capture=!0,ia(),!0};this.mouseDrag=Ye(40,function(na){if(this.capture){var xa={x:eb,y:Wa};switch(bc){case -3:na=
K(F(xa));var Aa=qb.subtractPoints(na,Vb);xa=Aa.getTruncated();Aa=Aa.subtract(xa);var $a=new lb;$a.translate(xa.x,xa.y);ea.preMultiply($a);Vb=qb.subtractPoints(na,Aa);break;case -2:$a=Math.PI/4;Aa=Va.getCenter();var cb=L(Aa),ic=Math.atan2(xa.y-cb.y,xa.x-cb.x)-Math.atan2(xb.y-cb.y,xb.x-cb.x);cb=new lb;rc+=ic;na=na.shiftKey?-ea.decompose().rotate+Math.round(rc/$a)*$a:ic;Ba&&(na=-na);cb.rotateAroundPoint(na,Aa.x,Aa.y);ea.preMultiply(cb);xb=xa;break;case 0:case 2:case 4:case 6:$a=~~(bc/2);Aa=za.points[$a];
cb=ea.getInverted().getTransformedPoint(K(F(xa)));xa=za.points[($a+2)%4];$a=(cb.x-xa.x)/(Aa.x-xa.x);Aa=(cb.y-xa.y)/(Aa.y-xa.y);if(.001>Math.abs($a)||.001>Math.abs(Aa)||isNaN($a)||isNaN(Aa))return!0;if(jd||na.shiftKey)Aa=$a=na=Math.max($a,Aa);ea.scaleAroundPoint($a,Aa,xa.x,xa.y);break;case 1:case 5:case 3:case 7:na=~~(bc/2);cb=y(za.points[na],za.points[(na+1)%4]);xa=ea.getInverted().getTransformedPoint(K(F(xa)));na=y(za.points[(na+2)%4],za.points[(na+3)%4]);cb=qb.subtractPoints(cb,na);xa=qb.subtractPoints(xa,
na);ic=cb.getLength();xa=cb.getDotProduct(xa)/ic/ic;if(.001>Math.abs(xa)||isNaN(xa))return!0;1==bc||5==bc?(Aa=1,$a=xa):(Aa=xa,$a=1);ea.scaleAroundPoint(Aa,$a,na.x,na.y)}return Va=za.getTransformed(ea),Ja.transformAffineAmend(ea),Z.repaintAll(),!0}});this.mouseUp=function(na,xa,Aa){if(this.capture&&0==xa)return this.capture=!1,bc=-1,!0};this.mouseMove=function(){this.capture||ia()};this.paint=function(){var na=Va.getTransformed(Qa).points,xa=Array(2*na.length);for(var Aa=0;Aa<na.length;Aa++)xa[Aa]=
na[Aa];for(let cb=0;cb<na.length;cb++){Aa=na[cb];var $a=na[(cb+1)%na.length];xa[cb+na.length]={x:(Aa.x+$a.x)/2,y:(Aa.y+$a.y)/2}}yd(da,"fill");for(Aa=0;Aa<xa.length;Aa++)da.fillRect(xa[Aa].x-3,xa[Aa].y-3,7,7);X(da,na)};this.keyDown=function(na){return"Enter"===na.key?(a.actionPerformed({action:"CPTransformAccept"}),!0):"Escape"===na.key?(a.actionPerformed({action:"CPTransformReject"}),!0):void 0};this.enter=function(){c.prototype.enter.call(this);var na,xa=Ja.transformAffineBegin();ea=xa.transform;
xa.rect;(na=xa.selection).isEmpty()&&(na=xa.rect.clone());Va=(za=new Lc(na.toPoints())).getTransformed(ea);bc=-1;rc=0;Z.repaintAll()};this.leave=function(){c.prototype.leave.call(this);Z.repaintAll()};this.moveByKey=function(na,xa){var Aa;if(ea){var $a=new lb;$a.translate(na,xa);ea.preMultiply($a);Va=za.getTransformed(ea);Ja.transformAffineAmend(ea);null==(Aa=this.repaintAll)||Aa.call(this)}}}function r(){var y,K,Y=0,ia=!1,ua=-1;this.mouseDown=function(ea,za,Va){return!!this.capture||(!this.transient&&
0==za&&!ea.altKey&&!wa(Na).isPressed("space")||0==za&&!ea.altKey&&!wa(Na).isPressed("space")&&wa(Na).isPressed("r")?(y={x:eb,y:Wa},Y=Z.getRotation(),K=Qa.clone(),Ba&&Ia(K),ia=!1,this.capture=!0,ua=za,!0):void(this.transient&&E.pop()))};this.mouseDrag=function(ea){if(this.capture){var za=O.clientWidth/2,Va=O.clientHeight/2;ea=O.width/2;var xb=O.height/2;za=Math.atan2(Wa-Va,eb-za)-Math.atan2(y.y-Va,y.x-za);Va=new lb;return Va.rotateAroundPoint(za,ea,xb),Va.multiply(K),Z.setRotation(Y+za),Z.setOffset(~~Va.getTranslateX(),
~~Va.getTranslateY()),ia=!0,!0}};this.mouseUp=function(ea,za,Va){if(this.capture&&za==ua){if(ia){ea=Math.round(wb/(Math.PI/2))*Math.PI/2;if(Math.abs(wb-ea)<5/180*Math.PI){Va=ea-Y;ea=O.width/2;za=O.height/2;let xb=new lb;xb.rotateAroundPoint(Va,ea,za);xb.multiply(K);Z.setRotation(Y+Va);Z.setOffset(~~xb.getTranslateX(),~~xb.getTranslateY());Z.repaintAll()}Z.emitEvent("canvasRotated90",[Z.getRotation90()])}else Z.resetRotation();return this.capture=!1,this.transient&&!wa(Na).isPressed("r")&&E.pop(),
!0}};this.keyUp=function(ea){if(this.transient&&1!=ua&&" "===ea.key)return u("default"),E.pop(),!0};this.keyDown=function(ea){if("r"===ea.key.toLowerCase())return!0}}function t(){n.call(this)}function u(y){O.getAttribute("data-cursor")!=y&&O.setAttribute("data-cursor",y)}function w(){var y=Ja.getActiveLayer();return y.visible&&y.ancestorsAreVisible()?0!=y.alpha||(a.showLayerNotification(y,Q("Whoops! This layer's opacity is currently 0%"),"opacity"),!1):(a.showLayerNotification(y,Q("Whoops! This layer is currently hidden"),
"layer"),!1)}function C(){var y=Ja.getActiveLayer();return y instanceof Ua&&!Ja.isEditingMask()?(a.showLayerNotification(y,Q("Whoops! You can't draw on a group"),"layer"),!1):w()}function D(y,K,Y,ia,ua){y.setValues(-ua,ia,K-ia-ua+Y/4,K+Y-ua-Y/4);y.setBlockIncrement(Math.max(1,~~(.66*ia)));y.setUnitIncrement(Math.max(1,~~(.05*ia)))}function A({resetViewFlip:y=!1}={}){(Qa.setToIdentity(),Qa.translate(Gb,jb),Qa.scale(sb,sb),Qa.rotate(wb),Ba&&!y&&Ia(Qa),null==R||null==V||R.getValueIsAdjusting()||V.getValueIsAdjusting())||
(y=pa(new oa(0,0,Ka.width,Ka.height)),D(R,y.left,y.getWidth(),O.clientWidth,Z.getOffset().x),D(V,y.top,y.getHeight(),O.clientHeight,Z.getOffset().y));Z.repaintAll()}function F(y){return Qa.getInverted().getTransformedPoint(y)}function J(y){y=F(y);return y.x=Math.floor(y.x),y.y=Math.floor(y.y),y}function N(y){var K=O.getBoundingClientRect();return{x:y.x-K.left-window.pageXOffset,y:y.y-K.top-window.pageYOffset}}function L(y){return Qa.getTransformedPoint(y)}function M(y){y=L(y);return y.x=Math.round(y.x),
y.y=Math.round(y.y),y}function X(y,K){y.beginPath();y.moveTo(K[0].x,K[0].y);for(var Y=1;Y<K.length;Y++)y.lineTo(K[Y].x,K[Y].y);y.lineTo(K[0].x,K[0].y);y.stroke()}function fa(y,K){var Y=L({x:(K.left+K.right)/2,y:(K.top+K.bottom)/2});K=K.toPoints();for(var ia=0;ia<K.length;ia++)K[ia]=M(K[ia]),K[ia].x+=.5*Math.sign(Y.x-K[ia].x),K[ia].y+=.5*Math.sign(Y.y-K[ia].y);X(y,K)}function pa(y){var K=M({x:y.left-1,y:y.top-1}),Y=M({x:y.left-1,y:y.bottom}),ia=M({x:y.right,y:y.top-1});y=M({x:y.right,y:y.bottom});
K=new oa(Math.min(Math.min(K.x,Y.x),Math.min(ia.x,y.x)),Math.min(Math.min(K.y,Y.y),Math.min(ia.y,y.y)),Math.max(Math.max(K.x,Y.x),Math.max(ia.x,y.x))+1,Math.max(Math.max(K.y,Y.y),Math.max(ia.y,y.y))+1);return K.grow(2,2),K}function H(){var y=O.width,K=O.height,Y=L({x:Ja.width/2,y:Ja.height/2});Z.setOffset(Math.round(Gb+y/2-Y.x),Math.round(jb+K/2-Y.y))}function ja(y,K,Y){if(y=Math.max(.1,Math.min(8,y)),Z.getZoom()!=y){var ia=Z.getOffset();Z.setOffset(ia.x+~~((K-ia.x)*(1-y/Z.getZoom())),ia.y+~~((Y-
ia.y)*(1-y/Z.getZoom())));Z.setZoom(y);Z.repaintAll()}}function U(y,K=!0){let Y=O.clientWidth,ia=O.clientHeight;K&&(K=parseFloat(y),.01>Math.abs(K-1)?y=1:.2>Math.abs(K-2)?y=2:.08>Math.abs(K-.5)&&(y=.5));ja(y,Y/2,ia/2)}function Za(y){return"mouse"===y.pointerType&&0!==y.buttons&&0===y.pressure?1:"touch"===y.pointerType?(0!==y.pressure&&(lc=!0),lc)?2*y.pressure:1:2*y.pressure}function Ia(y){let K=Ja.width/2;y.translate(K,0);y.scale(-1,1);y.translate(-K,0)}function zb(y){let K=y[0].pageX-y[1].pageX;
y=y[0].pageY-y[1].pageY;return Math.sqrt(K*K+y*y)}function Cb(){wc||(wc=!0,window.requestAnimationFrame(function(){Z.paint()}))}function db(y){Fb.union(y);Cb()}function ya(){Pb=Ja.getBounds();Z.repaintAll()}let T,Z=this,va=document.createElement("div"),ca=document.createElement("div"),Pa=document.createElement("div"),O=document.createElement("canvas"),da=O.getContext("2d"),Ka=document.createElement("canvas"),bb=Ka.getContext("2d"),Jb=Ze(da),Ja=a.getArtwork(),sb=1,Gb=0,jb=0,wb=0,Qa=new lb,Ob=!1,rb=
!1,Kb=32,eb=0,Wa=0,Bb=!1,ib=[!1,!1,!1],ec=!1,jc=!1,Zb=!1,lc=!1,Pb=Ja.getBounds(),Fb=new oa(0,0,0,0),wc=!1,kc;let ha,Lb,dc,Rb,vc,Da,Qb,hc,x=[],E=new Nb,P,R=new id(!1),V=new id(!0);Math.sign=Math.sign||function(y){return 0==(y*=1)||isNaN(y)?y:0<y?1:-1};c.prototype.transient=!1;c.prototype.capture=!1;c.prototype.enter=function(){u("default")};c.prototype.leave=function(){this.capture=!1};c.prototype.mouseMove=c.prototype.paint=c.prototype.mouseDown=c.prototype.mouseDrag=c.prototype.mouseUp=c.prototype.keyDown=
c.prototype.suspend=c.prototype.resume=c.prototype.keyUp=function(){};d.prototype=Object.create(c.prototype);d.prototype.constructor=d;d.prototype.mouseDown=function(y,K,Y){var ia=wa(Na).isPressed("space");!ia&&(2==K||0==K&&y.altKey)?(E.push(ha,!0),E.peek().mouseDown(y,K,Y)):ia||0!=K||y.altKey||!wa(Na).isPressed("r")?1!=K&&(y.altKey||y.ctrlKey||wa(Na).isPressed("z")||!ia||0!=K)||(E.push(Lb,!0),E.peek().mouseDown(y,K,Y)):(E.push(dc,!0),E.peek().mouseDown(y,K,Y))};let ba=null;d.prototype.keyDown=function(y){return!y.altKey&&
(!y.ctrlKey&&wa(Na).isPressed("z")||y.ctrlKey&&wa(Na).isPressed("space"))?(u("zoom-in"),E.peek()===P&&(ba=P,E.pop()),y.preventDefault(),!0):"r"===y.key.toLowerCase()&&" "!==y.key?(E.push(dc,!0),E.peek().keyDown(y),!0):" "!==y.key||y.ctrlKey&&"z"===y.key.toLowerCase()?(E.peek()===Da||E.peek()===Qb?"Enter"===y.key&&(a.actionPerformed({action:"CPTransform"}),y.preventDefault()):(E.peek()===Lb||E.peek()===dc)&&"Enter"===y.key&&(a.actionPerformed({action:"CPResetZoomAndRotation"}),y.preventDefault()),
!1):(E.push(Lb,!0),E.peek().keyDown(y),y.preventDefault(),!0)};d.prototype.keyUp=function(y){" "!==y.key&&"control"!==y.key.toLowerCase()&&"z"!==y.key.toLowerCase()||(u("default"),ba&&(E.setUserMode(ba),ba=null),y.preventDefault())};b.prototype=Object.create(c.prototype);b.prototype.constructor=b;b.prototype.getBrushPreviewOval=function(){let y=a.getBrushSize()*sb/2;return new oa(eb-y,Wa-y,eb+y,Wa+y)};b.prototype.queueBrushPreview=function(){if(E.peek()==this){this.shouldPaintBrushPreview=!0;var y=
this.getBrushPreviewOval();y.grow(2,2);null!=this.oldPreviewRect&&(y.union(this.oldPreviewRect),this.oldPreviewRect=null);db(y)}};b.prototype.eraseBrushPreview=function(){this.shouldPaintBrushPreview=!1;null!=this.oldPreviewRect&&(db(this.oldPreviewRect),this.oldPreviewRect=null)};b.prototype.mouseMove=function(y,K){this.queueBrushPreview()};b.prototype.enter=function(){c.prototype.enter.call(this);Bb&&this.queueBrushPreview()};b.prototype.leave=function(){c.prototype.leave.call(this);this.eraseBrushPreview()};
b.prototype.suspend=b.prototype.leave;b.prototype.resume=b.prototype.enter;b.prototype.paint=function(){if(this.shouldPaintBrushPreview){this.shouldPaintBrushPreview=!1;var y=this.getBrushPreviewOval();da.beginPath();da.arc((y.left+y.right)/2,(y.top+y.bottom)/2,y.getWidth()/2,0,2*Math.PI);da.stroke();y.grow(2,2);null==this.oldPreviewRect?this.oldPreviewRect=y:this.oldPreviewRect.union(y)}};k.prototype=Object.create(b.prototype);k.prototype.constructor=k;k.prototype.mouseDown=function(y,K,Y){if(!this.capture&&
0==K&&!y.altKey&&!wa(Na).isPressed("space")&&C()&&(y=F({x:eb,y:Wa}),this.eraseBrushPreview(),Ja.beginStroke(y.x,y.y,Y)))return this.capture=!0,this.smoothMouse=y,!0};k.prototype.mouseDrag=function(y,K){if(("number"!=typeof navigator.maxTouchPoints||3>navigator.maxTouchPoints)&&b.prototype.mouseMove.call(this,y,K),this.capture){y=F({x:eb,y:Wa});var Y=Math.min(.999,Math.pow(a.getBrushInfo().smoothing,.3));let ia=1-Y;return this.smoothMouse.x=ia*y.x+Y*this.smoothMouse.x,this.smoothMouse.y=ia*y.y+Y*this.smoothMouse.y,
Ja.continueStroke(this.smoothMouse.x,this.smoothMouse.y,K),!0}this.mouseMove(y)};k.prototype.mouseUp=function(y,K,Y){if(this.capture)return 0==K&&(this.capture=!1,Ja.endStroke()),!0};n.prototype=Object.create(b.prototype);n.prototype.constructor=n;n.prototype.drawLine=function(y,K){Ja.beginStroke(y.x,y.y,1);Ja.continueStroke(K.x,K.y,1);Ja.endStroke()};g.prototype=Object.create(b.prototype);g.prototype.constructor=g;e.prototype=Object.create(c.prototype);e.prototype.constructor=e;h.prototype=Object.create(c.prototype);
h.prototype.constructor=h;l.prototype=Object.create(c.prototype);l.prototype.constructor=l;l.prototype.mouseDown=function(y,K,Y){if(0==K&&!y.altKey&&!wa(Na).isPressed("space")&&C())return y=F({x:eb,y:Wa}),Ja.isPointWithin(y.x,y.y)&&(Ja.floodFill(y.x,y.y),Z.repaintAll()),!0};f.prototype=Object.create(c.prototype);f.prototype.constructor=f;m.prototype=Object.create(c.prototype);m.prototype.constructor=m;m.prototype.mouseMove=function(y){return E.peek()!==this||(wa(Na).isPressed("r")&&wa(Na).isPressed("space")||
u("move"),!0)};m.prototype.enter=function(){wa(Na).isPressed("r")&&wa(Na).isPressed("space")||u("move")};q.prototype=Object.create(c.prototype);q.prototype.constructor=q;document.addEventListener("keydown",function(y){let K=E.peek(),Y=function(ea){if(!ea)return null;switch(ea.toLowerCase()){case "arrowup":return{dx:0,dy:-1};case "arrowdown":return{dx:0,dy:1};case "arrowleft":return{dx:-1,dy:0};case "arrowright":return{dx:1,dy:0};default:return null}}(y.key);if(Y){var {dx:ia,dy:ua}=Y;(Ba&&(ia=-ia),
K===hc)?(hc.moveByKey(ia,ua),y.preventDefault()):K===Qb&&(Ja.move(ia,ua,y.altKey),y.preventDefault())}});r.prototype=Object.create(c.prototype);r.prototype.constructor=r;t.prototype=Object.create(n.prototype);t.prototype.constructor=t;t.prototype.drawLine=function(y,K){Ja.gradientFill(Math.round(y.x),Math.round(y.y),Math.round(K.x),Math.round(K.y),a.getCurGradient())};t.prototype.queueBrushPreview=function(){};this.setZoom=function(y){sb=y;A()};this.getZoom=function(){return sb};this.setGridSize=
function(y){Kb=Math.max(Math.round(y),1);this.repaintAll()};this.getGridSize=function(){return Kb};this.setOffset=function(y,K){isNaN(y)||isNaN(K)?console.log("Bad offset"):(Gb=y,jb=K,A())};this.getOffset=function(){return{x:Gb,y:jb}};this.setInterpolation=function(y){Ob=y;Td(da,y);this.repaintAll()};this.setRotation=function(y){wb=y%(2*Math.PI);A()};this.setRotationOnCenter=function(y){let K=O.width/2,Y=O.height/2;var ia=y-wb;let ua=Math.cos(ia);ia=Math.sin(ia);let ea=Gb-K,za=jb-Y;Gb=K+ea*ua-za*
ia;jb=Y+ea*ia+za*ua;wb=y%(2*Math.PI);A()};this.getRotation=function(){return wb};this.getRotationDegrees=function(){return(180*this.getRotation()/Math.PI+540)%360-180};this.setRotationDegrees=function(y){this.setRotationOnCenter(y*Math.PI/180)};this.getRotation90=function(){var y=Math.round(this.getRotation()/Math.PI*2);return 0>(y%=4)&&(y+=4),y};this.zoomIn=function(){U(1.41*this.getZoom())};this.zoomOut=function(){U(.7092*this.getZoom())};this.zoom100=function(){U(1);H()};this.zoomOnCenter=(y,K=
!1)=>{U(y,K)};this.resetRotation=function(){var y=O.width/2,K=O.height/2,Y=new lb;Y.rotateAroundPoint(-this.getRotation(),y,K);Y.multiply(Qa);Ba&&Ia(Y);this.setOffset(~~Y.getTranslateX(),~~Y.getTranslateY());this.setRotation(0);Z.emitEvent("canvasRotated90",[0])};this.resetZoomAndRotation=function(){this.zoom100();this.resetRotation();Ba=!1;A({resetViewFlip:!0})};this.isPanOrRotateMode=function(){return jc};let ta=!1,Ba=!1;this.toggleViewFlip=()=>(Ba?(Ba=!1,A({resetViewFlip:!0})):(Ia(Qa),Ba=!0,Z.repaintAll()),
Ba);let hb=!1,fc=0;O.addEventListener("pointerdown",y=>{!y.altKey&&(!y.ctrlKey&&wa(Na).isPressed("z")||y.ctrlKey&&wa(Na).isPressed("space"))&&"touch"!==y.pointerType&&(hb=!0,fc=y.clientX)});O.addEventListener("pointermove",y=>{if(!y.altKey&&(!y.ctrlKey&&wa(Na).isPressed("z")||y.ctrlKey&&wa(Na).isPressed("space"))&&hb&&"touch"!==y.pointerType&&1===y.buttons){let K=y.clientX-fc;if(10<Math.abs(K)){let Y=N({x:y.pageX,y:y.pageY});ja(Z.getZoom()*(0<K?1.15:1/1.15),Y.x,Y.y);fc=y.clientX}y.preventDefault()}});
O.addEventListener("pointerup",y=>{"touch"!==y.pointerType&&(hb=!1)});let gc=0,$b=1,Eb=0;this.getElement=function(){return va};this.repaintAll=function(){Fb.left=0;Fb.top=0;Fb.right=O.width;Fb.bottom=O.height;Cb()};this.paint=function(){var y=!1;if(wc=!1,Fb.isEmpty()||(da.save(),da.clipTo&&(da.beginPath(),Fb.left|=0,Fb.top|=0,da.rect(Fb.left,Fb.top,Math.ceil(Fb.getWidth()),Math.ceil(Fb.getHeight())),da.clip()),y=!0),!Pb.isEmpty()){var K=kc&&kc.isOpen()?kc.getImageData():Ja.fusionLayers().getImageData();
bb.putImageData(K,0,0,Pb.left,Pb.top,Pb.getWidth(),Pb.getHeight());Pb.makeEmpty()}if(da.fillStyle="#606060",da.fillRect(0,0,O.width,O.height),da.save(),da.setTransform(Qa.m[0],Qa.m[1],Qa.m[2],Qa.m[3],Qa.m[4],Qa.m[5]),da.fillStyle=Jb,da.fillRect(0,0,Ja.width,Ja.height),da.drawImage(Ka,0,0,Ka.width,Ka.height),da.restore(),yd(da,"stroke"),da.lineWidth=1,Ja.getSelection().isEmpty()||E.peek()instanceof f&&E.peek().capture||(da.setLineDash([3,2]),fa(da,Ja.getSelection()),da.setLineDash([])),rb)if(K=Ja.getBounds(),
2<sb*Kb){da.beginPath();for(var Y=Kb-1;Y<K.right;Y+=Kb){var ia=L({x:Y,y:K.top}),ua=L({x:Y,y:K.bottom});da.moveTo(ia.x+.5,ia.y+.5);da.lineTo(ua.x+.5,ua.y+.5)}for(Y=Kb-1;Y<K.bottom;Y+=Kb)ia=L({x:0,y:Y}),ua=L({x:K.right,y:Y}),da.moveTo(ia.x+.5,ia.y+.5),da.lineTo(ua.x+.5,ua.y+.5);da.stroke()}E.paint(da);da.globalCompositeOperation="source-over";y&&(Fb.makeEmpty(),da.restore())};this.showGrid=function(y){rb=y;this.repaintAll()};this.resize=function(y,K){y-=Pa.offsetHeight;y=Math.floor(y);O.style.height=
y+"px";O.width=O.clientWidth;O.height=y;T=null;K||H();this.setInterpolation(Ob);this.repaintAll()};a.on("toolChange",function(y,K){y=x[K.strokeMode];for(K=0;K<E.modes.length;K++)if(E.modes[K]instanceof b){E.modes[K].leave();E.modes[K]=y;E.modes[K].enter();break}P=y});a.on("modeChange",function(y){switch(y){case W.M_DRAW:var K=P;break;case W.M_FLOODFILL:K=Rb;break;case W.M_GRADIENTFILL:K=vc;break;case W.M_RECT_SELECTION:K=Da;break;case W.M_MOVE_TOOL:K=Qb;break;case W.M_ROTATE_CANVAS:K=dc;break;case W.M_PAN_CANVAS:K=
Lb;break;case W.M_COLOR_PICKER:K=ha;break;case W.M_TRANSFORM:K=hc}jc=y===W.M_PAN_CANVAS||y===W.M_ROTATE_CANVAS;Zb=y===W.M_MOVE_TOOL||y===W.M_ROTATE_CANVAS||y===W.M_PAN_CANVAS;E.setUserMode(K)});a.on("maskViewOpened",function(y){kc&&kc.off("changeLayer",ya);(kc=y).on("changeLayer",ya);ya()});var pb=new d;ha=new e;Lb=new h;dc=new r;Rb=new l;vc=new t;Da=new f;Qb=new m;hc=new q;P=(x=[new k,new n,new g])[la.STROKE_MODE_FREEHAND];E.setDefaultMode(pb);E.setUserMode(P);Ka.width=Ja.width;Ka.height=Ja.height;
O.width=800;O.height=900;O.className="chickenpaint-canvas";O.setAttribute("touch-action","none");da.setLineDash||(da.setLineDash=function(){});O.addEventListener("contextmenu",function(y){y.preventDefault()});O.addEventListener("mouseenter",function(){Bb=!0});O.addEventListener("mouseleave",function(){Bb=!1;ib[0]||ib[2]||ib[1]||Z.repaintAll()});O.addEventListener("pointerdown",function(y){ec&&!Zb&&"touch"===y.pointerType||!wa(Na).isPressed("z")&&(O.setPointerCapture(y.pointerId),T=O.getBoundingClientRect(),
eb=y.clientX-T.left,Wa=y.clientY-T.top,ib[0]=!1,ib[2]=!1,ib[1]=!1,ib[y.button]=!0,E.mouseDown(y,y.button,Za(y)))});O.addEventListener("pointermove",function(y){if(!(T||=O.getBoundingClientRect(),ec&&!Zb&&"touch"===y.pointerType||1<Eb&&"touch"===y.pointerType||wa(Na).isPressed("z")||y.ctrlKey&&wa(Na).isPressed("space"))){eb=y.clientX-T.left;Wa=y.clientY-T.top;var K=0!==y.buttons,Y=K?Za(y):0;0!=(1&y.buttons)!=ib[0]&&(ib[0]=!ib[0],ib[0]?E.mouseDown(y,0,Y):E.mouseUp(y,0,Y));0!=(2&y.buttons)!=ib[2]&&(ib[2]=
!ib[2],ib[2]?E.mouseDown(y,2,Y):E.mouseUp(y,2,Y));0!=(4&y.buttons)!=ib[1]&&(ib[1]=!ib[1],ib[1]?E.mouseDown(y,1,Y):E.mouseUp(y,1,Y));K?E.mouseDrag(y,Y):E.mouseMove(y,Y);ec||"pen"!==y.pointerType||(ec=!0)}});O.addEventListener("touchstart",function(y){Eb=y.touches.length;jc&&2===Eb&&(gc=zb(y.touches),$b=Z.getZoom(),y.preventDefault())},{passive:!1});O.addEventListener("touchend",function(y){Eb=y.touches.length},{passive:!1});O.addEventListener("touchmove",function(y){if(Eb=y.touches.length,jc&&2===
Eb){let K=zb(y.touches)/gc,Y=N({x:(y.touches[0].pageX+y.touches[1].pageX)/2,y:(y.touches[0].pageY+y.touches[1].pageY)/2});ja($b*K,Y.x,Y.y);y.preventDefault()}},{passive:!1});O.addEventListener("pointerup",function(y){ib[0]=!1;ib[2]=!1;ib[1]=!1;E.mouseUp(y,y.button,0);O.releasePointerCapture(y.pointerId)});O.addEventListener("wheel",function(y){if(0!=y.deltaY){if(!ta||20<Math.abs(y.deltaY)){let K;K=0<y.deltaY?1/1.15:1.15;let Y=N({x:y.pageX,y:y.pageY}),ia=F(Y);Ja.isPointWithin(ia.x,ia.y)?ja(Z.getZoom()*
K,Y.x,Y.y):ja(Z.getZoom()*K,Gb+~~(Ja.width*sb/2),jb+~~(Ja.height*sb/2));ta=ta||setTimeout(function(){ta=!1},50)}y.preventDefault()}},{passive:!1});document.addEventListener("keydown",function(y){E.keyDown(y)});document.addEventListener("keyup",function(y){"alt"===y.key.toLowerCase()&&y.preventDefault();E.keyUp(y)});document.addEventListener("visibilitychange",function(){let y=O.height+Pa.offsetHeight;O.width=1;O.height=1;Z.resize(y,!0)},!1);window.addEventListener("scroll",function(){T=null});O.addEventListener("mousedown",
function(y){1==y.button&&y.preventDefault()});Ja.on("changeSelection",function(){Z.repaintAll()});Ja.on("updateRegion",function(y){Pb.union(y);db(pa(Pb))});R.on("valueChanged",function(y){var K=Z.getOffset();Z.setOffset(-y,K.y)});V.on("valueChanged",function(y){var K=Z.getOffset();Z.setOffset(K.x,-y)});this.setInterpolation(!0);pb=document.createElement("div");pb.className="chickenpaint-canvas-container-wrapper";pb.appendChild(O);ca.className="chickenpaint-canvas-container-top";ca.appendChild(pb);
ca.appendChild(V.getElement());Pa.className="chickenpaint-canvas-container-bottom";Pa.appendChild(R.getElement());va.appendChild(ca);va.appendChild(Pa);a.setCanvas(this)}function Ib(a,c,d,b){a.getSmallScreenMode()&&Q(d+" (shorter)")!==d+" (shorter)"?this.title=Q(d+" (shorter)"):this.title=Q(d);b=b||{};this.name=c;this.resizeVert=b.resizeVert||!1;this.resizeHorz=b.resizeHorz||!1;let k=document.createElement("div");d=document.createElement("div");let n=document.createElement("i"),g=document.createElement("button"),
e=document.createElement("div"),h=null,l=null,f,m,q,r=this;this.getElement=function(){return k};this.getBodyElement=function(){return e};this.getWidth=function(){return k.offsetWidth};this.getHeight=function(){return k.offsetHeight};this.getX=function(){return parseInt(k.style.left,10)||0};this.getY=function(){return parseInt(k.style.top,10)||0};this.setLocation=function(u,w){k.style.left=u+"px";k.style.top=w+"px"};this.setWidth=function(u){k.style.width=u+"px"};this.setHeight=function(u){k.style.height=
u+"px"};this.setSize=function(u,w){this.setWidth(u);this.setHeight(w)};this.setCollapseDownwards=function(u){b.collapseDownwards=u};this.toggleCollapse=function(u){var w;if(void 0===u)u=!k.classList.contains("collapsed");else if(k.classList.contains("collapsed")===u)return;var C=null==(w=k.closest(".chickenpaint"))?void 0:w.querySelector(".chickenpaint-canvas");w=C?C.clientHeight:window.innerHeight;C=this.getHeight();C=this.getY()+C;(k.classList.toggle("collapsed",u),n.classList.toggle("icon-angle-down",
!u),n.classList.toggle("icon-angle-up",u),u)?b.collapseDownwards&&this.setLocation(this.getX(),Math.min(C,w)-this.getHeight()):(u=this.getHeight(),b.collapseDownwards?this.setLocation(this.getX(),Math.max(C-u,0)):this.getY()+u>w&&this.setLocation(this.getX(),Math.max(w-u,0)))};this.userIsDoneWithUs=function(){a.getSmallScreenMode()&&this.toggleCollapse(!0)};n.className="collapse-icon fas icon-angle-down";g.type="button";g.className="btn btn-close";g.textContent="";g.tabIndex=-1;k.className="chickenpaint-palette chickenpaint-palette-"+
c;d.className="chickenpaint-palette-head";d.setAttribute("touch-action","none");c=document.createElement("div");let t=document.createElement("h5");c.className="modal-header";t.className="modal-title";t.appendChild(document.createTextNode(this.title));t.appendChild(n);c.appendChild(t);c.appendChild(g);d.appendChild(c);e.className="chickenpaint-palette-body";k.appendChild(d);k.appendChild(e);this.resizeVert&&((h=document.createElement("div")).className="chickenpaint-resize-handle-vert",h.addEventListener("pointerdown",
function(u){m="vertResize";h.setPointerCapture(u.pointerId)}),h.addEventListener("pointermove",function(u){"vertResize"==m&&r.setHeight(u.pageY-k.offsetTop)}),h.addEventListener("pointerup",function(u){h.releasePointerCapture(u.pointerId);m=!1}),k.appendChild(h));this.resizeHorz&&((l=document.createElement("div")).className="chickenpaint-resize-handle-horz",l.addEventListener("pointerdown",function(u){m="horzResize";l.setPointerCapture(u.pointerId)}),l.addEventListener("pointermove",function(u){"horzResize"==
m&&r.setWidth(u.pageX-k.offsetLeft)}),l.addEventListener("pointerup",function(u){l.releasePointerCapture(u.pointerId);m=!1}),k.appendChild(l));d.addEventListener("pointerdown",function(u){0==u.button&&(u.stopPropagation(),u.preventDefault(),"BUTTON"==u.target.nodeName?r.emitEvent("paletteVisChange",[r,!1]):(f={x:parseInt(k.style.left,10)||0,y:parseInt(k.style.top,10)||0},q={x:u.pageX-k.offsetLeft,y:u.pageY-k.offsetTop},m=a.getSmallScreenMode()?"dragStart":"dragging",u.target.setPointerCapture(u.pointerId)))});
d.addEventListener("pointermove",function(u){if(("dragStart"===m||"dragging"===m)&&0!==u.buttons){var w,C;let D=u.pageX-q.x;u=u.pageY-q.y;"dragStart"==m&&(w={x:D,y:u},C=f,25<(w.x-C.x)*(w.x-C.x)+(w.y-C.y)*(w.y-C.y))&&(m="dragging");"dragging"==m&&r.setLocation(D,u)}});d.addEventListener("pointerup",function(u){if("dragging"===m||"dragStart"===m){"dragStart"===m&&(u.stopPropagation(),u.preventDefault(),setTimeout(()=>{r.setLocation(f.x,f.y);r.toggleCollapse()},100));m=!1;try{u.target.releasePointerCapture(u.pointerId)}catch(w){console.error(w)}}})}
function Ad(a){function c(g){"LI"==this.nodeName&&(g=b[parseInt(this.getAttribute("data-buttonIndex"),10)],a.actionPerformed({action:g.command}))}Ib.call(this,a,"tool","Tools");let d=this,b=[{className:"chickenpaint-tool-rect-selection",command:"CPRectSelection",toolTip:"Marquee",shortcut:"m",mode:W.M_RECT_SELECTION},{className:"chickenpaint-tool-move",command:"CPMoveTool",toolTip:"Move tool",shortcut:"v",mode:W.M_MOVE_TOOL},{className:"chickenpaint-tool-flood-fill",command:"CPFloodFill",toolTip:"Flood fill",
shortcut:"f",mode:W.M_FLOODFILL},{className:"chickenpaint-tool-gradient-fill",command:"CPGradientFill",toolTip:"Gradient fill",shortcut:"g",mode:W.M_GRADIENTFILL},{className:"chickenpaint-tool-color-picker",command:"CPColorPicker",toolTip:"Color picker",shortcut:"i",mode:W.M_COLOR_PICKER},{className:"chickenpaint-tool-blur",command:"CPBlur",toolTip:"Blur",shortcut:"u",mode:W.M_DRAW,tool:W.T_BLUR},{className:"chickenpaint-tool-pencil",command:"CPPencil",toolTip:"Pencil",shortcut:"n",mode:W.M_DRAW,
tool:W.T_PENCIL},{className:"chickenpaint-tool-pen",command:"CPPen",toolTip:"Pen",selected:!0,shortcut:"b",mode:W.M_DRAW,tool:W.T_PEN},{className:"chickenpaint-tool-airbrush",command:"CPAirbrush",toolTip:"Airbrush",shortcut:"a",mode:W.M_DRAW,tool:W.T_AIRBRUSH},{className:"chickenpaint-tool-water",command:"CPWater",toolTip:"Waterpaint",shortcut:"w",mode:W.M_DRAW,tool:W.T_WATER},{className:"chickenpaint-tool-eraser",command:"CPEraser",toolTip:"Eraser",shortcut:"e",mode:W.M_DRAW,tool:W.T_ERASER},{className:"chickenpaint-tool-soft-eraser",
command:"CPSoftEraser",toolTip:"Soft eraser",shortcut:"s",mode:W.M_DRAW,tool:W.T_SOFTERASER},{className:"chickenpaint-tool-smudge",command:"CPSmudge",toolTip:"Smudge",shortcut:"d",mode:W.M_DRAW,tool:W.T_SMUDGE},{className:"chickenpaint-tool-blender",command:"CPBlender",toolTip:"Blender",shortcut:"c",mode:W.M_DRAW,tool:W.T_BLENDER},{className:"chickenpaint-tool-dodge",command:"CPDodge",toolTip:"Dodge (tool)",shortcut:"o",mode:W.M_DRAW,tool:W.T_DODGE},{className:"chickenpaint-tool-burn",command:"CPBurn",
toolTip:"Burn (tool)",shortcut:"p",mode:W.M_DRAW,tool:W.T_BURN},{className:"chickenpaint-tool-rotate-canvas",command:"CPRotateCanvas",commandDoubleClick:"CPResetCanvasRotation",toolTip:"Rotate canvas",mode:W.M_ROTATE_CANVAS},{className:"chickenpaint-tool-pan-canvas",command:"CPPanCanvas",toolTip:"Grab canvas",mode:W.M_PAN_CANVAS}],k=document.createElement("ul");a.on("modeChange",function(g){let e=d.getBodyElement();(e.querySelectorAll("li").forEach(function(h){h.classList.remove("selected")}),g==
W.M_DRAW)?(g=e.querySelector(`li[data-tool="${a.getCurTool()}"]`))&&g.classList.add("selected"):(g=e.querySelector(`li[data-mode="${g}"]`))&&g.classList.add("selected")});a.on("toolChange",function(g){let e=d.getBodyElement();a.getCurMode()==W.M_DRAW&&(e.querySelectorAll("li").forEach(function(h){h.classList.remove("selected")}),(g=e.querySelector(`li[data-tool="${g}"]`))&&g.classList.add("selected"))});let n=d.getBodyElement();for(let g in k.className="chickenpaint-tools list-unstyled",b)!function(e){let h=
b[e],l=document.createElement("li"),f=document.createElement("div");l.className="chickenpaint-toolbar-button "+h.className;l.setAttribute("data-buttonIndex",e);l.setAttribute("data-mode",h.mode);void 0!==h.tool&&l.setAttribute("data-tool",h.tool);l.title=Q(h.toolTip);h.shortcut&&(l.title+=" ("+h.shortcut.toUpperCase()+")",wa(Na)(h.shortcut,function(){return c.call(l),!1}));h.selected&&(l.className+=" selected");f.className="chickenpaint-toolbar-button-icon";l.appendChild(f);k.appendChild(l)}(g);k.addEventListener("click",
function(g){let e=g.target.closest("li");e&&c.call(e,g)});k.addEventListener("dblclick",function(g){if(g=g.target.closest("li"))g=b[parseInt(g.getAttribute("data-buttonIndex"),10)],g.commandDoubleClick&&a.actionPerformed({action:g.commandDoubleClick})});n.appendChild(k)}function Bd(a){Ib.call(this,a,"misc","Misc");this.flipButton=null;let c=this,d=[{className:"chickenpaint-tool-zoom-in",command:"CPZoomIn",toolTip:"Zoom in"},{className:"chickenpaint-tool-zoom-out",command:"CPZoomOut",toolTip:"Zoom out"},
{className:"chickenpaint-tool-zoom-100",command:"CPZoom100",toolTip:"Zoom 100%"},{className:"chickenpaint-tool-flip-horizontal",command:"CPViewHFlip",toolTip:"Flip View horizontal"},{className:"chickenpaint-tool-undo",command:"CPUndo",toolTip:"Undo"},{className:"chickenpaint-tool-redo",command:"CPRedo",toolTip:"Redo"},{className:"chickenpaint-tool-send",command:"CPSend",toolTip:"Save Oekaki"}];!function(){let b=c.getBodyElement(),k=document.createElement("ul");for(let n in k.className="chickenpaint-misc-tools list-unstyled",
d){let g=d[n],e=document.createElement("li"),h=document.createElement("div");"CPSend"!=g.command||a.isActionSupported("CPContinue")||(g.toolTip="Post Oekaki",g.className="chickenpaint-tool-send-and-end");e.className="chickenpaint-toolbar-button "+g.className;e.setAttribute("data-buttonIndex",n);e.setAttribute("title",Q(g.toolTip));h.className="chickenpaint-toolbar-button-icon";e.appendChild(h);k.appendChild(e);"chickenpaint-tool-flip-horizontal"===g.className&&(c.flipButton=e)}k.addEventListener("click",
function(n){if(n=n.target.closest("li"))n=d[parseInt(n.getAttribute("data-buttonIndex"),10)],a.actionPerformed({action:n.command})});b.appendChild(k)}()}function Cd(a){Ib.call(this,a,"stroke","Stroke");let c=[{className:"chickenpaint-tool-freehand",command:"CPFreeHand",toolTip:Q("Free-hand"),selected:!0},{className:"chickenpaint-tool-line",command:"CPLine",toolTip:Q("Straight line")},{className:"chickenpaint-tool-bezier",command:"CPBezier",toolTip:Q("Bezier curve")}],d=this.getBodyElement(),b=document.createElement("ul");
for(let k in b.className="chickenpaint-stroke-tools list-unstyled",c){let n=c[k],g=document.createElement("li"),e=document.createElement("div");g.className="chickenpaint-toolbar-button "+n.className;g.setAttribute("data-buttonIndex",k);g.setAttribute("title",n.toolTip);n.selected&&(g.className+=" selected");e.className="chickenpaint-toolbar-button-icon";g.appendChild(e);b.appendChild(g)}b.addEventListener("click",function(k){if(k=k.target.closest("li"))k=c[parseInt(k.getAttribute("data-buttonIndex"),
10)],a.actionPerformed({action:k.command})});d.appendChild(b);a.on("toolChange",function(k,n){k=document.querySelector(".chickenpaint-tool-freehand");let g=document.querySelector(".chickenpaint-tool-line"),e=document.querySelector(".chickenpaint-tool-bezier");k&&k.classList.toggle("selected",n.strokeMode==la.STROKE_MODE_FREEHAND);g&&g.classList.toggle("selected",n.strokeMode==la.STROKE_MODE_LINE);e&&e.classList.toggle("selected",n.strokeMode==la.STROKE_MODE_BEZIER)})}function Wb(a,c,d){return c in
a?Object.defineProperty(a,c,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[c]=d,a}function Dd(a){Ib.call(this,a,"color","Color (picker)");let c=new $e(a),d=new af(a,c);a=new eg(a);let b=this.getBodyElement(),k=document.createElement("div");k.className="chickenpaint-colorpicker-top";k.appendChild(c.getElement());k.appendChild(d.getElement());b.appendChild(k);b.appendChild(a.getElement())}function eg(a){function c(n,g,e){for(;n.length<e;)n=g+n;return n}function d(){k.style.backgroundColor="#"+
c(Number(b).toString(16),"0",6)}let b=0,k=document.createElement("div");this.getElement=function(){return k};a.on("colorChange",function(n){b=n.getRgb();d()});k.className="chickenpaint-colorpicker-show";k.addEventListener("click",function(n){n.preventDefault();n="#"+c(Number(b).toString(16),"0",6);if(null!=(n=window.prompt(Q("Please enter a color in hex format"),n)))try{(n.match(/^#/)||n.match(/^$/))&&(n=n.substring(1));let g=parseInt(n,16);a.setCurColor(new fb(g))}catch(g){}});d()}function Uc(a,
c){function d(){var g=b.width;k.clearRect(0,0,g,b.height);k.beginPath();k.arc(g/2+1,g/2+1,Math.max(g/2,1)-2,0,2*Math.PI);n.state?k.fill():k.stroke()}var b=document.createElement("canvas"),k=b.getContext("2d"),n=this;this.state=a||!1;this.setValue=function(g){this.state!=g&&(this.state=g,this.emitEvent("valueChange",[g]),d())};this.getElement=function(){return b};b.addEventListener("mousedown",function(g){n.setValue(!n.state)});b.title=c||"";b.className="chickenpaint-checkbox";b.width=20;b.height=
20;b.fillStyle="black";b.strokeStyle="black";d()}function Sb(a,c,d,b,k=150){function n(){let u=h.width||k,w=h.height,C="string"==typeof t.title?Q(t.title):t.title(t.value),D=3*window.devicePixelRatio,A=.75*h.height;if(d)l.save(),l.fillStyle="white",l.fillRect(0,0,u,w),l.fillStyle="black",l.fillText(C,D,A),l.beginPath(),0<=t.value?l.rect(u/2,0,t.value/c*(u/2),w):l.rect(u/2+t.value/Math.abs(a)*(u/2),0,u/2*-(t.value/Math.abs(a)),w),l.fill(),l.clip(),l.fillStyle="white";else{var F=(t.value-a)/f;b&&(F=
Math.pow(F,.4));F*=u;l.save();l.save();l.fillStyle="black";l.beginPath();l.rect(0,0,F,w);l.fill();l.clip();l.fillStyle="white";l.fillText(C,D,A);l.restore();l.fillStyle="white";l.beginPath();l.rect(F,0,u,w);l.fill();l.clip();l.fillStyle="black"}l.fillText(C,D,A);l.restore()}function g(u){let w=h.clientWidth,C=h.getBoundingClientRect().left+window.scrollX;u=(u.pageX-C)/w;b&&(u=Math.pow(Math.max(u,0),2.5));t.setValue(u*f+a)}function e(u){switch(m){case 1:return g(u);case 2:var w=t.title();if(!w.includes(Q("Brush size"))&&
!w.includes(Q("Opacity")))return g(u);w=(u.pageX-q)/4;if(0!==w){w=t.value+w;let C=Math.floor(w);t.setValue(C);q=u.pageX-4*(w-C)}}}let h=document.createElement("canvas"),l=h.getContext("2d"),f=c-a,m=0,q,r=!1,t=this;this.value=void 0;this.title="";d=d||!1;h.addEventListener("pointerup",u=>{if(0===m)return h.releasePointerCapture(u.pointerId),h.removeEventListener("pointermove",e);if(0!==m)switch(m){case 1:0!==u.button||u.shiftKey||(m=0);break;case 2:(2==u.button||0===u.button&&u.shiftKey)&&(m=0);break;
default:return}return h.releasePointerCapture(u.pointerId),h.removeEventListener("pointermove",e)});this.setValue=function(u){u=~~Math.max(a,Math.min(c,u));this.value!=u&&(this.value=u,this.emitEvent("valueChange",[this.value]),r?n():(r=!0,this.resize()))};this.getElement=function(){return h};this.resize=function(){h.width=h.clientWidth||k;h.height=h.clientHeight||20;1<window.devicePixelRatio&&(h.style.height=h.height+"px",h.width*=window.devicePixelRatio,h.height*=window.devicePixelRatio);l.font=
.47*h.height+"pt sans-serif";n()};h.addEventListener("pointerdown",function(u){0===m&&(2===u.button||0===u.button&&u.shiftKey?(m=2,q=u.pageX):(m=1,g(u)),h.setPointerCapture(u.pointerId),h.addEventListener("pointermove",e))});h.addEventListener("contextmenu",function(u){u.preventDefault()});h.setAttribute("touch-action","none");h.className="chickenpaint-slider";"devicePixelRatio"in window||(window.devicePixelRatio=1)}function kd(a,c,d){function b(){for(var f=e.style,m=Number(n.getRgb()).toString(16);6>
m.length;)m="0"+m;f.backgroundColor="#"+m}let k=this,n=new fb(0),g=255,e=document.createElement("div");this.getElement=function(){return e};this.setColor=function(f){n.isEqual(f)||(n.copyFrom(f),b(),this.emitEvent("colorChange",[n]))};this.setAlpha=function(f){f!=g&&(g=f,b(),this.emitEvent("alphaChange",[g]))};this.getColorRgb=function(){return n.getRgb()};this.getAlpha=function(){return g};this.setCurColor=this.setColor;e.className="chickenpaint-color-pick-swatch";a&&n.copyFrom(a);c&&(g=c);let h=
new Tb.Popover(e,{html:!0,content:function(){return window.addEventListener("mousedown",l),function(){let f=document.createElement("div"),m=document.createElement("div"),q=new $e(k,n),r=new af(k,q,n.getHue()),t=new Sb(0,255);return f.className="chickenpaint-color-pick-panel",m.className="chickenpaint-colorpicker-top",m.appendChild(q.getElement()),m.appendChild(r.getElement()),f.appendChild(m),t.value=g,t.title=function(u){return Q("Opacity: ")+u},t.on("valueChange",function(u){k.setAlpha(u)}),f.appendChild(t.getElement()),
setTimeout(function(){t.resize()},0),f}()},trigger:"manual",placement:"bottom",container:d||!1}),l=function(f){var m=f.target;m=m.closest(".popover-body")||m.classList.contains("chickenpaint-color-pick-panel")||m.classList.contains("chickenpaint-colorpicker-select")||m.classList.contains("chickenpaint-colorpicker-slider");f.preventDefault();m||h.hide()};e.addEventListener("click",function(f){f.preventDefault();h.toggle()});e.addEventListener("hidden.bs.popover",function(){window.removeEventListener("mousedown",
l)});b()}function ke(a,c){let d=document.createElement("div");return d.className="chickenpaint-checkbox-slider-group",d.appendChild(a.getElement()),d.appendChild(c.getElement()),d}function bf(a,c){for(let d in c)if(c.hasOwnProperty(d)){let b=document.createElement("option");b.appendChild(document.createTextNode(Q(c[d])));b.value=d;a.appendChild(b)}}function fg(a){function c(){n.gradient(n.getBounds(),0,0,n.width,0,h,!0);e.putImageData(n.imageData,0,0,0,0,150,32);b.fillRect(0,0,d.width,d.height);b.drawImage(g,
0,0)}let d=document.createElement("canvas"),b=d.getContext("2d"),k=Ze(b),n=new z(150,32),g=document.createElement("canvas"),e=g.getContext("2d"),h=a.getCurGradient();this.getElement=function(){return d};a.on("gradientChange",function(l){h=l;c()});d.width=g.width=150;d.height=g.height=32;d.className="chickenpaint-gradient-preview";b.fillStyle=k;c()}function Vc(a){function c(){b.getElement().style.display="none";k.getElement().style.display="none";n.getElement().style.display="none";g.getElement().style.display=
"none";e.getElement().style.display="none"}function d(f){c();let m=g.getElement().querySelector(".form-check");switch(m&&(m.style.display="none"),f){case W.M_GRADIENTFILL:k.getElement().style.display="block";break;case W.M_TRANSFORM:n.getElement().style.display="block";break;case W.M_RECT_SELECTION:g.getElement().style.display="block";m instanceof HTMLElement&&(m.style.display="");break;case W.M_MOVE_TOOL:g.getElement().style.display="block";break;case W.M_ROTATE_CANVAS:case W.M_PAN_CANVAS:e.getElement().style.display=
"block";break;default:b.getElement().style.display="block"}}Ib.call(this,a,"brush","Tool options");let b=new gg(a),k=new hg(a),n=new ig(a),g=new jg(a),e=new kg(a),h=this.getBodyElement();h.addEventListener("touchmove",f=>{f.preventDefault()},{passive:!1});h.appendChild(b.getElement());h.appendChild(k.getElement());h.appendChild(n.getElement());h.appendChild(g.getElement());h.appendChild(e.getElement());let l=null;a.on("modeChange",function(f){l=f;d(f)});document.addEventListener("keydown",f=>{"r"!==
f.key.toLocaleLowerCase()&&(f.ctrlKey||"z"!==f.key.toLocaleLowerCase())&&" "!==f.key||(c(),e.getElement().style.display="block")});document.addEventListener("keyup",f=>{"r"!==f.key.toLocaleLowerCase()&&"z"!==f.key.toLocaleLowerCase()&&" "!==f.key||(c(),d(l))})}function gg(a){let c=[1,2,3,4,5,6,7,8,9,10,15,20,25,30,35,40,45,50,60,70,80,90,100,125,150,175,200],d=document.createElement("div"),b=document.createElement("select"),k=new Uc(!1,Q("Control brush opacity with pen pressure")),n=new Sb(1,255),
g=new Uc(!0,Q("Control brush size with pen pressure")),e=new Sb(1,200,!1,!0),h=new Uc(!1,Q("Control brush scattering with pen pressure")),l=new Sb(0,1E3,!1,!0),f=new Sb(0,100,!1,!0),m=new Sb(0,100,!1,!0),q=new Sb(0,100,!1,!0),r=new Sb(0,100,!1,!0),t=new Vc.CPBrushPreview(a);this.getElement=function(){return d};n.title=function(u){return Q("Opacity")+": "+u};n.on("valueChange",function(u){a.setAlpha(u)});e.title=function(u){return Q("Brush size")+": "+u};e.on("valueChange",function(u){a.setBrushSize(u)});
f.title=function(u){return Q("Color")+": "+u+"%"};f.on("valueChange",function(u){a.getBrushInfo().resat=u/100;a.callToolListeners()});m.title=function(u){return Q("Blend")+": "+u+"%"};m.on("valueChange",function(u){a.getBrushInfo().bleed=u/100;a.callToolListeners()});q.title=function(u){return Q("Spacing")+": "+u+"%"};q.on("valueChange",function(u){a.getBrushInfo().spacing=u/100;a.callToolListeners()});l.title=function(u){return Q("Scattering")+": "+u+"%"};l.on("valueChange",function(u){a.getBrushInfo().scattering=
u/100;a.callToolListeners()});r.title=function(u){return Q("Smoothing")+": "+u+"%"};r.on("valueChange",function(u){a.getBrushInfo().smoothing=u/100;a.callToolListeners()});h.on("valueChange",function(u){a.getBrushInfo().pressureScattering=u;a.callToolListeners()});k.on("valueChange",function(u){a.getBrushInfo().pressureAlpha=u;a.callToolListeners()});g.on("valueChange",function(u){a.getBrushInfo().pressureSize=u;a.callToolListeners()});b.addEventListener("change",function(u){a.getBrushInfo().tip=
parseInt(b.value,10);b.blur()});b.className="form-control form-control-sm";b.tabIndex=-1;bf(b,["Round Pixelated","Round Hard Edge","Round Soft","Square Pixelated","Square Hard Edge"]);d.appendChild(b);d.appendChild(t.getElement());d.appendChild(ke(g,e));d.appendChild(ke(k,n));d.appendChild(f.getElement());d.appendChild(m.getElement());d.appendChild(q.getElement());d.appendChild(ke(h,l));d.appendChild(r.getElement());k.setValue(a.getBrushInfo().pressureAlpha);n.setValue(a.getAlpha());g.setValue(a.getBrushInfo().pressureSize);
e.setValue(a.getBrushSize());h.setValue(a.getBrushInfo().pressureScattering);l.setValue(~~(100*a.getBrushInfo().scattering));b.value=a.getBrushInfo().tip;f.setValue(~~(100*a.getBrushInfo().resat));m.setValue(~~(100*a.getBrushInfo().bleed));q.setValue(~~(100*a.getBrushInfo().spacing));r.setValue(~~(100*a.getBrushInfo().smoothing));a.on("toolChange",function(u,w){n.setValue(w.alpha);e.setValue(w.size);g.setValue(w.pressureSize);k.setValue(w.pressureAlpha);b.value=w.tip;h.setValue(w.pressureScattering);
~~(100*w.resat)!=f.value&&f.setValue(~~(100*w.resat));~~(100*w.bleed)!=m.value&&m.setValue(~~(100*w.bleed));~~(100*w.spacing)!=q.value&&q.setValue(~~(100*w.spacing));~~(100*w.scattering)!=l.value&&l.setValue(~~(100*w.scattering));~~(100*w.smoothing)!=r.value&&r.setValue(~~(100*w.smoothing))});wa(Na)("1,2,3,4,5,6,7,8,9,0",function(u,w){u=parseInt(w.shortcut,10);0==u&&(u=10);a.setAlpha(Math.round(u/10*255))});wa(Na)("{,[",function(){let u=a.getBrushSize();for(let w=c.length-1;0<=w;w--)if(u>c[w]){a.setBrushSize(c[w]);
break}});wa(Na)("},]",function(){let u=a.getBrushSize();for(let w=0;w<c.length;w++)if(u<c[w]){a.setBrushSize(c[w]);break}})}function hg(a){function c(){let e=[n.getAlpha()<<24|n.getColorRgb(),g.getAlpha()<<24|g.getColorRgb()];a.setCurGradient(e)}var d;let b=document.createElement("div");var k=new fg(a);let n=new kd(new fb(16777215&a.getCurGradient()[0]),a.getCurGradient()[0]>>>24,b),g=new kd(new fb(16777215&a.getCurGradient()[1]),a.getCurGradient()[1]>>>24,b);this.getElement=function(){return b};
b.className="chickenpaint-gradient-panel";b.style.display="none";n.on("colorChange",c);n.on("alphaChange",c);g.on("colorChange",c);g.on("alphaChange",c);(d=document.createElement("p")).textContent=Q("Gradient");b.appendChild(d);b.appendChild(k.getElement());(d=document.createElement("div")).className="chickenpaint-gradient-colors";(k=document.createElement("div")).className="chickenpaint-gradient-start-color";k.appendChild(n.getElement());d.appendChild(k);(k=document.createElement("div")).className=
"chickenpaint-gradient-end-color";k.appendChild(g.getElement());d.appendChild(k);b.appendChild(d)}function ig(a){var c={smooth:Q("Smooth"),sharp:Q("Sharp")};let d=document.createElement("div"),b=document.createElement("button"),k=document.createElement("button");var n=document.createElement("select");if(this.getElement=function(){return d},d.className="chickenpaint-transform-panel",d.style.display="none",b.type="button",k.type="button",b.className="btn btn-primary btn-block",k.className="btn btn-light btn-block",
b.textContent=Q("Apply transform"),k.textContent=Q("Cancel"),n.addEventListener("change",function(h){a.setTransformInterpolation(this.value)}),n.className="form-control chickenpaint-transform-interpolation",bf(n,c),Sd(pc(0,0).getContext("2d"))){c=document.createElement("div");let h=document.createElement("label");h.textContent=Q("Transform style");c.className="form-group";c.appendChild(h);c.appendChild(n);d.appendChild(c)}n=document.createElement("div");n.appendChild(b);n.appendChild(k);n.className=
"form-group";d.appendChild(n);let {wrapper:g,checkbox:e}=cf("chickenpaint-t-maintainAspectCheckbox",Q("Constrain"),!0);d.appendChild(g);b.addEventListener("click",function(h){a.actionPerformed({action:"CPTransformAccept"});h.preventDefault()});k.addEventListener("click",function(h){a.actionPerformed({action:"CPTransformReject"});h.preventDefault()});e.addEventListener("change",()=>{e.blur()})}function jg(a){let c=document.createElement("div"),d=document.createElement("div"),b=document.createElement("label"),
k=document.createElement("button"),n=document.createElement("button"),g=document.createElement("button");this.getElement=function(){return c};c.className="chickenpaint-selection-panel";c.style.display="none";d.className="form-group";b.textContent=Q("Selection");d.appendChild(b);k.type="button";k.className="btn btn-light btn-block";k.textContent=Q("Select all");k.addEventListener("click",function(l){a.actionPerformed({action:"CPSelectAll"});l.preventDefault()});d.appendChild(k);n.type="button";n.className=
"btn btn-light btn-block";n.textContent=Q("Deselect");n.addEventListener("click",function(l){a.actionPerformed({action:"CPDeselectAll"});l.preventDefault()});d.appendChild(n);g.type="button";g.className="btn btn-primary btn-block";g.textContent=Q("Transform");g.addEventListener("click",function(l){a.actionPerformed({action:"CPTransform"});l.preventDefault()});d.appendChild(g);c.appendChild(d);let {wrapper:e,checkbox:h}=cf("chickenpaint-s-maintainAspectCheckbox",Q("Constrain"),!1);c.appendChild(e);
h.addEventListener("change",()=>{h.blur()})}function cf(a,c,d=!1){let b=document.createElement("input");b.type="checkbox";b.id=a;b.className="form-check-input";b.checked=d;b.style.outline="none";b.style.boxShadow="none";b.tabIndex=-1;d=document.createElement("label");d.className="form-check-label";d.setAttribute("for",a);d.textContent=c;a=document.createElement("div");return a.className="form-check",a.appendChild(b),a.appendChild(d),{wrapper:a,checkbox:b}}function kg(a){var c;let d,b=document.createElement("div"),
k=document.createElement("div"),n=document.createElement("label"),g=document.createElement("button"),e=new Sb(10,800,!1,!0),h=new Sb(-180,180,!1,!1);b.className="chickenpaint-pan-panel";b.style.display="none";b.appendChild(e.getElement());k.className="form-group";n.textContent=Q("Zoom and Rotate");k.appendChild(n);k.appendChild(n);b.appendChild(k);g.type="button";g.className="btn btn-primary btn-block";g.style.outline="none";g.style.boxShadow="none";g.textContent=Q("Reset View");g.addEventListener("click",
function(f){a.actionPerformed({action:"CPResetZoomAndRotation"});f.preventDefault()});k.appendChild(g);b.appendChild(k);e.title=function(f){return Q("Zoom")+": "+f+"%"};h.title=function(f){return Q("Rotation")+": "+f+"\u00b0"};e.on("valueChange",function(f){a.zoomOnCenter(f/100)});h.on("valueChange",function(f){a.setRotationDegrees(f)});b.appendChild(e.getElement());b.appendChild(h.getElement());this.getElement=function(){return b};e.setValue(100*a.getZoom());h.setValue(a.getRotationDegrees());wa(Na)("=,-,ctrl+0",
function(){l()});document.addEventListener("wheel",f=>{f.preventDefault();l()},{passive:!1});let l=(c=()=>{e.setValue(100*a.getZoom());h.setValue(a.getRotationDegrees())},function(...f){clearTimeout(d);d=setTimeout(()=>c.apply(this,f),10)});document.addEventListener("pointerup",()=>{(a.isPanOrRotateMode()||wa(Na).isPressed("z")||wa(Na).isPressed("space")||wa(Na).isPressed("r"))&&l()})}function lg(a){a.preventDefault();a.stopPropagation()}function cc(a){let c=document.createElement("span");return c.className=
"fa "+a,c}function le(a){let c=document.createElement("span");return c.className="chickenpaint-icon chickenpaint-icon-"+a,c}function df(a,c){let d=document.createElement("div"),b=document.createElement("label");return b.tabIndex=-1,a.tabIndex=-1,d.className="form-check",a.className="form-check-input",b.className="form-check-label",b.setAttribute("for",a.id),b.appendChild(a),b.appendChild(document.createTextNode(c)),d.appendChild(a),d.appendChild(b),d}function Ed(a){function c(){let A=k.getActiveLayer();
A.getAlpha()!=l.value&&l.setValue(A.getAlpha());let F=k.getActiveLayer();for(;f.lastChild;)f.removeChild(f.lastChild);for(let J=G.LM_FIRST;J<=G.LM_LAST;J++)if(J!=G.LM_MULTIPLY2&&(J==F.blendMode||J===G.LM_PASSTHROUGH&&F instanceof Ua||J<=G.LM_LAST_CHIBIPAINT)){let N=document.createElement("option");N.appendChild(document.createTextNode(Q(G.BLEND_MODE_DISPLAY_NAMES[J])));J!==G.LM_MULTIPLY||F.blendMode===J||F.useLegacyMultiply?N.value=J:N.value=G.LM_MULTIPLY2;f.appendChild(N)}A.getBlendMode()!=parseInt(f.value,
10)&&(f.value=A.getBlendMode());A.getLockAlpha()!=r.checked&&(r.checked=A.getLockAlpha());(function(){var J=k.getActiveLayer();let N=k.isEditingMask();J={"image-layer":J instanceof sa,"layer-group":J instanceof Ua,"clipping-mask":J instanceof sa&&J.clip,"no-clipping-mask":J instanceof sa&&!J.clip,"no-clipping-mask-or-is-group":!(J instanceof sa)||!J.clip,mask:J&&null!==J.mask,"no-mask":J&&null===J.mask,"mask-enabled":J&&null!==J.mask&&J.maskVisible,"mask-disabled":J&&null!==J.mask&&!J.maskVisible,
isNotEditingMask:J&&!N,isEditingMask:J&&null!==J.mask&&N};for(let L of"mask no-mask isEditingMask isNotEditingMask clipping-mask no-clipping-mask-or-is-group image-layer layer-group".split(" "))for(let M of u.getElementsByClassName("chickenpaint-action-require-"+L))M.style.display=J[L]?"inline-block":"none";u.querySelectorAll("[data-action]").forEach(function(L){let M=L.getAttribute("data-action");L.classList.toggle("disabled",!a.isActionAllowed(M))})})()}function d(){k=this;h.resize();c()}Ib.call(this,
a,"layers","Layers",{resizeHorz:!0,resizeVert:!0});let b=this,k=a.getArtwork(),n=null,g=this.getBodyElement(),e=this.getElement(),h=new function(){function A(ya){let T=Ia.querySelectorAll(".chickenpaint-layer");return T[T.length-1-ya]}function F(ya){if(!ya)return-1;ya=ya.closest(".chickenpaint-layer");if(!ya)return-1;let T=Array.from(Ia.querySelectorAll(".chickenpaint-layer"));return T.length-1-T.indexOf(ya)}function J(){var ya;if(2===U.state){var T=e.getBoundingClientRect();var Z=!0;var va=!0;if(U.dropTarget=
function(O,da){var Ka=Ia.querySelectorAll(".chickenpaint-layer");O={layer:n[n.length-1],displayIndex:n.length-1,direction:"over"};for(var bb=0;bb<Ka.length;bb++){let Jb=Ka[Ka.length-1-bb].getBoundingClientRect();if(0===bb&&da>Jb.bottom){O=k.getLayersRoot().layers[0];O={layer:O,displayIndex:n.indexOf(O),direction:"under"};break}if(da>=Jb.top){Ka=n[bb];let Ja=Jb.bottom-Jb.top;O={layer:Ka,displayIndex:bb};Ka instanceof Ua?da>=Jb.top+.75*Ja?Ka.expanded&&0<Ka.layers.length?(O.layer=Ka.layers[Ka.layers.length-
1],O.displayIndex--,O.direction="over"):O.direction="under":da>=Jb.top+.25*Ja?Ka.expanded&&0<Ka.layers.length?(O.layer=Ka.layers[Ka.layers.length-1],O.displayIndex--,O.direction="over"):O.direction="inside":O.direction="over":O.direction=da>=Jb.top+.5*Ja?"under":"over";break}}return O.layer.parent===U.layer.parent&&("over"===O.direction||"under"===O.direction)&&(da=O.layer.parent,bb=da.indexOf(O.layer),"over"===O.direction&&da.layers[bb+1]===U.layer||"under"===O.direction&&da.layers[bb-1]===U.layer||
O.layer===U.layer)?null:U.layer instanceof Ua&&(O.layer===U.layer&&"inside"===O.direction||O.layer.hasAncestor(U.layer))?null:O}(U.dragX,U.dragY),U.dropTarget){var ca=A(U.dropTarget.displayIndex);switch(U.dropTarget.direction){case "over":case "under":Ia.appendChild(U.dropBetweenMarkerElem);Z=U.dropTarget.layer.getDepth()-1;var Pa;ca=ca.getBoundingClientRect();if("under"===U.dropTarget.direction&&U.dropTarget.layer instanceof Ua&&U.dropTarget.layer.expanded){for(Pa=U.dropTarget.displayIndex-1;0<=
Pa&&n[Pa].hasAncestor(U.dropTarget.layer);Pa--);Pa=A(Pa+1).getBoundingClientRect().bottom}else Pa=ca.bottom;Z=ca.left-T.left+(0<Z?26+16*Z:0);U.dropBetweenMarkerElem.style.left=Z+"px";U.dropBetweenMarkerElem.style.width=ca.right-T.left-Z+"px";U.dropBetweenMarkerElem.style.top=("over"===U.dropTarget.direction?ca.top-1:Pa+1)-T.top+"px";Ia.querySelectorAll(".chickenpaint-layer-drop-target").forEach(da=>da.classList.remove("chickenpaint-layer-drop-target"));Z=!1;break;case "inside":let O=Ia.querySelectorAll(".chickenpaint-layer");
O.forEach((da,Ka)=>{da.classList.toggle("chickenpaint-layer-drop-target",O.length-1-Ka===U.dropTarget.displayIndex)});va=!1}}va&&Ia.querySelectorAll(".chickenpaint-layer-drop-target").forEach(O=>O.classList.remove("chickenpaint-layer-drop-target"));Z&&(null==(ya=U.dropBetweenMarkerElem)||ya.remove());U.frameElem.style.top=U.dragY-T.top-parseInt(U.frameElem.style.height,10)/2+"px"}else null==(T=U.dropBetweenMarkerElem)||T.remove(),null==(va=U.frameElem)||va.remove()}function N(ya){let T=ya.getImageThumbnail().getAsCanvas(zb);
return T.title=Q("Image"),T.className="chickenpaint-layer-thumbnail chickenpaint-layer-image-thumbnail",T.style.maxWidth=T.width/T.height*25+"px",ya!=k.getActiveLayer()||k.isEditingMask()||(T.className+=" active"),T}function L(ya){let T=ya.getMaskThumbnail().getAsCanvas(zb);(T.title=Q("Layer mask"),T.className="chickenpaint-layer-thumbnail chickenpaint-layer-mask-thumbnail",T.style.maxWidth=T.width/T.height*25+"px",ya==k.getActiveLayer()&&k.isEditingMask()&&(T.className+=" active"),ya.maskVisible)||
(T.className+=" disabled",ya=T.getContext("2d"),ya.strokeStyle="red",ya.lineWidth=3,ya.moveTo(5,5),ya.lineTo(T.width-5,T.height-5),ya.moveTo(T.width-5,5),ya.lineTo(5,T.height-5),ya.stroke());return T}function M(ya,T){let Z=document.createElement("div");var va=document.createElement("div");let ca=document.createElement("div");var Pa=document.createElement("div");let O=document.createElement("div"),da=document.createElement("div"),Ka=document.createElement("div");if(Z.className="chickenpaint-layer list-group-item",
T==k.getActiveLayer()&&(Z.className+=" active"),va.className="chickenpaint-layer-eye",T.ancestorsAreVisible()||(va.className+=" chickenpaint-layer-eye-hidden-ancestors"),va.style.marginRight=2+16*(T.getDepth()-1)+"px",T.visible?(Z.className+=" chickenpaint-layer-visible",va.appendChild(cc("icon-eye"))):(Z.className+=" chickenpaint-layer-hidden",va.appendChild(cc("icon-eye-slash"))),Z.appendChild(va),ca.className="chickenpaint-layer-description",T instanceof sa){if(T.clip&&(Z.className+=" chickenpaint-layer-clipped",
Pa.appendChild(cc("icon-level-down-alt fa-flip-horizontal"))),T.lockAlpha)va=le("lock-alpha"),va.title=Q("Transparency locked"),da.appendChild(va)}else T instanceof Ua&&(Z.className+=" chickenpaint-layer-group",T.expanded?(Z.className+=" chickenpaint-layer-group-expanded",Pa.appendChild(cc("icon-folder-open chickenpaint-layer-group-toggle"))):(Z.className+=" chickenpaint-layer-group-collapsed",Pa.appendChild(cc("icon-folder chickenpaint-layer-group-toggle"))));Pa.childNodes.length&&(Pa.className=
"chickenpaint-layer-icons",Z.appendChild(Pa));try{T instanceof sa&&Z.appendChild(N(T)),T.mask&&Z.appendChild(L(T))}catch(bb){console.log("Failed to create layer thumb")}Pa=T.name&&0<T.name.length?T.name:"(unnamed "+(T instanceof Ua?"group":"layer")+")";return O.innerText=Pa,O.setAttribute("title",Pa),O.className="chickenpaint-layer-name",Ka.innerText=Q(G.BLEND_MODE_DISPLAY_NAMES[T.blendMode])+": "+T.alpha+"%",Ka.className="chickenpaint-layer-blend",ca.appendChild(O),ca.appendChild(Ka),Z.appendChild(ca),
da.className="chickenpaint-layer-status",Z.appendChild(da),Z.setAttribute("data-display-index",""+ya),Z}function X(ya){if(-1<ya){let T=n[ya];ya=A(ya);T&&ya&&m.show(T,ya)}}function fa(ya){2===U.state?(U.layerElem.classList.remove("chickenpaint-layer-dragging"),U.dropTarget&&("inside"===U.dropTarget.direction?a.actionPerformed({action:"CPRelocateLayer",layer:U.layer,toGroup:U.dropTarget.layer,toIndex:U.dropTarget.layer.layers.length}):a.actionPerformed({action:"CPRelocateLayer",layer:U.layer,toGroup:U.dropTarget.layer.parent,
toIndex:U.dropTarget.layer.parent.indexOf(U.dropTarget.layer)+ +("over"===U.dropTarget.direction)})),U.dropTarget=null,U.state=0,J()):U.state=0;db&&(clearTimeout(db),db=null);Ia.releasePointerCapture(ya.pointerId);Ia.removeEventListener("pointermove",H);Ia.removeEventListener("pointerup",fa)}function pa(){U.state=2;U.frameElem=document.createElement("div");U.frameElem.className="chickenpaint-layer-drag-frame";U.frameElem.style.width=U.layerElem.offsetWidth+"px";U.frameElem.style.height=U.layerElem.offsetHeight+
"px";U.dropBetweenMarkerElem=document.createElement("div");U.dropBetweenMarkerElem.className="chickenpaint-layer-drop-between-mark";U.layerElem.classList.add("chickenpaint-layer-dragging");Ia.appendChild(U.frameElem)}function H(ya){ya=ya.clientY;switch(U.state){case 3:if(5<Math.abs(ya-U.dragY))U.state=4;else break;case 4:Ia.scrollTop=U.initialScrollTop+U.dragY-ya;break;case 1:if(5<Math.abs(ya-U.dragY))pa();else break;case 2:U.dragY=ya,J()}}function ja(ya,T,Z){try{let va=ya.querySelector("."+(Z?"chickenpaint-layer-mask-thumbnail":
"chickenpaint-layer-image-thumbnail"));va&&va.replaceWith(Z?L(T):N(T))}catch(va){console.log("Error rebuilding thumbnail: ",va)}}let U={state:0,layer:null,layerElem:null,dragX:0,dragY:0,initialScrollTop:0,dropTarget:null,dropBetweenMarkerElem:null,frameElem:null},Za=document.createElement("div"),Ia=document.createElement("div"),zb=0,Cb=!1,db=null;for(let ya of(this.buildLayers=function(){let T=(n=k.getLayersRoot().getLinearizedLayerList(!0)).map((va,ca)=>M(ca,va)),Z=document.createDocumentFragment();
Ia.innerHTML="";for(let va=T.length-1;0<=va;va--)Z.appendChild(T[va]);Ia.appendChild(Z);J()},this.layerChanged=function(T){let Z=n.indexOf(T),va=A(Z);!va||T instanceof Ua&&(T.expanded!=va.classList.contains("chickenpaint-layer-group-expanded")||T.visible!=va.classList.contains("chickenpaint-layer-visible"))?this.buildLayers():va.replaceWith(M(Z,T))},this.setRotation90=function(T){if(zb!==T)for(zb=T,T=0;T<n.length;T++){let Z=n[T],va=A(T);va&&(ja(va,Z,!1),Z.mask&&ja(va,Z,!0))}},this.layerImageThumbChanged=
function(T){let Z=A(n.indexOf(T));Z&&ja(Z,T,!1)},this.layerMaskThumbChanged=function(T){let Z=A(n.indexOf(T));Z&&(T.mask?ja(Z,T,!0):(T=Z.querySelector(".chickenpaint-layer-mask-thumbnail"))&&T.remove())},this.activeLayerChanged=function(T,Z){Ia.querySelectorAll(".active").forEach(ca=>{ca.classList.remove("active")});var va=A(n.indexOf(T));va.classList.add("active");T=va.querySelector(".chickenpaint-layer-image-thumbnail");va=va.querySelector(".chickenpaint-layer-mask-thumbnail");T&&T.classList.toggle("active",
!Z);va&&va.classList.toggle("active",Z)},this.resize=function(){b.dismissNotification();this.buildLayers()},this.getElement=function(){return Za},this.revealLayer=function(T){T=A(T);let Z=T.getBoundingClientRect(),va=Ia.getBoundingClientRect();return Ia.scrollTop=Math.max(Math.min(Math.max(Ia.scrollTop,Ia.scrollTop+Z.bottom-va.bottom),Ia.scrollTop+Z.top-va.top),0),T},e.id="chickenpaint-layer-pop",Za.className="chickenpaint-layers-widget",Za.addEventListener("contextmenu",T=>T.preventDefault(),!0),
Ia.className="list-group",Ia.addEventListener("dblclick",function(T){0===T.button&&T.target.closest(".chickenpaint-layer-description")&&!T.target.closest("input")&&(X(F(T.target)),T.preventDefault())}),Ia.addEventListener("pointerdown",function(T){let Z=F(T.target.closest(".chickenpaint-layer"));if(-1!==Z){let va=n[Z];if(0===T.button&&T.target.closest(".chickenpaint-layer-eye"))a.actionPerformed({action:"CPSetLayerVisibility",layer:va,visible:!va.visible});else if(0===T.button&&va instanceof Ua&&
T.target.closest(".chickenpaint-layer-group-toggle"))a.actionPerformed({action:"CPExpandLayerGroup",group:va,expand:!va.expanded});else{let ca=k.getActiveLayer()!==va;if(Cb=null!==T.target.closest(".chickenpaint-layer-mask-thumbnail")||va instanceof Ua&&null!==va.mask&&ca,0===T.button&&T.shiftKey&&!T.ctrlKey&&!T.metaKey&&Cb)a.actionPerformed({action:"CPSetMaskVisible",layer:va,visible:!va.maskVisible});else{let Pa,O;(Pa=0===T.button||ca?Cb:k.isEditingMask(),O=k.isEditingMask()!==Pa,(ca||O)&&a.actionPerformed({action:"CPSetActiveLayer",
layer:va,mask:Pa}),Pa&&T.altKey)?a.actionPerformed({action:"CPToggleMaskView"}):Pa&&!T.shiftKey&&(T.ctrlKey||T.metaKey)?a.actionPerformed({action:"CPApplyLayerMask"}):Pa&&T.shiftKey&&(T.ctrlKey||T.metaKey)?a.actionPerformed({action:"CPRemoveLayerMask"}):0===T.button?("pen"===T.pointerType||"touch"===T.pointerType?(U.state=3,U.initialScrollTop=Ia.scrollTop,db&&clearTimeout(db),db=setTimeout(()=>{3===U.state&&(pa(),U.dragY=T.clientY,J())},800)):U.state=1,U.dropTarget=null,U.layer=va,U.layerElem=A(Z),
U.dragX=T.clientX,U.dragY=T.clientY,Ia.setPointerCapture(T.pointerId),Ia.addEventListener("pointermove",H),Ia.addEventListener("pointerup",fa)):2===T.button&&!ca&&(T.preventDefault(),-1!=F(T.target)&&(X(F(T.target)),T.preventDefault()))}}}}),Ia.setAttribute("touch-action","none"),["ontouchstart","ontouchmove","ontouchend","ontouchcancel"]))Ia.addEventListener(ya,lg);Za.appendChild(Ia)},l=new Sb(0,100,!1,!1,208),f=document.createElement("select"),m=new function(){let A=null,F="",J=document.createElement("input"),
N=this;this.hide=function(){A=null;let L=J.parentNode;L&&(L.removeChild(J),L.textContent=F)};this.renameAndHide=function(){A&&A.name!==J.value&&a.actionPerformed({action:"CPSetLayerName",layer:A,name:J.value});this.hide()};this.show=function(L,M){J.value=F=(A=L).name;(L=M.querySelector(".chickenpaint-layer-name"))&&L.parentNode&&(M=L.firstChild)&&M.nodeType===Node.TEXT_NODE&&(L.removeChild(M),L.appendChild(J));J.select()};J.type="text";J.className="chickenpaint-layer-rename form-control input-sm";
J.addEventListener("keydown",function(L){L.stopPropagation()});J.addEventListener("keydown",function(L){"Enter"===L.key&&N.renameAndHide();L.stopPropagation()});J.addEventListener("keyup",function(L){"Escape"===L.key&&N.hide();L.stopPropagation()});J.addEventListener("blur",function(L){A&&N.renameAndHide()})},q=document.createElement("input"),r=document.createElement("input"),t=!1,u,w=this.setSize,C=this.setWidth,D=this.setHeight;this.setSize=function(A,F){w.call(this,A,F);this.dismissNotification();
l.resize()};this.setWidth=function(A){C.call(this,A);l.resize();h.resize()};this.setHeight=function(A){D.call(this,A);h.resize()};this.setRotation90=function(A){h.setRotation90(A)};this.dismissNotification=function(){document.querySelectorAll(".chickenpaint-layer[aria-describedby], .chickenpaint-slider[aria-describedby]").forEach(A=>{(A=Tb.Popover.getInstance(A))&&A.dispose()});t&&(clearTimeout(t),t=!1)};this.showNotification=(A,F,J)=>{let N=n.indexOf(A);A=k.getActiveLayer()==A&&"opacity"==J?l.getElement():
h.revealLayer(N);this.dismissNotification();(new Tb.Popover(A,{html:!1,content:F,placement:"left",trigger:"manual",fallbackPlacement:[],boundary:"window",container:b.getElement()})).show();t=setTimeout(()=>{t=!1;this.dismissNotification()},Math.max(Math.round(70*F.length),3E3))};f.className="form-control form-control-sm";f.tabIndex=-1;f.title=Q("Layer blending mode");f.addEventListener("change",function(A){a.actionPerformed({action:"CPSetLayerBlendMode",blendMode:parseInt(f.value,10)});f.blur()});
g.appendChild(f);l.title=function(A){return Q("Opacity")+": "+A+"%"};l.on("valueChange",function(A){a.actionPerformed({action:"CPSetLayerAlpha",alpha:A})});g.appendChild(l.getElement());q.id="chickenpaint-chk-sample-all-layers";q.type="checkbox";q.addEventListener("click",function(A){k.setSampleAllLayers(q.checked);document.activeElement.blur()});g.appendChild(df(q,Q("Sample all layers")));r.id="chickenpaint-chk-lock-alpha";r.type="checkbox";r.addEventListener("click",function(A){a.actionPerformed({action:"CPSetLayerLockAlpha",
lock:r.checked});document.activeElement.blur()});g.appendChild(df(r,Q("Lock transparency")));g.appendChild(h.getElement());u=function(){var A=[{title:"Add layer",icon:cc("icon-file"),action:"CPAddLayer"},{title:"Add group",icon:cc("icon-folder"),action:"CPAddGroup"},{title:"Merge down",icon:cc("icon-download_FILL"),action:"CPLayerMergeDown",require:["image-layer"]},{title:"Merge group",icon:cc("icon-collapse_all_FILL"),action:"CPGroupMerge",require:["layer-group"]},{title:"Clip to the layer below",
icon:cc("icon-level-down-alt fa-flip-horizontal"),action:"CPCreateClippingMask",require:"no-clipping-mask-or-is-group"},{title:"Unclip from the layer below",icon:cc("icon-level-down-alt fa-flip-horizontal"),action:"CPReleaseClippingMask",require:"clipping-mask"},{title:"Add layer mask",icon:le("mask"),action:"CPAddLayerMask",require:["no-mask"]},{title:"Apply mask",icon:le("mask"),action:"CPApplyLayerMask",require:["mask"]},{title:"Duplicate",icon:cc("icon-clone"),action:"CPLayerDuplicate"},{title:"Delete layer mask",
icon:cc("icon-trash"),action:"CPRemoveLayerMask",require:"isEditingMask"},{title:"Delete layer",icon:cc("icon-trash"),action:"CPRemoveLayer",require:"isNotEditingMask"}];let F=document.createElement("ul");for(let J of(F.className="chickenpaint-layer-buttons list-unstyled",A))A=document.createElement("li"),A.setAttribute("data-action",J.action),A.className="chickenpaint-small-toolbar-button "+(J.require?"chickenpaint-action-require-"+J.require:""),A.title=Q(J.title),A.appendChild(J.icon),A.addEventListener("click",
function(){a.actionPerformed({action:J.action})}),F.appendChild(A);return F}();g.appendChild(u);k.on("changeActiveLayer",function(A,F,J){h.activeLayerChanged(F,J);c()});k.on("changeLayer",function(A){k=this;b.dismissNotification();h.layerChanged(A);c()});k.on("changeStructure",d);k.on("changeLayerMaskThumb",function(A){k=this;h.layerMaskThumbChanged(A)});k.on("changeLayerImageThumb",function(A){k=this;h.layerImageThumbChanged(A)});a.on("layerNotification",this.showNotification.bind(this));d.call(k)}
function mg(){this.table=new Uint8Array(256);this.loadIdentity=function(){for(var a=0;256>a;a++)this.table[a]=a};this.loadBrightnessContrast=function(a,c){c=0<c?1/(1.0001-c):1+c;a=.5-.5*c+a;for(var d=0;256>d;d++)this.table[d]=Math.min(255,Math.max(~~(255*(d/255*c+a)),0))};this.invert=function(){for(var a=0;256>a;a++)this.table[a]=255-this.table[a]}}function ef(a,c){let d=document.createElement("div"),b=document.createElement("label");return d.className="form-check",a.className="form-check-input",
b.className="form-check-label",b.setAttribute("for",a.id),b.appendChild(a),b.appendChild(document.createTextNode(c)),d.appendChild(a),d.appendChild(b),d}function Fd(a){function c(N){for(let L=0;L<N.length;L++){let M=new e(N[L],32,32);M.on("click",function(){q=this.texture;g()});A.appendChild(M.getElement())}}function d(N){let L=new Ea(N,N,8);for(let M=1;M<N*N;M++)L.data[M]=255;return L}function b(N){let L=2*N,M=new Ea(L,L,8);for(let X=0;X<L;X++)for(let fa=0;fa<L;fa++)M.data[X+fa*L]=255*(0!=(~~(X/
N)+~~(fa/N))%2);return M}function k(N,L){let M=new Ea(L,L,8);for(let X=0;X<L*L;X++)~~(X%L)>=N&&(M.data[X]=255);return M}function n(N,L){let M=new Ea(L,L,8);for(let X=0;X<L*L;X++)X/L>=N&&(M.data[X]=255);return M}function g(){if(null!=q){r=q.clone();t&&r.mirrorHorizontally();let N=new mg;N.loadBrightnessContrast(w,C);u&&N.invert();r.applyLUT(N)}else r=null;a.getArtwork().setBrushTexture(r);null!=D&&D.updateTexture()}function e(N,L,M){let X=document.createElement("canvas"),fa=X.getContext("2d"),pa=this;
this.setTexture=function(H){this.texture=H;this.paint()};this.getElement=function(){return X};this.paint=function(){null!=this.texture?fa.fillStyle=fa.createPattern(this.texture.getAsCanvas(),"repeat"):fa.fillStyle="white";fa.fillRect(0,0,X.width,X.height)};X.addEventListener("click",function(){pa.emit("click")});X.width=L;X.height=M;this.setTexture(N)}var h;let l,f,m;Ib.call(this,a,"textures","Textures");let q,r,t=!1,u=!1,w=0,C=0,D,A=document.createElement("div"),F=this.getBodyElement();e.prototype=
Object.create(wa(Db).prototype);e.prototype.constructor=e;D=new function(){function N(){pa.checked=u;H.checked=t;ja.setValue(100*w+100);U.setValue(100*C+100)}let L,M,X,fa=document.createElement("div"),pa=document.createElement("input"),H=document.createElement("input"),ja=new Sb(0,200,!0),U=new Sb(0,200,!0),Za=new e(null,64,64),Ia=document.createElement("button"),zb,Cb=new Tb.Popover(Ia,{html:!0,content:()=>zb,trigger:"manual",placement:"right",container:F});this.updateTexture=function(){Ia.disabled=
null==r;Za.setTexture(r)};this.getElement=function(){return fa};fa.className="chickenpaint-texture-options";fa.appendChild(Za.getElement());Ia.type="button";Ia.className="btn btn-light btn-sm";Ia.setAttribute("data-bs-toggle","popover");Ia.setAttribute("data-bs-placement","right");Ia.textContent=Q("Customize");(L=document.createElement("div")).className="chickenpaint-texture-controls";pa.id="chickenpaint-chk-texture-invert";pa.type="checkbox";pa.addEventListener("click",function(db){u=this.checked;
g()});L.appendChild(ef(pa,Q("Inverse")));H.id="chickenpaint-chk-texture-mirror";H.type="checkbox";H.addEventListener("click",function(db){t=this.checked;g()});L.appendChild(ef(H,Q("Mirror")));ja.title=function(db){return Q("Brightness")+": "+(db-100)+"%"};ja.on("valueChange",function(db){w=(db-100)/100;g()});L.appendChild(ja.getElement());U.title=function(db){return Q("Contrast")+": "+(db-100)+"%"};U.on("valueChange",function(db){C=(db-100)/100;g()});L.appendChild(U.getElement());M=document.createElement("button");
X=document.createElement("button");M.textContent="Ok";M.className="btn btn-primary btn-sm";M.type="button";M.addEventListener("click",function(db){Cb.hide()});L.appendChild(M);L.appendChild(document.createTextNode(" "));X.textContent="Reset";X.className="btn btn-secondary btn-sm";X.type="button";X.addEventListener("click",function(db){C=w=0;u=t=!1;N();g()});L.appendChild(X);N();zb=L;Ia.addEventListener("click",function(){Cb.toggle()});fa.appendChild(Ia);this.updateTexture()};F.appendChild(D.getElement());
A.className="chickenpaint-texture-swatches";F.appendChild(A);c((h=[null],(l=new Ea(2,2,8)).data[0]=255,l.data[3]=255,h.push(l),h.push(d(2)),h.push(d(3)),h.push(d(4)),h.push(d(6)),h.push(d(8)),h.push(k(1,2)),h.push(k(2,4)),h.push(n(1,2)),h.push(n(2,4)),h.push(b(2)),h.push(b(4)),h.push(b(8)),h.push(b(16)),h.push(function(N){let L=new Ea(256,N,8);for(let M=0;M<N*N;M++)L.data[M]=Math.max(0,Math.min(255,Math.floor(.65*(.65*Math.floor(256*Math.random())-128)+128)));return L}(256)),h));h=a.getResourcesRoot()+
"gfx/textures32.png?20241024.1";var J=function(N){c(N)};f=new Image;m=[];f.onload=function(){var N=document.createElement("canvas");let L=N.getContext("2d",{willReadFrequently:!0});N.width=f.width;N.height=f.height;for(N=0;2>N;N++){L.drawImage(f,0,32*N,32,32,0,0,32,32);try{let M=L.getImageData(0,0,32,32),X=new Ea(32,32,8);for(let fa=0;1024>fa;fa++)X.data[fa]=M.data[4*fa];m.push(X)}catch(M){console.log(M)}}J(m)};f.src=h}function Gd(a){function c(w){let C=document.createElement("div"),D=document.createElement("a"),
A=document.createElement("ul"),F=document.createElement("a"),J=document.createElement("a"),N=this;this.getElement=function(){return C};this.setColor=function(M){D.setAttribute("data-color",M);var X=D.style;for(M=""+Number(M).toString(16);6>M.length;)M="0"+M;X.backgroundColor="#"+M};this.setColor(w);D.href="#";D.className="chickenpaint-color-swatch dropdown-toggle";F.className="dropdown-item";F.href="#";F.textContent=Q("Remove");F.addEventListener("click",function(M){M.preventDefault();C.remove();
f=!0});J.className="dropdown-item";J.href="#";J.textContent=Q("Replace with current color");J.addEventListener("click",function(M){M.preventDefault();N.setColor(a.getCurColor().getRgb());f=!0});A.className="dropdown-menu";w=document.createElement("li");let L=document.createElement("li");w.appendChild(F);L.appendChild(J);A.appendChild(w);A.appendChild(L);C.className="chickenpaint-color-swatch-wrapper";C.appendChild(D);C.appendChild(A)}function d(w){w=new c(w);m.appendChild(w.getElement())}function b(w){let C=
document.createElement("span");return C.className="fa icon-"+w,C}var k;let n;let g,e,h;Ib.call(this,a,"swatches","Color swatches");var l=[16777215,0,16711680,65280,255,16776960];let f=!1,m=document.createElement("ul"),q=document.createElement("div"),r,t=this;this.getSwatches=function(){let w=m.querySelectorAll(".chickenpaint-color-swatch"),C=Array(w.length);for(let D=0;D<w.length;D++)C[D]=parseInt(w[D].getAttribute("data-color"),10);return C};this.setSwatches=function(w){for(;m.lastChild;)m.removeChild(m.lastChild);
for(let C=0;C<w.length;C++)d(w[C]);f=!0};this.isModified=function(){return f};m.className="chickenpaint-color-swatches list-unstyled";for(k=0;k<l.length;k++)m.appendChild((new c(l[k])).getElement());m.addEventListener("click",function(w){let C=w.target;/^<a data-color=/i.test(C.outerHTML)&&/chickenpaint-color-swatch/.test(C.className)&&0==w.button&&void 0!==C.getAttribute("data-color")&&(a.setCurColor(new fb(parseInt(C.getAttribute("data-color"),10))),w.stopPropagation(),w.preventDefault())});m.addEventListener("contextmenu",
function(w){let C=w.target;if(/^<a data-color=/i.test(C.outerHTML)&&/chickenpaint-color-swatch/.test(C.className)){w.preventDefault();var D=new Tb.Dropdown(C);D.toggle();document.addEventListener("click",function J(F){D.hide();document.removeEventListener("click",J)})}});this.getBodyElement().appendChild(m);l=document.createElement("button");k=document.createElement("button");n=document.createElement("ul");var u=document.createElement("a");g=document.createElement("a");k.type="button";k.title=Q("Add the current brush color as a new swatch");
k.className="btn chickenpaint-small-toolbar-button chickenpaint-color-swatch-add";k.appendChild(b("plus"));l.type="button";l.className="btn dropdown-toggle chickenpaint-small-toolbar-button chickenpaint-color-swatch-settings";l.setAttribute("data-bs-toggle","dropdown");l.appendChild(b("cog"));u.className="dropdown-item";u.href="#";u.textContent=Q("Save swatches to your computer...");u.addEventListener("click",function(w){w.preventDefault();w=new Blob([(new Tc).write(t.getSwatches())],{type:"application/octet-stream"});
wa(hd).saveAs(w,"oekakiswatches.aco")});g.className="dropdown-item";g.href="#";g.textContent=Q("Load swatches from your computer...");g.addEventListener("click",function(w){w.preventDefault();r.onchange=function(){var C=this.files;if(!(1>C.length)){C=C[0];var D=new FileReader;D.onload=function(){let A=(new Tc).read(this.result);null!=A&&0<A.length?t.setSwatches(A):alert(Q("The swatches could not be read, did you select an .aco file?"))};D.readAsArrayBuffer(C)}};r.click()});n.className="dropdown-menu";
e=document.createElement("li");h=document.createElement("li");e.appendChild(u);h.appendChild(g);n.appendChild(e);n.appendChild(h);(u=document.createElement("div")).className="btn-group";u.appendChild(l);u.appendChild(n);k.addEventListener("click",function(w){d(a.getCurColor().getRgb());f=!0});q.className="chickenpaint-color-swatches-buttons";window.File&&window.FileReader&&window.FileList&&window.Blob&&((r=document.createElement("input")).type="file",r.multiple=!1,r.style.display="none",q.appendChild(u),
q.appendChild(r));q.appendChild(k);this.getBodyElement().appendChild(q)}function Hd(a){function c(){let f=g.closest(".chickenpaint").querySelector(".chickenpaint-canvas");return{width:f.offsetWidth,height:f.offsetHeight}}function d(f,m){let q=f.getElement();m?g.contains(q)||g.appendChild(q):g.contains(q)&&g.removeChild(q);e.emitEvent("paletteVisChange",[f.name,m])}let b={tool:new Ad(a),misc:new Bd(a),stroke:new Cd(a),color:new Dd(a),brush:new Vc(a),layers:new Ed(a),textures:new Fd(a),swatches:new Gd(a)},
k={tool:!1,color:!1,misc:!1};var n={color:!0,textures:!0,layers:!0};let g=document.createElement("div"),e=this,h=[],l=[];for(let f in this.palettes=b,this.showPaletteByName=function(m,q){(m=b[m])&&d(m,q)},this.togglePalettes=function(){if(0===l.length)g.querySelectorAll(".chickenpaint-palette").forEach(function(m){e.showPaletteByName(m.getAttribute("data-paletteName"),!1);l.push(m)});else{for(let m=0;m<l.length;m++)e.showPaletteByName(l[m].getAttribute("data-paletteName"),!0);l=[]}},this.constrainPalettes=
function(){let m=c();for(var q in b){let r=b[q];r.getX()+r.getWidth()/2>m.width&&r.setLocation(m.width-r.getWidth(),r.getY());r.getY()+r.getHeight()/2>m.height&&r.setLocation(r.getX(),m.height-r.getHeight())}q=0<m.width-b.tool.getWidth()-b.misc.getWidth()-b.stroke.getWidth()-b.color.getWidth()-b.brush.getWidth()-15;b.swatches.getX()+b.swatches.getWidth()==b.brush.getX()+b.brush.getWidth()&&20>Math.abs(b.swatches.getY()-b.brush.getY())&&b.swatches.setLocation(b.brush.getX()-b.swatches.getWidth()-(q?
5:1),0);b.layers.getY()+b.layers.getHeight()>m.height&&b.layers.setHeight(Math.max(m.height-b.layers.getY(),200))},this.arrangePalettes=function(){let m=c();if(a.getSmallScreenMode()){b.tool.setLocation(0,0);b.misc.setLocation(b.tool.getX()+b.tool.getWidth()+1,0);var q=16>=m.width-(b.tool.getWidth()+b.misc.getWidth()+b.brush.getWidth())?b.misc.getY()+b.misc.getHeight()+1:0;b.brush.setLocation(m.width-b.brush.getWidth()-15,q);b.textures.setWidth(m.width-b.textures.getX());b.layers.setLocation(b.brush.getX()+
b.brush.getWidth()-b.layers.getWidth(),b.textures.getY()-b.layers.getHeight());q=Math.max(b.textures.getY()-330-1,370);b.layers.setHeight(q);b.layers.setWidth(218);b.stroke.setLocation(b.misc.getX(),b.misc.getY()+b.misc.getHeight()+1);b.swatches.setLocation(b.stroke.getX(),b.stroke.getY()+b.stroke.getHeight()+1)}else{q=0<m.width-b.tool.getWidth()-b.misc.getWidth()-b.stroke.getWidth()-b.color.getWidth()-b.brush.getWidth()-15;b.brush.setLocation(m.width-b.brush.getWidth()-15,0);var r=b.brush.getY()+
b.brush.getHeight();r=300<m.height-r?r+2:r;b.layers.setSize(b.brush.getWidth()+30*!!q,m.height-r);b.layers.setLocation(b.brush.getX()+b.brush.getWidth()-b.layers.getWidth(),r);b.tool.setLocation(0,0);b.misc.setLocation(b.tool.getX()+b.tool.getWidth()+(q?5:1),0);q?b.stroke.setLocation(b.misc.getX()+b.misc.getWidth()+(q?5:1),0):b.stroke.setLocation(b.misc.getX(),b.misc.getY()+b.misc.getHeight()+1);b.swatches.setLocation(Math.max(b.brush.getX()-b.swatches.getWidth()-(q?5:1),b.tool.getX()+b.tool.getWidth()),
0);b.textures.setWidth(Math.min(b.layers.getX()-b.textures.getX(),490))}b.textures.setLocation(b.color.getX()+b.color.getWidth()+4,m.height-b.textures.getHeight());b.color.setLocation(0,Math.max(b.tool.getY()+b.tool.getHeight(),m.height-b.color.getHeight()))},a.on("smallScreen",function(m){if(m)for(let q in b)b[q].toggleCollapse(m&&(!(q in k)||k[q]))}),this.getElement=function(){return g},g.className="chickenpaint-palettes",b){let m=b[f],q=m.getElement();m.on("paletteVisChange",function(){d(this,
!1)});f in n&&m.setCollapseDownwards(!0);q.setAttribute("data-paletteName",f);h.push(q)}for(let f in b)n=b[f].getElement(),g.appendChild(n)}function ng(a,c){function d(h){let l,f=h.dataset.action,m="true"===h.dataset.checkbox;a.isActionAllowed(f)&&(m?(h.classList.toggle("selected"),l=h.classList.contains("selected")):l=!1,a.actionPerformed({action:f,checkbox:m,selected:l}))}let b=document.createElement("nav");b.className="navbar navbar-expand-md bg-light";b.innerHTML='\n    <div class="navbar-upper">\n      <a class="navbar-brand" href="#">ChickenPaint Be</a>\n      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#chickenpaint-main-menu-content" aria-controls="chickenpaint-main-menu-content" aria-expanded="false" aria-label="Toggle main menu">\n        <span class="navbar-toggler-icon"></span>\n      </button>\n    </div>\n    <div class="collapse navbar-collapse" id="chickenpaint-main-menu-content">\n      <div class="navbar-nav"></div>\n    </div>\n    <div class="widget-nav" id="chickenpaint-palette-toggler-content"></div>\n  ';
let k=navigator.userAgent.toLowerCase().includes("mac os");b.addEventListener("touchmove",h=>h.preventDefault(),{passive:!1});b.addEventListener("click",h=>{let l=h.target.closest("a:not(.dropdown-toggle)");l&&(d(l),h.preventDefault())});var n=b.querySelector(".navbar-nav");ff.forEach(h=>{function l(){setTimeout(()=>{let t=document.activeElement;t instanceof HTMLElement&&(t.matches('[data-bs-toggle="dropdown"]')||t.matches(".dropdown-item")||t.closest(".dropdown-menu"))&&t.blur()},10)}var f,m;let q=
document.createElement("div");q.className="nav-item dropdown";q.innerHTML=`
        <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">${Q(h.name)}</a>
        <ul class="dropdown-menu"></ul>
      `;let r=q.querySelector(".dropdown-menu");null==(f=q.querySelector(".dropdown-toggle"))||f.addEventListener("show.bs.dropdown",()=>{l();q.querySelectorAll("[data-action]").forEach(u=>{let w=a.isActionAllowed(u.dataset.action);u.classList.toggle("disabled",!w);"true"===u.dataset.hideIfNotAvailable&&u.classList.toggle("hidden",!w)});q.querySelectorAll(".dropdown-divider").forEach(u=>u.classList.remove("hidden"));let t=null;Array.from(q.querySelectorAll(".dropdown-item:not(.hidden), .dropdown-divider:not(.hidden)")).forEach((u,
w)=>{u.classList.contains("dropdown-divider")?0===w||t?u.classList.add("hidden"):t=u:t=null});t&&t.classList.add("hidden")});null==(m=q.querySelector(".dropdown-toggle"))||m.addEventListener("hide.bs.dropdown",()=>{l()});h.children.forEach(t=>{let u;if("-"===t.name)t=document.createElement("hr"),t.className="dropdown-divider",null==r||r.appendChild(t);else if(t.action&&a.isActionSupported(t.action)){if("CPSend"!==t.action||a.isActionSupported("CPContinue")||(t.name=Q("Post Oekaki"),t.shortcut="ctrl+p"),
(u=document.createElement("a")).className="dropdown-item",u.href="#",u.dataset.action=t.action,u.innerHTML=`<span>${Q(t.name)}</span>`,t.checkbox&&(u.dataset.checkbox="true",t.checked&&u.classList.add("selected")),t.hideIfNotAvailable&&(u.dataset.hideIfNotAvailable="true"),t.title&&(u.title=Q(t.title)),t.shortcut){k&&(t.shortcut=t.shortcut.replace(/SHIFT/im,"\u21e7").replace(/ALT/im,"\u2325").replace(/CTRL/im,"\u2318"));let C=document.createElement("small");C.className="chickenpaint-shortcut";var w=
(w=t.shortcut).toUpperCase().replace(/(,.+)$/,"").replace("=","+");C.textContent=k?w.replace(/([^+])\+/g,"$1"):w.replace(/([^+])\+/g,"$1 ");u.appendChild(C);wa(Na)(t.shortcut,D=>(d(u),D.preventDefault(),D.stopPropagation(),!1))}t=document.createElement("li");t.appendChild(u);r.appendChild(t)}});n.appendChild(q)});var g=b.querySelector(".widget-nav");ff[5].children.filter(h=>h.mnemonic&&a.isActionSupported(h.action)).forEach(h=>{let l=document.createElement("button");l.className="widget-toggler selected";
l.type="button";l.dataset.action=h.action;l.dataset.checkbox="true";l.dataset.selected=(!h.checked).toString();l.innerHTML=`<span>${h.mnemonic}</span>`;l.addEventListener("click",f=>{d(l);f.preventDefault()});g.appendChild(l)});c.getPaletteManager().on("paletteVisChange",function(h,l){h="CPPal"+h.charAt(0).toUpperCase()+h.slice(1);let f=document.getElementById("chickenpaint-palette-toggler-content");[...((null==f?void 0:f.querySelectorAll(`[data-action="${h}"]`))||[]),...((null==b?void 0:b.querySelectorAll(`[data-action="${h}"]`))||
[])].forEach(m=>{m.classList.toggle("selected",l)})});let e=b.querySelector(".dropdown-item[data-action=CPFullScreen]");a.on("fullScreen",h=>null==e?void 0:e.classList.toggle("selected",h));null==e||e.classList.toggle("selected",a.isFullScreen());this.getElement=()=>b}function Id(a,c){let d=document.createElement("div"),b=new zd(a),k=new Hd(a),n,g=!1,e=this;this.togglePalettes=function(){k.togglePalettes()};this.arrangePalettes=function(){setTimeout(k.arrangePalettes.bind(k),0)};this.constrainPalettes=
function(){k.constrainPalettes()};this.showPalette=function(m,q){k.showPaletteByName(m,q)};this.getSwatches=function(){return k.palettes.swatches.getSwatches()};this.setSwatches=function(m){k.palettes.swatches.setSwatches(m)};this.getPaletteManager=function(){return k};this.setRotation90=function(m){b.setRotation(m*Math.PI/2);k.palettes.layers.setRotation90(m)};this.setFullScreenMode=function(m){g!==m&&(g=m,e.resize(),e.arrangePalettes())};this.resize=function(m=!0){let q=window.innerHeight,r=n.getElement().getBoundingClientRect().height;
b.resize(g?q-r:Math.min(Math.max(q-r-65,500),850),!1);m&&e.constrainPalettes()};n=new ng(a,this);this.getMainMenu=function(){return n};c.appendChild(n.getElement());d.className="chickenpaint-main-section";d.appendChild(b.getElement());d.appendChild(k.getElement());c.appendChild(d);b.on("canvasRotated90",function(m){k.palettes.layers.setRotation90(m)});screen.orientation&&screen.orientation.addEventListener("change",m=>{this.resize();a.actionPerformed({action:"CPArrangePalettes"});setTimeout(()=>{this.resize();
a.actionPerformed({action:"CPArrangePalettes"})},10);Promise.resolve().then(()=>{this.resize()}).then(()=>{a.actionPerformed({action:"CPArrangePalettes"})})});let h=document.getElementById("chickenpaint-main-menu-content");if(document.addEventListener("show.bs.modal",()=>{h&&h.classList.contains("show")&&(new Tb.Collapse(h,{toggle:!1})).hide()}),h){let m=document.querySelector(".chickenpaint .widget-nav");m&&(h.addEventListener("show.bs.collapse",q=>{m.classList.add("hidden")}),h.addEventListener("hidden.bs.collapse",
q=>{m.classList.remove("hidden")}));window.addEventListener("resize",()=>{null==m||m.classList.remove("hidden")})}document.addEventListener("hidden.bs.collapse",this.resize.bind(this));window.addEventListener("resize",this.resize.bind(this));let l=null,f=!1;(new ResizeObserver(()=>{let m=window.innerWidth>document.documentElement.clientWidth;m!==l&&(l=m,f||(f=!0,requestAnimationFrame(()=>{f=!1;this.resize(!1)})))})).observe(document.body);a.on("fullScreen",m=>this.setFullScreenMode(m));a.on("unsavedChanges",
m=>{c.classList.toggle("chickenpaint-unsaved",m)});setTimeout(this.resize.bind(this),0)}function og(a){var c=document.createElement("div");c.classList.add("modal","fade","chickenpaint-about-dialog");c.setAttribute("tabindex","-1");c.setAttribute("role","dialog");c.innerHTML='\n        <div class="modal-dialog">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h5 class="modal-title">About ChickenPaint Be</h5>\n                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                </div>\n                <div class="modal-body">\n                    <a class="chickenpaint-on-github" target="_blank" href="https://github.com/satopian/ChickenPaint_Be" rel="noopener">\n                        <span class="icon-github"></span> ChickenPaint Be on GitHub\n                    </a>\n                    <p>\n                        ChickenPaint Be is a customized version of <a href="https://github.com/thenickdude/chickenpaint" target="_blank" rel="noopener">ChickenPaint</a> by satopian.\n                    </p>\n                    <p>\n                        Built on: 2025-08-20T11:58:44<br>\n                        <a href="https://www.gnu.org/licenses/" target="_blank" rel="noopener">GNU General Public License</a><br>\n                    </p>\n                    <a class="chickenpaint-on-github" target="_blank" href="https://github.com/thenickdude/chickenpaint" rel="noopener">\n                        <span class="icon-github"></span> ChickenPaint on GitHub\n                    </a>\n\n                    <p>\n                        ChickenPaint is a translation of <a href="https://github.com/thenickdude/chibipaint" target="_blank" rel="noopener">ChibiPaint</a>\n                        from Java to JavaScript by Nicholas Sherlock / Chicken Smoothie\n                    </p>\n                    <p>\n                        ChibiPaint is Copyright (c) 2006-2008 Marc Schefer. All Rights Reserved\n                    </p>\n                    <p>\n                        ChickenPaint is free software: you can redistribute it and/or modify\n                        it under the terms of the GNU General Public License as published by\n                        the Free Software Foundation, either version 3 of the License, or\n                        (at your option) any later version.\n                    </p>\n                    <p>\n                        ChickenPaint is distributed in the hope that it will be useful,\n                        but WITHOUT ANY WARRANTY; without even the implied warranty of\n                        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n                        <a target="_blank" href="https://www.gnu.org/licenses/" rel="noopener">GNU General Public License</a> for more details.\n                    </p>\n<pre class="pre-scrollable chickenpaint-third-party-licenses">Toolbar icons designed by <a target="_blank" href="https://github.com/Anteira" rel="noopener">Miglena Lapavicheva (Anteira)</a>\n    These icons are dual-licensed under <a target="_blank" href="https://spdx.org/licenses/GPL-3.0-or-later.html" rel="noopener">GPL-3.0-or-later</a> and <a target="_blank" href="https://creativecommons.org/licenses/by/3.0/" rel="noopener">CC-BY-3.0</a>\n\nIncludes these MIT-licensed libraries:\n\n    Includes the <a target="_blank" href="https://github.com/eligrey/FileSaver.js" rel="noopener">FileSaver.js library</a>\n    Copyright (c) 2016 <a target="_blank" href="https://eligrey.com/" rel="noopener">Eli Grey</a>\n\n    Includes the <a target="_blank" href="https://github.com/nodeca/pako" rel="noopener">Pako zlib compression library</a>\n    Copyright (c) 2014-2017 by Vitaly Puzrin and Andrei Tuputcyn\n    \n    Includes the <a target="_blank" href="https://github.com/madrobby/keymaster" rel="noopener">keymaster.js</a> keyboard library\n    Copyright (c) 2011-2013 Thomas Fuchs\n\n    Includes the <a target="_blank" href="https://benalman.com/projects/jquery-throttle-debounce-plugin/" rel="noopener">jQuery throttle-debounce</a> library\n    Copyright (c) 2010 "Cowboy" Ben Alman\n    \n    Includes the <a href="https://getbootstrap.com/" target="_blank" rel="noopener">Bootstrap</a> \n    Copyright (c) 2011-2025 <a href="https://github.com/twbs/bootstrap/blob/main/LICENSE" target="_blank" rel="noopener">The Bootstrap Authors</a>\n\n    MIT License\n\n    Permission is hereby granted, free of charge, to any person\n    obtaining a copy of this software and associated documentation\n    files (the "Software"), to deal in the Software without\n    restriction, including without limitation the rights to use,\n    copy, modify, merge, publish, distribute, sublicense, and/or\n    sell copies of the Software, and to permit persons to whom the\n    Software is furnished to do so, subject to the following\n    conditions:\n\n    The above copyright notice and this permission notice shall be\n    included in all copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,\n    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT \n    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n    OTHER DEALINGS IN THE SOFTWARE.\n\nIncludes Font Awesome by Fonticons, Inc. - <a href="https://fontawesome.com/" target="_blank" rel="noopener">https://fontawesome.com/</a>\nIncludes Material Design icons by Google - <a href="https://fonts.google.com/" target="_blank" rel="noopener">https://fonts.google.com/</a>\n                    </pre>\n                </div>\n            </div>\n        </div>\n    ';
a.appendChild(c);var d=new Tb.Modal(c);return c.addEventListener("hidden.bs.modal",()=>{c.remove()}),{show:function(){d.show()}}}function Jd(a,c){let d=document.createElement("div");d.classList.add("modal","fade");d.setAttribute("tabindex","-1");d.setAttribute("role","dialog");d.innerHTML=`
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Complete transform")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>
                        ${Q("You need to finish transforming this layer before you can do that. What would you like to do with the transform?")}
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light chickenpaint-cancel-transform" data-bs-dismiss="modal">${Q("Cancel")}</button>
                    <button type="button" class="btn btn-light chickenpaint-reject-transform" data-bs-dismiss="modal">${Q("Undo transform")}</button>
                    <button type="button" class="btn btn-primary chickenpaint-accept-transform" data-bs-dismiss="modal">${Q("Apply transform")}</button>
                </div>
            </div>
        </div>
    `;let b=this,k=d.querySelector(".chickenpaint-accept-transform"),n=d.querySelector(".chickenpaint-reject-transform"),g=d.querySelector(".chickenpaint-cancel-transform");null==k||k.addEventListener("click",function(h){c.actionPerformed({action:"CPTransformAccept"});b.emitEvent("accept");e.hide()});null==n||n.addEventListener("click",function(h){c.actionPerformed({action:"CPTransformReject"});b.emitEvent("reject");e.hide()});null==g||g.addEventListener("click",function(h){e.hide()});let e=new Tb.Modal(d);
this.show=function(){e.show()};this.hide=function(){e.hide()};d.addEventListener("hidden.bs.modal",h=>{d.remove()});a.addEventListener("keydown",function f(l){"Enter"===l.key&&(e.hide(),c.actionPerformed({action:"CPTransformAccept"}),b.emitEvent("accept"),a.removeEventListener("keydown",f))});a.appendChild(d)}function pg(a){let c=document.createElement("div");c.classList.add("modal","fade","chickenpaint-shortcuts-dialog");c.tabIndex=-1;c.role="dialog";c.innerHTML=`
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Shortcuts")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>${Q("Many of the menu options and painting tools have keyboard shortcuts which are written next to them or appear when you hover.")}</p>
                    <p>${Q("Here are some other shortcuts which are not as obvious!")}</p>
                    <div class="chickenpaint-shortcuts-sections">
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${Q("Color swatches palette")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Use as the drawing color")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${Q("Right")}</span></dt>
                                        <dd>${Q("Remove or replace a color swatch")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${Q("Line drawing mode")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Shift</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Snap line to nearest 45 degrees")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${Q("Painting tools")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">1</span> - <span class="chickenpaint-shortcut-key">9</span>, <span class="chickenpaint-shortcut-key">0</span></span></dt>
                                        <dd>${Q("Change brush opacity")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">[</span>, <span class="chickenpaint-shortcut-key">]</span></span></dt>
                                        <dd>${Q("Change brush size")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${Q("Brush palette")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${Q("Right")}</span><span class="chickenpaint-shortcut-alternate">${Q("or")}</span><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Shift</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Adjust brush sliders more precisely")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${Q("Zoom")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">${qg}</span>  + <span class="chickenpaint-shortcut-key">Space</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span><dt>
                                        <dt><span class="chickenpaint-shortcut-alternate">${Q("or")}</span>
                                        <span class="chickenpaint-shortcut-key">Z</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Zoom the canvas")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${Q("Drawing canvas")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${Q("Middle")}</span> <span class="chickenpaint-shortcut-alternate">${Q("or")}</span> <span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Space</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Move the canvas around")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">R</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Rotate the canvas")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${Q("Right")}</span><span class="chickenpaint-shortcut-alternate">${Q("or")}</span><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Alt</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Sample the color under the cursor")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">H</span></dt>
                                        <dd>${Q("Flip View horizontal")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${Q("Layers palette")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${Q("Double click")}</span><span class="chickenpaint-shortcut-alternate">${Q("or")}</span><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${Q("Right")}</span></dt>
                                        <dd>${Q("Rename layer")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Shift</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Toggle mask enable/disable")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Alt</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Toggle mask View")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">${gf}</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Apply layer mask")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Shift</span> + <span class="chickenpaint-shortcut-key">${gf}</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Delete layer mask")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;c.querySelector(".btn-close").addEventListener("click",()=>{c.remove()});let d=new Tb.Modal(c);a.appendChild(c);this.show=function(){d.show()}}function rg(a,c){let d=document.createElement("div");d.classList.add("modal","fade");d.setAttribute("tabindex","-1");d.setAttribute("role","dialog");d.innerHTML=`
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Box blur")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label>${Q("Blur amount (pixels)")}</label>
                            <input type="number" class="form-control chickenpaint-blur-amount" value="3" min="1">
                        </div>
                        <div class="form-group">
                            <label>${Q("Iterations (1-8, larger gives smoother blur)")}</label>
                            <input type="number" class="form-control chickenpaint-blur-iterations" value="1" min="1" max="8">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">${Q("Cancel")}</button>
                    <button type="button" class="btn btn-primary chickenpaint-apply-box-blur" data-bs-dismiss="modal">${Q("Ok")}</button>
                </div>
            </div>
        </div>
    `;let b=d.querySelector(".chickenpaint-blur-amount"),k=d.querySelector(".chickenpaint-blur-iterations"),n=d.querySelector(".chickenpaint-apply-box-blur"),g=new Tb.Modal(d);this.show=function(){let e=document.getElementById("chickenpaint-main-menu-content");e&&e.classList.contains("show")&&(new Tb.Collapse(e,{toggle:!1})).hide();g.show()};n.addEventListener("click",e=>{e=Math.max(parseInt(b.value,10),1);let h=Math.min(Math.max(parseInt(k.value,10),1),8);c.getArtwork().boxBlur(e,e,h);g.hide()});
d.addEventListener("hidden.bs.modal",()=>{document.activeElement.blur();d.remove()});d.addEventListener("shown.bs.modal",()=>{b.focus()});d.addEventListener("keydown",e=>{"Enter"===e.key&&d.classList.contains("show")&&(n.click(),e.preventDefault())});a.appendChild(d)}function sg(a){let c=document.createElement("div");c.classList.add("modal","fade");c.setAttribute("tabindex","-1");c.setAttribute("role","dialog");c.innerHTML='\n        <div class="modal-dialog" role="document">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h5 class="modal-title">Drawing tablet support</h5>\n                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                </div>\n                <div class="modal-body">\n                    <div class="chickenpaint-tablet-support chickenpaint-pointerevents-support">\n                        <h5>\n                            Built-in support for most tablets.\n                            <small>macOS, Windows 10 or newer</small>\n                        </h5>\n                        <div class="chickenpaint-supported-browsers">\n                            <div class="chickenpaint-supported-browser">\n                                <span class="icon-chrome"></span>\n                                Chrome\n                            </div>\n                            <div class="chickenpaint-supported-browser">\n                                <span class="icon-edge"></span>\n                                Edge (Windows 10)\n                            </div>\n                            <div class="chickenpaint-supported-browser">\n                                <span class="icon-firefox"></span>\n                                Firefox\n                            </div>\n                        </div>\n                        <p class="chickenpaint-not-supported">\n                            Your browser doesn\'t have built-in support for drawing tablets, please try\n                            one of the other browsers listed above.\n                        </p>\n                        <p class="chickenpaint-supported alert alert-success">\n                            Your browser has built-in support for drawing tablets!\n                        </p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ';
let d=c.querySelector(".chickenpaint-pointerevents-support"),b=!!window.PointerEvent;null==d||d.classList.toggle("supported",b);null==d||d.classList.toggle("not-supported",!b);c.addEventListener("hidden.bs.modal",n=>{c.remove()});let k=new Tb.Modal(c);a.appendChild(c);this.show=function(){k.show()}}function tg(a,c){let d=document.createElement("div");d.classList.add("modal","fade");d.setAttribute("tabindex","-1");d.setAttribute("role","dialog");d.innerHTML=`
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Grid options")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label>${Q("Grid size")}</label>
                            <input type="number" class="form-control chickenpaint-grid-size" value="" min="3">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">${Q("Cancel")}</button>
                    <button type="button" class="btn btn-primary chickenpaint-apply-grid-settings" data-bs-dismiss="modal">${Q("Ok")}</button>
                </div>
            </div>
        </div>
    `;let b=d.querySelector(".chickenpaint-grid-size"),k=d.querySelector(".chickenpaint-apply-grid-settings"),n=new Tb.Modal(d);this.show=function(){let g=document.getElementById("chickenpaint-main-menu-content");g&&g.classList.contains("show")&&(new Tb.Collapse(g,{toggle:!1})).hide();n.show()};b.value=c.getGridSize();d.addEventListener("hidden.bs.modal",()=>{d.remove()});k.addEventListener("click",()=>{let g=parseInt(b.value,10);c.setGridSize(g);n.hide()});d.addEventListener("shown.bs.modal",()=>
{b.focus()});d.addEventListener("keydown",g=>{"Enter"===g.key&&(g.preventDefault(),k.click())});a.appendChild(d)}function Kd(a,c,d){let b=document.createElement("div");b.className="modal fade chickenpaint-send-dialog";b.tabIndex=-1;b.setAttribute("role","dialog");b.innerHTML=`
        <div class="modal-dialog">
            <div class="modal-content" data-stage="saving">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Saving drawing...")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="chickenpaint-saving-progress-message">${Q("Preparing your drawing to be saved, please wait...")}</p>
                    <pre class="chickenpaint-saving-error-message pre-scrollable" style="display: none;"></pre>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light chickenpaint-send-cancel" data-bs-dismiss="modal">${Q("Cancel")}</button>
                </div>
            </div>
            <div class="modal-content" data-stage="success-not-previously-posted" style="display:none">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Drawing saved!")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body">
                    <p>${Q("Your drawing has been saved, would you like to post it to the forum now?")}</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary chickenpaint-post-drawing" data-bs-dismiss="modal">${Q("Yes, post it now")}</button>
                    <button type="button" class="btn btn-light chickenpaint-continue-drawing" data-bs-dismiss="modal">${Q("No, keep drawing")}</button>
                    <button type="button" class="btn btn-light chickenpaint-exit" data-bs-dismiss="modal">${Q("No, quit and I'll finish it later")}</button>
                </div>
            </div>
            <div class="modal-content" data-stage="success-already-posted" style="display:none">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Drawing saved!")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body">
                    <p>${Q("Your drawing has been saved, would you like to view it on the forum now?")}</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary chickenpaint-post-drawing" data-bs-dismiss="modal">${Q("Yes, view the post")}</button>
                    <button type="button" class="btn btn-light chickenpaint-continue-drawing" data-bs-dismiss="modal">${Q("No, keep drawing")}</button>
                </div>
            </div>
            <div class="modal-content" data-stage="success-redirect" style="display:none">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Drawing saved!")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>${Q("Your drawing has been saved, redirecting you to view your new post now...")}</p>
                </div>
            </div>
        </div>
    `;let k=b.querySelector(".chickenpaint-saving-progress-message"),n=b.querySelector(".chickenpaint-saving-error-message"),g=b.querySelector(".progress-bar"),e=new Tb.Modal(b),h=this;d.on("savingProgress",function(f,m){k.textContent=m;g.setAttribute("aria-valuenow",100*f);g.style.width=100*f+"%"});d.on("savingComplete",function(){b.querySelector(".modal-content[data-stage='saving']").style.display="none";a.isActionSupported("CPContinue")?a.isActionSupported("CPExit")?b.querySelector(".modal-content[data-stage='success-not-previously-posted']").style.display=
"block":b.querySelector(".modal-content[data-stage='success-already-posted']").style.display="block":b.querySelector(".modal-content[data-stage='success-redirect']").style.display="block"});d.on("savingFailure",function(f){g.classList.add("progress-bar-danger");let m=Q("Sorry, your drawing could not be saved, please try again later.");f&&0<(f=f.replace(/^CHIBIERROR\s*/,"")).length&&(m+=`<br><br>${Q("The error returned from the server was")}:`,n.textContent=f,n.style.display="block");k.innerHTML=m});
b.querySelector(".chickenpaint-send-cancel").addEventListener("click",function(){d.cancel()});var l=b.querySelector(".chickenpaint-post-drawing");l&&l.addEventListener("click",function(){a.actionPerformed({action:"CPPost"})});(l=b.querySelector(".chickenpaint-exit"))&&(l.style.display=a.isActionSupported("CPExit")?"":"none",l.addEventListener("click",function(){alert("When you want to come back and finish your drawing, just click the 'new drawing' button again and you can choose to continue this drawing.");
a.actionPerformed({action:"CPExit"})}));b.addEventListener("hidden.bs.modal",()=>{b.remove()});c.appendChild(b);this.show=function(){e.show();h.emitEvent("shown")}}function W(a){function c(H){this.palName=H}function d(H){this.toolNum=H}function b(H){this.modeNum=H}function k(H){let ja;switch(w=H==Yb.EDITING_MODE_IMAGE?W.COLOR_MODE_RGB:W.COLOR_MODE_GREYSCALE,m.emitEvent("colorModeChange",[H==Yb.EDITING_MODE_IMAGE?"rgb":"greyscale"]),w){case W.COLOR_MODE_RGB:ja=t.clone();break;case W.COLOR_MODE_GREYSCALE:ja=
new fb(fb.greyToRGB(u))}m.artwork.setForegroundColor(ja.getRgb());m.emitEvent("colorChange",[ja])}function n(){m.emitEvent("toolChange",[C,L[C]])}function g(H){D!=H&&(H==W.M_TRANSFORM&&(A=D),D=H,m.emitEvent("modeChange",[D]))}function e(H){g(W.M_DRAW);C=H;m.artwork.setBrush(L[H]);n()}function h(H,ja){f&&(f.addEventListener("dblclick",function(U){U.preventDefault();U.stopPropagation()}),m.artwork.on("editModeChanged",k),r=new Id(m,f),m.emitEvent("fullScreen",[N]),m.emitEvent("smallScreen",[J]),M.load(),
e(W.T_PEN),r.arrangePalettes(),H&&r.setSwatches(H),ja&&r.setRotation90(ja),window.addEventListener("beforeunload",function(U){m.artwork.getHasUnsavedChanges()&&U.preventDefault()}),m.artwork.on("unsavedChanges",U=>{a.allowMultipleSends&&m.emitEvent("unsavedChanges",[U])}))}var l;!function(){try{if("undefined"!=typeof navigator){let H=navigator.languages;for(let ja of(Array.isArray(H)||(H=[H]),H)){let U=/^(..)([-_].+)?$/.exec(ja);if(U){if(U[1]=U[1].toLowerCase(),U[1]in ie)return void he(ja);if("en"===
U[1])return void he("en")}}}}catch(H){console.error(H)}}();a.language&&he(a.language);let f=a.uiElem;document.addEventListener("keydown",H=>{((H.ctrlKey||H.metaKey)&&"+;=-shro".split("").includes(H.key.toLowerCase())||"Enter"===H.key)&&H.preventDefault()});f.addEventListener("contextmenu",H=>{H.preventDefault();H.stopPropagation()},{passive:!1});let m=this,q,r,t=new fb(0),u=255,w=W.COLOR_MODE_RGB,C=W.T_PENCIL,D=W.M_DRAW,A=D,F=[4278190080,4294967295],J=!1,N=!1,L=((l=Array(W.T_MAX))[W.T_PENCIL]=new la({toolNb:W.T_PENCIL,
size:16,alpha:255,isAA:!0,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,tip:la.TIP_ROUND_AA,brushMode:la.BRUSH_MODE_PAINT,paintMode:la.PAINT_MODE_OPACITY}),l[W.T_ERASER]=new la({toolNb:W.T_ERASER,size:16,alpha:255,isAA:!0,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!1,texture:0,tip:la.TIP_ROUND_AA,brushMode:la.BRUSH_MODE_ERASE,paintMode:la.PAINT_MODE_OPACITY}),l[W.T_PEN]=new la({toolNb:W.T_PEN,size:2,alpha:128,isAA:!0,minSpacing:.5,spacing:.05,pressureSize:!0,pressureAlpha:!1,
tip:la.TIP_ROUND_AA,brushMode:la.BRUSH_MODE_PAINT,paintMode:la.PAINT_MODE_FLOW,alphaScale:.5}),l[W.T_SOFTERASER]=new la({toolNb:W.T_SOFTERASER,size:16,alpha:64,isAA:!1,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,texture:1,tip:la.TIP_ROUND_AIRBRUSH,brushMode:la.BRUSH_MODE_ERASE,paintMode:la.PAINT_MODE_FLOW,alphaScale:.125}),l[W.T_AIRBRUSH]=new la({toolNb:W.T_AIRBRUSH,size:50,alpha:32,isAA:!1,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,tip:la.TIP_ROUND_AIRBRUSH,brushMode:la.BRUSH_MODE_PAINT,
paintMode:la.PAINT_MODE_FLOW,alphaScale:.125}),l[W.T_DODGE]=new la({toolNb:W.T_DODGE,size:30,alpha:32,isAA:!1,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,tip:la.TIP_ROUND_AIRBRUSH,brushMode:la.BRUSH_MODE_DODGE,paintMode:la.PAINT_MODE_FLOW,alphaScale:.125}),l[W.T_BURN]=new la({toolNb:W.T_BURN,size:30,alpha:32,isAA:!1,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,tip:la.TIP_ROUND_AIRBRUSH,brushMode:la.BRUSH_MODE_BURN,paintMode:la.PAINT_MODE_FLOW,alphaScale:.125}),l[W.T_WATER]=
new la({toolNb:W.T_WATER,size:30,alpha:70,isAA:!1,minSpacing:.5,spacing:.02,pressureSize:!1,pressureAlpha:!0,tip:la.TIP_ROUND_AA,brushMode:la.BRUSH_MODE_WATER,paintMode:la.PAINT_MODE_FLOW,alphaScale:.125,resat:.3,bleed:.6}),l[W.T_BLUR]=new la({toolNb:W.T_BLUR,size:20,alpha:255,isAA:!1,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,tip:la.TIP_ROUND_PIXEL,brushMode:la.BRUSH_MODE_BLUR,paintMode:la.PAINT_MODE_FLOW,alphaScale:.125}),l[W.T_SMUDGE]=new la({toolNb:W.T_SMUDGE,size:20,alpha:128,
isAA:!1,minSpacing:.5,spacing:.01,pressureSize:!1,pressureAlpha:!0,tip:la.TIP_ROUND_AIRBRUSH,brushMode:la.BRUSH_MODE_SMUDGE,paintMode:la.PAINT_MODE_FLOW,alphaScale:.125,resat:0,bleed:1}),l[W.T_BLENDER]=new la({toolNb:W.T_BLENDER,size:20,alpha:60,isAA:!1,minSpacing:.5,spacing:.1,pressureSize:!1,pressureAlpha:!0,tip:la.TIP_ROUND_AIRBRUSH,brushMode:la.BRUSH_MODE_OIL,paintMode:la.PAINT_MODE_FLOW,alphaScale:.125,resat:0,bleed:.07}),l),M=new ug,X,fa,pa={CPFullScreen:{action:function(){m.setFullScreen(!N)},
isSupported:function(){return"disable"!==a.fullScreenMode&&"force"!==a.fullScreenMode&&!1!==a.allowFullScreen},modifies:{gui:!0}},CPZoomIn:{action:function(){q.zoomIn()},modifies:{gui:!0}},CPZoomOut:{action:function(){q.zoomOut()},modifies:{gui:!0}},CPZoom100:{action:function(){q.zoom100()},modifies:{gui:!0}},CPResetZoomAndRotation:{action:function(){q.resetZoomAndRotation();let H=r.getPaletteManager().palettes.misc.flipButton,ja=r.getMainMenu().getElement().querySelector('[data-action="CPViewHFlip"]');
H&&H.classList.remove("flipped");ja&&ja.classList.remove("selected")},modifies:{gui:!0}},CPViewHFlip:{action:function(){let H=q.toggleViewFlip(),ja=r.getPaletteManager().palettes.misc.flipButton,U=r.getMainMenu().getElement().querySelector('[data-action="CPViewHFlip"]');ja&&(H?ja.classList.add("flipped"):ja.classList.remove("flipped"));U&&(H?U.classList.add("selected"):U.classList.remove("selected"))},modifies:{gui:!0}},CPUndo:{action:function(){m.artwork.undo()},modifies:{document:!0},allowed:"isUndoAllowed"},
CPRedo:{action:function(){m.artwork.redo()},modifies:{document:!0},allowed:"isRedoAllowed"},CPClearHistory:{action:function(){confirm(Q("You're about to clear the current Undo/Redo history.\nThis operation cannot be undone, are you sure you want to do that?"))&&m.artwork.clearHistory()},modifies:{document:!0}},CPPencil:new d(W.T_PENCIL),CPPen:new d(W.T_PEN),CPEraser:new d(W.T_ERASER),CPSoftEraser:new d(W.T_SOFTERASER),CPAirbrush:new d(W.T_AIRBRUSH),CPDodge:new d(W.T_DODGE),CPBurn:new d(W.T_BURN),
CPWater:new d(W.T_WATER),CPBlur:new d(W.T_BLUR),CPSmudge:new d(W.T_SMUDGE),CPBlender:new d(W.T_BLENDER),CPFloodFill:new b(W.M_FLOODFILL),CPGradientFill:new b(W.M_GRADIENTFILL),CPRectSelection:new b(W.M_RECT_SELECTION),CPMoveTool:new b(W.M_MOVE_TOOL),CPRotateCanvas:new b(W.M_ROTATE_CANVAS),CPPanCanvas:new b(W.M_PAN_CANVAS),CPColorPicker:new b(W.M_COLOR_PICKER),CPTransform:{action:function(){let H=m.artwork.getActiveLayer();null==m.artwork.transformAffineBegin()?m.showLayerNotification(H,Q("Whoops! All of the selected pixels are transparent!"),
"layer"):g(W.M_TRANSFORM)},modifies:{mode:!0},allowed:function(){let H=m.artwork.getActiveLayer();if(H.visible)if(0==H.alpha)m.showLayerNotification(H,Q("Whoops! This layer's opacity is currently 0%"),"opacity");else{if(null!=m.artwork.transformAffineBegin())return 0!=H.getEffectiveAlpha();m.showLayerNotification(H,Q("Whoops! All of the selected pixels are transparent!"),"layer")}else m.showLayerNotification(H,Q("Whoops! This layer is currently hidden"),"layer")}},CPTransformAccept:{action:function(){D==
W.M_TRANSFORM&&(m.artwork.transformAffineFinish(),g(A))},modifies:{mode:!0}},CPTransformReject:{action:function(){D==W.M_TRANSFORM&&(m.artwork.transformAffineAbort(),g(A))},modifies:{document:!0,mode:!0}},CPFreeHand:{action:function(){L[C].strokeMode=la.STROKE_MODE_FREEHAND;n()},modifies:{tool:!0}},CPLine:{action:function(){L[C].strokeMode=la.STROKE_MODE_LINE;n()},modifies:{tool:!0}},CPBezier:{action:function(){L[C].strokeMode=la.STROKE_MODE_BEZIER;n()},modifies:{tool:!0}},CPAbout:{action:function(){(new og(f)).show()},
modifies:{}},CPShortcuts:{action:function(){(new pg(f)).show()},modifies:{}},CPTabletSupport:{action:function(){(new sg(f)).show()},modifies:{}},CPLayerDuplicate:{action:function(){m.artwork.duplicateLayer()},modifies:{document:!0}},CPLayerMergeDown:{action:function(){m.artwork.mergeDown()},modifies:{document:!0},allowed:"isMergeDownAllowed"},CPGroupMerge:{action:function(){m.artwork.mergeGroup()},modifies:{document:!0},allowed:"isMergeGroupAllowed"},CPLayerMergeAll:{action:function(){m.artwork.mergeAllLayers()},
modifies:{document:!0},allowed:"isMergeAllLayersAllowed"},CPAddMergedLayer:{action:function(){m.artwork.mergeAllLayers(!0)},modifies:{document:!0},allowed:"isMergeAllLayersAllowed"},CPExpandLayerGroup:{action:function(H){m.artwork.expandLayerGroup(H.group,H.expand)},modifies:{document:!0}},CPFill:{action:function(){m.artwork.fill(4278190080|m.getCurColor().getRgb())},modifies:{document:!0},requiresDrawable:!0},CPClear:{action:function(){m.artwork.clear()},modifies:{document:!0},requiresDrawable:!0},
CPSelectAll:{action:function(){m.artwork.rectangleSelection(m.artwork.getBounds());q.repaintAll()},modifies:{document:!0}},CPDeselectAll:{action:function(){m.artwork.rectangleSelection(new oa(0,0,0,0));q.repaintAll()},modifies:{document:!0}},CPHFlip:{action:function(){m.artwork.hFlip()},modifies:{document:!0},requiresDrawable:!0},CPVFlip:{action:function(){m.artwork.vFlip()},modifies:{document:!0},requiresDrawable:!0},CPMNoise:{action:function(){m.artwork.monochromaticNoise()},modifies:{document:!0},
requiresDrawable:!0},CPCNoise:{action:function(){m.artwork.colorNoise()},modifies:{document:!0},allowed:"isColorNoiseAllowed"},CPFXBoxBlur:{action:function(){X||=new rg(f,m);X.show()},modifies:{document:!0},requiresDrawable:!0},CPFXInvert:{action:function(){m.artwork.invert()},modifies:{document:!0},requiresDrawable:!0},CPBrightnessToOpacity:{action:function(){m.artwork.brightnessToOpacity()},modifies:{document:!0},requiresDrawable:!0},CPCut:{action:function(){m.artwork.cutSelection()},modifies:{document:!0},
requiresDrawable:!0,allowed:"isCutSelectionAllowed"},CPCopy:{action:function(){m.artwork.copySelection()},modifies:{document:!0},requiresDrawable:!0,allowed:"isCopySelectionAllowed"},CPCopyMerged:{action:function(){m.artwork.copySelectionMerged()},modifies:{document:!0},allowed:"isCopySelectionMergedAllowed"},CPPaste:{action:function(){m.artwork.pasteClipboard()},modifies:{document:!0},allowed:"isPasteClipboardAllowed"},CPToggleGrid:{action:function(H){q.showGrid(H.selected)},modifies:{gui:!0}},CPGridOptions:{action:function(){fa||=
new tg(f,q);fa.show()},modifies:{gui:!0}},CPLinearInterpolation:{action:function(H){q.setInterpolation(H.selected)},modifies:{gui:!0},isSupported:function(){return!!Sd(pc(0,0).getContext("2d"))}},CPResetCanvasRotation:{action:function(){q.resetRotation()},modifies:{gui:!0}},CPAddLayer:{action:function(){m.artwork.addLayer("layer")},modifies:{document:!0}},CPAddGroup:{action:function(){m.artwork.addLayer("group")},modifies:{document:!0}},CPAddLayerMask:{action:function(){m.artwork.addLayerMask()},
modifies:{document:!0},allowed:"isAddLayerMaskAllowed"},CPApplyLayerMask:{action:function(){m.artwork.applyLayerMask(!0)},modifies:{document:!0},allowed:"isApplyLayerMaskAllowed"},CPRemoveLayerMask:{action:function(){m.artwork.removeLayerMask()},modifies:{document:!0},allowed:"isRemoveLayerMaskAllowed"},CPRemoveLayer:{action:function(){m.artwork.removeLayer()||alert(Q("Sorry, you can't remove the last remaining layer in the drawing."))},modifies:{document:!0},allowed:"isRemoveLayerAllowed"},CPCreateClippingMask:{action:function(){m.artwork.createClippingMask()},
modifies:{document:!0},allowed:"isCreateClippingMaskAllowed"},CPReleaseClippingMask:{action:function(){m.artwork.releaseClippingMask()},modifies:{document:!0},allowed:"isReleaseClippingMaskAllowed"},CPRelocateLayer:{action:function(H){m.artwork.relocateLayer(H.layer,H.toGroup,H.toIndex)},modifies:{document:!0}},CPSetActiveLayer:{action:function(H){H.mask&&H.layer.mask&&!H.layer.maskVisible&&m.artwork.setLayerMaskVisible(H.layer,!0);m.artwork.setActiveLayer(H.layer,H.mask);m.artwork.performIdleTasks()},
modifies:{document:!0}},CPToggleMaskView:{action:function(){let H=m.artwork.toggleMaskView();H&&m.emitEvent("maskViewOpened",[H])},modifies:{gui:!0}},CPSetMaskVisible:{action:function(H){m.artwork.setLayerMaskVisible(H.layer,H.visible)},modifies:{layerProp:!0}},CPSetLayerVisibility:{action:function(H){m.artwork.setLayerVisibility(H.layer,H.visible)},modifies:{layerProp:!0}},CPSetLayerName:{action:function(H){m.artwork.setLayerName(H.layer,H.name)},modifies:{layerProp:!0}},CPSetLayerBlendMode:{action:function(H){m.artwork.setLayerBlendMode(H.blendMode)},
modifies:{layerProp:!0}},CPSetLayerAlpha:{action:function(H){m.artwork.setLayerAlpha(H.alpha)},modifies:{layerProp:!0}},CPSetLayerLockAlpha:{action:function(H){m.artwork.setLayerLockAlpha(H.lock)},modifies:{layerProp:!0}},CPPalColor:new c("color"),CPPalBrush:new c("brush"),CPPalLayers:new c("layers"),CPPalStroke:new c("stroke"),CPPalSwatches:new c("swatches"),CPPalTool:new c("tool"),CPPalMisc:new c("misc"),CPPalTextures:new c("textures"),CPTogglePalettes:{action:function(){r.togglePalettes()},modifies:{gui:!0}},
CPArrangePalettes:{action:function(){r.arrangePalettes()},modifies:{gui:!0}},CPSave:{action:function(){let H;(H=new gd({artwork:m.getArtwork(),rotation:q.getRotation90(),swatches:r.getSwatches()})).on("savingComplete",function(){m.artwork.setHasUnsavedChanges(!1)});H.on("savingFailure",function(){alert(Q("Sorry, your drawing could not be saved, Please see the error message."))});H.save()},isSupported:function(){return!1!==a.allowDownload},modifies:{document:!0}},CPSend:{action:function(){!function(){if(m.isActionSupported("CPContinue")||
confirm(Q("Are you sure you want to send your drawing to the server and finish drawing now?"))){var H=new gd({artwork:m.getArtwork(),rotation:q.getRotation90(),swatches:r.getSwatches(),url:a.saveUrl,post_max_size:a.post_max_size}),ja=new Kd(m,f,H);H.on("savingComplete",function(){m.artwork.setHasUnsavedChanges(!1);!m.isActionSupported("CPContinue")&&m.isActionSupported("CPPost")&&m.actionPerformed({action:"CPPost"})});H.on("savingFailure",function(){alert(Q("Sorry, your drawing could not be saved, Please see the error message."))});
ja.on("shown",function(){H.save()});ja.show()}}()},isSupported:function(){return!!a.saveUrl},modifies:{document:!0}},CPPost:{action:function(){if("function"==typeof handleExit)return handleExit();window.location=a.postUrl},isSupported:function(){return!(!a.postUrl&&"function"!=typeof handleExit)},modifies:{document:!0}},CPContinue:{action:function(){},isSupported:function(){return!!a.allowMultipleSends}},CPExit:{action:function(){window.location=a.exitUrl},isSupported:function(){return!!a.exitUrl},
modifies:{}}};switch(c.prototype.action=function(H){r.showPalette(this.palName,H.selected)},c.prototype.modifies={gui:!0},d.prototype.action=function(){e(this.toolNum)},d.prototype.modifies={mode:!0,tool:!0},d.prototype.requiresDrawable=!0,b.prototype.action=function(){g(this.modeNum)},b.prototype.modifies={mode:!0},this.callToolListeners=function(){n()},this.getArtwork=function(){return this.artwork},this.setCanvas=function(H){q=H},this.setTransformInterpolation=function(H){this.artwork.setTransformInterpolation(H)},
this.setCurColor=function(H){switch(w){case W.COLOR_MODE_RGB:t.isEqual(H)||(t.copyFrom(H),this.artwork.setForegroundColor(H.getRgb()),this.emitEvent("colorChange",[H]));break;case W.COLOR_MODE_GREYSCALE:if(H=H.getValue(),u!=H){let ja=fb.greyToRGB(H);this.artwork.setForegroundColor(ja);u=H;this.emitEvent("colorChange",[new fb(ja)])}}},this.getCurColor=function(){switch(w){case W.COLOR_MODE_RGB:return t.clone();case W.COLOR_MODE_GREYSCALE:return new fb(fb.greyToRGB(u))}},this.setCurGradient=function(H){F=
H.slice(0);this.emitEvent("gradientChange",[F])},this.getCurGradient=function(){return F.slice(0)},this.setBrushSize=function(H){L[C].size=Math.max(1,Math.min(200,H));n()},this.getBrushSize=function(){return L[C].size},this.setAlpha=function(H){L[C].alpha=H;n()},this.getAlpha=function(){return L[C].alpha},this.getCurMode=function(){return D},this.zoomOnCenter=function(H,ja=!1){q.zoomOnCenter(H,ja)},this.getZoom=function(){return q.getZoom()},this.getRotationDegrees=function(){return q.getRotationDegrees()},
this.setRotationDegrees=function(H){q.setRotationDegrees(H)},this.isPanOrRotateMode=function(){return q.isPanOrRotateMode()},this.getCurTool=function(){return C},this.getBrushInfo=function(){return L[C]},this.isActionSupported=function(H){if(pa[H]){let ja=typeof pa[H].isSupported;return"function"==ja?pa[H].isSupported():"undefined"==ja||pa[H].isSupported}return!1},this.isActionAllowed=function(H){H=pa[H];return!!H&&("function"==typeof H.allowed?H.allowed():"string"==typeof H.allowed?this.artwork[H.allowed]():
!H.requiresDrawable||this.artwork.isActiveLayerDrawable())},this.showLayerNotification=function(H,ja,U){this.emitEvent("layerNotification",[H,ja,U])},this.actionPerformed=function(H){if(null!=this.artwork&&null!=q){var ja=pa[H.action];if(ja)if(D==W.M_TRANSFORM&&(ja.modifies.document||ja.modifies.mode)&&-1==["CPTransformAccept","CPTransformReject"].indexOf(H.action))if("CPUndo"==H.action)pa.CPTransformReject.action();else{if("CPTransform"!=H.action){let U=new Jd(f,this);U.on("accept",()=>{this.actionPerformed(H);
U.hide()});U.on("reject",()=>{this.actionPerformed(H);U.hide()});U.show()}}else ja.action(H)}},this.setSmallScreenMode=function(H){J!==H&&(J=H,f.classList.toggle("chickenpaint-small-screen",J),m.emitEvent("smallScreen",[J]))},this.getSmallScreenMode=function(){return J},this.setFullScreen=function(H){N!==H&&(N=H,document.body.classList.toggle("chickenpaint-full-screen",N),f.classList.toggle("chickenpaint-full-screen",N),H=document.querySelectorAll('head meta[name="viewport"]').length,N&&0===H?(H=
document.createElement("meta"),H.name="viewport",H.content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,,user-scalable=no",document.head.appendChild(H),setTimeout(()=>m.emitEvent("fullScreen",[N]),200)):m.emitEvent("fullScreen",[N]))},this.isFullScreen=function(){return N},this.setToolbarStyle=function(H){M.set("toolbarStyle",H);M.save()},this.getToolbarStyle=function(){return M.get("toolbarStyle")},this.getResourcesRoot=function(){return a.resourcesRoot},f&&(f.className+=
" chickenpaint chickenpaint-lang-"+je),a.resourcesRoot=a.resourcesRoot||"chickenpaint/",this.setSmallScreenMode(!!("number"==typeof navigator.maxTouchPoints&&2<navigator.maxTouchPoints&&(820>=window.screen.width||820>=window.screen.height))),a.fullScreenMode){case "force":this.setFullScreen(!0);break;case "auto":this.setFullScreen(J)}(M.on("toolbarStyle",H=>this.emitEvent("toolbarStyleChange",[H])),a.loadImageUrl||a.loadChibiFileUrl)?(l=new vd(a),new dg(f,l,a.resourcesRoot),l.on("loadingComplete",
function(H){m.artwork=H.layers||H.flat;h(H.swatches,a.rotation);a.onLoaded&&a.onLoaded(this)}),l.load()):(a.artwork?this.artwork=a.artwork:(this.artwork=new Yb(a.canvasWidth||800,a.canvasHeight||600),this.artwork.addBackgroundLayer(),this.artwork.addDefaultLayer()),h(),a.onLoaded&&a.onLoaded(this))}var hf,jf,kf,me,ne,Ld="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};la.STROKE_MODE_FREEHAND=0;la.STROKE_MODE_LINE=
1;la.STROKE_MODE_BEZIER=2;la.TIP_ROUND_PIXEL=0;la.TIP_ROUND_AA=1;la.TIP_ROUND_AIRBRUSH=2;la.TIP_SQUARE_PIXEL=3;la.TIP_SQUARE_AA=4;la.BRUSH_MODE_PAINT=0;la.BRUSH_MODE_ERASE=1;la.BRUSH_MODE_DODGE=2;la.BRUSH_MODE_BURN=3;la.BRUSH_MODE_WATER=4;la.BRUSH_MODE_BLUR=5;la.BRUSH_MODE_SMUDGE=6;la.BRUSH_MODE_OIL=7;la.PAINT_MODE_OPACITY=0;la.PAINT_MODE_FLOW=1;la.DEFAULTS={isAA:!1,minSpacing:0,spacing:0,pressureSize:!0,pressureAlpha:!1,pressureScattering:!1,alphaScale:1,tip:la.TIP_ROUND_PIXEL,brushMode:la.BRUSH_MODE_PAINT,
paintMode:la.PAINT_MODE_OPACITY,strokeMode:la.STROKE_MODE_FREEHAND,resat:1,bleed:0,texture:1,size:0,curSize:0,alpha:0,curAlpha:0,scattering:0,curScattering:0,squeeze:0,curSqueeze:0,angle:Math.PI,curAngle:0,smoothing:0};la.prototype.applyPressure=function(a){this.pressureSize&&this.brushMode!=la.BRUSH_MODE_SMUDGE&&this.brushMode!=la.BRUSH_MODE_OIL?this.curSize=Math.max(.1,this.size*a):this.curSize=Math.max(.1,this.size);16<this.curSize&&(this.curSize=Math.floor(this.curSize));this.curSize=Math.min(this.curSize,
400);this.curAlpha=this.pressureAlpha?Math.floor(this.alpha*Math.min(a,1)):this.alpha;this.curSqueeze=this.squeeze;this.curAngle=this.angle;this.curScattering=this.scattering*this.curSize*(this.pressureScattering?a:1)};la.prototype.clone=function(){return new la(this)};oa.prototype.makeEmpty=function(){this.bottom=this.right=this.top=this.left=0};oa.prototype.union=function(a){this.isEmpty()?this.set(a):a.isEmpty()||(this.left=Math.min(this.left,a.left),this.top=Math.min(this.top,a.top),this.right=
Math.max(this.right,a.right),this.bottom=Math.max(this.bottom,a.bottom))};oa.prototype.getUnion=function(a){var c=this.clone();return c.union(a),c};oa.prototype.getIntersection=function(a){return new oa(Math.max(this.left,a.left),Math.max(this.top,a.top),Math.min(this.right,a.right),Math.min(this.bottom,a.bottom))};oa.prototype.clipTo=function(a){return this.isEmpty()||(a.isEmpty()?this.makeEmpty():(this.left=Math.min(Math.max(this.left,a.left),a.right),this.top=Math.min(Math.max(this.top,a.top),
a.bottom),this.right=Math.max(Math.min(this.right,a.right),a.left),this.bottom=Math.max(Math.min(this.bottom,a.bottom),a.top))),this};oa.prototype.containsPoint=function(a){return!(a.x<this.left||a.y<this.top||a.x>=this.right||a.y>=this.bottom)};oa.prototype.isInside=function(a){return this.left>=a.left&&this.top>=a.top&&this.right<=a.right&&this.bottom<=a.bottom};oa.prototype.clipSourceDest=function(a,c){c.right=c.left+a.getWidth();c.bottom=c.top+a.getHeight();this.isEmpty()||c.left>=this.right||
c.top>=this.bottom||c.right<=this.left||c.bottom<=this.top?(a.makeEmpty(),c.makeEmpty()):(c.right>this.right&&(a.right-=c.right-this.right,c.right=this.right),c.bottom>this.bottom&&(a.bottom-=c.bottom-this.bottom,c.bottom=this.bottom),c.left<this.left&&(a.left+=this.left-c.left,c.left=this.left),c.top<this.top&&(a.top+=this.top-c.top,c.top=this.top))};oa.prototype.getWidth=function(){return this.right-this.left};oa.prototype.getHeight=function(){return this.bottom-this.top};oa.prototype.getArea=function(){return this.getWidth()*
this.getHeight()};oa.prototype.isEmpty=function(){return this.right<=this.left||this.bottom<=this.top};oa.prototype.set=function(a){this.left=a.left;this.top=a.top;this.right=a.right;this.bottom=a.bottom};oa.prototype.clone=function(){return new oa(this.left,this.top,this.right,this.bottom)};oa.prototype.translate=function(a,c){return this.left+=a,this.right+=a,this.top+=c,this.bottom+=c,this};oa.prototype.getTranslated=function(a,c){var d=this.clone();return d.translate(a,c),d};oa.prototype.moveTo=
function(a,c){this.translate(a-this.left,c-this.top)};oa.prototype.equals=function(a){return this.left==a.left&&this.right==a.right&&this.top==a.top&&this.bottom==a.bottom};oa.prototype.grow=function(a,c){this.left-=a;this.right+=a;this.top-=c;this.bottom+=c};oa.prototype.toString=function(){return"("+this.left+","+this.top+","+this.right+","+this.bottom+")"};oa.prototype.toPoints=function(){return[{x:this.left,y:this.top},{x:this.right,y:this.top},{x:this.right,y:this.bottom},{x:this.left,y:this.bottom}]};
oa.prototype.roundNearest=function(){return this.left=Math.round(this.left),this.top=Math.round(this.top),this.right=Math.round(this.right),this.bottom=Math.round(this.bottom),this};oa.prototype.roundContain=function(){return this.left=Math.floor(this.left),this.top=Math.floor(this.top),this.right=Math.ceil(this.right),this.bottom=Math.ceil(this.bottom),this};oa.createBoundingBox=function(a){if(0===a.length)return new oa(0,0,0,0);let c=new oa(a[0].x,a[0].y,a[0].x,a[0].y);for(let d=1;d<a.length;d++)c.left=
Math.min(c.left,a[d].x),c.top=Math.min(c.top,a[d].y),c.right=Math.max(c.right,a[d].x),c.bottom=Math.max(c.bottom,a[d].y);return c};oa.prototype.subtract=function(a){return oa.subtract(this,a)};oa.subtract=function(a,c){a instanceof oa&&(a=[a]);c instanceof oa&&(c=[c]);a=a.slice(0);for(let b=0;b<c.length;b++){let k=c[b],n=a.length;for(let g=0;g<n;g++){var d=a[g];if(!d)continue;let e=d.getIntersection(k);if(!e.isEmpty()){let h=[];if(d.top<k.top&&h.push(new oa(d.left,d.top,d.right,e.top)),d.bottom>k.bottom&&
h.push(new oa(d.left,e.bottom,d.right,d.bottom)),d.left<k.left&&h.push(new oa(d.left,e.top,e.left,e.bottom)),d.right>k.right&&h.push(new oa(e.right,e.top,d.right,e.bottom)),0<(h=h.filter(l=>!l.isEmpty())).length)for(a[g]=h[0],d=1;d<h.length;d++)a.push(h[d]);else a[g]=null}}}return a.filter(b=>null!=b)};oa.union=function(a){if(a instanceof oa)a=[a];else{a=a.slice(0);for(let d=0;d<a.length;d++){let b=a[d],k=a.length;if(b)for(let n=d+1;n<k;n++){var c=a[n];if(c&&!b.getIntersection(c).isEmpty()){c=oa.subtract(c,
b);a[n]=c[0];for(let g=1;g<c.length;g++)a.push(c[g])}}}}return a.filter(d=>d&&!d.isEmpty())};"object"==typeof window&&(window.cpRectGarbage=new oa(1.5,2.5,3.5,4.5));Gc.prototype.getBounds=function(){return new oa(0,0,this.width,this.height)};Gc.prototype.isInside=function(a,c){return 0<=a&&0<=c&&a<this.width&&c<this.height};z.prototype=Object.create(Gc.prototype);z.prototype.constructor=z;z.BYTES_PER_PIXEL=4;z.RED_BYTE_OFFSET=0;z.GREEN_BYTE_OFFSET=1;z.BLUE_BYTE_OFFSET=2;z.ALPHA_BYTE_OFFSET=3;z.prototype.clone=
function(){return this.cloneRect(this.getBounds())};z.prototype.cloneRect=function(a){var c=new z(a.getWidth(),a.getHeight());return c.copyBitmapRect(this,0,0,a),c};z.prototype.getPixel=function(a,c){a=Math.max(0,Math.min(this.width-1,a));c=Math.max(0,Math.min(this.height-1,c));a=this.offsetOfPixel(a,c);return this.data[a+z.ALPHA_BYTE_OFFSET]<<24|this.data[a+z.RED_BYTE_OFFSET]<<16|this.data[a+z.GREEN_BYTE_OFFSET]<<8|this.data[a+z.BLUE_BYTE_OFFSET]};z.prototype.copyRectXOR=function(a,c){var d=(c=this.getBounds().clipTo(c)).getWidth(),
b=new Uint8Array(d*c.getHeight()*z.BYTES_PER_PIXEL),k=0,n=this.offsetOfPixel(c.left,c.top),g=a.offsetOfPixel(c.left,c.top),e=(this.width-d)*z.BYTES_PER_PIXEL,h=(a.width-d)*z.BYTES_PER_PIXEL;d*=z.BYTES_PER_PIXEL;for(var l=c.top;l<c.bottom;l++,n+=e,g+=h)for(var f=0;f<d;f++,k++,n++,g++)b[k]=this.data[n]^a.data[g];return b};z.prototype.setRectXOR=function(a,c){var d=(c=this.getBounds().clipTo(c)).getWidth(),b=c.getHeight();c=this.offsetOfPixel(c.left,c.top);var k=0,n=(this.width-d)*z.BYTES_PER_PIXEL;
d*=z.BYTES_PER_PIXEL;for(var g=0;g<b;g++){for(var e=0;e<d;e++)this.data[c++]^=a[k++];c+=n}};z.prototype.copyBitmapRect=function(a,c,d,b){var k=new oa(c,d,0,0);b=b.clone();this.getBounds().clipSourceDest(b,k);c=0|k.getWidth();d=0|k.getHeight();if(0==k.left&&0==k.top&&c==this.width&&d==this.height&&c==a.width&&d==a.height)this.copyPixelsFrom(a);else{k=this.offsetOfPixel(k.left,k.top);var n=(this.width-c)*z.BYTES_PER_PIXEL;b=a.offsetOfPixel(b.left,b.top);for(var g=(a.width-c)*z.BYTES_PER_PIXEL,e=0;e<
d;e++,b+=g,k+=n)for(var h=0;h<c;h++,b+=z.BYTES_PER_PIXEL,k+=z.BYTES_PER_PIXEL)this.data[k]=a.data[b],this.data[k+1]=a.data[b+1],this.data[k+2]=a.data[b+2],this.data[k+3]=a.data[b+3]}};z.prototype.copyAlphaFrom=function(a,c){var d=0|(c=this.getBounds().clipTo(c)).getWidth(),b=0|c.getHeight();c=this.offsetOfPixel(c.left,c.top)+z.ALPHA_BYTE_OFFSET|0;for(var k=(this.width-d)*z.BYTES_PER_PIXEL|0,n=0;n<b;n++,c+=k)for(var g=0;g<d;g++,c+=z.BYTES_PER_PIXEL)this.data[c]=a.data[c]};z.prototype.setToSize=function(a){(a.width!=
this.width||a.height!=this.height)&&(this.width=a.width,this.height=a.height,this.imageData=Pd(this.width,this.height),this.data=this.imageData.data)};z.prototype.copyPixelsFrom=function(a){if(this.setToSize(a),"set"in this.data)this.data.set(a.data);else for(var c=0;c<this.data.length;c++)this.data[c]=a.data[c]};z.prototype.copyPixelsFromGreyscale=function(a){var c,d=0,b=a.width*a.height;this.setToSize(a);for(c=0;c<b;c++,d+=z.BYTES_PER_PIXEL)this.data[d+z.RED_BYTE_OFFSET]=a.data[c],this.data[d+z.GREEN_BYTE_OFFSET]=
a.data[c],this.data[d+z.BLUE_BYTE_OFFSET]=a.data[c],this.data[d+z.ALPHA_BYTE_OFFSET]=255};z.prototype.copyScaledNearestNeighbor=function(a){for(var c,d=0,b=a.width/this.width,k=a.height/this.height,n=0,g=0;n<this.height;n++,g+=k){c=a.offsetOfPixel(0,Math.round(g));for(var e=0,h=0;e<this.width;e++,d+=z.BYTES_PER_PIXEL,h+=b){var l=c+Math.round(h)*z.BYTES_PER_PIXEL;this.data[d]=a.data[l];this.data[d+1]=a.data[l+1];this.data[d+2]=a.data[l+2];this.data[d+z.ALPHA_BYTE_OFFSET]=a.data[l+z.ALPHA_BYTE_OFFSET]}}};
z.prototype.createThumbnailFrom=function(a){let c=Math.min(Math.floor(a.width/this.width),3);if(2>c)return void this.copyScaledNearestNeighbor(a);let d=new Uint16Array(5*this.width);var b=a.width*z.BYTES_PER_PIXEL,k=Math.floor(a.width/this.width)*z.BYTES_PER_PIXEL;let n=Math.floor(a.width/this.width/c)*z.BYTES_PER_PIXEL,g=k-n*c;var e=Math.floor(a.height/this.height/c);k=e*b-k*this.width;b*=Math.floor(a.height/this.height)-e*c;let h=e=0;for(let q=0;q<this.height;q++,e+=b){let r;d.fill(0);for(var l=
0;l<c;l++,e+=k){r=0;for(var f=0;f<this.width;f++,r+=5,e+=g)for(var m=0;m<c;m++,e+=n){let t=a.data[e+z.ALPHA_BYTE_OFFSET],u=t/255;d[r]+=a.data[e]*u;d[r+1]+=a.data[e+1]*u;d[r+2]+=a.data[e+2]*u;d[r+z.ALPHA_BYTE_OFFSET]+=t;d[r+4]=Math.max(d[r+4],t)}}r=0;for(l=0;l<this.width;l++,r+=5,h+=z.BYTES_PER_PIXEL)f=d[r+4],0==f?this.data[h+z.ALPHA_BYTE_OFFSET]=0:(m=f/d[r+z.ALPHA_BYTE_OFFSET],this.data[h]=d[r]*m,this.data[h+1]=d[r+1]*m,this.data[h+2]=d[r+2]*m,this.data[h+z.ALPHA_BYTE_OFFSET]=f)}};z.prototype.floodFill=
function(a,c,d){if(this.isInside(a,c)){var b=this.getPixel(a,c),k=b>>24&255,n=b>>16&255,g=b>>8&255,e=255&b,h=d>>24&255,l=d>>16&255,f=d>>8&255,m=255&d,q=[],r=this.getBounds(),t=this.data;if(r.left*=z.BYTES_PER_PIXEL,r.right*=z.BYTES_PER_PIXEL,q.push({x1:a*z.BYTES_PER_PIXEL,x2:a*z.BYTES_PER_PIXEL,y:c,dy:-1}),q.push({x1:a*z.BYTES_PER_PIXEL,x2:a*z.BYTES_PER_PIXEL,y:c+1,dy:1}),0==k){if(0!=h)for(;0<q.length;)if(n=q.pop(),!(n.y<r.top||n.y>=r.bottom)){g=this.offsetOfPixel(0,n.y);for(e=n.x1;e>=r.left&&0==
t[e+g+z.ALPHA_BYTE_OFFSET];)t[e+g+z.RED_BYTE_OFFSET]=l,t[e+g+z.GREEN_BYTE_OFFSET]=f,t[e+g+z.BLUE_BYTE_OFFSET]=m,t[e+g+z.ALPHA_BYTE_OFFSET]=h,e-=z.BYTES_PER_PIXEL;if(e>=n.x1){for(;e<=n.x2&&t[e+g+z.ALPHA_BYTE_OFFSET]!=k;)e+=z.BYTES_PER_PIXEL;if(a=e+z.BYTES_PER_PIXEL,e>n.x2)continue}else(e+=z.BYTES_PER_PIXEL)<n.x1&&q.push({x1:e,x2:n.x1-z.BYTES_PER_PIXEL,y:n.y-n.dy,dy:-n.dy}),a=n.x1+z.BYTES_PER_PIXEL;do{t[e+g+z.RED_BYTE_OFFSET]=l;t[e+g+z.GREEN_BYTE_OFFSET]=f;t[e+g+z.BLUE_BYTE_OFFSET]=m;for(t[e+g+z.ALPHA_BYTE_OFFSET]=
h;a<r.right&&t[a+g+z.ALPHA_BYTE_OFFSET]==k;)t[a+g+z.RED_BYTE_OFFSET]=l,t[a+g+z.GREEN_BYTE_OFFSET]=f,t[a+g+z.BLUE_BYTE_OFFSET]=m,t[a+g+z.ALPHA_BYTE_OFFSET]=h,a+=z.BYTES_PER_PIXEL;q.push({x1:e,x2:a-z.BYTES_PER_PIXEL,y:n.y+n.dy,dy:n.dy});a-z.BYTES_PER_PIXEL>n.x2&&q.push({x1:n.x2+z.BYTES_PER_PIXEL,x2:a-z.BYTES_PER_PIXEL,y:n.y-n.dy,dy:-n.dy});for(e=a+z.BYTES_PER_PIXEL;e<=n.x2&&t[e+g+z.ALPHA_BYTE_OFFSET]!=k;)e+=z.BYTES_PER_PIXEL;a=e+z.BYTES_PER_PIXEL}while(e<=n.x2)}}else if(d!=b)for(;0<q.length;)if(a=q.pop(),
!(a.y<r.top||a.y>=r.bottom)){c=this.offsetOfPixel(0,a.y);for(d=a.x1;d>=r.left&&t[d+c+z.RED_BYTE_OFFSET]==n&&t[d+c+z.GREEN_BYTE_OFFSET]==g&&t[d+c+z.BLUE_BYTE_OFFSET]==e&&t[d+c+z.ALPHA_BYTE_OFFSET]==k;)t[d+c+z.RED_BYTE_OFFSET]=l,t[d+c+z.GREEN_BYTE_OFFSET]=f,t[d+c+z.BLUE_BYTE_OFFSET]=m,t[d+c+z.ALPHA_BYTE_OFFSET]=h,d-=z.BYTES_PER_PIXEL;if(d>=a.x1){for(;d<=a.x2&&(t[d+c+z.RED_BYTE_OFFSET]!=n||t[d+c+z.GREEN_BYTE_OFFSET]!=g||t[d+c+z.BLUE_BYTE_OFFSET]!=e||t[d+c+z.ALPHA_BYTE_OFFSET]!=k);)d+=z.BYTES_PER_PIXEL;
if(b=d+z.BYTES_PER_PIXEL,d>a.x2)continue}else(d+=z.BYTES_PER_PIXEL)<a.x1&&q.push({x1:d,x2:a.x1-z.BYTES_PER_PIXEL,y:a.y-a.dy,dy:-a.dy}),b=a.x1+z.BYTES_PER_PIXEL;do{t[d+c+z.RED_BYTE_OFFSET]=l;t[d+c+z.GREEN_BYTE_OFFSET]=f;t[d+c+z.BLUE_BYTE_OFFSET]=m;for(t[d+c+z.ALPHA_BYTE_OFFSET]=h;b<r.right&&t[b+c+z.RED_BYTE_OFFSET]==n&&t[b+c+z.GREEN_BYTE_OFFSET]==g&&t[b+c+z.BLUE_BYTE_OFFSET]==e&&t[b+c+z.ALPHA_BYTE_OFFSET]==k;)t[b+c+z.RED_BYTE_OFFSET]=l,t[b+c+z.GREEN_BYTE_OFFSET]=f,t[b+c+z.BLUE_BYTE_OFFSET]=m,t[b+c+
z.ALPHA_BYTE_OFFSET]=h,b+=z.BYTES_PER_PIXEL;q.push({x1:d,x2:b-z.BYTES_PER_PIXEL,y:a.y+a.dy,dy:a.dy});b-z.BYTES_PER_PIXEL>a.x2&&q.push({x1:a.x2+z.BYTES_PER_PIXEL,x2:b-z.BYTES_PER_PIXEL,y:a.y-a.dy,dy:-a.dy});for(d=b+z.BYTES_PER_PIXEL;d<=a.x2&&(t[d+c+z.RED_BYTE_OFFSET]!=n||t[d+c+z.GREEN_BYTE_OFFSET]!=g||t[d+c+z.BLUE_BYTE_OFFSET]!=e||t[d+c+z.ALPHA_BYTE_OFFSET]!=k);)d+=z.BYTES_PER_PIXEL;b=d+z.BYTES_PER_PIXEL}while(d<=a.x2)}}};z.prototype.copyPixelColumnToArray=function(a,c,d,b){var k=(this.width-1)*z.BYTES_PER_PIXEL,
n=0;a=this.offsetOfPixel(a,c);for(c=0;c<d;c++){for(var g=0;g<z.BYTES_PER_PIXEL;g++)b[n++]=this.data[a++];a+=k}};z.prototype.copyArrayToPixelColumn=function(a,c,d,b){var k=(this.width-1)*z.BYTES_PER_PIXEL,n=0;a=this.offsetOfPixel(a,c);for(c=0;c<d;c++){for(var g=0;g<z.BYTES_PER_PIXEL;g++)this.data[a++]=b[n++];a+=k}};z.prototype.boxBlur=function(a,c,d){let b=(a=this.getBounds().clipTo(a)).getWidth(),k=b*z.BYTES_PER_PIXEL,n=a.getHeight();var g=Math.max(b,n);let e=new Uint8Array(g*z.BYTES_PER_PIXEL);g=
new Uint8Array(g*z.BYTES_PER_PIXEL);for(let f=a.top;f<a.bottom;f++){var h=this.offsetOfPixel(a.left,f);for(var l=0;l<k;l++)e[l]=this.data[h++];!function(m,q){for(var r=0,t=0;t<q;t++){for(var u=m[r+z.ALPHA_BYTE_OFFSET],w=0;3>w;w++,r++)m[r]=Math.round(m[r]*u/255);r++}}(e,b);ue(e,g,b,c);h=this.offsetOfPixel(a.left,f);for(l=0;l<k;l++)this.data[h++]=g[l]}for(c=a.left;c<a.right;c++)this.copyPixelColumnToArray(c,a.top,n,e),ue(e,g,n,d),function(f,m){for(var q=0,r=0;r<m;r++){var t=f[q+z.ALPHA_BYTE_OFFSET];
if(0!=t){t=255/t;for(var u=0;3>u;u++,q++)f[q]=Math.min(Math.round(f[q]*t),255);q++}else q+=z.BYTES_PER_PIXEL}}(g,n),this.copyArrayToPixelColumn(c,a.top,n,g)};z.prototype.offsetOfPixel=function(a,c){return 4*(c*this.width+a)|0};z.prototype.getMemorySize=function(){return this.data.length};z.prototype.getImageData=function(){return this.imageData};z.prototype.setImageData=function(a){this.width=a.width;this.height=a.height;this.imageData=a;this.data=a.data};z.prototype.clearAll=function(a){if(0==a&&
"fill"in this.data)this.data.fill(0);else{var c=a>>24&255,d=a>>16&255,b=a>>8&255;a&=255;for(var k=0;k<this.width*this.height*z.BYTES_PER_PIXEL;)this.data[k++]=d,this.data[k++]=b,this.data[k++]=a,this.data[k++]=c}};z.prototype.clearRect=function(a,c){a=this.getBounds().clipTo(a);var d=c>>24&255,b=c>>16&255,k=c>>8&255;c&=255;for(var n=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,g=this.offsetOfPixel(a.left,a.top),e=a.top;e<a.bottom;e++,g+=n)for(var h=a.left;h<a.right;h++)this.data[g++]=b,this.data[g++]=
k,this.data[g++]=c,this.data[g++]=d};z.prototype.copyRegionHFlip=function(a,c){a=this.getBounds().clipTo(a);for(var d=a.top;d<a.bottom;d++)for(var b=this.offsetOfPixel(a.left,d),k=c.offsetOfPixel(a.right-1,d),n=a.left;n<a.right;n++,k-=2*z.BYTES_PER_PIXEL)for(var g=0;g<z.BYTES_PER_PIXEL;g++)this.data[b++]=c.data[k++]};z.prototype.copyRegionVFlip=function(a,c){for(var d=(a=this.getBounds().clipTo(a)).getWidth()*z.BYTES_PER_PIXEL,b=a.top;b<a.bottom;b++)for(var k=this.offsetOfPixel(a.left,b),n=c.offsetOfPixel(a.left,
a.bottom-1-(b-a.top)),g=0;g<d;g++)this.data[k++]=c.data[n++]};z.prototype.fillWithNoise=function(a){a=this.getBounds().clipTo(a);for(var c,d=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,b=this.offsetOfPixel(a.left,a.top),k=a.top;k<a.bottom;k++,b+=d)for(var n=a.left;n<a.right;n++,b+=z.BYTES_PER_PIXEL)c=256*Math.random()|0,this.data[b+z.RED_BYTE_OFFSET]=c,this.data[b+z.GREEN_BYTE_OFFSET]=c,this.data[b+z.BLUE_BYTE_OFFSET]=c,this.data[b+z.ALPHA_BYTE_OFFSET]=255};z.prototype.gradientHorzReplace=function(a,
c,d,b){var k={r:b[0]>>16&255,g:b[0]>>8&255,b:255&b[0],a:b[0]>>24&255};b={r:b[1]>>16&255,g:b[1]>>8&255,b:255&b[1],a:b[1]>>24&255};var n=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,g=0|this.offsetOfPixel(a.left,a.top),e=a.bottom-a.top|0;if(d<c){var h=d;d=c;c=h;h=k;k=b;b=h}var l=d-c|0;h=(b.r-k.r)/l;var f=(b.g-k.g)/l,m=(b.b-k.b)/l;l=(b.a-k.a)/l;for(var q=Math.max(a.left-c,0),r=0;r<e;r++,g+=n){for(var t=a.left,u=0|Math.min(c,a.right);t<u;t++,g+=z.BYTES_PER_PIXEL)this.data[g+z.RED_BYTE_OFFSET]=k.r,this.data[g+
z.GREEN_BYTE_OFFSET]=k.g,this.data[g+z.BLUE_BYTE_OFFSET]=k.b,this.data[g+z.ALPHA_BYTE_OFFSET]=k.a;var w=k.r+h*q,C=k.g+f*q,D=k.b+m*q,A=k.a+l*q;for(u=0|Math.min(d,a.right);t<u;t++,g+=z.BYTES_PER_PIXEL)this.data[g+z.RED_BYTE_OFFSET]=w,this.data[g+z.GREEN_BYTE_OFFSET]=C,this.data[g+z.BLUE_BYTE_OFFSET]=D,this.data[g+z.ALPHA_BYTE_OFFSET]=A,w+=h,C+=f,D+=m,A+=l;for(;t<a.right;t++,g+=z.BYTES_PER_PIXEL)this.data[g+z.RED_BYTE_OFFSET]=b.r,this.data[g+z.GREEN_BYTE_OFFSET]=b.g,this.data[g+z.BLUE_BYTE_OFFSET]=b.b,
this.data[g+z.ALPHA_BYTE_OFFSET]=b.a}};z.prototype.gradientVertReplace=function(a,c,d,b){var k={r:b[0]>>16&255,g:b[0]>>8&255,b:255&b[0],a:b[0]>>24&255};b={r:b[1]>>16&255,g:b[1]>>8&255,b:255&b[1],a:b[1]>>24&255};let n=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,g=0|this.offsetOfPixel(a.left,a.top),e=a.right-a.left|0;if(d<c){var h=d;d=c;c=h;h=k;k=b;b=h}h=a.top;for(var l=0|Math.min(a.bottom,c);h<l;h++,g+=n)for(var f=0;f<e;f++,g+=z.BYTES_PER_PIXEL)this.data[g+z.RED_BYTE_OFFSET]=k.r,this.data[g+z.GREEN_BYTE_OFFSET]=
k.g,this.data[g+z.BLUE_BYTE_OFFSET]=k.b,this.data[g+z.ALPHA_BYTE_OFFSET]=k.a;var m=d-c|0;l=(b.r-k.r)/m;f=(b.g-k.g)/m;var q=(b.b-k.b)/m;m=(b.a-k.a)/m;var r=Math.max(h-c,0);c=k.r+l*r;var t=k.g+f*r,u=k.b+q*r;k=k.a+m*r;for(d=0|Math.min(a.bottom,d);h<d;h++,g+=n){for(r=0;r<e;r++,g+=z.BYTES_PER_PIXEL)this.data[g+z.RED_BYTE_OFFSET]=c,this.data[g+z.GREEN_BYTE_OFFSET]=t,this.data[g+z.BLUE_BYTE_OFFSET]=u,this.data[g+z.ALPHA_BYTE_OFFSET]=k;c+=l;t+=f;u+=q;k+=m}for(;h<a.bottom;h++,g+=n)for(d=0;d<e;d++,g+=z.BYTES_PER_PIXEL)this.data[g+
z.RED_BYTE_OFFSET]=b.r,this.data[g+z.GREEN_BYTE_OFFSET]=b.g,this.data[g+z.BLUE_BYTE_OFFSET]=b.b,this.data[g+z.ALPHA_BYTE_OFFSET]=b.a};z.prototype.gradientReplace=function(a,c,d,b,k,n){var g=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,e=0|this.offsetOfPixel(a.left,a.top),h=a.right-a.left|0,l=n[0]>>16&255,f=n[0]>>8&255,m=255&n[0],q=n[0]>>24&255,r=n[1]>>16&255,t=n[1]>>8&255,u=255&n[1];n=n[1]>>24&255;var w=k-d+(b-c)*(b-c)/(k-d);b=b-c+(k-d)*(k-d)/(b-c);k=1/b;for(var C=a.top;C<a.bottom;C++,e+=g)for(var D=
(a.left-c)/b+(C-d)/w,A=0;A<h;A++,e+=z.BYTES_PER_PIXEL){var F=Math.min(Math.max(D,0),1),J=1-F;this.data[e+z.RED_BYTE_OFFSET]=l*J+r*F;this.data[e+z.GREEN_BYTE_OFFSET]=f*J+t*F;this.data[e+z.BLUE_BYTE_OFFSET]=m*J+u*F;this.data[e+z.ALPHA_BYTE_OFFSET]=q*J+n*F;D+=k}};z.prototype.gradientAlpha=function(a,c,d,b,k,n){var g=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,e=0|this.offsetOfPixel(a.left,a.top),h=a.right-a.left|0,l=n[0]>>16&255,f=n[0]>>8&255,m=255&n[0],q=n[0]>>24&255,r=n[1]>>16&255,t=n[1]>>8&255,u=
255&n[1];n=n[1]>>24&255;var w=k-d+(b-c)*(b-c)/(k-d);b=b-c+(k-d)*(k-d)/(b-c);k=1/b;for(var C=a.top;C<a.bottom;C++,e+=g)for(var D=(a.left-c)/b+(C-d)/w,A=0;A<h;A++,e+=z.BYTES_PER_PIXEL){var F=Math.min(Math.max(D,0),1),J=1-F,N=l*J+r*F,L=f*J+t*F,M=m*J+u*F;J=q*J+n*F;F=this.data[e+z.ALPHA_BYTE_OFFSET];F=J+F-J*F/255|0;if(0<F){J=255*J/F|0;var X=255-J;this.data[e+z.RED_BYTE_OFFSET]=(N*J+this.data[e+z.RED_BYTE_OFFSET]*X)/255|0;this.data[e+z.GREEN_BYTE_OFFSET]=(L*J+this.data[e+z.GREEN_BYTE_OFFSET]*X)/255|0;this.data[e+
z.BLUE_BYTE_OFFSET]=(M*J+this.data[e+z.BLUE_BYTE_OFFSET]*X)/255|0;this.data[e+z.ALPHA_BYTE_OFFSET]=F}D+=k}};z.prototype.gradient=function(a,c,d,b,k,n,g){a=this.getBounds().clipTo(a);(c!=b||d!=k)&&(g||255==n[0]>>>24&&255==n[1]>>>24?c==b?this.gradientVertReplace(a,d,k,n):d==k?this.gradientHorzReplace(a,c,b,n):this.gradientReplace(a,c,d,b,k,n):this.gradientAlpha(a,c,d,b,k,n))};z.prototype.fillWithColorNoise=function(a){a=this.getBounds().clipTo(a);for(var c,d=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,
b=this.offsetOfPixel(a.left,a.top),k=a.top;k<a.bottom;k++,b+=d)for(var n=a.left;n<a.right;n++,b+=z.BYTES_PER_PIXEL)c=16777216*Math.random()|0,this.data[b+z.RED_BYTE_OFFSET]=c>>16&255,this.data[b+z.GREEN_BYTE_OFFSET]=c>>8&255,this.data[b+z.BLUE_BYTE_OFFSET]=255&c,this.data[b+z.ALPHA_BYTE_OFFSET]=255};z.prototype.invert=function(a){a=this.getBounds().clipTo(a);for(var c=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,d=this.offsetOfPixel(a.left,a.top),b=a.top;b<a.bottom;b++,d+=c)for(var k=a.left;k<a.right;k++,
d+=z.BYTES_PER_PIXEL)this.data[d+z.RED_BYTE_OFFSET]^=255,this.data[d+z.GREEN_BYTE_OFFSET]^=255,this.data[d+z.BLUE_BYTE_OFFSET]^=255};z.prototype.brightnessToOpacity=function(a){a=this.getBounds().clipTo(a);let c=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,d=this.offsetOfPixel(a.left,a.top);for(let k=a.top;k<a.bottom;k++,d+=c)for(let n=a.left;n<a.right;n++,d+=z.BYTES_PER_PIXEL){var b=void 0;b=(this.data[d+z.RED_BYTE_OFFSET]+this.data[d+z.GREEN_BYTE_OFFSET]+this.data[d+z.BLUE_BYTE_OFFSET])/3;let g=
this.data[d+z.ALPHA_BYTE_OFFSET]/255;b=250<b?0:Math.round(255*(1-b/250));this.data[d+z.ALPHA_BYTE_OFFSET]=Math.round(b*g);0<b&&(this.data[d+z.RED_BYTE_OFFSET]=0,this.data[d+z.GREEN_BYTE_OFFSET]=0,this.data[d+z.BLUE_BYTE_OFFSET]=0)}};z.prototype.getNonTransparentBounds=function(a){var c,d,b=a.clone();var k=(this.width-b.getWidth())*z.BYTES_PER_PIXEL;a=this.offsetOfPixel(b.left,b.top)+z.ALPHA_BYTE_OFFSET;for(d=b.top;d<b.bottom;d++,a+=k){var n=0;for(c=b.left;c<b.right;c++,a+=z.BYTES_PER_PIXEL)n|=this.data[a];
if(0!=n)break}if(b.top=d,b.top==b.bottom)return b;a=this.offsetOfPixel(b.right-1,b.bottom-1)+z.ALPHA_BYTE_OFFSET;for(d=b.bottom-1;d>=b.top;d--,a-=k){n=0;for(c=b.right-1;c>=b.left;c--,a-=z.BYTES_PER_PIXEL)n|=this.data[a];if(0!=n)break}b.bottom=d+1;k=z.BYTES_PER_PIXEL*this.width;for(c=b.left;c<b.right;c++){a=this.offsetOfPixel(c,b.top)+z.ALPHA_BYTE_OFFSET;n=0;for(d=b.top;d<b.bottom;d++,a+=k)n|=this.data[a];if(0!=n)break}b.left=c;for(c=b.right-1;c>=b.left;c--){a=this.offsetOfPixel(c,b.top)+z.ALPHA_BYTE_OFFSET;
n=0;for(d=b.top;d<b.bottom;d++,a+=k)n|=this.data[a];if(0!=n)break}return b.right=c+1,b};z.prototype.getAsCanvas=function(a){var c=pc(this.imageData.width,this.imageData.height);return c.getContext("2d").putImageData(this.imageData,0,0),ve(c,a||0)};z.prototype.getAsPNG=function(a){var c;return"string"==typeof(c=this.getAsCanvas(a).toDataURL("image/png"))&&!!c.match(/^data:image\/png;base64,/i)&&window.atob(c.substring(22))};z.prototype.getAsPNGBuffer=function(a){return this.getAsCanvas(a).toBuffer("image/png")};
z.prototype.hasAlphaInRect=function(a){a=this.getBounds().clipTo(a);for(var c=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,d=this.offsetOfPixel(a.left,a.top)+z.ALPHA_BYTE_OFFSET,b=a.top;b<a.bottom;b++,d+=c){for(var k=255,n=a.left;n<a.right;n++,d+=z.BYTES_PER_PIXEL)k&=this.data[d];if(255!=k)return!0}return!1};z.prototype.hasAlpha=function(){return this.hasAlphaInRect(this.getBounds())};z.createFromImage=function(a){var c=pc(a.width,a.height).getContext("2d");return c.globalCompositeOperation="copy",
c.drawImage(a,0,0),new z(c.getImageData(0,0,a.width,a.height))};z.prototype.equals=function(a){if(this.width!=a.width||this.height!=a.height)return!1;for(let c=0;c<this.data.length;c+=z.BYTES_PER_PIXEL)if(!(0==this.data[c+z.ALPHA_BYTE_OFFSET]&&0==a.data[c+z.ALPHA_BYTE_OFFSET]||this.data[c]==a.data[c]&&this.data[c+1]==a.data[c+1]&&this.data[c+2]==a.data[c+2]&&this.data[c+3]==a.data[c+3]))return!1;return!0};Ua.prototype=Object.create(Ya.prototype);Ua.prototype.constructor=Ua;Ua.prototype.getLinearizedLayerList=
function(a,c){for(let d of(c=c||[],this.layers))d instanceof Ua&&(d.expanded||!a)&&d.getLinearizedLayerList(a,c),c.push(d);return c};Ua.prototype.clearLayers=function(){this.layers=[]};Ua.prototype.addLayer=function(a){a.parent=this;this.layers.push(a)};Ua.prototype.insertLayer=function(a,c){c.parent=this;this.layers.splice(a,0,c)};Ua.prototype.removeLayer=function(a){a=this.layers.indexOf(a);-1<a&&this.layers.splice(a,1)};Ua.prototype.removeLayerAtIndex=function(a){var c=this.layers[a];return c&&
this.layers.splice(a,1),c};Ua.prototype.setLayerAtIndex=function(a,c){var d=this.layers[a];return c.parent=this,this.layers[a]=c,d};Ua.prototype.setExpanded=function(a){this.expanded=a};Ua.prototype.getExpanded=function(){return this.expanded};Ua.prototype.indexOf=function(a){return this.layers.indexOf(a)};Ua.prototype.getMemoryUsed=function(){return this.layers.map(a=>a.getMemoryUsed()).reduce(Mf,0)};Ua.prototype.clone=function(){var a=new Ua(this.name,this.blendMode);return Ya.prototype.copyFrom.call(a,
this),a.expanded=this.expanded,a.layers=this.layers.map(c=>c.clone()),a.layers.forEach(c=>c.parent=a),a};Ua.prototype.getNonTransparentBounds=function(a){var c=new oa(0,0,0,0);return this.layers.forEach(d=>c.union(d.getNonTransparentBounds(a))),c};Ea.prototype=Object.create(Gc.prototype);Ea.prototype.constructor=Ea;Ea.prototype.createBitmap=function(a,c,d){switch(this.bitDepth=d,d){case 32:this.data=new Uint32Array(a*c);break;case 16:this.data=new Uint16Array(a*c);break;default:this.data=new Uint8Array(a*
c)}};Ea.prototype.clone=function(){var a=new Ea(this.width,this.height,this.bitDepth);return a.copyPixelsFrom(this),a};Ea.prototype.cloneRect=function(a){var c=new Ea(a.getWidth(),a.getHeight(),this.bitDepth);return c.copyBitmapRect(this,0,0,a),c};Ea.prototype.getPixel=function(a,c){return a=Math.max(0,Math.min(this.width-1,a)),c=Math.max(0,Math.min(this.height-1,c)),this.data[this.offsetOfPixel(a,c)]};Ea.prototype.clearAll=function(a){this.data.fill(a)};Ea.prototype.clearRect=function(a,c){if((a=
this.getBounds().clipTo(a)).equals(this.getBounds()))this.clearAll(c);else{let d=this.width,b=a.right-a.left,k=this.offsetOfPixel(a.left,a.top);for(let n=a.top;n<a.bottom;n++,k+=d)this.data.fill(c,k,k+b)}};Ea.prototype.copyScaledNearestNeighbor=function(a){for(var c,d=0,b=a.width/this.width,k=a.height/this.height,n=0,g=0;n<this.height;n++,g+=k){c=a.offsetOfPixel(0,Math.round(g));for(var e=0,h=0;e<this.width;e++,d++,h+=b)this.data[d]=a.data[c+Math.round(h)]}};Ea.prototype.floodFill=function(a,c,d){if(this.isInside(a,
c)){d&=255;var b=this.getPixel(a,c),k=[],n=this.getBounds(),g=this.data;if(k.push({x1:a,x2:a,y:c,dy:-1}),k.push({x1:a,x2:a,y:c+1,dy:1}),d!=b)for(;0<k.length;){a=k.pop();if(a.y<n.top||a.y>=n.bottom)continue;c=this.offsetOfPixel(0,a.y);let e=a.x1,h;for(;e>=n.left&&g[e+c]==b;)g[e+c]=d,e--;if(e>=a.x1){for(;e<=a.x2&&g[e+c]!=b;)e++;if(h=e+1,e>a.x2)continue}else++e<a.x1&&k.push({x1:e,x2:a.x1-1,y:a.y-a.dy,dy:-a.dy}),h=a.x1+1;do{for(g[e+c]=d;h<n.right&&g[h+c]==b;)g[h+c]=d,h++;k.push({x1:e,x2:h-1,y:a.y+a.dy,
dy:a.dy});h-1>a.x2&&k.push({x1:a.x2+1,x2:h-1,y:a.y-a.dy,dy:-a.dy});for(e=h+1;e<=a.x2&&g[e+c]!=b;)e++;h=e+1}while(e<=a.x2)}}};Ea.prototype.createThumbnailFrom=function(a){let c=Math.min(Math.floor(a.width/this.width),3);if(2>c)return void this.copyScaledNearestNeighbor(a);let d=new Uint16Array(this.width);var b=a.width,k=Math.floor(a.width/this.width);let n=Math.floor(a.width/this.width/c),g=k-n*c;var e=Math.floor(a.height/this.height/c);k=e*b-k*this.width;b*=Math.floor(a.height/this.height)-e*c;let h=
e=0;for(let f=0;f<this.height;f++,e+=b){let m;d.fill(0);for(var l=0;l<c;l++,e+=k){m=0;for(let q=0;q<this.width;q++,m++,e+=g)for(let r=0;r<c;r++,e+=n)d[m]+=a.data[e]}m=0;for(l=0;l<this.width;l++,m++,h++)this.data[h]=d[m]/(c*c)}};Ea.prototype.mirrorHorizontally=function(){let a=this.width,c=this.height,d=new Uint8Array(a*c),b=0,k=a;for(let n=0;n<c;n++,k+=a+a)for(let g=0;g<a;g++)d[b++]=this.data[--k];this.data=d};Ea.prototype.applyLUT=function(a){for(var c=0;c<this.data.length;c++)this.data[c]=a.table[this.data[c]]};
Ea.prototype.getAsCanvas=function(a){var c=this.getImageData(0,0,this.width,this.height),d=pc(this.width,this.height);return d.getContext("2d").putImageData(c,0,0),ve(d,a||0)};Ea.prototype.getImageData=function(a,c,d,b){let k=Pd(d,b);a=this.offsetOfPixel(a,c);c=0;let n=this.width-d;for(let g=0;g<b;g++,a+=n)for(let e=0;e<d;e++,a++)k.data[c++]=this.data[a],k.data[c++]=this.data[a],k.data[c++]=this.data[a],k.data[c++]=255;return k};Ea.prototype.pasteImageData=function(a,c,d){let b=0;c=this.offsetOfPixel(c,
d);d=this.width-a.width;for(let k=0;k<a.height;k++,c+=d)for(let n=0;n<a.width;n++,b+=4,c++)this.data[c]=a.data[b];return a};Ea.prototype.copyPixelsFrom=function(a){a.width!=this.width||a.height!=this.height||a.bitDepth!=this.bitDepth?(this.data=a.data.slice(0),this.width=a.width,this.height=a.height,this.bitDepth=a.bitDepth):this.data.set(a.data)};Ea.prototype.copyRectXOR=function(a,c){for(var d=(c=this.getBounds().clipTo(c)).getWidth(),b=new Uint8Array(d*c.getHeight()),k=0,n=this.offsetOfPixel(c.left,
c.top),g=a.offsetOfPixel(c.left,c.top),e=this.width-d,h=a.width-d,l=c.top;l<c.bottom;l++,n+=e,g+=h)for(var f=0;f<d;f++,k++,n++,g++)b[k]=this.data[n]^a.data[g];return b};Ea.prototype.setRectXOR=function(a,c){var d=(c=this.getBounds().clipTo(c)).getWidth(),b=c.getHeight();c=this.offsetOfPixel(c.left,c.top);for(var k=0,n=this.width-d,g=0;g<b;g++){for(var e=0;e<d;e++)this.data[c++]^=a[k++];c+=n}};Ea.prototype.copyBitmapRect=function(a,c,d,b){var k=new oa(c,d,0,0);b=b.clone();this.getBounds().clipSourceDest(b,
k);c=0|k.getWidth();d=0|k.getHeight();if(0==k.left&&0==k.top&&c==this.width&&d==this.height&&c==a.width&&d==a.height)this.copyPixelsFrom(a);else{k=this.offsetOfPixel(k.left,k.top);var n=this.width-c;b=a.offsetOfPixel(b.left,b.top);for(var g=a.width-c,e=0;e<d;e++,b+=g,k+=n)for(var h=0;h<c;h++,b++,k++)this.data[k]=a.data[b]}};Ea.prototype.copyRegionHFlip=function(a,c){a=this.getBounds().clipTo(a);for(var d=a.top;d<a.bottom;d++)for(var b=this.offsetOfPixel(a.left,d),k=c.offsetOfPixel(a.right-1,d),n=
a.left;n<a.right;n++,k-=2)this.data[b++]=c.data[k++]};Ea.prototype.copyRegionVFlip=function(a,c){for(var d=(a=this.getBounds().clipTo(a)).getWidth(),b=a.top;b<a.bottom;b++)for(var k=this.offsetOfPixel(a.left,b),n=c.offsetOfPixel(a.left,a.bottom-1-(b-a.top)),g=0;g<d;g++)this.data[k++]=c.data[n++]};Ea.prototype.copyPixelColumnToArray=function(a,c,d,b){var k=this.width,n=0;a=this.offsetOfPixel(a,c);for(c=0;c<d;c++)b[n]=this.data[a],a+=k,n++};Ea.prototype.copyArrayToPixelColumn=function(a,c,d,b){var k=
this.width,n=0;a=this.offsetOfPixel(a,c);for(c=0;c<d;c++)this.data[a]=b[n],a+=k,n++};Ea.prototype.boxBlur=function(a,c,d){let b=(a=this.getBounds().clipTo(a)).getWidth(),k=a.getHeight();var n=Math.max(b,k);let g=new this.data.constructor(n);n=new this.data.constructor(n);for(let l=a.top;l<a.bottom;l++){var e=this.offsetOfPixel(a.left,l);for(var h=0;h<b;h++)g[h]=this.data[e++];we(g,n,b,c);e=this.offsetOfPixel(a.left,l);for(h=0;h<b;h++)this.data[e++]=n[h]}for(c=a.left;c<a.right;c++)this.copyPixelColumnToArray(c,
a.top,k,g),we(g,n,k,d),this.copyArrayToPixelColumn(c,a.top,k,n)};Ea.prototype.offsetOfPixel=function(a,c){return c*this.width+a};Ea.prototype.fillWithNoise=function(a){a=this.getBounds().clipTo(a);for(var c=this.width-a.getWidth(),d=this.offsetOfPixel(a.left,a.top),b=a.top;b<a.bottom;b++,d+=c)for(var k=a.left;k<a.right;k++,d++)this.data[d]=256*Math.random()|0};Ea.prototype.invert=function(a){a=this.getBounds().clipTo(a);for(var c=this.width-a.getWidth(),d=this.offsetOfPixel(a.left,a.top),b=a.top;b<
a.bottom;b++,d+=c)for(var k=a.left;k<a.right;k++,d++)this.data[d]=~this.data[d]};Ea.prototype.brightnessToOpacity=function(a){a=this.getBounds().clipTo(a);let c=(this.width-a.getWidth())*Ea.BYTES_PER_PIXEL,d=this.offsetOfPixel(a.left,a.top);for(let k=a.top;k<a.bottom;k++,d+=c)for(let n=a.left;n<a.right;n++,d++){var b=void 0;b=this.data[d];let g=this.data[d+Ea.ALPHA_BYTE_OFFSET]/255;b=250<b?0:Math.round(255*(1-b/250));this.data[d+Ea.ALPHA_BYTE_OFFSET]=Math.round(b*g);0<b&&(this.data[d]=0)}};Ea.prototype.getValueBounds=
function(a,c){var d,b,k=a.clone();var n=this.width-k.getWidth();a=this.offsetOfPixel(k.left,k.top);for(b=k.top;b<k.bottom;b++,a+=n){var g=!1;for(d=k.left;d<k.right;d++,a++)if(this.data[a]!=c){g=!0;break}if(g)break}if(k.top=b,k.top==k.bottom)return k;a=this.offsetOfPixel(k.right-1,k.bottom-1);for(b=k.bottom-1;b>=k.top;b--,a-=n){g=!1;for(d=k.right-1;d>=k.left;d--,a--)if(this.data[a]!=c){g=!0;break}if(g)break}k.bottom=b+1;n=this.width;for(d=k.left;d<k.right;d++){a=this.offsetOfPixel(d,k.top);g=!1;for(b=
k.top;b<k.bottom;b++,a+=n)if(this.data[a]!=c){g=!0;break}if(g)break}k.left=d;for(d=k.right-1;d>=k.left;d--){a=this.offsetOfPixel(d,k.top);g=!1;for(b=k.top;b<k.bottom;b++,a+=n)if(this.data[a]!=c){g=!0;break}if(g)break}return k.right=d+1,k};Ea.prototype.gradientHorzReplace=function(a,c,d,b){var k=255&b[0];b=255&b[1];var n=this.width-a.getWidth(),g=0|this.offsetOfPixel(a.left,a.top),e=a.bottom-a.top|0;if(d<c){var h=d;d=c;c=h;h=k;k=b;b=h}h=(b-k)/(d-c|0);for(var l=Math.max(a.left-c,0),f=0;f<e;f++,g+=n){for(var m=
a.left,q=0|Math.min(c,a.right);m<q;m++,g++)this.data[g]=k;var r=k+h*l;for(q=0|Math.min(d,a.right);m<q;m++,g++)this.data[g]=r,r+=h;for(;m<a.right;m++,g++)this.data[g]=b}};Ea.prototype.gradientVertReplace=function(a,c,d,b){var k=255&b[0];b=255&b[1];let n=this.width-a.getWidth(),g=0|this.offsetOfPixel(a.left,a.top),e=a.right-a.left|0;if(d<c){var h=d;d=c;c=h;h=k;k=b;b=h}h=a.top;for(var l=0|Math.min(a.bottom,c);h<l;h++,g+=n)for(let f=0;f<e;f++,g++)this.data[g]=k;l=(b-k)/(d-c|0);c=k+l*Math.max(h-c,0);for(d=
0|Math.min(a.bottom,d);h<d;h++,g+=n){for(k=0;k<e;k++,g++)this.data[g]=c;c+=l}for(;h<a.bottom;h++,g+=n)for(d=0;d<e;d++,g++)this.data[g]=b};Ea.prototype.gradientReplace=function(a,c,d,b,k,n){var g=this.width-a.getWidth(),e=0|this.offsetOfPixel(a.left,a.top),h=a.right-a.left|0,l=255&n[0];n=255&n[1];var f=k-d+(b-c)*(b-c)/(k-d);b=b-c+(k-d)*(k-d)/(b-c);k=1/b;for(var m=a.top;m<a.bottom;m++,e+=g)for(var q=(a.left-c)/b+(m-d)/f,r=0;r<h;r++,e++){var t=Math.min(Math.max(q,0),1);this.data[e]=l*(1-t)+n*t;q+=k}};
Ea.prototype.gradientAlpha=function(a,c,d,b,k,n){var g=this.width-a.getWidth(),e=0|this.offsetOfPixel(a.left,a.top),h=a.right-a.left|0,l=255&n[0],f=n[0]>>24&255,m=255&n[1];n=n[1]>>24&255;var q=k-d+(b-c)*(b-c)/(k-d);b=b-c+(k-d)*(k-d)/(b-c);k=1/b;for(var r=a.top;r<a.bottom;r++,e+=g)for(var t=(a.left-c)/b+(r-d)/q,u=0;u<h;u++,e++){var w=Math.min(Math.max(t,0),1),C=1-w,D=f*C+n*w;this.data[e]=((l*C+m*w)*D+this.data[e]*(255-D))/255|0;t+=k}};Ea.prototype.gradient=function(a,c,d,b,k,n,g){a=this.getBounds().clipTo(a);
(c!=b||d!=k)&&(g||255==n[0]>>>24&&255==n[1]>>>24?c==b?this.gradientVertReplace(a,d,k,n):d==k?this.gradientHorzReplace(a,c,b,n):this.gradientReplace(a,c,d,b,k,n):this.gradientAlpha(a,c,d,b,k,n))};Ea.prototype.equals=function(a){if(this.width!=a.width||this.height!=a.height)return!1;for(let c=0;c<this.data.length;c++)if(this.data[c]!=a.data[c])return!1;return!0};let tb=Array(256),ub=Array(256);G.multiplyOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-
k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3],l;h&&(l=a.data[b],a.data[b]=l-((255^c.data[b])*l*h/65025|0),l=a.data[b+1],a.data[b+1]=l-((255^c.data[b+1])*l*h/65025|0),l=a.data[b+2],a.data[b+2]=l-((255^c.data[b+2])*l*h/65025|0))}};G.multiplyOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=
c.data[b+3]*d/100|0,f;l&&(f=a.data[b],a.data[b]=f-((255^c.data[b])*f*l/65025|0),f=a.data[b+1],a.data[b+1]=f-((255^c.data[b+1])*f*l/65025|0),f=a.data[b+2],a.data[b+2]=f-((255^c.data[b+2])*f*l/65025|0))}};G.multiplyOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let h=0;h<k;h++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,q=g*l/255|0,r=g*(255^
l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(g*r+f*t+(g*f*q/255|0))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(g*r+f*t+(g*f*q/255|0))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(g*r+f*t+(g*f*q/255|0))/m|0;a.data[b+3]=m}}};G.multiplyOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let h=0;h<k;h++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let q=e+
(f=a.data[b+3])-(e*f/255|0)|0,r=e*f/255|0,t=e*(255^f)/255|0,u=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(e*t+m*u+(e*m*r/255|0))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(e*t+m*u+(e*m*r/255|0))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(e*t+m*u+(e*m*r/255|0))/q|0;a.data[b+3]=q}}};G.multiplyOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=
0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0,q;m&&(q=a.data[e],a.data[e]=q-((255^c.data[e])*q*m/65025|0),q=a.data[e+1],a.data[e+1]=q-((255^c.data[e+1])*q*m/65025|0),q=a.data[e+2],a.data[e+2]=q-((255^c.data[e+2])*q*m/65025|0))}};G.multiplyOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=
e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,r;q&&(r=a.data[h],a.data[h]=r-((255^c.data[h])*r*q/65025|0),r=a.data[h+1],a.data[h+1]=r-((255^c.data[h+1])*r*q/65025|0),r=a.data[h+2],a.data[h+2]=r-((255^c.data[h+2])*r*q/65025|0))}};G.multiplyOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=h)for(let m=
0;m<n;m++,e+=4,b++){var l=c.data[e+3]*k.data[b]/255|0;let q,r;if(l){let t=l+(q=a.data[e+3])-(l*q/255|0)|0,u=l*q/255|0,w=l*(255^q)/255|0,C=(255^l)*q/255|0;l=c.data[e];r=a.data[e];a.data[e]=(l*w+r*C+(l*r*u/255|0))/t|0;l=c.data[e+1];r=a.data[e+1];a.data[e+1]=(l*w+r*C+(l*r*u/255|0))/t|0;l=c.data[e+2];r=a.data[e+2];a.data[e+2]=(l*w+r*C+(l*r*u/255|0))/t|0;a.data[e+3]=t}}};G.multiplyOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|
0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,h+=e,b+=l)for(let q=0;q<g;q++,h+=4,b++){var f=c.data[h+3]*k.data[b]*d/25500|0;let r,t;if(f){let u=f+(r=a.data[h+3])-(f*r/255|0)|0,w=f*r/255|0,C=f*(255^r)/255|0,D=(255^f)*r/255|0;f=c.data[h];t=a.data[h];a.data[h]=(f*C+t*D+(f*t*w/255|0))/u|0;f=c.data[h+1];t=a.data[h+1];a.data[h+1]=(f*C+t*D+(f*t*w/255|0))/u|0;f=c.data[h+2];t=a.data[h+2];a.data[h+2]=(f*C+t*D+(f*t*w/255|0))/u|0;a.data[h+3]=u}}};G.multiply2OntoOpaqueFusionWithOpaqueLayer=
function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3],l;h&&(l=a.data[b],a.data[b]=l-Math.ceil((255^c.data[b])*l*h/65025),l=a.data[b+1],a.data[b+1]=l-Math.ceil((255^c.data[b+1])*l*h/65025),l=a.data[b+2],a.data[b+2]=l-Math.ceil((255^c.data[b+2])*l*h/65025))}};G.multiply2OntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|
0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f;l&&(f=a.data[b],a.data[b]=f-Math.ceil((255^c.data[b])*f*l/65025),f=a.data[b+1],a.data[b+1]=f-Math.ceil((255^c.data[b+1])*f*l/65025),f=a.data[b+2],a.data[b+2]=f-Math.ceil((255^c.data[b+2])*f*l/65025))}};G.multiply2OntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let h=
0;h<k;h++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,q=g*l/255|0,r=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(g*r+f*t+(g*f*q/255|0))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(g*r+f*t+(g*f*q/255|0))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(g*r+f*t+(g*f*q/255|0))/m|0;a.data[b+3]=m}}};G.multiply2OntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,
b.top);for(let h=0;h<k;h++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let q=e+(f=a.data[b+3])-(e*f/255|0)|0,r=e*f/255|0,t=e*(255^f)/255|0,u=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(e*t+m*u+(e*m*r/255|0))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(e*t+m*u+(e*m*r/255|0))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(e*t+m*u+(e*m*r/255|0))/q|0;a.data[b+3]=q}}};G.multiply2OntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),
g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0,q;m&&(q=a.data[e],a.data[e]=q-Math.ceil((255^c.data[e])*q*m/65025),q=a.data[e+1],a.data[e+1]=q-Math.ceil((255^c.data[e+1])*q*m/65025),q=a.data[e+2],a.data[e+2]=q-Math.ceil((255^c.data[e+2])*q*m/65025))}};G.multiply2OntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),
e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,r;q&&(r=a.data[h],a.data[h]=r-Math.ceil((255^c.data[h])*r*q/65025),r=a.data[h+1],a.data[h+1]=r-Math.ceil((255^c.data[h+1])*r*q/65025),r=a.data[h+2],a.data[h+2]=r-Math.ceil((255^c.data[h+2])*r*q/65025))}};G.multiply2OntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|
b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=h)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*k.data[b]/255|0;let q,r;if(l){let t=l+(q=a.data[e+3])-(l*q/255|0)|0,u=l*q/255|0,w=l*(255^q)/255|0,C=(255^l)*q/255|0;l=c.data[e];r=a.data[e];a.data[e]=(l*w+r*C+(l*r*u/255|0))/t|0;l=c.data[e+1];r=a.data[e+1];a.data[e+1]=(l*w+r*C+(l*r*u/255|0))/t|0;l=c.data[e+2];r=a.data[e+2];a.data[e+2]=(l*w+r*C+(l*r*u/255|0))/
t|0;a.data[e+3]=t}}};G.multiply2OntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,h+=e,b+=l)for(let q=0;q<g;q++,h+=4,b++){var f=c.data[h+3]*k.data[b]*d/25500|0;let r,t;if(f){let u=f+(r=a.data[h+3])-(f*r/255|0)|0,w=f*r/255|0,C=f*(255^r)/255|0,D=(255^f)*r/255|0;f=c.data[h];t=a.data[h];a.data[h]=(f*C+t*D+(f*t*w/255|0))/u|0;f=
c.data[h+1];t=a.data[h+1];a.data[h+1]=(f*C+t*D+(f*t*w/255|0))/u|0;f=c.data[h+2];t=a.data[h+2];a.data[h+2]=(f*C+t*D+(f*t*w/255|0))/u|0;a.data[h+3]=u}}};G.normalOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3],l;if(h)if(255==h)a.data[b]=c.data[b],a.data[b+1]=c.data[b+1],a.data[b+2]=c.data[b+2];else{let f=255-h;l=c.data[b];a.data[b]=(l*h+a.data[b]*
f)/255|0;l=c.data[b+1];a.data[b+1]=(l*h+a.data[b+1]*f)/255|0;l=c.data[b+2];a.data[b+2]=(l*h+a.data[b+2]*f)/255|0}}};G.normalOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f;if(l){let m=255-l;f=c.data[b];a.data[b]=(f*l+a.data[b]*m)/255|0;f=c.data[b+1];a.data[b+1]=(f*l+a.data[b+1]*m)/255|0;f=c.data[b+2];a.data[b+2]=(f*l+a.data[b+
2]*m)/255|0}}};G.normalOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let h=0;h<k;h++,b+=4){var g=c.data[b+3];let l;if(g){let f=g+(l=a.data[b+3])-(g*l/255|0)|0;g=255*g/f|0;let m=255-g;a.data[b]=(c.data[b]*g+a.data[b]*m)/255|0;a.data[b+1]=(c.data[b+1]*g+a.data[b+1]*m)/255|0;a.data[b+2]=(c.data[b+2]*g+a.data[b+2]*m)/255|0;a.data[b+3]=f}}};G.normalOntoTransparentFusionWithTransparentLayer=
function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let h=0;h<k;h++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f;if(e){let m=e+(f=a.data[b+3])-(e*f/255|0)|0;e=255*e/m|0;let q=255-e;a.data[b]=(c.data[b]*e+a.data[b]*q)/255|0;a.data[b+1]=(c.data[b+1]*e+a.data[b+1]*q)/255|0;a.data[b+2]=(c.data[b+2]*e+a.data[b+2]*q)/255|0;a.data[b+3]=m}}};G.normalOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=
0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0,q;if(m)if(255==m)a.data[e]=c.data[e],a.data[e+1]=c.data[e+1],a.data[e+2]=c.data[e+2];else{let r=255-m;q=c.data[e];a.data[e]=(q*m+a.data[e]*r)/255|0;q=c.data[e+1];a.data[e+1]=(q*m+a.data[e+1]*r)/255|0;q=c.data[e+2];a.data[e+2]=(q*m+a.data[e+2]*r)/255|0}}};G.normalOntoOpaqueFusionWithTransparentLayerMasked=
function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,r;if(q){let t=255-q;r=c.data[h];a.data[h]=(r*q+a.data[h]*t)/255|0;r=c.data[h+1];a.data[h+1]=(r*q+a.data[h+1]*t)/255|0;r=c.data[h+2];a.data[h+2]=(r*q+a.data[h+2]*t)/255|0}}};G.normalOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=
0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=h)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*k.data[b]/255|0;let q;if(l){let r=l+(q=a.data[e+3])-(l*q/255|0)|0;l=255*l/r|0;let t=255-l;a.data[e]=(c.data[e]*l+a.data[e]*t)/255|0;a.data[e+1]=(c.data[e+1]*l+a.data[e+1]*t)/255|0;a.data[e+2]=(c.data[e+2]*l+a.data[e+2]*t)/255|0;a.data[e+3]=r}}};G.normalOntoTransparentFusionWithTransparentLayerMasked=
function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,h+=e,b+=l)for(let q=0;q<g;q++,h+=4,b++){var f=c.data[h+3]*k.data[b]*d/25500|0;let r;if(f){let t=f+(r=a.data[h+3])-(f*r/255|0)|0;f=255*f/t|0;let u=255-f;a.data[h]=(c.data[h]*f+a.data[h]*u)/255|0;a.data[h+1]=(c.data[h+1]*f+a.data[h+1]*u)/255|0;a.data[h+2]=(c.data[h+2]*f+a.data[h+2]*u)/255|0;a.data[h+3]=t}}};G.addOntoOpaqueFusionWithOpaqueLayer=
function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3];h&&(a.data[b]=a.data[b]+h*c.data[b]/255|0,a.data[b+1]=a.data[b+1]+h*c.data[b+1]/255|0,a.data[b+2]=a.data[b+2]+h*c.data[b+2]/255|0)}};G.addOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<
n;h++,b+=4){let l=c.data[b+3]*d/100|0;l&&(a.data[b]=a.data[b]+l*c.data[b]/255|0,a.data[b+1]=a.data[b+1]+l*c.data[b+1]/255|0,a.data[b+2]=a.data[b+2]+l*c.data[b+2]/255|0)}};G.addOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3],l;if(h){let f=h+(l=a.data[b+3])-(h*l/255|0)|0;a.data[b]=(l*a.data[b]+h*c.data[b])/f|0;a.data[b+1]=(l*a.data[b+
1]+h*c.data[b+1])/f|0;a.data[b+2]=(l*a.data[b+2]+h*c.data[b+2])/f|0;a.data[b+3]=f}}};G.addOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f;if(l){let m=l+(f=a.data[b+3])-(l*f/255|0)|0;a.data[b]=(f*a.data[b]+l*c.data[b])/m|0;a.data[b+1]=(f*a.data[b+1]+l*c.data[b+1])/m|0;a.data[b+2]=(f*a.data[b+2]+l*c.data[b+2])/m|0;a.data[b+
3]=m}}};G.addOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0;m&&(a.data[e]=a.data[e]+m*c.data[e]/255|0,a.data[e+1]=a.data[e+1]+m*c.data[e+1]/255|0,a.data[e+2]=a.data[e+2]+m*c.data[e+2]/255|0)}};G.addOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,
k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0;q&&(a.data[h]=a.data[h]+q*c.data[h]/255|0,a.data[h+1]=a.data[h+1]+q*c.data[h+1]/255|0,a.data[h+2]=a.data[h+2]+q*c.data[h+2]/255|0)}};G.addOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|
c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0,q;if(m){let r=m+(q=a.data[e+3])-(m*q/255|0)|0;a.data[e]=(q*a.data[e]+m*c.data[e])/r|0;a.data[e+1]=(q*a.data[e+1]+m*c.data[e+1])/r|0;a.data[e+2]=(q*a.data[e+2]+m*c.data[e+2])/r|0;a.data[e+3]=r}}};G.addOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|
c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,r;if(q){let t=q+(r=a.data[h+3])-(q*r/255|0)|0;a.data[h]=(r*a.data[h]+q*c.data[h])/t|0;a.data[h+1]=(r*a.data[h+1]+q*c.data[h+1])/t|0;a.data[h+2]=(r*a.data[h+2]+q*c.data[h+2])/t|0;a.data[h+3]=t}}};G.subtractOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,
b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3];h&&(a.data[b]=a.data[b]+h*c.data[b]/255-h|0,a.data[b+1]=a.data[b+1]+h*c.data[b+1]/255-h|0,a.data[b+2]=a.data[b+2]+h*c.data[b+2]/255-h|0)}};G.subtractOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0;l&&(a.data[b]=a.data[b]+l*c.data[b]/255-l|0,a.data[b+
1]=a.data[b+1]+l*c.data[b+1]/255-l|0,a.data[b+2]=a.data[b+2]+l*c.data[b+2]/255-l|0)}};G.subtractOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3],l;if(h){let f=h+(l=a.data[b+3])-(h*l/255|0)|0,m=h*l;a.data[b]=(l*a.data[b]+h*c.data[b]-m)/f|0;a.data[b+1]=(l*a.data[b+1]+h*c.data[b+1]-m)/f|0;a.data[b+2]=(l*a.data[b+2]+h*c.data[b+2]-m)/f|0;
a.data[b+3]=f}}};G.subtractOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f;if(l){let m=l+(f=a.data[b+3])-(l*f/255|0)|0,q=l*f;a.data[b]=(f*a.data[b]+l*c.data[b]-q)/m|0;a.data[b+1]=(f*a.data[b+1]+l*c.data[b+1]-q)/m|0;a.data[b+2]=(f*a.data[b+2]+l*c.data[b+2]-q)/m|0;a.data[b+3]=m}}};G.subtractOntoOpaqueFusionWithOpaqueLayerMasked=
function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0;m&&(a.data[e]=a.data[e]+m*c.data[e]/255-m|0,a.data[e+1]=a.data[e+1]+m*c.data[e+1]/255-m|0,a.data[e+2]=a.data[e+2]+m*c.data[e+2]/255-m|0)}};G.subtractOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),
e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0;q&&(a.data[h]=a.data[h]+q*c.data[h]/255-q|0,a.data[h+1]=a.data[h+1]+q*c.data[h+1]/255-q|0,a.data[h+2]=a.data[h+2]+q*c.data[h+2]/255-q|0)}};G.subtractOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),
h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0,q;if(m){let r=m+(q=a.data[e+3])-(m*q/255|0)|0,t=m*q;a.data[e]=(q*a.data[e]+m*c.data[e]-t)/r|0;a.data[e+1]=(q*a.data[e+1]+m*c.data[e+1]-t)/r|0;a.data[e+2]=(q*a.data[e+2]+m*c.data[e+2]-t)/r|0;a.data[e+3]=r}}};G.subtractOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,
b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,r;if(q){let t=q+(r=a.data[h+3])-(q*r/255|0)|0,u=q*r;a.data[h]=(r*a.data[h]+q*c.data[h]-u)/t|0;a.data[h+1]=(r*a.data[h+1]+q*c.data[h+1]-u)/t|0;a.data[h+2]=(r*a.data[h+2]+q*c.data[h+2]-u)/t|0;a.data[h+3]=t}}};G.screenOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,
b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3],l;if(h){let f=255^h;l=a.data[b];a.data[b]=255^((255^l)*f+(255^c.data[b])*(255^l)*h/255)/255;l=a.data[b+1];a.data[b+1]=255^((255^l)*f+(255^c.data[b+1])*(255^l)*h/255)/255;l=a.data[b+2];a.data[b+2]=255^((255^l)*f+(255^c.data[b+2])*(255^l)*h/255)/255}}};G.screenOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,
b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f;if(l){let m=255^l;f=a.data[b];a.data[b]=255^((255^f)*m+(255^c.data[b])*(255^f)*l/255)/255;f=a.data[b+1];a.data[b+1]=255^((255^f)*m+(255^c.data[b+1])*(255^f)*l/255)/255;f=a.data[b+2];a.data[b+2]=255^((255^f)*m+(255^c.data[b+2])*(255^f)*l/255)/255}}};G.screenOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let h=0;h<
k;h++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,q=g*l/255|0,r=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=255^((255^g)*r+(255^f)*t+(255^g)*(255^f)*q/255)/m;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=255^((255^g)*r+(255^f)*t+(255^g)*(255^f)*q/255)/m;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=255^((255^g)*r+(255^f)*t+(255^g)*(255^f)*q/255)/m;a.data[b+3]=m}}};G.screenOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),
n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let h=0;h<k;h++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let q=e+(f=a.data[b+3])-(e*f/255|0)|0,r=e*f/255|0,t=e*(255^f)/255|0,u=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=255^((255^e)*t+(255^m)*u+(255^e)*(255^m)*r/255)/q;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=255^((255^e)*t+(255^m)*u+(255^e)*(255^m)*r/255)/q;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=255^((255^e)*t+(255^m)*u+(255^e)*(255^m)*
r/255)/q;a.data[b+3]=q}}};G.screenOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0,q;if(m){let r=255^m;q=a.data[e];a.data[e]=255^((255^q)*r+(255^c.data[e])*(255^q)*m/255)/255;q=a.data[e+1];a.data[e+1]=255^((255^q)*r+(255^c.data[e+1])*(255^q)*m/255)/255;q=a.data[e+
2];a.data[e+2]=255^((255^q)*r+(255^c.data[e+2])*(255^q)*m/255)/255}}};G.screenOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,r;if(q){let t=255^q;r=a.data[h];a.data[h]=255^((255^r)*t+(255^c.data[h])*(255^r)*q/255)/255;r=a.data[h+1];a.data[h+1]=255^((255^
r)*t+(255^c.data[h+1])*(255^r)*q/255)/255;r=a.data[h+2];a.data[h+2]=255^((255^r)*t+(255^c.data[h+2])*(255^r)*q/255)/255}}};G.screenOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=h)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*k.data[b]/255|0;let q,r;if(l){let t=l+(q=a.data[e+3])-(l*q/255|0)|0,u=l*q/255|0,w=l*(255^q)/
255|0,C=(255^l)*q/255|0;l=c.data[e];r=a.data[e];a.data[e]=255^((255^l)*w+(255^r)*C+(255^l)*(255^r)*u/255)/t;l=c.data[e+1];r=a.data[e+1];a.data[e+1]=255^((255^l)*w+(255^r)*C+(255^l)*(255^r)*u/255)/t;l=c.data[e+2];r=a.data[e+2];a.data[e+2]=255^((255^l)*w+(255^r)*C+(255^l)*(255^r)*u/255)/t;a.data[e+3]=t}}};G.screenOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,
b.top);for(let m=0;m<n;m++,h+=e,b+=l)for(let q=0;q<g;q++,h+=4,b++){var f=c.data[h+3]*k.data[b]*d/25500|0;let r,t;if(f){let u=f+(r=a.data[h+3])-(f*r/255|0)|0,w=f*r/255|0,C=f*(255^r)/255|0,D=(255^f)*r/255|0;f=c.data[h];t=a.data[h];a.data[h]=255^((255^f)*C+(255^t)*D+(255^f)*(255^t)*w/255)/u;f=c.data[h+1];t=a.data[h+1];a.data[h+1]=255^((255^f)*C+(255^t)*D+(255^f)*(255^t)*w/255)/u;f=c.data[h+2];t=a.data[h+2];a.data[h+2]=255^((255^f)*C+(255^t)*D+(255^f)*(255^t)*w/255)/u;a.data[h+3]=u}}};G.lightenOntoOpaqueFusionWithOpaqueLayer=
function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3],l,f;if(h){let m=255^h;l=c.data[b];f=a.data[b];a.data[b]=f>=l?f:(f*m+l*h)/255|0;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=f>=l?f:(f*m+l*h)/255|0;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=f>=l?f:(f*m+l*h)/255|0}}};G.lightenOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-
n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let q=255^l;f=c.data[b];m=a.data[b];a.data[b]=m>=f?m:(m*q+f*l)/255|0;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=m>=f?m:(m*q+f*l)/255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=m>=f?m:(m*q+f*l)/255|0}}};G.lightenOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=
n)for(let h=0;h<k;h++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,q=l*(255^g)/m|0,r=255^q,t=g*(255^l)/m|0,u=255^t;g=c.data[b];f=a.data[b];a.data[b]=(f>=g?g*t+f*u:f*q+g*r)/255|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(f>=g?g*t+f*u:f*q+g*r)/255|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(f>=g?g*t+f*u:f*q+g*r)/255|0;a.data[b+3]=m}}};G.lightenOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,
b.top);for(let h=0;h<k;h++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let q=e+(f=a.data[b+3])-(e*f/255|0)|0,r=f*(255^e)/q|0,t=255^r,u=e*(255^f)/q|0,w=255^u;e=c.data[b];m=a.data[b];a.data[b]=(m>=e?e*u+m*w:m*r+e*t)/255|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(m>=e?e*u+m*w:m*r+e*t)/255|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(m>=e?e*u+m*w:m*r+e*t)/255|0;a.data[b+3]=q}}};G.lightenOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),
g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=r>=q?r:(r*t+q*m)/255|0;q=c.data[e+1];r=a.data[e+1];a.data[e+1]=r>=q?r:(r*t+q*m)/255|0;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=r>=q?r:(r*t+q*m)/255|0}}};G.lightenOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),
e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,r,t;if(q){let u=255^q;r=c.data[h];t=a.data[h];a.data[h]=t>=r?t:(t*u+r*q)/255|0;r=c.data[h+1];t=a.data[h+1];a.data[h+1]=t>=r?t:(t*u+r*q)/255|0;r=c.data[h+2];t=a.data[h+2];a.data[h+2]=t>=r?t:(t*u+r*q)/255|0}}};G.lightenOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=
0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=h)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*k.data[b]/255|0;let q,r;if(l){let t=l+(q=a.data[e+3])-(l*q/255|0)|0,u=q*(255^l)/t|0,w=255^u,C=l*(255^q)/t|0,D=255^C;l=c.data[e];r=a.data[e];a.data[e]=(r>=l?l*C+r*D:r*u+l*w)/255|0;l=c.data[e+1];r=a.data[e+1];a.data[e+1]=(r>=l?l*C+r*D:r*u+l*w)/255|0;l=c.data[e+2];r=a.data[e+2];a.data[e+2]=(r>=l?l*C+r*D:r*u+l*
w)/255|0;a.data[e+3]=t}}};G.lightenOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,h+=e,b+=l)for(let q=0;q<g;q++,h+=4,b++){var f=c.data[h+3]*k.data[b]*d/25500|0;let r,t;if(f){let u=f+(r=a.data[h+3])-(f*r/255|0)|0,w=r*(255^f)/u|0,C=255^w,D=f*(255^r)/u|0,A=255^D;f=c.data[h];t=a.data[h];a.data[h]=(t>=f?f*D+t*A:t*w+f*C)/255|
0;f=c.data[h+1];t=a.data[h+1];a.data[h+1]=(t>=f?f*D+t*A:t*w+f*C)/255|0;f=c.data[h+2];t=a.data[h+2];a.data[h+2]=(t>=f?f*D+t*A:t*w+f*C)/255|0;a.data[h+3]=u}}};G.darkenOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3],l,f;if(h){let m=255^h;l=c.data[b];f=a.data[b];a.data[b]=f>=l?(f*m+l*h)/255|0:f;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=f>=l?(f*
m+l*h)/255|0:f;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=f>=l?(f*m+l*h)/255|0:f}}};G.darkenOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let q=255^l;f=c.data[b];m=a.data[b];a.data[b]=m>=f?(m*q+f*l)/255|0:m;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=m>=f?(m*q+f*l)/255|0:m;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=m>=f?(m*
q+f*l)/255|0:m}}};G.darkenOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let h=0;h<k;h++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,q=g*(255^l)/m|0,r=255^q,t=l*(255^g)/m|0,u=255^t;g=c.data[b];f=a.data[b];a.data[b]=(f>=g?f*t+g*u:g*q+f*r)/255|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(f>=g?f*t+g*u:g*q+f*r)/255|0;g=c.data[b+2];f=a.data[b+2];
a.data[b+2]=(f>=g?f*t+g*u:g*q+f*r)/255|0;a.data[b+3]=m}}};G.darkenOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let h=0;h<k;h++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let q=e+(f=a.data[b+3])-(e*f/255|0)|0,r=e*(255^f)/q|0,t=255^r,u=f*(255^e)/q|0,w=255^u;e=c.data[b];m=a.data[b];a.data[b]=(m>=e?m*u+e*w:e*r+m*t)/255|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(m>=
e?m*u+e*w:e*r+m*t)/255|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(m>=e?m*u+e*w:e*r+m*t)/255|0;a.data[b+3]=q}}};G.darkenOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=r>=q?(r*t+q*m)/255|0:r;q=c.data[e+1];
r=a.data[e+1];a.data[e+1]=r>=q?(r*t+q*m)/255|0:r;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=r>=q?(r*t+q*m)/255|0:r}}};G.darkenOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,r,t;if(q){let u=255^q;r=c.data[h];t=a.data[h];a.data[h]=t>=r?(t*u+r*q)/255|0:t;
r=c.data[h+1];t=a.data[h+1];a.data[h+1]=t>=r?(t*u+r*q)/255|0:t;r=c.data[h+2];t=a.data[h+2];a.data[h+2]=t>=r?(t*u+r*q)/255|0:t}}};G.darkenOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=h)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*k.data[b]/255|0;let q,r;if(l){let t=l+(q=a.data[e+3])-(l*q/255|0)|0,u=l*(255^q)/t|0,
w=255^u,C=q*(255^l)/t|0,D=255^C;l=c.data[e];r=a.data[e];a.data[e]=(r>=l?r*C+l*D:l*u+r*w)/255|0;l=c.data[e+1];r=a.data[e+1];a.data[e+1]=(r>=l?r*C+l*D:l*u+r*w)/255|0;l=c.data[e+2];r=a.data[e+2];a.data[e+2]=(r>=l?r*C+l*D:l*u+r*w)/255|0;a.data[e+3]=t}}};G.darkenOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,h+=e,b+=l)for(let q=
0;q<g;q++,h+=4,b++){var f=c.data[h+3]*k.data[b]*d/25500|0;let r,t;if(f){let u=f+(r=a.data[h+3])-(f*r/255|0)|0,w=f*(255^r)/u|0,C=255^w,D=r*(255^f)/u|0,A=255^D;f=c.data[h];t=a.data[h];a.data[h]=(t>=f?t*D+f*A:f*w+t*C)/255|0;f=c.data[h+1];t=a.data[h+1];a.data[h+1]=(t>=f?t*D+f*A:f*w+t*C)/255|0;f=c.data[h+2];t=a.data[h+2];a.data[h+2]=(t>=f?t*D+f*A:f*w+t*C)/255|0;a.data[h+3]=u}}};G.dodgeOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,
b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3],l,f;if(h){let m=255^h;l=c.data[b];f=a.data[b];a.data[b]=(f*m+h*(255==l?255:Math.min(255,255*f/(255^l)|0)))/255|0;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=(f*m+h*(255==l?255:Math.min(255,255*f/(255^l)|0)))/255|0;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=(f*m+h*(255==l?255:Math.min(255,255*f/(255^l)|0)))/255|0}}};G.dodgeOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|
0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let q=255^l;f=c.data[b];m=a.data[b];a.data[b]=(m*q+l*(255==f?255:Math.min(255,255*m/(255^f)|0)))/255|0;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=(m*q+l*(255==f?255:Math.min(255,255*m/(255^f)|0)))/255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=(m*q+l*(255==f?255:Math.min(255,255*m/(255^f)|0)))/255|0}}};G.dodgeOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();
let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let h=0;h<k;h++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,q=g*l/255|0,r=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(g*r+f*t+q*(255==g?255:Math.min(255,255*f/(255^g)|0)))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(g*r+f*t+q*(255==g?255:Math.min(255,255*f/(255^g)|0)))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(g*r+f*t+q*(255==g?255:Math.min(255,
255*f/(255^g)|0)))/m|0;a.data[b+3]=m}}};G.dodgeOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let h=0;h<k;h++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let q=e+(f=a.data[b+3])-(e*f/255|0)|0,r=e*f/255|0,t=e*(255^f)/255|0,u=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(e*t+m*u+r*(255==e?255:Math.min(255,255*m/(255^e)|0)))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+
1]=(e*t+m*u+r*(255==e?255:Math.min(255,255*m/(255^e)|0)))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(e*t+m*u+r*(255==e?255:Math.min(255,255*m/(255^e)|0)))/q|0;a.data[b+3]=q}}};G.dodgeOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];
r=a.data[e];a.data[e]=(r*t+m*(255==q?255:Math.min(255,255*r/(255^q)|0)))/255|0;q=c.data[e+1];r=a.data[e+1];a.data[e+1]=(r*t+m*(255==q?255:Math.min(255,255*r/(255^q)|0)))/255|0;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=(r*t+m*(255==q?255:Math.min(255,255*r/(255^q)|0)))/255|0}}};G.dodgeOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,
h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,r,t;if(q){let u=255^q;r=c.data[h];t=a.data[h];a.data[h]=(t*u+q*(255==r?255:Math.min(255,255*t/(255^r)|0)))/255|0;r=c.data[h+1];t=a.data[h+1];a.data[h+1]=(t*u+q*(255==r?255:Math.min(255,255*t/(255^r)|0)))/255|0;r=c.data[h+2];t=a.data[h+2];a.data[h+2]=(t*u+q*(255==r?255:Math.min(255,255*t/(255^r)|0)))/255|0}}};G.dodgeOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*
(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=h)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*k.data[b]/255|0;let q,r;if(l){let t=l+(q=a.data[e+3])-(l*q/255|0)|0,u=l*q/255|0,w=l*(255^q)/255|0,C=(255^l)*q/255|0;l=c.data[e];r=a.data[e];a.data[e]=(l*w+r*C+u*(255==l?255:Math.min(255,255*r/(255^l)|0)))/t|0;l=c.data[e+1];r=a.data[e+1];a.data[e+1]=(l*w+r*C+u*(255==l?255:Math.min(255,255*r/(255^l)|0)))/t|0;l=c.data[e+2];r=a.data[e+
2];a.data[e+2]=(l*w+r*C+u*(255==l?255:Math.min(255,255*r/(255^l)|0)))/t|0;a.data[e+3]=t}}};G.dodgeOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,h+=e,b+=l)for(let q=0;q<g;q++,h+=4,b++){var f=c.data[h+3]*k.data[b]*d/25500|0;let r,t;if(f){let u=f+(r=a.data[h+3])-(f*r/255|0)|0,w=f*r/255|0,C=f*(255^r)/255|0,D=(255^f)*r/255|
0;f=c.data[h];t=a.data[h];a.data[h]=(f*C+t*D+w*(255==f?255:Math.min(255,255*t/(255^f)|0)))/u|0;f=c.data[h+1];t=a.data[h+1];a.data[h+1]=(f*C+t*D+w*(255==f?255:Math.min(255,255*t/(255^f)|0)))/u|0;f=c.data[h+2];t=a.data[h+2];a.data[h+2]=(f*C+t*D+w*(255==f?255:Math.min(255,255*t/(255^f)|0)))/u|0;a.data[h+3]=u}}};G.burnOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,
b+=4){let h=c.data[b+3],l,f;if(h){let m=255^h;l=c.data[b];f=a.data[b];a.data[b]=(f*m+h*(0==l?0:255^Math.min(255,255*(255^f)/l)))/255|0;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=(f*m+h*(0==l?0:255^Math.min(255,255*(255^f)/l)))/255|0;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=(f*m+h*(0==l?0:255^Math.min(255,255*(255^f)/l)))/255|0}}};G.burnOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=
g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let q=255^l;f=c.data[b];m=a.data[b];a.data[b]=(m*q+l*(0==f?0:255^Math.min(255,255*(255^m)/f)))/255|0;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=(m*q+l*(0==f?0:255^Math.min(255,255*(255^m)/f)))/255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=(m*q+l*(0==f?0:255^Math.min(255,255*(255^m)/f)))/255|0}}};G.burnOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,
b.top);for(let e=0;e<d;e++,b+=n)for(let h=0;h<k;h++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,q=g*l/255|0,r=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(g*r+f*t+q*(0==g?0:255^Math.min(255,255*(255^f)/g)))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(g*r+f*t+q*(0==g?0:255^Math.min(255,255*(255^f)/g)))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(g*r+f*t+q*(0==g?0:255^Math.min(255,255*(255^f)/g)))/m|0;a.data[b+3]=m}}};G.burnOntoTransparentFusionWithTransparentLayer=
function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let h=0;h<k;h++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let q=e+(f=a.data[b+3])-(e*f/255|0)|0,r=e*f/255|0,t=e*(255^f)/255|0,u=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(e*t+m*u+r*(0==e?0:255^Math.min(255,255*(255^m)/e)))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(e*t+m*u+r*(0==e?0:255^Math.min(255,255*(255^m)/e)))/q|0;e=c.data[b+2];m=a.data[b+2];
a.data[b+2]=(e*t+m*u+r*(0==e?0:255^Math.min(255,255*(255^m)/e)))/q|0;a.data[b+3]=q}}};G.burnOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=(r*t+m*(0==q?0:255^Math.min(255,255*(255^r)/q)))/255|0;q=c.data[e+
1];r=a.data[e+1];a.data[e+1]=(r*t+m*(0==q?0:255^Math.min(255,255*(255^r)/q)))/255|0;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=(r*t+m*(0==q?0:255^Math.min(255,255*(255^r)/q)))/255|0}}};G.burnOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,r,t;if(q){let u=
255^q;r=c.data[h];t=a.data[h];a.data[h]=(t*u+q*(0==r?0:255^Math.min(255,255*(255^t)/r)))/255|0;r=c.data[h+1];t=a.data[h+1];a.data[h+1]=(t*u+q*(0==r?0:255^Math.min(255,255*(255^t)/r)))/255|0;r=c.data[h+2];t=a.data[h+2];a.data[h+2]=(t*u+q*(0==r?0:255^Math.min(255,255*(255^t)/r)))/255|0}}};G.burnOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=
0;f<d;f++,e+=g,b+=h)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*k.data[b]/255|0;let q,r;if(l){let t=l+(q=a.data[e+3])-(l*q/255|0)|0,u=l*q/255|0,w=l*(255^q)/255|0,C=(255^l)*q/255|0;l=c.data[e];r=a.data[e];a.data[e]=(l*w+r*C+u*(0==l?0:255^Math.min(255,255*(255^r)/l)))/t|0;l=c.data[e+1];r=a.data[e+1];a.data[e+1]=(l*w+r*C+u*(0==l?0:255^Math.min(255,255*(255^r)/l)))/t|0;l=c.data[e+2];r=a.data[e+2];a.data[e+2]=(l*w+r*C+u*(0==l?0:255^Math.min(255,255*(255^r)/l)))/t|0;a.data[e+3]=t}}};G.burnOntoTransparentFusionWithTransparentLayerMasked=
function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,h+=e,b+=l)for(let q=0;q<g;q++,h+=4,b++){var f=c.data[h+3]*k.data[b]*d/25500|0;let r,t;if(f){let u=f+(r=a.data[h+3])-(f*r/255|0)|0,w=f*r/255|0,C=f*(255^r)/255|0,D=(255^f)*r/255|0;f=c.data[h];t=a.data[h];a.data[h]=(f*C+t*D+w*(0==f?0:255^Math.min(255,255*(255^t)/f)))/u|0;f=c.data[h+1];t=a.data[h+1];a.data[h+1]=(f*C+t*D+w*(0==
f?0:255^Math.min(255,255*(255^t)/f)))/u|0;f=c.data[h+2];t=a.data[h+2];a.data[h+2]=(f*C+t*D+w*(0==f?0:255^Math.min(255,255*(255^t)/f)))/u|0;a.data[h+3]=u}}};G.overlayOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3],l,f;if(h){let m=255^h;l=c.data[b];f=a.data[b];a.data[b]=(m*f+(127>=f?2*h*l*f/255:h*(2*(255^l)*(255^f)/255^255)))/255|0;l=c.data[b+
1];f=a.data[b+1];a.data[b+1]=(m*f+(127>=f?2*h*l*f/255:h*(2*(255^l)*(255^f)/255^255)))/255|0;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=(m*f+(127>=f?2*h*l*f/255:h*(2*(255^l)*(255^f)/255^255)))/255|0}}};G.overlayOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let q=255^l;f=c.data[b];m=a.data[b];a.data[b]=(q*m+(127>=m?2*
l*f*m/255:l*(2*(255^f)*(255^m)/255^255)))/255|0;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=(q*m+(127>=m?2*l*f*m/255:l*(2*(255^f)*(255^m)/255^255)))/255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=(q*m+(127>=m?2*l*f*m/255:l*(2*(255^f)*(255^m)/255^255)))/255|0}}};G.overlayOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let h=0;h<k;h++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=
g+(l=a.data[b+3])-(g*l/255|0)|0,q=g*l/255|0,r=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(r*g+t*f+(127>=f?2*q*g*f/255:q*(2*(255^g)*(255^f)/255^255)))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(r*g+t*f+(127>=f?2*q*g*f/255:q*(2*(255^g)*(255^f)/255^255)))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(r*g+t*f+(127>=f?2*q*g*f/255:q*(2*(255^g)*(255^f)/255^255)))/m|0;a.data[b+3]=m}}};G.overlayOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|
b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let h=0;h<k;h++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let q=e+(f=a.data[b+3])-(e*f/255|0)|0,r=e*f/255|0,t=e*(255^f)/255|0,u=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+u*m+(127>=m?2*r*e*m/255:r*(2*(255^e)*(255^m)/255^255)))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+u*m+(127>=m?2*r*e*m/255:r*(2*(255^e)*(255^m)/255^255)))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+u*m+(127>=
m?2*r*e*m/255:r*(2*(255^e)*(255^m)/255^255)))/q|0;a.data[b+3]=q}}};G.overlayOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=(t*r+(127>=r?2*m*q*r/255:m*(2*(255^q)*(255^r)/255^255)))/255|0;q=c.data[e+1];r=
a.data[e+1];a.data[e+1]=(t*r+(127>=r?2*m*q*r/255:m*(2*(255^q)*(255^r)/255^255)))/255|0;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=(t*r+(127>=r?2*m*q*r/255:m*(2*(255^q)*(255^r)/255^255)))/255|0}}};G.overlayOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,
r,t;if(q){let u=255^q;r=c.data[h];t=a.data[h];a.data[h]=(u*t+(127>=t?2*q*r*t/255:q*(2*(255^r)*(255^t)/255^255)))/255|0;r=c.data[h+1];t=a.data[h+1];a.data[h+1]=(u*t+(127>=t?2*q*r*t/255:q*(2*(255^r)*(255^t)/255^255)))/255|0;r=c.data[h+2];t=a.data[h+2];a.data[h+2]=(u*t+(127>=t?2*q*r*t/255:q*(2*(255^r)*(255^t)/255^255)))/255|0}}};G.overlayOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-
n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=h)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*k.data[b]/255|0;let q,r;if(l){let t=l+(q=a.data[e+3])-(l*q/255|0)|0,u=l*q/255|0,w=l*(255^q)/255|0,C=(255^l)*q/255|0;l=c.data[e];r=a.data[e];a.data[e]=(w*l+C*r+(127>=r?2*u*l*r/255:u*(2*(255^l)*(255^r)/255^255)))/t|0;l=c.data[e+1];r=a.data[e+1];a.data[e+1]=(w*l+C*r+(127>=r?2*u*l*r/255:u*(2*(255^l)*(255^r)/255^255)))/t|0;l=c.data[e+2];r=a.data[e+2];a.data[e+2]=(w*l+C*r+(127>=r?2*u*l*r/
255:u*(2*(255^l)*(255^r)/255^255)))/t|0;a.data[e+3]=t}}};G.overlayOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,h+=e,b+=l)for(let q=0;q<g;q++,h+=4,b++){var f=c.data[h+3]*k.data[b]*d/25500|0;let r,t;if(f){let u=f+(r=a.data[h+3])-(f*r/255|0)|0,w=f*r/255|0,C=f*(255^r)/255|0,D=(255^f)*r/255|0;f=c.data[h];t=a.data[h];a.data[h]=
(C*f+D*t+(127>=t?2*w*f*t/255:w*(2*(255^f)*(255^t)/255^255)))/u|0;f=c.data[h+1];t=a.data[h+1];a.data[h+1]=(C*f+D*t+(127>=t?2*w*f*t/255:w*(2*(255^f)*(255^t)/255^255)))/u|0;f=c.data[h+2];t=a.data[h+2];a.data[h+2]=(C*f+D*t+(127>=t?2*w*f*t/255:w*(2*(255^f)*(255^t)/255^255)))/u|0;a.data[h+3]=u}}};G.hardLightOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=
c.data[b+3],l,f;if(h){let m=255^h;l=c.data[b];f=a.data[b];a.data[b]=(m*f+(127>=l?2*h*l*f/255:h*(2*(255^l)*(255^f)/255^255)))/255|0;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=(m*f+(127>=l?2*h*l*f/255:h*(2*(255^l)*(255^f)/255^255)))/255|0;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=(m*f+(127>=l?2*h*l*f/255:h*(2*(255^l)*(255^f)/255^255)))/255|0}}};G.hardLightOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=
0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let q=255^l;f=c.data[b];m=a.data[b];a.data[b]=(q*m+(127>=f?2*l*f*m/255:l*(2*(255^f)*(255^m)/255^255)))/255|0;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=(q*m+(127>=f?2*l*f*m/255:l*(2*(255^f)*(255^m)/255^255)))/255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=(q*m+(127>=f?2*l*f*m/255:l*(2*(255^f)*(255^m)/255^255)))/255|0}}};G.hardLightOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=
4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let h=0;h<k;h++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,q=g*l/255|0,r=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(r*g+t*f+(127>=g?2*q*g*f/255:q*(2*(255^g)*(255^f)/255^255)))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(r*g+t*f+(127>=g?2*q*g*f/255:q*(2*(255^g)*(255^f)/255^255)))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(r*g+t*f+(127>=g?2*q*g*f/255:q*(2*(255^
g)*(255^f)/255^255)))/m|0;a.data[b+3]=m}}};G.hardLightOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let h=0;h<k;h++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let q=e+(f=a.data[b+3])-(e*f/255|0)|0,r=e*f/255|0,t=e*(255^f)/255|0,u=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+u*m+(127>=e?2*r*e*m/255:r*(2*(255^e)*(255^m)/255^255)))/q|0;e=c.data[b+1];m=a.data[b+
1];a.data[b+1]=(t*e+u*m+(127>=e?2*r*e*m/255:r*(2*(255^e)*(255^m)/255^255)))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+u*m+(127>=e?2*r*e*m/255:r*(2*(255^e)*(255^m)/255^255)))/q|0;a.data[b+3]=q}}};G.hardLightOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|
0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=(t*r+(127>=q?2*m*q*r/255:m*(2*(255^q)*(255^r)/255^255)))/255|0;q=c.data[e+1];r=a.data[e+1];a.data[e+1]=(t*r+(127>=q?2*m*q*r/255:m*(2*(255^q)*(255^r)/255^255)))/255|0;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=(t*r+(127>=q?2*m*q*r/255:m*(2*(255^q)*(255^r)/255^255)))/255|0}}};G.hardLightOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-
g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,r,t;if(q){let u=255^q;r=c.data[h];t=a.data[h];a.data[h]=(u*t+(127>=r?2*q*r*t/255:q*(2*(255^r)*(255^t)/255^255)))/255|0;r=c.data[h+1];t=a.data[h+1];a.data[h+1]=(u*t+(127>=r?2*q*r*t/255:q*(2*(255^r)*(255^t)/255^255)))/255|0;r=c.data[h+2];t=a.data[h+2];a.data[h+2]=(u*t+(127>=r?2*q*r*t/255:q*(2*(255^r)*(255^t)/255^255)))/255|0}}};G.hardLightOntoTransparentFusionWithOpaqueLayerMasked=
function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=h)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*k.data[b]/255|0;let q,r;if(l){let t=l+(q=a.data[e+3])-(l*q/255|0)|0,u=l*q/255|0,w=l*(255^q)/255|0,C=(255^l)*q/255|0;l=c.data[e];r=a.data[e];a.data[e]=(w*l+C*r+(127>=l?2*u*l*r/255:u*(2*(255^l)*(255^r)/255^255)))/t|0;l=c.data[e+1];r=a.data[e+1];a.data[e+1]=(w*l+C*r+
(127>=l?2*u*l*r/255:u*(2*(255^l)*(255^r)/255^255)))/t|0;l=c.data[e+2];r=a.data[e+2];a.data[e+2]=(w*l+C*r+(127>=l?2*u*l*r/255:u*(2*(255^l)*(255^r)/255^255)))/t|0;a.data[e+3]=t}}};G.hardLightOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,h+=e,b+=l)for(let q=0;q<g;q++,h+=4,b++){var f=c.data[h+3]*k.data[b]*d/25500|0;let r,t;
if(f){let u=f+(r=a.data[h+3])-(f*r/255|0)|0,w=f*r/255|0,C=f*(255^r)/255|0,D=(255^f)*r/255|0;f=c.data[h];t=a.data[h];a.data[h]=(C*f+D*t+(127>=f?2*w*f*t/255:w*(2*(255^f)*(255^t)/255^255)))/u|0;f=c.data[h+1];t=a.data[h+1];a.data[h+1]=(C*f+D*t+(127>=f?2*w*f*t/255:w*(2*(255^f)*(255^t)/255^255)))/u|0;f=c.data[h+2];t=a.data[h+2];a.data[h+2]=(C*f+D*t+(127>=f?2*w*f*t/255:w*(2*(255^f)*(255^t)/255^255)))/u|0;a.data[h+3]=u}}};G.softLightOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=
0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3],l,f;if(h){let m=255^h;l=c.data[b];f=a.data[b];a.data[b]=(m*f+h*(127>=l?((2*l-255)*tb[f]/255|0)+f:((2*l-255)*ub[f]/255|0)+f))/255|0;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=(m*f+h*(127>=l?((2*l-255)*tb[f]/255|0)+f:((2*l-255)*ub[f]/255|0)+f))/255|0;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=(m*f+h*(127>=l?((2*l-255)*tb[f]/255|0)+f:((2*l-255)*ub[f]/255|0)+f))/255|0}}};G.softLightOntoOpaqueFusionWithTransparentLayer=
function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let q=255^l;f=c.data[b];m=a.data[b];a.data[b]=(q*m+l*(127>=f?((2*f-255)*tb[m]/255|0)+m:((2*f-255)*ub[m]/255|0)+m))/255|0;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=(q*m+l*(127>=f?((2*f-255)*tb[m]/255|0)+m:((2*f-255)*ub[m]/255|0)+m))/255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=(q*m+l*(127>=f?((2*f-255)*tb[m]/
255|0)+m:((2*f-255)*ub[m]/255|0)+m))/255|0}}};G.softLightOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let h=0;h<k;h++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,q=g*l/255|0,r=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(r*g+t*f+(127>=g?q*(((2*g-255)*tb[f]/255|0)+f):q*(((2*g-255)*ub[f]/255|0)+f)))/m|0;g=c.data[b+1];
f=a.data[b+1];a.data[b+1]=(r*g+t*f+(127>=g?q*(((2*g-255)*tb[f]/255|0)+f):q*(((2*g-255)*ub[f]/255|0)+f)))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(r*g+t*f+(127>=g?q*(((2*g-255)*tb[f]/255|0)+f):q*(((2*g-255)*ub[f]/255|0)+f)))/m|0;a.data[b+3]=m}}};G.softLightOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let h=0;h<k;h++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let q=
e+(f=a.data[b+3])-(e*f/255|0)|0,r=e*f/255|0,t=e*(255^f)/255|0,u=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+u*m+(127>=e?r*(((2*e-255)*tb[m]/255|0)+m):r*(((2*e-255)*ub[m]/255|0)+m)))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+u*m+(127>=e?r*(((2*e-255)*tb[m]/255|0)+m):r*(((2*e-255)*ub[m]/255|0)+m)))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+u*m+(127>=e?r*(((2*e-255)*tb[m]/255|0)+m):r*(((2*e-255)*ub[m]/255|0)+m)))/q|0;a.data[b+3]=q}}};G.softLightOntoOpaqueFusionWithOpaqueLayerMasked=
function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=(t*r+m*(127>=q?((2*q-255)*tb[r]/255|0)+r:((2*q-255)*ub[r]/255|0)+r))/255|0;q=c.data[e+1];r=a.data[e+1];a.data[e+1]=(t*r+m*(127>=q?((2*q-255)*tb[r]/255|0)+r:((2*q-255)*ub[r]/255|0)+r))/255|0;q=
c.data[e+2];r=a.data[e+2];a.data[e+2]=(t*r+m*(127>=q?((2*q-255)*tb[r]/255|0)+r:((2*q-255)*ub[r]/255|0)+r))/255|0}}};G.softLightOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,r,t;if(q){let u=255^q;r=c.data[h];t=a.data[h];a.data[h]=(u*t+q*(127>=r?((2*
r-255)*tb[t]/255|0)+t:((2*r-255)*ub[t]/255|0)+t))/255|0;r=c.data[h+1];t=a.data[h+1];a.data[h+1]=(u*t+q*(127>=r?((2*r-255)*tb[t]/255|0)+t:((2*r-255)*ub[t]/255|0)+t))/255|0;r=c.data[h+2];t=a.data[h+2];a.data[h+2]=(u*t+q*(127>=r?((2*r-255)*tb[t]/255|0)+t:((2*r-255)*ub[t]/255|0)+t))/255|0}}};G.softLightOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);
for(let f=0;f<d;f++,e+=g,b+=h)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*k.data[b]/255|0;let q,r;if(l){let t=l+(q=a.data[e+3])-(l*q/255|0)|0,u=l*q/255|0,w=l*(255^q)/255|0,C=(255^l)*q/255|0;l=c.data[e];r=a.data[e];a.data[e]=(w*l+C*r+(127>=l?u*(((2*l-255)*tb[r]/255|0)+r):u*(((2*l-255)*ub[r]/255|0)+r)))/t|0;l=c.data[e+1];r=a.data[e+1];a.data[e+1]=(w*l+C*r+(127>=l?u*(((2*l-255)*tb[r]/255|0)+r):u*(((2*l-255)*ub[r]/255|0)+r)))/t|0;l=c.data[e+2];r=a.data[e+2];a.data[e+2]=(w*l+C*r+(127>=l?u*(((2*l-255)*
tb[r]/255|0)+r):u*(((2*l-255)*ub[r]/255|0)+r)))/t|0;a.data[e+3]=t}}};G.softLightOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,h+=e,b+=l)for(let q=0;q<g;q++,h+=4,b++){var f=c.data[h+3]*k.data[b]*d/25500|0;let r,t;if(f){let u=f+(r=a.data[h+3])-(f*r/255|0)|0,w=f*r/255|0,C=f*(255^r)/255|0,D=(255^f)*r/255|0;f=c.data[h];t=a.data[h];
a.data[h]=(C*f+D*t+(127>=f?w*(((2*f-255)*tb[t]/255|0)+t):w*(((2*f-255)*ub[t]/255|0)+t)))/u|0;f=c.data[h+1];t=a.data[h+1];a.data[h+1]=(C*f+D*t+(127>=f?w*(((2*f-255)*tb[t]/255|0)+t):w*(((2*f-255)*ub[t]/255|0)+t)))/u|0;f=c.data[h+2];t=a.data[h+2];a.data[h+2]=(C*f+D*t+(127>=f?w*(((2*f-255)*tb[t]/255|0)+t):w*(((2*f-255)*ub[t]/255|0)+t)))/u|0;a.data[h+3]=u}}};G.vividLightOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,
b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3],l,f;if(h){let m=255^h;l=c.data[b];f=a.data[b];a.data[b]=(m*f+(127>=l?h*(0==l?0:255-Math.min(255,255*(255-f)/(2*l)|0)):h*(255==l?255:Math.min(255,255*f/(2*(255-l))|0))))/255|0;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=(m*f+(127>=l?h*(0==l?0:255-Math.min(255,255*(255-f)/(2*l)|0)):h*(255==l?255:Math.min(255,255*f/(2*(255-l))|0))))/255|0;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=(m*f+(127>=l?h*(0==l?0:255-Math.min(255,255*(255-f)/
(2*l)|0)):h*(255==l?255:Math.min(255,255*f/(2*(255-l))|0))))/255|0}}};G.vividLightOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let q=255^l;f=c.data[b];m=a.data[b];a.data[b]=(q*m+(127>=f?l*(0==f?0:255-Math.min(255,255*(255-m)/(2*f)|0)):l*(255==f?255:Math.min(255,255*m/(2*(255-f))|0))))/255|0;f=c.data[b+1];m=a.data[b+
1];a.data[b+1]=(q*m+(127>=f?l*(0==f?0:255-Math.min(255,255*(255-m)/(2*f)|0)):l*(255==f?255:Math.min(255,255*m/(2*(255-f))|0))))/255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=(q*m+(127>=f?l*(0==f?0:255-Math.min(255,255*(255-m)/(2*f)|0)):l*(255==f?255:Math.min(255,255*m/(2*(255-f))|0))))/255|0}}};G.vividLightOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let h=0;h<k;h++,b+=
4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,q=g*l/255|0,r=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(r*g+t*f+(127>=g?q*(0==g?0:255-Math.min(255,255*(255-f)/(2*g)|0)):q*(255==g?255:Math.min(255,255*f/(2*(255-g))|0))))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(r*g+t*f+(127>=g?q*(0==g?0:255-Math.min(255,255*(255-f)/(2*g)|0)):q*(255==g?255:Math.min(255,255*f/(2*(255-g))|0))))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(r*g+t*f+(127>=g?q*(0==g?
0:255-Math.min(255,255*(255-f)/(2*g)|0)):q*(255==g?255:Math.min(255,255*f/(2*(255-g))|0))))/m|0;a.data[b+3]=m}}};G.vividLightOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let h=0;h<k;h++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let q=e+(f=a.data[b+3])-(e*f/255|0)|0,r=e*f/255|0,t=e*(255^f)/255|0,u=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+u*m+(127>=
e?r*(0==e?0:255-Math.min(255,255*(255-m)/(2*e)|0)):r*(255==e?255:Math.min(255,255*m/(2*(255-e))|0))))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+u*m+(127>=e?r*(0==e?0:255-Math.min(255,255*(255-m)/(2*e)|0)):r*(255==e?255:Math.min(255,255*m/(2*(255-e))|0))))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+u*m+(127>=e?r*(0==e?0:255-Math.min(255,255*(255-m)/(2*e)|0)):r*(255==e?255:Math.min(255,255*m/(2*(255-e))|0))))/q|0;a.data[b+3]=q}}};G.vividLightOntoOpaqueFusionWithOpaqueLayerMasked=function(a,
c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=(t*r+(127>=q?m*(0==q?0:255-Math.min(255,255*(255-r)/(2*q)|0)):m*(255==q?255:Math.min(255,255*r/(2*(255-q))|0))))/255|0;q=c.data[e+1];r=a.data[e+1];a.data[e+1]=(t*r+(127>=q?m*(0==q?0:255-Math.min(255,255*
(255-r)/(2*q)|0)):m*(255==q?255:Math.min(255,255*r/(2*(255-q))|0))))/255|0;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=(t*r+(127>=q?m*(0==q?0:255-Math.min(255,255*(255-r)/(2*q)|0)):m*(255==q?255:Math.min(255,255*r/(2*(255-q))|0))))/255|0}}};G.vividLightOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,
h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,r,t;if(q){let u=255^q;r=c.data[h];t=a.data[h];a.data[h]=(u*t+(127>=r?q*(0==r?0:255-Math.min(255,255*(255-t)/(2*r)|0)):q*(255==r?255:Math.min(255,255*t/(2*(255-r))|0))))/255|0;r=c.data[h+1];t=a.data[h+1];a.data[h+1]=(u*t+(127>=r?q*(0==r?0:255-Math.min(255,255*(255-t)/(2*r)|0)):q*(255==r?255:Math.min(255,255*t/(2*(255-r))|0))))/255|0;r=c.data[h+2];t=a.data[h+2];a.data[h+2]=(u*t+(127>=r?q*(0==r?0:255-Math.min(255,255*(255-t)/(2*r)|0)):q*(255==r?255:Math.min(255,
255*t/(2*(255-r))|0))))/255|0}}};G.vividLightOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=h)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*k.data[b]/255|0;let q,r;if(l){let t=l+(q=a.data[e+3])-(l*q/255|0)|0,u=l*q/255|0,w=l*(255^q)/255|0,C=(255^l)*q/255|0;l=c.data[e];r=a.data[e];a.data[e]=(w*l+C*r+(127>=l?u*(0==l?0:
255-Math.min(255,255*(255-r)/(2*l)|0)):u*(255==l?255:Math.min(255,255*r/(2*(255-l))|0))))/t|0;l=c.data[e+1];r=a.data[e+1];a.data[e+1]=(w*l+C*r+(127>=l?u*(0==l?0:255-Math.min(255,255*(255-r)/(2*l)|0)):u*(255==l?255:Math.min(255,255*r/(2*(255-l))|0))))/t|0;l=c.data[e+2];r=a.data[e+2];a.data[e+2]=(w*l+C*r+(127>=l?u*(0==l?0:255-Math.min(255,255*(255-r)/(2*l)|0)):u*(255==l?255:Math.min(255,255*r/(2*(255-l))|0))))/t|0;a.data[e+3]=t}}};G.vividLightOntoTransparentFusionWithTransparentLayerMasked=function(a,
c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,h+=e,b+=l)for(let q=0;q<g;q++,h+=4,b++){var f=c.data[h+3]*k.data[b]*d/25500|0;let r,t;if(f){let u=f+(r=a.data[h+3])-(f*r/255|0)|0,w=f*r/255|0,C=f*(255^r)/255|0,D=(255^f)*r/255|0;f=c.data[h];t=a.data[h];a.data[h]=(C*f+D*t+(127>=f?w*(0==f?0:255-Math.min(255,255*(255-t)/(2*f)|0)):w*(255==f?255:Math.min(255,255*t/(2*(255-f))|0))))/u|0;
f=c.data[h+1];t=a.data[h+1];a.data[h+1]=(C*f+D*t+(127>=f?w*(0==f?0:255-Math.min(255,255*(255-t)/(2*f)|0)):w*(255==f?255:Math.min(255,255*t/(2*(255-f))|0))))/u|0;f=c.data[h+2];t=a.data[h+2];a.data[h+2]=(C*f+D*t+(127>=f?w*(0==f?0:255-Math.min(255,255*(255-t)/(2*f)|0)):w*(255==f?255:Math.min(255,255*t/(2*(255-f))|0))))/u|0;a.data[h+3]=u}}};G.linearLightOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=
0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3],l;if(h){let f=255^h;l=a.data[b];a.data[b]=(f*l+h*Math.min(255,Math.max(0,l+2*c.data[b]-255)))/255|0;l=a.data[b+1];a.data[b+1]=(f*l+h*Math.min(255,Math.max(0,l+2*c.data[b+1]-255)))/255|0;l=a.data[b+2];a.data[b+2]=(f*l+h*Math.min(255,Math.max(0,l+2*c.data[b+2]-255)))/255|0}}};G.linearLightOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=
0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f;if(l){let m=255^l;f=a.data[b];a.data[b]=(m*f+l*Math.min(255,Math.max(0,f+2*c.data[b]-255)))/255|0;f=a.data[b+1];a.data[b+1]=(m*f+l*Math.min(255,Math.max(0,f+2*c.data[b+1]-255)))/255|0;f=a.data[b+2];a.data[b+2]=(m*f+l*Math.min(255,Math.max(0,f+2*c.data[b+2]-255)))/255|0}}};G.linearLightOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);
for(let e=0;e<d;e++,b+=n)for(let h=0;h<k;h++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,q=g*l/255|0,r=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(r*g+t*f+q*Math.min(255,Math.max(0,f+2*g-255)))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(r*g+t*f+q*Math.min(255,Math.max(0,f+2*g-255)))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(r*g+t*f+q*Math.min(255,Math.max(0,f+2*g-255)))/m|0;a.data[b+3]=m}}};G.linearLightOntoTransparentFusionWithTransparentLayer=
function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let h=0;h<k;h++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let q=e+(f=a.data[b+3])-(e*f/255|0)|0,r=e*f/255|0,t=e*(255^f)/255|0,u=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+u*m+r*Math.min(255,Math.max(0,m+2*e-255)))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+u*m+r*Math.min(255,Math.max(0,m+2*e-255)))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+
2]=(t*e+u*m+r*Math.min(255,Math.max(0,m+2*e-255)))/q|0;a.data[b+3]=q}}};G.linearLightOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0,q;if(m){let r=255^m;q=a.data[e];a.data[e]=(r*q+m*Math.min(255,Math.max(0,q+2*c.data[e]-255)))/255|0;q=a.data[e+1];a.data[e+1]=
(r*q+m*Math.min(255,Math.max(0,q+2*c.data[e+1]-255)))/255|0;q=a.data[e+2];a.data[e+2]=(r*q+m*Math.min(255,Math.max(0,q+2*c.data[e+2]-255)))/255|0}}};G.linearLightOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,r;if(q){let t=255^q;r=a.data[h];a.data[h]=
(t*r+q*Math.min(255,Math.max(0,r+2*c.data[h]-255)))/255|0;r=a.data[h+1];a.data[h+1]=(t*r+q*Math.min(255,Math.max(0,r+2*c.data[h+1]-255)))/255|0;r=a.data[h+2];a.data[h+2]=(t*r+q*Math.min(255,Math.max(0,r+2*c.data[h+2]-255)))/255|0}}};G.linearLightOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=h)for(let m=0;m<n;m++,e+=
4,b++){var l=c.data[e+3]*k.data[b]/255|0;let q,r;if(l){let t=l+(q=a.data[e+3])-(l*q/255|0)|0,u=l*q/255|0,w=l*(255^q)/255|0,C=(255^l)*q/255|0;l=c.data[e];r=a.data[e];a.data[e]=(w*l+C*r+u*Math.min(255,Math.max(0,r+2*l-255)))/t|0;l=c.data[e+1];r=a.data[e+1];a.data[e+1]=(w*l+C*r+u*Math.min(255,Math.max(0,r+2*l-255)))/t|0;l=c.data[e+2];r=a.data[e+2];a.data[e+2]=(w*l+C*r+u*Math.min(255,Math.max(0,r+2*l-255)))/t|0;a.data[e+3]=t}}};G.linearLightOntoTransparentFusionWithTransparentLayerMasked=function(a,c,
d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,h+=e,b+=l)for(let q=0;q<g;q++,h+=4,b++){var f=c.data[h+3]*k.data[b]*d/25500|0;let r,t;if(f){let u=f+(r=a.data[h+3])-(f*r/255|0)|0,w=f*r/255|0,C=f*(255^r)/255|0,D=(255^f)*r/255|0;f=c.data[h];t=a.data[h];a.data[h]=(C*f+D*t+w*Math.min(255,Math.max(0,t+2*f-255)))/u|0;f=c.data[h+1];t=a.data[h+1];a.data[h+1]=(C*f+D*t+w*Math.min(255,Math.max(0,
t+2*f-255)))/u|0;f=c.data[h+2];t=a.data[h+2];a.data[h+2]=(C*f+D*t+w*Math.min(255,Math.max(0,t+2*f-255)))/u|0;a.data[h+3]=u}}};G.pinLightOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3],l,f;if(h){let m=255^h;l=c.data[b];f=a.data[b];a.data[b]=(m*f+h*(f>=2*l?2*l:f<=2*l-255?2*l-255:f))/255|0;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=(m*f+h*(f>=
2*l?2*l:f<=2*l-255?2*l-255:f))/255|0;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=(m*f+h*(f>=2*l?2*l:f<=2*l-255?2*l-255:f))/255|0}}};G.pinLightOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let q=255^l;f=c.data[b];m=a.data[b];a.data[b]=(q*m+l*(m>=2*f?2*f:m<=2*f-255?2*f-255:m))/255|0;f=c.data[b+1];m=a.data[b+1];a.data[b+
1]=(q*m+l*(m>=2*f?2*f:m<=2*f-255?2*f-255:m))/255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=(q*m+l*(m>=2*f?2*f:m<=2*f-255?2*f-255:m))/255|0}}};G.pinLightOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let h=0;h<k;h++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,q=g*l/255|0,r=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=
(r*g+t*f+q*(f>=2*g?2*g:f<=2*g-255?2*g-255:f))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(r*g+t*f+q*(f>=2*g?2*g:f<=2*g-255?2*g-255:f))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(r*g+t*f+q*(f>=2*g?2*g:f<=2*g-255?2*g-255:f))/m|0;a.data[b+3]=m}}};G.pinLightOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let h=0;h<k;h++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let q=
e+(f=a.data[b+3])-(e*f/255|0)|0,r=e*f/255|0,t=e*(255^f)/255|0,u=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+u*m+r*(m>=2*e?2*e:m<=2*e-255?2*e-255:m))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+u*m+r*(m>=2*e?2*e:m<=2*e-255?2*e-255:m))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+u*m+r*(m>=2*e?2*e:m<=2*e-255?2*e-255:m))/q|0;a.data[b+3]=q}}};G.pinLightOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,
b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=(t*r+m*(r>=2*q?2*q:r<=2*q-255?2*q-255:r))/255|0;q=c.data[e+1];r=a.data[e+1];a.data[e+1]=(t*r+m*(r>=2*q?2*q:r<=2*q-255?2*q-255:r))/255|0;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=(t*r+m*(r>=2*q?2*q:r<=2*q-255?2*q-255:r))/255|0}}};G.pinLightOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,
k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3]*k.data[b]*d/25500|0,r,t;if(q){let u=255^q;r=c.data[h];t=a.data[h];a.data[h]=(u*t+q*(t>=2*r?2*r:t<=2*r-255?2*r-255:t))/255|0;r=c.data[h+1];t=a.data[h+1];a.data[h+1]=(u*t+q*(t>=2*r?2*r:t<=2*r-255?2*r-255:t))/255|0;r=c.data[h+2];t=a.data[h+2];a.data[h+2]=(u*t+q*(t>=2*r?2*r:t<=2*r-255?
2*r-255:t))/255|0}}};G.pinLightOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=h)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*k.data[b]/255|0;let q,r;if(l){let t=l+(q=a.data[e+3])-(l*q/255|0)|0,u=l*q/255|0,w=l*(255^q)/255|0,C=(255^l)*q/255|0;l=c.data[e];r=a.data[e];a.data[e]=(w*l+C*r+u*(r>=2*l?2*l:r<=2*l-255?2*l-255:
r))/t|0;l=c.data[e+1];r=a.data[e+1];a.data[e+1]=(w*l+C*r+u*(r>=2*l?2*l:r<=2*l-255?2*l-255:r))/t|0;l=c.data[e+2];r=a.data[e+2];a.data[e+2]=(w*l+C*r+u*(r>=2*l?2*l:r<=2*l-255?2*l-255:r))/t|0;a.data[e+3]=t}}};G.pinLightOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,h+=e,b+=l)for(let q=0;q<g;q++,h+=4,b++){var f=c.data[h+3]*k.data[b]*
d/25500|0;let r,t;if(f){let u=f+(r=a.data[h+3])-(f*r/255|0)|0,w=f*r/255|0,C=f*(255^r)/255|0,D=(255^f)*r/255|0;f=c.data[h];t=a.data[h];a.data[h]=(C*f+D*t+w*(t>=2*f?2*f:t<=2*f-255?2*f-255:t))/u|0;f=c.data[h+1];t=a.data[h+1];a.data[h+1]=(C*f+D*t+w*(t>=2*f?2*f:t<=2*f-255?2*f-255:t))/u|0;f=c.data[h+2];t=a.data[h+2];a.data[h+2]=(C*f+D*t+w*(t>=2*f?2*f:t<=2*f-255?2*f-255:t))/u|0;a.data[h+3]=u}}};G.passthroughOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*
(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3],f=d/100,m=1-f,q=l*f+255*m;a.data[b]=(c.data[b]*l*f+255*a.data[b]*m)/q|0;a.data[b+1]=(c.data[b+1]*l*f+255*a.data[b+1]*m)/q|0;a.data[b+2]=(c.data[b+2]*l*f+255*a.data[b+2]*m)/q|0;a.data[b+3]=q}};G.passthroughOntoOpaqueFusionWithOpaqueLayer=G.passthroughOntoOpaqueFusionWithTransparentLayer;G.passthroughOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=
0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3],f=a.data[b+3],m=d/100,q=1-m,r=l*m+f*q;a.data[b]=(c.data[b]*l*m+a.data[b]*f*q)/r|0;a.data[b+1]=(c.data[b+1]*l*m+a.data[b+1]*f*q)/r|0;a.data[b+2]=(c.data[b+2]*l*m+a.data[b+2]*f*q)/r|0;a.data[b+3]=r}};G.passthroughOntoTransparentFusionWithOpaqueLayer=G.passthroughOntoTransparentFusionWithTransparentLayer;G.passthroughOntoOpaqueFusionWithTransparentLayerMasked=function(a,
c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3],r=k.data[b]*d/25500,t=1-r,u=q*r+255*t;a.data[h]=(c.data[h]*q*r+255*a.data[h]*t)/u|0;a.data[h+1]=(c.data[h+1]*q*r+255*a.data[h+1]*t)/u|0;a.data[h+2]=(c.data[h+2]*q*r+255*a.data[h+2]*t)/u|0;a.data[h+3]=u}};G.passthroughOntoOpaqueFusionWithOpaqueLayerMasked=G.passthroughOntoOpaqueFusionWithTransparentLayerMasked;
G.passthroughOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+3],r=a.data[h+3],t=k.data[b]*d/25500,u=1-t,w=q*t+r*u;a.data[h]=(c.data[h]*q*t+a.data[h]*r*u)/w|0;a.data[h+1]=(c.data[h+1]*q*t+a.data[h+1]*r*u)/w|0;a.data[h+2]=(c.data[h+2]*q*t+a.data[h+2]*r*u)/w|0;a.data[h+
3]=w}};G.passthroughOntoTransparentFusionWithOpaqueLayerMasked=G.passthroughOntoTransparentFusionWithTransparentLayerMasked;G.replaceOntoFusionWithTransparentLayer=function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0;a.data[b]=c.data[b];a.data[b+1]=c.data[b+1];a.data[b+2]=c.data[b+2];a.data[b+3]=l}};G.replaceOntoFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();
let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3];a.data[b]=c.data[b];a.data[b+1]=c.data[b+1];a.data[b+2]=c.data[b+2];a.data[b+3]=h}};G.replaceOntoFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++){let q=c.data[h+
3]*k.data[b]*d/25500|0;a.data[h]=c.data[h];a.data[h+1]=c.data[h+1];a.data[h+2]=c.data[h+2];a.data[h+3]=q}};G.replaceOntoFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*k.data[b]/255|0;a.data[e]=c.data[e];a.data[e+1]=c.data[e+1];a.data[e+2]=c.data[e+2];a.data[e+3]=m}};G.replaceAlphaOntoFusionWithTransparentLayer=
function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4)a.data[b+3]=c.data[b+3]*d/100|0};G.replaceAlphaOntoFusionWithTransparentLayerMasked=function(a,c,d,b,k){let n=0|b.getHeight(),g=0|b.getWidth(),e=4*(c.width-g)|0,h=0|c.offsetOfPixel(b.left,b.top),l=k.width-g|0;b=0|k.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,h+=e,b+=l)for(let m=0;m<g;m++,h+=4,b++)a.data[h+3]=c.data[h+3]*k.data[b]*d/25500|
0};G.replaceAlphaOntoFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4)a.data[b+3]=c.data[b+3]};G.replaceAlphaOntoFusionWithOpaqueLayerMasked=function(a,c,d,b,k){d=0|b.getHeight();let n=0|b.getWidth(),g=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),h=k.width-n|0;b=0|k.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=h)for(let f=0;f<n;f++,e+=4,b++)a.data[e+3]=
c.data[e+3]*k.data[b]/255|0};G.upgradeMultiplyOfOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let k=0|b.getWidth(),n=4*(c.width-k)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<k;e++,b+=4){let h=c.data[b+3],l,f;h&&(l=c.data[b],f=a.data[b],c.data[b]=l+Math.ceil((255-l)*f*h%65025/(f*h)),l=c.data[b+1],f=a.data[b+1],c.data[b+1]=l+Math.ceil((255-l)*f*h%65025/(f*h)),l=c.data[b+2],f=a.data[b+2],c.data[b+2]=l+Math.ceil((255-l)*f*h%65025/(f*h)))}};G.upgradeMultiplyOfTransparentLayer=
function(a,c,d,b){let k=0|b.getHeight(),n=0|b.getWidth(),g=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<k;e++,b+=g)for(let h=0;h<n;h++,b+=4){let l=c.data[b+3]*d/100|0,f,m;l&&(f=c.data[b],m=a.data[b],c.data[b]=f+Math.ceil((255-f)*m*l%65025/(m*l)),f=c.data[b+1],m=a.data[b+1],c.data[b+1]=f+Math.ceil((255-f)*m*l%65025/(m*l)),f=c.data[b+2],m=a.data[b+2],c.data[b+2]=f+Math.ceil((255-f)*m*l%65025/(m*l)))}};G._normalFuseImageOntoImageAtPosition=function(a,c,d,b,k,n){d=0|b.getHeight();let g=
0|b.getWidth(),e=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);let h=4*(a.width-g)|0;k=0|a.offsetOfPixel(k,n);for(n=0;n<d;n++,b+=e,k+=h)for(let f=0;f<g;f++,b+=4,k+=4){var l=c.data[b+3];let m;if(l){let q=l+(m=a.data[k+3])-(l*m/255|0)|0;l=255*l/q|0;let r=255-l;a.data[k]=(c.data[b]*l+a.data[k]*r)/255|0;a.data[k+1]=(c.data[b+1]*l+a.data[k+1]*r)/255|0;a.data[k+2]=(c.data[b+2]*l+a.data[k+2]*r)/255|0;a.data[k+3]=q}}};G.LM_NORMAL=0;G.LM_MULTIPLY=1;G.LM_ADD=2;G.LM_SCREEN=3;G.LM_LIGHTEN=4;G.LM_DARKEN=5;
G.LM_SUBTRACT=6;G.LM_DODGE=7;G.LM_BURN=8;G.LM_OVERLAY=9;G.LM_HARDLIGHT=10;G.LM_SOFTLIGHT=11;G.LM_VIVIDLIGHT=12;G.LM_LINEARLIGHT=13;G.LM_PINLIGHT=14;G.LM_PASSTHROUGH=15;G.LM_MULTIPLY2=16;G.LM_FIRST=0;G.LM_LAST=16;G.LM_LAST_CHIBIPAINT=G.LM_PINLIGHT;G.BLEND_MODE_CODENAMES="normal multiply add screen lighten darken subtract dodge burn overlay hardLight softLight vividLight linearLight pinLight passthrough multiply2".split(" ");G.BLEND_MODE_DISPLAY_NAMES="Normal;Multiply;Add;Screen;Lighten;Darken;Subtract;Dodge;Burn;Overlay;Hard Light;Soft Light;Vivid Light;Linear Light;Pin Light;Passthrough;Multiply".split(";");
for(let a=0;256>a;a++){let c=a/255;tb[a]=255*(c-c*c)|0}for(let a=0;256>a;a++){let c=a/255;ub[a]=255*(Math.sqrt(c)-c)|0}Ya.prototype.copyFrom=function(a){this.name=a.name;this.blendMode=a.blendMode;this.useLegacyMultiply=a.useLegacyMultiply;this.alpha=a.alpha;this.visible=a.visible;this.parent=a.parent;this.lockAlpha=a.lockAlpha;a.mask?this.mask?this.mask.copyPixelsFrom(a.mask):this.mask=a.mask.clone():this.mask=null;this.maskLinked=a.maskLinked;this.maskVisible=a.maskVisible;a.maskThumbnail?this.maskThumbnail?
this.maskThumbnail.copyPixelsFrom(a.maskThumbnail):this.maskThumbnail=a.maskThumbnail.clone():this.maskThumbnail=null};Ya.prototype.setMask=function(a){(this.mask=a)||(this.maskThumbnail=null)};Ya.prototype.setAlpha=function(a){this.alpha=a};Ya.prototype.getAlpha=function(){return this.alpha};Ya.prototype.getEffectiveAlpha=function(){return this.visible?this.alpha:0};Ya.prototype.getEffectiveMask=function(){return this.maskVisible?this.mask:null};Ya.prototype.setName=function(a){this.name=a};Ya.prototype.getName=
function(){return this.name};Ya.prototype.setBlendMode=function(a){this.blendMode=a;a===G.LM_MULTIPLY?this.useLegacyMultiply=!0:a===G.LM_MULTIPLY2&&(this.useLegacyMultiply=!1)};Ya.prototype.getBlendMode=function(){return this.blendMode};Ya.prototype.getLockAlpha=function(){return this.lockAlpha};Ya.prototype.setLockAlpha=function(a){this.lockAlpha=a};Ya.prototype.setVisible=function(a){this.visible=a};Ya.prototype.getVisible=function(){return this.visible};Ya.prototype.isVisible=Ya.prototype.getVisible;
Ya.prototype.setMaskLinked=function(a){this.maskLinked=a};Ya.prototype.getMaskLinked=function(){return this.maskLinked};Ya.prototype.setMaskVisible=function(a){this.maskVisible=a};Ya.prototype.getMaskVisible=function(){return this.maskVisible};Ya.prototype.getMemoryUsed=function(){return 0};Ya.prototype.getDepth=function(){return null==this.parent?0:this.parent.getDepth()+1};Ya.prototype.ancestorsAreVisible=function(){return null==this.parent||this.parent.visible&&this.parent.ancestorsAreVisible()};
Ya.prototype.hasAncestor=function(a){return this.parent==a||this.parent&&this.parent.hasAncestor(a)};Ya.prototype.clone=function(){throw"Pure virtual CPLayer.clone() call";};Ya.prototype.getNonTransparentBounds=function(a){return new oa(0,0,0,0)};Ya.prototype.rebuildMaskThumbnail=function(){if(this.mask){if(!this.maskThumbnail){var a=Math.ceil(Math.max(this.mask.width/Ya.LAYER_THUMBNAIL_WIDTH,this.mask.height/Ya.LAYER_THUMBNAIL_HEIGHT));this.maskThumbnail=new Ea(Math.floor(this.mask.width/a),Math.floor(this.mask.height/
a),8)}this.maskThumbnail.createThumbnailFrom(this.mask)}else this.maskThumbnail=null};Ya.prototype.getMaskThumbnail=function(){return!this.maskThumbnail&&this.mask&&this.rebuildMaskThumbnail(),this.maskThumbnail};Ya.LAYER_THUMBNAIL_WIDTH=80;Ya.LAYER_THUMBNAIL_HEIGHT=50;sa.prototype=Object.create(Ya.prototype);sa.prototype.constructor=sa;sa.createFromImage=function(a,c){c=new sa(0,0,c);return c.image=a,c};sa.prototype.clone=function(){var a=new sa(0,0,this.name);return a.copyFrom(this),a};sa.prototype.copyFrom=
function(a){Ya.prototype.copyFrom.call(this,a);this.clip=a.clip;this.image?this.image.copyPixelsFrom(a.image):this.image=a.image.clone()};sa.prototype.hasAlpha=function(){return 100!=this.alpha||this.image.hasAlpha()};sa.prototype.hasAlphaInRect=function(a){return 100!=this.alpha||this.image.hasAlphaInRect(a)};sa.prototype.copyImageFrom=function(a){this.image.copyPixelsFrom(a)};sa.prototype.getClippingBase=function(){if(this.clip&&this.parent)for(var a=this.parent.indexOf(this)-1;0<=a;a--)if(this.parent.layers[a]instanceof
sa){if(!this.parent.layers[a].clip)return this.parent.layers[a]}else break;return null};sa.prototype.getClip=function(){return this.clip};sa.prototype.setClip=function(a){this.clip=a};sa.prototype.getNonTransparentBounds=function(a){return this.image.getNonTransparentBounds(a)};sa.prototype.getBounds=function(){return new oa(0,0,this.image.width,this.image.height)};sa.prototype.getMemoryUsed=function(){return this.image?this.image.getMemorySize():0};sa.prototype.rebuildImageThumbnail=function(){if(!this.imageThumbnail){var a=
Math.ceil(Math.max(this.image.width/Ya.LAYER_THUMBNAIL_WIDTH,this.image.height/Ya.LAYER_THUMBNAIL_HEIGHT));this.imageThumbnail=new z(Math.floor(this.image.width/a),Math.floor(this.image.height/a))}this.imageThumbnail.createThumbnailFrom(this.image)};sa.prototype.getImageThumbnail=function(){return this.imageThumbnail||this.rebuildImageThumbnail(),this.imageThumbnail};G.blendFunctionNameForParameters=function(a,c,d,b){d=G.BLEND_MODE_CODENAMES[d]+"Onto";return a?d+="TransparentFusion":d+="OpaqueFusion",
100==c?d+="WithOpaqueLayer":d+="WithTransparentLayer",b&&(d+="Masked"),d};G.fuseImageOntoImage=function(a,c,d,b,k,n,g){0>=b||(c=G.blendFunctionNameForParameters(c,b,k,null!=g),n=a.getBounds().clipTo(n),this[c](a,d,b,n,g))};G.normalFuseImageOntoImageAtPosition=function(a,c,d,b,k){k=k.clone();d=new oa(d,b,0,0);a.getBounds().clipSourceDest(k,d);this._normalFuseImageOntoImageAtPosition(a,c,100,k,d.left,d.top)};G.multiplyAlphaBy=function(a,c){if(100>c)if(0==c)a.clearAll(0);else{a=a.data;for(var d=3;d<
a.length;d+=4)a[d]=Math.round(a[d]*c/100)}};G.multiplyAlphaByMask=function(a,c,d){c/=25500;for(var b=z.ALPHA_BYTE_OFFSET,k=0;b<a.data.length;b+=z.BYTES_PER_PIXEL,k++)a.data[b]=Math.round(a.data[b]*d.data[k]*c)};G.copyAndMultiplyAlphaBy=function(a,c,d,b){if(100==d)a.copyBitmapRect(c,b.left,b.top,b);else if(0==d)a.clearRect(b,0);else for(a=c.data,c=0;c<a.length;c+=4)a[c]=a[c],a[c+1]=a[c+1],a[c+2]=a[c+2],a[c+3]=Math.round(a[c+3]*d/100)};$c.prototype.addChildren=function(a){null!=a&&(Array.isArray(a)?
(a.forEach(c=>c.parent=this),this.layers=this.layers.concat(a)):(a.parent=this,this.layers.push(a)))};var Db={};!function(a){function c(){}function d(g,e){for(var h=g.length;h--;)if(g[h].listener===e)return h;return-1}function b(g){return function(){return this[g].apply(this,arguments)}}var k=c.prototype,n=a.EventEmitter;k.getListeners=function(g){var e,h,l=this._getEvents();if(g instanceof RegExp)for(h in e={},l)l.hasOwnProperty(h)&&g.test(h)&&(e[h]=l[h]);else e=l[g]||(l[g]=[]);return e};k.flattenListeners=
function(g){var e,h=[];for(e=0;e<g.length;e+=1)h.push(g[e].listener);return h};k.getListenersAsObject=function(g){var e,h=this.getListeners(g);return h instanceof Array&&((e={})[g]=h),e||h};k.addListener=function(g,e){if(!function q(m){return"function"==typeof m||m instanceof RegExp||!!m&&"object"==typeof m&&q(m.listener)}(e))throw TypeError("listener must be a function");var h;g=this.getListenersAsObject(g);var l="object"==typeof e;for(h in g)g.hasOwnProperty(h)&&-1===d(g[h],e)&&g[h].push(l?e:{listener:e,
once:!1});return this};k.on=b("addListener");k.addOnceListener=function(g,e){return this.addListener(g,{listener:e,once:!0})};k.once=b("addOnceListener");k.defineEvent=function(g){return this.getListeners(g),this};k.defineEvents=function(g){for(var e=0;e<g.length;e+=1)this.defineEvent(g[e]);return this};k.removeListener=function(g,e){var h,l;g=this.getListenersAsObject(g);for(l in g)g.hasOwnProperty(l)&&-1!==(h=d(g[l],e))&&g[l].splice(h,1);return this};k.off=b("removeListener");k.addListeners=function(g,
e){return this.manipulateListeners(!1,g,e)};k.removeListeners=function(g,e){return this.manipulateListeners(!0,g,e)};k.manipulateListeners=function(g,e,h){var l,f,m=g?this.removeListener:this.addListener;g=g?this.removeListeners:this.addListeners;if("object"!=typeof e||e instanceof RegExp)for(l=h.length;l--;)m.call(this,e,h[l]);else for(l in e)e.hasOwnProperty(l)&&(f=e[l])&&("function"==typeof f?m.call(this,l,f):g.call(this,l,f));return this};k.removeEvent=function(g){var e,h=typeof g,l=this._getEvents();
if("string"===h)delete l[g];else if(g instanceof RegExp)for(e in l)l.hasOwnProperty(e)&&g.test(e)&&delete l[e];else delete this._events;return this};k.removeAllListeners=b("removeEvent");k.emitEvent=function(g,e){var h,l,f,m=this.getListenersAsObject(g);for(f in m)if(m.hasOwnProperty(f)){var q=0;for(h=m[f].slice(0);q<h.length;q++)!0===(l=h[q]).once&&this.removeListener(g,l.listener),l.listener.apply(this,e||[])===this._getOnceReturnValue()&&this.removeListener(g,l.listener)}return this};k.trigger=
b("emitEvent");k.emit=function(g){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(g,e)};k.setOnceReturnValue=function(g){return this._onceReturnValue=g,this};k._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue};k._getEvents=function(){return this._events||(this._events={})};c.noConflict=function(){return a.EventEmitter=n,c};"function"==typeof define&&define.amd?define(function(){return c}):Db?Db=c:a.EventEmitter=c}("undefined"!=
typeof window?window:Db||{});class Pf extends wa(Db){close(){this.layer=this.buffer=null;this.emitEvent("changeLayer")}setLayer(a){this.layer=a;this.invalidRect=a.getBounds();this.emitEvent("changeLayer")}isOpen(){return null!=this.layer}invalidateRect(a){this.invalidRect.union(a)}getImageData(){this.prepareMask();if(!this.invalidRect.isEmpty()&&this.layer&&this.layer.mask){var a=this.buffer,c=this.layer.mask,d=this.invalidRect,b=d.top*c.width+d.left,k=b*z.BYTES_PER_PIXEL,n=d.getWidth();d=d.getHeight();
var g=c.width-n,e=g*z.BYTES_PER_PIXEL;for(let h=0;h<d;h++,b+=g,k+=e)for(let l=0;l<n;l++,b++,k+=z.BYTES_PER_PIXEL)a.data[k+z.RED_BYTE_OFFSET]=c.data[b],a.data[k+z.GREEN_BYTE_OFFSET]=c.data[b],a.data[k+z.BLUE_BYTE_OFFSET]=c.data[b],a.data[k+z.ALPHA_BYTE_OFFSET]=255;!0;this.invalidRect.makeEmpty()}return this.buffer}constructor(a,c){super();this.layer=a;this.buffer=a.mask.getImageData(0,0,a.mask.width,a.mask.height);this.invalidRect=new oa(0,0,0,0);this.prepareMask=c}}class Ub{merge(a){return!1}noChange(){return!1}getMemoryUsed(a,
c){return 0}compact(){}}fb.prototype.getRgb=function(){return this.rgb};fb.prototype.getSaturation=function(){return this.saturation};fb.prototype.getHue=function(){return this.hue};fb.prototype.getValue=function(){return this.value};fb.prototype.setRgbComponents=function(a,c,d){this.setRgb(a<<16|c<<8|d)};fb.prototype.setRgb=function(a){this.rgb=a;var c=a>>16&255,d=a>>8&255;a&=255;this.value=Math.max(c,Math.max(d,a));var b=Math.min(c,Math.min(d,a));if(0==this.value?this.saturation=0:this.saturation=
~~((this.value-b)/this.value*255),0==this.saturation)this.hue=0;else{var k=(this.value-c)/(this.value-b),n=(this.value-d)/(this.value-b);b=(this.value-a)/(this.value-b);var g=0;this.value==c&&(g=b-n);this.value==d&&(g=2+k-b);this.value==a&&(g=4+n-k);0>(g*=60)&&(g+=360);this.hue=~~g}};fb.prototype.setHsv=function(a,c,d){this.hue=a;this.saturation=c;this.value=d;this.rgb=qd(this)};fb.prototype.setHue=function(a){this.hue=a;this.rgb=qd(this)};fb.prototype.setSaturation=function(a){this.saturation=a;
this.rgb=qd(this)};fb.prototype.setValue=function(a){this.value=a;this.rgb=qd(this)};fb.prototype.setGreyscale=function(a){this.rgb=fb.greyToRGB(a);this.saturation=this.hue=0;this.value=a};fb.prototype.clone=function(){var a=new fb(0);return a.copyFrom(this),a};fb.prototype.copyFrom=function(a){this.rgb=a.rgb;this.hue=a.hue;this.saturation=a.saturation;this.value=a.value};fb.prototype.isEqual=function(a){return this.rgb==a.rgb&&this.hue==a.hue&&this.saturation==a.saturation&&this.value==a.value};
fb.greyToRGB=function(a){return a|a<<8|a<<16};lb.prototype.setToIdentity=function(){this.m=[1,0,0,1,0,0]};lb.prototype.multiply=function(a){var c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],b=this.m[1]*a.m[2]+this.m[3]*a.m[3],k=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],n=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=this.m[0]*a.m[0]+this.m[2]*a.m[1];this.m[1]=c;this.m[2]=d;this.m[3]=b;this.m[4]=k;this.m[5]=n};lb.prototype.preMultiply=function(a){var c=a.m[1]*this.m[0]+
a.m[3]*this.m[1],d=a.m[0]*this.m[2]+a.m[2]*this.m[3],b=a.m[1]*this.m[2]+a.m[3]*this.m[3],k=a.m[0]*this.m[4]+a.m[2]*this.m[5]+a.m[4],n=a.m[1]*this.m[4]+a.m[3]*this.m[5]+a.m[5];this.m[0]=a.m[0]*this.m[0]+a.m[2]*this.m[1];this.m[1]=c;this.m[2]=d;this.m[3]=b;this.m[4]=k;this.m[5]=n};lb.prototype.invert=function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),c=-this.m[1]*a,d=-this.m[2]*a,b=this.m[0]*a,k=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),n=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=
this.m[3]*a;this.m[1]=c;this.m[2]=d;this.m[3]=b;this.m[4]=k;this.m[5]=n};lb.prototype.getInverted=function(){var a=new lb;return a.m[0]=this.m[0],a.m[1]=this.m[1],a.m[2]=this.m[2],a.m[3]=this.m[3],a.m[4]=this.m[4],a.m[5]=this.m[5],a.invert(),a};lb.prototype.rotate=function(a){var c=Math.cos(a);a=Math.sin(a);var d=this.m[1]*c+this.m[3]*a,b=-(this.m[0]*a)+this.m[2]*c,k=-(this.m[1]*a)+this.m[3]*c;this.m[0]=this.m[0]*c+this.m[2]*a;this.m[1]=d;this.m[2]=b;this.m[3]=k};lb.prototype.rotateAroundPoint=function(a,
c,d){this.translate(c,d);this.rotate(a);this.translate(-c,-d)};lb.prototype.translate=function(a,c){this.m[4]+=this.m[0]*a+this.m[2]*c;this.m[5]+=this.m[1]*a+this.m[3]*c};lb.prototype.scale=function(a,c){this.m[0]*=a;this.m[1]*=a;this.m[2]*=c;this.m[3]*=c};lb.prototype.scaleAroundPoint=function(a,c,d,b){this.translate(d,b);this.scale(a,c);this.translate(-d,-b)};lb.prototype.shear=function(a,c){var d=this.m[1]+this.m[3]*c,b=this.m[2]+this.m[0]*a;a=this.m[3]+this.m[1]*a;this.m[0]+=this.m[2]*c;this.m[1]=
d;this.m[2]=b;this.m[3]=a};lb.prototype.getTransformedPoint=function(a){return{x:a.x*this.m[0]+a.y*this.m[2]+this.m[4],y:a.x*this.m[1]+a.y*this.m[3]+this.m[5]}};lb.prototype.transformPoints=function(a){for(var c=0;c<a.length;c++)a[c]=this.getTransformedPoint(a[c])};lb.prototype.getTranslateX=function(){return this.m[4]};lb.prototype.getTranslateY=function(){return this.m[5]};lb.prototype.clone=function(){var a=new lb;return a.m[0]=this.m[0],a.m[1]=this.m[1],a.m[2]=this.m[2],a.m[3]=this.m[3],a.m[4]=
this.m[4],a.m[5]=this.m[5],a};lb.prototype.getDeterminant=function(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]};lb.prototype.decompose=function(){var a=this.getDeterminant(),c=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return{translate:{x:this.m[4],y:this.m[5]},rotate:Math.sign(this.m[1])*Math.acos(this.m[0]/c),scale:{x:c,y:a/c},shear:{x:Math.atan((this.m[0]*this.m[2]+this.m[1]*this.m[3])/(c*c)),y:0}}};lb.prototype.toString=function(){return"["+this.m[0].toFixed(2)+" "+this.m[2].toFixed(2)+
" "+this.m[4].toFixed(2)+"]\n["+this.m[1].toFixed(2)+" "+this.m[3].toFixed(2)+" "+this.m[5].toFixed(2)+"]\n[0.00 0.00 1.00]"};Math.sign=Math.sign||function(a){return 0==(a*=1)||isNaN(a)?a:0<a?1:-1};qc.prototype.toInt=function(){return Math.max(0,Math.min(255,Math.round(255*this.r)))<<16|Math.max(0,Math.min(255,Math.round(255*this.g)))<<8|Math.max(0,Math.min(255,Math.round(255*this.b)))};qc.prototype.mixWith=function(a,c){this.r=this.r*(1-c)+a.r*c;this.g=this.g*(1-c)+a.g*c;this.b=this.b*(1-c)+a.b*
c};qc.prototype.clone=function(){return new qc(this.r,this.g,this.b)};qc.createFromInt=function(a){return new qc((a>>>16&255)/255,(a>>>8&255)/255,(255&a)/255)};class Pc{paintDab(a,c,d,b,k,n,g){a=Math.max(1,Math.ceil(n.alpha*b.alphaScale));switch(b.paintMode){case la.PAINT_MODE_FLOW:this._paintFlow(k,c,n.brush,n.width,a);break;case la.PAINT_MODE_OPACITY:this._paintOpacity(k,c,n.brush,n.width,a)}}mergeOntoImage(a,c,d){let b=this._strokeBuffer.data;var k=this._strokedRegion;c=c.data;let n=a.data,g=d>>
16&255,e=d>>8&255;d&=255;let h=0|k.getWidth(),l=0|k.getHeight(),f=this._strokeBuffer.offsetOfPixel(k.left,k.top);k=a.offsetOfPixel(k.left,k.top);let m=this._strokeBuffer.width-h|0;a=(a.width-h)*z.BYTES_PER_PIXEL|0;for(let r=0;r<l;r++,f+=m,k+=a)for(let t=0;t<h;t++,f++,k+=z.BYTES_PER_PIXEL){var q=b[f]/255+.5|0;if(0<q){let u=q+c[k+z.ALPHA_BYTE_OFFSET]*(255-q)/255|0;q=255*q/u|0;let w=255-q;n[k]=(g*q+c[k]*w)/255&255;n[k+1]=(e*q+c[k+1]*w)/255&255;n[k+2]=(d*q+c[k+2]*w)/255&255;n[k+3]=u}}}mergeOntoMask(a,
c,d){let b=this._strokeBuffer.data;var k=this._strokedRegion;c=c.data;let n=a.data,g=0|k.getWidth(),e=0|k.getHeight(),h=a.offsetOfPixel(k.left,k.top);k=this._strokeBuffer.offsetOfPixel(k.left,k.top);let l=this._strokeBuffer.width-g|0;a=a.width-g|0;for(let f=0;f<e;f++,k+=l,h+=a)for(let m=0;m<g;m++,k++,h++){let q=b[k]/255|0;0<q&&(n[h]=(d*q+c[h]*(255-q))/255)}}_paintFlow(a,c,d,b,k){let n=this._strokeBuffer.data;a=a.left+a.top*b;let g=this._strokeBuffer.offsetOfPixel(c.left,c.top),e=c.getHeight(),h=c.getWidth();
b-=h;let l=this._strokeBuffer.width-h;this._strokedRegion.union(c);for(c=0;c<e;c++,a+=b,g+=l)for(let f=0;f<h;f++,a++,g++){let m=d[a]*k;0!=m&&(n[g]=Math.min(65025,n[g]+(255-n[g]/255)*m/255))}}_paintOpacity(a,c,d,b,k){let n=this._strokeBuffer.data;a=a.left+a.top*b;let g=this._strokeBuffer.offsetOfPixel(c.left,c.top),e=c.getWidth();b-=e;let h=this._strokeBuffer.width-e;k=Math.min(255,k);this._strokedRegion.union(c);for(let l=c.top;l<c.bottom;l++,a+=b,g+=h)for(let f=0;f<e;f++,a++,g++)n[g]=Math.max(d[a]*
k,n[g])}beginStroke(){}endStroke(){}constructor(a,c){this._strokeBuffer=a;this._strokedRegion=c;this.wantsOutputAsInput=!0}}class Qf extends Pc{mergeOntoImage(a,c,d){d=this._strokeBuffer.data;let b=this._strokedRegion;c=c.data;let k=a.data;for(let n=b.top;n<b.bottom;n++){let g=a.offsetOfPixel(b.left,n)+z.ALPHA_BYTE_OFFSET,e=this._strokeBuffer.offsetOfPixel(b.left,n);for(let h=b.left;h<b.right;h++,g+=z.BYTES_PER_PIXEL){let l=d[e++]/255|0;0<l&&(k[g]=c[g]*(255-l)/255)}}}}class Rf extends Pc{mergeOntoImage(a,
c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;let k=b.getWidth(),n=b.getHeight(),g=a.offsetOfPixel(b.left,b.top);b=this._strokeBuffer.offsetOfPixel(b.left,b.top);let e=(a.width-k)*z.BYTES_PER_PIXEL,h=this._strokeBuffer.width-k;c=c.data;a=a.data;for(let f=0;f<n;f++,b+=h,g+=e)for(let m=0;m<k;m++,b++,g+=z.BYTES_PER_PIXEL){var l=d[b]/255|0;0<l&&0!=c[g+z.ALPHA_BYTE_OFFSET]&&(l=(l+255)/255,a[g+z.RED_BYTE_OFFSET]=c[g+z.RED_BYTE_OFFSET]*l,a[g+z.GREEN_BYTE_OFFSET]=c[g+z.GREEN_BYTE_OFFSET]*l,a[g+
z.BLUE_BYTE_OFFSET]=c[g+z.BLUE_BYTE_OFFSET]*l)}}mergeOntoMask(a,c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;let k=b.getWidth(),n=b.getHeight(),g=a.offsetOfPixel(b.left,b.top);b=this._strokeBuffer.offsetOfPixel(b.left,b.top);let e=a.width-k,h=this._strokeBuffer.width-k;c=c.data;a=a.data;for(let l=0;l<n;l++,b+=h,g+=e)for(let f=0;f<k;f++,b++,g++){let m=d[b]/255|0;0<m&&(a[g]=Math.min((m+255)/255*c[g],255))}}}class Sf extends Pc{mergeOntoImage(a,c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;
let k=b.getWidth(),n=b.getHeight(),g=a.offsetOfPixel(b.left,b.top);b=this._strokeBuffer.offsetOfPixel(b.left,b.top);let e=(a.width-k)*z.BYTES_PER_PIXEL,h=this._strokeBuffer.width-k;c=c.data;a=a.data;for(let l=0;l<n;l++,b+=h,g+=e)for(let f=0;f<k;f++,b++,g+=z.BYTES_PER_PIXEL){let m=d[b]/255|0;0<m&&0!=c[g+z.ALPHA_BYTE_OFFSET]&&(a[g+z.RED_BYTE_OFFSET]=c[g+z.RED_BYTE_OFFSET]-(260-c[g+z.RED_BYTE_OFFSET])*m/255|0,a[g+z.GREEN_BYTE_OFFSET]=c[g+z.GREEN_BYTE_OFFSET]-(260-c[g+z.GREEN_BYTE_OFFSET])*m/255|0,a[g+
z.BLUE_BYTE_OFFSET]=c[g+z.BLUE_BYTE_OFFSET]-(260-c[g+z.BLUE_BYTE_OFFSET])*m/255|0)}}mergeOntoMask(a,c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;let k=b.getWidth(),n=b.getHeight(),g=a.offsetOfPixel(b.left,b.top);b=this._strokeBuffer.offsetOfPixel(b.left,b.top);let e=a.width-k,h=this._strokeBuffer.width-k;c=c.data;a=a.data;for(let l=0;l<n;l++,b+=h,g+=e)for(let f=0;f<k;f++,b++,g++){let m=d[b]/255|0;0<m&&(a[g]=Math.max(c[g]-(260-c[g])*m/255,0))}}}class Tf extends Pc{mergeOntoImage(a,c,d){d=
this._strokeBuffer.data;let b=this._strokedRegion,k=c.data;a=a.data;var n=b.getWidth();let g=c.width*z.BYTES_PER_PIXEL,e=c.offsetOfPixel(b.left,b.top),h=this._strokeBuffer.offsetOfPixel(b.left,b.top),l=(c.width-n)*z.BYTES_PER_PIXEL;n=this._strokeBuffer.width-n;let f,m,q,r,t=function(w){f+=k[w+z.RED_BYTE_OFFSET];m+=k[w+z.GREEN_BYTE_OFFSET];q+=k[w+z.BLUE_BYTE_OFFSET];r+=k[w+z.ALPHA_BYTE_OFFSET]};for(let w=b.top;w<b.bottom;w++,e+=l,h+=n)for(let C=b.left;C<b.right;C++,e+=z.BYTES_PER_PIXEL,h++){var u=
d[h]/255|0;if(0<u){u=64+-63*u/255|0;let D=u+4;f=u*k[e+z.RED_BYTE_OFFSET];m=u*k[e+z.GREEN_BYTE_OFFSET];q=u*k[e+z.BLUE_BYTE_OFFSET];r=u*k[e+z.ALPHA_BYTE_OFFSET];t(0<w?e-g:e);t(w<c.height-1?e+g:e);t(0<C?e-z.BYTES_PER_PIXEL:e);t(C<c.width-1?e+z.BYTES_PER_PIXEL:e);r/=D;f/=D;m/=D;q/=D;a[e+z.RED_BYTE_OFFSET]=0|f;a[e+z.GREEN_BYTE_OFFSET]=0|m;a[e+z.BLUE_BYTE_OFFSET]=0|q;a[e+z.ALPHA_BYTE_OFFSET]=0|r}}}mergeOntoMask(a,c,d){d=this._strokeBuffer.data;let b=this._strokedRegion,k=c.data;a=a.data;var n=b.getWidth();
let g=c.width,e=c.offsetOfPixel(b.left,b.top),h=this._strokeBuffer.offsetOfPixel(b.left,b.top),l=c.width-n;n=this._strokeBuffer.width-n;for(let q=b.top;q<b.bottom;q++,e+=l,h+=n)for(let r=b.left;r<b.right;r++,e++,h++){var f=d[h]/255|0;if(0<f){var m=64+-63*f/255|0;f=m+4;m=m*k[e]+k[0<q?e-g:e]+k[q<c.height-1?e+g:e]+k[0<r?e-1:e]+k[r<c.width-1?e+1:e];a[e]=m/f|0}}}}class oe extends Pc{mergeOntoImage(a,c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;c=c.data;let k=a.data,n=this._strokeBuffer.offsetOfPixel(b.left,
b.top),g=a.offsetOfPixel(b.left,b.top),e=0|b.getWidth();b=0|b.getHeight();let h=this._strokeBuffer.width-e|0;a=(a.width-e)*z.BYTES_PER_PIXEL|0;for(let m=0;m<b;m++,n+=h,g+=a)for(let q=0;q<e;q++,n++,g+=z.BYTES_PER_PIXEL){let r=d[n];var l=r>>>24;if(0<l){var f=c[g+z.ALPHA_BYTE_OFFSET];f=l+f-l*f/255|0;l=255*l/f|0;let t=255-l;k[g]=((r>>16&255)*l+c[g]*t)/255|0;k[g+1]=((r>>8&255)*l+c[g+1]*t)/255|0;k[g+2]=((255&r)*l+c[g+2]*t)/255|0;k[g+3]=f}}}mergeOntoMask(a,c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;
c=c.data;let k=a.data,n=this._strokeBuffer.offsetOfPixel(b.left,b.top),g=a.offsetOfPixel(b.left,b.top),e=0|b.getWidth();b=0|b.getHeight();let h=this._strokeBuffer.width-e|0;a=a.width-e|0;for(let l=0;l<b;l++,n+=h,g+=a)for(let f=0;f<e;f++,n++,g++){let m=d[n],q=m>>8;0<q&&(k[g]=((255&m)*q+c[g]*(255-q))/255|0)}}}let lf=2/6;class ad extends oe{static _sampleGrey(a,c,d,b,k){c|=0;d|=0;let n=[{x:c,y:d}];for(let g=.25;1.001>g;g+=.25)Array.prototype.push.apply(n,[{x:~~(c+g*b),y:d},{x:~~(c-g*b),y:d},{x:c,y:~~(d+
g*k)},{x:c,y:~~(d-g*k)},{x:~~(c+.7*g*b),y:~~(d+.7*g*k)},{x:~~(c+.7*g*b),y:~~(d-.7*g*k)},{x:~~(c-.7*g*b),y:~~(d+.7*g*k)},{x:~~(c-.7*g*b),y:~~(d-.7*g*k)}]);return xe(n.map(g=>a.getPixel(g.x,g.y)))}static _sampleRGB(a,c,d,b,k){c|=0;d|=0;let n=[{x:c,y:d}];for(let g=.25;1.001>g;g+=.25)Array.prototype.push.apply(n,[{x:~~(c+g*b),y:d},{x:~~(c-g*b),y:d},{x:c,y:~~(d+g*k)},{x:c,y:~~(d-g*k)},{x:~~(c+.7*g*b),y:~~(d+.7*g*k)},{x:~~(c+.7*g*b),y:~~(d-.7*g*k)},{x:~~(c-.7*g*b),y:~~(d+.7*g*k)},{x:~~(c-.7*g*b),y:~~(d-
.7*g*k)}]);return ye(n.map(g=>qc.createFromInt(a.getPixel(g.x,g.y))))}_paintToColorStrokeBuffer(a,c,d,b,k,n){let g=this._strokeBuffer.data,e=c.getWidth(),h=c.getHeight(),l=this._strokeBuffer.width-e,f=b-e;a=a.left+a.top*b;b=this._strokeBuffer.offsetOfPixel(c.left,c.top);this._strokedRegion.union(c);for(c=0;c<h;c++,a+=f,b+=l)for(let r=0;r<e;r++,a++,b++){var m=d[a]*k/255|0;if(0<m){let t=g[b];var q=t>>>24;q=m+q-m*q/255|0;m=255-(255*m/q|0);g[b]=q<<24|(n>>16&255)+((t>>16&255)*m-(n>>16&255)*m)/255<<16|
(n>>8&255)+((t>>8&255)*m-(n>>8&255)*m)/255<<8|(255&n)+((255&t)*m-(255&n)*m)/255}}}_paintToGreyscaleStrokeBuffer(a,c,d,b,k,n){let g=this._strokeBuffer.data;this._strokedRegion.union(c);for(let l=c.top,f=a.top;l<c.bottom;l++,f++){let m=a.left+f*b,q=this._strokeBuffer.offsetOfPixel(c.left,l);for(let r=c.left;r<c.right;r++,m++,q++){var e=d[m]*k/255|0;if(0>=e)continue;let t=g[q];var h=t>>8;h=e+h-e*h/255|0;0<h&&(e=255-(255*e/h|0),g[q]=h<<8|n+((255&t)*e-n*e)/255)}}}beginStroke(){this._previousSamples=null}paintDab(a,
c,d,b,k,n,g){var e,h;a=Math.max(1,n.alpha/4);var l=(c.left+c.right)/2,f=(c.top+c.bottom)/2,m=Math.max(1,Math.min(64,c.getWidth()*lf)),q=Math.max(1,Math.min(64,c.getHeight()*lf));if(d instanceof Ea){null==this._previousSamples&&(this._previousSamples=Array(50),this._previousSamples.fill(ad._sampleGrey(d,l,f,m,q)));let t=xe(this._previousSamples);var r=t;g=r=t=r*(1-(e=b.resat*b.resat))+(255&g)*e;d=ad._sampleGrey(d,l,f,m,q);t=g*(1-(h=b.bleed))+d*h;this._previousSamples.push(t);this._previousSamples.shift();
this._paintToGreyscaleStrokeBuffer(k,c,n.brush,n.width,a,Math.round(r))}else null==this._previousSamples&&(this._previousSamples=Array(50),this._previousSamples.fill(ad._sampleRGB(d,l,f,m,q))),h=ye(this._previousSamples),h.mixWith(qc.createFromInt(g),b.resat*b.resat),g=h.toInt(),h.mixWith(ad._sampleRGB(d,l,f,m,q),b.bleed),this._previousSamples.push(h),this._previousSamples.shift(),this._paintToColorStrokeBuffer(k,c,n.brush,n.width,a,g)}constructor(a,c){super(a,c);this.wantsOutputAsInput=!0}}class Vf extends oe{_accumulatePaintFromMask(a,
c,d,b){let k=this._brushBuffer.data,n=a.data,g=d.getWidth(),e=d.getHeight();c=c.left+c.top*this._brushBuffer.width;d=a.offsetOfPixel(d.left,d.top);let h=this._brushBuffer.width-g;a=a.width-g;if(!(0>=b))for(let f=0;f<e;f++,c+=h,d+=a)for(let m=0;m<g;m++,c++,d++){let q=n[d],r=k[c];var l=r>>8;l=b+l-b*l/255|0;let t=255-(255*b/l|0);k[c]=l<<8|q+((255&r)*t-q*t)/255}}_resaturateBrushWithGrey(a,c,d){if(!(0>=c)){var b=this._brushBuffer.data,k=a.getWidth(),n=a.getHeight();a=a.left+a.top*this._brushBuffer.width;
var g=this._brushBuffer.width-k;for(let h=0;h<n;h++,a+=g)for(let l=0;l<k;l++,a++){let f=b[a];var e=f>>8;e=c+e-c*e/255|0;let m=255-(255*c/e|0);b[a]=e<<8|d+((255&f)*m-d*m)/255}}}_paintToGreyscaleStrokeBuffer(a,c,d,b,k){let n=this._strokeBuffer.data,g=this._brushBuffer.data,e=a.data;this._strokedRegion.union(d);for(let l=d.top,f=c.top;l<d.bottom;l++,f++){let m=this._brushBuffer.offsetOfPixel(c.left,f),q=this._strokeBuffer.offsetOfPixel(d.left,l),r=a.offsetOfPixel(d.left,l);for(let t=d.left;t<d.right;t++,
m++,r++,q++){let u=g[m];var h=(u>>8)*b[m]*k/65025|0;0<h&&(h=255-h,n[q]=65280|(255&u)+(e[r]*h-(255&u)*h)/255)}}}_accumulatePaintFromImage(a,c,d,b){let k=this._brushBuffer.data,n=a.data,g=d.getWidth(),e=d.getHeight();c=c.left+c.top*this._brushBuffer.width;d=a.offsetOfPixel(d.left,d.top);let h=this._brushBuffer.width-g;a=(a.width-g)*z.BYTES_PER_PIXEL;for(let m=0;m<e;m++,c+=h,d+=a)for(let q=0;q<g;q++,c++,d+=z.BYTES_PER_PIXEL){var l=n[d+z.ALPHA_BYTE_OFFSET]*b/255|0;if(0<l){let r=k[c];var f=r>>>24;f=l+
f-l*f/255|0;l=255-(255*l/f|0);let t=n[d+z.RED_BYTE_OFFSET],u=n[d+z.GREEN_BYTE_OFFSET],w=n[d+z.BLUE_BYTE_OFFSET];k[c]=f<<24|t+((r>>16&255)*l-t*l)/255<<16|u+((r>>8&255)*l-u*l)/255<<8|w+((255&r)*l-w*l)/255}}}_resaturateBrushWithColor(a,c,d){if(!(0>=c)){var b=this._brushBuffer.data,k=a.getWidth(),n=a.getHeight();a=a.left+a.top*this._brushBuffer.width;var g=this._brushBuffer.width-k;for(let h=0;h<n;h++,a+=g)for(let l=0;l<k;l++,a++){let f=b[a];var e=f>>>24;e=c+e-c*e/255|0;let m=255-(255*c/e|0);b[a]=e<<
24|(d>>>16&255)+((f>>>16&255)*m-(d>>>16&255)*m)/255<<16|(d>>>8&255)+((f>>>8&255)*m-(d>>>8&255)*m)/255<<8|(255&d)+((255&f)*m-(255&d)*m)/255}}}_paintToColorStrokeBuffer(a,c,d,b,k){let n=this._strokeBuffer.data,g=this._brushBuffer.data,e=a.data;this._strokedRegion.union(d);for(let f=d.top,m=c.top;f<d.bottom;f++,m++){let q=this._brushBuffer.offsetOfPixel(c.left,m),r=this._strokeBuffer.offsetOfPixel(d.left,f),t=a.offsetOfPixel(d.left,f);for(let u=d.left;u<d.right;u++,q++,t+=z.BYTES_PER_PIXEL,r++){let w=
g[q];var h=(w>>>24)*b[q]*k/65025|0;if(0<h){var l=e[t+z.ALPHA_BYTE_OFFSET];l=h+l-h*l/255|0;h=255-(255*h/l|0);n[r]=l<<24|(w>>16&255)+(e[t+z.RED_BYTE_OFFSET]*h-(w>>16&255)*h)/255<<16|(w>>8&255)+(e[t+z.GREEN_BYTE_OFFSET]*h-(w>>8&255)*h)/255<<8|(255&w)+(e[t+z.BLUE_BYTE_OFFSET]*h-(255&w)*h)/255}}}}paintDab(a,c,d,b,k,n,g){a instanceof z?null==this._brushBuffer?(this._brushBuffer=new Ea(n.width,n.height,32),this._accumulatePaintFromImage(d,k,c,255)):(this._resaturateBrushWithColor(k,~~(0>=b.resat?0:Math.max(1,
b.resat*b.resat*255)),16777215&g),this._paintToColorStrokeBuffer(a,k,c,n.brush,n.alpha),this._accumulatePaintFromImage(d,k,c,~~(255*b.bleed))):null==this._brushBuffer?(this._brushBuffer=new Ea(n.width,n.height,16),this._accumulatePaintFromMask(d,k,c,255)):(this._resaturateBrushWithGrey(k,~~(0>=b.resat?0:Math.max(1,b.resat*b.resat*255)),255&g),this._paintToGreyscaleStrokeBuffer(a,k,c,n.brush,n.alpha),this._accumulatePaintFromMask(d,k,c,~~(255*b.bleed)))}endStroke(){this._brushBuffer=null}constructor(a,
c){super(a,c);this.wantsOutputAsInput=!0}}class Uf extends oe{_sampleFromMask(a,c,d,b){let k=this._brushBuffer.data,n=c.getWidth(),g=c.getHeight(),e=this._brushBuffer.offsetOfPixel(c.left,c.top);d=a.offsetOfPixel(d.left,d.top);let h=this._brushBuffer.width-n,l=a.width-n,f=255-b;if(255!=b){for(let m=0;m<g;m++,e+=h,d+=l)for(let q=0;q<n;q++,e++,d++){let r=a.data[d],t=k[e],u=(r*f+(255&t)*b)/255,w=(255*f+(t>>8)*b)/255<<8|u;w==t&&(r>u?w++:r<u&&w--);k[e]=w}ze(this._brushBuffer,c)}}_paintToMask(a,c,d,b){let k=
c.getWidth(),n=c.getHeight();c=this._brushBuffer.offsetOfPixel(c.left,c.top);d=a.offsetOfPixel(d.left,d.top);let g=this._brushBuffer.width-k,e=a.width-k;a=a.data;let h=this._brushBuffer.data;for(let l=0;l<n;l++,d+=e,c+=g)for(let f=0;f<k;f++,c++,d++){let m=h[c],q=255&m;0<((m>>8)*b[c]/255|0)&&(a[d]=q)}}_sampleFromImage(a,c,d,b){let k=this._brushBuffer.data,n=c.getWidth(),g=c.getHeight(),e=this._brushBuffer.offsetOfPixel(c.left,c.top);d=a.offsetOfPixel(d.left,d.top);let h=this._brushBuffer.width-n,l=
(a.width-n)*z.BYTES_PER_PIXEL,f=255-b;if(255!=b){for(let q=0;q<g;q++,e+=h,d+=l)for(let r=0;r<n;r++,e++,d+=z.BYTES_PER_PIXEL){let t=a.data[d+z.RED_BYTE_OFFSET],u=a.data[d+z.GREEN_BYTE_OFFSET],w=a.data[d+z.BLUE_BYTE_OFFSET];var m=k[e];let C=(a.data[d+z.ALPHA_BYTE_OFFSET]*f+(m>>24&255)*b)/255<<24&4278190080|(t*f+(m>>16&255)*b)/255<<16&16711680|(u*f+(m>>8&255)*b)/255<<8&65280|(w*f+(255&m)*b)/255&255;if(C==m){m=(16711680&C)>>16;let D=(65280&C)>>8,A=255&C;t>m?C+=65536:t<m&&(C-=65536);u>D?C+=256:u<D&&(C-=
256);w>A?C+=1:w<A&&--C}k[e]=C}ze(this._brushBuffer,c)}}_paintToImage(a,c,d,b){let k=c.getWidth(),n=c.getHeight();c=this._brushBuffer.offsetOfPixel(c.left,c.top);d=a.offsetOfPixel(d.left,d.top);let g=this._brushBuffer.width-k,e=(a.width-k)*z.BYTES_PER_PIXEL;a=a.data;let h=this._brushBuffer.data;for(let l=0;l<n;l++,d+=e,c+=g)for(let f=0;f<k;f++,c++,d+=z.BYTES_PER_PIXEL){let m=h[c];0<((m>>>24)*b[c]/255|0)&&(a[d+z.RED_BYTE_OFFSET]=m>>16&255,a[d+z.GREEN_BYTE_OFFSET]=m>>8&255,a[d+z.BLUE_BYTE_OFFSET]=255&
m,a[d+z.ALPHA_BYTE_OFFSET]=m>>24&255)}}paintDab(a,c,d,b,k,n,g){a instanceof z?null==this._brushBuffer?(this._brushBuffer=new Ea(n.width,n.height,32),this._sampleFromImage(d,k,c,0)):(this._sampleFromImage(d,k,c,n.alpha),this._paintToImage(a,k,c,n.brush)):null==this._brushBuffer?(this._brushBuffer=new Ea(n.width,n.height,16),this._sampleFromMask(d,k,c,0)):(this._sampleFromMask(d,k,c,n.alpha),this._paintToMask(a,k,c,n.brush))}mergeOntoImage(a,c,d){}mergeOntoMask(a,c,d){}beginStroke(){this._brushBuffer=
null}endStroke(){this._brushBuffer=null}constructor(a,c){super(a,c);this._brushBuffer=null;this.noMergePhase=this.wantsOutputAsInput=!0}}"use strict";"use strict";Yb.prototype=Object.create(wa(Db).prototype);Yb.prototype.constructor=Yb;Yb.prototype.getBounds=function(){return new oa(0,0,this.width,this.height)};Yb.prototype.isPointWithin=function(a,c){return 0<=a&&0<=c&&a<this.width&&c<this.height};Yb.EDITING_MODE_IMAGE=0;Yb.EDITING_MODE_MASK=1;ab.prototype.readChar=function(){return this.pos<this.end?
String.fromCharCode(this.data[this.pos++]):(this.eof=!0,-1)};ab.prototype.readByte=function(){return this.pos<this.end?this.data[this.pos++]:(this.eof=!0,-1)};ab.prototype.readU8=ab.prototype.readByte;ab.prototype.readS8=function(){var a;return 128&(a=this.readByte())?4294967040|a:a};ab.prototype.unreadChar=function(a){this.pos--};ab.prototype.peekChar=function(){return this.pos<this.end?String.fromCharCode(this.data[this.pos]):(this.eof=!0,-1)};ab.prototype.readString=function(a){var c,d=Array(a);
for(c=0;c<a;c++)d[c]=this.readChar();return d.join("")};ab.prototype.readS16=function(){var a;return 32768&(a=this.readByte()<<8|this.readByte())?4294901760|a:a};ab.prototype.readU16BE=function(){return this.readByte()<<8|this.readByte()};ab.prototype.readU16LE=function(){var a=this.readByte();return this.readByte()<<8|a};ab.prototype.readU32BE=function(){return(this.readByte()<<24|this.readByte()<<16|this.readByte()<<8|this.readByte())>>>0};ab.prototype.readU32LE=function(){var a=this.readByte(),
c=this.readByte(),d=this.readByte();return(this.readByte()<<24|d<<16|c<<8|a)>>>0};ab.prototype.readBytes=function(a){var c=this.data.subarray(this.pos,this.pos+a);return this.pos+=a,this.pos>this.end&&(this.eof=!0),c};ab.prototype.skip=function(a){this.pos+=a;this.pos>this.end&&(this.eof=!0)};ab.prototype.seek=function(a){this.pos=a};ab.prototype.writeBytes=function(a){for(var c=0;c<a.length;c++)this.data[this.pos++]=a[c]};ab.prototype.writeByte=function(a){this.data[this.pos++]=a};ab.prototype.writeU8=
ab.prototype.writeByte;ab.prototype.writeU16LE=function(a){this.data[this.pos++]=a;this.data[this.pos++]=a>>8};ab.prototype.writeU16BE=function(a){this.data[this.pos++]=a>>8;this.data[this.pos++]=a};ab.prototype.writeU32BE=function(a){this.data[this.pos++]=a>>24;this.data[this.pos++]=a>>16;this.data[this.pos++]=a>>8;this.data[this.pos++]=a};ab.prototype.writeU32LE=function(a){this.data[this.pos++]=a;this.data[this.pos++]=a>>8;this.data[this.pos++]=a>>16;this.data[this.pos++]=a>>24};ab.prototype.writeDoubleBE=
function(a){a=new Uint8Array((new Float64Array([a])).buffer);for(var c=a.length-1;0<=c;c--)this.writeByte(a[c])};ab.prototype.writeFloatBE=function(a){a=new Uint8Array((new Float32Array([a])).buffer);for(var c=a.length-1;0<=c;c--)this.writeByte(a[c])};ab.prototype.writeString=function(a){for(var c=0;c<a.length;c++)this.data[this.pos++]=a.charCodeAt(c)};ab.prototype.writeUnsignedIntBE=function(a,c){switch(void 0===c&&(c=this.measureUnsignedInt(a)),c){case 5:this.writeU8(Math.floor(a/4294967296));case 4:this.writeU8(a>>
24);case 3:this.writeU8(a>>16);case 2:this.writeU8(a>>8);case 1:this.writeU8(a);break;default:throw"Bad UINT size "+c;}};ab.prototype.measureUnsignedInt=function(a){return 256>a?1:65536>a?2:16777216>a?3:4294967296>a?4:5};ab.prototype.getAsDataArray=function(){if(this.pos<this.data.byteLength)return this.data.subarray(0,this.pos);if(this.pos==this.data.byteLength)return this.data;throw"ArrayDataStream's pos lies beyond end of buffer";};ab.prototype.EOF=-1;var ge={},Fa={},vg="undefined"!=typeof Uint8Array&&
"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;Fa.assign=function(a){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var d=c.shift();if(d){if("object"!=typeof d)throw TypeError(d+"must be non-object");for(var b in d)Object.prototype.hasOwnProperty.call(d,b)&&(a[b]=d[b])}}return a};Fa.shrinkBuf=function(a,c){return a.length===c?a:a.subarray?a.subarray(0,c):(a.length=c,a)};"use strict";"use strict";"use strict";var wg={arraySet:function(a,c,d,b,k){if(c.subarray&&a.subarray)return void a.set(c.subarray(d,
d+b),k);for(var n=0;n<b;n++)a[k+n]=c[d+n]},flattenChunks:function(a){var c,d;var b=c=0;for(d=a.length;c<d;c++)b+=a[c].length;c=0;var k=new Uint8Array(b);b=0;for(d=a.length;c<d;c++){var n=a[c];k.set(n,b);b+=n.length}return k}},xg={arraySet:function(a,c,d,b,k){for(var n=0;n<b;n++)a[k+n]=c[d+n]},flattenChunks:function(a){return[].concat.apply([],a)}};Fa.setTyped=function(a){a?(Fa.Buf8=Uint8Array,Fa.Buf16=Uint16Array,Fa.Buf32=Int32Array,Fa.assign(Fa,wg)):(Fa.Buf8=Array,Fa.Buf16=Array,Fa.Buf32=Array,Fa.assign(Fa,
xg))};Fa.setTyped(vg);var yg=Fa.assign,ld={};uc(ld,"Deflate",function(){return mf},function(a){return mf=a});uc(ld,"deflate",function(){return nf},function(a){return nf=a});uc(ld,"deflateRaw",function(){return of},function(a){return of=a});uc(ld,"gzip",function(){return pf},function(a){return pf=a});var Xd=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],sd=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],zg=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],qf=[16,17,18,0,8,
7,9,6,10,5,11,4,12,3,13,2,14,1,15],sc=Array(576);Qc(sc);var md=Array(60);Qc(md);var bd=Array(512);Qc(bd);var dd=Array(256);Qc(dd);var Yd=Array(29);Qc(Yd);var td=Array(30);Qc(td);var rf=!1;"use strict";var Yf=function(a){if(!rf){var c,d,b=Array(16);for(c=d=0;28>d;d++){var k=0;for(Yd[d]=c;k<1<<Xd[d];k++)dd[c++]=d}dd[c-1]=d;for(d=c=0;16>d;d++)for(k=0,td[d]=c;k<1<<sd[d];k++)bd[c++]=d;for(c>>=7;30>d;d++)for(k=0,td[d]=c<<7;k<1<<sd[d]-7;k++)bd[256+c++]=d;for(k=0;15>=k;k++)b[k]=0;for(k=0;143>=k;)sc[2*k+1]=
8,k++,b[8]++;for(;255>=k;)sc[2*k+1]=9,k++,b[9]++;for(;279>=k;)sc[2*k+1]=7,k++,b[7]++;for(;287>=k;)sc[2*k+1]=8,k++,b[8]++;De(sc,287,b);for(k=0;30>k;k++)md[2*k+1]=5,md[2*k]=Ce(k,5);hf=new Ud(sc,Xd,257,286,15);jf=new Ud(md,sd,0,30,15);kf=new Ud([],zg,0,19,7);!0;rf=!0}a.l_desc=new Vd(a.dyn_ltree,hf);a.d_desc=new Vd(a.dyn_dtree,jf);a.bl_desc=new Vd(a.bl_tree,kf);a.bi_buf=0;a.bi_valid=0;Ee(a)};var Wf=function(a,c,d,b){var k,n,g=0;0<a.level?(2===a.strm.data_type&&(a.strm.data_type=function(e){var h,l=4093624447;
for(h=0;31>=h;h++,l>>>=1)if(1&l&&0!==e.dyn_ltree[2*h])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(h=32;256>h;h++)if(0!==e.dyn_ltree[2*h])return 1;return 0}(a)),Zd(a,a.l_desc),Zd(a,a.d_desc),g=function(e){var h;Ie(e,e.dyn_ltree,e.l_desc.max_code);Ie(e,e.dyn_dtree,e.d_desc.max_code);Zd(e,e.bl_desc);for(h=18;3<=h&&0===e.bl_tree[2*qf[h]+1];h--);return e.opt_len+=3*(h+1)+14,h}(a),k=a.opt_len+3+7>>>3,(n=a.static_len+3+7>>>3)<=k&&(k=n)):k=n=d+5;d+4<=k&&-1!==c?Ke(a,
c,d,b):4===a.strategy||n===k?(ac(a,2+ +!!b,3),He(a,sc,md)):(ac(a,4+ +!!b,3),function(e,h,l,f){var m;ac(e,h-257,5);ac(e,l-1,5);ac(e,f-4,4);for(m=0;m<f;m++)ac(e,e.bl_tree[2*qf[m]+1],3);Je(e,e.dyn_ltree,h-1);Je(e,e.dyn_dtree,l-1)}(a,a.l_desc.max_code+1,a.d_desc.max_code+1,g+1),He(a,a.dyn_ltree,a.dyn_dtree));Ee(a);b&&Fe(a)};var Ac=function(a,c,d){return a.pending_buf[a.d_buf+2*a.last_lit]=c>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&c,a.pending_buf[a.l_buf+a.last_lit]=255&d,a.last_lit++,0===c?
a.dyn_ltree[2*d]++:(a.matches++,c--,a.dyn_ltree[2*(dd[d]+256+1)]++,a.dyn_dtree[2*Be(c)]++),a.last_lit===a.lit_bufsize-1};var Ag=function(a){ac(a,2,3);mc(a,256,sc);16===a.bi_valid?(cd(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):8<=a.bi_valid&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)};"use strict";var Rc={};Rc=function(a,c,d,b){var k=65535&a;a=a>>>16&65535;for(var n;0!==d;){n=2E3<d?2E3:d;d-=n;do a=a+(k=k+c[b++]|0)|0;while(--n);k%=65521;a%=65521}return k|a<<16};"use strict";var Hb=
{},Bg=function(){for(var a,c=[],d=0;256>d;d++){a=d;for(var b=0;8>b;b++)a=1&a?3988292384^a>>>1:a>>>1;c[d]=a}return c}();Hb=function(a,c,d,b){d=b+d;for(a^=-1;b<d;b++)a=a>>>8^Bg[(a^c[b])&255];return-1^a};var Hc={};Hc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};var fd=[new nc(0,0,0,0,function(a,c){var d=65535;for(65535>a.pending_buf_size-5&&(d=a.pending_buf_size-5);;){if(1>=
a.lookahead){if(Ic(a),0===a.lookahead&&0===c)return 1;if(0===a.lookahead)break}a.strstart+=a.lookahead;a.lookahead=0;var b=a.block_start+d;if((0===a.strstart||a.strstart>=b)&&(a.lookahead=a.strstart-b,a.strstart=b,Mb(a,!1),0===a.strm.avail_out)||a.strstart-a.block_start>=a.w_size-262&&(Mb(a,!1),0===a.strm.avail_out))return 1}return(a.insert=0,4===c)?(Mb(a,!0),0===a.strm.avail_out)?3:4:(a.strstart>a.block_start&&(Mb(a,!1),a.strm.avail_out),1)}),new nc(4,4,8,4,$d),new nc(4,5,16,8,$d),new nc(4,6,32,
32,$d),new nc(4,4,16,16,Sc),new nc(8,16,32,32,Sc),new nc(8,16,128,128,Sc),new nc(8,32,128,256,Sc),new nc(32,128,258,1024,Sc),new nc(32,258,258,4096,Sc)];"use strict";var Cg=function(a,c){if(!a||!a.state||5<c||0>c)return a?xc(a,-2):-2;if(b=a.state,!a.output||!a.input&&0!==a.avail_in||666===b.status&&4!==c)return xc(a,0===a.avail_out?-5:-2);if(b.strm=a,d=b.last_flush,b.last_flush=c,42===b.status)if(2===b.wrap)a.adler=0,gb(b,31),gb(b,139),gb(b,8),b.gzhead?(gb(b,+!!b.gzhead.text+2*!!b.gzhead.hcrc+4*!!b.gzhead.extra+
8*!!b.gzhead.name+16*!!b.gzhead.comment),gb(b,255&b.gzhead.time),gb(b,b.gzhead.time>>8&255),gb(b,b.gzhead.time>>16&255),gb(b,b.gzhead.time>>24&255),gb(b,9===b.level?2:4*(2<=b.strategy||2>b.level)),gb(b,255&b.gzhead.os),b.gzhead.extra&&b.gzhead.extra.length&&(gb(b,255&b.gzhead.extra.length),gb(b,b.gzhead.extra.length>>8&255)),b.gzhead.hcrc&&(a.adler=Hb(a.adler,b.pending_buf,b.pending,0)),b.gzindex=0,b.status=69):(gb(b,0),gb(b,0),gb(b,0),gb(b,0),gb(b,0),gb(b,9===b.level?2:4*(2<=b.strategy||2>b.level)),
gb(b,3),b.status=113);else{var d,b;var k=8+(b.w_bits-8<<4)<<8;k|=(2<=b.strategy||2>b.level?0:6>b.level?1:6===b.level?2:3)<<6;0!==b.strstart&&(k|=32);b.status=113;ed(b,k+(31-k%31));0!==b.strstart&&(ed(b,a.adler>>>16),ed(b,65535&a.adler));a.adler=1}if(69===b.status)if(b.gzhead.extra){for(k=b.pending;b.gzindex<(65535&b.gzhead.extra.length)&&(b.pending!==b.pending_buf_size||(b.gzhead.hcrc&&b.pending>k&&(a.adler=Hb(a.adler,b.pending_buf,b.pending-k,k)),zc(a),k=b.pending,b.pending!==b.pending_buf_size));)gb(b,
255&b.gzhead.extra[b.gzindex]),b.gzindex++;b.gzhead.hcrc&&b.pending>k&&(a.adler=Hb(a.adler,b.pending_buf,b.pending-k,k));b.gzindex===b.gzhead.extra.length&&(b.gzindex=0,b.status=73)}else b.status=73;if(73===b.status)if(b.gzhead.name){k=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>k&&(a.adler=Hb(a.adler,b.pending_buf,b.pending-k,k)),zc(a),k=b.pending,b.pending===b.pending_buf_size)){var n=1;break}n=b.gzindex<b.gzhead.name.length?255&b.gzhead.name.charCodeAt(b.gzindex++):
0;gb(b,n)}while(0!==n);b.gzhead.hcrc&&b.pending>k&&(a.adler=Hb(a.adler,b.pending_buf,b.pending-k,k));0===n&&(b.gzindex=0,b.status=91)}else b.status=91;if(91===b.status)if(b.gzhead.comment){k=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>k&&(a.adler=Hb(a.adler,b.pending_buf,b.pending-k,k)),zc(a),k=b.pending,b.pending===b.pending_buf_size)){n=1;break}n=b.gzindex<b.gzhead.comment.length?255&b.gzhead.comment.charCodeAt(b.gzindex++):0;gb(b,n)}while(0!==n);b.gzhead.hcrc&&b.pending>
k&&(a.adler=Hb(a.adler,b.pending_buf,b.pending-k,k));0===n&&(b.status=103)}else b.status=103;if(103===b.status&&(b.gzhead.hcrc?(b.pending+2>b.pending_buf_size&&zc(a),b.pending+2<=b.pending_buf_size&&(gb(b,255&a.adler),gb(b,a.adler>>8&255),a.adler=0,b.status=113)):b.status=113),0!==b.pending){if(zc(a),0===a.avail_out)return b.last_flush=-1,0}else if(0===a.avail_in&&(c<<1)-9*(4<c)<=(d<<1)-9*(4<d)&&4!==c)return xc(a,-5);if(666===b.status&&0!==a.avail_in)return xc(a,-5);if(0!==a.avail_in||0!==b.lookahead||
0!==c&&666!==b.status){d=2===b.strategy?function(g,e){for(var h;;){if(0===g.lookahead&&(Ic(g),0===g.lookahead)){if(0===e)return 1;break}if(g.match_length=0,h=Ac(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++,h&&(Mb(g,!1),0===g.strm.avail_out))return 1}return(g.insert=0,4===e)?(Mb(g,!0),0===g.strm.avail_out)?3:4:g.last_lit&&(Mb(g,!1),0===g.strm.avail_out)?1:2}(b,c):3===b.strategy?function(g,e){for(var h,l,f,m,q=g.window;;){if(258>=g.lookahead){if(Ic(g),258>=g.lookahead&&0===e)return 1;if(0===
g.lookahead)break}if(g.match_length=0,3<=g.lookahead&&0<g.strstart&&(l=q[f=g.strstart-1])===q[++f]&&l===q[++f]&&l===q[++f]){for(m=g.strstart+258;l===q[++f]&&l===q[++f]&&l===q[++f]&&l===q[++f]&&l===q[++f]&&l===q[++f]&&l===q[++f]&&l===q[++f]&&f<m;);g.match_length=258-(m-f);g.match_length>g.lookahead&&(g.match_length=g.lookahead)}if(3<=g.match_length?(h=Ac(g,1,g.match_length-3),g.lookahead-=g.match_length,g.strstart+=g.match_length,g.match_length=0):(h=Ac(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++),
h&&(Mb(g,!1),0===g.strm.avail_out))return 1}return(g.insert=0,4===e)?(Mb(g,!0),0===g.strm.avail_out)?3:4:g.last_lit&&(Mb(g,!1),0===g.strm.avail_out)?1:2}(b,c):fd[b.level].func(b,c);if((3===d||4===d)&&(b.status=666),1===d||3===d)return 0===a.avail_out&&(b.last_flush=-1),0;if(2===d&&(1===c?Ag(b):5!==c&&(Ke(b,0,0,!1),3===c&&(yc(b.head),0===b.lookahead&&(b.strstart=0,b.block_start=0,b.insert=0))),zc(a),0===a.avail_out))return b.last_flush=-1,0}return 4!==c?0:0>=b.wrap?1:(2===b.wrap?(gb(b,255&a.adler),
gb(b,a.adler>>8&255),gb(b,a.adler>>16&255),gb(b,a.adler>>24&255),gb(b,255&a.total_in),gb(b,a.total_in>>8&255),gb(b,a.total_in>>16&255),gb(b,a.total_in>>24&255)):(ed(b,a.adler>>>16),ed(b,65535&a.adler)),zc(a),0<b.wrap&&(b.wrap=-b.wrap),+(0===b.pending))};var Dg=function(a){var c;return a&&a.state?42!==(c=a.state.status)&&69!==c&&73!==c&&91!==c&&103!==c&&113!==c&&666!==c?xc(a,-2):(a.state=null,113===c?xc(a,-3):0):-2};var Zf=function(a,c){var d,b,k;var n=c.length;if(!a||!a.state||2===(b=(d=a.state).wrap)||
1===b&&42!==d.status||d.lookahead)return-2;1===b&&(a.adler=Rc(a.adler,c,n,0));d.wrap=0;n>=d.w_size&&(0===b&&(yc(d.head),d.strstart=0,d.block_start=0,d.insert=0),k=new Fa.Buf8(d.w_size),Fa.arraySet(k,c,n-d.w_size,d.w_size,0),c=k,n=d.w_size);k=a.avail_in;var g=a.next_in;var e=a.input;a.avail_in=n;a.next_in=0;a.input=c;for(Ic(d);3<=d.lookahead;){c=d.strstart;n=d.lookahead-2;do d.ins_h=(d.ins_h<<d.hash_shift^d.window[c+3-1])&d.hash_mask,d.prev[c&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=c,c++;while(--n);
d.strstart=c;d.lookahead=2;Ic(d)}return d.strstart+=d.lookahead,d.block_start=d.strstart,d.insert=d.lookahead,d.lookahead=0,d.match_length=d.prev_length=2,d.match_available=0,a.next_in=g,a.input=e,a.avail_in=k,d.wrap=b,0};var Oe=!0,Ne=!0;try{String.fromCharCode.apply(null,[0])}catch(a){Oe=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(a){Ne=!1}for(var nd=new Fa.Buf8(256),Bc=0;256>Bc;Bc++)nd[Bc]=252<=Bc?6:248<=Bc?5:240<=Bc?4:224<=Bc?3:192<=Bc?2:1;"use strict";nd[254]=nd[254]=1;var be=
function(a){var c,d,b,k=a.length,n=0;for(b=0;b<k;b++)55296==(64512&(c=a.charCodeAt(b)))&&b+1<k&&56320==(64512&(d=a.charCodeAt(b+1)))&&(c=65536+(c-55296<<10)+(d-56320),b++),n+=128>c?1:2048>c?2:65536>c?3:4;var g=0;var e=new Fa.Buf8(n);for(b=0;g<n;b++)55296==(64512&(c=a.charCodeAt(b)))&&b+1<k&&56320==(64512&(d=a.charCodeAt(b+1)))&&(c=65536+(c-55296<<10)+(d-56320),b++),128>c?e[g++]=c:(2048>c?e[g++]=192|c>>>6:(65536>c?e[g++]=224|c>>>12:(e[g++]=240|c>>>18,e[g++]=128|c>>>12&63),e[g++]=128|c>>>6&63),e[g++]=
128|63&c);return e};var Eg=function(a){for(var c=new Fa.Buf8(a.length),d=0,b=c.length;d<b;d++)c[d]=a.charCodeAt(d);return c};var Fg=function(a,c){var d,b,k,n=c||a.length,g=Array(2*n);for(c=d=0;c<n;)if(128>(b=a[c++]))g[d++]=b;else if(4<(k=nd[b]))g[d++]=65533,c+=k-1;else{for(b&=2===k?31:3===k?15:7;1<k&&c<n;)b=b<<6|63&a[c++],k--;1<k?g[d++]=65533:65536>b?g[d++]=b:(b-=65536,g[d++]=55296|b>>10&1023,g[d++]=56320|1023&b)}return Me(g,d)};var Gg=function(a,c){var d;(c=c||a.length)>a.length&&(c=a.length);for(d=
c-1;0<=d&&128==(192&a[d]);)d--;return 0>d||0===d?c:d+nd[a[d]]>c?d:c};var ae={};ae=function(){this.input=null;this.total_in=this.avail_in=this.next_in=0;this.output=null;this.total_out=this.avail_out=this.next_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0};var Pe=Object.prototype.toString;"use strict";"use strict";Jc.prototype.push=function(a,c){var d,b,k=this.strm,n=this.options.chunkSize;if(this.ended)return!1;c=c===~~c?c:4*(!0===c);"string"==typeof a?k.input=be(a):"[object ArrayBuffer]"===
Pe.call(a)?k.input=new Uint8Array(a):k.input=a;k.next_in=0;k.avail_in=k.input.length;do{if(0===k.avail_out&&(k.output=new Fa.Buf8(n),k.next_out=0,k.avail_out=n),1!==(b=Cg(k,c))&&0!==b)return this.onEnd(b),this.ended=!0,!1;(0===k.avail_out||0===k.avail_in&&(4===c||2===c))&&("string"===this.options.to?this.onData(Me(d=Fa.shrinkBuf(k.output,k.next_out),d.length)):this.onData(Fa.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||0===k.avail_out)&&1!==b);return 4===c?(b=Dg(this.strm),this.onEnd(b),
this.ended=!0,0===b):(2===c&&(this.onEnd(0),k.avail_out=0),!0)};Jc.prototype.onData=function(a){this.chunks.push(a)};Jc.prototype.onEnd=function(a){0===a&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Fa.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};var mf=Jc;var nf=ce;var of=function(a,c){return(c=c||{}).raw=!0,ce(a,c)};var pf=function(a,c){return(c=c||{}).gzip=!0,ce(a,c)};"use strict";var od={};uc(od,"Inflate",function(){return sf},function(a){return sf=
a});uc(od,"inflate",function(){return tf},function(a){return tf=a});uc(od,"inflateRaw",function(){return uf},function(a){return uf=a});uc(od,"ungzip",function(){return vf},function(a){return vf=a});"use strict";var wf={};wf=function(a,c){var d,b,k,n;var g=a.state;var e=a.next_in;var h=a.input;var l=e+(a.avail_in-5);var f=a.next_out;var m=a.output;c=f-(c-a.avail_out);var q=f+(a.avail_out-257);var r=g.dmax;var t=g.wsize;var u=g.whave;var w=g.wnext;var C=g.window;var D=g.hold;var A=g.bits;var F=g.lencode;
var J=g.distcode;var N=(1<<g.lenbits)-1;var L=(1<<g.distbits)-1;a:do for(15>A&&(D+=h[e++]<<A,A+=8,D+=h[e++]<<A,A+=8),d=F[D&N];;){if(D>>>=b=d>>>24,A-=b,0==(b=d>>>16&255))m[f++]=65535&d;else if(16&b){var M=65535&d;(b&=15)&&(A<b&&(D+=h[e++]<<A,A+=8),M+=D&(1<<b)-1,D>>>=b,A-=b);15>A&&(D+=h[e++]<<A,A+=8,D+=h[e++]<<A,A+=8);for(d=J[D&L];;){if(D>>>=b=d>>>24,A-=b,16&(b=d>>>16&255)){if(k=65535&d,A<(b&=15)&&(D+=h[e++]<<A,(A+=8)<b&&(D+=h[e++]<<A,A+=8)),(k+=D&(1<<b)-1)>r){a.msg="invalid distance too far back";
g.mode=30;break a}if(D>>>=b,A-=b,k>(b=f-c)){if((b=k-b)>u&&g.sane){a.msg="invalid distance too far back";g.mode=30;break a}if(d=0,n=C,0===w){if(d+=t-b,b<M){M-=b;do m[f++]=C[d++];while(--b);d=f-k;n=m}}else if(w<b){if(d+=t+w-b,(b-=w)<M){M-=b;do m[f++]=C[d++];while(--b);if(d=0,w<M){M-=b=w;do m[f++]=C[d++];while(--b);d=f-k;n=m}}}else if(d+=w-b,b<M){M-=b;do m[f++]=C[d++];while(--b);d=f-k;n=m}for(;2<M;)m[f++]=n[d++],m[f++]=n[d++],m[f++]=n[d++],M-=3;M&&(m[f++]=n[d++],1<M&&(m[f++]=n[d++]))}else{d=f-k;do m[f++]=
m[d++],m[f++]=m[d++],m[f++]=m[d++],M-=3;while(2<M);M&&(m[f++]=m[d++],1<M&&(m[f++]=m[d++]))}}else if(0==(64&b)){d=J[(65535&d)+(D&(1<<b)-1)];continue}else{a.msg="invalid distance code";g.mode=30;break a}break}}else if(0==(64&b)){d=F[(65535&d)+(D&(1<<b)-1)];continue}else{32&b?g.mode=12:(a.msg="invalid literal/length code",g.mode=30);break a}break}while(e<l&&f<q);e-=M=A>>3;A-=M<<3;a.next_in=e;a.next_out=f;a.avail_in=e<l?5+(l-e):5-(e-l);a.avail_out=f<q?257+(q-f):257-(f-q);g.hold=D&(1<<A)-1;g.bits=A};var Wc=
{},Hg=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Ig=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Jg=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Kg=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];Wc=function(a,c,d,b,k,n,g,e){var h,l,f,m,q,r,t=e.bits,u,w,C,D,A,F=0,J,N=null,L=0,M=
new Fa.Buf16(16);var X=new Fa.Buf16(16);var fa=null,pa=0;for(u=0;15>=u;u++)M[u]=0;for(w=0;w<b;w++)M[c[d+w]]++;var H=15;for(C=t;1<=H&&0===M[H];H--);if(C>H&&(C=H),0===H)return k[n++]=20971520,k[n++]=20971520,e.bits=1,0;for(t=1;t<H&&0===M[t];t++);C<t&&(C=t);for(u=h=1;15>=u;u++)if(h<<=1,0>(h-=M[u]))return-1;if(0<h&&(0===a||1!==H))return-1;u=1;for(X[1]=0;15>u;u++)X[u+1]=X[u]+M[u];for(w=0;w<b;w++)0!==c[d+w]&&(g[X[c[d+w]]++]=w);if(0===a?(N=fa=g,m=19):1===a?(N=Hg,L-=257,fa=Ig,pa-=257,m=256):(N=Jg,fa=Kg,m=
-1),J=0,w=0,u=t,X=n,D=C,A=0,f=-1,b=(F=1<<C)-1,1===a&&852<F||2===a&&592<F)return 1;for(;;){var ja=u-A;g[w]<m?(q=0,r=g[w]):g[w]>m?(q=fa[pa+g[w]],r=N[L+g[w]]):(q=96,r=0);h=1<<u-A;t=l=1<<D;do k[X+(J>>A)+(l-=h)]=ja<<24|q<<16|r;while(0!==l);for(h=1<<u-1;J&h;)h>>=1;if(0!==h?(J&=h-1,J+=h):J=0,w++,0==--M[u]){if(u===H)break;u=c[d+g[w]]}if(u>C&&(J&b)!==f){0===A&&(A=C);X+=t;for(h=1<<(D=u-A);D+A<H&&!(0>=(h-=M[D+A]));)D++,h<<=1;if(F+=1<<D,1===a&&852<F||2===a&&592<F)return 1;k[f=J&b]=C<<24|D<<16|X-n}}return 0!==
J&&(k[X+J]=u-A<<24|4194304),e.bits=C,0};var xf=!0;"use strict";var Lg=function(a,c){var d,b,k,n,g,e,h,l,f=0,m=new Fa.Buf8(4),q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return-2;12===(d=a.state).mode&&(d.mode=13);var r=a.next_out;var t=a.output;var u=a.avail_out;var w=a.next_in;var C=a.input;var D=a.avail_in;var A=d.hold;var F=d.bits;var J=D;var N=u;var L=0;a:for(;;)switch(d.mode){case 1:if(0===d.wrap){d.mode=13;break}for(;16>F;){if(0===
D)break a;D--;A+=C[w++]<<F;F+=8}if(2&d.wrap&&35615===A){d.check=0;m[0]=255&A;m[1]=A>>>8&255;d.check=Hb(d.check,m,2,0);F=A=0;d.mode=2;break}if(d.flags=0,d.head&&(d.head.done=!1),!(1&d.wrap)||(((255&A)<<8)+(A>>8))%31){a.msg="incorrect header check";d.mode=30;break}if(8!=(15&A)){a.msg="unknown compression method";d.mode=30;break}if(A>>>=4,F-=4,h=(15&A)+8,0===d.wbits)d.wbits=h;else if(h>d.wbits){a.msg="invalid window size";d.mode=30;break}d.dmax=1<<h;a.adler=d.check=1;d.mode=512&A?10:12;F=A=0;break;case 2:for(;16>
F;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}if(d.flags=A,8!=(255&d.flags)){a.msg="unknown compression method";d.mode=30;break}if(57344&d.flags){a.msg="unknown header flags set";d.mode=30;break}d.head&&(d.head.text=A>>8&1);512&d.flags&&(m[0]=255&A,m[1]=A>>>8&255,d.check=Hb(d.check,m,2,0));F=A=0;d.mode=3;case 3:for(;32>F;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}d.head&&(d.head.time=A);512&d.flags&&(m[0]=255&A,m[1]=A>>>8&255,m[2]=A>>>16&255,m[3]=A>>>24&255,d.check=Hb(d.check,m,4,0));F=A=0;d.mode=4;case 4:for(;16>
F;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}d.head&&(d.head.xflags=255&A,d.head.os=A>>8);512&d.flags&&(m[0]=255&A,m[1]=A>>>8&255,d.check=Hb(d.check,m,2,0));F=A=0;d.mode=5;case 5:if(1024&d.flags){for(;16>F;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}d.length=A;d.head&&(d.head.extra_len=A);512&d.flags&&(m[0]=255&A,m[1]=A>>>8&255,d.check=Hb(d.check,m,2,0));F=A=0}else d.head&&(d.head.extra=null);d.mode=6;case 6:if(1024&d.flags&&((b=d.length)>D&&(b=D),b&&(d.head&&(h=d.head.extra_len-d.length,d.head.extra||
(d.head.extra=Array(d.head.extra_len)),Fa.arraySet(d.head.extra,C,w,b,h)),512&d.flags&&(d.check=Hb(d.check,C,b,w)),D-=b,w+=b,d.length-=b),d.length))break a;d.length=0;d.mode=7;case 7:if(2048&d.flags){if(0===D)break a;b=0;do h=C[w+b++],d.head&&h&&65536>d.length&&(d.head.name+=String.fromCharCode(h));while(h&&b<D);if(512&d.flags&&(d.check=Hb(d.check,C,b,w)),D-=b,w+=b,h)break a}else d.head&&(d.head.name=null);d.length=0;d.mode=8;case 8:if(4096&d.flags){if(0===D)break a;b=0;do h=C[w+b++],d.head&&h&&65536>
d.length&&(d.head.comment+=String.fromCharCode(h));while(h&&b<D);if(512&d.flags&&(d.check=Hb(d.check,C,b,w)),D-=b,w+=b,h)break a}else d.head&&(d.head.comment=null);d.mode=9;case 9:if(512&d.flags){for(;16>F;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}if(A!==(65535&d.check)){a.msg="header crc mismatch";d.mode=30;break}F=A=0}d.head&&(d.head.hcrc=d.flags>>9&1,d.head.done=!0);a.adler=d.check=0;d.mode=12;break;case 10:for(;32>F;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}a.adler=d.check=Qe(A);F=A=0;d.mode=11;
case 11:if(0===d.havedict)return a.next_out=r,a.avail_out=u,a.next_in=w,a.avail_in=D,d.hold=A,d.bits=F,2;a.adler=d.check=1;d.mode=12;case 12:if(5===c||6===c)break a;case 13:if(d.last){A>>>=7&F;F-=7&F;d.mode=27;break}for(;3>F;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}switch(d.last=1&A,--F,3&(A>>>=1)){case 0:d.mode=14;break;case 1:var M=d;if(xf){me=new Fa.Buf32(512);ne=new Fa.Buf32(32);for(n=0;144>n;)M.lens[n++]=8;for(;256>n;)M.lens[n++]=9;for(;280>n;)M.lens[n++]=7;for(;288>n;)M.lens[n++]=8;Wc(1,M.lens,
0,288,me,0,M.work,{bits:9});for(n=0;32>n;)M.lens[n++]=5;Wc(2,M.lens,0,32,ne,0,M.work,{bits:5});xf=!1}M.lencode=me;M.lenbits=9;M.distcode=ne;M.distbits=5;if(!0,d.mode=20,6===c){A>>>=2;F-=2;break a}break;case 2:d.mode=17;break;case 3:a.msg="invalid block type",d.mode=30}A>>>=2;F-=2;break;case 14:A>>>=7&F;for(F-=7&F;32>F;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}if((65535&A)!=(A>>>16^65535)){a.msg="invalid stored block lengths";d.mode=30;break}if(d.length=65535&A,A=0,F=0,d.mode=15,6===c)break a;case 15:d.mode=
16;case 16:if(b=d.length){if(b>D&&(b=D),b>u&&(b=u),0===b)break a;Fa.arraySet(t,C,w,b,r);D-=b;w+=b;u-=b;r+=b;d.length-=b;break}d.mode=12;break;case 17:for(;14>F;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}if(d.nlen=(31&A)+257,F-=5,d.ndist=(31&(A>>>=5))+1,F-=5,d.ncode=(15&(A>>>=5))+4,A>>>=4,F-=4,286<d.nlen||30<d.ndist){a.msg="too many length or distance symbols";d.mode=30;break}d.have=0;d.mode=18;case 18:for(;d.have<d.ncode;){for(;3>F;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}d.lens[q[d.have++]]=7&A;A>>>=
3;F-=3}for(;19>d.have;)d.lens[q[d.have++]]=0;if(d.lencode=d.lendyn,d.lenbits=7,l={bits:d.lenbits},L=Wc(0,d.lens,0,19,d.lencode,0,d.work,l),d.lenbits=l.bits,L){a.msg="invalid code lengths set";d.mode=30;break}d.have=0;d.mode=19;case 19:for(;d.have<d.nlen+d.ndist;){for(;g=(f=d.lencode[A&(1<<d.lenbits)-1])>>>24,M=65535&f,!(g<=F);){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}if(16>M)A>>>=g,F-=g,d.lens[d.have++]=M;else{if(16===M){for(n=g+2;F<n;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}if(A>>>=g,F-=g,0===d.have){a.msg=
"invalid bit length repeat";d.mode=30;break}h=d.lens[d.have-1];b=3+(3&A);A>>>=2;F-=2}else if(17===M){for(n=g+3;F<n;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}A>>>=g;F-=g;h=0;b=3+(7&A);A>>>=3;F-=3}else{for(n=g+7;F<n;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}A>>>=g;F-=g;h=0;b=11+(127&A);A>>>=7;F-=7}if(d.have+b>d.nlen+d.ndist){a.msg="invalid bit length repeat";d.mode=30;break}for(;b--;)d.lens[d.have++]=h}}if(30===d.mode)break;if(0===d.lens[256]){a.msg="invalid code -- missing end-of-block";d.mode=30;break}if(d.lenbits=
9,l={bits:d.lenbits},L=Wc(1,d.lens,0,d.nlen,d.lencode,0,d.work,l),d.lenbits=l.bits,L){a.msg="invalid literal/lengths set";d.mode=30;break}if(d.distbits=6,d.distcode=d.distdyn,l={bits:d.distbits},L=Wc(2,d.lens,d.nlen,d.ndist,d.distcode,0,d.work,l),d.distbits=l.bits,L){a.msg="invalid distances set";d.mode=30;break}if(d.mode=20,6===c)break a;case 20:d.mode=21;case 21:if(6<=D&&258<=u){a.next_out=r;a.avail_out=u;a.next_in=w;a.avail_in=D;d.hold=A;d.bits=F;wf(a,N);r=a.next_out;t=a.output;u=a.avail_out;w=
a.next_in;C=a.input;D=a.avail_in;A=d.hold;F=d.bits;12===d.mode&&(d.back=-1);break}for(d.back=0;g=(f=d.lencode[A&(1<<d.lenbits)-1])>>>24,n=f>>>16&255,M=65535&f,!(g<=F);){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}if(n&&0==(240&n)){var X=g;var fa=n;for(e=M;g=(f=d.lencode[e+((A&(1<<X+fa)-1)>>X)])>>>24,n=f>>>16&255,M=65535&f,!(X+g<=F);){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}A>>>=X;F-=X;d.back+=X}if(A>>>=g,F-=g,d.back+=g,d.length=M,0===n){d.mode=26;break}if(32&n){d.back=-1;d.mode=12;break}if(64&n){a.msg=
"invalid literal/length code";d.mode=30;break}d.extra=15&n;d.mode=22;case 22:if(d.extra){for(n=d.extra;F<n;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}d.length+=A&(1<<d.extra)-1;A>>>=d.extra;F-=d.extra;d.back+=d.extra}d.was=d.length;d.mode=23;case 23:for(;g=(f=d.distcode[A&(1<<d.distbits)-1])>>>24,n=f>>>16&255,M=65535&f,!(g<=F);){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}if(0==(240&n)){X=g;fa=n;for(e=M;g=(f=d.distcode[e+((A&(1<<X+fa)-1)>>X)])>>>24,n=f>>>16&255,M=65535&f,!(X+g<=F);){if(0===D)break a;D--;
A+=C[w++]<<F;F+=8}A>>>=X;F-=X;d.back+=X}if(A>>>=g,F-=g,d.back+=g,64&n){a.msg="invalid distance code";d.mode=30;break}d.offset=M;d.extra=15&n;d.mode=24;case 24:if(d.extra){for(n=d.extra;F<n;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}d.offset+=A&(1<<d.extra)-1;A>>>=d.extra;F-=d.extra;d.back+=d.extra}if(d.offset>d.dmax){a.msg="invalid distance too far back";d.mode=30;break}d.mode=25;case 25:if(0===u)break a;if(b=N-u,d.offset>b){if((b=d.offset-b)>d.whave&&d.sane){a.msg="invalid distance too far back";d.mode=
30;break}b>d.wnext?(b-=d.wnext,k=d.wsize-b):k=d.wnext-b;b>d.length&&(b=d.length);n=d.window}else n=t,k=r-d.offset,b=d.length;b>u&&(b=u);u-=b;d.length-=b;do t[r++]=n[k++];while(--b);0===d.length&&(d.mode=21);break;case 26:if(0===u)break a;t[r++]=d.length;u--;d.mode=21;break;case 27:if(d.wrap){for(;32>F;){if(0===D)break a;D--;A|=C[w++]<<F;F+=8}if(N-=u,a.total_out+=N,d.total+=N,N&&(a.adler=d.check=d.flags?Hb(d.check,t,N,r-N):Rc(d.check,t,N,r-N)),N=u,(d.flags?A:Qe(A))!==d.check){a.msg="incorrect data check";
d.mode=30;break}F=A=0}d.mode=28;case 28:if(d.wrap&&d.flags){for(;32>F;){if(0===D)break a;D--;A+=C[w++]<<F;F+=8}if(A!==(0|d.total)){a.msg="incorrect length check";d.mode=30;break}F=A=0}d.mode=29;case 29:L=1;break a;case 30:L=-3;break a;case 31:return-4;default:return-2}return(a.next_out=r,a.avail_out=u,a.next_in=w,a.avail_in=D,d.hold=A,d.bits=F,(d.wsize||N!==a.avail_out&&30>d.mode&&(27>d.mode||4!==c))&&Re(a,a.output,a.next_out,N-a.avail_out))?(d.mode=31,-4):(J-=a.avail_in,N-=a.avail_out,a.total_in+=
J,a.total_out+=N,d.total+=N,d.wrap&&N&&(a.adler=d.check=d.flags?Hb(d.check,t,N,a.next_out-N):Rc(d.check,t,N,a.next_out-N)),a.data_type=d.bits+64*!!d.last+128*(12===d.mode)+256*(20===d.mode||15===d.mode),(0===J&&0===N||4===c)&&0===L&&(L=-5),L)};var Mg=function(a){if(!a||!a.state)return-2;var c=a.state;return c.window&&(c.window=null),a.state=null,0};var ag=function(a,c){var d;return a&&a.state&&0!=(2&(d=a.state).wrap)?(d.head=c,c.done=!1,0):-2};var Ue=function(a,c){var d,b=c.length;return a&&a.state&&
(0===(d=a.state).wrap||11===d.mode)?11===d.mode&&Rc(1,c,b,0)!==d.check?-3:Re(a,c,b,b)?(d.mode=31,-4):(d.havedict=1,0):-2};"use strict";var Ab={};Ab={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,
Z_UNKNOWN:2,Z_DEFLATED:8};var Se={};Se=function(){this.os=this.xflags=this.time=this.text=0;this.extra=null;this.extra_len=0;this.comment=this.name="";this.hcrc=0;this.done=!1};var Te=Object.prototype.toString;Kc.prototype.push=function(a,c){var d,b,k,n,g=this.strm,e=this.options.chunkSize,h=this.options.dictionary,l=!1;if(this.ended)return!1;c=c===~~c?c:!0===c?Ab.Z_FINISH:Ab.Z_NO_FLUSH;"string"==typeof a?g.input=Eg(a):"[object ArrayBuffer]"===Te.call(a)?g.input=new Uint8Array(a):g.input=a;g.next_in=
0;g.avail_in=g.input.length;do{if(0===g.avail_out&&(g.output=new Fa.Buf8(e),g.next_out=0,g.avail_out=e),(d=Lg(g,Ab.Z_NO_FLUSH))===Ab.Z_NEED_DICT&&h&&(d=Ue(this.strm,h)),d===Ab.Z_BUF_ERROR&&!0===l&&(d=Ab.Z_OK,l=!1),d!==Ab.Z_STREAM_END&&d!==Ab.Z_OK)return this.onEnd(d),this.ended=!0,!1;g.next_out&&(0===g.avail_out||d===Ab.Z_STREAM_END||0===g.avail_in&&(c===Ab.Z_FINISH||c===Ab.Z_SYNC_FLUSH))&&("string"===this.options.to?(b=Gg(g.output,g.next_out),k=g.next_out-b,n=Fg(g.output,b),g.next_out=k,g.avail_out=
e-k,k&&Fa.arraySet(g.output,g.output,b,k,0),this.onData(n)):this.onData(Fa.shrinkBuf(g.output,g.next_out)));0===g.avail_in&&0===g.avail_out&&(l=!0)}while((0<g.avail_in||0===g.avail_out)&&d!==Ab.Z_STREAM_END);return(d===Ab.Z_STREAM_END&&(c=Ab.Z_FINISH),c===Ab.Z_FINISH)?(d=Mg(this.strm),this.onEnd(d),this.ended=!0,d===Ab.Z_OK):(c===Ab.Z_SYNC_FLUSH&&(this.onEnd(Ab.Z_OK),g.avail_out=0),!0)};Kc.prototype.onData=function(a){this.chunks.push(a)};Kc.prototype.onEnd=function(a){a===Ab.Z_OK&&("string"===this.options.to?
this.result=this.chunks.join(""):this.result=Fa.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};var sf=Kc;var tf=de;var uf=function(a,c){return(c=c||{}).raw=!0,de(a,c)};var vf=de;var yf={};yg(yf,ld,od,Ab);ge=yf;ee.FIXED_HEADER_LENGTH=16;ud.HEADER_LENGTH=8;class zf{readFixedHeader(a){this.payloadOffset=a.readU32BE();this.blendMode=a.readU32BE();this.alpha=a.readU32BE();let c=a.readU32BE();this.visible=0!=(1&c);this.clip=0!=(2&c);this.hasMask=0!=(4&c);this.maskLinked=0!=
(8&c);this.maskVisible=0!=(16&c);this.expanded=0!=(32&c);this.lockAlpha=0!=(64&c);this.blendMode===G.LM_MULTIPLY&&0!=(128&c)&&(this.blendMode=G.LM_MULTIPLY2);this.nameLength=a.readU32BE()}getFixedHeaderLen(){return 20}getVariableHeaderLen(){return this.nameLength}readVariableSizeHeader(a){this.name=a.readString(this.nameLength)}decode(a){for(var c;;){if(0<this.skipBytes){if(this.skipBytes>=a.length)return this.skipBytes-=a.length,null;a=a.subarray(this.skipBytes);this.skipBytes=0}switch(this.state){case 0:if(a.length<
this.getFixedHeaderLen())break;c=new ab(a);this.readFixedHeader(c);a=a.subarray(c.pos);this.state=1;continue;case 1:if(a.length<this.getVariableHeaderLen())break;c=new ab(a);this.readVariableSizeHeader(c);this.layer=this.createLayer();this.hasMask&&(this.layer.setMask(new Ea(this.width,this.height,8)),this.maskDecoder=new Ng(this.layer.mask));this.layer instanceof sa&&(this.colorDecoder=new Og(this.layer.image));this.skipBytes=this.payloadOffset-this.getFixedHeaderLen();this.colorDecoder?this.state=
3:this.maskDecoder?this.state=4:this.state=5;continue;case 3:if(a=this.colorDecoder.decode(a),this.colorDecoder.done){this.maskDecoder?this.state=4:this.state=5;continue}break;case 4:if(a=this.maskDecoder.decode(a),this.maskDecoder.done){this.state=5;continue}break;case 5:c=this.payloadOffset;this.colorDecoder&&(c+=this.colorDecoder.bytesTotal);this.maskDecoder&&(c+=this.maskDecoder.bytesTotal);this.state=6;this.skipBytes=this.chunkHeader.chunkSize-c;continue;case 6:this.done=!0}break}return a}constructor(a,
c,d){this.chunkHeader=a;this.width=c;this.height=d;this.nameLength=this.skipBytes=this.payloadOffset=this.state=0;this.done=!1;this.maskDecoder=this.colorDecoder=null}}class bg extends zf{createLayer(){let a=new sa(this.width,this.height,this.name);return a.setBlendMode(this.blendMode),a.setAlpha(this.alpha),a.setVisible(this.visible),a.setClip(this.clip),a.setMaskLinked(this.maskLinked),a.setMaskVisible(this.maskVisible),a.setLockAlpha(this.lockAlpha),a}}class cg extends zf{readFixedHeader(a){super.readFixedHeader.call(this,
a);this.childLayers=a.readU32BE()}getFixedHeaderLen(){return super.getFixedHeaderLen.call(this)+4}createLayer(){let a=new Ua(this.name,this.blendMode);return a.setAlpha(this.alpha),a.setVisible(this.visible),a.setExpanded(this.expanded),a.setMaskLinked(this.maskLinked),a.setMaskVisible(this.maskVisible),a}constructor(a,c,d){super(a,c,d);this.childLayers=0}}class Og{decode(a){if(null==a)return null;var c=this.bytesRead%z.BYTES_PER_PIXEL,d=this.bytesRead-c;let b=0,k=[z.ALPHA_BYTE_OFFSET,z.RED_BYTE_OFFSET,
z.GREEN_BYTE_OFFSET,z.BLUE_BYTE_OFFSET];for(;c<z.BYTES_PER_PIXEL&&b<a.length;c++)this.output[d+k[c]]=a[b],b++;this.bytesRead+=b;var n=0|Math.min(a.length-b,this.bytesTotal-this.bytesRead);c=n/z.BYTES_PER_PIXEL|0;n%=z.BYTES_PER_PIXEL;for(d=0;d<c;d++)this.output[this.bytesRead+z.ALPHA_BYTE_OFFSET]=a[b],this.output[this.bytesRead+z.RED_BYTE_OFFSET]=a[b+1],this.output[this.bytesRead+z.GREEN_BYTE_OFFSET]=a[b+2],this.output[this.bytesRead+z.BLUE_BYTE_OFFSET]=a[b+3],this.bytesRead+=z.BYTES_PER_PIXEL,b+=
z.BYTES_PER_PIXEL;c=0;for(d=this.bytesRead;c<n;c++)this.output[d+k[c]]=a[b],b++;return(this.bytesRead+=n,this.bytesRead>=this.bytesTotal&&(this.done=!0),b<a.length)?a.subarray(b):null}constructor(a){this.bytesRead=0;this.bytesTotal=a.width*a.height*z.BYTES_PER_PIXEL;this.output=a.data;this.done=!1}}class Ng{decode(a){if(null==a)return null;let c=0|Math.min(a.length,this.bytesTotal-this.bytesRead),d=this.bytesRead,b;for(b=0;b<c;b++,d++)this.output[d]=a[b];return(this.bytesRead=d,this.bytesRead>=this.bytesTotal&&
(this.done=!0),b<a.length)?a.subarray(b):null}constructor(a){this.bytesRead=0;this.bytesTotal=a.width*a.height;this.output=a.data;this.done=!1}}Tc.prototype.read=function(a){if(null==a)return null;var c=new ab(new Uint8Array(a)),d=[];if(1!=c.readU16BE())return null;a=c.readU16BE();for(var b=0;b<a;b++)if(0==c.readU16BE()){var k=255*c.readU16BE()/65535,n=255*c.readU16BE()/65535,g=255*c.readU16BE()/65535;c.readU16BE();d.push(k<<16|n<<8|g)}return d};Tc.prototype.write=function(a){var c=new ab(new Uint8Array(4+
10*a.length));c.writeU16BE(1);c.writeU16BE(a.length);for(var d=0;d<a.length;d++){var b=a[d];c.writeU16BE(0);c.writeU16BE(257*(b>>16&255));c.writeU16BE(257*(b>>8&255));c.writeU16BE(257*(255&b));c.writeU16BE(0)}return c.getAsDataArray()};vd.prototype=Object.create(wa(Db).prototype);vd.prototype.constructor=vd;var hd={};var Af=function(){function a(g,e,h){var l=new XMLHttpRequest;l.open("GET",g);l.responseType="blob";l.onload=function(){n(l.response,e,h)};l.onerror=function(){console.error("could not download file")};
l.send()}function c(g){var e=new XMLHttpRequest;e.open("HEAD",g,!1);try{e.send()}catch(h){}return 200<=e.status&&299>=e.status}function d(g){try{g.dispatchEvent(new MouseEvent("click"))}catch(h){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null);g.dispatchEvent(e)}}var b="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof Ld&&Ld.global===Ld?Ld:void 0,k=b.navigator&&/Macintosh/.test(navigator.userAgent)&&
/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),n=b.saveAs||("object"!=typeof window||window!==b?function(){}:"download"in HTMLAnchorElement.prototype&&!k?function(g,e,h){var l=b.URL||b.webkitURL,f=document.createElement("a");f.download=e=e||g.name||"download";f.rel="noopener";"string"==typeof g?(f.href=g,f.origin===location.origin?d(f):c(f.href)?a(g,e,h):d(f,f.target="_blank")):(f.href=l.createObjectURL(g),setTimeout(function(){l.revokeObjectURL(f.href)},4E4),setTimeout(function(){d(f)},
0))}:"msSaveOrOpenBlob"in navigator?function(g,e,h){if(e=e||g.name||"download","string"!=typeof g){var l;navigator.msSaveOrOpenBlob((void 0===(l=h)?l={autoBom:!1}:"object"!=typeof l&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(g.type)?new Blob(["\ufeff",g],{type:g.type}):g),e)}else if(c(g))a(g,e,h);else{var f=document.createElement("a");f.href=g;f.target="_blank";setTimeout(function(){d(f)})}}:
function(g,e,h,l){if((l=l||open("","_blank"))&&(l.document.title=l.document.body.innerText="downloading..."),"string"==typeof g)return a(g,e,h);e="application/octet-stream"===g.type;h=/constructor/i.test(b.HTMLElement)||b.safari;var f=/CriOS\/[\d]+/.test(navigator.userAgent);if((f||e&&h||k)&&"undefined"!=typeof FileReader){var m=new FileReader;m.onloadend=function(){var t=m.result;t=f?t:t.replace(/^data:[^;]*;/,"data:attachment/file;");l?l.location.href=t:location=t;l=null};m.readAsDataURL(g)}else{var q=
b.URL||b.webkitURL,r=q.createObjectURL(g);l?l.location=r:location.href=r;l=null;setTimeout(function(){q.revokeObjectURL(r)},4E4)}});hd=b.saveAs=n.saveAs=n};"function"==typeof define&&define.amd?define([],Af):Af();var xd={};xd=JSON.parse('{"Dodge (tool)":"Dodge","Burn (tool)":"Burn","Color (picker)":"Color","Color swatches (shorter)":"Swatches"}');let ie={ja:JSON.parse('{"File":"\u30d5\u30a1\u30a4\u30eb","Save to my computer":"PC\u306b\u4fdd\u5b58","Post Oekaki":"\u753b\u50cf\u3092\u6295\u7a3f","Edit":"\u7de8\u96c6","Undo":"\u53d6\u308a\u6d88\u3057","Redo":"\u3084\u308a\u76f4\u3057","Cut":"\u5207\u308a\u53d6\u308a","Copy":"\u30b3\u30d4\u30fc","Clear history":"\u5c65\u6b74\u6d88\u53bb","Copy merged":"\u7d50\u5408\u30b3\u30d4\u30fc","Paste":"\u8cbc\u308a\u4ed8\u3051","Select all":"\u3059\u3079\u3066\u9078\u629e","Deselect":"\u9078\u629e\u89e3\u9664","Transform":"\u5909\u5f62","Selection":"\u9078\u629e\u7bc4\u56f2","Constrain":"\u7e26\u6a2a\u6bd4\u3092\u7dad\u6301","Layers":"\u30ec\u30a4\u30e4\u30fc","Duplicate":"\u8907\u88fd","Merge down":"\u4e0b\u306e\u30ec\u30a4\u30e4\u30fc\u3068\u7d50\u5408","Merge group":"\u30b0\u30eb\u30fc\u30d7\u7d50\u5408","Merge all layers":"\u5168\u30ec\u30a4\u30e4\u30fc\u7d50\u5408","Add Merged Layer":"\u7d50\u5408\u30ec\u30a4\u30e4\u30fc\u3092\u8ffd\u52a0","Add layer mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u8ffd\u52a0","Delete mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u524a\u9664","Delete layer mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u524a\u9664","Apply mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u9069\u7528","Apply layer mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u9069\u7528","Disable mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u7121\u52b9\u5316","Enable mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u6709\u52b9\u5316","Clip to the layer below":"\u4e0b\u306e\u30ec\u30a4\u30e4\u30fc\u3067\u30af\u30ea\u30c3\u30d4\u30f3\u30b0","Unclip from the layer below":"\u30af\u30ea\u30c3\u30d4\u30f3\u30b0\u89e3\u9664","Effects":"\u52b9\u679c","Clear":"\u6d88\u53bb","Fill":"\u5857\u308a\u6f70\u3057","Flip horizontal":"\u5de6\u53f3\u53cd\u8ee2","Flip vertical":"\u4e0a\u4e0b\u53cd\u8ee2","Invert":"\u30cd\u30ac\u30dd\u30b8\u53cd\u8ee2","Convert brightness to opacity":"\u8f1d\u5ea6\u3092\u900f\u660e\u5ea6\u306b\u5909\u63db","Box blur...":"\u307c\u304b\u3057","Box blur":"\u307c\u304b\u3057","Blur amount (pixels)":"\u307c\u304b\u3057\u91cf(\u30d4\u30af\u30bb\u30eb\u5358\u4f4d)","Iterations (1-8, larger gives smoother blur)":"\u53cd\u5fa9(1-8,\u5927\u304d\u3044\u307b\u3069\u307c\u304b\u3057\u304c\u6ed1\u3089\u304b)","Monochromatic noise":"\u5358\u8272\u30ce\u30a4\u30ba","Color noise":"\u30ab\u30e9\u30fc\u30ce\u30a4\u30ba","View":"\u8868\u793a","Full-screen mode":"\u30d5\u30eb\u30b9\u30af\u30ea\u30fc\u30f3\u30e2\u30fc\u30c9","Zoom in":"\u62e1\u5927","Zoom out":"\u7e2e\u5c0f","Zoom 100%":"100%","Smooth-out zoomed canvas":"\u30ba\u30fc\u30e0\u3092\u306a\u3081\u3089\u304b\u306b\u8868\u793a\u3059\u308b","Show grid":"\u30b0\u30ea\u30c3\u30c9\u3092\u8868\u793a","Grid options...":"\u30b0\u30ea\u30c3\u30c9\u306e\u8a2d\u5b9a","Palettes":"\u30d1\u30ec\u30c3\u30c8","Rearrange":"\u521d\u671f\u5316","Toggle palettes":"\u8868\u793a\u975e\u8868\u793a\u5207\u308a\u66ff\u3048","Use old icons":"\u53e4\u3044\u30a2\u30a4\u30b3\u30f3","Show tool options":"\u30c4\u30fc\u30eb\u30aa\u30d7\u30b7\u30e7\u30f3","Show color":"\u30ab\u30e9\u30fc","Show layers":"\u30ec\u30a4\u30e4\u30fc","Show misc":"\u64cd\u4f5c","Show stroke":"\u30b9\u30c8\u30ed\u30fc\u30af","Show swatches":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8","Show textures":"\u30c6\u30af\u30b9\u30c1\u30e3","Show tools":"\u30c4\u30fc\u30eb","Help":"\u30d8\u30eb\u30d7","Tablet support":"\u30bf\u30d6\u30ec\u30c3\u30c8\u30b5\u30dd\u30fc\u30c8","Shortcuts":"\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8","About":"ChickenPaint Be\u306b\u3064\u3044\u3066","Removes all undo/redo information to regain memory":"\u5c65\u6b74\u3092\u30af\u30ea\u30a2\u3057\u3066\u30e1\u30e2\u30ea\u3092\u958b\u653e\u3057\u307e\u3059","Clears the selected area":"\u6d88\u53bb","Invert the image colors":"\u30cd\u30ac\u30dd\u30b8\u53cd\u8ee2","Blur effect":"\u307c\u304b\u3057\u30d5\u30a3\u30eb\u30bf","Fills the selection with noise":"\u5358\u8272\u30ce\u30a4\u30ba\u3067\u5857\u308a\u6f70\u3057","Fills the selection with colored noise":"\u30ab\u30e9\u30fc\u30ce\u30a4\u30ba\u3067\u5857\u308a\u6f70\u3057","Linear interpolation is used to give a smoothed looked to the picture when zoomed in":"\u753b\u50cf\u306e\u62e1\u5927\u6642\u306b\u88dc\u5b8c\u3057\u3066\u6ed1\u3089\u304b\u306b\u8868\u793a\u3057\u307e\u3059","Rearrange the palette windows":"\u30d1\u30ec\u30c3\u30c8\u3092\u518d\u914d\u7f6e","Hides or shows all palettes":"\u30d1\u30ec\u30c3\u30c8\u306e\u8868\u793a/\u975e\u8868\u793a","You\'re about to clear the current Undo/Redo history.\\nThis operation cannot be undone, are you sure you want to do that?":"\u30a2\u30f3\u30c9\u30a5\u30fb\u30ea\u30c9\u30a5\u306e\u5c65\u6b74\u3092\u6d88\u53bb\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u3002\\n\u3053\u306e\u64cd\u4f5c\u306f\u5143\u306b\u623b\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\u672c\u5f53\u306b\u5b9f\u884c\u3057\u307e\u3059\u304b?","Misc":"\u64cd\u4f5c","Round Pixelated":"\u5186\u30d4\u30af\u30bb\u30eb","Round Hard Edge":"\u5186\u30cf\u30fc\u30c9\u30a8\u30c3\u30b8","Round Soft":"\u5186\u30bd\u30d5\u30c8","Square Pixelated":"\u89d2\u30d4\u30af\u30bb\u30eb","Square Hard Edge":"\u89d2\u30cf\u30fc\u30c9\u30a8\u30c3\u30b8","Color (picker)":"\u30ab\u30e9\u30fc","Tool options":"\u30c4\u30fc\u30eb\u30aa\u30d7\u30b7\u30e7\u30f3","Brush size":"\u30d6\u30e9\u30b7\u30b5\u30a4\u30ba","Opacity":"\u4e0d\u900f\u660e\u5ea6","Color":"\u8272\u88dc\u5145","Blend":"\u6df7\u8272","Spacing":"\u9593\u9694","Scattering":"\u6563\u4e71","Smoothing":"\u624b\u3076\u308c\u88dc\u6b63","Rotation":"\u89d2\u5ea6","Color swatches":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8","Color swatches (shorter)":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8","Remove":"\u524a\u9664","Replace with current color":"\u9078\u629e\u4e2d\u306e\u8272\u306b\u7f6e\u304d\u63db\u3048","Save swatches to your computer...":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8\u3092PC\u306b\u4fdd\u5b58","Load swatches from your computer...":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8\u3092PC\u304b\u3089\u8aad\u307f\u8fbc\u307f","Add the current brush color as a new swatch":"\u9078\u629e\u4e2d\u306e\u8272\u3092\u8ffd\u52a0","Sample all layers":"\u5168\u30ec\u30a4\u30e4\u30fc\u6df7\u5408","Lock transparency":"\u900f\u660e\u90e8\u5206\u3092\u4fdd\u8b77","Textures":"\u30c6\u30af\u30b9\u30c1\u30e3","Customize":"\u30ab\u30b9\u30bf\u30de\u30a4\u30ba","Inverse":"\u30cd\u30ac\u30dd\u30b8\u53cd\u8ee2","Mirror":"\u5de6\u53f3\u53cd\u8ee2","Brightness":"\u8f1d\u5ea6","Contrast":"\u30b3\u30f3\u30c8\u30e9\u30b9\u30c8","Reset":"\u30ea\u30bb\u30c3\u30c8","Layer blending mode":"\u5408\u6210\u30e2\u30fc\u30c9","Normal":"\u901a\u5e38","Multiply":"\u4e57\u7b97","Add":"\u52a0\u7b97","Screen":"\u30b9\u30af\u30ea\u30fc\u30f3","Lighten":"\u6bd4\u8f03(\u660e)","Darken":"\u6bd4\u8f03(\u6697)","Subtract":"\u6e1b\u7b97","Dodge":"\u8986\u3044\u713c\u304d","Burn":"\u713c\u304d\u8fbc\u307f","Overlay":"\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4","Hard Light":"\u30cf\u30fc\u30c9\u30e9\u30a4\u30c8","Soft Light":"\u30bd\u30d5\u30c8\u30e9\u30a4\u30c8","Vivid Light":"\u30d3\u30d3\u30c3\u30c9\u30e9\u30a4\u30c8","Linear Light":"\u30ea\u30cb\u30a2\u30e9\u30a4\u30c8","Pin Light":"\u30d4\u30f3\u30e9\u30a4\u30c8","Passthrough":"\u901a\u904e","Stroke":"\u30b9\u30c8\u30ed\u30fc\u30af","Free-hand":"\u30d5\u30ea\u30fc\u30cf\u30f3\u30c9","Straight line":"\u76f4\u7dda","Bezier curve":"Bz\uff08\u30d9\u30b8\u30a7\uff09\u66f2\u7dda","Tools":"\u30c4\u30fc\u30eb","Marquee":"\u9078\u629e\u7bc4\u56f2","Move tool":"\u79fb\u52d5","Flood fill":"\u5857\u308a\u6f70\u3057","Gradient fill":"\u30b0\u30e9\u30c7\u30fc\u30b7\u30e7\u30f3","Color picker":"\u30b9\u30dd\u30a4\u30c8","Rotate canvas":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u56de\u8ee2","Grab canvas":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u4f4d\u7f6e","Pencil":"\u925b\u7b46","Pen":"\u30da\u30f3","Airbrush":"\u30a8\u30a2\u30d6\u30e9\u30b7","Waterpaint":"\u6c34\u5f69","Eraser":"\u6d88\u3057\u30b4\u30e0","Soft eraser":"\u8584\u6d88\u3057","Smudge":"\u6307\u5148","Blender":"\u6df7\u8272","Dodge (tool)":"\u8986\u3044\u713c\u304d","Burn (tool)":"\u713c\u304d\u8fbc\u307f","Blur":"\u307c\u304b\u3057","Grid options":"\u30b0\u30ea\u30c3\u30c9\u306e\u8a2d\u5b9a","Grid size":"\u30b0\u30ea\u30c3\u30c9\u30b5\u30a4\u30ba","Rename...":"\u540d\u524d\u3092\u5909\u66f4","Add layer":"\u65b0\u898f\u30ec\u30a4\u30e4\u30fc","Delete layer":"\u30ec\u30a4\u30e4\u30fc\u524a\u9664","Add group":"\u65b0\u898f\u30b0\u30eb\u30fc\u30d7","Delete group":"\u30b0\u30eb\u30fc\u30d7\u524a\u9664","Add mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u8ffd\u52a0","Gradient":"\u30b0\u30e9\u30c7\u30fc\u30b7\u30e7\u30f3\u4f5c\u6210","Zoom and Rotate":"\u30ba\u30fc\u30e0\u3068\u56de\u8ee2","Reset View":"\u8868\u793a\u3092\u30ea\u30bb\u30c3\u30c8","Transform style":"\u5909\u5f62\u30b9\u30bf\u30a4\u30eb","Apply transform":"\u5909\u5f62\u78ba\u5b9a","Complete transform":"\u5909\u5f62\u3092\u5b8c\u4e86","Undo transform":"\u53d6\u308a\u6d88\u3057","You need to finish transforming this layer before you can do that. What would you like to do with the transform?":"\u7d9a\u884c\u3059\u308b\u305f\u3081\u306b\u5909\u5f62\u3092\u5b8c\u4e86\u3057\u307e\u3059\u3002","Smooth":"\u30b9\u30e0\u30fc\u30ba","Sharp":"\u30b7\u30e3\u30fc\u30d7","Opacity: ":"\u4e0d\u900f\u660e\u5ea6:","Please enter a color in hex format":"16\u9032\u5f62\u5f0f\u3067\u8272\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\uff08#xxxxxx\u306e\u5f62\uff09","Cancel":"\u30ad\u30e3\u30f3\u30bb\u30eb","Ok":"OK","Okay":"OK","OK":"OK","Whoops! This layer is currently hidden":"\u975e\u8868\u793a\u30ec\u30a4\u30e4\u30fc\u3067\u3059\u3002","Whoops! This layer\'s opacity is currently 0%":"\u30ec\u30a4\u30e4\u30fc\u306e\u4e0d\u900f\u660e\u5ea6\u304c0%\u3067\u3059","Whoops! You can\'t draw on a group":"\u30b0\u30eb\u30fc\u30d7\u30d5\u30a9\u30eb\u30c0\u306b\u306f\u63cf\u3051\u307e\u305b\u3093","Whoops! All of the selected pixels are transparent!":"\u30ec\u30a4\u30e4\u30fc\u304c\u7a7a\u3067\u3059","Image":"\u753b\u50cf","Layer mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af","Sorry, you can\'t remove the last remaining layer in the drawing.":"\u6700\u5f8c\u306e1\u3064\u306a\u306e\u3067\u524a\u9664\u3067\u304d\u307e\u305b\u3093\u3002","Are you sure you want to send your drawing to the server and finish drawing now?":"\u753b\u50cf\u3092\u30b5\u30fc\u30d0\u30fc\u306b\u9001\u4fe1\u3057\u307e\u3059\u3002\u7d42\u4e86\u3057\u3066\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f","Your drawing has unsaved changes! Are you sure to want to navigate away?":"\u753b\u50cf\u306b\u672a\u4fdd\u5b58\u306e\u5909\u66f4\u304c\u3042\u308a\u307e\u3059\u3002\u7d42\u4e86\u3057\u3066\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f","Many of the menu options and painting tools have keyboard shortcuts which are written next to them or appear when you hover.":"\u5229\u7528\u53ef\u80fd\u306a\u30ad\u30fc\u30dc\u30fc\u30c9\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u306e\u3044\u304f\u3064\u304b\u306f\u30e1\u30cb\u30e5\u30fc\u306e\u6a2a\u3084\u30c4\u30fc\u30eb\u30c1\u30c3\u30d7\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002","Here are some other shortcuts which are not as obvious!":"\u3053\u306e\u4e00\u89a7\u306f\u305d\u308c\u4ee5\u5916\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u3092\u307e\u3068\u3081\u305f\u3082\u306e\u3067\u3059\u3002","Right":"\u53f3","Left":"\u5de6","Middle":"\u4e2d","or":"\u307e\u305f\u306f","Double click":"\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af","Color swatches palette":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8","Use as the drawing color":"\u30d1\u30ec\u30c3\u30c8\u306e\u8272\u3092\u53d6\u5f97","Remove or replace a color swatch":"\u30d1\u30ec\u30c3\u30c8\u306e\u5909\u66f4\uff65\u524a\u9664","Line drawing mode":"\u76f4\u7dda\u30e2\u30fc\u30c9","Snap line to nearest 45 degrees":"45\u00b0\u5358\u4f4d\u3067\u30b9\u30ca\u30c3\u30d7","Painting tools":"\u30c4\u30fc\u30eb","Change brush opacity":"\u30d6\u30e9\u30b7\u306e\u4e0d\u900f\u660e\u5ea6","Change brush size":"\u30d6\u30e9\u30b7\u30b5\u30a4\u30ba","Brush palette":"\u30d6\u30e9\u30b7\u30d1\u30ec\u30c3\u30c8","Adjust brush sliders more precisely":"\u30d6\u30e9\u30b7\u30b9\u30e9\u30a4\u30c0\u30fc\u3092\u3088\u308a\u7d30\u304b\u304f\u8abf\u6574","Drawing canvas":"\u30ad\u30e3\u30f3\u30d0\u30b9","Move the canvas around":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u79fb\u52d5","Rotate the canvas":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u56de\u8ee2","Zoom":"\u30ba\u30fc\u30e0","Zoom the canvas":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u62e1\u5927\u7e2e\u5c0f","Sample the color under the cursor":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u8272\u3092\u30b9\u30dd\u30a4\u30c8","Flip View horizontal":"\u8868\u793a\u306e\u5de6\u53f3\u53cd\u8ee2","Layers palette":"\u30ec\u30a4\u30e4\u30fc\u30d1\u30ec\u30c3\u30c8","Rename layer":"\u30ec\u30a4\u30e4\u30fc\u540d\u5909\u66f4","Toggle mask enable/disable":"\u30de\u30b9\u30af\u306e\u6709\u52b9/\u7121\u52b9\u5207\u308a\u66ff\u3048","Toggle mask View":"\u30de\u30b9\u30af\u306e\u8868\u793a/\u975e\u8868\u793a\u5207\u308a\u66ff\u3048","Save Oekaki":"\u4fdd\u5b58","Saving drawing...":"\u753b\u50cf\u3092\u4fdd\u5b58\u4e2d\u2026","Preparing your drawing to be saved, please wait...":"\u753b\u50cf\u3092\u4fdd\u5b58\u3059\u308b\u6e96\u5099\u3092\u3057\u3066\u3044\u307e\u3059\u3002\u3057\u3070\u3089\u304f\u304a\u5f85\u3061\u304f\u3060\u3055\u3044\u2026","Drawing saved!":"\u753b\u50cf\u3092\u4fdd\u5b58\u3057\u307e\u3057\u305f\uff01","Your drawing has been saved, would you like to post it to the forum now?":"\u753b\u50cf\u306e\u4fdd\u5b58\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\u30d5\u30a9\u30fc\u30e9\u30e0\u3078\u6295\u7a3f\u3057\u307e\u3059\u304b\uff1f","Yes, post it now":"\u306f\u3044\u3001\u6295\u7a3f\u3057\u307e\u3059","No, keep drawing":"\u307e\u3060\u63cf\u304d\u307e\u3059","No, quit and I\'ll finish it later":"\u30a2\u30d7\u30ea\u3092\u7d42\u4e86\u3057\u3066\u7d9a\u304d\u3092\u5f8c\u3067\u63cf\u304f","Your drawing has been saved, would you like to view it on the forum now?":"\u753b\u50cf\u306e\u4fdd\u5b58\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\u30d5\u30a9\u30fc\u30e9\u30e0\u3078\u6295\u7a3f\u3057\u307e\u3059\u304b\uff1f","Yes, view the post":"\u306f\u3044\u3001\u6295\u7a3f\u3057\u307e\u3059\u3002","Your drawing has been saved, redirecting you to view your new post now...":"\u753b\u50cf\u306e\u4fdd\u5b58\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\u6295\u7a3f\u5148\u306b\u79fb\u52d5\u3057\u307e\u3059\u3002","Sorry, your drawing could not be saved, Please see the error message.":"\u753b\u50cf\u3092\u4fdd\u5b58\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002","Sorry, your drawing could not be saved, please try again later.":"\u753b\u50cf\u3092\u4fdd\u5b58\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u6642\u9593\u3092\u7f6e\u3044\u3066\u518d\u5ea6\u6295\u7a3f\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002","The error returned from the server was":"\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u8fd4\u3063\u3066\u6765\u305f\u30a8\u30e9\u30fc","The file size exceeds the server limit.":"\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u30b5\u30fc\u30d0\u30fc\u306e\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002","The total size of FormData is within the acceptable range.":"FormData\u306e\u5408\u8a08\u30b5\u30a4\u30ba\u306f\u5236\u9650\u7bc4\u56f2\u5185\u3067\u3059\u3002","Limit size":"\u4e0a\u9650\u30b5\u30a4\u30ba","Current size":"\u73fe\u5728\u306e\u30b5\u30a4\u30ba","Network response was not OK":"\u901a\u4fe1\u30a8\u30e9\u30fc","HTTP status code":"HTTP\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9"}'),
en:xd},wd=xd,je="en";gd.prototype=Object.create(wa(Db).prototype);gd.prototype.constructor=gd;var Tb={};Tb=function(){function a(p,v){return v&&`${v}::${Fb++}`||p.uidEvent||Fb++}function c(p){let v=a(p);return p.uidEvent=v,Pb[v]=Pb[v]||{},Pb[v]}function d(p,v,B=null){return Object.values(p).find(I=>I.callable===v&&I.delegationSelector===B)}function b(p,v,B){let I="string"==typeof v,S=g(p);return kc.has(S)||(S=p),[I,I?B:v||B,S]}function k(p,v,B,I,S){var aa,ma;if("string"==typeof v&&p){var [qa,Ga,Ra]=
b(v,B,I);if(v in wc){let Ha;Ha=Ga;Ga=function(ra){if(!ra.relatedTarget||ra.relatedTarget!==ra.delegateTarget&&!ra.delegateTarget.contains(ra.relatedTarget))return Ha.call(this,ra)}}I=c(p);I=I[Ra]||(I[Ra]={});var ka=d(I,Ga,qa?B:null);if(ka)return void(ka.oneOff=ka.oneOff&&S);v=a(Ga,v.replace(jc,""));ka=qa?(aa=Ga,function Sa(ra){let Oa=p.querySelectorAll(B);for(let {target:La}=ra;La&&La!==this;La=La.parentNode)for(let Ma of Oa)if(Ma===La)return e(ra,{delegateTarget:La}),Sa.oneOff&&ha.off(p,ra.type,
B,aa),aa.apply(La,[ra])}):(ma=Ga,function Oa(Sa){return e(Sa,{delegateTarget:p}),Oa.oneOff&&ha.off(p,Sa.type,ma),ma.apply(p,[Sa])});ka.delegationSelector=qa?B:null;ka.callable=Ga;ka.oneOff=S;ka.uidEvent=v;I[v]=ka;p.addEventListener(Ra,ka,qa)}}function n(p,v,B,I,S){(I=d(v[B],I,S))&&(p.removeEventListener(B,I,!!S),delete v[B][I.uidEvent])}function g(p){return wc[p=p.replace(Zb,"")]||p}function e(p,v={}){for(let [B,I]of Object.entries(v))try{p[B]=I}catch(S){Object.defineProperty(p,B,{configurable:!0,
get:()=>I})}return p}function h(p){if("true"===p)return!0;if("false"===p)return!1;if(p===Number(p).toString())return Number(p);if(""===p||"null"===p)return null;if("string"!=typeof p)return p;try{return JSON.parse(decodeURIComponent(p))}catch(v){return p}}function l(p){return p.replace(/[A-Z]/g,v=>`-${v.toLowerCase()}`)}function f(p){return p?(p.nodeName||"").toLowerCase():null}function m(p){return null==p?window:"[object Window]"!==p.toString()?(p=p.ownerDocument)&&p.defaultView||window:p}function q(p){return p instanceof
m(p).Element||p instanceof Element}function r(p){return p instanceof m(p).HTMLElement||p instanceof HTMLElement}function t(p){return"undefined"!=typeof ShadowRoot&&(p instanceof m(p).ShadowRoot||p instanceof ShadowRoot)}function u(p){return p.split("-")[0]}function w(){var p=navigator.userAgentData;return null!=p&&p.brands&&Array.isArray(p.brands)?p.brands.map(function(v){return v.brand+"/"+v.version}).join(" "):navigator.userAgent}function C(){return!/^((?!chrome|android).)*safari/i.test(w())}function D(p,
v,B){void 0===v&&(v=!1);void 0===B&&(B=!1);var I=p.getBoundingClientRect(),S=1,aa=1;v&&r(p)&&(S=0<p.offsetWidth&&ua(I.width)/p.offsetWidth||1,aa=0<p.offsetHeight&&ua(I.height)/p.offsetHeight||1);p=(q(p)?m(p):window).visualViewport;v=!C()&&B;B=(I.left+(v&&p?p.offsetLeft:0))/S;p=(I.top+(v&&p?p.offsetTop:0))/aa;S=I.width/S;I=I.height/aa;return{width:S,height:I,top:p,right:B+S,bottom:p+I,left:B,x:B,y:p}}function A(p){var v=D(p),B=p.offsetWidth,I=p.offsetHeight;return 1>=Math.abs(v.width-B)&&(B=v.width),
1>=Math.abs(v.height-I)&&(I=v.height),{x:p.offsetLeft,y:p.offsetTop,width:B,height:I}}function F(p,v){var B=v.getRootNode&&v.getRootNode();if(p.contains(v))return!0;if(B&&t(B)){do{if(v&&p.isSameNode(v))return!0;v=v.parentNode||v.host}while(v)}return!1}function J(p){return m(p).getComputedStyle(p)}function N(p){return((q(p)?p.ownerDocument:p.document)||window.document).documentElement}function L(p){return"html"===f(p)?p:p.assignedSlot||p.parentNode||(t(p)?p.host:null)||N(p)}function M(p){return r(p)&&
"fixed"!==J(p).position?p.offsetParent:null}function X(p){for(var v=m(p),B=M(p);B&&0<=["table","td","th"].indexOf(f(B))&&"static"===J(B).position;)B=M(B);if(!B||"html"!==f(B)&&("body"!==f(B)||"static"!==J(B).position)){if(!B)a:{B=/firefox/i.test(w());if(!/Trident/i.test(w())||!r(p)||"fixed"!==J(p).position)for(p=L(p),t(p)&&(p=p.host);r(p)&&0>["html","body"].indexOf(f(p));){var I=J(p);if("none"!==I.transform||"none"!==I.perspective||"paint"===I.contain||-1!==["transform","perspective"].indexOf(I.willChange)||
B&&"filter"===I.willChange||B&&I.filter&&"none"!==I.filter){B=p;break a}p=p.parentNode}B=null}v=B||v}return v}function fa(p){return 0<=["top","bottom"].indexOf(p)?"x":"y"}function pa(p){return Object.assign({},{top:0,right:0,bottom:0,left:0},p)}function H(p,v){return v.reduce(function(B,I){return B[I]=p,B},{})}function ja(p){return p.split("-")[1]}function U(p){var v,B=p.popper,I=p.popperRect,S=p.placement,aa=p.variation,ma=p.offsets,qa=p.position,Ga=p.gpuAcceleration,Ra=p.adaptive,ka=p.roundOffsets,
Ha=p.isFixed;p=ma.x;p=void 0===p?0:p;var ra=ma.y;ra=void 0===ra?0:ra;ra="function"==typeof ka?ka({x:p,y:ra}):{x:p,y:ra};p=ra.x;ra=ra.y;var Sa=ma.hasOwnProperty("x");ma=ma.hasOwnProperty("y");var Oa="left",La="top",Ma=window;if(Ra){var Ta=X(B),vb="clientHeight",Xa="clientWidth";Ta===m(B)&&"static"!==J(Ta=N(B)).position&&"absolute"===qa&&(vb="scrollHeight",Xa="scrollWidth");("top"===S||("left"===S||"right"===S)&&"end"===aa)&&(La="bottom",ra-=(Ha&&Ta===Ma&&Ma.visualViewport?Ma.visualViewport.height:
Ta[vb])-I.height,ra*=Ga?1:-1);"left"!==S&&("top"!==S&&"bottom"!==S||"end"!==aa)||(Oa="right",p-=(Ha&&Ta===Ma&&Ma.visualViewport?Ma.visualViewport.width:Ta[Xa])-I.width,p*=Ga?1:-1)}var Ca,mb,nb,yb,ob,kb;I=Object.assign({position:qa},Ra&&za);ka=!0===ka?(Ca={x:p,y:ra},mb=m(B),nb=Ca.x,yb=Ca.y,{x:ua(nb*(ob=mb.devicePixelRatio||1))/ob||0,y:ua(yb*ob)/ob||0}):{x:p,y:ra};return p=ka.x,ra=ka.y,Ga?Object.assign({},I,((kb={})[La]=ma?"0":"",kb[Oa]=Sa?"0":"",kb.transform=1>=(Ma.devicePixelRatio||1)?"translate("+
p+"px, "+ra+"px)":"translate3d("+p+"px, "+ra+"px, 0)",kb)):Object.assign({},I,((v={})[La]=ma?ra+"px":"",v[Oa]=Sa?p+"px":"",v.transform="",v))}function Za(p){return p.replace(/left|right|bottom|top/g,function(v){return rc[v]})}function Ia(p){return p.replace(/start|end/g,function(v){return bc[v]})}function zb(p){p=m(p);return{scrollLeft:p.pageXOffset,scrollTop:p.pageYOffset}}function Cb(p){return D(N(p)).left+zb(p).scrollLeft}function db(p){p=J(p);return/auto|scroll|overlay|hidden/.test(p.overflow+
p.overflowY+p.overflowX)}function ya(p,v){void 0===v&&(v=[]);var B,I=function ma(aa){return 0<=["html","body","#document"].indexOf(f(aa))?aa.ownerDocument.body:r(aa)&&db(aa)?aa:ma(L(aa))}(p);p=I===(null==(B=p.ownerDocument)?void 0:B.body);B=m(I);I=p?[B].concat(B.visualViewport||[],db(I)?I:[]):I;v=v.concat(I);return p?v:v.concat(ya(L(I)))}function T(p){return Object.assign({},p,{left:p.x,top:p.y,right:p.x+p.width,bottom:p.y+p.height})}function Z(p,v,B){var I,S,aa,ma,qa,Ga,Ra;if("viewport"===v){v=m(p);
var ka=N(p);v=v.visualViewport;var Ha=ka.clientWidth;ka=ka.clientHeight;var ra=I=0;v&&(Ha=v.width,ka=v.height,((S=C())||!S&&"fixed"===B)&&(I=v.offsetLeft,ra=v.offsetTop));p={width:Ha,height:ka,x:I+Cb(p),y:ra};B=T(p)}else B=q(v)?((Ha=D(v,!1,"fixed"===B)).top=Ha.top+v.clientTop,Ha.left+=v.clientLeft,Ha.bottom=Ha.top+v.clientHeight,Ha.right=Ha.left+v.clientWidth,Ha.width=v.clientWidth,Ha.height=v.clientHeight,Ha.x=Ha.left,Ha.y=Ha.top,Ha):T((ka=N(p),ra=N(ka),S=zb(ka),aa=null==(I=ka.ownerDocument)?void 0:
I.body,ma=Y(ra.scrollWidth,ra.clientWidth,aa?aa.scrollWidth:0,aa?aa.clientWidth:0),qa=Y(ra.scrollHeight,ra.clientHeight,aa?aa.scrollHeight:0,aa?aa.clientHeight:0),Ga=-S.scrollLeft+Cb(ka),Ra=-S.scrollTop,"rtl"===J(aa||ra).direction&&(Ga+=Y(ra.clientWidth,aa?aa.clientWidth:0)-ma),{width:ma,height:qa,x:Ga,y:Ra}));return B}function va(p){var v=p.reference,B=p.element,I=(p=p.placement)?u(p):null;p=p?ja(p):null;var S=v.x+v.width/2-B.width/2;var aa=v.y+v.height/2-B.height/2;switch(I){case "top":S={x:S,y:v.y-
B.height};break;case "bottom":S={x:S,y:v.y+v.height};break;case "right":S={x:v.x+v.width,y:aa};break;case "left":S={x:v.x-B.width,y:aa};break;default:S={x:v.x,y:v.y}}I=I?fa(I):null;if(null!=I)switch(aa="y"===I?"height":"width",p){case "start":S[I]-=v[aa]/2-B[aa]/2;break;case "end":S[I]+=v[aa]/2-B[aa]/2}return S}function ca(p,v){void 0===v&&(v={});var B,I,S,aa,ma,qa,Ga,Ra,ka=v;v=ka.placement;v=void 0===v?p.placement:v;var Ha=ka.strategy,ra=void 0===Ha?p.strategy:Ha,Sa=ka.boundary,Oa=ka.rootBoundary;
Ha=ka.elementContext;Ha=void 0===Ha?"popper":Ha;var La=ka.altBoundary;ka=ka.padding;ka=void 0===ka?0:ka;ka=pa("number"!=typeof ka?ka:H(ka,$b));var Ma=p.rects.popper;La=p.elements[void 0!==La&&La?"popper"===Ha?"reference":"popper":Ha];La=(B=q(La)?La:La.contextElement||N(p.elements.popper),I=void 0===Sa?"clippingParents":Sa,S=void 0===Oa?"viewport":Oa,Ga=(qa=[].concat("clippingParents"===I?(aa=ya(L(B)),q(ma=0<=["absolute","fixed"].indexOf(J(B).position)&&r(B)?X(B):B)?aa.filter(function(Xa){return q(Xa)&&
F(Xa,ma)&&"body"!==f(Xa)}):[]):[].concat(I),[S]))[0],(Ra=qa.reduce(function(Xa,Ca){Ca=Z(B,Ca,ra);return Xa.top=Y(Ca.top,Xa.top),Xa.right=ia(Ca.right,Xa.right),Xa.bottom=ia(Ca.bottom,Xa.bottom),Xa.left=Y(Ca.left,Xa.left),Xa},Z(B,Ga,ra))).width=Ra.right-Ra.left,Ra.height=Ra.bottom-Ra.top,Ra.x=Ra.left,Ra.y=Ra.top,Ra);I=D(p.elements.reference);S=va({reference:I,element:Ma,placement:v});S=T(Object.assign({},Ma,S));I="popper"===Ha?S:I;var Ta={top:La.top-I.top+ka.top,bottom:I.bottom-La.bottom+ka.bottom,
left:La.left-I.left+ka.left,right:I.right-La.right+ka.right};p=p.modifiersData.offset;if("popper"===Ha&&p){var vb=p[v];Object.keys(Ta).forEach(function(Xa){var Ca=0<=["right","bottom"].indexOf(Xa)?1:-1,mb=0<=["top","bottom"].indexOf(Xa)?"y":"x";Ta[Xa]+=vb[mb]*Ca})}return Ta}function Pa(p,v,B){return void 0===B&&(B={x:0,y:0}),{top:p.top-v.height-B.y,right:p.right-v.width+B.x,bottom:p.bottom-v.height+B.y,left:p.left-v.width-B.x}}function O(p){return["top","right","bottom","left"].some(function(v){return 0<=
p[v]})}function da(){for(var p=arguments.length,v=Array(p),B=0;B<p;B++)v[B]=arguments[B];return!v.some(function(I){return!(I&&"function"==typeof I.getBoundingClientRect)})}function Ka(p){void 0===p&&(p={});var v=p.defaultModifiers,B=void 0===v?[]:v;p=p.defaultOptions;var I=void 0===p?cb:p;return function(S,aa,ma){function qa(){Ha.forEach(function(Oa){return Oa()});Ha=[]}void 0===ma&&(ma=I);var Ga,Ra,ka={placement:"bottom",orderedModifiers:[],options:Object.assign({},cb,I),modifiersData:{},elements:{reference:S,
popper:aa},attributes:{},styles:{}},Ha=[],ra=!1,Sa={state:ka,setOptions:function(Oa){Oa="function"==typeof Oa?Oa(ka.options):Oa;qa();ka.options=Object.assign({},I,ka.options,Oa);ka.scrollParents={reference:q(S)?ya(S):S.contextElement?ya(S.contextElement):[],popper:ya(aa)};var La,Ma,Ta,vb,Xa;Oa=(La=Object.keys(Xa=[].concat(B,ka.options.modifiers).reduce(function(Ca,mb){var nb=Ca[mb.name];return Ca[mb.name]=nb?Object.assign({},nb,mb,{options:Object.assign({},nb.options,mb.options),data:Object.assign({},
nb.data,mb.data)}):mb,Ca},{})).map(function(Ca){return Xa[Ca]}),Ma=new Map,Ta=new Set,vb=[],La.forEach(function(Ca){Ma.set(Ca.name,Ca)}),La.forEach(function(Ca){Ta.has(Ca.name)||function yb(nb){Ta.add(nb.name);[].concat(nb.requires||[],nb.requiresIfExists||[]).forEach(function(ob){Ta.has(ob)||(ob=Ma.get(ob))&&yb(ob)});vb.push(nb)}(Ca)}),y.reduce(function(Ca,mb){return Ca.concat(vb.filter(function(nb){return nb.phase===mb}))},[]));return ka.orderedModifiers=Oa.filter(function(Ca){return Ca.enabled}),
ka.orderedModifiers.forEach(function(Ca){var mb=Ca.name,nb=Ca.options;Ca=Ca.effect;"function"==typeof Ca&&(mb=Ca({state:ka,name:mb,instance:Sa,options:void 0===nb?{}:nb}),Ha.push(mb||function(){}))}),Sa.update()},forceUpdate:function(){if(!ra){var Oa=ka.elements,La=Oa.reference;Oa=Oa.popper;if(da(La,Oa)){ka.rects={reference:(Ma=X(Oa),Ta="fixed"===ka.options.strategy,mb=r(Ma),nb=r(Ma)&&(Xa=ua((vb=Ma.getBoundingClientRect()).width)/Ma.offsetWidth||1,Ca=ua(vb.height)/Ma.offsetHeight||1,1!==Xa||1!==Ca),
yb=N(Ma),ob=D(La,nb,Ta),kb={scrollLeft:0,scrollTop:0},Xb={x:0,y:0},(mb||!mb&&!Ta)&&(("body"!==f(Ma)||db(yb))&&(kb=Ma!==m(Ma)&&r(Ma)?{scrollLeft:Ma.scrollLeft,scrollTop:Ma.scrollTop}:zb(Ma)),r(Ma)?((Xb=D(Ma,!0)).x+=Ma.clientLeft,Xb.y+=Ma.clientTop):yb&&(Xb.x=Cb(yb))),{x:ob.left+kb.scrollLeft-Xb.x,y:ob.top+kb.scrollTop-Xb.y,width:ob.width,height:ob.height}),popper:A(Oa)};ka.reset=!1;ka.placement=ka.options.placement;ka.orderedModifiers.forEach(function(Cc){return ka.modifiersData[Cc.name]=Object.assign({},
Cc.data)});var Ma,Ta,vb,Xa,Ca,mb,nb,yb,ob,kb,Xb;for(La=0;La<ka.orderedModifiers.length;La++)!0!==ka.reset?(Ta=ka.orderedModifiers[La],Ma=Ta.fn,vb=Ta.options,vb=void 0===vb?{}:vb,Ta=Ta.name,"function"==typeof Ma&&(ka=Ma({state:ka,options:vb,name:Ta,instance:Sa})||ka)):(ka.reset=!1,La=-1)}}},update:(Ga=function(){return new Promise(function(Oa){Sa.forceUpdate();Oa(ka)})},function(){return Ra||=new Promise(function(Oa){Promise.resolve().then(function(){Ra=void 0;Oa(Ga())})}),Ra}),destroy:function(){qa();
ra=!0}};return da(S,aa)?(Sa.setOptions(ma).then(function(Oa){!ra&&ma.onFirstUpdate&&ma.onFirstUpdate(Oa)}),Sa):Sa}}let bb=new Map,Jb={set(p,v,B){bb.has(p)||bb.set(p,new Map);p=bb.get(p);p.has(v)||0===p.size?p.set(v,B):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(p.keys())[0]}.`)},get:(p,v)=>bb.has(p)&&bb.get(p).get(v)||null,remove(p,v){if(bb.has(p)){var B=bb.get(p);B.delete(v);0===B.size&&bb.delete(p)}}},Ja=p=>(p&&window.CSS&&window.CSS.escape&&
(p=p.replace(/#([^\s"#']+)/g,(v,B)=>`#${CSS.escape(B)}`)),p),sb=p=>!(!p||"object"!=typeof p)&&(void 0!==p.jquery&&(p=p[0]),void 0!==p.nodeType),Gb=p=>sb(p)?p.jquery?p[0]:p:"string"==typeof p&&0<p.length?document.querySelector(Ja(p)):null,jb=p=>{if(!sb(p)||0===p.getClientRects().length)return!1;let v="visible"===getComputedStyle(p).getPropertyValue("visibility"),B=p.closest("details:not([open])");return B?B!==p&&((p=p.closest("summary"))&&p.parentNode!==B||null===p)?!1:v:v},wb=p=>!p||p.nodeType!==
Node.ELEMENT_NODE||!!p.classList.contains("disabled")||(void 0!==p.disabled?p.disabled:p.hasAttribute("disabled")&&"false"!==p.getAttribute("disabled")),Qa=p=>document.documentElement.attachShadow?"function"==typeof p.getRootNode?(p=p.getRootNode(),p instanceof ShadowRoot?p:null):p instanceof ShadowRoot?p:p.parentNode?Qa(p.parentNode):null:null,Ob=()=>{},rb=p=>{p.offsetHeight},Kb=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,eb=[],Wa=p=>{var v=()=>{let B=Kb();
if(B){let I=p.NAME,S=B.fn[I];B.fn[I]=p.jQueryInterface;B.fn[I].Constructor=p;B.fn[I].noConflict=()=>(B.fn[I]=S,p.jQueryInterface)}};"loading"===document.readyState?(eb.length||document.addEventListener("DOMContentLoaded",()=>{for(let B of eb)B()}),eb.push(v)):v()},Bb=(p,v=[],B=p)=>"function"==typeof p?p.call(...v):B,ib=(p,v,B=!0)=>{if(!B)return void Bb(p);B=(aa=>{if(!aa)return 0;let {transitionDuration:ma,transitionDelay:qa}=window.getComputedStyle(aa);aa=Number.parseFloat(ma);let Ga=Number.parseFloat(qa);
return aa||Ga?(ma=ma.split(",")[0],qa=qa.split(",")[0],1E3*(Number.parseFloat(ma)+Number.parseFloat(qa))):0})(v)+5;let I=!1,S=({target:aa})=>{aa===v&&(I=!0,v.removeEventListener("transitionend",S),Bb(p))};v.addEventListener("transitionend",S);setTimeout(()=>{I||v.dispatchEvent(new Event("transitionend"))},B)},ec=(p,v,B,I)=>{let S=p.length;v=p.indexOf(v);return-1===v?!B&&I?p[S-1]:p[0]:(v+=B?1:-1,I&&(v=(v+S)%S),p[Math.max(0,Math.min(v,S-1))])},jc=/[^.]*(?=\..*)\.|.*/,Zb=/\..*/,lc=/::\d+$/,Pb={},Fb=
1,wc={mouseenter:"mouseover",mouseleave:"mouseout"},kc=new Set("click dblclick mouseup mousedown contextmenu mousewheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange touchstart touchmove touchend touchcancel pointerdown pointermove pointerup pointerleave pointercancel gesturestart gesturechange gestureend focus blur change reset select submit focusin focusout load unload beforeunload resize move DOMContentLoaded readystatechange error abort scroll".split(" ")),
ha={on(p,v,B,I){k(p,v,B,I,!1)},one(p,v,B,I){k(p,v,B,I,!0)},off(p,v,B,I){if("string"==typeof v&&p){var [S,aa,ma]=b(v,B,I);I=ma!==v;var qa=c(p),Ga=qa[ma]||{},Ra=v.startsWith(".");if(void 0===aa){if(Ra)for(var ka of Object.keys(qa)){B=v.slice(1);for(let [Ha,ra]of Object.entries(qa[ka]||{}))Ha.includes(B)&&n(p,qa,ka,ra.callable,ra.delegationSelector)}for(let [Ha,ra]of Object.entries(Ga))ka=Ha.replace(lc,""),I&&!v.includes(ka)||n(p,qa,ma,ra.callable,ra.delegationSelector)}else Object.keys(Ga).length&&
n(p,qa,ma,aa,S?B:null)}},trigger(p,v,B){if("string"!=typeof v||!p)return null;let I=Kb(),S=null,aa=!0,ma=!0,qa=!1;v!==g(v)&&I&&(S=I.Event(v,B),I(p).trigger(S),aa=!S.isPropagationStopped(),ma=!S.isImmediatePropagationStopped(),qa=S.isDefaultPrevented());v=e(new Event(v,{bubbles:aa,cancelable:!0}),B);return qa&&v.preventDefault(),ma&&p.dispatchEvent(v),v.defaultPrevented&&S&&S.preventDefault(),v}},Lb={setDataAttribute(p,v,B){p.setAttribute(`data-bs-${l(v)}`,B)},removeDataAttribute(p,v){p.removeAttribute(`data-bs-${l(v)}`)},
getDataAttributes(p){if(!p)return{};let v={};for(let B of Object.keys(p.dataset).filter(I=>I.startsWith("bs")&&!I.startsWith("bsConfig"))){let I=B.replace(/^bs/,"");v[I=I.charAt(0).toLowerCase()+I.slice(1)]=h(p.dataset[B])}return v},getDataAttribute:(p,v)=>h(p.getAttribute(`data-bs-${l(v)}`))};class dc{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw Error('You have to implement the static method "NAME", for each component!');}_getConfig(p){return p=this._mergeConfigObj(p),
p=this._configAfterMerge(p),this._typeCheckConfig(p),p}_configAfterMerge(p){return p}_mergeConfigObj(p,v){let B=sb(v)?Lb.getDataAttribute(v,"config"):{};return{...this.constructor.Default,...("object"==typeof B?B:{}),...(sb(v)?Lb.getDataAttributes(v):{}),...("object"==typeof p?p:{})}}_typeCheckConfig(p,v=this.constructor.DefaultType){for(let [B,I]of Object.entries(v))if(v=p[B],v=sb(v)?"element":null==v?`${v}`:Object.prototype.toString.call(v).match(/\s([a-z]+)/i)[1].toLowerCase(),!(new RegExp(I)).test(v))throw TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${B}" provided type "${v}" but expected type "${I}".`);
}}class Rb extends dc{dispose(){for(let p of(Jb.remove(this._element,this.constructor.DATA_KEY),ha.off(this._element,this.constructor.EVENT_KEY),Object.getOwnPropertyNames(this)))this[p]=null}_queueCallback(p,v,B=!0){ib(p,v,B)}_getConfig(p){return p=this._mergeConfigObj(p,this._element),p=this._configAfterMerge(p),this._typeCheckConfig(p),p}static getInstance(p){return Jb.get(Gb(p),this.DATA_KEY)}static getOrCreateInstance(p,v={}){return this.getInstance(p)||new this(p,"object"==typeof v?v:null)}static get VERSION(){return"5.3.7"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(p){return`${p}${this.EVENT_KEY}`}constructor(p,
v){super();(p=Gb(p))&&(this._element=p,this._config=this._getConfig(v),Jb.set(this._element,this.constructor.DATA_KEY,this))}}let vc=p=>{let v=p.getAttribute("data-bs-target");if(!v||"#"===v){p=p.getAttribute("href");if(!p||!p.includes("#")&&!p.startsWith("."))return null;p.includes("#")&&!p.startsWith("#")&&(p=`#${p.split("#")[1]}`);v=p&&"#"!==p?p.trim():null}return v?v.split(",").map(B=>Ja(B)).join(","):null},Da={find:(p,v=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(v,
p)),findOne:(p,v=document.documentElement)=>Element.prototype.querySelector.call(v,p),children:(p,v)=>[].concat(...p.children).filter(B=>B.matches(v)),parents(p,v){let B=[];for(p=p.parentNode.closest(v);p;)B.push(p),p=p.parentNode.closest(v);return B},prev(p,v){for(p=p.previousElementSibling;p;){if(p.matches(v))return[p];p=p.previousElementSibling}return[]},next(p,v){for(p=p.nextElementSibling;p;){if(p.matches(v))return[p];p=p.nextElementSibling}return[]},focusableChildren(p){let v='a button input textarea select details [tabindex] [contenteditable="true"]'.split(" ").map(B=>
`${B}:not([tabindex^="-"])`).join(",");return this.find(v,p).filter(B=>!wb(B)&&jb(B))},getSelectorFromElement(p){return(p=vc(p))&&Da.findOne(p)?p:null},getElementFromSelector(p){return(p=vc(p))?Da.findOne(p):null},getMultipleElementsFromSelector(p){return(p=vc(p))?Da.find(p):[]}},Qb=(p,v="hide")=>{let B=p.NAME;ha.on(document,`click.dismiss${p.EVENT_KEY}`,`[data-bs-dismiss="${B}"]`,function(I){(["A","AREA"].includes(this.tagName)&&I.preventDefault(),wb(this))||(I=Da.getElementFromSelector(this)||this.closest(`.${B}`),
p.getOrCreateInstance(I)[v]())})};class hc extends Rb{static get NAME(){return"alert"}close(){if(!ha.trigger(this._element,"close.bs.alert").defaultPrevented){this._element.classList.remove("show");var p=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,p)}}_destroyElement(){this._element.remove();ha.trigger(this._element,"closed.bs.alert");this.dispose()}static jQueryInterface(p){return this.each(function(){let v=hc.getOrCreateInstance(this);if("string"==
typeof p){if(void 0===v[p]||p.startsWith("_")||"constructor"===p)throw TypeError(`No method named "${p}"`);v[p](this)}})}}Qb(hc,"close");Wa(hc);class x extends Rb{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(p){return this.each(function(){let v=x.getOrCreateInstance(this);"toggle"===p&&v[p]()})}}ha.on(document,"click.bs.button.data-api",'[data-bs-toggle="button"]',p=>{p.preventDefault();p=p.target.closest('[data-bs-toggle="button"]');
x.getOrCreateInstance(p).toggle()});Wa(x);let E={endCallback:null,leftCallback:null,rightCallback:null},P={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class R extends dc{static get Default(){return E}static get DefaultType(){return P}static get NAME(){return"swipe"}dispose(){ha.off(this._element,".bs.swipe")}_start(p){this._supportPointerEvents?this._eventIsPointerPenTouch(p)&&(this._deltaX=p.clientX):this._deltaX=p.touches[0].clientX}_end(p){this._eventIsPointerPenTouch(p)&&
(this._deltaX=p.clientX-this._deltaX);this._handleSwipe();Bb(this._config.endCallback)}_move(p){this._deltaX=p.touches&&1<p.touches.length?0:p.touches[0].clientX-this._deltaX}_handleSwipe(){var p=Math.abs(this._deltaX);40>=p||(p/=this._deltaX,this._deltaX=0,p&&Bb(0<p?this._config.rightCallback:this._config.leftCallback))}_initEvents(){this._supportPointerEvents?(ha.on(this._element,"pointerdown.bs.swipe",p=>this._start(p)),ha.on(this._element,"pointerup.bs.swipe",p=>this._end(p)),this._element.classList.add("pointer-event")):
(ha.on(this._element,"touchstart.bs.swipe",p=>this._start(p)),ha.on(this._element,"touchmove.bs.swipe",p=>this._move(p)),ha.on(this._element,"touchend.bs.swipe",p=>this._end(p)))}_eventIsPointerPenTouch(p){return this._supportPointerEvents&&("pen"===p.pointerType||"touch"===p.pointerType)}static isSupported(){return"ontouchstart"in document.documentElement||0<navigator.maxTouchPoints}constructor(p,v){super();(this._element=p)&&R.isSupported()&&(this._config=this._getConfig(v),this._deltaX=0,this._supportPointerEvents=
!!window.PointerEvent,this._initEvents())}}let V={ArrowLeft:"right",ArrowRight:"left"},ba={interval:5E3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},ta={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Ba extends Rb{static get Default(){return ba}static get DefaultType(){return ta}static get NAME(){return"carousel"}next(){this._slide("next")}nextWhenVisible(){!document.hidden&&jb(this._element)&&this.next()}prev(){this._slide("prev")}pause(){this._isSliding&&
this._element.dispatchEvent(new Event("transitionend"));this._clearInterval()}cycle(){this._clearInterval();this._updateInterval();this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?ha.one(this._element,"slid.bs.carousel",()=>this.cycle()):this.cycle())}to(p){let v=this._getItems();if(!(p>v.length-1||0>p)){if(this._isSliding)return void ha.one(this._element,"slid.bs.carousel",()=>this.to(p));var B=this._getItemIndex(this._getActive());
B!==p&&this._slide(p>B?"next":"prev",v[p])}}dispose(){this._swipeHelper&&this._swipeHelper.dispose();super.dispose()}_configAfterMerge(p){return p.defaultInterval=p.interval,p}_addEventListeners(){this._config.keyboard&&ha.on(this._element,"keydown.bs.carousel",p=>this._keydown(p));"hover"===this._config.pause&&(ha.on(this._element,"mouseenter.bs.carousel",()=>this.pause()),ha.on(this._element,"mouseleave.bs.carousel",()=>this._maybeEnableCycle()));this._config.touch&&R.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(let p of Da.find(".carousel-item img",
this._element))ha.on(p,"dragstart.bs.carousel",v=>v.preventDefault());this._swipeHelper=new R(this._element,{leftCallback:()=>this._slide(this._directionToOrder("left")),rightCallback:()=>this._slide(this._directionToOrder("right")),endCallback:()=>{"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}})}_keydown(p){if(!/input|textarea/i.test(p.target.tagName)){var v=V[p.key];
v&&(p.preventDefault(),this._slide(this._directionToOrder(v)))}}_getItemIndex(p){return this._getItems().indexOf(p)}_setActiveIndicatorElement(p){if(this._indicatorsElement){var v=Da.findOne(".active",this._indicatorsElement);v.classList.remove("active");v.removeAttribute("aria-current");(p=Da.findOne(`[data-bs-slide-to="${p}"]`,this._indicatorsElement))&&(p.classList.add("active"),p.setAttribute("aria-current","true"))}}_updateInterval(){var p=this._activeElement||this._getActive();p&&(p=Number.parseInt(p.getAttribute("data-bs-interval"),
10),this._config.interval=p||this._config.defaultInterval)}_slide(p,v=null){if(!this._isSliding){var B=this._getActive(),I="next"===p,S=v||ec(this._getItems(),B,I,this._config.wrap);if(S!==B){var aa=this._getItemIndex(S),ma=Ra=>ha.trigger(this._element,Ra,{relatedTarget:S,direction:this._orderToDirection(p),from:this._getItemIndex(B),to:aa});if(!ma("slide.bs.carousel").defaultPrevented&&B&&S){v=!!this._interval;this.pause();this._isSliding=!0;this._setActiveIndicatorElement(aa);this._activeElement=
S;var qa=I?"carousel-item-start":"carousel-item-end",Ga=I?"carousel-item-next":"carousel-item-prev";S.classList.add(Ga);S.offsetHeight;B.classList.add(qa);S.classList.add(qa);this._queueCallback(()=>{S.classList.remove(qa,Ga);S.classList.add("active");B.classList.remove("active",Ga,qa);this._isSliding=!1;ma("slid.bs.carousel")},B,this._isAnimated());v&&this.cycle()}}}}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return Da.findOne(".active.carousel-item",this._element)}_getItems(){return Da.find(".carousel-item",
this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(p){return"rtl"===document.documentElement.dir?"left"===p?"prev":"next":"left"===p?"next":"prev"}_orderToDirection(p){return"rtl"===document.documentElement.dir?"prev"===p?"left":"right":"prev"===p?"right":"left"}static jQueryInterface(p){return this.each(function(){let v=Ba.getOrCreateInstance(this,p);if("number"!=typeof p){if("string"==typeof p){if(void 0===v[p]||p.startsWith("_")||
"constructor"===p)throw TypeError(`No method named "${p}"`);v[p]()}}else v.to(p)})}constructor(p,v){super(p,v);this._activeElement=this._interval=null;this._isSliding=!1;this._swipeHelper=this.touchTimeout=null;this._indicatorsElement=Da.findOne(".carousel-indicators",this._element);this._addEventListeners();"carousel"===this._config.ride&&this.cycle()}}ha.on(document,"click.bs.carousel.data-api","[data-bs-slide], [data-bs-slide-to]",function(p){var v=Da.getElementFromSelector(this);if(v&&v.classList.contains("carousel"))return p.preventDefault(),
p=Ba.getOrCreateInstance(v),v=this.getAttribute("data-bs-slide-to"),v?p.to(v):"next"===Lb.getDataAttribute(this,"slide")?p.next():p.prev(),void p._maybeEnableCycle()});ha.on(window,"load.bs.carousel.data-api",()=>{for(let p of Da.find('[data-bs-ride="carousel"]'))Ba.getOrCreateInstance(p)});Wa(Ba);let hb={parent:null,toggle:!0},fc={parent:"(null|element)",toggle:"boolean"};class gc extends Rb{static get Default(){return hb}static get DefaultType(){return fc}static get NAME(){return"collapse"}toggle(){this._isShown()?
this.hide():this.show()}show(){if(!this._isTransitioning&&!this._isShown()){var p=[];if(!(this._config.parent&&(p=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(B=>B!==this._element).map(B=>gc.getOrCreateInstance(B,{toggle:!1}))),p.length&&p[0]._isTransitioning||ha.trigger(this._element,"show.bs.collapse").defaultPrevented)){for(let B of p)B.hide();var v=this._getDimension();this._element.classList.remove("collapse");this._element.classList.add("collapsing");this._element.style[v]=
0;this._addAriaAndCollapsedClass(this._triggerArray,!0);this._isTransitioning=!0;p=`scroll${v[0].toUpperCase()+v.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1;this._element.classList.remove("collapsing");this._element.classList.add("collapse","show");this._element.style[v]="";ha.trigger(this._element,"shown.bs.collapse")},this._element,!0);this._element.style[v]=`${this._element[p]}px`}}}hide(){if(!this._isTransitioning&&this._isShown()&&!ha.trigger(this._element,"hide.bs.collapse").defaultPrevented){var p=
this._getDimension();for(let v of(this._element.style[p]=`${this._element.getBoundingClientRect()[p]}px`,rb(this._element),this._element.classList.add("collapsing"),this._element.classList.remove("collapse","show"),this._triggerArray)){let B=Da.getElementFromSelector(v);B&&!this._isShown(B)&&this._addAriaAndCollapsedClass([v],!1)}this._isTransitioning=!0;this._element.style[p]="";this._queueCallback(()=>{this._isTransitioning=!1;this._element.classList.remove("collapsing");this._element.classList.add("collapse");
ha.trigger(this._element,"hidden.bs.collapse")},this._element,!0)}}_isShown(p=this._element){return p.classList.contains("show")}_configAfterMerge(p){return p.toggle=!!p.toggle,p.parent=Gb(p.parent),p}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(this._config.parent)for(let p of this._getFirstLevelChildren('[data-bs-toggle="collapse"]')){let v=Da.getElementFromSelector(p);v&&this._addAriaAndCollapsedClass([p],this._isShown(v))}}_getFirstLevelChildren(p){let v=
Da.find(":scope .collapse .collapse",this._config.parent);return Da.find(p,this._config.parent).filter(B=>!v.includes(B))}_addAriaAndCollapsedClass(p,v){if(p.length)for(let B of p)B.classList.toggle("collapsed",!v),B.setAttribute("aria-expanded",v)}static jQueryInterface(p){let v={};return"string"==typeof p&&/show|hide/.test(p)&&(v.toggle=!1),this.each(function(){let B=gc.getOrCreateInstance(this,v);if("string"==typeof p){if(void 0===B[p])throw TypeError(`No method named "${p}"`);B[p]()}})}constructor(p,
v){for(let B of(super(p,v),this._isTransitioning=!1,this._triggerArray=[],Da.find('[data-bs-toggle="collapse"]')))p=Da.getSelectorFromElement(B),v=Da.find(p).filter(I=>I===this._element),null!==p&&v.length&&this._triggerArray.push(B);this._initializeChildren();this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown());this._config.toggle&&this.toggle()}}ha.on(document,"click.bs.collapse.data-api",'[data-bs-toggle="collapse"]',function(p){for(let v of(("A"===p.target.tagName||
p.delegateTarget&&"A"===p.delegateTarget.tagName)&&p.preventDefault(),Da.getMultipleElementsFromSelector(this)))gc.getOrCreateInstance(v,{toggle:!1}).toggle()});Wa(gc);var $b=["top","bottom","right","left"],Eb=$b.reduce(function(p,v){return p.concat([v+"-start",v+"-end"])},[]),pb=[].concat($b,["auto"]).reduce(function(p,v){return p.concat([v,v+"-start",v+"-end"])},[]),y="beforeRead read afterRead beforeMain main afterMain beforeWrite write afterWrite".split(" ");let K={name:"applyStyles",enabled:!0,
phase:"write",fn:function(p){var v=p.state;Object.keys(v.elements).forEach(function(B){var I=v.styles[B]||{},S=v.attributes[B]||{},aa=v.elements[B];r(aa)&&f(aa)&&(Object.assign(aa.style,I),Object.keys(S).forEach(function(ma){var qa=S[ma];!1===qa?aa.removeAttribute(ma):aa.setAttribute(ma,!0===qa?"":qa)}))})},effect:function(p){var v=p.state,B={popper:{position:v.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(v.elements.popper.style,B.popper),
v.styles=B,v.elements.arrow&&Object.assign(v.elements.arrow.style,B.arrow),function(){Object.keys(v.elements).forEach(function(I){var S=v.elements[I],aa=v.attributes[I]||{};I=Object.keys(v.styles.hasOwnProperty(I)?v.styles[I]:B[I]).reduce(function(ma,qa){return ma[qa]="",ma},{});r(S)&&f(S)&&(Object.assign(S.style,I),Object.keys(aa).forEach(function(ma){S.removeAttribute(ma)}))})}},requires:["computeStyles"]};var Y=Math.max,ia=Math.min,ua=Math.round;let ea={name:"arrow",enabled:!0,phase:"main",fn:function(p){var v,
B=p.state,I=p.name,S=p.options,aa=B.elements.arrow,ma=B.modifiersData.popperOffsets,qa=u(B.placement);p=fa(qa);qa=0<=["left","right"].indexOf(qa)?"height":"width";if(aa&&ma){var Ga;S=(Ga=S.padding,pa("number"!=typeof(Ga="function"==typeof Ga?Ga(Object.assign({},B.rects,{placement:B.placement})):Ga)?Ga:H(Ga,$b)));Ga=A(aa);var Ra="y"===p?"top":"left",ka="y"===p?"bottom":"right",Ha=B.rects.reference[qa]+B.rects.reference[p]-ma[p]-B.rects.popper[qa];ma=ma[p]-B.rects.reference[p];aa=(aa=X(aa))?"y"===p?
aa.clientHeight||0:aa.clientWidth||0:0;ma=aa/2-Ga[qa]/2+(Ha/2-ma/2);qa=Y(S[Ra],ia(ma,aa-Ga[qa]-S[ka]));B.modifiersData[I]=((v={})[p]=qa,v.centerOffset=qa-ma,v)}},effect:function(p){var v=p.state;p=p.options.element;p=void 0===p?"[data-popper-arrow]":p;null!=p&&("string"!=typeof p||(p=v.elements.popper.querySelector(p)))&&F(v.elements.popper,p)&&(v.elements.arrow=p)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};var za={top:"auto",right:"auto",bottom:"auto",left:"auto"};let Va={name:"computeStyles",
enabled:!0,phase:"beforeWrite",fn:function(p){var v=p.state,B=p.options,I=B.gpuAcceleration;p=B.adaptive;B=B.roundOffsets;B=void 0===B||B;I={placement:u(v.placement),variation:ja(v.placement),popper:v.elements.popper,popperRect:v.rects.popper,gpuAcceleration:void 0===I||I,isFixed:"fixed"===v.options.strategy};null!=v.modifiersData.popperOffsets&&(v.styles.popper=Object.assign({},v.styles.popper,U(Object.assign({},I,{offsets:v.modifiersData.popperOffsets,position:v.options.strategy,adaptive:void 0===
p||p,roundOffsets:B}))));null!=v.modifiersData.arrow&&(v.styles.arrow=Object.assign({},v.styles.arrow,U(Object.assign({},I,{offsets:v.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:B}))));v.attributes.popper=Object.assign({},v.attributes.popper,{"data-popper-placement":v.placement})},data:{}};var xb={passive:!0};let Vb={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(p){var v=p.state,B=p.instance;p=p.options;var I=p.scroll,S=void 0===I||I;p=p.resize;
var aa=void 0===p||p,ma=m(v.elements.popper),qa=[].concat(v.scrollParents.reference,v.scrollParents.popper);return S&&qa.forEach(function(Ga){Ga.addEventListener("scroll",B.update,xb)}),aa&&ma.addEventListener("resize",B.update,xb),function(){S&&qa.forEach(function(Ga){Ga.removeEventListener("scroll",B.update,xb)});aa&&ma.removeEventListener("resize",B.update,xb)}},data:{}};var rc={left:"right",right:"left",bottom:"top",top:"bottom"},bc={start:"end",end:"start"};let jd={name:"flip",enabled:!0,phase:"main",
fn:function(p){var v=p.state,B=p.options;p=p.name;if(!v.modifiersData[p]._skip){var I=B.mainAxis;I=void 0===I||I;var S=B.altAxis;S=void 0===S||S;var aa=B.fallbackPlacements,ma=B.padding,qa=B.boundary,Ga=B.rootBoundary,Ra=B.altBoundary,ka=B.flipVariations,Ha=void 0===ka||ka,ra=B.allowedAutoPlacements;B=v.options.placement;ka=u(B);aa=aa||(ka!==B&&Ha?function(yb){if("auto"===u(yb))return[];var ob=Za(yb);return[Ia(yb),ob,Ia(ob)]}(B):[Za(B)]);var Sa=[B].concat(aa).reduce(function(yb,ob){var kb,Xb,Cc,Dc,
Bf,Cf,Df,Ef,Ff,Gf,pe,qe;return yb.concat("auto"===u(ob)?(Xb=(kb={placement:ob,boundary:qa,rootBoundary:Ga,padding:ma,flipVariations:Ha,allowedAutoPlacements:ra}).placement,Cc=kb.boundary,Dc=kb.rootBoundary,Bf=kb.padding,Cf=kb.flipVariations,Ef=void 0===(Df=kb.allowedAutoPlacements)?pb:Df,0===(pe=(Gf=(Ff=ja(Xb))?Cf?Eb:Eb.filter(function(Ec){return ja(Ec)===Ff}):$b).filter(function(Ec){return 0<=Ef.indexOf(Ec)})).length&&(pe=Gf),Object.keys(qe=pe.reduce(function(Ec,pd){return Ec[pd]=ca(v,{placement:pd,
boundary:Cc,rootBoundary:Dc,padding:Bf})[u(pd)],Ec},{})).sort(function(Ec,pd){return qe[Ec]-qe[pd]})):ob)},[]);B=v.rects.reference;aa=v.rects.popper;var Oa=new Map;ka=!0;for(var La=Sa[0],Ma=0;Ma<Sa.length;Ma++){var Ta=Sa[Ma],vb=u(Ta),Xa="start"===ja(Ta),Ca=0<=["top","bottom"].indexOf(vb),mb=Ca?"width":"height",nb=ca(v,{placement:Ta,boundary:qa,rootBoundary:Ga,altBoundary:Ra,padding:ma});Xa=Ca?Xa?"right":"left":Xa?"bottom":"top";B[mb]>aa[mb]&&(Xa=Za(Xa));mb=Za(Xa);Ca=[];if(I&&Ca.push(0>=nb[vb]),S&&
Ca.push(0>=nb[Xa],0>=nb[mb]),Ca.every(function(yb){return yb})){La=Ta;ka=!1;break}Oa.set(Ta,Ca)}if(ka)for(I=function(yb){var ob=Sa.find(function(kb){if(kb=Oa.get(kb))return kb.slice(0,yb).every(function(Xb){return Xb})});if(ob)return La=ob,"break"},S=Ha?3:1;0<S&&"break"!==I(S);S--);v.placement!==La&&(v.modifiersData[p]._skip=!0,v.placement=La,v.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},na={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(p){var v=
p.state;p=p.name;var B=v.rects.reference,I=v.rects.popper,S=v.modifiersData.preventOverflow,aa=ca(v,{elementContext:"reference"}),ma=ca(v,{altBoundary:!0});B=Pa(aa,B);I=Pa(ma,I,S);S=O(B);ma=O(I);v.modifiersData[p]={referenceClippingOffsets:B,popperEscapeOffsets:I,isReferenceHidden:S,hasPopperEscaped:ma};v.attributes.popper=Object.assign({},v.attributes.popper,{"data-popper-reference-hidden":S,"data-popper-escaped":ma})}},xa={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(p){var v=
p.state,B=p.name;p=p.options.offset;var I=void 0===p?[0,0]:p;p=pb.reduce(function(ma,qa){var Ga,Ra,ka,Ha,ra,Sa;return ma[qa]=(Ga=v.rects,ka=0<=["left","top"].indexOf(Ra=u(qa))?-1:1,ra=(Ha="function"==typeof I?I(Object.assign({},Ga,{placement:qa})):I)[0],Sa=Ha[1],ra=ra||0,Sa=(Sa||0)*ka,0<=["left","right"].indexOf(Ra)?{x:Sa,y:ra}:{x:ra,y:Sa}),ma},{});var S=p[v.placement],aa=S.x;S=S.y;null!=v.modifiersData.popperOffsets&&(v.modifiersData.popperOffsets.x+=aa,v.modifiersData.popperOffsets.y+=S);v.modifiersData[B]=
p}},Aa={name:"popperOffsets",enabled:!0,phase:"read",fn:function(p){var v=p.state;v.modifiersData[p.name]=va({reference:v.rects.reference,element:v.rects.popper,placement:v.placement})},data:{}},$a={name:"preventOverflow",enabled:!0,phase:"main",fn:function(p){var v=p.state,B=p.options;p=p.name;var I=B.mainAxis,S=B.altAxis,aa=B.tether;aa=void 0===aa||aa;var ma=B.tetherOffset,qa=void 0===ma?0:ma,Ga=ca(v,{boundary:B.boundary,rootBoundary:B.rootBoundary,padding:B.padding,altBoundary:B.altBoundary}),
Ra=u(v.placement),ka=ja(v.placement),Ha=!ka,ra=fa(Ra);B="x"===ra?"y":"x";ma=v.modifiersData.popperOffsets;var Sa=v.rects.reference,Oa=v.rects.popper;qa="function"==typeof qa?qa(Object.assign({},v.rects,{placement:v.placement})):qa;var La="number"==typeof qa?{mainAxis:qa,altAxis:qa}:Object.assign({mainAxis:0,altAxis:0},qa),Ma=v.modifiersData.offset?v.modifiersData.offset[v.placement]:null;qa={x:0,y:0};if(ma){if(void 0===I||I){var Ta,vb="y"===ra?"top":"left",Xa="y"===ra?"bottom":"right",Ca="y"===ra?
"height":"width";I=ma[ra];var mb=I+Ga[vb],nb=I-Ga[Xa],yb=aa?-Oa[Ca]/2:0,ob="start"===ka?Sa[Ca]:Oa[Ca];ka="start"===ka?-Oa[Ca]:-Sa[Ca];var kb=v.elements.arrow;kb=aa&&kb?A(kb):{width:0,height:0};var Xb=v.modifiersData["arrow#persistent"]?v.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0};vb=Xb[vb];Xa=Xb[Xa];kb=Y(0,ia(Sa[Ca],kb[Ca]));ob=Ha?Sa[Ca]/2-yb-kb-vb-La.mainAxis:ob-kb-vb-La.mainAxis;Ha=Ha?-Sa[Ca]/2+yb+kb+Xa+La.mainAxis:ka+kb+Xa+La.mainAxis;yb=(Ca=v.elements.arrow&&X(v.elements.arrow))?
"y"===ra?Ca.clientTop||0:Ca.clientLeft||0:0;Ca=null!=(Ta=null==Ma?void 0:Ma[ra])?Ta:0;Ta=aa?ia(mb,I+ob-Ca-yb):mb;nb=aa?Y(nb,I+Ha-Ca):nb;Ta=Y(Ta,ia(I,nb));ma[ra]=Ta;qa[ra]=Ta-I}if(void 0!==S&&S){var Cc,Dc;S=ma[B];I="y"===B?"height":"width";Ta=S+Ga["x"===ra?"top":"left"];Ga=S-Ga["x"===ra?"bottom":"right"];Ra=-1!==["top","left"].indexOf(Ra);ra=null!=(Dc=null==Ma?void 0:Ma[B])?Dc:0;Dc=Ra?Ta:S-Sa[I]-Oa[I]-ra+La.altAxis;Sa=Ra?S+Sa[I]+Oa[I]-ra-La.altAxis:Ga;Oa=aa&&Ra?(Cc=Y(Dc,ia(S,Sa)))>Sa?Sa:Cc:Y(aa?Dc:
Ta,ia(S,aa?Sa:Ga));ma[B]=Oa;qa[B]=Oa-S}v.modifiersData[p]=qa}},requiresIfExists:["offset"]};var cb={placement:"bottom",modifiers:[],strategy:"absolute"},ic=Ka(),Mc=Ka({defaultModifiers:[Vb,Aa,Va,K]}),re=Ka({defaultModifiers:[Vb,Aa,Va,K,xa,jd,$a,ea,na]});let Hf=Object.freeze(Object.defineProperty({__proto__:null,afterMain:"afterMain",afterRead:"afterRead",afterWrite:"afterWrite",applyStyles:K,arrow:ea,auto:"auto",basePlacements:$b,beforeMain:"beforeMain",beforeRead:"beforeRead",beforeWrite:"beforeWrite",
bottom:"bottom",clippingParents:"clippingParents",computeStyles:Va,createPopper:re,createPopperBase:ic,createPopperLite:Mc,detectOverflow:ca,end:"end",eventListeners:Vb,flip:jd,hide:na,left:"left",main:"main",modifierPhases:y,offset:xa,placements:pb,popper:"popper",popperGenerator:Ka,popperOffsets:Aa,preventOverflow:$a,read:"read",reference:"reference",right:"right",start:"start",top:"top",variationPlacements:Eb,viewport:"viewport",write:"write"},Symbol.toStringTag,{value:"Module"})),Pg="rtl"===document.documentElement.dir?
"top-end":"top-start",Qg="rtl"===document.documentElement.dir?"top-start":"top-end",Rg="rtl"===document.documentElement.dir?"bottom-end":"bottom-start",Sg="rtl"===document.documentElement.dir?"bottom-start":"bottom-end",Tg="rtl"===document.documentElement.dir?"left-start":"right-start",Ug="rtl"===document.documentElement.dir?"right-start":"left-start",Vg={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Wg={autoClose:"(boolean|string)",boundary:"(string|element)",
display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class oc extends Rb{static get Default(){return Vg}static get DefaultType(){return Wg}static get NAME(){return"dropdown"}toggle(){return this._isShown()?this.hide():this.show()}show(){if(!wb(this._element)&&!this._isShown()){var p={relatedTarget:this._element};if(!ha.trigger(this._element,"show.bs.dropdown",p).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&
!this._parent.closest(".navbar-nav"))for(let v of[].concat(...document.body.children))ha.on(v,"mouseover",Ob);this._element.focus();this._element.setAttribute("aria-expanded",!0);this._menu.classList.add("show");this._element.classList.add("show");ha.trigger(this._element,"shown.bs.dropdown",p)}}}hide(){!wb(this._element)&&this._isShown()&&this._completeHide({relatedTarget:this._element})}dispose(){this._popper&&this._popper.destroy();super.dispose()}update(){this._inNavbar=this._detectNavbar();this._popper&&
this._popper.update()}_completeHide(p){if(!ha.trigger(this._element,"hide.bs.dropdown",p).defaultPrevented){if("ontouchstart"in document.documentElement)for(let v of[].concat(...document.body.children))ha.off(v,"mouseover",Ob);this._popper&&this._popper.destroy();this._menu.classList.remove("show");this._element.classList.remove("show");this._element.setAttribute("aria-expanded","false");Lb.removeDataAttribute(this._menu,"popper");ha.trigger(this._element,"hidden.bs.dropdown",p);this._element.focus()}}_getConfig(p){if("object"==
typeof(p=super._getConfig(p)).reference&&!sb(p.reference)&&"function"!=typeof p.reference.getBoundingClientRect)throw TypeError('DROPDOWN: Option "reference" provided type "object" without a required "getBoundingClientRect" method.');return p}_createPopper(){if(void 0===Hf)throw TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let p=this._element;"parent"===this._config.reference?p=this._parent:sb(this._config.reference)?p=Gb(this._config.reference):"object"==typeof this._config.reference&&
(p=this._config.reference);let v=this._getPopperConfig();this._popper=re(p,this._menu,v)}_isShown(){return this._menu.classList.contains("show")}_getPlacement(){let p=this._parent;if(p.classList.contains("dropend"))return Tg;if(p.classList.contains("dropstart"))return Ug;if(p.classList.contains("dropup-center"))return"top";if(p.classList.contains("dropdown-center"))return"bottom";let v="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return p.classList.contains("dropup")?
v?Qg:Pg:v?Sg:Rg}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){let {offset:p}=this._config;return"string"==typeof p?p.split(",").map(v=>Number.parseInt(v,10)):"function"==typeof p?v=>p(v,this._element):p}_getPopperConfig(){let p={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||"static"===this._config.display)&&(Lb.setDataAttribute(this._menu,
"popper","static"),p.modifiers=[{name:"applyStyles",enabled:!1}]),{...p,...Bb(this._config.popperConfig,[void 0,p])}}_selectMenuItem({key:p,target:v}){let B=Da.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(I=>jb(I));B.length&&ec(B,v,"ArrowDown"===p,!B.includes(v)).focus()}static jQueryInterface(p){return this.each(function(){let v=oc.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===v[p])throw TypeError(`No method named "${p}"`);v[p]()}})}static clearMenus(p){if(2!==
p.button&&("keyup"!==p.type||"Tab"===p.key))for(let B of Da.find('[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled).show')){let I=oc.getInstance(B);if(!I||!1===I._config.autoClose)continue;var v=p.composedPath();let S=v.includes(I._menu);v.includes(I._element)||"inside"===I._config.autoClose&&!S||"outside"===I._config.autoClose&&S||I._menu.contains(p.target)&&("keyup"===p.type&&"Tab"===p.key||/input|select|option|textarea|form/i.test(p.target.tagName))||(v={relatedTarget:I._element},"click"===
p.type&&(v.clickEvent=p),I._completeHide(v))}}static dataApiKeydownHandler(p){var v=/input|textarea/i.test(p.target.tagName),B="Escape"===p.key;let I=["ArrowUp","ArrowDown"].includes(p.key);if((I||B)&&(!v||B)){p.preventDefault();v=this.matches('[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)')?this:Da.prev(this,'[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)')[0]||Da.next(this,'[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)')[0]||Da.findOne('[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',
p.delegateTarget.parentNode);B=oc.getOrCreateInstance(v);if(I)return p.stopPropagation(),B.show(),void B._selectMenuItem(p);B._isShown()&&(p.stopPropagation(),B.hide(),v.focus())}}constructor(p,v){super(p,v);this._popper=null;this._parent=this._element.parentNode;this._menu=Da.next(this._element,".dropdown-menu")[0]||Da.prev(this._element,".dropdown-menu")[0]||Da.findOne(".dropdown-menu",this._parent);this._inNavbar=this._detectNavbar()}}ha.on(document,"keydown.bs.dropdown.data-api",'[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',
oc.dataApiKeydownHandler);ha.on(document,"keydown.bs.dropdown.data-api",".dropdown-menu",oc.dataApiKeydownHandler);ha.on(document,"click.bs.dropdown.data-api",oc.clearMenus);ha.on(document,"keyup.bs.dropdown.data-api",oc.clearMenus);ha.on(document,"click.bs.dropdown.data-api",'[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',function(p){p.preventDefault();oc.getOrCreateInstance(this).toggle()});Wa(oc);let Xg={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},
Yg={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class If extends dc{static get Default(){return Xg}static get DefaultType(){return Yg}static get NAME(){return"backdrop"}show(p){if(!this._config.isVisible)return void Bb(p);this._append();let v=this._getElement();this._config.isAnimated&&v.offsetHeight;v.classList.add("show");this._emulateAnimation(()=>{Bb(p)})}hide(p){this._config.isVisible?(this._getElement().classList.remove("show"),
this._emulateAnimation(()=>{this.dispose();Bb(p)})):Bb(p)}dispose(){this._isAppended&&(ha.off(this._element,"mousedown.bs.backdrop"),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){let p=document.createElement("div");p.className=this._config.className;this._config.isAnimated&&p.classList.add("fade");this._element=p}return this._element}_configAfterMerge(p){return p.rootElement=Gb(p.rootElement),p}_append(){if(!this._isAppended){var p=this._getElement();this._config.rootElement.append(p);
ha.on(p,"mousedown.bs.backdrop",()=>{Bb(this._config.clickCallback)});this._isAppended=!0}}_emulateAnimation(p){ib(p,this._getElement(),this._config.isAnimated)}constructor(p){super();this._config=this._getConfig(p);this._isAppended=!1;this._element=null}}let Zg={autofocus:!0,trapElement:null},$g={autofocus:"boolean",trapElement:"element"};class Jf extends dc{static get Default(){return Zg}static get DefaultType(){return $g}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&
this._config.trapElement.focus(),ha.off(document,".bs.focustrap"),ha.on(document,"focusin.bs.focustrap",p=>this._handleFocusin(p)),ha.on(document,"keydown.tab.bs.focustrap",p=>this._handleKeydown(p)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,ha.off(document,".bs.focustrap"))}_handleFocusin(p){let {trapElement:v}=this._config;p.target===document||p.target===v||v.contains(p.target)||(p=Da.focusableChildren(v),0===p.length?v.focus():"backward"===this._lastTabNavDirection?p[p.length-
1].focus():p[0].focus())}_handleKeydown(p){"Tab"===p.key&&(this._lastTabNavDirection=p.shiftKey?"backward":"forward")}constructor(p){super();this._config=this._getConfig(p);this._isActive=!1;this._lastTabNavDirection=null}}class se{getWidth(){return Math.abs(window.innerWidth-document.documentElement.clientWidth)}hide(){let p=this.getWidth();this._disableOverFlow();this._setElementAttributes(this._element,"padding-right",v=>v+p);this._setElementAttributes(".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",
"padding-right",v=>v+p);this._setElementAttributes(".sticky-top","margin-right",v=>v-p)}reset(){this._resetElementAttributes(this._element,"overflow");this._resetElementAttributes(this._element,"padding-right");this._resetElementAttributes(".fixed-top, .fixed-bottom, .is-fixed, .sticky-top","padding-right");this._resetElementAttributes(".sticky-top","margin-right")}isOverflowing(){return 0<this.getWidth()}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow");this._element.style.overflow=
"hidden"}_setElementAttributes(p,v,B){let I=this.getWidth();this._applyManipulationCallback(p,S=>{if(!(S!==this._element&&window.innerWidth>S.clientWidth+I)){this._saveInitialAttribute(S,v);var aa=window.getComputedStyle(S).getPropertyValue(v);S.style.setProperty(v,`${B(Number.parseFloat(aa))}px`)}})}_saveInitialAttribute(p,v){let B=p.style.getPropertyValue(v);B&&Lb.setDataAttribute(p,v,B)}_resetElementAttributes(p,v){this._applyManipulationCallback(p,B=>{let I=Lb.getDataAttribute(B,v);null!==I?(Lb.removeDataAttribute(B,
v),B.style.setProperty(v,I)):B.style.removeProperty(v)})}_applyManipulationCallback(p,v){if(sb(p))v(p);else for(let B of Da.find(p,this._element))v(B)}constructor(){this._element=document.body}}let ah={backdrop:!0,focus:!0,keyboard:!0},bh={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Xc extends Rb{static get Default(){return ah}static get DefaultType(){return bh}static get NAME(){return"modal"}toggle(p){return this._isShown?this.hide():this.show(p)}show(p){this._isShown||
this._isTransitioning||ha.trigger(this._element,"show.bs.modal",{relatedTarget:p}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add("modal-open"),this._adjustDialog(),this._backdrop.show(()=>this._showElement(p)))}hide(){this._isShown&&!this._isTransitioning&&(ha.trigger(this._element,"hide.bs.modal").defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove("show"),this._queueCallback(()=>
this._hideModal(),this._element,this._isAnimated())))}dispose(){ha.off(window,".bs.modal");ha.off(this._dialog,".bs.modal");this._backdrop.dispose();this._focustrap.deactivate();super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new If({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Jf({trapElement:this._element})}_showElement(p){document.body.contains(this._element)||document.body.append(this._element);this._element.style.display=
"block";this._element.removeAttribute("aria-hidden");this._element.setAttribute("aria-modal",!0);this._element.setAttribute("role","dialog");this._element.scrollTop=0;let v=Da.findOne(".modal-body",this._dialog);v&&(v.scrollTop=0);this._element.offsetHeight;this._element.classList.add("show");this._queueCallback(()=>{this._config.focus&&this._focustrap.activate();this._isTransitioning=!1;ha.trigger(this._element,"shown.bs.modal",{relatedTarget:p})},this._dialog,this._isAnimated())}_addEventListeners(){ha.on(this._element,
"keydown.dismiss.bs.modal",p=>{"Escape"===p.key&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())});ha.on(window,"resize.bs.modal",()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()});ha.on(this._element,"mousedown.dismiss.bs.modal",p=>{ha.one(this._element,"click.dismiss.bs.modal",v=>{this._element===p.target&&this._element===v.target&&("static"!==this._config.backdrop?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display=
"none";this._element.setAttribute("aria-hidden",!0);this._element.removeAttribute("aria-modal");this._element.removeAttribute("role");this._isTransitioning=!1;this._backdrop.hide(()=>{document.body.classList.remove("modal-open");this._resetAdjustments();this._scrollBar.reset();ha.trigger(this._element,"hidden.bs.modal")})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(!ha.trigger(this._element,"hidePrevented.bs.modal").defaultPrevented){var p=this._element.scrollHeight>
document.documentElement.clientHeight,v=this._element.style.overflowY;"hidden"===v||this._element.classList.contains("modal-static")||(p||(this._element.style.overflowY="hidden"),this._element.classList.add("modal-static"),this._queueCallback(()=>{this._element.classList.remove("modal-static");this._queueCallback(()=>{this._element.style.overflowY=v},this._dialog)},this._dialog),this._element.focus())}}_adjustDialog(){let p=this._element.scrollHeight>document.documentElement.clientHeight,v=this._scrollBar.getWidth(),
B=0<v;B&&!p&&(this._element.style["rtl"===document.documentElement.dir?"paddingLeft":"paddingRight"]=`${v}px`);!B&&p&&(this._element.style["rtl"===document.documentElement.dir?"paddingRight":"paddingLeft"]=`${v}px`)}_resetAdjustments(){this._element.style.paddingLeft="";this._element.style.paddingRight=""}static jQueryInterface(p,v){return this.each(function(){let B=Xc.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===B[p])throw TypeError(`No method named "${p}"`);B[p](v)}})}constructor(p,
v){super(p,v);this._dialog=Da.findOne(".modal-dialog",this._element);this._backdrop=this._initializeBackDrop();this._focustrap=this._initializeFocusTrap();this._isTransitioning=this._isShown=!1;this._scrollBar=new se;this._addEventListeners()}}ha.on(document,"click.bs.modal.data-api",'[data-bs-toggle="modal"]',function(p){let v=Da.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&p.preventDefault();ha.one(v,"show.bs.modal",B=>{B.defaultPrevented||ha.one(v,"hidden.bs.modal",()=>{jb(this)&&
this.focus()})});(p=Da.findOne(".modal.show"))&&Xc.getInstance(p).hide();Xc.getOrCreateInstance(v).toggle(this)});Qb(Xc);Wa(Xc);let ch={backdrop:!0,keyboard:!0,scroll:!1},dh={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Fc extends Rb{static get Default(){return ch}static get DefaultType(){return dh}static get NAME(){return"offcanvas"}toggle(p){return this._isShown?this.hide():this.show(p)}show(p){this._isShown||ha.trigger(this._element,"show.bs.offcanvas",{relatedTarget:p}).defaultPrevented||
(this._isShown=!0,this._backdrop.show(),this._config.scroll||(new se).hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add("showing"),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate();this._element.classList.add("show");this._element.classList.remove("showing");ha.trigger(this._element,"shown.bs.offcanvas",{relatedTarget:p})},this._element,!0))}hide(){this._isShown&&(ha.trigger(this._element,
"hide.bs.offcanvas").defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add("hiding"),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove("show","hiding");this._element.removeAttribute("aria-modal");this._element.removeAttribute("role");this._config.scroll||(new se).reset();ha.trigger(this._element,"hidden.bs.offcanvas")},this._element,!0)))}dispose(){this._backdrop.dispose();this._focustrap.deactivate();super.dispose()}_initializeBackDrop(){let p=
!!this._config.backdrop;return new If({className:"offcanvas-backdrop",isVisible:p,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:p?()=>{"static"!==this._config.backdrop?this.hide():ha.trigger(this._element,"hidePrevented.bs.offcanvas")}:null})}_initializeFocusTrap(){return new Jf({trapElement:this._element})}_addEventListeners(){ha.on(this._element,"keydown.dismiss.bs.offcanvas",p=>{"Escape"===p.key&&(this._config.keyboard?this.hide():ha.trigger(this._element,"hidePrevented.bs.offcanvas"))})}static jQueryInterface(p){return this.each(function(){let v=
Fc.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===v[p]||p.startsWith("_")||"constructor"===p)throw TypeError(`No method named "${p}"`);v[p](this)}})}constructor(p,v){super(p,v);this._isShown=!1;this._backdrop=this._initializeBackDrop();this._focustrap=this._initializeFocusTrap();this._addEventListeners()}}ha.on(document,"click.bs.offcanvas.data-api",'[data-bs-toggle="offcanvas"]',function(p){let v=Da.getElementFromSelector(this);(["A","AREA"].includes(this.tagName)&&p.preventDefault(),
wb(this))||(ha.one(v,"hidden.bs.offcanvas",()=>{jb(this)&&this.focus()}),(p=Da.findOne(".offcanvas.show"))&&p!==v&&Fc.getInstance(p).hide(),Fc.getOrCreateInstance(v).toggle(this))});ha.on(window,"load.bs.offcanvas.data-api",()=>{for(let p of Da.find(".offcanvas.show"))Fc.getOrCreateInstance(p).show()});ha.on(window,"resize.bs.offcanvas",()=>{for(let p of Da.find("[aria-modal][class*=show][class*=offcanvas-]"))"fixed"!==getComputedStyle(p).position&&Fc.getOrCreateInstance(p).hide()});Qb(Fc);Wa(Fc);
let Kf={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:"src srcset alt title width height".split(" "),li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},eh=new Set("background cite href itemtype longdesc poster src xlink:href".split(" ")),fh=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,gh=(p,v)=>{let B=
p.nodeName.toLowerCase();return v.includes(B)?!eh.has(B)||!!fh.test(p.nodeValue):v.filter(I=>I instanceof RegExp).some(I=>I.test(B))},hh={allowList:Kf,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},ih={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},jh={entry:"(string|element|function|null)",selector:"(string|element)"};class kh extends dc{static get Default(){return hh}static get DefaultType(){return ih}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(p=>
this._resolvePossibleFunction(p)).filter(Boolean)}hasContent(){return 0<this.getContent().length}changeContent(p){return this._checkContent(p),this._config.content={...this._config.content,...p},this}toHtml(){var p=document.createElement("div");for(let [B,I]of(p.innerHTML=this._maybeSanitize(this._config.template),Object.entries(this._config.content)))this._setContent(p,I,B);p=p.children[0];let v=this._resolvePossibleFunction(this._config.extraClass);return v&&p.classList.add(...v.split(" ")),p}_typeCheckConfig(p){super._typeCheckConfig(p);
this._checkContent(p.content)}_checkContent(p){for(let [v,B]of Object.entries(p))super._typeCheckConfig({selector:v,entry:B},jh)}_setContent(p,v,B){(p=Da.findOne(B,p))&&((v=this._resolvePossibleFunction(v))?sb(v)?this._putElementInTemplate(Gb(v),p):this._config.html?p.innerHTML=this._maybeSanitize(v):p.textContent=v:p.remove())}_maybeSanitize(p){if(this._config.sanitize){var v=this._config.allowList;var B=this._config.sanitizeFn;if(p.length)if(B&&"function"==typeof B)v=B(p);else{p=(new window.DOMParser).parseFromString(p,
"text/html");for(let S of[].concat(...p.body.querySelectorAll("*"))){var I=S.nodeName.toLowerCase();if(Object.keys(v).includes(I)){B=[].concat(...S.attributes);I=[].concat(v["*"]||[],v[I]||[]);for(let aa of B)gh(aa,I)||S.removeAttribute(aa.nodeName)}else S.remove()}v=p.body.innerHTML}else v=p}else v=p;return v}_resolvePossibleFunction(p){return Bb(p,[void 0,this])}_putElementInTemplate(p,v){if(this._config.html)return v.innerHTML="",void v.append(p);v.textContent=p.textContent}constructor(p){super();
this._config=this._getConfig(p)}}let lh=new Set(["sanitize","allowList","sanitizeFn"]),mh={AUTO:"auto",TOP:"top",RIGHT:"rtl"===document.documentElement.dir?"left":"right",BOTTOM:"bottom",LEFT:"rtl"===document.documentElement.dir?"right":"left"},nh={allowList:Kf,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',
title:"",trigger:"hover focus"},oh={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Yc extends Rb{static get Default(){return nh}static get DefaultType(){return oh}static get NAME(){return"tooltip"}enable(){this._isEnabled=
!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout);ha.off(this._element.closest(".modal"),"hide.bs.modal",this._hideModalHandler);this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title"));this._disposePopper();super.dispose()}show(){if("none"===this._element.style.display)throw Error("Please use show on visible elements");
if(this._isWithContent()&&this._isEnabled){var p=ha.trigger(this._element,this.constructor.eventName("show")),v=(Qa(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(!p.defaultPrevented&&v){this._disposePopper();p=this._getTipElement();this._element.setAttribute("aria-describedby",p.getAttribute("id"));({container:v}=this._config);if(this._element.ownerDocument.documentElement.contains(this.tip)||(v.append(p),ha.trigger(this._element,this.constructor.eventName("inserted"))),
this._popper=this._createPopper(p),p.classList.add("show"),"ontouchstart"in document.documentElement)for(let B of[].concat(...document.body.children))ha.on(B,"mouseover",Ob);this._queueCallback(()=>{ha.trigger(this._element,this.constructor.eventName("shown"));!1===this._isHovered&&this._leave();this._isHovered=!1},this.tip,this._isAnimated())}}}hide(){if(this._isShown()&&!ha.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove("show"),
"ontouchstart"in document.documentElement)for(let p of[].concat(...document.body.children))ha.off(p,"mouseover",Ob);this._activeTrigger.click=!1;this._activeTrigger.focus=!1;this._activeTrigger.hover=!1;this._isHovered=null;this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),ha.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||
(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(p){p=this._getTemplateFactory(p).toHtml();if(!p)return null;p.classList.remove("fade","show");p.classList.add(`bs-${this.constructor.NAME}-auto`);var v=this.constructor.NAME;do v+=Math.floor(1E6*Math.random());while(document.getElementById(v));return p.setAttribute("id",v.toString()),this._isAnimated()&&p.classList.add("fade"),p}setContent(p){this._newContent=p;this._isShown()&&(this._disposePopper(),
this.show())}_getTemplateFactory(p){return this._templateFactory?this._templateFactory.changeContent(p):this._templateFactory=new kh({...this._config,content:p,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(p){return this.constructor.getOrCreateInstance(p.delegateTarget,
this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains("fade")}_isShown(){return this.tip&&this.tip.classList.contains("show")}_createPopper(p){let v=mh[Bb(this._config.placement,[this,p,this._element]).toUpperCase()];return re(this._element,p,this._getPopperConfig(v))}_getOffset(){let {offset:p}=this._config;return"string"==typeof p?p.split(",").map(v=>Number.parseInt(v,10)):"function"==typeof p?v=>p(v,this._element):p}_resolvePossibleFunction(p){return Bb(p,
[this._element,this._element])}_getPopperConfig(p){p={placement:p,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:v=>{this._getTipElement().setAttribute("data-popper-placement",v.state.placement)}}]};return{...p,...Bb(this._config.popperConfig,
[void 0,p])}}_setListeners(){for(let p of this._config.trigger.split(" "))if("click"===p)ha.on(this._element,this.constructor.eventName("click"),this._config.selector,v=>{v=this._initializeOnDelegatedTarget(v);v._activeTrigger.click=!(v._isShown()&&v._activeTrigger.click);v.toggle()});else if("manual"!==p){let v="hover"===p?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),B="hover"===p?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");ha.on(this._element,
v,this._config.selector,I=>{let S=this._initializeOnDelegatedTarget(I);S._activeTrigger["focusin"===I.type?"focus":"hover"]=!0;S._enter()});ha.on(this._element,B,this._config.selector,I=>{let S=this._initializeOnDelegatedTarget(I);S._activeTrigger["focusout"===I.type?"focus":"hover"]=S._element.contains(I.relatedTarget);S._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()};ha.on(this._element.closest(".modal"),"hide.bs.modal",this._hideModalHandler)}_fixTitle(){let p=this._element.getAttribute("title");
p&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",p),this._element.setAttribute("data-bs-original-title",p),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(p,
v){clearTimeout(this._timeout);this._timeout=setTimeout(p,v)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(p){let v=Lb.getDataAttributes(this._element);for(let B of Object.keys(v))lh.has(B)&&delete v[B];return p={...v,...("object"==typeof p&&p?p:{})},p=this._mergeConfigObj(p),p=this._configAfterMerge(p),this._typeCheckConfig(p),p}_configAfterMerge(p){return p.container=!1===p.container?document.body:Gb(p.container),"number"==typeof p.delay&&(p.delay={show:p.delay,
hide:p.delay}),"number"==typeof p.title&&(p.title=p.title.toString()),"number"==typeof p.content&&(p.content=p.content.toString()),p}_getDelegateConfig(){let p={};for(let [v,B]of Object.entries(this._config))this.constructor.Default[v]!==B&&(p[v]=B);return p.selector=!1,p.trigger="manual",p}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null);this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(p){return this.each(function(){let v=Yc.getOrCreateInstance(this,p);
if("string"==typeof p){if(void 0===v[p])throw TypeError(`No method named "${p}"`);v[p]()}})}constructor(p,v){if(void 0===Hf)throw TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(p,v);this._isEnabled=!0;this._timeout=0;this._isHovered=null;this._activeTrigger={};this.tip=this._newContent=this._templateFactory=this._popper=null;this._setListeners();this._config.selector||this._fixTitle()}}Wa(Yc);let ph={...Yc.Default,content:"",offset:[0,8],placement:"right",
template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},qh={...Yc.DefaultType,content:"(null|string|element|function)"};class te extends Yc{static get Default(){return ph}static get DefaultType(){return qh}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(p){return this.each(function(){let v=
te.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===v[p])throw TypeError(`No method named "${p}"`);v[p]()}})}}Wa(te);let rh={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},sh={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Md extends Rb{static get Default(){return rh}static get DefaultType(){return sh}static get NAME(){return"scrollspy"}refresh(){for(let p of(this._initializeTargetsAndObservables(),
this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver(),this._observableSections.values()))this._observer.observe(p)}dispose(){this._observer.disconnect();super.dispose()}_configAfterMerge(p){return p.target=Gb(p.target)||document.body,p.rootMargin=p.offset?`${p.offset}px 0px -30%`:p.rootMargin,"string"==typeof p.threshold&&(p.threshold=p.threshold.split(",").map(v=>Number.parseFloat(v))),p}_maybeEnableSmoothScroll(){this._config.smoothScroll&&
(ha.off(this._config.target,"click.bs.scrollspy"),ha.on(this._config.target,"click.bs.scrollspy","[href]",p=>{var v=this._observableSections.get(p.target.hash);if(v){p.preventDefault();p=this._rootElement||window;v=v.offsetTop-this._element.offsetTop;if(p.scrollTo)return void p.scrollTo({top:v,behavior:"smooth"});p.scrollTop=v}}))}_getNewObserver(){return new IntersectionObserver(p=>this._observerCallback(p),{root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin})}_observerCallback(p){let v=
aa=>this._targetLinks.get(`#${aa.target.id}`),B=aa=>{this._previousScrollData.visibleEntryTop=aa.target.offsetTop;this._process(v(aa))},I=(this._rootElement||document.documentElement).scrollTop,S=I>=this._previousScrollData.parentScrollTop;for(let aa of(this._previousScrollData.parentScrollTop=I,p))if(aa.isIntersecting)if(p=aa.target.offsetTop>=this._previousScrollData.visibleEntryTop,S&&p){if(B(aa),!I)break}else S||p||B(aa);else this._activeTarget=null,this._clearActiveClass(v(aa))}_initializeTargetsAndObservables(){for(let p of(this._targetLinks=
new Map,this._observableSections=new Map,Da.find("[href]",this._config.target))){if(!p.hash||wb(p))continue;let v=Da.findOne(decodeURI(p.hash),this._element);jb(v)&&(this._targetLinks.set(decodeURI(p.hash),p),this._observableSections.set(p.hash,v))}}_process(p){this._activeTarget!==p&&(this._clearActiveClass(this._config.target),this._activeTarget=p,p.classList.add("active"),this._activateParents(p),ha.trigger(this._element,"activate.bs.scrollspy",{relatedTarget:p}))}_activateParents(p){if(p.classList.contains("dropdown-item"))Da.findOne(".dropdown-toggle",
p.closest(".dropdown")).classList.add("active");else for(let v of Da.parents(p,".nav, .list-group"))for(let B of Da.prev(v,".nav-link, .nav-item > .nav-link, .list-group-item"))B.classList.add("active")}_clearActiveClass(p){for(let v of(p.classList.remove("active"),Da.find("[href].active",p)))v.classList.remove("active")}static jQueryInterface(p){return this.each(function(){let v=Md.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===v[p]||p.startsWith("_")||"constructor"===p)throw TypeError(`No method named "${p}"`);
v[p]()}})}constructor(p,v){super(p,v);this._targetLinks=new Map;this._observableSections=new Map;this._rootElement="visible"===getComputedStyle(this._element).overflowY?null:this._element;this._observer=this._activeTarget=null;this._previousScrollData={visibleEntryTop:0,parentScrollTop:0};this.refresh()}}ha.on(window,"load.bs.scrollspy.data-api",()=>{for(let p of Da.find('[data-bs-spy="scroll"]'))Md.getOrCreateInstance(p)});Wa(Md);class Zc extends Rb{static get NAME(){return"tab"}show(){let p=this._element;
if(!this._elemIsActive(p)){var v=this._getActiveElem(),B=v?ha.trigger(v,"hide.bs.tab",{relatedTarget:p}):null;ha.trigger(p,"show.bs.tab",{relatedTarget:v}).defaultPrevented||B&&B.defaultPrevented||(this._deactivate(v,p),this._activate(p,v))}}_activate(p,v){p&&(p.classList.add("active"),this._activate(Da.getElementFromSelector(p)),this._queueCallback(()=>{"tab"===p.getAttribute("role")?(p.removeAttribute("tabindex"),p.setAttribute("aria-selected",!0),this._toggleDropDown(p,!0),ha.trigger(p,"shown.bs.tab",
{relatedTarget:v})):p.classList.add("show")},p,p.classList.contains("fade")))}_deactivate(p,v){p&&(p.classList.remove("active"),p.blur(),this._deactivate(Da.getElementFromSelector(p)),this._queueCallback(()=>{"tab"===p.getAttribute("role")?(p.setAttribute("aria-selected",!1),p.setAttribute("tabindex","-1"),this._toggleDropDown(p,!1),ha.trigger(p,"hidden.bs.tab",{relatedTarget:v})):p.classList.remove("show")},p,p.classList.contains("fade")))}_keydown(p){if("ArrowLeft ArrowRight ArrowUp ArrowDown Home End".split(" ").includes(p.key)){p.stopPropagation();
p.preventDefault();var v=this._getChildren().filter(B=>!wb(B));if(["Home","End"].includes(p.key))p=v["Home"===p.key?0:v.length-1];else{let B=["ArrowRight","ArrowDown"].includes(p.key);p=ec(v,p.target,B,!0)}p&&(p.focus({preventScroll:!0}),Zc.getOrCreateInstance(p).show())}}_getChildren(){return Da.find('.nav-link:not(.dropdown-toggle), .list-group-item:not(.dropdown-toggle), [role="tab"]:not(.dropdown-toggle), [data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',this._parent)}_getActiveElem(){return this._getChildren().find(p=>
this._elemIsActive(p))||null}_setInitialAttributes(p,v){for(let B of(this._setAttributeIfNotExists(p,"role","tablist"),v))this._setInitialAttributesOnChild(B)}_setInitialAttributesOnChild(p){p=this._getInnerElement(p);let v=this._elemIsActive(p),B=this._getOuterElement(p);p.setAttribute("aria-selected",v);B!==p&&this._setAttributeIfNotExists(B,"role","presentation");v||p.setAttribute("tabindex","-1");this._setAttributeIfNotExists(p,"role","tab");this._setInitialAttributesOnTargetPanel(p)}_setInitialAttributesOnTargetPanel(p){let v=
Da.getElementFromSelector(p);v&&(this._setAttributeIfNotExists(v,"role","tabpanel"),p.id&&this._setAttributeIfNotExists(v,"aria-labelledby",`${p.id}`))}_toggleDropDown(p,v){p=this._getOuterElement(p);if(p.classList.contains("dropdown")){var B=Da.findOne(".dropdown-toggle",p);B&&B.classList.toggle("active",v);(B=Da.findOne(".dropdown-menu",p))&&B.classList.toggle("show",v);p.setAttribute("aria-expanded",v)}}_setAttributeIfNotExists(p,v,B){p.hasAttribute(v)||p.setAttribute(v,B)}_elemIsActive(p){return p.classList.contains("active")}_getInnerElement(p){return p.matches('.nav-link:not(.dropdown-toggle), .list-group-item:not(.dropdown-toggle), [role="tab"]:not(.dropdown-toggle), [data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]')?
p:Da.findOne('.nav-link:not(.dropdown-toggle), .list-group-item:not(.dropdown-toggle), [role="tab"]:not(.dropdown-toggle), [data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',p)}_getOuterElement(p){return p.closest(".nav-item, .list-group-item")||p}static jQueryInterface(p){return this.each(function(){let v=Zc.getOrCreateInstance(this);if("string"==typeof p){if(void 0===v[p]||p.startsWith("_")||"constructor"===p)throw TypeError(`No method named "${p}"`);v[p]()}})}constructor(p){super(p);
(this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'))&&(this._setInitialAttributes(this._parent,this._getChildren()),ha.on(this._element,"keydown.bs.tab",v=>this._keydown(v)))}}ha.on(document,"click.bs.tab",'[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',function(p){["A","AREA"].includes(this.tagName)&&p.preventDefault();wb(this)||Zc.getOrCreateInstance(this).show()});ha.on(window,"load.bs.tab",()=>{for(let p of Da.find('.active[data-bs-toggle="tab"], .active[data-bs-toggle="pill"], .active[data-bs-toggle="list"]'))Zc.getOrCreateInstance(p)});
Wa(Zc);let th={animation:"boolean",autohide:"boolean",delay:"number"},uh={animation:!0,autohide:!0,delay:5E3};class Nd extends Rb{static get Default(){return uh}static get DefaultType(){return th}static get NAME(){return"toast"}show(){ha.trigger(this._element,"show.bs.toast").defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove("hide"),this._element.offsetHeight,this._element.classList.add("show","showing"),this._queueCallback(()=>
{this._element.classList.remove("showing");ha.trigger(this._element,"shown.bs.toast");this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(ha.trigger(this._element,"hide.bs.toast").defaultPrevented||(this._element.classList.add("showing"),this._queueCallback(()=>{this._element.classList.add("hide");this._element.classList.remove("showing","show");ha.trigger(this._element,"hidden.bs.toast")},this._element,this._config.animation)))}dispose(){this._clearTimeout();
this.isShown()&&this._element.classList.remove("show");super.dispose()}isShown(){return this._element.classList.contains("show")}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(p,v){switch(p.type){case "mouseover":case "mouseout":this._hasMouseInteraction=v;break;case "focusin":case "focusout":this._hasKeyboardInteraction=v}if(v)return void this._clearTimeout();p=
p.relatedTarget;this._element===p||this._element.contains(p)||this._maybeScheduleHide()}_setListeners(){ha.on(this._element,"mouseover.bs.toast",p=>this._onInteraction(p,!0));ha.on(this._element,"mouseout.bs.toast",p=>this._onInteraction(p,!1));ha.on(this._element,"focusin.bs.toast",p=>this._onInteraction(p,!0));ha.on(this._element,"focusout.bs.toast",p=>this._onInteraction(p,!1))}_clearTimeout(){clearTimeout(this._timeout);this._timeout=null}static jQueryInterface(p){return this.each(function(){let v=
Nd.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===v[p])throw TypeError(`No method named "${p}"`);v[p](this)}})}constructor(p,v){super(p,v);this._timeout=null;this._hasKeyboardInteraction=this._hasMouseInteraction=!1;this._setListeners()}}return Qb(Nd),Wa(Nd),{Alert:hc,Button:x,Carousel:Ba,Collapse:gc,Dropdown:oc,Modal:Xc,Offcanvas:Fc,Popover:te,ScrollSpy:Md,Tab:Zc,Toast:Nd,Tooltip:Yc}}();var Na={};for(let a of(!function(c){function d(D,A){for(var F=D.length;F--;)if(D[F]===A)return F;
return-1}function b(D,A,F){var J=n(D);void 0===F&&(F=A,A="all");for(var N=0;N<J.length;N++){var L=[];1<(D=J[N].split("+")).length&&(L=g(D),D=[D[D.length-1]]);(D=t(D=D[0]))in l||(l[D]=[]);l[D].push({shortcut:J[N],scope:A,method:F,key:J[N],mods:L})}}function k(){return m||"all"}function n(D){var A;return""==(A=D.replace(/\s/g,"").split(","))[A.length-1]&&(A[A.length-2]+=","),A}function g(D){D=D.slice(0,D.length-1);for(var A=0;A<D.length;A++)D[A]=q[D[A]];return D}function e(D,A,F){D.addEventListener&&
D.addEventListener(A,F,!1)}var h,l={},f={16:!1,18:!1,17:!1,91:!1},m="all",q={"\u21e7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,command:91},r={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},t=function(D){D=r[D]||D.toUpperCase().charCodeAt(0);return"function"==
typeof D?D():D},u=[];for(h=1;20>h;h++)r["f"+h]=111+h;var w={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(h in q)b[h]=!1;e(document,"keydown",function(D){!function(A){var F,J,N,L,M;if(-1==d(u,F=We(A.key))&&u.push(F),F in f)for(N in f[F]=!0,q)q[N]==F&&(b[N]=!0);else{for(h in f)f[h]=A[w[h]];if(b.filter.call(this,A)&&F in l){var X=0;for(M=k();X<l[F].length;X++)if((J=l[F][X]).scope==M||"all"==J.scope){for(N in L=0<J.mods.length,f)(!f[N]&&-1<d(J.mods,+N)||f[N]&&-1==d(J.mods,+N))&&(L=!1);(0!=
J.mods.length||f[16]||f[18]||f[17]||f[91])&&!L||!1!==J.method(A,J)||(A.preventDefault?A.preventDefault():A.returnValue=!1,A.stopPropagation&&A.stopPropagation(),A.cancelBubble&&(A.cancelBubble=!0))}}}}(D)});e(document,"keyup",function(D){var A;D=We(D.key);var F=d(u,D);if(0<=F&&u.splice(F,1),D in f)for(A in f[D]=!1,q)q[A]==D&&(b[A]=!1)});e(window,"focus",function(){for(h in f)f[h]=!1;for(h in q)b[h]=!1});var C=c.key;c.key=b;c.key.setScope=function(D){m=D||"all"};c.key.getScope=k;c.key.deleteScope=
function(D){var A,F;for(A in l){var J=0;for(F=l[A];J<F.length;)F[J].scope===D?F.splice(J,1):J++}};c.key.filter=function(D){D=(D.target||D.srcElement).tagName;return"INPUT"!=D&&"SELECT"!=D&&"TEXTAREA"!=D};c.key.isPressed=function(D){return"string"==typeof D&&(D=t(D)),-1!=d(u,D)};c.key.getPressedKeyCodes=function(){return u.slice(0)};c.key.noConflict=function(){var D=c.key;return c.key=C,D};c.key.unbind=function(D,A){var F,J,N,L,M=[];var X=0;for(F=n(D);X<F.length&&(1<(J=F[X].split("+")).length&&(M=
g(J)),D=t(D=J[J.length-1]),void 0===A&&(A=k()),l[D]);X++)for(N=0;N<l[D].length;N++){var fa;if(fa=(L=l[D][N]).scope===A)a:if(L=L.mods,L.length!=M.length)fa=!1;else{for(fa=0;fa<L.length;fa++)if(L[fa]!==M[fa]){fa=!1;break a}fa=!0}fa&&(l[D][N]={})}};Na=b}(Na||{}),Lc.prototype.clone=function(){for(var c=new Lc(Array(this.points.length)),d=0;d<this.points.length;d++)c.points[d]={x:this.points[d].x,y:this.points[d].y};return c},Lc.prototype.getTransformed=function(c){for(var d=new Lc(Array(this.points.length)),
b=0;b<this.points.length;b++)d.points[b]=c.getTransformedPoint(this.points[b]);return d},Lc.prototype.getCenter=function(){for(var c=this.points[0].x,d=this.points[0].y,b=1;b<this.points.length;b++)c+=this.points[b].x,d+=this.points[b].y;return{x:c/this.points.length,y:d/this.points.length}},Lc.prototype.containsPoint=function(c){var d,b=!1;var k=0;for(d=this.points.length-1;k<this.points.length;d=k++)this.points[k].y>c.y!=this.points[d].y>c.y&&c.x<(this.points[d].x-this.points[k].x)*(c.y-this.points[k].y)/
(this.points[d].y-this.points[k].y)+this.points[k].x&&(b=!b);return b},qb.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},qb.prototype.normalize=function(){var c=this.getLength();return this.x/=c,this.y/=c,this},qb.prototype.getDotProduct=function(c){return this.x*c.x+this.y*c.y},qb.prototype.scale=function(c){return this.x*=c,this.y*=c,this},qb.prototype.getScaled=function(c){var d=new qb(this.x,this.y);return d.scale(c),d},qb.prototype.getRounded=function(){return new qb(Math.round(this.x),
Math.round(this.y))},qb.prototype.getTruncated=function(){return new qb(~~this.x,~~this.y)},qb.prototype.getPerpendicular=function(){return new qb(-this.y,this.x)},qb.prototype.add=function(c){return this.x+=c.x,this.y+=c.y,this},qb.prototype.subtract=function(c){return this.x-=c.x,this.y-=c.y,this},qb.prototype.getSum=function(c){return new qb(this.x+c.x,this.y+c.y)},qb.subtractPoints=function(c,d){return new qb(c.x-d.x,c.y-d.y)},id.prototype=Object.create(wa(Db).prototype),id.prototype.constructor=
id,Nb.MODE_INDEX_DEFAULT=0,Nb.MODE_INDEX_USER=1,Nb.prototype.setMode=function(c,d){var b=this.modes[c];b!=d&&(b&&b.leave(),this.modes[c]=d,d.enter())},Nb.prototype.setDefaultMode=function(c){c.transient=!1;c.capture=!1;this.setMode(Nb.MODE_INDEX_DEFAULT,c)},Nb.prototype.setUserMode=function(c){for(var d=this.modes.length-1;d>Nb.MODE_INDEX_USER;d--)this.modes[d].leave(),this.modes.splice(d,1);c.transient=!1;c.capture=!1;this.setMode(Nb.MODE_INDEX_USER,c)},Nb.prototype.deliverEvent=function(c,d){for(var b=
this.modes.length-1;0<=b;b--){var k=this.modes[b];if(k[c].apply(k,d)||k.capture&&"paint"!=c)return!0}return!1},["mouseDown","mouseUp"]))Nb.prototype[a]=function(c,d,b){this.deliverEvent(a,[c,d,b])};for(let a of["mouseDrag","mouseMove"])Nb.prototype[a]=function(c,d){this.deliverEvent(a,[c,d])};for(let a of["keyDown","keyUp"])Nb.prototype[a]=function(c){this.deliverEvent(a,[c])&&c.preventDefault()};Nb.prototype.paint=function(a){this.deliverEvent("paint",[a])};Nb.prototype.push=function(a,c){var d=
this.peek();d&&d.suspend();a.transient=c;a.capture=!1;a.enter();this.modes.push(a)};Nb.prototype.peek=function(){return 0<this.modes.length?this.modes[this.modes.length-1]:null};Nb.prototype.pop=function(){var a=this.modes.pop(),c=this.peek();return a&&a.leave(),c&&c.resume(),c};zd.prototype=Object.create(wa(Db).prototype);zd.prototype.constructor=zd;Ib.prototype=Object.create(wa(Db).prototype);Ib.prototype.constructor=wa(Db);Ad.prototype=Object.create(Ib.prototype);Ad.prototype.constructor=Ad;Bd.prototype=
Object.create(Ib.prototype);Bd.prototype.constructor=Bd;Cd.prototype=Object.create(Ib.prototype);Cd.prototype.constructor=Cd;let Od=window.devicePixelRatio||1,Nc=Math.round(128*Od),Oc=Math.round(128*Od);class $e{_makeBitmap(){if(this._bitmapInvalid){var a=0,c=this._imageData.data;if(this._greyscale)for(var d=0;d<Oc;d++){var b=255-Math.round(d/(Oc-1)*255);for(var k=0;k<Nc;k++)c[a+z.RED_BYTE_OFFSET]=b,c[a+z.GREEN_BYTE_OFFSET]=b,c[a+z.BLUE_BYTE_OFFSET]=b,c[a+z.ALPHA_BYTE_OFFSET]=255,a+=z.BYTES_PER_PIXEL}else for(d=
this.color.clone(),b=0;b<Oc;b++)for(d.setValue(255-~~(b/(Oc-1)*255)),k=0;k<Nc;k++)d.setSaturation(Math.round(k/(Nc-1)*255)),c[a+z.RED_BYTE_OFFSET]=d.rgb>>16&255,c[a+z.GREEN_BYTE_OFFSET]=d.rgb>>8&255,c[a+z.BLUE_BYTE_OFFSET]=255&d.rgb,c[a+z.ALPHA_BYTE_OFFSET]=255,a+=z.BYTES_PER_PIXEL;this._bitmapInvalid=!1}}paint(){this._makeBitmap();this._canvasContext.putImageData(this._imageData,0,0);let a=this.color.getSaturation()/255*(Nc-1),c=(255-this.color.getValue())/255*(Oc-1);yd(this._canvasContext,"stroke");
this._canvasContext.lineWidth=1.5*Od;this._canvasContext.beginPath();this._greyscale?(this._canvasContext.moveTo(0,c),this._canvasContext.lineTo(Nc,c)):this._canvasContext.arc(a,c,5*Od,0,2*Math.PI);this._canvasContext.stroke();this._canvasContext.globalCompositeOperation="source-over"}_mousePickColor(a){let c=this._canvas.getBoundingClientRect();var d=a.pageX-window.scrollX-c.left;a=Math.max(Math.min(255-~~(255*(a.pageY-window.scrollY-c.top)/127),255),0);this._greyscale?this.color.setGreyscale(a):
(d=Math.max(Math.min(~~(255*d/127),255),0),this.color.setHsv(this.color.getHue(),d,a));this.paint();this._controller.setCurColor(this.color)}_endDrag(a){this._canvas.releasePointerCapture(a.pointerId);this._capturedMouse=!1;this._canvas.removeEventListener("pointerup",this._handleEndDrag);this._canvas.removeEventListener("pointermove",this._handleMousePickColor)}_startDrag(a){this._capturedMouse||(this._capturedMouse=!0,this._canvas.setPointerCapture(a.pointerId),this._canvas.addEventListener("pointerup",
this._handleEndDrag),this._canvas.addEventListener("pointermove",this._handleMousePickColor));this._handleMousePickColor(a)}setHue(a){this.color.getHue()!=a&&(this.color.setHue(a),this._controller.setCurColor(this.color))}getElement(){return this._canvas}constructor(a,c){Wb(this,"_controller",void 0);Wb(this,"_canvas",void 0);Wb(this,"_canvasContext",void 0);Wb(this,"_imageData",void 0);Wb(this,"_bitmapInvalid",!0);Wb(this,"_capturedMouse",!1);Wb(this,"_greyscale",!1);Wb(this,"color",new fb(0));this._controller=
a;let d=document.createElement("canvas");this._canvas=d;d.className="chickenpaint-colorpicker-select";d.setAttribute("touch-action","none");d.width=Nc;d.height=Oc;d.style.width="128px";d.style.height="128px";this._canvasContext=d.getContext("2d");this._imageData=this._canvasContext.createImageData(Nc,Oc);this._canvasContext.getImageData(0,0,1,1);this._handleEndDrag=this._endDrag.bind(this);this._handleMousePickColor=this._mousePickColor.bind(this);d.addEventListener("pointerdown",b=>this._startDrag(b));
c&&this.color.copyFrom(c);a.on("colorChange",b=>{this.color.copyFrom(b);this._bitmapInvalid=!0;this.paint()});a.on("colorModeChange",b=>{this._greyscale="greyscale"==b;this._bitmapInvalid=!0;this.paint()});this.paint()}}class af{paint(){this._canvasContext.putImageData(this._imageData,0,0);let a=128*this.hue/360;yd(this._canvasContext,"stroke");this._canvasContext.lineWidth=1.5;this._canvasContext.beginPath();this._canvasContext.moveTo(0,a);this._canvasContext.lineTo(24,a);this._canvasContext.stroke();
this._canvasContext.globalCompositeOperation="source-over"}_mousePickColor(a){let c=this._canvas.getBoundingClientRect();this.hue=Math.max(0,Math.min(359,~~(360*(a.pageY-c.top)/128)));this.paint();this.selecter&&this.selecter.setHue(this.hue)}_endDrag(a){this._canvas.releasePointerCapture(a.pointerId);this._capturedMouse=!1;this._canvas.removeEventListener("pointerup",this._handleEndDrag);this._canvas.removeEventListener("pointermove",this._handleMousePickColor)}_startDrag(a){this._capturedMouse||
(this._capturedMouse=!0,this._canvas.setPointerCapture(a.pointerId),this._canvas.addEventListener("pointerup",this._handleEndDrag),this._canvas.addEventListener("pointermove",this._handleMousePickColor));this._handleMousePickColor(a)}getElement(){return this._canvas}setHue(a){this.hue=a;this.paint()}constructor(a,c,d){Wb(this,"hue",void 0);Wb(this,"selecter",void 0);Wb(this,"_canvas",void 0);Wb(this,"_canvasContext",void 0);Wb(this,"_imageData",void 0);Wb(this,"_capturedMouse",!1);this.selecter=c;
this.hue=d||0;let b=document.createElement("canvas");this._canvas=b;a.on("colorChange",k=>{this.setHue(k.getHue())});a.on("colorModeChange",k=>{b.style.display="greyscale"==k?"none":"block"});b.setAttribute("touch-action","none");b.addEventListener("pointerdown",k=>this._startDrag(k));b.width=24;b.height=128;b.className="chickenpaint-colorpicker-slider";this._canvasContext=b.getContext("2d");this._imageData=this._canvasContext.createImageData(24,128);this._canvasContext.getImageData(0,0,1,1);this._handleEndDrag=
this._endDrag.bind(this);this._handleMousePickColor=this._mousePickColor.bind(this);(function(k){let n=new fb(65535),g=0,e=k.data;for(let h=0;h<k.height;h++){n.setHue(359*h/k.height);for(let l=0;l<k.width;l++)e[g+z.RED_BYTE_OFFSET]=n.rgb>>16&255,e[g+z.GREEN_BYTE_OFFSET]=n.rgb>>8&255,e[g+z.BLUE_BYTE_OFFSET]=255&n.rgb,e[g+z.ALPHA_BYTE_OFFSET]=255,g+=z.BYTES_PER_PIXEL}})(this._imageData);this.paint()}}Dd.prototype=Object.create(Ib.prototype);Dd.prototype.constructor=Dd;Uc.prototype=Object.create(wa(Db).prototype);
Uc.prototype.constructor=Uc;Sb.prototype=Object.create(wa(Db).prototype);Sb.prototype.constructor=Sb;kd.prototype=Object.create(wa(Db).prototype);kd.prototype.constructor=kd;Vc.prototype=Object.create(Ib.prototype);Vc.prototype.constructor=Vc;Vc.CPBrushPreview=function(a){function c(){g.clearRect(0,0,n.width,n.height);g.beginPath();g.arc(n.width/2,n.height/2,k/2*window.devicePixelRatio,0,2*Math.PI);g.stroke()}function d(h){let l=n.getBoundingClientRect();var f=h.clientX-l.left-n.clientWidth/2;h=h.clientY-
l.top-n.clientHeight/2;f=Math.max(1,Math.min(200,Math.round(2*Math.sqrt(f*f+h*h))));c();a.setBrushSize(f)}function b(h){e&&(e=!1,document.removeEventListener("pointerup",b,{capture:!1}),document.removeEventListener("pointermove",d,{capture:!1}))}let k=16,n=document.createElement("canvas"),g=n.getContext("2d"),e=!1;n.addEventListener("pointerdown",function(h){e||(e=!0,document.addEventListener("pointerup",b,{passive:!0,capture:!1}),document.addEventListener("pointermove",d,{passive:!0,capture:!1}),
d(h))});this.getElement=function(){return n};a.on("toolChange",function(h,l){l.size!=k&&(k=l.size,c())});n.width=64;n.height=64;1<window.devicePixelRatio&&(n.style.width=n.width+"px",n.style.height=n.height+"px",n.width*=window.devicePixelRatio,n.height*=window.devicePixelRatio);n.className="chickenpaint-brush-preview";g.strokeStyle="black";g.lineWidth=+window.devicePixelRatio;c()};Ed.prototype=Object.create(Ib.prototype);Ed.prototype.constructor=Ed;Fd.prototype=Object.create(Ib.prototype);Fd.prototype.constructor=
Fd;Gd.prototype=Object.create(Ib.prototype);Gd.prototype.constructor=Gd;Hd.prototype=Object.create(wa(Db).prototype);Hd.prototype.constructor=Hd;let ff=[{name:"File",mnemonic:"F",children:[{name:"Save to my computer",action:"CPSave",mnemonic:"S",shortcut:"ctrl+s"},{name:"Save Oekaki",action:"CPSend",mnemonic:"S",shortcut:"ctrl+s"}]},{name:"Edit",mnemonic:"E",children:[{name:"Undo",action:"CPUndo",mnemonic:"U",shortcut:"ctrl+z"},{name:"Redo",action:"CPRedo",mnemonic:"R",shortcut:"ctrl+y"},{name:"Clear history",
action:"CPClearHistory",mnemonic:"H",title:Q("Removes all undo/redo information to regain memory")},{name:"-"},{name:"Cut",action:"CPCut",mnemonic:"T",shortcut:"ctrl+x"},{name:"Copy",action:"CPCopy",mnemonic:"C",shortcut:"ctrl+c"},{name:"Copy merged",action:"CPCopyMerged",mnemonic:"Y",shortcut:"shift+ctrl+c"},{name:"Paste",action:"CPPaste",mnemonic:"P",shortcut:"ctrl+v"},{name:"-"},{name:"Select all",action:"CPSelectAll",mnemonic:"A",shortcut:"ctrl+a"},{name:"Deselect",action:"CPDeselectAll",mnemonic:"D",
shortcut:"ctrl+d"},{name:"-"},{name:"Transform",action:"CPTransform",mnemonic:"T",shortcut:"ctrl+h"}]},{name:"Layers",mnemonic:"L",children:[{name:"Duplicate",action:"CPLayerDuplicate",mnemonic:"D",shortcut:"shift+ctrl+d"},{name:"-"},{name:"Merge down",action:"CPLayerMergeDown",mnemonic:"E",shortcut:"ctrl+e"},{name:"Merge group",action:"CPGroupMerge",mnemonic:"G",shortcut:"shift+ctrl+g"},{name:"Merge all layers",action:"CPLayerMergeAll",shortcut:"shift+ctrl+e",mnemonic:"A"},{name:"Add Merged Layer",
action:"CPAddMergedLayer",shortcut:"shift+alt+e"},{name:"-"},{hideIfNotAvailable:!0,name:"Add layer mask",action:"CPAddLayerMask"},{hideIfNotAvailable:!0,name:"Delete layer mask",action:"CPRemoveLayerMask",shortcut:"shift+m"},{hideIfNotAvailable:!0,name:"Apply layer mask",action:"CPApplyLayerMask",shortcut:"ctrl+m"},{name:"-"},{hideIfNotAvailable:!0,name:"Clip to the layer below",action:"CPCreateClippingMask"},{hideIfNotAvailable:!0,name:"Unclip from the layer below",action:"CPReleaseClippingMask"}]},
{name:"Effects",mnemonic:"E",children:[{name:"Clear",action:"CPClear",mnemonic:"D",shortcut:"del,backspace"},{name:"Fill",action:"CPFill",mnemonic:"F",shortcut:"ctrl+f"},{name:"Flip horizontal",action:"CPHFlip",mnemonic:"Q",shortcut:"q"},{name:"Flip vertical",action:"CPVFlip",mnemonic:"V"},{name:"Invert",action:"CPFXInvert",mnemonic:"I",shortcut:"ctrl+i",title:Q("Invert the image colors")},{name:"-"},{name:"Convert brightness to opacity",action:"CPBrightnessToOpacity",mnemonic:"B",title:Q("Convert brightness to opacity")},
{name:"-"},{name:"Box blur...",action:"CPFXBoxBlur",mnemonic:"B"},{name:"-"},{name:"Monochromatic noise",action:"CPMNoise",mnemonic:"M",title:Q("Fills the selection with noise")},{name:"Color noise",action:"CPCNoise",mnemonic:"C",title:Q("Fills the selection with colored noise")}]},{name:"View",mnemonic:"V",children:[{name:"Full-screen mode",action:"CPFullScreen",mnemonic:"F",checkbox:!0,checked:!1},{name:"-"},{name:"Zoom in",action:"CPZoomIn",mnemonic:"I",shortcut:"="},{name:"Zoom out",action:"CPZoomOut",
mnemonic:"O",shortcut:"-"},{name:"Zoom 100%",action:"CPZoom100",mnemonic:"1",shortcut:"ctrl+0"},{name:"-"},{name:"Flip View horizontal",action:"CPViewHFlip",mnemonic:"H",shortcut:"h"},{action:"CPLinearInterpolation",name:"-"},{name:"Smooth-out zoomed canvas",action:"CPLinearInterpolation",mnemonic:"L",title:Q("Linear interpolation is used to give a smoothed looked to the picture when zoomed in"),checkbox:!0,checked:!0},{name:"-"},{name:"Show grid",action:"CPToggleGrid",mnemonic:"G",shortcut:"ctrl+g",
checkbox:!0,checked:!1},{name:"Grid options...",action:"CPGridOptions",mnemonic:"D"}]},{name:"Palettes",mnemonic:"P",children:[{name:"Rearrange",action:"CPArrangePalettes",title:Q("Rearrange the palette windows")},{name:"Toggle palettes",action:"CPTogglePalettes",mnemonic:"P",shortcut:"tab",title:Q("Hides or shows all palettes")},{name:"-"},{name:"Show tools",action:"CPPalTool",mnemonic:"T",checkbox:!0,checked:!0},{name:"Show color",action:"CPPalColor",mnemonic:"C",checkbox:!0,checked:!0},{name:"Show stroke",
action:"CPPalStroke",mnemonic:"S",checkbox:!0,checked:!0},{name:"Show misc",action:"CPPalMisc",mnemonic:"M",checkbox:!0,checked:!0},{name:"Show swatches",action:"CPPalSwatches",mnemonic:"W",checkbox:!0,checked:!0},{name:"Show textures",action:"CPPalTextures",mnemonic:"X",checkbox:!0,checked:!0},{name:"Show tool options",action:"CPPalBrush",mnemonic:"B",checkbox:!0,checked:!0},{name:"Show layers",action:"CPPalLayers",mnemonic:"L",checkbox:!0,checked:!0}]},{name:"Help",mnemonic:"H",children:[{name:"Tablet support",
mnemonic:"T",action:"CPTabletSupport"},{name:"Shortcuts",mnemonic:"S",action:"CPShortcuts"},{name:"-"},{name:"About",mnemonic:"A",action:"CPAbout"}]}];Id.prototype=Object.create(wa(Db).prototype);Id.prototype.constructor=Id;Jd.prototype=Object.create(wa(Db).prototype);Jd.prototype.constructor=Jd;let Lf=navigator.userAgent.toLowerCase().includes("mac os"),gf=Lf?"\u2318":"Ctrl",qg=Lf?"\u2303":"Ctrl";Kd.prototype=Object.create(wa(Db).prototype);Kd.prototype.constructor=Kd;let tc={toolbarStyle:"new"};
class ug extends wa(Db){setDefaults(){for(let a in tc)tc.hasOwnProperty(a)&&this.set(a,tc[a])}load(){let a={};try{a=JSON.parse(localStorage.getItem("chickenpaint-prefs"))}catch(c){console.error(c)}for(let c in a&&"object"==typeof a||(a={}),tc)if(tc.hasOwnProperty(c))try{this.set(c,a.hasOwnProperty(c)?a[c]:tc[c])}catch(d){console.error(d)}}save(){try{let a=!1;for(let c in tc)if(tc.hasOwnProperty(c)&&this[c]!=tc[c]){a=!0;break}a?localStorage.setItem("chickenpaint-prefs",JSON.stringify({toolbarStyle:this.toolbarStyle})):
localStorage.removeItem("chickenpaint-prefs")}catch(a){console.error(a)}}set(a,c){this[a]=c;this.emitEvent(a,[c])}get(a){return this[a]}constructor(){super();Wb(this,"toolbarStyle",void 0);this.setDefaults()}}W.prototype=Object.create(wa(Db).prototype);W.prototype.constructor=W;W.UnsupportedBrowserException=function(a){this.message=a};W.UnsupportedBrowserException.prototype.toString=function(){let a="Sorry, your web browser does not support ChickenPaint.";return this.message?a+=" "+this.message:a+=
" Please try a modern browser like Chrome, Safari, Firefox, or Edge.",a};W.M_DRAW=0;W.M_FLOODFILL=1;W.M_RECT_SELECTION=2;W.M_MOVE_TOOL=3;W.M_ROTATE_CANVAS=4;W.M_COLOR_PICKER=5;W.M_GRADIENTFILL=6;W.M_TRANSFORM=7;W.M_PAN_CANVAS=8;W.T_PENCIL=0;W.T_ERASER=1;W.T_PEN=2;W.T_SOFTERASER=3;W.T_AIRBRUSH=4;W.T_DODGE=5;W.T_BURN=6;W.T_WATER=7;W.T_BLUR=8;W.T_SMUDGE=9;W.T_BLENDER=10;W.T_MAX=11;W.COLOR_MODE_RGB=0;W.COLOR_MODE_GREYSCALE=1;window.ChickenPaint=W}();
