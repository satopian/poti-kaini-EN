/*
    ChickenPaint Be
    https://github.com/satopian/ChickenPaint_Be
    by satopian
    Customized from ChickenPaint by Nicholas Sherlock.
    GNU GENERAL PUBLIC LICENSE
    Version 3, 29 June 2007
    <http://www.gnu.org/licenses/>
*/
/*
    ChickenPaint

    ChickenPaint is a translation of ChibiPaint from Java to JavaScript
    by Nicholas Sherlock / Chicken Smoothie.

    ChibiPaint is Copyright (c) 2006-2008 Marc Schefer

    ChickenPaint is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    ChickenPaint is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with ChickenPaint. If not, see <http://www.gnu.org/licenses/>.
*/
/*
    Bootstrap (https://getbootstrap.com/)
    Copyright The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
    Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)

    EventEmitter v5.2.9 - git.io/ee
    Unlicense - http://unlicense.org/
    Oliver Caldwell - https://oli.me.uk/
*/
/*
    jQuery throttle / debounce - v1.1 - 3/7/2010
    http://benalman.com/projects/jquery-throttle-debounce-plugin/

    Copyright (c) 2010 "Cowboy" Ben Alman
    Dual licensed under the MIT and GPL licenses.
    http://benalman.com/about/license/
*/
!function(){function ya(a){return a&&a.__esModule?a.default:a}function zc(a,c,d,b){Object.defineProperty(a,c,{get:d,set:b,enumerable:!0,configurable:!0})}function ka(a){for(var c in ka.DEFAULTS)ka.DEFAULTS.hasOwnProperty(c)&&(this[c]=ka.DEFAULTS[c]);for(c in a)a.hasOwnProperty(c)&&(this[c]=a[c])}function pa(a,c,d,b){this.left=a;this.top=c;this.right=d;this.bottom=b}function Mc(a,c){this.width=0|a;this.height=0|c}function Nc(a,c){var d=document.createElement("canvas");return d.width=a,d.height=c,d}
function Xd(a,c){return document.createElement("canvas").getContext("2d").createImageData(a,c)}function C(a,c){"number"==typeof a?(Mc.call(this,a,c),this.imageData=Xd(this.width,this.height)):(Mc.call(this,a.width,a.height),this.imageData=a);this.data=this.imageData.data}function Be(a,c,d,b){var h,n=0,g=[0,0,0,0];var e=0;for(h=0;h<b&&h<d;h++){for(var k=0;k<C.BYTES_PER_PIXEL;k++)g[k]+=a[e++];n++}h=0;for(k=0;k<d;k++){if(k+b<d){e=(k+b)*C.BYTES_PER_PIXEL;for(var l=0;l<C.BYTES_PER_PIXEL;l++)g[l]+=a[e++];
n++}for(e=0;e<C.BYTES_PER_PIXEL;e++)c[h++]=Math.round(g[e]/n);if(k-b>=0){e=(k-b)*C.BYTES_PER_PIXEL;for(l=0;l<C.BYTES_PER_PIXEL;l++)g[l]-=a[e++];n--}}}function Ce(a,c){if(0==(c%=4))return a;let d=Nc(0,0),b=d.getContext("2d");switch(c%2==0?(d.width=a.width,d.height=a.height):(d.width=a.height,d.height=a.width),c){case 1:b.rotate(Math.PI/2);b.drawImage(a,0,-a.height);break;case 2:b.rotate(Math.PI);b.drawImage(a,-a.width,-a.height);break;case 3:b.rotate(-Math.PI/2);b.drawImage(a,-a.width,0);break;default:return a}return d}
function Ua(a="",c=0){Xa.call(this,a);this.layers=[];this.expanded=!0;this.blendMode=c}function Rf(a,c){return a+c}function Ba(a,c,d){Mc.call(this,a,c);this.createBitmap(a,c,d)}function De(a,c,d,b){var h,n=0,g=0;for(h=0;h<b&&h<d;h++)g+=a[h],n++;h=0;for(let e=0;e<d;e++)e+b<d&&(g+=a[e+b],n++),c[h++]=Math.round(g/n),e-b>=0&&(g-=a[e-b],n--)}function I(){}function Xa(a){this.name=a||"";this.parent=null;this.lockAlpha=!1;this.alpha=100;this.visible=!0;this.blendMode=I.LM_NORMAL;this.mask=null;this.maskVisible=
this.maskLinked=!0;this.maskThumbnail=null;this.useLegacyMultiply=!1}function ta(a,c,d){Xa.call(this,d);a>0&&c>0?this.image=new C(a,c):this.image=null;this.clip=!1;this.imageThumbnail=null}function hd(a,c,d){d?(this.isGroup=d instanceof Ua,this.image=d.image,this.mask=d.getEffectiveMask(),this.layer=d,this.blendMode=d.blendMode,this.alpha=d.alpha,this.visible=d.visible):(this.isGroup=!0,this.image=null,this.mask=null,this.layer=null,this.blendMode=I.LM_PASSTHROUGH,this.alpha=100,this.visible=!0);
this.dirtyRect=new pa(0,0,a,c);this.layers=[];this.parent=null;this.clip=!1}function Yd(a,c,d,b){function h(){return l.length>0?l.pop():new C(c,d)}function n(m){if(0==m.layers.length)return null;if(1==m.layers.length&&(null==m.mask||null==m.layers[0].mask)){let r=m.layers[0];return r.alpha=Math.round(m.alpha*r.alpha/100),m.blendMode!=I.LM_PASSTHROUGH&&(r.blendMode=m.blendMode),r.mask=m.mask||r.mask,m.layer&&f.set(m.layer,r),r}return m.blendMode==I.LM_PASSTHROUGH&&100==m.alpha&&null==m.mask?m.layers:
(m.image=h(),m)}function g(m){let r=new hd(c,d,m);return f.set(m,r),r}function e(m,r){m&&(m.dirtyRect.union(r),e(m.parent,r))}let k,l=[],f=new Map;this.invalidateLayerRect=function(m,r){e(f.get(m),r)};this.buildTree=function(){if(!k){if(k=function q(r){if(0==r.getEffectiveAlpha())return null;let t=g(r);for(var v=0;v<r.layers.length;v++){let A=r.layers[v];var x=r.layers[v+1];if(A instanceof ta&&x&&x.clip){x=new hd(c,d,null);x.blendMode=A.blendMode;x.alpha=100;x.clip=!0;x.addChildren(g(A));for(v+=1;v<
r.layers.length;v++)if(r.layers[v].clip)r.layers[v].getEffectiveAlpha()>0&&x.addChildren(g(r.layers[v]));else break;A.getEffectiveAlpha()>0&&t.addChildren(n(x));--v}else A instanceof Ua?t.addChildren(q(A)):A.getEffectiveAlpha()>0&&t.addChildren(g(A))}return n(t)}(a)){if(Array.isArray(k)||b&&(k.alpha<100||k.mask)){let r=k;(k=new hd(c,d)).blendMode=Array.isArray(r)?I.LM_NORMAL:r.blendMode;k.alpha=100;k.image=h();k.addChildren(r)}}else(k=new hd(c,d,{image:h(),blendMode:I.LM_NORMAL,alpha:100,getEffectiveMask:()=>
null,visible:!0})).image.clearAll(0);l=[]}};this.resetTree=function(){k&&(!function q(r){if(r.isGroup)for(let t of(r.image&&l.push(r.image),r.layers))q(t)}(k),k=null,f.clear())};this.layerPropertyChanged=function(m,r){let q=f.get(m);q&&q.visible==m.visible&&q.alpha==m.alpha&&null==q.mask==(null==m.getEffectiveMask())&&q.blendMode==I.LM_PASSTHROUGH==(m.blendMode==I.LM_PASSTHROUGH)&&"clip"!==r?(q.blendMode=m.blendMode,e(q,new pa(0,0,c,d))):this.resetTree()};this.blendTree=function(){return function q(r){if(!r||
!r.isGroup)return r;let t=r.dirtyRect;var v=!0,x=!0;if(r.blendMode==I.LM_PASSTHROUGH&&r.parent&&t.union(r.parent.dirtyRect),t.isEmpty())return r;if(r.blendMode==I.LM_PASSTHROUGH&&r.parent){v=!1;var A=r.image;var B=r.parent.image;t.getWidth()==A.width&&t.getHeight()==A.height?A.copyPixelsFrom(B):I.replaceOntoFusionWithOpaqueLayer(A,B,100,t)}for(A=0;A<r.layers.length;A++){var y=q(r.layers[A]);if(v){v=r.image;B=y.image;var E=y.alpha,G=t;y=y.mask;if(100!=E||y||G.getWidth()!=v.width||G.getHeight()!=v.height){let M=
"replaceOntoFusionWith";100==E?M+="OpaqueLayer":M+="TransparentLayer";y&&(M+="Masked");I[M](v,B,E,G,y)}else v.copyPixelsFrom(B);!0;v=!1}else x=x&&r.image.hasAlphaInRect(t),I.fuseImageOntoImage(r.image,x,y.image,y.alpha,y.blendMode,t,y.mask)}r.clip&&(x=r.layers[0],x.alpha<100?x.mask?I.replaceAlphaOntoFusionWithTransparentLayerMasked(r.image,x.image,x.alpha,t,x.mask):I.replaceAlphaOntoFusionWithTransparentLayer(r.image,x.image,x.alpha,t):x.mask?I.replaceAlphaOntoFusionWithOpaqueLayerMasked(r.image,
x.image,100,t,x.mask):I.replaceAlphaOntoFusionWithOpaqueLayer(r.image,x.image,100,t));return r.dirtyRect.makeEmpty(),r}(k)}}function Sf(){function a(f){if(null!=h&&f.curSize==n&&f.curSqueeze==g&&f.curAngle==e&&f.tip==k)return h;switch(f.tip){case ka.TIP_ROUND_AIRBRUSH:!function(m,r){let q=Math.ceil(r.curSize),t=q/2,v=r.curSize/2*(r.curSize/2),x=1+10*r.curSqueeze,A=Math.cos(r.curAngle);r=Math.sin(r.curAngle);let B=0;for(let G=0;G<q;G++)for(let M=0;M<q;M++){var y=M+.5-t;let L=G+.5-t;var E=(y*A-L*r)*
x;y=L*A+y*r;E=E*E+y*y;E<=v?m[B++]=~~(255*(1-E/v)):m[B++]=0}}(c,f);break;case ka.TIP_ROUND_AA:!function(m,r){let q=Math.ceil(r.curSize),t=q/2,v=r.curSize/2*(r.curSize/2),x=(r.curSize-2)/2*((r.curSize-2)/2),A=(r.curSize+2)/2*((r.curSize+2)/2),B=1+10*r.curSqueeze,y=Math.cos(r.curAngle);r=Math.sin(r.curAngle);let E=0;for(let M=0;M<q;M++)for(let L=0;L<q;L++){let J=L+.5-t,W=M+.5-t,ba=(J*y-W*r)*B,ma=W*y+J*r;var G=ba*ba+ma*ma;if(G<=x)m[E++]=255;else if(G>A)m[E++]=0;else{G=0;for(let na=0;na<4;na++)for(let H=
0;H<4;H++)(ba=((J=L+.25*H-t)*y-(W=M+.25*na-t)*r)*B)*ba+(ma=W*y+J*r)*ma<=v&&(G+=1);m[E++]=Math.min(16*G,255)}}}(c,f);break;case ka.TIP_ROUND_PIXEL:!function(m,r){let q=Math.ceil(r.curSize),t=q/2,v=r.curSize/2*(r.curSize/2),x=1+10*r.curSqueeze,A=Math.cos(r.curAngle);r=Math.sin(r.curAngle);let B=0;for(let E=0;E<q;E++)for(let G=0;G<q;G++){var y=G+.5-t;let M=E+.5-t,L=(y*A-M*r)*x;y=M*A+y*r;L*L+y*y<=v?m[B++]=255:m[B++]=0}}(c,f);break;case ka.TIP_SQUARE_AA:!function(m,r){let q=Math.ceil(r.curSize),t=q/2;
var v=r.curSize*Math.sin(Math.PI/4);let x=v/2/(1+10*r.curSqueeze);v/=2;let A=x-1,B=v-1,y=x+1,E=v+1,G=Math.cos(r.curAngle);r=Math.sin(r.curAngle);let M=0;for(let J=0;J<q;J++)for(let W=0;W<q;W++){var L=W+.5-t;let ba=J+.5-t,ma=Math.abs(L*G-ba*r);L=Math.abs(ba*G+L*r);if(ma<=A&&L<=B)m[M++]=255;else if(ma>y||L>E)m[M++]=0;else{let na=0;for(let H=0;H<4;H++)for(let T=0;T<4;T++)ma=Math.abs((L=W+.25*T-t)*G-(ba=J+.25*H-t)*r),L=Math.abs(ba*G+L*r),ma<=x&&L<=v&&na++;m[M++]=Math.min(16*na,255)}}}(c,f);break;case ka.TIP_SQUARE_PIXEL:!function(m,
r){let q=Math.ceil(r.curSize),t=q/2;var v=r.curSize*Math.sin(Math.PI/4);let x=v/2/(1+10*r.curSqueeze);v/=2;let A=Math.cos(r.curAngle);r=Math.sin(r.curAngle);let B=0;for(let y=0;y<q;y++)for(let E=0;E<q;E++){let G=E+.5-t,M=y+.5-t,L=Math.abs(M*A+G*r);Math.abs(G*A-M*r)<=x&&L<=v?m[B++]=255:m[B++]=0}}(c,f)}return h=c,n=f.curSize,k=f.tip,g=f.curSqueeze,e=f.curAngle,c}let c=new Uint8Array(160801),d=new Uint8Array(161604),b=[new Float32Array(402),new Float32Array(402)],h=null,n,g,e,k,l=this;this.getDab=function(f,
m,r){let q={alpha:r.curAlpha,width:Math.ceil(r.curSize),height:Math.ceil(r.curSize)},t=r.isAA&&r.tip!=ka.TIP_ROUND_PIXEL;t&&(q.width++,q.height++);f=f-q.width/2+.5;m=m-q.height/2+.5;let v=Math.floor(f),x=Math.floor(m);return t?q.brush=function(A,B,y){var E=a(A);let G=Math.ceil(A.curSize);A=Math.ceil(A.curSize)+1;let M=(1-B)*(1-y),L=B*(1-y),J=B*y,W=(1-B)*y,ba=0;B=0;y=b[0];let ma=b[1];y.fill(0);for(let H=0;H<G;H++){var na=0;for(ma[0]=0;na<G;na++,ba++,B++){let T=E[ba];d[B]=y[na]+T*M+.5|0;y[na+1]+=T*
L;ma[na]+=T*W;ma[na+1]=T*J}d[B++]=y[na]+.5|0;na=y;y=ma;ma=na}for(E=0;E<A;E++,B++)d[B]=y[E]+.5|0;return d}(r,f-v,m-x):q.brush=a(r),q.x=v,q.y=x,r.texture>0&&null!=this.texture&&(q.brush==c&&(d.set(c),q.brush=d),!function(A,B){B=Math.floor(255*B);let y=l.texture,E=A.x%y.width,G=A.y%y.height,M=0,L,J;E<0&&(E+=y.width);G<0&&(G+=y.height);for(let W=0;W<A.height;W++){L=G*y.width+E;J=G*y.width+y.width;for(let ba=0;ba<A.width;ba++)A.brush[M]=~~(A.brush[M]*(y.data[L]*B/255^255)/255),M++,++L==J&&(L-=y.width);
++G==y.height&&(G=0)}}(q,r.texture)),q};this.setTexture=function(f){this.texture=f}}function Zd(a,c,d){this.bmp=a;this.x=c;this.y=d}function xd(a){if(0==a.saturation)return a.value<<16|a.value<<8|a.value;var c=a.hue/60;c-=Math.floor(c);var d=a.saturation/255,b=~~(a.value*(1-d)),h=~~(a.value*(1-d*c));c=~~(a.value*(1-d*(1-c)));switch(~~(a.hue/60)){case 0:return a.value<<16|c<<8|b;case 1:return h<<16|a.value<<8|b;case 2:return b<<16|a.value<<8|c;case 3:return b<<16|h<<8|a.value;case 4:return c<<16|b<<
8|a.value;case 5:return a.value<<16|b<<8|h;default:return 0}}function db(a){this.value=this.saturation=this.hue=this.rgb=0;this.setRgb(a||0)}function Tf(){var a,c=!1;this.nextGaussian=function(){if(c)return c=!1,a;do var d=(b=2*Math.random()-1)*b+(h=2*Math.random()-1)*h;while(d>=1||0==d);var b,h;d=Math.sqrt(-2*Math.log(d)/d);return a=h*d,c=!0,b*d}}function lb(){this.setToIdentity()}function oc(a,c,d){this.r=a;this.g=c;this.b=d}function Ee(a){let c=0;for(let d=0;d<a.length;d++)c+=a[d];return c/a.length}
function Fe(a){let c=new oc(0,0,0);for(let d=0;d<a.length;d++){let b=a[d];c.r+=b.r;c.g+=b.g;c.b+=b.b}return c.r/=a.length,c.g/=a.length,c.b/=a.length,c}function Ge(a,c){let d=a.data;if(c.left>0)for(var b=c.top;b<c.bottom;b++){var h=b*a.width,n=h;h=d[h+c.left];for(var g=0;g<c.left;g++,n++)d[n]=h}if(c.right<a.width)for(b=c.top;b<c.bottom;b++)for(n=b*a.width+c.right,h=d[n-1],g=c.right;g<a.width;g++,n++)d[n]=h;b=0;for(n=0;n<c.top;n++)for(h=c.top*a.width,g=0;g<a.width;g++,h++,b++)d[b]=d[h];b=c.bottom*
a.width;for(n=c.bottom;n<a.width;n++)for(h=(c.bottom-1)*a.width,g=0;g<a.width;g++,h++,b++)d[b]=d[h]}function yd(a,c){return a+c}function He(a){return a?a.width*a.height*4:0}function cc(a,c){function d(w){fc=!1;(pc.size>0||qc.size>0)&&(w?e():hc||setTimeout(e,1E3))}function b(){Z.emitEvent("changeSelection",[])}function h(w){Z.emitEvent("updateRegion",[w])}function n(){Z.emitEvent("changeStructure");ub.resetTree();v();h(Z.getBounds())}function g(w,F,P){Z.emitEvent("changeLayer",[w]);P||(ub.layerPropertyChanged(w,
F),h(Z.getBounds()))}function e(){for(let w of pc)w.rebuildImageThumbnail(),Z.emitEvent("changeLayerImageThumb",[w]);for(let w of qc)w.rebuildMaskThumbnail(),Z.emitEvent("changeLayerMaskThumb",[w]);pc.clear();hc&&(clearTimeout(hc),hc=null)}function k(w,F,P,O){Array.isArray(w)||(w=[w]);w.forEach(Y=>ub.invalidateLayerRect(Y,F));let U=!1;if(P)for(let Y of(vb.union(F),w))Y instanceof ta&&(pc.add(Y),U=!0);O&&(R.union(F),w.forEach(Y=>{qc.add(Y);ab&&ab.layer==Y&&ab.invalidateRect(F)}),U=!0);U&&(hc&&(clearTimeout(hc),
hc=null),fc||(hc=setTimeout(e,1E3)));h(F)}function l(w,F){k(w,F,!va,va)}function f(){return va?S.mask:S.image}function m(){if(!wa.isEmpty()){if(va){var w=S.mask;eb.brushMode==ka.BRUSH_MODE_ERASE?ea[ka.BRUSH_MODE_PAINT].mergeOntoMask(w,Aa,4278190080):ea[eb.brushMode].mergeOntoMask(w,Aa,255&Ib)}else{w=S.image;let F=S.getLockAlpha();eb.brushMode==ka.BRUSH_MODE_ERASE&&F?ea[ka.BRUSH_MODE_PAINT].mergeOntoImage(w,mb,16777215):ea[eb.brushMode].mergeOntoImage(w,mb,Ib);F&&w.copyAlphaFrom(mb,wa)}wa.makeEmpty()}}
function r(){S instanceof ta&&!vb.isEmpty()&&(mb.copyBitmapRect(S.image,vb.left,vb.top,vb),vb.makeEmpty())}function q(){S.mask&&!R.isEmpty()&&(Aa.copyBitmapRect(S.mask,R.left,R.top,R),R.makeEmpty())}function t(){va?q():r()}function v(){let w=Z.getBounds();vb.set(w);R.set(w)}function x(w){Z.setHasUnsavedChanges(!0);ic.length>0&&(ic=[]);0!==rb.length&&rb[rb.length-1].merge(w)?rb[rb.length-1].noChange()&&rb.pop():(rb.length>=30&&rb.shift(),Z.compactUndo(),rb.push(w))}function A(w,F){w||F||(w=!va,F=va);
let P=ib.clone(),O=w?mb.copyRectXOR(S.image,P):null,U=F?Aa.copyRectXOR(S.mask,P):null;this.layer=S;ib.makeEmpty();this.redo=this.undo=function(){O&&this.layer.image.setRectXOR(O,P);U&&this.layer.mask.setRectXOR(U,P);k(this.layer,P,null!=O,null!=U)};this.getMemoryUsed=function(Y,la){return(O?O.length:0)+(U?U.length:0)}}function B(w){let F=w.maskLinked,P=w.maskVisible;this.undo=function(){w.setMask(null);w.maskLinked=F;w.maskVisible=P;n();Z.setActiveLayer(w,!1)};this.redo=function(){let O=new Ba(Z.width,
Z.height,8);O.clearAll(255);w.maskLinked=!0;w.maskVisible=!0;w.setMask(O);n();Z.setActiveLayer(w,!0)};this.redo()}function y(w,F){let P=w.mask,O,U=!1;O=F&&w instanceof ta?w.image.clone():null;U=S==w&&va;this.undo=function(){w.setMask(P);O&&(w.image.copyPixelsFrom(O),k(w,w.image.getBounds(),!0,!1));U&&Z.setActiveLayer(w,!0);n()};this.redo=function(){O&&(I.multiplyAlphaByMask(w.image,100,w.mask),k(w,Z.getBounds(),!0,!1));U&&Z.setActiveLayer(w,!1);w.setMask(null);n()};this.redo()}function E(w,F,P){let O=
P instanceof ta&&P.clip,U=w.layers[F],Y=U instanceof ta&&U.clip,la=va;this.undo=function(){w.removeLayer(P);let Ka=w.layers[F-1]||w.layers[0]||w;U instanceof ta&&(U.clip=Y);P instanceof ta&&(P.clip=O);n();Z.setActiveLayer(Ka,la)};this.redo=function(){w.insertLayer(F,P);Y&&(P instanceof ta?P.clip=!0:U.clip=!1);n();Z.setActiveLayer(P,!1)};this.redo()}function G(w){let F=w.clone(),P=va;this.undo=function(){F.parent.removeLayer(F);n();Z.setActiveLayer(w,P)};this.redo=function(){let O=w.name;O.endsWith(" Copy")||
(O+=" Copy");F.name=O;w.parent.insertLayer(w.parent.indexOf(w)+1,F);n();Z.setActiveLayer(F,!1)};this.redo()}function M(w){let F=w.parent,P=F.indexOf(w),O=va,U=0;if(w instanceof ta&&!w.clip)for(let Y=P+1;Y<F.layers.length;Y++)if(F.layers[Y]instanceof ta&&F.layers[Y].clip)U++;else break;this.undo=function(){F.insertLayer(P,w);for(let Y=0;Y<U;Y++)F.layers[Y+P+1].clip=!0;n();Z.setActiveLayer(w,O)};this.redo=function(){var Y;for(Y=0;Y<U;Y++)F.layers[Y+P+1].clip=!1;F.removeLayerAtIndex(P);Y=0==F.layers.length?
w.parent:F.layers[Math.max(P-1,0)];n();Z.setActiveLayer(Y,!1)};this.getMemoryUsed=function(Y,la){return Y?0:w.getMemoryUsed()};this.redo()}function L(w){let F=w.parent.indexOf(w),P=va,O=new ta(Z.width,Z.height,"");this.undo=function(){w.parent.setLayerAtIndex(F,w);n();Z.setActiveLayer(w,P)};this.redo=function(){w.parent.setLayerAtIndex(F,O);n();Z.setActiveLayer(O,!1)};this.getMemoryUsed=function(Y,la){return Y?0:w.getMemoryUsed()};var U=new Yd(w,Z.width,Z.height,!1);U.buildTree();U=U.blendTree();
O.name=w.name;O.alpha=U.alpha;O.image=U.image;O.blendMode=U.blendMode;O.mask=U.mask;O.blendMode==I.LM_PASSTHROUGH&&(O.blendMode=I.LM_NORMAL);this.redo()}function J(w){let F=w.parent,P=F.layers[F.indexOf(w)-1],O=new ta(Z.width,Z.height,""),U=va;this.undo=function(){let Y=F.indexOf(O);F.removeLayerAtIndex(Y);F.insertLayer(Y,w);F.insertLayer(Y,P);n();Z.setActiveLayer(w,U)};this.redo=function(){if(P.clip||!w.clip)O.copyFrom(P),w.getEffectiveAlpha()>0&&(O.mask?I.multiplyAlphaByMask(O.image,O.alpha,O.mask):
I.multiplyAlphaBy(O.image,O.alpha),I.fuseImageOntoImage(O.image,!0,w.image,w.alpha,w.blendMode,w.getBounds(),w.mask));else{var Y=new Ua;Y.layers=[P,w];Y.parent=null;Y.name="Temporary Group";Y=new Yd(Y,Z.width,Z.height,!1);Y.buildTree();O.image=Y.blendTree().image}O.name=P.name;O.alpha=100;O.blendMode=P.blendMode;O.mask=null;Y=F.indexOf(P);F.removeLayerAtIndex(Y);F.removeLayerAtIndex(Y);F.insertLayer(Y,O);n();Z.setActiveLayer(O,!1)};this.getMemoryUsed=function(Y,la){return Y?0:w.getMemoryUsed()+O.getMemoryUsed()};
this.redo()}function W(w=!1){let F=Z.getActiveLayer(),P=ra.layers.slice(0),O=new ta(Z.width,Z.height,"");this.undo=function(){ra.layers=P.slice(0);n();Z.setActiveLayer(F,!1)};this.redo=function(){let U=Z.fusionLayers();O.copyImageFrom(U);O.setName(Z.getDefaultLayerName(!1));w?ra.layers=P.slice(0):ra.clearLayers();ra.addLayer(O);n();Z.setActiveLayer(O,!1)};this.getMemoryUsed=function(U,Y){return P.map(la=>la.getMemoryUsed()).reduce(yd,0)};this.redo()}function ba(w){if(!va){var F=Z.getActiveLayer(),
P=ra.layers.slice(0),O=new ta(Z.width,Z.height,"");this.undo=function(){ra.layers=P.slice(0);n();Z.setActiveLayer(F,!1)};this.redo=function(){var U=Z.fusionLayers();O.copyImageFrom(U);O.setName(Z.getDefaultLayerName(!1));ra.layers=P.slice(0);ra.addLayer(O);n();Z.setActiveLayer(O,!1);U=Z.getSelectionAutoSelect();let Y=f();Y&&(t(),ib=U.clone(),Y.chromaticAberration(U,w),l(S,U))};this.redo()}}function ma(w,F,P){let O=w.parent,U=w.parent.indexOf(w),Y=va,la=O.layers[O.indexOf(w)+1],Ka=F.layers[P],fb=w instanceof
ta&&w.clip,Jb=!!fb&&w.getClippingBase(),Qb=0,Rb=0;if(w instanceof ta&&!w.clip)for(var sb=U+1;sb<O.layers.length;sb++)if(O.layers[sb]instanceof ta&&O.layers[sb].clip)Qb++;else break;else if(w instanceof Ua)for(sb=P;sb<F.layers.length;sb++)if(F.layers[sb]instanceof ta&&F.layers[sb].clip)Rb++;else break;this.undo=function(){w.parent.removeLayer(w);var tb=la?O.indexOf(la):O.layers.length;O.insertLayer(tb,w);w instanceof ta&&(w.clip=fb);for(tb=0;tb<Qb;tb++)O.layers[tb+U+1].clip=!0;for(tb=0;tb<Rb;tb++)F.layers[tb+
P].clip=!0;n();Z.setActiveLayer(w,Y)};this.redo=function(){for(var tb=0;tb<Qb;tb++)O.layers[tb+U+1].clip=!1;w.parent.removeLayer(w);tb=Ka?F.indexOf(Ka):F.layers.length;F.insertLayer(tb,w);for(var Kb=0;Kb<Rb;Kb++)F.layers[Kb+tb+1].clip=!1;w instanceof ta&&(w.clip&&w.getClippingBase()!=Jb&&(w.clip=!1),Ka instanceof ta&&Ka.clip&&(w.clip=!0));for(Kb=0;Kb<Rb;Kb++)F.layers[Kb+tb+1].clip=!1;n();Z.setActiveLayer(w,!1)};this.redo()}function na(w,F){let P=w.substring(0,1).toUpperCase()+w.substring(1),O=function(U,
Y){Array.isArray(U)||(U=[U]);this.layers=U;this.from=this.layers.map(la=>la["get"+P]());this.to=Y;this.redo()};return O.prototype=Object.create(Vb.prototype),O.prototype.constructor=O,O.prototype.undo=function(){this.layers.forEach((U,Y)=>U["set"+P](this.from[Y]));this.layers.forEach(U=>g(U,w,!F))},O.prototype.redo=function(){this.layers.forEach(U=>U["set"+P](this.to));this.layers.forEach(U=>g(U,w,!F))},O.prototype.merge=function(U){var Y;if(Y=U instanceof O)a:{Y=this.layers;var la=U.layers;if(Y.length!=
la.length)Y=!1;else{for(let Ka=0;Ka<Y.length;Ka++)if(Y[Ka]!=la[Ka]){Y=!1;break a}Y=!0}}return!!Y&&(this.to=U.to,!0)},O.prototype.noChange=function(){for(let U=0;U<this.from.length;U++)if(this.from[U]!=this.to)return!1;return!0},O}function H(w,F){w=w.clone();F=F.clone();this.undo=function(){Z.setSelection(w);h(Z.getBounds())};this.redo=function(){Z.setSelection(F);h(Z.getBounds())};this.noChange=function(){return w.equals(F)}}function T(w,F,P){let O=F?w.mask:w.image,U=O.cloneRect(P);P=P.clone();this.undo=
function(){O.copyBitmapRect(U,P.left,P.top,U.getBounds());Z.setActiveLayer(w,F);Z.setSelection(P);k(w,P,!F,F)};this.redo=function(){F?O.clearRect(P,0):O.clearRect(P,16777215);jb=new Zd(U,P.left,P.top);Z.setActiveLayer(w,F);Z.emptySelection();k(w,P,!F,F)};this.getMemoryUsed=function(Y,la){return U==la?0:U.getMemorySize()};this.redo()}function Ca(w){let F=Z.getSelection(),P=va,O=new ta(Z.width,Z.height,Z.getDefaultLayerName(!1)),U=S,Y=U.parent;this.undo=function(){Y.removeLayer(O);Z.setSelection(F);
n();Z.setActiveLayer(U,P)};this.redo=function(){var la=Y.indexOf(U);let Ka=w.bmp.getBounds(),fb,Jb;(Y.insertLayer(la+1,O),Ka.isInside(Z.getBounds())?(fb=w.x,Jb=w.y):(fb=(Z.width-w.bmp.width)/2|0,Jb=(Z.height-w.bmp.height)/2|0),w.bmp instanceof Ba)?(la=new C(w.bmp.width,w.bmp.height),la.copyPixelsFromGreyscale(w.bmp),O.image.copyBitmapRect(la,fb,Jb,Ka)):O.image.copyBitmapRect(w.bmp,fb,Jb,Ka);Z.emptySelection();n();Z.setActiveLayer(O,!1)};this.getMemoryUsed=function(la,Ka){return w.bmp==Ka?0:w.bmp.getMemorySize()};
this.redo()}a|=0;c|=0;let ra=new Ua("Root",I.LM_NORMAL),ub=new Yd(ra,a,c,!0),mb=new C(a,c),vb=new pa(0,0,a,c),Aa=new Ba(a,c,8),R=new pa(0,0,a,c),da=new Ba(a,c,32),wa=new pa(0,0,0,0),$a=new Sf,Z=this,ea=[],S=ra,va=!1,ab=null,ib=new pa(0,0,0,0),La=!1,xb=new pa(0,0,0,0),Cb=null,Sb=new Tf,gb=null,jb=null,rb=[],ic=[],eb=null,bb=0,Qa=0,Db=0,nb=!1,fc=!1,qc=new Set,pc=new Set,hc=null,Ib=0,Gb="smooth";this.texture=null;this.getLayersRoot=function(){return ra};this.getSelectionAutoSelect=function(){return xb.isEmpty()?
this.getBounds():this.getSelection()};this.getSelection=function(){return xb.clone()};this.setHasUnsavedChanges=function(w){w!=La&&(La=w,this.emitEvent("unsavedChanges",[w]))};this.getHasUnsavedChanges=function(){return La};this.isAddLayerMaskAllowed=function(){return!S.mask};this.addLayerMask=function(){this.isAddLayerMaskAllowed()&&x(new B(S))};this.isRemoveLayerMaskAllowed=function(){return null!==S.mask};this.removeLayerMask=function(){this.isRemoveLayerMaskAllowed()&&x(new y(S,!1))};this.isApplyLayerMaskAllowed=
function(){return null!==S.mask&&S instanceof ta};this.applyLayerMask=function(w){this.isApplyLayerMaskAllowed()&&x(new y(S,!0))};this.addLayer=function(w){let F,P;if(S instanceof Ua&&S.expanded?(F=S,P=S.layers.length):P=(F=S.parent).layers.indexOf(S)+1,"group"===w){for(;F.layers[P]instanceof ta&&F.layers[P].clip;)P++;w=new Ua(this.getDefaultLayerName(!0),I.LM_PASSTHROUGH)}else(w=new ta(this.width,this.height,this.getDefaultLayerName(!1))).image.clearAll(16777215);return x(new E(F,P,w)),w};this.addLayerObject=
function(w,F){w.addLayer(F);w==ra&&1==ra.layers.length&&(S=F);n()};this.addLayerGroupObject=function(w,F,P){let O=[];for(let U=0;U<P;U++)O.unshift(w.layers.pop());O.forEach(U=>F.addLayer(U));this.addLayerObject(w,F)};this.isRemoveLayerAllowed=function(){return S instanceof ta?ra.getLinearizedLayerList(!1).some(w=>w instanceof ta&&w!=S):S instanceof Ua&&ra.getLinearizedLayerList(!1).some(w=>w instanceof ta&&!w.hasAncestor(S))};this.removeLayer=function(){return!!this.isRemoveLayerAllowed()&&(x(new M(S)),
!0)};this.duplicateLayer=function(){x(new G(S))};this.isMergeDownAllowed=function(){let w=S.parent.indexOf(S);return w>0&&S instanceof ta&&S.parent.layers[w-1]instanceof ta};this.mergeDown=function(){this.isMergeDownAllowed()&&x(new J(S))};this.isMergeGroupAllowed=function(){return S instanceof Ua&&S.getEffectiveAlpha()>0};this.mergeGroup=function(){this.isMergeGroupAllowed()&&x(new L(S))};this.isMergeAllLayersAllowed=function(){return ra.getLinearizedLayerList(!1).length>1};this.mergeAllLayers=function(w=
!1){this.isMergeAllLayersAllowed()&&x(new W(w))};this.relocateLayer=function(w,F,P){w&&F&&w!=F&&!F.hasAncestor(w)&&x(new ma(w,F,P))};this.setLayerVisibility=function(w,F){let P=[];if(w.ancestorsAreVisible())w.visible!=F&&x(new fa(w,F));else{for(;null!=w;w=w.parent)w.visible||P.push(w);x(new fa(P,!0))}};this.expandLayerGroup=function(w,F){w.expanded!=F&&(w.expanded=F,!F&&S.hasAncestor(w)&&this.setActiveLayer(w,!1),g(w,"expanded",!0))};this.setLayerAlpha=function(w){S.getAlpha()!=w&&x(new Ac(S,w))};
this.setLayerMaskLinked=function(w){S.maskLinked!=w&&x(new Fa(S,w))};this.setLayerMaskVisible=function(w,F){w.maskVisible!=F&&x(new jc(w,F))};this.setLayerBlendMode=function(w){S.getBlendMode()!=w&&(w!=I.LM_PASSTHROUGH||S instanceof Ua)&&x(new rc(S,w))};this.setLayerName=function(w,F){w.getName()!=F&&x(new Wb(w,F))};this.paintDab=function(w,F,P){if(eb){eb.applyPressure(P);eb.scattering>0&&(w+=Sb.nextGaussian()*eb.curScattering/4,F+=Sb.nextGaussian()*eb.curScattering/4);P=ea[eb.brushMode];w=$a.getDab(w,
F,eb);var O=new pa(0,0,w.width,w.height);F=new pa(0,0,w.width,w.height);if(F.translate(w.x,w.y),Z.getBounds().clipSourceDest(O,F),!F.isEmpty()){ib.union(F);var U=va?S.mask:S.image,Y=nb&&!va?Cb:U,la=va?null:Z.getSelection();if(!la||la.isEmpty())P.paintDab(U,F,Y,eb,O,w,Ib);else{O=F.getIntersection(la,!0);if(!O||O.isEmpty()||(O.left=Math.max(0,O.left),O.top=Math.max(0,O.top),O.right=Math.min(U.width,O.right),O.bottom=Math.min(U.height,O.bottom),O.isEmpty()))return;la=new pa(O.left-w.x,O.top-w.y,O.left-
w.x+O.getWidth(),O.top-w.y+O.getHeight());P.paintDab(U,O,Y,eb,la,w,Ib)}!va&&P.noMergePhase&&S.getLockAlpha()&&U.copyAlphaFrom(mb,F);P.wantsOutputAsInput&&(m(),nb&&!va&&Z.fusionLayers());l(S,F)}}};this.getDefaultLayerName=function(w){let F=w?"Group ":"Layer ";w=w?/^Group [0-9]+$/:/^Layer [0-9]+$/;let P=0,O=ra.getLinearizedLayerList(!1);for(let U=0;U<O.length;U++){let Y=O[U];w.test(Y.name)&&(P=Math.max(P,parseInt(Y.name.substring(F.length),10)))}return F+(P+1)};this.addBackgroundLayer=function(){let w=
new ta(Z.width,Z.height,this.getDefaultLayerName(!1));w.image.clearAll(4294967295);this.addLayerObject(this.getLayersRoot(),w)};this.addDefaultLayer=function(){let w=new ta(Z.width,Z.height,this.getDefaultLayerName(!1));w.image.clearAll(16777215);this.addLayerObject(this.getLayersRoot(),w);this.setActiveLayer(w,!1)};this.fusionLayers=function(){m();ub.buildTree();return Cb=ub.blendTree().image};this.upgradeMultiplyLayers=function(w){let F=this.getLayersRoot().getLinearizedLayerList(!1,[]),P=-1;for(var O=
0;O<F.length;O++){var U=F[O];if(!(U instanceof ta)||U.mask||U.blendMode>I.LM_LAST_CHIBIPAINT)throw Error("Bad layer type during multiply upgrade");U.blendMode===I.LM_MULTIPLY&&(P=O)}if(-1!==P){O=new C(this.width,this.height);let Y=U=!0,la=this.getBounds();O.clearAll(la,16777215);for(let Ka=0;Ka<=P;Ka++){let fb=F[Ka];Y||(U=U&&O.hasAlphaInRect(la));fb.blendMode===I.LM_MULTIPLY&&("bake"===w?!U&&fb.getEffectiveAlpha()>0&&(100===fb.alpha?I.upgradeMultiplyOfOpaqueLayer(O,fb.image,100,la):I.upgradeMultiplyOfTransparentLayer(O,
fb.image,fb.alpha,la),fb.setBlendMode(I.LM_MULTIPLY2)):U&&fb.setBlendMode(I.LM_MULTIPLY2));fb.getEffectiveAlpha()>0&&(Y=!1,I.fuseImageOntoImage(O,U,fb.image,fb.alpha,fb.blendMode,la,null))}}};this.isCreateClippingMaskAllowed=function(){var w=S.parent.indexOf(S);w=S.parent.layers[w-1];return S instanceof ta&&!S.clip&&w instanceof ta};this.createClippingMask=function(){this.isCreateClippingMaskAllowed()&&x(new Nb(S,!0))};this.isReleaseClippingMaskAllowed=function(){return S instanceof ta&&S.clip};this.releaseClippingMask=
function(){this.isReleaseClippingMaskAllowed()&&x(new Nb(S,!1))};this.setActiveLayer=function(w,F){if(w){let P=(F=w.mask&&F)!=va;if(S!=w||P){let O=S;S=w;va=F;v();this.emitEvent("changeActiveLayer",[O,w,va]);P&&this.emitEvent("editModeChanged",[va?cc.EDITING_MODE_MASK:cc.EDITING_MODE_IMAGE]);ab&&ab.layer==O&&(F?ab.setLayer(w):this.closeMaskView())}}};this.closeMaskView=function(){ab.close();ab=null};this.toggleMaskView=function(){return null!=ab&&ab.isOpen()?this.closeMaskView():ab=S.mask?new Uf(S,
m):null,ab};this.selectTopmostVisibleLayer=function(){let w=ra.getLinearizedLayerList(!1);for(var F=w.length-1;F>=0;F--)if(w[F]instanceof ta&&w[F].getEffectiveAlpha()>0)return void this.setActiveLayer(w[F],!1);for(F=w.length-1;F>=0;F--)if(w[F]instanceof ta)return void this.setActiveLayer(w[F],!1);this.setActiveLayer(w[w.length-1],!1)};this.getActiveLayer=function(){return S};this.isEditingMask=function(){return va};this.isActiveLayerDrawable=function(){return va&&S.mask||!va&&S instanceof ta};this.getUndoMemoryUsed=
function(){let w=0;for(let F of ic)w+=F.getMemoryUsed(!0,null);for(let F of rb)w+=F.getMemoryUsed(!1,null);return w};this.isUndoAllowed=function(){return rb.length>0};this.isRedoAllowed=function(){return ic.length>0};this.undo=function(){if(this.isUndoAllowed()){this.setHasUnsavedChanges(!0);var w=rb.pop();w.undo();ic.push(w)}};this.redo=function(){if(this.isRedoAllowed()){this.setHasUnsavedChanges(!0);var w=ic.pop();w.redo();rb.push(w)}};this.performIdleTasks=function(){t();m();ub.buildTree()};this.compactUndo=
function(){rb.length>0&&rb[rb.length-1].compact()};this.clearHistory=function(){rb=[];ic=[]};this.colorPicker=function(w,F){return va&&S.mask?db.greyToRGB(S.mask.getPixel(~~w,~~F)):16777215&Cb.getPixel(~~w,~~F)};this.setSelection=function(w){xb.set(w);xb.roundNearest();xb.clipTo(this.getBounds())};this.emptySelection=function(){xb.makeEmpty()};this.floodFill=function(w,F,P=0,O=255,U=!0){U=!va&&U?this.fusionLayers():null;let Y=f();Y&&(t(),ib=this.getBounds(),Y.floodFillWithBorder(~~w,~~F,4278190080|
Ib,P,O,U),x(new A),l(S,this.getBounds()))};this.gradientFill=function(w,F,P,O,U){let Y=this.getSelectionAutoSelect(),la=f();la&&(t(),ib=Y.clone(),la.gradient(Y,w,F,P,O,U,!1),this.getLayerLockAlpha()&&la instanceof C&&la.copyAlphaFrom(mb,Y),x(new A),l(S,Y))};this.fill=function(w,F){let P=this.getSelectionAutoSelect(),O=f(),U=this.texture;if(O){t();ib=P.clone();if(U&&!F){F=U.width;let fb=U.height,Jb=P.right-P.left,Qb=P.bottom-P.top;for(let Rb=0;Rb<Qb;Rb++)for(let sb=0;sb<Jb;sb++){var Y,la,Ka;let tb=
P.left+sb,Kb=P.top+Rb,Xb=1-U.data[Kb%fb*F+tb%F]/255,kc=(255&((Y=w)>>24&255)*(la=Xb)+((Ka=O.getPixel(tb,Kb))>>24&255)*(1-la))<<24|(255&(Y>>16&255)*la+(Ka>>16&255)*(1-la))<<16|(255&(Y>>8&255)*la+(Ka>>8&255)*(1-la))<<8|255&(255&Y)*la+(255&Ka)*(1-la);O.setPixel(tb,Kb,kc)}}else O.clearRect(P,w);x(new A);l(S,P)}};this.clear=function(w=!0){va?this.fill(0,w):this.fill(16777215,w)};this.flip=function(w){let F=this.getSelection(),P=F.isEmpty();var O=P&&S instanceof ta&&S.mask&&S.maskLinked;let U=(!va||O)&&
S instanceof ta;O=(va||O)&&S.mask;w=w?"copyRegionHFlip":"copyRegionVFlip";(U||O)&&(P&&(F=this.getBounds()),ib=F.clone(),U&&(r(),S.image[w](F,mb)),O&&(q(),S.mask[w](F,Aa)),x(new A(U,O)),k(S,F,U,O))};this.hFlip=function(){this.flip(!0)};this.vFlip=function(){this.flip(!1)};this.monochromaticNoise=function(){let w=this.getSelectionAutoSelect(),F=f();F&&(t(),ib=w.clone(),F.fillWithNoise(w),x(new A),l(S,w))};this.isColorNoiseAllowed=function(){return!this.isEditingMask()&&this.isActiveLayerDrawable()};
this.colorNoise=function(){if(this.isColorNoiseAllowed()){let w=this.getSelectionAutoSelect();t();ib=w.clone();S.image.fillWithColorNoise(w);x(new A(!0,!1));k(S,w,!0,!1)}};this.invert=function(){let w=this.getSelectionAutoSelect(),F=f();F&&(t(),ib=w.clone(),F.invert(w),x(new A),l(S,w))};this.brightnessToOpacity=function(){let w=this.getSelectionAutoSelect(),F=f();F&&(t(),ib=w.clone(),F.brightnessToOpacity(w),x(new A),l(S,w))};this.boxBlur=function(w,F,P){let O=this.getSelectionAutoSelect(),U=f();
if(U){t();ib=O.clone();for(let Y=0;Y<P;Y++)U.boxBlur(O,w,F);x(new A);l(S,O)}};this.chromaticAberration=function(w,F=!1){if(F)x(new ba(w));else{F=this.getSelectionAutoSelect();let P=f();P&&(t(),ib=F.clone(),P.chromaticAberration(F,w),x(new A),l(S,F))}};this.rectangleSelection=function(w){w=w.clone();w.clipTo(this.getBounds());x(new H(this.getSelection(),w));this.setSelection(w)};this.move=function(w,F,P){if(F|=0,0!=(w|=0)||0!=F){var O=rb.length>0?rb[rb.length-1]:null;!P&&O instanceof sc&&O.layer==
this.getActiveLayer()?(O.amend(w,F),ic=[],this.setHasUnsavedChanges(!0)):(w=new sc(w,F,P),x(w),w.redo())}};this.setTransformInterpolation=function(w){Gb=w;gb instanceof Yb&&gb.setInterpolation(w)};this.transformAffineAbort=function(){gb instanceof Yb&&(gb.undo(),gb=null,d(!0))};this.transformAffineBegin=function(){if(gb instanceof Yb)return{transform:gb.getTransform(),rect:gb.getInitialTransformRect(),selection:gb.getInitialSelectionRect()};let w=new lb,F;return(F=new Yb(w,Gb)).getInitialTransformRect().isEmpty()?
null:(gb=F,fc=!0,{transform:w,rect:F.getInitialTransformRect(),selection:F.getInitialSelectionRect()})};this.transformAffineFinish=function(){gb instanceof Yb&&(x(gb),gb=null,d(!0))};this.transformAffineAmend=function(w){gb instanceof Yb&&gb.amend(w)};this.isCopySelectionAllowed=this.isCutSelectionAllowed=function(){return!this.getSelection().isEmpty()&&null!==f()};this.cutSelection=function(){this.isCutSelectionAllowed()&&x(new T(S,va,this.getSelection()))};this.copySelection=function(){if(this.isCopySelectionAllowed()){let w=
Z.getSelection();jb=new Zd(f().cloneRect(w),w.left,w.top)}};this.isCopySelectionMergedAllowed=function(){return!this.getSelection().isEmpty()};this.copySelectionMerged=function(){if(this.isCopySelectionMergedAllowed()){let w=Z.getSelection();jb=new Zd(this.fusionLayers().cloneRect(w),w.left,w.top)}};this.isPasteClipboardAllowed=function(){return!this.isClipboardEmpty()};this.pasteClipboard=function(){this.isPasteClipboardAllowed()&&x(new Ca(jb))};this.getClipboard=function(){return jb};this.setClipboard=
function(w){jb=w};this.isClipboardEmpty=function(){return null==jb};this.setSampleAllLayers=function(w){nb=w};this.getLayerLockAlpha=function(){return this.getActiveLayer().getLockAlpha()};this.setLayerLockAlpha=function(w){S.getLockAlpha()!=w&&x(new Bc(S,w))};this.setForegroundColor=function(w){Ib=w};this.setBrush=function(w){eb=w};this.setBrushTexture=function(w){$a.setTexture(w);this.texture=w};this.beginStroke=function(w,F,P){return null!==eb&&!!this.isActiveLayerDrawable()&&(t(),ib.makeEmpty(),
da.clearAll(0),wa.makeEmpty(),bb=w,Qa=F,Db=P,fc=!0,ea[eb.brushMode].beginStroke(),this.paintDab(w,F,P),!0)};this.continueStroke=function(w,F,P){if(null!=eb){var O=Math.sqrt((bb-w)*(bb-w)+(Qa-F)*(Qa-F)),U=Math.max(eb.minSpacing,eb.curSize*eb.spacing);if(O>U){let Y=bb,la=Qa,Ka=Db;O=(U-.001)/O;for(U=O;U<=1;U+=O)Y=U*w+(1-U)*bb,la=U*F+(1-U)*Qa,Ka=U*P+(1-U)*Db,this.paintDab(Y,la,Ka);bb=Y;Qa=la;Db=Ka}}};this.endStroke=function(){null!=eb&&(m(),ea[eb.brushMode].endStroke(),ib.clipTo(this.getBounds()),ib.isEmpty()||
(x(new A),t()),d(!1))};this.hasAlpha=function(){return Cb.hasAlpha()};this.getFlatPNG=function(w){return this.fusionLayers(),Cb.getAsPNG(w)};this.getFlatPNGBuffer=function(w){return this.fusionLayers(),Cb.getAsPNGBuffer(w)};this.isSimpleDrawing=function(){return 1==ra.layers.length&&ra.layers[0]instanceof ta&&!ra.layers[0].mask&&100==ra.layers[0].getEffectiveAlpha()};A.prototype=Object.create(Vb.prototype);A.prototype.constructor=A;B.prototype=Object.create(Vb.prototype);B.prototype.constructor=B;
y.prototype=Object.create(Vb.prototype);y.prototype.constructor=y;E.prototype=Object.create(Vb.prototype);E.prototype.constructor=E;G.prototype=Object.create(Vb.prototype);G.prototype.constructor=G;M.prototype=Object.create(Vb.prototype);M.prototype.constructor=M;L.prototype=Object.create(Vb.prototype);L.prototype.constructor=L;J.prototype=Object.create(Vb.prototype);J.prototype.constructor=J;W.prototype=Object.create(Vb.prototype);W.prototype.constructor=W;ba.prototype=Object.create(Vb.prototype);
ba.prototype.constructor=ba;ma.prototype=Object.create(Vb.prototype);ma.prototype.constructor=ma;let Ac=na("alpha",!0),rc=na("blendMode",!0),fa=na("visible",!0),Nb=na("clip",!0),jc=na("maskVisible",!0),Wb=na("name",!1),Bc=na("lockAlpha",!1),Fa=na("maskLinked",!1);H.prototype=Object.create(Vb.prototype);H.prototype.constructor=H;class mc extends Vb{undo(){let w=[];this.dstRect.isEmpty()||w.push(this.dstRect);this.erasesSourceRect&&(w.push(this.srcRect),w=pa.union(w));this.movingLayers.forEach(F=>{this.hasFullUndo?
w.forEach(P=>{F.moveImage&&F.layer.image.copyBitmapRect(F.imageUndo,P.left,P.top,P);F.moveMask&&F.layer.mask.copyBitmapRect(F.maskUndo,P.left,P.top,P)}):(F.moveImage&&F.imageRect.forEach((P,O)=>{F.layer.image.copyBitmapRect(P,O.left,O.top,P.getBounds())}),F.moveMask&&F.maskRect.forEach((P,O)=>{F.layer.mask.copyBitmapRect(P,O.left,O.top,P.getBounds())}))});k(this.movingLayers.map(F=>F.layer),w.reduce((F,P)=>F.getUnion(P),new pa(0,0,0,0)),!0,!0);this.dstRect.makeEmpty();Z.setSelection(this.fromSelection);
Z.setActiveLayer(this.layer,this.fromMaskMode);b()}getMemoryUsed(w,F){return this.movingLayers.map(function(P){return[P.imageUndo,P.maskUndo,P.imageRect,P.maskRect].map(O=>O?O.getMemorySize():0).reduce(yd,0)}).reduce(yd,0)}buildFullUndo(){this.hasFullUndo||(this.movingLayers.forEach(function(w){w.moveImage&&(w.imageUndo=w.layer.image.clone());w.moveMask&&(w.maskUndo=w.layer.mask.clone());w.imageRect.clear();w.maskRect.clear()}),this.hasFullUndo=!0)}compact(){if(this.hasFullUndo){let w=[];this.dstRect.isEmpty()||
w.push(this.dstRect);this.erasesSourceRect&&(w.push(this.srcRect),w=pa.union(w));this.movingLayers.forEach(F=>{F.imageRect.clear();F.maskRect.clear();w.forEach(P=>{F.moveImage&&F.imageRect.set(P,F.imageUndo.cloneRect(P));F.moveMask&&F.maskRect.set(P,F.maskUndo.cloneRect(P))});F.imageUndo=null;F.maskUndo=null});this.hasFullUndo=!1}}constructor(){super();this.layer=S;this.fromSelection=Z.getSelection();this.fromMaskMode=va;this.movingWholeLayer=this.fromSelection.isEmpty();this.movingImage=!va||this.movingWholeLayer&&
this.layer.maskLinked;this.movingMask=va||this.movingWholeLayer&&this.layer.maskLinked;this.erasesSourceRect=this.hasFullUndo=!1;this.dstRect=new pa(0,0,0,0);this.movingLayers=[{layer:this.layer,moveImage:this.layer instanceof ta&&this.movingImage,moveMask:null!==this.layer.mask&&this.movingMask,imageRect:new Map,maskRect:new Map}];this.layer instanceof Ua&&this.movingImage&&this.movingWholeLayer&&(this.movingLayers=this.movingLayers.concat(this.layer.getLinearizedLayerList(!1).map(O=>({layer:O,moveImage:O instanceof
ta,moveMask:null!==O.mask&&O.maskLinked,imageRect:new Map,maskRect:new Map}))));let w=new pa(0,0,0,0);if(this.movingWholeLayer){this.srcRect=Z.getBounds();for(var F=0;F<this.movingLayers.length&&!w.equals(this.srcRect);F++){var P=this.movingLayers[F];P.moveMask&&w.union(P.layer.mask.getValueBounds(this.srcRect,255));P.moveImage&&w.union(P.layer.image.getNonTransparentBounds(this.srcRect))}}else for(this.srcRect=this.fromSelection.clone(),F=0;F<this.movingLayers.length&&!w.equals(this.srcRect);F++)P=
this.movingLayers[F],P.moveMask&&w.union(P.layer.mask.getValueBounds(this.srcRect,0)),P.moveImage&&w.union(P.layer.image.getNonTransparentBounds(this.srcRect));this.srcRect=w}}class Yb extends mc{buildFullUndo(){this.hasFullUndo||(super.buildFullUndo(),this.movingLayers.forEach(w=>{if(w.moveImage){var F=Nc(this.srcRect.getWidth(),this.srcRect.getHeight());F.getContext("2d").putImageData(w.layer.image.getImageData(),-this.srcRect.left,-this.srcRect.top,this.srcRect.left,this.srcRect.top,this.srcRect.getWidth(),
this.srcRect.getHeight());w.imageSourceCanvas=F}w.moveMask&&(F=Nc(this.srcRect.getWidth(),this.srcRect.getHeight()),F.getContext("2d").putImageData(w.layer.mask.getImageData(this.srcRect.left,this.srcRect.top,this.srcRect.getWidth(),this.srcRect.getHeight()),0,0),w.maskSourceCanvas=F)}),this.composeCanvas=Nc(Z.width,Z.height),this.composeCanvasContext=this.composeCanvas.getContext("2d",{willReadFrequently:!0}),this.composeCanvasContext.imageSmoothingEnabled="smooth"===this.interpolation,this.junk=
this.composeCanvasContext.getImageData(0,0,1,1))}redo(){this.buildFullUndo();var w=this.dstRect.clone();let F=this.srcRect.toPoints();this.affineTransform.transformPoints(F);this.dstRect.set(pa.createBoundingBox(F).roundContain().clipTo(Z.getBounds()));let P=pa.subtract(this.dstRect,this.srcRect),O=pa.subtract(w.isEmpty()?this.srcRect:this.srcRect.getIntersection(w),this.dstRect),U=this.srcRect.getIntersection(this.dstRect),Y=pa.subtract(w,[this.dstRect,this.srcRect]);w=this.srcRect.getUnion(this.dstRect).getUnion(w);
(this.movingLayers.forEach(la=>{if(O.forEach(Ka=>{la.moveImage&&la.layer.image.clearRect(Ka,16777215);la.moveMask&&(this.movingWholeLayer?la.layer.mask.clearRect(Ka,255):la.layer.mask.clearRect(Ka,0))}),!this.dstRect.isEmpty()){if(la.moveImage){let Ka=la.imageUndo.getImageData();P.forEach(fb=>{this.composeCanvasContext.putImageData(Ka,0,0,fb.left,fb.top,fb.getWidth(),fb.getHeight())});this.composeCanvasContext.clearRect(U.left,U.top,U.getWidth(),U.getHeight());this.composeCanvasContext.save();this.composeCanvasContext.setTransform(this.affineTransform.m[0],
this.affineTransform.m[1],this.affineTransform.m[2],this.affineTransform.m[3],this.affineTransform.m[4],this.affineTransform.m[5]);this.composeCanvasContext.drawImage(la.imageSourceCanvas,this.srcRect.left,this.srcRect.top);this.composeCanvasContext.restore();la.layer.image.copyBitmapRect(new C(this.composeCanvasContext.getImageData(this.dstRect.left,this.dstRect.top,this.dstRect.getWidth(),this.dstRect.getHeight())),this.dstRect.left,this.dstRect.top,new pa(0,0,this.dstRect.getWidth(),this.dstRect.getHeight()))}la.moveMask&&
(P.forEach(Ka=>{this.composeCanvasContext.putImageData(la.layer.mask.getImageData(Ka.left,Ka.top,Ka.getWidth(),Ka.getHeight()),Ka.left,Ka.top)}),this.movingWholeLayer?this.composeCanvasContext.fillStyle="#FFF":this.composeCanvasContext.fillStyle="#000",this.composeCanvasContext.fillRect(U.left,U.top,U.getWidth(),U.getHeight()),this.composeCanvasContext.save(),this.composeCanvasContext.setTransform(this.affineTransform.m[0],this.affineTransform.m[1],this.affineTransform.m[2],this.affineTransform.m[3],
this.affineTransform.m[4],this.affineTransform.m[5]),this.composeCanvasContext.drawImage(la.maskSourceCanvas,this.srcRect.left,this.srcRect.top),this.composeCanvasContext.restore(),la.layer.mask.pasteImageData(this.composeCanvasContext.getImageData(this.dstRect.left,this.dstRect.top,this.dstRect.getWidth(),this.dstRect.getHeight()),this.dstRect.left,this.dstRect.top))}Y.forEach(Ka=>{la.moveImage&&la.layer.image.copyBitmapRect(la.imageUndo,Ka.left,Ka.top,Ka);la.moveMask&&la.layer.mask.copyBitmapRect(la.maskUndo,
Ka.left,Ka.top,Ka)})}),k(this.movingLayers.map(la=>la.layer),w,!0,!0),this.fromSelection.isEmpty())||(w=this.fromSelection.toPoints(),this.affineTransform.transformPoints(w),(w=pa.createBoundingBox(w)).roundNearest(),Z.setSelection(w),b());Z.setActiveLayer(this.layer,this.fromMaskMode)}amend(w){this.hasFullUndo||this.undo();this.affineTransform=w.clone();this.redo()}setInterpolation(w){w!=this.interpolation&&(this.interpolation=w,this.composeCanvasContext&&(this.composeCanvasContext.imageSmoothingEnabled=
"smooth"==this.interpolation),this.undo(),this.redo())}compact(){super.compact();this.composeCanvasContext=this.composeCanvas=null;this.movingLayers.forEach(w=>w.imageSourceCanvas=null)}getMemoryUsed(w,F){w=super.getMemoryUsed(w,F);return w+=He(this.composeCanvas),w+=this.movingLayers.map(P=>He(P.imageSourceCanvas)).reduce(yd,0)}getTransform(){return this.affineTransform.clone()}getInitialTransformRect(){return this.srcRect.clone()}getInitialSelectionRect(){return this.fromSelection.clone()}constructor(w,
F){super();this.erasesSourceRect=!0;this.affineTransform=w.clone();this.interpolation=F||"smooth";this.composeCanvasContext=this.composeCanvas=null}}class sc extends mc{redo(){var w=this.dstRect.clone();let F,P,O=w.clone(),U=null;(this.buildFullUndo(),this.dstRect.set(this.srcRect),this.dstRect.translate(this.offsetX,this.offsetY),F=this.dstRect.clone(),this.dstRect.clipTo(Z.getBounds()),this.erasesSourceRect?(U=w.isEmpty()?this.srcRect:this.srcRect.getIntersection(w),O.union(U),P=w.subtract(this.srcRect)):
P=[w],this.movingLayers.forEach(Y=>{U&&(Y.moveImage&&Y.layer.image.clearRect(U,16777215),Y.moveMask&&Y.layer.mask.clearRect(U,255*!!this.movingWholeLayer));P.forEach(function(la){Y.moveImage&&Y.layer.image.copyBitmapRect(Y.imageUndo,la.left,la.top,la);Y.moveMask&&Y.layer.mask.copyBitmapRect(Y.maskUndo,la.left,la.top,la)});Y.moveImage&&I.normalFuseImageOntoImageAtPosition(Y.layer.image,Y.imageUndo,F.left,F.top,this.srcRect);Y.moveMask&&Y.layer.mask.copyBitmapRect(Y.maskUndo,F.left,F.top,this.srcRect)}),
O.union(this.dstRect),k(this.movingLayers.map(Y=>Y.layer),O,!0,!0),this.fromSelection.isEmpty())||(w=this.fromSelection.clone(),w.translate(this.offsetX,this.offsetY),Z.setSelection(w),b())}amend(w,F){this.hasFullUndo||this.undo();this.offsetX+=w;this.offsetY+=F;this.redo()}constructor(w,F,P){super();this.offsetX=w;this.offsetY=F;this.erasesSourceRect=!P}}T.prototype=Object.create(Vb.prototype);T.prototype.constructor=T;Ca.prototype=Object.create(Vb.prototype);Ca.prototype.constructor=Ca;ea=[Wc,Vf,
Wf,Xf,id,Yf,Zf,$f].map(w=>new w(da,wa));this.width=a;this.height=c}function Ya(a,c,d){this.data=a;this.eof=!1;this.start=void 0===c?0:c;this.end=void 0===d?a.length:d;this.pos=this.start}function Xc(a){for(var c=a.length;--c>=0;)a[c]=0}function $d(a,c,d,b,h){this.static_tree=a;this.extra_bits=c;this.extra_base=d;this.elems=b;this.max_length=h;this.has_stree=a&&a.length}function ae(a,c){this.dyn_tree=a;this.max_code=0;this.stat_desc=c}function Ie(a){return a<256?jd[a]:jd[256+(a>>>7)]}function kd(a,
c){a.pending_buf[a.pending++]=255&c;a.pending_buf[a.pending++]=c>>>8&255}function dc(a,c,d){a.bi_valid>16-d?(a.bi_buf|=c<<a.bi_valid&65535,kd(a,a.bi_buf),a.bi_buf=c>>16-a.bi_valid,a.bi_valid+=d-16):(a.bi_buf|=c<<a.bi_valid&65535,a.bi_valid+=d)}function tc(a,c,d){dc(a,d[2*c],d[2*c+1])}function Je(a,c){var d=0;do d|=1&a,a>>>=1,d<<=1;while(--c>0);return d>>>1}function Ke(a,c,d){var b,h=Array(16),n=0;for(b=1;b<=15;b++)h[b]=n=n+d[b-1]<<1;for(d=0;d<=c;d++)b=a[2*d+1],0!==b&&(a[2*d]=Je(h[b]++,b))}function Le(a){var c;
for(c=0;c<286;c++)a.dyn_ltree[2*c]=0;for(c=0;c<30;c++)a.dyn_dtree[2*c]=0;for(c=0;c<19;c++)a.bl_tree[2*c]=0;a.dyn_ltree[512]=1;a.opt_len=a.static_len=0;a.last_lit=a.matches=0}function Me(a){a.bi_valid>8?kd(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf);a.bi_buf=0;a.bi_valid=0}function Ne(a,c,d,b){var h=2*c,n=2*d;return a[h]<a[n]||a[h]===a[n]&&b[c]<=b[d]}function be(a,c,d){for(var b=a.heap[d],h=d<<1;h<=a.heap_len&&(h<a.heap_len&&Ne(c,a.heap[h+1],a.heap[h],a.depth)&&h++,!Ne(c,b,a.heap[h],
a.depth));)a.heap[d]=a.heap[h],d=h,h<<=1;a.heap[d]=b}function Oe(a,c,d){var b,h,n=0;if(0!==a.last_lit){do{var g=a.pending_buf[a.d_buf+2*n]<<8|a.pending_buf[a.d_buf+2*n+1];var e=a.pending_buf[a.l_buf+n];n++;0===g?tc(a,e,c):(tc(a,(b=ld[e])+256+1,c),0!==(h=ce[b])&&dc(a,e-de[b],h),tc(a,b=Ie(--g),d),0!==(h=zd[b])&&dc(a,g-Ad[b],h))}while(n<a.last_lit)}tc(a,256,c)}function ee(a,c){var d,b=c.dyn_tree;var h=c.stat_desc.static_tree;var n=c.stat_desc.has_stree,g=c.stat_desc.elems,e=-1;var k=0;a.heap_len=0;for(a.heap_max=
573;k<g;k++)0!==b[2*k]?(a.heap[++a.heap_len]=e=k,a.depth[k]=0):b[2*k+1]=0;for(;a.heap_len<2;)b[2*(d=a.heap[++a.heap_len]=e<2?++e:0)]=1,a.depth[d]=0,a.opt_len--,n&&(a.static_len-=h[2*d+1]);c.max_code=e;for(k=a.heap_len>>1;k>=1;k--)be(a,b,k);d=g;do k=a.heap[1],a.heap[1]=a.heap[a.heap_len--],be(a,b,1),h=a.heap[1],a.heap[--a.heap_max]=k,a.heap[--a.heap_max]=h,b[2*d]=b[2*k]+b[2*h],a.depth[d]=(a.depth[k]>=a.depth[h]?a.depth[k]:a.depth[h])+1,b[2*k+1]=b[2*h+1]=d,a.heap[1]=d++,be(a,b,1);while(a.heap_len>=
2);a.heap[--a.heap_max]=a.heap[1];var l,f,m,r,q;k=c.dyn_tree;d=c.max_code;h=c.stat_desc.static_tree;n=c.stat_desc.has_stree;g=c.stat_desc.extra_bits;var t=c.stat_desc.extra_base,v=c.stat_desc.max_length,x=0;for(m=0;m<=15;m++)a.bl_count[m]=0;k[2*a.heap[a.heap_max]+1]=0;for(c=a.heap_max+1;c<573;c++)(m=k[2*k[2*(l=a.heap[c])+1]+1]+1)>v&&(m=v,x++),k[2*l+1]=m,l>d||(a.bl_count[m]++,r=0,l>=t&&(r=g[l-t]),q=k[2*l],a.opt_len+=q*(m+r),!n||(a.static_len+=q*(h[2*l+1]+r)));if(0!==x){do{for(m=v-1;0===a.bl_count[m];)m--;
a.bl_count[m]--;a.bl_count[m+1]+=2;a.bl_count[v]--;x-=2}while(x>0);for(m=v;0!==m;m--)for(l=a.bl_count[m];0!==l;)(f=a.heap[--c])>d||(k[2*f+1]!==m&&(a.opt_len+=(m-k[2*f+1])*k[2*f],k[2*f+1]=m),l--)}Ke(b,e,a.bl_count)}function Pe(a,c,d){var b,h=-1,n=c[1],g=0,e=7,k=4;0===n&&(e=138,k=3);c[(d+1)*2+1]=65535;for(b=0;b<=d;b++){var l=n;n=c[(b+1)*2+1];++g<e&&l===n||(g<k?a.bl_tree[2*l]+=g:0!==l?(l!==h&&a.bl_tree[2*l]++,a.bl_tree[32]++):g<=10?a.bl_tree[34]++:a.bl_tree[36]++,g=0,h=l,0===n?(e=138,k=3):l===n?(e=6,
k=3):(e=7,k=4))}}function Qe(a,c,d){var b,h,n=-1,g=c[1],e=0,k=7,l=4;0===g&&(k=138,l=3);for(b=0;b<=d;b++)if(h=g,g=c[(b+1)*2+1],!(++e<k)||h!==g){if(e<l){do tc(a,h,a.bl_tree);while(0!=--e)}else 0!==h?(h!==n&&(tc(a,h,a.bl_tree),e--),tc(a,16,a.bl_tree),dc(a,e-3,2)):e<=10?(tc(a,17,a.bl_tree),dc(a,e-3,3)):(tc(a,18,a.bl_tree),dc(a,e-11,7));e=0;n=h;0===g?(k=138,l=3):h===g?(k=6,l=3):(k=7,l=4)}}function Re(a,c,d,b){dc(a,+!!b,3);Me(a);kd(a,d);kd(a,~d);Ga.arraySet(a.pending_buf,a.window,c,d,a.pending);a.pending+=
d}function Cc(a,c){return a.msg=Oc[c],c}function Dc(a){for(var c=a.length;--c>=0;)a[c]=0}function Ec(a){var c=a.state,d=c.pending;d>a.avail_out&&(d=a.avail_out);0!==d&&(Ga.arraySet(a.output,c.pending_buf,c.pending_out,d,a.next_out),a.next_out+=d,c.pending_out+=d,a.total_out+=d,a.avail_out-=d,c.pending-=d,0===c.pending&&(c.pending_out=0))}function Tb(a,c){ag(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,c);a.block_start=a.strstart;Ec(a.strm)}function hb(a,c){a.pending_buf[a.pending++]=
c}function md(a,c){a.pending_buf[a.pending++]=c>>>8&255;a.pending_buf[a.pending++]=255&c}function Se(a,c){var d,b,h=a.max_chain_length,n=a.strstart,g=a.prev_length,e=a.nice_match,k=a.strstart>a.w_size-262?a.strstart-(a.w_size-262):0,l=a.window,f=a.w_mask,m=a.prev,r=a.strstart+258,q=l[n+g-1],t=l[n+g];a.prev_length>=a.good_match&&(h>>=2);e>a.lookahead&&(e=a.lookahead);do if(l[(d=c)+g]===t&&l[d+g-1]===q&&l[d]===l[n]&&l[++d]===l[n+1]){n+=2;for(d++;l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===
l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&l[++n]===l[++d]&&n<r;);if(b=258-(r-n),n=r-258,b>g){if(a.match_start=c,g=b,b>=e)break;q=l[n+g-1];t=l[n+g]}}while((c=m[c&f])>k&&0!=--h);return g<=a.lookahead?g:a.lookahead}function Pc(a){var c,d,b=a.w_size;do{if(d=a.window_size-a.lookahead-a.strstart,a.strstart>=b+(b-262)){Ga.arraySet(a.window,a.window,b,b,0);a.match_start-=b;a.strstart-=b;a.block_start-=b;var h=c=a.hash_size;do{var n=a.head[--h];a.head[h]=n>=b?n-b:0}while(--c);h=c=b;do n=a.prev[--h],
a.prev[h]=n>=b?n-b:0;while(--c);d+=b}if(0===a.strm.avail_in)break;h=a.strm;n=a.window;var g=a.strstart+a.lookahead,e=h.avail_in;if(c=(e>d&&(e=d),0===e)?0:(h.avail_in-=e,Ga.arraySet(n,h.input,h.next_in,e,g),1===h.state.wrap?h.adler=Yc(h.adler,n,e,g):2===h.state.wrap&&(h.adler=Lb(h.adler,n,e,g)),h.next_in+=e,h.total_in+=e,e),a.lookahead+=c,a.lookahead+a.insert>=3)for(d=a.strstart-a.insert,a.ins_h=a.window[d],a.ins_h=(a.ins_h<<a.hash_shift^a.window[d+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^
a.window[d+3-1])&a.hash_mask,a.prev[d&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=d,d++,a.insert--,!(a.lookahead+a.insert<3)););}while(a.lookahead<262&&0!==a.strm.avail_in)}function fe(a,c){for(var d,b;;){if(a.lookahead<262){if(Pc(a),a.lookahead<262&&0===c)return 1;if(0===a.lookahead)break}if(d=0,a.lookahead>=3&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==d&&a.strstart-d<=a.w_size-262&&(a.match_length=
Se(a,d)),a.match_length>=3)if(b=Fc(a,a.strstart-a.match_start,a.match_length-3),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=3){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!=--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+
1])&a.hash_mask;else b=Fc(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(b&&(Tb(a,!1),0===a.strm.avail_out))return 1}return(a.insert=a.strstart<2?a.strstart:2,4===c)?(Tb(a,!0),0===a.strm.avail_out)?3:4:a.last_lit&&(Tb(a,!1),0===a.strm.avail_out)?1:2}function Zc(a,c){for(var d,b,h;;){if(a.lookahead<262){if(Pc(a),a.lookahead<262&&0===c)return 1;if(0===a.lookahead)break}if(d=0,a.lookahead>=3&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,d=a.prev[a.strstart&a.w_mask]=
a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=2,0!==d&&a.prev_length<a.max_lazy_match&&a.strstart-d<=a.w_size-262&&(a.match_length=Se(a,d),a.match_length<=5&&(1===a.strategy||3===a.match_length&&a.strstart-a.match_start>4096)&&(a.match_length=2)),a.prev_length>=3&&a.match_length<=a.prev_length){h=a.strstart+a.lookahead-3;b=Fc(a,a.strstart-1-a.prev_match,a.prev_length-3);a.lookahead-=a.prev_length-1;a.prev_length-=2;do++a.strstart<=
h&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!=--a.prev_length);if(a.match_available=0,a.match_length=2,a.strstart++,b&&(Tb(a,!1),0===a.strm.avail_out))return 1}else if(a.match_available){if(Fc(a,0,a.window[a.strstart-1])&&Tb(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return 1}else a.match_available=1,a.strstart++,a.lookahead--}return(a.match_available&&(Fc(a,0,a.window[a.strstart-
1]),a.match_available=0),a.insert=a.strstart<2?a.strstart:2,4===c)?(Tb(a,!0),0===a.strm.avail_out)?3:4:a.last_lit&&(Tb(a,!1),0===a.strm.avail_out)?1:2}function uc(a,c,d,b,h){this.good_length=a;this.max_lazy=c;this.nice_length=d;this.max_chain=b;this.func=h}function bg(){this.strm=null;this.status=0;this.pending_buf=null;this.wrap=this.pending=this.pending_out=this.pending_buf_size=0;this.gzhead=null;this.gzindex=0;this.method=8;this.last_flush=-1;this.w_mask=this.w_bits=this.w_size=0;this.window=
null;this.window_size=0;this.head=this.prev=null;this.nice_match=this.good_match=this.strategy=this.level=this.max_lazy_match=this.max_chain_length=this.prev_length=this.lookahead=this.match_start=this.strstart=this.match_available=this.prev_match=this.match_length=this.block_start=this.hash_shift=this.hash_mask=this.hash_bits=this.hash_size=this.ins_h=0;this.dyn_ltree=new Ga.Buf16(1146);this.dyn_dtree=new Ga.Buf16(122);this.bl_tree=new Ga.Buf16(78);Dc(this.dyn_ltree);Dc(this.dyn_dtree);Dc(this.bl_tree);
this.bl_desc=this.d_desc=this.l_desc=null;this.bl_count=new Ga.Buf16(16);this.heap=new Ga.Buf16(573);Dc(this.heap);this.heap_max=this.heap_len=0;this.depth=new Ga.Buf16(573);Dc(this.depth);this.bi_valid=this.bi_buf=this.insert=this.matches=this.static_len=this.opt_len=this.d_buf=this.last_lit=this.lit_bufsize=this.l_buf=0}function Te(a,c){if(c<65534&&(a.subarray&&Ue||!a.subarray&&Ve))return String.fromCharCode.apply(null,Ga.shrinkBuf(a,c));for(var d="",b=0;b<c;b++)d+=String.fromCharCode(a[b]);return d}
function Qc(a){if(!(this instanceof Qc))return new Qc(a);this.options=Ga.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},a||{});var c,d,b;a=this.options;a.raw&&a.windowBits>0?a.windowBits=-a.windowBits:a.gzip&&a.windowBits>0&&a.windowBits<16&&(a.windowBits+=16);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new ge;this.strm.avail_out=0;var h=this.strm;var n=a.level;var g=a.method,e=a.windowBits,k=a.memLevel,l=a.strategy;if(h){var f,m,r,q=1;if(-1===
n&&(n=6),e<0?(q=0,e=-e):e>15&&(q=2,e-=16),k<1||k>9||8!==g||e<8||e>15||n<0||n>9||l<0||l>4)n=Cc(h,-2);else{8===e&&(e=9);var t=new bg;n=(h.state=t,t.strm=h,t.wrap=q,t.gzhead=null,t.w_bits=e,t.w_size=1<<t.w_bits,t.w_mask=t.w_size-1,t.hash_bits=k+7,t.hash_size=1<<t.hash_bits,t.hash_mask=t.hash_size-1,t.hash_shift=~~((t.hash_bits+3-1)/3),t.window=new Ga.Buf8(2*t.w_size),t.head=new Ga.Buf16(t.hash_size),t.prev=new Ga.Buf16(t.w_size),t.lit_bufsize=1<<k+6,t.pending_buf_size=4*t.lit_bufsize,t.pending_buf=new Ga.Buf8(t.pending_buf_size),
t.d_buf=+t.lit_bufsize,t.l_buf=3*t.lit_bufsize,t.level=n,t.strategy=l,t.method=g,0===(r=h&&h.state?(h.total_in=h.total_out=0,h.data_type=2,(f=h.state).pending=0,f.pending_out=0,f.wrap<0&&(f.wrap=-f.wrap),f.status=f.wrap?42:113,h.adler=+(2!==f.wrap),f.last_flush=0,cg(f),0):Cc(h,-2))&&((m=h.state).window_size=2*m.w_size,Dc(m.head),m.max_lazy_match=nd[m.level].max_lazy,m.good_match=nd[m.level].good_length,m.nice_match=nd[m.level].nice_length,m.max_chain_length=nd[m.level].max_chain,m.strstart=0,m.block_start=
0,m.lookahead=0,m.insert=0,m.match_length=m.prev_length=2,m.match_available=0,m.ins_h=0),r)}}else n=-2;if(0!==n)throw Error(Oc[n]);if(a.header&&(c=this.strm,d=a.header,c&&c.state&&2===c.state.wrap&&(c.state.gzhead=d)),a.dictionary){if(b="string"==typeof a.dictionary?he(a.dictionary):"[object ArrayBuffer]"===We.call(a.dictionary)?new Uint8Array(a.dictionary):a.dictionary,0!==(n=dg(this.strm,b)))throw Error(Oc[n]);this._dict_set=!0}}function ie(a,c){c=new Qc(c);if(c.push(a,!0),c.err)throw c.msg||Oc[c.err];
return c.result}function Xe(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function eg(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.total=this.check=this.dmax=this.flags=0;this.head=null;this.wnext=this.whave=this.wsize=this.wbits=0;this.window=null;this.extra=this.offset=this.length=this.bits=this.hold=0;this.distcode=this.lencode=null;this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0;this.next=null;this.lens=new Ga.Buf16(320);this.work=new Ga.Buf16(288);
this.distdyn=this.lendyn=null;this.was=this.back=this.sane=0}function Ye(a,c,d,b){var h;a=a.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Ga.Buf8(a.wsize)),b>=a.wsize?(Ga.arraySet(a.window,c,d-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((h=a.wsize-a.wnext)>b&&(h=b),Ga.arraySet(a.window,c,d-b,h,a.wnext),(b-=h)?(Ga.arraySet(a.window,c,d-b,b,0),a.wnext=b,a.whave=a.wsize):(a.wnext+=h,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=h))),0}function Rc(a){if(!(this instanceof
Rc))return new Rc(a);this.options=Ga.assign({chunkSize:16384,windowBits:0,to:""},a||{});var c,d,b,h,n,g,e,k,l,f=this.options;f.raw&&f.windowBits>=0&&f.windowBits<16&&(f.windowBits=-f.windowBits,0===f.windowBits&&(f.windowBits=-15));f.windowBits>=0&&f.windowBits<16&&(!a||!a.windowBits)&&(f.windowBits+=32);f.windowBits>15&&f.windowBits<48&&(15&f.windowBits)==0&&(f.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new ge;this.strm.avail_out=0;a=(c=this.strm,d=f.windowBits,
c?(c.state=h=new eg,h.window=null,0!==(n=d,b=c&&c.state?(e=c.state,n<0?(g=0,n=-n):(g=(n>>4)+1,n<48&&(n&=15)),n&&(n<8||n>15))?-2:(null!==e.window&&e.wbits!==n&&(e.window=null),e.wrap=g,e.wbits=n,c&&c.state?((k=c.state).wsize=0,k.whave=0,k.wnext=0,c&&c.state?(l=c.state,c.total_in=c.total_out=l.total=0,c.msg="",l.wrap&&(c.adler=1&l.wrap),l.mode=1,l.last=0,l.havedict=0,l.dmax=32768,l.head=null,l.hold=0,l.bits=0,l.lencode=l.lendyn=new Ga.Buf32(852),l.distcode=l.distdyn=new Ga.Buf32(592),l.sane=1,l.back=
-1,0):-2):-2):-2)&&(c.state=null),b):-2);if(a!==Eb.Z_OK||(this.header=new Ze,fg(this.strm,this.header),f.dictionary&&("string"==typeof f.dictionary?f.dictionary=he(f.dictionary):"[object ArrayBuffer]"===$e.call(f.dictionary)&&(f.dictionary=new Uint8Array(f.dictionary)),f.raw)&&(a=af(this.strm,f.dictionary))!==Eb.Z_OK))throw Error(Oc[a]);}function je(a,c){c=new Rc(c);if(c.push(a,!0),c.err)throw c.msg||Oc[c.err];return c.result}function ke(a){this.version=a.readU32BE();this.width=a.readU32BE();this.height=
a.readU32BE();this.layersNb=a.readU32BE()}function Bd(a){let c=[,,,,];for(let d=0;d<c.length;d++)c[d]=String.fromCharCode(a.readByte());if(this.chunkType=c.join(""),this.chunkSize=a.readU32BE(),a.eof)throw"Truncated chunk";}function bf(a){return{major:a>>16&65535,minor:65535&a}}function le(a,c){let d=new Ya(new Uint8Array(Bd.HEADER_LENGTH+c));return d.writeString(a),d.writeU32BE(c),d}function $c(){}function Cd(a){function c(n,g){null===g?h.emitEvent("loadingProgress",[1,"Loading your "+n.friendly+
"..."]):h.emitEvent("loadingProgress",[g,"Loading your "+n.friendly+" ("+Math.round(100*g)+"%)..."])}var d=[],b={},h=this;a.loadChibiFileUrl&&(""+a.loadChibiFileUrl).length>0?d.push({url:a.loadChibiFileUrl,friendly:"drawing layers",name:"layers",required:!0}):a.loadImageUrl&&(""+a.loadImageUrl).length>0&&d.push({url:a.loadImageUrl,friendly:"drawing",name:"flat",required:!0});a.loadSwatchesUrl&&d.push({url:a.loadSwatchesUrl,friendly:"color swatches",name:"swatches",required:!1,noProgress:!0});this.load=
function(){function n(){g.required?h.emitEvent("loadingFailure",["Failed to load your "+g.friendly+", please try again later."]):h.load()}if(0==d.length)return void h.emitEvent("loadingComplete",[b]);var g=d.shift(),e=new XMLHttpRequest;e.addEventListener("progress",function(k){c(g,k.lengthComputable&&!g.noProgress?k.loaded/k.total:null)},!1);e.addEventListener("load",function(k){if(200==this.status){let l=this.response;h.emitEvent("loadingProgress",[1,"Starting ChickenPaint..."]);setTimeout(function(){(function(f,
m){switch(f.name){case "flat":return new Promise(function(r,q){let t=new Blob([m],{type:"image/png"}),v=window.URL.createObjectURL(t);if(v){let x=new Image;x.onload=function(){let A=new cc(this.width,this.height),B=new ta(0,0,"Layer 1");B.image=C.createFromImage(x);A.addLayerObject(A.getLayersRoot(),B);x=null;window.URL.revokeObjectURL(v);r(A)};x.src=v}else q(null)});case "swatches":return(f=(new $c).read(m))?Promise.resolve(f):Promise.reject(null);case "layers":return function(r,q){function t(J){let W;
var ba=L;if(null!==ba&&0!==ba.length)if(null===J||0===J.length)J=ba;else{var ma=new Uint8Array(ba.length+J.length);J=(ma.set(ba,0),ma.set(J,ba.length),ma)}for(L=J;L;){if(E<L.length)L=L.subarray(E),E=0;else{E-=L.length;L=null;break}switch(x){case 0:if(L.length<Bd.HEADER_LENGTH)break;if(M=new Bd(W=new Ya(L)),L=L.subarray(W.pos),G)if(M.chunkType=="ZEND")x=45;else{M.chunkType=="LAYR"?(x=2,y=new gg(M,G.width,G.height)):M.chunkType=="GRUP"?(x=3,y=new hg(M,G.width,G.height)):(console.log("Unknown chunk type '"+
M.chunkType+"', attempting to skip..."),E=M.chunkSize);continue}else if(M.chunkType=="HEAD"){x=1;continue}else x=5;break;case 1:if(L.length<M.chunkSize)break;if(bf((G=new ke(W=new Ya(L))).version).major>0){x=5;break}B=(A=new cc(G.width,G.height)).getLayersRoot();E=M.chunkSize;x=0;continue;case 2:if(L=y.decode(L),y.done){A.addLayerObject(B,y.layer);x=0;continue}break;case 3:if(L=y.decode(L),y.done){A.addLayerGroupObject(B,y.layer,y.childLayers);x=0;continue}}break}}q=q||{};let v=new (ya(me).Inflate)({}),
x=0,A=null,B=null,y,E=0,G=null,M=null,L=null;return(new Promise(function(J){if(r instanceof ArrayBuffer)J(r);else{let W=new FileReader;W.onload=function(){J(this.result)};W.readAsArrayBuffer(r)}})).then(J=>new Promise(function(W,ba){let ma=new Uint8Array(J);if(!function(na){for(let H=0;H<8;H++)if(na[H]!="CHIBIOEK".charCodeAt(H))return!1;return!0}(ma))return void ba("This doesn't appear to be a ChibiPaint layers file, is it damaged?");ma=ma.subarray(8);v.onData=t;v.onEnd=function(na){0===na&&45==x?
(!1!==q.upgradeMultiplyLayers&&G.version<10&&A.upgradeMultiplyLayers(q.upgradeMultiplyLayers),A.selectTopmostVisibleLayer(),W(A)):ba("Fatal error decoding ChibiFile: "+na)};v.push(ma,!0)}))}(m);default:return Promise.reject("Unexpected resource type '"+f.name+"'")}})(g,l).then(function(f){b[g.name]=f;h.load()},function(){h.emitEvent("loadingFailure",["Failed to read your "+g.friendly])})},0)}else n()},!1);e.addEventListener("error",n);c(g,g.noProgress?null:0);e.open("GET",g.url,!0);e.responseType=
"arraybuffer";e.send()}}function ne(a){(a=a.split(/[-_]/,1)[0].toLowerCase())in oe?(Dd=oe[a],pe=a):(Dd=Ed,pe="en")}function Q(a){return a in Dd?Dd[a]:a}function od(a){function c(e){null===e?n.emitEvent("savingProgress",[1,Q("Saving drawing...")]):n.emitEvent("savingProgress",[e,Q("Saving drawing...")+" ("+Math.round(100*e)+"%)"])}function d(e){n.emitEvent("savingFailure",[e])}async function b(e){try{let k=await h(e),l=`${(k/1024/1024).toFixed(3)}MB`,f=`${a.post_max_size}MB`;if(console.log("Total size of FormData:",
l),console.log("post_max_size:",f),a&&a.post_max_size&&k&&!isNaN(k)&&k>1048576*a.post_max_size)return void d(`${Q("The file size exceeds the server limit.")}
${Q("Limit size")}:${f}
${Q("Current size")}:${l}`);console.log(Q("The total size of FormData is within the acceptable range."))}catch(k){console.error("Error details:",k);d("An error occurred in the getFormDataSize function.");return}c(.5);fetch(a.url,{method:"POST",mode:"same-origin",headers:{"X-Requested-With":"chickenpaint"},body:e}).then(k=>{if(!k.ok){let l;switch(k.status){case 400:l="Bad Request";break;case 401:l="Unauthorized";break;case 403:l="Forbidden";break;case 404:l="Not Found";break;case 500:l="Internal Server Error";
break;case 502:l="Bad Gateway";break;case 503:l="Service Unavailable";break;default:l="Unknown Error"}throw Error(`${Q("Network response was not OK")} ( ${Q("HTTP status code")} ${k.status} : ${l} )`);}return k.text()}).then(k=>{/^CHIBIOK/.test(k)?(c(1),n.emitEvent("savingComplete")):d(k)}).catch(k=>{d(k.message)})}async function h(e){if(a.post_max_size)return e=Array.from(e.entries()).map(([k,l])=>"string"==typeof l?new Blob([`${k}=${l}`]):l),(new Blob(e)).size}var n=this,g=!1;a.rotation=a.rotation||
0;this.save=function(){var e,k,l,f,m;(e=new Blob([function(r){for(var q=new Uint8Array(r.length),t=0;t<r.length;t++)q[t]=r.charCodeAt(t);return q}(a.artwork.getFlatPNG(a.rotation))],{type:"image/png"}),a.artwork.isSimpleDrawing())?l=Promise.resolve(null):(f=a.artwork,m=m||{},l=Promise.resolve().then(()=>{var r,q;let t,v=new (ya(me).Deflate)({level:7}),x=[],A=new Uint8Array(8),B=f.getLayersRoot().getLinearizedLayerList(!1),y=m.forceOldVersion?0:function(G){for(let M of G.getLayersRoot().getLinearizedLayerList(!1))if(M instanceof
Ua||M.mask||M.clip||M.blendMode>I.LM_LAST_CHIBIPAINT||M.blendMode===I.LM_MULTIPLY)return 10;return 0}(f),E=0===(q=bf(y)).major&&0===q.minor?"ChibiPaint v0.0":"ChickenPaint v"+q.major+"."+q.minor;q=Promise.resolve();v.onData=function(G){x.push(G)};for(let G=0;G<8;G++)A[G]="CHIBIOEK".charCodeAt(G);for(let G of(x.push(A),v.push((r=B.length,(t=le("HEAD",ke.FIXED_HEADER_LENGTH)).writeU32BE(y),t.writeU32BE(f.width),t.writeU32BE(f.height),t.writeU32BE(r),t.getAsDataArray()),!1),B))q=q.then(()=>new Promise(function(M){var L=
v.push;var J=G;var W,ba=(new TextEncoder).encode(J.name),ma=J instanceof ta,na=4*(ma?5:6),H=ba.length;let T=le(ma?"LAYR":"GRUP",na+H+((ma?J.image.data.length:0)+(J.mask?J.mask.data.length:0))),Ca=0,ra;J.visible&&(Ca|=1);ma&&J.clip&&(Ca|=2);J.mask&&(Ca|=4);J.maskLinked&&(Ca|=8);J.maskVisible&&(Ca|=16);J.lockAlpha&&(Ca|=64);!ma&&J.expanded&&(Ca|=32);J.blendMode===I.LM_MULTIPLY2?(ra=I.LM_MULTIPLY,Ca|=128):ra=J.blendMode;T.writeU32BE(na+H);T.writeU32BE(ra);T.writeU32BE(J.alpha);T.writeU32BE(Ca);T.writeU32BE(ba.length);
ma||T.writeU32BE(J.layers.length);T.data.set(ba,T.pos);T.pos+=ba.length;if(ma){ba=T.pos;ma=T.data;na=J.image.data;for(H=0;H<na.length;H+=C.BYTES_PER_PIXEL)ma[ba++]=na[H+C.ALPHA_BYTE_OFFSET],ma[ba++]=na[H+C.RED_BYTE_OFFSET],ma[ba++]=na[H+C.GREEN_BYTE_OFFSET],ma[ba++]=na[H+C.BLUE_BYTE_OFFSET];T.pos=ba}J=(J.mask&&(W=J.mask,T.data.set(W.data,T.pos),T.pos+=W.data.length),T.getAsDataArray());L.call(v,J,!1);setTimeout(M,10)}));return q.then(()=>new Promise((G,M)=>{v.onEnd=function(L){if(0===L)if("undefined"!=
typeof Blob)G({bytes:new Blob(x,{type:"application/octet-stream"}),version:E});else{L=new Uint8Array(x.map(W=>W.byteLength).reduce((W,ba)=>W+ba,0));let J=0;for(let W of x)L.set(W,J),J+=W.byteLength;G({bytes:L,version:E})}else M(L)};v.push(le("ZEND",0).getAsDataArray(),!0)}))}));l.then(function(r){if(g)return void n.emitEvent("savingFailure");if(k=a.swatches?new Blob([(new $c).write(a.swatches)],{type:"application/octet-stream"}):null,a.url){var q=new FormData;q.append("beginMarker","This marker ensures the upload wasn't truncated");
q.append("painter","ChickenPaint v2.0");q.append("picture",e);e=null;r?(q.append("chibifileFormat",r.version),q.append("chibifile",r.bytes),q.append("rotation",""+a.rotation)):q.append("rotation","0");k&&(q.append("swatches",k),k=null);q.append("endMarker","This marker ensures the upload wasn't truncated");b(q)}else q="oekaki_"+(new Date).toISOString().split(".")[0].replace(/[^0-9]/g,"_"),ya(pd).saveAs(e,q+".png"),r&&ya(pd).saveAs(r.bytes,q+".chi"),k&&ya(pd).saveAs(k,q+".aco")}).catch(function(r){n.emitEvent("savingFailure")})};
this.cancel=function(){g=!0}}function ig(a,c,d){function b(){var L=l.width/2,J=l.height/2;if(f.fillStyle="white",f.fillRect(0,0,l.width,l.height),y==B.length){var W=t.width,ba=t.height,ma=Math.round(L-W/2),na=Math.round(J-ba/2);f.drawImage(t,ma,na);var H=E;n||((n=document.createElement("canvas")).width=W,n.height=ba,e=n.getContext("2d"));e.globalCompositeOperation="copy";e.drawImage(m,0,0);g||((g=document.createElement("canvas")).width=W,g.height=ba,k=g.getContext("2d"));k.globalCompositeOperation=
"copy";k.drawImage(A,0,0);k.globalCompositeOperation="source-in";k.drawImage(A,0,Math.round(170*H));e.globalCompositeOperation="source-over";e.drawImage(g,0,0);e.drawImage(r,0,0);e.globalCompositeOperation="screen";e.drawImage(x,0,0);e.globalCompositeOperation="multiply";e.drawImage(v,0,0);f.globalAlpha=.88;f.drawImage(n,ma,na);f.globalAlpha=1;f.drawImage(q,ma,na);J=Math.round(J+ba/2+2)}if(""!=G)for(f.fillStyle="black",H=G.split("\n"),W=0;W<H.length;W++)ba=H[W],ma=f.measureText(ba).width,J+=28,f.fillText(ba,
L-ma/2,J)}function h(){l.width=l.clientWidth;l.height=l.clientHeight;f.font="14pt sans-serif";b()}var n,g,e,k,l=document.createElement("canvas"),f=l.getContext("2d"),m=new Image,r=new Image,q=new Image,t=new Image,v=new Image,x=new Image,A=new Image,B=[m,r,q,t,v,x,A],y=0,E=0,G="";d+="splash/";for(var M=0;M<B.length;M++)B[M].onload=function(){++y==B.length&&b()};m.src=d+"cup.png";x.src=d+"highlights.png";r.src=d+"lid.png";q.src=d+"lines.png";v.src=d+"shading.png";A.src=d+"smoothie.png";t.src=d+"text.png";
c.on("loadingProgress",function(L,J){E=L;G=J;b()});c.on("loadingFailure",function(L){E=0;G=L;b()});c.on("loadingComplete",function(){window.removeEventListener("resize",h);a.removeChild(l)});window.addEventListener("resize",h);l.className="chickenpaint-splash-screen";a.appendChild(l);h()}function cf(a){for(var c={DELETE:46,BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27," ":32,ARROWLEFT:37,ARROWUP:38,ARROWRIGHT:39,ARROWDOWN:40,SHIFT:16,"[":219,"]":221,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,0:48,"-":189,
"=":187,"+":187,";":187,META:91,LEFTMETA:91,RIGHTMETA:91,ALT:18,ALTGRAPH:18,OPTION:18,CONTROL:17},d=65;d<=90;d++)c[String.fromCharCode(d)]=d;if((a=a.toUpperCase())in c)return c[a]}function df(){let a,c,d,b,h,n,g,e;this.x0=this.y0=this.x1=this.y1=this.x2=this.y2=this.x3=this.y3=0;let k=l=>{let f=3*l,m=f*l;l*=l*l;let r=2*m,q=6*l,t=this.x0-2*this.x1+this.x2,v=this.y0-2*this.y1+this.y2,x=3*(this.x1-this.x2)-this.x0+this.x3,A=3*(this.y1-this.y2)-this.y0+this.y3;a=this.x0;h=this.y0;c=(this.x1-this.x0)*
f+t*m+x*l;n=(this.y1-this.y0)*f+v*m+A*l;d=t*r+x*q;g=v*r+A*q;b=x*q;e=A*q};this.compute=(l,f,m)=>{k(1/m);l[0]=a;f[0]=h;for(let r=1;r<m;r++)a+=c,h+=n,c+=d,n+=g,d+=b,g+=e,l[r]=a,f[r]=h}}function ef(a,c,d,b){var h,n=0;return"boolean"!=typeof c&&(b=d,d=c,c=void 0),function(){function g(){n=+new Date;d.apply(e,l)}var e=this,k=new Date-n,l=arguments;b&&!h&&g();h&&clearTimeout(h);void 0===b&&k>a?g():!0!==c&&(h=setTimeout(b?function(){h=void 0}:g,void 0===b?a-k:a))}}function Sc(a){this.points=a||[]}function wb(a,
c){this.x=a;this.y=c}function ff(a){for(var c=document.createElement("canvas"),d=c.getContext("2d"),b=d.createImageData(64,64),h=b.data,n=0,g=0;g<64;g++)for(var e=0;e<64;e++)(8&e)!=0!=((8&g)!=0)?(h[n++]=255,h[n++]=255,h[n++]=255):(h[n++]=204,h[n++]=204,h[n++]=204),h[n++]=255;return c.width=64,c.height=64,d.putImageData(b,0,0),a.createPattern(c,"repeat")}function Fd(a,c){c+="Style";a.globalCompositeOperation="exclusion";"exclusion"==a.globalCompositeOperation?a[c]="white":(a.globalCompositeOperation=
"difference",a[c]="#888","difference"!=a.globalCompositeOperation&&(a[c]="black"))}function qd(a){function c(){var v=a?d.clientHeight:d.clientWidth;m=k/(g-n)*v;v=(e-n)/(g-n)*(v-m);h.style[a?"height":"width"]=m+"px";b.style[a?"height":"width"]=m+"px";b.style[a?"top":"left"]=v+"px"}let d=document.createElement("div"),b=document.createElement("div"),h=document.createElement("div"),n=0,g=1,e=0,k=1,l=10,f=!1,m=1,r=!1,q,t=this;this.setValues=function(v,x,A,B){e=v;k=x;n=A;g=B;c()};this.setBlockIncrement=
function(v){l=v};this.setUnitIncrement=function(v){};this.getElement=function(){return d};this.getValueIsAdjusting=function(){return f};d.className="chickenpaint-scrollbar "+(a?"chickenpaint-scrollbar-vertical":"chickenpaint-scrollbar-horizontal");b.className="chickenpaint-scrollbar-handle";b.setAttribute("touch-action","none");h.className="chickenpaint-scrollbar-handle-inner";b.appendChild(h);d.appendChild(b);b.addEventListener("pointerdown",function(v){v.stopPropagation();q=a?v.pageY-d.offsetTop-
window.scrollY:v.pageX-d.offsetLeft-window.scrollX;b.setPointerCapture(v.pointerId);b.classList.add("dragging");r=!0});b.addEventListener("pointermove",function(v){r&&(f=!0,v=a?v.pageY-d.offsetTop-window.scrollY:v.pageX-d.offsetLeft-window.scrollX,e+=(v-q)*(g-n)/((a?d.clientHeight:d.clientWidth)-m),e=Math.min(Math.max(e,n),g),q=v,t.emitEvent("valueChanged",[e]),c(),f=!1)});b.addEventListener("pointerup",function(v){if(v.stopPropagation(),r){try{b.releasePointerCapture(v.pointerId)}catch(x){}b.classList.remove("dragging");
r=!1}});b.addEventListener("click",function(v){v.stopPropagation()});d.addEventListener("click",function(v){this==d&&((a?v.pageY-d.offsetTop-window.scrollY:v.pageX-d.offsetLeft-window.scrollX)<parseInt(b.style[a?"top":"left"],10)?e-=l:e+=l,t.emitEvent("valueChanged",[e]),c())})}function Ub(){this.modes=[]}function Gd(a){function c(){}function d(){}function b(){this.shouldPaintBrushPreview=!1;this.oldPreviewRect=null}function h(){b.call(this);this.smoothMouse={x:0,y:0}}function n(){var z,N;this.mouseDown=
function(aa,ia,xa){if(!this.capture&&0==ia&&!aa.altKey&&!ya(Oa).isPressed("space")&&A())return this.capture=!0,z=N={x:bb+.5,y:Qa+.5},this.eraseBrushPreview(),!0};this.mouseDrag=function(aa){if(this.capture){var ia=new pa(Math.min(z.x,N.x)-1-1,Math.min(z.y,N.y)-1-1,Math.max(z.x,N.x)+1+1+1,Math.max(z.y,N.y)+1+1+1);if(N={x:bb+.5,y:Qa+.5},aa.shiftKey){var xa=Math.PI/4;aa=Math.round(Math.atan2(N.y-z.y,N.x-z.x)/xa);switch(aa){case 0:case 4:N.y=z.y;break;case 2:case 6:N.x=z.x;break;default:aa*=xa,xa=Math.sqrt((N.y-
z.y)*(N.y-z.y)+(N.x-z.x)*(N.x-z.x)),N.x=z.x+xa*Math.cos(aa),N.y=z.y+xa*Math.sin(aa)}}return ia.union(new pa(Math.min(z.x,N.x)-1-1,Math.min(z.y,N.y)-1-1,Math.max(z.x,N.x)+1+1+1,Math.max(z.y,N.y)+1+1+1)),vb(ia),!0}this.mouseMove.call(this,aa)};this.mouseUp=function(aa,ia,xa){if(this.capture&&0==ia)return aa=E(z),ia=E(N),this.capture=!1,this.drawLine(aa,ia),vb(new pa(Math.min(z.x,N.x)-1-1,Math.min(z.y,N.y)-1-1,Math.max(z.x,N.x)+1+1+1,Math.max(z.y,N.y)+1+1+1)),!0};this.paint=function(){this.capture?(S.lineWidth=
1,S.beginPath(),S.moveTo(z.x,z.y),S.lineTo(N.x,N.y),S.stroke()):b.prototype.paint.call(this)};b.call(this)}function g(){let z=0,N,aa,ia,xa;this.mouseDown=function(ha,Ha,Va){if(!this.capture&&0==Ha&&!ha.altKey&&!ya(Oa).isPressed("space")&&A())return ha=E({x:bb,y:Qa}),z=0,N=aa=ia=xa=ha,this.capture=!0,this.eraseBrushPreview(),!0};this.mouseDrag=function(ha){if(this.capture&&0===z)return ia=xa=E({x:bb,y:Qa}),da.repaintAll(),!0;this.mouseMove.call(this,ha)};this.mouseUp=function(ha,Ha,Va){if(this.capture&&
0==Ha){switch(z){case 0:z=1;break;case 1:z=2;break;case 2:this.capture=!1;Ha=N;Va=aa;let Fb=ia,Zb=xa;ha=new df;ha.x0=Ha.x;ha.y0=Ha.y;ha.x1=Va.x;ha.y1=Va.y;ha.x2=Fb.x;ha.y2=Fb.y;ha.x3=Zb.x;ha.y3=Zb.y;Ha=Array(500);Va=Array(500);ha.compute(Ha,Va,500);La.beginStroke(Ha[0],Va[0],1);for(ha=1;ha<500;ha++)La.continueStroke(Ha[ha],Va[ha],1);La.endStroke();da.repaintAll()}return!0}};this.mouseMove=function(ha,Ha){if(this.capture)return ha=E({x:bb,y:Qa}),1==z?aa=ha:2==z&&(ia=ha),da.repaintAll(),!0;b.prototype.mouseMove.call(this,
ha,Ha)};this.paint=function(){if(this.capture){var ha=new df;let Ha=L(N),Va=L(aa),Fb=L(ia),Zb=L(xa);ha.x0=Ha.x;ha.y0=Ha.y;ha.x1=Va.x;ha.y1=Va.y;ha.x2=Fb.x;ha.y2=Fb.y;ha.x3=Zb.x;ha.y3=Zb.y;let vc=Array(100),$b=Array(100);ha.compute(vc,$b,100);S.beginPath();S.moveTo(vc[0],$b[0]);for(ha=1;ha<100;ha++)S.lineTo(vc[ha],$b[ha]);S.moveTo(~~Ha.x,~~Ha.y);S.lineTo(~~Va.x,~~Va.y);S.moveTo(~~Fb.x,~~Fb.y);S.lineTo(~~Zb.x,~~Zb.y);S.stroke()}else b.prototype.paint.call(this)};b.call(this)}function e(){var z;this.mouseDown=
function(N,aa,ia){return!!this.capture||(ya(Oa).isPressed("space")||(0!=aa||this.transient&&!N.altKey)&&2!=aa?void(this.transient&&w.pop()):(z=aa,this.capture=!0,v("crosshair"),this.mouseDrag(N),!0))};this.mouseDrag=function(N){if(this.capture)return N=E({x:bb,y:Qa}),La.isPointWithin(N.x,N.y)&&a.setCurColor(new db(La.colorPicker(N.x,N.y))),!0};this.mouseUp=function(N,aa,ia){if(this.capture&&aa==z)return z=-1,this.capture=!1,v("default"),this.transient&&w.pop(),!0};this.enter=function(){c.prototype.enter.call(this);
z=-1}}function k(){var z,N,aa,ia;this.keyDown=function(xa){if(!xa.ctrlKey&&" "===xa.key)return this.capture||v("grab"),!0};this.keyUp=function(xa){if(this.transient&&1!=ia&&" "===xa.key)return v("default"),w.pop(),!0};this.mouseDown=function(xa,ha,Ha){return!!this.capture||(1==ha||ya(Oa).isPressed("space")&&!xa.ctrlKey&&0==ha||!this.transient&&0==ha?(this.capture=!0,ia=ha,z=xa.pageX,N=xa.pageY,aa=da.getOffset(),v("grab"),!0):void(this.transient&&w.pop()))};this.mouseDrag=function(xa){if(this.capture)return da.setOffset(aa.x+
xa.pageX-z,aa.y+xa.pageY-N),!0};this.mouseUp=function(xa,ha,Ha){if(this.capture&&ha==ia)return ia=-1,this.capture=!1,w.peek()!==this||(this.transient&&!ya(Oa).isPressed("space")?(v("default"),w.pop()):v("grab"),!0)};this.enter=function(){v("grab")}}function l(){}function f(){var z,N=new pa(0,0,0,0),aa=-1;let ia=!1;this.mouseDown=function(xa,ha,Ha){if(Jb&&Jb instanceof HTMLInputElement&&(ia=Jb.checked),!this.capture&&0==ha&&!xa.altKey&&!ya(Oa).isPressed("space"))return xa=G({x:bb,y:Qa}),aa=ha,N.makeEmpty(),
z=xa,da.repaintAll(),this.capture=!0,!0};this.mouseDrag=function(xa){if(!this.capture)return!1;let ha=G({x:bb,y:Qa});xa=xa.shiftKey||ia;let Ha=~~Math.max(Math.abs(ha.x-z.x),Math.abs(ha.y-z.y));return ha.x>=z.x?(N.left=z.x,N.right=(xa?z.x+Ha:ha.x)+1):(N.left=xa?z.x-Ha:ha.x,N.right=z.x+1),ha.y>=z.y?(N.top=z.y,N.bottom=(xa?z.y+Ha:ha.y)+1):(N.top=xa?z.y-Ha:ha.y,N.bottom=z.y+1),da.repaintAll(),!0};this.mouseUp=function(xa,ha,Ha){if(this.capture&&ha==aa)return La.rectangleSelection(N),N.makeEmpty(),da.repaintAll(),
this.capture=!1,aa=-1,!0};this.paint=function(){N.isEmpty()||(S.lineWidth=1,ba(S,N))}}function m(){var z,N,aa=!1;this.mouseDown=function(ia,xa,ha){if(!this.capture&&0==xa&&!ya(Oa).isPressed("space")&&x())return z=E({x:bb,y:Qa}),N=ia.altKey,aa=!0,this.capture=!0,!0};this.mouseDrag=ef(25,function(ia){if(this.capture){ia=E({x:bb,y:Qa});var xa=ia.x-z.x,ha=ia.y-z.y,Ha=~~xa,Va=~~ha;return(0!=Ha||0!=Va)&&(La.move(Ha,Va,N&&aa),aa=!1),z.x=ia.x-(xa-Ha),z.y=ia.y-(ha-Va),!0}});this.mouseUp=function(ia,xa,ha){if(this.capture&&
0==xa)return this.capture=!1,this.transient&&w.pop(),!0}}function r(){function z(qa,za){return{x:(qa.x+za.x)/2,y:(qa.y+za.y)/2}}function N(qa){return{x:Math.round(qa.x),y:Math.round(qa.y)}}function aa(qa,za){for(var Da=0;Da<qa.points.length;Da++)if((za.x-qa.points[Da].x)*(za.x-qa.points[Da].x)+(za.y-qa.points[Da].y)*(za.y-qa.points[Da].y)<=49)return 2*Da;for(Da=0;Da<qa.points.length;Da++){var Za=qa.points[Da],cb=qa.points[(Da+1)%qa.points.length];cb=new wb(cb.x-Za.x,cb.y-Za.y);Za=new wb(za.x-Za.x,
za.y-Za.y);var nc=cb.getLength(),Tc=cb.getScaled(1/nc);nc=Za.getScaled(1/nc);Tc=Tc.getDotProduct(nc);if(Tc>=0&&Tc<=1&&(cb.scale(Tc),(cb.x-Za.x)*(cb.x-Za.x)+(cb.y-Za.y)*(cb.y-Za.y)<=49))return 2*Da+1}return qa.containsPoint(za)?-3:-2}function ia(){var qa=Va.getTransformed(jb),za=aa(qa,{x:bb,y:Qa});switch(za){case 0:case 2:case 4:case 6:za=~~(za/2);let Da=qa.points[za],Za=qa.points[(za+1)%4];xa(wb.subtractPoints(qa.points[(za+3)%4],Da).normalize().add(wb.subtractPoints(Za,Da).normalize()));break;case 1:case 3:case 5:case 7:xa(wb.subtractPoints(qa.points[(~~(za/
2)+1)%4],qa.points[~~(za/2)]).getPerpendicular());break;case -3:ya(Oa).isPressed("r")||ya(Oa).isPressed("space")||v("move");break;case -2:ya(Oa).isPressed("r")||ya(Oa).isPressed("space")||v("grab");break;default:v("default")}}function xa(qa){qa=Math.floor(Math.atan2(-qa.y,qa.x)/(Math.PI/4)+.5);switch(qa<0&&(qa+=4),qa){default:qa="ew-resize";break;case 1:qa="nesw-resize";break;case 2:qa="ns-resize";break;case 3:qa="nwse-resize"}v(qa)}var ha,Ha,Va,Fb,Zb,vc,$b=-1;let Hd=!1;this.mouseDown=function(qa,
za,Da){Da=document.getElementById("chickenpaint-t-maintainAspectCheckbox");if(Da&&Da instanceof HTMLInputElement&&(Hd=Da.checked),!this.capture&&0==za&&!qa.altKey&&!ya(Oa).isPressed("space"))return $b=aa(Va.getTransformed(jb),{x:bb,y:Qa}),Zb=E(Fb={x:bb,y:Qa}),this.capture=!0,ia(),!0};this.mouseDrag=ef(40,function(qa){if(this.capture){var za={x:bb,y:Qa};switch($b){case -3:qa=N(E(za));var Da=wb.subtractPoints(qa,Zb);za=Da.getTruncated();Da=Da.subtract(za);var Za=new lb;Za.translate(za.x,za.y);ha.preMultiply(Za);
Zb=wb.subtractPoints(qa,Da);break;case -2:Za=Math.PI/4;Da=Va.getCenter();var cb=L(Da),nc=Math.atan2(za.y-cb.y,za.x-cb.x)-Math.atan2(Fb.y-cb.y,Fb.x-cb.x);cb=new lb;vc+=nc;qa=qa.shiftKey?-ha.decompose().rotate+Math.round(vc/Za)*Za:nc;sb&&(qa=-qa);cb.rotateAroundPoint(qa,Da.x,Da.y);ha.preMultiply(cb);Fb=za;break;case 0:case 2:case 4:case 6:Za=~~($b/2);Da=Ha.points[Za];cb=ha.getInverted().getTransformedPoint(N(E(za)));za=Ha.points[(Za+2)%4];Za=(cb.x-za.x)/(Da.x-za.x);Da=(cb.y-za.y)/(Da.y-za.y);if(.001>
Math.abs(Za)||.001>Math.abs(Da)||isNaN(Za)||isNaN(Da))return!0;if(Hd||qa.shiftKey)Da=Za=qa=Math.max(Za,Da);ha.scaleAroundPoint(Za,Da,za.x,za.y);break;case 1:case 5:case 3:case 7:qa=~~($b/2);cb=z(Ha.points[qa],Ha.points[(qa+1)%4]);za=ha.getInverted().getTransformedPoint(N(E(za)));qa=z(Ha.points[(qa+2)%4],Ha.points[(qa+3)%4]);cb=wb.subtractPoints(cb,qa);za=wb.subtractPoints(za,qa);nc=cb.getLength();za=cb.getDotProduct(za)/nc/nc;if(.001>Math.abs(za)||isNaN(za))return!0;1==$b||5==$b?(Da=1,Za=za):(Da=
za,Za=1);ha.scaleAroundPoint(Da,Za,qa.x,qa.y)}return Va=Ha.getTransformed(ha),La.transformAffineAmend(ha),da.repaintAll(),!0}});this.mouseUp=function(qa,za,Da){if(this.capture&&0==za)return this.capture=!1,$b=-1,!0};this.mouseMove=function(){this.capture||ia()};this.paint=function(){var qa=Va.getTransformed(jb).points,za=Array(2*qa.length);for(var Da=0;Da<qa.length;Da++)za[Da]=qa[Da];for(let cb=0;cb<qa.length;cb++){Da=qa[cb];var Za=qa[(cb+1)%qa.length];za[cb+qa.length]={x:(Da.x+Za.x)/2,y:(Da.y+Za.y)/
2}}Fd(S,"fill");for(Da=0;Da<za.length;Da++)S.fillRect(za[Da].x-3,za[Da].y-3,7,7);W(S,qa)};this.keyDown=function(qa){if("Enter"===qa.key){if(!U&&!Y)return a.actionPerformed({action:"CPTransformAccept"}),!0}else if("Escape"===qa.key)return a.actionPerformed({action:"CPTransformReject"}),!0};this.enter=function(){c.prototype.enter.call(this);var qa,za=La.transformAffineBegin();ha=za.transform;za.rect;(qa=za.selection).isEmpty()&&(qa=za.rect.clone());Va=(Ha=new Sc(qa.toPoints())).getTransformed(ha);$b=
-1;vc=0;da.repaintAll()};this.leave=function(){c.prototype.leave.call(this);da.repaintAll()};this.moveByKey=function(qa,za){var Da;if(ha){var Za=new lb;Za.translate(qa,za);ha.preMultiply(Za);Va=Ha.getTransformed(ha);La.transformAffineAmend(ha);null==(Da=this.repaintAll)||Da.call(this)}}}function q(){var z,N,aa=0,ia=!1,xa=-1;this.mouseDown=function(ha,Ha,Va){return!!this.capture||(!this.transient&&0==Ha&&!ha.altKey&&!ya(Oa).isPressed("space")||0==Ha&&!ha.altKey&&!ya(Oa).isPressed("space")&&ya(Oa).isPressed("r")?
(z={x:bb,y:Qa},aa=da.getRotation(),N=jb.clone(),sb&&ra(N),ia=!1,this.capture=!0,xa=Ha,v("grab"),!0):void(this.transient&&w.pop()))};this.mouseDrag=function(ha){if(this.capture){var Ha=ea.clientWidth/2,Va=ea.clientHeight/2;ha=ea.width/2;var Fb=ea.height/2;Ha=Math.atan2(Qa-Va,bb-Ha)-Math.atan2(z.y-Va,z.x-Ha);Va=new lb;return Va.rotateAroundPoint(Ha,ha,Fb),Va.multiply(N),da.setRotation(aa+Ha),da.setOffset(~~Va.getTranslateX(),~~Va.getTranslateY()),ia=!0,!0}};this.enter=function(){v("grab")};this.mouseUp=
function(ha,Ha,Va){if(this.capture&&Ha==xa){if(ia){ha=Math.round(gb/(Math.PI/2))*Math.PI/2;if(Math.abs(gb-ha)<5/180*Math.PI){Va=ha-aa;ha=ea.width/2;Ha=ea.height/2;let Fb=new lb;Fb.rotateAroundPoint(Va,ha,Ha);Fb.multiply(N);da.setRotation(aa+Va);da.setOffset(~~Fb.getTranslateX(),~~Fb.getTranslateY());da.repaintAll()}da.emitEvent("canvasRotated90",[da.getRotation90()])}else da.resetRotation();return this.capture=!1,this.transient&&!ya(Oa).isPressed("r")?(v("default"),w.pop()):v("grab"),!0}};this.keyUp=
function(ha){if(this.transient&&1!=xa&&"r"===ha.key.toLowerCase())return v("default"),w.pop(),!0};this.keyDown=function(ha){if("r"===ha.key.toLowerCase())return!0}}function t(){n.call(this)}function v(z){ea.getAttribute("data-cursor")!=z&&ea.setAttribute("data-cursor",z)}function x(){var z=La.getActiveLayer();return z.visible&&z.ancestorsAreVisible()?0!=z.alpha||(a.showLayerNotification(z,Q("Whoops! This layer's opacity is currently 0%"),"opacity"),!1):(a.showLayerNotification(z,Q("Whoops! This layer is currently hidden"),
"layer"),!1)}function A(){var z=La.getActiveLayer();return z instanceof Ua&&!La.isEditingMask()?(a.showLayerNotification(z,Q("Whoops! You can't draw on a group"),"layer"),!1):x()}function B(z,N,aa,ia,xa){z.setValues(-xa,ia,N-ia-xa+aa/4,N+aa-xa-aa/4);z.setBlockIncrement(Math.max(1,~~(.66*ia)));z.setUnitIncrement(Math.max(1,~~(.05*ia)))}function y({resetViewFlip:z=!1}={}){(jb.setToIdentity(),jb.translate(Cb,Sb),jb.scale(xb,xb),jb.rotate(gb),sb&&!z&&ra(jb),null==P||null==O||P.getValueIsAdjusting()||
O.getValueIsAdjusting())||(z=ma(new pa(0,0,va.width,va.height)),B(P,z.left,z.getWidth(),ea.clientWidth,da.getOffset().x),B(O,z.top,z.getHeight(),ea.clientHeight,da.getOffset().y));da.repaintAll()}function E(z){return jb.getInverted().getTransformedPoint(z)}function G(z){z=E(z);return z.x=Math.floor(z.x),z.y=Math.floor(z.y),z}function M(z){var N=ea.getBoundingClientRect();return{x:z.x-N.left-window.pageXOffset,y:z.y-N.top-window.pageYOffset}}function L(z){return jb.getTransformedPoint(z)}function J(z){z=
L(z);return z.x=Math.round(z.x),z.y=Math.round(z.y),z}function W(z,N){z.beginPath();z.moveTo(N[0].x,N[0].y);for(var aa=1;aa<N.length;aa++)z.lineTo(N[aa].x,N[aa].y);z.lineTo(N[0].x,N[0].y);z.stroke()}function ba(z,N){var aa=L({x:(N.left+N.right)/2,y:(N.top+N.bottom)/2});N=N.toPoints();for(var ia=0;ia<N.length;ia++)N[ia]=J(N[ia]),N[ia].x+=.5*Math.sign(aa.x-N[ia].x),N[ia].y+=.5*Math.sign(aa.y-N[ia].y);W(z,N)}function ma(z){var N=J({x:z.left-1,y:z.top-1}),aa=J({x:z.left-1,y:z.bottom}),ia=J({x:z.right,
y:z.top-1});z=J({x:z.right,y:z.bottom});N=new pa(Math.min(Math.min(N.x,aa.x),Math.min(ia.x,z.x)),Math.min(Math.min(N.y,aa.y),Math.min(ia.y,z.y)),Math.max(Math.max(N.x,aa.x),Math.max(ia.x,z.x))+1,Math.max(Math.max(N.y,aa.y),Math.max(ia.y,z.y))+1);return N.grow(2,2),N}function na(){var z=ea.width,N=ea.height,aa=L({x:La.width/2,y:La.height/2});da.setOffset(Math.round(Cb+z/2-aa.x),Math.round(Sb+N/2-aa.y))}function H(z,N,aa){if(z=Math.max(.1,Math.min(8,z)),da.getZoom()!=z){var ia=da.getOffset();da.setOffset(ia.x+
~~((N-ia.x)*(1-z/da.getZoom())),ia.y+~~((aa-ia.y)*(1-z/da.getZoom())));da.setZoom(z);da.repaintAll()}}function T(z,N=!0){let aa=ea.clientWidth,ia=ea.clientHeight;N&&(N=parseFloat(z),.01>Math.abs(N-1)?z=1:.2>Math.abs(N-2)?z=2:.08>Math.abs(N-.5)&&(z=.5));H(z,aa/2,ia/2)}function Ca(z){return"mouse"===z.pointerType&&0!==z.buttons&&0===z.pressure?1:"touch"===z.pointerType?(0!==z.pressure&&(hc=!0),hc)?2*z.pressure:1:2*z.pressure}function ra(z){let N=La.width/2;z.translate(N,0);z.scale(-1,1);z.translate(-N,
0)}function ub(z){let N=z[0].pageX-z[1].pageX;z=z[0].pageY-z[1].pageY;return Math.sqrt(N*N+z*z)}function mb(){Ac||(Ac=!0,window.requestAnimationFrame(function(){da.paint()}))}function vb(z){Gb.union(z);mb()}function Aa(){Ib=La.getBounds();da.repaintAll()}let R,da=this,wa=document.createElement("div"),$a=document.createElement("div"),Z=document.createElement("div"),ea=document.createElement("canvas"),S=ea.getContext("2d"),va=document.createElement("canvas"),ab=va.getContext("2d"),ib=ff(S),La=a.getArtwork(),
xb=1,Cb=0,Sb=0,gb=0,jb=new lb,rb=!1,ic=!1,eb=32,bb=0,Qa=0,Db=!1,nb=[!1,!1,!1],fc=!1,qc=!1,pc=!1,hc=!1,Ib=La.getBounds(),Gb=new pa(0,0,0,0),Ac=!1,rc;let fa,Nb,jc,Wb,Bc,Fa,mc,Yb,sc=[],w=new Ub,F,P=new qd(!1),O=new qd(!0),U=null,Y=null,la=0,Ka=255,fb=!0,Jb=!1;Math.sign=Math.sign||function(z){return 0==(z*=1)||isNaN(z)?z:z>0?1:-1};c.prototype.transient=!1;c.prototype.capture=!1;c.prototype.enter=function(){v("default")};c.prototype.leave=function(){this.capture=!1};c.prototype.mouseMove=c.prototype.paint=
c.prototype.mouseDown=c.prototype.mouseDrag=c.prototype.mouseUp=c.prototype.keyDown=c.prototype.suspend=c.prototype.resume=c.prototype.keyUp=function(){};d.prototype=Object.create(c.prototype);d.prototype.constructor=d;d.prototype.mouseDown=function(z,N,aa){var ia=ya(Oa).isPressed("space");!ia&&(2==N||0==N&&z.altKey)?(w.push(fa,!0),w.peek().mouseDown(z,N,aa)):ia||0!=N||z.altKey||!ya(Oa).isPressed("r")?1!=N&&(z.altKey||z.ctrlKey||ya(Oa).isPressed("z")||!ia||0!=N)||(w.push(Nb,!0),w.peek().mouseDown(z,
N,aa)):(w.push(jc,!0),w.peek().mouseDown(z,N,aa))};let Qb=null;d.prototype.keyDown=function(z){if(!z.altKey&&(!z.ctrlKey&&ya(Oa).isPressed("z")||z.ctrlKey&&ya(Oa).isPressed("space")))return v("zoom-in"),w.peek()===F&&(Qb=F,w.pop()),z.preventDefault(),!0;if("r"===z.key.toLowerCase()&&" "!==z.key)return w.push(jc,!0),w.peek().keyDown(z),!0;if(" "===z.key&&(!z.ctrlKey||"z"!==z.key.toLowerCase()))return w.push(Nb,!0),w.peek().keyDown(z),z.preventDefault(),!0;if(w.peek()===Fa||w.peek()===mc){if("Enter"===
z.key){if(U||Y)return;a.actionPerformed({action:"CPTransform"});z.preventDefault()}}else if((w.peek()===Nb||w.peek()===jc)&&"Enter"===z.key){if(U||Y)return;a.actionPerformed({action:"CPResetZoomAndRotation"});z.preventDefault()}return!1};d.prototype.keyUp=function(z){" "!==z.key&&"control"!==z.key.toLowerCase()&&"z"!==z.key.toLowerCase()||(v("default"),Qb&&(w.setUserMode(Qb),Qb=null),z.preventDefault())};b.prototype=Object.create(c.prototype);b.prototype.constructor=b;b.prototype.getBrushPreviewOval=
function(){let z=a.getBrushSize()*xb/2;return new pa(bb-z,Qa-z,bb+z,Qa+z)};b.prototype.queueBrushPreview=function(){if(w.peek()==this){this.shouldPaintBrushPreview=!0;var z=this.getBrushPreviewOval();z.grow(2,2);null!=this.oldPreviewRect&&(z.union(this.oldPreviewRect),this.oldPreviewRect=null);vb(z)}};b.prototype.eraseBrushPreview=function(){this.shouldPaintBrushPreview=!1;null!=this.oldPreviewRect&&(vb(this.oldPreviewRect),this.oldPreviewRect=null)};b.prototype.mouseMove=function(z,N){this.queueBrushPreview()};
b.prototype.enter=function(){c.prototype.enter.call(this);Db&&this.queueBrushPreview()};b.prototype.leave=function(){c.prototype.leave.call(this);this.eraseBrushPreview()};b.prototype.suspend=b.prototype.leave;b.prototype.resume=b.prototype.enter;b.prototype.paint=function(){if(this.shouldPaintBrushPreview){this.shouldPaintBrushPreview=!1;var z=this.getBrushPreviewOval();S.beginPath();S.arc((z.left+z.right)/2,(z.top+z.bottom)/2,z.getWidth()/2,0,2*Math.PI);S.stroke();z.grow(2,2);null==this.oldPreviewRect?
this.oldPreviewRect=z:this.oldPreviewRect.union(z)}};h.prototype=Object.create(b.prototype);h.prototype.constructor=h;h.prototype.mouseDown=function(z,N,aa){if(!this.capture&&0==N&&!z.altKey&&!ya(Oa).isPressed("space")&&A()&&(z=E({x:bb,y:Qa}),this.eraseBrushPreview(),La.beginStroke(z.x,z.y,aa)))return this.capture=!0,this.smoothMouse=z,!0};h.prototype.mouseDrag=function(z,N){if(("number"!=typeof navigator.maxTouchPoints||navigator.maxTouchPoints<3)&&b.prototype.mouseMove.call(this,z,N),this.capture){z=
E({x:bb,y:Qa});var aa=Math.min(.999,Math.pow(a.getBrushInfo().smoothing,.3));let ia=1-aa;return this.smoothMouse.x=ia*z.x+aa*this.smoothMouse.x,this.smoothMouse.y=ia*z.y+aa*this.smoothMouse.y,La.continueStroke(this.smoothMouse.x,this.smoothMouse.y,N),!0}this.mouseMove(z)};h.prototype.mouseUp=function(z,N,aa){if(this.capture)return 0==N&&(this.capture=!1,La.endStroke()),!0};n.prototype=Object.create(b.prototype);n.prototype.constructor=n;n.prototype.drawLine=function(z,N){La.beginStroke(z.x,z.y,1);
La.continueStroke(N.x,N.y,1);La.endStroke()};g.prototype=Object.create(b.prototype);g.prototype.constructor=g;e.prototype=Object.create(c.prototype);e.prototype.constructor=e;k.prototype=Object.create(c.prototype);k.prototype.constructor=k;this.setGrowFillArea=function(z=0){la=Number(z)};this.setFoodFillAlpha=function(z=255){Ka=Number(z)};this.setFloodFillReferAllLayers=function(z){fb=!!z};l.prototype=Object.create(c.prototype);l.prototype.constructor=l;l.prototype.mouseDown=function(z,N,aa){if(0==
N&&!z.altKey&&!ya(Oa).isPressed("space")&&A())return z=E({x:bb,y:Qa}),La.isPointWithin(z.x,z.y)&&(La.floodFill(z.x,z.y,la,Ka,fb),da.repaintAll()),!0};this.setMaintainAspectCheckbox=function(z){Jb=z};f.prototype=Object.create(c.prototype);f.prototype.constructor=f;m.prototype=Object.create(c.prototype);m.prototype.constructor=m;m.prototype.mouseMove=function(z){return w.peek()!==this||(ya(Oa).isPressed("r")&&ya(Oa).isPressed("space")||v("move"),!0)};m.prototype.enter=function(){ya(Oa).isPressed("r")&&
ya(Oa).isPressed("space")||v("move")};r.prototype=Object.create(c.prototype);r.prototype.constructor=r;this.setModalShown=function(z){(U=!!z)||(Y=!0,setTimeout(()=>Y=!1,300))};document.addEventListener("keydown",function(z){let N=w.peek(),aa=function(ha){if(!U){if(!ha)return null;switch(ha.toLowerCase()){case "arrowup":return{dx:0,dy:-1};case "arrowdown":return{dx:0,dy:1};case "arrowleft":return{dx:-1,dy:0};case "arrowright":return{dx:1,dy:0};default:return null}}}(z.key);if(aa){var {dx:ia,dy:xa}=
aa;(sb&&(ia=-ia),N===Yb)?(Yb.moveByKey(ia,xa),z.preventDefault()):N===mc&&(La.move(ia,xa,z.altKey),z.preventDefault())}});q.prototype=Object.create(c.prototype);q.prototype.constructor=q;t.prototype=Object.create(n.prototype);t.prototype.constructor=t;t.prototype.drawLine=function(z,N){La.gradientFill(Math.round(z.x),Math.round(z.y),Math.round(N.x),Math.round(N.y),a.getCurGradient())};t.prototype.queueBrushPreview=function(){};this.setZoom=function(z){xb=z;y()};this.getZoom=function(){return xb};
this.setGridSize=function(z){eb=Math.max(Math.round(z),1);this.repaintAll()};this.getGridSize=function(){return eb};this.setOffset=function(z,N){isNaN(z)||isNaN(N)?console.log("Bad offset"):(Cb=z,Sb=N,y())};this.getOffset=function(){return{x:Cb,y:Sb}};this.setInterpolation=function(z){rb=z;S.imageSmoothingEnabled=z;this.repaintAll()};this.setRotation=function(z){gb=z%(2*Math.PI);y()};this.setRotationOnCenter=function(z){let N=ea.width/2,aa=ea.height/2;var ia=z-gb;let xa=Math.cos(ia);ia=Math.sin(ia);
let ha=Cb-N,Ha=Sb-aa;Cb=N+ha*xa-Ha*ia;Sb=aa+ha*ia+Ha*xa;gb=z%(2*Math.PI);y()};this.getRotation=function(){return gb};this.getRotationDegrees=function(){return(180*this.getRotation()/Math.PI+180+360)%360-180};this.setRotationDegrees=function(z){this.setRotationOnCenter(z*Math.PI/180)};this.getRotation90=function(){var z=Math.round(this.getRotation()/Math.PI*2);return(z%=4)<0&&(z+=4),z};this.zoomIn=function(){T(1.41*this.getZoom())};this.zoomOut=function(){T(.7092*this.getZoom())};this.zoom100=function(){T(1);
na()};this.zoomOnCenter=(z,N=!1)=>{T(z,N)};this.resetRotation=function(){var z=ea.width/2,N=ea.height/2,aa=new lb;aa.rotateAroundPoint(-this.getRotation(),z,N);aa.multiply(jb);sb&&ra(aa);this.setOffset(~~aa.getTranslateX(),~~aa.getTranslateY());this.setRotation(0);da.emitEvent("canvasRotated90",[0])};this.resetZoomAndRotation=function(){this.zoom100();this.resetRotation();sb=!1;y({resetViewFlip:!0})};this.isPanOrRotateMode=function(){return qc};let Rb=!1,sb=!1;this.toggleViewFlip=()=>(sb?(sb=!1,y({resetViewFlip:!0})):
(ra(jb),sb=!0,da.repaintAll()),sb);let tb=!1,Kb=0;ea.addEventListener("pointerdown",z=>{!z.altKey&&(!z.ctrlKey&&ya(Oa).isPressed("z")||z.ctrlKey&&ya(Oa).isPressed("space"))&&"touch"!==z.pointerType&&(tb=!0,Kb=z.clientX)});ea.addEventListener("pointermove",z=>{if(!z.altKey&&(!z.ctrlKey&&ya(Oa).isPressed("z")||z.ctrlKey&&ya(Oa).isPressed("space"))&&tb&&"touch"!==z.pointerType&&1===z.buttons){let N=z.clientX-Kb;if(Math.abs(N)>10){let aa=M({x:z.pageX,y:z.pageY});H(da.getZoom()*(N>0?1.15:1/1.15),aa.x,
aa.y);Kb=z.clientX}z.preventDefault()}});ea.addEventListener("pointerup",z=>{"touch"!==z.pointerType&&(tb=!1)});let Xb=0,kc=1,lc=0;this.getElement=function(){return wa};this.repaintAll=function(){Gb.left=0;Gb.top=0;Gb.right=ea.width;Gb.bottom=ea.height;mb()};this.paint=function(){var z=!1;if(Ac=!1,Gb.isEmpty()||(S.save(),S.clipTo&&(S.beginPath(),Gb.left|=0,Gb.top|=0,S.rect(Gb.left,Gb.top,Math.ceil(Gb.getWidth()),Math.ceil(Gb.getHeight())),S.clip()),z=!0),!Ib.isEmpty()){var N=rc&&rc.isOpen()?rc.getImageData():
La.fusionLayers().getImageData();ab.putImageData(N,0,0,Ib.left,Ib.top,Ib.getWidth(),Ib.getHeight());Ib.makeEmpty()}if(S.fillStyle="#606060",S.fillRect(0,0,ea.width,ea.height),S.save(),S.setTransform(jb.m[0],jb.m[1],jb.m[2],jb.m[3],jb.m[4],jb.m[5]),S.fillStyle=ib,S.fillRect(0,0,La.width,La.height),S.drawImage(va,0,0,va.width,va.height),S.restore(),Fd(S,"stroke"),S.lineWidth=1,La.getSelection().isEmpty()||w.peek()instanceof f&&w.peek().capture||(S.setLineDash([3,2]),ba(S,La.getSelection()),S.setLineDash([])),
ic)if(N=La.getBounds(),xb*eb>2){S.beginPath();for(var aa=eb-1;aa<N.right;aa+=eb){var ia=L({x:aa,y:N.top}),xa=L({x:aa,y:N.bottom});S.moveTo(ia.x+.5,ia.y+.5);S.lineTo(xa.x+.5,xa.y+.5)}for(aa=eb-1;aa<N.bottom;aa+=eb)ia=L({x:0,y:aa}),xa=L({x:N.right,y:aa}),S.moveTo(ia.x+.5,ia.y+.5),S.lineTo(xa.x+.5,xa.y+.5);S.stroke()}w.paint(S);S.globalCompositeOperation="source-over";z&&(Gb.makeEmpty(),S.restore())};this.showGrid=function(z){ic=z;this.repaintAll()};this.resize=function(z,N){z-=Z.offsetHeight;z=Math.floor(z);
ea.style.height=z+"px";ea.width=ea.clientWidth;ea.height=z;R=null;N||na();this.setInterpolation(rb);this.repaintAll()};a.on("toolChange",function(z,N){z=sc[N.strokeMode];for(N=0;N<w.modes.length;N++)if(w.modes[N]instanceof b){w.modes[N].leave();w.modes[N]=z;w.modes[N].enter();break}F=z});a.on("modeChange",function(z){switch(z){case X.M_DRAW:var N=F;break;case X.M_FLOODFILL:N=Wb;break;case X.M_GRADIENTFILL:N=Bc;break;case X.M_RECT_SELECTION:N=Fa;break;case X.M_MOVE_TOOL:N=mc;break;case X.M_ROTATE_CANVAS:N=
jc;break;case X.M_PAN_CANVAS:N=Nb;break;case X.M_COLOR_PICKER:N=fa;break;case X.M_TRANSFORM:N=Yb}qc=z===X.M_PAN_CANVAS||z===X.M_ROTATE_CANVAS;pc=z===X.M_MOVE_TOOL||z===X.M_ROTATE_CANVAS||z===X.M_PAN_CANVAS;w.setUserMode(N)});a.on("maskViewOpened",function(z){rc&&rc.off("changeLayer",Aa);(rc=z).on("changeLayer",Aa);Aa()});var Gc=new d;fa=new e;Nb=new k;jc=new q;Wb=new l;Bc=new t;Fa=new f;mc=new m;Yb=new r;F=(sc=[new h,new n,new g])[ka.STROKE_MODE_FREEHAND];w.setDefaultMode(Gc);w.setUserMode(F);va.width=
La.width;va.height=La.height;ea.width=800;ea.height=900;ea.className="chickenpaint-canvas";ea.setAttribute("touch-action","none");S.setLineDash||(S.setLineDash=function(){});ea.addEventListener("contextmenu",function(z){z.preventDefault()});ea.addEventListener("mouseenter",function(){Db=!0});ea.addEventListener("mouseleave",function(){Db=!1;nb[0]||nb[2]||nb[1]||da.repaintAll()});ea.addEventListener("pointerdown",function(z){fc&&!pc&&"touch"===z.pointerType||!ya(Oa).isPressed("z")&&(ea.setPointerCapture(z.pointerId),
R=ea.getBoundingClientRect(),bb=z.clientX-R.left,Qa=z.clientY-R.top,nb[0]=!1,nb[2]=!1,nb[1]=!1,nb[z.button]=!0,w.mouseDown(z,z.button,Ca(z)))});ea.addEventListener("pointermove",function(z){if(!(R||=ea.getBoundingClientRect(),fc&&!pc&&"touch"===z.pointerType||lc>1&&"touch"===z.pointerType||ya(Oa).isPressed("z")||z.ctrlKey&&ya(Oa).isPressed("space"))){bb=z.clientX-R.left;Qa=z.clientY-R.top;var N=0!==z.buttons,aa=N?Ca(z):0;(1&z.buttons)!=0!=nb[0]&&(nb[0]=!nb[0],nb[0]?w.mouseDown(z,0,aa):w.mouseUp(z,
0,aa));(2&z.buttons)!=0!=nb[2]&&(nb[2]=!nb[2],nb[2]?w.mouseDown(z,2,aa):w.mouseUp(z,2,aa));(4&z.buttons)!=0!=nb[1]&&(nb[1]=!nb[1],nb[1]?w.mouseDown(z,1,aa):w.mouseUp(z,1,aa));N?w.mouseDrag(z,aa):w.mouseMove(z,aa);fc||"pen"!==z.pointerType||(fc=!0)}});ea.addEventListener("touchstart",function(z){lc=z.touches.length;qc&&2===lc&&(Xb=ub(z.touches),kc=da.getZoom(),z.preventDefault())},{passive:!1});ea.addEventListener("touchend",function(z){lc=z.touches.length},{passive:!1});ea.addEventListener("touchmove",
function(z){if(lc=z.touches.length,qc&&2===lc){let N=ub(z.touches)/Xb,aa=M({x:(z.touches[0].pageX+z.touches[1].pageX)/2,y:(z.touches[0].pageY+z.touches[1].pageY)/2});H(kc*N,aa.x,aa.y);z.preventDefault()}},{passive:!1});ea.addEventListener("pointerup",function(z){nb[0]=!1;nb[2]=!1;nb[1]=!1;w.mouseUp(z,z.button,0);ea.releasePointerCapture(z.pointerId)});ea.addEventListener("wheel",function(z){if(0!=z.deltaY){if(!Rb||Math.abs(z.deltaY)>20){let N;N=z.deltaY>0?1/1.15:1.15;let aa=M({x:z.pageX,y:z.pageY}),
ia=E(aa);La.isPointWithin(ia.x,ia.y)?H(da.getZoom()*N,aa.x,aa.y):H(da.getZoom()*N,Cb+~~(La.width*xb/2),Sb+~~(La.height*xb/2));Rb=Rb||setTimeout(function(){Rb=!1},50)}z.preventDefault()}},{passive:!1});document.addEventListener("keydown",function(z){w.keyDown(z)});document.addEventListener("keyup",function(z){"alt"===z.key.toLowerCase()&&z.preventDefault();w.keyUp(z)});document.addEventListener("visibilitychange",function(){let z=ea.height+Z.offsetHeight;ea.width=1;ea.height=1;da.resize(z,!0)},!1);
window.addEventListener("scroll",function(){R=null});ea.addEventListener("mousedown",function(z){1==z.button&&z.preventDefault()});La.on("changeSelection",function(){da.repaintAll()});La.on("updateRegion",function(z){Ib.union(z);vb(ma(Ib))});P.on("valueChanged",function(z){var N=da.getOffset();da.setOffset(-z,N.y)});O.on("valueChanged",function(z){var N=da.getOffset();da.setOffset(N.x,-z)});this.setInterpolation(!0);Gc=document.createElement("div");Gc.className="chickenpaint-canvas-container-wrapper";
Gc.appendChild(ea);$a.className="chickenpaint-canvas-container-top";$a.appendChild(Gc);$a.appendChild(O.getElement());Z.className="chickenpaint-canvas-container-bottom";Z.appendChild(P.getElement());wa.appendChild($a);wa.appendChild(Z);a.setCanvas(this)}function Ob(a,c,d,b){function h(M){if(("dragStart"===A||"dragging"===A)&&0!==M.buttons){var L,J;let W=M.pageX-B.x;M=M.pageY-B.y;"dragStart"==A&&(L={x:W,y:M},J=x,(L.x-J.x)*(L.x-J.x)+(L.y-J.y)*(L.y-J.y)>25)&&(A="dragging");"dragging"==A&&E.setLocation(W,
M)}}function n(M){if("dragging"===A||"dragStart"===A){"dragStart"===A&&(M.stopPropagation(),M.preventDefault(),setTimeout(()=>{E.setLocation(x.x,x.y);E.toggleCollapse()},100));A=!1;try{M.target.releasePointerCapture(M.pointerId)}catch(L){console.error(L)}}m.removeEventListener("pointermove",h);m.removeEventListener("pointerup",n)}function g(M){M.stopPropagation();M.preventDefault();"vertResize"===A&&E.setHeight(M.pageY-f.offsetTop-y)}function e(M){null==t||t.releasePointerCapture(M.pointerId);A=!1;
t.removeEventListener("pointermove",g);t.removeEventListener("pointerup",e)}function k(M){M.stopPropagation();M.preventDefault();"horzResize"==A&&E.setWidth(M.pageX-f.offsetLeft)}function l(M){v.releasePointerCapture(M.pointerId);A=!1;v.removeEventListener("pointermove",k);v.removeEventListener("pointerup",l)}a.getSmallScreenMode()&&Q(d+" (shorter)")!==d+" (shorter)"?this.title=Q(d+" (shorter)"):this.title=Q(d);b=b||{};this.name=c;this.resizeVert=b.resizeVert||!1;this.resizeHorz=b.resizeHorz||!1;
let f=document.createElement("div"),m=document.createElement("div"),r=document.createElement("i");d=document.createElement("button");let q=document.createElement("div"),t=null,v=null,x,A,B,y=0,E=this;this.getElement=function(){return f};this.getBodyElement=function(){return q};this.getWidth=function(){return f.offsetWidth};this.getHeight=function(){return f.offsetHeight};this.getX=function(){return parseInt(f.style.left,10)||0};this.getY=function(){return parseInt(f.style.top,10)||0};this.setLocation=
function(M,L){f.style.left=M+"px";f.style.top=L+"px"};this.setWidth=function(M){f.style.width=M+"px"};this.setHeight=function(M){f.style.height=M+"px"};this.setSize=function(M,L){this.setWidth(M);this.setHeight(L)};this.setCollapseDownwards=function(M){b.collapseDownwards=M};this.toggleCollapse=function(M){var L;if(void 0===M)M=!f.classList.contains("collapsed");else if(f.classList.contains("collapsed")===M)return;var J=null==(L=f.closest(".chickenpaint"))?void 0:L.querySelector(".chickenpaint-canvas");
L=J?J.clientHeight:window.innerHeight;J=this.getHeight();J=this.getY()+J;(f.classList.toggle("collapsed",M),r.classList.toggle("icon-angle-down",!M),r.classList.toggle("icon-angle-up",M),M)?b.collapseDownwards&&this.setLocation(this.getX(),Math.min(J,L)-this.getHeight()):(M=this.getHeight(),b.collapseDownwards?this.setLocation(this.getX(),Math.max(J-M,0)):this.getY()+M>L&&this.setLocation(this.getX(),Math.max(L-M,0)))};this.userIsDoneWithUs=function(){a.getSmallScreenMode()&&this.toggleCollapse(!0)};
r.className="collapse-icon fas icon-angle-down";d.type="button";d.className="btn btn-close";d.textContent="";d.tabIndex=-1;f.className="chickenpaint-palette chickenpaint-palette-"+c;m.className="chickenpaint-palette-head";m.setAttribute("touch-action","none");c=document.createElement("div");let G=document.createElement("h5");c.className="modal-header";G.className="modal-title";G.appendChild(document.createTextNode(this.title));G.appendChild(r);c.appendChild(G);c.appendChild(d);m.appendChild(c);q.className=
"chickenpaint-palette-body";f.appendChild(m);f.appendChild(q);this.resizeVert&&((t=document.createElement("div")).className="chickenpaint-resize-handle-vert",t.addEventListener("pointerdown",function(M){M.stopPropagation();M.preventDefault();A="vertResize";y=M.pageY-f.offsetTop-f.offsetHeight;t.setPointerCapture(M.pointerId);t.addEventListener("pointermove",g);t.addEventListener("pointerup",e)}),f.appendChild(t));this.resizeHorz&&((v=document.createElement("div")).className="chickenpaint-resize-handle-horz",
v.addEventListener("pointerdown",function(M){M.stopPropagation();M.preventDefault();A="horzResize";v.setPointerCapture(M.pointerId);v.addEventListener("pointermove",k);v.addEventListener("pointerup",l)}),f.appendChild(v));m.addEventListener("pointerdown",function(M){0==M.button&&(M.stopPropagation(),M.preventDefault(),"BUTTON"==M.target.nodeName?E.emitEvent("paletteVisChange",[E,!1]):(x={x:parseInt(f.style.left,10)||0,y:parseInt(f.style.top,10)||0},B={x:M.pageX-f.offsetLeft,y:M.pageY-f.offsetTop},
A=a.getSmallScreenMode()?"dragStart":"dragging",M.target.setPointerCapture(M.pointerId)),m.addEventListener("pointermove",h),m.addEventListener("pointerup",n))})}function Id(a){function c(g){"LI"==this.nodeName&&(g=b[parseInt(this.getAttribute("data-buttonIndex"),10)],a.actionPerformed({action:g.command}))}Ob.call(this,a,"tool","Tools");let d=this,b=[{className:"chickenpaint-tool-rect-selection",command:"CPRectSelection",toolTip:"Marquee",shortcut:"m",mode:X.M_RECT_SELECTION},{className:"chickenpaint-tool-move",
command:"CPMoveTool",toolTip:"Move tool",shortcut:"v",mode:X.M_MOVE_TOOL},{className:"chickenpaint-tool-flood-fill",command:"CPFloodFill",toolTip:"Flood fill",shortcut:"f",mode:X.M_FLOODFILL},{className:"chickenpaint-tool-gradient-fill",command:"CPGradientFill",toolTip:"Gradient fill",shortcut:"g",mode:X.M_GRADIENTFILL},{className:"chickenpaint-tool-color-picker",command:"CPColorPicker",toolTip:"Color picker",shortcut:"i",mode:X.M_COLOR_PICKER},{className:"chickenpaint-tool-blur",command:"CPBlur",
toolTip:"Blur",shortcut:"u",mode:X.M_DRAW,tool:X.T_BLUR},{className:"chickenpaint-tool-pencil",command:"CPPencil",toolTip:"Pencil",shortcut:"n",mode:X.M_DRAW,tool:X.T_PENCIL},{className:"chickenpaint-tool-pen",command:"CPPen",toolTip:"Pen",selected:!0,shortcut:"b",mode:X.M_DRAW,tool:X.T_PEN},{className:"chickenpaint-tool-airbrush",command:"CPAirbrush",toolTip:"Airbrush",shortcut:"a",mode:X.M_DRAW,tool:X.T_AIRBRUSH},{className:"chickenpaint-tool-water",command:"CPWater",toolTip:"Waterpaint",shortcut:"w",
mode:X.M_DRAW,tool:X.T_WATER},{className:"chickenpaint-tool-eraser",command:"CPEraser",toolTip:"Eraser",shortcut:"e",mode:X.M_DRAW,tool:X.T_ERASER},{className:"chickenpaint-tool-soft-eraser",command:"CPSoftEraser",toolTip:"Soft eraser",shortcut:"s",mode:X.M_DRAW,tool:X.T_SOFTERASER},{className:"chickenpaint-tool-smudge",command:"CPSmudge",toolTip:"Smudge",shortcut:"d",mode:X.M_DRAW,tool:X.T_SMUDGE},{className:"chickenpaint-tool-blender",command:"CPBlender",toolTip:"Blender",shortcut:"c",mode:X.M_DRAW,
tool:X.T_BLENDER},{className:"chickenpaint-tool-dodge",command:"CPDodge",toolTip:"Dodge (tool)",shortcut:"o",mode:X.M_DRAW,tool:X.T_DODGE},{className:"chickenpaint-tool-burn",command:"CPBurn",toolTip:"Burn (tool)",shortcut:"p",mode:X.M_DRAW,tool:X.T_BURN},{className:"chickenpaint-tool-rotate-canvas",command:"CPRotateCanvas",commandDoubleClick:"CPResetCanvasRotation",toolTip:"Rotate canvas",mode:X.M_ROTATE_CANVAS},{className:"chickenpaint-tool-pan-canvas",command:"CPPanCanvas",toolTip:"Grab canvas",
mode:X.M_PAN_CANVAS}],h=document.createElement("ul");a.on("modeChange",function(g){let e=d.getBodyElement();(e.querySelectorAll("li").forEach(function(k){k.classList.remove("selected")}),g==X.M_DRAW)?(g=e.querySelector(`li[data-tool="${a.getCurTool()}"]`))&&g.classList.add("selected"):(g=e.querySelector(`li[data-mode="${g}"]`))&&g.classList.add("selected")});a.on("toolChange",function(g){let e=d.getBodyElement();a.getCurMode()==X.M_DRAW&&(e.querySelectorAll("li").forEach(function(k){k.classList.remove("selected")}),
(g=e.querySelector(`li[data-tool="${g}"]`))&&g.classList.add("selected"))});let n=d.getBodyElement();for(let g in h.className="chickenpaint-tools list-unstyled",b)!function(e){let k=b[e],l=document.createElement("li"),f=document.createElement("div");l.className="chickenpaint-toolbar-button "+k.className;l.setAttribute("data-buttonIndex",e);l.setAttribute("data-mode",k.mode);void 0!==k.tool&&l.setAttribute("data-tool",k.tool);l.title=Q(k.toolTip);k.shortcut&&(l.title+=" ("+k.shortcut.toUpperCase()+
")",ya(Oa)(k.shortcut,function(){return c.call(l),!1}));k.selected&&(l.className+=" selected");f.className="chickenpaint-toolbar-button-icon";l.appendChild(f);h.appendChild(l)}(g);h.addEventListener("click",function(g){let e=g.target.closest("li");e&&c.call(e,g)});h.addEventListener("dblclick",function(g){if(g=g.target.closest("li"))g=b[parseInt(g.getAttribute("data-buttonIndex"),10)],g.commandDoubleClick&&a.actionPerformed({action:g.commandDoubleClick})});n.appendChild(h)}function Jd(a){Ob.call(this,
a,"misc","Misc");this.flipButton=null;let c=this,d=[{className:"chickenpaint-tool-zoom-in",command:"CPZoomIn",toolTip:"Zoom in"},{className:"chickenpaint-tool-zoom-out",command:"CPZoomOut",toolTip:"Zoom out"},{className:"chickenpaint-tool-zoom-100",command:"CPZoom100",toolTip:"Zoom 100%"},{className:"chickenpaint-tool-flip-horizontal",command:"CPViewHFlip",toolTip:"Flip View Horizontal"},{className:"chickenpaint-tool-undo",command:"CPUndo",toolTip:"Undo"},{className:"chickenpaint-tool-redo",command:"CPRedo",
toolTip:"Redo"},{className:"chickenpaint-tool-send",command:"CPSend",toolTip:"Save Oekaki"}];!function(){let b=c.getBodyElement(),h=document.createElement("ul");for(let n in h.className="chickenpaint-misc-tools list-unstyled",d){let g=d[n],e=document.createElement("li"),k=document.createElement("div");"CPSend"!=g.command||a.isActionSupported("CPContinue")||(g.toolTip="Post Oekaki",g.className="chickenpaint-tool-send-and-end");e.className="chickenpaint-toolbar-button "+g.className;e.setAttribute("data-buttonIndex",
n);e.setAttribute("title",Q(g.toolTip));k.className="chickenpaint-toolbar-button-icon";e.appendChild(k);h.appendChild(e);"chickenpaint-tool-flip-horizontal"===g.className&&(c.flipButton=e)}h.addEventListener("click",function(n){if(n=n.target.closest("li"))n=d[parseInt(n.getAttribute("data-buttonIndex"),10)],a.actionPerformed({action:n.command})});b.appendChild(h)}()}function Kd(a){Ob.call(this,a,"stroke","Stroke");let c=[{className:"chickenpaint-tool-freehand",command:"CPFreeHand",toolTip:Q("Free-hand"),
selected:!0},{className:"chickenpaint-tool-line",command:"CPLine",toolTip:Q("Straight line")},{className:"chickenpaint-tool-bezier",command:"CPBezier",toolTip:Q("Bezier curve")}],d=this.getBodyElement(),b=document.createElement("ul");for(let h in b.className="chickenpaint-stroke-tools list-unstyled",c){let n=c[h],g=document.createElement("li"),e=document.createElement("div");g.className="chickenpaint-toolbar-button "+n.className;g.setAttribute("data-buttonIndex",h);g.setAttribute("title",n.toolTip);
n.selected&&(g.className+=" selected");e.className="chickenpaint-toolbar-button-icon";g.appendChild(e);b.appendChild(g)}b.addEventListener("click",function(h){if(h=h.target.closest("li"))h=c[parseInt(h.getAttribute("data-buttonIndex"),10)],a.actionPerformed({action:h.command})});d.appendChild(b);a.on("toolChange",function(h,n){h=document.querySelector(".chickenpaint-tool-freehand");let g=document.querySelector(".chickenpaint-tool-line"),e=document.querySelector(".chickenpaint-tool-bezier");h&&h.classList.toggle("selected",
n.strokeMode==ka.STROKE_MODE_FREEHAND);g&&g.classList.toggle("selected",n.strokeMode==ka.STROKE_MODE_LINE);e&&e.classList.toggle("selected",n.strokeMode==ka.STROKE_MODE_BEZIER)})}function ac(a,c,d){return c in a?Object.defineProperty(a,c,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[c]=d,a}function Ld(a){Ob.call(this,a,"color","Color (picker)");let c=new gf(a),d=new hf(a,c);a=new jg(a);let b=this.getBodyElement(),h=document.createElement("div");h.className="chickenpaint-colorpicker-top";
h.appendChild(c.getElement());h.appendChild(d.getElement());b.appendChild(h);b.appendChild(a.getElement())}function jg(a){function c(n,g,e){for(;n.length<e;)n=g+n;return n}function d(){h.style.backgroundColor="#"+c(Number(b).toString(16),"0",6)}let b=0,h=document.createElement("div");this.getElement=function(){return h};a.on("colorChange",function(n){b=n.getRgb();d()});h.className="chickenpaint-colorpicker-show";h.addEventListener("click",function(n){n.preventDefault();n="#"+c(Number(b).toString(16),
"0",6);if(null!=(n=window.prompt(Q("Please enter a color in hex format"),n)))try{(n.match(/^#/)||n.match(/^$/))&&(n=n.substring(1));let g=parseInt(n,16);a.setCurColor(new db(g))}catch(g){}});d()}function ad(a,c){function d(){var g=b.width;h.clearRect(0,0,g,b.height);h.beginPath();h.arc(g/2+1,g/2+1,Math.max(g/2,1)-2,0,2*Math.PI);n.state?h.fill():h.stroke()}var b=document.createElement("canvas"),h=b.getContext("2d"),n=this;this.state=a||!1;this.setValue=function(g){this.state!=g&&(this.state=g,this.emitEvent("valueChange",
[g]),d())};this.getElement=function(){return b};b.addEventListener("mousedown",function(g){n.setValue(!n.state)});b.title=c||"";b.className="chickenpaint-checkbox";b.width=20;b.height=20;b.fillStyle="black";b.strokeStyle="black";d()}function Mb(a,c,d,b,h=150,n=2.5){function g(){let x=l.width||h,A=l.height,B="string"==typeof v.title?Q(v.title):v.title(v.value),y=3*window.devicePixelRatio,E=.75*l.height;if(d)f.save(),f.fillStyle="white",f.fillRect(0,0,x,A),f.fillStyle="black",f.fillText(B,y,E),f.beginPath(),
v.value>=m/2?f.rect(x/2,0,(v.value-m/2)*x/m,A):f.rect(v.value*x/m,0,(m/2-v.value)*x/m,A),f.fill(),f.clip(),f.fillStyle="white";else{var G=(v.value-a)/m;b&&(G=Math.pow(G,1/n));G*=x;f.save();f.save();f.fillStyle="black";f.beginPath();f.rect(0,0,G,A);f.fill();f.clip();f.fillStyle="white";f.fillText(B,y,E);f.restore();f.fillStyle="white";f.beginPath();f.rect(G,0,x,A);f.fill();f.clip();f.fillStyle="black"}f.fillText(B,y,E);f.restore()}function e(x){let A=l.clientWidth,B=l.getBoundingClientRect().left+
window.scrollX;x=(x.pageX-B)/A;b&&(x=Math.pow(Math.max(x,0),n));v.setValue(x*m+a)}function k(x){switch(r){case 1:return e(x);case 2:var A=v.title();if(!A.includes(Q("Brush size"))&&!A.includes(Q("Opacity")))return e(x);A=(x.pageX-q)/4;if(0!==A){A=v.value+A;let B=Math.floor(A);v.setValue(B);q=x.pageX-(A-B)*4}}}let l=document.createElement("canvas"),f=l.getContext("2d"),m=c-a,r=0,q,t=!1,v=this;this.value=void 0;this.title="";d=d||!1;l.addEventListener("pointerup",x=>{if(0===r)return l.releasePointerCapture(x.pointerId),
l.removeEventListener("pointermove",k);if(0!==r)switch(r){case 1:0!==x.button||x.shiftKey||(r=0);break;case 2:(2==x.button||0===x.button&&x.shiftKey)&&(r=0);break;default:return}return l.releasePointerCapture(x.pointerId),l.removeEventListener("pointermove",k)});this.setValue=function(x){x=~~Math.max(a,Math.min(c,x));this.value!=x&&(this.value=x,this.emitEvent("valueChange",[this.value]),t?g():(t=!0,this.resize()))};this.getElement=function(){return l};this.resize=function(){l.width=l.clientWidth||
h;l.height=l.clientHeight||20;window.devicePixelRatio>1&&(l.style.height=l.height+"px",l.width*=window.devicePixelRatio,l.height*=window.devicePixelRatio);f.font=.47*l.height+"pt sans-serif";g()};l.addEventListener("pointerdown",function(x){0===r&&(2===x.button||0===x.button&&x.shiftKey?(r=2,q=x.pageX):(r=1,e(x)),l.setPointerCapture(x.pointerId),l.addEventListener("pointermove",k))});l.addEventListener("contextmenu",function(x){x.preventDefault()});l.setAttribute("touch-action","none");l.className=
"chickenpaint-slider";"devicePixelRatio"in window||(window.devicePixelRatio=1)}function rd(a,c,d){function b(){for(var f=e.style,m=Number(n.getRgb()).toString(16);m.length<6;)m="0"+m;f.backgroundColor="#"+m}let h=this,n=new db(0),g=255,e=document.createElement("div");this.getElement=function(){return e};this.setColor=function(f){n.isEqual(f)||(n.copyFrom(f),b(),this.emitEvent("colorChange",[n]))};this.setAlpha=function(f){f!=g&&(g=f,b(),this.emitEvent("alphaChange",[g]))};this.getColorRgb=function(){return n.getRgb()};
this.getAlpha=function(){return g};this.setCurColor=this.setColor;e.className="chickenpaint-color-pick-swatch";a&&n.copyFrom(a);c&&(g=c);let k=new Pb.Popover(e,{html:!0,content:function(){return window.addEventListener("mousedown",l),function(){let f=document.createElement("div"),m=document.createElement("div"),r=new gf(h,n),q=new hf(h,r,n.getHue()),t=new Mb(0,255);return f.className="chickenpaint-color-pick-panel",m.className="chickenpaint-colorpicker-top",m.appendChild(r.getElement()),m.appendChild(q.getElement()),
f.appendChild(m),t.value=g,t.title=function(v){return Q("Opacity: ")+v},t.on("valueChange",function(v){h.setAlpha(v)}),f.appendChild(t.getElement()),setTimeout(function(){t.resize()},0),f}()},trigger:"manual",placement:"bottom",container:d||!1}),l=function(f){var m=f.target;m=m.closest(".popover-body")||m.classList.contains("chickenpaint-color-pick-panel")||m.classList.contains("chickenpaint-colorpicker-select")||m.classList.contains("chickenpaint-colorpicker-slider");f.preventDefault();m||k.hide()};
e.addEventListener("click",function(f){f.preventDefault();k.toggle()});e.addEventListener("hidden.bs.popover",function(){window.removeEventListener("mousedown",l)});b()}function qe(a,c){let d=document.createElement("div");return d.className="chickenpaint-checkbox-slider-group",d.appendChild(a.getElement()),d.appendChild(c.getElement()),d}function jf(a,c){for(let d in c)if(c.hasOwnProperty(d)){let b=document.createElement("option");b.appendChild(document.createTextNode(Q(c[d])));b.value=d;a.appendChild(b)}}
function kg(a){function c(){n.gradient(n.getBounds(),0,0,n.width,0,k,!0);e.putImageData(n.imageData,0,0,0,0,150,32);b.fillRect(0,0,d.width,d.height);b.drawImage(g,0,0)}let d=document.createElement("canvas"),b=d.getContext("2d"),h=ff(b),n=new C(150,32),g=document.createElement("canvas"),e=g.getContext("2d"),k=a.getCurGradient();this.getElement=function(){return d};a.on("gradientChange",function(l){k=l;c()});d.width=g.width=150;d.height=g.height=32;d.className="chickenpaint-gradient-preview";b.fillStyle=
h;c()}function bd(a){function c(){b.getElement().style.display="none";h.getElement().style.display="none";n.getElement().style.display="none";g.getElement().style.display="none";e.getElement().style.display="none";k.getElement().style.display="none"}function d(m){c();let r=g.getElement().querySelector(".form-check");switch(r&&(r.style.display="none"),m){case X.M_GRADIENTFILL:h.getElement().style.display="block";break;case X.M_TRANSFORM:n.getElement().style.display="block";break;case X.M_RECT_SELECTION:g.getElement().style.display=
"block";r instanceof HTMLElement&&(r.style.display="");break;case X.M_MOVE_TOOL:g.getElement().style.display="block";break;case X.M_ROTATE_CANVAS:case X.M_PAN_CANVAS:e.getElement().style.display="block";break;case X.M_FLOODFILL:k.getElement().style.display="block";break;default:b.getElement().style.display="block"}}Ob.call(this,a,"brush","Tool options");let b=new lg(a),h=new mg(a),n=new ng(a),g=new og(a),e=new pg(a),k=new qg(a),l=this.getBodyElement();l.addEventListener("touchmove",m=>{m.preventDefault()},
{passive:!1});l.appendChild(b.getElement());l.appendChild(h.getElement());l.appendChild(n.getElement());l.appendChild(g.getElement());l.appendChild(e.getElement());l.appendChild(k.getElement());let f=null;a.on("modeChange",function(m){f=m;d(m)});document.addEventListener("keydown",m=>{"r"!==m.key.toLocaleLowerCase()&&(m.ctrlKey||"z"!==m.key.toLocaleLowerCase())&&" "!==m.key||(c(),e.getElement().style.display="block")});document.addEventListener("keyup",m=>{"r"!==m.key.toLocaleLowerCase()&&"z"!==m.key.toLocaleLowerCase()&&
" "!==m.key||(c(),d(f))})}function lg(a){let c=[1,2,3,4,5,6,7,8,9,10,15,20,25,30,35,40,45,50,60,70,80,90,100,125,150,175,200],d=document.createElement("div"),b=document.createElement("select"),h=new ad(!1,Q("Control brush opacity with pen pressure")),n=new Mb(1,255,!1,!0),g=new ad(!0,Q("Control brush size with pen pressure")),e=new Mb(1,200,!1,!0),k=new ad(!1,Q("Control brush scattering with pen pressure")),l=new Mb(0,1E3,!1,!0),f=new Mb(0,100,!1,!0),m=new Mb(0,100,!1,!0),r=new Mb(0,100,!1,!0),q=
new Mb(0,100,!1,!0),t=new bd.CPBrushPreview(a);this.getElement=function(){return d};n.title=function(v){return Q("Opacity")+": "+v};n.on("valueChange",function(v){a.setAlpha(v)});e.title=function(v){return Q("Brush size")+": "+v};e.on("valueChange",function(v){a.setBrushSize(v)});f.title=function(v){return Q("Color")+": "+v+"%"};f.on("valueChange",function(v){a.getBrushInfo().resat=v/100;a.callToolListeners()});m.title=function(v){return Q("Blend")+": "+v+"%"};m.on("valueChange",function(v){a.getBrushInfo().bleed=
v/100;a.callToolListeners()});r.title=function(v){return Q("Spacing")+": "+v+"%"};r.on("valueChange",function(v){a.getBrushInfo().spacing=v/100;a.callToolListeners()});l.title=function(v){return Q("Scattering")+": "+v+"%"};l.on("valueChange",function(v){a.getBrushInfo().scattering=v/100;a.callToolListeners()});q.title=function(v){return Q("Smoothing")+": "+v+"%"};q.on("valueChange",function(v){a.getBrushInfo().smoothing=v/100;a.callToolListeners()});k.on("valueChange",function(v){a.getBrushInfo().pressureScattering=
v;a.callToolListeners()});h.on("valueChange",function(v){a.getBrushInfo().pressureAlpha=v;a.callToolListeners()});g.on("valueChange",function(v){a.getBrushInfo().pressureSize=v;a.callToolListeners()});b.addEventListener("change",function(v){a.getBrushInfo().tip=parseInt(b.value,10);b.blur()});b.className="form-control form-control-sm";b.tabIndex=-1;jf(b,["Round Pixelated","Round Hard Edge","Round Soft","Square Pixelated","Square Hard Edge"]);d.appendChild(b);d.appendChild(t.getElement());d.appendChild(qe(g,
e));d.appendChild(qe(h,n));d.appendChild(f.getElement());d.appendChild(m.getElement());d.appendChild(r.getElement());d.appendChild(qe(k,l));d.appendChild(q.getElement());h.setValue(a.getBrushInfo().pressureAlpha);n.setValue(a.getAlpha());g.setValue(a.getBrushInfo().pressureSize);e.setValue(a.getBrushSize());k.setValue(a.getBrushInfo().pressureScattering);l.setValue(~~(100*a.getBrushInfo().scattering));b.value=a.getBrushInfo().tip;f.setValue(~~(100*a.getBrushInfo().resat));m.setValue(~~(100*a.getBrushInfo().bleed));
r.setValue(~~(100*a.getBrushInfo().spacing));q.setValue(~~(100*a.getBrushInfo().smoothing));a.on("toolChange",function(v,x){n.setValue(x.alpha);e.setValue(x.size);g.setValue(x.pressureSize);h.setValue(x.pressureAlpha);b.value=x.tip;k.setValue(x.pressureScattering);~~(100*x.resat)!=f.value&&f.setValue(~~(100*x.resat));~~(100*x.bleed)!=m.value&&m.setValue(~~(100*x.bleed));~~(100*x.spacing)!=r.value&&r.setValue(~~(100*x.spacing));~~(100*x.scattering)!=l.value&&l.setValue(~~(100*x.scattering));~~(100*
x.smoothing)!=q.value&&q.setValue(~~(100*x.smoothing))});ya(Oa)("1,2,3,4,5,6,7,8,9,0",function(v,x){v=parseInt(x.shortcut,10);0==v&&(v=10);a.setAlpha(Math.round(v/10*255))});ya(Oa)("{,[",function(){let v=a.getBrushSize();for(let x=c.length-1;x>=0;x--)if(v>c[x]){a.setBrushSize(c[x]);break}});ya(Oa)("},]",function(){let v=a.getBrushSize();for(let x=0;x<c.length;x++)if(v<c[x]){a.setBrushSize(c[x]);break}})}function mg(a){function c(){let e=[n.getAlpha()<<24|n.getColorRgb(),g.getAlpha()<<24|g.getColorRgb()];
a.setCurGradient(e)}var d;let b=document.createElement("div");var h=new kg(a);let n=new rd(new db(16777215&a.getCurGradient()[0]),a.getCurGradient()[0]>>>24,b),g=new rd(new db(16777215&a.getCurGradient()[1]),a.getCurGradient()[1]>>>24,b);this.getElement=function(){return b};b.className="chickenpaint-gradient-panel";b.style.display="none";n.on("colorChange",c);n.on("alphaChange",c);g.on("colorChange",c);g.on("alphaChange",c);(d=document.createElement("p")).textContent=Q("Gradient");b.appendChild(d);
b.appendChild(h.getElement());(d=document.createElement("div")).className="chickenpaint-gradient-colors";(h=document.createElement("div")).className="chickenpaint-gradient-start-color";h.appendChild(n.getElement());d.appendChild(h);(h=document.createElement("div")).className="chickenpaint-gradient-end-color";h.appendChild(g.getElement());d.appendChild(h);b.appendChild(d)}function cd(a,c){let d=a.textContent;if(a.textContent="",a.classList.add("d-flex","align-items-center","justify-content-center",
"position-relative"),a.style.paddingLeft="0.35rem",c){let b=document.createElement("span");b.className=`md-panel ${c}`;b.style.flex="0 0 auto";b.style.marginRight="0";a.prepend(b)}c=document.createElement("span");c.textContent=d;c.style.flex="1 1 auto";c.style.textAlign="center";a.appendChild(c)}function ng(a){var c={smooth:Q("Smooth"),sharp:Q("Sharp")};let d=document.createElement("div"),b=document.createElement("button"),h=document.createElement("button");var n=document.createElement("select");
this.getElement=function(){return d};d.className="chickenpaint-transform-panel";d.style.display="none";b.type="button";h.type="button";b.className="btn btn-primary btn-block";h.className="btn btn-light btn-block";b.textContent=Q("Apply transform");h.textContent=Q("Cancel");cd(b,"icon-md-circle");cd(h,"icon-md-close");n.addEventListener("change",function(l){a.setTransformInterpolation(this.value)});n.className="form-control chickenpaint-transform-interpolation";jf(n,c);c=document.createElement("div");
let g=document.createElement("label");g.textContent=Q("Transform style");c.className="form-group";c.appendChild(g);c.appendChild(n);d.appendChild(c);n=document.createElement("div");n.appendChild(b);n.appendChild(h);n.className="form-group";d.appendChild(n);let {wrapper:e,checkbox:k}=re("chickenpaint-t-maintainAspectCheckbox",Q("Constrain"),!0);d.appendChild(e);b.addEventListener("click",function(l){a.actionPerformed({action:"CPTransformAccept"});l.preventDefault()});h.addEventListener("click",function(l){a.actionPerformed({action:"CPTransformReject"});
l.preventDefault()});k.addEventListener("change",()=>{k.blur()})}function og(a){let c=document.createElement("div"),d=document.createElement("div"),b=document.createElement("label"),h=document.createElement("button"),n=document.createElement("button"),g=document.createElement("button");this.getElement=function(){return c};c.className="chickenpaint-selection-panel";c.style.display="none";d.className="form-group";b.textContent=Q("Selection");d.appendChild(b);h.type="button";h.className="btn btn-light btn-block";
h.textContent=Q("Fill");h.addEventListener("click",function(l){a.actionPerformed({action:"CPFill"});l.preventDefault()});cd(h,"icon-md-ink_selection");d.appendChild(h);n.type="button";n.className="btn btn-light btn-block";n.textContent=Q("Deselect");n.addEventListener("click",function(l){a.actionPerformed({action:"CPDeselectAll"});l.preventDefault()});cd(n,"icon-md-deselect");d.appendChild(n);g.type="button";g.className="btn btn-primary btn-block";g.textContent=Q("Transform");g.addEventListener("click",
function(l){a.actionPerformed({action:"CPTransform"});l.preventDefault()});cd(g,"icon-md-resize");d.appendChild(g);c.appendChild(d);let {wrapper:e,checkbox:k}=re("chickenpaint-s-maintainAspectCheckbox",Q("Constrain"),!1);c.appendChild(e);k.addEventListener("change",()=>{k.blur();a.setMaintainAspectCheckbox(k.checked)})}function re(a,c,d=!1){let b=document.createElement("input");b.type="checkbox";b.id=a;b.className="form-check-input";b.checked=d;b.style.outline="none";b.style.boxShadow="none";b.tabIndex=
-1;d=document.createElement("label");d.className="form-check-label";d.setAttribute("for",a);d.textContent=c;a=document.createElement("div");return a.className="form-check",a.appendChild(b),a.appendChild(d),{wrapper:a,checkbox:b}}function pg(a){var c;let d,b=document.createElement("div"),h=document.createElement("div"),n=document.createElement("label"),g=document.createElement("button"),e=new Mb(10,800,!1,!0,180,3.13),k=new Mb(-180,180,!1,!1,180);b.className="chickenpaint-pan-panel";b.style.display=
"none";b.appendChild(e.getElement());h.className="form-group";n.textContent=Q("Zoom and Rotate");h.appendChild(n);h.appendChild(n);b.appendChild(h);g.type="button";g.className="btn btn-primary btn-block";g.style.outline="none";g.textContent=Q("Reset View");g.addEventListener("click",function(t){a.actionPerformed({action:"CPResetZoomAndRotation"});t.preventDefault()});cd(g,"icon-md-restart_alt");h.appendChild(g);b.appendChild(h);e.title=function(t){return Q("Zoom")+": "+t+"%"};k.title=function(t){return Q("Rotation")+
": "+t+"\u00b0"};e.on("valueChange",function(t){a.zoomOnCenter(t/100)});k.on("valueChange",function(t){a.setRotationDegrees(t)});b.appendChild(e.getElement());b.appendChild(k.getElement());this.getElement=function(){return b};e.setValue(100*a.getZoom());k.setValue(a.getRotationDegrees());document.addEventListener("wheel",t=>{t.preventDefault();l()},{passive:!1});let l=(c=()=>{e.setValue(100*a.getZoom());k.setValue(a.getRotationDegrees())},function(...t){clearTimeout(d);d=setTimeout(()=>c.apply(this,
t),12)}),f=t=>a.isPanOrRotateMode()||ya(Oa).isPressed("space")||ya(Oa).isPressed("r")||ya(Oa).isPressed("z"),m=t=>t instanceof HTMLCanvasElement&&t.classList.contains("chickenpaint-canvas"),r=!1;document.addEventListener("pointerdown",t=>{f(t)&&(r=!0,m(t.target)&&l())});document.addEventListener("pointermove",t=>{r&&f(t)&&m(t.target)&&l()});document.addEventListener("pointerup",t=>{r=!1;f(t)&&m(t.target)&&l()});ya(Oa)("=,-",function(){l()});let q=!0;ya(Oa)("ctrl+0,alt+0,r,z,space,enter",function(){q&&
(q=!1,l())});document.addEventListener("keyup",t=>{q=!0});document.addEventListener("click",t=>{t.target instanceof HTMLElement&&!(t.target instanceof HTMLCanvasElement)&&l()})}function qg(a){let c=document.createElement("div");var d=document.createElement("div");let b=document.createElement("label"),h=new Mb(0,5,!1,!1,180),n=new Mb(0,255,!1,!1,180);c.className="chickenpaint-floodFill-panel";c.style.display="none";c.appendChild(h.getElement());d.className="form-group";b.textContent=Q("Flood fill");
d.appendChild(b);c.appendChild(d);h.title=function(k){return Q("Grow fill area")+": "+k};n.title=function(k){return Q("Opacity")+": "+k};h.on("valueChange",function(k){a.setGrowFillArea(k)});n.on("valueChange",function(k){a.setFoodFillAlpha(k)});d=document.createElement("div");d.className="form-group";d.appendChild(h.getElement());d.appendChild(n.getElement());c.appendChild(d);let {wrapper:g,checkbox:e}=re("chickenpaint-floodFillreferAllLayersCheckbox",Q("Refer all layers"),!0);g.classList.add("mb-1");
c.appendChild(g);e.addEventListener("change",()=>{e.blur();a.setFloodFillReferAllLayers(e.checked)});this.getElement=function(){return c};h.setValue(2);n.setValue(255)}function rg(a){a.preventDefault();a.stopPropagation()}function ec(a){let c=document.createElement("span");return c.className="fa "+a,c}function se(a){let c=document.createElement("span");return c.className="chickenpaint-icon chickenpaint-icon-"+a,c}function kf(a,c){let d=document.createElement("div"),b=document.createElement("label");
return b.tabIndex=-1,a.tabIndex=-1,d.className="form-check",a.className="form-check-input",b.className="form-check-label",b.setAttribute("for",a.id),b.appendChild(a),b.appendChild(document.createTextNode(c)),d.appendChild(a),d.appendChild(b),d}function Md(a){function c(){let y=h.getActiveLayer();y.getAlpha()!=l.value&&l.setValue(y.getAlpha());let E=h.getActiveLayer();for(;f.lastChild;)f.removeChild(f.lastChild);for(let G=I.LM_FIRST;G<=I.LM_LAST;G++)if(G!=I.LM_MULTIPLY2&&(G==E.blendMode||G===I.LM_PASSTHROUGH&&
E instanceof Ua||G<=I.LM_LAST_CHIBIPAINT)){let M=document.createElement("option");M.appendChild(document.createTextNode(Q(I.BLEND_MODE_DISPLAY_NAMES[G])));G!==I.LM_MULTIPLY||E.blendMode===G||E.useLegacyMultiply?M.value=G:M.value=I.LM_MULTIPLY2;f.appendChild(M)}y.getBlendMode()!=parseInt(f.value,10)&&(f.value=y.getBlendMode());y.getLockAlpha()!=q.checked&&(q.checked=y.getLockAlpha());(function(){var G=h.getActiveLayer();let M=h.isEditingMask();G={"image-layer":G instanceof ta,"layer-group":G instanceof
Ua,"clipping-mask":G instanceof ta&&G.clip,"no-clipping-mask":G instanceof ta&&!G.clip,"no-clipping-mask-or-is-group":!(G instanceof ta)||!G.clip,mask:G&&null!==G.mask,"no-mask":G&&null===G.mask,"mask-enabled":G&&null!==G.mask&&G.maskVisible,"mask-disabled":G&&null!==G.mask&&!G.maskVisible,isNotEditingMask:G&&!M,isEditingMask:G&&null!==G.mask&&M};for(let L of"mask no-mask isEditingMask isNotEditingMask clipping-mask no-clipping-mask-or-is-group image-layer layer-group".split(" "))for(let J of v.getElementsByClassName("chickenpaint-action-require-"+
L))J.style.display=G[L]?"inline-block":"none";v.querySelectorAll("[data-action]").forEach(function(L){let J=L.getAttribute("data-action");L.classList.toggle("disabled",!a.isActionAllowed(J))})})()}function d(){h=this;k.resize();c()}Ob.call(this,a,"layers","Layers",{resizeHorz:!0,resizeVert:!0});let b=this,h=a.getArtwork(),n=null,g=this.getBodyElement(),e=this.getElement(),k=new function(){function y(Aa){let R=ra.querySelectorAll(".chickenpaint-layer");return R[R.length-1-Aa]}function E(Aa){if(!Aa)return-1;
Aa=Aa.closest(".chickenpaint-layer");if(!Aa)return-1;let R=Array.from(ra.querySelectorAll(".chickenpaint-layer"));return R.length-1-R.indexOf(Aa)}function G(){var Aa;if(2===T.state){var R=e.getBoundingClientRect();var da=!0;var wa=!0;if(T.dropTarget=function(ea,S){var va=ra.querySelectorAll(".chickenpaint-layer");ea={layer:n[n.length-1],displayIndex:n.length-1,direction:"over"};for(var ab=0;ab<va.length;ab++){let ib=va[va.length-1-ab].getBoundingClientRect();if(0===ab&&S>ib.bottom){ea=h.getLayersRoot().layers[0];
ea={layer:ea,displayIndex:n.indexOf(ea),direction:"under"};break}if(S>=ib.top){va=n[ab];let La=ib.bottom-ib.top;ea={layer:va,displayIndex:ab};va instanceof Ua?S>=ib.top+.75*La?va.expanded&&va.layers.length>0?(ea.layer=va.layers[va.layers.length-1],ea.displayIndex--,ea.direction="over"):ea.direction="under":S>=ib.top+.25*La?va.expanded&&va.layers.length>0?(ea.layer=va.layers[va.layers.length-1],ea.displayIndex--,ea.direction="over"):ea.direction="inside":ea.direction="over":ea.direction=S>=ib.top+
.5*La?"under":"over";break}}return ea.layer.parent===T.layer.parent&&("over"===ea.direction||"under"===ea.direction)&&(S=ea.layer.parent,ab=S.indexOf(ea.layer),"over"===ea.direction&&S.layers[ab+1]===T.layer||"under"===ea.direction&&S.layers[ab-1]===T.layer||ea.layer===T.layer)?null:T.layer instanceof Ua&&(ea.layer===T.layer&&"inside"===ea.direction||ea.layer.hasAncestor(T.layer))?null:ea}(T.dragX,T.dragY),T.dropTarget){var $a=y(T.dropTarget.displayIndex);switch(T.dropTarget.direction){case "over":case "under":ra.appendChild(T.dropBetweenMarkerElem);
da=T.dropTarget.layer.getDepth()-1;var Z;$a=$a.getBoundingClientRect();if("under"===T.dropTarget.direction&&T.dropTarget.layer instanceof Ua&&T.dropTarget.layer.expanded){for(Z=T.dropTarget.displayIndex-1;Z>=0&&n[Z].hasAncestor(T.dropTarget.layer);Z--);Z=y(Z+1).getBoundingClientRect().bottom}else Z=$a.bottom;da=$a.left-R.left+(da>0?26+16*da:0);T.dropBetweenMarkerElem.style.left=da+"px";T.dropBetweenMarkerElem.style.width=$a.right-R.left-da+"px";T.dropBetweenMarkerElem.style.top=("over"===T.dropTarget.direction?
$a.top-1:Z+1)-R.top+"px";ra.querySelectorAll(".chickenpaint-layer-drop-target").forEach(S=>S.classList.remove("chickenpaint-layer-drop-target"));da=!1;break;case "inside":let ea=ra.querySelectorAll(".chickenpaint-layer");ea.forEach((S,va)=>{S.classList.toggle("chickenpaint-layer-drop-target",ea.length-1-va===T.dropTarget.displayIndex)});wa=!1}}wa&&ra.querySelectorAll(".chickenpaint-layer-drop-target").forEach(ea=>ea.classList.remove("chickenpaint-layer-drop-target"));da&&(null==(Aa=T.dropBetweenMarkerElem)||
Aa.remove());T.frameElem.style.top=T.dragY-R.top-parseInt(T.frameElem.style.height,10)/2+"px"}else null==(R=T.dropBetweenMarkerElem)||R.remove(),null==(wa=T.frameElem)||wa.remove()}function M(Aa){let R=Aa.getImageThumbnail().getAsCanvas(ub);return R.title=Q("Image"),R.className="chickenpaint-layer-thumbnail chickenpaint-layer-image-thumbnail",R.style.maxWidth=R.width/R.height*25+"px",Aa!=h.getActiveLayer()||h.isEditingMask()||(R.className+=" active"),R}function L(Aa){let R=Aa.getMaskThumbnail().getAsCanvas(ub);
(R.title=Q("Layer mask"),R.className="chickenpaint-layer-thumbnail chickenpaint-layer-mask-thumbnail",R.style.maxWidth=R.width/R.height*25+"px",Aa==h.getActiveLayer()&&h.isEditingMask()&&(R.className+=" active"),Aa.maskVisible)||(R.className+=" disabled",Aa=R.getContext("2d"),Aa.strokeStyle="red",Aa.lineWidth=3,Aa.moveTo(5,5),Aa.lineTo(R.width-5,R.height-5),Aa.moveTo(R.width-5,5),Aa.lineTo(5,R.height-5),Aa.stroke());return R}function J(Aa,R){let da=document.createElement("div");var wa=document.createElement("div");
let $a=document.createElement("div");var Z=document.createElement("div");let ea=document.createElement("div"),S=document.createElement("div"),va=document.createElement("div");if(da.className="chickenpaint-layer list-group-item",R==h.getActiveLayer()&&(da.className+=" active"),wa.className="chickenpaint-layer-eye",R.ancestorsAreVisible()||(wa.className+=" chickenpaint-layer-eye-hidden-ancestors"),wa.style.marginRight=2+16*(R.getDepth()-1)+"px",R.visible?(da.className+=" chickenpaint-layer-visible",
wa.appendChild(ec("icon-eye"))):(da.className+=" chickenpaint-layer-hidden",wa.appendChild(ec("icon-eye-slash"))),da.appendChild(wa),$a.className="chickenpaint-layer-description",R instanceof ta){if(R.clip&&(da.className+=" chickenpaint-layer-clipped",Z.appendChild(ec("icon-level-down-alt fa-flip-horizontal"))),R.lockAlpha)wa=se("lock-alpha"),wa.title=Q("Transparency locked"),S.appendChild(wa)}else R instanceof Ua&&(da.className+=" chickenpaint-layer-group",R.expanded?(da.className+=" chickenpaint-layer-group-expanded",
Z.appendChild(ec("icon-folder-open chickenpaint-layer-group-toggle"))):(da.className+=" chickenpaint-layer-group-collapsed",Z.appendChild(ec("icon-folder chickenpaint-layer-group-toggle"))));Z.childNodes.length&&(Z.className="chickenpaint-layer-icons",da.appendChild(Z));try{R instanceof ta&&da.appendChild(M(R)),R.mask&&da.appendChild(L(R))}catch(ab){console.log("Failed to create layer thumb")}Z=R.name&&R.name.length>0?R.name:"(unnamed "+(R instanceof Ua?"group":"layer")+")";return ea.innerText=Z,
ea.setAttribute("title",Z),ea.className="chickenpaint-layer-name",va.innerText=Q(I.BLEND_MODE_DISPLAY_NAMES[R.blendMode])+": "+R.alpha+"%",va.className="chickenpaint-layer-blend",$a.appendChild(ea),$a.appendChild(va),da.appendChild($a),S.className="chickenpaint-layer-status",da.appendChild(S),da.setAttribute("data-display-index",""+Aa),da}function W(Aa){if(Aa>-1){let R=n[Aa];Aa=y(Aa);R&&Aa&&m.show(R,Aa)}}function ba(Aa){2===T.state?(T.layerElem.classList.remove("chickenpaint-layer-dragging"),T.dropTarget&&
("inside"===T.dropTarget.direction?a.actionPerformed({action:"CPRelocateLayer",layer:T.layer,toGroup:T.dropTarget.layer,toIndex:T.dropTarget.layer.layers.length}):a.actionPerformed({action:"CPRelocateLayer",layer:T.layer,toGroup:T.dropTarget.layer.parent,toIndex:T.dropTarget.layer.parent.indexOf(T.dropTarget.layer)+ +("over"===T.dropTarget.direction)})),T.dropTarget=null,T.state=0,G()):T.state=0;vb&&(clearTimeout(vb),vb=null);ra.releasePointerCapture(Aa.pointerId);ra.removeEventListener("pointermove",
na);ra.removeEventListener("pointerup",ba)}function ma(){T.state=2;T.frameElem=document.createElement("div");T.frameElem.className="chickenpaint-layer-drag-frame";T.frameElem.style.width=T.layerElem.offsetWidth+"px";T.frameElem.style.height=T.layerElem.offsetHeight+"px";T.dropBetweenMarkerElem=document.createElement("div");T.dropBetweenMarkerElem.className="chickenpaint-layer-drop-between-mark";T.layerElem.classList.add("chickenpaint-layer-dragging");ra.appendChild(T.frameElem)}function na(Aa){Aa=
Aa.clientY;switch(T.state){case 3:if(Math.abs(Aa-T.dragY)>5)T.state=4;else break;case 4:ra.scrollTop=T.initialScrollTop+T.dragY-Aa;break;case 1:if(Math.abs(Aa-T.dragY)>5)ma();else break;case 2:T.dragY=Aa,G()}}function H(Aa,R,da){try{let wa=Aa.querySelector("."+(da?"chickenpaint-layer-mask-thumbnail":"chickenpaint-layer-image-thumbnail"));wa&&wa.replaceWith(da?L(R):M(R))}catch(wa){console.log("Error rebuilding thumbnail: ",wa)}}let T={state:0,layer:null,layerElem:null,dragX:0,dragY:0,initialScrollTop:0,
dropTarget:null,dropBetweenMarkerElem:null,frameElem:null},Ca=document.createElement("div"),ra=document.createElement("div"),ub=0,mb=!1,vb=null;for(let Aa of(this.buildLayers=function(){let R=(n=h.getLayersRoot().getLinearizedLayerList(!0)).map((wa,$a)=>J($a,wa)),da=document.createDocumentFragment();ra.innerHTML="";for(let wa=R.length-1;wa>=0;wa--)da.appendChild(R[wa]);ra.appendChild(da);G()},this.layerChanged=function(R){let da=n.indexOf(R),wa=y(da);!wa||R instanceof Ua&&(R.expanded!=wa.classList.contains("chickenpaint-layer-group-expanded")||
R.visible!=wa.classList.contains("chickenpaint-layer-visible"))?this.buildLayers():wa.replaceWith(J(da,R))},this.setRotation90=function(R){if(ub!==R)for(ub=R,R=0;R<n.length;R++){let da=n[R],wa=y(R);wa&&(H(wa,da,!1),da.mask&&H(wa,da,!0))}},this.layerImageThumbChanged=function(R){let da=y(n.indexOf(R));da&&H(da,R,!1)},this.layerMaskThumbChanged=function(R){let da=y(n.indexOf(R));da&&(R.mask?H(da,R,!0):(R=da.querySelector(".chickenpaint-layer-mask-thumbnail"))&&R.remove())},this.activeLayerChanged=function(R,
da){ra.querySelectorAll(".active").forEach($a=>{$a.classList.remove("active")});var wa=y(n.indexOf(R));wa.classList.add("active");R=wa.querySelector(".chickenpaint-layer-image-thumbnail");wa=wa.querySelector(".chickenpaint-layer-mask-thumbnail");R&&R.classList.toggle("active",!da);wa&&wa.classList.toggle("active",da)},this.resize=function(){b.dismissNotification();this.buildLayers()},this.getElement=function(){return Ca},this.revealLayer=function(R){R=y(R);let da=R.getBoundingClientRect(),wa=ra.getBoundingClientRect();
return ra.scrollTop=Math.max(Math.min(Math.max(ra.scrollTop,ra.scrollTop+da.bottom-wa.bottom),ra.scrollTop+da.top-wa.top),0),R},e.id="chickenpaint-layer-pop",Ca.className="chickenpaint-layers-widget",Ca.addEventListener("contextmenu",R=>R.preventDefault(),!0),ra.className="list-group",ra.addEventListener("dblclick",function(R){0===R.button&&R.target.closest(".chickenpaint-layer-description")&&!R.target.closest("input")&&(W(E(R.target)),R.preventDefault())}),ra.addEventListener("pointerdown",function(R){let da=
E(R.target.closest(".chickenpaint-layer"));if(-1!==da){let wa=n[da];if(0===R.button&&R.target.closest(".chickenpaint-layer-eye"))a.actionPerformed({action:"CPSetLayerVisibility",layer:wa,visible:!wa.visible});else if(0===R.button&&wa instanceof Ua&&R.target.closest(".chickenpaint-layer-group-toggle"))a.actionPerformed({action:"CPExpandLayerGroup",group:wa,expand:!wa.expanded});else{let $a=h.getActiveLayer()!==wa;if(mb=null!==R.target.closest(".chickenpaint-layer-mask-thumbnail")||wa instanceof Ua&&
null!==wa.mask&&$a,0===R.button&&R.shiftKey&&!R.ctrlKey&&!R.metaKey&&mb)a.actionPerformed({action:"CPSetMaskVisible",layer:wa,visible:!wa.maskVisible});else{let Z,ea;(Z=0===R.button||$a?mb:h.isEditingMask(),ea=h.isEditingMask()!==Z,($a||ea)&&a.actionPerformed({action:"CPSetActiveLayer",layer:wa,mask:Z}),Z&&R.altKey)?a.actionPerformed({action:"CPToggleMaskView"}):Z&&!R.shiftKey&&(R.ctrlKey||R.metaKey)?a.actionPerformed({action:"CPApplyLayerMask"}):Z&&R.shiftKey&&(R.ctrlKey||R.metaKey)?a.actionPerformed({action:"CPRemoveLayerMask"}):
0===R.button?("pen"===R.pointerType||"touch"===R.pointerType?(T.state=3,T.initialScrollTop=ra.scrollTop,vb&&clearTimeout(vb),vb=setTimeout(()=>{3===T.state&&(ma(),T.dragY=R.clientY,G())},800)):T.state=1,T.dropTarget=null,T.layer=wa,T.layerElem=y(da),T.dragX=R.clientX,T.dragY=R.clientY,ra.setPointerCapture(R.pointerId),ra.addEventListener("pointermove",na),ra.addEventListener("pointerup",ba)):2===R.button&&!$a&&(R.preventDefault(),-1!=E(R.target)&&(W(E(R.target)),R.preventDefault()))}}}}),ra.setAttribute("touch-action",
"none"),["ontouchstart","ontouchmove","ontouchend","ontouchcancel"]))ra.addEventListener(Aa,rg);Ca.appendChild(ra)},l=new Mb(0,100,!1,!1,208),f=document.createElement("select"),m=new function(){let y=null,E="",G=document.createElement("input"),M=this;this.hide=function(){y=null;let L=G.parentNode;L&&(L.removeChild(G),L.textContent=E)};this.renameAndHide=function(){y&&y.name!==G.value&&a.actionPerformed({action:"CPSetLayerName",layer:y,name:G.value});this.hide()};this.show=function(L,J){G.value=E=
(y=L).name;(L=J.querySelector(".chickenpaint-layer-name"))&&L.parentNode&&(J=L.firstChild)&&J.nodeType===Node.TEXT_NODE&&(L.removeChild(J),L.appendChild(G));G.select()};G.type="text";G.className="chickenpaint-layer-rename form-control input-sm";G.addEventListener("keydown",function(L){L.stopPropagation()});G.addEventListener("keydown",function(L){"Enter"===L.key&&M.renameAndHide();L.stopPropagation()});G.addEventListener("keyup",function(L){"Escape"===L.key&&M.hide();L.stopPropagation()});G.addEventListener("blur",
function(L){y&&M.renameAndHide()})},r=document.createElement("input"),q=document.createElement("input"),t=!1,v,x=this.setSize,A=this.setWidth,B=this.setHeight;this.setSize=function(y,E){x.call(this,y,E);this.dismissNotification();l.resize()};this.setWidth=function(y){A.call(this,y);l.resize();k.resize()};this.setHeight=function(y){B.call(this,y);k.resize()};this.setRotation90=function(y){k.setRotation90(y)};this.dismissNotification=function(){document.querySelectorAll(".chickenpaint-layer[aria-describedby], .chickenpaint-slider[aria-describedby]").forEach(y=>
{(y=Pb.Popover.getInstance(y))&&y.dispose()});t&&(clearTimeout(t),t=!1)};this.showNotification=(y,E,G)=>{let M=n.indexOf(y);y=h.getActiveLayer()==y&&"opacity"==G?l.getElement():k.revealLayer(M);this.dismissNotification();(new Pb.Popover(y,{html:!1,content:E,placement:"left",trigger:"manual",fallbackPlacement:[],boundary:"window",container:b.getElement()})).show();t=setTimeout(()=>{t=!1;this.dismissNotification()},Math.max(Math.round(70*E.length),3E3))};f.className="form-control form-control-sm";f.tabIndex=
-1;f.title=Q("Layer blending mode");f.addEventListener("change",function(y){a.actionPerformed({action:"CPSetLayerBlendMode",blendMode:parseInt(f.value,10)});f.blur()});g.appendChild(f);l.title=function(y){return Q("Opacity")+": "+y+"%"};l.on("valueChange",function(y){a.actionPerformed({action:"CPSetLayerAlpha",alpha:y})});g.appendChild(l.getElement());r.id="chickenpaint-chk-sample-all-layers";r.type="checkbox";r.addEventListener("click",function(y){h.setSampleAllLayers(r.checked);document.activeElement.blur()});
g.appendChild(kf(r,Q("Blend all layers")));q.id="chickenpaint-chk-lock-alpha";q.type="checkbox";q.addEventListener("click",function(y){a.actionPerformed({action:"CPSetLayerLockAlpha",lock:q.checked});document.activeElement.blur()});g.appendChild(kf(q,Q("Lock transparency")));g.appendChild(k.getElement());v=function(){var y=[{title:"Add layer",icon:ec("icon-file"),action:"CPAddLayer"},{title:"Add group",icon:ec("icon-folder"),action:"CPAddGroup"},{title:"Merge down",icon:ec("icon-md-download"),action:"CPLayerMergeDown",
require:["image-layer"]},{title:"Merge group",icon:ec("icon-md-collapse_all"),action:"CPGroupMerge",require:["layer-group"]},{title:"Clip to the layer below",icon:ec("icon-level-down-alt fa-flip-horizontal"),action:"CPCreateClippingMask",require:"no-clipping-mask-or-is-group"},{title:"Unclip from the layer below",icon:ec("icon-level-down-alt fa-flip-horizontal"),action:"CPReleaseClippingMask",require:"clipping-mask"},{title:"Add layer mask",icon:se("mask"),action:"CPAddLayerMask",require:["no-mask"]},
{title:"Apply mask",icon:se("mask"),action:"CPApplyLayerMask",require:["mask"]},{title:"Duplicate",icon:ec("icon-clone"),action:"CPLayerDuplicate"},{title:"Delete layer mask",icon:ec("icon-trash"),action:"CPRemoveLayerMask",require:"isEditingMask"},{title:"Delete layer",icon:ec("icon-trash"),action:"CPRemoveLayer",require:"isNotEditingMask"}];let E=document.createElement("ul");for(let G of(E.className="chickenpaint-layer-buttons list-unstyled",y))y=document.createElement("li"),y.setAttribute("data-action",
G.action),y.className="chickenpaint-small-toolbar-button "+(G.require?"chickenpaint-action-require-"+G.require:""),y.title=Q(G.title),y.appendChild(G.icon),y.addEventListener("click",function(){a.actionPerformed({action:G.action})}),E.appendChild(y);return E}();g.appendChild(v);h.on("changeActiveLayer",function(y,E,G){k.activeLayerChanged(E,G);c()});h.on("changeLayer",function(y){h=this;b.dismissNotification();k.layerChanged(y);c()});h.on("changeStructure",d);h.on("changeLayerMaskThumb",function(y){h=
this;k.layerMaskThumbChanged(y)});h.on("changeLayerImageThumb",function(y){h=this;k.layerImageThumbChanged(y)});a.on("layerNotification",this.showNotification.bind(this));d.call(h)}function sg(){this.table=new Uint8Array(256);this.loadIdentity=function(){for(var a=0;a<256;a++)this.table[a]=a};this.loadBrightnessContrast=function(a,c){c=c>0?1/(1.0001-c):1+c;a=.5-.5*c+a;for(var d=0;d<256;d++)this.table[d]=Math.min(255,Math.max(~~(255*(d/255*c+a)),0))};this.invert=function(){for(var a=0;a<256;a++)this.table[a]=
255-this.table[a]}}function lf(a,c){let d=document.createElement("div"),b=document.createElement("label");return d.className="form-check",a.className="form-check-input",b.className="form-check-label",b.setAttribute("for",a.id),b.appendChild(a),b.appendChild(document.createTextNode(c)),d.appendChild(a),d.appendChild(b),d}function Nd(a){function c(L){for(let J=0;J<L.length;J++){let W=new e(L[J],32,32);W.on("click",function(){r=this.texture;g()});E.appendChild(W.getElement())}}function d(L){let J=new Ba(L,
L,8);for(let W=1;W<L*L;W++)J.data[W]=255;return J}function b(L){let J=2*L,W=new Ba(J,J,8);for(let ba=0;ba<J;ba++)for(let ma=0;ma<J;ma++)W.data[ba+ma*J]=255*((~~(ba/L)+~~(ma/L))%2!=0);return W}function h(L,J){let W=new Ba(J,J,8);for(let ba=0;ba<J*J;ba++)~~(ba%J)>=L&&(W.data[ba]=255);return W}function n(L,J){let W=new Ba(J,J,8);for(let ba=0;ba<J*J;ba++)ba/J>=L&&(W.data[ba]=255);return W}function g(){if(null!=r){q=r.clone();t&&q.mirrorHorizontally();let W=new sg;W.loadBrightnessContrast(x,A);v&&W.invert();
if(1!==B){var L=q,J=B;let ba=Math.max(1,Math.floor(L.width*J)),ma=Math.max(1,Math.floor(L.height*J)),na=new Ba(ba,ma,L.bitDepth),H=255,T=0;for(let Ca=0;Ca<ma;Ca++)for(let ra=0;ra<ba;ra++){let ub=L.data[Math.floor(Ca/J)*L.width+Math.floor(ra/J)];na.data[Ca*ba+ra]=ub;ub<H&&(H=ub);ub>T&&(T=ub)}q=H===T?L:na}q.applyLUT(W)}else q=null;a.getArtwork().setBrushTexture(q);null!=y&&y.updateTexture()}function e(L,J,W){let ba=document.createElement("canvas"),ma=ba.getContext("2d"),na=this;this.setTexture=function(H){this.texture=
H;this.paint()};this.getElement=function(){return ba};this.paint=function(){null!=this.texture?ma.fillStyle=ma.createPattern(this.texture.getAsCanvas(),"repeat"):ma.fillStyle="white";ma.fillRect(0,0,ba.width,ba.height)};ba.addEventListener("click",function(){na.emit("click")});ba.width=J;ba.height=W;this.setTexture(L)}var k;let l,f,m;Ob.call(this,a,"textures","Textures");let r,q,t=!1,v=!1,x=0,A=0,B=1,y,E=document.createElement("div"),G=this.getBodyElement();e.prototype=Object.create(ya(Hb).prototype);
e.prototype.constructor=e;y=new function(){function L(){na.checked=v;H.checked=t;T.setValue(100*x+100);Ca.setValue(100*A+100);ra.setValue(100*B)}let J,W,ba,ma=document.createElement("div"),na=document.createElement("input"),H=document.createElement("input"),T=new Mb(0,200,!0),Ca=new Mb(0,200,!0),ra=new Mb(50,800,!1,!0,150,3.9),ub=new e(null,64,64),mb=document.createElement("button"),vb,Aa=new Pb.Popover(mb,{html:!0,content:()=>vb,trigger:"manual",placement:"right",container:G,fallbackPlacements:[]});
this.updateTexture=function(){mb.disabled=null==q;ub.setTexture(q)};this.getElement=function(){return ma};ma.className="chickenpaint-texture-options";ma.appendChild(ub.getElement());mb.type="button";mb.className="btn btn-light btn-sm";mb.setAttribute("data-bs-toggle","popover");mb.setAttribute("data-bs-placement","right");mb.textContent=Q("Customize");(J=document.createElement("div")).className="chickenpaint-texture-controls";na.id="chickenpaint-chk-texture-invert";na.type="checkbox";na.addEventListener("click",
function(R){v=this.checked;g()});J.appendChild(lf(na,Q("Inverse")));H.id="chickenpaint-chk-texture-mirror";H.type="checkbox";H.addEventListener("click",function(R){t=this.checked;g()});J.appendChild(lf(H,Q("Mirror")));T.title=function(R){return Q("Brightness")+": "+(R-100)+"%"};T.on("valueChange",function(R){x=(R-100)/100;g()});J.appendChild(T.getElement());Ca.title=function(R){return Q("Contrast")+": "+(R-100)+"%"};Ca.on("valueChange",function(R){A=(R-100)/100;g()});J.appendChild(Ca.getElement());
ra.title=function(R){return Q("Scale")+": "+R+"%"};ra.on("valueChange",function(R){B=R/100;g()});J.appendChild(ra.getElement());W=document.createElement("button");ba=document.createElement("button");W.textContent="Ok";W.className="btn btn-primary btn-sm";W.type="button";W.addEventListener("click",function(R){Aa.hide()});J.appendChild(W);J.appendChild(document.createTextNode(" "));ba.textContent=Q("Reset");ba.className="btn btn-secondary btn-sm";ba.type="button";ba.addEventListener("click",function(R){A=
x=0;B=1;v=t=!1;L();g()});J.appendChild(ba);L();vb=J;mb.addEventListener("click",function(){Aa.toggle()});ma.appendChild(mb);this.updateTexture()};G.appendChild(y.getElement());E.className="chickenpaint-texture-swatches";G.appendChild(E);c((k=[null],(l=new Ba(2,2,8)).data[0]=255,l.data[3]=255,k.push(l),k.push(d(2)),k.push(d(3)),k.push(d(4)),k.push(d(6)),k.push(d(8)),k.push(h(1,2)),k.push(h(2,4)),k.push(n(1,2)),k.push(n(2,4)),k.push(b(2)),k.push(b(4)),k.push(b(8)),k.push(b(16)),k.push(function(L){let J=
new Ba(256,L,8);for(let W=0;W<L*L;W++)J.data[W]=Math.max(0,Math.min(255,Math.floor((.65*Math.floor(256*Math.random())-128)*.65+128)));return J}(256)),k));k=a.getResourcesRoot()+"gfx/textures32.png?20241024.1";var M=function(L){c(L)};f=new Image;m=[];f.onload=function(){var L=document.createElement("canvas");let J=L.getContext("2d",{willReadFrequently:!0});L.width=f.width;L.height=f.height;for(L=0;L<2;L++){J.drawImage(f,0,32*L,32,32,0,0,32,32);try{let W=J.getImageData(0,0,32,32),ba=new Ba(32,32,8);
for(let ma=0;ma<1024;ma++)ba.data[ma]=W.data[4*ma];m.push(ba)}catch(W){console.log(W)}}M(m)};f.src=k}function Od(a){function c(x){let A=document.createElement("div"),B=document.createElement("a"),y=document.createElement("ul"),E=document.createElement("a"),G=document.createElement("a"),M=this;this.getElement=function(){return A};this.setColor=function(J){B.setAttribute("data-color",J);var W=B.style;for(J=""+Number(J).toString(16);J.length<6;)J="0"+J;W.backgroundColor="#"+J};this.setColor(x);B.href=
"#";B.className="chickenpaint-color-swatch dropdown-toggle";E.className="dropdown-item";E.href="#";E.textContent=Q("Remove");E.addEventListener("click",function(J){J.preventDefault();A.remove();f=!0});G.className="dropdown-item";G.href="#";G.textContent=Q("Replace with current color");G.addEventListener("click",function(J){J.preventDefault();M.setColor(a.getCurColor().getRgb());f=!0});y.className="dropdown-menu";x=document.createElement("li");let L=document.createElement("li");x.appendChild(E);L.appendChild(G);
y.appendChild(x);y.appendChild(L);A.className="chickenpaint-color-swatch-wrapper";A.appendChild(B);A.appendChild(y)}function d(x){x=new c(x);m.appendChild(x.getElement())}function b(x){let A=document.createElement("span");return A.className="fa icon-"+x,A}var h;let n;let g,e,k;Ob.call(this,a,"swatches","Color swatches");var l=[16777215,0,16711680,65280,255,16776960];let f=!1,m=document.createElement("ul"),r=document.createElement("div"),q,t=this;this.getSwatches=function(){let x=m.querySelectorAll(".chickenpaint-color-swatch"),
A=Array(x.length);for(let B=0;B<x.length;B++)A[B]=parseInt(x[B].getAttribute("data-color"),10);return A};this.setSwatches=function(x){for(;m.lastChild;)m.removeChild(m.lastChild);for(let A=0;A<x.length;A++)d(x[A]);f=!0};this.isModified=function(){return f};m.className="chickenpaint-color-swatches list-unstyled";for(h=0;h<l.length;h++)m.appendChild((new c(l[h])).getElement());m.addEventListener("click",function(x){let A=x.target;/^<a data-color=/i.test(A.outerHTML)&&/chickenpaint-color-swatch/.test(A.className)&&
0==x.button&&void 0!==A.getAttribute("data-color")&&(a.setCurColor(new db(parseInt(A.getAttribute("data-color"),10))),x.stopPropagation(),x.preventDefault())});m.addEventListener("contextmenu",function(x){let A=x.target;if(/^<a data-color=/i.test(A.outerHTML)&&/chickenpaint-color-swatch/.test(A.className)){x.preventDefault();var B=new Pb.Dropdown(A);B.toggle();document.addEventListener("click",function G(E){B.hide();document.removeEventListener("click",G)})}});this.getBodyElement().appendChild(m);
l=document.createElement("button");h=document.createElement("button");n=document.createElement("ul");var v=document.createElement("a");g=document.createElement("a");h.type="button";h.title=Q("Add the current brush color as a new swatch");h.className="btn chickenpaint-small-toolbar-button chickenpaint-color-swatch-add";h.appendChild(b("plus"));l.type="button";l.className="btn dropdown-toggle chickenpaint-small-toolbar-button chickenpaint-color-swatch-settings";l.setAttribute("data-bs-toggle","dropdown");
l.appendChild(b("cog"));v.className="dropdown-item";v.href="#";v.textContent=Q("Save swatches to your computer...");v.addEventListener("click",function(x){x.preventDefault();x=new Blob([(new $c).write(t.getSwatches())],{type:"application/octet-stream"});ya(pd).saveAs(x,"oekakiswatches.aco")});g.className="dropdown-item";g.href="#";g.textContent=Q("Load swatches from your computer...");g.addEventListener("click",function(x){x.preventDefault();q.onchange=function(){var A=this.files;if(!(A.length<1)){A=
A[0];var B=new FileReader;B.onload=function(){let y=(new $c).read(this.result);null!=y&&y.length>0?t.setSwatches(y):alert(Q("The swatches could not be read, did you select an .aco file?"))};B.readAsArrayBuffer(A)}};q.click()});n.className="dropdown-menu";e=document.createElement("li");k=document.createElement("li");e.appendChild(v);k.appendChild(g);n.appendChild(e);n.appendChild(k);(v=document.createElement("div")).className="btn-group";v.appendChild(l);v.appendChild(n);h.addEventListener("click",
function(x){d(a.getCurColor().getRgb());f=!0});r.className="chickenpaint-color-swatches-buttons";window.File&&window.FileReader&&window.FileList&&window.Blob&&((q=document.createElement("input")).type="file",q.multiple=!1,q.style.display="none",r.appendChild(v),r.appendChild(q));r.appendChild(h);this.getBodyElement().appendChild(r)}function Pd(a){function c(){let f=g.closest(".chickenpaint").querySelector(".chickenpaint-canvas");return{width:f.offsetWidth,height:f.offsetHeight}}function d(f,m){let r=
f.getElement();m?g.contains(r)||g.appendChild(r):g.contains(r)&&g.removeChild(r);e.emitEvent("paletteVisChange",[f.name,m])}let b={tool:new Id(a),color:new Ld(a),swatches:new Od(a),stroke:new Kd(a),brush:new bd(a),layers:new Md(a),misc:new Jd(a),textures:new Nd(a)},h={tool:!1,color:!1,misc:!1};var n={color:!0,textures:!0,layers:!0};let g=document.createElement("div"),e=this,k=[],l=[];for(let f in this.palettes=b,this.showPaletteByName=function(m,r){(m=b[m])&&d(m,r)},this.togglePalettes=function(){let m=
a.mainGUI.getMainMenu().getElement().querySelector('.widget-nav [data-action="CPTogglePalettes"]');if(0===l.length)g.querySelectorAll(".chickenpaint-palette").forEach(function(r){e.showPaletteByName(r.getAttribute("data-paletteName"),!1);l.push(r)}),m.classList.remove("selected");else{for(let r=0;r<l.length;r++)e.showPaletteByName(l[r].getAttribute("data-paletteName"),!0);l=[];m.classList.add("selected")}},this.constrainPalettes=function(){let m=c();for(var r in b){let q=b[r];q.getX()+q.getWidth()/
2>m.width&&q.setLocation(m.width-q.getWidth(),q.getY());q.getY()+q.getHeight()/2>m.height&&q.setLocation(q.getX(),m.height-q.getHeight())}r=m.width-b.tool.getWidth()-b.misc.getWidth()-b.stroke.getWidth()-b.color.getWidth()-b.brush.getWidth()-15>0;b.swatches.getX()+b.swatches.getWidth()==b.brush.getX()+b.brush.getWidth()&&20>Math.abs(b.swatches.getY()-b.brush.getY())&&b.swatches.setLocation(b.brush.getX()-b.swatches.getWidth()-(r?5:1),0);b.layers.getY()+b.layers.getHeight()>m.height&&b.layers.setHeight(Math.max(m.height-
b.layers.getY(),200))},this.arrangePalettes=function(){let m=c();var r=a.getSmallScreenMode();var q=a.mainGUI.getMainMenu().getElement(),t=q.querySelector('.dropdown-item[data-action="CPToggleSetSmallScreenMode"]');t&&(r?t.classList.add("selected"):t.classList.remove("selected"));if(q=q.querySelector('.widget-nav [data-action="CPToggleSetSmallScreenMode"]'))q.className="widget-toggler mobile selected",q.dataset.checkbox="true",q.type="button",q.classList.add("selected"),q.dataset.selected="true",
q.textContent="",t=document.createElement("span"),t.textContent=r?Q("PC mode"):Q("Mobile mode"),q.appendChild(t);r?(b.tool.setLocation(0,0),b.misc.setLocation(b.tool.getX()+b.tool.getWidth()+1,0),r=m.width-(b.tool.getWidth()+b.misc.getWidth()+b.brush.getWidth())<=16?b.misc.getY()+b.misc.getHeight()+1:0,b.brush.setLocation(m.width-b.brush.getWidth()-15,r),b.textures.setWidth(m.width-b.textures.getX()),b.layers.setLocation(b.brush.getX()+b.brush.getWidth()-b.layers.getWidth(),b.textures.getY()-b.layers.getHeight()),
r=Math.max(b.textures.getY()-330-1,370),b.layers.setHeight(r),b.layers.setWidth(218),b.stroke.setLocation(b.misc.getX(),b.misc.getY()+b.misc.getHeight()+1),b.swatches.setLocation(b.stroke.getX(),b.stroke.getY()+b.stroke.getHeight()+1)):(r=m.width-b.tool.getWidth()-b.misc.getWidth()-b.stroke.getWidth()-b.color.getWidth()-b.brush.getWidth()-15>0,b.brush.setLocation(m.width-b.brush.getWidth()-15,0),q=b.brush.getY()+b.brush.getHeight(),q=m.height-q>300?q+2:q,b.layers.setSize(b.brush.getWidth()+30*!!r,
m.height-q),b.layers.setLocation(b.brush.getX()+b.brush.getWidth()-b.layers.getWidth(),q),b.tool.setLocation(0,0),b.misc.setLocation(b.tool.getX()+b.tool.getWidth()+(r?5:1),0),r?b.stroke.setLocation(b.misc.getX()+b.misc.getWidth()+(r?5:1),0):b.stroke.setLocation(b.misc.getX(),b.misc.getY()+b.misc.getHeight()+1),b.swatches.setLocation(Math.max(b.brush.getX()-b.swatches.getWidth()-(r?5:1),b.tool.getX()+b.tool.getWidth()),0),b.textures.setWidth(Math.min(b.layers.getX()-b.textures.getX(),490)));b.textures.setLocation(b.color.getX()+
b.color.getWidth()+4,m.height-b.textures.getHeight());b.color.setLocation(0,Math.max(b.tool.getY()+b.tool.getHeight(),m.height-b.color.getHeight()))},a.on("smallScreen",function(m){for(let r in b)b[r].toggleCollapse(m&&(!(r in h)||h[r]))}),this.getElement=function(){return g},g.className="chickenpaint-palettes",b){let m=b[f],r=m.getElement();m.on("paletteVisChange",function(){d(this,!1)});f in n&&m.setCollapseDownwards(!0);r.setAttribute("data-paletteName",f);k.push(r)}for(let f in b)n=b[f].getElement(),
g.appendChild(n)}function tg(a,c){function d(e){let k,l=e.dataset.action,f="true"===e.dataset.checkbox;a.isActionAllowed(l)&&(f?(e.classList.toggle("selected"),k=e.classList.contains("selected")):k=!1,a.actionPerformed({action:l,checkbox:f,selected:k}))}let b=document.createElement("nav");b.className="navbar navbar-expand-md bg-light";b.innerHTML='\n    <div class="navbar-upper">\n      <a class="navbar-brand" href="#">ChickenPaint Be</a>\n      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#chickenpaint-main-menu-content" aria-controls="chickenpaint-main-menu-content" aria-expanded="false" aria-label="Toggle main menu">\n        <span class="navbar-toggler-icon"></span>\n      </button>\n    </div>\n    <div class="collapse navbar-collapse" id="chickenpaint-main-menu-content">\n      <div class="navbar-nav"></div>\n    </div>\n    <div class="widget-nav" id="chickenpaint-palette-toggler-content"></div>\n  ';
let h=navigator.userAgent.toLowerCase().includes("mac os");b.addEventListener("touchmove",e=>e.preventDefault(),{passive:!1});b.addEventListener("click",e=>{let k=e.target.closest("a:not(.dropdown-toggle)");k&&(d(k),e.preventDefault())});var n=b.querySelector(".navbar-nav");mf.forEach(e=>{function k(){setTimeout(()=>{let q=document.activeElement;q instanceof HTMLElement&&(q.matches('[data-bs-toggle="dropdown"]')||q.matches(".dropdown-item")||q.closest(".dropdown-menu"))&&q.blur()},10)}var l,f;let m=
document.createElement("div");m.className="nav-item dropdown";m.innerHTML=`
        <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">${Q(e.name)}</a>
        <ul class="dropdown-menu"></ul>
      `;let r=m.querySelector(".dropdown-menu");null==(l=m.querySelector(".dropdown-toggle"))||l.addEventListener("show.bs.dropdown",()=>{k();m.querySelectorAll("[data-action]").forEach(t=>{let v=a.isActionAllowed(t.dataset.action);t.classList.toggle("disabled",!v);"true"===t.dataset.hideIfNotAvailable&&t.classList.toggle("hidden",!v)});m.querySelectorAll(".dropdown-divider").forEach(t=>t.classList.remove("hidden"));let q=null;Array.from(m.querySelectorAll(".dropdown-item:not(.hidden), .dropdown-divider:not(.hidden)")).forEach((t,
v)=>{t.classList.contains("dropdown-divider")?0===v||q?t.classList.add("hidden"):q=t:q=null});q&&q.classList.add("hidden")});null==(f=m.querySelector(".dropdown-toggle"))||f.addEventListener("hide.bs.dropdown",()=>{k()});e.children.forEach(q=>{let t;if("-"===q.name)q=document.createElement("hr"),q.className="dropdown-divider",null==r||r.appendChild(q);else if(q.action&&a.isActionSupported(q.action)){if("CPSend"!==q.action||a.isActionSupported("CPContinue")||(q.name=Q("Post Oekaki"),q.shortcut="ctrl+p"),
(t=document.createElement("a")).className="dropdown-item",t.href="#",t.dataset.action=q.action,t.innerHTML=`<span>${Q(q.name)}</span>`,q.checkbox&&(t.dataset.checkbox="true",q.checked&&t.classList.add("selected")),q.hideIfNotAvailable&&(t.dataset.hideIfNotAvailable="true"),q.title&&(t.title=Q(q.title)),q.shortcut){h&&(q.shortcut=q.shortcut.replace(/SHIFT/im,"\u21e7").replace(/ALT/im,"\u2325").replace(/CTRL/im,"\u2318"));let x=document.createElement("small");x.className="chickenpaint-shortcut";var v=
(v=q.shortcut).toUpperCase().replace(/(,.+)$/,"").replace("=","+");x.textContent=h?v.replace(/([^+])\+/g,"$1"):v.replace(/([^+])\+/g,"$1 ");t.appendChild(x);ya(Oa)(q.shortcut,A=>(d(t),A.preventDefault(),A.stopPropagation(),!1))}q=document.createElement("li");q.appendChild(t);r.appendChild(q)}});n.appendChild(m)});(function(e,k){k.filter(l=>l.mnemonic&&a.isActionSupported(l.action)).forEach(l=>{let f=document.createElement("button");f.className="widget-toggler selected";f.type="button";f.dataset.action=
l.action;f.dataset.checkbox="true";f.dataset.selected=(!l.checked).toString();let m=document.createElement("span");m.textContent=l.mnemonic;f.appendChild(m);f.addEventListener("click",r=>{d(f);r.preventDefault()});e.appendChild(f)});if(k=k.find(l=>"CPToggleSetSmallScreenMode"===l.action)){let l=a.getSmallScreenMode(),f=document.createElement("button");f.className="widget-toggler mobile selected";f.dataset.checkbox="true";f.type="button";f.dataset.selected="true";f.style.minWidth="110px";f.textContent=
"";let m=document.createElement("span");m.textContent=l?Q("PC mode"):Q("Mobile mode");f.appendChild(m);f.dataset.action=k.action;f.addEventListener("click",r=>{d(f);r.preventDefault()});e.appendChild(f)}})(b.querySelector(".widget-nav"),mf[5].children);c.getPaletteManager().on("paletteVisChange",function(e,k){e="CPPal"+e.charAt(0).toUpperCase()+e.slice(1);[...((null==b?void 0:b.querySelectorAll(`[data-action="${e}"]`))||[])].forEach(l=>{l.classList.toggle("selected",k)})});let g=b.querySelector(".dropdown-item[data-action=CPFullScreen]");
a.on("fullScreen",e=>null==g?void 0:g.classList.toggle("selected",e));null==g||g.classList.toggle("selected",a.isFullScreen());this.getElement=()=>b}function Qd(a,c){let d=document.createElement("div"),b=new Gd(a),h=new Pd(a),n,g=!1,e=this;this.togglePalettes=function(){h.togglePalettes()};this.arrangePalettes=function(){setTimeout(h.arrangePalettes.bind(h),0)};this.constrainPalettes=function(){h.constrainPalettes()};this.showPalette=function(m,r){h.showPaletteByName(m,r)};this.getSwatches=function(){return h.palettes.swatches.getSwatches()};
this.setSwatches=function(m){h.palettes.swatches.setSwatches(m)};this.getPaletteManager=function(){return h};this.setRotation90=function(m){b.setRotation(m*Math.PI/2);h.palettes.layers.setRotation90(m)};this.setFullScreenMode=function(m){g!==m&&(g=m,e.resize(),e.arrangePalettes())};this.resize=function(m=!0){let r=window.innerHeight,q=n.getElement().getBoundingClientRect().height;b.resize(g?r-q:Math.min(Math.max(r-q-65,500),850),!1);m&&e.constrainPalettes()};n=new tg(a,this);this.getMainMenu=function(){return n};
c.appendChild(n.getElement());d.className="chickenpaint-main-section";d.appendChild(b.getElement());d.appendChild(h.getElement());c.appendChild(d);b.on("canvasRotated90",function(m){h.palettes.layers.setRotation90(m)});screen.orientation&&screen.orientation.addEventListener("change",m=>{this.resize();a.actionPerformed({action:"CPArrangePalettes"});setTimeout(()=>{this.resize();a.actionPerformed({action:"CPArrangePalettes"})},10);Promise.resolve().then(()=>{this.resize()}).then(()=>{a.actionPerformed({action:"CPArrangePalettes"})})});
let k=document.getElementById("chickenpaint-main-menu-content");if(document.addEventListener("show.bs.modal",()=>{k&&k.classList.contains("show")&&(new Pb.Collapse(k,{toggle:!1})).hide()}),k){let m=document.querySelector(".chickenpaint .widget-nav");m&&(k.addEventListener("show.bs.collapse",r=>{m.classList.add("hidden")}),k.addEventListener("hidden.bs.collapse",r=>{m.classList.remove("hidden")}));window.addEventListener("resize",()=>{null==m||m.classList.remove("hidden")})}document.addEventListener("hidden.bs.collapse",
this.resize.bind(this));window.addEventListener("resize",this.resize.bind(this));let l=null,f=!1;(new ResizeObserver(()=>{let m=window.innerWidth>document.documentElement.clientWidth;m!==l&&(l=m,f||(f=!0,requestAnimationFrame(()=>{f=!1;this.resize(!1)})))})).observe(document.body);a.on("fullScreen",m=>this.setFullScreenMode(m));a.on("unsavedChanges",m=>{c.classList.toggle("chickenpaint-unsaved",m)});setTimeout(this.resize.bind(this),0)}function ug(a){var c=document.createElement("div");c.classList.add("modal",
"fade","chickenpaint-about-dialog");c.setAttribute("tabindex","-1");c.setAttribute("role","dialog");c.innerHTML='\n        <div class="modal-dialog">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h5 class="modal-title">About ChickenPaint Be</h5>\n                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                </div>\n                <div class="modal-body">\n                    <a class="chickenpaint-on-github" target="_blank" href="https://github.com/satopian/ChickenPaint_Be" rel="noopener">\n                        <span class="icon-github"></span> ChickenPaint Be on GitHub\n                    </a>\n                    <p>\n                        ChickenPaint Be is a customized version of <a href="https://github.com/thenickdude/chickenpaint" target="_blank" rel="noopener">ChickenPaint</a> by satopian.\n                    </p>\n                    <p>\n                        Built on: 2025-10-23T00:57:58<br>\n                        <a href="https://www.gnu.org/licenses/" target="_blank" rel="noopener">GNU General Public License</a><br>\n                    </p>\n                    <a class="chickenpaint-on-github" target="_blank" href="https://github.com/thenickdude/chickenpaint" rel="noopener">\n                        <span class="icon-github"></span> ChickenPaint on GitHub\n                    </a>\n\n                    <p>\n                        ChickenPaint is a translation of <a href="https://github.com/thenickdude/chibipaint" target="_blank" rel="noopener">ChibiPaint</a>\n                        from Java to JavaScript by Nicholas Sherlock / Chicken Smoothie\n                    </p>\n                    <p>\n                        ChibiPaint is Copyright (c) 2006-2008 Marc Schefer. All Rights Reserved\n                    </p>\n                    <p>\n                        ChickenPaint is free software: you can redistribute it and/or modify\n                        it under the terms of the GNU General Public License as published by\n                        the Free Software Foundation, either version 3 of the License, or\n                        (at your option) any later version.\n                    </p>\n                    <p>\n                        ChickenPaint is distributed in the hope that it will be useful,\n                        but WITHOUT ANY WARRANTY; without even the implied warranty of\n                        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n                        <a target="_blank" href="https://www.gnu.org/licenses/" rel="noopener">GNU General Public License</a> for more details.\n                    </p>\n<pre class="pre-scrollable chickenpaint-third-party-licenses">Toolbar icons designed by <a target="_blank" href="https://github.com/Anteira" rel="noopener">Miglena Lapavicheva (Anteira)</a>\n    These icons are dual-licensed under <a target="_blank" href="https://spdx.org/licenses/GPL-3.0-or-later.html" rel="noopener">GPL-3.0-or-later</a> and <a target="_blank" href="https://creativecommons.org/licenses/by/3.0/" rel="noopener">CC-BY-3.0</a>\n\nIncludes these MIT-licensed libraries:\n\n    Includes the <a target="_blank" href="https://github.com/eligrey/FileSaver.js" rel="noopener">FileSaver.js library</a>\n    Copyright (c) 2016 <a target="_blank" href="https://eligrey.com/" rel="noopener">Eli Grey</a>\n\n    Includes the <a target="_blank" href="https://github.com/nodeca/pako" rel="noopener">Pako zlib compression library</a>\n    Copyright (c) 2014-2017 by Vitaly Puzrin and Andrei Tuputcyn\n    \n    Includes the <a target="_blank" href="https://github.com/madrobby/keymaster" rel="noopener">keymaster.js</a> keyboard library\n    Copyright (c) 2011-2013 Thomas Fuchs\n\n    Includes the <a target="_blank" href="https://benalman.com/projects/jquery-throttle-debounce-plugin/" rel="noopener">jQuery throttle-debounce</a> library\n    Copyright (c) 2010 "Cowboy" Ben Alman\n    \n    Includes the <a href="https://getbootstrap.com/" target="_blank" rel="noopener">Bootstrap</a> \n    Copyright (c) 2011-2025 <a href="https://github.com/twbs/bootstrap/blob/main/LICENSE" target="_blank" rel="noopener">The Bootstrap Authors</a>\n\n    MIT License\n\n    Permission is hereby granted, free of charge, to any person\n    obtaining a copy of this software and associated documentation\n    files (the "Software"), to deal in the Software without\n    restriction, including without limitation the rights to use,\n    copy, modify, merge, publish, distribute, sublicense, and/or\n    sell copies of the Software, and to permit persons to whom the\n    Software is furnished to do so, subject to the following\n    conditions:\n\n    The above copyright notice and this permission notice shall be\n    included in all copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,\n    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT \n    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n    OTHER DEALINGS IN THE SOFTWARE.\n\nIncludes Font Awesome by Fonticons, Inc. - <a href="https://fontawesome.com/" target="_blank" rel="noopener">https://fontawesome.com/</a>\nIncludes Material Design icons by Google - <a href="https://fonts.google.com/" target="_blank" rel="noopener">https://fonts.google.com/</a>\n                    </pre>\n                </div>\n            </div>\n        </div>\n    ';
a.appendChild(c);var d=new Pb.Modal(c);return c.addEventListener("hidden.bs.modal",()=>{c.remove()}),{show:function(){d.show()}}}function Rd(a,c){let d=document.createElement("div");d.classList.add("modal","fade");d.setAttribute("tabindex","-1");d.setAttribute("role","dialog");d.innerHTML=`
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Complete transform")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>
                        ${Q("You need to finish transforming this layer before you can do that. What would you like to do with the transform?")}
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light chickenpaint-cancel-transform">${Q("Cancel")}</button>
                    <button type="button" class="btn btn-light chickenpaint-reject-transform">${Q("Undo transform")}</button>
                    <button type="button" class="btn btn-primary chickenpaint-accept-transform">${Q("Apply transform")}</button>
                </div>
            </div>
        </div>
    `;let b=this,h=d.querySelector(".chickenpaint-accept-transform"),n=d.querySelector(".chickenpaint-reject-transform"),g=d.querySelector(".chickenpaint-cancel-transform"),e=new Pb.Modal(d);null==h||h.addEventListener("click",function(k){c.actionPerformed({action:"CPTransformAccept"});b.emitEvent("accept")});null==n||n.addEventListener("click",function(k){c.actionPerformed({action:"CPTransformReject"});b.emitEvent("reject")});null==g||g.addEventListener("click",function(k){e.hide()});this.show=function(){e.show()};
this.hide=function(){e.hide()};d.addEventListener("hidden.bs.modal",k=>{d.remove()});a.addEventListener("keydown",function f(l){"Enter"===l.key&&(e.hide(),c.actionPerformed({action:"CPTransformAccept"}),b.emitEvent("accept"),a.removeEventListener("keydown",f))});a.appendChild(d)}function vg(a){let c=document.createElement("div");c.classList.add("modal","fade","chickenpaint-shortcuts-dialog");c.tabIndex=-1;c.role="dialog";c.innerHTML=`
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Shortcuts")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>${Q("Many of the menu options and painting tools have keyboard shortcuts which are written next to them or appear when you hover.")}</p>
                    <p>${Q("Here are some other shortcuts which are not as obvious!")}</p>
                    <div class="chickenpaint-shortcuts-sections">
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${Q("Color swatches palette")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Use as the drawing color")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${Q("Right")}</span></dt>
                                        <dd>${Q("Remove or replace a color swatch")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${Q("Line drawing mode")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Shift</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Snap line to nearest 45 degrees")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${Q("Painting tools")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">1</span> - <span class="chickenpaint-shortcut-key">9</span>, <span class="chickenpaint-shortcut-key">0</span></span></dt>
                                        <dd>${Q("Change brush opacity")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">[</span>, <span class="chickenpaint-shortcut-key">]</span></span></dt>
                                        <dd>${Q("Change brush size")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${Q("Brush palette")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${Q("Right")}</span><span class="chickenpaint-shortcut-alternate">${Q("or")}</span><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Shift</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Adjust brush sliders more precisely")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${Q("Zoom")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">${wg}</span>  + <span class="chickenpaint-shortcut-key">Space</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span><dt>
                                        <dt><span class="chickenpaint-shortcut-alternate">${Q("or")}</span>
                                        <span class="chickenpaint-shortcut-key">Z</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Zoom the canvas")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${Q("Drawing canvas")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${Q("Middle")}</span> <span class="chickenpaint-shortcut-alternate">${Q("or")}</span> <span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Space</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Move the canvas around")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">R</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Rotate the canvas")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${Q("Right")}</span><span class="chickenpaint-shortcut-alternate">${Q("or")}</span><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">${nf}</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Sample the color under the cursor")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">H</span></dt>
                                        <dd>${Q("Flip View Horizontal")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${Q("Layers palette")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${Q("Double click")}</span><span class="chickenpaint-shortcut-alternate">${Q("or")}</span><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${Q("Right")}</span></dt>
                                        <dd>${Q("Rename layer")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Shift</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Toggle mask enable/disable")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">${nf}</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Toggle mask View")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">${of}</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Apply layer mask")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Shift</span> + <span class="chickenpaint-shortcut-key">${of}</span> + <span class="fa icon-mouse-pointer"></span> ${Q("Left")}</span></dt>
                                        <dd>${Q("Delete layer mask")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;c.querySelector(".btn-close").addEventListener("click",()=>{c.remove()});let d=new Pb.Modal(c);a.appendChild(c);this.show=function(){d.show()}}function xg(a,c){let d=document.createElement("div");d.classList.add("modal","fade");d.setAttribute("tabindex","-1");d.setAttribute("role","dialog");d.innerHTML=`
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Box blur")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label>${Q("Blur amount (pixels)")}</label>
                            <input type="number" class="form-control chickenpaint-blur-amount" value="3" min="1">
                        </div>
                        <div class="form-group">
                            <label>${Q("Iterations (1-8, larger gives smoother blur)")}</label>
                            <input type="number" class="form-control chickenpaint-blur-iterations" value="1" min="1" max="8">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">${Q("Cancel")}</button>
                    <button type="button" class="btn btn-primary chickenpaint-apply-box-blur" data-bs-dismiss="modal">${Q("Ok")}</button>
                </div>
            </div>
        </div>
    `;let b=d.querySelector(".chickenpaint-blur-amount"),h=d.querySelector(".chickenpaint-blur-iterations"),n=d.querySelector(".chickenpaint-apply-box-blur"),g=new Pb.Modal(d);this.show=function(){let e=document.getElementById("chickenpaint-main-menu-content");e&&e.classList.contains("show")&&(new Pb.Collapse(e,{toggle:!1})).hide();c.setModalShown(!0);g.show()};n.addEventListener("click",e=>{e=Math.max(parseInt(b.value,10),1);let k=Math.min(Math.max(parseInt(h.value,10),1),8);c.getArtwork().boxBlur(e,
e,k);c.setModalShown(!1);g.hide()});d.addEventListener("hidden.bs.modal",()=>{document.activeElement.blur();d.remove()});d.addEventListener("shown.bs.modal",()=>{b.focus()});d.addEventListener("keydown",e=>{"Enter"===e.key&&d.classList.contains("show")&&(n.click(),e.preventDefault())});a.appendChild(d)}function yg(a){let c=document.createElement("div");c.classList.add("modal","fade");c.setAttribute("tabindex","-1");c.setAttribute("role","dialog");c.innerHTML='\n        <div class="modal-dialog" role="document">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h5 class="modal-title">Drawing tablet support</h5>\n                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                </div>\n                <div class="modal-body">\n                    <div class="chickenpaint-tablet-support chickenpaint-pointerevents-support">\n                        <h5>\n                            Built-in support for most tablets.\n                            <small>macOS, Windows 10 or newer</small>\n                        </h5>\n                        <div class="chickenpaint-supported-browsers">\n                            <div class="chickenpaint-supported-browser">\n                                <span class="icon-chrome"></span>\n                                Chrome\n                            </div>\n                            <div class="chickenpaint-supported-browser">\n                                <span class="icon-edge"></span>\n                                Edge (Windows 10)\n                            </div>\n                            <div class="chickenpaint-supported-browser">\n                                <span class="icon-firefox"></span>\n                                Firefox\n                            </div>\n                        </div>\n                        <p class="chickenpaint-not-supported">\n                            Your browser doesn\'t have built-in support for drawing tablets, please try\n                            one of the other browsers listed above.\n                        </p>\n                        <p class="chickenpaint-supported alert alert-success">\n                            Your browser has built-in support for drawing tablets!\n                        </p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ';
let d=c.querySelector(".chickenpaint-pointerevents-support"),b=!!window.PointerEvent;null==d||d.classList.toggle("supported",b);null==d||d.classList.toggle("not-supported",!b);c.addEventListener("hidden.bs.modal",n=>{c.remove()});let h=new Pb.Modal(c);a.appendChild(c);this.show=function(){h.show()}}function zg(a,c){let d=document.createElement("div");d.classList.add("modal","fade");d.setAttribute("tabindex","-1");d.setAttribute("role","dialog");d.innerHTML=`
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Grid options")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label>${Q("Grid size")}</label>
                            <input type="number" class="form-control chickenpaint-grid-size" value="" min="3">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">${Q("Cancel")}</button>
                    <button type="button" class="btn btn-primary chickenpaint-apply-grid-settings" data-bs-dismiss="modal">${Q("Ok")}</button>
                </div>
            </div>
        </div>
    `;let b=d.querySelector(".chickenpaint-grid-size"),h=d.querySelector(".chickenpaint-apply-grid-settings"),n=new Pb.Modal(d);this.show=function(){let g=document.getElementById("chickenpaint-main-menu-content");g&&g.classList.contains("show")&&(new Pb.Collapse(g,{toggle:!1})).hide();n.show()};b.value=c.getGridSize();d.addEventListener("hidden.bs.modal",()=>{d.remove()});h.addEventListener("click",()=>{let g=parseInt(b.value,10);c.setGridSize(g);c.setModalShown(!1);n.hide()});d.addEventListener("shown.bs.modal",
()=>{c.setModalShown(!0);b.focus()});d.addEventListener("keydown",g=>{"Enter"===g.key&&(g.preventDefault(),h.click())});a.appendChild(d)}function Ag(a,c){let d=document.createElement("div");d.classList.add("modal","fade");d.setAttribute("tabindex","-1");d.setAttribute("role","dialog");d.innerHTML=`
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Chromatic aberration")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label>${Q("Offset (pixels)")}</label>
                            <input type="number" class="form-control chickenpaint-aberration-offset" value="" min="1", max="32">
                        </div>
                    </form>
                    <div class="form-check mt-3">
                    <input class="form-check-input" type="checkbox" id="createMergedLayer" checked="checked">
                    <label class="form-check-label" for="createMergedLayer">
                    ${Q("Apply to all (create merged layer)")}
                    </label>
                    </div>
                    </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">${Q("Cancel")}</button>
                    <button type="button" class="btn btn-primary chickenpaint-apply-aberration-settings" data-bs-dismiss="modal">${Q("Ok")}</button>
                </div>
            </div>
        </div>
    `;let b=d.querySelector(".chickenpaint-aberration-offset"),h=d.querySelector(".chickenpaint-apply-aberration-settings"),n=new Pb.Modal(d);this.show=function(){let g=document.getElementById("chickenpaint-main-menu-content");g&&g.classList.contains("show")&&(new Pb.Collapse(g,{toggle:!1})).hide();n.show()};b.value=3;d.addEventListener("hidden.bs.modal",()=>{d.remove()});null==h||h.addEventListener("click",()=>{var g;let e=parseInt(null==b?void 0:b.value,10),k=null==(g=d.querySelector("#createMergedLayer"))?
void 0:g.checked;c.getArtwork().chromaticAberration(e,k);c.setModalShown(!1);n.hide()});d.addEventListener("shown.bs.modal",()=>{c.setModalShown(!0);null==b||b.focus()});d.addEventListener("keydown",g=>{"Enter"===g.key&&(g.preventDefault(),null==h||h.click())});a.appendChild(d)}function Sd(a,c,d){let b=document.createElement("div");b.className="modal fade chickenpaint-send-dialog";b.tabIndex=-1;b.setAttribute("role","dialog");b.innerHTML=`
        <div class="modal-dialog">
            <div class="modal-content" data-stage="saving">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Saving drawing...")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="chickenpaint-saving-progress-message">${Q("Preparing your drawing to be saved, please wait...")}</p>
                    <pre class="chickenpaint-saving-error-message pre-scrollable" style="display: none;"></pre>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light chickenpaint-send-cancel" data-bs-dismiss="modal">${Q("Cancel")}</button>
                </div>
            </div>
            <div class="modal-content" data-stage="success-not-previously-posted" style="display:none">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Drawing saved!")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body">
                    <p>${Q("Your drawing has been saved, would you like to post it to the forum now?")}</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary chickenpaint-post-drawing" data-bs-dismiss="modal">${Q("Yes, post it now")}</button>
                    <button type="button" class="btn btn-light chickenpaint-continue-drawing" data-bs-dismiss="modal">${Q("No, keep drawing")}</button>
                    <button type="button" class="btn btn-light chickenpaint-exit" data-bs-dismiss="modal">${Q("No, quit and I'll finish it later")}</button>
                </div>
            </div>
            <div class="modal-content" data-stage="success-already-posted" style="display:none">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Drawing saved!")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body">
                    <p>${Q("Your drawing has been saved, would you like to view it on the forum now?")}</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary chickenpaint-post-drawing" data-bs-dismiss="modal">${Q("Yes, view the post")}</button>
                    <button type="button" class="btn btn-light chickenpaint-continue-drawing" data-bs-dismiss="modal">${Q("No, keep drawing")}</button>
                </div>
            </div>
            <div class="modal-content" data-stage="success-redirect" style="display:none">
                <div class="modal-header">
                    <h5 class="modal-title">${Q("Drawing saved!")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>${Q("Your drawing has been saved, redirecting you to view your new post now...")}</p>
                </div>
            </div>
        </div>
    `;let h=b.querySelector(".chickenpaint-saving-progress-message"),n=b.querySelector(".chickenpaint-saving-error-message"),g=b.querySelector(".progress-bar"),e=new Pb.Modal(b),k=this;d.on("savingProgress",function(f,m){h.textContent=m;g.setAttribute("aria-valuenow",100*f);g.style.width=100*f+"%"});d.on("savingComplete",function(){b.querySelector(".modal-content[data-stage='saving']").style.display="none";a.isActionSupported("CPContinue")?a.isActionSupported("CPExit")?b.querySelector(".modal-content[data-stage='success-not-previously-posted']").style.display=
"block":b.querySelector(".modal-content[data-stage='success-already-posted']").style.display="block":b.querySelector(".modal-content[data-stage='success-redirect']").style.display="block"});d.on("savingFailure",function(f){g.classList.add("progress-bar-danger");let m=Q("Sorry, your drawing could not be saved, please try again later.");f&&(f=f.replace(/^CHIBIERROR\s*/,"")).length>0&&(m+=`<br><br>${Q("The error returned from the server was")}:`,n.textContent=f,n.style.display="block");h.innerHTML=m});
b.querySelector(".chickenpaint-send-cancel").addEventListener("click",function(){d.cancel()});var l=b.querySelector(".chickenpaint-post-drawing");l&&l.addEventListener("click",function(){a.actionPerformed({action:"CPPost"})});(l=b.querySelector(".chickenpaint-exit"))&&(l.style.display=a.isActionSupported("CPExit")?"":"none",l.addEventListener("click",function(){alert("When you want to come back and finish your drawing, just click the 'new drawing' button again and you can choose to continue this drawing.");
a.actionPerformed({action:"CPExit"})}));b.addEventListener("hidden.bs.modal",()=>{b.remove()});c.appendChild(b);this.show=function(){e.show();k.emitEvent("shown")}}function X(a){function c(H){this.palName=H}function d(H){this.toolNum=H}function b(H){this.modeNum=H}function h(H){let T;switch(x=H==cc.EDITING_MODE_IMAGE?X.COLOR_MODE_RGB:X.COLOR_MODE_GREYSCALE,m.emitEvent("colorModeChange",[H==cc.EDITING_MODE_IMAGE?"rgb":"greyscale"]),x){case X.COLOR_MODE_RGB:T=t.clone();break;case X.COLOR_MODE_GREYSCALE:T=
new db(db.greyToRGB(v))}m.artwork.setForegroundColor(T.getRgb());m.emitEvent("colorChange",[T])}function n(){m.emitEvent("toolChange",[A,L[A]])}function g(H){B!=H&&(H==X.M_TRANSFORM&&(y=B),B=H,m.emitEvent("modeChange",[B]))}function e(H){g(X.M_DRAW);A=H;m.artwork.setBrush(L[H]);n()}function k(H,T){f&&(f.addEventListener("dblclick",function(Ca){Ca.preventDefault();Ca.stopPropagation()}),m.artwork.on("editModeChanged",h),q=new Qd(m,f),m.mainGUI=q,m.emitEvent("fullScreen",[M]),m.emitEvent("smallScreen",
[G]),J.load(),e(X.T_PEN),q.arrangePalettes(),H&&q.setSwatches(H),T&&q.setRotation90(T),window.addEventListener("beforeunload",function(Ca){m.artwork.getHasUnsavedChanges()&&Ca.preventDefault()}),m.artwork.on("unsavedChanges",Ca=>{a.allowMultipleSends&&m.emitEvent("unsavedChanges",[Ca])}))}var l;!function(){try{if("undefined"!=typeof navigator){let H=navigator.languages;for(let T of(Array.isArray(H)||(H=[H]),H)){let Ca=/^(..)([-_].+)?$/.exec(T);if(Ca){if(Ca[1]=Ca[1].toLowerCase(),Ca[1]in oe)return void ne(T);
if("en"===Ca[1])return void ne("en")}}}}catch(H){console.error(H)}}();a.language&&ne(a.language);let f=a.uiElem;document.addEventListener("keydown",H=>{((H.ctrlKey||H.metaKey)&&"+;=-shro".split("").includes(H.key.toLowerCase())||"Enter"===H.key)&&H.preventDefault()});f.addEventListener("contextmenu",H=>{H.preventDefault();H.stopPropagation()},{passive:!1});let m=this,r,q,t=new db(0),v=255,x=X.COLOR_MODE_RGB,A=X.T_PENCIL,B=X.M_DRAW,y=B,E=[4278190080,4294967295],G=!1,M=!1,L=((l=Array(X.T_MAX))[X.T_PENCIL]=
new ka({toolNb:X.T_PENCIL,size:16,alpha:255,isAA:!0,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,tip:ka.TIP_ROUND_AA,brushMode:ka.BRUSH_MODE_PAINT,paintMode:ka.PAINT_MODE_OPACITY}),l[X.T_ERASER]=new ka({toolNb:X.T_ERASER,size:16,alpha:255,isAA:!0,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!1,texture:0,tip:ka.TIP_ROUND_AA,brushMode:ka.BRUSH_MODE_ERASE,paintMode:ka.PAINT_MODE_OPACITY}),l[X.T_PEN]=new ka({toolNb:X.T_PEN,size:2,alpha:100,isAA:!0,minSpacing:.5,spacing:.05,pressureSize:!0,
pressureAlpha:!1,tip:ka.TIP_ROUND_AA,brushMode:ka.BRUSH_MODE_PAINT,paintMode:ka.PAINT_MODE_FLOW,alphaScale:.5}),l[X.T_SOFTERASER]=new ka({toolNb:X.T_SOFTERASER,size:16,alpha:60,isAA:!1,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,texture:1,tip:ka.TIP_ROUND_AIRBRUSH,brushMode:ka.BRUSH_MODE_ERASE,paintMode:ka.PAINT_MODE_FLOW,alphaScale:.125}),l[X.T_AIRBRUSH]=new ka({toolNb:X.T_AIRBRUSH,size:50,alpha:30,isAA:!1,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,tip:ka.TIP_ROUND_AIRBRUSH,
brushMode:ka.BRUSH_MODE_PAINT,paintMode:ka.PAINT_MODE_FLOW,alphaScale:.125}),l[X.T_DODGE]=new ka({toolNb:X.T_DODGE,size:30,alpha:32,isAA:!1,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,tip:ka.TIP_ROUND_AIRBRUSH,brushMode:ka.BRUSH_MODE_DODGE,paintMode:ka.PAINT_MODE_FLOW,alphaScale:.125}),l[X.T_BURN]=new ka({toolNb:X.T_BURN,size:30,alpha:32,isAA:!1,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,tip:ka.TIP_ROUND_AIRBRUSH,brushMode:ka.BRUSH_MODE_BURN,paintMode:ka.PAINT_MODE_FLOW,
alphaScale:.125}),l[X.T_WATER]=new ka({toolNb:X.T_WATER,size:30,alpha:50,isAA:!1,minSpacing:.5,spacing:.02,pressureSize:!1,pressureAlpha:!0,tip:ka.TIP_ROUND_AA,brushMode:ka.BRUSH_MODE_WATER,paintMode:ka.PAINT_MODE_FLOW,alphaScale:.125,resat:.3,bleed:.6}),l[X.T_BLUR]=new ka({toolNb:X.T_BLUR,size:20,alpha:255,isAA:!1,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,tip:ka.TIP_ROUND_PIXEL,brushMode:ka.BRUSH_MODE_BLUR,paintMode:ka.PAINT_MODE_FLOW,alphaScale:.125}),l[X.T_SMUDGE]=new ka({toolNb:X.T_SMUDGE,
size:20,alpha:128,isAA:!1,minSpacing:.5,spacing:.01,pressureSize:!1,pressureAlpha:!0,tip:ka.TIP_ROUND_AIRBRUSH,brushMode:ka.BRUSH_MODE_SMUDGE,paintMode:ka.PAINT_MODE_FLOW,alphaScale:.125,resat:0,bleed:1}),l[X.T_BLENDER]=new ka({toolNb:X.T_BLENDER,size:20,alpha:60,isAA:!1,minSpacing:.5,spacing:.1,pressureSize:!1,pressureAlpha:!0,tip:ka.TIP_ROUND_AIRBRUSH,brushMode:ka.BRUSH_MODE_OIL,paintMode:ka.PAINT_MODE_FLOW,alphaScale:.125,resat:0,bleed:.07}),l),J=new Bg,W,ba,ma,na={CPFullScreen:{action:function(){m.setFullScreen(!M)},
isSupported:function(){return"disable"!==a.fullScreenMode&&"force"!==a.fullScreenMode&&!1!==a.allowFullScreen},modifies:{gui:!0}},CPZoomIn:{action:function(){r.zoomIn()},modifies:{gui:!0}},CPZoomOut:{action:function(){r.zoomOut()},modifies:{gui:!0}},CPZoom100:{action:function(){r.zoom100()},modifies:{gui:!0}},CPResetZoomAndRotation:{action:function(){r.resetZoomAndRotation();let H=q.getPaletteManager().palettes.misc.flipButton,T=q.getMainMenu().getElement().querySelector('[data-action="CPViewHFlip"]');
H&&H.classList.remove("flipped");T&&T.classList.remove("selected")},modifies:{gui:!0}},CPViewHFlip:{action:function(){let H=r.toggleViewFlip(),T=q.getPaletteManager().palettes.misc.flipButton,Ca=q.getMainMenu().getElement().querySelector('[data-action="CPViewHFlip"]');T&&(H?T.classList.add("flipped"):T.classList.remove("flipped"));Ca&&(H?Ca.classList.add("selected"):Ca.classList.remove("selected"))},modifies:{gui:!0}},CPUndo:{action:function(){m.artwork.undo()},modifies:{document:!0},allowed:"isUndoAllowed"},
CPRedo:{action:function(){m.artwork.redo()},modifies:{document:!0},allowed:"isRedoAllowed"},CPClearHistory:{action:function(){confirm(Q("You're about to clear the current Undo/Redo history.\nThis operation cannot be undone, are you sure you want to do that?"))&&m.artwork.clearHistory()},modifies:{document:!0}},CPPencil:new d(X.T_PENCIL),CPPen:new d(X.T_PEN),CPEraser:new d(X.T_ERASER),CPSoftEraser:new d(X.T_SOFTERASER),CPAirbrush:new d(X.T_AIRBRUSH),CPDodge:new d(X.T_DODGE),CPBurn:new d(X.T_BURN),
CPWater:new d(X.T_WATER),CPBlur:new d(X.T_BLUR),CPSmudge:new d(X.T_SMUDGE),CPBlender:new d(X.T_BLENDER),CPFloodFill:new b(X.M_FLOODFILL),CPGradientFill:new b(X.M_GRADIENTFILL),CPRectSelection:new b(X.M_RECT_SELECTION),CPMoveTool:new b(X.M_MOVE_TOOL),CPRotateCanvas:new b(X.M_ROTATE_CANVAS),CPPanCanvas:new b(X.M_PAN_CANVAS),CPColorPicker:new b(X.M_COLOR_PICKER),CPTransform:{action:function(){let H=m.artwork.getActiveLayer();null==m.artwork.transformAffineBegin()?m.showLayerNotification(H,Q("Whoops! All of the selected pixels are transparent!"),
"layer"):g(X.M_TRANSFORM)},modifies:{mode:!0},allowed:function(){let H=m.artwork.getActiveLayer();if(H.visible)if(0==H.alpha)m.showLayerNotification(H,Q("Whoops! This layer's opacity is currently 0%"),"opacity");else{if(null!=m.artwork.transformAffineBegin())return 0!=H.getEffectiveAlpha();m.showLayerNotification(H,Q("Whoops! All of the selected pixels are transparent!"),"layer")}else m.showLayerNotification(H,Q("Whoops! This layer is currently hidden"),"layer")}},CPTransformAccept:{action:function(){B==
X.M_TRANSFORM&&(m.artwork.transformAffineFinish(),g(y))},modifies:{mode:!0}},CPTransformReject:{action:function(){B==X.M_TRANSFORM&&(m.artwork.transformAffineAbort(),g(y))},modifies:{document:!0,mode:!0}},CPFreeHand:{action:function(){L[A].strokeMode=ka.STROKE_MODE_FREEHAND;n()},modifies:{tool:!0}},CPLine:{action:function(){L[A].strokeMode=ka.STROKE_MODE_LINE;n()},modifies:{tool:!0}},CPBezier:{action:function(){L[A].strokeMode=ka.STROKE_MODE_BEZIER;n()},modifies:{tool:!0}},CPAbout:{action:function(){(new ug(f)).show()},
modifies:{}},CPShortcuts:{action:function(){(new vg(f)).show()},modifies:{}},CPTabletSupport:{action:function(){(new yg(f)).show()},modifies:{}},CPLayerDuplicate:{action:function(){m.artwork.duplicateLayer()},modifies:{document:!0}},CPLayerMergeDown:{action:function(){m.artwork.mergeDown()},modifies:{document:!0},allowed:"isMergeDownAllowed"},CPGroupMerge:{action:function(){m.artwork.mergeGroup()},modifies:{document:!0},allowed:"isMergeGroupAllowed"},CPLayerMergeAll:{action:function(){m.artwork.mergeAllLayers()},
modifies:{document:!0},allowed:"isMergeAllLayersAllowed"},CPCreateMergedLayer:{action:function(){m.artwork.mergeAllLayers(!0)},modifies:{document:!0},allowed:"isMergeAllLayersAllowed"},CPExpandLayerGroup:{action:function(H){m.artwork.expandLayerGroup(H.group,H.expand)},modifies:{document:!0}},CPFill:{action:function(){m.artwork.fill(4278190080|m.getCurColor().getRgb())},modifies:{document:!0},requiresDrawable:!0},CPClear:{action:function(){m.artwork.clear()},modifies:{document:!0},requiresDrawable:!0},
CPClearWithTexture:{action:function(){m.artwork.clear(!1)},modifies:{document:!0},requiresDrawable:!0},CPSelectAll:{action:function(){m.artwork.rectangleSelection(m.artwork.getBounds());r.repaintAll()},modifies:{document:!0}},CPDeselectAll:{action:function(){m.artwork.rectangleSelection(new pa(0,0,0,0));r.repaintAll()},modifies:{document:!0}},CPHFlip:{action:function(){m.artwork.hFlip()},modifies:{document:!0},requiresDrawable:!0},CPVFlip:{action:function(){m.artwork.vFlip()},modifies:{document:!0},
requiresDrawable:!0},CPMNoise:{action:function(){m.artwork.monochromaticNoise()},modifies:{document:!0},requiresDrawable:!0},CPCNoise:{action:function(){m.artwork.colorNoise()},modifies:{document:!0},allowed:"isColorNoiseAllowed"},CPFXBoxBlur:{action:function(){W||=new xg(f,m);W.show()},modifies:{document:!0},requiresDrawable:!0},CPChromaticAberration:{action:function(){ma||=new Ag(f,m);ma.show()},modifies:{gui:!0}},CPFXInvert:{action:function(){m.artwork.invert()},modifies:{document:!0},requiresDrawable:!0},
CPBrightnessToOpacity:{action:function(){m.artwork.brightnessToOpacity()},modifies:{document:!0},requiresDrawable:!0},CPCut:{action:function(){m.artwork.cutSelection()},modifies:{document:!0},requiresDrawable:!0,allowed:"isCutSelectionAllowed"},CPCopy:{action:function(){m.artwork.copySelection()},modifies:{document:!0},requiresDrawable:!0,allowed:"isCopySelectionAllowed"},CPCopyMerged:{action:function(){m.artwork.copySelectionMerged()},modifies:{document:!0},allowed:"isCopySelectionMergedAllowed"},
CPPaste:{action:function(){m.artwork.pasteClipboard()},modifies:{document:!0},allowed:"isPasteClipboardAllowed"},CPToggleGrid:{action:function(H){r.showGrid(H.selected)},modifies:{gui:!0}},CPGridOptions:{action:function(){ba||=new zg(f,r);ba.show()},modifies:{gui:!0}},CPLinearInterpolation:{action:function(H){r.setInterpolation(H.selected)},modifies:{gui:!0}},CPResetCanvasRotation:{action:function(){r.resetRotation()},modifies:{gui:!0}},CPAddLayer:{action:function(){m.artwork.addLayer("layer")},modifies:{document:!0}},
CPAddGroup:{action:function(){m.artwork.addLayer("group")},modifies:{document:!0}},CPAddLayerMask:{action:function(){m.artwork.addLayerMask()},modifies:{document:!0},allowed:"isAddLayerMaskAllowed"},CPApplyLayerMask:{action:function(){m.artwork.applyLayerMask(!0)},modifies:{document:!0},allowed:"isApplyLayerMaskAllowed"},CPRemoveLayerMask:{action:function(){m.artwork.removeLayerMask()},modifies:{document:!0},allowed:"isRemoveLayerMaskAllowed"},CPRemoveLayer:{action:function(){m.artwork.removeLayer()||
alert(Q("Sorry, you can't remove the last remaining layer in the drawing."))},modifies:{document:!0},allowed:"isRemoveLayerAllowed"},CPCreateClippingMask:{action:function(){m.artwork.createClippingMask()},modifies:{document:!0},allowed:"isCreateClippingMaskAllowed"},CPReleaseClippingMask:{action:function(){m.artwork.releaseClippingMask()},modifies:{document:!0},allowed:"isReleaseClippingMaskAllowed"},CPRelocateLayer:{action:function(H){m.artwork.relocateLayer(H.layer,H.toGroup,H.toIndex)},modifies:{document:!0}},
CPSetActiveLayer:{action:function(H){H.mask&&H.layer.mask&&!H.layer.maskVisible&&m.artwork.setLayerMaskVisible(H.layer,!0);m.artwork.setActiveLayer(H.layer,H.mask);m.artwork.performIdleTasks()},modifies:{document:!0}},CPToggleMaskView:{action:function(){let H=m.artwork.toggleMaskView();H&&m.emitEvent("maskViewOpened",[H])},modifies:{gui:!0}},CPSetMaskVisible:{action:function(H){m.artwork.setLayerMaskVisible(H.layer,H.visible)},modifies:{layerProp:!0}},CPSetLayerVisibility:{action:function(H){m.artwork.setLayerVisibility(H.layer,
H.visible)},modifies:{layerProp:!0}},CPSetLayerName:{action:function(H){m.artwork.setLayerName(H.layer,H.name)},modifies:{layerProp:!0}},CPSetLayerBlendMode:{action:function(H){m.artwork.setLayerBlendMode(H.blendMode)},modifies:{layerProp:!0}},CPSetLayerAlpha:{action:function(H){m.artwork.setLayerAlpha(H.alpha)},modifies:{layerProp:!0}},CPSetLayerLockAlpha:{action:function(H){m.artwork.setLayerLockAlpha(H.lock)},modifies:{layerProp:!0}},CPPalColor:new c("color"),CPPalBrush:new c("brush"),CPPalLayers:new c("layers"),
CPPalStroke:new c("stroke"),CPPalSwatches:new c("swatches"),CPPalTool:new c("tool"),CPPalMisc:new c("misc"),CPPalTextures:new c("textures"),CPTogglePalettes:{action:function(){q.togglePalettes()},modifies:{gui:!0}},CPArrangePalettes:{action:function(){q.arrangePalettes()},modifies:{gui:!0}},CPToggleSetSmallScreenMode:{action:function(){m.setSmallScreenMode(!G);q.arrangePalettes()},modifies:{gui:!0}},CPSave:{action:function(){let H;(H=new od({artwork:m.getArtwork(),rotation:r.getRotation90(),swatches:q.getSwatches()})).on("savingComplete",
function(){m.artwork.setHasUnsavedChanges(!1)});H.on("savingFailure",function(){alert(Q("Sorry, your drawing could not be saved, Please see the error message."))});H.save()},isSupported:function(){return!1!==a.allowDownload},modifies:{document:!0}},CPSend:{action:function(){!function(){if(m.isActionSupported("CPContinue")||confirm(Q("Are you sure you want to send your drawing to the server and finish drawing now?"))){var H=new od({artwork:m.getArtwork(),rotation:r.getRotation90(),swatches:q.getSwatches(),
url:a.saveUrl,post_max_size:a.post_max_size}),T=new Sd(m,f,H);H.on("savingComplete",function(){m.artwork.setHasUnsavedChanges(!1);!m.isActionSupported("CPContinue")&&m.isActionSupported("CPPost")&&m.actionPerformed({action:"CPPost"})});H.on("savingFailure",function(){alert(Q("Sorry, your drawing could not be saved, Please see the error message."))});T.on("shown",function(){H.save()});T.show()}}()},isSupported:function(){return!!a.saveUrl},modifies:{document:!0}},CPPost:{action:function(){if("function"==
typeof handleExit)return handleExit();window.location=a.postUrl},isSupported:function(){return!(!a.postUrl&&"function"!=typeof handleExit)},modifies:{document:!0}},CPContinue:{action:function(){},isSupported:function(){return!!a.allowMultipleSends}},CPExit:{action:function(){window.location=a.exitUrl},isSupported:function(){return!!a.exitUrl},modifies:{}}};switch(c.prototype.action=function(H){q.showPalette(this.palName,H.selected)},c.prototype.modifies={gui:!0},d.prototype.action=function(){e(this.toolNum)},
d.prototype.modifies={mode:!0,tool:!0},d.prototype.requiresDrawable=!0,b.prototype.action=function(){g(this.modeNum)},b.prototype.modifies={mode:!0},this.callToolListeners=function(){n()},this.getArtwork=function(){return this.artwork},this.setCanvas=function(H){r=H},this.setTransformInterpolation=function(H){this.artwork.setTransformInterpolation(H)},this.setCurColor=function(H){switch(x){case X.COLOR_MODE_RGB:t.isEqual(H)||(t.copyFrom(H),this.artwork.setForegroundColor(H.getRgb()),this.emitEvent("colorChange",
[H]));break;case X.COLOR_MODE_GREYSCALE:if(H=H.getValue(),v!=H){let T=db.greyToRGB(H);this.artwork.setForegroundColor(T);v=H;this.emitEvent("colorChange",[new db(T)])}}},this.getCurColor=function(){switch(x){case X.COLOR_MODE_RGB:return t.clone();case X.COLOR_MODE_GREYSCALE:return new db(db.greyToRGB(v))}},this.setCurGradient=function(H){E=H.slice(0);this.emitEvent("gradientChange",[E])},this.getCurGradient=function(){return E.slice(0)},this.setBrushSize=function(H){L[A].size=Math.max(1,Math.min(200,
H));n()},this.getBrushSize=function(){return L[A].size},this.setAlpha=function(H){L[A].alpha=H;n()},this.getAlpha=function(){return L[A].alpha},this.getCurMode=function(){return B},this.zoomOnCenter=function(H,T=!1){r.zoomOnCenter(H,T)},this.getZoom=function(){return r.getZoom()},this.getRotationDegrees=function(){return r.getRotationDegrees()},this.setRotationDegrees=function(H){r.setRotationDegrees(H)},this.setGrowFillArea=function(H){r.setGrowFillArea(H)},this.setFoodFillAlpha=function(H){r.setFoodFillAlpha(H)},
this.setFloodFillReferAllLayers=function(H){r.setFloodFillReferAllLayers(H)},this.setMaintainAspectCheckbox=function(H){r.setMaintainAspectCheckbox(H)},this.setModalShown=function(H){r.setModalShown(H)},this.isPanOrRotateMode=function(){return r.isPanOrRotateMode()},this.getCurTool=function(){return A},this.getBrushInfo=function(){return L[A]},this.isActionSupported=function(H){if(na[H]){let T=typeof na[H].isSupported;return"function"==T?na[H].isSupported():"undefined"==T||na[H].isSupported}return!1},
this.isActionAllowed=function(H){H=na[H];return!!H&&("function"==typeof H.allowed?H.allowed():"string"==typeof H.allowed?this.artwork[H.allowed]():!H.requiresDrawable||this.artwork.isActiveLayerDrawable())},this.showLayerNotification=function(H,T,Ca){this.emitEvent("layerNotification",[H,T,Ca])},this.actionPerformed=function(H){if(null!=this.artwork&&null!=r){var T=na[H.action];if(T)if(B==X.M_TRANSFORM&&(T.modifies.document||T.modifies.mode)&&-1==["CPTransformAccept","CPTransformReject"].indexOf(H.action))if("CPUndo"==
H.action)na.CPTransformReject.action();else{if("CPTransform"!=H.action){let Ca=new Rd(f,this);Ca.on("accept",()=>{this.actionPerformed(H);Ca.hide()});Ca.on("reject",()=>{this.actionPerformed(H);Ca.hide()});Ca.show()}}else T.action(H)}},this.setSmallScreenMode=function(H){G!==H&&(G=H,f.classList.toggle("chickenpaint-small-screen",G),m.emitEvent("smallScreen",[G]))},this.getSmallScreenMode=function(){return G},this.setFullScreen=function(H){M!==H&&(M=H,document.body.classList.toggle("chickenpaint-full-screen",
M),f.classList.toggle("chickenpaint-full-screen",M),H=document.querySelectorAll('head meta[name="viewport"]').length,M&&0===H?(H=document.createElement("meta"),H.name="viewport",H.content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,,user-scalable=no",document.head.appendChild(H),setTimeout(()=>m.emitEvent("fullScreen",[M]),200)):m.emitEvent("fullScreen",[M]))},this.isFullScreen=function(){return M},this.setToolbarStyle=function(H){J.set("toolbarStyle",H);J.save()},this.getToolbarStyle=
function(){return J.get("toolbarStyle")},this.getResourcesRoot=function(){return a.resourcesRoot},f&&(f.className+=" chickenpaint chickenpaint-lang-"+pe),a.resourcesRoot=a.resourcesRoot||"chickenpaint/",this.setSmallScreenMode(!!("number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&(window.screen.width<=820||window.screen.height<=820))),a.fullScreenMode){case "force":this.setFullScreen(!0);break;case "auto":this.setFullScreen(G)}(J.on("toolbarStyle",H=>this.emitEvent("toolbarStyleChange",
[H])),a.loadImageUrl||a.loadChibiFileUrl)?(l=new Cd(a),new ig(f,l,a.resourcesRoot),l.on("loadingComplete",function(H){m.artwork=H.layers||H.flat;k(H.swatches,a.rotation);a.onLoaded&&a.onLoaded(this)}),l.load()):(a.artwork?this.artwork=a.artwork:(this.artwork=new cc(a.canvasWidth||800,a.canvasHeight||600),this.artwork.addBackgroundLayer(),this.artwork.addDefaultLayer()),k(),a.onLoaded&&a.onLoaded(this))}var pf,qf,rf,te,ue,Td="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=
typeof window?window:"undefined"!=typeof global?global:{};ka.STROKE_MODE_FREEHAND=0;ka.STROKE_MODE_LINE=1;ka.STROKE_MODE_BEZIER=2;ka.TIP_ROUND_PIXEL=0;ka.TIP_ROUND_AA=1;ka.TIP_ROUND_AIRBRUSH=2;ka.TIP_SQUARE_PIXEL=3;ka.TIP_SQUARE_AA=4;ka.BRUSH_MODE_PAINT=0;ka.BRUSH_MODE_ERASE=1;ka.BRUSH_MODE_DODGE=2;ka.BRUSH_MODE_BURN=3;ka.BRUSH_MODE_WATER=4;ka.BRUSH_MODE_BLUR=5;ka.BRUSH_MODE_SMUDGE=6;ka.BRUSH_MODE_OIL=7;ka.PAINT_MODE_OPACITY=0;ka.PAINT_MODE_FLOW=1;ka.DEFAULTS={isAA:!1,minSpacing:0,spacing:0,pressureSize:!0,
pressureAlpha:!1,pressureScattering:!1,alphaScale:1,tip:ka.TIP_ROUND_PIXEL,brushMode:ka.BRUSH_MODE_PAINT,paintMode:ka.PAINT_MODE_OPACITY,strokeMode:ka.STROKE_MODE_FREEHAND,resat:1,bleed:0,texture:1,size:0,curSize:0,alpha:0,curAlpha:0,scattering:0,curScattering:0,squeeze:0,curSqueeze:0,angle:Math.PI,curAngle:0,smoothing:0};ka.prototype.applyPressure=function(a){this.pressureSize&&this.brushMode!=ka.BRUSH_MODE_SMUDGE&&this.brushMode!=ka.BRUSH_MODE_OIL?this.curSize=Math.max(.1,this.size*a):this.curSize=
Math.max(.1,this.size);this.curSize>16&&(this.curSize=Math.floor(this.curSize));this.curSize=Math.min(this.curSize,400);this.curAlpha=this.pressureAlpha?Math.floor(this.alpha*Math.min(a,1)):this.alpha;this.curSqueeze=this.squeeze;this.curAngle=this.angle;this.curScattering=this.scattering*this.curSize*(this.pressureScattering?a:1)};ka.prototype.clone=function(){return new ka(this)};pa.prototype.makeEmpty=function(){this.bottom=this.right=this.top=this.left=0};pa.prototype.union=function(a){this.isEmpty()?
this.set(a):a.isEmpty()||(this.left=Math.min(this.left,a.left),this.top=Math.min(this.top,a.top),this.right=Math.max(this.right,a.right),this.bottom=Math.max(this.bottom,a.bottom))};pa.prototype.getUnion=function(a){var c=this.clone();return c.union(a),c};pa.prototype.getIntersection=function(a,c=!1){let d=Math.max(this.left,a.left),b=Math.max(this.top,a.top),h=Math.min(this.right,a.right);a=Math.min(this.bottom,a.bottom);return c&&(d>=h||b>=a)?null:new pa(d,b,h,a)};pa.prototype.clipTo=function(a){return this.isEmpty()||
(a.isEmpty()?this.makeEmpty():(this.left=Math.min(Math.max(this.left,a.left),a.right),this.top=Math.min(Math.max(this.top,a.top),a.bottom),this.right=Math.max(Math.min(this.right,a.right),a.left),this.bottom=Math.max(Math.min(this.bottom,a.bottom),a.top))),this};pa.prototype.containsPoint=function(a){return!(a.x<this.left||a.y<this.top||a.x>=this.right||a.y>=this.bottom)};pa.prototype.isInside=function(a){return this.left>=a.left&&this.top>=a.top&&this.right<=a.right&&this.bottom<=a.bottom};pa.prototype.clipSourceDest=
function(a,c){c.right=c.left+a.getWidth();c.bottom=c.top+a.getHeight();this.isEmpty()||c.left>=this.right||c.top>=this.bottom||c.right<=this.left||c.bottom<=this.top?(a.makeEmpty(),c.makeEmpty()):(c.right>this.right&&(a.right-=c.right-this.right,c.right=this.right),c.bottom>this.bottom&&(a.bottom-=c.bottom-this.bottom,c.bottom=this.bottom),c.left<this.left&&(a.left+=this.left-c.left,c.left=this.left),c.top<this.top&&(a.top+=this.top-c.top,c.top=this.top))};pa.prototype.getWidth=function(){return this.right-
this.left};pa.prototype.getHeight=function(){return this.bottom-this.top};pa.prototype.getArea=function(){return this.getWidth()*this.getHeight()};pa.prototype.isEmpty=function(){return this.right<=this.left||this.bottom<=this.top};pa.prototype.set=function(a){this.left=a.left;this.top=a.top;this.right=a.right;this.bottom=a.bottom};pa.prototype.clone=function(){return new pa(this.left,this.top,this.right,this.bottom)};pa.prototype.translate=function(a,c){return this.left+=a,this.right+=a,this.top+=
c,this.bottom+=c,this};pa.prototype.getTranslated=function(a,c){var d=this.clone();return d.translate(a,c),d};pa.prototype.moveTo=function(a,c){this.translate(a-this.left,c-this.top)};pa.prototype.equals=function(a){return this.left==a.left&&this.right==a.right&&this.top==a.top&&this.bottom==a.bottom};pa.prototype.grow=function(a,c){this.left-=a;this.right+=a;this.top-=c;this.bottom+=c};pa.prototype.toString=function(){return"("+this.left+","+this.top+","+this.right+","+this.bottom+")"};pa.prototype.toPoints=
function(){return[{x:this.left,y:this.top},{x:this.right,y:this.top},{x:this.right,y:this.bottom},{x:this.left,y:this.bottom}]};pa.prototype.roundNearest=function(){return this.left=Math.round(this.left),this.top=Math.round(this.top),this.right=Math.round(this.right),this.bottom=Math.round(this.bottom),this};pa.prototype.roundContain=function(){return this.left=Math.floor(this.left),this.top=Math.floor(this.top),this.right=Math.ceil(this.right),this.bottom=Math.ceil(this.bottom),this};pa.createBoundingBox=
function(a){if(0===a.length)return new pa(0,0,0,0);let c=new pa(a[0].x,a[0].y,a[0].x,a[0].y);for(let d=1;d<a.length;d++)c.left=Math.min(c.left,a[d].x),c.top=Math.min(c.top,a[d].y),c.right=Math.max(c.right,a[d].x),c.bottom=Math.max(c.bottom,a[d].y);return c};pa.prototype.subtract=function(a){return pa.subtract(this,a)};pa.subtract=function(a,c){a instanceof pa&&(a=[a]);c instanceof pa&&(c=[c]);a=a.slice(0);for(let b=0;b<c.length;b++){let h=c[b],n=a.length;for(let g=0;g<n;g++){var d=a[g];if(!d)continue;
let e=d.getIntersection(h);if(!e.isEmpty()){let k=[];if(d.top<h.top&&k.push(new pa(d.left,d.top,d.right,e.top)),d.bottom>h.bottom&&k.push(new pa(d.left,e.bottom,d.right,d.bottom)),d.left<h.left&&k.push(new pa(d.left,e.top,e.left,e.bottom)),d.right>h.right&&k.push(new pa(e.right,e.top,d.right,e.bottom)),(k=k.filter(l=>!l.isEmpty())).length>0)for(a[g]=k[0],d=1;d<k.length;d++)a.push(k[d]);else a[g]=null}}}return a.filter(b=>null!=b)};pa.union=function(a){if(a instanceof pa)a=[a];else{a=a.slice(0);for(let d=
0;d<a.length;d++){let b=a[d],h=a.length;if(b)for(let n=d+1;n<h;n++){var c=a[n];if(c&&!b.getIntersection(c).isEmpty()){c=pa.subtract(c,b);a[n]=c[0];for(let g=1;g<c.length;g++)a.push(c[g])}}}}return a.filter(d=>d&&!d.isEmpty())};"object"==typeof window&&(window.cpRectGarbage=new pa(1.5,2.5,3.5,4.5));Mc.prototype.getBounds=function(){return new pa(0,0,this.width,this.height)};Mc.prototype.isInside=function(a,c){return a>=0&&c>=0&&a<this.width&&c<this.height};C.prototype=Object.create(Mc.prototype);C.prototype.constructor=
C;C.BYTES_PER_PIXEL=4;C.RED_BYTE_OFFSET=0;C.GREEN_BYTE_OFFSET=1;C.BLUE_BYTE_OFFSET=2;C.ALPHA_BYTE_OFFSET=3;C.prototype.clone=function(){return this.cloneRect(this.getBounds())};C.prototype.cloneRect=function(a){var c=new C(a.getWidth(),a.getHeight());return c.copyBitmapRect(this,0,0,a),c};C.prototype.getPixel=function(a,c){a=Math.max(0,Math.min(this.width-1,a));c=Math.max(0,Math.min(this.height-1,c));a=this.offsetOfPixel(a,c);return this.data[a+C.ALPHA_BYTE_OFFSET]<<24|this.data[a+C.RED_BYTE_OFFSET]<<
16|this.data[a+C.GREEN_BYTE_OFFSET]<<8|this.data[a+C.BLUE_BYTE_OFFSET]};C.prototype.setPixel=function(a,c,d){a=Math.max(0,Math.min(this.width-1,a));c=Math.max(0,Math.min(this.height-1,c));a=this.offsetOfPixel(a,c);this.data[a+C.ALPHA_BYTE_OFFSET]=d>>24&255;this.data[a+C.RED_BYTE_OFFSET]=d>>16&255;this.data[a+C.GREEN_BYTE_OFFSET]=d>>8&255;this.data[a+C.BLUE_BYTE_OFFSET]=255&d};C.prototype.copyRectXOR=function(a,c){var d=(c=this.getBounds().clipTo(c)).getWidth(),b=new Uint8Array(d*c.getHeight()*C.BYTES_PER_PIXEL),
h=0,n=this.offsetOfPixel(c.left,c.top),g=a.offsetOfPixel(c.left,c.top),e=(this.width-d)*C.BYTES_PER_PIXEL,k=(a.width-d)*C.BYTES_PER_PIXEL;d*=C.BYTES_PER_PIXEL;for(var l=c.top;l<c.bottom;l++,n+=e,g+=k)for(var f=0;f<d;f++,h++,n++,g++)b[h]=this.data[n]^a.data[g];return b};C.prototype.setRectXOR=function(a,c){var d=(c=this.getBounds().clipTo(c)).getWidth(),b=c.getHeight();c=this.offsetOfPixel(c.left,c.top);var h=0,n=(this.width-d)*C.BYTES_PER_PIXEL;d*=C.BYTES_PER_PIXEL;for(var g=0;g<b;g++){for(var e=
0;e<d;e++)this.data[c++]^=a[h++];c+=n}};C.prototype.copyBitmapRect=function(a,c,d,b){var h=new pa(c,d,0,0);b=b.clone();this.getBounds().clipSourceDest(b,h);c=0|h.getWidth();d=0|h.getHeight();if(0==h.left&&0==h.top&&c==this.width&&d==this.height&&c==a.width&&d==a.height)this.copyPixelsFrom(a);else{h=this.offsetOfPixel(h.left,h.top);var n=(this.width-c)*C.BYTES_PER_PIXEL;b=a.offsetOfPixel(b.left,b.top);for(var g=(a.width-c)*C.BYTES_PER_PIXEL,e=0;e<d;e++,b+=g,h+=n)for(var k=0;k<c;k++,b+=C.BYTES_PER_PIXEL,
h+=C.BYTES_PER_PIXEL)this.data[h]=a.data[b],this.data[h+1]=a.data[b+1],this.data[h+2]=a.data[b+2],this.data[h+3]=a.data[b+3]}};C.prototype.copyAlphaFrom=function(a,c){var d=0|(c=this.getBounds().clipTo(c)).getWidth(),b=0|c.getHeight();c=this.offsetOfPixel(c.left,c.top)+C.ALPHA_BYTE_OFFSET|0;for(var h=(this.width-d)*C.BYTES_PER_PIXEL|0,n=0;n<b;n++,c+=h)for(var g=0;g<d;g++,c+=C.BYTES_PER_PIXEL)this.data[c]=a.data[c]};C.prototype.setToSize=function(a){(a.width!=this.width||a.height!=this.height)&&(this.width=
a.width,this.height=a.height,this.imageData=Xd(this.width,this.height),this.data=this.imageData.data)};C.prototype.copyPixelsFrom=function(a){if(this.setToSize(a),"set"in this.data)this.data.set(a.data);else for(var c=0;c<this.data.length;c++)this.data[c]=a.data[c]};C.prototype.copyPixelsFromGreyscale=function(a){var c,d=0,b=a.width*a.height;this.setToSize(a);for(c=0;c<b;c++,d+=C.BYTES_PER_PIXEL)this.data[d+C.RED_BYTE_OFFSET]=a.data[c],this.data[d+C.GREEN_BYTE_OFFSET]=a.data[c],this.data[d+C.BLUE_BYTE_OFFSET]=
a.data[c],this.data[d+C.ALPHA_BYTE_OFFSET]=255};C.prototype.copyScaledNearestNeighbor=function(a){for(var c,d=0,b=a.width/this.width,h=a.height/this.height,n=0,g=0;n<this.height;n++,g+=h){c=a.offsetOfPixel(0,Math.round(g));for(var e=0,k=0;e<this.width;e++,d+=C.BYTES_PER_PIXEL,k+=b){var l=c+Math.round(k)*C.BYTES_PER_PIXEL;this.data[d]=a.data[l];this.data[d+1]=a.data[l+1];this.data[d+2]=a.data[l+2];this.data[d+C.ALPHA_BYTE_OFFSET]=a.data[l+C.ALPHA_BYTE_OFFSET]}}};C.prototype.createThumbnailFrom=function(a){let c=
Math.min(Math.floor(a.width/this.width),3);if(c<2)return void this.copyScaledNearestNeighbor(a);let d=new Uint16Array(5*this.width);var b=a.width*C.BYTES_PER_PIXEL,h=Math.floor(a.width/this.width)*C.BYTES_PER_PIXEL;let n=Math.floor(a.width/this.width/c)*C.BYTES_PER_PIXEL,g=h-n*c;var e=Math.floor(a.height/this.height/c);h=e*b-h*this.width;b*=Math.floor(a.height/this.height)-e*c;let k=e=0;for(let r=0;r<this.height;r++,e+=b){let q;d.fill(0);for(var l=0;l<c;l++,e+=h){q=0;for(var f=0;f<this.width;f++,
q+=5,e+=g)for(var m=0;m<c;m++,e+=n){let t=a.data[e+C.ALPHA_BYTE_OFFSET],v=t/255;d[q]+=a.data[e]*v;d[q+1]+=a.data[e+1]*v;d[q+2]+=a.data[e+2]*v;d[q+C.ALPHA_BYTE_OFFSET]+=t;d[q+4]=Math.max(d[q+4],t)}}q=0;for(l=0;l<this.width;l++,q+=5,k+=C.BYTES_PER_PIXEL)f=d[q+4],0==f?this.data[k+C.ALPHA_BYTE_OFFSET]=0:(m=f/d[q+C.ALPHA_BYTE_OFFSET],this.data[k]=d[q]*m,this.data[k+1]=d[q+1]*m,this.data[k+2]=d[q+2]*m,this.data[k+C.ALPHA_BYTE_OFFSET]=f)}};C.prototype.floodFillWithBorder=function(a,c,d,b=2,h=255,n=null){if(this.isInside(a,
c)){var g=this.width,e=this.height,k=this.data,l=n?n.data:k,f=C.BYTES_PER_PIXEL;n=d>>16&255;var m=d>>8&255;d&=255;var r=new Uint8Array(g*e),q=[{x:a,y:c}];a=(c*g+a)*f;var t=l[a+C.RED_BYTE_OFFSET],v=l[a+C.GREEN_BYTE_OFFSET],x=l[a+C.BLUE_BYTE_OFFSET],A=l[a+C.ALPHA_BYTE_OFFSET];a=(y,E)=>{if(y<0||E<0||y>=g||E>=e||r[E*g+y])return!1;y=(E*g+y)*f;return l[y+C.RED_BYTE_OFFSET]===t&&l[y+C.GREEN_BYTE_OFFSET]===v&&l[y+C.BLUE_BYTE_OFFSET]===x&&l[y+C.ALPHA_BYTE_OFFSET]===A};for(c=(y,E,G,M,L,J)=>{y=(E*g+y)*f;k[y+
C.RED_BYTE_OFFSET]=G;k[y+C.GREEN_BYTE_OFFSET]=M;k[y+C.BLUE_BYTE_OFFSET]=L;k[y+C.ALPHA_BYTE_OFFSET]=J};q.length;){let {x:y,y:E}=q.pop();a(y,E)&&(r[E*g+y]=1,c(y,E,n,m,d,h),a(y,E-1)&&q.push({x:y,y:E-1}),a(y+1,E)&&q.push({x:y+1,y:E}),a(y,E+1)&&q.push({x:y,y:E+1}),a(y-1,E)&&q.push({x:y-1,y:E}))}q=new Uint8ClampedArray(k);for(a=0;a<e;a++)for(c=0;c<g;c++)if(r[a*g+c])for(let y=-b;y<=b;y++)for(let E=-b;E<=b;E++){var B=c+E;let G=a+y;B<0||G<0||B>=g||G>=e||r[G*g+B]||(B=(G*g+B)*f,q[B+C.RED_BYTE_OFFSET]=n,q[B+
C.GREEN_BYTE_OFFSET]=m,q[B+C.BLUE_BYTE_OFFSET]=d,q[B+C.ALPHA_BYTE_OFFSET]=h)}k.set(q)}};C.prototype.copyPixelColumnToArray=function(a,c,d,b){var h=(this.width-1)*C.BYTES_PER_PIXEL,n=0;a=this.offsetOfPixel(a,c);for(c=0;c<d;c++){for(var g=0;g<C.BYTES_PER_PIXEL;g++)b[n++]=this.data[a++];a+=h}};C.prototype.copyArrayToPixelColumn=function(a,c,d,b){var h=(this.width-1)*C.BYTES_PER_PIXEL,n=0;a=this.offsetOfPixel(a,c);for(c=0;c<d;c++){for(var g=0;g<C.BYTES_PER_PIXEL;g++)this.data[a++]=b[n++];a+=h}};C.prototype.boxBlur=
function(a,c,d){let b=(a=this.getBounds().clipTo(a)).getWidth(),h=b*C.BYTES_PER_PIXEL,n=a.getHeight();var g=Math.max(b,n);let e=new Uint8Array(g*C.BYTES_PER_PIXEL);g=new Uint8Array(g*C.BYTES_PER_PIXEL);for(let f=a.top;f<a.bottom;f++){var k=this.offsetOfPixel(a.left,f);for(var l=0;l<h;l++)e[l]=this.data[k++];!function(m,r){for(var q=0,t=0;t<r;t++){for(var v=m[q+C.ALPHA_BYTE_OFFSET],x=0;x<3;x++,q++)m[q]=Math.round(m[q]*v/255);q++}}(e,b);Be(e,g,b,c);k=this.offsetOfPixel(a.left,f);for(l=0;l<h;l++)this.data[k++]=
g[l]}for(c=a.left;c<a.right;c++)this.copyPixelColumnToArray(c,a.top,n,e),Be(e,g,n,d),function(f,m){for(var r=0,q=0;q<m;q++){var t=f[r+C.ALPHA_BYTE_OFFSET];if(0!=t){t=255/t;for(var v=0;v<3;v++,r++)f[r]=Math.min(Math.round(f[r]*t),255);r++}else r+=C.BYTES_PER_PIXEL}}(g,n),this.copyArrayToPixelColumn(c,a.top,n,g)};C.prototype.chromaticAberration=function(a,c){c=Math.max(1,Math.min(32,c));a=this.getBounds().clipTo(a);let d=this.width,b=this.height,h=C.BYTES_PER_PIXEL,n=new Uint8ClampedArray(this.data),
g=new Uint8ClampedArray(this.data.length);g.set(n);for(let l=a.top;l<a.bottom;l++)for(let f=a.left;f<a.right;f++){var e=(l*d+f)*h;let m=n[e+C.RED_BYTE_OFFSET],r=n[e+C.GREEN_BYTE_OFFSET],q=n[e+C.BLUE_BYTE_OFFSET];e=n[e+C.ALPHA_BYTE_OFFSET]/255;if(0!==e){var k=Math.min(d-1,f+c);k=(l*d+k)*h;g[k+C.ALPHA_BYTE_OFFSET];g[k+C.RED_BYTE_OFFSET]=Math.round(m*e+g[k+C.RED_BYTE_OFFSET]*(1-e));g[(k=(Math.min(b-1,l+c)*d+f)*h)+C.ALPHA_BYTE_OFFSET];g[k+C.GREEN_BYTE_OFFSET]=Math.round(r*e+g[k+C.GREEN_BYTE_OFFSET]*(1-
e));k=Math.max(0,f-c);g[(k=(Math.max(0,l-c)*d+k)*h)+C.ALPHA_BYTE_OFFSET];g[k+C.BLUE_BYTE_OFFSET]=Math.round(q*e+g[k+C.BLUE_BYTE_OFFSET]*(1-e))}}this.data.set(g)};C.prototype.offsetOfPixel=function(a,c){return(c*this.width+a)*4|0};C.prototype.getMemorySize=function(){return this.data.length};C.prototype.getImageData=function(){return this.imageData};C.prototype.setImageData=function(a){this.width=a.width;this.height=a.height;this.imageData=a;this.data=a.data};C.prototype.clearAll=function(a){if(0==
a&&"fill"in this.data)this.data.fill(0);else{var c=a>>24&255,d=a>>16&255,b=a>>8&255;a&=255;for(var h=0;h<this.width*this.height*C.BYTES_PER_PIXEL;)this.data[h++]=d,this.data[h++]=b,this.data[h++]=a,this.data[h++]=c}};C.prototype.clearRect=function(a,c){a=this.getBounds().clipTo(a);var d=c>>24&255,b=c>>16&255,h=c>>8&255;c&=255;for(var n=(this.width-a.getWidth())*C.BYTES_PER_PIXEL,g=this.offsetOfPixel(a.left,a.top),e=a.top;e<a.bottom;e++,g+=n)for(var k=a.left;k<a.right;k++)this.data[g++]=b,this.data[g++]=
h,this.data[g++]=c,this.data[g++]=d};C.prototype.copyRegionHFlip=function(a,c){a=this.getBounds().clipTo(a);for(var d=a.top;d<a.bottom;d++)for(var b=this.offsetOfPixel(a.left,d),h=c.offsetOfPixel(a.right-1,d),n=a.left;n<a.right;n++,h-=2*C.BYTES_PER_PIXEL)for(var g=0;g<C.BYTES_PER_PIXEL;g++)this.data[b++]=c.data[h++]};C.prototype.copyRegionVFlip=function(a,c){for(var d=(a=this.getBounds().clipTo(a)).getWidth()*C.BYTES_PER_PIXEL,b=a.top;b<a.bottom;b++)for(var h=this.offsetOfPixel(a.left,b),n=c.offsetOfPixel(a.left,
a.bottom-1-(b-a.top)),g=0;g<d;g++)this.data[h++]=c.data[n++]};C.prototype.fillWithNoise=function(a){a=this.getBounds().clipTo(a);for(var c,d=(this.width-a.getWidth())*C.BYTES_PER_PIXEL,b=this.offsetOfPixel(a.left,a.top),h=a.top;h<a.bottom;h++,b+=d)for(var n=a.left;n<a.right;n++,b+=C.BYTES_PER_PIXEL)c=256*Math.random()|0,this.data[b+C.RED_BYTE_OFFSET]=c,this.data[b+C.GREEN_BYTE_OFFSET]=c,this.data[b+C.BLUE_BYTE_OFFSET]=c,this.data[b+C.ALPHA_BYTE_OFFSET]=255};C.prototype.gradientHorzReplace=function(a,
c,d,b){var h={r:b[0]>>16&255,g:b[0]>>8&255,b:255&b[0],a:b[0]>>24&255};b={r:b[1]>>16&255,g:b[1]>>8&255,b:255&b[1],a:b[1]>>24&255};var n=(this.width-a.getWidth())*C.BYTES_PER_PIXEL,g=0|this.offsetOfPixel(a.left,a.top),e=a.bottom-a.top|0;if(d<c){var k=d;d=c;c=k;k=h;h=b;b=k}var l=d-c|0;k=(b.r-h.r)/l;var f=(b.g-h.g)/l,m=(b.b-h.b)/l;l=(b.a-h.a)/l;for(var r=Math.max(a.left-c,0),q=0;q<e;q++,g+=n){for(var t=a.left,v=0|Math.min(c,a.right);t<v;t++,g+=C.BYTES_PER_PIXEL)this.data[g+C.RED_BYTE_OFFSET]=h.r,this.data[g+
C.GREEN_BYTE_OFFSET]=h.g,this.data[g+C.BLUE_BYTE_OFFSET]=h.b,this.data[g+C.ALPHA_BYTE_OFFSET]=h.a;var x=h.r+k*r,A=h.g+f*r,B=h.b+m*r,y=h.a+l*r;for(v=0|Math.min(d,a.right);t<v;t++,g+=C.BYTES_PER_PIXEL)this.data[g+C.RED_BYTE_OFFSET]=x,this.data[g+C.GREEN_BYTE_OFFSET]=A,this.data[g+C.BLUE_BYTE_OFFSET]=B,this.data[g+C.ALPHA_BYTE_OFFSET]=y,x+=k,A+=f,B+=m,y+=l;for(;t<a.right;t++,g+=C.BYTES_PER_PIXEL)this.data[g+C.RED_BYTE_OFFSET]=b.r,this.data[g+C.GREEN_BYTE_OFFSET]=b.g,this.data[g+C.BLUE_BYTE_OFFSET]=b.b,
this.data[g+C.ALPHA_BYTE_OFFSET]=b.a}};C.prototype.gradientVertReplace=function(a,c,d,b){var h={r:b[0]>>16&255,g:b[0]>>8&255,b:255&b[0],a:b[0]>>24&255};b={r:b[1]>>16&255,g:b[1]>>8&255,b:255&b[1],a:b[1]>>24&255};let n=(this.width-a.getWidth())*C.BYTES_PER_PIXEL,g=0|this.offsetOfPixel(a.left,a.top),e=a.right-a.left|0;if(d<c){var k=d;d=c;c=k;k=h;h=b;b=k}k=a.top;for(var l=0|Math.min(a.bottom,c);k<l;k++,g+=n)for(var f=0;f<e;f++,g+=C.BYTES_PER_PIXEL)this.data[g+C.RED_BYTE_OFFSET]=h.r,this.data[g+C.GREEN_BYTE_OFFSET]=
h.g,this.data[g+C.BLUE_BYTE_OFFSET]=h.b,this.data[g+C.ALPHA_BYTE_OFFSET]=h.a;var m=d-c|0;l=(b.r-h.r)/m;f=(b.g-h.g)/m;var r=(b.b-h.b)/m;m=(b.a-h.a)/m;var q=Math.max(k-c,0);c=h.r+l*q;var t=h.g+f*q,v=h.b+r*q;h=h.a+m*q;for(d=0|Math.min(a.bottom,d);k<d;k++,g+=n){for(q=0;q<e;q++,g+=C.BYTES_PER_PIXEL)this.data[g+C.RED_BYTE_OFFSET]=c,this.data[g+C.GREEN_BYTE_OFFSET]=t,this.data[g+C.BLUE_BYTE_OFFSET]=v,this.data[g+C.ALPHA_BYTE_OFFSET]=h;c+=l;t+=f;v+=r;h+=m}for(;k<a.bottom;k++,g+=n)for(d=0;d<e;d++,g+=C.BYTES_PER_PIXEL)this.data[g+
C.RED_BYTE_OFFSET]=b.r,this.data[g+C.GREEN_BYTE_OFFSET]=b.g,this.data[g+C.BLUE_BYTE_OFFSET]=b.b,this.data[g+C.ALPHA_BYTE_OFFSET]=b.a};C.prototype.gradientReplace=function(a,c,d,b,h,n){var g=(this.width-a.getWidth())*C.BYTES_PER_PIXEL,e=0|this.offsetOfPixel(a.left,a.top),k=a.right-a.left|0,l=n[0]>>16&255,f=n[0]>>8&255,m=255&n[0],r=n[0]>>24&255,q=n[1]>>16&255,t=n[1]>>8&255,v=255&n[1];n=n[1]>>24&255;var x=h-d+(b-c)*(b-c)/(h-d);b=b-c+(h-d)*(h-d)/(b-c);h=1/b;for(var A=a.top;A<a.bottom;A++,e+=g)for(var B=
(a.left-c)/b+(A-d)/x,y=0;y<k;y++,e+=C.BYTES_PER_PIXEL){var E=Math.min(Math.max(B,0),1),G=1-E;this.data[e+C.RED_BYTE_OFFSET]=l*G+q*E;this.data[e+C.GREEN_BYTE_OFFSET]=f*G+t*E;this.data[e+C.BLUE_BYTE_OFFSET]=m*G+v*E;this.data[e+C.ALPHA_BYTE_OFFSET]=r*G+n*E;B+=h}};C.prototype.gradientAlpha=function(a,c,d,b,h,n){var g=(this.width-a.getWidth())*C.BYTES_PER_PIXEL,e=0|this.offsetOfPixel(a.left,a.top),k=a.right-a.left|0,l=n[0]>>16&255,f=n[0]>>8&255,m=255&n[0],r=n[0]>>24&255,q=n[1]>>16&255,t=n[1]>>8&255,v=
255&n[1];n=n[1]>>24&255;var x=h-d+(b-c)*(b-c)/(h-d);b=b-c+(h-d)*(h-d)/(b-c);h=1/b;for(var A=a.top;A<a.bottom;A++,e+=g)for(var B=(a.left-c)/b+(A-d)/x,y=0;y<k;y++,e+=C.BYTES_PER_PIXEL){var E=Math.min(Math.max(B,0),1),G=1-E,M=l*G+q*E,L=f*G+t*E,J=m*G+v*E;G=r*G+n*E;E=this.data[e+C.ALPHA_BYTE_OFFSET];E=G+E-G*E/255|0;if(E>0){G=255*G/E|0;var W=255-G;this.data[e+C.RED_BYTE_OFFSET]=(M*G+this.data[e+C.RED_BYTE_OFFSET]*W)/255|0;this.data[e+C.GREEN_BYTE_OFFSET]=(L*G+this.data[e+C.GREEN_BYTE_OFFSET]*W)/255|0;this.data[e+
C.BLUE_BYTE_OFFSET]=(J*G+this.data[e+C.BLUE_BYTE_OFFSET]*W)/255|0;this.data[e+C.ALPHA_BYTE_OFFSET]=E}B+=h}};C.prototype.gradient=function(a,c,d,b,h,n,g){a=this.getBounds().clipTo(a);(c!=b||d!=h)&&(g||n[0]>>>24==255&&n[1]>>>24==255?c==b?this.gradientVertReplace(a,d,h,n):d==h?this.gradientHorzReplace(a,c,b,n):this.gradientReplace(a,c,d,b,h,n):this.gradientAlpha(a,c,d,b,h,n))};C.prototype.fillWithColorNoise=function(a){a=this.getBounds().clipTo(a);for(var c,d=(this.width-a.getWidth())*C.BYTES_PER_PIXEL,
b=this.offsetOfPixel(a.left,a.top),h=a.top;h<a.bottom;h++,b+=d)for(var n=a.left;n<a.right;n++,b+=C.BYTES_PER_PIXEL)c=16777216*Math.random()|0,this.data[b+C.RED_BYTE_OFFSET]=c>>16&255,this.data[b+C.GREEN_BYTE_OFFSET]=c>>8&255,this.data[b+C.BLUE_BYTE_OFFSET]=255&c,this.data[b+C.ALPHA_BYTE_OFFSET]=255};C.prototype.invert=function(a){a=this.getBounds().clipTo(a);for(var c=(this.width-a.getWidth())*C.BYTES_PER_PIXEL,d=this.offsetOfPixel(a.left,a.top),b=a.top;b<a.bottom;b++,d+=c)for(var h=a.left;h<a.right;h++,
d+=C.BYTES_PER_PIXEL)this.data[d+C.RED_BYTE_OFFSET]^=255,this.data[d+C.GREEN_BYTE_OFFSET]^=255,this.data[d+C.BLUE_BYTE_OFFSET]^=255};C.prototype.brightnessToOpacity=function(a){a=this.getBounds().clipTo(a);let c=(this.width-a.getWidth())*C.BYTES_PER_PIXEL,d=this.offsetOfPixel(a.left,a.top);for(let h=a.top;h<a.bottom;h++,d+=c)for(let n=a.left;n<a.right;n++,d+=C.BYTES_PER_PIXEL){var b=void 0;b=(this.data[d+C.RED_BYTE_OFFSET]+this.data[d+C.GREEN_BYTE_OFFSET]+this.data[d+C.BLUE_BYTE_OFFSET])/3;let g=
this.data[d+C.ALPHA_BYTE_OFFSET]/255;b=b>250?0:Math.round((1-b/250)*255);this.data[d+C.ALPHA_BYTE_OFFSET]=Math.round(b*g);b>0&&(this.data[d+C.RED_BYTE_OFFSET]=0,this.data[d+C.GREEN_BYTE_OFFSET]=0,this.data[d+C.BLUE_BYTE_OFFSET]=0)}};C.prototype.getNonTransparentBounds=function(a){var c,d,b=a.clone();var h=(this.width-b.getWidth())*C.BYTES_PER_PIXEL;a=this.offsetOfPixel(b.left,b.top)+C.ALPHA_BYTE_OFFSET;for(d=b.top;d<b.bottom;d++,a+=h){var n=0;for(c=b.left;c<b.right;c++,a+=C.BYTES_PER_PIXEL)n|=this.data[a];
if(0!=n)break}if(b.top=d,b.top==b.bottom)return b;a=this.offsetOfPixel(b.right-1,b.bottom-1)+C.ALPHA_BYTE_OFFSET;for(d=b.bottom-1;d>=b.top;d--,a-=h){n=0;for(c=b.right-1;c>=b.left;c--,a-=C.BYTES_PER_PIXEL)n|=this.data[a];if(0!=n)break}b.bottom=d+1;h=C.BYTES_PER_PIXEL*this.width;for(c=b.left;c<b.right;c++){a=this.offsetOfPixel(c,b.top)+C.ALPHA_BYTE_OFFSET;n=0;for(d=b.top;d<b.bottom;d++,a+=h)n|=this.data[a];if(0!=n)break}b.left=c;for(c=b.right-1;c>=b.left;c--){a=this.offsetOfPixel(c,b.top)+C.ALPHA_BYTE_OFFSET;
n=0;for(d=b.top;d<b.bottom;d++,a+=h)n|=this.data[a];if(0!=n)break}return b.right=c+1,b};C.prototype.getAsCanvas=function(a){var c=Nc(this.imageData.width,this.imageData.height);return c.getContext("2d").putImageData(this.imageData,0,0),Ce(c,a||0)};C.prototype.getAsPNG=function(a){var c;return"string"==typeof(c=this.getAsCanvas(a).toDataURL("image/png"))&&!!c.match(/^data:image\/png;base64,/i)&&window.atob(c.substring(22))};C.prototype.getAsPNGBuffer=function(a){return this.getAsCanvas(a).toBuffer("image/png")};
C.prototype.hasAlphaInRect=function(a){a=this.getBounds().clipTo(a);for(var c=(this.width-a.getWidth())*C.BYTES_PER_PIXEL,d=this.offsetOfPixel(a.left,a.top)+C.ALPHA_BYTE_OFFSET,b=a.top;b<a.bottom;b++,d+=c){for(var h=255,n=a.left;n<a.right;n++,d+=C.BYTES_PER_PIXEL)h&=this.data[d];if(255!=h)return!0}return!1};C.prototype.hasAlpha=function(){return this.hasAlphaInRect(this.getBounds())};C.createFromImage=function(a){var c=Nc(a.width,a.height).getContext("2d");return c.globalCompositeOperation="copy",
c.drawImage(a,0,0),new C(c.getImageData(0,0,a.width,a.height))};C.prototype.equals=function(a){if(this.width!=a.width||this.height!=a.height)return!1;for(let c=0;c<this.data.length;c+=C.BYTES_PER_PIXEL)if(!(0==this.data[c+C.ALPHA_BYTE_OFFSET]&&0==a.data[c+C.ALPHA_BYTE_OFFSET]||this.data[c]==a.data[c]&&this.data[c+1]==a.data[c+1]&&this.data[c+2]==a.data[c+2]&&this.data[c+3]==a.data[c+3]))return!1;return!0};Ua.prototype=Object.create(Xa.prototype);Ua.prototype.constructor=Ua;Ua.prototype.getLinearizedLayerList=
function(a,c){for(let d of(c=c||[],this.layers))d instanceof Ua&&(d.expanded||!a)&&d.getLinearizedLayerList(a,c),c.push(d);return c};Ua.prototype.clearLayers=function(){this.layers=[]};Ua.prototype.addLayer=function(a){a.parent=this;this.layers.push(a)};Ua.prototype.insertLayer=function(a,c){c.parent=this;this.layers.splice(a,0,c)};Ua.prototype.removeLayer=function(a){a=this.layers.indexOf(a);a>-1&&this.layers.splice(a,1)};Ua.prototype.removeLayerAtIndex=function(a){var c=this.layers[a];return c&&
this.layers.splice(a,1),c};Ua.prototype.setLayerAtIndex=function(a,c){var d=this.layers[a];return c.parent=this,this.layers[a]=c,d};Ua.prototype.setExpanded=function(a){this.expanded=a};Ua.prototype.getExpanded=function(){return this.expanded};Ua.prototype.indexOf=function(a){return this.layers.indexOf(a)};Ua.prototype.getMemoryUsed=function(){return this.layers.map(a=>a.getMemoryUsed()).reduce(Rf,0)};Ua.prototype.clone=function(){var a=new Ua(this.name,this.blendMode);return Xa.prototype.copyFrom.call(a,
this),a.expanded=this.expanded,a.layers=this.layers.map(c=>c.clone()),a.layers.forEach(c=>c.parent=a),a};Ua.prototype.getNonTransparentBounds=function(a){var c=new pa(0,0,0,0);return this.layers.forEach(d=>c.union(d.getNonTransparentBounds(a))),c};Ba.prototype=Object.create(Mc.prototype);Ba.prototype.constructor=Ba;Ba.prototype.createBitmap=function(a,c,d){switch(this.bitDepth=d,d){case 32:this.data=new Uint32Array(a*c);break;case 16:this.data=new Uint16Array(a*c);break;default:this.data=new Uint8Array(a*
c)}};Ba.prototype.clone=function(){var a=new Ba(this.width,this.height,this.bitDepth);return a.copyPixelsFrom(this),a};Ba.prototype.cloneRect=function(a){var c=new Ba(a.getWidth(),a.getHeight(),this.bitDepth);return c.copyBitmapRect(this,0,0,a),c};Ba.prototype.getPixel=function(a,c){return a=Math.max(0,Math.min(this.width-1,a)),c=Math.max(0,Math.min(this.height-1,c)),this.data[this.offsetOfPixel(a,c)]};Ba.prototype.setPixel=function(a,c,d){a=Math.max(0,Math.min(this.width-1,a));c=Math.max(0,Math.min(this.height-
1,c));a=this.offsetOfPixel(a,c);this.data[a+CPColorBmp.ALPHA_BYTE_OFFSET]=d>>24&255;this.data[a+CPColorBmp.RED_BYTE_OFFSET]=d>>16&255;this.data[a+CPColorBmp.GREEN_BYTE_OFFSET]=d>>8&255;this.data[a+CPColorBmp.BLUE_BYTE_OFFSET]=255&d};Ba.prototype.clearAll=function(a){this.data.fill(a)};Ba.prototype.clearRect=function(a,c){if((a=this.getBounds().clipTo(a)).equals(this.getBounds()))this.clearAll(c);else{let d=this.width,b=a.right-a.left,h=this.offsetOfPixel(a.left,a.top);for(let n=a.top;n<a.bottom;n++,
h+=d)this.data.fill(c,h,h+b)}};Ba.prototype.copyScaledNearestNeighbor=function(a){for(var c,d=0,b=a.width/this.width,h=a.height/this.height,n=0,g=0;n<this.height;n++,g+=h){c=a.offsetOfPixel(0,Math.round(g));for(var e=0,k=0;e<this.width;e++,d++,k+=b)this.data[d]=a.data[c+Math.round(k)]}};Ba.prototype.floodFillWithBorder=function(a,c,d,b=2,h=255){if(this.isInside(a,c)){d&=255;var n=this.width,g=this.height,e=this.data,k=new Uint8Array(n*g),l=e[c*n+a];h/=255;for(a=[{x:a,y:c}];a.length;){var f=void 0;
let {x:r,y:q}=a.pop();r<0||q<0||r>=n||q>=g||(c=q*n+r,k[c]||Math.abs(e[c]-l)>10||(k[c]=1,f=Math.round(e[c]*(1-h)+d*h),e[c]=f,a.push({x:r+1,y:q}),a.push({x:r-1,y:q}),a.push({x:r,y:q+1}),a.push({x:r,y:q-1})))}if(b>0){f=new Uint8ClampedArray(e);l=new Uint8ClampedArray(f);for(a=0;a<g;a++)for(c=0;c<n;c++)if(k[a*n+c])for(let r=-b;r<=b;r++)for(let q=-b;q<=b;q++){var m=c+q;let t=a+r;m<0||t<0||m>=n||t>=g||(m=t*n+m,k[m]||(l[m]=Math.round(f[m]*(1-h)+d*h)))}e.set(l)}}};Ba.prototype.createThumbnailFrom=function(a){let c=
Math.min(Math.floor(a.width/this.width),3);if(c<2)return void this.copyScaledNearestNeighbor(a);let d=new Uint16Array(this.width);var b=a.width,h=Math.floor(a.width/this.width);let n=Math.floor(a.width/this.width/c),g=h-n*c;var e=Math.floor(a.height/this.height/c);h=e*b-h*this.width;b*=Math.floor(a.height/this.height)-e*c;let k=e=0;for(let f=0;f<this.height;f++,e+=b){let m;d.fill(0);for(var l=0;l<c;l++,e+=h){m=0;for(let r=0;r<this.width;r++,m++,e+=g)for(let q=0;q<c;q++,e+=n)d[m]+=a.data[e]}m=0;for(l=
0;l<this.width;l++,m++,k++)this.data[k]=d[m]/(c*c)}};Ba.prototype.mirrorHorizontally=function(){let a=this.width,c=this.height,d=new Uint8Array(a*c),b=0,h=a;for(let n=0;n<c;n++,h+=a+a)for(let g=0;g<a;g++)d[b++]=this.data[--h];this.data=d};Ba.prototype.applyLUT=function(a){for(var c=0;c<this.data.length;c++)this.data[c]=a.table[this.data[c]]};Ba.prototype.getAsCanvas=function(a){var c=this.getImageData(0,0,this.width,this.height),d=Nc(this.width,this.height);return d.getContext("2d").putImageData(c,
0,0),Ce(d,a||0)};Ba.prototype.getImageData=function(a,c,d,b){let h=Xd(d,b);a=this.offsetOfPixel(a,c);c=0;let n=this.width-d;for(let g=0;g<b;g++,a+=n)for(let e=0;e<d;e++,a++)h.data[c++]=this.data[a],h.data[c++]=this.data[a],h.data[c++]=this.data[a],h.data[c++]=255;return h};Ba.prototype.pasteImageData=function(a,c,d){let b=0;c=this.offsetOfPixel(c,d);d=this.width-a.width;for(let h=0;h<a.height;h++,c+=d)for(let n=0;n<a.width;n++,b+=4,c++)this.data[c]=a.data[b];return a};Ba.prototype.copyPixelsFrom=
function(a){a.width!=this.width||a.height!=this.height||a.bitDepth!=this.bitDepth?(this.data=a.data.slice(0),this.width=a.width,this.height=a.height,this.bitDepth=a.bitDepth):this.data.set(a.data)};Ba.prototype.copyRectXOR=function(a,c){for(var d=(c=this.getBounds().clipTo(c)).getWidth(),b=new Uint8Array(d*c.getHeight()),h=0,n=this.offsetOfPixel(c.left,c.top),g=a.offsetOfPixel(c.left,c.top),e=this.width-d,k=a.width-d,l=c.top;l<c.bottom;l++,n+=e,g+=k)for(var f=0;f<d;f++,h++,n++,g++)b[h]=this.data[n]^
a.data[g];return b};Ba.prototype.setRectXOR=function(a,c){var d=(c=this.getBounds().clipTo(c)).getWidth(),b=c.getHeight();c=this.offsetOfPixel(c.left,c.top);for(var h=0,n=this.width-d,g=0;g<b;g++){for(var e=0;e<d;e++)this.data[c++]^=a[h++];c+=n}};Ba.prototype.copyBitmapRect=function(a,c,d,b){var h=new pa(c,d,0,0);b=b.clone();this.getBounds().clipSourceDest(b,h);c=0|h.getWidth();d=0|h.getHeight();if(0==h.left&&0==h.top&&c==this.width&&d==this.height&&c==a.width&&d==a.height)this.copyPixelsFrom(a);
else{h=this.offsetOfPixel(h.left,h.top);var n=this.width-c;b=a.offsetOfPixel(b.left,b.top);for(var g=a.width-c,e=0;e<d;e++,b+=g,h+=n)for(var k=0;k<c;k++,b++,h++)this.data[h]=a.data[b]}};Ba.prototype.copyRegionHFlip=function(a,c){a=this.getBounds().clipTo(a);for(var d=a.top;d<a.bottom;d++)for(var b=this.offsetOfPixel(a.left,d),h=c.offsetOfPixel(a.right-1,d),n=a.left;n<a.right;n++,h-=2)this.data[b++]=c.data[h++]};Ba.prototype.copyRegionVFlip=function(a,c){for(var d=(a=this.getBounds().clipTo(a)).getWidth(),
b=a.top;b<a.bottom;b++)for(var h=this.offsetOfPixel(a.left,b),n=c.offsetOfPixel(a.left,a.bottom-1-(b-a.top)),g=0;g<d;g++)this.data[h++]=c.data[n++]};Ba.prototype.copyPixelColumnToArray=function(a,c,d,b){var h=this.width,n=0;a=this.offsetOfPixel(a,c);for(c=0;c<d;c++)b[n]=this.data[a],a+=h,n++};Ba.prototype.copyArrayToPixelColumn=function(a,c,d,b){var h=this.width,n=0;a=this.offsetOfPixel(a,c);for(c=0;c<d;c++)this.data[a]=b[n],a+=h,n++};Ba.prototype.boxBlur=function(a,c,d){let b=(a=this.getBounds().clipTo(a)).getWidth(),
h=a.getHeight();var n=Math.max(b,h);let g=new this.data.constructor(n);n=new this.data.constructor(n);for(let l=a.top;l<a.bottom;l++){var e=this.offsetOfPixel(a.left,l);for(var k=0;k<b;k++)g[k]=this.data[e++];De(g,n,b,c);e=this.offsetOfPixel(a.left,l);for(k=0;k<b;k++)this.data[e++]=n[k]}for(c=a.left;c<a.right;c++)this.copyPixelColumnToArray(c,a.top,h,g),De(g,n,h,d),this.copyArrayToPixelColumn(c,a.top,h,n)};Ba.prototype.offsetOfPixel=function(a,c){return c*this.width+a};Ba.prototype.fillWithNoise=
function(a){a=this.getBounds().clipTo(a);for(var c=this.width-a.getWidth(),d=this.offsetOfPixel(a.left,a.top),b=a.top;b<a.bottom;b++,d+=c)for(var h=a.left;h<a.right;h++,d++)this.data[d]=256*Math.random()|0};Ba.prototype.invert=function(a){a=this.getBounds().clipTo(a);for(var c=this.width-a.getWidth(),d=this.offsetOfPixel(a.left,a.top),b=a.top;b<a.bottom;b++,d+=c)for(var h=a.left;h<a.right;h++,d++)this.data[d]=~this.data[d]};Ba.prototype.brightnessToOpacity=function(a){a=this.getBounds().clipTo(a);
let c=(this.width-a.getWidth())*Ba.BYTES_PER_PIXEL,d=this.offsetOfPixel(a.left,a.top);for(let h=a.top;h<a.bottom;h++,d+=c)for(let n=a.left;n<a.right;n++,d++){var b=void 0;b=this.data[d];let g=this.data[d+Ba.ALPHA_BYTE_OFFSET]/255;b=b>250?0:Math.round((1-b/250)*255);this.data[d+Ba.ALPHA_BYTE_OFFSET]=Math.round(b*g);b>0&&(this.data[d]=0)}};Ba.prototype.getValueBounds=function(a,c){var d,b,h=a.clone();var n=this.width-h.getWidth();a=this.offsetOfPixel(h.left,h.top);for(b=h.top;b<h.bottom;b++,a+=n){var g=
!1;for(d=h.left;d<h.right;d++,a++)if(this.data[a]!=c){g=!0;break}if(g)break}if(h.top=b,h.top==h.bottom)return h;a=this.offsetOfPixel(h.right-1,h.bottom-1);for(b=h.bottom-1;b>=h.top;b--,a-=n){g=!1;for(d=h.right-1;d>=h.left;d--,a--)if(this.data[a]!=c){g=!0;break}if(g)break}h.bottom=b+1;n=this.width;for(d=h.left;d<h.right;d++){a=this.offsetOfPixel(d,h.top);g=!1;for(b=h.top;b<h.bottom;b++,a+=n)if(this.data[a]!=c){g=!0;break}if(g)break}h.left=d;for(d=h.right-1;d>=h.left;d--){a=this.offsetOfPixel(d,h.top);
g=!1;for(b=h.top;b<h.bottom;b++,a+=n)if(this.data[a]!=c){g=!0;break}if(g)break}return h.right=d+1,h};Ba.prototype.gradientHorzReplace=function(a,c,d,b){var h=255&b[0];b=255&b[1];var n=this.width-a.getWidth(),g=0|this.offsetOfPixel(a.left,a.top),e=a.bottom-a.top|0;if(d<c){var k=d;d=c;c=k;k=h;h=b;b=k}k=(b-h)/(d-c|0);for(var l=Math.max(a.left-c,0),f=0;f<e;f++,g+=n){for(var m=a.left,r=0|Math.min(c,a.right);m<r;m++,g++)this.data[g]=h;var q=h+k*l;for(r=0|Math.min(d,a.right);m<r;m++,g++)this.data[g]=q,q+=
k;for(;m<a.right;m++,g++)this.data[g]=b}};Ba.prototype.gradientVertReplace=function(a,c,d,b){var h=255&b[0];b=255&b[1];let n=this.width-a.getWidth(),g=0|this.offsetOfPixel(a.left,a.top),e=a.right-a.left|0;if(d<c){var k=d;d=c;c=k;k=h;h=b;b=k}k=a.top;for(var l=0|Math.min(a.bottom,c);k<l;k++,g+=n)for(let f=0;f<e;f++,g++)this.data[g]=h;l=(b-h)/(d-c|0);c=h+l*Math.max(k-c,0);for(d=0|Math.min(a.bottom,d);k<d;k++,g+=n){for(h=0;h<e;h++,g++)this.data[g]=c;c+=l}for(;k<a.bottom;k++,g+=n)for(d=0;d<e;d++,g++)this.data[g]=
b};Ba.prototype.gradientReplace=function(a,c,d,b,h,n){var g=this.width-a.getWidth(),e=0|this.offsetOfPixel(a.left,a.top),k=a.right-a.left|0,l=255&n[0];n=255&n[1];var f=h-d+(b-c)*(b-c)/(h-d);b=b-c+(h-d)*(h-d)/(b-c);h=1/b;for(var m=a.top;m<a.bottom;m++,e+=g)for(var r=(a.left-c)/b+(m-d)/f,q=0;q<k;q++,e++){var t=Math.min(Math.max(r,0),1);this.data[e]=l*(1-t)+n*t;r+=h}};Ba.prototype.gradientAlpha=function(a,c,d,b,h,n){var g=this.width-a.getWidth(),e=0|this.offsetOfPixel(a.left,a.top),k=a.right-a.left|
0,l=255&n[0],f=n[0]>>24&255,m=255&n[1];n=n[1]>>24&255;var r=h-d+(b-c)*(b-c)/(h-d);b=b-c+(h-d)*(h-d)/(b-c);h=1/b;for(var q=a.top;q<a.bottom;q++,e+=g)for(var t=(a.left-c)/b+(q-d)/r,v=0;v<k;v++,e++){var x=Math.min(Math.max(t,0),1),A=1-x,B=f*A+n*x;this.data[e]=((l*A+m*x)*B+this.data[e]*(255-B))/255|0;t+=h}};Ba.prototype.gradient=function(a,c,d,b,h,n,g){a=this.getBounds().clipTo(a);(c!=b||d!=h)&&(g||n[0]>>>24==255&&n[1]>>>24==255?c==b?this.gradientVertReplace(a,d,h,n):d==h?this.gradientHorzReplace(a,c,
b,n):this.gradientReplace(a,c,d,b,h,n):this.gradientAlpha(a,c,d,b,h,n))};Ba.prototype.equals=function(a){if(this.width!=a.width||this.height!=a.height)return!1;for(let c=0;c<this.data.length;c++)if(this.data[c]!=a.data[c])return!1;return!0};let yb=Array(256),zb=Array(256);I.multiplyOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3],l;k&&(l=
a.data[b],a.data[b]=l-((255^c.data[b])*l*k/65025|0),l=a.data[b+1],a.data[b+1]=l-((255^c.data[b+1])*l*k/65025|0),l=a.data[b+2],a.data[b+2]=l-((255^c.data[b+2])*l*k/65025|0))}};I.multiplyOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f;l&&(f=a.data[b],a.data[b]=f-((255^c.data[b])*f*l/65025|0),f=a.data[b+1],a.data[b+1]=f-((255^
c.data[b+1])*f*l/65025|0),f=a.data[b+2],a.data[b+2]=f-((255^c.data[b+2])*f*l/65025|0))}};I.multiplyOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let k=0;k<h;k++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,r=g*l/255|0,q=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(g*q+f*t+(g*f*r/255|0))/m|0;g=c.data[b+1];f=a.data[b+
1];a.data[b+1]=(g*q+f*t+(g*f*r/255|0))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(g*q+f*t+(g*f*r/255|0))/m|0;a.data[b+3]=m}}};I.multiplyOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let k=0;k<h;k++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let r=e+(f=a.data[b+3])-(e*f/255|0)|0,q=e*f/255|0,t=e*(255^f)/255|0,v=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(e*
t+m*v+(e*m*q/255|0))/r|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(e*t+m*v+(e*m*q/255|0))/r|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(e*t+m*v+(e*m*q/255|0))/r|0;a.data[b+3]=r}}};I.multiplyOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r;m&&(r=a.data[e],a.data[e]=
r-((255^c.data[e])*r*m/65025|0),r=a.data[e+1],a.data[e+1]=r-((255^c.data[e+1])*r*m/65025|0),r=a.data[e+2],a.data[e+2]=r-((255^c.data[e+2])*r*m/65025|0))}};I.multiplyOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0,q;r&&(q=a.data[k],a.data[k]=q-((255^
c.data[k])*q*r/65025|0),q=a.data[k+1],a.data[k+1]=q-((255^c.data[k+1])*q*r/65025|0),q=a.data[k+2],a.data[k+2]=q-((255^c.data[k+2])*q*r/65025|0))}};I.multiplyOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=k)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*h.data[b]/255|0;let r,q;if(l){let t=l+(r=a.data[e+3])-(l*r/255|0)|
0,v=l*r/255|0,x=l*(255^r)/255|0,A=(255^l)*r/255|0;l=c.data[e];q=a.data[e];a.data[e]=(l*x+q*A+(l*q*v/255|0))/t|0;l=c.data[e+1];q=a.data[e+1];a.data[e+1]=(l*x+q*A+(l*q*v/255|0))/t|0;l=c.data[e+2];q=a.data[e+2];a.data[e+2]=(l*x+q*A+(l*q*v/255|0))/t|0;a.data[e+3]=t}}};I.multiplyOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,
k+=e,b+=l)for(let r=0;r<g;r++,k+=4,b++){var f=c.data[k+3]*h.data[b]*d/25500|0;let q,t;if(f){let v=f+(q=a.data[k+3])-(f*q/255|0)|0,x=f*q/255|0,A=f*(255^q)/255|0,B=(255^f)*q/255|0;f=c.data[k];t=a.data[k];a.data[k]=(f*A+t*B+(f*t*x/255|0))/v|0;f=c.data[k+1];t=a.data[k+1];a.data[k+1]=(f*A+t*B+(f*t*x/255|0))/v|0;f=c.data[k+2];t=a.data[k+2];a.data[k+2]=(f*A+t*B+(f*t*x/255|0))/v|0;a.data[k+3]=v}}};I.multiply2OntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-
h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3],l;k&&(l=a.data[b],a.data[b]=l-Math.ceil((255^c.data[b])*l*k/65025),l=a.data[b+1],a.data[b+1]=l-Math.ceil((255^c.data[b+1])*l*k/65025),l=a.data[b+2],a.data[b+2]=l-Math.ceil((255^c.data[b+2])*l*k/65025))}};I.multiply2OntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=
0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f;l&&(f=a.data[b],a.data[b]=f-Math.ceil((255^c.data[b])*f*l/65025),f=a.data[b+1],a.data[b+1]=f-Math.ceil((255^c.data[b+1])*f*l/65025),f=a.data[b+2],a.data[b+2]=f-Math.ceil((255^c.data[b+2])*f*l/65025))}};I.multiply2OntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let k=0;k<h;k++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+
3])-(g*l/255|0)|0,r=g*l/255|0,q=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(g*q+f*t+(g*f*r/255|0))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(g*q+f*t+(g*f*r/255|0))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(g*q+f*t+(g*f*r/255|0))/m|0;a.data[b+3]=m}}};I.multiply2OntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let k=0;k<h;k++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+
3]*d/100|0;let f,m;if(e){let r=e+(f=a.data[b+3])-(e*f/255|0)|0,q=e*f/255|0,t=e*(255^f)/255|0,v=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(e*t+m*v+(e*m*q/255|0))/r|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(e*t+m*v+(e*m*q/255|0))/r|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(e*t+m*v+(e*m*q/255|0))/r|0;a.data[b+3]=r}}};I.multiply2OntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=
0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r;m&&(r=a.data[e],a.data[e]=r-Math.ceil((255^c.data[e])*r*m/65025),r=a.data[e+1],a.data[e+1]=r-Math.ceil((255^c.data[e+1])*r*m/65025),r=a.data[e+2],a.data[e+2]=r-Math.ceil((255^c.data[e+2])*r*m/65025))}};I.multiply2OntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-
g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0,q;r&&(q=a.data[k],a.data[k]=q-Math.ceil((255^c.data[k])*q*r/65025),q=a.data[k+1],a.data[k+1]=q-Math.ceil((255^c.data[k+1])*q*r/65025),q=a.data[k+2],a.data[k+2]=q-Math.ceil((255^c.data[k+2])*q*r/65025))}};I.multiply2OntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),
k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=k)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*h.data[b]/255|0;let r,q;if(l){let t=l+(r=a.data[e+3])-(l*r/255|0)|0,v=l*r/255|0,x=l*(255^r)/255|0,A=(255^l)*r/255|0;l=c.data[e];q=a.data[e];a.data[e]=(l*x+q*A+(l*q*v/255|0))/t|0;l=c.data[e+1];q=a.data[e+1];a.data[e+1]=(l*x+q*A+(l*q*v/255|0))/t|0;l=c.data[e+2];q=a.data[e+2];a.data[e+2]=(l*x+q*A+(l*q*v/255|0))/t|0;a.data[e+3]=t}}};I.multiply2OntoTransparentFusionWithTransparentLayerMasked=
function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,k+=e,b+=l)for(let r=0;r<g;r++,k+=4,b++){var f=c.data[k+3]*h.data[b]*d/25500|0;let q,t;if(f){let v=f+(q=a.data[k+3])-(f*q/255|0)|0,x=f*q/255|0,A=f*(255^q)/255|0,B=(255^f)*q/255|0;f=c.data[k];t=a.data[k];a.data[k]=(f*A+t*B+(f*t*x/255|0))/v|0;f=c.data[k+1];t=a.data[k+1];a.data[k+1]=(f*A+t*B+(f*t*x/255|0))/v|0;f=c.data[k+2];
t=a.data[k+2];a.data[k+2]=(f*A+t*B+(f*t*x/255|0))/v|0;a.data[k+3]=v}}};I.normalOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3],l;if(k)if(255==k)a.data[b]=c.data[b],a.data[b+1]=c.data[b+1],a.data[b+2]=c.data[b+2];else{let f=255-k;l=c.data[b];a.data[b]=(l*k+a.data[b]*f)/255|0;l=c.data[b+1];a.data[b+1]=(l*k+a.data[b+1]*f)/255|0;l=c.data[b+2];
a.data[b+2]=(l*k+a.data[b+2]*f)/255|0}}};I.normalOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f;if(l){let m=255-l;f=c.data[b];a.data[b]=(f*l+a.data[b]*m)/255|0;f=c.data[b+1];a.data[b+1]=(f*l+a.data[b+1]*m)/255|0;f=c.data[b+2];a.data[b+2]=(f*l+a.data[b+2]*m)/255|0}}};I.normalOntoTransparentFusionWithOpaqueLayer=function(a,
c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let k=0;k<h;k++,b+=4){var g=c.data[b+3];let l;if(g){let f=g+(l=a.data[b+3])-(g*l/255|0)|0;g=255*g/f|0;let m=255-g;a.data[b]=(c.data[b]*g+a.data[b]*m)/255|0;a.data[b+1]=(c.data[b+1]*g+a.data[b+1]*m)/255|0;a.data[b+2]=(c.data[b+2]*g+a.data[b+2]*m)/255|0;a.data[b+3]=f}}};I.normalOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),
g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let k=0;k<h;k++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f;if(e){let m=e+(f=a.data[b+3])-(e*f/255|0)|0;e=255*e/m|0;let r=255-e;a.data[b]=(c.data[b]*e+a.data[b]*r)/255|0;a.data[b+1]=(c.data[b+1]*e+a.data[b+1]*r)/255|0;a.data[b+2]=(c.data[b+2]*e+a.data[b+2]*r)/255|0;a.data[b+3]=m}}};I.normalOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,
b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r;if(m)if(255==m)a.data[e]=c.data[e],a.data[e+1]=c.data[e+1],a.data[e+2]=c.data[e+2];else{let q=255-m;r=c.data[e];a.data[e]=(r*m+a.data[e]*q)/255|0;r=c.data[e+1];a.data[e+1]=(r*m+a.data[e+1]*q)/255|0;r=c.data[e+2];a.data[e+2]=(r*m+a.data[e+2]*q)/255|0}}};I.normalOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|
b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0,q;if(r){let t=255-r;q=c.data[k];a.data[k]=(q*r+a.data[k]*t)/255|0;q=c.data[k+1];a.data[k+1]=(q*r+a.data[k+1]*t)/255|0;q=c.data[k+2];a.data[k+2]=(q*r+a.data[k+2]*t)/255|0}}};I.normalOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-
n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=k)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*h.data[b]/255|0;let r;if(l){let q=l+(r=a.data[e+3])-(l*r/255|0)|0;l=255*l/q|0;let t=255-l;a.data[e]=(c.data[e]*l+a.data[e]*t)/255|0;a.data[e+1]=(c.data[e+1]*l+a.data[e+1]*t)/255|0;a.data[e+2]=(c.data[e+2]*l+a.data[e+2]*t)/255|0;a.data[e+3]=q}}};I.normalOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),
g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,k+=e,b+=l)for(let r=0;r<g;r++,k+=4,b++){var f=c.data[k+3]*h.data[b]*d/25500|0;let q;if(f){let t=f+(q=a.data[k+3])-(f*q/255|0)|0;f=255*f/t|0;let v=255-f;a.data[k]=(c.data[k]*f+a.data[k]*v)/255|0;a.data[k+1]=(c.data[k+1]*f+a.data[k+1]*v)/255|0;a.data[k+2]=(c.data[k+2]*f+a.data[k+2]*v)/255|0;a.data[k+3]=t}}};I.addOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=
0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3];k&&(a.data[b]=a.data[b]+k*c.data[b]/255|0,a.data[b+1]=a.data[b+1]+k*c.data[b+1]/255|0,a.data[b+2]=a.data[b+2]+k*c.data[b+2]/255|0)}};I.addOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+
3]*d/100|0;l&&(a.data[b]=a.data[b]+l*c.data[b]/255|0,a.data[b+1]=a.data[b+1]+l*c.data[b+1]/255|0,a.data[b+2]=a.data[b+2]+l*c.data[b+2]/255|0)}};I.addOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3],l;if(k){let f=k+(l=a.data[b+3])-(k*l/255|0)|0;a.data[b]=(l*a.data[b]+k*c.data[b])/f|0;a.data[b+1]=(l*a.data[b+1]+k*c.data[b+1])/f|0;a.data[b+
2]=(l*a.data[b+2]+k*c.data[b+2])/f|0;a.data[b+3]=f}}};I.addOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f;if(l){let m=l+(f=a.data[b+3])-(l*f/255|0)|0;a.data[b]=(f*a.data[b]+l*c.data[b])/m|0;a.data[b+1]=(f*a.data[b+1]+l*c.data[b+1])/m|0;a.data[b+2]=(f*a.data[b+2]+l*c.data[b+2])/m|0;a.data[b+3]=m}}};I.addOntoOpaqueFusionWithOpaqueLayerMasked=
function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0;m&&(a.data[e]=a.data[e]+m*c.data[e]/255|0,a.data[e+1]=a.data[e+1]+m*c.data[e+1]/255|0,a.data[e+2]=a.data[e+2]+m*c.data[e+2]/255|0)}};I.addOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-
g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0;r&&(a.data[k]=a.data[k]+r*c.data[k]/255|0,a.data[k+1]=a.data[k+1]+r*c.data[k+1]/255|0,a.data[k+2]=a.data[k+2]+r*c.data[k+2]/255|0)}};I.addOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,
b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r;if(m){let q=m+(r=a.data[e+3])-(m*r/255|0)|0;a.data[e]=(r*a.data[e]+m*c.data[e])/q|0;a.data[e+1]=(r*a.data[e+1]+m*c.data[e+1])/q|0;a.data[e+2]=(r*a.data[e+2]+m*c.data[e+2])/q|0;a.data[e+3]=q}}};I.addOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,
b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0,q;if(r){let t=r+(q=a.data[k+3])-(r*q/255|0)|0;a.data[k]=(q*a.data[k]+r*c.data[k])/t|0;a.data[k+1]=(q*a.data[k+1]+r*c.data[k+1])/t|0;a.data[k+2]=(q*a.data[k+2]+r*c.data[k+2])/t|0;a.data[k+3]=t}}};I.subtractOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=
c.data[b+3];k&&(a.data[b]=a.data[b]+k*c.data[b]/255-k|0,a.data[b+1]=a.data[b+1]+k*c.data[b+1]/255-k|0,a.data[b+2]=a.data[b+2]+k*c.data[b+2]/255-k|0)}};I.subtractOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0;l&&(a.data[b]=a.data[b]+l*c.data[b]/255-l|0,a.data[b+1]=a.data[b+1]+l*c.data[b+1]/255-l|0,a.data[b+2]=a.data[b+2]+l*c.data[b+
2]/255-l|0)}};I.subtractOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3],l;if(k){let f=k+(l=a.data[b+3])-(k*l/255|0)|0,m=k*l;a.data[b]=(l*a.data[b]+k*c.data[b]-m)/f|0;a.data[b+1]=(l*a.data[b+1]+k*c.data[b+1]-m)/f|0;a.data[b+2]=(l*a.data[b+2]+k*c.data[b+2]-m)/f|0;a.data[b+3]=f}}};I.subtractOntoTransparentFusionWithTransparentLayer=function(a,
c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f;if(l){let m=l+(f=a.data[b+3])-(l*f/255|0)|0,r=l*f;a.data[b]=(f*a.data[b]+l*c.data[b]-r)/m|0;a.data[b+1]=(f*a.data[b+1]+l*c.data[b+1]-r)/m|0;a.data[b+2]=(f*a.data[b+2]+l*c.data[b+2]-r)/m|0;a.data[b+3]=m}}};I.subtractOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*
4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0;m&&(a.data[e]=a.data[e]+m*c.data[e]/255-m|0,a.data[e+1]=a.data[e+1]+m*c.data[e+1]/255-m|0,a.data[e+2]=a.data[e+2]+m*c.data[e+2]/255-m|0)}};I.subtractOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|
h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0;r&&(a.data[k]=a.data[k]+r*c.data[k]/255-r|0,a.data[k+1]=a.data[k+1]+r*c.data[k+1]/255-r|0,a.data[k+2]=a.data[k+2]+r*c.data[k+2]/255-r|0)}};I.subtractOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=
g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r;if(m){let q=m+(r=a.data[e+3])-(m*r/255|0)|0,t=m*r;a.data[e]=(r*a.data[e]+m*c.data[e]-t)/q|0;a.data[e+1]=(r*a.data[e+1]+m*c.data[e+1]-t)/q|0;a.data[e+2]=(r*a.data[e+2]+m*c.data[e+2]-t)/q|0;a.data[e+3]=q}}};I.subtractOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=
0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0,q;if(r){let t=r+(q=a.data[k+3])-(r*q/255|0)|0,v=r*q;a.data[k]=(q*a.data[k]+r*c.data[k]-v)/t|0;a.data[k+1]=(q*a.data[k+1]+r*c.data[k+1]-v)/t|0;a.data[k+2]=(q*a.data[k+2]+r*c.data[k+2]-v)/t|0;a.data[k+3]=t}}};I.screenOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=
c.data[b+3],l;if(k){let f=255^k;l=a.data[b];a.data[b]=255^((255^l)*f+(255^c.data[b])*(255^l)*k/255)/255;l=a.data[b+1];a.data[b+1]=255^((255^l)*f+(255^c.data[b+1])*(255^l)*k/255)/255;l=a.data[b+2];a.data[b+2]=255^((255^l)*f+(255^c.data[b+2])*(255^l)*k/255)/255}}};I.screenOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f;if(l){let m=
255^l;f=a.data[b];a.data[b]=255^((255^f)*m+(255^c.data[b])*(255^f)*l/255)/255;f=a.data[b+1];a.data[b+1]=255^((255^f)*m+(255^c.data[b+1])*(255^f)*l/255)/255;f=a.data[b+2];a.data[b+2]=255^((255^f)*m+(255^c.data[b+2])*(255^f)*l/255)/255}}};I.screenOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let k=0;k<h;k++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*
l/255|0)|0,r=g*l/255|0,q=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=255^((255^g)*q+(255^f)*t+(255^g)*(255^f)*r/255)/m;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=255^((255^g)*q+(255^f)*t+(255^g)*(255^f)*r/255)/m;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=255^((255^g)*q+(255^f)*t+(255^g)*(255^f)*r/255)/m;a.data[b+3]=m}}};I.screenOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let k=
0;k<h;k++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let r=e+(f=a.data[b+3])-(e*f/255|0)|0,q=e*f/255|0,t=e*(255^f)/255|0,v=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=255^((255^e)*t+(255^m)*v+(255^e)*(255^m)*q/255)/r;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=255^((255^e)*t+(255^m)*v+(255^e)*(255^m)*q/255)/r;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=255^((255^e)*t+(255^m)*v+(255^e)*(255^m)*q/255)/r;a.data[b+3]=r}}};I.screenOntoOpaqueFusionWithOpaqueLayerMasked=function(a,
c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r;if(m){let q=255^m;r=a.data[e];a.data[e]=255^((255^r)*q+(255^c.data[e])*(255^r)*m/255)/255;r=a.data[e+1];a.data[e+1]=255^((255^r)*q+(255^c.data[e+1])*(255^r)*m/255)/255;r=a.data[e+2];a.data[e+2]=255^((255^r)*q+(255^c.data[e+2])*(255^r)*m/255)/255}}};I.screenOntoOpaqueFusionWithTransparentLayerMasked=
function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0,q;if(r){let t=255^r;q=a.data[k];a.data[k]=255^((255^q)*t+(255^c.data[k])*(255^q)*r/255)/255;q=a.data[k+1];a.data[k+1]=255^((255^q)*t+(255^c.data[k+1])*(255^q)*r/255)/255;q=a.data[k+2];a.data[k+2]=255^((255^q)*t+(255^c.data[k+2])*(255^q)*r/255)/
255}}};I.screenOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=k)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*h.data[b]/255|0;let r,q;if(l){let t=l+(r=a.data[e+3])-(l*r/255|0)|0,v=l*r/255|0,x=l*(255^r)/255|0,A=(255^l)*r/255|0;l=c.data[e];q=a.data[e];a.data[e]=255^((255^l)*x+(255^q)*A+(255^l)*(255^q)*v/255)/t;l=c.data[e+
1];q=a.data[e+1];a.data[e+1]=255^((255^l)*x+(255^q)*A+(255^l)*(255^q)*v/255)/t;l=c.data[e+2];q=a.data[e+2];a.data[e+2]=255^((255^l)*x+(255^q)*A+(255^l)*(255^q)*v/255)/t;a.data[e+3]=t}}};I.screenOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,k+=e,b+=l)for(let r=0;r<g;r++,k+=4,b++){var f=c.data[k+3]*h.data[b]*d/25500|0;let q,
t;if(f){let v=f+(q=a.data[k+3])-(f*q/255|0)|0,x=f*q/255|0,A=f*(255^q)/255|0,B=(255^f)*q/255|0;f=c.data[k];t=a.data[k];a.data[k]=255^((255^f)*A+(255^t)*B+(255^f)*(255^t)*x/255)/v;f=c.data[k+1];t=a.data[k+1];a.data[k+1]=255^((255^f)*A+(255^t)*B+(255^f)*(255^t)*x/255)/v;f=c.data[k+2];t=a.data[k+2];a.data[k+2]=255^((255^f)*A+(255^t)*B+(255^f)*(255^t)*x/255)/v;a.data[k+3]=v}}};I.lightenOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,
b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3],l,f;if(k){let m=255^k;l=c.data[b];f=a.data[b];a.data[b]=f>=l?f:(f*m+l*k)/255|0;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=f>=l?f:(f*m+l*k)/255|0;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=f>=l?f:(f*m+l*k)/255|0}}};I.lightenOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+
3]*d/100|0,f,m;if(l){let r=255^l;f=c.data[b];m=a.data[b];a.data[b]=m>=f?m:(m*r+f*l)/255|0;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=m>=f?m:(m*r+f*l)/255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=m>=f?m:(m*r+f*l)/255|0}}};I.lightenOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let k=0;k<h;k++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,r=l*(255^
g)/m|0,q=255^r,t=g*(255^l)/m|0,v=255^t;g=c.data[b];f=a.data[b];a.data[b]=(f>=g?g*t+f*v:f*r+g*q)/255|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(f>=g?g*t+f*v:f*r+g*q)/255|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(f>=g?g*t+f*v:f*r+g*q)/255|0;a.data[b+3]=m}}};I.lightenOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let k=0;k<h;k++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;
if(e){let r=e+(f=a.data[b+3])-(e*f/255|0)|0,q=f*(255^e)/r|0,t=255^q,v=e*(255^f)/r|0,x=255^v;e=c.data[b];m=a.data[b];a.data[b]=(m>=e?e*v+m*x:m*q+e*t)/255|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(m>=e?e*v+m*x:m*q+e*t)/255|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(m>=e?e*v+m*x:m*q+e*t)/255|0;a.data[b+3]=r}}};I.lightenOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,
b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r,q;if(m){let t=255^m;r=c.data[e];q=a.data[e];a.data[e]=q>=r?q:(q*t+r*m)/255|0;r=c.data[e+1];q=a.data[e+1];a.data[e+1]=q>=r?q:(q*t+r*m)/255|0;r=c.data[e+2];q=a.data[e+2];a.data[e+2]=q>=r?q:(q*t+r*m)/255|0}}};I.lightenOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,
b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0,q,t;if(r){let v=255^r;q=c.data[k];t=a.data[k];a.data[k]=t>=q?t:(t*v+q*r)/255|0;q=c.data[k+1];t=a.data[k+1];a.data[k+1]=t>=q?t:(t*v+q*r)/255|0;q=c.data[k+2];t=a.data[k+2];a.data[k+2]=t>=q?t:(t*v+q*r)/255|0}}};I.lightenOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,
b.top);for(let f=0;f<d;f++,e+=g,b+=k)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*h.data[b]/255|0;let r,q;if(l){let t=l+(r=a.data[e+3])-(l*r/255|0)|0,v=r*(255^l)/t|0,x=255^v,A=l*(255^r)/t|0,B=255^A;l=c.data[e];q=a.data[e];a.data[e]=(q>=l?l*A+q*B:q*v+l*x)/255|0;l=c.data[e+1];q=a.data[e+1];a.data[e+1]=(q>=l?l*A+q*B:q*v+l*x)/255|0;l=c.data[e+2];q=a.data[e+2];a.data[e+2]=(q>=l?l*A+q*B:q*v+l*x)/255|0;a.data[e+3]=t}}};I.lightenOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=
0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,k+=e,b+=l)for(let r=0;r<g;r++,k+=4,b++){var f=c.data[k+3]*h.data[b]*d/25500|0;let q,t;if(f){let v=f+(q=a.data[k+3])-(f*q/255|0)|0,x=q*(255^f)/v|0,A=255^x,B=f*(255^q)/v|0,y=255^B;f=c.data[k];t=a.data[k];a.data[k]=(t>=f?f*B+t*y:t*x+f*A)/255|0;f=c.data[k+1];t=a.data[k+1];a.data[k+1]=(t>=f?f*B+t*y:t*x+f*A)/255|0;f=c.data[k+2];t=a.data[k+2];a.data[k+2]=
(t>=f?f*B+t*y:t*x+f*A)/255|0;a.data[k+3]=v}}};I.darkenOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3],l,f;if(k){let m=255^k;l=c.data[b];f=a.data[b];a.data[b]=f>=l?(f*m+l*k)/255|0:f;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=f>=l?(f*m+l*k)/255|0:f;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=f>=l?(f*m+l*k)/255|0:f}}};I.darkenOntoOpaqueFusionWithTransparentLayer=
function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let r=255^l;f=c.data[b];m=a.data[b];a.data[b]=m>=f?(m*r+f*l)/255|0:m;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=m>=f?(m*r+f*l)/255|0:m;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=m>=f?(m*r+f*l)/255|0:m}}};I.darkenOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-
h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let k=0;k<h;k++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,r=g*(255^l)/m|0,q=255^r,t=l*(255^g)/m|0,v=255^t;g=c.data[b];f=a.data[b];a.data[b]=(f>=g?f*t+g*v:g*r+f*q)/255|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(f>=g?f*t+g*v:g*r+f*q)/255|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(f>=g?f*t+g*v:g*r+f*q)/255|0;a.data[b+3]=m}}};I.darkenOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let h=
0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let k=0;k<h;k++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let r=e+(f=a.data[b+3])-(e*f/255|0)|0,q=e*(255^f)/r|0,t=255^q,v=f*(255^e)/r|0,x=255^v;e=c.data[b];m=a.data[b];a.data[b]=(m>=e?m*v+e*x:e*q+m*t)/255|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(m>=e?m*v+e*x:e*q+m*t)/255|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(m>=e?m*v+e*x:e*q+m*t)/255|0;a.data[b+3]=r}}};I.darkenOntoOpaqueFusionWithOpaqueLayerMasked=
function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r,q;if(m){let t=255^m;r=c.data[e];q=a.data[e];a.data[e]=q>=r?(q*t+r*m)/255|0:q;r=c.data[e+1];q=a.data[e+1];a.data[e+1]=q>=r?(q*t+r*m)/255|0:q;r=c.data[e+2];q=a.data[e+2];a.data[e+2]=q>=r?(q*t+r*m)/255|0:q}}};I.darkenOntoOpaqueFusionWithTransparentLayerMasked=
function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0,q,t;if(r){let v=255^r;q=c.data[k];t=a.data[k];a.data[k]=t>=q?(t*v+q*r)/255|0:t;q=c.data[k+1];t=a.data[k+1];a.data[k+1]=t>=q?(t*v+q*r)/255|0:t;q=c.data[k+2];t=a.data[k+2];a.data[k+2]=t>=q?(t*v+q*r)/255|0:t}}};I.darkenOntoTransparentFusionWithOpaqueLayerMasked=
function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=k)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*h.data[b]/255|0;let r,q;if(l){let t=l+(r=a.data[e+3])-(l*r/255|0)|0,v=l*(255^r)/t|0,x=255^v,A=r*(255^l)/t|0,B=255^A;l=c.data[e];q=a.data[e];a.data[e]=(q>=l?q*A+l*B:l*v+q*x)/255|0;l=c.data[e+1];q=a.data[e+1];a.data[e+1]=(q>=l?q*A+l*B:l*v+q*x)/255|0;l=c.data[e+2];q=
a.data[e+2];a.data[e+2]=(q>=l?q*A+l*B:l*v+q*x)/255|0;a.data[e+3]=t}}};I.darkenOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,k+=e,b+=l)for(let r=0;r<g;r++,k+=4,b++){var f=c.data[k+3]*h.data[b]*d/25500|0;let q,t;if(f){let v=f+(q=a.data[k+3])-(f*q/255|0)|0,x=f*(255^q)/v|0,A=255^x,B=q*(255^f)/v|0,y=255^B;f=c.data[k];t=a.data[k];
a.data[k]=(t>=f?t*B+f*y:f*x+t*A)/255|0;f=c.data[k+1];t=a.data[k+1];a.data[k+1]=(t>=f?t*B+f*y:f*x+t*A)/255|0;f=c.data[k+2];t=a.data[k+2];a.data[k+2]=(t>=f?t*B+f*y:f*x+t*A)/255|0;a.data[k+3]=v}}};I.dodgeOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3],l,f;if(k){let m=255^k;l=c.data[b];f=a.data[b];a.data[b]=(f*m+k*(255==l?255:Math.min(255,255*
f/(255^l)|0)))/255|0;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=(f*m+k*(255==l?255:Math.min(255,255*f/(255^l)|0)))/255|0;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=(f*m+k*(255==l?255:Math.min(255,255*f/(255^l)|0)))/255|0}}};I.dodgeOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let r=255^l;f=c.data[b];m=a.data[b];a.data[b]=
(m*r+l*(255==f?255:Math.min(255,255*m/(255^f)|0)))/255|0;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=(m*r+l*(255==f?255:Math.min(255,255*m/(255^f)|0)))/255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=(m*r+l*(255==f?255:Math.min(255,255*m/(255^f)|0)))/255|0}}};I.dodgeOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let k=0;k<h;k++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=
a.data[b+3])-(g*l/255|0)|0,r=g*l/255|0,q=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(g*q+f*t+r*(255==g?255:Math.min(255,255*f/(255^g)|0)))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(g*q+f*t+r*(255==g?255:Math.min(255,255*f/(255^g)|0)))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(g*q+f*t+r*(255==g?255:Math.min(255,255*f/(255^g)|0)))/m|0;a.data[b+3]=m}}};I.dodgeOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*
4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let k=0;k<h;k++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let r=e+(f=a.data[b+3])-(e*f/255|0)|0,q=e*f/255|0,t=e*(255^f)/255|0,v=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(e*t+m*v+q*(255==e?255:Math.min(255,255*m/(255^e)|0)))/r|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(e*t+m*v+q*(255==e?255:Math.min(255,255*m/(255^e)|0)))/r|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(e*t+m*v+q*(255==e?255:Math.min(255,255*m/(255^e)|0)))/
r|0;a.data[b+3]=r}}};I.dodgeOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r,q;if(m){let t=255^m;r=c.data[e];q=a.data[e];a.data[e]=(q*t+m*(255==r?255:Math.min(255,255*q/(255^r)|0)))/255|0;r=c.data[e+1];q=a.data[e+1];a.data[e+1]=(q*t+m*(255==r?255:Math.min(255,
255*q/(255^r)|0)))/255|0;r=c.data[e+2];q=a.data[e+2];a.data[e+2]=(q*t+m*(255==r?255:Math.min(255,255*q/(255^r)|0)))/255|0}}};I.dodgeOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0,q,t;if(r){let v=255^r;q=c.data[k];t=a.data[k];a.data[k]=(t*v+r*(255==
q?255:Math.min(255,255*t/(255^q)|0)))/255|0;q=c.data[k+1];t=a.data[k+1];a.data[k+1]=(t*v+r*(255==q?255:Math.min(255,255*t/(255^q)|0)))/255|0;q=c.data[k+2];t=a.data[k+2];a.data[k+2]=(t*v+r*(255==q?255:Math.min(255,255*t/(255^q)|0)))/255|0}}};I.dodgeOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=k)for(let m=0;m<n;m++,e+=
4,b++){var l=c.data[e+3]*h.data[b]/255|0;let r,q;if(l){let t=l+(r=a.data[e+3])-(l*r/255|0)|0,v=l*r/255|0,x=l*(255^r)/255|0,A=(255^l)*r/255|0;l=c.data[e];q=a.data[e];a.data[e]=(l*x+q*A+v*(255==l?255:Math.min(255,255*q/(255^l)|0)))/t|0;l=c.data[e+1];q=a.data[e+1];a.data[e+1]=(l*x+q*A+v*(255==l?255:Math.min(255,255*q/(255^l)|0)))/t|0;l=c.data[e+2];q=a.data[e+2];a.data[e+2]=(l*x+q*A+v*(255==l?255:Math.min(255,255*q/(255^l)|0)))/t|0;a.data[e+3]=t}}};I.dodgeOntoTransparentFusionWithTransparentLayerMasked=
function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,k+=e,b+=l)for(let r=0;r<g;r++,k+=4,b++){var f=c.data[k+3]*h.data[b]*d/25500|0;let q,t;if(f){let v=f+(q=a.data[k+3])-(f*q/255|0)|0,x=f*q/255|0,A=f*(255^q)/255|0,B=(255^f)*q/255|0;f=c.data[k];t=a.data[k];a.data[k]=(f*A+t*B+x*(255==f?255:Math.min(255,255*t/(255^f)|0)))/v|0;f=c.data[k+1];t=a.data[k+1];a.data[k+1]=(f*A+t*B+x*
(255==f?255:Math.min(255,255*t/(255^f)|0)))/v|0;f=c.data[k+2];t=a.data[k+2];a.data[k+2]=(f*A+t*B+x*(255==f?255:Math.min(255,255*t/(255^f)|0)))/v|0;a.data[k+3]=v}}};I.burnOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3],l,f;if(k){let m=255^k;l=c.data[b];f=a.data[b];a.data[b]=(f*m+k*(0==l?0:255^Math.min(255,255*(255^f)/l)))/255|0;l=c.data[b+
1];f=a.data[b+1];a.data[b+1]=(f*m+k*(0==l?0:255^Math.min(255,255*(255^f)/l)))/255|0;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=(f*m+k*(0==l?0:255^Math.min(255,255*(255^f)/l)))/255|0}}};I.burnOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let r=255^l;f=c.data[b];m=a.data[b];a.data[b]=(m*r+l*(0==f?0:255^Math.min(255,255*
(255^m)/f)))/255|0;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=(m*r+l*(0==f?0:255^Math.min(255,255*(255^m)/f)))/255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=(m*r+l*(0==f?0:255^Math.min(255,255*(255^m)/f)))/255|0}}};I.burnOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let k=0;k<h;k++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,r=g*l/255|0,q=g*
(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(g*q+f*t+r*(0==g?0:255^Math.min(255,255*(255^f)/g)))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(g*q+f*t+r*(0==g?0:255^Math.min(255,255*(255^f)/g)))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(g*q+f*t+r*(0==g?0:255^Math.min(255,255*(255^f)/g)))/m|0;a.data[b+3]=m}}};I.burnOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let k=
0;k<h;k++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let r=e+(f=a.data[b+3])-(e*f/255|0)|0,q=e*f/255|0,t=e*(255^f)/255|0,v=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(e*t+m*v+q*(0==e?0:255^Math.min(255,255*(255^m)/e)))/r|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(e*t+m*v+q*(0==e?0:255^Math.min(255,255*(255^m)/e)))/r|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(e*t+m*v+q*(0==e?0:255^Math.min(255,255*(255^m)/e)))/r|0;a.data[b+3]=r}}};I.burnOntoOpaqueFusionWithOpaqueLayerMasked=
function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r,q;if(m){let t=255^m;r=c.data[e];q=a.data[e];a.data[e]=(q*t+m*(0==r?0:255^Math.min(255,255*(255^q)/r)))/255|0;r=c.data[e+1];q=a.data[e+1];a.data[e+1]=(q*t+m*(0==r?0:255^Math.min(255,255*(255^q)/r)))/255|0;r=c.data[e+2];q=a.data[e+2];a.data[e+2]=(q*
t+m*(0==r?0:255^Math.min(255,255*(255^q)/r)))/255|0}}};I.burnOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0,q,t;if(r){let v=255^r;q=c.data[k];t=a.data[k];a.data[k]=(t*v+r*(0==q?0:255^Math.min(255,255*(255^t)/q)))/255|0;q=c.data[k+1];t=a.data[k+1];a.data[k+
1]=(t*v+r*(0==q?0:255^Math.min(255,255*(255^t)/q)))/255|0;q=c.data[k+2];t=a.data[k+2];a.data[k+2]=(t*v+r*(0==q?0:255^Math.min(255,255*(255^t)/q)))/255|0}}};I.burnOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=k)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*h.data[b]/255|0;let r,q;if(l){let t=l+(r=a.data[e+3])-(l*r/
255|0)|0,v=l*r/255|0,x=l*(255^r)/255|0,A=(255^l)*r/255|0;l=c.data[e];q=a.data[e];a.data[e]=(l*x+q*A+v*(0==l?0:255^Math.min(255,255*(255^q)/l)))/t|0;l=c.data[e+1];q=a.data[e+1];a.data[e+1]=(l*x+q*A+v*(0==l?0:255^Math.min(255,255*(255^q)/l)))/t|0;l=c.data[e+2];q=a.data[e+2];a.data[e+2]=(l*x+q*A+v*(0==l?0:255^Math.min(255,255*(255^q)/l)))/t|0;a.data[e+3]=t}}};I.burnOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,
b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,k+=e,b+=l)for(let r=0;r<g;r++,k+=4,b++){var f=c.data[k+3]*h.data[b]*d/25500|0;let q,t;if(f){let v=f+(q=a.data[k+3])-(f*q/255|0)|0,x=f*q/255|0,A=f*(255^q)/255|0,B=(255^f)*q/255|0;f=c.data[k];t=a.data[k];a.data[k]=(f*A+t*B+x*(0==f?0:255^Math.min(255,255*(255^t)/f)))/v|0;f=c.data[k+1];t=a.data[k+1];a.data[k+1]=(f*A+t*B+x*(0==f?0:255^Math.min(255,255*(255^t)/f)))/v|0;f=c.data[k+2];t=a.data[k+2];a.data[k+2]=(f*A+t*B+x*(0==f?0:255^
Math.min(255,255*(255^t)/f)))/v|0;a.data[k+3]=v}}};I.overlayOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3],l,f;if(k){let m=255^k;l=c.data[b];f=a.data[b];a.data[b]=(m*f+(f<=127?2*k*l*f/255:k*(2*(255^l)*(255^f)/255^255)))/255|0;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=(m*f+(f<=127?2*k*l*f/255:k*(2*(255^l)*(255^f)/255^255)))/255|0;l=c.data[b+
2];f=a.data[b+2];a.data[b+2]=(m*f+(f<=127?2*k*l*f/255:k*(2*(255^l)*(255^f)/255^255)))/255|0}}};I.overlayOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let r=255^l;f=c.data[b];m=a.data[b];a.data[b]=(r*m+(m<=127?2*l*f*m/255:l*(2*(255^f)*(255^m)/255^255)))/255|0;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=(r*m+(m<=127?2*
l*f*m/255:l*(2*(255^f)*(255^m)/255^255)))/255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=(r*m+(m<=127?2*l*f*m/255:l*(2*(255^f)*(255^m)/255^255)))/255|0}}};I.overlayOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let k=0;k<h;k++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,r=g*l/255|0,q=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];
a.data[b]=(q*g+t*f+(f<=127?2*r*g*f/255:r*(2*(255^g)*(255^f)/255^255)))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(q*g+t*f+(f<=127?2*r*g*f/255:r*(2*(255^g)*(255^f)/255^255)))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(q*g+t*f+(f<=127?2*r*g*f/255:r*(2*(255^g)*(255^f)/255^255)))/m|0;a.data[b+3]=m}}};I.overlayOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let k=0;k<h;k++,b+=g)for(let l=0;l<
n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let r=e+(f=a.data[b+3])-(e*f/255|0)|0,q=e*f/255|0,t=e*(255^f)/255|0,v=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+v*m+(m<=127?2*q*e*m/255:q*(2*(255^e)*(255^m)/255^255)))/r|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+v*m+(m<=127?2*q*e*m/255:q*(2*(255^e)*(255^m)/255^255)))/r|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+v*m+(m<=127?2*q*e*m/255:q*(2*(255^e)*(255^m)/255^255)))/r|0;a.data[b+3]=r}}};I.overlayOntoOpaqueFusionWithOpaqueLayerMasked=
function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r,q;if(m){let t=255^m;r=c.data[e];q=a.data[e];a.data[e]=(t*q+(q<=127?2*m*r*q/255:m*(2*(255^r)*(255^q)/255^255)))/255|0;r=c.data[e+1];q=a.data[e+1];a.data[e+1]=(t*q+(q<=127?2*m*r*q/255:m*(2*(255^r)*(255^q)/255^255)))/255|0;r=c.data[e+2];q=a.data[e+2];
a.data[e+2]=(t*q+(q<=127?2*m*r*q/255:m*(2*(255^r)*(255^q)/255^255)))/255|0}}};I.overlayOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0,q,t;if(r){let v=255^r;q=c.data[k];t=a.data[k];a.data[k]=(v*t+(t<=127?2*r*q*t/255:r*(2*(255^q)*(255^t)/255^255)))/255|
0;q=c.data[k+1];t=a.data[k+1];a.data[k+1]=(v*t+(t<=127?2*r*q*t/255:r*(2*(255^q)*(255^t)/255^255)))/255|0;q=c.data[k+2];t=a.data[k+2];a.data[k+2]=(v*t+(t<=127?2*r*q*t/255:r*(2*(255^q)*(255^t)/255^255)))/255|0}}};I.overlayOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=k)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*h.data[b]/
255|0;let r,q;if(l){let t=l+(r=a.data[e+3])-(l*r/255|0)|0,v=l*r/255|0,x=l*(255^r)/255|0,A=(255^l)*r/255|0;l=c.data[e];q=a.data[e];a.data[e]=(x*l+A*q+(q<=127?2*v*l*q/255:v*(2*(255^l)*(255^q)/255^255)))/t|0;l=c.data[e+1];q=a.data[e+1];a.data[e+1]=(x*l+A*q+(q<=127?2*v*l*q/255:v*(2*(255^l)*(255^q)/255^255)))/t|0;l=c.data[e+2];q=a.data[e+2];a.data[e+2]=(x*l+A*q+(q<=127?2*v*l*q/255:v*(2*(255^l)*(255^q)/255^255)))/t|0;a.data[e+3]=t}}};I.overlayOntoTransparentFusionWithTransparentLayerMasked=function(a,c,
d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,k+=e,b+=l)for(let r=0;r<g;r++,k+=4,b++){var f=c.data[k+3]*h.data[b]*d/25500|0;let q,t;if(f){let v=f+(q=a.data[k+3])-(f*q/255|0)|0,x=f*q/255|0,A=f*(255^q)/255|0,B=(255^f)*q/255|0;f=c.data[k];t=a.data[k];a.data[k]=(A*f+B*t+(t<=127?2*x*f*t/255:x*(2*(255^f)*(255^t)/255^255)))/v|0;f=c.data[k+1];t=a.data[k+1];a.data[k+1]=(A*f+B*t+(t<=127?2*
x*f*t/255:x*(2*(255^f)*(255^t)/255^255)))/v|0;f=c.data[k+2];t=a.data[k+2];a.data[k+2]=(A*f+B*t+(t<=127?2*x*f*t/255:x*(2*(255^f)*(255^t)/255^255)))/v|0;a.data[k+3]=v}}};I.hardLightOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3],l,f;if(k){let m=255^k;l=c.data[b];f=a.data[b];a.data[b]=(m*f+(l<=127?2*k*l*f/255:k*(2*(255^l)*(255^f)/255^255)))/
255|0;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=(m*f+(l<=127?2*k*l*f/255:k*(2*(255^l)*(255^f)/255^255)))/255|0;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=(m*f+(l<=127?2*k*l*f/255:k*(2*(255^l)*(255^f)/255^255)))/255|0}}};I.hardLightOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let r=255^l;f=c.data[b];m=a.data[b];a.data[b]=
(r*m+(f<=127?2*l*f*m/255:l*(2*(255^f)*(255^m)/255^255)))/255|0;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=(r*m+(f<=127?2*l*f*m/255:l*(2*(255^f)*(255^m)/255^255)))/255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=(r*m+(f<=127?2*l*f*m/255:l*(2*(255^f)*(255^m)/255^255)))/255|0}}};I.hardLightOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let k=0;k<h;k++,b+=4){var g=c.data[b+3];let l,
f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,r=g*l/255|0,q=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(q*g+t*f+(g<=127?2*r*g*f/255:r*(2*(255^g)*(255^f)/255^255)))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(q*g+t*f+(g<=127?2*r*g*f/255:r*(2*(255^g)*(255^f)/255^255)))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(q*g+t*f+(g<=127?2*r*g*f/255:r*(2*(255^g)*(255^f)/255^255)))/m|0;a.data[b+3]=m}}};I.hardLightOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),
n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let k=0;k<h;k++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let r=e+(f=a.data[b+3])-(e*f/255|0)|0,q=e*f/255|0,t=e*(255^f)/255|0,v=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+v*m+(e<=127?2*q*e*m/255:q*(2*(255^e)*(255^m)/255^255)))/r|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+v*m+(e<=127?2*q*e*m/255:q*(2*(255^e)*(255^m)/255^255)))/r|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+v*m+(e<=
127?2*q*e*m/255:q*(2*(255^e)*(255^m)/255^255)))/r|0;a.data[b+3]=r}}};I.hardLightOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r,q;if(m){let t=255^m;r=c.data[e];q=a.data[e];a.data[e]=(t*q+(r<=127?2*m*r*q/255:m*(2*(255^r)*(255^q)/255^255)))/255|0;r=c.data[e+
1];q=a.data[e+1];a.data[e+1]=(t*q+(r<=127?2*m*r*q/255:m*(2*(255^r)*(255^q)/255^255)))/255|0;r=c.data[e+2];q=a.data[e+2];a.data[e+2]=(t*q+(r<=127?2*m*r*q/255:m*(2*(255^r)*(255^q)/255^255)))/255|0}}};I.hardLightOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/
25500|0,q,t;if(r){let v=255^r;q=c.data[k];t=a.data[k];a.data[k]=(v*t+(q<=127?2*r*q*t/255:r*(2*(255^q)*(255^t)/255^255)))/255|0;q=c.data[k+1];t=a.data[k+1];a.data[k+1]=(v*t+(q<=127?2*r*q*t/255:r*(2*(255^q)*(255^t)/255^255)))/255|0;q=c.data[k+2];t=a.data[k+2];a.data[k+2]=(v*t+(q<=127?2*r*q*t/255:r*(2*(255^q)*(255^t)/255^255)))/255|0}}};I.hardLightOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),
k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=k)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*h.data[b]/255|0;let r,q;if(l){let t=l+(r=a.data[e+3])-(l*r/255|0)|0,v=l*r/255|0,x=l*(255^r)/255|0,A=(255^l)*r/255|0;l=c.data[e];q=a.data[e];a.data[e]=(x*l+A*q+(l<=127?2*v*l*q/255:v*(2*(255^l)*(255^q)/255^255)))/t|0;l=c.data[e+1];q=a.data[e+1];a.data[e+1]=(x*l+A*q+(l<=127?2*v*l*q/255:v*(2*(255^l)*(255^q)/255^255)))/t|0;l=c.data[e+2];q=a.data[e+2];a.data[e+2]=(x*l+A*q+(l<=127?
2*v*l*q/255:v*(2*(255^l)*(255^q)/255^255)))/t|0;a.data[e+3]=t}}};I.hardLightOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,k+=e,b+=l)for(let r=0;r<g;r++,k+=4,b++){var f=c.data[k+3]*h.data[b]*d/25500|0;let q,t;if(f){let v=f+(q=a.data[k+3])-(f*q/255|0)|0,x=f*q/255|0,A=f*(255^q)/255|0,B=(255^f)*q/255|0;f=c.data[k];t=a.data[k];
a.data[k]=(A*f+B*t+(f<=127?2*x*f*t/255:x*(2*(255^f)*(255^t)/255^255)))/v|0;f=c.data[k+1];t=a.data[k+1];a.data[k+1]=(A*f+B*t+(f<=127?2*x*f*t/255:x*(2*(255^f)*(255^t)/255^255)))/v|0;f=c.data[k+2];t=a.data[k+2];a.data[k+2]=(A*f+B*t+(f<=127?2*x*f*t/255:x*(2*(255^f)*(255^t)/255^255)))/v|0;a.data[k+3]=v}}};I.softLightOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=
4){let k=c.data[b+3],l,f;if(k){let m=255^k;l=c.data[b];f=a.data[b];a.data[b]=(m*f+k*(l<=127?((2*l-255)*yb[f]/255|0)+f:((2*l-255)*zb[f]/255|0)+f))/255|0;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=(m*f+k*(l<=127?((2*l-255)*yb[f]/255|0)+f:((2*l-255)*zb[f]/255|0)+f))/255|0;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=(m*f+k*(l<=127?((2*l-255)*yb[f]/255|0)+f:((2*l-255)*zb[f]/255|0)+f))/255|0}}};I.softLightOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-
n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let r=255^l;f=c.data[b];m=a.data[b];a.data[b]=(r*m+l*(f<=127?((2*f-255)*yb[m]/255|0)+m:((2*f-255)*zb[m]/255|0)+m))/255|0;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=(r*m+l*(f<=127?((2*f-255)*yb[m]/255|0)+m:((2*f-255)*zb[m]/255|0)+m))/255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=(r*m+l*(f<=127?((2*f-255)*yb[m]/255|0)+m:((2*f-255)*zb[m]/255|0)+m))/255|0}}};I.softLightOntoTransparentFusionWithOpaqueLayer=
function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let k=0;k<h;k++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,r=g*l/255|0,q=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(q*g+t*f+(g<=127?r*(((2*g-255)*yb[f]/255|0)+f):r*(((2*g-255)*zb[f]/255|0)+f)))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(q*g+t*f+(g<=127?r*(((2*g-255)*yb[f]/255|0)+f):r*(((2*g-255)*zb[f]/
255|0)+f)))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(q*g+t*f+(g<=127?r*(((2*g-255)*yb[f]/255|0)+f):r*(((2*g-255)*zb[f]/255|0)+f)))/m|0;a.data[b+3]=m}}};I.softLightOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let k=0;k<h;k++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let r=e+(f=a.data[b+3])-(e*f/255|0)|0,q=e*f/255|0,t=e*(255^f)/255|0,v=(255^e)*f/255|0;e=c.data[b];
m=a.data[b];a.data[b]=(t*e+v*m+(e<=127?q*(((2*e-255)*yb[m]/255|0)+m):q*(((2*e-255)*zb[m]/255|0)+m)))/r|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+v*m+(e<=127?q*(((2*e-255)*yb[m]/255|0)+m):q*(((2*e-255)*zb[m]/255|0)+m)))/r|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+v*m+(e<=127?q*(((2*e-255)*yb[m]/255|0)+m):q*(((2*e-255)*zb[m]/255|0)+m)))/r|0;a.data[b+3]=r}}};I.softLightOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,
b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r,q;if(m){let t=255^m;r=c.data[e];q=a.data[e];a.data[e]=(t*q+m*(r<=127?((2*r-255)*yb[q]/255|0)+q:((2*r-255)*zb[q]/255|0)+q))/255|0;r=c.data[e+1];q=a.data[e+1];a.data[e+1]=(t*q+m*(r<=127?((2*r-255)*yb[q]/255|0)+q:((2*r-255)*zb[q]/255|0)+q))/255|0;r=c.data[e+2];q=a.data[e+2];a.data[e+2]=(t*q+m*(r<=127?((2*r-255)*yb[q]/255|0)+q:((2*r-255)*zb[q]/255|0)+q))/
255|0}}};I.softLightOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0,q,t;if(r){let v=255^r;q=c.data[k];t=a.data[k];a.data[k]=(v*t+r*(q<=127?((2*q-255)*yb[t]/255|0)+t:((2*q-255)*zb[t]/255|0)+t))/255|0;q=c.data[k+1];t=a.data[k+1];a.data[k+1]=(v*t+r*(q<=
127?((2*q-255)*yb[t]/255|0)+t:((2*q-255)*zb[t]/255|0)+t))/255|0;q=c.data[k+2];t=a.data[k+2];a.data[k+2]=(v*t+r*(q<=127?((2*q-255)*yb[t]/255|0)+t:((2*q-255)*zb[t]/255|0)+t))/255|0}}};I.softLightOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=k)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*h.data[b]/255|0;let r,q;if(l){let t=
l+(r=a.data[e+3])-(l*r/255|0)|0,v=l*r/255|0,x=l*(255^r)/255|0,A=(255^l)*r/255|0;l=c.data[e];q=a.data[e];a.data[e]=(x*l+A*q+(l<=127?v*(((2*l-255)*yb[q]/255|0)+q):v*(((2*l-255)*zb[q]/255|0)+q)))/t|0;l=c.data[e+1];q=a.data[e+1];a.data[e+1]=(x*l+A*q+(l<=127?v*(((2*l-255)*yb[q]/255|0)+q):v*(((2*l-255)*zb[q]/255|0)+q)))/t|0;l=c.data[e+2];q=a.data[e+2];a.data[e+2]=(x*l+A*q+(l<=127?v*(((2*l-255)*yb[q]/255|0)+q):v*(((2*l-255)*zb[q]/255|0)+q)))/t|0;a.data[e+3]=t}}};I.softLightOntoTransparentFusionWithTransparentLayerMasked=
function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,k+=e,b+=l)for(let r=0;r<g;r++,k+=4,b++){var f=c.data[k+3]*h.data[b]*d/25500|0;let q,t;if(f){let v=f+(q=a.data[k+3])-(f*q/255|0)|0,x=f*q/255|0,A=f*(255^q)/255|0,B=(255^f)*q/255|0;f=c.data[k];t=a.data[k];a.data[k]=(A*f+B*t+(f<=127?x*(((2*f-255)*yb[t]/255|0)+t):x*(((2*f-255)*zb[t]/255|0)+t)))/v|0;f=c.data[k+1];t=a.data[k+1];
a.data[k+1]=(A*f+B*t+(f<=127?x*(((2*f-255)*yb[t]/255|0)+t):x*(((2*f-255)*zb[t]/255|0)+t)))/v|0;f=c.data[k+2];t=a.data[k+2];a.data[k+2]=(A*f+B*t+(f<=127?x*(((2*f-255)*yb[t]/255|0)+t):x*(((2*f-255)*zb[t]/255|0)+t)))/v|0;a.data[k+3]=v}}};I.vividLightOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3],l,f;if(k){let m=255^k;l=c.data[b];f=a.data[b];
a.data[b]=(m*f+(l<=127?k*(0==l?0:255-Math.min(255,(255-f)*255/(2*l)|0)):k*(255==l?255:Math.min(255,255*f/(2*(255-l))|0))))/255|0;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=(m*f+(l<=127?k*(0==l?0:255-Math.min(255,(255-f)*255/(2*l)|0)):k*(255==l?255:Math.min(255,255*f/(2*(255-l))|0))))/255|0;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=(m*f+(l<=127?k*(0==l?0:255-Math.min(255,(255-f)*255/(2*l)|0)):k*(255==l?255:Math.min(255,255*f/(2*(255-l))|0))))/255|0}}};I.vividLightOntoOpaqueFusionWithTransparentLayer=function(a,
c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let r=255^l;f=c.data[b];m=a.data[b];a.data[b]=(r*m+(f<=127?l*(0==f?0:255-Math.min(255,(255-m)*255/(2*f)|0)):l*(255==f?255:Math.min(255,255*m/(2*(255-f))|0))))/255|0;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=(r*m+(f<=127?l*(0==f?0:255-Math.min(255,(255-m)*255/(2*f)|0)):l*(255==f?255:Math.min(255,255*m/(2*(255-f))|0))))/
255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=(r*m+(f<=127?l*(0==f?0:255-Math.min(255,(255-m)*255/(2*f)|0)):l*(255==f?255:Math.min(255,255*m/(2*(255-f))|0))))/255|0}}};I.vividLightOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let k=0;k<h;k++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,r=g*l/255|0,q=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];
f=a.data[b];a.data[b]=(q*g+t*f+(g<=127?r*(0==g?0:255-Math.min(255,(255-f)*255/(2*g)|0)):r*(255==g?255:Math.min(255,255*f/(2*(255-g))|0))))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(q*g+t*f+(g<=127?r*(0==g?0:255-Math.min(255,(255-f)*255/(2*g)|0)):r*(255==g?255:Math.min(255,255*f/(2*(255-g))|0))))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(q*g+t*f+(g<=127?r*(0==g?0:255-Math.min(255,(255-f)*255/(2*g)|0)):r*(255==g?255:Math.min(255,255*f/(2*(255-g))|0))))/m|0;a.data[b+3]=m}}};I.vividLightOntoTransparentFusionWithTransparentLayer=
function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let k=0;k<h;k++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let r=e+(f=a.data[b+3])-(e*f/255|0)|0,q=e*f/255|0,t=e*(255^f)/255|0,v=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+v*m+(e<=127?q*(0==e?0:255-Math.min(255,(255-m)*255/(2*e)|0)):q*(255==e?255:Math.min(255,255*m/(2*(255-e))|0))))/r|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+v*m+(e<=127?q*(0==
e?0:255-Math.min(255,(255-m)*255/(2*e)|0)):q*(255==e?255:Math.min(255,255*m/(2*(255-e))|0))))/r|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+v*m+(e<=127?q*(0==e?0:255-Math.min(255,(255-m)*255/(2*e)|0)):q*(255==e?255:Math.min(255,255*m/(2*(255-e))|0))))/r|0;a.data[b+3]=r}}};I.vividLightOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,
e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r,q;if(m){let t=255^m;r=c.data[e];q=a.data[e];a.data[e]=(t*q+(r<=127?m*(0==r?0:255-Math.min(255,(255-q)*255/(2*r)|0)):m*(255==r?255:Math.min(255,255*q/(2*(255-r))|0))))/255|0;r=c.data[e+1];q=a.data[e+1];a.data[e+1]=(t*q+(r<=127?m*(0==r?0:255-Math.min(255,(255-q)*255/(2*r)|0)):m*(255==r?255:Math.min(255,255*q/(2*(255-r))|0))))/255|0;r=c.data[e+2];q=a.data[e+2];a.data[e+2]=(t*q+(r<=127?m*(0==r?0:255-Math.min(255,(255-q)*255/(2*
r)|0)):m*(255==r?255:Math.min(255,255*q/(2*(255-r))|0))))/255|0}}};I.vividLightOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0,q,t;if(r){let v=255^r;q=c.data[k];t=a.data[k];a.data[k]=(v*t+(q<=127?r*(0==q?0:255-Math.min(255,(255-t)*255/(2*q)|0)):r*(255==
q?255:Math.min(255,255*t/(2*(255-q))|0))))/255|0;q=c.data[k+1];t=a.data[k+1];a.data[k+1]=(v*t+(q<=127?r*(0==q?0:255-Math.min(255,(255-t)*255/(2*q)|0)):r*(255==q?255:Math.min(255,255*t/(2*(255-q))|0))))/255|0;q=c.data[k+2];t=a.data[k+2];a.data[k+2]=(v*t+(q<=127?r*(0==q?0:255-Math.min(255,(255-t)*255/(2*q)|0)):r*(255==q?255:Math.min(255,255*t/(2*(255-q))|0))))/255|0}}};I.vividLightOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,
e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=k)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*h.data[b]/255|0;let r,q;if(l){let t=l+(r=a.data[e+3])-(l*r/255|0)|0,v=l*r/255|0,x=l*(255^r)/255|0,A=(255^l)*r/255|0;l=c.data[e];q=a.data[e];a.data[e]=(x*l+A*q+(l<=127?v*(0==l?0:255-Math.min(255,(255-q)*255/(2*l)|0)):v*(255==l?255:Math.min(255,255*q/(2*(255-l))|0))))/t|0;l=c.data[e+1];q=a.data[e+1];a.data[e+1]=(x*l+A*q+(l<=127?v*(0==l?0:255-
Math.min(255,(255-q)*255/(2*l)|0)):v*(255==l?255:Math.min(255,255*q/(2*(255-l))|0))))/t|0;l=c.data[e+2];q=a.data[e+2];a.data[e+2]=(x*l+A*q+(l<=127?v*(0==l?0:255-Math.min(255,(255-q)*255/(2*l)|0)):v*(255==l?255:Math.min(255,255*q/(2*(255-l))|0))))/t|0;a.data[e+3]=t}}};I.vividLightOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let m=0;m<
n;m++,k+=e,b+=l)for(let r=0;r<g;r++,k+=4,b++){var f=c.data[k+3]*h.data[b]*d/25500|0;let q,t;if(f){let v=f+(q=a.data[k+3])-(f*q/255|0)|0,x=f*q/255|0,A=f*(255^q)/255|0,B=(255^f)*q/255|0;f=c.data[k];t=a.data[k];a.data[k]=(A*f+B*t+(f<=127?x*(0==f?0:255-Math.min(255,(255-t)*255/(2*f)|0)):x*(255==f?255:Math.min(255,255*t/(2*(255-f))|0))))/v|0;f=c.data[k+1];t=a.data[k+1];a.data[k+1]=(A*f+B*t+(f<=127?x*(0==f?0:255-Math.min(255,(255-t)*255/(2*f)|0)):x*(255==f?255:Math.min(255,255*t/(2*(255-f))|0))))/v|0;f=
c.data[k+2];t=a.data[k+2];a.data[k+2]=(A*f+B*t+(f<=127?x*(0==f?0:255-Math.min(255,(255-t)*255/(2*f)|0)):x*(255==f?255:Math.min(255,255*t/(2*(255-f))|0))))/v|0;a.data[k+3]=v}}};I.linearLightOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3],l;if(k){let f=255^k;l=a.data[b];a.data[b]=(f*l+k*Math.min(255,Math.max(0,l+2*c.data[b]-255)))/255|0;l=
a.data[b+1];a.data[b+1]=(f*l+k*Math.min(255,Math.max(0,l+2*c.data[b+1]-255)))/255|0;l=a.data[b+2];a.data[b+2]=(f*l+k*Math.min(255,Math.max(0,l+2*c.data[b+2]-255)))/255|0}}};I.linearLightOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f;if(l){let m=255^l;f=a.data[b];a.data[b]=(m*f+l*Math.min(255,Math.max(0,f+2*c.data[b]-255)))/
255|0;f=a.data[b+1];a.data[b+1]=(m*f+l*Math.min(255,Math.max(0,f+2*c.data[b+1]-255)))/255|0;f=a.data[b+2];a.data[b+2]=(m*f+l*Math.min(255,Math.max(0,f+2*c.data[b+2]-255)))/255|0}}};I.linearLightOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let k=0;k<h;k++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,r=g*l/255|0,q=g*(255^l)/255|0,t=(255^g)*
l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(q*g+t*f+r*Math.min(255,Math.max(0,f+2*g-255)))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(q*g+t*f+r*Math.min(255,Math.max(0,f+2*g-255)))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(q*g+t*f+r*Math.min(255,Math.max(0,f+2*g-255)))/m|0;a.data[b+3]=m}}};I.linearLightOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let k=0;k<h;k++,b+=g)for(let l=0;l<n;l++,
b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let r=e+(f=a.data[b+3])-(e*f/255|0)|0,q=e*f/255|0,t=e*(255^f)/255|0,v=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+v*m+q*Math.min(255,Math.max(0,m+2*e-255)))/r|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+v*m+q*Math.min(255,Math.max(0,m+2*e-255)))/r|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+v*m+q*Math.min(255,Math.max(0,m+2*e-255)))/r|0;a.data[b+3]=r}}};I.linearLightOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();
let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r;if(m){let q=255^m;r=a.data[e];a.data[e]=(q*r+m*Math.min(255,Math.max(0,r+2*c.data[e]-255)))/255|0;r=a.data[e+1];a.data[e+1]=(q*r+m*Math.min(255,Math.max(0,r+2*c.data[e+1]-255)))/255|0;r=a.data[e+2];a.data[e+2]=(q*r+m*Math.min(255,Math.max(0,r+2*c.data[e+2]-255)))/255|0}}};I.linearLightOntoOpaqueFusionWithTransparentLayerMasked=
function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0,q;if(r){let t=255^r;q=a.data[k];a.data[k]=(t*q+r*Math.min(255,Math.max(0,q+2*c.data[k]-255)))/255|0;q=a.data[k+1];a.data[k+1]=(t*q+r*Math.min(255,Math.max(0,q+2*c.data[k+1]-255)))/255|0;q=a.data[k+2];a.data[k+2]=(t*q+r*Math.min(255,Math.max(0,q+
2*c.data[k+2]-255)))/255|0}}};I.linearLightOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,e+=g,b+=k)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*h.data[b]/255|0;let r,q;if(l){let t=l+(r=a.data[e+3])-(l*r/255|0)|0,v=l*r/255|0,x=l*(255^r)/255|0,A=(255^l)*r/255|0;l=c.data[e];q=a.data[e];a.data[e]=(x*l+A*q+v*Math.min(255,Math.max(0,
q+2*l-255)))/t|0;l=c.data[e+1];q=a.data[e+1];a.data[e+1]=(x*l+A*q+v*Math.min(255,Math.max(0,q+2*l-255)))/t|0;l=c.data[e+2];q=a.data[e+2];a.data[e+2]=(x*l+A*q+v*Math.min(255,Math.max(0,q+2*l-255)))/t|0;a.data[e+3]=t}}};I.linearLightOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,k+=e,b+=l)for(let r=0;r<g;r++,k+=4,b++){var f=
c.data[k+3]*h.data[b]*d/25500|0;let q,t;if(f){let v=f+(q=a.data[k+3])-(f*q/255|0)|0,x=f*q/255|0,A=f*(255^q)/255|0,B=(255^f)*q/255|0;f=c.data[k];t=a.data[k];a.data[k]=(A*f+B*t+x*Math.min(255,Math.max(0,t+2*f-255)))/v|0;f=c.data[k+1];t=a.data[k+1];a.data[k+1]=(A*f+B*t+x*Math.min(255,Math.max(0,t+2*f-255)))/v|0;f=c.data[k+2];t=a.data[k+2];a.data[k+2]=(A*f+B*t+x*Math.min(255,Math.max(0,t+2*f-255)))/v|0;a.data[k+3]=v}}};I.pinLightOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=
0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3],l,f;if(k){let m=255^k;l=c.data[b];f=a.data[b];a.data[b]=(m*f+k*(f>=2*l?2*l:f<=2*l-255?2*l-255:f))/255|0;l=c.data[b+1];f=a.data[b+1];a.data[b+1]=(m*f+k*(f>=2*l?2*l:f<=2*l-255?2*l-255:f))/255|0;l=c.data[b+2];f=a.data[b+2];a.data[b+2]=(m*f+k*(f>=2*l?2*l:f<=2*l-255?2*l-255:f))/255|0}}};I.pinLightOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),
n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f,m;if(l){let r=255^l;f=c.data[b];m=a.data[b];a.data[b]=(r*m+l*(m>=2*f?2*f:m<=2*f-255?2*f-255:m))/255|0;f=c.data[b+1];m=a.data[b+1];a.data[b+1]=(r*m+l*(m>=2*f?2*f:m<=2*f-255?2*f-255:m))/255|0;f=c.data[b+2];m=a.data[b+2];a.data[b+2]=(r*m+l*(m>=2*f?2*f:m<=2*f-255?2*f-255:m))/255|0}}};I.pinLightOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();
let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let k=0;k<h;k++,b+=4){var g=c.data[b+3];let l,f;if(g){let m=g+(l=a.data[b+3])-(g*l/255|0)|0,r=g*l/255|0,q=g*(255^l)/255|0,t=(255^g)*l/255|0;g=c.data[b];f=a.data[b];a.data[b]=(q*g+t*f+r*(f>=2*g?2*g:f<=2*g-255?2*g-255:f))/m|0;g=c.data[b+1];f=a.data[b+1];a.data[b+1]=(q*g+t*f+r*(f>=2*g?2*g:f<=2*g-255?2*g-255:f))/m|0;g=c.data[b+2];f=a.data[b+2];a.data[b+2]=(q*g+t*f+r*(f>=2*g?2*g:f<=2*g-255?2*g-255:f))/
m|0;a.data[b+3]=m}}};I.pinLightOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let k=0;k<h;k++,b+=g)for(let l=0;l<n;l++,b+=4){var e=c.data[b+3]*d/100|0;let f,m;if(e){let r=e+(f=a.data[b+3])-(e*f/255|0)|0,q=e*f/255|0,t=e*(255^f)/255|0,v=(255^e)*f/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+v*m+q*(m>=2*e?2*e:m<=2*e-255?2*e-255:m))/r|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+v*m+q*(m>=2*e?
2*e:m<=2*e-255?2*e-255:m))/r|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+v*m+q*(m>=2*e?2*e:m<=2*e-255?2*e-255:m))/r|0;a.data[b+3]=r}}};I.pinLightOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0,r,q;if(m){let t=255^m;r=c.data[e];q=a.data[e];a.data[e]=(t*q+m*
(q>=2*r?2*r:q<=2*r-255?2*r-255:q))/255|0;r=c.data[e+1];q=a.data[e+1];a.data[e+1]=(t*q+m*(q>=2*r?2*r:q<=2*r-255?2*r-255:q))/255|0;r=c.data[e+2];q=a.data[e+2];a.data[e+2]=(t*q+m*(q>=2*r?2*r:q<=2*r-255?2*r-255:q))/255|0}}};I.pinLightOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+
3]*h.data[b]*d/25500|0,q,t;if(r){let v=255^r;q=c.data[k];t=a.data[k];a.data[k]=(v*t+r*(t>=2*q?2*q:t<=2*q-255?2*q-255:t))/255|0;q=c.data[k+1];t=a.data[k+1];a.data[k+1]=(v*t+r*(t>=2*q?2*q:t<=2*q-255?2*q-255:t))/255|0;q=c.data[k+2];t=a.data[k+2];a.data[k+2]=(v*t+r*(t>=2*q?2*q:t<=2*q-255?2*q-255:t))/255|0}}};I.pinLightOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,
b.top);for(let f=0;f<d;f++,e+=g,b+=k)for(let m=0;m<n;m++,e+=4,b++){var l=c.data[e+3]*h.data[b]/255|0;let r,q;if(l){let t=l+(r=a.data[e+3])-(l*r/255|0)|0,v=l*r/255|0,x=l*(255^r)/255|0,A=(255^l)*r/255|0;l=c.data[e];q=a.data[e];a.data[e]=(x*l+A*q+v*(q>=2*l?2*l:q<=2*l-255?2*l-255:q))/t|0;l=c.data[e+1];q=a.data[e+1];a.data[e+1]=(x*l+A*q+v*(q>=2*l?2*l:q<=2*l-255?2*l-255:q))/t|0;l=c.data[e+2];q=a.data[e+2];a.data[e+2]=(x*l+A*q+v*(q>=2*l?2*l:q<=2*l-255?2*l-255:q))/t|0;a.data[e+3]=t}}};I.pinLightOntoTransparentFusionWithTransparentLayerMasked=
function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,k+=e,b+=l)for(let r=0;r<g;r++,k+=4,b++){var f=c.data[k+3]*h.data[b]*d/25500|0;let q,t;if(f){let v=f+(q=a.data[k+3])-(f*q/255|0)|0,x=f*q/255|0,A=f*(255^q)/255|0,B=(255^f)*q/255|0;f=c.data[k];t=a.data[k];a.data[k]=(A*f+B*t+x*(t>=2*f?2*f:t<=2*f-255?2*f-255:t))/v|0;f=c.data[k+1];t=a.data[k+1];a.data[k+1]=(A*f+B*t+x*(t>=2*f?2*
f:t<=2*f-255?2*f-255:t))/v|0;f=c.data[k+2];t=a.data[k+2];a.data[k+2]=(A*f+B*t+x*(t>=2*f?2*f:t<=2*f-255?2*f-255:t))/v|0;a.data[k+3]=v}}};I.passthroughOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3],f=d/100,m=1-f,r=l*f+255*m;a.data[b]=(c.data[b]*l*f+255*a.data[b]*m)/r|0;a.data[b+1]=(c.data[b+1]*l*f+255*a.data[b+1]*m)/r|0;a.data[b+2]=(c.data[b+
2]*l*f+255*a.data[b+2]*m)/r|0;a.data[b+3]=r}};I.passthroughOntoOpaqueFusionWithOpaqueLayer=I.passthroughOntoOpaqueFusionWithTransparentLayer;I.passthroughOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3],f=a.data[b+3],m=d/100,r=1-m,q=l*m+f*r;a.data[b]=(c.data[b]*l*m+a.data[b]*f*r)/q|0;a.data[b+1]=(c.data[b+1]*l*m+a.data[b+1]*f*r)/
q|0;a.data[b+2]=(c.data[b+2]*l*m+a.data[b+2]*f*r)/q|0;a.data[b+3]=q}};I.passthroughOntoTransparentFusionWithOpaqueLayer=I.passthroughOntoTransparentFusionWithTransparentLayer;I.passthroughOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3],q=h.data[b]*d/25500,t=1-q,v=r*q+255*
t;a.data[k]=(c.data[k]*r*q+255*a.data[k]*t)/v|0;a.data[k+1]=(c.data[k+1]*r*q+255*a.data[k+1]*t)/v|0;a.data[k+2]=(c.data[k+2]*r*q+255*a.data[k+2]*t)/v|0;a.data[k+3]=v}};I.passthroughOntoOpaqueFusionWithOpaqueLayerMasked=I.passthroughOntoOpaqueFusionWithTransparentLayerMasked;I.passthroughOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=
0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3],q=a.data[k+3],t=h.data[b]*d/25500,v=1-t,x=r*t+q*v;a.data[k]=(c.data[k]*r*t+a.data[k]*q*v)/x|0;a.data[k+1]=(c.data[k+1]*r*t+a.data[k+1]*q*v)/x|0;a.data[k+2]=(c.data[k+2]*r*t+a.data[k+2]*q*v)/x|0;a.data[k+3]=x}};I.passthroughOntoTransparentFusionWithOpaqueLayerMasked=I.passthroughOntoTransparentFusionWithTransparentLayerMasked;I.replaceOntoFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-
n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0;a.data[b]=c.data[b];a.data[b+1]=c.data[b+1];a.data[b+2]=c.data[b+2];a.data[b+3]=l}};I.replaceOntoFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3];a.data[b]=c.data[b];a.data[b+1]=c.data[b+1];a.data[b+2]=c.data[b+2];a.data[b+3]=k}};I.replaceOntoFusionWithTransparentLayerMasked=
function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++){let r=c.data[k+3]*h.data[b]*d/25500|0;a.data[k]=c.data[k];a.data[k+1]=c.data[k+1];a.data[k+2]=c.data[k+2];a.data[k+3]=r}};I.replaceOntoFusionWithOpaqueLayerMasked=function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-
n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++){let m=c.data[e+3]*h.data[b]/255|0;a.data[e]=c.data[e];a.data[e+1]=c.data[e+1];a.data[e+2]=c.data[e+2];a.data[e+3]=m}};I.replaceAlphaOntoFusionWithTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4)a.data[b+3]=c.data[b+3]*d/100|0};I.replaceAlphaOntoFusionWithTransparentLayerMasked=
function(a,c,d,b,h){let n=0|b.getHeight(),g=0|b.getWidth(),e=(c.width-g)*4|0,k=0|c.offsetOfPixel(b.left,b.top),l=h.width-g|0;b=0|h.offsetOfPixel(b.left,b.top);for(let f=0;f<n;f++,k+=e,b+=l)for(let m=0;m<g;m++,k+=4,b++)a.data[k+3]=c.data[k+3]*h.data[b]*d/25500|0};I.replaceAlphaOntoFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4)a.data[b+3]=c.data[b+3]};I.replaceAlphaOntoFusionWithOpaqueLayerMasked=
function(a,c,d,b,h){d=0|b.getHeight();let n=0|b.getWidth(),g=(c.width-n)*4|0,e=0|c.offsetOfPixel(b.left,b.top),k=h.width-n|0;b=0|h.offsetOfPixel(b.left,b.top);for(let l=0;l<d;l++,e+=g,b+=k)for(let f=0;f<n;f++,e+=4,b++)a.data[e+3]=c.data[e+3]*h.data[b]/255|0};I.upgradeMultiplyOfOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let h=0|b.getWidth(),n=(c.width-h)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let g=0;g<d;g++,b+=n)for(let e=0;e<h;e++,b+=4){let k=c.data[b+3],l,f;k&&(l=c.data[b],f=a.data[b],c.data[b]=
l+Math.ceil((255-l)*f*k%65025/(f*k)),l=c.data[b+1],f=a.data[b+1],c.data[b+1]=l+Math.ceil((255-l)*f*k%65025/(f*k)),l=c.data[b+2],f=a.data[b+2],c.data[b+2]=l+Math.ceil((255-l)*f*k%65025/(f*k)))}};I.upgradeMultiplyOfTransparentLayer=function(a,c,d,b){let h=0|b.getHeight(),n=0|b.getWidth(),g=(c.width-n)*4|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<h;e++,b+=g)for(let k=0;k<n;k++,b+=4){let l=c.data[b+3]*d/100|0,f,m;l&&(f=c.data[b],m=a.data[b],c.data[b]=f+Math.ceil((255-f)*m*l%65025/(m*l)),f=c.data[b+
1],m=a.data[b+1],c.data[b+1]=f+Math.ceil((255-f)*m*l%65025/(m*l)),f=c.data[b+2],m=a.data[b+2],c.data[b+2]=f+Math.ceil((255-f)*m*l%65025/(m*l)))}};I._normalFuseImageOntoImageAtPosition=function(a,c,d,b,h,n){d=0|b.getHeight();let g=0|b.getWidth(),e=(c.width-g)*4|0;b=0|c.offsetOfPixel(b.left,b.top);let k=(a.width-g)*4|0;h=0|a.offsetOfPixel(h,n);for(n=0;n<d;n++,b+=e,h+=k)for(let f=0;f<g;f++,b+=4,h+=4){var l=c.data[b+3];let m;if(l){let r=l+(m=a.data[h+3])-(l*m/255|0)|0;l=255*l/r|0;let q=255-l;a.data[h]=
(c.data[b]*l+a.data[h]*q)/255|0;a.data[h+1]=(c.data[b+1]*l+a.data[h+1]*q)/255|0;a.data[h+2]=(c.data[b+2]*l+a.data[h+2]*q)/255|0;a.data[h+3]=r}}};I.LM_NORMAL=0;I.LM_MULTIPLY=1;I.LM_ADD=2;I.LM_SCREEN=3;I.LM_LIGHTEN=4;I.LM_DARKEN=5;I.LM_SUBTRACT=6;I.LM_DODGE=7;I.LM_BURN=8;I.LM_OVERLAY=9;I.LM_HARDLIGHT=10;I.LM_SOFTLIGHT=11;I.LM_VIVIDLIGHT=12;I.LM_LINEARLIGHT=13;I.LM_PINLIGHT=14;I.LM_PASSTHROUGH=15;I.LM_MULTIPLY2=16;I.LM_FIRST=0;I.LM_LAST=16;I.LM_LAST_CHIBIPAINT=I.LM_PINLIGHT;I.BLEND_MODE_CODENAMES="normal multiply add screen lighten darken subtract dodge burn overlay hardLight softLight vividLight linearLight pinLight passthrough multiply2".split(" ");
I.BLEND_MODE_DISPLAY_NAMES="Normal;Multiply;Add;Screen;Lighten;Darken;Subtract;Dodge;Burn;Overlay;Hard Light;Soft Light;Vivid Light;Linear Light;Pin Light;Passthrough;Multiply".split(";");for(let a=0;a<256;a++){let c=a/255;yb[a]=(c-c*c)*255|0}for(let a=0;a<256;a++){let c=a/255;zb[a]=(Math.sqrt(c)-c)*255|0}Xa.prototype.copyFrom=function(a){this.name=a.name;this.blendMode=a.blendMode;this.useLegacyMultiply=a.useLegacyMultiply;this.alpha=a.alpha;this.visible=a.visible;this.parent=a.parent;this.lockAlpha=
a.lockAlpha;a.mask?this.mask?this.mask.copyPixelsFrom(a.mask):this.mask=a.mask.clone():this.mask=null;this.maskLinked=a.maskLinked;this.maskVisible=a.maskVisible;a.maskThumbnail?this.maskThumbnail?this.maskThumbnail.copyPixelsFrom(a.maskThumbnail):this.maskThumbnail=a.maskThumbnail.clone():this.maskThumbnail=null};Xa.prototype.setMask=function(a){(this.mask=a)||(this.maskThumbnail=null)};Xa.prototype.setAlpha=function(a){this.alpha=a};Xa.prototype.getAlpha=function(){return this.alpha};Xa.prototype.getEffectiveAlpha=
function(){return this.visible?this.alpha:0};Xa.prototype.getEffectiveMask=function(){return this.maskVisible?this.mask:null};Xa.prototype.setName=function(a){this.name=a};Xa.prototype.getName=function(){return this.name};Xa.prototype.setBlendMode=function(a){this.blendMode=a;a===I.LM_MULTIPLY?this.useLegacyMultiply=!0:a===I.LM_MULTIPLY2&&(this.useLegacyMultiply=!1)};Xa.prototype.getBlendMode=function(){return this.blendMode};Xa.prototype.getLockAlpha=function(){return this.lockAlpha};Xa.prototype.setLockAlpha=
function(a){this.lockAlpha=a};Xa.prototype.setVisible=function(a){this.visible=a};Xa.prototype.getVisible=function(){return this.visible};Xa.prototype.isVisible=Xa.prototype.getVisible;Xa.prototype.setMaskLinked=function(a){this.maskLinked=a};Xa.prototype.getMaskLinked=function(){return this.maskLinked};Xa.prototype.setMaskVisible=function(a){this.maskVisible=a};Xa.prototype.getMaskVisible=function(){return this.maskVisible};Xa.prototype.getMemoryUsed=function(){return 0};Xa.prototype.getDepth=function(){return null==
this.parent?0:this.parent.getDepth()+1};Xa.prototype.ancestorsAreVisible=function(){return null==this.parent||this.parent.visible&&this.parent.ancestorsAreVisible()};Xa.prototype.hasAncestor=function(a){return this.parent==a||this.parent&&this.parent.hasAncestor(a)};Xa.prototype.clone=function(){throw"Pure virtual CPLayer.clone() call";};Xa.prototype.getNonTransparentBounds=function(a){return new pa(0,0,0,0)};Xa.prototype.rebuildMaskThumbnail=function(){if(this.mask){if(!this.maskThumbnail){var a=
Math.ceil(Math.max(this.mask.width/Xa.LAYER_THUMBNAIL_WIDTH,this.mask.height/Xa.LAYER_THUMBNAIL_HEIGHT));this.maskThumbnail=new Ba(Math.floor(this.mask.width/a),Math.floor(this.mask.height/a),8)}this.maskThumbnail.createThumbnailFrom(this.mask)}else this.maskThumbnail=null};Xa.prototype.getMaskThumbnail=function(){return!this.maskThumbnail&&this.mask&&this.rebuildMaskThumbnail(),this.maskThumbnail};Xa.LAYER_THUMBNAIL_WIDTH=80;Xa.LAYER_THUMBNAIL_HEIGHT=50;ta.prototype=Object.create(Xa.prototype);ta.prototype.constructor=
ta;ta.createFromImage=function(a,c){c=new ta(0,0,c);return c.image=a,c};ta.prototype.clone=function(){var a=new ta(0,0,this.name);return a.copyFrom(this),a};ta.prototype.copyFrom=function(a){Xa.prototype.copyFrom.call(this,a);this.clip=a.clip;this.image?this.image.copyPixelsFrom(a.image):this.image=a.image.clone()};ta.prototype.hasAlpha=function(){return 100!=this.alpha||this.image.hasAlpha()};ta.prototype.hasAlphaInRect=function(a){return 100!=this.alpha||this.image.hasAlphaInRect(a)};ta.prototype.copyImageFrom=
function(a){this.image.copyPixelsFrom(a)};ta.prototype.getClippingBase=function(){if(this.clip&&this.parent)for(var a=this.parent.indexOf(this)-1;a>=0;a--)if(this.parent.layers[a]instanceof ta){if(!this.parent.layers[a].clip)return this.parent.layers[a]}else break;return null};ta.prototype.getClip=function(){return this.clip};ta.prototype.setClip=function(a){this.clip=a};ta.prototype.getNonTransparentBounds=function(a){return this.image.getNonTransparentBounds(a)};ta.prototype.getBounds=function(){return new pa(0,
0,this.image.width,this.image.height)};ta.prototype.getMemoryUsed=function(){return this.image?this.image.getMemorySize():0};ta.prototype.rebuildImageThumbnail=function(){if(!this.imageThumbnail){var a=Math.ceil(Math.max(this.image.width/Xa.LAYER_THUMBNAIL_WIDTH,this.image.height/Xa.LAYER_THUMBNAIL_HEIGHT));this.imageThumbnail=new C(Math.floor(this.image.width/a),Math.floor(this.image.height/a))}this.imageThumbnail.createThumbnailFrom(this.image)};ta.prototype.getImageThumbnail=function(){return this.imageThumbnail||
this.rebuildImageThumbnail(),this.imageThumbnail};I.blendFunctionNameForParameters=function(a,c,d,b){d=I.BLEND_MODE_CODENAMES[d]+"Onto";return a?d+="TransparentFusion":d+="OpaqueFusion",100==c?d+="WithOpaqueLayer":d+="WithTransparentLayer",b&&(d+="Masked"),d};I.fuseImageOntoImage=function(a,c,d,b,h,n,g){b<=0||(c=I.blendFunctionNameForParameters(c,b,h,null!=g),n=a.getBounds().clipTo(n),this[c](a,d,b,n,g))};I.normalFuseImageOntoImageAtPosition=function(a,c,d,b,h){h=h.clone();d=new pa(d,b,0,0);a.getBounds().clipSourceDest(h,
d);this._normalFuseImageOntoImageAtPosition(a,c,100,h,d.left,d.top)};I.multiplyAlphaBy=function(a,c){if(c<100)if(0==c)a.clearAll(0);else{a=a.data;for(var d=3;d<a.length;d+=4)a[d]=Math.round(a[d]*c/100)}};I.multiplyAlphaByMask=function(a,c,d){c/=25500;for(var b=C.ALPHA_BYTE_OFFSET,h=0;b<a.data.length;b+=C.BYTES_PER_PIXEL,h++)a.data[b]=Math.round(a.data[b]*d.data[h]*c)};I.copyAndMultiplyAlphaBy=function(a,c,d,b){if(100==d)a.copyBitmapRect(c,b.left,b.top,b);else if(0==d)a.clearRect(b,0);else for(a=c.data,
c=0;c<a.length;c+=4)a[c]=a[c],a[c+1]=a[c+1],a[c+2]=a[c+2],a[c+3]=Math.round(a[c+3]*d/100)};hd.prototype.addChildren=function(a){null!=a&&(Array.isArray(a)?(a.forEach(c=>c.parent=this),this.layers=this.layers.concat(a)):(a.parent=this,this.layers.push(a)))};var Hb={};!function(a){function c(){}function d(g,e){for(var k=g.length;k--;)if(g[k].listener===e)return k;return-1}function b(g){return function(){return this[g].apply(this,arguments)}}var h=c.prototype,n=a.EventEmitter;h.getListeners=function(g){var e,
k,l=this._getEvents();if(g instanceof RegExp)for(k in e={},l)l.hasOwnProperty(k)&&g.test(k)&&(e[k]=l[k]);else e=l[g]||(l[g]=[]);return e};h.flattenListeners=function(g){var e,k=[];for(e=0;e<g.length;e+=1)k.push(g[e].listener);return k};h.getListenersAsObject=function(g){var e,k=this.getListeners(g);return k instanceof Array&&((e={})[g]=k),e||k};h.addListener=function(g,e){if(!function r(m){return"function"==typeof m||m instanceof RegExp||!!m&&"object"==typeof m&&r(m.listener)}(e))throw TypeError("listener must be a function");
var k;g=this.getListenersAsObject(g);var l="object"==typeof e;for(k in g)g.hasOwnProperty(k)&&-1===d(g[k],e)&&g[k].push(l?e:{listener:e,once:!1});return this};h.on=b("addListener");h.addOnceListener=function(g,e){return this.addListener(g,{listener:e,once:!0})};h.once=b("addOnceListener");h.defineEvent=function(g){return this.getListeners(g),this};h.defineEvents=function(g){for(var e=0;e<g.length;e+=1)this.defineEvent(g[e]);return this};h.removeListener=function(g,e){var k,l;g=this.getListenersAsObject(g);
for(l in g)g.hasOwnProperty(l)&&-1!==(k=d(g[l],e))&&g[l].splice(k,1);return this};h.off=b("removeListener");h.addListeners=function(g,e){return this.manipulateListeners(!1,g,e)};h.removeListeners=function(g,e){return this.manipulateListeners(!0,g,e)};h.manipulateListeners=function(g,e,k){var l,f,m=g?this.removeListener:this.addListener;g=g?this.removeListeners:this.addListeners;if("object"!=typeof e||e instanceof RegExp)for(l=k.length;l--;)m.call(this,e,k[l]);else for(l in e)e.hasOwnProperty(l)&&
(f=e[l])&&("function"==typeof f?m.call(this,l,f):g.call(this,l,f));return this};h.removeEvent=function(g){var e,k=typeof g,l=this._getEvents();if("string"===k)delete l[g];else if(g instanceof RegExp)for(e in l)l.hasOwnProperty(e)&&g.test(e)&&delete l[e];else delete this._events;return this};h.removeAllListeners=b("removeEvent");h.emitEvent=function(g,e){var k,l,f,m=this.getListenersAsObject(g);for(f in m)if(m.hasOwnProperty(f)){var r=0;for(k=m[f].slice(0);r<k.length;r++)!0===(l=k[r]).once&&this.removeListener(g,
l.listener),l.listener.apply(this,e||[])===this._getOnceReturnValue()&&this.removeListener(g,l.listener)}return this};h.trigger=b("emitEvent");h.emit=function(g){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(g,e)};h.setOnceReturnValue=function(g){return this._onceReturnValue=g,this};h._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue};h._getEvents=function(){return this._events||(this._events={})};c.noConflict=function(){return a.EventEmitter=
n,c};"function"==typeof define&&define.amd?define(function(){return c}):Hb?Hb=c:a.EventEmitter=c}("undefined"!=typeof window?window:Hb||{});class Uf extends ya(Hb){close(){this.layer=this.buffer=null;this.emitEvent("changeLayer")}setLayer(a){this.layer=a;this.invalidRect=a.getBounds();this.emitEvent("changeLayer")}isOpen(){return null!=this.layer}invalidateRect(a){this.invalidRect.union(a)}getImageData(){this.prepareMask();if(!this.invalidRect.isEmpty()&&this.layer&&this.layer.mask){var a=this.buffer,
c=this.layer.mask,d=this.invalidRect,b=d.top*c.width+d.left,h=b*C.BYTES_PER_PIXEL,n=d.getWidth();d=d.getHeight();var g=c.width-n,e=g*C.BYTES_PER_PIXEL;for(let k=0;k<d;k++,b+=g,h+=e)for(let l=0;l<n;l++,b++,h+=C.BYTES_PER_PIXEL)a.data[h+C.RED_BYTE_OFFSET]=c.data[b],a.data[h+C.GREEN_BYTE_OFFSET]=c.data[b],a.data[h+C.BLUE_BYTE_OFFSET]=c.data[b],a.data[h+C.ALPHA_BYTE_OFFSET]=255;!0;this.invalidRect.makeEmpty()}return this.buffer}constructor(a,c){super();this.layer=a;this.buffer=a.mask.getImageData(0,0,
a.mask.width,a.mask.height);this.invalidRect=new pa(0,0,0,0);this.prepareMask=c}}class Vb{merge(a){return!1}noChange(){return!1}getMemoryUsed(a,c){return 0}compact(){}}db.prototype.getRgb=function(){return this.rgb};db.prototype.getSaturation=function(){return this.saturation};db.prototype.getHue=function(){return this.hue};db.prototype.getValue=function(){return this.value};db.prototype.setRgbComponents=function(a,c,d){this.setRgb(a<<16|c<<8|d)};db.prototype.setRgb=function(a){this.rgb=a;var c=a>>
16&255,d=a>>8&255;a&=255;this.value=Math.max(c,Math.max(d,a));var b=Math.min(c,Math.min(d,a));if(0==this.value?this.saturation=0:this.saturation=~~((this.value-b)/this.value*255),0==this.saturation)this.hue=0;else{var h=(this.value-c)/(this.value-b),n=(this.value-d)/(this.value-b);b=(this.value-a)/(this.value-b);var g=0;this.value==c&&(g=b-n);this.value==d&&(g=2+h-b);this.value==a&&(g=4+n-h);(g*=60)<0&&(g+=360);this.hue=~~g}};db.prototype.setHsv=function(a,c,d){this.hue=a;this.saturation=c;this.value=
d;this.rgb=xd(this)};db.prototype.setHue=function(a){this.hue=a;this.rgb=xd(this)};db.prototype.setSaturation=function(a){this.saturation=a;this.rgb=xd(this)};db.prototype.setValue=function(a){this.value=a;this.rgb=xd(this)};db.prototype.setGreyscale=function(a){this.rgb=db.greyToRGB(a);this.saturation=this.hue=0;this.value=a};db.prototype.clone=function(){var a=new db(0);return a.copyFrom(this),a};db.prototype.copyFrom=function(a){this.rgb=a.rgb;this.hue=a.hue;this.saturation=a.saturation;this.value=
a.value};db.prototype.isEqual=function(a){return this.rgb==a.rgb&&this.hue==a.hue&&this.saturation==a.saturation&&this.value==a.value};db.greyToRGB=function(a){return a|a<<8|a<<16};lb.prototype.setToIdentity=function(){this.m=[1,0,0,1,0,0]};lb.prototype.multiply=function(a){var c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],b=this.m[1]*a.m[2]+this.m[3]*a.m[3],h=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],n=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=this.m[0]*a.m[0]+
this.m[2]*a.m[1];this.m[1]=c;this.m[2]=d;this.m[3]=b;this.m[4]=h;this.m[5]=n};lb.prototype.preMultiply=function(a){var c=a.m[1]*this.m[0]+a.m[3]*this.m[1],d=a.m[0]*this.m[2]+a.m[2]*this.m[3],b=a.m[1]*this.m[2]+a.m[3]*this.m[3],h=a.m[0]*this.m[4]+a.m[2]*this.m[5]+a.m[4],n=a.m[1]*this.m[4]+a.m[3]*this.m[5]+a.m[5];this.m[0]=a.m[0]*this.m[0]+a.m[2]*this.m[1];this.m[1]=c;this.m[2]=d;this.m[3]=b;this.m[4]=h;this.m[5]=n};lb.prototype.invert=function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),c=
-this.m[1]*a,d=-this.m[2]*a,b=this.m[0]*a,h=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),n=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=this.m[3]*a;this.m[1]=c;this.m[2]=d;this.m[3]=b;this.m[4]=h;this.m[5]=n};lb.prototype.getInverted=function(){var a=new lb;return a.m[0]=this.m[0],a.m[1]=this.m[1],a.m[2]=this.m[2],a.m[3]=this.m[3],a.m[4]=this.m[4],a.m[5]=this.m[5],a.invert(),a};lb.prototype.rotate=function(a){var c=Math.cos(a);a=Math.sin(a);var d=this.m[1]*c+this.m[3]*a,b=-(this.m[0]*a)+this.m[2]*
c,h=-(this.m[1]*a)+this.m[3]*c;this.m[0]=this.m[0]*c+this.m[2]*a;this.m[1]=d;this.m[2]=b;this.m[3]=h};lb.prototype.rotateAroundPoint=function(a,c,d){this.translate(c,d);this.rotate(a);this.translate(-c,-d)};lb.prototype.translate=function(a,c){this.m[4]+=this.m[0]*a+this.m[2]*c;this.m[5]+=this.m[1]*a+this.m[3]*c};lb.prototype.scale=function(a,c){this.m[0]*=a;this.m[1]*=a;this.m[2]*=c;this.m[3]*=c};lb.prototype.scaleAroundPoint=function(a,c,d,b){this.translate(d,b);this.scale(a,c);this.translate(-d,
-b)};lb.prototype.shear=function(a,c){var d=this.m[1]+this.m[3]*c,b=this.m[2]+this.m[0]*a;a=this.m[3]+this.m[1]*a;this.m[0]+=this.m[2]*c;this.m[1]=d;this.m[2]=b;this.m[3]=a};lb.prototype.getTransformedPoint=function(a){return{x:a.x*this.m[0]+a.y*this.m[2]+this.m[4],y:a.x*this.m[1]+a.y*this.m[3]+this.m[5]}};lb.prototype.transformPoints=function(a){for(var c=0;c<a.length;c++)a[c]=this.getTransformedPoint(a[c])};lb.prototype.getTranslateX=function(){return this.m[4]};lb.prototype.getTranslateY=function(){return this.m[5]};
lb.prototype.clone=function(){var a=new lb;return a.m[0]=this.m[0],a.m[1]=this.m[1],a.m[2]=this.m[2],a.m[3]=this.m[3],a.m[4]=this.m[4],a.m[5]=this.m[5],a};lb.prototype.getDeterminant=function(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]};lb.prototype.decompose=function(){var a=this.getDeterminant(),c=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return{translate:{x:this.m[4],y:this.m[5]},rotate:Math.sign(this.m[1])*Math.acos(this.m[0]/c),scale:{x:c,y:a/c},shear:{x:Math.atan((this.m[0]*this.m[2]+
this.m[1]*this.m[3])/(c*c)),y:0}}};lb.prototype.toString=function(){return"["+this.m[0].toFixed(2)+" "+this.m[2].toFixed(2)+" "+this.m[4].toFixed(2)+"]\n["+this.m[1].toFixed(2)+" "+this.m[3].toFixed(2)+" "+this.m[5].toFixed(2)+"]\n[0.00 0.00 1.00]"};Math.sign=Math.sign||function(a){return 0==(a*=1)||isNaN(a)?a:a>0?1:-1};oc.prototype.toInt=function(){return Math.max(0,Math.min(255,Math.round(255*this.r)))<<16|Math.max(0,Math.min(255,Math.round(255*this.g)))<<8|Math.max(0,Math.min(255,Math.round(255*
this.b)))};oc.prototype.mixWith=function(a,c){this.r=this.r*(1-c)+a.r*c;this.g=this.g*(1-c)+a.g*c;this.b=this.b*(1-c)+a.b*c};oc.prototype.clone=function(){return new oc(this.r,this.g,this.b)};oc.createFromInt=function(a){return new oc((a>>>16&255)/255,(a>>>8&255)/255,(255&a)/255)};class Wc{paintDab(a,c,d,b,h,n,g){n.alpha=Math.round(250/254*(n.alpha-1)+5);a=Math.max(1,Math.ceil(n.alpha*b.alphaScale));switch(b.paintMode){case ka.PAINT_MODE_FLOW:this._paintFlow(h,c,n.brush,n.width,a);break;case ka.PAINT_MODE_OPACITY:this._paintOpacity(h,
c,n.brush,n.width,a)}}mergeOntoImage(a,c,d){let b=this._strokeBuffer.data;var h=this._strokedRegion;c=c.data;let n=a.data,g=d>>16&255,e=d>>8&255;d&=255;let k=0|h.getWidth(),l=0|h.getHeight(),f=this._strokeBuffer.offsetOfPixel(h.left,h.top);h=a.offsetOfPixel(h.left,h.top);let m=this._strokeBuffer.width-k|0;a=(a.width-k)*C.BYTES_PER_PIXEL|0;for(let q=0;q<l;q++,f+=m,h+=a)for(let t=0;t<k;t++,f++,h+=C.BYTES_PER_PIXEL){var r=b[f]/255+.5|0;if(r>0){let v=r+c[h+C.ALPHA_BYTE_OFFSET]*(255-r)/255|0;r=255*r/v|
0;let x=255-r;n[h]=(g*r+c[h]*x)/255&255;n[h+1]=(e*r+c[h+1]*x)/255&255;n[h+2]=(d*r+c[h+2]*x)/255&255;n[h+3]=v}}}mergeOntoMask(a,c,d){let b=this._strokeBuffer.data;var h=this._strokedRegion;c=c.data;let n=a.data,g=0|h.getWidth(),e=0|h.getHeight(),k=a.offsetOfPixel(h.left,h.top);h=this._strokeBuffer.offsetOfPixel(h.left,h.top);let l=this._strokeBuffer.width-g|0;a=a.width-g|0;for(let f=0;f<e;f++,h+=l,k+=a)for(let m=0;m<g;m++,h++,k++){let r=b[h]/255|0;r>0&&(n[k]=(d*r+c[k]*(255-r))/255)}}_paintFlow(a,c,
d,b,h){let n=this._strokeBuffer.data;a=a.left+a.top*b;let g=this._strokeBuffer.offsetOfPixel(c.left,c.top),e=c.getHeight(),k=c.getWidth();b-=k;let l=this._strokeBuffer.width-k;this._strokedRegion.union(c);for(c=0;c<e;c++,a+=b,g+=l)for(let f=0;f<k;f++,a++,g++){let m=d[a]*h;0!=m&&(n[g]=Math.min(65025,n[g]+(255-n[g]/255)*m/255))}}_paintOpacity(a,c,d,b,h){let n=this._strokeBuffer.data;a=a.left+a.top*b;let g=this._strokeBuffer.offsetOfPixel(c.left,c.top),e=c.getWidth();b-=e;let k=this._strokeBuffer.width-
e;h=Math.min(255,h);this._strokedRegion.union(c);for(let l=c.top;l<c.bottom;l++,a+=b,g+=k)for(let f=0;f<e;f++,a++,g++)n[g]=Math.max(d[a]*h,n[g])}beginStroke(){}endStroke(){}constructor(a,c){this._strokeBuffer=a;this._strokedRegion=c;this.wantsOutputAsInput=!0}}class Vf extends Wc{mergeOntoImage(a,c,d){d=this._strokeBuffer.data;let b=this._strokedRegion;c=c.data;let h=a.data;for(let n=b.top;n<b.bottom;n++){let g=a.offsetOfPixel(b.left,n)+C.ALPHA_BYTE_OFFSET,e=this._strokeBuffer.offsetOfPixel(b.left,
n);for(let k=b.left;k<b.right;k++,g+=C.BYTES_PER_PIXEL){let l=d[e++]/255|0;l>0&&(h[g]=c[g]*(255-l)/255)}}}}class Wf extends Wc{mergeOntoImage(a,c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;let h=b.getWidth(),n=b.getHeight(),g=a.offsetOfPixel(b.left,b.top);b=this._strokeBuffer.offsetOfPixel(b.left,b.top);let e=(a.width-h)*C.BYTES_PER_PIXEL,k=this._strokeBuffer.width-h;c=c.data;a=a.data;for(let f=0;f<n;f++,b+=k,g+=e)for(let m=0;m<h;m++,b++,g+=C.BYTES_PER_PIXEL){var l=d[b]/255|0;l>0&&0!=
c[g+C.ALPHA_BYTE_OFFSET]&&(l=(l+255)/255,a[g+C.RED_BYTE_OFFSET]=c[g+C.RED_BYTE_OFFSET]*l,a[g+C.GREEN_BYTE_OFFSET]=c[g+C.GREEN_BYTE_OFFSET]*l,a[g+C.BLUE_BYTE_OFFSET]=c[g+C.BLUE_BYTE_OFFSET]*l)}}mergeOntoMask(a,c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;let h=b.getWidth(),n=b.getHeight(),g=a.offsetOfPixel(b.left,b.top);b=this._strokeBuffer.offsetOfPixel(b.left,b.top);let e=a.width-h,k=this._strokeBuffer.width-h;c=c.data;a=a.data;for(let l=0;l<n;l++,b+=k,g+=e)for(let f=0;f<h;f++,b++,g++){let m=
d[b]/255|0;m>0&&(a[g]=Math.min((m+255)/255*c[g],255))}}}class Xf extends Wc{mergeOntoImage(a,c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;let h=b.getWidth(),n=b.getHeight(),g=a.offsetOfPixel(b.left,b.top);b=this._strokeBuffer.offsetOfPixel(b.left,b.top);let e=(a.width-h)*C.BYTES_PER_PIXEL,k=this._strokeBuffer.width-h;c=c.data;a=a.data;for(let l=0;l<n;l++,b+=k,g+=e)for(let f=0;f<h;f++,b++,g+=C.BYTES_PER_PIXEL){let m=d[b]/255|0;m>0&&0!=c[g+C.ALPHA_BYTE_OFFSET]&&(a[g+C.RED_BYTE_OFFSET]=c[g+
C.RED_BYTE_OFFSET]-(260-c[g+C.RED_BYTE_OFFSET])*m/255|0,a[g+C.GREEN_BYTE_OFFSET]=c[g+C.GREEN_BYTE_OFFSET]-(260-c[g+C.GREEN_BYTE_OFFSET])*m/255|0,a[g+C.BLUE_BYTE_OFFSET]=c[g+C.BLUE_BYTE_OFFSET]-(260-c[g+C.BLUE_BYTE_OFFSET])*m/255|0)}}mergeOntoMask(a,c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;let h=b.getWidth(),n=b.getHeight(),g=a.offsetOfPixel(b.left,b.top);b=this._strokeBuffer.offsetOfPixel(b.left,b.top);let e=a.width-h,k=this._strokeBuffer.width-h;c=c.data;a=a.data;for(let l=0;l<n;l++,
b+=k,g+=e)for(let f=0;f<h;f++,b++,g++){let m=d[b]/255|0;m>0&&(a[g]=Math.max(c[g]-(260-c[g])*m/255,0))}}}class Yf extends Wc{mergeOntoImage(a,c,d){d=this._strokeBuffer.data;let b=this._strokedRegion,h=c.data;a=a.data;var n=b.getWidth();let g=c.width*C.BYTES_PER_PIXEL,e=c.offsetOfPixel(b.left,b.top),k=this._strokeBuffer.offsetOfPixel(b.left,b.top),l=(c.width-n)*C.BYTES_PER_PIXEL;n=this._strokeBuffer.width-n;let f,m,r,q,t=function(x){f+=h[x+C.RED_BYTE_OFFSET];m+=h[x+C.GREEN_BYTE_OFFSET];r+=h[x+C.BLUE_BYTE_OFFSET];
q+=h[x+C.ALPHA_BYTE_OFFSET]};for(let x=b.top;x<b.bottom;x++,e+=l,k+=n)for(let A=b.left;A<b.right;A++,e+=C.BYTES_PER_PIXEL,k++){var v=d[k]/255|0;if(v>0){v=64+-63*v/255|0;let B=v+4;f=v*h[e+C.RED_BYTE_OFFSET];m=v*h[e+C.GREEN_BYTE_OFFSET];r=v*h[e+C.BLUE_BYTE_OFFSET];q=v*h[e+C.ALPHA_BYTE_OFFSET];t(x>0?e-g:e);t(x<c.height-1?e+g:e);t(A>0?e-C.BYTES_PER_PIXEL:e);t(A<c.width-1?e+C.BYTES_PER_PIXEL:e);q/=B;f/=B;m/=B;r/=B;a[e+C.RED_BYTE_OFFSET]=0|f;a[e+C.GREEN_BYTE_OFFSET]=0|m;a[e+C.BLUE_BYTE_OFFSET]=0|r;a[e+
C.ALPHA_BYTE_OFFSET]=0|q}}}mergeOntoMask(a,c,d){d=this._strokeBuffer.data;let b=this._strokedRegion,h=c.data;a=a.data;var n=b.getWidth();let g=c.width,e=c.offsetOfPixel(b.left,b.top),k=this._strokeBuffer.offsetOfPixel(b.left,b.top),l=c.width-n;n=this._strokeBuffer.width-n;for(let r=b.top;r<b.bottom;r++,e+=l,k+=n)for(let q=b.left;q<b.right;q++,e++,k++){var f=d[k]/255|0;if(f>0){var m=64+-63*f/255|0;f=m+4;m=m*h[e]+h[r>0?e-g:e]+h[r<c.height-1?e+g:e]+h[q>0?e-1:e]+h[q<c.width-1?e+1:e];a[e]=m/f|0}}}}class ve extends Wc{mergeOntoImage(a,
c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;c=c.data;let h=a.data,n=this._strokeBuffer.offsetOfPixel(b.left,b.top),g=a.offsetOfPixel(b.left,b.top),e=0|b.getWidth();b=0|b.getHeight();let k=this._strokeBuffer.width-e|0;a=(a.width-e)*C.BYTES_PER_PIXEL|0;for(let m=0;m<b;m++,n+=k,g+=a)for(let r=0;r<e;r++,n++,g+=C.BYTES_PER_PIXEL){let q=d[n];var l=q>>>24;if(l>0){var f=c[g+C.ALPHA_BYTE_OFFSET];f=l+f-l*f/255|0;l=255*l/f|0;let t=255-l;h[g]=((q>>16&255)*l+c[g]*t)/255|0;h[g+1]=((q>>8&255)*l+c[g+
1]*t)/255|0;h[g+2]=((255&q)*l+c[g+2]*t)/255|0;h[g+3]=f}}}mergeOntoMask(a,c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;c=c.data;let h=a.data,n=this._strokeBuffer.offsetOfPixel(b.left,b.top),g=a.offsetOfPixel(b.left,b.top),e=0|b.getWidth();b=0|b.getHeight();let k=this._strokeBuffer.width-e|0;a=a.width-e|0;for(let l=0;l<b;l++,n+=k,g+=a)for(let f=0;f<e;f++,n++,g++){let m=d[n],r=m>>8;r>0&&(h[g]=((255&m)*r+c[g]*(255-r))/255|0)}}}let sf=2/6;class id extends ve{static _sampleGrey(a,c,d,b,h){c|=
0;d|=0;let n=[{x:c,y:d}];for(let g=.25;g<1.001;g+=.25)Array.prototype.push.apply(n,[{x:~~(c+g*b),y:d},{x:~~(c-g*b),y:d},{x:c,y:~~(d+g*h)},{x:c,y:~~(d-g*h)},{x:~~(c+.7*g*b),y:~~(d+.7*g*h)},{x:~~(c+.7*g*b),y:~~(d-.7*g*h)},{x:~~(c-.7*g*b),y:~~(d+.7*g*h)},{x:~~(c-.7*g*b),y:~~(d-.7*g*h)}]);return Ee(n.map(g=>a.getPixel(g.x,g.y)))}static _sampleRGB(a,c,d,b,h,n){c|=0;d|=0;var g=[{x:c,y:d}];for(let e=.25;e<1.001;e+=.25)Array.prototype.push.apply(g,[{x:~~(c+e*b),y:d},{x:~~(c-e*b),y:d},{x:c,y:~~(d+e*h)},{x:c,
y:~~(d-e*h)},{x:~~(c+.7*e*b),y:~~(d+.7*e*h)},{x:~~(c+.7*e*b),y:~~(d-.7*e*h)},{x:~~(c-.7*e*b),y:~~(d+.7*e*h)},{x:~~(c-.7*e*b),y:~~(d-.7*e*h)}]);c=[];for(let e of g)e.x<0||e.y<0||e.x>=a.width||e.y>=a.height||(g=(e.y*a.width+e.x)*4,a.data[g+3]>0&&c.push(oc.createFromInt(-16777216|a.data[g]<<16|a.data[g+1]<<8|a.data[g+2])));return 0===c.length?n:Fe(c)}_paintToColorStrokeBuffer(a,c,d,b,h,n){let g=this._strokeBuffer.data,e=c.getWidth(),k=c.getHeight(),l=this._strokeBuffer.width-e,f=b-e;a=a.left+a.top*b;
b=this._strokeBuffer.offsetOfPixel(c.left,c.top);this._strokedRegion.union(c);for(c=0;c<k;c++,a+=f,b+=l)for(let q=0;q<e;q++,a++,b++){var m=d[a]*h/255|0;if(m>0){let t=g[b];var r=t>>>24;r=m+r-m*r/255|0;m=255-(255*m/r|0);g[b]=r<<24|(n>>16&255)+((t>>16&255)*m-(n>>16&255)*m)/255<<16|(n>>8&255)+((t>>8&255)*m-(n>>8&255)*m)/255<<8|(255&n)+((255&t)*m-(255&n)*m)/255}}}_paintToGreyscaleStrokeBuffer(a,c,d,b,h,n){let g=this._strokeBuffer.data;this._strokedRegion.union(c);for(let l=c.top,f=a.top;l<c.bottom;l++,
f++){let m=a.left+f*b,r=this._strokeBuffer.offsetOfPixel(c.left,l);for(let q=c.left;q<c.right;q++,m++,r++){var e=d[m]*h/255|0;if(e<=0)continue;let t=g[r];var k=t>>8;k=e+k-e*k/255|0;k>0&&(e=255-(255*e/k|0),g[r]=k<<8|n+((255&t)*e-n*e)/255)}}}beginStroke(){this._previousSamples=null}paintDab(a,c,d,b,h,n,g){a=this.isTransparentCanvas?.3:1;n.alpha=247/254*(n.alpha-1)+8;n.alpha*=a;var e,k;a=Math.max(1,n.alpha/4);var l=(c.left+c.right)/2,f=(c.top+c.bottom)/2,m=Math.max(1,Math.min(64,c.getWidth()*sf)),r=
Math.max(1,Math.min(64,c.getHeight()*sf));if(d instanceof Ba){null==this._previousSamples&&(this._previousSamples=Array(50),this._previousSamples.fill(id._sampleGrey(d,l,f,m,r)));let t=Ee(this._previousSamples);var q=t;g=q=t=q*(1-(e=b.resat*b.resat))+(255&g)*e;d=id._sampleGrey(d,l,f,m,r);t=g*(1-(k=b.bleed))+d*k;this._previousSamples.push(t);this._previousSamples.shift();this._paintToGreyscaleStrokeBuffer(h,c,n.brush,n.width,a,Math.round(q))}else null==this._previousSamples&&(this._previousSamples=
Array(50),k=oc.createFromInt(g),this._previousSamples.fill(id._sampleRGB(d,l,f,m,r,k))),k=Fe(this._previousSamples),k.mixWith(oc.createFromInt(g),b.resat*b.resat),e=k.toInt(),g=oc.createFromInt(g),d=id._sampleRGB(d,l,f,m,r,g),this.isTransparentCanvas=g===d,k.mixWith(d,b.bleed),this._previousSamples.push(k),this._previousSamples.shift(),this._paintToColorStrokeBuffer(h,c,n.brush,n.width,a,e)}constructor(a,c){super(a,c);this.wantsOutputAsInput=!0}}class $f extends ve{_accumulatePaintFromMask(a,c,d,
b){let h=this._brushBuffer.data,n=a.data,g=d.getWidth(),e=d.getHeight();c=c.left+c.top*this._brushBuffer.width;d=a.offsetOfPixel(d.left,d.top);let k=this._brushBuffer.width-g;a=a.width-g;if(!(b<=0))for(let f=0;f<e;f++,c+=k,d+=a)for(let m=0;m<g;m++,c++,d++){let r=n[d],q=h[c];var l=q>>8;l=b+l-b*l/255|0;let t=255-(255*b/l|0);h[c]=l<<8|r+((255&q)*t-r*t)/255}}_resaturateBrushWithGrey(a,c,d){if(!(c<=0)){var b=this._brushBuffer.data,h=a.getWidth(),n=a.getHeight();a=a.left+a.top*this._brushBuffer.width;var g=
this._brushBuffer.width-h;for(let k=0;k<n;k++,a+=g)for(let l=0;l<h;l++,a++){let f=b[a];var e=f>>8;e=c+e-c*e/255|0;let m=255-(255*c/e|0);b[a]=e<<8|d+((255&f)*m-d*m)/255}}}_paintToGreyscaleStrokeBuffer(a,c,d,b,h){let n=this._strokeBuffer.data,g=this._brushBuffer.data,e=a.data;this._strokedRegion.union(d);for(let l=d.top,f=c.top;l<d.bottom;l++,f++){let m=this._brushBuffer.offsetOfPixel(c.left,f),r=this._strokeBuffer.offsetOfPixel(d.left,l),q=a.offsetOfPixel(d.left,l);for(let t=d.left;t<d.right;t++,m++,
q++,r++){let v=g[m];var k=(v>>8)*b[m]*h/65025|0;k>0&&(k=255-k,n[r]=65280|(255&v)+(e[q]*k-(255&v)*k)/255)}}}_accumulatePaintFromImage(a,c,d,b){let h=this._brushBuffer.data,n=a.data,g=d.getWidth(),e=d.getHeight();c=c.left+c.top*this._brushBuffer.width;d=a.offsetOfPixel(d.left,d.top);let k=this._brushBuffer.width-g;a=(a.width-g)*C.BYTES_PER_PIXEL;for(let m=0;m<e;m++,c+=k,d+=a)for(let r=0;r<g;r++,c++,d+=C.BYTES_PER_PIXEL){var l=n[d+C.ALPHA_BYTE_OFFSET]*b/255|0;if(l>0){let q=h[c];var f=q>>>24;f=l+f-l*
f/255|0;l=255-(255*l/f|0);let t=n[d+C.RED_BYTE_OFFSET],v=n[d+C.GREEN_BYTE_OFFSET],x=n[d+C.BLUE_BYTE_OFFSET];h[c]=f<<24|t+((q>>16&255)*l-t*l)/255<<16|v+((q>>8&255)*l-v*l)/255<<8|x+((255&q)*l-x*l)/255}}}_resaturateBrushWithColor(a,c,d){if(!(c<=0)){var b=this._brushBuffer.data,h=a.getWidth(),n=a.getHeight();a=a.left+a.top*this._brushBuffer.width;var g=this._brushBuffer.width-h;for(let k=0;k<n;k++,a+=g)for(let l=0;l<h;l++,a++){let f=b[a];var e=f>>>24;e=c+e-c*e/255|0;let m=255-(255*c/e|0);b[a]=e<<24|(d>>>
16&255)+((f>>>16&255)*m-(d>>>16&255)*m)/255<<16|(d>>>8&255)+((f>>>8&255)*m-(d>>>8&255)*m)/255<<8|(255&d)+((255&f)*m-(255&d)*m)/255}}}_paintToColorStrokeBuffer(a,c,d,b,h){let n=this._strokeBuffer.data,g=this._brushBuffer.data,e=a.data;this._strokedRegion.union(d);for(let f=d.top,m=c.top;f<d.bottom;f++,m++){let r=this._brushBuffer.offsetOfPixel(c.left,m),q=this._strokeBuffer.offsetOfPixel(d.left,f),t=a.offsetOfPixel(d.left,f);for(let v=d.left;v<d.right;v++,r++,t+=C.BYTES_PER_PIXEL,q++){let x=g[r];var k=
(x>>>24)*b[r]*h/65025|0;if(k>0){var l=e[t+C.ALPHA_BYTE_OFFSET];l=k+l-k*l/255|0;k=255-(255*k/l|0);n[q]=l<<24|(x>>16&255)+(e[t+C.RED_BYTE_OFFSET]*k-(x>>16&255)*k)/255<<16|(x>>8&255)+(e[t+C.GREEN_BYTE_OFFSET]*k-(x>>8&255)*k)/255<<8|(255&x)+(e[t+C.BLUE_BYTE_OFFSET]*k-(255&x)*k)/255}}}}paintDab(a,c,d,b,h,n,g){a instanceof C?null==this._brushBuffer?(this._brushBuffer=new Ba(n.width,n.height,32),this._accumulatePaintFromImage(d,h,c,255)):(this._resaturateBrushWithColor(h,~~(b.resat<=0?0:Math.max(1,b.resat*
b.resat*255)),16777215&g),this._paintToColorStrokeBuffer(a,h,c,n.brush,n.alpha),this._accumulatePaintFromImage(d,h,c,~~(255*b.bleed))):null==this._brushBuffer?(this._brushBuffer=new Ba(n.width,n.height,16),this._accumulatePaintFromMask(d,h,c,255)):(this._resaturateBrushWithGrey(h,~~(b.resat<=0?0:Math.max(1,b.resat*b.resat*255)),255&g),this._paintToGreyscaleStrokeBuffer(a,h,c,n.brush,n.alpha),this._accumulatePaintFromMask(d,h,c,~~(255*b.bleed)))}endStroke(){this._brushBuffer=null}constructor(a,c){super(a,
c);this.wantsOutputAsInput=!0;this.isTransparentCanvas=!1}}class Zf extends ve{_sampleFromMask(a,c,d,b){let h=this._brushBuffer.data,n=c.getWidth(),g=c.getHeight(),e=this._brushBuffer.offsetOfPixel(c.left,c.top);d=a.offsetOfPixel(d.left,d.top);let k=this._brushBuffer.width-n,l=a.width-n,f=255-b;if(255!=b){for(let m=0;m<g;m++,e+=k,d+=l)for(let r=0;r<n;r++,e++,d++){let q=a.data[d],t=h[e],v=(q*f+(255&t)*b)/255,x=(255*f+(t>>8)*b)/255<<8|v;x==t&&(q>v?x++:q<v&&x--);h[e]=x}Ge(this._brushBuffer,c)}}_paintToMask(a,
c,d,b){let h=c.getWidth(),n=c.getHeight();c=this._brushBuffer.offsetOfPixel(c.left,c.top);d=a.offsetOfPixel(d.left,d.top);let g=this._brushBuffer.width-h,e=a.width-h;a=a.data;let k=this._brushBuffer.data;for(let l=0;l<n;l++,d+=e,c+=g)for(let f=0;f<h;f++,c++,d++){let m=k[c],r=255&m;((m>>8)*b[c]/255|0)>0&&(a[d]=r)}}_sampleFromImage(a,c,d,b){let h=this._brushBuffer.data,n=c.getWidth(),g=c.getHeight(),e=this._brushBuffer.offsetOfPixel(c.left,c.top);d=a.offsetOfPixel(d.left,d.top);let k=this._brushBuffer.width-
n,l=(a.width-n)*C.BYTES_PER_PIXEL,f=255-b;if(255!=b){for(let r=0;r<g;r++,e+=k,d+=l)for(let q=0;q<n;q++,e++,d+=C.BYTES_PER_PIXEL){let t=a.data[d+C.RED_BYTE_OFFSET],v=a.data[d+C.GREEN_BYTE_OFFSET],x=a.data[d+C.BLUE_BYTE_OFFSET];var m=h[e];let A=(a.data[d+C.ALPHA_BYTE_OFFSET]*f+(m>>24&255)*b)/255<<24&4278190080|(t*f+(m>>16&255)*b)/255<<16&16711680|(v*f+(m>>8&255)*b)/255<<8&65280|(x*f+(255&m)*b)/255&255;if(A==m){m=(16711680&A)>>16;let B=(65280&A)>>8,y=255&A;t>m?A+=65536:t<m&&(A-=65536);v>B?A+=256:v<B&&
(A-=256);x>y?A+=1:x<y&&--A}h[e]=A}Ge(this._brushBuffer,c)}}_paintToImage(a,c,d,b){let h=c.getWidth(),n=c.getHeight();c=this._brushBuffer.offsetOfPixel(c.left,c.top);d=a.offsetOfPixel(d.left,d.top);let g=this._brushBuffer.width-h,e=(a.width-h)*C.BYTES_PER_PIXEL;a=a.data;let k=this._brushBuffer.data;for(let l=0;l<n;l++,d+=e,c+=g)for(let f=0;f<h;f++,c++,d+=C.BYTES_PER_PIXEL){let m=k[c];((m>>>24)*b[c]/255|0)>0&&(a[d+C.RED_BYTE_OFFSET]=m>>16&255,a[d+C.GREEN_BYTE_OFFSET]=m>>8&255,a[d+C.BLUE_BYTE_OFFSET]=
255&m,a[d+C.ALPHA_BYTE_OFFSET]=m>>24&255)}}paintDab(a,c,d,b,h,n,g){a instanceof C?null==this._brushBuffer?(this._brushBuffer=new Ba(n.width,n.height,32),this._sampleFromImage(d,h,c,0)):(this._sampleFromImage(d,h,c,n.alpha),this._paintToImage(a,h,c,n.brush)):null==this._brushBuffer?(this._brushBuffer=new Ba(n.width,n.height,16),this._sampleFromMask(d,h,c,0)):(this._sampleFromMask(d,h,c,n.alpha),this._paintToMask(a,h,c,n.brush))}mergeOntoImage(a,c,d){}mergeOntoMask(a,c,d){}beginStroke(){this._brushBuffer=
null}endStroke(){this._brushBuffer=null}constructor(a,c){super(a,c);this._brushBuffer=null;this.noMergePhase=this.wantsOutputAsInput=!0}}"use strict";"use strict";cc.prototype=Object.create(ya(Hb).prototype);cc.prototype.constructor=cc;cc.prototype.getBounds=function(){return new pa(0,0,this.width,this.height)};cc.prototype.isPointWithin=function(a,c){return a>=0&&c>=0&&a<this.width&&c<this.height};cc.EDITING_MODE_IMAGE=0;cc.EDITING_MODE_MASK=1;Ya.prototype.readChar=function(){return this.pos<this.end?
String.fromCharCode(this.data[this.pos++]):(this.eof=!0,-1)};Ya.prototype.readByte=function(){return this.pos<this.end?this.data[this.pos++]:(this.eof=!0,-1)};Ya.prototype.readU8=Ya.prototype.readByte;Ya.prototype.readS8=function(){var a;return 128&(a=this.readByte())?4294967040|a:a};Ya.prototype.unreadChar=function(a){this.pos--};Ya.prototype.peekChar=function(){return this.pos<this.end?String.fromCharCode(this.data[this.pos]):(this.eof=!0,-1)};Ya.prototype.readString=function(a){var c,d=Array(a);
for(c=0;c<a;c++)d[c]=this.readChar();return d.join("")};Ya.prototype.readS16=function(){var a;return 32768&(a=this.readByte()<<8|this.readByte())?4294901760|a:a};Ya.prototype.readU16BE=function(){return this.readByte()<<8|this.readByte()};Ya.prototype.readU16LE=function(){var a=this.readByte();return this.readByte()<<8|a};Ya.prototype.readU32BE=function(){return(this.readByte()<<24|this.readByte()<<16|this.readByte()<<8|this.readByte())>>>0};Ya.prototype.readU32LE=function(){var a=this.readByte(),
c=this.readByte(),d=this.readByte();return(this.readByte()<<24|d<<16|c<<8|a)>>>0};Ya.prototype.readBytes=function(a){var c=this.data.subarray(this.pos,this.pos+a);return this.pos+=a,this.pos>this.end&&(this.eof=!0),c};Ya.prototype.skip=function(a){this.pos+=a;this.pos>this.end&&(this.eof=!0)};Ya.prototype.seek=function(a){this.pos=a};Ya.prototype.writeBytes=function(a){for(var c=0;c<a.length;c++)this.data[this.pos++]=a[c]};Ya.prototype.writeByte=function(a){this.data[this.pos++]=a};Ya.prototype.writeU8=
Ya.prototype.writeByte;Ya.prototype.writeU16LE=function(a){this.data[this.pos++]=a;this.data[this.pos++]=a>>8};Ya.prototype.writeU16BE=function(a){this.data[this.pos++]=a>>8;this.data[this.pos++]=a};Ya.prototype.writeU32BE=function(a){this.data[this.pos++]=a>>24;this.data[this.pos++]=a>>16;this.data[this.pos++]=a>>8;this.data[this.pos++]=a};Ya.prototype.writeU32LE=function(a){this.data[this.pos++]=a;this.data[this.pos++]=a>>8;this.data[this.pos++]=a>>16;this.data[this.pos++]=a>>24};Ya.prototype.writeDoubleBE=
function(a){a=new Uint8Array((new Float64Array([a])).buffer);for(var c=a.length-1;c>=0;c--)this.writeByte(a[c])};Ya.prototype.writeFloatBE=function(a){a=new Uint8Array((new Float32Array([a])).buffer);for(var c=a.length-1;c>=0;c--)this.writeByte(a[c])};Ya.prototype.writeString=function(a){for(var c=0;c<a.length;c++)this.data[this.pos++]=a.charCodeAt(c)};Ya.prototype.writeUnsignedIntBE=function(a,c){switch(void 0===c&&(c=this.measureUnsignedInt(a)),c){case 5:this.writeU8(Math.floor(a/4294967296));case 4:this.writeU8(a>>
24);case 3:this.writeU8(a>>16);case 2:this.writeU8(a>>8);case 1:this.writeU8(a);break;default:throw"Bad UINT size "+c;}};Ya.prototype.measureUnsignedInt=function(a){return a<256?1:a<65536?2:a<16777216?3:a<4294967296?4:5};Ya.prototype.getAsDataArray=function(){if(this.pos<this.data.byteLength)return this.data.subarray(0,this.pos);if(this.pos==this.data.byteLength)return this.data;throw"ArrayDataStream's pos lies beyond end of buffer";};Ya.prototype.EOF=-1;var me={},Ga={},Cg="undefined"!=typeof Uint8Array&&
"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;Ga.assign=function(a){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var d=c.shift();if(d){if("object"!=typeof d)throw TypeError(d+"must be non-object");for(var b in d)Object.prototype.hasOwnProperty.call(d,b)&&(a[b]=d[b])}}return a};Ga.shrinkBuf=function(a,c){return a.length===c?a:a.subarray?a.subarray(0,c):(a.length=c,a)};"use strict";"use strict";"use strict";var Dg={arraySet:function(a,c,d,b,h){if(c.subarray&&a.subarray)return void a.set(c.subarray(d,
d+b),h);for(var n=0;n<b;n++)a[h+n]=c[d+n]},flattenChunks:function(a){var c,d;var b=c=0;for(d=a.length;c<d;c++)b+=a[c].length;c=0;var h=new Uint8Array(b);b=0;for(d=a.length;c<d;c++){var n=a[c];h.set(n,b);b+=n.length}return h}},Eg={arraySet:function(a,c,d,b,h){for(var n=0;n<b;n++)a[h+n]=c[d+n]},flattenChunks:function(a){return[].concat.apply([],a)}};Ga.setTyped=function(a){a?(Ga.Buf8=Uint8Array,Ga.Buf16=Uint16Array,Ga.Buf32=Int32Array,Ga.assign(Ga,Dg)):(Ga.Buf8=Array,Ga.Buf16=Array,Ga.Buf32=Array,Ga.assign(Ga,
Eg))};Ga.setTyped(Cg);var Fg=Ga.assign,sd={};zc(sd,"Deflate",function(){return tf},function(a){return tf=a});zc(sd,"deflate",function(){return uf},function(a){return uf=a});zc(sd,"deflateRaw",function(){return vf},function(a){return vf=a});zc(sd,"gzip",function(){return wf},function(a){return wf=a});var ce=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],zd=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Gg=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],xf=[16,17,18,0,8,
7,9,6,10,5,11,4,12,3,13,2,14,1,15],xc=Array(576);Xc(xc);var td=Array(60);Xc(td);var jd=Array(512);Xc(jd);var ld=Array(256);Xc(ld);var de=Array(29);Xc(de);var Ad=Array(30);Xc(Ad);var yf=!1;"use strict";var cg=function(a){if(!yf){var c,d,b=Array(16);for(c=d=0;d<28;d++){var h=0;for(de[d]=c;h<1<<ce[d];h++)ld[c++]=d}ld[c-1]=d;for(d=c=0;d<16;d++)for(h=0,Ad[d]=c;h<1<<zd[d];h++)jd[c++]=d;for(c>>=7;d<30;d++)for(h=0,Ad[d]=c<<7;h<1<<zd[d]-7;h++)jd[256+c++]=d;for(h=0;h<=15;h++)b[h]=0;for(h=0;h<=143;)xc[2*h+1]=
8,h++,b[8]++;for(;h<=255;)xc[2*h+1]=9,h++,b[9]++;for(;h<=279;)xc[2*h+1]=7,h++,b[7]++;for(;h<=287;)xc[2*h+1]=8,h++,b[8]++;Ke(xc,287,b);for(h=0;h<30;h++)td[2*h+1]=5,td[2*h]=Je(h,5);pf=new $d(xc,ce,257,286,15);qf=new $d(td,zd,0,30,15);rf=new $d([],Gg,0,19,7);!0;yf=!0}a.l_desc=new ae(a.dyn_ltree,pf);a.d_desc=new ae(a.dyn_dtree,qf);a.bl_desc=new ae(a.bl_tree,rf);a.bi_buf=0;a.bi_valid=0;Le(a)};var ag=function(a,c,d,b){var h,n,g=0;a.level>0?(2===a.strm.data_type&&(a.strm.data_type=function(e){var k,l=4093624447;
for(k=0;k<=31;k++,l>>>=1)if(1&l&&0!==e.dyn_ltree[2*k])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(k=32;k<256;k++)if(0!==e.dyn_ltree[2*k])return 1;return 0}(a)),ee(a,a.l_desc),ee(a,a.d_desc),g=function(e){var k;Pe(e,e.dyn_ltree,e.l_desc.max_code);Pe(e,e.dyn_dtree,e.d_desc.max_code);ee(e,e.bl_desc);for(k=18;k>=3&&0===e.bl_tree[2*xf[k]+1];k--);return e.opt_len+=3*(k+1)+5+5+4,k}(a),h=a.opt_len+3+7>>>3,(n=a.static_len+3+7>>>3)<=h&&(h=n)):h=n=d+5;d+4<=h&&-1!==
c?Re(a,c,d,b):4===a.strategy||n===h?(dc(a,2+ +!!b,3),Oe(a,xc,td)):(dc(a,4+ +!!b,3),function(e,k,l,f){var m;dc(e,k-257,5);dc(e,l-1,5);dc(e,f-4,4);for(m=0;m<f;m++)dc(e,e.bl_tree[2*xf[m]+1],3);Qe(e,e.dyn_ltree,k-1);Qe(e,e.dyn_dtree,l-1)}(a,a.l_desc.max_code+1,a.d_desc.max_code+1,g+1),Oe(a,a.dyn_ltree,a.dyn_dtree));Le(a);b&&Me(a)};var Fc=function(a,c,d){return a.pending_buf[a.d_buf+2*a.last_lit]=c>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&c,a.pending_buf[a.l_buf+a.last_lit]=255&d,a.last_lit++,
0===c?a.dyn_ltree[2*d]++:(a.matches++,c--,a.dyn_ltree[(ld[d]+256+1)*2]++,a.dyn_dtree[2*Ie(c)]++),a.last_lit===a.lit_bufsize-1};var Hg=function(a){dc(a,2,3);tc(a,256,xc);16===a.bi_valid?(kd(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)};"use strict";var Yc={};Yc=function(a,c,d,b){var h=65535&a;a=a>>>16&65535;for(var n;0!==d;){n=d>2E3?2E3:d;d-=n;do a=a+(h=h+c[b++]|0)|0;while(--n);h%=65521;a%=65521}return h|a<<16};"use strict";
var Lb={},Ig=function(){for(var a,c=[],d=0;d<256;d++){a=d;for(var b=0;b<8;b++)a=1&a?3988292384^a>>>1:a>>>1;c[d]=a}return c}();Lb=function(a,c,d,b){d=b+d;for(a^=-1;b<d;b++)a=a>>>8^Ig[(a^c[b])&255];return-1^a};var Oc={};Oc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};var nd=[new uc(0,0,0,0,function(a,c){var d=65535;for(65535>a.pending_buf_size-5&&(d=a.pending_buf_size-5);;){if(a.lookahead<=
1){if(Pc(a),0===a.lookahead&&0===c)return 1;if(0===a.lookahead)break}a.strstart+=a.lookahead;a.lookahead=0;var b=a.block_start+d;if((0===a.strstart||a.strstart>=b)&&(a.lookahead=a.strstart-b,a.strstart=b,Tb(a,!1),0===a.strm.avail_out)||a.strstart-a.block_start>=a.w_size-262&&(Tb(a,!1),0===a.strm.avail_out))return 1}return(a.insert=0,4===c)?(Tb(a,!0),0===a.strm.avail_out)?3:4:(a.strstart>a.block_start&&(Tb(a,!1),a.strm.avail_out),1)}),new uc(4,4,8,4,fe),new uc(4,5,16,8,fe),new uc(4,6,32,32,fe),new uc(4,
4,16,16,Zc),new uc(8,16,32,32,Zc),new uc(8,16,128,128,Zc),new uc(8,32,128,256,Zc),new uc(32,128,258,1024,Zc),new uc(32,258,258,4096,Zc)];"use strict";var Jg=function(a,c){if(!a||!a.state||c>5||c<0)return a?Cc(a,-2):-2;if(b=a.state,!a.output||!a.input&&0!==a.avail_in||666===b.status&&4!==c)return Cc(a,0===a.avail_out?-5:-2);if(b.strm=a,d=b.last_flush,b.last_flush=c,42===b.status)if(2===b.wrap)a.adler=0,hb(b,31),hb(b,139),hb(b,8),b.gzhead?(hb(b,+!!b.gzhead.text+2*!!b.gzhead.hcrc+4*!!b.gzhead.extra+
8*!!b.gzhead.name+16*!!b.gzhead.comment),hb(b,255&b.gzhead.time),hb(b,b.gzhead.time>>8&255),hb(b,b.gzhead.time>>16&255),hb(b,b.gzhead.time>>24&255),hb(b,9===b.level?2:4*(b.strategy>=2||b.level<2)),hb(b,255&b.gzhead.os),b.gzhead.extra&&b.gzhead.extra.length&&(hb(b,255&b.gzhead.extra.length),hb(b,b.gzhead.extra.length>>8&255)),b.gzhead.hcrc&&(a.adler=Lb(a.adler,b.pending_buf,b.pending,0)),b.gzindex=0,b.status=69):(hb(b,0),hb(b,0),hb(b,0),hb(b,0),hb(b,0),hb(b,9===b.level?2:4*(b.strategy>=2||b.level<
2)),hb(b,3),b.status=113);else{var d,b;var h=8+(b.w_bits-8<<4)<<8;h|=(b.strategy>=2||b.level<2?0:b.level<6?1:6===b.level?2:3)<<6;0!==b.strstart&&(h|=32);b.status=113;md(b,h+(31-h%31));0!==b.strstart&&(md(b,a.adler>>>16),md(b,65535&a.adler));a.adler=1}if(69===b.status)if(b.gzhead.extra){for(h=b.pending;b.gzindex<(65535&b.gzhead.extra.length)&&(b.pending!==b.pending_buf_size||(b.gzhead.hcrc&&b.pending>h&&(a.adler=Lb(a.adler,b.pending_buf,b.pending-h,h)),Ec(a),h=b.pending,b.pending!==b.pending_buf_size));)hb(b,
255&b.gzhead.extra[b.gzindex]),b.gzindex++;b.gzhead.hcrc&&b.pending>h&&(a.adler=Lb(a.adler,b.pending_buf,b.pending-h,h));b.gzindex===b.gzhead.extra.length&&(b.gzindex=0,b.status=73)}else b.status=73;if(73===b.status)if(b.gzhead.name){h=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>h&&(a.adler=Lb(a.adler,b.pending_buf,b.pending-h,h)),Ec(a),h=b.pending,b.pending===b.pending_buf_size)){var n=1;break}n=b.gzindex<b.gzhead.name.length?255&b.gzhead.name.charCodeAt(b.gzindex++):
0;hb(b,n)}while(0!==n);b.gzhead.hcrc&&b.pending>h&&(a.adler=Lb(a.adler,b.pending_buf,b.pending-h,h));0===n&&(b.gzindex=0,b.status=91)}else b.status=91;if(91===b.status)if(b.gzhead.comment){h=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>h&&(a.adler=Lb(a.adler,b.pending_buf,b.pending-h,h)),Ec(a),h=b.pending,b.pending===b.pending_buf_size)){n=1;break}n=b.gzindex<b.gzhead.comment.length?255&b.gzhead.comment.charCodeAt(b.gzindex++):0;hb(b,n)}while(0!==n);b.gzhead.hcrc&&b.pending>
h&&(a.adler=Lb(a.adler,b.pending_buf,b.pending-h,h));0===n&&(b.status=103)}else b.status=103;if(103===b.status&&(b.gzhead.hcrc?(b.pending+2>b.pending_buf_size&&Ec(a),b.pending+2<=b.pending_buf_size&&(hb(b,255&a.adler),hb(b,a.adler>>8&255),a.adler=0,b.status=113)):b.status=113),0!==b.pending){if(Ec(a),0===a.avail_out)return b.last_flush=-1,0}else if(0===a.avail_in&&(c<<1)-9*(c>4)<=(d<<1)-9*(d>4)&&4!==c)return Cc(a,-5);if(666===b.status&&0!==a.avail_in)return Cc(a,-5);if(0!==a.avail_in||0!==b.lookahead||
0!==c&&666!==b.status){d=2===b.strategy?function(g,e){for(var k;;){if(0===g.lookahead&&(Pc(g),0===g.lookahead)){if(0===e)return 1;break}if(g.match_length=0,k=Fc(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++,k&&(Tb(g,!1),0===g.strm.avail_out))return 1}return(g.insert=0,4===e)?(Tb(g,!0),0===g.strm.avail_out)?3:4:g.last_lit&&(Tb(g,!1),0===g.strm.avail_out)?1:2}(b,c):3===b.strategy?function(g,e){for(var k,l,f,m,r=g.window;;){if(g.lookahead<=258){if(Pc(g),g.lookahead<=258&&0===e)return 1;if(0===
g.lookahead)break}if(g.match_length=0,g.lookahead>=3&&g.strstart>0&&(l=r[f=g.strstart-1])===r[++f]&&l===r[++f]&&l===r[++f]){for(m=g.strstart+258;l===r[++f]&&l===r[++f]&&l===r[++f]&&l===r[++f]&&l===r[++f]&&l===r[++f]&&l===r[++f]&&l===r[++f]&&f<m;);g.match_length=258-(m-f);g.match_length>g.lookahead&&(g.match_length=g.lookahead)}if(g.match_length>=3?(k=Fc(g,1,g.match_length-3),g.lookahead-=g.match_length,g.strstart+=g.match_length,g.match_length=0):(k=Fc(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++),
k&&(Tb(g,!1),0===g.strm.avail_out))return 1}return(g.insert=0,4===e)?(Tb(g,!0),0===g.strm.avail_out)?3:4:g.last_lit&&(Tb(g,!1),0===g.strm.avail_out)?1:2}(b,c):nd[b.level].func(b,c);if((3===d||4===d)&&(b.status=666),1===d||3===d)return 0===a.avail_out&&(b.last_flush=-1),0;if(2===d&&(1===c?Hg(b):5!==c&&(Re(b,0,0,!1),3===c&&(Dc(b.head),0===b.lookahead&&(b.strstart=0,b.block_start=0,b.insert=0))),Ec(a),0===a.avail_out))return b.last_flush=-1,0}return 4!==c?0:b.wrap<=0?1:(2===b.wrap?(hb(b,255&a.adler),
hb(b,a.adler>>8&255),hb(b,a.adler>>16&255),hb(b,a.adler>>24&255),hb(b,255&a.total_in),hb(b,a.total_in>>8&255),hb(b,a.total_in>>16&255),hb(b,a.total_in>>24&255)):(md(b,a.adler>>>16),md(b,65535&a.adler)),Ec(a),b.wrap>0&&(b.wrap=-b.wrap),+(0===b.pending))};var Kg=function(a){var c;return a&&a.state?42!==(c=a.state.status)&&69!==c&&73!==c&&91!==c&&103!==c&&113!==c&&666!==c?Cc(a,-2):(a.state=null,113===c?Cc(a,-3):0):-2};var dg=function(a,c){var d,b,h;var n=c.length;if(!a||!a.state||2===(b=(d=a.state).wrap)||
1===b&&42!==d.status||d.lookahead)return-2;1===b&&(a.adler=Yc(a.adler,c,n,0));d.wrap=0;n>=d.w_size&&(0===b&&(Dc(d.head),d.strstart=0,d.block_start=0,d.insert=0),h=new Ga.Buf8(d.w_size),Ga.arraySet(h,c,n-d.w_size,d.w_size,0),c=h,n=d.w_size);h=a.avail_in;var g=a.next_in;var e=a.input;a.avail_in=n;a.next_in=0;a.input=c;for(Pc(d);d.lookahead>=3;){c=d.strstart;n=d.lookahead-2;do d.ins_h=(d.ins_h<<d.hash_shift^d.window[c+3-1])&d.hash_mask,d.prev[c&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=c,c++;while(--n);
d.strstart=c;d.lookahead=2;Pc(d)}return d.strstart+=d.lookahead,d.block_start=d.strstart,d.insert=d.lookahead,d.lookahead=0,d.match_length=d.prev_length=2,d.match_available=0,a.next_in=g,a.input=e,a.avail_in=h,d.wrap=b,0};var Ve=!0,Ue=!0;try{String.fromCharCode.apply(null,[0])}catch(a){Ve=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(a){Ue=!1}for(var ud=new Ga.Buf8(256),Hc=0;Hc<256;Hc++)ud[Hc]=Hc>=252?6:Hc>=248?5:Hc>=240?4:Hc>=224?3:Hc>=192?2:1;"use strict";ud[254]=ud[254]=1;var he=
function(a){var c,d,b,h=a.length,n=0;for(b=0;b<h;b++)(64512&(c=a.charCodeAt(b)))==55296&&b+1<h&&(64512&(d=a.charCodeAt(b+1)))==56320&&(c=65536+(c-55296<<10)+(d-56320),b++),n+=c<128?1:c<2048?2:c<65536?3:4;var g=0;var e=new Ga.Buf8(n);for(b=0;g<n;b++)(64512&(c=a.charCodeAt(b)))==55296&&b+1<h&&(64512&(d=a.charCodeAt(b+1)))==56320&&(c=65536+(c-55296<<10)+(d-56320),b++),c<128?e[g++]=c:(c<2048?e[g++]=192|c>>>6:(c<65536?e[g++]=224|c>>>12:(e[g++]=240|c>>>18,e[g++]=128|c>>>12&63),e[g++]=128|c>>>6&63),e[g++]=
128|63&c);return e};var Lg=function(a){for(var c=new Ga.Buf8(a.length),d=0,b=c.length;d<b;d++)c[d]=a.charCodeAt(d);return c};var Mg=function(a,c){var d,b,h,n=c||a.length,g=Array(2*n);for(c=d=0;c<n;)if((b=a[c++])<128)g[d++]=b;else if((h=ud[b])>4)g[d++]=65533,c+=h-1;else{for(b&=2===h?31:3===h?15:7;h>1&&c<n;)b=b<<6|63&a[c++],h--;h>1?g[d++]=65533:b<65536?g[d++]=b:(b-=65536,g[d++]=55296|b>>10&1023,g[d++]=56320|1023&b)}return Te(g,d)};var Ng=function(a,c){var d;(c=c||a.length)>a.length&&(c=a.length);for(d=
c-1;d>=0&&(192&a[d])==128;)d--;return d<0||0===d?c:d+ud[a[d]]>c?d:c};var ge={};ge=function(){this.input=null;this.total_in=this.avail_in=this.next_in=0;this.output=null;this.total_out=this.avail_out=this.next_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0};var We=Object.prototype.toString;"use strict";"use strict";Qc.prototype.push=function(a,c){var d,b,h=this.strm,n=this.options.chunkSize;if(this.ended)return!1;c=c===~~c?c:4*(!0===c);"string"==typeof a?h.input=he(a):"[object ArrayBuffer]"===
We.call(a)?h.input=new Uint8Array(a):h.input=a;h.next_in=0;h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new Ga.Buf8(n),h.next_out=0,h.avail_out=n),1!==(b=Jg(h,c))&&0!==b)return this.onEnd(b),this.ended=!0,!1;(0===h.avail_out||0===h.avail_in&&(4===c||2===c))&&("string"===this.options.to?this.onData(Te(d=Ga.shrinkBuf(h.output,h.next_out),d.length)):this.onData(Ga.shrinkBuf(h.output,h.next_out)))}while((h.avail_in>0||0===h.avail_out)&&1!==b);return 4===c?(b=Kg(this.strm),this.onEnd(b),
this.ended=!0,0===b):(2===c&&(this.onEnd(0),h.avail_out=0),!0)};Qc.prototype.onData=function(a){this.chunks.push(a)};Qc.prototype.onEnd=function(a){0===a&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ga.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};var tf=Qc;var uf=ie;var vf=function(a,c){return(c=c||{}).raw=!0,ie(a,c)};var wf=function(a,c){return(c=c||{}).gzip=!0,ie(a,c)};"use strict";var vd={};zc(vd,"Inflate",function(){return zf},function(a){return zf=
a});zc(vd,"inflate",function(){return Af},function(a){return Af=a});zc(vd,"inflateRaw",function(){return Bf},function(a){return Bf=a});zc(vd,"ungzip",function(){return Cf},function(a){return Cf=a});"use strict";var Df={};Df=function(a,c){var d,b,h,n;var g=a.state;var e=a.next_in;var k=a.input;var l=e+(a.avail_in-5);var f=a.next_out;var m=a.output;c=f-(c-a.avail_out);var r=f+(a.avail_out-257);var q=g.dmax;var t=g.wsize;var v=g.whave;var x=g.wnext;var A=g.window;var B=g.hold;var y=g.bits;var E=g.lencode;
var G=g.distcode;var M=(1<<g.lenbits)-1;var L=(1<<g.distbits)-1;a:do for(y<15&&(B+=k[e++]<<y,y+=8,B+=k[e++]<<y,y+=8),d=E[B&M];;){if(B>>>=b=d>>>24,y-=b,0==(b=d>>>16&255))m[f++]=65535&d;else if(16&b){var J=65535&d;(b&=15)&&(y<b&&(B+=k[e++]<<y,y+=8),J+=B&(1<<b)-1,B>>>=b,y-=b);y<15&&(B+=k[e++]<<y,y+=8,B+=k[e++]<<y,y+=8);for(d=G[B&L];;){if(B>>>=b=d>>>24,y-=b,16&(b=d>>>16&255)){if(h=65535&d,y<(b&=15)&&(B+=k[e++]<<y,(y+=8)<b&&(B+=k[e++]<<y,y+=8)),(h+=B&(1<<b)-1)>q){a.msg="invalid distance too far back";
g.mode=30;break a}if(B>>>=b,y-=b,h>(b=f-c)){if((b=h-b)>v&&g.sane){a.msg="invalid distance too far back";g.mode=30;break a}if(d=0,n=A,0===x){if(d+=t-b,b<J){J-=b;do m[f++]=A[d++];while(--b);d=f-h;n=m}}else if(x<b){if(d+=t+x-b,(b-=x)<J){J-=b;do m[f++]=A[d++];while(--b);if(d=0,x<J){J-=b=x;do m[f++]=A[d++];while(--b);d=f-h;n=m}}}else if(d+=x-b,b<J){J-=b;do m[f++]=A[d++];while(--b);d=f-h;n=m}for(;J>2;)m[f++]=n[d++],m[f++]=n[d++],m[f++]=n[d++],J-=3;J&&(m[f++]=n[d++],J>1&&(m[f++]=n[d++]))}else{d=f-h;do m[f++]=
m[d++],m[f++]=m[d++],m[f++]=m[d++],J-=3;while(J>2);J&&(m[f++]=m[d++],J>1&&(m[f++]=m[d++]))}}else if((64&b)==0){d=G[(65535&d)+(B&(1<<b)-1)];continue}else{a.msg="invalid distance code";g.mode=30;break a}break}}else if((64&b)==0){d=E[(65535&d)+(B&(1<<b)-1)];continue}else{32&b?g.mode=12:(a.msg="invalid literal/length code",g.mode=30);break a}break}while(e<l&&f<r);e-=J=y>>3;y-=J<<3;a.next_in=e;a.next_out=f;a.avail_in=e<l?5+(l-e):5-(e-l);a.avail_out=f<r?257+(r-f):257-(f-r);g.hold=B&(1<<y)-1;g.bits=y};var dd=
{},Og=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Pg=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Qg=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Rg=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];dd=function(a,c,d,b,h,n,g,e){var k,l,f,m,r,q,t=e.bits,v,x,A,B,y,E=0,G,M=null,L=0,J=
new Ga.Buf16(16);var W=new Ga.Buf16(16);var ba=null,ma=0;for(v=0;v<=15;v++)J[v]=0;for(x=0;x<b;x++)J[c[d+x]]++;var na=15;for(A=t;na>=1&&0===J[na];na--);if(A>na&&(A=na),0===na)return h[n++]=20971520,h[n++]=20971520,e.bits=1,0;for(t=1;t<na&&0===J[t];t++);A<t&&(A=t);for(v=k=1;v<=15;v++)if(k<<=1,(k-=J[v])<0)return-1;if(k>0&&(0===a||1!==na))return-1;v=1;for(W[1]=0;v<15;v++)W[v+1]=W[v]+J[v];for(x=0;x<b;x++)0!==c[d+x]&&(g[W[c[d+x]]++]=x);if(0===a?(M=ba=g,m=19):1===a?(M=Og,L-=257,ba=Pg,ma-=257,m=256):(M=Qg,
ba=Rg,m=-1),G=0,x=0,v=t,W=n,B=A,y=0,f=-1,b=(E=1<<A)-1,1===a&&E>852||2===a&&E>592)return 1;for(;;){var H=v-y;g[x]<m?(r=0,q=g[x]):g[x]>m?(r=ba[ma+g[x]],q=M[L+g[x]]):(r=96,q=0);k=1<<v-y;t=l=1<<B;do h[W+(G>>y)+(l-=k)]=H<<24|r<<16|q;while(0!==l);for(k=1<<v-1;G&k;)k>>=1;if(0!==k?(G&=k-1,G+=k):G=0,x++,0==--J[v]){if(v===na)break;v=c[d+g[x]]}if(v>A&&(G&b)!==f){0===y&&(y=A);W+=t;for(k=1<<(B=v-y);B+y<na&&!((k-=J[B+y])<=0);)B++,k<<=1;if(E+=1<<B,1===a&&E>852||2===a&&E>592)return 1;h[f=G&b]=A<<24|B<<16|W-n}}return 0!==
G&&(h[W+G]=v-y<<24|4194304),e.bits=A,0};var Ef=!0;"use strict";var Sg=function(a,c){var d,b,h,n,g,e,k,l,f=0,m=new Ga.Buf8(4),r=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return-2;12===(d=a.state).mode&&(d.mode=13);var q=a.next_out;var t=a.output;var v=a.avail_out;var x=a.next_in;var A=a.input;var B=a.avail_in;var y=d.hold;var E=d.bits;var G=B;var M=v;var L=0;a:for(;;)switch(d.mode){case 1:if(0===d.wrap){d.mode=13;break}for(;E<16;){if(0===
B)break a;B--;y+=A[x++]<<E;E+=8}if(2&d.wrap&&35615===y){d.check=0;m[0]=255&y;m[1]=y>>>8&255;d.check=Lb(d.check,m,2,0);E=y=0;d.mode=2;break}if(d.flags=0,d.head&&(d.head.done=!1),!(1&d.wrap)||(((255&y)<<8)+(y>>8))%31){a.msg="incorrect header check";d.mode=30;break}if((15&y)!=8){a.msg="unknown compression method";d.mode=30;break}if(y>>>=4,E-=4,k=(15&y)+8,0===d.wbits)d.wbits=k;else if(k>d.wbits){a.msg="invalid window size";d.mode=30;break}d.dmax=1<<k;a.adler=d.check=1;d.mode=512&y?10:12;E=y=0;break;case 2:for(;E<
16;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}if(d.flags=y,(255&d.flags)!=8){a.msg="unknown compression method";d.mode=30;break}if(57344&d.flags){a.msg="unknown header flags set";d.mode=30;break}d.head&&(d.head.text=y>>8&1);512&d.flags&&(m[0]=255&y,m[1]=y>>>8&255,d.check=Lb(d.check,m,2,0));E=y=0;d.mode=3;case 3:for(;E<32;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}d.head&&(d.head.time=y);512&d.flags&&(m[0]=255&y,m[1]=y>>>8&255,m[2]=y>>>16&255,m[3]=y>>>24&255,d.check=Lb(d.check,m,4,0));E=y=0;d.mode=4;case 4:for(;E<
16;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}d.head&&(d.head.xflags=255&y,d.head.os=y>>8);512&d.flags&&(m[0]=255&y,m[1]=y>>>8&255,d.check=Lb(d.check,m,2,0));E=y=0;d.mode=5;case 5:if(1024&d.flags){for(;E<16;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}d.length=y;d.head&&(d.head.extra_len=y);512&d.flags&&(m[0]=255&y,m[1]=y>>>8&255,d.check=Lb(d.check,m,2,0));E=y=0}else d.head&&(d.head.extra=null);d.mode=6;case 6:if(1024&d.flags&&((b=d.length)>B&&(b=B),b&&(d.head&&(k=d.head.extra_len-d.length,d.head.extra||
(d.head.extra=Array(d.head.extra_len)),Ga.arraySet(d.head.extra,A,x,b,k)),512&d.flags&&(d.check=Lb(d.check,A,b,x)),B-=b,x+=b,d.length-=b),d.length))break a;d.length=0;d.mode=7;case 7:if(2048&d.flags){if(0===B)break a;b=0;do k=A[x+b++],d.head&&k&&d.length<65536&&(d.head.name+=String.fromCharCode(k));while(k&&b<B);if(512&d.flags&&(d.check=Lb(d.check,A,b,x)),B-=b,x+=b,k)break a}else d.head&&(d.head.name=null);d.length=0;d.mode=8;case 8:if(4096&d.flags){if(0===B)break a;b=0;do k=A[x+b++],d.head&&k&&d.length<
65536&&(d.head.comment+=String.fromCharCode(k));while(k&&b<B);if(512&d.flags&&(d.check=Lb(d.check,A,b,x)),B-=b,x+=b,k)break a}else d.head&&(d.head.comment=null);d.mode=9;case 9:if(512&d.flags){for(;E<16;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}if(y!==(65535&d.check)){a.msg="header crc mismatch";d.mode=30;break}E=y=0}d.head&&(d.head.hcrc=d.flags>>9&1,d.head.done=!0);a.adler=d.check=0;d.mode=12;break;case 10:for(;E<32;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}a.adler=d.check=Xe(y);E=y=0;d.mode=11;case 11:if(0===
d.havedict)return a.next_out=q,a.avail_out=v,a.next_in=x,a.avail_in=B,d.hold=y,d.bits=E,2;a.adler=d.check=1;d.mode=12;case 12:if(5===c||6===c)break a;case 13:if(d.last){y>>>=7&E;E-=7&E;d.mode=27;break}for(;E<3;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}switch(d.last=1&y,--E,3&(y>>>=1)){case 0:d.mode=14;break;case 1:var J=d;if(Ef){te=new Ga.Buf32(512);ue=new Ga.Buf32(32);for(n=0;n<144;)J.lens[n++]=8;for(;n<256;)J.lens[n++]=9;for(;n<280;)J.lens[n++]=7;for(;n<288;)J.lens[n++]=8;dd(1,J.lens,0,288,te,0,
J.work,{bits:9});for(n=0;n<32;)J.lens[n++]=5;dd(2,J.lens,0,32,ue,0,J.work,{bits:5});Ef=!1}J.lencode=te;J.lenbits=9;J.distcode=ue;J.distbits=5;if(!0,d.mode=20,6===c){y>>>=2;E-=2;break a}break;case 2:d.mode=17;break;case 3:a.msg="invalid block type",d.mode=30}y>>>=2;E-=2;break;case 14:y>>>=7&E;for(E-=7&E;E<32;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}if((65535&y)!=(y>>>16^65535)){a.msg="invalid stored block lengths";d.mode=30;break}if(d.length=65535&y,y=0,E=0,d.mode=15,6===c)break a;case 15:d.mode=16;
case 16:if(b=d.length){if(b>B&&(b=B),b>v&&(b=v),0===b)break a;Ga.arraySet(t,A,x,b,q);B-=b;x+=b;v-=b;q+=b;d.length-=b;break}d.mode=12;break;case 17:for(;E<14;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}if(d.nlen=(31&y)+257,E-=5,d.ndist=(31&(y>>>=5))+1,E-=5,d.ncode=(15&(y>>>=5))+4,y>>>=4,E-=4,d.nlen>286||d.ndist>30){a.msg="too many length or distance symbols";d.mode=30;break}d.have=0;d.mode=18;case 18:for(;d.have<d.ncode;){for(;E<3;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}d.lens[r[d.have++]]=7&y;y>>>=
3;E-=3}for(;d.have<19;)d.lens[r[d.have++]]=0;if(d.lencode=d.lendyn,d.lenbits=7,l={bits:d.lenbits},L=dd(0,d.lens,0,19,d.lencode,0,d.work,l),d.lenbits=l.bits,L){a.msg="invalid code lengths set";d.mode=30;break}d.have=0;d.mode=19;case 19:for(;d.have<d.nlen+d.ndist;){for(;g=(f=d.lencode[y&(1<<d.lenbits)-1])>>>24,J=65535&f,!(g<=E);){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}if(J<16)y>>>=g,E-=g,d.lens[d.have++]=J;else{if(16===J){for(n=g+2;E<n;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}if(y>>>=g,E-=g,0===d.have){a.msg=
"invalid bit length repeat";d.mode=30;break}k=d.lens[d.have-1];b=3+(3&y);y>>>=2;E-=2}else if(17===J){for(n=g+3;E<n;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}y>>>=g;E-=g;k=0;b=3+(7&y);y>>>=3;E-=3}else{for(n=g+7;E<n;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}y>>>=g;E-=g;k=0;b=11+(127&y);y>>>=7;E-=7}if(d.have+b>d.nlen+d.ndist){a.msg="invalid bit length repeat";d.mode=30;break}for(;b--;)d.lens[d.have++]=k}}if(30===d.mode)break;if(0===d.lens[256]){a.msg="invalid code -- missing end-of-block";d.mode=30;break}if(d.lenbits=
9,l={bits:d.lenbits},L=dd(1,d.lens,0,d.nlen,d.lencode,0,d.work,l),d.lenbits=l.bits,L){a.msg="invalid literal/lengths set";d.mode=30;break}if(d.distbits=6,d.distcode=d.distdyn,l={bits:d.distbits},L=dd(2,d.lens,d.nlen,d.ndist,d.distcode,0,d.work,l),d.distbits=l.bits,L){a.msg="invalid distances set";d.mode=30;break}if(d.mode=20,6===c)break a;case 20:d.mode=21;case 21:if(B>=6&&v>=258){a.next_out=q;a.avail_out=v;a.next_in=x;a.avail_in=B;d.hold=y;d.bits=E;Df(a,M);q=a.next_out;t=a.output;v=a.avail_out;x=
a.next_in;A=a.input;B=a.avail_in;y=d.hold;E=d.bits;12===d.mode&&(d.back=-1);break}for(d.back=0;g=(f=d.lencode[y&(1<<d.lenbits)-1])>>>24,n=f>>>16&255,J=65535&f,!(g<=E);){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}if(n&&(240&n)==0){var W=g;var ba=n;for(e=J;g=(f=d.lencode[e+((y&(1<<W+ba)-1)>>W)])>>>24,n=f>>>16&255,J=65535&f,!(W+g<=E);){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}y>>>=W;E-=W;d.back+=W}if(y>>>=g,E-=g,d.back+=g,d.length=J,0===n){d.mode=26;break}if(32&n){d.back=-1;d.mode=12;break}if(64&n){a.msg=
"invalid literal/length code";d.mode=30;break}d.extra=15&n;d.mode=22;case 22:if(d.extra){for(n=d.extra;E<n;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}d.length+=y&(1<<d.extra)-1;y>>>=d.extra;E-=d.extra;d.back+=d.extra}d.was=d.length;d.mode=23;case 23:for(;g=(f=d.distcode[y&(1<<d.distbits)-1])>>>24,n=f>>>16&255,J=65535&f,!(g<=E);){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}if((240&n)==0){W=g;ba=n;for(e=J;g=(f=d.distcode[e+((y&(1<<W+ba)-1)>>W)])>>>24,n=f>>>16&255,J=65535&f,!(W+g<=E);){if(0===B)break a;B--;
y+=A[x++]<<E;E+=8}y>>>=W;E-=W;d.back+=W}if(y>>>=g,E-=g,d.back+=g,64&n){a.msg="invalid distance code";d.mode=30;break}d.offset=J;d.extra=15&n;d.mode=24;case 24:if(d.extra){for(n=d.extra;E<n;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}d.offset+=y&(1<<d.extra)-1;y>>>=d.extra;E-=d.extra;d.back+=d.extra}if(d.offset>d.dmax){a.msg="invalid distance too far back";d.mode=30;break}d.mode=25;case 25:if(0===v)break a;if(b=M-v,d.offset>b){if((b=d.offset-b)>d.whave&&d.sane){a.msg="invalid distance too far back";d.mode=
30;break}b>d.wnext?(b-=d.wnext,h=d.wsize-b):h=d.wnext-b;b>d.length&&(b=d.length);n=d.window}else n=t,h=q-d.offset,b=d.length;b>v&&(b=v);v-=b;d.length-=b;do t[q++]=n[h++];while(--b);0===d.length&&(d.mode=21);break;case 26:if(0===v)break a;t[q++]=d.length;v--;d.mode=21;break;case 27:if(d.wrap){for(;E<32;){if(0===B)break a;B--;y|=A[x++]<<E;E+=8}if(M-=v,a.total_out+=M,d.total+=M,M&&(a.adler=d.check=d.flags?Lb(d.check,t,M,q-M):Yc(d.check,t,M,q-M)),M=v,(d.flags?y:Xe(y))!==d.check){a.msg="incorrect data check";
d.mode=30;break}E=y=0}d.mode=28;case 28:if(d.wrap&&d.flags){for(;E<32;){if(0===B)break a;B--;y+=A[x++]<<E;E+=8}if(y!==(0|d.total)){a.msg="incorrect length check";d.mode=30;break}E=y=0}d.mode=29;case 29:L=1;break a;case 30:L=-3;break a;case 31:return-4;default:return-2}return(a.next_out=q,a.avail_out=v,a.next_in=x,a.avail_in=B,d.hold=y,d.bits=E,(d.wsize||M!==a.avail_out&&d.mode<30&&(d.mode<27||4!==c))&&Ye(a,a.output,a.next_out,M-a.avail_out))?(d.mode=31,-4):(G-=a.avail_in,M-=a.avail_out,a.total_in+=
G,a.total_out+=M,d.total+=M,d.wrap&&M&&(a.adler=d.check=d.flags?Lb(d.check,t,M,a.next_out-M):Yc(d.check,t,M,a.next_out-M)),a.data_type=d.bits+64*!!d.last+128*(12===d.mode)+256*(20===d.mode||15===d.mode),(0===G&&0===M||4===c)&&0===L&&(L=-5),L)};var Tg=function(a){if(!a||!a.state)return-2;var c=a.state;return c.window&&(c.window=null),a.state=null,0};var fg=function(a,c){var d;return a&&a.state&&(2&(d=a.state).wrap)!=0?(d.head=c,c.done=!1,0):-2};var af=function(a,c){var d,b=c.length;return a&&a.state&&
(0===(d=a.state).wrap||11===d.mode)?11===d.mode&&Yc(1,c,b,0)!==d.check?-3:Ye(a,c,b,b)?(d.mode=31,-4):(d.havedict=1,0):-2};"use strict";var Eb={};Eb={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,
Z_UNKNOWN:2,Z_DEFLATED:8};var Ze={};Ze=function(){this.os=this.xflags=this.time=this.text=0;this.extra=null;this.extra_len=0;this.comment=this.name="";this.hcrc=0;this.done=!1};var $e=Object.prototype.toString;Rc.prototype.push=function(a,c){var d,b,h,n,g=this.strm,e=this.options.chunkSize,k=this.options.dictionary,l=!1;if(this.ended)return!1;c=c===~~c?c:!0===c?Eb.Z_FINISH:Eb.Z_NO_FLUSH;"string"==typeof a?g.input=Lg(a):"[object ArrayBuffer]"===$e.call(a)?g.input=new Uint8Array(a):g.input=a;g.next_in=
0;g.avail_in=g.input.length;do{if(0===g.avail_out&&(g.output=new Ga.Buf8(e),g.next_out=0,g.avail_out=e),(d=Sg(g,Eb.Z_NO_FLUSH))===Eb.Z_NEED_DICT&&k&&(d=af(this.strm,k)),d===Eb.Z_BUF_ERROR&&!0===l&&(d=Eb.Z_OK,l=!1),d!==Eb.Z_STREAM_END&&d!==Eb.Z_OK)return this.onEnd(d),this.ended=!0,!1;g.next_out&&(0===g.avail_out||d===Eb.Z_STREAM_END||0===g.avail_in&&(c===Eb.Z_FINISH||c===Eb.Z_SYNC_FLUSH))&&("string"===this.options.to?(b=Ng(g.output,g.next_out),h=g.next_out-b,n=Mg(g.output,b),g.next_out=h,g.avail_out=
e-h,h&&Ga.arraySet(g.output,g.output,b,h,0),this.onData(n)):this.onData(Ga.shrinkBuf(g.output,g.next_out)));0===g.avail_in&&0===g.avail_out&&(l=!0)}while((g.avail_in>0||0===g.avail_out)&&d!==Eb.Z_STREAM_END);return(d===Eb.Z_STREAM_END&&(c=Eb.Z_FINISH),c===Eb.Z_FINISH)?(d=Tg(this.strm),this.onEnd(d),this.ended=!0,d===Eb.Z_OK):(c===Eb.Z_SYNC_FLUSH&&(this.onEnd(Eb.Z_OK),g.avail_out=0),!0)};Rc.prototype.onData=function(a){this.chunks.push(a)};Rc.prototype.onEnd=function(a){a===Eb.Z_OK&&("string"===this.options.to?
this.result=this.chunks.join(""):this.result=Ga.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};var zf=Rc;var Af=je;var Bf=function(a,c){return(c=c||{}).raw=!0,je(a,c)};var Cf=je;var Ff={};Fg(Ff,sd,vd,Eb);me=Ff;ke.FIXED_HEADER_LENGTH=16;Bd.HEADER_LENGTH=8;class Gf{readFixedHeader(a){this.payloadOffset=a.readU32BE();this.blendMode=a.readU32BE();this.alpha=a.readU32BE();let c=a.readU32BE();this.visible=(1&c)!=0;this.clip=(2&c)!=0;this.hasMask=(4&c)!=0;this.maskLinked=(8&
c)!=0;this.maskVisible=(16&c)!=0;this.expanded=(32&c)!=0;this.lockAlpha=(64&c)!=0;this.blendMode===I.LM_MULTIPLY&&(128&c)!=0&&(this.blendMode=I.LM_MULTIPLY2);this.nameLength=a.readU32BE()}getFixedHeaderLen(){return 20}getVariableHeaderLen(){return this.nameLength}readVariableSizeHeader(a){a=a.readString(this.nameLength);let c=new Uint8Array(a.length);for(let d=0;d<a.length;d++)c[d]=255&a.charCodeAt(d);try{this.name=(new TextDecoder("utf-8")).decode(c)}catch(d){this.name=a}}decode(a){for(var c;;){if(this.skipBytes>
0){if(this.skipBytes>=a.length)return this.skipBytes-=a.length,null;a=a.subarray(this.skipBytes);this.skipBytes=0}switch(this.state){case 0:if(a.length<this.getFixedHeaderLen())break;c=new Ya(a);this.readFixedHeader(c);a=a.subarray(c.pos);this.state=1;continue;case 1:if(a.length<this.getVariableHeaderLen())break;c=new Ya(a);this.readVariableSizeHeader(c);this.layer=this.createLayer();this.hasMask&&(this.layer.setMask(new Ba(this.width,this.height,8)),this.maskDecoder=new Ug(this.layer.mask));this.layer instanceof
ta&&(this.colorDecoder=new Vg(this.layer.image));this.skipBytes=this.payloadOffset-this.getFixedHeaderLen();this.colorDecoder?this.state=3:this.maskDecoder?this.state=4:this.state=5;continue;case 3:if(a=this.colorDecoder.decode(a),this.colorDecoder.done){this.maskDecoder?this.state=4:this.state=5;continue}break;case 4:if(a=this.maskDecoder.decode(a),this.maskDecoder.done){this.state=5;continue}break;case 5:c=this.payloadOffset;this.colorDecoder&&(c+=this.colorDecoder.bytesTotal);this.maskDecoder&&
(c+=this.maskDecoder.bytesTotal);this.state=6;this.skipBytes=this.chunkHeader.chunkSize-c;continue;case 6:this.done=!0}break}return a}constructor(a,c,d){this.chunkHeader=a;this.width=c;this.height=d;this.nameLength=this.skipBytes=this.payloadOffset=this.state=0;this.done=!1;this.maskDecoder=this.colorDecoder=null}}class gg extends Gf{createLayer(){let a=new ta(this.width,this.height,this.name);return a.setBlendMode(this.blendMode),a.setAlpha(this.alpha),a.setVisible(this.visible),a.setClip(this.clip),
a.setMaskLinked(this.maskLinked),a.setMaskVisible(this.maskVisible),a.setLockAlpha(this.lockAlpha),a}}class hg extends Gf{readFixedHeader(a){super.readFixedHeader.call(this,a);this.childLayers=a.readU32BE()}getFixedHeaderLen(){return super.getFixedHeaderLen.call(this)+4}createLayer(){let a=new Ua(this.name,this.blendMode);return a.setAlpha(this.alpha),a.setVisible(this.visible),a.setExpanded(this.expanded),a.setMaskLinked(this.maskLinked),a.setMaskVisible(this.maskVisible),a}constructor(a,c,d){super(a,
c,d);this.childLayers=0}}class Vg{decode(a){if(null==a)return null;var c=this.bytesRead%C.BYTES_PER_PIXEL,d=this.bytesRead-c;let b=0,h=[C.ALPHA_BYTE_OFFSET,C.RED_BYTE_OFFSET,C.GREEN_BYTE_OFFSET,C.BLUE_BYTE_OFFSET];for(;c<C.BYTES_PER_PIXEL&&b<a.length;c++)this.output[d+h[c]]=a[b],b++;this.bytesRead+=b;var n=0|Math.min(a.length-b,this.bytesTotal-this.bytesRead);c=n/C.BYTES_PER_PIXEL|0;n%=C.BYTES_PER_PIXEL;for(d=0;d<c;d++)this.output[this.bytesRead+C.ALPHA_BYTE_OFFSET]=a[b],this.output[this.bytesRead+
C.RED_BYTE_OFFSET]=a[b+1],this.output[this.bytesRead+C.GREEN_BYTE_OFFSET]=a[b+2],this.output[this.bytesRead+C.BLUE_BYTE_OFFSET]=a[b+3],this.bytesRead+=C.BYTES_PER_PIXEL,b+=C.BYTES_PER_PIXEL;c=0;for(d=this.bytesRead;c<n;c++)this.output[d+h[c]]=a[b],b++;return(this.bytesRead+=n,this.bytesRead>=this.bytesTotal&&(this.done=!0),b<a.length)?a.subarray(b):null}constructor(a){this.bytesRead=0;this.bytesTotal=a.width*a.height*C.BYTES_PER_PIXEL;this.output=a.data;this.done=!1}}class Ug{decode(a){if(null==a)return null;
let c=0|Math.min(a.length,this.bytesTotal-this.bytesRead),d=this.bytesRead,b;for(b=0;b<c;b++,d++)this.output[d]=a[b];return(this.bytesRead=d,this.bytesRead>=this.bytesTotal&&(this.done=!0),b<a.length)?a.subarray(b):null}constructor(a){this.bytesRead=0;this.bytesTotal=a.width*a.height;this.output=a.data;this.done=!1}}$c.prototype.read=function(a){if(null==a)return null;var c=new Ya(new Uint8Array(a)),d=[];if(1!=c.readU16BE())return null;a=c.readU16BE();for(var b=0;b<a;b++)if(0==c.readU16BE()){var h=
255*c.readU16BE()/65535,n=255*c.readU16BE()/65535,g=255*c.readU16BE()/65535;c.readU16BE();d.push(h<<16|n<<8|g)}return d};$c.prototype.write=function(a){var c=new Ya(new Uint8Array(4+10*a.length));c.writeU16BE(1);c.writeU16BE(a.length);for(var d=0;d<a.length;d++){var b=a[d];c.writeU16BE(0);c.writeU16BE((b>>16&255)*257);c.writeU16BE((b>>8&255)*257);c.writeU16BE((255&b)*257);c.writeU16BE(0)}return c.getAsDataArray()};Cd.prototype=Object.create(ya(Hb).prototype);Cd.prototype.constructor=Cd;var pd={};
var Hf=function(){function a(g,e,k){var l=new XMLHttpRequest;l.open("GET",g);l.responseType="blob";l.onload=function(){n(l.response,e,k)};l.onerror=function(){console.error("could not download file")};l.send()}function c(g){var e=new XMLHttpRequest;e.open("HEAD",g,!1);try{e.send()}catch(k){}return 200<=e.status&&299>=e.status}function d(g){try{g.dispatchEvent(new MouseEvent("click"))}catch(k){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,
null);g.dispatchEvent(e)}}var b="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof Td&&Td.global===Td?Td:void 0,h=b.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),n=b.saveAs||("object"!=typeof window||window!==b?function(){}:"download"in HTMLAnchorElement.prototype&&!h?function(g,e,k){var l=b.URL||b.webkitURL,f=document.createElement("a");f.download=e=e||
g.name||"download";f.rel="noopener";"string"==typeof g?(f.href=g,f.origin===location.origin?d(f):c(f.href)?a(g,e,k):d(f,f.target="_blank")):(f.href=l.createObjectURL(g),setTimeout(function(){l.revokeObjectURL(f.href)},4E4),setTimeout(function(){d(f)},0))}:"msSaveOrOpenBlob"in navigator?function(g,e,k){if(e=e||g.name||"download","string"!=typeof g){var l;navigator.msSaveOrOpenBlob((void 0===(l=k)?l={autoBom:!1}:"object"!=typeof l&&(console.warn("Deprecated: Expected third argument to be a object"),
l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(g.type)?new Blob(["\ufeff",g],{type:g.type}):g),e)}else if(c(g))a(g,e,k);else{var f=document.createElement("a");f.href=g;f.target="_blank";setTimeout(function(){d(f)})}}:function(g,e,k,l){if((l=l||open("","_blank"))&&(l.document.title=l.document.body.innerText="downloading..."),"string"==typeof g)return a(g,e,k);e="application/octet-stream"===g.type;k=/constructor/i.test(b.HTMLElement)||b.safari;
var f=/CriOS\/[\d]+/.test(navigator.userAgent);if((f||e&&k||h)&&"undefined"!=typeof FileReader){var m=new FileReader;m.onloadend=function(){var t=m.result;t=f?t:t.replace(/^data:[^;]*;/,"data:attachment/file;");l?l.location.href=t:location=t;l=null};m.readAsDataURL(g)}else{var r=b.URL||b.webkitURL,q=r.createObjectURL(g);l?l.location=q:location.href=q;l=null;setTimeout(function(){r.revokeObjectURL(q)},4E4)}});pd=b.saveAs=n.saveAs=n};"function"==typeof define&&define.amd?define([],Hf):Hf();var Ed={};
Ed=JSON.parse('{"Dodge (tool)":"Dodge","Burn (tool)":"Burn","Color (picker)":"Color","Color swatches (shorter)":"Swatches"}');let oe={ja:JSON.parse('{"File":"\u30d5\u30a1\u30a4\u30eb","Save to my computer":"PC\u306b\u4fdd\u5b58","Post Oekaki":"\u753b\u50cf\u3092\u6295\u7a3f","Edit":"\u7de8\u96c6","Undo":"\u53d6\u308a\u6d88\u3057","Redo":"\u3084\u308a\u76f4\u3057","Cut":"\u5207\u308a\u53d6\u308a","Copy":"\u30b3\u30d4\u30fc","Clear history":"\u5c65\u6b74\u6d88\u53bb","Copy merged":"\u7d50\u5408\u30b3\u30d4\u30fc","Paste":"\u8cbc\u308a\u4ed8\u3051","Select all":"\u3059\u3079\u3066\u9078\u629e","Deselect":"\u9078\u629e\u89e3\u9664","Transform":"\u5909\u5f62","Selection":"\u9078\u629e\u7bc4\u56f2","Constrain":"\u7e26\u6a2a\u6bd4\u3092\u7dad\u6301","Layers":"\u30ec\u30a4\u30e4\u30fc","Duplicate":"\u8907\u88fd","Merge down":"\u4e0b\u306e\u30ec\u30a4\u30e4\u30fc\u3068\u7d50\u5408","Merge group":"\u30b0\u30eb\u30fc\u30d7\u7d50\u5408","Merge all layers":"\u5168\u30ec\u30a4\u30e4\u30fc\u7d50\u5408","Create merged layer":"\u7d50\u5408\u30ec\u30a4\u30e4\u30fc\u3092\u8ffd\u52a0","Add layer mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u8ffd\u52a0","Delete mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u524a\u9664","Delete layer mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u524a\u9664","Apply mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u9069\u7528","Apply layer mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u9069\u7528","Disable mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u7121\u52b9\u5316","Enable mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u6709\u52b9\u5316","Clip to the layer below":"\u4e0b\u306e\u30ec\u30a4\u30e4\u30fc\u3067\u30af\u30ea\u30c3\u30d4\u30f3\u30b0","Unclip from the layer below":"\u30af\u30ea\u30c3\u30d4\u30f3\u30b0\u89e3\u9664","Effects":"\u52b9\u679c","Clear":"\u6d88\u53bb","Clear with texture":"\u30c6\u30af\u30b9\u30c1\u30e3\u3067\u6d88\u53bb","Fill":"\u5857\u308a\u6f70\u3057","Flip horizontal":"\u5de6\u53f3\u53cd\u8ee2","Flip vertical":"\u4e0a\u4e0b\u53cd\u8ee2","Invert":"\u30cd\u30ac\u30dd\u30b8\u53cd\u8ee2","Convert brightness to opacity":"\u8f1d\u5ea6\u3092\u900f\u660e\u5ea6\u306b\u5909\u63db","Box blur...":"\u307c\u304b\u3057","Box blur":"\u307c\u304b\u3057","Blur amount (pixels)":"\u307c\u304b\u3057\u91cf (\u30d4\u30af\u30bb\u30eb\u5358\u4f4d)","Iterations (1-8, larger gives smoother blur)":"\u53cd\u5fa9 (1-8,\u5927\u304d\u3044\u307b\u3069\u307c\u304b\u3057\u304c\u6ed1\u3089\u304b)","Chromatic aberration":"\u8272\u53ce\u5dee (RGB\u305a\u3089\u3057)","Offset (pixels)":"\u30aa\u30d5\u30bb\u30c3\u30c8 (\u30d4\u30af\u30bb\u30eb\u5358\u4f4d)","Apply to all (create merged layer)":"\u5168\u4f53\u306b\u9069\u7528 (\u7d50\u5408\u30ec\u30a4\u30e4\u30fc\u3092\u8ffd\u52a0)","Monochromatic noise":"\u5358\u8272\u30ce\u30a4\u30ba","Color noise":"\u30ab\u30e9\u30fc\u30ce\u30a4\u30ba","View":"\u8868\u793a","Full-screen mode":"\u30d5\u30eb\u30b9\u30af\u30ea\u30fc\u30f3\u30e2\u30fc\u30c9","Zoom in":"\u62e1\u5927","Zoom out":"\u7e2e\u5c0f","Zoom 100%":"100%","Reset Rotation":"\u56de\u8ee2\u3092\u30ea\u30bb\u30c3\u30c8","Smooth-out zoomed canvas":"\u30ba\u30fc\u30e0\u3092\u306a\u3081\u3089\u304b\u306b\u8868\u793a\u3059\u308b","Show grid":"\u30b0\u30ea\u30c3\u30c9\u3092\u8868\u793a","Grid options...":"\u30b0\u30ea\u30c3\u30c9\u306e\u8a2d\u5b9a","Palettes":"\u30d1\u30ec\u30c3\u30c8","Rearrange":"\u521d\u671f\u5316","Toggle palettes":"\u8868\u793a\u975e\u8868\u793a\u5207\u308a\u66ff\u3048","Mobile mode":"\u30e2\u30d0\u30a4\u30eb\u30e2\u30fc\u30c9","PC mode":"PC\u30e2\u30fc\u30c9","Use old icons":"\u53e4\u3044\u30a2\u30a4\u30b3\u30f3","Show tool options":"\u30c4\u30fc\u30eb\u30aa\u30d7\u30b7\u30e7\u30f3","Show color":"\u30ab\u30e9\u30fc","Show layers":"\u30ec\u30a4\u30e4\u30fc","Show misc":"\u64cd\u4f5c","Show stroke":"\u30b9\u30c8\u30ed\u30fc\u30af","Show swatches":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8","Show textures":"\u30c6\u30af\u30b9\u30c1\u30e3","Show tools":"\u30c4\u30fc\u30eb","Help":"\u30d8\u30eb\u30d7","Tablet support":"\u30bf\u30d6\u30ec\u30c3\u30c8\u30b5\u30dd\u30fc\u30c8","Shortcuts":"\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8","About":"ChickenPaint Be\u306b\u3064\u3044\u3066","Removes all undo/redo information to regain memory":"\u5c65\u6b74\u3092\u30af\u30ea\u30a2\u3057\u3066\u30e1\u30e2\u30ea\u3092\u958b\u653e\u3057\u307e\u3059","Clears the selected area":"\u6d88\u53bb","Invert the image colors":"\u30cd\u30ac\u30dd\u30b8\u53cd\u8ee2","Blur effect":"\u307c\u304b\u3057\u30d5\u30a3\u30eb\u30bf","Fills the selection with noise":"\u5358\u8272\u30ce\u30a4\u30ba\u3067\u5857\u308a\u6f70\u3057","Fills the selection with colored noise":"\u30ab\u30e9\u30fc\u30ce\u30a4\u30ba\u3067\u5857\u308a\u6f70\u3057","Linear interpolation is used to give a smoothed looked to the picture when zoomed in":"\u753b\u50cf\u306e\u62e1\u5927\u6642\u306b\u88dc\u5b8c\u3057\u3066\u6ed1\u3089\u304b\u306b\u8868\u793a\u3057\u307e\u3059","Rearrange the palette windows":"\u30d1\u30ec\u30c3\u30c8\u3092\u518d\u914d\u7f6e","Hides or shows all palettes":"\u30d1\u30ec\u30c3\u30c8\u306e\u8868\u793a/\u975e\u8868\u793a","You\'re about to clear the current Undo/Redo history.\\nThis operation cannot be undone, are you sure you want to do that?":"\u30a2\u30f3\u30c9\u30a5\u30fb\u30ea\u30c9\u30a5\u306e\u5c65\u6b74\u3092\u6d88\u53bb\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u3002\\n\u3053\u306e\u64cd\u4f5c\u306f\u5143\u306b\u623b\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\u672c\u5f53\u306b\u5b9f\u884c\u3057\u307e\u3059\u304b?","Misc":"\u64cd\u4f5c","Round Pixelated":"\u5186\u30d4\u30af\u30bb\u30eb","Round Hard Edge":"\u5186\u30cf\u30fc\u30c9\u30a8\u30c3\u30b8","Round Soft":"\u5186\u30bd\u30d5\u30c8","Square Pixelated":"\u89d2\u30d4\u30af\u30bb\u30eb","Square Hard Edge":"\u89d2\u30cf\u30fc\u30c9\u30a8\u30c3\u30b8","Color (picker)":"\u30ab\u30e9\u30fc","Tool options":"\u30c4\u30fc\u30eb\u30aa\u30d7\u30b7\u30e7\u30f3","Brush size":"\u30d6\u30e9\u30b7\u30b5\u30a4\u30ba","Opacity":"\u4e0d\u900f\u660e\u5ea6","Color":"\u8272\u88dc\u5145","Blend":"\u6df7\u8272","Spacing":"\u9593\u9694","Scattering":"\u6563\u4e71","Smoothing":"\u624b\u3076\u308c\u88dc\u6b63","Rotation":"\u89d2\u5ea6","Color swatches":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8","Color swatches (shorter)":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8","Remove":"\u524a\u9664","Replace with current color":"\u9078\u629e\u4e2d\u306e\u8272\u306b\u7f6e\u304d\u63db\u3048","Save swatches to your computer...":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8\u3092PC\u306b\u4fdd\u5b58","Load swatches from your computer...":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8\u3092PC\u304b\u3089\u8aad\u307f\u8fbc\u307f","Add the current brush color as a new swatch":"\u9078\u629e\u4e2d\u306e\u8272\u3092\u8ffd\u52a0","Refer all layers":"\u5168\u30ec\u30a4\u30e4\u30fc\u53c2\u7167","Blend all layers":"\u5168\u30ec\u30a4\u30e4\u30fc\u6df7\u5408","Lock transparency":"\u900f\u660e\u90e8\u5206\u3092\u4fdd\u8b77","Textures":"\u30c6\u30af\u30b9\u30c1\u30e3","Customize":"\u30ab\u30b9\u30bf\u30de\u30a4\u30ba","Inverse":"\u30cd\u30ac\u30dd\u30b8\u53cd\u8ee2","Mirror":"\u5de6\u53f3\u53cd\u8ee2","Brightness":"\u8f1d\u5ea6","Contrast":"\u30b3\u30f3\u30c8\u30e9\u30b9\u30c8","Scale":"\u62e1\u5927\u7387","Reset":"\u30ea\u30bb\u30c3\u30c8","Layer blending mode":"\u5408\u6210\u30e2\u30fc\u30c9","Normal":"\u901a\u5e38","Multiply":"\u4e57\u7b97","Add":"\u52a0\u7b97","Screen":"\u30b9\u30af\u30ea\u30fc\u30f3","Lighten":"\u6bd4\u8f03(\u660e)","Darken":"\u6bd4\u8f03(\u6697)","Subtract":"\u6e1b\u7b97","Dodge":"\u8986\u3044\u713c\u304d","Burn":"\u713c\u304d\u8fbc\u307f","Overlay":"\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4","Hard Light":"\u30cf\u30fc\u30c9\u30e9\u30a4\u30c8","Soft Light":"\u30bd\u30d5\u30c8\u30e9\u30a4\u30c8","Vivid Light":"\u30d3\u30d3\u30c3\u30c9\u30e9\u30a4\u30c8","Linear Light":"\u30ea\u30cb\u30a2\u30e9\u30a4\u30c8","Pin Light":"\u30d4\u30f3\u30e9\u30a4\u30c8","Passthrough":"\u901a\u904e","Stroke":"\u30b9\u30c8\u30ed\u30fc\u30af","Free-hand":"\u30d5\u30ea\u30fc\u30cf\u30f3\u30c9","Straight line":"\u76f4\u7dda","Bezier curve":"Bz\uff08\u30d9\u30b8\u30a7\uff09\u66f2\u7dda","Tools":"\u30c4\u30fc\u30eb","Marquee":"\u9078\u629e\u7bc4\u56f2","Move tool":"\u79fb\u52d5","Flood fill":"\u30d0\u30b1\u30c4\u5857\u308a","Grow fill area":"\u9818\u57df\u62e1\u5f35","Gradient fill":"\u30b0\u30e9\u30c7\u30fc\u30b7\u30e7\u30f3","Color picker":"\u30b9\u30dd\u30a4\u30c8","Rotate canvas":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u56de\u8ee2","Grab canvas":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u4f4d\u7f6e","Pencil":"\u925b\u7b46","Pen":"\u30da\u30f3","Airbrush":"\u30a8\u30a2\u30d6\u30e9\u30b7","Waterpaint":"\u6c34\u5f69","Eraser":"\u6d88\u3057\u30b4\u30e0","Soft eraser":"\u8584\u6d88\u3057","Smudge":"\u6307\u5148","Blender":"\u6df7\u8272","Dodge (tool)":"\u8986\u3044\u713c\u304d","Burn (tool)":"\u713c\u304d\u8fbc\u307f","Blur":"\u307c\u304b\u3057","Grid options":"\u30b0\u30ea\u30c3\u30c9\u306e\u8a2d\u5b9a","Grid size":"\u30b0\u30ea\u30c3\u30c9\u30b5\u30a4\u30ba","Rename...":"\u540d\u524d\u3092\u5909\u66f4","Add layer":"\u65b0\u898f\u30ec\u30a4\u30e4\u30fc","Delete layer":"\u30ec\u30a4\u30e4\u30fc\u524a\u9664","Add group":"\u65b0\u898f\u30b0\u30eb\u30fc\u30d7","Delete group":"\u30b0\u30eb\u30fc\u30d7\u524a\u9664","Add mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u8ffd\u52a0","Gradient":"\u30b0\u30e9\u30c7\u30fc\u30b7\u30e7\u30f3\u4f5c\u6210","Zoom and Rotate":"\u30ba\u30fc\u30e0\u3068\u56de\u8ee2","Reset View":"\u8868\u793a\u3092\u521d\u671f\u5316","Transform style":"\u5909\u5f62\u30b9\u30bf\u30a4\u30eb","Apply transform":"\u5909\u5f62\u78ba\u5b9a","Complete transform":"\u5909\u5f62\u3092\u5b8c\u4e86","Undo transform":"\u53d6\u308a\u6d88\u3057","You need to finish transforming this layer before you can do that. What would you like to do with the transform?":"\u7d9a\u884c\u3059\u308b\u305f\u3081\u306b\u5909\u5f62\u3092\u5b8c\u4e86\u3057\u307e\u3059\u3002","Smooth":"\u30b9\u30e0\u30fc\u30ba","Sharp":"\u30b7\u30e3\u30fc\u30d7","Opacity: ":"\u4e0d\u900f\u660e\u5ea6:","Please enter a color in hex format":"16\u9032\u5f62\u5f0f\u3067\u8272\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\uff08#xxxxxx\u306e\u5f62\uff09","Cancel":"\u30ad\u30e3\u30f3\u30bb\u30eb","Ok":"OK","Okay":"OK","OK":"OK","Whoops! This layer is currently hidden":"\u975e\u8868\u793a\u30ec\u30a4\u30e4\u30fc\u3067\u3059\u3002","Whoops! This layer\'s opacity is currently 0%":"\u30ec\u30a4\u30e4\u30fc\u306e\u4e0d\u900f\u660e\u5ea6\u304c0%\u3067\u3059","Whoops! You can\'t draw on a group":"\u30b0\u30eb\u30fc\u30d7\u30d5\u30a9\u30eb\u30c0\u306b\u306f\u63cf\u3051\u307e\u305b\u3093","Whoops! All of the selected pixels are transparent!":"\u30ec\u30a4\u30e4\u30fc\u304c\u7a7a\u3067\u3059","Image":"\u753b\u50cf","Layer mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af","Sorry, you can\'t remove the last remaining layer in the drawing.":"\u6700\u5f8c\u306e1\u3064\u306a\u306e\u3067\u524a\u9664\u3067\u304d\u307e\u305b\u3093\u3002","Are you sure you want to send your drawing to the server and finish drawing now?":"\u753b\u50cf\u3092\u30b5\u30fc\u30d0\u30fc\u306b\u9001\u4fe1\u3057\u307e\u3059\u3002\u7d42\u4e86\u3057\u3066\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f","Your drawing has unsaved changes! Are you sure to want to navigate away?":"\u753b\u50cf\u306b\u672a\u4fdd\u5b58\u306e\u5909\u66f4\u304c\u3042\u308a\u307e\u3059\u3002\u7d42\u4e86\u3057\u3066\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f","Many of the menu options and painting tools have keyboard shortcuts which are written next to them or appear when you hover.":"\u5229\u7528\u53ef\u80fd\u306a\u30ad\u30fc\u30dc\u30fc\u30c9\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u306e\u3044\u304f\u3064\u304b\u306f\u30e1\u30cb\u30e5\u30fc\u306e\u6a2a\u3084\u30c4\u30fc\u30eb\u30c1\u30c3\u30d7\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002","Here are some other shortcuts which are not as obvious!":"\u3053\u306e\u4e00\u89a7\u306f\u305d\u308c\u4ee5\u5916\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u3092\u307e\u3068\u3081\u305f\u3082\u306e\u3067\u3059\u3002","Right":"\u53f3","Left":"\u5de6","Middle":"\u4e2d","or":"\u307e\u305f\u306f","Double click":"\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af","Color swatches palette":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8","Use as the drawing color":"\u30d1\u30ec\u30c3\u30c8\u306e\u8272\u3092\u53d6\u5f97","Remove or replace a color swatch":"\u30d1\u30ec\u30c3\u30c8\u306e\u5909\u66f4\uff65\u524a\u9664","Line drawing mode":"\u76f4\u7dda\u30e2\u30fc\u30c9","Snap line to nearest 45 degrees":"45\u00b0\u5358\u4f4d\u3067\u30b9\u30ca\u30c3\u30d7","Painting tools":"\u30c4\u30fc\u30eb","Change brush opacity":"\u30d6\u30e9\u30b7\u306e\u4e0d\u900f\u660e\u5ea6","Change brush size":"\u30d6\u30e9\u30b7\u30b5\u30a4\u30ba","Brush palette":"\u30d6\u30e9\u30b7\u30d1\u30ec\u30c3\u30c8","Adjust brush sliders more precisely":"\u30d6\u30e9\u30b7\u30b9\u30e9\u30a4\u30c0\u30fc\u3092\u3088\u308a\u7d30\u304b\u304f\u8abf\u6574","Drawing canvas":"\u30ad\u30e3\u30f3\u30d0\u30b9","Move the canvas around":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u79fb\u52d5","Rotate the canvas":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u56de\u8ee2","Zoom":"\u30ba\u30fc\u30e0","Zoom the canvas":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u62e1\u5927\u7e2e\u5c0f","Sample the color under the cursor":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u8272\u3092\u30b9\u30dd\u30a4\u30c8","Flip View Horizontal":"\u8868\u793a\u306e\u5de6\u53f3\u53cd\u8ee2","Layers palette":"\u30ec\u30a4\u30e4\u30fc\u30d1\u30ec\u30c3\u30c8","Rename layer":"\u30ec\u30a4\u30e4\u30fc\u540d\u5909\u66f4","Toggle mask enable/disable":"\u30de\u30b9\u30af\u306e\u6709\u52b9/\u7121\u52b9\u5207\u308a\u66ff\u3048","Toggle mask View":"\u30de\u30b9\u30af\u306e\u8868\u793a/\u975e\u8868\u793a\u5207\u308a\u66ff\u3048","Save Oekaki":"\u4fdd\u5b58","Saving drawing...":"\u753b\u50cf\u3092\u4fdd\u5b58\u4e2d\u2026","Preparing your drawing to be saved, please wait...":"\u753b\u50cf\u3092\u4fdd\u5b58\u3059\u308b\u6e96\u5099\u3092\u3057\u3066\u3044\u307e\u3059\u3002\u3057\u3070\u3089\u304f\u304a\u5f85\u3061\u304f\u3060\u3055\u3044\u2026","Drawing saved!":"\u753b\u50cf\u3092\u4fdd\u5b58\u3057\u307e\u3057\u305f\uff01","Your drawing has been saved, would you like to post it to the forum now?":"\u753b\u50cf\u306e\u4fdd\u5b58\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\u30d5\u30a9\u30fc\u30e9\u30e0\u3078\u6295\u7a3f\u3057\u307e\u3059\u304b\uff1f","Yes, post it now":"\u306f\u3044\u3001\u6295\u7a3f\u3057\u307e\u3059","No, keep drawing":"\u307e\u3060\u63cf\u304d\u307e\u3059","No, quit and I\'ll finish it later":"\u30a2\u30d7\u30ea\u3092\u7d42\u4e86\u3057\u3066\u7d9a\u304d\u3092\u5f8c\u3067\u63cf\u304f","Your drawing has been saved, would you like to view it on the forum now?":"\u753b\u50cf\u306e\u4fdd\u5b58\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\u30d5\u30a9\u30fc\u30e9\u30e0\u3078\u6295\u7a3f\u3057\u307e\u3059\u304b\uff1f","Yes, view the post":"\u306f\u3044\u3001\u6295\u7a3f\u3057\u307e\u3059\u3002","Your drawing has been saved, redirecting you to view your new post now...":"\u753b\u50cf\u306e\u4fdd\u5b58\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\u6295\u7a3f\u5148\u306b\u79fb\u52d5\u3057\u307e\u3059\u3002","Sorry, your drawing could not be saved, Please see the error message.":"\u753b\u50cf\u3092\u4fdd\u5b58\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002","Sorry, your drawing could not be saved, please try again later.":"\u753b\u50cf\u3092\u4fdd\u5b58\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u6642\u9593\u3092\u7f6e\u3044\u3066\u518d\u5ea6\u6295\u7a3f\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002","The error returned from the server was":"\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u8fd4\u3063\u3066\u6765\u305f\u30a8\u30e9\u30fc","The file size exceeds the server limit.":"\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u30b5\u30fc\u30d0\u30fc\u306e\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002","The total size of FormData is within the acceptable range.":"FormData\u306e\u5408\u8a08\u30b5\u30a4\u30ba\u306f\u5236\u9650\u7bc4\u56f2\u5185\u3067\u3059\u3002","Limit size":"\u4e0a\u9650\u30b5\u30a4\u30ba","Current size":"\u73fe\u5728\u306e\u30b5\u30a4\u30ba","Network response was not OK":"\u901a\u4fe1\u30a8\u30e9\u30fc","HTTP status code":"HTTP\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9"}'),
en:Ed},Dd=Ed,pe="en";od.prototype=Object.create(ya(Hb).prototype);od.prototype.constructor=od;var Pb={};Pb=function(){function a(p,u){return u&&`${u}::${Gb++}`||p.uidEvent||Gb++}function c(p){let u=a(p);return p.uidEvent=u,Ib[u]=Ib[u]||{},Ib[u]}function d(p,u,D=null){return Object.values(p).find(K=>K.callable===u&&K.delegationSelector===D)}function b(p,u,D){let K="string"==typeof u,V=g(p);return rc.has(V)||(V=p),[K,K?D:u||D,V]}function h(p,u,D,K,V){var ca,oa;if("string"==typeof u&&p){var [sa,Ia,Ra]=
b(u,D,K);if(u in Ac){let Ja;Ja=Ia;Ia=function(ua){if(!ua.relatedTarget||ua.relatedTarget!==ua.delegateTarget&&!ua.delegateTarget.contains(ua.relatedTarget))return Ja.call(this,ua)}}K=c(p);K=K[Ra]||(K[Ra]={});var ja=d(K,Ia,sa?D:null);if(ja)return void(ja.oneOff=ja.oneOff&&V);u=a(Ia,u.replace(qc,""));ja=sa?(ca=Ia,function Sa(ua){let Pa=p.querySelectorAll(D);for(let {target:Ma}=ua;Ma&&Ma!==this;Ma=Ma.parentNode)for(let Na of Pa)if(Na===Ma)return e(ua,{delegateTarget:Ma}),Sa.oneOff&&fa.off(p,ua.type,
D,ca),ca.apply(Ma,[ua])}):(oa=Ia,function Pa(Sa){return e(Sa,{delegateTarget:p}),Pa.oneOff&&fa.off(p,Sa.type,oa),oa.apply(p,[Sa])});ja.delegationSelector=sa?D:null;ja.callable=Ia;ja.oneOff=V;ja.uidEvent=u;K[u]=ja;p.addEventListener(Ra,ja,sa)}}function n(p,u,D,K,V){(K=d(u[D],K,V))&&(p.removeEventListener(D,K,!!V),delete u[D][K.uidEvent])}function g(p){return Ac[p=p.replace(pc,"")]||p}function e(p,u={}){for(let [D,K]of Object.entries(u))try{p[D]=K}catch(V){Object.defineProperty(p,D,{configurable:!0,
get:()=>K})}return p}function k(p){if("true"===p)return!0;if("false"===p)return!1;if(p===Number(p).toString())return Number(p);if(""===p||"null"===p)return null;if("string"!=typeof p)return p;try{return JSON.parse(decodeURIComponent(p))}catch(u){return p}}function l(p){return p.replace(/[A-Z]/g,u=>`-${u.toLowerCase()}`)}function f(p){return p?(p.nodeName||"").toLowerCase():null}function m(p){return null==p?window:"[object Window]"!==p.toString()?(p=p.ownerDocument)&&p.defaultView||window:p}function r(p){return p instanceof
m(p).Element||p instanceof Element}function q(p){return p instanceof m(p).HTMLElement||p instanceof HTMLElement}function t(p){return"undefined"!=typeof ShadowRoot&&(p instanceof m(p).ShadowRoot||p instanceof ShadowRoot)}function v(p){return p.split("-")[0]}function x(){var p=navigator.userAgentData;return null!=p&&p.brands&&Array.isArray(p.brands)?p.brands.map(function(u){return u.brand+"/"+u.version}).join(" "):navigator.userAgent}function A(){return!/^((?!chrome|android).)*safari/i.test(x())}function B(p,
u,D){void 0===u&&(u=!1);void 0===D&&(D=!1);var K=p.getBoundingClientRect(),V=1,ca=1;u&&q(p)&&(V=p.offsetWidth>0&&lc(K.width)/p.offsetWidth||1,ca=p.offsetHeight>0&&lc(K.height)/p.offsetHeight||1);p=(r(p)?m(p):window).visualViewport;u=!A()&&D;D=(K.left+(u&&p?p.offsetLeft:0))/V;p=(K.top+(u&&p?p.offsetTop:0))/ca;V=K.width/V;K=K.height/ca;return{width:V,height:K,top:p,right:D+V,bottom:p+K,left:D,x:D,y:p}}function y(p){var u=B(p),D=p.offsetWidth,K=p.offsetHeight;return 1>=Math.abs(u.width-D)&&(D=u.width),
1>=Math.abs(u.height-K)&&(K=u.height),{x:p.offsetLeft,y:p.offsetTop,width:D,height:K}}function E(p,u){var D=u.getRootNode&&u.getRootNode();if(p.contains(u))return!0;if(D&&t(D)){do{if(u&&p.isSameNode(u))return!0;u=u.parentNode||u.host}while(u)}return!1}function G(p){return m(p).getComputedStyle(p)}function M(p){return((r(p)?p.ownerDocument:p.document)||window.document).documentElement}function L(p){return"html"===f(p)?p:p.assignedSlot||p.parentNode||(t(p)?p.host:null)||M(p)}function J(p){return q(p)&&
"fixed"!==G(p).position?p.offsetParent:null}function W(p){for(var u=m(p),D=J(p);D&&["table","td","th"].indexOf(f(D))>=0&&"static"===G(D).position;)D=J(D);if(!D||"html"!==f(D)&&("body"!==f(D)||"static"!==G(D).position)){if(!D)a:{D=/firefox/i.test(x());if(!/Trident/i.test(x())||!q(p)||"fixed"!==G(p).position)for(p=L(p),t(p)&&(p=p.host);q(p)&&0>["html","body"].indexOf(f(p));){var K=G(p);if("none"!==K.transform||"none"!==K.perspective||"paint"===K.contain||-1!==["transform","perspective"].indexOf(K.willChange)||
D&&"filter"===K.willChange||D&&K.filter&&"none"!==K.filter){D=p;break a}p=p.parentNode}D=null}u=D||u}return u}function ba(p){return["top","bottom"].indexOf(p)>=0?"x":"y"}function ma(p){return Object.assign({},{top:0,right:0,bottom:0,left:0},p)}function na(p,u){return u.reduce(function(D,K){return D[K]=p,D},{})}function H(p){return p.split("-")[1]}function T(p){var u,D=p.popper,K=p.popperRect,V=p.placement,ca=p.variation,oa=p.offsets,sa=p.position,Ia=p.gpuAcceleration,Ra=p.adaptive,ja=p.roundOffsets,
Ja=p.isFixed;p=oa.x;p=void 0===p?0:p;var ua=oa.y;ua=void 0===ua?0:ua;ua="function"==typeof ja?ja({x:p,y:ua}):{x:p,y:ua};p=ua.x;ua=ua.y;var Sa=oa.hasOwnProperty("x");oa=oa.hasOwnProperty("y");var Pa="left",Ma="top",Na=window;if(Ra){var Ta=W(D),Ab="clientHeight",Wa="clientWidth";Ta===m(D)&&"static"!==G(Ta=M(D)).position&&"absolute"===sa&&(Ab="scrollHeight",Wa="scrollWidth");("top"===V||(V==="left"||V==="right")&&"end"===ca)&&(Ma="bottom",ua-=(Ja&&Ta===Na&&Na.visualViewport?Na.visualViewport.height:
Ta[Ab])-K.height,ua*=Ia?1:-1);V!=="left"&&("top"!==V&&V!=="bottom"||"end"!==ca)||(Pa="right",p-=(Ja&&Ta===Na&&Na.visualViewport?Na.visualViewport.width:Ta[Wa])-K.width,p*=Ia?1:-1)}var Ea,ob,pb,Bb,qb,kb;K=Object.assign({position:sa},Ra&&z);ja=!0===ja?(Ea={x:p,y:ua},ob=m(D),pb=Ea.x,Bb=Ea.y,{x:lc(pb*(qb=ob.devicePixelRatio||1))/qb||0,y:lc(Bb*qb)/qb||0}):{x:p,y:ua};return p=ja.x,ua=ja.y,Ia?Object.assign({},K,((kb={})[Ma]=oa?"0":"",kb[Pa]=Sa?"0":"",kb.transform=1>=(Na.devicePixelRatio||1)?"translate("+
p+"px, "+ua+"px)":"translate3d("+p+"px, "+ua+"px, 0)",kb)):Object.assign({},K,((u={})[Ma]=oa?ua+"px":"",u[Pa]=Sa?p+"px":"",u.transform="",u))}function Ca(p){return p.replace(/left|right|bottom|top/g,function(u){return xa[u]})}function ra(p){return p.replace(/start|end/g,function(u){return ha[u]})}function ub(p){p=m(p);return{scrollLeft:p.pageXOffset,scrollTop:p.pageYOffset}}function mb(p){return B(M(p)).left+ub(p).scrollLeft}function vb(p){p=G(p);return/auto|scroll|overlay|hidden/.test(p.overflow+
p.overflowY+p.overflowX)}function Aa(p,u){void 0===u&&(u=[]);var D,K=function oa(ca){return["html","body","#document"].indexOf(f(ca))>=0?ca.ownerDocument.body:q(ca)&&vb(ca)?ca:oa(L(ca))}(p);p=K===(null==(D=p.ownerDocument)?void 0:D.body);D=m(K);K=p?[D].concat(D.visualViewport||[],vb(K)?K:[]):K;u=u.concat(K);return p?u:u.concat(Aa(L(K)))}function R(p){return Object.assign({},p,{left:p.x,top:p.y,right:p.x+p.width,bottom:p.y+p.height})}function da(p,u,D){var K,V,ca,oa,sa,Ia,Ra;if(u==="viewport"){u=m(p);
var ja=M(p);u=u.visualViewport;var Ja=ja.clientWidth;ja=ja.clientHeight;var ua=K=0;u&&(Ja=u.width,ja=u.height,((V=A())||!V&&"fixed"===D)&&(K=u.offsetLeft,ua=u.offsetTop));p={width:Ja,height:ja,x:K+mb(p),y:ua};D=R(p)}else D=r(u)?((Ja=B(u,!1,"fixed"===D)).top=Ja.top+u.clientTop,Ja.left+=u.clientLeft,Ja.bottom=Ja.top+u.clientHeight,Ja.right=Ja.left+u.clientWidth,Ja.width=u.clientWidth,Ja.height=u.clientHeight,Ja.x=Ja.left,Ja.y=Ja.top,Ja):R((ja=M(p),ua=M(ja),V=ub(ja),ca=null==(K=ja.ownerDocument)?void 0:
K.body,oa=Xb(ua.scrollWidth,ua.clientWidth,ca?ca.scrollWidth:0,ca?ca.clientWidth:0),sa=Xb(ua.scrollHeight,ua.clientHeight,ca?ca.scrollHeight:0,ca?ca.clientHeight:0),Ia=-V.scrollLeft+mb(ja),Ra=-V.scrollTop,"rtl"===G(ca||ua).direction&&(Ia+=Xb(ua.clientWidth,ca?ca.clientWidth:0)-oa),{width:oa,height:sa,x:Ia,y:Ra}));return D}function wa(p){var u=p.reference,D=p.element,K=(p=p.placement)?v(p):null;p=p?H(p):null;var V=u.x+u.width/2-D.width/2;var ca=u.y+u.height/2-D.height/2;switch(K){case "top":V={x:V,
y:u.y-D.height};break;case "bottom":V={x:V,y:u.y+u.height};break;case "right":V={x:u.x+u.width,y:ca};break;case "left":V={x:u.x-D.width,y:ca};break;default:V={x:u.x,y:u.y}}K=K?ba(K):null;if(null!=K)switch(ca="y"===K?"height":"width",p){case "start":V[K]-=u[ca]/2-D[ca]/2;break;case "end":V[K]+=u[ca]/2-D[ca]/2}return V}function $a(p,u){void 0===u&&(u={});var D,K,V,ca,oa,sa,Ia,Ra,ja=u;u=ja.placement;u=void 0===u?p.placement:u;var Ja=ja.strategy,ua=void 0===Ja?p.strategy:Ja,Sa=ja.boundary,Pa=ja.rootBoundary;
Ja=ja.elementContext;Ja=void 0===Ja?"popper":Ja;var Ma=ja.altBoundary;ja=ja.padding;ja=void 0===ja?0:ja;ja=ma("number"!=typeof ja?ja:na(ja,Qb));var Na=p.rects.popper;Ma=p.elements[void 0!==Ma&&Ma?Ja==="popper"?"reference":"popper":Ja];Ma=(D=r(Ma)?Ma:Ma.contextElement||M(p.elements.popper),K=void 0===Sa?"clippingParents":Sa,V=void 0===Pa?"viewport":Pa,Ia=(sa=[].concat("clippingParents"===K?(ca=Aa(L(D)),r(oa=["absolute","fixed"].indexOf(G(D).position)>=0&&q(D)?W(D):D)?ca.filter(function(Wa){return r(Wa)&&
E(Wa,oa)&&"body"!==f(Wa)}):[]):[].concat(K),[V]))[0],(Ra=sa.reduce(function(Wa,Ea){Ea=da(D,Ea,ua);return Wa.top=Xb(Ea.top,Wa.top),Wa.right=kc(Ea.right,Wa.right),Wa.bottom=kc(Ea.bottom,Wa.bottom),Wa.left=Xb(Ea.left,Wa.left),Wa},da(D,Ia,ua))).width=Ra.right-Ra.left,Ra.height=Ra.bottom-Ra.top,Ra.x=Ra.left,Ra.y=Ra.top,Ra);K=B(p.elements.reference);V=wa({reference:K,element:Na,placement:u});V=R(Object.assign({},Na,V));K=Ja==="popper"?V:K;var Ta={top:Ma.top-K.top+ja.top,bottom:K.bottom-Ma.bottom+ja.bottom,
left:Ma.left-K.left+ja.left,right:K.right-Ma.right+ja.right};p=p.modifiersData.offset;if(Ja==="popper"&&p){var Ab=p[u];Object.keys(Ta).forEach(function(Wa){var Ea=["right","bottom"].indexOf(Wa)>=0?1:-1,ob=["top","bottom"].indexOf(Wa)>=0?"y":"x";Ta[Wa]+=Ab[ob]*Ea})}return Ta}function Z(p,u,D){return void 0===D&&(D={x:0,y:0}),{top:p.top-u.height-D.y,right:p.right-u.width+D.x,bottom:p.bottom-u.height+D.y,left:p.left-u.width-D.x}}function ea(p){return["top","right","bottom","left"].some(function(u){return p[u]>=
0})}function S(){for(var p=arguments.length,u=Array(p),D=0;D<p;D++)u[D]=arguments[D];return!u.some(function(K){return!(K&&"function"==typeof K.getBoundingClientRect)})}function va(p){void 0===p&&(p={});var u=p.defaultModifiers,D=void 0===u?[]:u;p=p.defaultOptions;var K=void 0===p?$b:p;return function(V,ca,oa){function sa(){Ja.forEach(function(Pa){return Pa()});Ja=[]}void 0===oa&&(oa=K);var Ia,Ra,ja={placement:"bottom",orderedModifiers:[],options:Object.assign({},$b,K),modifiersData:{},elements:{reference:V,
popper:ca},attributes:{},styles:{}},Ja=[],ua=!1,Sa={state:ja,setOptions:function(Pa){Pa="function"==typeof Pa?Pa(ja.options):Pa;sa();ja.options=Object.assign({},K,ja.options,Pa);ja.scrollParents={reference:r(V)?Aa(V):V.contextElement?Aa(V.contextElement):[],popper:Aa(ca)};var Ma,Na,Ta,Ab,Wa;Pa=(Ma=Object.keys(Wa=[].concat(D,ja.options.modifiers).reduce(function(Ea,ob){var pb=Ea[ob.name];return Ea[ob.name]=pb?Object.assign({},pb,ob,{options:Object.assign({},pb.options,ob.options),data:Object.assign({},
pb.data,ob.data)}):ob,Ea},{})).map(function(Ea){return Wa[Ea]}),Na=new Map,Ta=new Set,Ab=[],Ma.forEach(function(Ea){Na.set(Ea.name,Ea)}),Ma.forEach(function(Ea){Ta.has(Ea.name)||function Bb(pb){Ta.add(pb.name);[].concat(pb.requires||[],pb.requiresIfExists||[]).forEach(function(qb){Ta.has(qb)||(qb=Na.get(qb))&&Bb(qb)});Ab.push(pb)}(Ea)}),tb.reduce(function(Ea,ob){return Ea.concat(Ab.filter(function(pb){return pb.phase===ob}))},[]));return ja.orderedModifiers=Pa.filter(function(Ea){return Ea.enabled}),
ja.orderedModifiers.forEach(function(Ea){var ob=Ea.name,pb=Ea.options;Ea=Ea.effect;"function"==typeof Ea&&(ob=Ea({state:ja,name:ob,instance:Sa,options:void 0===pb?{}:pb}),Ja.push(ob||function(){}))}),Sa.update()},forceUpdate:function(){if(!ua){var Pa=ja.elements,Ma=Pa.reference;Pa=Pa.popper;if(S(Ma,Pa)){ja.rects={reference:(Na=W(Pa),Ta="fixed"===ja.options.strategy,ob=q(Na),pb=q(Na)&&(Wa=lc((Ab=Na.getBoundingClientRect()).width)/Na.offsetWidth||1,Ea=lc(Ab.height)/Na.offsetHeight||1,1!==Wa||1!==Ea),
Bb=M(Na),qb=B(Ma,pb,Ta),kb={scrollLeft:0,scrollTop:0},bc={x:0,y:0},(ob||!ob&&!Ta)&&(("body"!==f(Na)||vb(Bb))&&(kb=Na!==m(Na)&&q(Na)?{scrollLeft:Na.scrollLeft,scrollTop:Na.scrollTop}:ub(Na)),q(Na)?((bc=B(Na,!0)).x+=Na.clientLeft,bc.y+=Na.clientTop):Bb&&(bc.x=mb(Bb))),{x:qb.left+kb.scrollLeft-bc.x,y:qb.top+kb.scrollTop-bc.y,width:qb.width,height:qb.height}),popper:y(Pa)};ja.reset=!1;ja.placement=ja.options.placement;ja.orderedModifiers.forEach(function(Ic){return ja.modifiersData[Ic.name]=Object.assign({},
Ic.data)});var Na,Ta,Ab,Wa,Ea,ob,pb,Bb,qb,kb,bc;for(Ma=0;Ma<ja.orderedModifiers.length;Ma++)!0!==ja.reset?(Ta=ja.orderedModifiers[Ma],Na=Ta.fn,Ab=Ta.options,Ab=void 0===Ab?{}:Ab,Ta=Ta.name,"function"==typeof Na&&(ja=Na({state:ja,options:Ab,name:Ta,instance:Sa})||ja)):(ja.reset=!1,Ma=-1)}}},update:(Ia=function(){return new Promise(function(Pa){Sa.forceUpdate();Pa(ja)})},function(){return Ra||=new Promise(function(Pa){Promise.resolve().then(function(){Ra=void 0;Pa(Ia())})}),Ra}),destroy:function(){sa();
ua=!0}};return S(V,ca)?(Sa.setOptions(oa).then(function(Pa){!ua&&oa.onFirstUpdate&&oa.onFirstUpdate(Pa)}),Sa):Sa}}let ab=new Map,ib={set(p,u,D){ab.has(p)||ab.set(p,new Map);p=ab.get(p);p.has(u)||0===p.size?p.set(u,D):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(p.keys())[0]}.`)},get:(p,u)=>ab.has(p)&&ab.get(p).get(u)||null,remove(p,u){if(ab.has(p)){var D=ab.get(p);D.delete(u);0===D.size&&ab.delete(p)}}},La=p=>(p&&window.CSS&&window.CSS.escape&&
(p=p.replace(/#([^\s"#']+)/g,(u,D)=>`#${CSS.escape(D)}`)),p),xb=p=>!(!p||"object"!=typeof p)&&(void 0!==p.jquery&&(p=p[0]),void 0!==p.nodeType),Cb=p=>xb(p)?p.jquery?p[0]:p:"string"==typeof p&&p.length>0?document.querySelector(La(p)):null,Sb=p=>{if(!xb(p)||0===p.getClientRects().length)return!1;let u="visible"===getComputedStyle(p).getPropertyValue("visibility"),D=p.closest("details:not([open])");return D?D!==p&&((p=p.closest("summary"))&&p.parentNode!==D||null===p)?!1:u:u},gb=p=>!p||p.nodeType!==
Node.ELEMENT_NODE||!!p.classList.contains("disabled")||(void 0!==p.disabled?p.disabled:p.hasAttribute("disabled")&&"false"!==p.getAttribute("disabled")),jb=p=>document.documentElement.attachShadow?"function"==typeof p.getRootNode?(p=p.getRootNode(),p instanceof ShadowRoot?p:null):p instanceof ShadowRoot?p:p.parentNode?jb(p.parentNode):null:null,rb=()=>{},ic=p=>{p.offsetHeight},eb=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,bb=[],Qa=p=>{var u=()=>{let D=eb();
if(D){let K=p.NAME,V=D.fn[K];D.fn[K]=p.jQueryInterface;D.fn[K].Constructor=p;D.fn[K].noConflict=()=>(D.fn[K]=V,p.jQueryInterface)}};"loading"===document.readyState?(bb.length||document.addEventListener("DOMContentLoaded",()=>{for(let D of bb)D()}),bb.push(u)):u()},Db=(p,u=[],D=p)=>"function"==typeof p?p.call(...u):D,nb=(p,u,D=!0)=>{if(!D)return void Db(p);D=(ca=>{if(!ca)return 0;let {transitionDuration:oa,transitionDelay:sa}=window.getComputedStyle(ca);ca=Number.parseFloat(oa);let Ia=Number.parseFloat(sa);
return ca||Ia?(oa=oa.split(",")[0],sa=sa.split(",")[0],1E3*(Number.parseFloat(oa)+Number.parseFloat(sa))):0})(u)+5;let K=!1,V=({target:ca})=>{ca===u&&(K=!0,u.removeEventListener("transitionend",V),Db(p))};u.addEventListener("transitionend",V);setTimeout(()=>{K||u.dispatchEvent(new Event("transitionend"))},D)},fc=(p,u,D,K)=>{let V=p.length;u=p.indexOf(u);return-1===u?!D&&K?p[V-1]:p[0]:(u+=D?1:-1,K&&(u=(u+V)%V),p[Math.max(0,Math.min(u,V-1))])},qc=/[^.]*(?=\..*)\.|.*/,pc=/\..*/,hc=/::\d+$/,Ib={},Gb=
1,Ac={mouseenter:"mouseover",mouseleave:"mouseout"},rc=new Set("click dblclick mouseup mousedown contextmenu mousewheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange touchstart touchmove touchend touchcancel pointerdown pointermove pointerup pointerleave pointercancel gesturestart gesturechange gestureend focus blur change reset select submit focusin focusout load unload beforeunload resize move DOMContentLoaded readystatechange error abort scroll".split(" ")),
fa={on(p,u,D,K){h(p,u,D,K,!1)},one(p,u,D,K){h(p,u,D,K,!0)},off(p,u,D,K){if("string"==typeof u&&p){var [V,ca,oa]=b(u,D,K);K=oa!==u;var sa=c(p),Ia=sa[oa]||{},Ra=u.startsWith(".");if(void 0===ca){if(Ra)for(var ja of Object.keys(sa)){D=u.slice(1);for(let [Ja,ua]of Object.entries(sa[ja]||{}))Ja.includes(D)&&n(p,sa,ja,ua.callable,ua.delegationSelector)}for(let [Ja,ua]of Object.entries(Ia))ja=Ja.replace(hc,""),K&&!u.includes(ja)||n(p,sa,oa,ua.callable,ua.delegationSelector)}else Object.keys(Ia).length&&
n(p,sa,oa,ca,V?D:null)}},trigger(p,u,D){if("string"!=typeof u||!p)return null;let K=eb(),V=null,ca=!0,oa=!0,sa=!1;u!==g(u)&&K&&(V=K.Event(u,D),K(p).trigger(V),ca=!V.isPropagationStopped(),oa=!V.isImmediatePropagationStopped(),sa=V.isDefaultPrevented());u=e(new Event(u,{bubbles:ca,cancelable:!0}),D);return sa&&u.preventDefault(),oa&&p.dispatchEvent(u),u.defaultPrevented&&V&&V.preventDefault(),u}},Nb={setDataAttribute(p,u,D){p.setAttribute(`data-bs-${l(u)}`,D)},removeDataAttribute(p,u){p.removeAttribute(`data-bs-${l(u)}`)},
getDataAttributes(p){if(!p)return{};let u={};for(let D of Object.keys(p.dataset).filter(K=>K.startsWith("bs")&&!K.startsWith("bsConfig"))){let K=D.replace(/^bs/,"");u[K=K.charAt(0).toLowerCase()+K.slice(1)]=k(p.dataset[D])}return u},getDataAttribute:(p,u)=>k(p.getAttribute(`data-bs-${l(u)}`))};class jc{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw Error('You have to implement the static method "NAME", for each component!');}_getConfig(p){return p=this._mergeConfigObj(p),
p=this._configAfterMerge(p),this._typeCheckConfig(p),p}_configAfterMerge(p){return p}_mergeConfigObj(p,u){let D=xb(u)?Nb.getDataAttribute(u,"config"):{};return{...this.constructor.Default,...("object"==typeof D?D:{}),...(xb(u)?Nb.getDataAttributes(u):{}),...("object"==typeof p?p:{})}}_typeCheckConfig(p,u=this.constructor.DefaultType){for(let [D,K]of Object.entries(u))if(u=p[D],u=xb(u)?"element":null==u?`${u}`:Object.prototype.toString.call(u).match(/\s([a-z]+)/i)[1].toLowerCase(),!(new RegExp(K)).test(u))throw TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${D}" provided type "${u}" but expected type "${K}".`);
}}class Wb extends jc{dispose(){for(let p of(ib.remove(this._element,this.constructor.DATA_KEY),fa.off(this._element,this.constructor.EVENT_KEY),Object.getOwnPropertyNames(this)))this[p]=null}_queueCallback(p,u,D=!0){nb(p,u,D)}_getConfig(p){return p=this._mergeConfigObj(p,this._element),p=this._configAfterMerge(p),this._typeCheckConfig(p),p}static getInstance(p){return ib.get(Cb(p),this.DATA_KEY)}static getOrCreateInstance(p,u={}){return this.getInstance(p)||new this(p,"object"==typeof u?u:null)}static get VERSION(){return"5.3.8"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(p){return`${p}${this.EVENT_KEY}`}constructor(p,
u){super();(p=Cb(p))&&(this._element=p,this._config=this._getConfig(u),ib.set(this._element,this.constructor.DATA_KEY,this))}}let Bc=p=>{let u=p.getAttribute("data-bs-target");if(!u||"#"===u){p=p.getAttribute("href");if(!p||!p.includes("#")&&!p.startsWith("."))return null;p.includes("#")&&!p.startsWith("#")&&(p=`#${p.split("#")[1]}`);u=p&&"#"!==p?p.trim():null}return u?u.split(",").map(D=>La(D)).join(","):null},Fa={find:(p,u=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(u,
p)),findOne:(p,u=document.documentElement)=>Element.prototype.querySelector.call(u,p),children:(p,u)=>[].concat(...p.children).filter(D=>D.matches(u)),parents(p,u){let D=[];for(p=p.parentNode.closest(u);p;)D.push(p),p=p.parentNode.closest(u);return D},prev(p,u){for(p=p.previousElementSibling;p;){if(p.matches(u))return[p];p=p.previousElementSibling}return[]},next(p,u){for(p=p.nextElementSibling;p;){if(p.matches(u))return[p];p=p.nextElementSibling}return[]},focusableChildren(p){let u='a button input textarea select details [tabindex] [contenteditable="true"]'.split(" ").map(D=>
`${D}:not([tabindex^="-"])`).join(",");return this.find(u,p).filter(D=>!gb(D)&&Sb(D))},getSelectorFromElement(p){return(p=Bc(p))&&Fa.findOne(p)?p:null},getElementFromSelector(p){return(p=Bc(p))?Fa.findOne(p):null},getMultipleElementsFromSelector(p){return(p=Bc(p))?Fa.find(p):[]}},mc=(p,u="hide")=>{let D=p.NAME;fa.on(document,`click.dismiss${p.EVENT_KEY}`,`[data-bs-dismiss="${D}"]`,function(K){(["A","AREA"].includes(this.tagName)&&K.preventDefault(),gb(this))||(K=Fa.getElementFromSelector(this)||this.closest(`.${D}`),
p.getOrCreateInstance(K)[u]())})};class Yb extends Wb{static get NAME(){return"alert"}close(){if(!fa.trigger(this._element,"close.bs.alert").defaultPrevented){this._element.classList.remove("show");var p=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,p)}}_destroyElement(){this._element.remove();fa.trigger(this._element,"closed.bs.alert");this.dispose()}static jQueryInterface(p){return this.each(function(){let u=Yb.getOrCreateInstance(this);if("string"==
typeof p){if(void 0===u[p]||p.startsWith("_")||"constructor"===p)throw TypeError(`No method named "${p}"`);u[p](this)}})}}mc(Yb,"close");Qa(Yb);class sc extends Wb{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(p){return this.each(function(){let u=sc.getOrCreateInstance(this);"toggle"===p&&u[p]()})}}fa.on(document,"click.bs.button.data-api",'[data-bs-toggle="button"]',p=>{p.preventDefault();p=p.target.closest('[data-bs-toggle="button"]');
sc.getOrCreateInstance(p).toggle()});Qa(sc);let w={endCallback:null,leftCallback:null,rightCallback:null},F={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class P extends jc{static get Default(){return w}static get DefaultType(){return F}static get NAME(){return"swipe"}dispose(){fa.off(this._element,".bs.swipe")}_start(p){this._supportPointerEvents?this._eventIsPointerPenTouch(p)&&(this._deltaX=p.clientX):this._deltaX=p.touches[0].clientX}_end(p){this._eventIsPointerPenTouch(p)&&
(this._deltaX=p.clientX-this._deltaX);this._handleSwipe();Db(this._config.endCallback)}_move(p){this._deltaX=p.touches&&p.touches.length>1?0:p.touches[0].clientX-this._deltaX}_handleSwipe(){var p=Math.abs(this._deltaX);p<=40||(p/=this._deltaX,this._deltaX=0,p&&Db(p>0?this._config.rightCallback:this._config.leftCallback))}_initEvents(){this._supportPointerEvents?(fa.on(this._element,"pointerdown.bs.swipe",p=>this._start(p)),fa.on(this._element,"pointerup.bs.swipe",p=>this._end(p)),this._element.classList.add("pointer-event")):
(fa.on(this._element,"touchstart.bs.swipe",p=>this._start(p)),fa.on(this._element,"touchmove.bs.swipe",p=>this._move(p)),fa.on(this._element,"touchend.bs.swipe",p=>this._end(p)))}_eventIsPointerPenTouch(p){return this._supportPointerEvents&&("pen"===p.pointerType||"touch"===p.pointerType)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}constructor(p,u){super();(this._element=p)&&P.isSupported()&&(this._config=this._getConfig(u),this._deltaX=0,this._supportPointerEvents=
!!window.PointerEvent,this._initEvents())}}let O={ArrowLeft:"right",ArrowRight:"left"},U={interval:5E3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},Y={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class la extends Wb{static get Default(){return U}static get DefaultType(){return Y}static get NAME(){return"carousel"}next(){this._slide("next")}nextWhenVisible(){!document.hidden&&Sb(this._element)&&this.next()}prev(){this._slide("prev")}pause(){this._isSliding&&
this._element.dispatchEvent(new Event("transitionend"));this._clearInterval()}cycle(){this._clearInterval();this._updateInterval();this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?fa.one(this._element,"slid.bs.carousel",()=>this.cycle()):this.cycle())}to(p){let u=this._getItems();if(!(p>u.length-1||p<0)){if(this._isSliding)return void fa.one(this._element,"slid.bs.carousel",()=>this.to(p));var D=this._getItemIndex(this._getActive());
D!==p&&this._slide(p>D?"next":"prev",u[p])}}dispose(){this._swipeHelper&&this._swipeHelper.dispose();super.dispose()}_configAfterMerge(p){return p.defaultInterval=p.interval,p}_addEventListeners(){this._config.keyboard&&fa.on(this._element,"keydown.bs.carousel",p=>this._keydown(p));"hover"===this._config.pause&&(fa.on(this._element,"mouseenter.bs.carousel",()=>this.pause()),fa.on(this._element,"mouseleave.bs.carousel",()=>this._maybeEnableCycle()));this._config.touch&&P.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(let p of Fa.find(".carousel-item img",
this._element))fa.on(p,"dragstart.bs.carousel",u=>u.preventDefault());this._swipeHelper=new P(this._element,{leftCallback:()=>this._slide(this._directionToOrder("left")),rightCallback:()=>this._slide(this._directionToOrder("right")),endCallback:()=>{"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}})}_keydown(p){if(!/input|textarea/i.test(p.target.tagName)){var u=O[p.key];
u&&(p.preventDefault(),this._slide(this._directionToOrder(u)))}}_getItemIndex(p){return this._getItems().indexOf(p)}_setActiveIndicatorElement(p){if(this._indicatorsElement){var u=Fa.findOne(".active",this._indicatorsElement);u.classList.remove("active");u.removeAttribute("aria-current");(p=Fa.findOne(`[data-bs-slide-to="${p}"]`,this._indicatorsElement))&&(p.classList.add("active"),p.setAttribute("aria-current","true"))}}_updateInterval(){var p=this._activeElement||this._getActive();p&&(p=Number.parseInt(p.getAttribute("data-bs-interval"),
10),this._config.interval=p||this._config.defaultInterval)}_slide(p,u=null){if(!this._isSliding){var D=this._getActive(),K=p==="next",V=u||fc(this._getItems(),D,K,this._config.wrap);if(V!==D){var ca=this._getItemIndex(V),oa=Ra=>fa.trigger(this._element,Ra,{relatedTarget:V,direction:this._orderToDirection(p),from:this._getItemIndex(D),to:ca});if(!oa("slide.bs.carousel").defaultPrevented&&D&&V){u=!!this._interval;this.pause();this._isSliding=!0;this._setActiveIndicatorElement(ca);this._activeElement=
V;var sa=K?"carousel-item-start":"carousel-item-end",Ia=K?"carousel-item-next":"carousel-item-prev";V.classList.add(Ia);V.offsetHeight;D.classList.add(sa);V.classList.add(sa);this._queueCallback(()=>{V.classList.remove(sa,Ia);V.classList.add("active");D.classList.remove("active",Ia,sa);this._isSliding=!1;oa("slid.bs.carousel")},D,this._isAnimated());u&&this.cycle()}}}}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return Fa.findOne(".active.carousel-item",this._element)}_getItems(){return Fa.find(".carousel-item",
this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(p){return"rtl"===document.documentElement.dir?p==="left"?"prev":"next":p==="left"?"next":"prev"}_orderToDirection(p){return"rtl"===document.documentElement.dir?p==="prev"?"left":"right":p==="prev"?"right":"left"}static jQueryInterface(p){return this.each(function(){let u=la.getOrCreateInstance(this,p);if("number"!=typeof p){if("string"==typeof p){if(void 0===u[p]||p.startsWith("_")||
"constructor"===p)throw TypeError(`No method named "${p}"`);u[p]()}}else u.to(p)})}constructor(p,u){super(p,u);this._activeElement=this._interval=null;this._isSliding=!1;this._swipeHelper=this.touchTimeout=null;this._indicatorsElement=Fa.findOne(".carousel-indicators",this._element);this._addEventListeners();this._config.ride==="carousel"&&this.cycle()}}fa.on(document,"click.bs.carousel.data-api","[data-bs-slide], [data-bs-slide-to]",function(p){var u=Fa.getElementFromSelector(this);if(u&&u.classList.contains("carousel"))return p.preventDefault(),
p=la.getOrCreateInstance(u),u=this.getAttribute("data-bs-slide-to"),u?p.to(u):"next"===Nb.getDataAttribute(this,"slide")?p.next():p.prev(),void p._maybeEnableCycle()});fa.on(window,"load.bs.carousel.data-api",()=>{for(let p of Fa.find('[data-bs-ride="carousel"]'))la.getOrCreateInstance(p)});Qa(la);let Ka={parent:null,toggle:!0},fb={parent:"(null|element)",toggle:"boolean"};class Jb extends Wb{static get Default(){return Ka}static get DefaultType(){return fb}static get NAME(){return"collapse"}toggle(){this._isShown()?
this.hide():this.show()}show(){if(!this._isTransitioning&&!this._isShown()){var p=[];if(!(this._config.parent&&(p=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(D=>D!==this._element).map(D=>Jb.getOrCreateInstance(D,{toggle:!1}))),p.length&&p[0]._isTransitioning||fa.trigger(this._element,"show.bs.collapse").defaultPrevented)){for(let D of p)D.hide();var u=this._getDimension();this._element.classList.remove("collapse");this._element.classList.add("collapsing");this._element.style[u]=
0;this._addAriaAndCollapsedClass(this._triggerArray,!0);this._isTransitioning=!0;p=`scroll${u[0].toUpperCase()+u.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1;this._element.classList.remove("collapsing");this._element.classList.add("collapse","show");this._element.style[u]="";fa.trigger(this._element,"shown.bs.collapse")},this._element,!0);this._element.style[u]=`${this._element[p]}px`}}}hide(){if(!this._isTransitioning&&this._isShown()&&!fa.trigger(this._element,"hide.bs.collapse").defaultPrevented){var p=
this._getDimension();for(let u of(this._element.style[p]=`${this._element.getBoundingClientRect()[p]}px`,ic(this._element),this._element.classList.add("collapsing"),this._element.classList.remove("collapse","show"),this._triggerArray)){let D=Fa.getElementFromSelector(u);D&&!this._isShown(D)&&this._addAriaAndCollapsedClass([u],!1)}this._isTransitioning=!0;this._element.style[p]="";this._queueCallback(()=>{this._isTransitioning=!1;this._element.classList.remove("collapsing");this._element.classList.add("collapse");
fa.trigger(this._element,"hidden.bs.collapse")},this._element,!0)}}_isShown(p=this._element){return p.classList.contains("show")}_configAfterMerge(p){return p.toggle=!!p.toggle,p.parent=Cb(p.parent),p}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(this._config.parent)for(let p of this._getFirstLevelChildren('[data-bs-toggle="collapse"]')){let u=Fa.getElementFromSelector(p);u&&this._addAriaAndCollapsedClass([p],this._isShown(u))}}_getFirstLevelChildren(p){let u=
Fa.find(":scope .collapse .collapse",this._config.parent);return Fa.find(p,this._config.parent).filter(D=>!u.includes(D))}_addAriaAndCollapsedClass(p,u){if(p.length)for(let D of p)D.classList.toggle("collapsed",!u),D.setAttribute("aria-expanded",u)}static jQueryInterface(p){let u={};return"string"==typeof p&&/show|hide/.test(p)&&(u.toggle=!1),this.each(function(){let D=Jb.getOrCreateInstance(this,u);if("string"==typeof p){if(void 0===D[p])throw TypeError(`No method named "${p}"`);D[p]()}})}constructor(p,
u){for(let D of(super(p,u),this._isTransitioning=!1,this._triggerArray=[],Fa.find('[data-bs-toggle="collapse"]')))p=Fa.getSelectorFromElement(D),u=Fa.find(p).filter(K=>K===this._element),null!==p&&u.length&&this._triggerArray.push(D);this._initializeChildren();this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown());this._config.toggle&&this.toggle()}}fa.on(document,"click.bs.collapse.data-api",'[data-bs-toggle="collapse"]',function(p){for(let u of(("A"===p.target.tagName||
p.delegateTarget&&"A"===p.delegateTarget.tagName)&&p.preventDefault(),Fa.getMultipleElementsFromSelector(this)))Jb.getOrCreateInstance(u,{toggle:!1}).toggle()});Qa(Jb);var Qb=["top","bottom","right","left"],Rb=Qb.reduce(function(p,u){return p.concat([u+"-start",u+"-end"])},[]),sb=[].concat(Qb,["auto"]).reduce(function(p,u){return p.concat([u,u+"-start",u+"-end"])},[]),tb="beforeRead read afterRead beforeMain main afterMain beforeWrite write afterWrite".split(" ");let Kb={name:"applyStyles",enabled:!0,
phase:"write",fn:function(p){var u=p.state;Object.keys(u.elements).forEach(function(D){var K=u.styles[D]||{},V=u.attributes[D]||{},ca=u.elements[D];q(ca)&&f(ca)&&(Object.assign(ca.style,K),Object.keys(V).forEach(function(oa){var sa=V[oa];!1===sa?ca.removeAttribute(oa):ca.setAttribute(oa,!0===sa?"":sa)}))})},effect:function(p){var u=p.state,D={popper:{position:u.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(u.elements.popper.style,D.popper),
u.styles=D,u.elements.arrow&&Object.assign(u.elements.arrow.style,D.arrow),function(){Object.keys(u.elements).forEach(function(K){var V=u.elements[K],ca=u.attributes[K]||{};K=Object.keys(u.styles.hasOwnProperty(K)?u.styles[K]:D[K]).reduce(function(oa,sa){return oa[sa]="",oa},{});q(V)&&f(V)&&(Object.assign(V.style,K),Object.keys(ca).forEach(function(oa){V.removeAttribute(oa)}))})}},requires:["computeStyles"]};var Xb=Math.max,kc=Math.min,lc=Math.round;let Gc={name:"arrow",enabled:!0,phase:"main",fn:function(p){var u,
D=p.state,K=p.name,V=p.options,ca=D.elements.arrow,oa=D.modifiersData.popperOffsets,sa=v(D.placement);p=ba(sa);sa=["left","right"].indexOf(sa)>=0?"height":"width";if(ca&&oa){var Ia;V=(Ia=V.padding,ma("number"!=typeof(Ia="function"==typeof Ia?Ia(Object.assign({},D.rects,{placement:D.placement})):Ia)?Ia:na(Ia,Qb)));Ia=y(ca);var Ra="y"===p?"top":"left",ja="y"===p?"bottom":"right",Ja=D.rects.reference[sa]+D.rects.reference[p]-oa[p]-D.rects.popper[sa];oa=oa[p]-D.rects.reference[p];ca=(ca=W(ca))?"y"===
p?ca.clientHeight||0:ca.clientWidth||0:0;oa=ca/2-Ia[sa]/2+(Ja/2-oa/2);sa=Xb(V[Ra],kc(oa,ca-Ia[sa]-V[ja]));D.modifiersData[K]=((u={})[p]=sa,u.centerOffset=sa-oa,u)}},effect:function(p){var u=p.state;p=p.options.element;p=void 0===p?"[data-popper-arrow]":p;null!=p&&("string"!=typeof p||(p=u.elements.popper.querySelector(p)))&&E(u.elements.popper,p)&&(u.elements.arrow=p)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};var z={top:"auto",right:"auto",bottom:"auto",left:"auto"};let N=
{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(p){var u=p.state,D=p.options,K=D.gpuAcceleration;p=D.adaptive;D=D.roundOffsets;D=void 0===D||D;K={placement:v(u.placement),variation:H(u.placement),popper:u.elements.popper,popperRect:u.rects.popper,gpuAcceleration:void 0===K||K,isFixed:"fixed"===u.options.strategy};null!=u.modifiersData.popperOffsets&&(u.styles.popper=Object.assign({},u.styles.popper,T(Object.assign({},K,{offsets:u.modifiersData.popperOffsets,position:u.options.strategy,
adaptive:void 0===p||p,roundOffsets:D}))));null!=u.modifiersData.arrow&&(u.styles.arrow=Object.assign({},u.styles.arrow,T(Object.assign({},K,{offsets:u.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:D}))));u.attributes.popper=Object.assign({},u.attributes.popper,{"data-popper-placement":u.placement})},data:{}};var aa={passive:!0};let ia={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(p){var u=p.state,D=p.instance;p=p.options;var K=p.scroll,V=void 0===
K||K;p=p.resize;var ca=void 0===p||p,oa=m(u.elements.popper),sa=[].concat(u.scrollParents.reference,u.scrollParents.popper);return V&&sa.forEach(function(Ia){Ia.addEventListener("scroll",D.update,aa)}),ca&&oa.addEventListener("resize",D.update,aa),function(){V&&sa.forEach(function(Ia){Ia.removeEventListener("scroll",D.update,aa)});ca&&oa.removeEventListener("resize",D.update,aa)}},data:{}};var xa={left:"right",right:"left",bottom:"top",top:"bottom"},ha={start:"end",end:"start"};let Ha={name:"flip",
enabled:!0,phase:"main",fn:function(p){var u=p.state,D=p.options;p=p.name;if(!u.modifiersData[p]._skip){var K=D.mainAxis;K=void 0===K||K;var V=D.altAxis;V=void 0===V||V;var ca=D.fallbackPlacements,oa=D.padding,sa=D.boundary,Ia=D.rootBoundary,Ra=D.altBoundary,ja=D.flipVariations,Ja=void 0===ja||ja,ua=D.allowedAutoPlacements;D=u.options.placement;ja=v(D);ca=ca||(ja!==D&&Ja?function(Bb){if(v(Bb)==="auto")return[];var qb=Ca(Bb);return[ra(Bb),qb,ra(qb)]}(D):[Ca(D)]);var Sa=[D].concat(ca).reduce(function(Bb,
qb){var kb,bc,Ic,Jc,If,Jf,Kf,Lf,Mf,Nf,we,xe;return Bb.concat(v(qb)==="auto"?(bc=(kb={placement:qb,boundary:sa,rootBoundary:Ia,padding:oa,flipVariations:Ja,allowedAutoPlacements:ua}).placement,Ic=kb.boundary,Jc=kb.rootBoundary,If=kb.padding,Jf=kb.flipVariations,Lf=void 0===(Kf=kb.allowedAutoPlacements)?sb:Kf,0===(we=(Nf=(Mf=H(bc))?Jf?Rb:Rb.filter(function(Kc){return H(Kc)===Mf}):Qb).filter(function(Kc){return Lf.indexOf(Kc)>=0})).length&&(we=Nf),Object.keys(xe=we.reduce(function(Kc,wd){return Kc[wd]=
$a(u,{placement:wd,boundary:Ic,rootBoundary:Jc,padding:If})[v(wd)],Kc},{})).sort(function(Kc,wd){return xe[Kc]-xe[wd]})):qb)},[]);D=u.rects.reference;ca=u.rects.popper;var Pa=new Map;ja=!0;for(var Ma=Sa[0],Na=0;Na<Sa.length;Na++){var Ta=Sa[Na],Ab=v(Ta),Wa=H(Ta)==="start",Ea=["top","bottom"].indexOf(Ab)>=0,ob=Ea?"width":"height",pb=$a(u,{placement:Ta,boundary:sa,rootBoundary:Ia,altBoundary:Ra,padding:oa});Wa=Ea?Wa?"right":"left":Wa?"bottom":"top";D[ob]>ca[ob]&&(Wa=Ca(Wa));ob=Ca(Wa);Ea=[];if(K&&Ea.push(pb[Ab]<=
0),V&&Ea.push(pb[Wa]<=0,pb[ob]<=0),Ea.every(function(Bb){return Bb})){Ma=Ta;ja=!1;break}Pa.set(Ta,Ea)}if(ja)for(K=function(Bb){var qb=Sa.find(function(kb){if(kb=Pa.get(kb))return kb.slice(0,Bb).every(function(bc){return bc})});if(qb)return Ma=qb,"break"},V=Ja?3:1;V>0&&"break"!==K(V);V--);u.placement!==Ma&&(u.modifiersData[p]._skip=!0,u.placement=Ma,u.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},Va={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(p){var u=
p.state;p=p.name;var D=u.rects.reference,K=u.rects.popper,V=u.modifiersData.preventOverflow,ca=$a(u,{elementContext:"reference"}),oa=$a(u,{altBoundary:!0});D=Z(ca,D);K=Z(oa,K,V);V=ea(D);oa=ea(K);u.modifiersData[p]={referenceClippingOffsets:D,popperEscapeOffsets:K,isReferenceHidden:V,hasPopperEscaped:oa};u.attributes.popper=Object.assign({},u.attributes.popper,{"data-popper-reference-hidden":V,"data-popper-escaped":oa})}},Fb={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(p){var u=
p.state,D=p.name;p=p.options.offset;var K=void 0===p?[0,0]:p;p=sb.reduce(function(oa,sa){var Ia,Ra,ja,Ja,ua,Sa;return oa[sa]=(Ia=u.rects,ja=["left","top"].indexOf(Ra=v(sa))>=0?-1:1,ua=(Ja="function"==typeof K?K(Object.assign({},Ia,{placement:sa})):K)[0],Sa=Ja[1],ua=ua||0,Sa=(Sa||0)*ja,["left","right"].indexOf(Ra)>=0?{x:Sa,y:ua}:{x:ua,y:Sa}),oa},{});var V=p[u.placement],ca=V.x;V=V.y;null!=u.modifiersData.popperOffsets&&(u.modifiersData.popperOffsets.x+=ca,u.modifiersData.popperOffsets.y+=V);u.modifiersData[D]=
p}},Zb={name:"popperOffsets",enabled:!0,phase:"read",fn:function(p){var u=p.state;u.modifiersData[p.name]=wa({reference:u.rects.reference,element:u.rects.popper,placement:u.placement})},data:{}},vc={name:"preventOverflow",enabled:!0,phase:"main",fn:function(p){var u=p.state,D=p.options;p=p.name;var K=D.mainAxis,V=D.altAxis,ca=D.tether;ca=void 0===ca||ca;var oa=D.tetherOffset,sa=void 0===oa?0:oa,Ia=$a(u,{boundary:D.boundary,rootBoundary:D.rootBoundary,padding:D.padding,altBoundary:D.altBoundary}),
Ra=v(u.placement),ja=H(u.placement),Ja=!ja,ua=ba(Ra);D="x"===ua?"y":"x";oa=u.modifiersData.popperOffsets;var Sa=u.rects.reference,Pa=u.rects.popper;sa="function"==typeof sa?sa(Object.assign({},u.rects,{placement:u.placement})):sa;var Ma="number"==typeof sa?{mainAxis:sa,altAxis:sa}:Object.assign({mainAxis:0,altAxis:0},sa),Na=u.modifiersData.offset?u.modifiersData.offset[u.placement]:null;sa={x:0,y:0};if(oa){if(void 0===K||K){var Ta,Ab="y"===ua?"top":"left",Wa="y"===ua?"bottom":"right",Ea="y"===ua?
"height":"width";K=oa[ua];var ob=K+Ia[Ab],pb=K-Ia[Wa],Bb=ca?-Pa[Ea]/2:0,qb=ja==="start"?Sa[Ea]:Pa[Ea];ja=ja==="start"?-Pa[Ea]:-Sa[Ea];var kb=u.elements.arrow;kb=ca&&kb?y(kb):{width:0,height:0};var bc=u.modifiersData["arrow#persistent"]?u.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0};Ab=bc[Ab];Wa=bc[Wa];kb=Xb(0,kc(Sa[Ea],kb[Ea]));qb=Ja?Sa[Ea]/2-Bb-kb-Ab-Ma.mainAxis:qb-kb-Ab-Ma.mainAxis;Ja=Ja?-Sa[Ea]/2+Bb+kb+Wa+Ma.mainAxis:ja+kb+Wa+Ma.mainAxis;Bb=(Ea=u.elements.arrow&&W(u.elements.arrow))?
"y"===ua?Ea.clientTop||0:Ea.clientLeft||0:0;Ea=null!=(Ta=null==Na?void 0:Na[ua])?Ta:0;Ta=ca?kc(ob,K+qb-Ea-Bb):ob;pb=ca?Xb(pb,K+Ja-Ea):pb;Ta=Xb(Ta,kc(K,pb));oa[ua]=Ta;sa[ua]=Ta-K}if(void 0!==V&&V){var Ic,Jc;V=oa[D];K="y"===D?"height":"width";Ta=V+Ia["x"===ua?"top":"left"];Ia=V-Ia["x"===ua?"bottom":"right"];Ra=-1!==["top","left"].indexOf(Ra);ua=null!=(Jc=null==Na?void 0:Na[D])?Jc:0;Jc=Ra?Ta:V-Sa[K]-Pa[K]-ua+Ma.altAxis;Sa=Ra?V+Sa[K]+Pa[K]-ua-Ma.altAxis:Ia;Pa=ca&&Ra?(Ic=Xb(Jc,kc(V,Sa)))>Sa?Sa:Ic:Xb(ca?
Jc:Ta,kc(V,ca?Sa:Ia));oa[D]=Pa;sa[D]=Pa-V}u.modifiersData[p]=sa}},requiresIfExists:["offset"]};var $b={placement:"bottom",modifiers:[],strategy:"absolute"},Hd=va(),qa=va({defaultModifiers:[ia,Zb,N,Kb]}),za=va({defaultModifiers:[ia,Zb,N,Kb,Fb,Ha,vc,Gc,Va]});let Da=Object.freeze(Object.defineProperty({__proto__:null,afterMain:"afterMain",afterRead:"afterRead",afterWrite:"afterWrite",applyStyles:Kb,arrow:Gc,auto:"auto",basePlacements:Qb,beforeMain:"beforeMain",beforeRead:"beforeRead",beforeWrite:"beforeWrite",
bottom:"bottom",clippingParents:"clippingParents",computeStyles:N,createPopper:za,createPopperBase:Hd,createPopperLite:qa,detectOverflow:$a,end:"end",eventListeners:ia,flip:Ha,hide:Va,left:"left",main:"main",modifierPhases:tb,offset:Fb,placements:sb,popper:"popper",popperGenerator:va,popperOffsets:Zb,preventOverflow:vc,read:"read",reference:"reference",right:"right",start:"start",top:"top",variationPlacements:Rb,viewport:"viewport",write:"write"},Symbol.toStringTag,{value:"Module"})),Za="rtl"===document.documentElement.dir?
"top-end":"top-start",cb="rtl"===document.documentElement.dir?"top-start":"top-end",nc="rtl"===document.documentElement.dir?"bottom-end":"bottom-start",Tc="rtl"===document.documentElement.dir?"bottom-start":"bottom-end",Wg="rtl"===document.documentElement.dir?"left-start":"right-start",Xg="rtl"===document.documentElement.dir?"right-start":"left-start",Yg={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Zg={autoClose:"(boolean|string)",boundary:"(string|element)",
display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class wc extends Wb{static get Default(){return Yg}static get DefaultType(){return Zg}static get NAME(){return"dropdown"}toggle(){return this._isShown()?this.hide():this.show()}show(){if(!gb(this._element)&&!this._isShown()){var p={relatedTarget:this._element};if(!fa.trigger(this._element,"show.bs.dropdown",p).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&
!this._parent.closest(".navbar-nav"))for(let u of[].concat(...document.body.children))fa.on(u,"mouseover",rb);this._element.focus();this._element.setAttribute("aria-expanded",!0);this._menu.classList.add("show");this._element.classList.add("show");fa.trigger(this._element,"shown.bs.dropdown",p)}}}hide(){!gb(this._element)&&this._isShown()&&this._completeHide({relatedTarget:this._element})}dispose(){this._popper&&this._popper.destroy();super.dispose()}update(){this._inNavbar=this._detectNavbar();this._popper&&
this._popper.update()}_completeHide(p){if(!fa.trigger(this._element,"hide.bs.dropdown",p).defaultPrevented){if("ontouchstart"in document.documentElement)for(let u of[].concat(...document.body.children))fa.off(u,"mouseover",rb);this._popper&&this._popper.destroy();this._menu.classList.remove("show");this._element.classList.remove("show");this._element.setAttribute("aria-expanded","false");Nb.removeDataAttribute(this._menu,"popper");fa.trigger(this._element,"hidden.bs.dropdown",p)}}_getConfig(p){if("object"==
typeof(p=super._getConfig(p)).reference&&!xb(p.reference)&&"function"!=typeof p.reference.getBoundingClientRect)throw TypeError('DROPDOWN: Option "reference" provided type "object" without a required "getBoundingClientRect" method.');return p}_createPopper(){if(void 0===Da)throw TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let p=this._element;"parent"===this._config.reference?p=this._parent:xb(this._config.reference)?p=Cb(this._config.reference):"object"==typeof this._config.reference&&
(p=this._config.reference);let u=this._getPopperConfig();this._popper=za(p,this._menu,u)}_isShown(){return this._menu.classList.contains("show")}_getPlacement(){let p=this._parent;if(p.classList.contains("dropend"))return Wg;if(p.classList.contains("dropstart"))return Xg;if(p.classList.contains("dropup-center"))return"top";if(p.classList.contains("dropdown-center"))return"bottom";let u="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return p.classList.contains("dropup")?
u?cb:Za:u?Tc:nc}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){let {offset:p}=this._config;return"string"==typeof p?p.split(",").map(u=>Number.parseInt(u,10)):"function"==typeof p?u=>p(u,this._element):p}_getPopperConfig(){let p={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||"static"===this._config.display)&&(Nb.setDataAttribute(this._menu,
"popper","static"),p.modifiers=[{name:"applyStyles",enabled:!1}]),{...p,...Db(this._config.popperConfig,[void 0,p])}}_selectMenuItem({key:p,target:u}){let D=Fa.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(K=>Sb(K));D.length&&fc(D,u,p==="ArrowDown",!D.includes(u)).focus()}static jQueryInterface(p){return this.each(function(){let u=wc.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===u[p])throw TypeError(`No method named "${p}"`);u[p]()}})}static clearMenus(p){if(2!==
p.button&&("keyup"!==p.type||"Tab"===p.key))for(let D of Fa.find('[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled).show')){let K=wc.getInstance(D);if(!K||!1===K._config.autoClose)continue;var u=p.composedPath();let V=u.includes(K._menu);u.includes(K._element)||"inside"===K._config.autoClose&&!V||"outside"===K._config.autoClose&&V||K._menu.contains(p.target)&&("keyup"===p.type&&"Tab"===p.key||/input|select|option|textarea|form/i.test(p.target.tagName))||(u={relatedTarget:K._element},"click"===
p.type&&(u.clickEvent=p),K._completeHide(u))}}static dataApiKeydownHandler(p){var u=/input|textarea/i.test(p.target.tagName),D="Escape"===p.key;let K=["ArrowUp","ArrowDown"].includes(p.key);if((K||D)&&(!u||D)){p.preventDefault();u=this.matches('[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)')?this:Fa.prev(this,'[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)')[0]||Fa.next(this,'[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)')[0]||Fa.findOne('[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',
p.delegateTarget.parentNode);D=wc.getOrCreateInstance(u);if(K)return p.stopPropagation(),D.show(),void D._selectMenuItem(p);D._isShown()&&(p.stopPropagation(),D.hide(),u.focus())}}constructor(p,u){super(p,u);this._popper=null;this._parent=this._element.parentNode;this._menu=Fa.next(this._element,".dropdown-menu")[0]||Fa.prev(this._element,".dropdown-menu")[0]||Fa.findOne(".dropdown-menu",this._parent);this._inNavbar=this._detectNavbar()}}fa.on(document,"keydown.bs.dropdown.data-api",'[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',
wc.dataApiKeydownHandler);fa.on(document,"keydown.bs.dropdown.data-api",".dropdown-menu",wc.dataApiKeydownHandler);fa.on(document,"click.bs.dropdown.data-api",wc.clearMenus);fa.on(document,"keyup.bs.dropdown.data-api",wc.clearMenus);fa.on(document,"click.bs.dropdown.data-api",'[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',function(p){p.preventDefault();wc.getOrCreateInstance(this).toggle()});Qa(wc);let $g={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},
ah={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class Of extends jc{static get Default(){return $g}static get DefaultType(){return ah}static get NAME(){return"backdrop"}show(p){if(!this._config.isVisible)return void Db(p);this._append();let u=this._getElement();this._config.isAnimated&&u.offsetHeight;u.classList.add("show");this._emulateAnimation(()=>{Db(p)})}hide(p){this._config.isVisible?(this._getElement().classList.remove("show"),
this._emulateAnimation(()=>{this.dispose();Db(p)})):Db(p)}dispose(){this._isAppended&&(fa.off(this._element,"mousedown.bs.backdrop"),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){let p=document.createElement("div");p.className=this._config.className;this._config.isAnimated&&p.classList.add("fade");this._element=p}return this._element}_configAfterMerge(p){return p.rootElement=Cb(p.rootElement),p}_append(){if(!this._isAppended){var p=this._getElement();this._config.rootElement.append(p);
fa.on(p,"mousedown.bs.backdrop",()=>{Db(this._config.clickCallback)});this._isAppended=!0}}_emulateAnimation(p){nb(p,this._getElement(),this._config.isAnimated)}constructor(p){super();this._config=this._getConfig(p);this._isAppended=!1;this._element=null}}let bh={autofocus:!0,trapElement:null},ch={autofocus:"boolean",trapElement:"element"};class Pf extends jc{static get Default(){return bh}static get DefaultType(){return ch}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&
this._config.trapElement.focus(),fa.off(document,".bs.focustrap"),fa.on(document,"focusin.bs.focustrap",p=>this._handleFocusin(p)),fa.on(document,"keydown.tab.bs.focustrap",p=>this._handleKeydown(p)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,fa.off(document,".bs.focustrap"))}_handleFocusin(p){let {trapElement:u}=this._config;p.target===document||p.target===u||u.contains(p.target)||(p=Fa.focusableChildren(u),0===p.length?u.focus():this._lastTabNavDirection==="backward"?p[p.length-
1].focus():p[0].focus())}_handleKeydown(p){"Tab"===p.key&&(this._lastTabNavDirection=p.shiftKey?"backward":"forward")}constructor(p){super();this._config=this._getConfig(p);this._isActive=!1;this._lastTabNavDirection=null}}class ye{getWidth(){return Math.abs(window.innerWidth-document.documentElement.clientWidth)}hide(){let p=this.getWidth();this._disableOverFlow();this._setElementAttributes(this._element,"padding-right",u=>u+p);this._setElementAttributes(".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",
"padding-right",u=>u+p);this._setElementAttributes(".sticky-top","margin-right",u=>u-p)}reset(){this._resetElementAttributes(this._element,"overflow");this._resetElementAttributes(this._element,"padding-right");this._resetElementAttributes(".fixed-top, .fixed-bottom, .is-fixed, .sticky-top","padding-right");this._resetElementAttributes(".sticky-top","margin-right")}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow");this._element.style.overflow=
"hidden"}_setElementAttributes(p,u,D){let K=this.getWidth();this._applyManipulationCallback(p,V=>{if(!(V!==this._element&&window.innerWidth>V.clientWidth+K)){this._saveInitialAttribute(V,u);var ca=window.getComputedStyle(V).getPropertyValue(u);V.style.setProperty(u,`${D(Number.parseFloat(ca))}px`)}})}_saveInitialAttribute(p,u){let D=p.style.getPropertyValue(u);D&&Nb.setDataAttribute(p,u,D)}_resetElementAttributes(p,u){this._applyManipulationCallback(p,D=>{let K=Nb.getDataAttribute(D,u);null!==K?(Nb.removeDataAttribute(D,
u),D.style.setProperty(u,K)):D.style.removeProperty(u)})}_applyManipulationCallback(p,u){if(xb(p))u(p);else for(let D of Fa.find(p,this._element))u(D)}constructor(){this._element=document.body}}let dh={backdrop:!0,focus:!0,keyboard:!0},eh={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class ed extends Wb{static get Default(){return dh}static get DefaultType(){return eh}static get NAME(){return"modal"}toggle(p){return this._isShown?this.hide():this.show(p)}show(p){this._isShown||
this._isTransitioning||fa.trigger(this._element,"show.bs.modal",{relatedTarget:p}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add("modal-open"),this._adjustDialog(),this._backdrop.show(()=>this._showElement(p)))}hide(){this._isShown&&!this._isTransitioning&&(fa.trigger(this._element,"hide.bs.modal").defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove("show"),this._queueCallback(()=>
this._hideModal(),this._element,this._isAnimated())))}dispose(){fa.off(window,".bs.modal");fa.off(this._dialog,".bs.modal");this._backdrop.dispose();this._focustrap.deactivate();super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new Of({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Pf({trapElement:this._element})}_showElement(p){document.body.contains(this._element)||document.body.append(this._element);this._element.style.display=
"block";this._element.removeAttribute("aria-hidden");this._element.setAttribute("aria-modal",!0);this._element.setAttribute("role","dialog");this._element.scrollTop=0;let u=Fa.findOne(".modal-body",this._dialog);u&&(u.scrollTop=0);this._element.offsetHeight;this._element.classList.add("show");this._queueCallback(()=>{this._config.focus&&this._focustrap.activate();this._isTransitioning=!1;fa.trigger(this._element,"shown.bs.modal",{relatedTarget:p})},this._dialog,this._isAnimated())}_addEventListeners(){fa.on(this._element,
"keydown.dismiss.bs.modal",p=>{"Escape"===p.key&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())});fa.on(window,"resize.bs.modal",()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()});fa.on(this._element,"mousedown.dismiss.bs.modal",p=>{fa.one(this._element,"click.dismiss.bs.modal",u=>{this._element===p.target&&this._element===u.target&&("static"!==this._config.backdrop?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display=
"none";this._element.setAttribute("aria-hidden",!0);this._element.removeAttribute("aria-modal");this._element.removeAttribute("role");this._isTransitioning=!1;this._backdrop.hide(()=>{document.body.classList.remove("modal-open");this._resetAdjustments();this._scrollBar.reset();fa.trigger(this._element,"hidden.bs.modal")})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(!fa.trigger(this._element,"hidePrevented.bs.modal").defaultPrevented){var p=this._element.scrollHeight>
document.documentElement.clientHeight,u=this._element.style.overflowY;"hidden"===u||this._element.classList.contains("modal-static")||(p||(this._element.style.overflowY="hidden"),this._element.classList.add("modal-static"),this._queueCallback(()=>{this._element.classList.remove("modal-static");this._queueCallback(()=>{this._element.style.overflowY=u},this._dialog)},this._dialog),this._element.focus())}}_adjustDialog(){let p=this._element.scrollHeight>document.documentElement.clientHeight,u=this._scrollBar.getWidth(),
D=u>0;D&&!p&&(this._element.style["rtl"===document.documentElement.dir?"paddingLeft":"paddingRight"]=`${u}px`);!D&&p&&(this._element.style["rtl"===document.documentElement.dir?"paddingRight":"paddingLeft"]=`${u}px`)}_resetAdjustments(){this._element.style.paddingLeft="";this._element.style.paddingRight=""}static jQueryInterface(p,u){return this.each(function(){let D=ed.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===D[p])throw TypeError(`No method named "${p}"`);D[p](u)}})}constructor(p,
u){super(p,u);this._dialog=Fa.findOne(".modal-dialog",this._element);this._backdrop=this._initializeBackDrop();this._focustrap=this._initializeFocusTrap();this._isTransitioning=this._isShown=!1;this._scrollBar=new ye;this._addEventListeners()}}fa.on(document,"click.bs.modal.data-api",'[data-bs-toggle="modal"]',function(p){let u=Fa.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&p.preventDefault();fa.one(u,"show.bs.modal",D=>{D.defaultPrevented||fa.one(u,"hidden.bs.modal",()=>{Sb(this)&&
this.focus()})});(p=Fa.findOne(".modal.show"))&&ed.getInstance(p).hide();ed.getOrCreateInstance(u).toggle(this)});mc(ed);Qa(ed);let fh={backdrop:!0,keyboard:!0,scroll:!1},gh={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Lc extends Wb{static get Default(){return fh}static get DefaultType(){return gh}static get NAME(){return"offcanvas"}toggle(p){return this._isShown?this.hide():this.show(p)}show(p){this._isShown||fa.trigger(this._element,"show.bs.offcanvas",{relatedTarget:p}).defaultPrevented||
(this._isShown=!0,this._backdrop.show(),this._config.scroll||(new ye).hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add("showing"),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate();this._element.classList.add("show");this._element.classList.remove("showing");fa.trigger(this._element,"shown.bs.offcanvas",{relatedTarget:p})},this._element,!0))}hide(){this._isShown&&(fa.trigger(this._element,
"hide.bs.offcanvas").defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add("hiding"),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove("show","hiding");this._element.removeAttribute("aria-modal");this._element.removeAttribute("role");this._config.scroll||(new ye).reset();fa.trigger(this._element,"hidden.bs.offcanvas")},this._element,!0)))}dispose(){this._backdrop.dispose();this._focustrap.deactivate();super.dispose()}_initializeBackDrop(){let p=
!!this._config.backdrop;return new Of({className:"offcanvas-backdrop",isVisible:p,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:p?()=>{"static"!==this._config.backdrop?this.hide():fa.trigger(this._element,"hidePrevented.bs.offcanvas")}:null})}_initializeFocusTrap(){return new Pf({trapElement:this._element})}_addEventListeners(){fa.on(this._element,"keydown.dismiss.bs.offcanvas",p=>{"Escape"===p.key&&(this._config.keyboard?this.hide():fa.trigger(this._element,"hidePrevented.bs.offcanvas"))})}static jQueryInterface(p){return this.each(function(){let u=
Lc.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===u[p]||p.startsWith("_")||"constructor"===p)throw TypeError(`No method named "${p}"`);u[p](this)}})}constructor(p,u){super(p,u);this._isShown=!1;this._backdrop=this._initializeBackDrop();this._focustrap=this._initializeFocusTrap();this._addEventListeners()}}fa.on(document,"click.bs.offcanvas.data-api",'[data-bs-toggle="offcanvas"]',function(p){let u=Fa.getElementFromSelector(this);(["A","AREA"].includes(this.tagName)&&p.preventDefault(),
gb(this))||(fa.one(u,"hidden.bs.offcanvas",()=>{Sb(this)&&this.focus()}),(p=Fa.findOne(".offcanvas.show"))&&p!==u&&Lc.getInstance(p).hide(),Lc.getOrCreateInstance(u).toggle(this))});fa.on(window,"load.bs.offcanvas.data-api",()=>{for(let p of Fa.find(".offcanvas.show"))Lc.getOrCreateInstance(p).show()});fa.on(window,"resize.bs.offcanvas",()=>{for(let p of Fa.find("[aria-modal][class*=show][class*=offcanvas-]"))"fixed"!==getComputedStyle(p).position&&Lc.getOrCreateInstance(p).hide()});mc(Lc);Qa(Lc);
let Qf={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:"src srcset alt title width height".split(" "),li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},hh=new Set("background cite href itemtype longdesc poster src xlink:href".split(" ")),ih=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,jh=(p,u)=>{let D=
p.nodeName.toLowerCase();return u.includes(D)?!hh.has(D)||!!ih.test(p.nodeValue):u.filter(K=>K instanceof RegExp).some(K=>K.test(D))},kh={allowList:Qf,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},lh={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},mh={entry:"(string|element|function|null)",selector:"(string|element)"};class nh extends jc{static get Default(){return kh}static get DefaultType(){return lh}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(p=>
this._resolvePossibleFunction(p)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(p){return this._checkContent(p),this._config.content={...this._config.content,...p},this}toHtml(){var p=document.createElement("div");for(let [D,K]of(p.innerHTML=this._maybeSanitize(this._config.template),Object.entries(this._config.content)))this._setContent(p,K,D);p=p.children[0];let u=this._resolvePossibleFunction(this._config.extraClass);return u&&p.classList.add(...u.split(" ")),p}_typeCheckConfig(p){super._typeCheckConfig(p);
this._checkContent(p.content)}_checkContent(p){for(let [u,D]of Object.entries(p))super._typeCheckConfig({selector:u,entry:D},mh)}_setContent(p,u,D){(p=Fa.findOne(D,p))&&((u=this._resolvePossibleFunction(u))?xb(u)?this._putElementInTemplate(Cb(u),p):this._config.html?p.innerHTML=this._maybeSanitize(u):p.textContent=u:p.remove())}_maybeSanitize(p){if(this._config.sanitize){var u=this._config.allowList;var D=this._config.sanitizeFn;if(p.length)if(D&&"function"==typeof D)u=D(p);else{p=(new window.DOMParser).parseFromString(p,
"text/html");for(let V of[].concat(...p.body.querySelectorAll("*"))){var K=V.nodeName.toLowerCase();if(Object.keys(u).includes(K)){D=[].concat(...V.attributes);K=[].concat(u["*"]||[],u[K]||[]);for(let ca of D)jh(ca,K)||V.removeAttribute(ca.nodeName)}else V.remove()}u=p.body.innerHTML}else u=p}else u=p;return u}_resolvePossibleFunction(p){return Db(p,[void 0,this])}_putElementInTemplate(p,u){if(this._config.html)return u.innerHTML="",void u.append(p);u.textContent=p.textContent}constructor(p){super();
this._config=this._getConfig(p)}}let oh=new Set(["sanitize","allowList","sanitizeFn"]),ph={AUTO:"auto",TOP:"top",RIGHT:"rtl"===document.documentElement.dir?"left":"right",BOTTOM:"bottom",LEFT:"rtl"===document.documentElement.dir?"right":"left"},qh={allowList:Qf,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',
title:"",trigger:"hover focus"},rh={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class fd extends Wb{static get Default(){return qh}static get DefaultType(){return rh}static get NAME(){return"tooltip"}enable(){this._isEnabled=
!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout);fa.off(this._element.closest(".modal"),"hide.bs.modal",this._hideModalHandler);this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title"));this._disposePopper();super.dispose()}show(){if("none"===this._element.style.display)throw Error("Please use show on visible elements");
if(this._isWithContent()&&this._isEnabled){var p=fa.trigger(this._element,this.constructor.eventName("show")),u=(jb(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(!p.defaultPrevented&&u){this._disposePopper();p=this._getTipElement();this._element.setAttribute("aria-describedby",p.getAttribute("id"));({container:u}=this._config);if(this._element.ownerDocument.documentElement.contains(this.tip)||(u.append(p),fa.trigger(this._element,this.constructor.eventName("inserted"))),
this._popper=this._createPopper(p),p.classList.add("show"),"ontouchstart"in document.documentElement)for(let D of[].concat(...document.body.children))fa.on(D,"mouseover",rb);this._queueCallback(()=>{fa.trigger(this._element,this.constructor.eventName("shown"));!1===this._isHovered&&this._leave();this._isHovered=!1},this.tip,this._isAnimated())}}}hide(){if(this._isShown()&&!fa.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove("show"),
"ontouchstart"in document.documentElement)for(let p of[].concat(...document.body.children))fa.off(p,"mouseover",rb);this._activeTrigger.click=!1;this._activeTrigger.focus=!1;this._activeTrigger.hover=!1;this._isHovered=null;this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),fa.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||
(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(p){p=this._getTemplateFactory(p).toHtml();if(!p)return null;p.classList.remove("fade","show");p.classList.add(`bs-${this.constructor.NAME}-auto`);var u=this.constructor.NAME;do u+=Math.floor(1E6*Math.random());while(document.getElementById(u));return p.setAttribute("id",u.toString()),this._isAnimated()&&p.classList.add("fade"),p}setContent(p){this._newContent=p;this._isShown()&&(this._disposePopper(),
this.show())}_getTemplateFactory(p){return this._templateFactory?this._templateFactory.changeContent(p):this._templateFactory=new nh({...this._config,content:p,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(p){return this.constructor.getOrCreateInstance(p.delegateTarget,
this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains("fade")}_isShown(){return this.tip&&this.tip.classList.contains("show")}_createPopper(p){let u=ph[Db(this._config.placement,[this,p,this._element]).toUpperCase()];return za(this._element,p,this._getPopperConfig(u))}_getOffset(){let {offset:p}=this._config;return"string"==typeof p?p.split(",").map(u=>Number.parseInt(u,10)):"function"==typeof p?u=>p(u,this._element):p}_resolvePossibleFunction(p){return Db(p,
[this._element,this._element])}_getPopperConfig(p){p={placement:p,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:u=>{this._getTipElement().setAttribute("data-popper-placement",u.state.placement)}}]};return{...p,...Db(this._config.popperConfig,
[void 0,p])}}_setListeners(){for(let p of this._config.trigger.split(" "))if("click"===p)fa.on(this._element,this.constructor.eventName("click"),this._config.selector,u=>{u=this._initializeOnDelegatedTarget(u);u._activeTrigger.click=!(u._isShown()&&u._activeTrigger.click);u.toggle()});else if("manual"!==p){let u=p==="hover"?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),D=p==="hover"?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");fa.on(this._element,
u,this._config.selector,K=>{let V=this._initializeOnDelegatedTarget(K);V._activeTrigger["focusin"===K.type?"focus":"hover"]=!0;V._enter()});fa.on(this._element,D,this._config.selector,K=>{let V=this._initializeOnDelegatedTarget(K);V._activeTrigger["focusout"===K.type?"focus":"hover"]=V._element.contains(K.relatedTarget);V._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()};fa.on(this._element.closest(".modal"),"hide.bs.modal",this._hideModalHandler)}_fixTitle(){let p=this._element.getAttribute("title");
p&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",p),this._element.setAttribute("data-bs-original-title",p),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(p,
u){clearTimeout(this._timeout);this._timeout=setTimeout(p,u)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(p){let u=Nb.getDataAttributes(this._element);for(let D of Object.keys(u))oh.has(D)&&delete u[D];return p={...u,...("object"==typeof p&&p?p:{})},p=this._mergeConfigObj(p),p=this._configAfterMerge(p),this._typeCheckConfig(p),p}_configAfterMerge(p){return p.container=!1===p.container?document.body:Cb(p.container),"number"==typeof p.delay&&(p.delay={show:p.delay,
hide:p.delay}),"number"==typeof p.title&&(p.title=p.title.toString()),"number"==typeof p.content&&(p.content=p.content.toString()),p}_getDelegateConfig(){let p={};for(let [u,D]of Object.entries(this._config))this.constructor.Default[u]!==D&&(p[u]=D);return p.selector=!1,p.trigger="manual",p}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null);this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(p){return this.each(function(){let u=fd.getOrCreateInstance(this,p);
if("string"==typeof p){if(void 0===u[p])throw TypeError(`No method named "${p}"`);u[p]()}})}constructor(p,u){if(void 0===Da)throw TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(p,u);this._isEnabled=!0;this._timeout=0;this._isHovered=null;this._activeTrigger={};this.tip=this._newContent=this._templateFactory=this._popper=null;this._setListeners();this._config.selector||this._fixTitle()}}Qa(fd);let sh={...fd.Default,content:"",offset:[0,8],placement:"right",
template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},th={...fd.DefaultType,content:"(null|string|element|function)"};class ze extends fd{static get Default(){return sh}static get DefaultType(){return th}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(p){return this.each(function(){let u=
ze.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===u[p])throw TypeError(`No method named "${p}"`);u[p]()}})}}Qa(ze);let uh={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},vh={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Ud extends Wb{static get Default(){return uh}static get DefaultType(){return vh}static get NAME(){return"scrollspy"}refresh(){for(let p of(this._initializeTargetsAndObservables(),
this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver(),this._observableSections.values()))this._observer.observe(p)}dispose(){this._observer.disconnect();super.dispose()}_configAfterMerge(p){return p.target=Cb(p.target)||document.body,p.rootMargin=p.offset?`${p.offset}px 0px -30%`:p.rootMargin,"string"==typeof p.threshold&&(p.threshold=p.threshold.split(",").map(u=>Number.parseFloat(u))),p}_maybeEnableSmoothScroll(){this._config.smoothScroll&&
(fa.off(this._config.target,"click.bs.scrollspy"),fa.on(this._config.target,"click.bs.scrollspy","[href]",p=>{var u=this._observableSections.get(p.target.hash);if(u){p.preventDefault();p=this._rootElement||window;u=u.offsetTop-this._element.offsetTop;if(p.scrollTo)return void p.scrollTo({top:u,behavior:"smooth"});p.scrollTop=u}}))}_getNewObserver(){return new IntersectionObserver(p=>this._observerCallback(p),{root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin})}_observerCallback(p){let u=
ca=>this._targetLinks.get(`#${ca.target.id}`),D=ca=>{this._previousScrollData.visibleEntryTop=ca.target.offsetTop;this._process(u(ca))},K=(this._rootElement||document.documentElement).scrollTop,V=K>=this._previousScrollData.parentScrollTop;for(let ca of(this._previousScrollData.parentScrollTop=K,p))if(ca.isIntersecting)if(p=ca.target.offsetTop>=this._previousScrollData.visibleEntryTop,V&&p){if(D(ca),!K)break}else V||p||D(ca);else this._activeTarget=null,this._clearActiveClass(u(ca))}_initializeTargetsAndObservables(){for(let p of(this._targetLinks=
new Map,this._observableSections=new Map,Fa.find("[href]",this._config.target))){if(!p.hash||gb(p))continue;let u=Fa.findOne(decodeURI(p.hash),this._element);Sb(u)&&(this._targetLinks.set(decodeURI(p.hash),p),this._observableSections.set(p.hash,u))}}_process(p){this._activeTarget!==p&&(this._clearActiveClass(this._config.target),this._activeTarget=p,p.classList.add("active"),this._activateParents(p),fa.trigger(this._element,"activate.bs.scrollspy",{relatedTarget:p}))}_activateParents(p){if(p.classList.contains("dropdown-item"))Fa.findOne(".dropdown-toggle",
p.closest(".dropdown")).classList.add("active");else for(let u of Fa.parents(p,".nav, .list-group"))for(let D of Fa.prev(u,".nav-link, .nav-item > .nav-link, .list-group-item"))D.classList.add("active")}_clearActiveClass(p){for(let u of(p.classList.remove("active"),Fa.find("[href].active",p)))u.classList.remove("active")}static jQueryInterface(p){return this.each(function(){let u=Ud.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===u[p]||p.startsWith("_")||"constructor"===p)throw TypeError(`No method named "${p}"`);
u[p]()}})}constructor(p,u){super(p,u);this._targetLinks=new Map;this._observableSections=new Map;this._rootElement="visible"===getComputedStyle(this._element).overflowY?null:this._element;this._observer=this._activeTarget=null;this._previousScrollData={visibleEntryTop:0,parentScrollTop:0};this.refresh()}}fa.on(window,"load.bs.scrollspy.data-api",()=>{for(let p of Fa.find('[data-bs-spy="scroll"]'))Ud.getOrCreateInstance(p)});Qa(Ud);class gd extends Wb{static get NAME(){return"tab"}show(){let p=this._element;
if(!this._elemIsActive(p)){var u=this._getActiveElem(),D=u?fa.trigger(u,"hide.bs.tab",{relatedTarget:p}):null;fa.trigger(p,"show.bs.tab",{relatedTarget:u}).defaultPrevented||D&&D.defaultPrevented||(this._deactivate(u,p),this._activate(p,u))}}_activate(p,u){p&&(p.classList.add("active"),this._activate(Fa.getElementFromSelector(p)),this._queueCallback(()=>{"tab"===p.getAttribute("role")?(p.removeAttribute("tabindex"),p.setAttribute("aria-selected",!0),this._toggleDropDown(p,!0),fa.trigger(p,"shown.bs.tab",
{relatedTarget:u})):p.classList.add("show")},p,p.classList.contains("fade")))}_deactivate(p,u){p&&(p.classList.remove("active"),p.blur(),this._deactivate(Fa.getElementFromSelector(p)),this._queueCallback(()=>{"tab"===p.getAttribute("role")?(p.setAttribute("aria-selected",!1),p.setAttribute("tabindex","-1"),this._toggleDropDown(p,!1),fa.trigger(p,"hidden.bs.tab",{relatedTarget:u})):p.classList.remove("show")},p,p.classList.contains("fade")))}_keydown(p){if("ArrowLeft ArrowRight ArrowUp ArrowDown Home End".split(" ").includes(p.key)){p.stopPropagation();
p.preventDefault();var u=this._getChildren().filter(D=>!gb(D));if(["Home","End"].includes(p.key))p=u[p.key==="Home"?0:u.length-1];else{let D=["ArrowRight","ArrowDown"].includes(p.key);p=fc(u,p.target,D,!0)}p&&(p.focus({preventScroll:!0}),gd.getOrCreateInstance(p).show())}}_getChildren(){return Fa.find('.nav-link:not(.dropdown-toggle), .list-group-item:not(.dropdown-toggle), [role="tab"]:not(.dropdown-toggle), [data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',this._parent)}_getActiveElem(){return this._getChildren().find(p=>
this._elemIsActive(p))||null}_setInitialAttributes(p,u){for(let D of(this._setAttributeIfNotExists(p,"role","tablist"),u))this._setInitialAttributesOnChild(D)}_setInitialAttributesOnChild(p){p=this._getInnerElement(p);let u=this._elemIsActive(p),D=this._getOuterElement(p);p.setAttribute("aria-selected",u);D!==p&&this._setAttributeIfNotExists(D,"role","presentation");u||p.setAttribute("tabindex","-1");this._setAttributeIfNotExists(p,"role","tab");this._setInitialAttributesOnTargetPanel(p)}_setInitialAttributesOnTargetPanel(p){let u=
Fa.getElementFromSelector(p);u&&(this._setAttributeIfNotExists(u,"role","tabpanel"),p.id&&this._setAttributeIfNotExists(u,"aria-labelledby",`${p.id}`))}_toggleDropDown(p,u){p=this._getOuterElement(p);if(p.classList.contains("dropdown")){var D=Fa.findOne(".dropdown-toggle",p);D&&D.classList.toggle("active",u);(D=Fa.findOne(".dropdown-menu",p))&&D.classList.toggle("show",u);p.setAttribute("aria-expanded",u)}}_setAttributeIfNotExists(p,u,D){p.hasAttribute(u)||p.setAttribute(u,D)}_elemIsActive(p){return p.classList.contains("active")}_getInnerElement(p){return p.matches('.nav-link:not(.dropdown-toggle), .list-group-item:not(.dropdown-toggle), [role="tab"]:not(.dropdown-toggle), [data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]')?
p:Fa.findOne('.nav-link:not(.dropdown-toggle), .list-group-item:not(.dropdown-toggle), [role="tab"]:not(.dropdown-toggle), [data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',p)}_getOuterElement(p){return p.closest(".nav-item, .list-group-item")||p}static jQueryInterface(p){return this.each(function(){let u=gd.getOrCreateInstance(this);if("string"==typeof p){if(void 0===u[p]||p.startsWith("_")||"constructor"===p)throw TypeError(`No method named "${p}"`);u[p]()}})}constructor(p){super(p);
(this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'))&&(this._setInitialAttributes(this._parent,this._getChildren()),fa.on(this._element,"keydown.bs.tab",u=>this._keydown(u)))}}fa.on(document,"click.bs.tab",'[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',function(p){["A","AREA"].includes(this.tagName)&&p.preventDefault();gb(this)||gd.getOrCreateInstance(this).show()});fa.on(window,"load.bs.tab",()=>{for(let p of Fa.find('.active[data-bs-toggle="tab"], .active[data-bs-toggle="pill"], .active[data-bs-toggle="list"]'))gd.getOrCreateInstance(p)});
Qa(gd);let wh={animation:"boolean",autohide:"boolean",delay:"number"},xh={animation:!0,autohide:!0,delay:5E3};class Vd extends Wb{static get Default(){return xh}static get DefaultType(){return wh}static get NAME(){return"toast"}show(){fa.trigger(this._element,"show.bs.toast").defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove("hide"),this._element.offsetHeight,this._element.classList.add("show","showing"),this._queueCallback(()=>
{this._element.classList.remove("showing");fa.trigger(this._element,"shown.bs.toast");this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(fa.trigger(this._element,"hide.bs.toast").defaultPrevented||(this._element.classList.add("showing"),this._queueCallback(()=>{this._element.classList.add("hide");this._element.classList.remove("showing","show");fa.trigger(this._element,"hidden.bs.toast")},this._element,this._config.animation)))}dispose(){this._clearTimeout();
this.isShown()&&this._element.classList.remove("show");super.dispose()}isShown(){return this._element.classList.contains("show")}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(p,u){switch(p.type){case "mouseover":case "mouseout":this._hasMouseInteraction=u;break;case "focusin":case "focusout":this._hasKeyboardInteraction=u}if(u)return void this._clearTimeout();p=
p.relatedTarget;this._element===p||this._element.contains(p)||this._maybeScheduleHide()}_setListeners(){fa.on(this._element,"mouseover.bs.toast",p=>this._onInteraction(p,!0));fa.on(this._element,"mouseout.bs.toast",p=>this._onInteraction(p,!1));fa.on(this._element,"focusin.bs.toast",p=>this._onInteraction(p,!0));fa.on(this._element,"focusout.bs.toast",p=>this._onInteraction(p,!1))}_clearTimeout(){clearTimeout(this._timeout);this._timeout=null}static jQueryInterface(p){return this.each(function(){let u=
Vd.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===u[p])throw TypeError(`No method named "${p}"`);u[p](this)}})}constructor(p,u){super(p,u);this._timeout=null;this._hasKeyboardInteraction=this._hasMouseInteraction=!1;this._setListeners()}}return mc(Vd),Qa(Vd),{Alert:Yb,Button:sc,Carousel:la,Collapse:Jb,Dropdown:wc,Modal:ed,Offcanvas:Lc,Popover:ze,ScrollSpy:Ud,Tab:gd,Toast:Vd,Tooltip:fd}}();var Oa={};for(let a of(!function(c){function d(B,y){for(var E=B.length;E--;)if(B[E]===y)return E;
return-1}function b(B,y,E){var G=n(B);void 0===E&&(E=y,y="all");for(var M=0;M<G.length;M++){var L=[];(B=G[M].split("+")).length>1&&(L=g(B),B=[B[B.length-1]]);(B=t(B=B[0]))in l||(l[B]=[]);l[B].push({shortcut:G[M],scope:y,method:E,key:G[M],mods:L})}}function h(){return m||"all"}function n(B){var y;return""==(y=B.replace(/\s/g,"").split(","))[y.length-1]&&(y[y.length-2]+=","),y}function g(B){B=B.slice(0,B.length-1);for(var y=0;y<B.length;y++)B[y]=r[B[y]];return B}function e(B,y,E){B.addEventListener&&
B.addEventListener(y,E,!1)}var k,l={},f={16:!1,18:!1,17:!1,91:!1},m="all",r={"\u21e7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,command:91},q={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},t=function(B){B=q[B]||B.toUpperCase().charCodeAt(0);return"function"==
typeof B?B():B},v=[];for(k=1;k<20;k++)q["f"+k]=111+k;var x={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(k in r)b[k]=!1;e(document,"keydown",function(B){!function(y){var E,G,M,L,J;if(-1==d(v,E=cf(y.key))&&v.push(E),E in f)for(M in f[E]=!0,r)r[M]==E&&(b[M]=!0);else{for(k in f)f[k]=y[x[k]];if(b.filter.call(this,y)&&E in l){var W=0;for(J=h();W<l[E].length;W++)if((G=l[E][W]).scope==J||"all"==G.scope){for(M in L=G.mods.length>0,f)(!f[M]&&d(G.mods,+M)>-1||f[M]&&-1==d(G.mods,+M))&&(L=!1);(0!=
G.mods.length||f[16]||f[18]||f[17]||f[91])&&!L||!1!==G.method(y,G)||(y.preventDefault?y.preventDefault():y.returnValue=!1,y.stopPropagation&&y.stopPropagation(),y.cancelBubble&&(y.cancelBubble=!0))}}}}(B)});e(document,"keyup",function(B){var y;B=cf(B.key);var E=d(v,B);if(E>=0&&v.splice(E,1),B in f)for(y in f[B]=!1,r)r[y]==B&&(b[y]=!1)});e(window,"focus",function(){for(k in f)f[k]=!1;for(k in r)b[k]=!1});var A=c.key;c.key=b;c.key.setScope=function(B){m=B||"all"};c.key.getScope=h;c.key.deleteScope=
function(B){var y,E;for(y in l){var G=0;for(E=l[y];G<E.length;)E[G].scope===B?E.splice(G,1):G++}};c.key.filter=function(B){B=(B.target||B.srcElement).tagName;return"INPUT"!=B&&"SELECT"!=B&&"TEXTAREA"!=B};c.key.isPressed=function(B){return"string"==typeof B&&(B=t(B)),-1!=d(v,B)};c.key.getPressedKeyCodes=function(){return v.slice(0)};c.key.noConflict=function(){var B=c.key;return c.key=A,B};c.key.unbind=function(B,y){var E,G,M,L,J=[];var W=0;for(E=n(B);W<E.length&&((G=E[W].split("+")).length>1&&(J=
g(G)),B=t(B=G[G.length-1]),void 0===y&&(y=h()),l[B]);W++)for(M=0;M<l[B].length;M++){var ba;if(ba=(L=l[B][M]).scope===y)a:if(L=L.mods,L.length!=J.length)ba=!1;else{for(ba=0;ba<L.length;ba++)if(L[ba]!==J[ba]){ba=!1;break a}ba=!0}ba&&(l[B][M]={})}};Oa=b}(Oa||{}),Sc.prototype.clone=function(){for(var c=new Sc(Array(this.points.length)),d=0;d<this.points.length;d++)c.points[d]={x:this.points[d].x,y:this.points[d].y};return c},Sc.prototype.getTransformed=function(c){for(var d=new Sc(Array(this.points.length)),
b=0;b<this.points.length;b++)d.points[b]=c.getTransformedPoint(this.points[b]);return d},Sc.prototype.getCenter=function(){for(var c=this.points[0].x,d=this.points[0].y,b=1;b<this.points.length;b++)c+=this.points[b].x,d+=this.points[b].y;return{x:c/this.points.length,y:d/this.points.length}},Sc.prototype.containsPoint=function(c){var d,b=!1;var h=0;for(d=this.points.length-1;h<this.points.length;d=h++)this.points[h].y>c.y!=this.points[d].y>c.y&&c.x<(this.points[d].x-this.points[h].x)*(c.y-this.points[h].y)/
(this.points[d].y-this.points[h].y)+this.points[h].x&&(b=!b);return b},wb.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},wb.prototype.normalize=function(){var c=this.getLength();return this.x/=c,this.y/=c,this},wb.prototype.getDotProduct=function(c){return this.x*c.x+this.y*c.y},wb.prototype.scale=function(c){return this.x*=c,this.y*=c,this},wb.prototype.getScaled=function(c){var d=new wb(this.x,this.y);return d.scale(c),d},wb.prototype.getRounded=function(){return new wb(Math.round(this.x),
Math.round(this.y))},wb.prototype.getTruncated=function(){return new wb(~~this.x,~~this.y)},wb.prototype.getPerpendicular=function(){return new wb(-this.y,this.x)},wb.prototype.add=function(c){return this.x+=c.x,this.y+=c.y,this},wb.prototype.subtract=function(c){return this.x-=c.x,this.y-=c.y,this},wb.prototype.getSum=function(c){return new wb(this.x+c.x,this.y+c.y)},wb.subtractPoints=function(c,d){return new wb(c.x-d.x,c.y-d.y)},qd.prototype=Object.create(ya(Hb).prototype),qd.prototype.constructor=
qd,Ub.MODE_INDEX_DEFAULT=0,Ub.MODE_INDEX_USER=1,Ub.prototype.setMode=function(c,d){var b=this.modes[c];b!=d&&(b&&b.leave(),this.modes[c]=d,d.enter())},Ub.prototype.setDefaultMode=function(c){c.transient=!1;c.capture=!1;this.setMode(Ub.MODE_INDEX_DEFAULT,c)},Ub.prototype.setUserMode=function(c){for(var d=this.modes.length-1;d>Ub.MODE_INDEX_USER;d--)this.modes[d].leave(),this.modes.splice(d,1);c.transient=!1;c.capture=!1;this.setMode(Ub.MODE_INDEX_USER,c)},Ub.prototype.deliverEvent=function(c,d){for(var b=
this.modes.length-1;b>=0;b--){var h=this.modes[b];if(h[c].apply(h,d)||h.capture&&"paint"!=c)return!0}return!1},["mouseDown","mouseUp"]))Ub.prototype[a]=function(c,d,b){this.deliverEvent(a,[c,d,b])};for(let a of["mouseDrag","mouseMove"])Ub.prototype[a]=function(c,d){this.deliverEvent(a,[c,d])};for(let a of["keyDown","keyUp"])Ub.prototype[a]=function(c){this.deliverEvent(a,[c])&&c.preventDefault()};Ub.prototype.paint=function(a){this.deliverEvent("paint",[a])};Ub.prototype.push=function(a,c){var d=
this.peek();d&&d.suspend();a.transient=c;a.capture=!1;a.enter();this.modes.push(a)};Ub.prototype.peek=function(){return this.modes.length>0?this.modes[this.modes.length-1]:null};Ub.prototype.pop=function(){var a=this.modes.pop(),c=this.peek();return a&&a.leave(),c&&c.resume(),c};Gd.prototype=Object.create(ya(Hb).prototype);Gd.prototype.constructor=Gd;Ob.prototype=Object.create(ya(Hb).prototype);Ob.prototype.constructor=ya(Hb);Id.prototype=Object.create(Ob.prototype);Id.prototype.constructor=Id;Jd.prototype=
Object.create(Ob.prototype);Jd.prototype.constructor=Jd;Kd.prototype=Object.create(Ob.prototype);Kd.prototype.constructor=Kd;let Wd=window.devicePixelRatio||1,Uc=Math.round(128*Wd),Vc=Math.round(128*Wd);class gf{_makeBitmap(){if(this._bitmapInvalid){var a=0,c=this._imageData.data;if(this._greyscale)for(var d=0;d<Vc;d++){var b=255-Math.round(d/(Vc-1)*255);for(var h=0;h<Uc;h++)c[a+C.RED_BYTE_OFFSET]=b,c[a+C.GREEN_BYTE_OFFSET]=b,c[a+C.BLUE_BYTE_OFFSET]=b,c[a+C.ALPHA_BYTE_OFFSET]=255,a+=C.BYTES_PER_PIXEL}else for(d=
this.color.clone(),b=0;b<Vc;b++)for(d.setValue(255-~~(b/(Vc-1)*255)),h=0;h<Uc;h++)d.setSaturation(Math.round(h/(Uc-1)*255)),c[a+C.RED_BYTE_OFFSET]=d.rgb>>16&255,c[a+C.GREEN_BYTE_OFFSET]=d.rgb>>8&255,c[a+C.BLUE_BYTE_OFFSET]=255&d.rgb,c[a+C.ALPHA_BYTE_OFFSET]=255,a+=C.BYTES_PER_PIXEL;this._bitmapInvalid=!1}}paint(){this._makeBitmap();this._canvasContext.putImageData(this._imageData,0,0);let a=this.color.getSaturation()/255*(Uc-1),c=(255-this.color.getValue())/255*(Vc-1);Fd(this._canvasContext,"stroke");
this._canvasContext.lineWidth=1.5*Wd;this._canvasContext.beginPath();this._greyscale?(this._canvasContext.moveTo(0,c),this._canvasContext.lineTo(Uc,c)):this._canvasContext.arc(a,c,5*Wd,0,2*Math.PI);this._canvasContext.stroke();this._canvasContext.globalCompositeOperation="source-over"}_mousePickColor(a){let c=this._canvas.getBoundingClientRect();var d=a.pageX-window.scrollX-c.left;a=Math.max(Math.min(255-~~(255*(a.pageY-window.scrollY-c.top)/127),255),0);this._greyscale?this.color.setGreyscale(a):
(d=Math.max(Math.min(~~(255*d/127),255),0),this.color.setHsv(this.color.getHue(),d,a));this.paint();this._controller.setCurColor(this.color)}_endDrag(a){this._canvas.releasePointerCapture(a.pointerId);this._capturedMouse=!1;this._canvas.removeEventListener("pointerup",this._handleEndDrag);this._canvas.removeEventListener("pointermove",this._handleMousePickColor)}_startDrag(a){this._capturedMouse||(this._capturedMouse=!0,this._canvas.setPointerCapture(a.pointerId),this._canvas.addEventListener("pointerup",
this._handleEndDrag),this._canvas.addEventListener("pointermove",this._handleMousePickColor));this._handleMousePickColor(a)}setHue(a){this.color.getHue()!=a&&(this.color.setHue(a),this._controller.setCurColor(this.color))}getElement(){return this._canvas}constructor(a,c){ac(this,"_controller",void 0);ac(this,"_canvas",void 0);ac(this,"_canvasContext",void 0);ac(this,"_imageData",void 0);ac(this,"_bitmapInvalid",!0);ac(this,"_capturedMouse",!1);ac(this,"_greyscale",!1);ac(this,"color",new db(0));this._controller=
a;let d=document.createElement("canvas");this._canvas=d;d.className="chickenpaint-colorpicker-select";d.setAttribute("touch-action","none");d.width=Uc;d.height=Vc;d.style.width="128px";d.style.height="128px";this._canvasContext=d.getContext("2d");this._imageData=this._canvasContext.createImageData(Uc,Vc);this._canvasContext.getImageData(0,0,1,1);this._handleEndDrag=this._endDrag.bind(this);this._handleMousePickColor=this._mousePickColor.bind(this);d.addEventListener("pointerdown",b=>this._startDrag(b));
c&&this.color.copyFrom(c);a.on("colorChange",b=>{this.color.copyFrom(b);this._bitmapInvalid=!0;this.paint()});a.on("colorModeChange",b=>{this._greyscale="greyscale"==b;this._bitmapInvalid=!0;this.paint()});this.paint()}}class hf{paint(){this._canvasContext.putImageData(this._imageData,0,0);let a=128*this.hue/360;Fd(this._canvasContext,"stroke");this._canvasContext.lineWidth=1.5;this._canvasContext.beginPath();this._canvasContext.moveTo(0,a);this._canvasContext.lineTo(24,a);this._canvasContext.stroke();
this._canvasContext.globalCompositeOperation="source-over"}_mousePickColor(a){let c=this._canvas.getBoundingClientRect();this.hue=Math.max(0,Math.min(359,~~(360*(a.pageY-c.top)/128)));this.paint();this.selecter&&this.selecter.setHue(this.hue)}_endDrag(a){this._canvas.releasePointerCapture(a.pointerId);this._capturedMouse=!1;this._canvas.removeEventListener("pointerup",this._handleEndDrag);this._canvas.removeEventListener("pointermove",this._handleMousePickColor)}_startDrag(a){this._capturedMouse||
(this._capturedMouse=!0,this._canvas.setPointerCapture(a.pointerId),this._canvas.addEventListener("pointerup",this._handleEndDrag),this._canvas.addEventListener("pointermove",this._handleMousePickColor));this._handleMousePickColor(a)}getElement(){return this._canvas}setHue(a){this.hue=a;this.paint()}constructor(a,c,d){ac(this,"hue",void 0);ac(this,"selecter",void 0);ac(this,"_canvas",void 0);ac(this,"_canvasContext",void 0);ac(this,"_imageData",void 0);ac(this,"_capturedMouse",!1);this.selecter=c;
this.hue=d||0;let b=document.createElement("canvas");this._canvas=b;a.on("colorChange",h=>{this.setHue(h.getHue())});a.on("colorModeChange",h=>{b.style.display="greyscale"==h?"none":"block"});b.setAttribute("touch-action","none");b.addEventListener("pointerdown",h=>this._startDrag(h));b.width=24;b.height=128;b.className="chickenpaint-colorpicker-slider";this._canvasContext=b.getContext("2d");this._imageData=this._canvasContext.createImageData(24,128);this._canvasContext.getImageData(0,0,1,1);this._handleEndDrag=
this._endDrag.bind(this);this._handleMousePickColor=this._mousePickColor.bind(this);(function(h){let n=new db(65535),g=0,e=h.data;for(let k=0;k<h.height;k++){n.setHue(359*k/h.height);for(let l=0;l<h.width;l++)e[g+C.RED_BYTE_OFFSET]=n.rgb>>16&255,e[g+C.GREEN_BYTE_OFFSET]=n.rgb>>8&255,e[g+C.BLUE_BYTE_OFFSET]=255&n.rgb,e[g+C.ALPHA_BYTE_OFFSET]=255,g+=C.BYTES_PER_PIXEL}})(this._imageData);this.paint()}}Ld.prototype=Object.create(Ob.prototype);Ld.prototype.constructor=Ld;ad.prototype=Object.create(ya(Hb).prototype);
ad.prototype.constructor=ad;Mb.prototype=Object.create(ya(Hb).prototype);Mb.prototype.constructor=Mb;rd.prototype=Object.create(ya(Hb).prototype);rd.prototype.constructor=rd;bd.prototype=Object.create(Ob.prototype);bd.prototype.constructor=bd;bd.CPBrushPreview=function(a){function c(){g.clearRect(0,0,n.width,n.height);g.beginPath();g.arc(n.width/2,n.height/2,h/2*window.devicePixelRatio,0,2*Math.PI);g.stroke()}function d(k){let l=n.getBoundingClientRect();var f=k.clientX-l.left-n.clientWidth/2;k=k.clientY-
l.top-n.clientHeight/2;f=Math.max(1,Math.min(200,Math.round(2*Math.sqrt(f*f+k*k))));c();a.setBrushSize(f)}function b(k){e&&(e=!1,document.removeEventListener("pointerup",b,{capture:!1}),document.removeEventListener("pointermove",d,{capture:!1}))}let h=16,n=document.createElement("canvas"),g=n.getContext("2d"),e=!1;n.addEventListener("pointerdown",function(k){e||(e=!0,document.addEventListener("pointerup",b,{passive:!0,capture:!1}),document.addEventListener("pointermove",d,{passive:!0,capture:!1}),
d(k))});this.getElement=function(){return n};a.on("toolChange",function(k,l){l.size!=h&&(h=l.size,c())});n.width=64;n.height=64;window.devicePixelRatio>1&&(n.style.width=n.width+"px",n.style.height=n.height+"px",n.width*=window.devicePixelRatio,n.height*=window.devicePixelRatio);n.className="chickenpaint-brush-preview";g.strokeStyle="black";g.lineWidth=+window.devicePixelRatio;c()};Md.prototype=Object.create(Ob.prototype);Md.prototype.constructor=Md;Nd.prototype=Object.create(Ob.prototype);Nd.prototype.constructor=
Nd;Od.prototype=Object.create(Ob.prototype);Od.prototype.constructor=Od;Pd.prototype=Object.create(ya(Hb).prototype);Pd.prototype.constructor=Pd;let mf=[{name:"File",mnemonic:"F",children:[{name:"Save to my computer",action:"CPSave",mnemonic:"S",shortcut:"ctrl+s"},{name:"Save Oekaki",action:"CPSend",mnemonic:"S",shortcut:"ctrl+s"}]},{name:"Edit",mnemonic:"E",children:[{name:"Undo",action:"CPUndo",mnemonic:"U",shortcut:"ctrl+z"},{name:"Redo",action:"CPRedo",mnemonic:"R",shortcut:"ctrl+y"},{name:"Clear history",
action:"CPClearHistory",mnemonic:"H",title:Q("Removes all undo/redo information to regain memory")},{name:"-"},{name:"Cut",action:"CPCut",mnemonic:"T",shortcut:"ctrl+x"},{name:"Copy",action:"CPCopy",mnemonic:"C",shortcut:"ctrl+c"},{name:"Copy merged",action:"CPCopyMerged",mnemonic:"Y",shortcut:"shift+ctrl+c"},{name:"Paste",action:"CPPaste",mnemonic:"P",shortcut:"ctrl+v"},{name:"-"},{name:"Select all",action:"CPSelectAll",mnemonic:"A",shortcut:"ctrl+a"},{name:"Deselect",action:"CPDeselectAll",mnemonic:"D",
shortcut:"ctrl+d"},{name:"-"},{name:"Transform",action:"CPTransform",mnemonic:"T",shortcut:"ctrl+h"}]},{name:"Layers",mnemonic:"L",children:[{name:"Duplicate",action:"CPLayerDuplicate",mnemonic:"D",shortcut:"shift+ctrl+d"},{name:"-"},{name:"Merge down",action:"CPLayerMergeDown",mnemonic:"E",shortcut:"ctrl+e"},{name:"Merge group",action:"CPGroupMerge",mnemonic:"G",shortcut:"shift+ctrl+g"},{name:"Merge all layers",action:"CPLayerMergeAll",shortcut:"shift+ctrl+e",mnemonic:"A"},{name:"Create merged layer",
action:"CPCreateMergedLayer",shortcut:"shift+alt+e"},{name:"-"},{hideIfNotAvailable:!0,name:"Add layer mask",action:"CPAddLayerMask"},{hideIfNotAvailable:!0,name:"Delete layer mask",action:"CPRemoveLayerMask",shortcut:"shift+m"},{hideIfNotAvailable:!0,name:"Apply layer mask",action:"CPApplyLayerMask",shortcut:"ctrl+m"},{name:"-"},{hideIfNotAvailable:!0,name:"Clip to the layer below",action:"CPCreateClippingMask"},{hideIfNotAvailable:!0,name:"Unclip from the layer below",action:"CPReleaseClippingMask"}]},
{name:"Effects",mnemonic:"E",children:[{name:"Clear",action:"CPClear",mnemonic:"D",shortcut:"del,backspace"},{name:"Clear with texture",action:"CPClearWithTexture",mnemonic:"T",shortcut:"shift+x"},{name:"Fill",action:"CPFill",mnemonic:"F",shortcut:"ctrl+f"},{name:"Flip horizontal",action:"CPHFlip",mnemonic:"Q",shortcut:"q"},{name:"Flip vertical",action:"CPVFlip",mnemonic:"V"},{name:"Invert",action:"CPFXInvert",mnemonic:"I",shortcut:"ctrl+i",title:Q("Invert the image colors")},{name:"-"},{name:"Convert brightness to opacity",
action:"CPBrightnessToOpacity",mnemonic:"B",title:Q("Convert brightness to opacity")},{name:"-"},{name:"Box blur...",action:"CPFXBoxBlur",mnemonic:"B"},{name:"Chromatic aberration",action:"CPChromaticAberration",mnemonic:"C"},{name:"-"},{name:"Monochromatic noise",action:"CPMNoise",mnemonic:"M",title:Q("Fills the selection with noise")},{name:"Color noise",action:"CPCNoise",mnemonic:"C",title:Q("Fills the selection with colored noise")}]},{name:"View",mnemonic:"V",children:[{name:"Full-screen mode",
action:"CPFullScreen",mnemonic:"F",checkbox:!0,checked:!1},{name:"-"},{name:"Zoom in",action:"CPZoomIn",mnemonic:"I",shortcut:"="},{name:"Zoom out",action:"CPZoomOut",mnemonic:"O",shortcut:"-"},{name:"Zoom 100%",action:"CPZoom100",mnemonic:"1",shortcut:"ctrl+0"},{name:"-"},{name:"Reset Rotation",action:"CPResetCanvasRotation",mnemonic:"R",shortcut:"alt+0"},{name:"-"},{name:"Flip View Horizontal",action:"CPViewHFlip",mnemonic:"H",shortcut:"h"},{name:"-"},{name:"Smooth-out zoomed canvas",action:"CPLinearInterpolation",
mnemonic:"L",title:Q("Linear interpolation is used to give a smoothed looked to the picture when zoomed in"),checkbox:!0,checked:!0},{name:"-"},{name:"Show grid",action:"CPToggleGrid",mnemonic:"G",shortcut:"ctrl+g",checkbox:!0,checked:!1},{name:"Grid options...",action:"CPGridOptions",mnemonic:"D"}]},{name:"Palettes",mnemonic:"P",children:[{name:"Rearrange",action:"CPArrangePalettes",title:Q("Rearrange the palette windows")},{name:"Toggle palettes",action:"CPTogglePalettes",mnemonic:"P",shortcut:"tab",
title:Q("Hides or shows all palettes")},{name:"-"},{name:"Mobile mode",action:"CPToggleSetSmallScreenMode"},{name:"-"},{name:"Show tools",action:"CPPalTool",mnemonic:"T",checkbox:!0,checked:!0},{name:"Show color",action:"CPPalColor",mnemonic:"C",checkbox:!0,checked:!0},{name:"Show stroke",action:"CPPalStroke",mnemonic:"S",checkbox:!0,checked:!0},{name:"Show misc",action:"CPPalMisc",mnemonic:"M",checkbox:!0,checked:!0},{name:"Show swatches",action:"CPPalSwatches",mnemonic:"W",checkbox:!0,checked:!0},
{name:"Show textures",action:"CPPalTextures",mnemonic:"X",checkbox:!0,checked:!0},{name:"Show tool options",action:"CPPalBrush",mnemonic:"B",checkbox:!0,checked:!0},{name:"Show layers",action:"CPPalLayers",mnemonic:"L",checkbox:!0,checked:!0}]},{name:"Help",mnemonic:"H",children:[{name:"Tablet support",mnemonic:"T",action:"CPTabletSupport"},{name:"Shortcuts",mnemonic:"S",action:"CPShortcuts"},{name:"-"},{name:"About",mnemonic:"A",action:"CPAbout"}]}];Qd.prototype=Object.create(ya(Hb).prototype);Qd.prototype.constructor=
Qd;Rd.prototype=Object.create(ya(Hb).prototype);Rd.prototype.constructor=Rd;let Ae=navigator.userAgent.toLowerCase().includes("mac os"),of=Ae?"\u2318":"Ctrl",nf=Ae?"\u2325":"Alt",wg=Ae?"\u2303":"Ctrl";Sd.prototype=Object.create(ya(Hb).prototype);Sd.prototype.constructor=Sd;let yc={toolbarStyle:"new"};class Bg extends ya(Hb){setDefaults(){for(let a in yc)yc.hasOwnProperty(a)&&this.set(a,yc[a])}load(){let a={};try{a=JSON.parse(localStorage.getItem("chickenpaint-prefs"))}catch(c){console.error(c)}for(let c in a&&
"object"==typeof a||(a={}),yc)if(yc.hasOwnProperty(c))try{this.set(c,a.hasOwnProperty(c)?a[c]:yc[c])}catch(d){console.error(d)}}save(){try{let a=!1;for(let c in yc)if(yc.hasOwnProperty(c)&&this[c]!=yc[c]){a=!0;break}a?localStorage.setItem("chickenpaint-prefs",JSON.stringify({toolbarStyle:this.toolbarStyle})):localStorage.removeItem("chickenpaint-prefs")}catch(a){console.error(a)}}set(a,c){this[a]=c;this.emitEvent(a,[c])}get(a){return this[a]}constructor(){super();ac(this,"toolbarStyle",void 0);this.setDefaults()}}
X.prototype=Object.create(ya(Hb).prototype);X.prototype.constructor=X;X.UnsupportedBrowserException=function(a){this.message=a};X.UnsupportedBrowserException.prototype.toString=function(){let a="Sorry, your web browser does not support ChickenPaint.";return this.message?a+=" "+this.message:a+=" Please try a modern browser like Chrome, Safari, Firefox, or Edge.",a};X.M_DRAW=0;X.M_FLOODFILL=1;X.M_RECT_SELECTION=2;X.M_MOVE_TOOL=3;X.M_ROTATE_CANVAS=4;X.M_COLOR_PICKER=5;X.M_GRADIENTFILL=6;X.M_TRANSFORM=
7;X.M_PAN_CANVAS=8;X.T_PENCIL=0;X.T_ERASER=1;X.T_PEN=2;X.T_SOFTERASER=3;X.T_AIRBRUSH=4;X.T_DODGE=5;X.T_BURN=6;X.T_WATER=7;X.T_BLUR=8;X.T_SMUDGE=9;X.T_BLENDER=10;X.T_MAX=11;X.COLOR_MODE_RGB=0;X.COLOR_MODE_GREYSCALE=1;window.ChickenPaint=X}();
